000100***************************************************************** 00010001
000160 IDENTIFICATION DIVISION.                                         00016002
000170 PROGRAM-ID.         RCKUT189.                                    00017004
000180 AUTHOR.             German Banda.                                00018002
000190 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00019002
000200 DATE-WRITTEN.       January 2022.                                00020004
000300                                                                  00030002
000400******************************************************************00040002
000500*                                                                 00050002
000600* THIS PROGRAM WILL READ AN XML FILE FROM GEODIS. THE FILE IS     00060004
000700* THE 945 SHIPMENT CONFIRMATION THAT WILL HAVE TRAILER AND CARTON 00070004
000800* DETAIL LEVEL INFORMATION. THE DATA WILL BE PARSED               00080080
000900* INTO COPYBOOK RCRD118 FOR FURTHER PROCESSING.                   00090080
000902*                                                                 00090283
000910* THE XML BANNER WILL ERROR OUT IN THE PARSER, SO THE BANNER IS   00091083
000920* REMOVED FROM THE FILE 1200-INSPECT-XML-BANNER                   00092083
000930*                                                                 00093083
000940* THE XML PARSER IS EXPECTING A ONE CHARACTER STRING OF DATA.     00094083
000950* Logic in 1500-CREATE-XML-MSG will string together the data      00095083
000960* BEFORE PASSING IT TO THE PARSER FOR FURTHER PROCESSING          00096083
001000******************************************************************00100002
001100 ENVIRONMENT DIVISION.                                            00110002
001200******************************************************************00120002
001300 CONFIGURATION SECTION.                                           00130002
001400 SOURCE-COMPUTER.        IBM-3090.                                00140002
001500 OBJECT-COMPUTER.        IBM-3090.                                00150002
001600 INPUT-OUTPUT SECTION.                                            00160002
001700                                                                  00170002
001800 FILE-CONTROL.                                                    00180002
001900                                                                  00190002
002000     SELECT SHIP-CONFIRM-FILE                                     00200004
002100            ASSIGN TO INP01.                                      00210002
002200                                                                  00220002
002300     SELECT OUTPUT-FILE                                           00230002
002400            ASSIGN TO OUT01.                                      00240002
002500                                                                  00250002
002600******************************************************************00260002
002700 DATA DIVISION.                                                   00270002
002800******************************************************************00280002
002900 FILE SECTION.                                                    00290002
003000                                                                  00300002
003100 FD  SHIP-CONFIRM-FILE                                            00310004
003300     LABEL RECORDS ARE STANDARD                                   00330002
003400     BLOCK CONTAINS 0 RECORDS                                     00340002
003410     RECORDING MODE IS F                                          00341049
003420     RECORD CONTAINS 80 CHARACTERS                                00342085
003500     DATA RECORD IS INPUT-RECORD.                                 00350049
003810 01 INPUT-RECORD              PIC  X(80).                         00381085
003900                                                                  00390002
004000 FD  OUTPUT-FILE                                                  00400002
004100     RECORDING MODE IS F                                          00410002
004200     LABEL RECORDS ARE STANDARD                                   00420002
004300     BLOCK CONTAINS 0 RECORDS.                                    00430002
004400 01  OUTPUT-RECORD            PIC  X(330).                        00440011
004500                                                                  00450002
004600 WORKING-STORAGE SECTION.                                         00460002
004700******************************************************************00470002
004800*    PROGRAM CONSTANTS                                            00480002
004900******************************************************************00490002
005000 01  PC-PROGRAM-CONSTANTS.                                        00500002
005100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08) VALUE 'RCKUT189'.   00510004
005120     05  PC-XML-BANNER               PIC X(56) VALUE              00512033
005140     '<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>'.  00514033
005150     05  PC-END-TRANSACTION          PIC X(14) VALUE              00515059
005160     '</Transaction>'.                                            00516060
005300******************************************************************00530002
005400*    PROGRAM SWITCHES                                             00540002
005500******************************************************************00550002
005600 01  PS-PROGRAM-SWITCHES.                                         00560002
005700     05  PS-END-OF-CARTN-REC         PIC X(01) VALUE 'N'.         00570002
005800         88  PS-END-OF-CARTN-REC-YES           VALUE 'Y'.         00580002
005900         88  PS-END-OF-CARTN-REC-NO            VALUE 'N'.         00590002
006000     05  PS-END-XML-FILE             PIC X(01) VALUE 'N'.         00600002
006100         88  PS-END-OF-XML-FILE                VALUE 'Y'.         00610002
006200         88  PS-END-OF-XML-FILE-NO             VALUE 'N'.         00620002
006210     05  PS-BANNER-FOUND-SW          PIC X(01) VALUE 'N'.         00621050
006220         88  PS-BANNER-FOUND-YES               VALUE 'Y'.         00622050
006230         88  PS-BANNER-FOUND-NO                VALUE 'N'.         00623050
006240     05  PS-END-OF-TRANS-SW          PIC X(01) VALUE 'N'.         00624059
006250         88  PS-END-OF-TRANS-YES               VALUE 'Y'.         00625059
006260         88  PS-END-OF-TRANS-NO                VALUE 'N'.         00626059
006270     05  pS-XML-ERROR-SW             PIC X(01) VALUE 'N'.         00627099
006280         88  PS-XML-ERROR                      VALUE 'Y'.         00628094
006290         88  PS-XML-ERROR-NO                   VALUE 'N'.         00629094
006300******************************************************************00630002
006400*    PROGRAM VARIABLES                                            00640002
006500******************************************************************00650002
006600 01  PV-PROGRAM-VARIABLES.                                        00660002
006700     05  PV-CURRENT-ELEMENT        PIC  X(30)  VALUE SPACES.      00670002
006800     05  PV-CURRENT-ATTRIBUTE      PIC  X(30)  VALUE SPACES.      00680002
006900     05  PV-PARAGRAPH              PIC  X(30)  VALUE SPACE.       00690002
007500     05  PV-DISPLAY-NBR            PIC  ZZZ,ZZZ,ZZ9.              00750002
007600     05  PV-REC-LEN                PIC S9(09)  BINARY VALUE 32400.00760002
007700                                                                  00770002
007720     05  pv-read-count           PIC 9(8)        VALUE ZERO.      00772089
007721     05  PV-TOTAL                PIC 9(8)        VALUE ZERO.      00772189
007730     05  PV-START                PIC 9(8)        VALUE ZERO.      00773088
007740     05  PV-END                  PIC 9(8)        VALUE ZERO.      00774088
007750     05  PV-LEN                  PIC 9(8)        VALUE ZERO.      00775088
007760**** This is how big the incoming XML field can be.  Try to choose00776056
007770**** a more realistic size to prevent allocating too much memory. 00777056
007771 01  PC-XML-MAX-LENGTH           PIC X(8)        VALUE '15000000'.00777199
007780*01  PV-XML                      PIC X(16777215) VALUE SPACES.    00778094
007790 01  PV-XML                      PIC X(15000000) VALUE SPACES.    00779099
007794                                                                  00779456
007795 01  IN-XML                      PIC X(80)       VALUE SPACES.    00779585
007810                                                                  00781002
007900 01  PV-HOLD-RECORD.                                              00790002
008000     05  PV-HOLD-3RD-PRTY-DC-NBR        PIC  X(06).               00800006
008100     05  PV-HOLD-KOHLS-SHIP-TO-DC-NBR   PIC  X(06).               00810006
008200     05  PV-HOLD-SHIP-SCAC              PIC  X(06).               00820006
008300     05  PV-HOLD-SHIP-TRAILER-NBR       PIC  X(30).               00830006
008400     05  PV-HOLD-SHIP-BOL               PIC  X(30).               00840006
008500     05  PV-HOLD-SHIP-PRO               PIC  X(30).               00850006
008600     05  PV-HOLD-SHIP-DATE              PIC  X(08).               00860006
008700     05  PV-HOLD-CUST-ORDER-NBR         PIC  X(20).               00870006
008710     05  PV-HOLD-KOHLS-PO-NBR           PIC  X(10).               00871006
008720     05  PV-HOLD-3RD-PRTY-ORDER-NBR     PIC  X(15).               00872006
008730     05  PV-HOLD-DEST-STORE-NBR         PIC  X(06).               00873006
008740     05  PV-HOLD-SML-NBR                PIC  X(30).               00874006
008750     05  PV-HOLD-3RD-PRTY-CARTON-ID     PIC  X(30).               00875006
008760     05  PV-HOLD-CUST-ORDER-LINE-NBR    PIC  X(08).               00876006
008770     05  PV-HOLD-SKU-NBR                PIC  X(10).               00877006
008780     05  PV-HOLD-SHIP-QTY               PIC  X(10).               00878006
008790     05  PV-HOLD-ORDER-QTY              PIC  X(10).               00879006
008791     05  PV-HOLD-FILLER                 PIC  X(65).               00879147
008800                                                                  00880002
009600******************************************************************00960002
009700*    PROGRAM ACCUMULATORS                                         00970002
009800******************************************************************00980002
009900 01  PA-PROGRAM-ACCUMULATORS.                                     00990002
010000     05  PA-TOTAL-OUTPUT-RECS      PIC  9(09)  VALUE ZERO.        01000002
010300     05  PA-XML-PARSED             PIC S9(09)  VALUE +0 COMP-3.   01030002
010500                                                                  01050002
010600******************************************************************01060002
010700*PV-MSG IS THE INPUT MESSAGE                                      01070002
011100 01  PV-MSG-BANNER                 PIC  X(56) VALUE SPACES.       01110033
011400 01  XML-LENGTH                    PIC  9(08)   VALUE ZEROS.      01140088
011500                                                                  01150002
011600 01  PV-ABEND-VARIABLES.                                          01160002
011700     05  PV-ABEND-CODE             PIC S9(04)  VALUE +0 COMP SYNC.01170002
011800     88  ABEND-4001-WRITE-ERROR                VALUE +4001.       01180002
011900     88  ABEND-4002-READ-ERROR                 VALUE +4002.       01190002
012000     88  ABEND-4003-CTRL-CARD-ERROR            VALUE +4003.       01200002
012100     88  ABEND-4004-TABLE-ERROR                VALUE +4004.       01210002
012200     88  ABEND-4005-OPEN-ERROR                 VALUE +4005.       01220002
012300     88  ABEND-4006-CLOSE-ERROR                VALUE +4006.       01230002
012400     88  ABEND-4007-SEQUENCE-ERROR             VALUE +4007.       01240002
012500     88  ABEND-4008-DATA-ERROR                 VALUE +4008.       01250002
012600     88  ABEND-4009-KEY-DATA-ERROR             VALUE +4009.       01260002
012700     88  ABEND-4013-DB2-ERROR                  VALUE +4013.       01270002
012800     88  ABEND-4019-CAL-SUB-ERROR              VALUE +4019.       01280002
012900     88  ABEND-4020-MQ-ERROR                   VALUE +4020.       01290002
013000     88  ABEND-4444-FORCED-ABEND               VALUE +4444.       01300002
013100                                                                  01310002
013200******************************************************************01320002
013900* OUTPUT RECORD LAYOUT                                            01390002
014000******************************************************************01400002
014100     COPY RCRD118.                                                01410004
014200                                                                  01420002
014300******************************************************************01430002
014400* XML CODE DESCRIPTIONS, AND DISPLAYING FORMATTED XML MESSAGES    01440002
014500******************************************************************01450002
014600     COPY ISWS007.                                                01460002
014700     COPY ISWS008.                                                01470002
014800     COPY ISWS009.                                                01480002
014900                                                                  01490002
015000******************************************************************01500002
015100 PROCEDURE DIVISION.                                              01510002
015200******************************************************************01520002
015300*                                                                 01530002
015400******************************************************************01540002
015500*    MAIN PROCESSING.                                             01550002
015600******************************************************************01560002
015700 0000-MAIN-MODULE.                                                01570002
015800                                                                  01580002
015900     INITIALIZE  PV-PROGRAM-VARIABLES                             01590046
016000                 PV-HOLD-RECORD.                                  01600069
016100     MOVE '0000-MAIN-MODULE'           TO PV-PARAGRAPH.           01610002
016200                                                                  01620002
016300     PERFORM 1000-INITIALIZATION.                                 01630002
016400     PERFORM 1500-CREATE-XML-MSG                                  01640063
016600              UNTIL PS-END-OF-CARTN-REC-YES                       01660094
016610                 or PS-XML-ERROR.                                 01661094
016700     PERFORM 9300-EOJ.                                            01670002
016800                                                                  01680002
016900     GOBACK.                                                      01690002
017000                                                                  01700002
017100******************************************************************01710002
017200* INITIALIZATION                                                  01720002
017300******************************************************************01730002
017400 1000-INITIALIZATION.                                             01740002
017500                                                                  01750002
017600     MOVE '1000-INITIALIZATION'        TO PV-PARAGRAPH.           01760002
017700                                                                  01770002
017800     DISPLAY ' '.                                                 01780002
017900     DISPLAY '**********************************'.                01790002
018000     DISPLAY '* START OF RCKUT189               '.                01800004
018100     DISPLAY '**********************************'.                01810002
018200                                                                  01820002
018400                                                                  01840002
018500     OPEN INPUT  SHIP-CONFIRM-FILE.                               01850004
018600     OPEN OUTPUT OUTPUT-FILE.                                     01860002
018810                                                                  01881050
018900     PERFORM 5000-READ-SHIP-CONFIRM-FILE.                         01890004
018901     IF PS-END-OF-CARTN-REC-NO                                    01890142
018920        PERFORM 1200-INSPECT-XML-BANNER                           01892056
018940     END-IF.                                                      01894043
018992                                                                  01899256
018993****************************************************************  01899383
018994* INPUT XML IS READ IN FROM THE FILE AND CONCATENATED INTO        01899483
018995* ONE CHARACTER STRING AND PASSED TO THE XML PARSER.              01899583
018997****************************************************************  01899783
018998 1500-CREATE-XML-MSG.                                             01899856
018999                                                                  01899956
019000     PERFORM  UNTIL PS-END-OF-CARTN-REC-YES                       01900056
019001               OR   PS-END-OF-TRANS-YES                           01900159
019002       PERFORM 1600-FIND-START-LEN                                01900256
019003       IF IN-XML(PV-START:1) = "<"                                01900356
019004         STRING PV-XML(1:PV-TOTAL)                                01900456
019005                IN-XML(PV-START:PV-LEN)                           01900556
019006           DELIMITED BY SIZE INTO PV-XML                          01900656
019007         COMPUTE PV-TOTAL = PV-TOTAL + PV-LEN                     01900756
019008       ELSE                                                       01900856
019009         STRING PV-XML(1:PV-TOTAL) ' '                            01900956
019010                IN-XML(PV-START:PV-LEN)                           01901056
019011           DELIMITED BY SIZE INTO PV-XML                          01901156
019012         COMPUTE PV-TOTAL = PV-TOTAL + PV-LEN + 1                 01901256
019013       END-IF                                                     01901356
019014                                                                  01901461
019015       IF IN-XML(1:14) = PC-END-TRANSACTION                       01901561
019016          SET PS-END-OF-TRANS-YES TO TRUE                         01901662
019019       ELSE                                                       01901961
019020            PERFORM 5000-READ-SHIP-CONFIRM-FILE                   01902061
019021       END-IF                                                     01902161
019022                                                                  01902256
019023                                                                  01902359
019024     END-PERFORM.                                                 01902456
019025                                                                  01902562
019026     IF PS-END-OF-TRANS-YES                                       01902662
019027          DISPLAY " "                                             01902764
019028****      DISPLAY "UNFORMATTED (" PV-TOTAL " characters):"        01902874
019029          DISPLAY "XML LENGTH " PV-TOTAL                          01902976
019030****      DISPLAY PV-XML(1:PV-TOTAL)                              01903074
019031          SET PS-END-OF-TRANS-NO TO TRUE                          01903174
019032          SET PS-BANNER-FOUND-NO TO TRUE                          01903274
019033          PERFORM 2000-PROCESS-XML                                01903374
019034     END-IF.                                                      01903474
019035                                                                  01903574
019036 1600-FIND-START-LEN.                                             01903674
019037      MOVE 1  TO PV-START.                                        01903774
019038      MOVE 80 TO PV-END.                                          01903874
019039      PERFORM  UNTIL PV-START > PV-END                            01903974
019040                  OR IN-XML(PV-START:1) NOT = " "                 01904074
019041        COMPUTE PV-START = PV-START + 1                           01904174
019042      END-PERFORM.                                                01904274
019043      PERFORM  UNTIL PV-END <= PV-START                           01904374
019044                  OR IN-XML(PV-END:1) NOT = " "                   01904474
019045        COMPUTE PV-END = PV-END - 1                               01904574
019046      END-PERFORM.                                                01904674
019047      COMPUTE PV-LEN = PV-END - PV-START + 1.                     01904774
019048                                                                  01904874
019049                                                                  01904974
019050*----------------------------------------------------------------*01905002
020410******************************************************************02041042
020510 1200-INSPECT-XML-BANNER.                                         02051056
020520******************************************************************02052042
020550                                                                  02055042
020560     MOVE IN-XML(1:56)  TO PV-MSG-BANNER                          02056065
020570     IF PV-MSG-BANNER = PC-XML-BANNER                             02057042
020571        SET PS-BANNER-FOUND-YES  TO TRUE                          02057150
020572        PERFORM 5000-READ-SHIP-CONFIRM-FILE                       02057250
020593     END-IF.                                                      02059379
020600******************************************************************02060002
020698******************************************************************02069842
020700* PROCESS/PARSE THE XML DATA                                      02070002
020800******************************************************************02080002
020900 2000-PROCESS-XML.                                                02090002
021000*    DISPLAY '2000-PROCESS-XML'.                                  02100002
021100                                                                  02110002
021200     MOVE '2000-PROCESS-XML'           TO PV-PARAGRAPH.           02120002
021300                                                                  02130002
021400     XML PARSE PV-XML(1:PV-TOTAL)                                 02140056
021500         PROCESSING PROCEDURE                                     02150002
021600             2100-HANDLE-XML                                      02160002
021700                 ON EXCEPTION                                     02170002
021800                      PERFORM 3000-XML-ERROR                      02180002
021900                 NOT ON EXCEPTION                                 02190002
022000                      PERFORM 3100-XML-SUCCESS                    02200002
022100     END-XML.                                                     02210002
022200                                                                  02220002
022300                                                                  02230002
022400     INITIALIZE PV-PROGRAM-VARIABLES                              02240047
022500                PV-HOLD-RECORD.                                   02250047
022600                                                                  02260002
022700******************************************************************02270002
022800* PREP THE OUTPUT FIELDS WITH THE XML DATA                        02280002
022900******************************************************************02290002
023000 2100-HANDLE-XML.                                                 02300002
023100                                                                  02310002
023200     COMPUTE XML-LENGTH = FUNCTION LENGTH(XML-TEXT).              02320002
023300                                                                  02330002
023400     EVALUATE XML-EVENT                                           02340002
023500                                                                  02350002
023600       WHEN 'END-OF-ELEMENT'                                      02360002
023700         EVALUATE XML-TEXT(1:XML-LENGTH)                          02370002
023820           WHEN 'Line'                                            02382084
023830*          WHEN 'Transaction'                                     02383084
023840              PERFORM 7900-LOAD-RECORD                            02384084
023900*              CONTINUE                                           02390084
024000                                                                  02400002
024100           WHEN OTHER                                             02410002
024200               CONTINUE                                           02420002
024300                                                                  02430002
024400         END-EVALUATE                                             02440002
024410       WHEN 'START-OF-DOCUMENT'                                   02441014
024500              continue                                            02450058
024600       WHEN 'START-OF-ELEMENT'                                    02460002
024608            MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ELEMENT     02460817
024610                                                                  02461017
024900       WHEN 'ATTRIBUTE-NAME'                                      02490002
025100*          display 'ATTRIB-NAME=' XML-EVENT '-'                   02510074
025200*                  PV-CURRENT-ATTRIBUTE '-'                       02520074
025300*                  XML-TEXT(1:XML-LENGTH)                         02530074
025400*                 ' - ' xml-length                                02540074
025500                                                                  02550002
025600       WHEN 'ATTRIBUTE-CHARACTERS'                                02560002
025700       WHEN 'ATTRIBUTE-CHARACTER'                                 02570002
025800       WHEN 'CONTENT-CHARACTERS'                                  02580002
025900       WHEN 'CONTENT-CHARACTER'                                   02590002
025910         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ATTRIBUTE      02591020
025920         MOVE XML-TEXT(1:XML-LENGTH) TO PV-CURRENT-ATTRIBUTE      02592021
026000                                                                  02600002
026100        EVALUATE PV-CURRENT-ELEMENT                               02610021
026200*****   EVALUATE PV-CURRENT-ATTRIBUTE                             02620021
026501                                                                  02650106
026510         WHEN 'WarehouseID'                                       02651006
026520           MOVE XML-TEXT(1:XML-LENGTH) TO PV-HOLD-3RD-PRTY-DC-NBR 02652006
026530         WHEN 'SortDCID'                                          02653068
026540          MOVE XML-TEXT(1:XML-LENGTH) TO                          02654006
026550                                 PV-HOLD-KOHLS-SHIP-TO-DC-NBR     02655070
026551         WHEN 'DestinationDCID'                                   02655168
026552               continue                                           02655269
026560         WHEN 'Carrier'                                           02656006
026570          MOVE XML-TEXT(1:XML-LENGTH) TO                          02657006
026580                                 PV-HOLD-SHIP-SCAC                02658006
026590         WHEN 'TrailerNum'                                        02659006
026600          MOVE XML-TEXT(1:XML-LENGTH) TO                          02660006
026700                                 PV-HOLD-SHIP-TRAILER-NBR         02670006
026710         WHEN 'BillOfLading'                                      02671006
026720          MOVE XML-TEXT(1:XML-LENGTH) TO                          02672006
026730                                 PV-HOLD-SHIP-BOL                 02673006
026740         WHEN 'ProNumber'                                         02674006
026750          MOVE XML-TEXT(1:XML-LENGTH) TO                          02675006
026760                                 PV-HOLD-SHIP-PRO                 02676006
026770         WHEN 'ShipmentDate'                                      02677006
026780          MOVE XML-TEXT(1:XML-LENGTH) TO                          02678006
026790                                 PV-HOLD-SHIP-DATE                02679006
026800         WHEN 'OrderNum'                                          02680006
026801           MOVE XML-TEXT(1:XML-LENGTH) TO PV-HOLD-CUST-ORDER-NBR  02680106
026802               display 'OrderNum ' PV-HOLD-CUST-ORDER-NBR         02680287
026810         WHEN 'PONum'                                             02681005
026820           MOVE XML-TEXT(1:XML-LENGTH) TO PV-HOLD-KOHLS-PO-NBR    02682006
026840         WHEN 'OrderID'                                           02684008
026850           MOVE XML-TEXT(1:XML-LENGTH) TO                         02685006
026860                                     PV-HOLD-3RD-PRTY-ORDER-NBR   02686006
027800         WHEN 'DestinationStoreID'                                02780005
027900           MOVE XML-TEXT(1:XML-LENGTH) TO PV-HOLD-DEST-STORE-NBR  02790006
028000                                                                  02800002
028100         WHEN 'CartonSSCC18'                                      02810005
028200           MOVE XML-TEXT(1:XML-LENGTH) TO PV-HOLD-SML-NBR         02820006
028300                                                                  02830002
028301         WHEN 'LPID'                                              02830109
028302           MOVE XML-TEXT(1:XML-LENGTH) TO                         02830206
028303                                     PV-HOLD-3RD-PRTY-CARTON-ID   02830306
028304                                                                  02830406
028305         WHEN 'OrderLineNumber'                                   02830506
028306           MOVE XML-TEXT(1:XML-LENGTH) TO                         02830606
028307                                     PV-HOLD-CUST-ORDER-LINE-NBR  02830706
028309                                                                  02830906
028310         WHEN 'Item'                                              02831005
028320           MOVE XML-TEXT(1:XML-LENGTH) TO PV-HOLD-SKU-NBR         02832005
028330                                                                  02833005
028331         WHEN 'ShippedQuantity'                                   02833106
028332           MOVE XML-TEXT(1:XML-LENGTH) TO PV-HOLD-SHIP-QTY        02833206
028333           continue                                               02833384
028334*          PERFORM 7900-LOAD-RECORD                               02833484
028335                                                                  02833506
028340         WHEN 'OrderedQuantity'                                   02834005
028350           MOVE XML-TEXT(1:XML-LENGTH) TO PV-HOLD-ORDER-QTY       02835006
028700                                                                  02870002
028800         WHEN OTHER                                               02880002
028900             CONTINUE                                             02890002
029000                                                                  02900002
029100        END-EVALUATE                                              02910002
029200                                                                  02920002
029300       WHEN 'EXCEPTION'                                           02930002
029310            display ' '                                           02931096
029311            display 'read count:  ' pv-read-count                 02931196
029320                    '  xml len: '   PV-TOTAL                      02932096
029330                    '  max len: '   PC-XML-MAX-LENGTH             02933098
029340            display ' '                                           02934096
029350            display 'current element: ' pv-current-element        02935099
029360            display ' '                                           02936099
029400            DISPLAY 'RCKUT189-2100 - UNKNOWN XML EVENT - '        02940004
029500                   XML-EVENT                                      02950002
029510            display ' '                                           02951096
029600            DISPLAY 'Exception Caught at ' XML-TEXT(1:XML-LENGTH) 02960002
029700            SET ABEND-4020-MQ-ERROR   TO TRUE                     02970002
029800            PERFORM 3000-XML-ERROR                                02980002
029810            SET PS-XML-ERROR          TO TRUE                     02981099
029900     END-EVALUATE.                                                02990002
030000                                                                  03000002
030100******************************************************************03010002
030200* XML ERROR                                                       03020002
030300******************************************************************03030002
030400 3000-XML-ERROR.                                                  03040002
030500                                                                  03050002
030600     MOVE '3000-XML-ERROR'             TO PV-PARAGRAPH.           03060002
030700                                                                  03070002
030800     DISPLAY ' '                                                  03080099
030810     DISPLAY 'RCKUT189 - 3000-XML-ERROR.               '.         03081099
030900                                                                  03090002
031000     PERFORM 9000-EXPLAIN-XML-RESPONSE                            03100002
031100     PERFORM VARYING XML-LINE-IDX FROM 1 BY 1                     03110002
031200       UNTIL XML-LINE-IDX > XML-RESPONSE-LINES                    03120002
031300          DISPLAY XML-MSG(XML-LINE-IDX)                           03130002
031400     END-PERFORM.                                                 03140002
031500                                                                  03150002
031600     MOVE +4018              TO PV-ABEND-CODE.                    03160002
031800                                                                  03180002
031900******************************************************************03190002
032000* SUCCESSFUL XML PARSE                                            03200002
032100******************************************************************03210002
032200 3100-XML-SUCCESS.                                                03220002
032300                                                                  03230002
032400     MOVE '3100-XML-SUCCESS'           TO PV-PARAGRAPH.           03240002
032500                                                                  03250002
032600*    DISPLAY 'RCKUT189 - 3100-XML-SUCCESS.             '.         03260004
032700                                                                  03270002
032800     ADD +1                            TO PA-XML-PARSED.          03280002
032900                                                                  03290002
033000     PERFORM 5000-READ-SHIP-CONFIRM-FILE.                         03300062
033001     IF PS-END-OF-CARTN-REC-NO                                    03300162
033002        PERFORM 1200-INSPECT-XML-BANNER                           03300262
033003        MOVE +0  TO PV-TOTAL                                      03300362
033030     END-IF.                                                      03303062
033100******************************************************************03310002
033200 5000-READ-SHIP-CONFIRM-FILE.                                     03320004
033300******************************************************************03330002
033400     READ SHIP-CONFIRM-FILE INTO IN-XML                           03340056
033500       AT END                                                     03350002
033600        SET PS-END-OF-CARTN-REC-YES TO TRUE                       03360002
033700     END-READ.                                                    03370002
033710                                                                  03371089
033720     if PS-END-OF-CARTN-REC-YES                                   03372089
033730        display 'read count:  ' pv-read-count                     03373089
033731                '  xml len: '   PV-TOTAL                          03373192
033740     else                                                         03374089
033750        add  1 to  pv-read-count                                  03375089
033760     end-if.                                                      03376090
033800                                                                  03380002
033801******************************************************************03380130
033870                                                                  03387030
033900 7900-LOAD-RECORD.                                                03390002
034000                                                                  03400045
034700      INITIALIZE  RC118-PARSED-SHIPMENT-REC.                      03470045
034800      MOVE PV-HOLD-3RD-PRTY-DC-NBR      TO RC118-3RD-PRTY-DC-NBR. 03480007
034900      MOVE PV-HOLD-KOHLS-SHIP-TO-DC-NBR TO                        03490007
034910                                       RC118-KOHLS-SHIP-TO-DC-NBR.03491007
035000      MOVE PV-HOLD-SHIP-SCAC            TO RC118-SHIP-SCAC.       03500007
035100      MOVE PV-HOLD-SHIP-TRAILER-NBR     TO RC118-SHIP-TRAILER-NBR.03510007
035200      MOVE PV-HOLD-SHIP-BOL             TO RC118-SHIP-BOL.        03520007
035300      MOVE PV-HOLD-SHIP-PRO             TO RC118-SHIP-PRO.        03530007
035400      MOVE PV-HOLD-SHIP-DATE            TO RC118-SHIP-DATE.       03540007
035410      MOVE PV-HOLD-CUST-ORDER-NBR       TO RC118-CUST-ORDER-NBR.  03541007
035420      MOVE PV-HOLD-KOHLS-PO-NBR         TO RC118-KOHLS-PO-NBR.    03542007
035430      MOVE PV-HOLD-3RD-PRTY-ORDER-NBR   TO                        03543007
035431                                        RC118-3RD-PRTY-ORDER-NBR. 03543107
035440      MOVE PV-HOLD-DEST-STORE-NBR       TO RC118-DEST-STORE-NBR.  03544007
035450      MOVE PV-HOLD-SML-NBR              TO RC118-SML-NBR.         03545007
035460      MOVE PV-HOLD-3RD-PRTY-CARTON-ID   TO                        03546007
035461                                        RC118-3RD-PRTY-CARTON-ID. 03546107
035470      MOVE PV-HOLD-CUST-ORDER-LINE-NBR  TO                        03547007
035471                                        RC118-CUST-ORDER-LINE-NBR.03547107
035480      MOVE PV-HOLD-SKU-NBR              TO RC118-SKU-NBR.         03548007
035490      MOVE PV-HOLD-SHIP-QTY             TO RC118-SHIP-QTY.        03549007
035491      MOVE PV-HOLD-ORDER-QTY            TO RC118-ORDER-QTY.       03549107
035500      PERFORM 8000-WRITE-RECORD.                                  03550002
035600******************************************************************03560002
035700* WRITE MESSAGES TO A OUTPUT FILE                                 03570002
035800******************************************************************03580002
035900 8000-WRITE-RECORD.                                               03590002
036000                                                                  03600002
036100     WRITE OUTPUT-RECORD                                          03610002
036200       FROM RC118-PARSED-SHIPMENT-REC.                            03620010
036300                                                                  03630002
036400     ADD +1                            TO PA-TOTAL-OUTPUT-RECS.   03640002
036500                                                                  03650002
036600******************************************************************03660002
039200* EOJ AND DISPLAY SUMMARY TOTALS.                                 03920002
039300******************************************************************03930002
039400 9300-EOJ.                                                        03940002
039500                                                                  03950002
039600     MOVE '9300-EOJ'              TO PV-PARAGRAPH.                03960002
039700                                                                  03970002
039800     CLOSE OUTPUT-FILE.                                           03980002
039900                                                                  03990002
040000     DISPLAY SPACES.                                              04000002
040100     DISPLAY '******************************'.                    04010002
040200     DISPLAY ' RCKUT189 SUMMARY STATISTICS '.                     04020004
040300     DISPLAY '******************************'.                    04030002
040400     DISPLAY SPACES.                                              04040002
040500                                                                  04050002
040600     MOVE PA-XML-PARSED                TO PV-DISPLAY-NBR.         04060002
040700     DISPLAY ' UNIQUE FILES PARSED  = '   PV-DISPLAY-NBR.         04070002
040800     DISPLAY SPACES.                                              04080002
040900                                                                  04090002
041000     MOVE PA-TOTAL-OUTPUT-RECS         TO PV-DISPLAY-NBR.         04100002
041100     DISPLAY ' RECORDS WRITTEN/SINGLE SKU CARTONS'                04110002
041200     DISPLAY ' RECORDS WRITTEN      = '   PV-DISPLAY-NBR.         04120002
041300                                                                  04130002
041400     DISPLAY SPACES.                                              04140002
041500                                                                  04150002
041600******************************************************************04160002
041700     COPY ISPD007.                                                04170002
041800     COPY ISPD008.                                                04180002
041900     COPY ISPD009.                                                04190002
