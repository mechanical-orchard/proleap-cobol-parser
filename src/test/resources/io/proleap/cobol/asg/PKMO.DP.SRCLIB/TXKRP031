000100******************************************************************00010061
000200 IDENTIFICATION DIVISION.                                         00020061
000400                                                                  00030061
000500 PROGRAM-ID.             TXKRP031.                                00040061
000600 AUTHOR.                 KATHY PRIESTER.                          00050061
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060061
000800 DATE-WRITTEN.           APRIL 2002.                              00070061
000900 DATE-COMPILED.                                                   00080061
001000                                                                  00090061
001100******************************************************************00100061
001200*  THIS PROGRAM COMPARES THE TRANSACTION TOTAL SLS AMOUNT AND    *00110061
001300*  TAX AMOUNT ON THE TAX REPORTING TRANSACTIONS EXTRACTED FROM   *00120061
001400*  COSA BY TXKUT005 TO THE AMOUNTS ON THE TEPTRN ROWS.  IT       *00130061
001500*  CREATES A REPORT THAT SHOWS ANY TRANSACTIONS THAT ARE OUT OF  *00140061
001600*  BALANCE.   THE PROGRAM WILL COMPLETE WITH A RETURN CODE OF 12 *00150061
001700*  WHEN THERE ARE TRANSACTIONS OUT OF BALANCE.                   *00160061
001800******************************************************************00170061
C92405*  01/07/15  BARB SCHULTZ CHG0092405                             *00180061
C92405*  MARKETPLACE PROJECT - ADD ONLY KOHLS ITEMS UP, NOT WAYFAIR    *00190061
C92405*  ITEMS. MADE CHANGES TO THIS PROGRAM TO NOT ADD IN THE WAYFAIR *00200061
C92405*  ITEMS.                                                        *00210061
C92405******************************************************************00220061
105300*  03/12/15  BARB SCHULTZ CHG0105300                             *00230061
105300*  MARKETPLACE PROJECT - CHANGE THE TX_AMT TO NEGATIVE IF THE    *00240061
105300*  SLS_AMT ON TEPITM IS NEGATIVE.                                *00250061
105300*  COMMENTED OUT THE CHANGES - 3/16/15                           *00260061
105300******************************************************************00270061
STCFEE* CHANGE #: CHG0160001   JIM HUNTER         DATE:2017-01-30       00280099
STCFEE* --------------------                                            00290099
STCFEE* ADDING LOGIC TO CAPTURE FEES FROM THE TEPLIS TABLE FOR THE      00300073
STCFEE* SALES TAX COMPLIANCE PROJECT                                    00310073
STCFEE******************************************************************00320073
020619* CHANGE #: CHG0216630   DAN PAYNTER        DATE:2019-02-06       00321099
020619* --------------------                                            00322099
020619* ADDING LOGIC TO PROPERLY CAPTURE FEES FROM TEPLIS FOR POC FEES  00323099
020619******************************************************************00325099
001900 ENVIRONMENT DIVISION.                                            00330061
002000                                                                  00340061
002100 INPUT-OUTPUT SECTION.                                            00350061
002200                                                                  00360061
002300 FILE-CONTROL.                                                    00370061
002400                                                                  00380061
002500     SELECT DATE-CNTL-FILE                                        00390061
002600         ASSIGN TO INP01.                                         00400061
002700                                                                  00410061
002800     SELECT TAX-EXTRACT-FILE                                      00420061
002900         ASSIGN TO INP02.                                         00430061
003000                                                                  00440061
003100     SELECT TAX-OUT-OF-BAL-FILE                                   00450061
003200         ASSIGN TO OUT01.                                         00460061
003300                                                                  00470061
003400     SELECT TAX-BALANCE-REPORT                                    00480061
003500         ASSIGN TO RPT01.                                         00490061
003600                                                                  00500061
003700******************************************************************00510061
003800 DATA DIVISION.                                                   00520061
003900******************************************************************00530061
004000                                                                  00540061
004100 FILE SECTION.                                                    00550061
004200                                                                  00560061
004300 FD  DATE-CNTL-FILE                                               00570061
004400     RECORDING MODE IS F                                          00580061
004500     LABEL RECORDS ARE STANDARD                                   00590061
004600     BLOCK CONTAINS 0 RECORDS                                     00600061
004700     RECORD CONTAINS 80 CHARACTERS                                00610061
004800     DATA RECORD IS DATE-CNTL-RECORD.                             00620061
004900                                                                  00630061
005000 01  DATE-CNTL-RECORD         PIC X(80).                          00640061
005100                                                                  00650061
005200 FD  TAX-EXTRACT-FILE                                             00660061
005300     RECORDING MODE IS F                                          00670061
005400     LABEL RECORDS ARE STANDARD                                   00680061
005500     BLOCK CONTAINS 0 RECORDS                                     00690061
005600     RECORD CONTAINS 200 CHARACTERS                               00700061
005700     DATA RECORD IS TAX-EXTRACT-RECORD.                           00710061
005800                                                                  00720061
005900 01  TAX-EXTRACT-RECORD       PIC X(200).                         00730061
006000                                                                  00740061
006100 FD  TAX-OUT-OF-BAL-FILE                                          00750061
006200     RECORDING MODE IS F                                          00760061
006300     LABEL RECORDS ARE STANDARD                                   00770061
006400     BLOCK CONTAINS 0 RECORDS                                     00780061
006500     RECORD CONTAINS 90 CHARACTERS                                00790061
006600     DATA RECORD IS TAX-OUT-OF-BAL-RECORD.                        00800061
006700                                                                  00810061
006800 01  TAX-OUT-OF-BAL-RECORD    PIC X(90).                          00820061
006900                                                                  00830061
007000 FD  TAX-BALANCE-REPORT                                           00840061
007100     RECORDING MODE IS F                                          00850061
007200     LABEL RECORDS ARE STANDARD                                   00860061
007300     BLOCK CONTAINS 0 RECORDS                                     00870061
007400     RECORD CONTAINS 132 CHARACTERS                               00880061
007500     DATA RECORD IS TAX-BALANCE-LINE.                             00890061
007600                                                                  00900061
007700 01  TAX-BALANCE-LINE         PIC X(132).                         00910061
007800                                                                  00920061
007900 WORKING-STORAGE SECTION.                                         00930061
008000                                                                  00940061
008100 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00950061
008200                                                  COMP SYNC.      00960061
008300     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00970061
008400     88  AC-DB2-ERROR                             VALUE +4013.    00980061
008500                                                                  00990061
008600 01  PS-PROGRAM-SWITCHES.                                         01000061
008700     05  PS-END-OF-DATE-CNTL-FILE-SW                              01010061
008800                                 PIC X(1)     VALUE 'N'.          01020061
008900         88  PS-NOT-END-OF-DATE-CNTL-FILE     VALUE 'N'.          01030061
009000         88  PS-END-OF-DATE-CNTL-FILE         VALUE 'Y'.          01040061
009100     05  PS-END-OF-TAX-EXTRACT-FILE-SW                            01050061
009200                                 PIC X(1)     VALUE 'N'.          01060061
009300         88  PS-NOT-END-OF-TAX-EXTRACT-FILE   VALUE 'N'.          01070061
009400         88  PS-END-OF-TAX-EXTRACT-FILE       VALUE 'Y'.          01080061
009500     05  PS-END-OF-SSFEES-CURSOR-SW                               01090061
009600                                 PIC X(1)     VALUE SPACE.        01100061
009700         88  PS-END-OF-SSFEES-CURSOR          VALUE 'Y'.          01110061
009800         88  PS-NOT-END-OF-SSFEES-CURSOR      VALUE 'N'.          01120061
009500     05  PS-END-OF-TRAN-TOT-CURSOR-SW                             01130092
009600                                 PIC X(1)     VALUE SPACE.        01140092
009700         88  PS-END-OF-TRAN-TOT-CURSOR        VALUE 'Y'.          01150092
009800         88  PS-NOT-END-OF-TRAN-TOT-CURSOR    VALUE 'N'.          01160092
009900     05  PS-NEGATIVE-SW          PIC X(1)     VALUE 'N'.          01170061
010000         88  PS-NEGATIVE-NO                   VALUE 'N'.          01180061
010100         88  PS-NEGATIVE-YES                  VALUE 'Y'.          01190061
010200                                                                  01200061
010300 01  PC-PROGRAM-CONSTANTS.                                        01210061
010400     05  PC-MAX-LINES            PIC S9(4)  VALUE 65 COMP.        01220061
010500     05  PC-CURRENT-PROGRAM-NAME PIC X(8)   VALUE 'TXKRP031'.     01230061
010600     05  PC-REPORT-NBR-1         PIC 9(1)   VALUE 1.              01240061
010700     05  PC-TAX-REFUND-ITEM      PIC X(08)  VALUE '88268073'.     01250061
010800     05  PC-REPORT-TOTAL-OB-DESC PIC X(32)                        01260061
010900         VALUE 'TOTAL TRANS OUT OF BALANCE'.                      01270061
011000     05  PC-REPORT-TOTAL-DESC    PIC X(32)                        01280061
011100         VALUE 'TOTAL TRANS FOR PROC DTE'.                        01290061
THRCHG     05  PC-VARAINCE-THRESHOLD   PIC S9(3)   VALUE 300.           01300069
011200                                                                  01310061
011300 01  PV-PROGRAM-VARIABLES.                                        01320061
011400     05  PV-PARAGRAPH-NAME       PIC  X(30)   VALUE SPACE.        01330061
011500     05  PV-DB2-OPERATION        PIC  X(40)   VALUE SPACE.        01340061
011600     05  PV-PARTITION            PIC S9(4)    COMP.               01350061
011700     05  PV-STR-NBR              PIC  9(4).                       01360061
011800     05  PV-SAVE-STR-NBR         PIC  9(4)           VALUE ZERO.  01370061
011900     05  PV-RPT-STR-NBR          PIC  9(4)           VALUE ZERO.  01380061
012000     05  PV-RGST-ID              PIC S9(4)    COMP.               01390061
012100     05  PV-TRN-NBR              PIC S9(4)    COMP.               01400061
STCFEE     05  PV-TAX-EXMPT-ID         PIC X(25)    VALUE SPACES.       01410092
020619     05  PV-LNE-ITM-SEQ-NBR      PIC S9(4) USAGE COMP.            01411099
012200     05  PV-STRT-TM              PIC X(08).                       01420061
012300     05  PV-SLS-CORR-SEQ-NBR     PIC S9(4)    COMP.               01430061
012400     05  PV-SLS-AMT              PIC S9(7)V99 COMP-3 VALUE ZERO.  01440061
C92405     05  PV-SLS-TX-AMT           PIC S9(7)V99 COMP-3 VALUE ZERO.  01450061
012500     05  PV-COSA-NET-SLS         PIC S9(7)V99 COMP-3 VALUE ZERO.  01460061
C92405     05  PV-COSA-TX-AMT          PIC S9(7)V99 COMP-3 VALUE ZERO.  01470061
C92405     05  PV-TX-AMT               PIC S9(7)V99 COMP-3 VALUE ZERO.  01480061
105300     05  PV-TX-AMTC              PIC S9(7)V99 COMP-3 VALUE ZERO.  01490061
012600     05  PV-SLS-AMT-VAR          PIC S9(7)V99 COMP-3 VALUE ZERO.  01500061
012700     05  PV-TAX-AMT-VAR          PIC S9(7)V99 COMP-3 VALUE ZERO.  01510061
012800     05  PV-ITEM                 PIC 9(08).                       01520061
012900     05  PV-SLS-DTE              PIC X(10).                       01530061
013000     05  PV-TRN-TYP-CDE          PIC X(02).                       01540061
STCFEE     05  PV-MISC-SKU             PIC 9(08)    VALUE 09910000.     01550095
STCFEE     05  PV-TAX-REFUND-SKU       PIC 9(08)    VALUE 88268073.     01560095
STCFEE     05  PV-SHIPPING-CHARGE      PIC 9(08)    VALUE 85010001.     01570095
STCFEE     05  PV-TX-WORK-AMT          PIC S9(7)V99 COMP-3 VALUE ZERO.  01580094
013100                                                                  01590061
013200 01  PV-DATE-AND-TIME-FIELDS.                                     01600061
013300     05  PV-CURR-DATE-CCYYMMDD.                                   01610061
013400         10  PV-CURR-DATE-CCYY       PIC  9(04).                  01620061
013500         10  PV-CURR-DATE-MM         PIC  9(02).                  01630061
013600         10  PV-CURR-DATE-DD         PIC  9(02).                  01640061
013700     05  PV-CURR-TIME.                                            01650061
013800         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    01660061
013900         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    01670061
014000         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    01680061
014100                                                                  01690061
014200 01  PA-PROGRAM-ACCUMULATORS.                                     01700061
014300     05  PA-LINE-CNTR           PIC S9(4)    COMP   VALUE 99.     01710061
014400     05  PA-PAGE-CNTR           PIC 9(5)     COMP-3 VALUE ZERO.   01720061
014500     05  PA-ERROR-CNTR          PIC 9(5)     COMP-3 VALUE ZERO.   01730061
014600     05  PA-TAXRPT-TRN-CNTR     PIC 9(9)     COMP-3 VALUE ZERO.   01740061
014700     05  PA-TRN-TAX-AMT         PIC S9(7)V99 COMP-3 VALUE ZERO.   01750061
014800     05  PA-TOT-TAX-AMT         PIC S9(9)V99 COMP-3 VALUE ZERO.   01760061
014900     05  PA-TOT-TAX-ERR         PIC S9(9)V99 COMP-3 VALUE ZERO.   01770061
015000     05  PA-TRN-SLS-AMT         PIC S9(7)V99 COMP-3 VALUE ZERO.   01780061
015100     05  PA-TOT-SLS-AMT         PIC S9(9)V99 COMP-3 VALUE ZERO.   01790061
015200     05  PA-TOT-SLS-ERR         PIC S9(9)V99 COMP-3 VALUE ZERO.   01800061
015300     05  PA-TEPTRN-SLS-TOT      PIC S9(9)V99 COMP-3 VALUE ZERO.   01810061
015400     05  PA-TEPTRN-TAX-TOT      PIC S9(9)V99 COMP-3 VALUE ZERO.   01820061
015500     05  PA-TEPTRN-SLS-ERR      PIC S9(9)V99 COMP-3 VALUE ZERO.   01830061
015600     05  PA-TEPTRN-TAX-ERR      PIC S9(9)V99 COMP-3 VALUE ZERO.   01840061
015700     05  PA-ECOMM-SHIP-WRAP     PIC S9(9)V99 COMP-3 VALUE ZERO.   01850061
C92405     05  PA-ECOMM-TX-AMT        PIC S9(9)V99 COMP-3 VALUE ZERO.   01860061
015800     05  PA-ECOMM-FEES          PIC S9(9)V99 COMP-3 VALUE ZERO.   01870061
C92405     05  PA-ECOMM-TX-FEES       PIC S9(9)V99 COMP-3 VALUE ZERO.   01880061
015900                                                                  01890061
016000******************************************************************01900061
016100* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    01910061
016200******************************************************************01920061
016300 01  CC-CONTROL-CARD.                                             01930061
016400     05  CC-CONTROL-CARD-DISPLAY.                                 01940061
016500         10  CC-CONTROL-NAME     PIC X(14)    VALUE               01950061
016600                                              'P.O.S. DATE = '.   01960061
016700         10  CC-POS-DATE-MMDDYY.                                  01970061
016800             15  CC-POS-DATE-MM  PIC 9(2)     VALUE ZERO.         01980061
016900             15  CC-POS-DATE-DD  PIC 9(2)     VALUE ZERO.         01990061
017000             15  CC-POS-DATE-YY  PIC 9(2)     VALUE ZERO.         02000061
017100     05  FILLER                  PIC X(60)    VALUE SPACE.        02010061
017200                                                                  02020061
017300******************************************************************02030061
017400* RECORD LAYOUT FOR STANDARD REPORT HEADINGS.                    *02040061
017500******************************************************************02050061
017600     COPY DPWS132O.                                               02060061
017700                                                                  02070061
017800                                                                  02080061
017900******************************************************************02090061
018000* RECORD LAYOUTS FOR CUSTOM REPORT HEADINGS.                     *02100061
018100******************************************************************02110061
018200 01  RH1-HEAD1.                                                   02120061
018300     05  FILLER                    PIC X(02)  VALUE SPACES.       02130061
018400     05  FILLER                    PIC X(32)  VALUE SPACES.       02140061
018500     05  FILLER                    PIC X(56)  VALUE               02150061
018600     'TAX REPORTING TRANSACTIONS OUT OF BALANCE WITH COSA FOR '.  02160061
018700     05  RH1-PROCESS-DTE           PIC X(10).                     02170061
018800     05  FILLER                    PIC X(32)  VALUE SPACES.       02180061
018900                                                                  02190061
019000 01  RH1-HEAD2.                                                   02200061
019100     05  FILLER        PIC X(01)  VALUE SPACES.                   02210061
019200     05  FILLER        PIC X(04)  VALUE ' STR'.                   02220061
019300     05  FILLER        PIC X(02)  VALUE SPACES.                   02230061
019400     05  FILLER        PIC X(08)  VALUE ' SALES  '.               02240061
019500     05  FILLER        PIC X(01)  VALUE SPACES.                   02250061
019600     05  FILLER        PIC X(04)  VALUE 'RGST'.                   02260061
019700     05  FILLER        PIC X(01)  VALUE SPACES.                   02270061
019800     05  FILLER        PIC X(04)  VALUE ' TRN'.                   02280061
019900     05  FILLER        PIC X(01)  VALUE SPACES.                   02290061
020000     05  FILLER        PIC X(08)  VALUE '   START'.               02300061
020100     05  FILLER        PIC X(01)  VALUE SPACES.                   02310061
020200     05  FILLER        PIC X(05)  VALUE ' CORR'.                  02320061
020300     05  FILLER        PIC X(03)  VALUE SPACES.                   02330061
020400     05  FILLER        PIC X(14)  VALUE '      GL    '.           02340061
020500     05  FILLER        PIC X(01)  VALUE SPACES.                   02350061
020600     05  FILLER        PIC X(14)  VALUE '      GL    '.           02360061
020700     05  FILLER        PIC X(01)  VALUE SPACES.                   02370061
020800     05  FILLER        PIC X(14)  VALUE '     TAX RPT'.           02380061
020900     05  FILLER        PIC X(01)  VALUE SPACES.                   02390061
021000     05  FILLER        PIC X(14)  VALUE '     TAX RPT'.           02400061
021100     05  FILLER        PIC X(01)  VALUE SPACES.                   02410061
021200     05  FILLER        PIC X(14)  VALUE '     SLS AMT'.           02420061
021300     05  FILLER        PIC X(01)  VALUE SPACES.                   02430061
021400     05  FILLER        PIC X(14)  VALUE '     TAX AMT'.           02440061
021500     05  FILLER        PIC X(01)  VALUE SPACES.                   02450061
021600     05  FILLER        PIC X(01)  VALUE SPACES.                   02460061
021700                                                                  02470061
021800 01  RH1-HEAD3.                                                   02480061
021900     05  FILLER        PIC X(01)  VALUE SPACES.                   02490061
022000     05  FILLER        PIC X(04)  VALUE ' NBR'.                   02500061
022100     05  FILLER        PIC X(02)  VALUE SPACES.                   02510061
022200     05  FILLER        PIC X(08)  VALUE '  DATE  '.               02520061
022300     05  FILLER        PIC X(01)  VALUE SPACES.                   02530061
022400     05  FILLER        PIC X(04)  VALUE '  ID'.                   02540061
022500     05  FILLER        PIC X(01)  VALUE SPACES.                   02550061
022600     05  FILLER        PIC X(04)  VALUE ' NBR'.                   02560061
022700     05  FILLER        PIC X(01)  VALUE SPACES.                   02570061
022800     05  FILLER        PIC X(08)  VALUE '    TIME'.               02580061
022900     05  FILLER        PIC X(01)  VALUE SPACES.                   02590061
023000     05  FILLER        PIC X(05)  VALUE 'SEQ #'.                  02600061
023100     05  FILLER        PIC X(03)  VALUE SPACES.                   02610061
023200     05  FILLER        PIC X(14)  VALUE '   SLS AMT  '.           02620061
023300     05  FILLER        PIC X(01)  VALUE SPACES.                   02630061
023400     05  FILLER        PIC X(14)  VALUE '   TAX AMT  '.           02640061
023500     05  FILLER        PIC X(01)  VALUE SPACES.                   02650061
023600     05  FILLER        PIC X(14)  VALUE '     SLS AMT'.           02660061
023700     05  FILLER        PIC X(01)  VALUE SPACES.                   02670061
023800     05  FILLER        PIC X(14)  VALUE '     TAX AMT'.           02680061
023900     05  FILLER        PIC X(01)  VALUE SPACES.                   02690061
024000     05  FILLER        PIC X(14)  VALUE '         VAR'.           02700061
024100     05  FILLER        PIC X(01)  VALUE SPACES.                   02710061
024200     05  FILLER        PIC X(14)  VALUE '         VAR'.           02720061
024300     05  FILLER        PIC X(01)  VALUE SPACES.                   02730061
024400     05  FILLER        PIC X(01)  VALUE SPACES.                   02740061
024500                                                                  02750061
024600 01  RD1-DETAIL-LINE.                                             02760061
024700     05  FILLER               PIC X(01)  VALUE SPACES.            02770061
024800     05  RD1-STR-NBR          PIC ZZZ9.                           02780061
024900     05  FILLER               PIC X(01)  VALUE SPACES.            02790061
025000     05  RD1-SLS-DTE          PIC X(08).                          02800061
025100     05  RD1-RGST-ID          PIC ZZZ9.                           02810061
025200     05  FILLER               PIC X(01)  VALUE SPACES.            02820061
025300     05  RD1-TRN-NBR          PIC ZZZ9.                           02830061
025400     05  FILLER               PIC X(01)  VALUE SPACES.            02840061
025500     05  RD1-STRT-TM          PIC X(08).                          02850061
025600     05  RD1-SLS-CORR-SEQ-NBR PIC ---9.                           02860061
025700     05  FILLER               PIC X(01)  VALUE SPACES.            02870061
025800     05  RD1-TEPTRN-SLS-AMT   PIC -,---,---,--9.99.               02880061
025900     05  FILLER               PIC X(01)  VALUE SPACES.            02890061
026000     05  RD1-TEPTRN-TAX-AMT   PIC ---,---,--9.99.                 02900061
026100     05  FILLER               PIC X(01)  VALUE SPACES.            02910061
026200     05  RD1-TAXRPT-SLS-AMT   PIC -,---,---,--9.99.               02920061
026300     05  FILLER               PIC X(01)  VALUE SPACES.            02930061
026400     05  RD1-TAXRPT-TAX-AMT   PIC ---,---,---.99.                 02940061
026500     05  FILLER               PIC X(01)  VALUE SPACES.            02950061
026600     05  RD1-SLS-AMT-VAR      PIC ---,---,--9.99.                 02960061
026700     05  FILLER               PIC X(01)  VALUE SPACES.            02970061
026800     05  RD1-TAX-AMT-VAR      PIC ---,---,--9.99.                 02980061
026900     05  FILLER               PIC X(01)  VALUE SPACES.            02990061
027000     05  RD1-COSA-BAL-IND     PIC X(01)  VALUE SPACES.            03000061
027100                                                                  03010061
027200 01  RF1-FOOT1.                                                   03020061
027300     05  FILLER               PIC X(02)  VALUE SPACES.            03030061
027400     05  RF1-TOTAL-DESC       PIC X(32)  VALUE SPACES.            03040061
027500     05  FILLER               PIC X(03)  VALUE SPACES.            03050061
027600     05  RF1-TEPTRN-SLS-AMT   PIC -,---,---,--9.99.               03060061
027700     05  FILLER               PIC X(01)  VALUE SPACES.            03070061
027800     05  RF1-TEPTRN-TAX-AMT   PIC ---,---,--9.99.                 03080061
027900     05  FILLER               PIC X(01)  VALUE SPACES.            03090061
028000     05  RF1-TAXRPT-SLS-AMT   PIC -,---,---,--9.99.               03100061
028100     05  FILLER               PIC X(01)  VALUE SPACES.            03110061
028200     05  RF1-TAXRPT-TAX-AMT   PIC ---,---,--9.99.                 03120061
028300     05  FILLER               PIC X(01)  VALUE SPACES.            03130061
028400     05  RF1-SLS-AMT-VAR      PIC ---,---,--9.99.                 03140061
028500     05  FILLER               PIC X(01)  VALUE SPACES.            03150061
028600     05  RF1-TAX-AMT-VAR      PIC ---,---,--9.99.                 03160061
028700     05  FILLER               PIC X(02)  VALUE SPACES.            03170061
028800                                                                  03180061
028900 01  RF1-FOOT2.                                                   03190061
029000     05  FILLER                    PIC X(02)  VALUE SPACES.       03200061
029100     05  FILLER                    PIC X(53)  VALUE SPACES.       03210061
029200     05  FILLER                    PIC X(23)  VALUE               03220061
029300     '**** END OF REPORT ****'.                                   03230061
029400     05  FILLER                    PIC X(54)  VALUE SPACES.       03240061
029500                                                                  03250061
029600                                                                  03260061
029700***************************************************************** 03270061
029800*  TAX EXTRACT FILE RECORD LAYOUT                                 03280061
029900***************************************************************** 03290061
030000     COPY TXRD006.                                                03300061
030100                                                                  03310061
030200***************************************************************** 03320061
030300*  TAX OUT OF BALANCE RECORD LAYOUT                               03330061
030400***************************************************************** 03340061
030500     COPY TXRD031.                                                03350061
030600                                                                  03360061
030700******************************************************************03370061
030800*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             03380061
030900******************************************************************03390061
031000     COPY DPWS500.                                                03400061
031100                                                                  03410061
031200******************************************************************03420061
031300*  DB2 ERROR ROUTINE (DSNTIAR) RECORD LAYOUT                      03430061
031400******************************************************************03440061
031500     COPY DPWS004.                                                03450061
031600                                                                  03460061
031700******************************************************************03470061
031800*  COSA TRANSACTION TABLE                                         03480061
031900******************************************************************03490061
032000     EXEC SQL                                                     03500061
032100         INCLUDE TEPTRN                                           03510061
032200     END-EXEC.                                                    03520061
032300                                                                  03530061
032400******************************************************************03540061
032500*  COSA ITEM TABLE                                                03550061
032600******************************************************************03560061
032700     EXEC SQL                                                     03570061
032800         INCLUDE TEPITM                                           03580061
032900     END-EXEC.                                                    03590061
033000                                                                  03600061
033100******************************************************************03610061
033200*  COSA SERVICE FEE TABLE                                         03620061
033300******************************************************************03630061
033400     EXEC SQL                                                     03640061
033500         INCLUDE TEPLIS                                           03650061
033600     END-EXEC.                                                    03660061
033700                                                                  03670061
033800******************************************************************03680061
033900*  COSA SHIP TABLE                                                03690061
034000******************************************************************03700061
034100     EXEC SQL                                                     03710061
034200         INCLUDE TEPSHP                                           03720061
034300     END-EXEC.                                                    03730061
034400                                                                  03740061
C92405******************************************************************03750061
C92405*  COSA IPS TABLE                                                 03760061
C92405******************************************************************03770061
C92405     EXEC SQL                                                     03780061
C92405         INCLUDE TEPIPS                                           03790061
C92405     END-EXEC.                                                    03800061
C92405                                                                  03810061
034500******************************************************************03820061
034600* PARTITION TABLE                                                 03830061
034700******************************************************************03840061
034800     EXEC SQL                                                     03850061
034900         INCLUDE TEPPART                                          03860061
035000     END-EXEC.                                                    03870061
035100                                                                  03880061
035200******************************************************************03890061
035300*  DB2 AREA FOR COMMUNICATIONS                                    03900061
035400******************************************************************03910061
035500     EXEC SQL                                                     03920061
035600         INCLUDE SQLCA                                            03930061
035700     END-EXEC.                                                    03940061
035800                                                                  03950061
035900******************************************************************03960061
036000*  CURSOR TO RETRIEVE SPECIAL SERVICE FEES FOR THE TRANSACTION.   03970061
STCFEE*  JOINING TO TEPITM TO MAKE SURE THAT ITEM HAS NOT BEEN VOIDED.  03980075
STCFEE*  BYPASSING FEES ('F').                                          03990075
036100******************************************************************04000061
036200     EXEC SQL                                                     04010061
036300         DECLARE SSFEES-CSR CURSOR FOR                            04020061
036400             SELECT A.SRVC_TYP_CDE                                04030076
036500                   ,SUM(A.SRVC_AMT)                               04040076
C92405                   ,SUM(A.TX_AMT)                                 04050076
036600             FROM TEPLIS A                                        04060061
STCFEE                , TEPITM B                                        04070075
036700            WHERE A.PARTN_NBR        = :PV-PARTITION              04080061
036800              AND A.STR_NBR          = :EPTRN-STR-NBR             04090061
036900              AND A.RGST_ID          = :PV-RGST-ID                04100061
037000              AND A.TRN_NBR          = :PV-TRN-NBR                04110061
037100              AND A.STRT_TM          = :PV-STRT-TM                04120061
037200              AND A.SLS_CORR_SEQ_NBR = :PV-SLS-CORR-SEQ-NBR       04130061
STCFEE              AND A.PARTN_NBR        = B.PARTN_NBR                04140075
STCFEE              AND A.STR_NBR          = B.STR_NBR                  04150075
STCFEE              AND A.RGST_ID          = B.RGST_ID                  04160075
STCFEE              AND A.TRN_NBR          = B.TRN_NBR                  04170075
STCFEE              AND A.STRT_TM          = B.STRT_TM                  04180075
STCFEE              AND A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR         04190075
STCFEE              AND A.LNE_ITM_SEQ_NBR  = B.LNE_ITM_SEQ_NBR          04200075
STCFEE              AND A.SRVC_TYP_CDE    <> 'F'                        04210075
STCFEE              AND B.LIV_RSLU_CDE    IN ('+', '-')                 04220075
037300              GROUP BY A.SRVC_TYP_CDE                             04230076
037400              WITH UR                                             04240075
037500     END-EXEC.                                                    04250061
035800                                                                  04260092
STCFEE******************************************************************04270092
STCFEE*  CURSOR TO RETRIEVE SALES AND TAX TOTALS FOR THE TRANSACTION.   04280092
STCFEE*  JOINING TO TEPITM TO MAKE SURE THAT ITEM HAS NOT BEEN VOIDED.  04290092
STCFEE******************************************************************04300092
STCFEE     EXEC SQL                                                     04310092
STCFEE         DECLARE TRAN-TOT-CSR CURSOR FOR                          04320092
STCFEE             SELECT TRN_STAT_CDE                                  04330092
STCFEE                   ,TX_AMT                                        04340092
STCFEE                   ,NET_CHRGD_AMT                                 04350092
STCFEE                   ,SBJCT_TO_TX_AMT                               04360092
STCFEE                   ,SKU_NBR                                       04370094
020619                   ,LNE_ITM_SEQ_NBR                               04371099
STCFEE             FROM TEPTRN A                                        04380092
STCFEE                 ,TEPITM B                                        04390092
STCFEE            WHERE A.PARTN_NBR        = B.PARTN_NBR                04400092
STCFEE              AND A.STR_NBR          = B.STR_NBR                  04410092
STCFEE              AND A.RGST_ID          = B.RGST_ID                  04420092
STCFEE              AND A.TRN_NBR          = B.TRN_NBR                  04430092
STCFEE              AND A.STRT_TM          = B.STRT_TM                  04440092
STCFEE              AND A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR         04450092
STCFEE              AND A.PARTN_NBR        = :PV-PARTITION              04460092
STCFEE              AND A.STR_NBR          = :EPTRN-STR-NBR             04470092
STCFEE              AND A.RGST_ID          = :PV-RGST-ID                04480092
STCFEE              AND A.TRN_NBR          = :PV-TRN-NBR                04490092
STCFEE              AND A.STRT_TM          = :PV-STRT-TM                04500092
STCFEE              AND A.SLS_CORR_SEQ_NBR = :PV-SLS-CORR-SEQ-NBR       04510092
STCFEE              AND B.LIV_RSLU_CDE IN ('+','-')                     04520092
STCFEE              AND NOT (DEPT_NBR = '070' AND                       04530092
STCFEE                       SUB_CL_NBR = '91')                         04540092
STCFEE         WITH UR                                                  04550092
STCFEE     END-EXEC.                                                    04560092
066400                                                                  04570092
037600******************************************************************04580061
037700 PROCEDURE DIVISION.                                              04590061
037800******************************************************************04600061
037900 0000-MAINLINE.                                                   04610061
038000                                                                  04620061
038100     PERFORM 1000-INITIALIZE.                                     04630061
038200                                                                  04640061
038300     PERFORM 2100-READ-TAX-EXTRACT-FILE.                          04650061
038400                                                                  04660061
038500     PERFORM UNTIL PS-END-OF-TAX-EXTRACT-FILE                     04670061
038600         IF PV-SAVE-STR-NBR = ZERO                                04680061
038700             PERFORM 2300-SET-UP-NEW-TRANS                        04690061
038800             MOVE TX006-STR-NBR TO PV-SAVE-STR-NBR                04700061
038900         END-IF                                                   04710061
039000         PERFORM 2000-PROCESS-TAX-EXTRACT                         04720061
039100         PERFORM 2100-READ-TAX-EXTRACT-FILE                       04730061
039200     END-PERFORM.                                                 04740061
039300                                                                  04750061
039400     IF PA-TAXRPT-TRN-CNTR > 0                                    04760061
039500         PERFORM 2200-GET-TRAN-TAX-TOTAL                          04770061
039600                                                                  04780061
039700         SET PS-NOT-END-OF-SSFEES-CURSOR TO TRUE                  04790061
039800         PERFORM 7210-OPEN-SSFEES-CURSOR                          04800061
039900         PERFORM 7220-FETCH-SSFEES-CURSOR                         04810061
040000         PERFORM UNTIL PS-END-OF-SSFEES-CURSOR                    04820061
040100             IF EPLIS-SRVC-TYP-CDE = 'W' OR                       04830061
040200              ((PV-TRN-TYP-CDE = '11' OR                          04840061
040300                PV-TRN-TYP-CDE = '12') AND                        04850061
040400                EPTRN-TRN-STAT-CDE NOT = 'R')                     04860061
040500                 COMPUTE PV-SLS-AMT = PV-SLS-AMT                  04870061
040600                                    + PA-ECOMM-FEES               04880061
040700                 END-COMPUTE                                      04890061
040800                 ADD PA-ECOMM-FEES TO PA-TEPTRN-SLS-TOT           04900061
C92405                 COMPUTE PV-TX-AMT = PV-TX-AMT                    04910061
C92405                                   + PA-ECOMM-TX-FEES             04920061
C92405                 END-COMPUTE                                      04930061
C92405                 ADD PA-ECOMM-TX-FEES TO PA-TEPTRN-TAX-TOT        04940061
040900            END-IF                                                04950061
041000            PERFORM 7220-FETCH-SSFEES-CURSOR                      04960061
041100         END-PERFORM                                              04970061
041200         PERFORM 7230-CLOSE-SSFEES-CURSOR                         04980061
041300                                                                  04990061
041400         IF PV-SLS-AMT = PA-TRN-SLS-AMT AND                       05000061
C92405            PV-TX-AMT  = PA-TRN-TAX-AMT                           05010061
041600               CONTINUE                                           05020061
041700         ELSE                                                     05030061
041800             PERFORM 2400-TRN-ERROR-PROCESS                       05040061
041900         END-IF                                                   05050061
042000     END-IF.                                                      05060061
042100                                                                  05070061
042200     PERFORM 9000-EOJ-ROUTINE.                                    05080061
042300                                                                  05090061
042400     GOBACK.                                                      05100061
042500                                                                  05110061
042600******************************************************************05120061
042700* OPEN ALL FILES.                                                *05130061
042800* GET THE DATE CONTROL CARD.                                     *05140061
042900* CONVERT THE DATE ON THE CONTROL CARD TO DB2 DATE FORMAT.       *05150061
043000* GET INTERNAL UPC FOR SPECIAL SERVICE ITEMS.                    *05160061
043100* FIND THE COSA PARTITION NUMBER FOR THE PROCESSING DATE.        *05170061
043200******************************************************************05180061
043300 1000-INITIALIZE.                                                 05190061
043400                                                                  05200061
043500     PERFORM 1100-OPEN-FILES.                                     05210061
043600                                                                  05220061
043700     PERFORM 1200-READ-DATE-CC-CARD.                              05230061
043800                                                                  05240061
043900     PERFORM 1300-CONVERT-INPUT-DATE.                             05250061
044000                                                                  05260061
044100     PERFORM 1400-FORMAT-REPORT-HEADINGS.                         05270061
044200                                                                  05280061
044300     INITIALIZE TX006-TAX-AUDIT-RECORD.                           05290061
044400                                                                  05300061
044500                                                                  05310061
044600******************************************************************05320061
044700* OPEN THE CONTROL CARD FILE AS INPUT.                           *05330061
044800* OPEN THE EXTRACT FILE AS OUTPUT.                               *05340061
044900* OPEN THE STORE GEO CODE FILE AS INPUT AND CHECK THE VSAM RETURN*05350061
045000* CODE.                                                          *05360061
045100******************************************************************05370061
045200 1100-OPEN-FILES.                                                 05380061
045300                                                                  05390061
045400     OPEN INPUT  DATE-CNTL-FILE                                   05400061
045500                 TAX-EXTRACT-FILE                                 05410061
045600          OUTPUT TAX-OUT-OF-BAL-FILE                              05420061
045700                 TAX-BALANCE-REPORT.                              05430061
045800                                                                  05440061
045900******************************************************************05450061
046000* READ THE DATE CONTROL CARD AND CLOSE THE FILE.                 *05460061
046100* IF THE DATE CONTROL CARD WAS NOT FOUND, ABEND THE PROGRAM.     *05470061
046200******************************************************************05480061
046300 1200-READ-DATE-CC-CARD.                                          05490061
046400                                                                  05500061
046500     READ DATE-CNTL-FILE INTO CC-CONTROL-CARD                     05510061
046600        AT END                                                    05520061
046700           SET PS-END-OF-DATE-CNTL-FILE TO TRUE.                  05530061
046800                                                                  05540061
046900     DISPLAY 'TXKRP031 CONTROL CARD: ' CC-CONTROL-CARD.           05550061
047000                                                                  05560061
047100     CLOSE DATE-CNTL-FILE.                                        05570061
047200                                                                  05580061
047300     IF PS-END-OF-DATE-CNTL-FILE                                  05590061
047400        DISPLAY '** ABEND ** ' PC-CURRENT-PROGRAM-NAME            05600061
047500        DISPLAY 'DATE CONTROL CARD EMPTY'                         05610061
047600        CALL 'ILBOABN0' USING AC-ABEND-CODE                       05620061
047700     END-IF.                                                      05630061
047800                                                                  05640061
047900******************************************************************05650061
048000*     CALL KOHLS CALENDAR ROUTINE:                                05660061
048100*         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            05670061
048200*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 05680061
048300******************************************************************05690061
048400 1300-CONVERT-INPUT-DATE.                                         05700061
048500                                                                  05710061
048600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05720061
048700                                                                  05730061
048800     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   05740061
048900     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   05750061
049000     SET  DPG52-LK-DTE-GREG            TO TRUE.                   05760061
049100     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    05770061
049200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05780061
049300                                             DPG54 DPG55 DPG56.   05790061
049400     IF DPG54-SEVERE-ERROR                                        05800061
049500            DISPLAY '** ABEND ** ' PC-CURRENT-PROGRAM-NAME        05810061
049600            DISPLAY 'DATE CONTROL CARD INVALID'                   05820061
049700            SET AC-CONTROL-CARD-ERROR TO TRUE                     05830061
049800            CALL 'ILBOABN0' USING AC-ABEND-CODE                   05840061
049900     END-IF.                                                      05850061
050000                                                                  05860061
050100     DISPLAY 'EXECUTION DATE USED = ' DPG55-DB2-ISO-DATE-FMT.     05870061
050200                                                                  05880061
050300******************************************************************05890061
050400* MOVE CONSTANT VALUES TO STANDARD REPORT HEADINGS.              *05900061
050500******************************************************************05910061
050600 1400-FORMAT-REPORT-HEADINGS.                                     05920061
050700                                                                  05930061
050800     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   05940061
050900     ACCEPT PV-CURR-TIME            FROM TIME.                    05950061
051000                                                                  05960061
051100     MOVE PV-CURR-DATE-MM             TO DP132O-RUN-MONTH.        05970061
051200     MOVE PV-CURR-DATE-DD             TO DP132O-RUN-DAY.          05980061
051300     MOVE PV-CURR-DATE-CCYY           TO DP132O-RUN-YEAR.         05990061
051400     MOVE PV-CURR-TIME-HH             TO DP132O-RUN-HOUR.         06000061
051500     MOVE PV-CURR-TIME-MM             TO DP132O-RUN-MINUTE.       06010061
051600     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.     06020061
051700     MOVE PC-REPORT-NBR-1             TO DP132O-REPORT-NUMBER.    06030061
051800     MOVE DPG55-GREG-CC-DATE-FMT      TO RH1-PROCESS-DTE.         06040061
051900                                                                  06050061
052000******************************************************************06060061
052100*  PROCESS THE RECORD READ FROM THE TAX REPORTING TRANSACTION    *06070061
052200*  FILE.  WHEN PROCESSING IS COMPLETE FOR A TRANSACTION, VERIFY  *06080061
052300*  THAT THE TOTALS FOR THE TRANSACTION MATCH THE AMOUNTS ON      *06090061
052400*  TEPTRN.  PERFORM THE TRANSACTION ERROR PROCESSING WHEN THERE  *06100061
052500*  THERE ARE DIFFERENCES.  ADD THE SALES AMOUNT AND TAX AMOUNT   *06110061
052600*  FOR THE SALES AMOUNT AND TAX AMOUNT FOR THE TRANSACTON AND THE*06120061
052700*  STORE.                                                        *06130061
052800******************************************************************06140061
052900 2000-PROCESS-TAX-EXTRACT.                                        06150061
053000                                                                  06160061
053100     IF TX006-PARTITION        = PV-PARTITION        AND          06170061
053200        TX006-STR-NBR          = PV-STR-NBR          AND          06180061
053300        TX006-RGST-ID          = PV-RGST-ID          AND          06190061
053400        TX006-TRN-NBR          = PV-TRN-NBR          AND          06200061
053500        TX006-START-TIME       = PV-STRT-TM          AND          06210061
053600        TX006-SLS-CORR-SEQ-NBR = PV-SLS-CORR-SEQ-NBR              06220061
053700          CONTINUE                                                06230061
053800     ELSE                                                         06240061
053900         PERFORM 2200-GET-TRAN-TAX-TOTAL                          06250061
054000         SET PS-NOT-END-OF-SSFEES-CURSOR TO TRUE                  06260061
054100         PERFORM 7210-OPEN-SSFEES-CURSOR                          06270061
054200         PERFORM 7220-FETCH-SSFEES-CURSOR                         06280061
054300         PERFORM UNTIL PS-END-OF-SSFEES-CURSOR                    06290061
054400             IF EPLIS-SRVC-TYP-CDE = 'W' OR                       06300061
054500              ((PV-TRN-TYP-CDE = '11' OR                          06310061
054600                PV-TRN-TYP-CDE = '12') AND                        06320061
054700                EPTRN-TRN-STAT-CDE NOT = 'R')                     06330061
054800                 COMPUTE PV-SLS-AMT = PV-SLS-AMT                  06340061
054900                                    + PA-ECOMM-FEES               06350061
055000                 END-COMPUTE                                      06360061
055100                 ADD PA-ECOMM-FEES TO PA-TEPTRN-SLS-TOT           06370061
C92405                 COMPUTE PV-TX-AMT = PV-TX-AMT                    06380061
C92405                                     + PA-ECOMM-TX-FEES           06390061
C92405                 END-COMPUTE                                      06400061
C92405                 ADD PA-ECOMM-TX-FEES TO PA-TEPTRN-TAX-TOT        06410061
055200            END-IF                                                06420061
055300            PERFORM 7220-FETCH-SSFEES-CURSOR                      06430061
055400         END-PERFORM                                              06440061
055500         PERFORM 7230-CLOSE-SSFEES-CURSOR                         06450061
055600         IF PV-SLS-AMT = PA-TRN-SLS-AMT AND                       06460061
C92405            PV-TX-AMT  = PA-TRN-TAX-AMT                           06470061
055800             IF PS-NEGATIVE-YES                                   06480061
055900                 PERFORM 2400-TRN-ERROR-PROCESS                   06490061
056000             END-IF                                               06500061
056100         ELSE                                                     06510061
056200             PERFORM 2400-TRN-ERROR-PROCESS                       06520061
056300         END-IF                                                   06530061
056400         PERFORM 2300-SET-UP-NEW-TRANS                            06540061
056500     END-IF.                                                      06550061
056600                                                                  06560061
056700     MOVE TX006-SKU-NBR               TO PV-ITEM.                 06570061
056800                                                                  06580061
056900***** IF THE TRANSACTION IS A VOID TRANSACTION REVERSE THE CREDIT 06590061
057000***** INDICATOR.                                                  06600061
057100                                                                  06610061
057200     IF TX006-VOID-TRANSACTION                                    06620061
057300         IF TX006-CREDIT-YES                                      06630061
057400             SET TX006-CREDIT-NO  TO TRUE                         06640061
057500         ELSE                                                     06650061
057600             SET TX006-CREDIT-YES TO TRUE                         06660061
057700         END-IF                                                   06670061
057800     END-IF.                                                      06680061
057900                                                                  06690061
058000***** WHEN THE TRANSACTION IS A TAX REFUND TO A FORIEGN CUSTOMER  06700061
058100***** THE TAX AMOUNT IS TOTALED IN THE SALES AMOUNT COLUMN.  THE  06710061
058200***** SLS AMOUNT IS ZERO.                                         06720061
058300                                                                  06730061
058400     IF TX006-CREDIT-NO                                           06740061
058500         IF PV-ITEM = PC-TAX-REFUND-ITEM                          06750061
058600             ADD TX006-TX-AMT             TO PA-TRN-SLS-AMT       06760061
058700                                             PA-TOT-SLS-AMT       06770061
058800         ELSE                                                     06780061
058900             ADD TX006-TX-AMT             TO PA-TRN-TAX-AMT       06790061
059000                                             PA-TOT-TAX-AMT       06800061
059100             ADD TX006-TAXABLE-AMT        TO PA-TRN-SLS-AMT       06810061
059200                                             PA-TOT-SLS-AMT       06820061
059300         END-IF                                                   06830061
059400     ELSE                                                         06840061
059500         IF PV-ITEM = PC-TAX-REFUND-ITEM                          06850061
059600             SUBTRACT TX006-TX-AMT       FROM PA-TRN-SLS-AMT      06860061
059700                                              PA-TOT-SLS-AMT      06870061
059800         ELSE                                                     06880061
059900             SUBTRACT TX006-TX-AMT       FROM PA-TRN-TAX-AMT      06890061
060000                                              PA-TOT-TAX-AMT      06900061
060100             SUBTRACT TX006-TAXABLE-AMT  FROM PA-TRN-SLS-AMT      06910061
060200                                              PA-TOT-SLS-AMT      06920061
060300         END-IF                                                   06930061
060400     END-IF.                                                      06940061
060500                                                                  06950061
060600**** IF EITHER THE TAXABLE AMOUNT OR TAX AMOUNT IS LESS THAN ZERO,06960061
060700**** SET THE NEGATIVE INDICATOR.                                  06970061
060800                                                                  06980061
060900     IF TX006-TAXABLE-AMT LESS THAN ZERO                          06990061
061000        SET PS-NEGATIVE-YES TO TRUE                               07000061
061100     END-IF.                                                      07010061
061200                                                                  07020061
061300     IF TX006-TX-AMT LESS THAN ZERO                               07030061
061400        SET PS-NEGATIVE-YES TO TRUE                               07040061
061500     END-IF.                                                      07050061
061600                                                                  07060061
061700                                                                  07070061
061800******************************************************************07080061
061900*  READ A RECORD FROM THE TAX REPORTING TRANSACTION TABLE.       *07090061
062000******************************************************************07100061
062100 2100-READ-TAX-EXTRACT-FILE.                                      07110061
062200                                                                  07120061
062300     READ TAX-EXTRACT-FILE                                        07130061
062400         INTO TX006-TAX-AUDIT-RECORD                              07140061
062500         AT END                                                   07150061
062600             SET PS-END-OF-TAX-EXTRACT-FILE TO TRUE               07160061
062700     END-READ.                                                    07170061
062800                                                                  07180061
062900     IF PS-NOT-END-OF-TAX-EXTRACT-FILE                            07190061
063000        ADD 1 TO PA-TAXRPT-TRN-CNTR                               07200061
063100     END-IF.                                                      07210061
063200                                                                  07220061
063300******************************************************************07230061
063400*  SELECT THE TOTAL AMOUNT FOR THE TRANSACTION FROM THE TEPTRN   *07240061
063500*  TABLE.                                                        *07250061
063600******************************************************************07260061
063700 2200-GET-TRAN-TAX-TOTAL.                                         07270061
063800                                                                  07280061
063900     MOVE PV-STR-NBR TO  EPTRN-STR-NBR.                           07290061
STCFEE     MOVE ZEROES     TO  PV-SLS-AMT                               07300092
STCFEE                         PV-TX-AMT                                07310094
STCFEE                         PV-TX-WORK-AMT.                          07320097
STCFEE                                                                  07330092
STCFEE     SET PS-NOT-END-OF-TRAN-TOT-CURSOR TO TRUE                    07340092
STCFEE     PERFORM 2250-OPEN-TRAN-TOT-CURSOR                            07350092
STCFEE     PERFORM 2260-FETCH-TRAN-TOT-CURSOR                           07360092
STCFEE     PERFORM UNTIL PS-END-OF-TRAN-TOT-CURSOR                      07370092
STCFEE         IF (EPITM-SBJCT-TO-TX-AMT = ZERO                         07380099
STCFEE         OR  EPTRN-TRN-STAT-CDE    = 'R')                         07390099
STCFEE             IF (EPITM-TX-AMT  NOT = ZERO)                        07400092
STCFEE             OR (PV-TAX-EXMPT-ID NOT = SPACES)                    07410092
STCFEE             OR (EPITM-SKU-NBR       = PV-TAX-REFUND-SKU)         07420094
STCFEE                 ADD  EPITM-NET-CHRGD-AMT    TO PV-SLS-AMT        07430098
STCFEE                                                PA-TEPTRN-SLS-TOT 07440098
STCFEE                 PERFORM 2210-ADD-FEES-TO-TOTALS                  07450093
STCFEE             END-IF                                               07460092
STCFEE         ELSE                                                     07470092
STCFEE             ADD  EPITM-SBJCT-TO-TX-AMT  TO PV-SLS-AMT            07480099
STCFEE                                            PA-TEPTRN-SLS-TOT     07490099
STCFEE         END-IF                                                   07500092
REVFIX         IF EPTRN-TRN-STAT-CDE = 'R'                              07510098
REVFIX             COMPUTE EPITM-TX-AMT = EPITM-TX-AMT * -1             07520098
REVFIX         END-IF                                                   07530098
STCFEE         ADD  EPITM-TX-AMT    TO PV-TX-AMT                        07540098
STCFEE                                 PA-TEPTRN-TAX-TOT                07550098
STCFEE                                                                  07560094
STCFEE         PERFORM 2260-FETCH-TRAN-TOT-CURSOR                       07570092
STCFEE     END-PERFORM.                                                 07580092
STCFEE     PERFORM 2270-CLOSE-TRAN-TOT-CURSOR.                          07590092
068200                                                                  07600083
C92405* GET THE SHIPPING AMOUNT AND TX AMT FROM TEPSHP FOR ALL KOHLS    07610083
C92405* ITEMS SOLD. NEED TEPIPS TO KNOW WHICH LINE ITEM IS THE KOHLS    07620061
C92405* SHIPPING CHARGE AND SHIPPING TAX.                               07630061
068200                                                                  07640061
068300     EXEC SQL                                                     07650061
#CHG00       SELECT SUM(SHP.SHIP_CHRG_AMT)                              07660061
#CHG00            , SUM(SHP.TX_AMT)                                     07670061
#CHG00        INTO :PA-ECOMM-SHIP-WRAP                                  07680061
#CHG00           , :PA-ECOMM-TX-AMT                                     07690061
#CHG00       FROM TEPSHP SHP                                            07700061
#CHG00      WHERE SHP.PARTN_NBR         =:PV-PARTITION                  07710061
#CHG00        AND SHP.STR_NBR           =:EPTRN-STR-NBR                 07720061
#CHG00        AND SHP.RGST_ID           =:PV-RGST-ID                    07730061
#CHG00        AND SHP.TRN_NBR           =:PV-TRN-NBR                    07740061
#CHG00        AND SHP.STRT_TM           =:PV-STRT-TM                    07750061
#CHG00        AND SHP.SLS_CORR_SEQ_NBR  =:PV-SLS-CORR-SEQ-NBR           07760061
#CHG00        AND SHP.SHIP_CHRG_AMT   ^= 0                              07770061
#CHG00        AND PLND_SHIPT_NBR NOT IN                                 07780061
#CHG00           ( SELECT 1 FROM TEPIPS IPS,                            07790061
#CHG00                           TEPITM ITM                             07800061
#CHG00            WHERE IPS.PARTN_NBR       =:PV-PARTITION              07810061
#CHG00             AND IPS.STR_NBR          =:EPTRN-STR-NBR             07820061
#CHG00             AND IPS.RGST_ID          =:PV-RGST-ID                07830061
#CHG00             AND IPS.TRN_NBR          =:PV-TRN-NBR                07840061
#CHG00             AND IPS.STRT_TM          =:PV-STRT-TM                07850061
#CHG00             AND IPS.SLS_CORR_SEQ_NBR =:PV-SLS-CORR-SEQ-NBR       07860061
#CHG00             AND IPS.PARTN_NBR      = ITM.PARTN_NBR               07870061
#CHG00             AND IPS.STR_NBR        = ITM.STR_NBR                 07880061
#CHG00             AND IPS.RGST_ID        = ITM.RGST_ID                 07890061
#CHG00             AND IPS.TRN_NBR        = ITM.TRN_NBR                 07900061
#CHG00             AND IPS.STRT_TM        = ITM.STRT_TM                 07910061
#CHG00             AND IPS.SLS_CORR_SEQ_NBR = ITM.SLS_CORR_SEQ_NBR      07920061
#CHG00             AND IPS.LNE_ITM_SEQ_NBR = ITM.LNE_ITM_SEQ_NBR        07930061
#CHG00             AND  (DEPT_NBR = '070' AND                           07940061
#CHG00                   SUB_CL_NBR = '91'))                            07950061
069300        WITH UR                                                   07960061
069400     END-EXEC.                                                    07970061
069500                                                                  07980061
069600     EVALUATE SQLCODE                                             07990061
069700         WHEN ZERO                                                08000061
069800             COMPUTE PV-SLS-AMT = PV-SLS-AMT                      08010098
069900                                + PA-ECOMM-SHIP-WRAP              08020098
070000             END-COMPUTE                                          08030098
C92405             ADD PA-ECOMM-SHIP-WRAP TO PA-TEPTRN-SLS-TOT          08040098
C92405             COMPUTE PV-TX-AMT = PV-TX-AMT                        08050098
C92405                               + PA-ECOMM-TX-AMT                  08060098
C92405             END-COMPUTE                                          08070098
C92405             ADD PA-ECOMM-TX-AMT   TO PA-TEPTRN-TAX-TOT           08080098
070200         WHEN +100                                                08090061
070300         WHEN -305                                                08100061
070400             CONTINUE                                             08110061
070500         WHEN OTHER                                               08120061
070600             MOVE '2200-GET-TRAN-TAX-TOTAL' TO PV-PARAGRAPH-NAME  08130061
070700             MOVE 'ERROR SELECT FROM TEPSHP TABLE'                08140061
070800                                            TO PV-DB2-OPERATION   08150061
070900             PERFORM 9200-SQL-ABEND                               08160061
071000     END-EVALUATE.                                                08170061
071100                                                                  08180061
063200                                                                  08190075
STCFEE******************************************************************08200075
STCFEE*  SELECT THE TOTAL FEE AMOUNT FOR THE TRANSACTION FROM THE      *08210075
STCFEE*  TEPLIS TABLE.  JOIN TO TEPITM TO MAKE SURE THAT VOIDED ITEMS  *08220075
STCFEE*  ARE NOT INCLUDED.  FEE TAXES ARE ALREADY INCLUDED IN THE ITEM *08230075
STCFEE*  TAX AMOUNTS, SO THEY DO NOT NEED TO BE CAPTURED HERE.         *08240075
STCFEE******************************************************************08250075
STCFEE 2210-ADD-FEES-TO-TOTALS.                                         08260075
STCFEE                                                                  08270075
STCFEE     EXEC SQL                                                     08280075
STCFEE           SELECT SUM(SRVC_AMT)                                   08290075
STCFEE             INTO :EPLIS-SRVC-AMT                                 08300075
STCFEE             FROM TEPLIS A                                        08310075
STCFEE                , TEPITM B                                        08320075
STCFEE            WHERE A.PARTN_NBR        = :PV-PARTITION              08330075
STCFEE              AND A.STR_NBR          = :EPTRN-STR-NBR             08340075
STCFEE              AND A.RGST_ID          = :PV-RGST-ID                08350075
STCFEE              AND A.TRN_NBR          = :PV-TRN-NBR                08360075
STCFEE              AND A.STRT_TM          = :PV-STRT-TM                08370075
STCFEE              AND A.SLS_CORR_SEQ_NBR = :PV-SLS-CORR-SEQ-NBR       08380075
STCFEE              AND A.PARTN_NBR        = B.PARTN_NBR                08390075
STCFEE              AND A.STR_NBR          = B.STR_NBR                  08400075
STCFEE              AND A.RGST_ID          = B.RGST_ID                  08410075
STCFEE              AND A.TRN_NBR          = B.TRN_NBR                  08420075
STCFEE              AND A.STRT_TM          = B.STRT_TM                  08430075
STCFEE              AND A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR         08440075
STCFEE              AND A.LNE_ITM_SEQ_NBR  = B.LNE_ITM_SEQ_NBR          08450075
STCFEE              AND A.SRVC_TYP_CDE     = 'F'                        08460075
STCFEE              AND A.FEE_TXBL_IND     = 'Y'                        08470099
STCFEE              AND B.LIV_RSLU_CDE    IN ('+', '-')                 08480075
020619              AND B.LNE_ITM_SEQ_NBR = :PV-LNE-ITM-SEQ-NBR         08481099
STCFEE              WITH UR                                             08490075
STCFEE     END-EXEC.                                                    08500075
STCFEE                                                                  08510075
STCFEE     EVALUATE SQLCODE                                             08520075
STCFEE         WHEN ZERO                                                08530075
STCFEE             ADD EPLIS-SRVC-AMT  TO PV-SLS-AMT                    08540098
STCFEE                                    PA-TEPTRN-SLS-TOT             08550098
STCFEE         WHEN +100                                                08560075
STCFEE         WHEN -305                                                08570075
STCFEE             CONTINUE                                             08580075
STCFEE         WHEN OTHER                                               08590075
STCFEE             MOVE '2210-ADD-FEES-TO-TOTALS' TO PV-PARAGRAPH-NAME  08600075
STCFEE             MOVE 'ERROR SELECT FROM TEPLIS TABLE'                08610075
STCFEE                                            TO PV-DB2-OPERATION   08620075
STCFEE             PERFORM 9200-SQL-ABEND                               08630075
STCFEE     END-EVALUATE.                                                08640075
STCFEE                                                                  08650092
STCFEE                                                                  08660092
STCFEE******************************************************************08670092
STCFEE* OPEN THE TRANSACTION TOTALS CURSOR.                            *08680092
STCFEE******************************************************************08690092
STCFEE 2250-OPEN-TRAN-TOT-CURSOR.                                       08700092
STCFEE                                                                  08710092
STCFEE     EXEC SQL                                                     08720092
STCFEE         OPEN TRAN-TOT-CSR                                        08730092
STCFEE     END-EXEC.                                                    08740092
STCFEE                                                                  08750092
STCFEE     EVALUATE SQLCODE                                             08760092
STCFEE         WHEN ZERO                                                08770092
STCFEE             CONTINUE                                             08780092
STCFEE         WHEN OTHER                                               08790092
STCFEE             MOVE '2250-OPEN-TRAN-TOT-CURSOR'                     08800092
STCFEE                                            TO PV-PARAGRAPH-NAME  08810092
STCFEE             MOVE 'ERROR ON OPENING TRAN-TOT CURSOR '             08820092
STCFEE                                            TO PV-DB2-OPERATION   08830092
STCFEE             PERFORM 9200-SQL-ABEND                               08840092
STCFEE     END-EVALUATE.                                                08850092
STCFEE                                                                  08860092
STCFEE***************************************************************** 08870092
STCFEE*  FETCH THE TRANSACTION TOTALS                                   08880092
STCFEE***************************************************************** 08890092
STCFEE 2260-FETCH-TRAN-TOT-CURSOR.                                      08900092
STCFEE                                                                  08910092
STCFEE     EXEC SQL                                                     08920092
STCFEE         FETCH TRAN-TOT-CSR                                       08930092
STCFEE           INTO :EPTRN-TRN-STAT-CDE                               08940092
STCFEE               ,:EPITM-TX-AMT                                     08950092
STCFEE               ,:EPITM-NET-CHRGD-AMT                              08960092
STCFEE               ,:EPITM-SBJCT-TO-TX-AMT                            08970092
STCFEE               ,:EPITM-SKU-NBR                                    08980094
020619               ,:PV-LNE-ITM-SEQ-NBR                               08981099
STCFEE     END-EXEC.                                                    08990092
STCFEE                                                                  09000092
STCFEE     EVALUATE SQLCODE                                             09010092
STCFEE         WHEN ZERO                                                09020092
STCFEE             CONTINUE                                             09030092
STCFEE         WHEN +100                                                09040092
STCFEE             SET PS-END-OF-TRAN-TOT-CURSOR  TO TRUE               09050092
STCFEE         WHEN OTHER                                               09060092
STCFEE             MOVE '2260-FETCH-TRAN-TOT-CURSOR'                    09070092
STCFEE                                             TO PV-PARAGRAPH-NAME 09080092
STCFEE             MOVE 'ERROR ON FETCHING TRAN-TOT CURSOR '            09090092
STCFEE                                             TO PV-DB2-OPERATION  09100092
STCFEE             PERFORM 9200-SQL-ABEND                               09110092
STCFEE     END-EVALUATE.                                                09120092
STCFEE                                                                  09130092
STCFEE***************************************************************** 09140092
STCFEE*  CLOSE THE TRANSACTION TOTALS CURSOR                            09150092
STCFEE***************************************************************** 09160092
STCFEE 2270-CLOSE-TRAN-TOT-CURSOR.                                      09170092
STCFEE                                                                  09180092
STCFEE     EXEC SQL                                                     09190092
STCFEE         CLOSE TRAN-TOT-CSR                                       09200092
STCFEE     END-EXEC.                                                    09210092
STCFEE                                                                  09220092
STCFEE     EVALUATE SQLCODE                                             09230092
STCFEE         WHEN ZERO                                                09240092
STCFEE             CONTINUE                                             09250092
STCFEE         WHEN OTHER                                               09260092
STCFEE             MOVE '2270-CLOSE-TRAN-TOT-CURSOR'                    09270092
STCFEE                                             TO PV-PARAGRAPH-NAME 09280092
STCFEE             MOVE 'ERROR ON CLOSING TRAN-TOT CURSOR '             09290092
STCFEE                                             TO PV-DB2-OPERATION  09300092
STCFEE             PERFORM 9200-SQL-ABEND                               09310092
STCFEE     END-EVALUATE.                                                09320092
STCFEE                                                                  09330092
STCFEE                                                                  09340092
071200******************************************************************09350061
071300*  MOVE TRANSACTION INFORMATION FROM THE TAX REPORTING RECORD TO *09360061
071400*  THE TRANSACTION SAVE AREA.                                    *09370061
071500******************************************************************09380061
071600 2300-SET-UP-NEW-TRANS.                                           09390061
071700                                                                  09400061
071800     SET PS-NEGATIVE-NO TO TRUE.                                  09410061
071900                                                                  09420061
072000     MOVE ZERO TO PA-TRN-SLS-AMT                                  09430061
072100                  PA-TRN-TAX-AMT                                  09440061
072200                  PA-ECOMM-FEES                                   09450061
072300                  PA-ECOMM-SHIP-WRAP.                             09460061
072400     MOVE TX006-STR-NBR          TO PV-STR-NBR                    09470061
072500     MOVE TX006-PARTITION        TO PV-PARTITION                  09480061
072600     MOVE TX006-RGST-ID          TO PV-RGST-ID                    09490061
072700     MOVE TX006-TRN-NBR          TO PV-TRN-NBR                    09500061
072800     MOVE TX006-START-TIME       TO PV-STRT-TM                    09510061
072900     MOVE TX006-SLS-CORR-SEQ-NBR TO PV-SLS-CORR-SEQ-NBR.          09520061
073000     MOVE TX006-PROCESS-DTE      TO PV-SLS-DTE.                   09530061
073100     MOVE TX006-TRN-TYP-CDE      TO PV-TRN-TYP-CDE.               09540061
STCFEE     MOVE TX006-TAX-EXMPT-ID     TO PV-TAX-EXMPT-ID.              09550092
073200                                                                  09560061
073300******************************************************************09570061
073400* IF THE TRANSACTION IS OUT OF BALANCE, CHECK IF ASSOCIATE       *09580061
073500* DISCOUNT IS IN EFFECT.                                         *09590061
073600* CALCULATE THE VARIANCE BETWEEN TEPTRN AND THE TAX REPORTING    *09600061
073700* TRANSACTION.   ADD THE AMOUNTS TO THE OUT OF BALANCE TOTALS.   *09610061
073800******************************************************************09620061
073900 2400-TRN-ERROR-PROCESS.                                          09630061
074000                                                                  09640061
074100     COMPUTE PV-SLS-AMT-VAR = PV-SLS-AMT -                        09650061
074200                              PA-TRN-SLS-AMT                      09660061
074300     END-COMPUTE.                                                 09670061
074400                                                                  09680061
C92405     COMPUTE PV-TAX-AMT-VAR = PV-TX-AMT -                         09690061
074600                              PA-TRN-TAX-AMT                      09700067
074700     END-COMPUTE.                                                 09710067
074800                                                                  09720061
074900     ADD PV-SLS-AMT       TO PA-TEPTRN-SLS-ERR.                   09730061
C92405     ADD PV-TX-AMT        TO PA-TEPTRN-TAX-ERR.                   09740061
075100     ADD PA-TRN-SLS-AMT   TO PA-TOT-SLS-ERR.                      09750061
075200     ADD PA-TRN-TAX-AMT   TO PA-TOT-TAX-ERR.                      09760061
075300                                                                  09770061
075400     PERFORM 2600-WRITE-TRN-ERROR.                                09780061
075500     PERFORM 2800-WRITE-OUT-OF-BAL-RECORD.                        09790061
075600                                                                  09800061
075700******************************************************************09810061
075800* WRITE A LINE TO THE BALANCE REPORT FOR THE TRANSACTION.        *09820061
075900******************************************************************09830061
076000 2600-WRITE-TRN-ERROR.                                            09840061
076100                                                                  09850061
076200     IF PV-STR-NBR NOT EQUAL PV-RPT-STR-NBR                       09860061
076300         IF PA-LINE-CNTR > PC-MAX-LINES                           09870061
076400             PERFORM 2700-WRITE-PAGE-HEADINGS                     09880061
076500         ELSE                                                     09890061
076600             MOVE SPACES TO TAX-BALANCE-LINE                      09900061
076700             WRITE TAX-BALANCE-LINE                               09910061
076800                 AFTER ADVANCING 1 LINE                           09920061
076900             END-WRITE                                            09930061
077000             ADD +1              TO PA-LINE-CNTR                  09940061
077100         END-IF                                                   09950061
077200     END-IF.                                                      09960061
077300                                                                  09970061
077400     IF PA-LINE-CNTR > PC-MAX-LINES                               09980061
077500         PERFORM 2700-WRITE-PAGE-HEADINGS                         09990061
077600     END-IF.                                                      10000061
077700                                                                  10010061
077800     ADD +1                   TO PA-LINE-CNTR                     10020061
077900                                 PA-ERROR-CNTR.                   10030061
078000     MOVE SPACES              TO RD1-DETAIL-LINE.                 10040061
078100     MOVE PV-STR-NBR          TO RD1-STR-NBR                      10050061
078200                                 PV-RPT-STR-NBR.                  10060061
078300     MOVE PV-RGST-ID          TO RD1-RGST-ID                      10070061
078400     MOVE PV-TRN-NBR          TO RD1-TRN-NBR                      10080061
078500     MOVE PV-STRT-TM          TO RD1-STRT-TM                      10090061
078600     MOVE PV-SLS-CORR-SEQ-NBR TO RD1-SLS-CORR-SEQ-NBR.            10100061
078700     MOVE PA-TRN-SLS-AMT      TO RD1-TAXRPT-SLS-AMT.              10110061
078800     MOVE PA-TRN-TAX-AMT      TO RD1-TAXRPT-TAX-AMT.              10120061
078900     MOVE PV-SLS-AMT          TO RD1-TEPTRN-SLS-AMT.              10130061
C92405     MOVE PV-TX-AMT           TO RD1-TEPTRN-TAX-AMT.              10140061
079100     MOVE PV-SLS-AMT-VAR      TO RD1-SLS-AMT-VAR.                 10150061
079200     MOVE PV-TAX-AMT-VAR      TO RD1-TAX-AMT-VAR.                 10160061
079300     MOVE '/'                 TO RD1-SLS-DTE (3:1)                10170061
079400                                 RD1-SLS-DTE (6:1).               10180061
079500     MOVE PV-SLS-DTE(3:2)     TO RD1-SLS-DTE (7:2).               10190061
079600     MOVE PV-SLS-DTE(6:2)     TO RD1-SLS-DTE (1:2).               10200061
079700     MOVE PV-SLS-DTE(9:2)     TO RD1-SLS-DTE (4:2).               10210061
079800                                                                  10220061
079900     IF PS-NEGATIVE-YES                                           10230061
080000         MOVE 'N'             TO RD1-COSA-BAL-IND                 10240061
080100     END-IF.                                                      10250061
080200                                                                  10260061
080300     WRITE TAX-BALANCE-LINE FROM RD1-DETAIL-LINE                  10270061
080400         AFTER ADVANCING 1 LINE                                   10280061
080500     END-WRITE.                                                   10290061
080600                                                                  10300061
080700******************************************************************10310061
080800* WRITE PAGE HEADINGS.                                           *10320061
080900******************************************************************10330061
081000 2700-WRITE-PAGE-HEADINGS.                                        10340061
081100                                                                  10350061
081200     ADD  +1 TO PA-PAGE-CNTR.                                     10360061
081300     MOVE +6 TO PA-LINE-CNTR.                                     10370061
081400                                                                  10380061
081500     MOVE PA-PAGE-CNTR TO DP132O-PAGE-NUMBER.                     10390061
081600                                                                  10400061
081700     WRITE TAX-BALANCE-LINE                                       10410061
081800         FROM DP132O-STANDRD-HEADER-132-COLS                      10420061
081900         AFTER ADVANCING PAGE                                     10430061
082000     END-WRITE.                                                   10440061
082100                                                                  10450061
082200     WRITE TAX-BALANCE-LINE                                       10460061
082300         FROM RH1-HEAD1                                           10470061
082400         AFTER ADVANCING 1 LINE                                   10480061
082500     END-WRITE.                                                   10490061
082600                                                                  10500061
082700     WRITE TAX-BALANCE-LINE                                       10510061
082800         FROM RH1-HEAD2                                           10520061
082900         AFTER ADVANCING 2 LINES                                  10530061
083000     END-WRITE.                                                   10540061
083100                                                                  10550061
083200     WRITE TAX-BALANCE-LINE                                       10560061
083300         FROM RH1-HEAD3                                           10570061
083400         AFTER ADVANCING 1 LINE                                   10580061
083500     END-WRITE.                                                   10590061
083600                                                                  10600061
083700     MOVE SPACES TO TAX-BALANCE-LINE.                             10610061
083800                                                                  10620061
083900     WRITE TAX-BALANCE-LINE                                       10630061
084000         AFTER ADVANCING 1 LINE                                   10640061
084100     END-WRITE.                                                   10650061
084200                                                                  10660061
084300******************************************************************10670061
084400* WRITE A RECORD TO THE OUT OF BALANCE FILE.                     *10680061
084500******************************************************************10690061
084600 2800-WRITE-OUT-OF-BAL-RECORD.                                    10700061
084700                                                                  10710061
084800     MOVE PV-STR-NBR          TO TX031-STR-NBR                    10720061
084900     MOVE PV-RGST-ID          TO TX031-RGST-ID                    10730061
085000     MOVE PV-TRN-NBR          TO TX031-TRN-NBR                    10740061
085100     MOVE PV-STRT-TM          TO TX031-STRT-TM                    10750061
085200     MOVE PV-SLS-CORR-SEQ-NBR TO TX031-SLS-CORR-SEQ-NBR.          10760061
085300     MOVE PA-TRN-SLS-AMT      TO TX031-TAXRPT-SLS-AMT.            10770061
085400     MOVE PA-TRN-TAX-AMT      TO TX031-TAXRPT-TAX-AMT.            10780061
085500     MOVE PV-SLS-AMT          TO TX031-TEPTRN-SLS-AMT.            10790061
C92405     MOVE PV-TX-AMT           TO TX031-TEPTRN-TAX-AMT.            10800061
085700     MOVE '/'                 TO TX031-SLS-DTE (3:1)              10810061
085800                                 TX031-SLS-DTE (6:1).             10820061
085900     MOVE PV-SLS-DTE(3:2)     TO TX031-SLS-DTE (7:2).             10830061
086000     MOVE PV-SLS-DTE(6:2)     TO TX031-SLS-DTE (1:2).             10840061
086100     MOVE PV-SLS-DTE(9:2)     TO TX031-SLS-DTE (4:2).             10850061
086200                                                                  10860061
086300     WRITE TAX-OUT-OF-BAL-RECORD FROM                             10870061
086400           TX031-OUT-OF-BAL-RECORD                                10880061
086500     END-WRITE.                                                   10890061
086600                                                                  10900061
086700******************************************************************10910061
086800* OPEN THE SPECIAL SERVICES CURSOR.                              *10920061
086900******************************************************************10930061
087000 7210-OPEN-SSFEES-CURSOR.                                         10940061
087100                                                                  10950061
087200     EXEC SQL                                                     10960061
087300         OPEN SSFEES-CSR                                          10970061
087400     END-EXEC.                                                    10980061
087500                                                                  10990061
087600     EVALUATE SQLCODE                                             11000061
087700         WHEN ZERO                                                11010061
087800             CONTINUE                                             11020061
087900         WHEN OTHER                                               11030061
088000             MOVE '7210-OPEN-SSFEES-CURSOR' TO PV-PARAGRAPH-NAME  11040061
088100             MOVE 'ERROR ON OPENING SSFEES CURSOR '               11050061
088200                                            TO PV-DB2-OPERATION   11060061
088300             PERFORM 9200-SQL-ABEND                               11070061
088400     END-EVALUATE.                                                11080061
088500                                                                  11090061
088600***************************************************************** 11100061
088700*  FETCH THE SPECIAL SERVICE FEE INFORMATION                      11110061
088800***************************************************************** 11120061
088900 7220-FETCH-SSFEES-CURSOR.                                        11130061
089000                                                                  11140061
089100     EXEC SQL                                                     11150061
089200         FETCH SSFEES-CSR                                         11160061
089300           INTO :EPLIS-SRVC-TYP-CDE                               11170061
089400               ,:PA-ECOMM-FEES                                    11180061
C92405               ,:PA-ECOMM-TX-FEES                                 11190061
089500     END-EXEC.                                                    11200061
089600                                                                  11210061
089700     EVALUATE SQLCODE                                             11220061
089800         WHEN ZERO                                                11230061
089900             CONTINUE                                             11240061
090000         WHEN +100                                                11250061
090100             SET PS-END-OF-SSFEES-CURSOR  TO TRUE                 11260061
090200         WHEN OTHER                                               11270061
090300             MOVE '7220-FETCH-SSFEES-CURSOR' TO PV-PARAGRAPH-NAME 11280061
090400             MOVE 'ERROR ON FETCHING SSFEES CURSOR '              11290061
090500                                             TO PV-DB2-OPERATION  11300061
090600             PERFORM 9200-SQL-ABEND                               11310061
090700     END-EVALUATE.                                                11320061
090800                                                                  11330061
090900***************************************************************** 11340061
091000*  CLOSE THE SPECIAL SERVICES FEES CURSOR                         11350061
091100***************************************************************** 11360061
091200 7230-CLOSE-SSFEES-CURSOR.                                        11370061
091300                                                                  11380061
091400     EXEC SQL                                                     11390061
091500         CLOSE SSFEES-CSR                                         11400061
091600     END-EXEC.                                                    11410061
091700                                                                  11420061
091800     EVALUATE SQLCODE                                             11430061
091900         WHEN ZERO                                                11440061
092000             CONTINUE                                             11450061
092100         WHEN OTHER                                               11460061
092200             MOVE '7230-CLOSE-SSFEES-CURSOR' TO PV-PARAGRAPH-NAME 11470061
092300             MOVE 'ERROR ON CLOSING SSFEES CURSOR '               11480061
092400                                             TO PV-DB2-OPERATION  11490061
092500             PERFORM 9200-SQL-ABEND                               11500061
092600     END-EVALUATE.                                                11510061
092700                                                                  11520061
092800******************************************************************11530061
092900*  WRITE THE REPORT TOTAL LINES AND CLOSE ALL FILES.             *11540061
093000******************************************************************11550061
093100 9000-EOJ-ROUTINE.                                                11560061
093200                                                                  11570061
093300     IF PA-ERROR-CNTR > 0                                         11580061
093400         PERFORM 9010-WRITE-ERROR-TOT-LINE                        11590061
093600     END-IF.                                                      11600061
093700                                                                  11610061
093800     PERFORM 9020-WRITE-CORP-TOT-LINE.                            11620061
093900                                                                  11630061
094000     IF PA-LINE-CNTR > PC-MAX-LINES - 1                           11640061
094100        PERFORM 2700-WRITE-PAGE-HEADINGS                          11650061
094200     END-IF.                                                      11660061
094300                                                                  11670061
094400     WRITE TAX-BALANCE-LINE                                       11680061
094500         FROM RF1-FOOT2                                           11690061
094600         AFTER ADVANCING 2 LINES                                  11700061
094700     END-WRITE.                                                   11710061
094800                                                                  11720061
094900     CLOSE TAX-EXTRACT-FILE                                       11730061
095000           TAX-OUT-OF-BAL-FILE                                    11740061
095100           TAX-BALANCE-REPORT.                                    11750061
095200                                                                  11760061
095300                                                                  11770061
095400 9010-WRITE-ERROR-TOT-LINE.                                       11780061
095500                                                                  11790061
095600     COMPUTE PV-SLS-AMT-VAR = PA-TOT-SLS-ERR    -                 11800061
095700                              PA-TEPTRN-SLS-ERR                   11810061
095800     END-COMPUTE.                                                 11820061
095900                                                                  11830061
096000     COMPUTE PV-TAX-AMT-VAR = PA-TOT-TAX-ERR    -                 11840061
096100                              PA-TEPTRN-TAX-ERR                   11850061
096200     END-COMPUTE.                                                 11860061
THRCHG     IF (PV-TAX-AMT-VAR  > PC-VARAINCE-THRESHOLD OR               11870071
THRCHG         PV-TAX-AMT-VAR  < PC-VARAINCE-THRESHOLD * -1)            11880071
THRCHG         MOVE 4054 TO RETURN-CODE                                 11890071
THRCHG     ELSE                                                         11900071
THRCHG         MOVE 4051 TO RETURN-CODE                                 11910071
THRCHG     END-IF.                                                      11920071
096400     MOVE PC-REPORT-TOTAL-OB-DESC TO RF1-TOTAL-DESC.              11930061
096500     MOVE PA-TEPTRN-SLS-ERR       TO RF1-TEPTRN-SLS-AMT.          11940061
096600     MOVE PA-TEPTRN-TAX-ERR       TO RF1-TEPTRN-TAX-AMT.          11950061
096700     MOVE PA-TOT-SLS-ERR          TO RF1-TAXRPT-SLS-AMT.          11960061
096800     MOVE PA-TOT-TAX-ERR          TO RF1-TAXRPT-TAX-AMT.          11970061
096900     MOVE PV-SLS-AMT-VAR          TO RF1-SLS-AMT-VAR.             11980061
097000     MOVE PV-TAX-AMT-VAR          TO RF1-TAX-AMT-VAR.             11990072
097100                                                                  12000061
097200     IF PA-LINE-CNTR > PC-MAX-LINES - 1                           12010061
097300        PERFORM 2700-WRITE-PAGE-HEADINGS                          12020061
097400     END-IF.                                                      12030061
097500                                                                  12040061
097600     WRITE TAX-BALANCE-LINE                                       12050061
097700         FROM RF1-FOOT1                                           12060061
097800         AFTER ADVANCING 2 LINES                                  12070061
097900     END-WRITE.                                                   12080061
098000                                                                  12090061
098100     ADD +2 TO PA-LINE-CNTR.                                      12100061
098200                                                                  12110061
098300 9020-WRITE-CORP-TOT-LINE.                                        12120061
098400                                                                  12130061
098500     COMPUTE PV-SLS-AMT-VAR = PA-TOT-SLS-AMT    -                 12140061
098600                              PA-TEPTRN-SLS-TOT                   12150061
098700     END-COMPUTE.                                                 12160061
098800                                                                  12170061
098900     COMPUTE PV-TAX-AMT-VAR = PA-TOT-TAX-AMT    -                 12180061
099000                              PA-TEPTRN-TAX-TOT                   12190061
099100     END-COMPUTE.                                                 12200061
099200                                                                  12210061
099300     MOVE PC-REPORT-TOTAL-DESC    TO RF1-TOTAL-DESC.              12220061
099400     MOVE PA-TEPTRN-SLS-TOT       TO RF1-TEPTRN-SLS-AMT.          12230061
099500     MOVE PA-TEPTRN-TAX-TOT       TO RF1-TEPTRN-TAX-AMT.          12240061
099600     MOVE PA-TOT-SLS-AMT          TO RF1-TAXRPT-SLS-AMT.          12250061
099700     MOVE PA-TOT-TAX-AMT          TO RF1-TAXRPT-TAX-AMT.          12260061
099800     MOVE PV-SLS-AMT-VAR          TO RF1-SLS-AMT-VAR.             12270061
099900     MOVE PV-TAX-AMT-VAR          TO RF1-TAX-AMT-VAR.             12280061
100000                                                                  12290061
100100     IF PV-RPT-STR-NBR = ZERO OR PA-LINE-CNTR > PC-MAX-LINES - 1  12300061
100200        PERFORM 2700-WRITE-PAGE-HEADINGS                          12310061
100300     END-IF.                                                      12320061
100400                                                                  12330061
100500     WRITE TAX-BALANCE-LINE                                       12340061
100600         FROM RF1-FOOT1                                           12350061
100700         AFTER ADVANCING 2 LINES                                  12360061
100800     END-WRITE.                                                   12370061
100900                                                                  12380061
101000     ADD +2 TO PA-LINE-CNTR.                                      12390061
101100                                                                  12400061
101200                                                                  12410061
101300******************************************************************12420061
101400* 9200-SQL-ABEND                                                  12430061
101500*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.12440061
101600******************************************************************12450061
101700 9200-SQL-ABEND.                                                  12460061
101800                                                                  12470061
101900     DISPLAY '** ABEND        **'.                                12480061
102000     DISPLAY '** PROGRAM      ** = ' PC-CURRENT-PROGRAM-NAME.     12490061
102100     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH-NAME.           12500061
102200     DISPLAY '** OPERATION    ** = ' PV-DB2-OPERATION.            12510061
102300                                                                  12520061
102400******************************************************************12530061
102500* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     12540061
102600* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      12550061
102700******************************************************************12560061
102800     COPY DPPD004.                                                12570061
102900                                                                  12580061
103000     SET AC-DB2-ERROR TO TRUE.                                    12590061
103100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12600061
103200                                                                  12610061
