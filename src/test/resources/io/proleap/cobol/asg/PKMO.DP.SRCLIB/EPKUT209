000100*----------------------------------------------------------------*00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*----------------------------------------------------------------*00030099
000400 PROGRAM-ID.    EPKUT209.                                         00040099
000500 AUTHOR.        CHUCK HERO.                                       00050099
000600 DATE-WRITTEN.  31 JANUARY 2008.                                  00060099
000700 DATE-COMPILED.                                                   00070099
000800                                                                  00080099
000900*----------------------------------------------------------------*00090099
001000*     **   FILTER OFFERS FULL FILE REFRESH EXTRACT FILE   **     *00100099
001100*                **   NEXT GENERATION STORE   **                 *00110099
001200*----------------------------------------------------------------*00120099
001300*  THIS PROGRAM INPUTS THE FULL REFRESH OFFERS FILE, THE STORE    00130099
001400*  LIST FILE BY OFFER, AND THE EXTRACT CONTROL FILE WITH THE GROUP00140099
001500*  TYPE CODES AND STORE GROUP IDS FOR THE STORES.  IT EXTRACTS    00150099
001600*  ALL EXCLUDED STORE GROUPS FOR EACH OFFER IN THE INPUT FILES.   00160099
001700*                                                                 00170099
001800*  IF AN INCLUDED OFFER'S EXCLUDED STORE GROUP MATCHES A STORE    00180099
001900*  GROUP IN THE EXTRACT CONTROL FILE, THE OFFER'S STORE LIST      00190099
002000*  ENTRY, AND THE OFFER'S RECORDS, FOR THAT STORE NUMBER ARE      00200099
002100*  DROPPED FROM THE OUTPUT FILES.                                 00210099
002200*                                                                 00220099
002300*  THIS PROGRAM SELECTS THE OFFERS INFORMATION FROM THE OFFERS    00230099
002400*  MANAGEMENT DATABASE, WHICH IS IN ORACLE.                       00240099
002500*                                                                 00250099
002600*----------------------------------------------------------------*00260099
002700*  ORACLE TABLES:                         DCLGEN:                *00270099
002800*  --------------                         -------                *00280099
002900*   K_OM01.OMT_OFR_LOC_GP                 OMT00004               *00290099
003000*                                                                *00300099
003100*----------------------------------------------------------------*00310099
003200* HISTORY LOG:                                                    00320099
003300*----------------------------------------------------------------*00330099
003400* DATE:        31 JANUARY 2008                                    00340099
003500* WR/IR#:      WR#33714                                           00350099
003600* PROGRAMMER:  CHUCK HERO                                         00360099
003700* DESCRIPTION: INITIAL PROGRAM CREATION                           00370099
003800*                                                                 00380099
003900* DATE:        01 MAY 2008                                        00390099
004000* WR/IR#:      WR#33714                                           00400099
004100* PROGRAMMER:  MEDHA CHOUDHURY                                    00410099
004200* DESCRIPTION: THE PROGRAM CURRENTLY IS EXCLUDING OFFERS WHEN IT  00420099
004210*              IS SET FOR INCLUSION/EXCLUSIONS AT MULTIPLE STORE  00421099
004220*              GROUP LEVELS. NEED TO IDENTIFY THE FINAL INCLUSION 00422099
004230*              AND OUTPUT OFFERS ACCORDINGLY.                     00423099
004240*                                                                 00424099
004250* WR/IR#:      WR#33714                                           00425099
004260* PROGRAMMER:  MEDHA CHOUDHURY                                    00426099
004270* DESCRIPTION: INCREASED THE TABLE SIZE OF THE STOREGROUP TABLE   00427099
004280*              FROM 1000 TO 5000, TO ALLOW MORE THAN 600 STORES   00428099
004290*              TO RECEIVE FULL FILE IN SINGLE EXECUTION.          00429099
004291*                                                                 00429199
004292*----------------------------------------------------------------*00429299
004293* DATE:        02/26/2009                                         00429399
004294* WR/IR#:      WR34938                                            00429499
004295* PROGRAMMER:  THOMAS HANSON                                      00429599
004296* DESCRIPTION: INCREASED THE MAX SIZE OF THE OFFER LOCATION GROUP 00429699
004297*              TABLE DUE TO AN ABEND DURING SYSTEM TESTING WHERE  00429799
004298*              AN OFFER WAS SET UP AT A METRO LEVEL COMPANY WIDE. 00429899
004299*              CHANGED FROM 50 TO 5000.                           00429999
004300*----------------------------------------------------------------*00430099
004400* DATE:                                                           00440099
004500* WR/IR#:                                                         00450099
004600* PROGRAMMER:                                                     00460099
004700* DESCRIPTION:                                                    00470099
004800*                                                                 00480099
004900*----------------------------------------------------------------*00490099
005000 ENVIRONMENT DIVISION.                                            00500099
005100*----------------------------------------------------------------*00510099
005200 CONFIGURATION SECTION.                                           00520099
005300 SOURCE-COMPUTER. IBM-3090.                                       00530099
005400 OBJECT-COMPUTER. IBM-3090.                                       00540099
005500                                                                  00550099
005600 INPUT-OUTPUT SECTION.                                            00560099
005700                                                                  00570099
005800 FILE-CONTROL.                                                    00580099
005900                                                                  00590099
006000     SELECT REFRESH-STORE-CARD-FILE           ASSIGN TO INP01.    00600099
006100                                                                  00610099
006200     SELECT OFFERS-FULL-REFRESH-IN-FILE       ASSIGN TO INP02.    00620099
006300                                                                  00630099
006400     SELECT ORACLE-LOGIN-FILE                 ASSIGN TO ORALOGON. 00640099
006500                                                                  00650099
006600     SELECT REFRESH-STORE-LIST-IN-FILE        ASSIGN TO INP04.    00660099
006700                                                                  00670099
006800     SELECT OFFERS-FULL-REFRESH-OUT-FILE      ASSIGN TO OUT01.    00680099
006900                                                                  00690099
007000     SELECT REFRESH-STORE-LIST-OUT-FILE       ASSIGN TO OUT02.    00700099
007100                                                                  00710099
007200*----------------------------------------------------------------*00720099
007300 DATA DIVISION.                                                   00730099
007400*----------------------------------------------------------------*00740099
007500 FILE SECTION.                                                    00750099
007600 FD  REFRESH-STORE-CARD-FILE                                      00760099
007700     RECORDING MODE IS F                                          00770099
007800     LABEL RECORDS ARE STANDARD                                   00780099
007900     RECORD CONTAINS 080 CHARACTERS                               00790099
008000     BLOCK CONTAINS 0 RECORDS                                     00800099
008100     DATA RECORD IS REFRESH-STORE-CARD-RECORD.                    00810099
008200                                                                  00820099
008300 01  REFRESH-STORE-CARD-RECORD        PIC X(080).                 00830099
008400                                                                  00840099
008500 FD  OFFERS-FULL-REFRESH-IN-FILE                                  00850099
008600     RECORDING MODE IS F                                          00860099
008700     LABEL RECORDS ARE STANDARD                                   00870099
008800     RECORD CONTAINS 176 CHARACTERS                               00880099
008900     BLOCK CONTAINS 0 RECORDS                                     00890099
009000     DATA RECORD IS OFFERS-FULL-REFRESH-IN-RECORD.                00900099
009100                                                                  00910099
009200 01  OFFERS-FULL-REFRESH-IN-RECORD    PIC X(176).                 00920099
009300                                                                  00930099
009400 FD  ORACLE-LOGIN-FILE                                            00940099
009500     RECORDING MODE IS F                                          00950099
009600     LABEL RECORDS ARE STANDARD                                   00960099
009700     RECORD CONTAINS 080 CHARACTERS                               00970099
009800     BLOCK CONTAINS 0 RECORDS                                     00980099
009900     DATA RECORD IS ORACLE-LOGIN-FILE-RCD.                        00990099
010000                                                                  01000099
010100 01  ORACLE-LOGIN-FILE-RCD            PIC X(080).                 01010099
010200                                                                  01020099
010300 FD  REFRESH-STORE-LIST-IN-FILE                                   01030099
010400     RECORDING MODE IS F                                          01040099
010500     LABEL RECORDS ARE STANDARD                                   01050099
010600     RECORD CONTAINS 050 CHARACTERS                               01060099
010700     BLOCK CONTAINS 0 RECORDS                                     01070099
010800     DATA RECORD IS REFRESH-STORE-LIST-IN-RECORD.                 01080099
010900                                                                  01090099
011000 01  REFRESH-STORE-LIST-IN-RECORD     PIC X(050).                 01100099
011100                                                                  01110099
011200 FD  OFFERS-FULL-REFRESH-OUT-FILE                                 01120099
011300     RECORDING MODE IS F                                          01130099
011400     LABEL RECORDS ARE STANDARD                                   01140099
011500     RECORD CONTAINS 176 CHARACTERS                               01150099
011600     BLOCK CONTAINS 0 RECORDS                                     01160099
011700     DATA RECORD IS OFFERS-FULL-REFRESH-OUT-RECORD.               01170099
011800                                                                  01180099
011900 01  OFFERS-FULL-REFRESH-OUT-RECORD   PIC X(176).                 01190099
012000                                                                  01200099
012100 FD  REFRESH-STORE-LIST-OUT-FILE                                  01210099
012200     RECORDING MODE IS F                                          01220099
012300     LABEL RECORDS ARE STANDARD                                   01230099
012400     RECORD CONTAINS 050 CHARACTERS                               01240099
012500     BLOCK CONTAINS 0 RECORDS                                     01250099
012600     DATA RECORD IS REFRESH-STORE-LIST-OUT-RECORD.                01260099
012700                                                                  01270099
012800 01  REFRESH-STORE-LIST-OUT-RECORD    PIC X(050).                 01280099
012900                                                                  01290099
013000*----------------------------------------------------------------*01300099
013100                                                                  01310099
013200 WORKING-STORAGE SECTION.                                         01320099
013300                                                                  01330099
013400*----------------------------------------------------------------*01340099
013500                                                                  01350099
013600*----------------------------------------------------------------*01360099
013700* PC- PROGRAM CONSTANTS                                          *01370099
013800*----------------------------------------------------------------*01380099
013900 01  PC-PROGRAM-CONSTANTS.                                        01390099
014000     05  FILLER                       PIC  X(27) VALUE            01400099
014100        'WORKING STORAGE STARTS HERE'.                            01410099
014200     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'EPKUT209'.01420099
014300     05  PC-MAX-RETRIES               PIC  9(01) VALUE 5.         01430099
014400     05  PC-FIELD-LENGTH              PIC S9(03) VALUE +10 COMP-3.01440099
014500     05  PC-INDX-LIMIT-5000           PIC S9(04) COMP VALUE +5010.01450099
014510     05  PC-INDX-LIMIT-50             PIC S9(04) COMP VALUE +500. 01451099
014520     05  PC-ROW-NOT-FOUND             PIC  9(04) VALUE 1403.      01452099
014530     05  PC-STORE-GP-5000             PIC  9(05) VALUE 5010.      01453099
014540     05  PC-NO-REFRESH-STRS-FOUND     PIC  X(44) VALUE            01454099
014550                  'NO FULL FILE REFRESH STORES FOUND FOR OFFERS'. 01455099
014560     05  PC-NO-OFFERS-FOUND           PIC  X(44) VALUE            01456099
014570                  'NO OFFERS FOUND FOR FULL FILE REFRESH STORES'. 01457099
014571     05  PC-AUTO-LOGON                PIC X(01)       VALUE '/'.  01457199
014580                                                                  01457299
014590*----------------------------------------------------------------*01457399
014600* PS- PROGRAM SWITCHES                                           *01457499
014700*----------------------------------------------------------------*01457599
014800 01  PS-PROGRAM-SWITCHES.                                         01457699
014900     05  PS-END-OF-STR-GRP-FIL-SW     PIC  X(01) VALUE 'N'.       01457799
015000         88  PS-END-OF-STR-GRP-FILE              VALUE 'Y'.       01457899
015100         88  PS-NOT-END-OF-STR-GRP-FILE          VALUE 'N'.       01457999
015200     05  PS-END-OF-OFFERS-FILE-SW     PIC  X(01) VALUE 'N'.       01458099
015300         88  PS-END-OF-OFFERS-FILE               VALUE 'Y'.       01459099
015400         88  PS-NOT-END-OF-OFFERS-FILE           VALUE 'N'.       01460099
015500     05  PS-END-OF-STR-LIST-FIL-SW    PIC  X(01) VALUE 'N'.       01470099
015600         88  PS-END-OF-STR-LIST-FILE             VALUE 'Y'.       01480099
015700         88  PS-NOT-END-OF-STR-LIST-FILE         VALUE 'N'.       01490099
015800     05  PS-STRS-FOUND-SW             PIC  X(01) VALUE 'N'.       01500099
015900         88  PS-STRS-FOUND                       VALUE 'Y'.       01510099
016000         88  PS-NO-STRS-FOUND                    VALUE 'N'.       01520099
016100     05  PS-OFFERS-FOUND-SW           PIC  X(01) VALUE 'N'.       01530099
016200         88  PS-OFFERS-FOUND                     VALUE 'Y'.       01540099
016300         88  PS-NO-OFFERS-FOUND                  VALUE 'N'.       01550099
016400     05  PS-STR-EXCL-FROM-OFR-SW      PIC  X(01) VALUE 'N'.       01560099
016500         88  PS-STR-EXCL-FROM-OFR                VALUE 'Y'.       01570099
016600         88  PS-STR-NOT-EXCL-FROM-OFR            VALUE 'N'.       01580099
016700     05  PS-STR-IN-EXCL-STR-GP-SW     PIC  X(01) VALUE 'N'.       01590099
016800         88  PS-STR-IN-EXCL-STR-GP               VALUE 'Y'.       01600099
016900         88  PS-STR-NOT-IN-EXCL-STR-GP           VALUE 'N'.       01610099
017000     05  PS-END-OF-FETCH-EXCL-SW      PIC  X(01) VALUE 'N'.       01620099
017100         88  PS-END-OF-FETCH-EXCL                VALUE 'Y'.       01630099
017200         88  PS-NOT-END-OF-FETCH-EXCL            VALUE 'N'.       01640099
017300                                                                  01650099
017400     05  PS-STR-SPECIFIC-EXCL-SW      PIC  X(01) VALUE 'N'.       01660099
017500         88  PS-STR-SPEC-INCLUDED                VALUE 'Y'.       01670099
017600         88  PS-STR-SPEC-EXCLUDED                VALUE 'N'.       01680099
017700         88  PS-STR-SPEC-ABSENT                  VALUE 'A'.       01690099
017800     05  PS-STR-GRP-HIERARCHY-SW      PIC  X(01) VALUE 'C'.       01700099
017900         88  PS-STR-GRP-CORPORATE                VALUE 'C'.       01710099
018000         88  PS-STR-GRP-ADVERSION                VALUE 'A'.       01720099
018010         88  PS-STR-GRP-MRKT-CLSTR               VALUE 'M'.       01730099
018011     05  PS-ORACLE-LOGIN-EOF-SW       PIC X(01)  VALUE 'N'.       01740099
018012         88  ORACLE-LOGIN-EOF                    VALUE 'Y'.       01750099
018020                                                                  01760099
018021*---------------------------------------------------------------* 01770099
018022 01  CC-ORACLE-CONNECTION.                                        01780099
018023     05  CC-ORACLE-USERID        PIC X(40).                       01790099
018024         88 CC-AUTO-LOGON                   VALUE '/'.            01800099
018025     05  CC-ORACLE-PASSWORD      PIC X(40).                       01801099
018026                                                                  01802099
018030*--------------------------------------------------------------*  01803099
018040* PV- PROGRAM VARIABLES                                           01804099
018050*--------------------------------------------------------------*  01805099
018200 01  PV-PROGRAM-VARIABLES.                                        01806099
018300     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 01807099
018400     05  PV-SPACE                     PIC  X(01) VALUE SPACE.     01808099
018500     05  PV-SQL-SUB                   PIC S9(04) VALUE 0  COMP.   01809099
018510 01  PV-LOGON-SYSIN.                                              01810099
018520     05  PV-ORACLE-USERID-LEN        PIC S9(04)      VALUE ZEROS. 01820099
018530     05  PV-ORACLE-PASSWORD-LEN      PIC S9(04)      VALUE ZEROS. 01830099
018600                                                                  01840099
018700*-------------------------------------------------------------    01850099
018800*  TABLE FOR STORE LIST - FOR EXCEPTION STORE GROUP PROCESSING    01860099
018900*-------------------------------------------------------------    01870099
019000 01  PV-STR-GRP-TBL.                                              01880099
019100     05  PV-STR-GRP-TBL-RCD           OCCURS 5010 TIMES           01890099
019200                                      INDEXED BY PV-SGTR-NDX,     01900099
019300                                                 PV-SGTR-NDX2.    01910099
019400         10 PV-SGTR-STR-NBR           PIC  9(05) VALUE 0.         01920099
019500         10 PV-SGTR-STR-GP-TYP-CDE    PIC  9(05) VALUE 0.         01930099
019600         10 PV-SGTR-STR-GRP-ID        PIC  9(05) VALUE 0.         01940099
019700*                                                                 01950099
019800 01  PV-TEST-STR-LIST-DATA.                                       01960099
019900     05  PV-TEST-STR-GP-TYP            PIC  9(05) VALUE ZERO.     01970099
020000     05  PV-TEST-STR-GP-ID             PIC  9(05) VALUE ZERO.     01980099
020100     05  PV-TEST-STR-NBR               PIC  9(05) VALUE ZERO.     01990099
020200*-------------------------------------------------------------    02000099
020300*  FOLLOWING TABLE WILL HOLD DATA FETCHED FROM OMT_OFR_LOC_GP     02010099
020400*  TABLE FOR A PARTICULAR OFFER_ID BEING PROCESSED.               02020099
020500*-------------------------------------------------------------    02030099
020600 01  PV-OFR-LOC-GP-TBL.                                           02040099
020700     05  PV-OFR-LOC-GP-RCD            OCCURS 5010 TIMES           02050099
020800                                      INDEXED BY PV-OLGT-NDX,     02060099
020810                                                 PV-OLGT-NDX2.    02070099
020820         10 PV-OLGT-EVNT-ID           PIC  9(10) VALUE 0.         02080099
020830         10 PV-OLGT-OFR-ID            PIC  9(10) VALUE 0.         02081099
020840         10 PV-OLGT-OFR-SECT-TYP-CDE  PIC  X(01) VALUE SPACES.    02082099
020850         10 PV-OLGT-STR-GP-TYP-CDE    PIC  9(05) VALUE 0.         02083099
020860         10 PV-OLGT-STR-GRP-ID        PIC  9(05) VALUE 0.         02084099
020870         10 PV-OLGT-IE-IND            PIC  X(01) VALUE SPACES.    02085099
020880         10 PV-OLGT-EXIST-IN-RFRSH    PIC  X(01) VALUE SPACES.    02086099
020890                                                                  02087099
020900 01  PV-SAVE-OFFER-KEY.                                           02088099
021000     05  PV-SAVE-EVNT-ID              PIC  9(10) VALUE ZEROS.     02089099
021100     05  PV-SAVE-OFR-ID               PIC  9(10) VALUE ZEROS.     02090099
021200     05  PV-SAVE-OFR-SECT-TYP-CDE     PIC  X(01) VALUE SPACE.     02100099
021300                                                                  02110099
021400*----------------------------------------------------------------*02120099
021500* DF- DATE AND TIME FIELDS USED IN P9990-                        *02130099
021600*----------------------------------------------------------------*02140099
021700 01  DF-DATE-TIME-FIELDS.                                         02150099
021800     05  DF-CURRENT-DATE-TIME.                                    02160099
021900         10  DF-CURRENT-YR            PIC  9(04) VALUE ZEROS.     02170099
022000         10  DF-CURRENT-MO            PIC  9(02) VALUE ZEROS.     02180099
022100         10  DF-CURRENT-DY            PIC  9(02) VALUE ZEROS.     02190099
022200         10  DF-CURRENT-HR            PIC  9(02) VALUE ZEROS.     02200099
022300         10  DF-CURRENT-MIN           PIC  9(02) VALUE ZEROS.     02210099
022400         10  DF-CURRENT-SEC           PIC  9(02) VALUE ZEROS.     02220099
022500         10  DF-CURRENT-HSEC          PIC  9(02) VALUE ZEROS.     02230099
022600     05  DF-DISPLAY-DATE.                                         02240099
022700         10  DF-DD-YR                 PIC  X(04) VALUE SPACES.    02250099
022800         10  FILLER                   PIC  X(01) VALUE '-'.       02260099
022900         10  DF-DD-MO                 PIC  X(02) VALUE SPACES.    02270099
023000         10  FILLER                   PIC  X(01) VALUE '-'.       02280099
023100         10  DF-DD-DY                 PIC  X(02) VALUE SPACES.    02290099
023200     05  DF-DISPLAY-TIME.                                         02300099
023300         10  DF-DT-HR                 PIC  X(02) VALUE SPACES.    02310099
023400         10  FILLER                   PIC  X(01) VALUE ':'.       02320099
023500         10  DF-DT-MIN                PIC  X(02) VALUE SPACES.    02330099
023600         10  FILLER                   PIC  X(01) VALUE ':'.       02340099
023700         10  DF-DT-SEC                PIC  X(02) VALUE SPACES.    02350099
023800                                                                  02360099
023900*----------------------------------------------------------------*02370099
024000* PV- PROGRAM COUNTER VARIABLES                                  *02380099
024100*----------------------------------------------------------------*02390099
024200 01  PV-PROGRAM-COUNTERS.                                         02400099
024300     05  PV-STR-GRP-RECS-READ         PIC  9(09) VALUE 0.         02410099
024400     05  PV-OFFERS-RECS-READ          PIC  9(09) VALUE 0.         02420099
024500     05  PV-STR-LIST-RECS-READ        PIC  9(09) VALUE 0.         02430099
024600     05  PV-STR-LIST-RECS-DROPPED     PIC  9(09) VALUE 0.         02440099
024700     05  PV-STORE-RFRSH-COUNT         PIC  9(09) VALUE 0.         02450099
024800     05  PV-EXCL-OFFERS-DROPPED       PIC  9(09) VALUE 0.         02460099
024900     05  PV-OFFERS-RECS-DROPPED       PIC  9(09) VALUE 0.         02470099
025000     05  PV-OFFER-RECS-OUT            PIC  9(09) VALUE 0.         02480099
025100     05  PV-STR-LIST-RECS-OUT         PIC  9(09) VALUE 0.         02490099
025200     05  PV-INCLUDED-STR-GP-CNT       PIC  9(09) VALUE 0.         02500099
025210     05  PV-EXCLUDED-STR-GP-CNT       PIC  9(09) VALUE 0.         02510099
025220                                                                  02520099
025230*----------------------------------------------------------------*02521099
025240* ERROR HANDLING                                                  02522099
025250*----------------------------------------------------------------*02523099
025260 01  PV-MISC-ABEND-FIELDS.                                        02524099
025270     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     02525099
025280     05  PV-ORA-OPERATION             PIC  X(50) VALUE SPACES.    02526099
025290     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     02527099
025300     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     02528099
025400                                                                  02529099
025500 01  AC-ABEND-CODE                    PIC S9(04) VALUE +0         02530099
025600                                                 COMP SYNC.       02540099
025700     88  AC-4004-TABLE-OVERFLOW-ERROR            VALUE +4004.     02550099
025800     88  AC-4008-INPUT-FILE-EMPTY                VALUE +4008.     02560099
025900     88  AC-4013-ORACLE-ERROR                    VALUE +4013.     02570099
026000                                                                  02580099
026100*----------------------------------------------------------------*02590099
026200* COPYBOOK FOR INPUT AND OUTPUT REFRESH STORES FILE              *02600099
026300*----------------------------------------------------------------*02610099
026400     COPY EPRD250.                                                02620099
026500                                                                  02630099
026600*-------------------------------------------------------------    02640099
026700*  COPY BOOK FOR INPUT OFFERS REFRESH DATA FILE                   02650099
026800*----------------------------------------------------------------*02660099
026900     COPY EPRD205 REPLACING EP205 BY PV205.                       02670099
027000                                                                  02680099
027100*-------------------------------------------------------------    02690099
027200*  COPY BOOK FOR OFFERS STORE GROUP INPUT FILE                    02700099
027300*-------------------------------------------------------------    02710099
027400     COPY EPRD206 REPLACING EP206 BY PV206.                       02720099
027500                                                                  02730099
027600*----------------------------------------------------------------*02740099
027700* COPYBOOK FOR OUTPUT OFFERS DATA FILE - INTERMEDIATE            *02750099
027800*----------------------------------------------------------------*02760099
027900     COPY EPRD205.                                                02770099
028000                                                                  02780099
028100*----------------------------------------------------------------*02790099
028200* COPYBOOK FOR OUTPUT REFRESH STORE LIST FILE                    *02800099
028300*----------------------------------------------------------------*02810099
028400     COPY EPRD206.                                                02820099
028500                                                                  02830099
028600*----------------------------------------------------------------*02840099
028700* ORACLE DELARE SECTION START                                    *02850099
028800*----------------------------------------------------------------*02860099
028900     EXEC SQL                                                     02870099
029000        BEGIN DECLARE SECTION                                     02880099
029100     END-EXEC.                                                    02890099
029200                                                                  02900099
029300*----------------------------------------------------------------*02910099
029400* PD- ORA VARIABLES (NON DCLGEN)                                 *02920099
029500*----------------------------------------------------------------*02930099
029600 01  USERNAME                      PIC X(10)  VARYING.            02940099
029700 01  PASSWD                        PIC X(10)  VARYING.            02950099
029800 01  PV-ORACLE-ID                  PIC X(01)  VALUE '/'.          02960099
029900                                                                  02970099
030000*----------------------------------------------------------------*02980099
030100* OMT00001 - OMT_OFR  COPYBOOK                                   *02990099
030200* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR              *03000099
030300*----------------------------------------------------------------*03010099
030400     EXEC SQL                                                     03020099
030500         INCLUDE OMT00001                                         03030099
030600     END-EXEC.                                                    03040099
030700                                                                  03050099
030800*----------------------------------------------------------------*03060099
030900* OMT00002 - OMT_OFR_SECT COPYBOOK                               *03070099
031000* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_SECT         *03080099
031100*----------------------------------------------------------------*03090099
031200     EXEC SQL                                                     03100099
031300         INCLUDE OMT00002                                         03110099
031400     END-EXEC.                                                    03120099
031500                                                                  03130099
031600*----------------------------------------------------------------*03140099
031700* OMT00003 - OMT_OFR_SECT_BWP COPYBOOK                           *03150099
031800* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_SECT_BWP     *03160099
031900*----------------------------------------------------------------*03170099
032000     EXEC SQL                                                     03180099
032100         INCLUDE OMT00003                                         03190099
032200     END-EXEC.                                                    03200099
032300                                                                  03210099
032400*----------------------------------------------------------------*03220099
032500* OMT00004 - OMT_OFR_LOC_GP COPYBOOK                             *03230099
032600* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_LOC_GP       *03240099
032700*----------------------------------------------------------------*03250099
032800     EXEC SQL                                                     03260099
032900         INCLUDE OMT00004                                         03270099
033000     END-EXEC.                                                    03280099
033100                                                                  03290099
033200*----------------------------------------------------------------*03300099
033300* ORACLE END OF DECLARATIVE SECTION                              *03310099
033400*----------------------------------------------------------------*03320099
033500     EXEC SQL                                                     03330099
033600       END DECLARE SECTION                                        03340099
033700     END-EXEC.                                                    03350099
033800                                                                  03360099
033900     EXEC SQL                                                     03370099
034000       INCLUDE SQLCACOB                                           03380099
034100     END-EXEC.                                                    03390099
034200*----------------------------------------------------------------*03400099
034300* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        *03410099
034400*----------------------------------------------------------------*03420099
034500     COPY DPWS004.                                                03430099
034600                                                                  03440099
034700*----------------------------------------------------------------*03450099
034800* ORA ABEND COPYBOOK                                             *03460099
034900*----------------------------------------------------------------*03470099
035000     COPY DPWS900.                                                03480099
035100                                                                  03490099
035200******************************************************************03500099
035300 PROCEDURE DIVISION.                                              03510099
035400******************************************************************03520099
035500 0000-MAINLINE.                                                   03530099
035600                                                                  03540099
035700     PERFORM 1000-INITIALIZATION.                                 03550099
035800                                                                  03560099
035900     IF  PS-STRS-FOUND                                            03570099
036000       AND PS-OFFERS-FOUND                                        03580099
036100         PERFORM 1100-LOAD-STR-GRP-TBL                            03590099
036200           UNTIL PS-END-OF-STR-GRP-FILE                           03600099
036300                                                                  03610099
036400         PERFORM 2000-PROCESS-OFFERS                              03620099
036500           UNTIL PS-END-OF-STR-LIST-FILE                          03630099
036600     END-IF.                                                      03640099
036700                                                                  03650099
036800     PERFORM 9000-WRAPUP.                                         03660099
036900                                                                  03670099
037000     GOBACK.                                                      03680099
037100                                                                  03690099
037200*0000-EXIT.                                                       03700099
037300******************************************************************03710099
037400*   1000-INITIALIZATION.                                         *03720099
037500*     INTIALIZES VARIABLES, OPENS FILES, READS CONTROL CARDS,    *03730099
037600*     AND PERFORMS SET-UP ROUTINES.                              *03740099
037700******************************************************************03750099
037800 1000-INITIALIZATION.                                             03760099
037900     MOVE '1000-INITIALIZATION             ' TO PV-PARAGRAPH-NAME.03770099
038000                                                                  03780099
038100     PERFORM 9990-GET-CURRENT.                                    03790099
038200                                                                  03800099
038300     DISPLAY '****************************************'.          03810099
038400     DISPLAY '**          EPKUT209 STARTED          **'.          03820099
038500     DISPLAY '****************************************'.          03830099
038600     DISPLAY '** CURRENT DATE ' DF-DISPLAY-DATE                   03840099
038700             '            **'.                                    03850099
038800     DISPLAY '** CURRENT TIME ' DF-DISPLAY-TIME                   03860099
038900             '              **'.                                  03870099
039000     DISPLAY '****************************************'.          03880099
039100                                                                  03890099
039200     OPEN INPUT  REFRESH-STORE-CARD-FILE                          03900099
039300                 OFFERS-FULL-REFRESH-IN-FILE                      03910099
039400                 ORACLE-LOGIN-FILE                                03920099
039500                 REFRESH-STORE-LIST-IN-FILE                       03930099
039600          OUTPUT OFFERS-FULL-REFRESH-OUT-FILE                     03940099
039700                 REFRESH-STORE-LIST-OUT-FILE.                     03950099
039800                                                                  03960099
039900     SET PV-SGTR-NDX TO +1.                                       03970099
040000                                                                  03980099
040100     INITIALIZE EP250-CC-CONTROL-CARD.                            03990099
040200     INITIALIZE PS-PROGRAM-SWITCHES.                              04000099
040300     INITIALIZE PV-PROGRAM-VARIABLES.                             04010099
040400                                                                  04020099
040500*------------------------------------------------------------     04030099
040600*   INITIAL READ OF STR GRP FILE                                  04040099
040700     SET PS-NOT-END-OF-STR-GRP-FILE TO TRUE.                      04050099
040800     PERFORM 8000-READ-STR-GRP-FILE.                              04060099
040900                                                                  04070099
041000     IF  PS-END-OF-STR-GRP-FILE                                   04080099
041100         DISPLAY PC-NO-REFRESH-STRS-FOUND                         04090099
041200         SET PS-NO-STRS-FOUND TO TRUE                             04100099
041300     ELSE                                                         04110099
041400         SET PS-STRS-FOUND TO TRUE                                04120099
041500         PERFORM 1300-READ-CHECK-OFFERS-STRLIST                   04130099
041600     END-IF.                                                      04140099
041700                                                                  04150099
041800     IF  PS-STRS-FOUND                                            04160099
041900       AND PS-OFFERS-FOUND                                        04170099
042000         SET PS-STR-NOT-EXCL-FROM-OFR TO TRUE                     04180099
042100         PERFORM 1200-SETUP-ORACLE-ACCESS                         04190099
042200     END-IF.                                                      04200099
042300                                                                  04210099
042400*1000-EXIT.                                                       04220099
042500******************************************************************04230099
042600*   1100-LOAD-STR-GRP-TBL.                                       *04240099
042700*     LOAD STORE GROUP LIST INTERNAL TABLE.                      *04250099
042800******************************************************************04260099
042900 1100-LOAD-STR-GRP-TBL.                                           04270099
043000     MOVE '1100-LOAD-STR-GRP-TBL          ' TO  PV-PARAGRAPH-NAME.04280099
043100*                                                                 04290099
043200     MOVE EP250-CC-STR-NBR                                        04300099
043300       TO PV-SGTR-STR-NBR(PV-SGTR-NDX).                           04310099
043400     MOVE EP250-CC-STR-GP-TYP-CDE                                 04320099
043500       TO PV-SGTR-STR-GP-TYP-CDE(PV-SGTR-NDX).                    04330099
043600     MOVE EP250-CC-STR-GRP-ID                                     04340099
043700       TO PV-SGTR-STR-GRP-ID(PV-SGTR-NDX).                        04350099
043800                                                                  04360099
043900     SET PV-SGTR-NDX UP BY 1.                                     04370099
044000                                                                  04380099
044100     IF  PV-SGTR-NDX > PC-INDX-LIMIT-5000                         04390099
044200         DISPLAY 'LIMIT OF STR GP TABLE ARRAY REACHED'            04400099
044300         MOVE '1100-LOAD-STR-GRP-TBL      ' TO                    04410099
044400                                PV-PARAGRAPH-NAME                 04420099
044500         MOVE 'TABLE LIMIT REACHED FOR STR-GP-ARRAY' TO           04430099
044600                              PV-OPERATION-MSG-1                  04440099
044700         SET AC-4004-TABLE-OVERFLOW-ERROR TO TRUE                 04450099
044800         PERFORM 9800-ABEND                                       04460099
044900     END-IF.                                                      04470099
045000                                                                  04480099
045100     PERFORM 8000-READ-STR-GRP-FILE.                              04490099
045200                                                                  04500099
045300*1100-EXIT.                                                       04510099
045400******************************************************************04520099
045500*   1200-SETUP-ORACLE-ACCESS.                                    *04530099
045600*     SET UP TO CONNECT TO THE ORACLE DATABASE.                  *04540099
045700*     IF USERNAME-LEN IS ZERO, THE LOGON ID IS MISSING FROM SYSIN.04550099
045800*     THEREFORE IT IS A PRODUCTION RUN WHERE THE LOGON INFO COMES 04560099
045900*     FROM THE JCL.  (STD. USAGE - HERE PROVIDE READONLY IN PROD) 04570099
046000******************************************************************04580099
046100 1200-SETUP-ORACLE-ACCESS.                                        04590099
046200     MOVE '1200-SETUP-ORACLE-ACCESS      ' TO PV-PARAGRAPH-NAME.  04600099
046300*                                                                 04610099
046400     READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION             04620099
046500        AT END                                                    04630099
046600           SET ORACLE-LOGIN-EOF TO TRUE.                          04640099
046700     CLOSE ORACLE-LOGIN-FILE.                                     04650099
046800                                                                  04660099
046900     IF  ((ORACLE-LOGIN-EOF)                                      04670099
047000           OR ((CC-ORACLE-CONNECTION = SPACES)))                  04680099
047100           DISPLAY '** ABEND **'                                  04690099
047200           DISPLAY ' ORACLE LOGON NOT PROVIDED'                   04700099
047300           MOVE    '1200-SET-UP-FOR-ORACLE'   TO PV-PARAGRAPH-NAME04710099
047400           PERFORM 9900-ORA-ERROR                                 04720099
047500     END-IF.                                                      04730099
048600                                                                  04740099
048700     PERFORM 7000-CONNECT-TO-ORACLE.                              04750099
048800                                                                  04760099
048900*1200-EXIT.                                                       04770099
049000******************************************************************04780099
049100*  1300-READ-CHECK-OFFERS-STRLIST.                               *04790099
049200*  READ AND CHECK OFFERS DATA AND STORE LIST FILES.              *04800099
049300*  THIS PARAGRAPH IS EXECUTED IF THERE ARE INPUT STR GRPS        *04810099
049400*  - INITIAL READ OF OFFERS FILE                                 *04820099
049500*  - INITIAL READ OF STR LIST FILE                               *04830099
049600*  OFFERS AND STR LIST FILES MAY BE EMPTY, WHEN STR GRPS FOUND   *04840099
049700*  - PROCESS STORE LIST AND OFFERS FILES IF BOTH NON-EMPTY       *04850099
049800*  - DISPLAY NO OFFERS FOUND MESSAGE WHEN BOTH EMPTY             *04860099
049900*  - ABEND IF OFFERS FILE IS EMPTY WHEN STR LIST RECS WERE FOUND *04870099
050000*  - ABEND IF STR LIST FILE IS EMPTY, WHEN OFFERS WERE FOUND     *04880099
050100******************************************************************04890099
050200 1300-READ-CHECK-OFFERS-STRLIST.                                  04900099
050300                                                                  04910099
050400     SET PS-NOT-END-OF-OFFERS-FILE  TO TRUE.                      04920099
050500     SET PS-NOT-END-OF-STR-LIST-FILE TO TRUE.                     04930099
050600                                                                  04940099
050700     PERFORM 8100-READ-OFFERS-FILE.                               04950099
050800     PERFORM 8200-READ-STR-LIST-FILE.                             04960099
050900                                                                  04970099
051000     EVALUATE TRUE                                                04980099
051100       WHEN PS-NOT-END-OF-STR-LIST-FILE                           04990099
051200         AND PS-NOT-END-OF-OFFERS-FILE                            05000099
051300            SET  PS-OFFERS-FOUND             TO TRUE              05010099
051400       WHEN PS-END-OF-OFFERS-FILE                                 05020099
051500         AND PS-END-OF-STR-LIST-FILE                              05030099
051600            SET  PS-NO-OFFERS-FOUND TO TRUE                       05040099
051700            DISPLAY PC-NO-OFFERS-FOUND                            05050099
051800       WHEN PS-END-OF-STR-LIST-FILE                               05060099
051900         AND PS-NOT-END-OF-OFFERS-FILE                            05070099
052000            MOVE '1300-READ-CHECK-OFFERS-STRLIST'                 05080099
052100                                             TO PV-PARAGRAPH-NAME 05090099
052200            MOVE 'NO STR LIST WHEN EXPECTED' TO PV-OPERATION-MSG-105100099
052300            SET  AC-4008-INPUT-FILE-EMPTY    TO TRUE              05110099
052400            PERFORM 9800-ABEND                                    05120099
052500       WHEN PS-END-OF-OFFERS-FILE                                 05130099
052600         AND PS-NOT-END-OF-STR-LIST-FILE                          05140099
052700            MOVE '1300-READ-CHECK-OFFERS-STRLIST'                 05150099
052800                                             TO PV-PARAGRAPH-NAME 05160099
052900            MOVE 'NO OFFERS WHEN EXPECTED  ' TO PV-OPERATION-MSG-105170099
053000            SET  AC-4008-INPUT-FILE-EMPTY    TO TRUE              05180099
053100            PERFORM 9800-ABEND                                    05190099
053200     END-EVALUATE.                                                05200099
053300                                                                  05210099
053400*1300-EXIT.                                                       05220099
053500******************************************************************05230099
053600*   2000-PROCESS-OFFERS.                                         *05240099
053700*    MAIN DRIVING PARAGRAPH OF PROGRAM.                          *05250099
053800*    PROCESS EACH STORE LIST FILE RECORD:                        *05260099
053900*    - IF DIFFERENT OFFER (OFFER KEY) FROM PREVIOUS RECORD,      *05270099
054000*      RESET EXCLUSION SWITCH AND CHECK FOR EXCLUSIONS.          *05280099
054100*      - IF NOT EXCLUDED:                                        *05290099
054200*        - WRITE OUT STORE LIST RECORD,                          *05300099
054300*        - READ AND WRITE OUT OFFERS DATA RECORDS WITH SAME      *05310099
054400*          OFFER KEY AND STORE NUMBER.                           *05320099
054500*      - IF EXCLUDED:                                            *05330099
054600*        - DROP AND DISPLAY STORE LIST RECORD,                   *05340099
054700*        - READ AND DROP OFFERS DATA RECORDS WITH SAME OFFER     *05350099
054800*          KEY AND STORE NUMBER.                                 *05360099
054900*    - READ NEXT STORE LIST RECORD.                              *05370099
055000******************************************************************05380099
055100 2000-PROCESS-OFFERS.                                             05390099
055200     MOVE '2000-PROCESS-OFFERS          ' TO PV-PARAGRAPH-NAME.   05400099
055300                                                                  05410099
055400                                                                  05420099
055500     IF  PV206-OFFER-KEY  NOT EQUAL TO  PV-SAVE-OFFER-KEY         05430099
055600         SET PS-STR-NOT-EXCL-FROM-OFR TO TRUE                     05440099
055700         PERFORM 3000-CHECK-FOR-EXCLUSIONS                        05450099
055800         MOVE PV206-OFFER-KEY       TO  PV-SAVE-OFFER-KEY         05460099
055900     END-IF.                                                      05470099
056000                                                                  05480099
056100     IF  PS-STR-NOT-EXCL-FROM-OFR                                 05490099
056200         MOVE PV206-STORE-LIST-RCD TO EP206-STORE-LIST-RCD        05500099
056300         PERFORM 8400-WRITE-STR-LIST-REC                          05510099
056400     ELSE                                                         05520099
056500         ADD 1 TO PV-STR-LIST-RECS-DROPPED                        05530099
056600         DISPLAY 'EXCLUDED STR-LIST-REC > ' PV206-STORE-LIST-RCD  05540099
056700     END-IF.                                                      05550099
056800                                                                  05560099
056900     PERFORM 3200-PROCESS-OFFERS-FILE                             05570099
057000       UNTIL PV205-OFFER-KEY NOT EQUAL PV206-OFFER-KEY            05580099
057100         OR  PV205-STR-NBR   NOT EQUAL PV206-STORE-NUMBER         05590099
057200         OR  PS-END-OF-OFFERS-FILE.                               05600099
057300                                                                  05610099
057400     PERFORM 8200-READ-STR-LIST-FILE.                             05620099
057500                                                                  05630099
057600*2000-EXIT.                                                       05640099
057700******************************************************************05650099
057800*  3000-CHECK-FOR-EXCLUSIONS.                                    *05660099
057900*   CHECK FOR EXCLUSION STORE GROUPS FOR THE OFFER IN HAND       *05670099
058000*    - PROCESS THE INPUT STORE GROUP RECORDS                     *05680099
058100******************************************************************05690099
058200 3000-CHECK-FOR-EXCLUSIONS.                                       05700099
058300     MOVE '3000-CHECK-FOR-EXCLUSIONS ' TO       PV-PARAGRAPH-NAME.05710099
058400                                                                  05720099
058500     MOVE PV206-EVENT-ID         TO EVNT-ID          IN OMT00004. 05730099
058600     MOVE PV206-OFFER-ID         TO OFR-ID           IN OMT00004. 05740099
058700     MOVE PV206-OFR-SECT-TYP-CDE TO OFR-SECT-TYP-CDE IN OMT00004. 05750099
058800     SET PV-OLGT-NDX TO +1.                                       05760099
058900     SET PS-STR-SPEC-ABSENT TO TRUE.                              05770099
059000                                                                  05780099
059100     INITIALIZE PV-OFR-LOC-GP-TBL.                                05790099
059200                                                                  05800099
059300     PERFORM 7100-DEC-OPEN-EXCL-CURSOR.                           05810099
059400                                                                  05820099
059500     PERFORM 3100-PROCESS-EXCLUSION-CSR                           05830099
059600           UNTIL PS-END-OF-FETCH-EXCL.                            05840099
059700                                                                  05850099
059800     PERFORM 7300-CLOSE-EXCL-CURSOR.                              05860099
059900                                                                  05870099
060000     EVALUATE TRUE                                                05880099
060010         WHEN PS-STR-SPEC-INCLUDED                                05890099
060020             SET PS-STR-NOT-EXCL-FROM-OFR TO TRUE                 05900099
060030                                                                  05910099
060040         WHEN PS-STR-SPEC-EXCLUDED                                05920099
060050             SET PS-STR-EXCL-FROM-OFR TO TRUE                     05930099
060060                                                                  05940099
060070         WHEN PS-STR-SPEC-ABSENT                                  05950099
060080             PERFORM 3300-DETERMINE-OFR-IN-EXC                    05960099
060090                                                                  05970099
060091     END-EVALUATE.                                                05980099
060092                                                                  05990099
060093     SET  PV-SGTR-NDX TO 1.                                       06000099
060094     SET  PS-NOT-END-OF-FETCH-EXCL TO TRUE.                       06001099
060095                                                                  06002099
060096*3000-EXIT.                                                       06003099
060097******************************************************************06004099
060098*  3100-PROCESS-EXCLUSION-CSR.                                   *06005099
060099*   PROCESS THE INPUT STORE GROUP RECORDS TO OBTAIN OFFERS       *06006099
060100*    - ROCESS THE INPUT STORE GROUP RECORDS                      *06007099
060200******************************************************************06008099
060300 3100-PROCESS-EXCLUSION-CSR.                                      06009099
060400     MOVE '3100-PROCESS-EXCLUSION-CSR' TO       PV-PARAGRAPH-NAME.06010099
060500                                                                  06020099
060600     PERFORM 7200-FETCH-EXCLUSION-CSR.                            06030099
060700                                                                  06040099
060800     EVALUATE TRUE                                                06050099
060900        WHEN SQLCODE IS EQUAL TO ZEROS                            06060099
061000            MOVE STR-GP-TYP-CDE IN OMT00004 TO PV-TEST-STR-GP-TYP 06070099
061100            MOVE STR-GP-ID      IN OMT00004 TO PV-TEST-STR-GP-ID  06080099
061200            MOVE PV206-STORE-NUMBER         TO PV-TEST-STR-NBR    06090099
061300            SET  PS-STR-NOT-IN-EXCL-STR-GP  TO TRUE               06100099
061400                                                                  06110099
061500            PERFORM 4100-LOAD-LOC-GP-TBL                          06120099
061600                                                                  06130099
061700        WHEN SQLCODE IS EQUAL TO PC-ROW-NOT-FOUND                 06140099
061800            SET PS-END-OF-FETCH-EXCL     TO TRUE                  06150099
061900        WHEN OTHER                                                06160099
062000            DISPLAY ' '                                           06170099
062100            DISPLAY '** ABEND IN 3100-PROCESS-EXCLUSION-CSR **'   06180099
062200            DISPLAY 'INVALID SQLCODE IN FETCH FROM EXCLCRSR FOR'  06190099
062300            DISPLAY 'EVENT-ID > '         PV206-EVENT-ID          06200099
062400                  ', OFFER-ID > '         PV206-OFFER-ID          06210099
062500                  ', OFR-SECT-TYP-CDE > ' PV206-OFR-SECT-TYP-CDE  06220099
062600            DISPLAY '** FETCH SQLCODE > ' SQLCODE ' **'           06230099
062700            MOVE 'FETCH DATA FROM EXCLCRSR   ' TO PV-ORA-OPERATION06240099
062800            PERFORM 9900-ORA-ERROR                                06250099
062900     END-EVALUATE.                                                06260099
063000                                                                  06270099
063100*3100-EXIT.                                                       06280099
063200******************************************************************06290099
063300*  3200-PROCESS-OFFERS-FILE.                                     *06300099
063400*   PROCESS THE INPUT OFFERS RECORDS TO DETERMINE IF STORE IS    *06310099
063500*   EXCLUDED FROM OFFER.                                         *06320099
063600******************************************************************06330099
063700 3200-PROCESS-OFFERS-FILE.                                        06340099
063800     MOVE '3200-PROCESS-OFFERS-FILE      ' TO PV-PARAGRAPH-NAME.  06350099
063900                                                                  06360099
064000     IF  PS-STR-NOT-EXCL-FROM-OFR                                 06370099
064100         MOVE PV205-OFFER-EXTRACT TO EP205-OFFER-EXTRACT          06380099
064200         PERFORM 8300-WRITE-XST-OFR-DATA                          06390099
064300     ELSE                                                         06400099
064400         ADD 1 TO PV-OFFERS-RECS-DROPPED                          06410099
064500     END-IF.                                                      06420099
064600                                                                  06430099
064700     PERFORM 8100-READ-OFFERS-FILE.                               06440099
064800                                                                  06450099
064900*3200-EXIT.                                                       06460099
065000****************************************************************  06470099
065100*  3300-DETERMINE-OFR-IN-EXC                                   *  06480099
065200*                                                              *  06490099
065300****************************************************************  06500099
065400 3300-DETERMINE-OFR-IN-EXC.                                       06510099
065500                                                                  06520099
065600     SET PV-OLGT-NDX TO +1.                                       06530099
065700     INITIALIZE PV-INCLUDED-STR-GP-CNT.                           06540099
065800     INITIALIZE PV-EXCLUDED-STR-GP-CNT.                           06550099
065810                                                                  06560099
065820     PERFORM                                                      06570099
065830       VARYING PV-OLGT-NDX FROM 1 BY 1                            06580099
065840         UNTIL PV-OLGT-NDX >  PC-INDX-LIMIT-50                    06581099
065850            OR PV-OLGT-STR-GRP-ID(PV-OLGT-NDX) = ZEROS            06582099
065860                                                                  06583099
065861           EVALUATE TRUE                                          06584099
065862              WHEN PV-OLGT-IE-IND(PV-OLGT-NDX) = 'Y'              06585099
065863               AND PV-OLGT-EXIST-IN-RFRSH(PV-OLGT-NDX) = 'Y'      06586099
065864                   ADD 1 TO PV-INCLUDED-STR-GP-CNT                06586199
065865                                                                  06586299
065866              WHEN PV-OLGT-IE-IND(PV-OLGT-NDX) = 'N'              06586399
065867               AND PV-OLGT-EXIST-IN-RFRSH(PV-OLGT-NDX) = 'Y'      06586499
065868                   ADD 1 TO PV-EXCLUDED-STR-GP-CNT                06586599
065869           END-EVALUATE                                           06586699
065870     END-PERFORM.                                                 06586799
065880                                                                  06586899
065881     EVALUATE TRUE                                                06586999
065882         WHEN PV-INCLUDED-STR-GP-CNT = 1 AND                      06587099
065883              PV-EXCLUDED-STR-GP-CNT = 0                          06588099
065884                 SET PS-STR-NOT-EXCL-FROM-OFR TO TRUE             06588199
065885                                                                  06588299
065886         WHEN PV-INCLUDED-STR-GP-CNT = 1 AND                      06588399
065887              PV-EXCLUDED-STR-GP-CNT = 1                          06588499
065888                 SET PS-STR-EXCL-FROM-OFR TO TRUE                 06588599
065889                                                                  06588699
065890         WHEN PV-INCLUDED-STR-GP-CNT > 1 AND                      06588799
065891              PV-EXCLUDED-STR-GP-CNT = 1                          06588899
065892                 SET PS-STR-NOT-EXCL-FROM-OFR TO TRUE             06588999
065893     END-EVALUATE.                                                06589099
065894                                                                  06589199
065895*3300-EXIT.                                                       06589299
065896****************************************************************  06589399
065897*  4100-LOAD-LOC-GP-TBL.                                      *   06589499
065898*  CHECK THE INTERNAL STORE GROUP TABLE FOR THE PRESENCE OF    *  06589599
065899*  THE EXCLUSION STORE GROUP FETCHED FOR THE OFFER.            *  06589699
065900*  IF FOUND, THE OFFER WILL BE DROPPED FROM THE OFFERS FILE    *  06589799
066000*  AND THE STORE LIST FILE, FOR THAT STORE.                    *  06589899
066100*                                                              *  06589999
066200****************************************************************  06590099
066300 4100-LOAD-LOC-GP-TBL.                                            06600099
066400     MOVE '4100-LOAD-LOC-GP-TBL         ' TO PV-PARAGRAPH-NAME.   06610099
066500                                                                  06620099
066600     MOVE PV206-EVENT-ID  TO PV-OLGT-EVNT-ID(PV-OLGT-NDX)         06630099
066700     MOVE PV206-OFFER-ID   TO PV-OLGT-OFR-ID(PV-OLGT-NDX)         06640099
066800     MOVE PV206-OFR-SECT-TYP-CDE TO                               06650099
066900                     PV-OLGT-OFR-SECT-TYP-CDE(PV-OLGT-NDX)        06660099
067000     MOVE PV-TEST-STR-GP-TYP TO                                   06670099
067100                             PV-OLGT-STR-GP-TYP-CDE(PV-OLGT-NDX)  06680099
067200     MOVE PV-TEST-STR-GP-ID TO PV-OLGT-STR-GRP-ID(PV-OLGT-NDX)    06690099
067300     MOVE IE-IND IN OMT00004 TO PV-OLGT-IE-IND(PV-OLGT-NDX)       06700099
067400                                                                  06710099
067500                                                                  06720099
067600     IF PV-TEST-STR-GP-TYP = PC-STORE-GP-5000                     06730099
067700     AND PV-TEST-STR-GP-ID = PV-TEST-STR-NBR                      06740099
067800        EVALUATE TRUE                                             06750099
067900          WHEN IE-IND  IN OMT00004 = 'Y'                          06760099
068000             SET PS-STR-SPEC-INCLUDED TO TRUE                     06770099
068100                                                                  06780099
068200          WHEN IE-IND  IN OMT00004 = 'N'                          06790099
068300             SET PS-STR-SPEC-EXCLUDED TO TRUE                     06800099
068400                                                                  06810099
068500        END-EVALUATE                                              06820099
068600     END-IF.                                                      06830099
068700                                                                  06840099
068800     SET PV-SGTR-NDX TO 1.                                        06850099
068900                                                                  06860099
069000     PERFORM                                                      06870099
069100       VARYING PV-SGTR-NDX FROM 1 BY 1                            06880099
069200         UNTIL PV-SGTR-NDX     > PC-INDX-LIMIT-5000               06890099
069300          OR   PV-SGTR-STR-GRP-ID(PV-SGTR-NDX) = ZEROS            06900099
069310                                                                  06910099
069320         IF   PV-SGTR-STR-NBR(PV-SGTR-NDX)    = PV-TEST-STR-NBR   06920099
069321          AND PV-SGTR-STR-GP-TYP-CDE(PV-SGTR-NDX)                 06930099
069322                                              = PV-TEST-STR-GP-TYP06931099
069323          AND PV-SGTR-STR-GRP-ID(PV-SGTR-NDX) = PV-TEST-STR-GP-ID 06932099
069324             MOVE 'Y' TO PV-OLGT-EXIST-IN-RFRSH(PV-OLGT-NDX)      06932199
069325         END-IF                                                   06932299
069326                                                                  06932399
069327     END-PERFORM.                                                 06932499
069328                                                                  06932599
069329     SET PV-OLGT-NDX UP BY +1.                                    06932699
069330                                                                  06932799
069331     IF PV-SGTR-NDX > PC-INDX-LIMIT-5000                          06932899
069332        DISPLAY 'LIMIT OF STR GP TABLE ARRAY REACHED'             06932999
069333        MOVE 'TABLE LIMIT REACHED FOR STR GP ARRAY' TO            06933099
069334                             PV-OPERATION-MSG-1                   06933199
069335        SET AC-4004-TABLE-OVERFLOW-ERROR TO TRUE                  06933299
069336        PERFORM 9800-ABEND                                        06933399
069337     END-IF.                                                      06933499
069338                                                                  06933599
069339*4100-EXIT.                                                       06933699
069340******************************************************************06933799
069350*   7000-CONNECT-TO-ORACLE.                                      *06933899
069360*     CONNECT TO THE ORACLE DATABASE.                            *06933999
069370******************************************************************06934099
069380 7000-CONNECT-TO-ORACLE.                                          06935099
069390     MOVE '7000-CONNECT-TO-ORACLE          ' TO PV-PARAGRAPH-NAME.06936099
069400*                                                                 06937099
071800                                                                  06938099
071810     IF CC-AUTO-LOGON                                             06939099
071820        DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'         06940099
071830        EXEC SQL                                                  06950099
071840             CONNECT :PC-AUTO-LOGON                               06960099
071850        END-EXEC                                                  06970099
071860     ELSE                                                         06980099
071870        INITIALIZE PV-ORACLE-USERID-LEN                           06990099
071880                   PV-ORACLE-PASSWORD-LEN                         07000099
071890        INSPECT CC-ORACLE-USERID                                  07010099
071891                TALLYING PV-ORACLE-USERID-LEN                     07020099
071892                FOR CHARACTERS BEFORE INITIAL SPACE               07030099
071893        INSPECT CC-ORACLE-PASSWORD                                07040099
071894                TALLYING PV-ORACLE-PASSWORD-LEN                   07050099
071895                FOR CHARACTERS BEFORE INITIAL SPACE               07060099
071896        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         07070099
071897                USERNAME-ARR                                      07080099
071898        MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                 07090099
071899        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     07100099
071900                PASSWD-ARR                                        07110099
071901        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 07120099
071902        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     07130099
071903             PASSWD-ARR                                           07140099
071904        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 07150099
071905        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         07160099
071906             USERNAME-ARR                                         07170099
071907        MOVE PV-ORACLE-USERID-LEN  TO USERNAME-LEN                07180099
071908        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     07190099
071909             PASSWD-ARR                                           07190199
071910        MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                07190299
071911        DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '    07190399
071912             USERNAME-ARR                                         07190499
071913        EXEC SQL                                                  07190599
071914             CONNECT :USERNAME IDENTIFIED BY :PASSWD              07190699
071915        END-EXEC                                                  07190799
071916        INITIALIZE CC-ORACLE-PASSWORD                             07190899
071917                   PASSWD                                         07190999
071918     END-IF                                                       07191099
071919                                                                  07191199
071920     IF (SQLCODE NOT = 0)                                         07191299
071921         DISPLAY PV-PARAGRAPH-NAME                                07191399
071922         PERFORM 9900-ORA-ERROR                                   07191499
071923     END-IF.                                                      07191599
071924                                                                  07191699
071930*7000-EXIT.                                                       07191799
072000******************************************************************07191899
072100* 7100-DEC-OPEN-EXCL-CURSOR.                                      07191999
072200*   DECLARE AND OPEN OFFERCRSR                                    07192099
072300*   NOTE: ADDED OMT_OFR_LOC_GP.LOC_DLT_IND  = 'N'                 07193099
072400*         AND OMT_MDSE_SET.MDSE_DLT_IND = 'N' TO WHERE CLAUSE.    07194099
072500*   NOTE 2: THIS IS IN THE PROCEDURE DIVISION BECAUSE OF THE WAY  07195099
072600*           COBOL AND ORACLE INTERACT.                            07196099
072700******************************************************************07197099
072800 7100-DEC-OPEN-EXCL-CURSOR.                                       07198099
072900     MOVE '7100-DEC-OPEN-EXCL-CURSOR       ' TO PV-PARAGRAPH-NAME.07199099
073000                                                                  07200099
073100     EXEC SQL DECLARE EXCLCRSR CURSOR FOR                         07210099
073200         SELECT STR_GP_TYP_CDE                                    07220099
073300               ,STR_GP_ID                                         07230099
073400               ,IE_IND                                            07240099
073500               ,LOC_DLT_IND                                       07250099
073600         FROM OMT_OFR_LOC_GP                                      07260099
073700         WHERE   EVNT_ID          = :OMT00004.EVNT-ID             07270099
073800             AND OFR_ID           = :OMT00004.OFR-ID              07280099
073900             AND OFR_SECT_TYP_CDE = :OMT00004.OFR-SECT-TYP-CDE    07290099
074000             AND LOC_DLT_IND      = 'N'                           07300099
074100         ORDER BY STR_GP_TYP_CDE                                  07310099
074200                 ,STR_GP_ID                                       07320099
074300     END-EXEC.                                                    07330099
074400                                                                  07340099
074500     PERFORM                                                      07350099
074600         WITH TEST AFTER                                          07360099
074700         VARYING PV-SQL-SUB                                       07370099
074800         FROM 1 BY 1                                              07380099
074900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07390099
075000                   OR  SQLCODE = 0)                               07400099
075100                                                                  07410099
075200           EXEC SQL                                               07420099
075300              OPEN EXCLCRSR                                       07430099
075400           END-EXEC                                               07440099
075500                                                                  07450099
075600           EVALUATE TRUE                                          07460099
075700               WHEN SQLCODE = 0                                   07470099
075800                    CONTINUE                                      07480099
075900               WHEN SQLWARN0 NOT EQUAL SPACE                      07490099
076000               WHEN SQLCODE NOT EQUAL ZERO                        07500099
076100                    MOVE 'OPEN CURSOR FOR EXCLCRSR    '           07510099
076200                                       TO PV-ORA-OPERATION        07520099
076300                    PERFORM 9900-ORA-ERROR                        07530099
076400           END-EVALUATE                                           07540099
076500                                                                  07550099
076600      END-PERFORM.                                                07560099
076700                                                                  07570099
076800*7100-EXIT.                                                       07580099
076900******************************************************************07590099
077000* 7200-FETCH-EXCLUSION-CSR.                                       07600099
077100* THIS PARAGRAPH WILL FETCH DATA FROM THE OFFERCRSR CURSOR        07610099
077200******************************************************************07620099
077300 7200-FETCH-EXCLUSION-CSR.                                        07630099
077400     MOVE '7200-FETCH-EXCLUSION-CSR.      '  TO PV-PARAGRAPH-NAME.07640099
077500                                                                  07650099
077600     EXEC SQL                                                     07660099
077700         FETCH EXCLCRSR                                           07670099
077800          INTO :OMT00004.STR-GP-TYP-CDE                           07680099
077900              ,:OMT00004.STR-GP-ID                                07690099
078000              ,:OMT00004.IE-IND                                   07700099
078100              ,:OMT00004.LOC-DLT-IND                              07710099
078200     END-EXEC.                                                    07720099
078300                                                                  07730099
078400*7200-EXIT.                                                       07740099
078500******************************************************************07750099
078600*  7300-CLOSE-EXCL-CURSOR.                                       *07760099
078700*  CLOSE EXCLCRSR CURSOR                                         *07770099
078800******************************************************************07780099
078900 7300-CLOSE-EXCL-CURSOR.                                          07790099
079000     MOVE '7300-CLOSE-EXCL-CURSOR    ' TO      PV-PARAGRAPH-NAME. 07800099
079100                                                                  07810099
079200     PERFORM                                                      07820099
079300         WITH TEST AFTER                                          07830099
079400         VARYING PV-SQL-SUB                                       07840099
079500         FROM 1 BY 1                                              07850099
079600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07860099
079700                   OR  SQLCODE = 0)                               07870099
079800                                                                  07880099
079900           EXEC SQL                                               07890099
080000              CLOSE EXCLCRSR                                      07900099
080100           END-EXEC                                               07910099
080200                                                                  07920099
080300         EVALUATE TRUE                                            07930099
080400             WHEN SQLCODE = 0                                     07940099
080500                  CONTINUE                                        07950099
080600             WHEN SQLWARN0 NOT EQUAL SPACE                        07960099
080700             WHEN SQLCODE NOT EQUAL ZERO                          07970099
080800                  MOVE 'CLOSE CURSOR FOR EXCLUSION EXTRACT'       07980099
080900                                     TO PV-ORA-OPERATION          07990099
081000                  PERFORM 9900-ORA-ERROR                          08000099
081100         END-EVALUATE                                             08010099
081200     END-PERFORM.                                                 08020099
081300                                                                  08030099
081400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08040099
081500        MOVE 'CLOSE EXCLUSION CURSOR RETRIES EXCEEDED'            08050099
081600                              TO  PV-ORA-OPERATION                08060099
081700        PERFORM 9900-ORA-ERROR                                    08070099
081800     END-IF.                                                      08080099
081900                                                                  08090099
082000*7300-EXIT.                                                       08100099
082100******************************************************************08110099
082200*  8000-READ-STR-GRP-FILE.                                       *08120099
082300*    READ STORE GROUP DRIVER FILE.                               *08130099
082400******************************************************************08140099
082500 8000-READ-STR-GRP-FILE.                                          08150099
082600     MOVE '8000-READ-STR-GRP-FILE       ' TO PV-PARAGRAPH-NAME.   08160099
082700                                                                  08170099
082800     READ REFRESH-STORE-CARD-FILE INTO EP250-CC-CONTROL-CARD      08180099
082900       AT END                                                     08190099
083000          SET PS-END-OF-STR-GRP-FILE TO TRUE                      08200099
083100                                                                  08210099
083200       NOT AT END                                                 08220099
083300          ADD 1                    TO PV-STR-GRP-RECS-READ        08230099
083400     END-READ.                                                    08240099
083500                                                                  08250099
083600*8000-EXIT.                                                       08260099
083700******************************************************************08270099
083800*  8100-READ-OFFERS-FILE.                                        *08280099
083900*    READ OFFERS FILE.  THIS FILE DRIVES THE PROCESSING.         *08290099
084000******************************************************************08300099
084100 8100-READ-OFFERS-FILE.                                           08310099
084200     MOVE '8100-READ-OFFERS-FILE        ' TO PV-PARAGRAPH-NAME.   08320099
084300                                                                  08330099
084400     READ OFFERS-FULL-REFRESH-IN-FILE INTO PV205-OFFER-EXTRACT    08340099
084500       AT END                                                     08350099
084600          SET PS-END-OF-OFFERS-FILE TO TRUE                       08360099
084700                                                                  08370099
084800       NOT AT END                                                 08380099
084900          ADD 1                    TO PV-OFFERS-RECS-READ         08390099
085000     END-READ.                                                    08400099
085100                                                                  08410099
085200*8100-EXIT.                                                       08420099
085300******************************************************************08430099
085400*  8200-READ-STR-LIST-FILE.                                      *08440099
085500*    READ STORE LIST FILE.                                       *08450099
085600******************************************************************08460099
085700 8200-READ-STR-LIST-FILE.                                         08470099
085800     MOVE '8200-READ-STR-LIST-FILE      ' TO PV-PARAGRAPH-NAME.   08480099
085900                                                                  08490099
086000     READ REFRESH-STORE-LIST-IN-FILE INTO PV206-STORE-LIST-RCD    08500099
086100       AT END                                                     08510099
086200          SET PS-END-OF-STR-LIST-FILE TO TRUE                     08520099
086300                                                                  08530099
086400       NOT AT END                                                 08540099
086500          ADD 1                    TO PV-STR-LIST-RECS-READ       08550099
086600     END-READ.                                                    08560099
086700                                                                  08570099
086800*8200-EXIT.                                                       08580099
086900******************************************************************08590099
087000* 8300-WRITE-XST-OFR-DATA                                         08600099
087100*     WRITE OFFER DATA RECORD                                     08610099
087200*     ALL RECORD TYPES WILL USE THIS WRITE STATEMENT              08620099
087300******************************************************************08630099
087400 8300-WRITE-XST-OFR-DATA.                                         08640099
087500     MOVE '8300-WRITE-XST-OFR-DATA      ' TO PV-PARAGRAPH-NAME.   08650099
087600                                                                  08660099
087700     MOVE SPACES TO OFFERS-FULL-REFRESH-OUT-RECORD.               08670099
087800                                                                  08680099
087900     WRITE OFFERS-FULL-REFRESH-OUT-RECORD                         08690099
088000      FROM EP205-OFFER-EXTRACT.                                   08700099
088100                                                                  08710099
088200     ADD 1 TO PV-OFFER-RECS-OUT.                                  08720099
088300                                                                  08730099
088400*8300-EXIT.                                                       08740099
088500******************************************************************08750099
088600* 8400-WRITE-STR-LIST-REC                                         08760099
088700*     WRITE STORE LIST RECORD                                     08770099
088800******************************************************************08780099
088900 8400-WRITE-STR-LIST-REC.                                         08790099
089000     MOVE '8400-WRITE-STR-LIST-REC      ' TO PV-PARAGRAPH-NAME.   08800099
089100                                                                  08810099
089200     MOVE SPACES TO REFRESH-STORE-LIST-OUT-RECORD.                08820099
089300                                                                  08830099
089400     WRITE REFRESH-STORE-LIST-OUT-RECORD                          08840099
089500      FROM EP206-STORE-LIST-RCD.                                  08850099
089600                                                                  08860099
089700     ADD 1 TO PV-STR-LIST-RECS-OUT.                               08870099
089800                                                                  08880099
089900*8400-EXIT.                                                       08890099
090000******************************************************************08900099
090100* 9000-WRAPUP.                                                   *08910099
090200*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *08920099
090300******************************************************************08930099
090400 9000-WRAPUP.                                                     08940099
090500     MOVE '9000-WRAPUP                     ' TO PV-PARAGRAPH-NAME.08950099
090600                                                                  08960099
090700     PERFORM 9920-DISPLAY-TOTALS.                                 08970099
090800                                                                  08980099
090900     PERFORM 9990-GET-CURRENT.                                    08990099
091000                                                                  09000099
091100     DISPLAY '****************************************'.          09010099
091200     DISPLAY '**          EPKUT209 END              **'.          09020099
091300     DISPLAY '****************************************'.          09030099
091400     DISPLAY '**     END DATE ' DF-DISPLAY-DATE                   09040099
091500             '            **'.                                    09050099
091600     DISPLAY '**     END TIME ' DF-DISPLAY-TIME                   09060099
091700             '              **'.                                  09070099
091800     DISPLAY '****************************************'.          09080099
091900                                                                  09090099
092000     CLOSE REFRESH-STORE-CARD-FILE                                09100099
092100           OFFERS-FULL-REFRESH-IN-FILE                            09110099
092300           REFRESH-STORE-LIST-IN-FILE                             09130099
092400           OFFERS-FULL-REFRESH-OUT-FILE                           09140099
092500           REFRESH-STORE-LIST-OUT-FILE.                           09150099
092600                                                                  09160099
092700*9000-EXIT.                                                       09170099
092800******************************************************************09180099
092900* 9800-ABEND.                                                    *09190099
093000*     ABEND PROGRAM WHEN A NON-ORACLE ERROR OCCURS.              *09200099
093100******************************************************************09210099
093200 9800-ABEND.                                                      09220099
093300                                                                  09230099
093400     PERFORM 9920-DISPLAY-TOTALS.                                 09240099
093500     PERFORM 9990-GET-CURRENT.                                    09250099
093600                                                                  09260099
093700     DISPLAY '** ABEND           **'.                             09270099
093800     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          09280099
093900     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        09290099
094000     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       09300099
094100     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       09310099
094200     DISPLAY '** TIME            ** = ' DF-DISPLAY-TIME.          09320099
094300                                                                  09330099
094400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         09340099
094500                                                                  09350099
094600*9800-EXIT.                                                       09360099
094700***************************************************************** 09370099
094800*   9900-ORA-ERROR.                                             * 09380099
094900*     ORACLE ABEND ROUTINE.                                     * 09390099
095000***************************************************************** 09400099
095100 9900-ORA-ERROR.                                                  09410099
095200                                                                  09420099
095300     EXEC SQL                                                     09430099
095400        ROLLBACK                                                  09440099
095500     END-EXEC.                                                    09450099
095600                                                                  09460099
095700     PERFORM 9920-DISPLAY-TOTALS.                                 09470099
095800     PERFORM 9990-GET-CURRENT.                                    09480099
095900                                                                  09490099
096000     SET AC-4013-ORACLE-ERROR      TO TRUE.                       09500099
096100     DISPLAY '** ABEND     **'.                                   09510099
096200     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                09520099
096300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              09530099
096400     DISPLAY '** OPERATION ** = ' PV-ORA-OPERATION.               09540099
096500     DISPLAY '** TIME      ** = ' DF-DISPLAY-TIME.                09550099
096600                                                                  09560099
096700     COPY DPPD004.                                                09570099
096800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         09580099
096900                                                                  09590099
097000*9900-EXIT.                                                       09600099
097100******************************************************************09610099
097200*   9920-DISPLAY-TOTALS.                                         *09620099
097300*     DISPLAY END OF JOB TOTALS                                  *09630099
097400******************************************************************09640099
097500 9920-DISPLAY-TOTALS.                                             09650099
097600                                                                  09660099
097700     DISPLAY '****************************************'.          09670099
097800     DISPLAY '**     EOJ STATISTICS FOR EPKUT209    **'           09680099
097900     DISPLAY '****************************************'.          09690099
098000                                                                  09700099
098100     DISPLAY '** STR GRP CNTL RCDS READ ==> '                     09710099
098200             PV-STR-GRP-RECS-READ                                 09720099
098300             ' **'.                                               09730099
098400     DISPLAY '** OFFERS RCDS READ ========> '                     09740099
098500             PV-OFFERS-RECS-READ                                  09750099
098600             ' **'.                                               09760099
098700     DISPLAY '** STORE LIST RCDS READ ====> '                     09770099
098800             PV-STR-LIST-RECS-READ                                09780099
098900             ' **'.                                               09790099
099000     DISPLAY '** OFFERS RCDS DROPPED =====> '                     09800099
099100             PV-OFFERS-RECS-DROPPED                               09810099
099200             ' **'.                                               09820099
099300     DISPLAY '** STR LIST RCDS DROPPED ===> '                     09830099
099400             PV-STR-LIST-RECS-DROPPED                             09840099
099500             ' **'.                                               09850099
099600     DISPLAY '** OFFER RCDS WRITTEN ======> '                     09860099
099700             PV-OFFER-RECS-OUT                                    09870099
099800             ' **'.                                               09880099
099900     DISPLAY '** STR LIST RCDS WRITTEN ===> '                     09890099
100000             PV-STR-LIST-RECS-OUT                                 09900099
100100             ' **'.                                               09910099
100200     DISPLAY '****************************************'.          09920099
100300                                                                  09930099
100400*9920-EXIT.                                                       09940099
100500******************************************************************09950099
100600*  9990-GET-CURRENT.                                             *09960099
100700*     GET CURRENT DATE, TIME AND TIMESTAMP FROM ORA / SYSTEM     *09970099
100800******************************************************************09980099
100900 9990-GET-CURRENT.                                                09990099
101000                                                                  10000099
101100     MOVE FUNCTION CURRENT-DATE(1:16) TO DF-CURRENT-DATE-TIME.    10010099
101200                                                                  10020099
101300     MOVE DF-CURRENT-YR            TO DF-DD-YR.                   10030099
101400     MOVE DF-CURRENT-MO            TO DF-DD-MO.                   10040099
101500     MOVE DF-CURRENT-DY            TO DF-DD-DY.                   10050099
101600     MOVE DF-CURRENT-HR            TO DF-DT-HR.                   10060099
101700     MOVE DF-CURRENT-MIN           TO DF-DT-MIN.                  10070099
101800     MOVE DF-CURRENT-SEC           TO DF-DT-SEC.                  10080099
101900                                                                  10090099
102000*9990-EXIT.                                                       10100099
102100************************  END OF PROGRAM  ************************10110099
