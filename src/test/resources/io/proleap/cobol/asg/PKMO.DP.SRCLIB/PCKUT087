000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             PCKUT087.                                00050000
000600 AUTHOR.                 BRENDA ROCKWELL.                         00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            NOVEMBER, 2009.                          00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM WILL TAKE THE EXTRACTED TRAILER ARRIVAL           *00120000
001300* DATA AND CREATE 2 OUTPUT FILES.                                *00130000
001500*                                                                *00140000
001600* THE FIRST OUTPUT FILE WILL CONTAIN ALL THE PO/RCVRS FOR        *00150000
001700* NON-TRANSCRIBED AND PBS ORDERS AND THEIR CARTON COUNTS.        *00160000
001800*                                                                *00170000
001900* THE SECOND OUTPUT FILE WILL CONTAIN ALL PO/RCVR/LNES/PKS       *00180000
002000* FOR TRANSCRIBED, NON-PBS ORDERS.  THIS FILE WILL THEN BE       *00190000
002100* SENT TO THE NEXT STEP TO DETERMINE CARTON COUNTS.              *00200000
002200*                                                                *00210000
002300* THE INPUT AND OUTPUT FILE LAYOUTS ARE PCRD068.                 *00220000
002500*----------------------------------------------------------------*00230000
W40392***************************************************************** 00240000
W40392*  CHANGE LOG.                                                    00250000
W40392*  DATE         CHANGED BY      DESC                              00260000
W40392*  -----------  -------------- ---------------------------------- 00270000
W40796*  04/03/2012   B. ROCKWELL    ADD SKU NUMBER LOOKUP              00280000
W40796*                              PROJ ID:  3347A                    00310000
W40796*                              WR/IR#:   WR40796                  00320000
W40392*  10/07/2011   S. ANDERSON    EFC OPTIMIZATION AND HOLIDAY PREP  00321000
W40392*               (CODEWORKS)     - ADDITIONAL DATA NEEDED FOR      00322000
W40392*                                 SUMMARY REPORTS                 00323000
W40392*                              PROJ ID:   3253                    00324000
W40392*                              WR/IR#:   WR40392                  00325000
W40392*  WHEN READING THE TRECEIV TABLE ADD CURR_OPER_UNT_ID TO SELECT  00330000
W40392*  AND ADD TO OUTPUT FILE.                                        00340000
W40392***************************************************************** 00350000
002600                                                                  00360000
002700***************************************************************** 00370000
002800 ENVIRONMENT DIVISION.                                            00380000
002900***************************************************************** 00390000
003000 INPUT-OUTPUT SECTION.                                            00400000
003100                                                                  00410000
003200 FILE-CONTROL.                                                    00420000
003300                                                                  00430000
003400     SELECT INPUT-FILE ASSIGN TO INP01.                           00440000
003500                                                                  00450000
003600     SELECT EXTRACT-PBS-FILE     ASSIGN TO OUT01.                 00460000
003700                                                                  00470000
003800     SELECT EXTRACT-NON-PBS-FILE ASSIGN TO OUT02.                 00480000
003900                                                                  00490000
004000***************************************************************** 00500000
004100 DATA DIVISION.                                                   00510000
004200***************************************************************** 00520000
004300 FILE SECTION.                                                    00530000
004400*                                                                 00540000
004500*                                                                 00550000
004600 FD  INPUT-FILE                                                   00560000
004700     RECORDING MODE IS F                                          00570000
004800     LABEL RECORDS ARE STANDARD                                   00580000
004900     BLOCK CONTAINS 0 RECORDS.                                    00590000
005000 01  INPUT-RECORD                PIC X(400).                      00600000
005100                                                                  00610000
005200 FD  EXTRACT-PBS-FILE                                             00620000
005300     RECORDING MODE IS F                                          00630000
005400     LABEL RECORDS ARE STANDARD                                   00640000
005500     BLOCK CONTAINS 0 RECORDS.                                    00650000
005600 01  EXTRACT-PBS-RECORD          PIC X(400).                      00660000
005700                                                                  00670000
005800 FD  EXTRACT-NON-PBS-FILE                                         00680000
005900     RECORDING MODE IS F                                          00690000
006000     LABEL RECORDS ARE STANDARD                                   00700000
006100     BLOCK CONTAINS 0 RECORDS.                                    00710000
006200 01  EXTRACT-NON-PBS-RECORD      PIC X(400).                      00720000
006300*                                                                 00730000
006400*                                                                 00740000
006500***************************************************************** 00750000
006600 WORKING-STORAGE SECTION.                                         00760000
006700                                                                  00770000
006800 01  PS-PROGRAM-SWITCHES.                                         00780000
006900     05  PS-END-OF-INPUT-FILE-SW      PIC X(01)  VALUE 'N'.       00790000
007000         88  PS-END-OF-INPUT-FILE                VALUE 'Y'.       00800000
007100         88  PS-NOT-END-OF-INPUT-FILE            VALUE 'N'.       00810000
007200     05  PS-EOF-PO-RCVR-CSR-SW        PIC X(01)  VALUE 'N'.       00820000
007300         88  PS-EOF-PO-RCVR-CSR                  VALUE 'Y'.       00830000
007400         88  PS-NOT-EOF-PO-RCVR-CSR              VALUE 'N'.       00840000
007500     05  PS-EOF-TPURITM-CSR-SW        PIC X(01)  VALUE 'N'.       00850000
007600         88  PS-EOF-TPURITM-CSR                  VALUE 'Y'.       00860000
007700         88  PS-NOT-EOF-TPURITM-CSR              VALUE 'N'.       00870000
007800     05  PS-EOF-TRECITM-CSR-SW        PIC X(01)  VALUE 'N'.       00880000
007900         88  PS-EOF-TRECITM-CSR                  VALUE 'Y'.       00890000
008000         88  PS-NOT-EOF-TRECITM-CSR              VALUE 'N'.       00900000
008100                                                                  00910000
008200     05  PS-JEWELRY-SW                PIC X(01)  VALUE 'N'.       00920000
008300         88  PS-JEWELRY-YES                      VALUE 'Y'.       00930000
008400         88  PS-JEWELRY-NO                       VALUE 'N'.       00940000
008500                                                                  00950000
008600     05  PS-TRANSCRIBED-SW            PIC X(01)  VALUE 'N'.       00960000
008700         88  PS-TRANSCRIBED-YES                  VALUE 'Y'.       00970000
008800         88  PS-TRANSCRIBED-NO                   VALUE 'N'.       00980000
008900                                                                  00990000
009000     05  PS-TRECEIV-SW                PIC X(01)  VALUE 'N'.       01000000
009100         88  PS-TRECEIV-FOUND-YES                VALUE 'Y'.       01010000
009200         88  PS-TRECEIV-FOUND-NO                 VALUE 'N'.       01020000
W40392     05  PS-EFC-FREIGHT               PIC X(01)  VALUE 'N'.       01021000
W40392         88  PS-EFC-FREIGHT-YES                  VALUE 'Y'.       01022000
W40392         88  PS-EFC-FREIGHT-NO                   VALUE 'N'.       01023000
009300                                                                  01030000
009400 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       01040000
009500                                                 COMP SYNC.       01050000
009600     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     01060000
009700                                                                  01070000
009800 01  PV-PROGRAM-VARIABLES.                                        01080000
009900     05  PV-ATTR-DEPT                 PIC  S9(10)V9(5) COMP-3.    01090000
010000     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       01100000
010100                                                  COMP SYNC.      01110000
010200     05  PV-WRITE-PBS-EXTR-COUNT      PIC S9(09) VALUE ZERO       01120000
010300                                                  COMP SYNC.      01130000
010400     05  PV-WRITE-NON-PBS-EXTR-COUNT  PIC S9(09) VALUE ZERO       01140000
010500                                                  COMP SYNC.      01150000
010600                                                                  01160000
010700     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            01170000
010800     05  PV-DISPLAY-WRITE-PBS-CNT     PIC ZZZ,ZZZ,ZZ9.            01180000
010900     05  PV-DISPLAY-WRITE-NON-PBS-CNT PIC ZZZ,ZZZ,ZZ9.            01190000
011000                                                                  01200000
011100     05  PV-DISPLAY-TRIP-ID           PIC Z(8)9-.                 01210000
011200     05  PV-DISPLAY-PO-NBR            PIC Z(8)9-.                 01220000
011300     05  PV-DISPLAY-PO-LNE-NBR        PIC Z(8)9-.                 01230000
011400     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC 9999-.                  01240000
011500                                                                  01250000
011600     05  PV-DB2-COUNT                 PIC S9(9) VALUE +0          01260000
011700                                                COMP-3.           01270000
W40392     05  PV-DB2-VERIFY-ITM-QTY        PIC S9(9) VALUE +0          01280000
W40392                                                COMP-3.           01290000
W40392     05  PV-DB2-AP-VERIFY-ITM-QTY     PIC S9(9) VALUE +0          01300000
W40392                                                COMP-3.           01310000
011800     05  PV-DB2-TRECITM-COUNT         PIC S9(9) VALUE +0          01320000
011900                                                COMP-3.           01330000
012000     05  PV-HANG-DIFF-COUNT           PIC S9(9) VALUE +0          01340000
012100                                                COMP-3.           01350000
012200                                                                  01360000
012300     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACES.    01370000
012400     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACES.    01380000
012500     05  PV-DB2-TABLE-NAME1           PIC X(15)  VALUE SPACES.    01390000
012600     05  PV-DB2-TABLE-NAME2           PIC X(15)  VALUE SPACES.    01400000
012700     05  PV-DB2-TABLE-NAME3           PIC X(15)  VALUE SPACES.    01410000
012800                                                                  01420000
012900     05  PV-JEWELRY-DEPT              PIC 9(03).                  01430000
013000                                                                  01440000
013100     05  PV-VENDOR-HANG               PIC  X(01).                 01450000
013200                                                                  01460000
013300     05  PV-KOHLS-HANG                PIC  X(01).                 01470000
W40796                                                                  01480000
W40796     05  PV-SKU-NUMBER                PIC  X(08).                 01481000
013400                                                                  01482000
013600 01  PV-SAVE-FIELDS.                                              01490000
013700     05  PV-SAVE-TRIP-ID             PIC  S9(9) COMP.             01500000
013800                                                                  01510000
013900 01  DK-DB-KEYS.                                                  01520000
014000     05  DK-TRIP-ID                  PIC  S9(9) COMP.             01530000
014100     05  DK-PO-NBR                   PIC  S9(9) COMP.             01540000
014200     05  DK-REC-SEQ-NBR              PIC  S9(9) COMP.             01550000
W40392     05  DK-REC-ORD-LNE-NBR          PIC  S9(9) COMP.             01560000
014300     05  DK-DEPT-NBR                 PIC   X(03).                 01570000
014400     05  DK-SUB-CL-NBR               PIC   X(03).                 01580000
014500     05  DK-AGRMT-TYP-ID             PIC   X(01).                 01590000
014600     05  DK-TYP-CDE                  PIC  S9(4) COMP.             01600000
014600     05  DK-EFC-NBR                  PIC  S9(4) COMP.             01601000
014700     05  DK-ITEM-NBR                 PIC  S9(15)V COMP-3.         01610000
014800     05  DK-CHARTC-SEQ-NBR           PIC   X(01).                 01620000
014900     05  DK-CONV-HANG-DESC           PIC   X(01).                 01630000
015000                                                                  01640000
016500 01 PC-PROGRAM-CONSTANTS.                                         01650000
016600     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT087'. 01660000
016700                                                                  01670000
016800 01  PV-ABEND-FIELDS.                                             01680000
016900     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01690000
017000                                                 COMP SYNC.       01700000
017100     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUT087'.01710000
017200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01720000
017300     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01730000
017400     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01740000
017500     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01750000
017600     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01760000
017700     05  PV-SQL-RETURN-CD             PIC  999-.                  01770000
017800     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01780000
017900     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01790000
018000     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01800000
018100     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01810000
018200                                                                  01820000
018300     05  PV-MAJ-CL-NBR                PIC   X(04).                01830000
018400                                                                  01840000
018500******************************************************************01850000
018600*  USED FOR DB2 ERROR MESSAGE BUILDING                            01860000
018700******************************************************************01870000
018800     COPY DPWS004.                                                01880000
018900                                                                  01890000
019000*----------------------------------------------------------------*01900000
019100*    ABEND PROCESSING COPYBOOK.                                  *01910000
019200*----------------------------------------------------------------*01920000
019300                                                                  01930000
019400     COPY DPWS013.                                                01940000
019500******************************************************************01950000
019600*   DB2 SQL COMMUNICATION AREA                                    01960000
019700******************************************************************01970000
019800     EXEC SQL                                                     01980000
019900          INCLUDE SQLCA                                           01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200*DB2 AREA FOR COMMUNICATIONS AREA2                                02020000
020300     COPY SQLCA2.                                                 02030000
020400                                                                  02040000
020500******************************************************************02050000
020600*   DB2 DCLGEN FOR TPURCHS - PO-PURCHASE TABLE                    02060000
020700******************************************************************02070000
020800     EXEC SQL                                                     02080000
020900          INCLUDE TPURCHS                                         02090000
021000     END-EXEC.                                                    02100000
021100                                                                  02110000
W40392* JAK START                                                       02110100
W40796******************************************************************02111000
W40796*   DB2 DCLGEN FOR XLT_SKU TABLE                                  02112000
W40796******************************************************************02113000
W40796     EXEC SQL                                                     02114000
W40796          INCLUDE XLT00003                                        02115000
W40796     END-EXEC.                                                    02116000
020500******************************************************************02116100
020600*   DB2 DCLGEN FOR XLT_LOC - LOCATION TABLE                       02116200
020700******************************************************************02116300
020800     EXEC SQL                                                     02116400
020900          INCLUDE XLT00010                                        02116500
021000     END-EXEC.                                                    02116600
W40392* JAK END                                                         02116700
021100                                                                  02117000
021200******************************************************************02120000
021300*   DB2 DCLGEN FOR TRECEIV - RC-RECEIVER TABLE                    02130000
021400******************************************************************02140000
021500     EXEC SQL                                                     02150000
021600          INCLUDE TRECEIV                                         02160000
021700     END-EXEC.                                                    02170000
021800                                                                  02180000
021900******************************************************************02190000
022000*   DB2 DCLGEN FOR TSHIPMT - TR-SHIPMENT TABLE                    02200000
022100******************************************************************02210000
022200     EXEC SQL                                                     02220000
022300          INCLUDE TSHIPMT                                         02230000
022400     END-EXEC.                                                    02240000
022500                                                                  02250000
022600******************************************************************02260000
022700*   DB2 DCLGEN FOR TSHPTPO - TR-SHIPMENT - PO ASSOCIATION TABLE   02270000
022800******************************************************************02280000
022900     EXEC SQL                                                     02290000
023000          INCLUDE TSHPTPO                                         02300000
023100     END-EXEC.                                                    02310000
023200                                                                  02320000
024000******************************************************************02400000
024100*   DB2 DCLGEN FOR XLT_SKU - LOGISTICS-SKU TABLE                  02410000
024200******************************************************************02420000
024300*    EXEC SQL                                                     02430000
024400*         INCLUDE XLT00003                                        02440000
024500*    END-EXEC.                                                    02450000
024600                                                                  02460000
024700******************************************************************02470000
024800*   DB2 DCLGEN FOR XLT_VND_STYL - LOGISTICS-VENDOR STYLE TABLE    02480000
024900******************************************************************02490000
025000*    EXEC SQL                                                     02500000
025100*         INCLUDE XLT00004                                        02510000
025200*    END-EXEC.                                                    02520000
025300                                                                  02530000
025400******************************************************************02540000
025500*   DCLGEN LAYOUT FOR TPURITM - PO-PURCHASE ITEM TABLE            02550000
025600******************************************************************02560000
025700     EXEC SQL                                                     02570000
025800          INCLUDE TPURITM                                         02580000
025900     END-EXEC.                                                    02590000
026000                                                                  02600000
026100******************************************************************02610000
026200*   DCLGEN LAYOUT FOR TRECITM - RC-RECEIPT ITEM TABLE             02620000
026300******************************************************************02630000
026400     EXEC SQL                                                     02640000
026500          INCLUDE TRECITM                                         02650000
026600     END-EXEC.                                                    02660000
026700                                                                  02670000
026100******************************************************************02680000
026200*   DCLGEN LAYOUT FOR TRECDIS - RC-RECEIPT ITEM TABLE             02690000
026300******************************************************************02700000
026400     EXEC SQL                                                     02710000
026500          INCLUDE TRECDIS                                         02720000
026600     END-EXEC.                                                    02730000
026700                                                                  02740000
026800******************************************************************02750000
026900*   DCLGEN LAYOUT FOR TPOAGMT - PO-PURCHASE AGREEMENT TABLE       02760000
027000******************************************************************02770000
027100*    EXEC SQL                                                     02780000
027200*         INCLUDE TPOAGMT                                         02790000
027300*    END-EXEC.                                                    02800000
027400                                                                  02810000
029900******************************************************************03060000
030000*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 03070000
030100******************************************************************03080000
030200*    EXEC SQL                                                     03090000
030300*         INCLUDE WST00008                                        03100000
030400*    END-EXEC.                                                    03110000
030500******************************************************************03120000
030600*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   03130000
030700******************************************************************03140000
030800*    EXEC SQL                                                     03150000
030900*         INCLUDE WST00009                                        03160000
031000*    END-EXEC.                                                    03170000
031100******************************************************************03180000
031200*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   03190000
031300******************************************************************03200000
031400*    EXEC SQL                                                     03210000
031500*         INCLUDE WST00010                                        03220000
031600*    END-EXEC.                                                    03230000
031800                                                                  03240000
031900******************************************************************03250000
032000* PO/RCVR CURSOR                                                  03260000
032100******************************************************************03270000
032200     EXEC SQL                                                     03280000
032300          DECLARE PO-RCVR-CSR CURSOR FOR                          03290000
032400      SELECT                                                      03300000
032500            B.PO_NBR                                              03310000
032600          , B.REC_SEQ_NBR                                         03320000
032700          , A.EXPTED_PKG_QTY                                      03330000
032800      FROM TSHIPMT A                                              03340000
032900          ,TSHPTPO B                                              03350000
033000     WHERE A.TRIP_ID        = :DK-TRIP-ID                         03360000
033100       AND A.SHIPT_ID       = B.SHIPT_ID                          03370000
033200       AND B.REC_SEQ_NBR    > 0                                   03380000
033300     WITH UR                                                      03390000
033400     END-EXEC.                                                    03400000
033500                                                                  03410000
033600                                                                  03420000
033700******************************************************************03430000
033800* TPURITM CURSOR                                                  03440000
033900******************************************************************03450000
034000     EXEC SQL                                                     03460000
034100          DECLARE TPURITM-CSR CURSOR FOR                          03470000
034200           SELECT PO_LNE_NBR                                      03480000
034300                , ITM_NBR                                         03490000
034400                , PO_PREPK_ID                                     03500000
W40796                , RMS_PO_SKU_NBR                                  03501000
034500           FROM   TPURITM                                         03510000
034600           WHERE  PO_NBR         = :DK-PO-NBR                     03520000
034700             AND  VER_STATUS_CDE = 'A'                            03530000
034800           ORDER BY ITM_NBR                                       03540000
034900     WITH UR                                                      03550000
035000     END-EXEC.                                                    03560000
035100                                                                  03570000
035200******************************************************************03580000
035300* TRECITM CURSOR                                                  03590000
035400******************************************************************03600000
035500     EXEC SQL                                                     03610000
035600          DECLARE TRECITM-CSR CURSOR FOR                          03620000
035700           SELECT ORD_LNE_NBR                                     03630000
W40796                , B.ITM_NBR                                       03640000
035900                , PREPK_ID                                        03650000
036000                , PREPK_DRV_LNE_CDE                               03660000
W40392                , STATUS_CDE                                      03670000
W40392                , PKSL_ITM_QTY                                    03680000
W40392                , DTL_CK_ITM_QTY                                  03690000
W40796                , SKU_NBR                                         03691000
W40796           FROM   TRECITM A                                       03700000
W40796                , XLT_SKU B                                       03701000
036200           WHERE  ORD_NBR        = :DK-PO-NBR                     03710000
036300             AND  REC_SEQ_NBR    = :DK-REC-SEQ-NBR                03720000
036400             AND  VER_STATUS_CDE = 'A'                            03730000
W40796             AND  A.ITM_NBR      = B.ITM_NBR                      03731000
036500           ORDER BY ORD_LNE_NBR                                   03740000
036600     WITH UR                                                      03750000
036700     END-EXEC.                                                    03760000
036800                                                                  03770000
037700***********************************************************       03780000
037800*  RECORD LAYOUT FOR AN EXTRACT FILE CONTAINING THE               03790000
037900*  PO/RCVR/LINE INFORMATION FOR A TRAILER TO CREATE               03800000
038000*  PLANNING RECORDS BASED ON A TRAILER ARRIVAL.                   03810000
038100***********************************************************       03820000
038200*OUTPUT FILE LAYOUT                                               03830000
038300     COPY PCRD068.                                                03840000
038400                                                                  03850000
038600 EJECT                                                            03860000
038700                                                                  03870000
038800***********************************************************       03880000
038900 PROCEDURE DIVISION.                                              03890000
039000***********************************************************       03900000
039100     DISPLAY '***BEGINNING PCKUT087***'.                          03910000
039200                                                                  03920000
039300     PERFORM 1000-INITIALIZE.                                     03930000
039400                                                                  03940000
039500     PERFORM 2000-PROCESS-EXTRACTS                                03950000
039600         UNTIL PS-END-OF-INPUT-FILE.                              03960000
039700                                                                  03970000
039800     PERFORM 9000-CLOSE-FILES.                                    03980000
039900                                                                  03990000
040000     GOBACK.                                                      04000000
040100                                                                  04010000
040200                                                                  04020000
040300******************************************************************04030000
040400*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        04040000
040500 1000-INITIALIZE.                                                 04050000
040600******************************************************************04060000
040700     OPEN INPUT  INPUT-FILE                                       04070000
040800          OUTPUT EXTRACT-PBS-FILE                                 04080000
040900                 EXTRACT-NON-PBS-FILE.                            04090000
041000                                                                  04100000
041100     INITIALIZE PC068-RECORD-LAYOUT.                              04110000
041200                                                                  04120000
041300*FIRST READ                                                       04130000
041400     PERFORM 7000-READ-INPUT-FILE.                                04140000
041500                                                                  04150000
041600     IF PS-END-OF-INPUT-FILE                                      04160000
041700         DISPLAY '** FILE IS EMPTY **'                            04170000
041800     ELSE                                                         04180000
041900         MOVE PC068-TRIP-ID TO PV-SAVE-TRIP-ID                    04190000
042000     END-IF.                                                      04200000
042200                                                                  04210000
042300***************************************************************** 04220000
042400 2000-PROCESS-EXTRACTS.                                           04230000
042500***************************************************************** 04240000
042600     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       04250000
042700                                                                  04260000
042800        IF PC068-TRIP-ID = PV-SAVE-TRIP-ID                        04270000
042900           PERFORM 2010-PROCESS-TRIP-ID                           04280000
043000        ELSE                                                      04290000
043100           CONTINUE                                               04300000
043200        END-IF                                                    04310000
043300                                                                  04320000
043310        INITIALIZE PC068-RECORD-LAYOUT.                           04330000
043320                                                                  04340000
043400        PERFORM 7000-READ-INPUT-FILE.                             04350000
043500        MOVE PC068-TRIP-ID TO PV-SAVE-TRIP-ID.                    04360000
043600                                                                  04370000
043800***************************************************************** 04380000
043900 2010-PROCESS-TRIP-ID.                                            04390000
044000***************************************************************** 04400000
044100     MOVE '2010-PROCESS-TRIP-ID    ' TO PV-ABEND-PARAGRAPH.       04410000
044200                                                                  04420000
044300     MOVE PC068-TRIP-ID TO DK-TRIP-ID.                            04430000
044400                                                                  04440000
044700     PERFORM 2110-OPEN-PO-RCVR-CSR                                04450000
044800     PERFORM 2120-FETCH-PO-RCVR-CSR                               04460000
044900                                                                  04470000
045000     IF SQLCODE = +100                                            04480000
045100        CONTINUE                                                  04490000
045200     ELSE                                                         04500000
045300        PERFORM 2125-PROCESS-PO-RCVR-CSR                          04510000
045400           UNTIL PS-EOF-PO-RCVR-CSR                               04520000
045500     END-IF                                                       04530000
045600                                                                  04540000
045700     PERFORM 2130-CLOSE-PO-RCVR-CSR                               04550000
045800     SET PS-NOT-EOF-PO-RCVR-CSR TO TRUE.                          04560000
045900                                                                  04570000
049800***************************************************************** 04580000
049900 2110-OPEN-PO-RCVR-CSR.                                           04590000
050000***************************************************************** 04600000
050100     MOVE '2110-OPEN-PO-RCVR-CSR' TO PV-ABEND-PARAGRAPH.          04610000
050200                                                                  04620000
050300     EXEC SQL                                                     04630000
050400         OPEN PO-RCVR-CSR                                         04640000
050500     END-EXEC.                                                    04650000
050600                                                                  04660000
050700     EVALUATE TRUE                                                04670000
050800         WHEN SQLCODE = +0                                        04680000
050900             CONTINUE                                             04690000
051000         WHEN SQLWARN0 NOT = SPACE                                04700000
051100         WHEN SQLCODE  NOT = +0                                   04710000
051200             MOVE '2110-OPEN-PO-RCVR-CSR'                         04720000
051300                                 TO PV-ABEND-PARAGRAPH            04730000
051400             MOVE 'OPEN CURSOR '                                  04740000
051500                                 TO PV-ABEND-OPERATION            04750000
051600             MOVE 'TSHIPMT  '                                     04760000
051700                                 TO PV-DB2-TABLE-NAME1            04770000
051800             MOVE 'TSHPTPO  '                                     04780000
051900                                 TO PV-DB2-TABLE-NAME2            04790000
052000             MOVE DK-TRIP-ID     TO PV-DISPLAY-TRIP-ID            04800000
052100             PERFORM Z999-SQL-ABEND                               04810000
052200     END-EVALUATE.                                                04820000
052300                                                                  04830000
052400***************************************************************** 04840000
052500 2120-FETCH-PO-RCVR-CSR.                                          04850000
052600***************************************************************** 04860000
052700     MOVE '2120-FETCH-PO-RCVR-CSR' TO PV-ABEND-PARAGRAPH.         04870000
052800                                                                  04880000
052900     EXEC SQL                                                     04890000
053000          FETCH PO-RCVR-CSR                                       04900000
053100           INTO  :SHPTPO-PO-NBR                                   04910000
053200               , :SHPTPO-REC-SEQ-NBR                              04920000
053300               , :SHIPMT-EXPTED-PKG-QTY                           04930000
053400     END-EXEC.                                                    04940000
053500                                                                  04950000
053600     EVALUATE TRUE                                                04960000
053700         WHEN SQLCODE = +0                                        04970000
053800              MOVE SHPTPO-PO-NBR      TO DK-PO-NBR                04980000
053900                                         PV-DISPLAY-PO-NBR        04990000
054000              MOVE SHPTPO-REC-SEQ-NBR TO DK-REC-SEQ-NBR           05000000
054100                                      PV-DISPLAY-RCVR-SEQ-NBR     05010000
054200                                                                  05020000
054600         WHEN SQLCODE = +100                                      05030000
054700              SET PS-EOF-PO-RCVR-CSR TO TRUE                      05040000
054800         WHEN SQLWARN0 NOT = SPACE                                05050000
054900         WHEN SQLCODE  NOT = +0                                   05060000
055000              MOVE '2120-FETCH-PO-RCVR-CSR'                       05070000
055100                                   TO PV-ABEND-PARAGRAPH          05080000
055200              MOVE 'ATTEMPTING TO FETCH CURSOR '                  05090000
055300                                   TO PV-ABEND-OPERATION          05100000
055400              MOVE 'TSHIPMT '                                     05110000
055500                                   TO PV-DB2-TABLE-NAME1          05120000
055600              MOVE 'TSHPTPO '                                     05130000
055700                                   TO PV-DB2-TABLE-NAME2          05140000
055800                                                                  05150000
055900              MOVE DK-TRIP-ID            TO                       05160000
056000                                PV-DISPLAY-TRIP-ID                05170000
056100              PERFORM Z999-SQL-ABEND                              05180000
056200     END-EVALUATE.                                                05190000
056300                                                                  05200000
056400***************************************************************** 05210000
056500 2125-PROCESS-PO-RCVR-CSR.                                        05220000
056600***************************************************************** 05230000
056700     MOVE '2125-PROCESS-PO-RCVR-CSR' TO PV-ABEND-PARAGRAPH.       05240000
056800                                                                  05250000
056900     IF SHPTPO-REC-SEQ-NBR = 0                                    05260000
057000        PERFORM 3000-PROCESS-ZERO-RECEIVER                        05270000
057100     END-IF                                                       05280000
057200                                                                  05290000
057300     IF SHPTPO-REC-SEQ-NBR > 0                                    05300000
057400        PERFORM 4000-PROCESS-RECEIVER                             05310000
057500     END-IF.                                                      05320000
057600                                                                  05330000
057700     PERFORM 2120-FETCH-PO-RCVR-CSR.                              05340000
057800                                                                  05350000
057900***************************************************************** 05360000
058000 2130-CLOSE-PO-RCVR-CSR.                                          05370000
058100***************************************************************** 05380000
058200     MOVE '2130-CLOSE-PO-RCVR-CSR' TO PV-ABEND-PARAGRAPH.         05390000
058300                                                                  05400000
058400     EXEC SQL                                                     05410000
058500         CLOSE PO-RCVR-CSR                                        05420000
058600     END-EXEC                                                     05430000
058700                                                                  05440000
058800     EVALUATE TRUE                                                05450000
058900         WHEN SQLCODE = ZERO                                      05460000
059000             CONTINUE                                             05470000
059100         WHEN OTHER                                               05480000
059200             MOVE '2130-CLOSE-PO-RCVR-CSR'                        05490000
059300                                 TO PV-ABEND-PARAGRAPH            05500000
059400             MOVE 'CLOSE CURSOR '                                 05510000
059500                                 TO PV-ABEND-OPERATION            05520000
059600             MOVE 'TSHIPMT '                                      05530000
059700                                 TO PV-DB2-TABLE-NAME1            05540000
059800             MOVE 'TSHPTPO '                                      05550000
059900                                 TO PV-DB2-TABLE-NAME2            05560000
060000             PERFORM Z999-SQL-ABEND                               05570000
060100     END-EVALUATE.                                                05580000
060200                                                                  05590000
060300***************************************************************** 05600000
060400 2200-SELECT-TPURCHS.                                             05610000
060500* IF RECEIVER = 0                                                 05620000
060600***************************************************************** 05630000
060700     MOVE '2200-SELECT-TPURCHS   ' TO PV-ABEND-PARAGRAPH.         05640000
060800                                                                  05650000
060900     EXEC SQL                                                     05660000
061000        SELECT PKGNG_CDE                                          05670000
061100             , PO_TYP_CDE                                         05680000
061200             , ENT_ID                                             05690000
061300             , DEPT_NBR                                           05700000
061400          INTO   :PURCHS-PKGNG-CDE                                05710000
061500             ,   :PURCHS-PO-TYP-CDE                               05720000
061600             ,   :PURCHS-ENT-ID                                   05730000
061700             ,   :PURCHS-DEPT-NBR                                 05740000
061800          FROM TPURCHS                                            05750000
061900         WHERE PO_NBR = :DK-PO-NBR                                05760000
062000           AND VER_STATUS_CDE = 'A'                               05770000
062100     WITH UR                                                      05780000
062200     END-EXEC.                                                    05790000
062300                                                                  05800000
062400     EVALUATE TRUE                                                05810000
062500         WHEN SQLCODE = +0                                        05820000
062600*             PERFORM 2400-CHECK-FOR-JWL-DEPT                     05830000
062700         WHEN SQLWARN0 NOT = SPACE                                05840000
062800         WHEN SQLCODE  NOT = +0                                   05850000
062900              MOVE '2200-SELECT-TPURCHS'                          05860000
063000                                   TO PV-ABEND-PARAGRAPH          05870000
063100              MOVE 'ATTEMPTING TO SELECT TPURCHS '                05880000
063200                                   TO PV-ABEND-OPERATION          05890000
063300              MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          05900000
063400              MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           05910000
063500              PERFORM Z999-SQL-ABEND                              05920000
063600     END-EVALUATE.                                                05930000
063700                                                                  05940000
063800***************************************************************** 05950000
063900 2300-SELECT-TRECEIV.                                             05960000
064000* IF RECEIVER > 0                                                 05970000
064100***************************************************************** 05980000
064200     MOVE '2300-SELECT-TRECEIV   ' TO PV-ABEND-PARAGRAPH.         05990000
064300                                                                  06000000
064400     EXEC SQL                                                     06010000
064500       SELECT A.PKGNG_CDE                                         06020000
064600            , A.PO_TYP_CDE                                        06030000
064700            , A.ENT_ID                                            06040000
064800            , A.DEPT_NBR                                          06050000
064900            , B.PACK_BY_ST_IND                                    06060000
065000            , B.PKGNG_CDE                                         06070000
065100            , B.OPER_UNT_ID                                       06080000
065200            , B.EXPTED_CART_CNT                                   06090000
W40392            , B.CURR_OPER_UNT_ID                                  06100000
W40392            , B.OPER_UNT_ID                                       06101000
065300         INTO :PURCHS-PKGNG-CDE                                   06110000
065400            , :PURCHS-PO-TYP-CDE                                  06120000
065500            , :PURCHS-ENT-ID                                      06130000
065600            , :PURCHS-DEPT-NBR                                    06140000
065700            , :RECEIV-PACK-BY-ST-IND                              06150000
065800            , :RECEIV-PKGNG-CDE                                   06160000
065900            , :RECEIV-OPER-UNT-ID                                 06170000
066000            , :RECEIV-EXPTED-CART-CNT                             06180000
W40392            , :RECEIV-CURR-OPER-UNT-ID                            06190000
W40392            , :RECEIV-OPER-UNT-ID                                 06191000
066100         FROM TPURCHS A                                           06200000
066200            , TRECEIV B                                           06210000
066300        WHERE A.PO_NBR      = B.ORD_NBR                           06220000
066400          AND A.VER_NBR     = B.PO_VER_NBR                        06230000
066500          AND B.ORD_NBR     = :DK-PO-NBR                          06240000
066600          AND B.REC_SEQ_NBR = :DK-REC-SEQ-NBR                     06250000
066700          AND B.VER_STATUS_CDE = 'A'                              06260000
066710          AND B.STATUS_CDE  IN ('IP', 'CM')                       06270000
066800     WITH UR                                                      06280000
066900     END-EXEC.                                                    06290000
067000                                                                  06300000
067100     EVALUATE TRUE                                                06310000
067200         WHEN SQLCODE = +0                                        06320000
067300              SET PS-TRECEIV-FOUND-YES TO TRUE                    06330000
W40392              IF RECEIV-CURR-OPER-UNT-ID NOT =                    06331000
W40392                                RECEIV-OPER-UNT-ID                06331100
W40392                  SET PS-EFC-FREIGHT-YES TO TRUE                  06332000
W40392              END-IF                                              06332100
067400*             PERFORM 2400-CHECK-FOR-JWL-DEPT                     06340000
067500         WHEN SQLCODE = +100                                      06350000
067600              SET PS-TRECEIV-FOUND-NO TO TRUE                     06360000
067700         WHEN SQLWARN0 NOT = SPACE                                06370000
067800         WHEN SQLCODE  NOT = +0                                   06380000
067900              MOVE '2300-SELECT-TRECEIV'                          06390000
068000                                   TO PV-ABEND-PARAGRAPH          06400000
068100              MOVE 'ATTEMPTING TO SELECT TRECEIV '                06410000
068200                                   TO PV-ABEND-OPERATION          06420000
068300              MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          06430000
068400              MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           06440000
068500              MOVE DK-REC-SEQ-NBR  TO PV-DISPLAY-RCVR-SEQ-NBR     06450000
068600              PERFORM Z999-SQL-ABEND                              06460000
068700     END-EVALUATE.                                                06470000
068800                                                                  06480000
068900***************************************************************** 06490000
069000*2400-CHECK-FOR-JWL-DEPT.                                         06500000
069100***************************************************************** 06510000
069200*    MOVE '2400-CHECK-FOR-JWL-DEPT'  TO PV-ABEND-PARAGRAPH.       06520000
069300*                                                                 06530000
069400*    SET PS-JEWELRY-NO          TO  TRUE.                         06540000
069500*    MOVE  PURCHS-DEPT-NBR      TO  PV-ATTR-DEPT.                 06550000
069600*                                                                 06560000
069700*    EXEC SQL                                                     06570000
069800*         SELECT C.INTGRTN_TYP_CDE                                06580000
069900*           INTO :WST00010-INTGRTN-TYP-CDE                        06590000
070000*           FROM WST_INTGRTN_TYP A                                06600000
070100*              , WST_ATTR_DEFN   B                                06610000
070200*              , WST_ATTR_ELEM   C                                06620000
070300*          WHERE A.INTGRTN_TYP_CDE    =  'JEWLRYDEPT'             06630000
070400*            AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE        06640000
070500*            AND B.ATTR_DEFN_SEQ_NBR  =  1                        06650000
070600*            AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE        06660000
070700*            AND C.ATTR_DEFN_SEQ_NBR  =  1                        06670000
070800*            AND C.ATTR_ELEM_NBR      =  :PV-ATTR-DEPT            06680000
070900*    END-EXEC.                                                    06690000
071000*                                                                 06700000
071100*    EVALUATE TRUE                                                06710000
071200*        WHEN SQLCODE = +0                                        06720000
071300*             SET PS-JEWELRY-YES         TO  TRUE                 06730000
071400*        WHEN SQLCODE = +100                                      06740000
071500*            CONTINUE                                             06750000
071600*        WHEN SQLWARN0 NOT = SPACE                                06760000
071700*        WHEN SQLCODE  NOT = +0                                   06770000
071800*             MOVE 'CHECK JEWLERY'   TO PV-DB2-FUNCTION           06780000
071900*             MOVE 'WST_INTGRTN_TYP' TO PV-DB2-TABLE-NAME1        06790000
072000*             MOVE 'WST_ATTR_DEFN'   TO PV-DB2-TABLE-NAME2        06800000
072100*             MOVE 'WST_ATTR_ELEM'   TO PV-DB2-TABLE-NAME3        06810000
072200*            PERFORM Z999-SQL-ABEND                               06820000
072300*    END-EVALUATE.                                                06830000
072500*                                                                 06840000
072600***************************************************************** 06850000
072700*                                                                 06860000
072800* IF IT'S A PBS ORDER -  IT WOULD NOT GO TO HANG                  06870000
072900*                                                                 06880000
073000* IF THERE IS A PO/VND AGREEMENT THAT THE VENDOR WOULD HANG THEN  06890000
073100* IT WOULD NOT GO TO HANG                                         06900000
073200*                                                                 06910000
073300* IF THERE ISN'T A PO/VND AGREEMENT THEN WE WOULD CHECK THE ITEM  06920000
073400* TO SEE IF THE PRESENTATION CODE SAYS HANG.   IF IT DOES, THEN   06930000
073500* IT WOULD GO TO HANG                                             06940000
073600*                                                                 06950000
073700*                                                                 06960000
073800***************************************************************** 06970000
073900*2500-GET-HANG-FOLD-IND.                                          06980000
074000*    MOVE '2500-GET-HANG-FOLD-IND  ' TO PV-ABEND-PARAGRAPH.       06990000
074100*                                                                 07000000
074200*    INITIALIZE PV-KOHLS-HANG                                     07010000
074300*                                                                 07020000
074400*    MOVE 4 TO DK-AGRMT-TYP-ID                                    07030000
074500*    MOVE 2 TO DK-TYP-CDE                                         07040000
074600*                                                                 07050000
074700*    INITIALIZE PV-DB2-COUNT                                      07060000
074800*                                                                 07070000
074900*    PERFORM 2510-CHECK-PO-SERVICE-INFO.                          07080000
075000*                                                                 07090000
075100*    IF PV-DB2-COUNT > 0                                          07100000
075200*       MOVE 'Y' TO PV-VENDOR-HANG                                07110000
075300*    ELSE                                                         07120000
075400*       MOVE 'N' TO PV-VENDOR-HANG                                07130000
075500*    END-IF                                                       07140000
075600*                                                                 07150000
075700*    EVALUATE TRUE                                                07160000
075800*       WHEN PV-VENDOR-HANG = 'Y'                                 07170000
075900*          MOVE 'N' TO PV-KOHLS-HANG                              07180000
076000*       WHEN PV-VENDOR-HANG = 'N'                                 07190000
076100*          IF RECEIV-PACK-BY-ST-IND = 'Y' OR PS-TRANSCRIBED-NO    07200000
076200*             MOVE 'N' TO PV-KOHLS-HANG                           07210000
076300*          ELSE                                                   07220000
076400*             PERFORM 2520-GET-HANG-FOLD-INFO                     07230000
076500*             MOVE PURCHS-DEPT-NBR              TO DK-DEPT-NBR    07240000
076600*             MOVE XLT00004-SUB-CL-NBR          TO DK-SUB-CL-NBR  07250000
076700*          END-IF                                                 07260000
076800*    END-EVALUATE.                                                07270000
076900*                                                                 07280000
077000***************************************************************** 07290000
077100*2510-CHECK-PO-SERVICE-INFO.                                      07300000
077200* CHECK TO SEE IF HANG-FOLD AGREEMENT WITH VENDOR                 07310000
077300***************************************************************** 07320000
077400*    MOVE '2510-CHECK-PO-SERVICE-INFO ' TO PV-ABEND-PARAGRAPH.    07330000
077500*                                                                 07340000
077600*    EXEC SQL                                                     07350000
077700*          SELECT COUNT(*)                                        07360000
077800*          INTO   :PV-DB2-COUNT                                   07370000
077900*          FROM   TPOAGMT                                         07380000
078000*          WHERE  PO_NBR         = :DK-PO-NBR                     07390000
078100*            AND  AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID               07400000
078200*            AND  VER_STATUS_CDE = 'A'                            07410000
078300*            AND  TYP_CDE        = :DK-TYP-CDE                    07420000
078400*    END-EXEC.                                                    07430000
078500*                                                                 07440000
078600*    EVALUATE TRUE                                                07450000
078700*        WHEN SQLCODE = +0                                        07460000
078800*             CONTINUE                                            07470000
078900*        WHEN SQLWARN0 NOT = SPACE                                07480000
079000*        WHEN SQLCODE  NOT = +0                                   07490000
079100*             MOVE '2510-CHECK-PO-SERVICE-INFO'                   07500000
079200*                                  TO PV-ABEND-PARAGRAPH          07510000
079300*             MOVE 'ATTEMPTING TO SELECT TPOAGMT '                07520000
079400*                                  TO PV-ABEND-OPERATION          07530000
079500*             MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          07540000
079600*             MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           07550000
079700*             PERFORM Z999-SQL-ABEND                              07560000
079800*    END-EVALUATE.                                                07570000
079900*                                                                 07580000
080000***************************************************************** 07590000
080100*2520-GET-HANG-FOLD-INFO.                                         07600000
080200***************************************************************** 07610000
080300*    MOVE '2520-GET-HANG-FOLD-INFO ' TO PV-ABEND-PARAGRAPH.       07620000
080400*                                                                 07630000
080500*    EXEC SQL                                                     07640000
080600*        SELECT B.MAJ_CL_NBR                                      07650000
080700*             , B.SUB_CL_NBR                                      07660000
080800*             , B.HNG_FOLD_DESC                                   07670000
080900*          INTO :XLT00004-MAJ-CL-NBR                              07680000
081000*             , :XLT00004-SUB-CL-NBR                              07690000
081100*             , :XLT00004-HNG-FOLD-DESC                           07700000
081200*          FROM XLT_SKU      A                                    07710000
081300*             , XLT_VND_STYL B                                    07720000
081400*         WHERE A.STYL_ID = B.STYL_ID                             07730000
081500*           AND A.ITM_NBR = :DK-ITEM-NBR                          07740000
081600*    END-EXEC.                                                    07750000
081700*                                                                 07760000
081800*    EVALUATE TRUE                                                07770000
081900*        WHEN SQLCODE = +0                                        07780000
082000*             IF XLT00004-HNG-FOLD-DESC = 'HANG'                  07790000
082100*                MOVE 'Y'  TO PV-KOHLS-HANG                       07800000
082200*             ELSE                                                07810000
082300*                MOVE 'N'  TO PV-KOHLS-HANG                       07820000
082400*             END-IF                                              07830000
082500*        WHEN SQLWARN0 NOT = SPACE                                07840000
082600*        WHEN SQLCODE  NOT = +0                                   07850000
082700*             MOVE '2520-GET-HANG-FOLD-INFO '                     07860000
082800*                                  TO PV-ABEND-PARAGRAPH          07870000
082900*             MOVE 'ATTEMPTING TO SELECT SUBCLASS '               07880000
083000*                                  TO PV-ABEND-OPERATION          07890000
083100*             MOVE 'XLT_SKU       '                               07900000
083200*                                  TO PV-DB2-TABLE-NAME1          07910000
083300*             MOVE 'XLT_VND_STYL  '                               07920000
083400*                                  TO PV-DB2-TABLE-NAME2          07930000
083500*             DISPLAY 'DK ITEM NUMBER ' DK-ITEM-NBR               07940000
083600*             PERFORM Z999-SQL-ABEND                              07950000
083700*    END-EVALUATE.                                                07960000
083800*                                                                 07970000
084000***************************************************************** 07980000
084100 2540-SELECT-TRECITM.                                             07990000
084200*WHEN PBS ORDER, USE THIS TO CHECK TO SEE IF TRANSCRIBED OR NOT   08000000
084300***************************************************************** 08010000
084400     MOVE '2540-SELECT-TRECITM ' TO PV-ABEND-PARAGRAPH.           08020000
084500                                                                  08030000
084600     EXEC SQL                                                     08040000
084700           SELECT COUNT(*)                                        08050000
084800           INTO   :PV-DB2-TRECITM-COUNT                           08060000
084900           FROM   TRECITM                                         08070000
085000           WHERE  ORD_NBR        = :DK-PO-NBR                     08080000
085100             AND  REC_SEQ_NBR    = :DK-REC-SEQ-NBR                08090000
085200             AND  VER_STATUS_CDE = 'A'                            08100000
085210             AND  STATUS_CDE = 'IP'                               08110000
085220           WITH UR                                                08120000
085300     END-EXEC.                                                    08130000
085400                                                                  08140000
085500     EVALUATE TRUE                                                08150000
085600         WHEN SQLCODE = +0                                        08160000
085700              CONTINUE                                            08170000
085800         WHEN SQLWARN0 NOT = SPACE                                08180000
085900         WHEN SQLCODE  NOT = +0                                   08190000
086000              MOVE '2540-SELECT-TRECITM'                          08200000
086100                                   TO PV-ABEND-PARAGRAPH          08210000
086200              MOVE 'ATTEMPTING TO SELECT TRECITM  '               08220000
086300                                   TO PV-ABEND-OPERATION          08230000
086400              MOVE 'TRECITM       '                               08240000
086500                                   TO PV-DB2-TABLE-NAME1          08250000
086600              MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          08260000
086700              MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           08270000
086800              MOVE DK-REC-SEQ-NBR  TO PV-DISPLAY-RCVR-SEQ-NBR     08280000
086900              PERFORM Z999-SQL-ABEND                              08290000
087000     END-EVALUATE.                                                08300000
087100                                                                  08310000
087200***************************************************************** 08320000
087300 2600-LOAD-EXTRACT-RECORD.                                        08330000
087400***************************************************************** 08340000
087500     MOVE '2600-LOAD-EXTRACT-RECORD' TO PV-ABEND-PARAGRAPH.       08350000
087600                                                                  08360000
088200*    IF PS-JEWELRY-YES                                            08370000
088300*       SET PC068-JEWELRY-ORDER TO TRUE                           08380000
088400*    ELSE                                                         08390000
088500*       INITIALIZE PC068-JEWELRY-IND                              08400000
088600*    END-IF                                                       08410000
088700*                                                                 08420000
088800*    IF PURCHS-PO-TYP-CDE = 'FB' OR 'IF'                          08430000
088900*       SET PC068-FB-ORDER TO TRUE                                08440000
089000*    ELSE                                                         08450000
089100*       INITIALIZE PC068-FLOWBACK-IND                             08460000
089200*    END-IF                                                       08470000
089300*                                                                 08480000
089400*    IF PV-KOHLS-HANG = 'Y'                                       08490000
089500*       SET PC068-HANG TO TRUE                                    08500000
089600*    ELSE                                                         08510000
089700*       INITIALIZE PC068-HANG-FOLD-IND                            08520000
089800*    END-IF                                                       08530000
089900                                                                  08540000
090000     MOVE PURCHS-DEPT-NBR          TO PC068-DEPT-NBR.             08550000
090100     MOVE PURCHS-ENT-ID            TO PC068-ENT-ID.               08560000
090300                                                                  08570000
090400*RECEIVER = 0                                                     08580000
090500     IF SHPTPO-REC-SEQ-NBR = 0                                    08590000
090600        MOVE SHPTPO-PO-NBR              TO PC068-PO-NBR           08600000
090700        MOVE 0 TO      PC068-PO-LNE-NBR                           08610000
090800                       PC068-REC-SEQ-NBR                          08620000
090900                       PC068-PACK-ID                              08630000
091000                                                                  08640000
091100        MOVE SHIPMT-EXPTED-PKG-QTY      TO PC068-TOT-CTN-CNT      08650000
091200                                                                  08660000
091300        IF PURCHS-PKGNG-CDE = 'B' OR 'I'                          08670000
091400           MOVE SHIPMT-EXPTED-PKG-QTY   TO PC068-P2L-CTN-CNT      08680000
091500        ELSE                                                      08690000
091600           MOVE SHIPMT-EXPTED-PKG-QTY   TO PC068-XDCK-CTN-CNT     08700000
091700        END-IF                                                    08710000
091800                                                                  08720000
091900        SET PC068-NOT-TRANSCRIBED  TO TRUE                        08730000
092000                                                                  08740000
092100*SET UCC128 NOT USED TO TRUE                                      08750000
092200        INITIALIZE PC068-UCC128-IND                               08760000
092300                                                                  08770000
092400        INITIALIZE PC068-HANG-FOLD-IND                            08780000
092500                                                                  08790000
092600*PBS                                                              08800000
092700        IF PURCHS-PKGNG-CDE = SPACES                              08810000
092800           SET PC068-PBS-ORDER        TO TRUE                     08820000
092900           MOVE SPACES                TO PC068-PKG-TYPE           08830000
093000           MOVE SHIPMT-EXPTED-PKG-QTY TO PC068-TOT-CTN-CNT        08840000
093100*NON-PBS                                                          08850000
093200        ELSE                                                      08860000
093300           INITIALIZE PC068-PBS-IND                               08870000
093400           MOVE PURCHS-PKGNG-CDE      TO PC068-PKG-TYPE           08880000
093500        END-IF                                                    08890000
093600     END-IF.                                                      08900000
093700                                                                  08900100
W40796     INITIALIZE PC068-SKU-NUMBER.                                 08900200
W40796     MOVE PV-SKU-NUMBER               TO PC068-SKU-NUMBER.        08900300
W40796                                                                  08900500
W40796     INITIALIZE PC068-EFC-NBR.                                    08900600
W40392     MOVE RECEIV-CURR-OPER-UNT-ID     TO PC068-CURR-LOC.          08901000
W40392     IF RECEIV-OPER-UNT-ID NOT = RECEIV-CURR-OPER-UNT-ID          08902000
W40392* JAK START                                                       08902100
W40392*        MOVE RECEIV-OPER-UNT-ID      TO PC068-EFC-NBR            08902200
W40392         MOVE RECEIV-OPER-UNT-ID      TO DK-EFC-NBR               08902300
W40392         PERFORM 4200-CHECK-IF-EFC                                08902500
W40392         IF XLT00010-E-BUS-IND = 'Y'                              08902600
W40392             MOVE RECEIV-OPER-UNT-ID      TO PC068-EFC-NBR        08903000
W40392         END-IF                                                   08904000
W40392* JAK END                                                         08904100
W40392     END-IF.                                                      08905000
093700                                                                  08910000
093800*RECEIVER > 0                                                     08920000
093900     IF SHPTPO-REC-SEQ-NBR > 0                                    08930000
094000        MOVE SHPTPO-PO-NBR                TO PC068-PO-NBR         08940000
094100*PBS                                                              08950000
094200        IF RECEIV-PKGNG-CDE = SPACES                              08960000
094300           AND RECEIV-PACK-BY-ST-IND = 'Y'                        08970000
094400                                                                  08980000
094500           IF PS-TRANSCRIBED-YES                                  08990000
094600              SET PC068-TRANSCRIBED       TO TRUE                 09000000
094700           ELSE                                                   09010000
094800              SET PC068-NOT-TRANSCRIBED   TO TRUE                 09020000
094900           END-IF                                                 09030000
095000                                                                  09040000
095100           SET PC068-PBS-ORDER            TO TRUE                 09050000
095200           MOVE SPACES                    TO PC068-PKG-TYPE       09060000
095300           MOVE RECEIV-EXPTED-CART-CNT    TO PC068-TOT-CTN-CNT    09070000
095400                                             PC068-XDCK-CTN-CNT   09080000
095500           MOVE SHPTPO-REC-SEQ-NBR        TO PC068-REC-SEQ-NBR    09100000
095600           MOVE 0                         TO PC068-PO-LNE-NBR     09110000
095700                                             PC068-PACK-ID        09120000
095800           INITIALIZE PC068-MAJ-CL-NBR                            09130000
095900*NON-PBS                                                          09140000
096000        ELSE                                                      09150000
096100           INITIALIZE PC068-PBS-IND                               09160000
096200                                                                  09170000
096300           IF PS-TRANSCRIBED-YES                                  09180000
096400              SET PC068-TRANSCRIBED       TO TRUE                 09190000
096500              MOVE RECITM-ORD-LNE-NBR     TO PC068-PO-LNE-NBR     09200000
096600              MOVE RECITM-PREPK-ID        TO PC068-PACK-ID        09210000
096700*             MOVE XLT00004-MAJ-CL-NBR    TO PV-MAJ-CL-NBR        09220000
096800*             MOVE PV-MAJ-CL-NBR(2:3)     TO PC068-MAJ-CL-NBR     09230000
096900           ELSE                                                   09240000
097000              SET PC068-NOT-TRANSCRIBED   TO TRUE                 09250000
097100              MOVE 0                      TO PC068-PO-LNE-NBR     09260000
097200              MOVE 0                      TO PC068-PACK-ID        09270000
097201*                                                                 09280000
097210              MOVE 0                      TO PC068-XDCK-CTN-CNT   09290000
097220                                             PC068-P2L-CTN-CNT    09300000
097300           END-IF                                                 09310000
097400                                                                  09320000
097500           MOVE SHPTPO-REC-SEQ-NBR        TO PC068-REC-SEQ-NBR    09330000
097600           MOVE RECEIV-PKGNG-CDE          TO PC068-PKG-TYPE       09340000
W40392           MOVE RECEIV-CURR-OPER-UNT-ID   TO PC068-CURR-LOC       09350000
097700           MOVE 0                         TO PC068-TOT-CTN-CNT    09360000
097800        END-IF                                                    09370000
097900     END-IF.                                                      09380000
098000                                                                  09390000
098100***************************************************************** 09400000
098200 3000-PROCESS-ZERO-RECEIVER.                                      09410000
098300***************************************************************** 09420000
098400     MOVE '3000-PROCESS-ZERO-RECEIVER' TO PV-ABEND-PARAGRAPH.     09430000
098500                                                                  09440000
098600     PERFORM 2200-SELECT-TPURCHS                                  09450000
098700                                                                  09460000
098800     PERFORM 3110-OPEN-TPURITM-CSR                                09470000
098900     PERFORM 3120-FETCH-TPURITM-CSR                               09480000
099000                                                                  09490000
099100     IF SQLCODE = +100                                            09500000
099200        SET PS-TRANSCRIBED-NO TO TRUE                             09510000
099300        INITIALIZE PV-KOHLS-HANG                                  09520000
099400        MOVE 0 TO PC068-PO-LNE-NBR                                09530000
099500                  PC068-PACK-ID                                   09540000
099600     ELSE                                                         09550000
099700        PERFORM 3125-PROCESS-TPURITM-CSR                          09560000
099800               UNTIL PS-EOF-TPURITM-CSR                           09570000
099900     END-IF                                                       09580000
100000                                                                  09590000
100100     PERFORM 3130-CLOSE-TPURITM-CSR                               09600000
100200                                                                  09610000
100300     SET PS-NOT-EOF-TPURITM-CSR TO TRUE.                          09620000
100400                                                                  09630000
100500***************************************************************** 09640000
100600 3110-OPEN-TPURITM-CSR.                                           09650000
100700***************************************************************** 09660000
100800     MOVE '3110-OPEN-TPURITM-CSR' TO PV-ABEND-PARAGRAPH.          09670000
100900                                                                  09680000
101000     EXEC SQL                                                     09690000
101100         OPEN TPURITM-CSR                                         09700000
101200     END-EXEC.                                                    09710000
101300                                                                  09720000
101400     EVALUATE TRUE                                                09730000
101500         WHEN SQLCODE = +0                                        09740000
101600             CONTINUE                                             09750000
101700         WHEN SQLWARN0 NOT = SPACE                                09760000
101800         WHEN SQLCODE  NOT = +0                                   09770000
101900             MOVE '3110-OPEN-TPURITM-CSR'                         09780000
102000                                 TO PV-ABEND-PARAGRAPH            09790000
102100             MOVE 'OPEN CURSOR '                                  09800000
102200                                 TO PV-ABEND-OPERATION            09810000
102300             MOVE 'TPURITM  '                                     09820000
102400                                 TO PV-DB2-TABLE-NAME1            09830000
102500              MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          09840000
102600             MOVE DK-PO-NBR      TO PV-DISPLAY-PO-NBR             09850000
102700             PERFORM Z999-SQL-ABEND                               09860000
102800     END-EVALUATE.                                                09870000
102900                                                                  09880000
103000***************************************************************** 09890000
103100 3120-FETCH-TPURITM-CSR.                                          09900000
103200***************************************************************** 09910000
103300     MOVE '3120-FETCH-TPURITM-CSR' TO PV-ABEND-PARAGRAPH.         09920000
103400                                                                  09930000
103500     EXEC SQL                                                     09940000
103600          FETCH TPURITM-CSR                                       09950000
103700           INTO  :PURITM-PO-LNE-NBR                               09960000
103800               , :PURITM-ITM-NBR                                  09970000
103900               , :PURITM-PO-PREPK-ID                              09980000
W40796               , :PURITM-RMS-PO-SKU-NBR                           09981000
104000     END-EXEC.                                                    09990000
104100                                                                  10000000
104200     EVALUATE TRUE                                                10010000
104300         WHEN SQLCODE = +0                                        10020000
W40796              MOVE PURITM-RMS-PO-SKU-NBR TO PV-SKU-NUMBER         10030000
104500         WHEN SQLCODE = +100                                      10040000
104600              SET PS-EOF-TPURITM-CSR TO TRUE                      10050000
104700         WHEN SQLWARN0 NOT = SPACE                                10060000
104800         WHEN SQLCODE  NOT = +0                                   10070000
104900              MOVE '3120-FETCH-TPURITM-CSR'                       10080000
105000                                   TO PV-ABEND-PARAGRAPH          10090000
105100              MOVE 'ATTEMPTING TO FETCH CURSOR '                  10100000
105200                                   TO PV-ABEND-OPERATION          10110000
105300                                                                  10120000
105400              MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          10130000
105500              MOVE DK-PO-NBR             TO                       10140000
105600                                PV-DISPLAY-PO-NBR                 10150000
105700              PERFORM Z999-SQL-ABEND                              10160000
105800     END-EVALUATE.                                                10170000
105900                                                                  10180000
106000***************************************************************** 10190000
106100 3125-PROCESS-TPURITM-CSR.                                        10200000
106200***************************************************************** 10210000
106300     MOVE '3125-PROCESS-TPURITM-CSR' TO PV-ABEND-PARAGRAPH.       10220000
106400                                                                  10230000
106500     PERFORM 3120-FETCH-TPURITM-CSR                               10240000
106600                                                                  10250000
106700     MOVE PURITM-ITM-NBR TO DK-ITEM-NBR                           10260000
106800*    PERFORM 2500-GET-HANG-FOLD-IND                               10270000
106900                                                                  10280000
107000     PERFORM 2600-LOAD-EXTRACT-RECORD                             10290000
107100     PERFORM 8000-WRITE-TO-PBS-FILE.                              10300000
107200                                                                  10310000
107300                                                                  10320000
107400***************************************************************** 10330000
107500 3130-CLOSE-TPURITM-CSR.                                          10340000
107600***************************************************************** 10350000
107700     MOVE '3130-CLOSE-TPURITM-CSR' TO PV-ABEND-PARAGRAPH.         10360000
107800                                                                  10370000
107900     EXEC SQL                                                     10380000
108000         CLOSE TPURITM-CSR                                        10390000
108100     END-EXEC                                                     10400000
108200                                                                  10410000
108300     EVALUATE TRUE                                                10420000
108400         WHEN SQLCODE = ZERO                                      10430000
108500             CONTINUE                                             10440000
108600         WHEN OTHER                                               10450000
108700             MOVE '3130-CLOSE-TPURITM-CSR'                        10460000
108800                                 TO PV-ABEND-PARAGRAPH            10470000
108900             MOVE 'CLOSE CURSOR '                                 10480000
109000                                 TO PV-ABEND-OPERATION            10490000
109100             MOVE 'TPURITM '                                      10500000
109200                                 TO PV-DB2-TABLE-NAME1            10510000
109300             PERFORM Z999-SQL-ABEND                               10520000
109400     END-EVALUATE.                                                10530000
109500                                                                  10540000
109600***************************************************************** 10550000
109700 4000-PROCESS-RECEIVER.                                           10560000
109800***************************************************************** 10570000
109900     MOVE '4000-PROCESS-RECEIVER' TO PV-ABEND-PARAGRAPH.          10580000
110000                                                                  10590000
W40392     SET PS-EFC-FREIGHT-NO TO TRUE.                               10591000
110100     PERFORM 2300-SELECT-TRECEIV                                  10600000
110200     IF PS-TRECEIV-FOUND-YES                                      10610000
110300        IF RECEIV-PACK-BY-ST-IND = 'Y'                            10620000
110400*          PERFORM 2500-GET-HANG-FOLD-IND                         10630000
110500           MOVE 'N' TO PV-VENDOR-HANG PV-KOHLS-HANG               10640000
110600           PERFORM 2540-SELECT-TRECITM                            10650000
110700           IF PV-DB2-TRECITM-COUNT > 0                            10660000
110800              SET PS-TRANSCRIBED-YES TO TRUE                      10670000
110900           ELSE                                                   10680000
111000              SET PS-TRANSCRIBED-NO  TO TRUE                      10690000
111100           END-IF                                                 10700000
111200                                                                  10710000
111300           PERFORM 2600-LOAD-EXTRACT-RECORD                       10720000
111400           PERFORM 8000-WRITE-TO-PBS-FILE                         10730000
111500        ELSE                                                      10740000
111600           PERFORM 4110-OPEN-TRECITM-CSR                          10750000
111700           PERFORM 4120-FETCH-TRECITM-CSR                         10760000
111800                                                                  10770000
111900           IF SQLCODE = +100                                      10780000
112000              SET PS-TRANSCRIBED-NO TO TRUE                       10790000
112100                                                                  10800000
112200*             PERFORM 2500-GET-HANG-FOLD-IND                      10810000
112300                                                                  10820000
112400              MOVE 0 TO PC068-PO-LNE-NBR                          10830000
112500                        PC068-PACK-ID                             10840000
112600                                                                  10850000
112700              PERFORM 2600-LOAD-EXTRACT-RECORD                    10860000
112800              PERFORM 8000-WRITE-TO-PBS-FILE                      10870000
112900           ELSE                                                   10880000
113000              SET PS-TRANSCRIBED-YES TO TRUE                      10890000
113100              PERFORM 4125-PROCESS-TRECITM-CSR                    10900000
113200                   UNTIL PS-EOF-TRECITM-CSR                       10910000
113300           END-IF                                                 10920000
113400                                                                  10930000
113500           PERFORM 4130-CLOSE-TRECITM-CSR                         10940000
113600                                                                  10950000
113700           SET PS-NOT-EOF-TRECITM-CSR TO TRUE                     10960000
113800        END-IF                                                    10970000
113900     ELSE                                                         10980000
114000        CONTINUE                                                  10990000
114100     END-IF.                                                      11000000
114200                                                                  11010000
114300***************************************************************** 11020000
114400 4110-OPEN-TRECITM-CSR.                                           11030000
114500***************************************************************** 11040000
114600     MOVE '4110-OPEN-TRECITM-CSR' TO PV-ABEND-PARAGRAPH.          11050000
114700                                                                  11060000
114800     EXEC SQL                                                     11070000
114900         OPEN TRECITM-CSR                                         11080000
115000     END-EXEC.                                                    11090000
115100                                                                  11100000
115200     EVALUATE TRUE                                                11110000
115300         WHEN SQLCODE = +0                                        11120000
115400             CONTINUE                                             11130000
115500         WHEN SQLWARN0 NOT = SPACE                                11140000
115600         WHEN SQLCODE  NOT = +0                                   11150000
115700             MOVE '4110-OPEN-TRECITM-CSR'                         11160000
115800                                 TO PV-ABEND-PARAGRAPH            11170000
115900             MOVE 'OPEN CURSOR '                                  11180000
116000                                 TO PV-ABEND-OPERATION            11190000
116100             MOVE 'TRECITM  '                                     11200000
116200                                 TO PV-DB2-TABLE-NAME1            11210000
116300              MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          11220000
116400             MOVE DK-PO-NBR      TO PV-DISPLAY-PO-NBR             11230000
116500             MOVE DK-REC-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR       11240000
116600             PERFORM Z999-SQL-ABEND                               11250000
116700     END-EVALUATE.                                                11260000
116800                                                                  11270000
116900***************************************************************** 11280000
117000 4120-FETCH-TRECITM-CSR.                                          11290000
117100***************************************************************** 11300000
117200     MOVE '4120-FETCH-TRECITM-CSR' TO PV-ABEND-PARAGRAPH.         11310000
117300                                                                  11320000
117400     EXEC SQL                                                     11330000
117500          FETCH TRECITM-CSR                                       11340000
117600           INTO  :RECITM-ORD-LNE-NBR                              11350000
117700               , :RECITM-ITM-NBR                                  11360000
117800               , :RECITM-PREPK-ID                                 11370000
117900               , :RECITM-PREPK-DRV-LNE-CDE                        11380000
W40392               , :RECITM-STATUS-CDE                               11390000
W40392               , :RECITM-PKSL-ITM-QTY                             11400000
W40392               , :RECITM-DTL-CK-ITM-QTY                           11410000
W40796               , :XLT00003-SKU-NBR                                11411000
118000     END-EXEC.                                                    11420000
118100                                                                  11430000
118200     EVALUATE TRUE                                                11440000
118300         WHEN SQLCODE = +0                                        11450000
W40796           MOVE XLT00003-SKU-NBR      TO PV-SKU-NUMBER            11451000
W40392           PERFORM 4122-GET-ITEM-QUANTITY                         11460000
118400**                                                                11470000
118500*          MOVE DK-PO-NBR    TO PV-DISPLAY-PO-NBR                 11480000
118600*          MOVE DK-REC-SEQ-NBR     TO                             11490000
118700*                               PV-DISPLAY-RCVR-SEQ-NBR           11500000
118800*          MOVE RECITM-ORD-LNE-NBR TO PV-DISPLAY-PO-LNE-NBR       11510000
118900*          DISPLAY 'PO NUMBER IS ' PV-DISPLAY-PO-NBR              11520000
119000*                   ' LNE NBR ' PV-DISPLAY-PO-LNE-NBR             11530000
119100*                   ' RCVR NBR ' PV-DISPLAY-RCVR-SEQ-NBR          11540000
119200**                                                                11550000
W40392*             CONTINUE                                            11560000
119400         WHEN SQLCODE = +100                                      11570000
119500              SET PS-EOF-TRECITM-CSR TO TRUE                      11580000
119600         WHEN SQLWARN0 NOT = SPACE                                11590000
119700         WHEN SQLCODE  NOT = +0                                   11600000
119800              MOVE '4120-FETCH-TRECITM-CSR'                       11610000
119900                                   TO PV-ABEND-PARAGRAPH          11620000
120000              MOVE 'ATTEMPTING TO FETCH CURSOR '                  11630000
120100                                   TO PV-ABEND-OPERATION          11640000
120200              MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          11650000
120300              MOVE DK-PO-NBR             TO                       11660000
120400                                PV-DISPLAY-PO-NBR                 11670000
120500              MOVE DK-REC-SEQ-NBR        TO                       11680000
120600                                PV-DISPLAY-RCVR-SEQ-NBR           11690000
120700              PERFORM Z999-SQL-ABEND                              11700000
120800     END-EVALUATE.                                                11710000
120900                                                                  11720000
W40392***************************************************************** 11730000
W40392 4122-GET-ITEM-QUANTITY.                                          11740000
W40392***************************************************************** 11750000
W40392     MOVE '4122-GET-ITEM-QUANTITY' TO PV-ABEND-PARAGRAPH.         11760000
W40392                                                                  11770000
W40392     EXEC SQL                                                     11780000
W40392           SELECT SUM(VERIFY_ITM_QTY)                             11790000
W40392                , SUM(AP_VERIFY_ITM_QTY)                          11800000
W40392           INTO   :PV-DB2-VERIFY-ITM-QTY                          11810000
W40392                , :PV-DB2-AP-VERIFY-ITM-QTY                       11820000
W40392           FROM   TRECDIS                                         11830000
W40392           WHERE  ORD_NBR        = :DK-PO-NBR                     11840000
W40392             AND  REC_SEQ_NBR    = :DK-REC-SEQ-NBR                11850000
W40392             AND  ORD_LNE_NBR    = :RECITM-ORD-LNE-NBR            11860000
W40392           WITH UR                                                11870000
W40392     END-EXEC.                                                    11880000
W40392                                                                  11890000
W40392     EVALUATE TRUE                                                11900000
W40392         WHEN SQLCODE = +0                                        11910000
W40392              IF RECITM-STATUS-CDE = 'VE'                         11920000
W40392                  MOVE  PV-DB2-AP-VERIFY-ITM-QTY                  11930000
W40392                                   TO PC068-UNIT-CNT              11940000
W40392              ELSE                                                11950000
W40392                  MOVE  PV-DB2-VERIFY-ITM-QTY                     11960000
W40392                                   TO PC068-UNIT-CNT              11970000
W40392              END-IF                                              11980000
W40392         WHEN SQLCODE = +100                                      11990000
W40392              IF RECITM-DTL-CK-ITM-QTY > 0                        12000000
W40392                  MOVE RECITM-DTL-CK-ITM-QTY TO PC068-UNIT-CNT    12010000
W40392              ELSE                                                12020000
W40392                  MOVE RECITM-PKSL-ITM-QTY   TO PC068-UNIT-CNT    12030000
W40392              END-IF                                              12040000
W40392         WHEN SQLCODE = -305                                      12050000
W40392              MOVE +0 TO PC068-UNIT-CNT                           12060000
W40392         WHEN OTHER                                               12070000
W40392              MOVE '4122-GET-ITEM-QUANTITY'                       12080000
W40392                                   TO PV-ABEND-PARAGRAPH          12090000
W40392              MOVE 'ATTEMPTING TO SUM TRECDIS  '                  12100000
W40392                                   TO PV-ABEND-OPERATION          12110000
W40392              MOVE 'TRECITM       '                               12120000
W40392                                   TO PV-DB2-TABLE-NAME1          12130000
W40392              MOVE PC068-TRIP-ID   TO PV-DISPLAY-TRIP-ID          12140000
W40392              MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           12150000
W40392              MOVE DK-REC-SEQ-NBR  TO PV-DISPLAY-RCVR-SEQ-NBR     12160000
W40392              PERFORM Z999-SQL-ABEND                              12170000
W40392     END-EVALUATE.                                                12180000
W40392                                                                  12190000
121000***************************************************************** 12200000
121100 4125-PROCESS-TRECITM-CSR.                                        12210000
121200***************************************************************** 12220000
121300     MOVE '4125-PROCESS-TRECITM-CSR' TO PV-ABEND-PARAGRAPH.       12230000
121400                                                                  12240000
121500     MOVE RECITM-ITM-NBR      TO DK-ITEM-NBR                      12250000
121600*    PERFORM 2500-GET-HANG-FOLD-IND                               12260000
121700                                                                  12270000
121800     EVALUATE TRUE                                                12280000
121900        WHEN RECITM-PREPK-ID = 0                                  12290000
122000           PERFORM 2600-LOAD-EXTRACT-RECORD                       12300000
122100           PERFORM 8500-WRITE-TO-NON-PBS-FILE                     12310000
122200        WHEN RECITM-PREPK-ID > 0                                  12320000
122300           IF RECITM-PREPK-DRV-LNE-CDE = 'A'                      12330000
122400              PERFORM 2600-LOAD-EXTRACT-RECORD                    12340000
122500              PERFORM 8500-WRITE-TO-NON-PBS-FILE                  12350000
122600           END-IF                                                 12360000
122700     END-EVALUATE                                                 12370000
122800                                                                  12380000
122900     PERFORM 4120-FETCH-TRECITM-CSR.                              12390000
123000                                                                  12400000
123100***************************************************************** 12410000
123200 4130-CLOSE-TRECITM-CSR.                                          12420000
123300***************************************************************** 12430000
123400     MOVE '4130-CLOSE-TRECITM-CSR' TO PV-ABEND-PARAGRAPH.         12440000
123500                                                                  12450000
123600     EXEC SQL                                                     12460000
123700         CLOSE TRECITM-CSR                                        12470000
123800     END-EXEC                                                     12480000
123900                                                                  12490000
124000     EVALUATE TRUE                                                12500000
124100         WHEN SQLCODE = ZERO                                      12510000
124200             CONTINUE                                             12520000
124300         WHEN OTHER                                               12530000
124400             MOVE '4130-CLOSE-TRECITM-CSR'                        12540000
124500                                 TO PV-ABEND-PARAGRAPH            12550000
124600             MOVE 'CLOSE CURSOR '                                 12560000
124700                                 TO PV-ABEND-OPERATION            12570000
124800             MOVE 'TRECITM '                                      12580000
124900                                 TO PV-DB2-TABLE-NAME1            12590000
125000             PERFORM Z999-SQL-ABEND                               12600000
125100     END-EVALUATE.                                                12610000
125200                                                                  12620000
W40392* JAK START                                                       12621000
W40392***************************************************************** 12621100
W40392 4200-CHECK-IF-EFC.                                               12622000
W40392***************************************************************** 12623000
W40392     MOVE '4200-CHECK-IF-EFC' TO PV-ABEND-PARAGRAPH.              12624000
W40392                                                                  12625000
W40392     EXEC SQL                                                     12626000
W40392           SELECT E_BUS_IND                                       12627000
W40392           INTO  :XLT00010-E-BUS-IND                              12629000
W40392           FROM   XLT_LOC                                         12629200
W40392           WHERE  LOC_NBR        = :DK-EFC-NBR                    12629300
W40392             AND  LOC_TYP_CDE    = 'DC'                           12629400
W40392           WITH UR                                                12629600
W40392     END-EXEC.                                                    12629700
W40392                                                                  12629800
W40392     EVALUATE TRUE                                                12629900
W40392         WHEN SQLCODE = +0                                        12630000
W40392              CONTINUE                                            12630200
W40392         WHEN SQLCODE = +100                                      12630800
W40392              MOVE 'N' TO XLT00010-E-BUS-IND                      12631000
W40392         WHEN OTHER                                               12631600
W40392              MOVE '4200-CHECK-IF-EFC'                            12631700
W40392                                   TO PV-ABEND-PARAGRAPH          12631800
W40392              MOVE 'READING XLT_LOC  '                            12631900
W40392                                   TO PV-ABEND-OPERATION          12632000
W40392              MOVE 'XLT_LOC       '                               12632100
W40392                                   TO PV-DB2-TABLE-NAME1          12632200
W40392              PERFORM Z999-SQL-ABEND                              12632600
W40392     END-EVALUATE.                                                12632700
W40392* JAK START                                                       12632800
W40392                                                                  12632900
125300***************************************************************** 12633000
125400 7000-READ-INPUT-FILE.                                            12640000
125500***************************************************************** 12650000
125600      READ INPUT-FILE INTO PC068-RECORD-LAYOUT                    12660000
125700        AT END                                                    12670000
125800           SET PS-END-OF-INPUT-FILE TO TRUE                       12680000
125900        NOT AT END                                                12690000
126000           ADD +1 TO PV-READ-COUNT                                12700000
126100      END-READ.                                                   12710000
126200                                                                  12720000
126300***************************************************************** 12730000
126400 8000-WRITE-TO-PBS-FILE.                                          12740000
126500***************************************************************** 12750000
126600     WRITE EXTRACT-PBS-RECORD                                     12760000
126700       FROM PC068-RECORD-LAYOUT.                                  12770000
126800                                                                  12780000
126900**                                                                12790000
127000*    MOVE PC068-PO-NBR TO PV-DISPLAY-PO-NBR.                      12800000
127100*    MOVE PC068-REC-SEQ-NBR TO                                    12810000
127200*                         PV-DISPLAY-RCVR-SEQ-NBR.                12820000
127300*    MOVE PC068-PO-LNE-NBR TO PV-DISPLAY-PO-LNE-NBR.              12830000
127400*    DISPLAY 'WRITING '                                           12840000
127500*            'PO ' PV-DISPLAY-PO-NBR                              12850000
127600*             ' LNE NBR ' PV-DISPLAY-PO-LNE-NBR                   12860000
127700*             ' RCVR NBR ' PV-DISPLAY-RCVR-SEQ-NBR.               12870000
127800**                                                                12880000
127900     ADD +1 TO PV-WRITE-PBS-EXTR-COUNT.                           12890000
128000                                                                  12900000
128100***************************************************************** 12910000
128200 8500-WRITE-TO-NON-PBS-FILE.                                      12920000
128300***************************************************************** 12930000
128400     WRITE EXTRACT-NON-PBS-RECORD                                 12940000
128500       FROM PC068-RECORD-LAYOUT.                                  12950000
128600**                                                                12960000
128700*    MOVE PC068-PO-NBR TO PV-DISPLAY-PO-NBR.                      12970000
128800*    MOVE PC068-REC-SEQ-NBR TO                                    12980000
128900*                         PV-DISPLAY-RCVR-SEQ-NBR.                12990000
129000*    MOVE PC068-PO-LNE-NBR TO PV-DISPLAY-PO-LNE-NBR.              13000000
129100*    DISPLAY 'WRITING NONPBS '                                    13010000
129200*            'PO ' PV-DISPLAY-PO-NBR                              13020000
129300*             ' LNE NBR ' PV-DISPLAY-PO-LNE-NBR                   13030000
129400*             ' RCVR NBR ' PV-DISPLAY-RCVR-SEQ-NBR                13040000
129500*             ' PKG TYPE ' PC068-PKG-TYPE.                        13050000
129600**                                                                13060000
129700                                                                  13070000
129800     ADD +1 TO PV-WRITE-NON-PBS-EXTR-COUNT.                       13080000
129900                                                                  13090000
130000***************************************************************** 13100000
130100 9000-CLOSE-FILES.                                                13110000
130200                                                                  13120000
130300     DISPLAY ' '.                                                 13130000
130400     DISPLAY '**************************************************'.13140000
130500     DISPLAY 'PROGRAM.................'   PC-PROGRAM-NAME.        13150000
130600     DISPLAY ' '.                                                 13160000
130700     MOVE PV-READ-COUNT              TO PV-DISPLAY-READ-CNT.      13170000
130800     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-READ-CNT.      13180000
130900     DISPLAY ' '.                                                 13190000
131000                                                                  13200000
131100     MOVE PV-WRITE-PBS-EXTR-COUNT     TO PV-DISPLAY-WRITE-PBS-CNT.13210000
131200     DISPLAY 'TOT PBS RECS WRITTEN : '   PV-DISPLAY-WRITE-PBS-CNT.13220000
131300                                                                  13230000
131400     MOVE PV-WRITE-NON-PBS-EXTR-COUNT                             13240000
131500                                 TO PV-DISPLAY-WRITE-NON-PBS-CNT  13250000
131600     DISPLAY 'TOT NON-PBS WRITTEN : '                             13260000
131700                                    PV-DISPLAY-WRITE-NON-PBS-CNT  13270000
131800                                                                  13280000
131900     CLOSE INPUT-FILE                                             13290000
132000           EXTRACT-PBS-FILE                                       13300000
132100           EXTRACT-NON-PBS-FILE.                                  13310000
132200                                                                  13320000
132300***************************************************************** 13330000
132400 Z999-SQL-ABEND.                                                  13340000
132500***************************************************************** 13350000
132600     MOVE SQLCODE                     TO PV-DISPLAY-SQLCODE.      13360000
132700                                                                  13370000
132800     DISPLAY '** ABEND **         ** = SQLERROR'.                 13380000
132900     DISPLAY '** PROGRAM      ** = ' PC-PROGRAM-NAME.             13390000
133000     DISPLAY '** TRIP ID      ** = ' PV-DISPLAY-TRIP-ID.          13400000
133100     DISPLAY '** PO NBR       ** = ' PV-DISPLAY-PO-NBR.           13410000
133200     DISPLAY '** RCVR SEQ NBR ** = ' PV-DISPLAY-RCVR-SEQ-NBR.     13420000
133300                                                                  13430000
133400     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             13440000
133500     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                13450000
133600     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             13460000
133700     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME2.             13470000
133800     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME3.             13480000
133900     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE.             13490000
134000                                                                  13500000
134100     MOVE +4013                  TO PV-ABEND-CODE.                13510000
134200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         13520000
