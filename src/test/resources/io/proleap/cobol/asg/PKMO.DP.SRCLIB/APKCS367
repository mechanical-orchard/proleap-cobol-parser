000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    APKCS367.                                         00040099
000500 AUTHOR.        MIKE BESKE.                                       00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  MAY 2000.                                         00070099
000800                                                                  00080099
000900*---------------------------------------------------------------* 00090099
001000*                                                               * 00100099
001100*    UPDATE STORE NUMBER ON INVOICES TO STORE 000 (BULK)        * 00110099
001200*                                                               * 00120099
001300*    TRANID      - A367                                         * 00130099
001400*    DESCRIPTION - AP-UPDATE INVOICE TO BULK                    * 00140099
001500*    MAPSET      - APKM367                                      * 00150099
001600*                                                               * 00160099
001700*    THIS PROGRAM FETCHES ALL BY-STORE MI & RI'S(EN, RC, IB, OB)* 00170099
001800*    FOR A SPECIFIC PO NUMBER.  IT WILL THEN CHANGE THE VALUE   * 00180099
001900*    OF THE STORE NUMBER TO BE 000.  THIS WILL ALLOW THE PO TO  * 00190099
002000*    BE TREATED AS A BULK PO.                                   * 00200099
002100*                                                               * 00210099
002200*---------------------------------------------------------------* 00220099
002300* CHANGE LOG:                                                   * 00230099
002400* 05/02/00   INITIAL VERSION.                                   * 00240099
002500*                                                               * 00250099
002600* 06/08/00 - REWROTE THIS PROGRAM BASED ON TXKCS500.  THIS HAD  * 00260099
002700*            TO BE DONE BECAUSE THE ORIGINAL VERSION COULD ONLY * 00270099
002800*            CHANGE 28 INVOICES' (2 SCREENS OF 14 ROWS) STORE   * 00280099
002900*            NUMBERS TO ZERO BEFORE ABENDING.  THE ORIGINAL     * 00290099
003000*            VERSION WAS NOT HANDLING THE TEMP STORAGE QUEUE    * 00300099
003100*            CORRECTLY.                                         * 00310099
003200*        BY: MIKE BESKE                             WR #: 20978 * 00320099
003300*                                                               * 00330099
003400* 06/22/00 - ADDED A NEW PO NUMBER ERROR CHECK.  THE PO STORE   * 00340099
003500*            TABLE WILL BE CHECKED FOR ANY OCCURRENCES OF THE PO* 00350099
003600*            NUMBER THAT IS ENTERED.  IF THE PO IS FOUND THIS   * 00360099
003700*            INDICATES THAT THE PO WAS PAYRELEASED PRIOR TO THE * 00370099
003800*            ATTEMPT TO CHANGE THE INVOICES TO BULK.  THIS ERROR* 00380099
003900*            CHECK WILL AVOID BALANCING ERRORS BECAUSE THE RE-  * 00390099
004000*            MAINDER INVOICES THAT WERE CREATED WON'T HAVE THEIR* 00400099
004100*            STORE NUMBERS CHANGED. IF THE NUMBERS WERE CHANGED,* 00410099
004200*            THE RI'S WOULDN'T GET PICKED UP IN THE BATCH MATCH.* 00420099
004300*        BY: MIKE BESKE                             WR #: 20978 * 00430099
004400*                                                               * 00440099
004500*   5/22/02  RECOMPILED TO PICK UP NEW DCLGENS FOR TINVOIC,     * 00450099
004600*            TMDINVC AND TEXINVC AS PART OF THE ARK PO PHASE ONE* 00460099
004700*            PROJECT.                                           * 00470099
004800*             BY: MIKE BESKE                     WR: 23500      * 00480099
004900*                                                               * 00490099
005000*  04/23/04  INCREASED THE LENGTH OF STORE NUMBER TO 4 DIGITS   * 00500099
005100*            AS PART OF THE STORE CONSTRAINTS PROJECT.          * 00510099
005200*             BY: MIKE BESKE                     WR: 25805      * 00520099
005300*                                                               * 00530099
005301*  02/08/06  REMOVED TPAYREQ SO THAT USERS COULD UPDATE STORES  * 00530199
005302*            TO BULK, FUNCTION F24, WITHOUT AN ERROR.  THE      * 00530299
005303*            ERROR "00050 - E - NO LIST ITEMS WERE FOUND FOR    * 00530399
005304*            CRITERIA SPECIFIED" WAS ENCOUNTERED BECAUSE        * 00530499
005305*            TPAYREQ HAD BEEN REMOVED FROM APKUP202 BEFORE THE  * 00530599
005306*            INVOICE WAS INSERTED.                              * 00530699
005307*             BY: ROLF NOHE                      WR: P000980683 * 00530799
005308*                                                               * 00530899
005309*  03/11/07  MATCH BY DC PROJECT                                * 00530999
005310*            REMOVED EN FROM SCREEN AND ADDED DC.  MOFIFIED     * 00531099
005320*            PARAGRAPH 5050- TO CHECK THE TAUDINC TABLE FOR     * 00532099
005321*            PREVIOUS ROLLUP THAT HAD NOT BEEN PAY RELEASED.    * 00532199
005322*            ALSO ADDED PARAGRAPHS: 6200-, 6300-, 6400-, 6500-  * 00532299
005323*            6600-, 6700-, 6800-, 6900-, 7000-, 7100-, 7200-,   * 00532399
005324*            7300-.                                             * 00532499
005325*             BY: ROLF NOHE                      WR: 21578      * 00532599
005326*                                                               * 00532699
005327*  04/17/07  CORRECTED INSERT TO TAUDINC TO INSERT ONLY ONCE    * 00532799
005328*            PER INVOICE.  ALSO REMOVED CODE TO ALLOW ONLY ONE  * 00532899
005329*            ROLLUP PER PAYCYCLE.                               * 00532999
005330*             BY: ROLF NOHE                      WR: P001008831 * 00533099
005331*                                                               * 00533199
005332*  10/22/14  CHANGE MADE: PO EXTENDED DIGIT CHANGES.            * 00533299
005333*            EXTENDED PO# FROM 7 TO 9                           * 00533399
005334*            BY: COGNIZANT                       WR: CHG0094517 * 00533499
005335*                                                               * 00533599
005336*  10/23/17  CHANGE MADE: PO TYPE CD CANNOT BE UPDATED USING    * 00533699
005338*            THIS SCREEN. PART OF PRB0063558. JUST ADDED 'CD'   * 00533899
005339*            TO PARA 1150.                                      * 00533999
005340*            BY: NANCY EILBES                    WR: CHG0182147 * 00534099
005341*  05/11/21  CHANGE MADE: ADD STATUS CODE OF 'PJ' TO CURSOR     * 00534199
005342*            INVOICE-CSR, TO INCLUDE SEPHORA @ KOHLS            * 00534299
005344*            BY: JEAN KURK                       CHG0256545     * 00534499
005345*  09/01/2021                                                     00534599
005346*            - CHANGE CALL OF  DPKUT100  TO                     * 00534699
005347*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00534799
005348*              MAKING THE CALL DYNAMIC VS STATIC                * 00534899
005349*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        00534999
005350*  10/24/22  CHANGE MADE: ADD COPYBOOK DPWS930                  * 00535099
005351*            CHANGE CICS ARCHITECTURE CALL TO USE               * 00535199
005352*            DP930-CICS-ARCH-API                                * 00535299
005353*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864      * 00535399
005355*                                                               * 00535599
005356*---------------------------------------------------------------* 00535699
005357                                                                  00535799
005358 ENVIRONMENT DIVISION.                                            00535899
005359                                                                  00535999
005360 DATA DIVISION.                                                   00536099
005361                                                                  00536199
005362 WORKING-STORAGE SECTION.                                         00536299
005370                                                                  00537099
005380 01  AP-DB2-KEYS.                                                 00538099
005390     15  AP-KEY-PO-NBR                  PIC S9(09)  COMP.         00539099
005400     15  AP-ALP-PO-NBR                  PIC  9(9).                00540099
005500                                                                  00550099
005600 01  PC-PROGRAM-CONSTANTS.                                        00560099
005700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00570099
005800                                                    'AP367A  '.   00580099
005900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00590099
006000                                                    'APKM367 '.   00600099
006100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00610099
006200                                                    'APKCS367'.   00620099
006300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00630099
006400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00640099
006500     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00650099
006600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00660099
006700                                                    COMP SYNC.    00670099
006800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00680099
006900                                                    COMP SYNC.    00690099
007000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00700099
007100                                                    +7000         00710099
007200                                                    COMP-3.       00720099
007300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00730099
007400                                                    COMP SYNC.    00740099
007500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00750099
007600                                                    COMP-3.       00760099
007700*    05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00770099
007800     05  PC-DC-IND                      PIC  X(01)  VALUE 'D'.    00780099
007900     05  PC-BULK-IND                    PIC  X(01)  VALUE 'P'.    00790099
008000*                                                                 00800099
008100     05  PC-TSYMSG-NUMBERS.                                       00810099
008200         10  PC-TSYMSG-00004      PIC 9(5)   VALUE 00004.         00820099
008300         10  PC-TSYMSG-00005      PIC 9(5)   VALUE 00005.         00830099
008400         10  PC-TSYMSG-00007      PIC 9(5)   VALUE 00007.         00840099
008500         10  PC-TSYMSG-00008      PIC 9(5)   VALUE 00008.         00850099
008600         10  PC-TSYMSG-00016      PIC 9(5)   VALUE 00016.         00860099
008700         10  PC-TSYMSG-00046      PIC 9(5)   VALUE 00046.         00870099
008800         10  PC-TSYMSG-00050      PIC 9(5)   VALUE 00050.         00880099
008900         10  PC-TSYMSG-00051      PIC 9(05)  VALUE 00051.         00890099
009000         10  PC-TSYMSG-00052      PIC 9(05)  VALUE 00052.         00900099
009100         10  PC-TSYMSG-00053      PIC 9(05)  VALUE 00053.         00910099
009200         10  PC-TSYMSG-00054      PIC 9(05)  VALUE 00054.         00920099
009300         10  PC-TSYMSG-00055      PIC 9(05)  VALUE 00055.         00930099
009400         10  PC-TSYMSG-00057      PIC 9(05)  VALUE 00057.         00940099
009500         10  PC-TSYMSG-00059      PIC 9(5)   VALUE 00059.         00950099
009600         10  PC-TSYMSG-00069      PIC 9(5)   VALUE 00069.         00960099
009700         10  PC-TSYMSG-00070      PIC 9(5)   VALUE 00070.         00970099
009800         10  PC-TSYMSG-00101      PIC 9(5)   VALUE 00101.         00980099
009900         10  PC-TSYMSG-00170      PIC 9(5)   VALUE 00170.         00990099
010000         10  PC-TSYMSG-00279      PIC 9(5)   VALUE 00279.         01000099
010100         10  PC-TSYMSG-00587      PIC 9(5)   VALUE 00587.         01010099
010200         10  PC-TSYMSG-00726      PIC 9(5)   VALUE 00726.         01020099
010300         10  PC-TSYMSG-00807      PIC 9(5)   VALUE 00807.         01030099
010400         10  PC-TSYMSG-00904      PIC 9(5)   VALUE 00904.         01040099
010500         10  PC-TSYMSG-02417      PIC 9(5)   VALUE 02417.         01050099
010600         10  PC-TSYMSG-03539      PIC 9(5)   VALUE 03539.         01060099
010700*                                                                 01070099
010800 01  PS-PROGRAM-SWITCHES.                                         01080099
010900     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01090099
011000         88  PS-NO-ERROR                            VALUE 'Y'.    01100099
011100         88  PS-ERROR                               VALUE 'N'.    01110099
011200     05  PS-WARNING-SW                  PIC  X(01)  VALUE 'Y'.    01120099
011300         88  PS-NO-WARNING                          VALUE 'Y'.    01130099
011400         88  PS-WARNING                             VALUE 'N'.    01140099
011500     05  PS-HOLD-ERROR-SW               PIC  X(01)  VALUE 'Y'.    01150099
011600         88  PS-HOLD-NO-ERROR                       VALUE 'Y'.    01160099
011700         88  PS-HOLD-ERROR                          VALUE 'N'.    01170099
011800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01180099
011900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01190099
012000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01200099
012100     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01210099
012200         88  PS-DONE                                VALUE 'Y'.    01220099
012300         88  PS-NOT-DONE                            VALUE 'N'.    01230099
012400     05  PS-SEL-SW                      PIC  X(01)  VALUE 'N'.    01240099
012500         88  PS-SEL-YES                             VALUE 'Y'.    01250099
012600         88  PS-SEL-NO                              VALUE 'N'.    01260099
012700     05  PS-TPURCHS-FOUND-SW            PIC X(01)   VALUE 'N'.    01270099
012800         88  PS-TPURCHS-FOUND                       VALUE 'Y'.    01280099
012900         88  PS-TPURCHS-NOT-FOUND                   VALUE 'N'.    01290099
013000     05  PS-NINREC-END-OF-CSR-SW        PIC X(01)   VALUE 'N'.    01300099
013100         88  NINREC-END-OF-CSR                      VALUE 'Y'.    01310099
013200     05  PS-BULK-ROLLUP-SW              PIC X(01)   VALUE 'N'.    01320099
013300         88  PS-BULK-ROLLUP-OKAY                    VALUE 'Y'.    01330099
013400         88  PS-BULK-ROLLUP-NOT-OKAY                VALUE 'N'.    01340099
013500     05  PS-ROW-EXISTS-SW               PIC X(01)   VALUE 'N'.    01350099
013600         88  PS-ROW-EXISTS                          VALUE 'Y'.    01360099
013700         88  PS-NO-ROW-EXISTS                       VALUE 'N'.    01370099
013800     05  PS-FIRST-TIME-SW               PIC X(01)   VALUE 'N'.    01380099
013810         88  PS-FIRST-TIME                          VALUE 'Y'.    01381099
013820         88  PS-NOT-FIRST-TIME                      VALUE 'N'.    01382099
013830     05  PS-AUDINC-END-OF-CSR-SW        PIC X(01)   VALUE 'N'.    01383099
013840         88  PS-AUDINC-END-OF-CSR                   VALUE 'Y'.    01384099
013850         88  PS-NOT-AUDINC-END-OF-CSR               VALUE 'N'.    01385099
013860*                                                                 01386099
013870 01  PV-PROGRAM-VARIABLES.                                        01387099
013880     05  PV-SUB                         PIC S9(04)  VALUE +0      01388099
013890                                                    COMP SYNC.    01389099
013900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01390099
014000                                                    COMP SYNC.    01400099
014100     05  PV-POSTRR-COUNT                PIC S9(9)   COMP.         01410099
014200     05  PV-EFF-DTE.                                              01420099
014300         10  PV-MONTH                   PIC X(02)   VALUE SPACES. 01430099
014400         10  PV-FILLER-1                PIC X(01)   VALUE '/'.    01440099
014500         10  PV-DAY                     PIC X(02)   VALUE SPACES. 01450099
014600         10  PV-FILLER-2                PIC X(01)   VALUE '/'.    01460099
014700         10  PV-CENTURY                 PIC X(02)   VALUE SPACES. 01470099
014800         10  PV-YEAR                    PIC X(02)   VALUE SPACES. 01480099
014900     05  PV-EFFECTIVE-DATE.                                       01490099
015000         10  PV-CC                      PIC X(02)   VALUE ZERO.   01500099
015100         10  PV-YY                      PIC X(02)   VALUE ZERO.   01510099
015200         10  PV-FILLER                  PIC X(01)   VALUE '-'.    01520099
015300         10  PV-MM                      PIC X(02)   VALUE ZERO.   01530099
015400         10  PV-FILLER                  PIC X(01)   VALUE '-'.    01540099
015500         10  PV-DD                      PIC X(02)   VALUE ZERO.   01550099
015600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01560099
015700                                                    COMP-3.       01570099
015800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01580099
015900                                                    COMP-3.       01590099
016000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01600099
016100                                                    COMP-3.       01610099
016200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01620099
016300                                                    COMP-3.       01630099
016400     05  PV-NEXT-TOP-ITEM               PIC S9(09)  VALUE +0      01640099
016500                                                    COMP-3.       01650099
016600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01660099
016700                                                    COMP-3.       01670099
016800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01680099
016900                                                    COMP-3.       01690099
017000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01700099
017100                                                    COMP-3.       01710099
017200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01720099
017300                                                    COMP SYNC.    01730099
017400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01740099
017500                                                    COMP SYNC.    01750099
017600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01760099
017700                                                    COMP SYNC.    01770099
017800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01780099
017900                                                    COMP SYNC.    01790099
018000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01800099
018100                                                    COMP SYNC.    01810099
018200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01820099
018300                                                    COMP SYNC.    01830099
018400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01840099
018500                                                    COMP SYNC.    01850099
018600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01860099
018700                                                    COMP SYNC.    01870099
018800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01880099
018900                                                    COMP SYNC.    01890099
019000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01900099
019100                                                    COMP SYNC.    01910099
019200     05  PV-EFF-END-DTE-IND             PIC S9(04)  VALUE -1      01920099
019300                                        COMP.                     01930099
019400     05  PV-CURRENT-TMST                PIC  X(26)  VALUE SPACES. 01940099
019500     05  PV-PAYT-REQ-SEQ-NBR            PIC S9(09)   VALUE +0     01950099
019600                                                     COMP.        01960099
019700     05  PV-SQL-SUB                     PIC S9(4)    COMP.        01970099
019800     05  PV-DATE-FORMAT-DB2.                                      01980099
019900         10  PV-DATE-DB2-CC             PIC X(02)   VALUE SPACES. 01990099
020000         10  PV-DATE-DB2-YY             PIC X(02)   VALUE SPACES. 02000099
020100         10  FILLER                     PIC X(01)   VALUE SPACES. 02010099
020200         10  PV-DATE-DB2-MM             PIC X(02)   VALUE SPACES. 02020099
020300         10  FILLER                     PIC X(01)   VALUE SPACES. 02030099
020400         10  PV-DATE-DB2-DD             PIC X(02)   VALUE SPACES. 02040099
020500     05  PV-DATE-FORMAT.                                          02050099
020600         10  PV-DATE-MM                 PIC X(02)   VALUE SPACES. 02060099
020700         10  FILLER                     PIC X(01)   VALUE '/'.    02070099
020800         10  PV-DATE-DD                 PIC X(02)   VALUE SPACES. 02080099
020900         10  FILLER                     PIC X(01)   VALUE '/'.    02090099
021000         10  PV-DATE-CC                 PIC X(02)   VALUE SPACES. 02100099
021100         10  PV-DATE-YY                 PIC X(02)   VALUE SPACES. 02110099
021200     05  PV-PO-NBR                      PIC  S9(9)  COMP VALUE 0. 02120099
021300     05  PV-VER-NBR                     PIC  S9(9)  COMP VALUE 0. 02130099
021400     05  PV-PO-LNE-NBR                  PIC  S9(9)  COMP VALUE 0. 02140099
021500     05  PV-NON-INVC-SEQ-NBR            PIC  S9(9)  COMP VALUE 0. 02150099
021600     05  PV-STR-NBR                     PIC  S9(4)  COMP VALUE 0. 02160099
021610     05  PV-DC-NBR                      PIC  S9(4)  COMP VALUE 0. 02161099
021620     05  PV-NON-INVC-UNT-QTY            PIC  S9(9)  COMP VALUE 0. 02162099
021630     05  PV-UNT-COST-AMT                PIC  S9(7)V9(3)           02163099
021640                                              COMP-3 VALUE 0.     02164099
021650     05  PV-PAYT-RLSE-TMST              PIC   X(26) VALUE SPACES. 02165099
021660     05  PV-STATUS-CDE                  PIC   X(2)  VALUE SPACES. 02166099
021670     05  PV-PAYT-DTE                    PIC   X(10) VALUE SPACES. 02167099
021680     05  PV-REC-TMST                    PIC   X(26) VALUE SPACES. 02168099
021690     05  PV-ORIG-DISC-PCT               PIC  SV9(4)               02169099
021691                                              COMP-3 VALUE 0.     02169199
021692     05  PV-RANDOM-KEY                  PIC 9(09)   VALUE ZERO.   02169299
021693     05  FILLER  REDEFINES PV-RANDOM-KEY.                         02169399
021694         10  PV-RANDOM-KEY-NANOSEC-1    PIC X(03).                02169499
021695         10  PV-RANDOM-KEY-NANOSEC-2    PIC X(03).                02169599
021696         10  PV-RANDOM-KEY-MINUTE       PIC X(02).                02169699
021697         10  PV-RANDOM-KEY-SECOND       PIC X(01).                02169799
021698                                                                  02169899
021699     05  PV-RANDOM-KEY-INT              PIC S9(9)                 02169999
021700                                              VALUE ZERO COMP.    02170099
021701     05  PV-INVC-NBR-SAVE               PIC  X(22)  VALUE SPACES. 02170199
021702     05  PV-CURR-WK-END-DATE            PIC  X(10)  VALUE SPACES. 02170299
021703     05  PV-CURR-WK-END-DTE REDEFINES PV-CURR-WK-END-DATE.        02170399
021704         10  PV-CURR-WK-END-DTE-CC      PIC  X(02).               02170499
021705         10  PV-CURR-WK-END-DTE-YY      PIC  X(02).               02170599
021706         10  FILLER                     PIC  X(01).               02170699
021707         10  PV-CURR-WK-END-DTE-MM      PIC  X(02).               02170799
021708         10  FILLER                     PIC  X(01).               02170899
021709         10  PV-CURR-WK-END-DTE-DD      PIC  X(02).               02170999
021710     05  PV-CURR-WEEK-END-DATE.                                   02171099
021711         10  PV-CURR-WEEK-END-DATE-CC   PIC  X(02).               02171199
021712         10  PV-CURR-WEEK-END-DATE-YY   PIC  X(02).               02171299
021713         10  PV-CURR-WEEK-END-DATE-MM   PIC  X(02).               02171399
021714         10  PV-CURR-WEEK-END-DATE-DD   PIC  X(02).               02171499
021715     05  PV-CURR-WK-END-DD-NUM          PIC  9(02)  VALUE ZERO.   02171599
021716     05  PV-CURR-WED-DD-NUM             PIC  9(02)  VALUE ZERO.   02171699
021717     05  PV-AUDINC-TIMESTAMP            PIC  X(26)  VALUE SPACES. 02171799
021718     05  PV-AUDINC-TMST REDEFINES PV-AUDINC-TIMESTAMP.            02171899
021719         10  PV-AUDINC-TMST-CC          PIC  X(02).               02171999
021720         10  PV-AUDINC-TMST-YY          PIC  X(02).               02172099
021730         10  FILLER                     PIC  X(01).               02173099
021731         10  PV-AUDINC-TMST-MM          PIC  X(02).               02173199
021732         10  FILLER                     PIC  X(01).               02173299
021733         10  PV-AUDINC-TMST-DD          PIC  X(02).               02173399
021734         10  FILLER                     PIC  X(16).               02173499
021735     05  PV-AUDINC-DATE.                                          02173599
021736         10  PV-AUDINC-DATE-CC          PIC  X(02).               02173699
021737         10  PV-AUDINC-DATE-YY          PIC  X(02).               02173799
021738         10  PV-AUDINC-DATE-MM          PIC  X(02).               02173899
021739         10  PV-AUDINC-DATE-DD          PIC  X(02).               02173999
021740     05  PV-CURRENT-TIMESTAMP           PIC  X(26)  VALUE SPACES. 02174099
021741     05  PV-CURRENT-TIMESTMP REDEFINES PV-CURRENT-TIMESTAMP.      02174199
021742         10  PV-CURRENT-TIMESTMP-CC     PIC  X(02).               02174299
021743         10  PV-CURRENT-TIMESTMP-YY     PIC  X(02).               02174399
021744         10  FILLER                     PIC  X(01).               02174499
021745         10  PV-CURRENT-TIMESTMP-MM     PIC  X(02).               02174599
021746         10  FILLER                     PIC  X(01).               02174699
021747         10  PV-CURRENT-TIMESTMP-DD     PIC  X(02).               02174799
021748         10  FILLER                     PIC  X(16).               02174899
021749     05  PV-CURRENT-DATE.                                         02174999
021750         10  PV-CURRENT-DATE-CC         PIC  X(02).               02175099
021751         10  PV-CURRENT-DATE-YY         PIC  X(02).               02175199
021752         10  PV-CURRENT-DATE-MM         PIC  X(02).               02175299
021753         10  PV-CURRENT-DATE-DD         PIC  X(02).               02175399
021754     05  PV-MTCH-LVL-IND                PIC  X(01)  VALUE SPACES. 02175499
021755     05  PV-SAVE-INVC-NBR               PIC  X(22)  VALUE SPACES. 02175599
021756     05  PV-SAVE-AUD-TMST               PIC  X(26)  VALUE SPACES. 02175699
021757     05  PV-SAVE-MTCH-LVL-CDE           PIC  X(01)  VALUE SPACES. 02175799
021758     05  PV-SAVE-DC-NBR                 PIC  S9(4)  COMP VALUE 0. 02175899
021759                                                                  02175999
021760 01  KEY-TIMESTAMP                      PIC X(26)   VALUE SPACES. 02176099
021761 01  FILLER  REDEFINES KEY-TIMESTAMP.                             02176199
021762     05  FILLER                         PIC X(14).                02176299
021763     05  KEY-MINUTE                     PIC X(02).                02176399
021764     05  FILLER                         PIC X(02).                02176499
021765     05  KEY-SECOND                     PIC X(01).                02176599
021766     05  FILLER                         PIC X(01).                02176699
021767     05  KEY-NANOSEC-1                  PIC X(03).                02176799
021768     05  KEY-NANOSEC-2                  PIC X(03).                02176899
021769******************************************************************02176999
021770**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02177099
021771**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02177199
021772**  APPLICATION-SPECIFIC COMMAREA.                              **02177299
021773******************************************************************02177399
021774 01  LQW-LIST-QUEUE-WORK-AREA.                                    02177499
021775     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02177599
021776     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           02177699
021777                                        INDEXED BY LQW-IDX.       02177799
021778         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02177899
021779         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02177999
021780             88  LQW-TEMP-SELECT                    VALUE 'S'.    02178099
021790             88  LQW-TEMP-DESELECT                  VALUE ' '.    02179099
021800         10  LQW-SELECTED-SW            PIC  X(01).               02180099
021900             88  LQW-SELECT                         VALUE 'S'.    02190099
022000             88  LQW-DESELECT                       VALUE ' '.    02200099
022100         10  LQW-PAYT-REQ-SEQ-NBR       PIC S9(09)                02210099
022200                                             COMP.                02220099
022300         10  LQW-ITEM-UPD-SW            PIC  X.                   02230099
022400             88  LQW-ITEM-UPD          VALUE 'Y'.                 02240099
022500         10  LQW-INVC-NBR               PIC  X(22).               02250099
022600         10  LQW-INVC-DTE               PIC  X(10).               02260099
022700         10  LQW-STR-NBR                PIC S9(04)                02270099
022800                                             COMP.                02280099
022900         10  LQW-DC-NBR                 PIC S9(04)                02290099
023000                                             COMP.                02300099
023100         10  LQW-MTCH-LVL-CDE           PIC  X(01).               02310099
023200         10  LQW-DIR-STR-IND            PIC  X(01).               02320099
023300         10  LQW-TYPE                   PIC  X(02).               02330099
023400         10  LQW-STATUS                 PIC  X(02).               02340099
023500         10  LQW-GROSS-AMT              PIC S9(09)V99             02350099
023600                                             COMP-3.              02360099
023700         10  LQW-ENTR-DTE               PIC  X(10).               02370099
023800                                                                  02380099
023900 01  HOLD-FIELDS.                                                 02390099
024000     05  HOLD-PO-NBR                    PIC S9(09) COMP VALUE 0.  02400099
024100     05  HOLD-PO-LNE-NBR                PIC  S9(9) COMP VALUE 0.  02410099
024200     05  HOLD-UNT-COST-AMT              PIC S9(7)V9(3)            02420099
024300                                             COMP-3 VALUE 0.      02430099
024400                                                                  02440099
024500 01  ACCUM-FIELDS.                                                02450099
024600     05  ACCUM-QTY                      PIC S9(09) COMP VALUE 0.  02460099
024700     05  TOTAL-PO-COST                  PIC S9(7)V9(3)            02470099
024710                                             COMP-3 VALUE 0.      02471099
024720     05  TOTAL-LNE-COST                 PIC S9(7)V9(3)            02472099
024730                                             COMP-3 VALUE 0.      02473099
024740                                                                  02474099
024741*---------------------------------------------------------------* 02474199
024742*  RECORD LAYOUT FOR THE TAX SELECTION TEMP STORAGE QUEUE.      * 02474299
024743*---------------------------------------------------------------* 02474399
024744                                                                  02474499
024745                                                                  02474599
024746*---------------------------------------------------------------* 02474699
024747*    MAP LAYOUT                                                 * 02474799
024748*---------------------------------------------------------------* 02474899
024749                                                                  02474999
024750     COPY APKM367.                                                02475099
024760*                                                                 02476099
024770 01  MR-OCCURS-LAYOUT                   REDEFINES  AP367AO.       02477099
024780     05  FILLER                         PIC X(95).                02478099
024790     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02479099
024800         10  MR-SELECTL                 PIC S9(04) COMP.          02480099
024900         10  MR-SELECTA                 PIC  X(01).               02490099
025000         10  MR-SELECTC                 PIC  X(01).               02500099
025100         10  MR-SELECTH                 PIC  X(01).               02510099
025200         10  MR-SELECT                  PIC  X(01).               02520099
025300                                                                  02530099
025400         10  MR-INVC-NBRL               PIC S9(04) COMP.          02540099
025500         10  MR-INVC-NBRA               PIC X(01).                02550099
025600         10  MR-INVC-NBRC               PIC X(01).                02560099
025700         10  MR-INVC-NBRH               PIC X(01).                02570099
025800         10  MR-INVC-NBR                PIC X(14).                02580099
025900                                                                  02590099
026000         10  MR-INVC-DTEL               PIC S9(04) COMP.          02600099
026100         10  MR-INVC-DTEA               PIC X(01).                02610099
026200         10  MR-INVC-DTEC               PIC X(01).                02620099
026300         10  MR-INVC-DTEH               PIC X(01).                02630099
026400         10  MR-INVC-DTE                PIC X(10).                02640099
026500                                                                  02650099
026600         10  MR-STR-NBRL                PIC S9(04) COMP.          02660099
026700         10  MR-STR-NBRA                PIC X(01).                02670099
026800         10  MR-STR-NBRC                PIC X(01).                02680099
026900         10  MR-STR-NBRH                PIC X(01).                02690099
027000         10  MR-STR-NBR-X.                                        02700099
027100             15  MR-STR-NBR-N           PIC 9(04).                02710099
027200                                                                  02720099
027300         10  MR-DC-NBRL                 PIC S9(04) COMP.          02730099
027400         10  MR-DC-NBRA                 PIC X(01).                02740099
027500         10  MR-DC-NBRC                 PIC X(01).                02750099
027600         10  MR-DC-NBRH                 PIC X(01).                02760099
027700         10  MR-DC-NBR-X.                                         02770099
027800             15  MR-DC-NBR-N            PIC 9(04).                02780099
027900                                                                  02790099
028000         10  MR-TYPEL                   PIC S9(04) COMP.          02800099
028100         10  MR-TYPEA                   PIC X(01).                02810099
028200         10  MR-TYPEC                   PIC X(01).                02820099
028300         10  MR-TYPEH                   PIC X(01).                02830099
028400         10  MR-TYPE                    PIC X(02).                02840099
028500                                                                  02850099
028600         10  MR-STATUSL                 PIC S9(04) COMP.          02860099
028700         10  MR-STATUSA                 PIC X(01).                02870099
028800         10  MR-STATUSC                 PIC X(01).                02880099
028900         10  MR-STATUSH                 PIC X(01).                02890099
029000         10  MR-STATUS                  PIC X(02).                02900099
029100                                                                  02910099
029200         10  MR-MTCH-LVLL               PIC S9(04) COMP.          02920099
029300         10  MR-MTCH-LVLA               PIC X(01).                02930099
029400         10  MR-MTCH-LVLC               PIC X(01).                02940099
029500         10  MR-MTCH-LVLH               PIC X(01).                02950099
029600         10  MR-MTCH-LVL                PIC X(01).                02960099
029700                                                                  02970099
029800         10  MR-GROSS-AMTL              PIC S9(04) COMP.          02980099
029900         10  MR-GROSS-AMTA              PIC X(01).                02990099
030000         10  MR-GROSS-AMTC              PIC X(01).                03000099
030100         10  MR-GROSS-AMTH              PIC X(01).                03010099
030200         10  MR-GROSS-AMT-X.                                      03020099
030300             15  MR-GROSS-AMT-N         PIC Z,ZZZ,ZZ9.99.         03030099
030400                                                                  03040099
030500         10  MR-ENTR-DTEL               PIC S9(04) COMP.          03050099
030600         10  MR-ENTR-DTEA               PIC X(01).                03060099
030700         10  MR-ENTR-DTEC               PIC X(01).                03070099
030800         10  MR-ENTR-DTEH               PIC X(01).                03080099
030900         10  MR-ENTR-DTE                PIC X(10).                03090099
031000                                                                  03100099
031100*---------------------------------------------------------------* 03110099
031200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03120099
031300*---------------------------------------------------------------* 03130099
031400                                                                  03140099
031500     COPY DPWS015.                                                03150099
031600                                                                  03160099
031700*---------------------------------------------------------------* 03170099
031800*    FUNCTION KEYS COPYBOOK.                                    * 03180099
031900*---------------------------------------------------------------* 03190099
032000                                                                  03200099
032100     COPY DPWS016.                                                03210099
032200                                                                  03220099
032300*---------------------------------------------------------------* 03230099
032400*    NUMERIC EDIT LAYOUT.                                       * 03240099
032500*---------------------------------------------------------------* 03250099
032600                                                                  03260099
032700     COPY DPWS010I.                                               03270099
032800                                                                  03280099
032900*---------------------------------------------------------------* 03290099
033000*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 03300099
033100*---------------------------------------------------------------* 03310099
033200                                                                  03320099
033300     COPY DPWS030.                                                03330099
033310     COPY DPWS930.                                                03331099
033400                                                                  03340099
033500*---------------------------------------------------------------* 03350099
033600*    STANDARD COMMAREA.                                         * 03360099
033700*---------------------------------------------------------------* 03370099
033800                                                                  03380099
033900     COPY DPWS020.                                                03390099
034000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03400099
034100                                                                  03410099
034200*---------------------------------------------------------------* 03420099
034300* INTER-APPLICATION COMMAREA.                                   * 03430099
034400*---------------------------------------------------------------* 03440099
034500                                                                  03450099
034600         10  INTER-APPL-COMM-AREA       PIC X(200).               03460099
034700     COPY APWS300.                                                03470099
034800*---------------------------------------------------------------* 03480099
034900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03490099
035000*---------------------------------------------------------------* 03500099
035100         10  ASC-SPECIFIC-COMMAREA.                               03510099
035200             15  ASC-LIST-KEYS.                                   03520099
035300                 20  ASC-KEY-PO-NBR                  PIC S9(09)   03530099
035400                                                     COMP.        03540099
035500                 20  ASC-ALP-PO-NBR                  PIC  9(9).   03550099
035600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03560099
035700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03570099
035800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03580099
035900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03590099
036000                                                                  03600099
036100                 20  ASC-ITEM-ARRAY.                              03610099
036200                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03620099
036300                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   03630099
036400                                                     COMP-3.      03640099
036500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03650099
036600                             88  ASC-VALID-SELECT    VALUE ' '    03660099
036700                                                           'S'.   03670099
036800                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03680099
036900                             88  ASC-TEMP-SELECT     VALUE 'S'.   03690099
037000                         30  ASC-SELECTED-SW         PIC  X(01).  03700099
037100                             88  ASC-NO-SELECT       VALUE ' '.   03710099
037200                             88  ASC-SELECT          VALUE 'S'.   03720099
037300                         30  ASC-PAYT-REQ-SEQ-NBR    PIC S9(09)   03730099
037400                                                          COMP.   03740099
037500                         30  ASC-ITEM-UPD-SW         PIC  X.      03750099
037600                             88  ASC-ITEM-UPD         VALUE 'Y'.  03760099
037700                         30  ASC-INVC-NBR            PIC  X(22).  03770099
037800                         30  ASC-INVC-DTE            PIC  X(10).  03780099
037900                         30  ASC-STR-NBR             PIC S9(04)   03790099
038000                                                          COMP.   03800099
038100                         30  ASC-DC-NBR              PIC S9(04)   03810099
038200                                                          COMP.   03820099
038300                         30  ASC-MTCH-LVL-CDE        PIC  X(01).  03830099
038400                         30  ASC-DIR-STR-IND         PIC  X(01).  03840099
038500                         30  ASC-TYPE                PIC  X(02).  03850099
038600                         30  ASC-STATUS              PIC  X(02).  03860099
038700                         30  ASC-GROSS-AMT           PIC S9(09)V9903870099
038710                                                          COMP-3. 03871099
038720                         30  ASC-ENTR-DTE            PIC  X(10).  03872099
038730                                                                  03873099
038740             15  ASC-BLK-SUB                         PIC S9(04)   03874099
038750                                                          COMP    03875099
038760                                                          SYNC.   03876099
038770             15  ASC-ITEM-SUB                        PIC S9(04)   03877099
038780                                                          COMP    03878099
038790                                                          SYNC.   03879099
038800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03880099
038900                                                          COMP-3. 03890099
039000             15  ASC-NBR-OF-ITEMS-IN-DB              PIC S9(09)   03900099
039100                                                          COMP-3. 03910099
039200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03920099
039300                                                          COMP-3. 03930099
039400             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03940099
039500                                                          COMP-3. 03950099
039600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03960099
039700                                                          COMP-3. 03970099
039800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03980099
039900                                                          COMP-3. 03990099
040000             15  ASC-ITEMS-UPDATED                   PIC S9(03)   04000099
040100                                                         COMP-3.  04010099
040200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04020099
040300                                                          COMP    04030099
040400                                                          SYNC.   04040099
040500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04050099
040600                                                          COMP-3. 04060099
040700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04070099
040800                                                          COMP-3. 04080099
040900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04090099
041000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04100099
041100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04110099
041200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04120099
041300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04130099
041400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04140099
041500             15  ASC-LIST-QUEUE-NAME.                             04150099
041600                 20  ASC-LIST-TERM-ID                PIC  X(04).  04160099
041700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04170099
041800                                                          COMP-3. 04180099
041900                 20  ASC-LIST-SEQ                    PIC  9(01).  04190099
042000             15  ASC-SEL-QUEUE-NAME.                              04200099
042100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04210099
042200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04220099
042300                                                          COMP-3. 04230099
042400                 20  ASC-SEL-SEQ                     PIC  9(01).  04240099
042500             15  ASC-START-ITEM-REQUEST.                          04250099
042600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04260099
042700             15  ASC-CURRENT-ITEM-ID                 PIC  S9(04)  04270099
042800                                                          COMP.   04280099
042900             15  ASC-AT-ITEM                         PIC S9(04)   04290099
043000                                                      COMP SYNC.  04300099
043100             15  ASC-SWITCHS.                                     04310099
043200                 20 ASC-REQUEST-SW                   PIC X(03).   04320099
043300                     88 ASC-UPDATE-NOT-COMPLETED    VALUE 'NOT'.  04330099
043400                     88 ASC-UPDATE-COMPLETED        VALUE 'CMP'.  04340099
043500             15  ASC-OTHER-FILEDS.                                04350099
043600                 20  ASC-VENDOR-NBR                  PIC  9(09).  04360099
043700                 20  ASC-VENDOR-NAME                 PIC  X(14).  04370099
043800                 20  ASC-CURRENT-TIMESTAMP           PIC  X(26).  04380099
043900                 20  ASC-CURRENT-TS-RDF              REDEFINES    04390099
044000                     ASC-CURRENT-TIMESTAMP.                       04400099
044100                     25  ASC-CURRENT-DATE            PIC X(10).   04410099
044200                     25  FILLER                      PIC X(01).   04420099
044300                     25  ASC-CURRENT-TIME.                        04430099
044400                         30  ASC-HH                  PIC 9(02).   04440099
044500                         30  FILLER                  PIC X(01).   04450099
044600                         30  ASC-MIN                 PIC 9(02).   04460099
044700                         30  FILLER                  PIC X(01).   04470099
044800                         30  ASC-SEC                 PIC 9(02).   04480099
044900                         30  FILLER                  PIC X(01).   04490099
045000                         30  ASC-MILLI-SEC           PIC 9(06).   04500099
045100                 20  ASC-WORK-TIMESTAMP              PIC X(26).   04510099
045110                 20  ASC-TS-RDF                      REDEFINES    04511099
045120                     ASC-WORK-TIMESTAMP.                          04512099
045130                     25  FILLER                      PIC X(20).   04513099
045140                     25  ASC-MILLISECONDS            PIC 9(06).   04514099
045150                                                                  04515099
045160*---------------------------------------------------------------* 04516099
045170*    ABEND PROCESSING COPYBOOK.                                 * 04517099
045180*---------------------------------------------------------------* 04518099
045190     COPY DPWS013.                                                04519099
045191                                                                  04519199
045192*---------------------------------------------------------------* 04519299
045193*    DB2 AREA FOR INVOICE TABLE                                 * 04519399
045194*---------------------------------------------------------------* 04519499
045195     EXEC SQL                                                     04519599
045196          INCLUDE TINVOIC                                         04519699
045197     END-EXEC.                                                    04519799
045198                                                                  04519899
045199*---------------------------------------------------------------* 04519999
045200*    DB2 AREA FOR PURCHASE TABLE                                * 04520099
045300*---------------------------------------------------------------* 04530099
045400     EXEC SQL                                                     04540099
045500          INCLUDE TPURCHS                                         04550099
045600     END-EXEC.                                                    04560099
045700                                                                  04570099
045800*---------------------------------------------------------------* 04580099
045900*    DB2 AREA FOR EXTERNAL ENTERPRISE TABLE                     * 04590099
046000*---------------------------------------------------------------* 04600099
046100     EXEC SQL                                                     04610099
046200          INCLUDE TEXTENT                                         04620099
046300     END-EXEC.                                                    04630099
046400                                                                  04640099
046500*---------------------------------------------------------------* 04650099
046600*    DB2 AREA FOR EXTERNAL ENTERPRISE NAME TABLE                * 04660099
046700*---------------------------------------------------------------* 04670099
046800     EXEC SQL                                                     04680099
046900          INCLUDE TENTNME                                         04690099
047000     END-EXEC.                                                    04700099
047100                                                                  04710099
047200*---------------------------------------------------------------* 04720099
047300*    DB2 AREA FOR RELEASED PO/STORES TABLE                      * 04730099
047400*---------------------------------------------------------------* 04740099
047500     EXEC SQL                                                     04750099
047600          INCLUDE TPOSTRR                                         04760099
047700     END-EXEC.                                                    04770099
047800                                                                  04780099
047900*-----------------------------------------------------------      04790099
048000*  DCLGEN FOR TNINREC                                             04800099
048100*-----------------------------------------------------------      04810099
048200     EXEC SQL                                                     04820099
048300          INCLUDE TNINREC                                         04830099
048400     END-EXEC.                                                    04840099
048500                                                                  04850099
048600*-----------------------------------------------------------      04860099
048700*  DCLGEN FOR TAUDINC                                             04870099
048800*-----------------------------------------------------------      04880099
048900     EXEC SQL                                                     04890099
049000          INCLUDE TAUDINC                                         04900099
049100     END-EXEC.                                                    04910099
049200                                                                  04920099
049300*-----------------------------------------------------------      04930099
049400*  DCLGEN FOR TAPCNTL                                             04940099
049500*-----------------------------------------------------------      04950099
049600     EXEC SQL                                                     04960099
049700          INCLUDE TAPCNTL                                         04970099
049800     END-EXEC.                                                    04980099
049900                                                                  04990099
049910*---------------------------------------------------------------* 04991099
049920*    DB2 AREA FOR COMMUNICATIONS                                * 04992099
049930*---------------------------------------------------------------* 04993099
049940     EXEC SQL                                                     04994099
049950          INCLUDE SQLCA                                           04995099
049960     END-EXEC.                                                    04996099
049970                                                                  04997099
049980*---------------------------------------------------------------* 04998099
049990*    CURSOR THAT BRINGS BACK ALL ELIGIBLE INVOICES              * 04999099
050000*---------------------------------------------------------------* 05000099
050100                                                                  05010099
050200     EXEC SQL                                                     05020099
050300          DECLARE INVOICE-CSR CURSOR                              05030099
050400          FOR SELECT                                              05040099
050500                I.PAYT_REQ_SEQ_NBR                                05050099
050600               ,I.INVC_ID                                         05060099
050700               ,I.INVC_DTE                                        05070099
050800               ,I.STR_NBR                                         05080099
050900               ,I.INVC_TYP_CDE                                    05090099
051000               ,I.STATUS_CDE                                      05100099
051100               ,I.GRO_COST_AMT                                    05110099
051200               ,I.DC_NBR                                          05120099
051300               ,I.MTCH_LVL_CDE                                    05130099
051400               ,I.CRE_DTE                                         05140099
051500          FROM  TINVOIC I                                         05150099
051600          WHERE I.PO_NBR           = :ASC-KEY-PO-NBR              05160099
051700*           AND I.STATUS_CDE       IN ('EN','RC','OB','IB')       05170099
051710            AND I.STATUS_CDE       IN ('EN','RC','OB','IB','PJ')  05171099
051800            AND I.INVC_TYP_CDE     IN ('MI','RI')                 05180099
051900            AND I.STR_NBR      NOT IN (000)                       05190099
052000          ORDER BY                                                05200099
052100                I.INVC_ID                                         05210099
052200     END-EXEC.                                                    05220099
052300                                                                  05230099
052400                                                                  05240099
052500*-----------------------------------------------------------      05250099
052600*    NINREC CURSOR                                                05260099
052700*-----------------------------------------------------------      05270099
052800     EXEC SQL                                                     05280099
052900       DECLARE NINREC_CSR CURSOR FOR                              05290099
053000         SELECT PO_NBR                                            05300099
053100               ,VER_NBR                                           05310099
053200               ,PO_LNE_NBR                                        05320099
053300               ,NON_INVC_SEQ_NBR                                  05330099
053310               ,STR_NBR                                           05331099
053320               ,NON_INVC_UNT_QTY                                  05332099
053330               ,UNT_COST_AMT                                      05333099
053340               ,PAYT_RLSE_TMST                                    05334099
053350               ,STATUS_CDE                                        05335099
053360               ,PAYT_DTE                                          05336099
053370               ,REC_TMST                                          05337099
053380               ,ORIG_DISC_PCT                                     05338099
053390               ,DC_NBR                                            05339099
053391          FROM TNINREC                                            05339199
053392         WHERE PO_NBR = :ASC-KEY-PO-NBR                           05339299
053393           AND STATUS_CDE = '  '                                  05339399
053394         ORDER BY PO_NBR                                          05339499
053395                , PO_LNE_NBR                                      05339599
053396                , UNT_COST_AMT                                    05339699
053397     END-EXEC.                                                    05339799
053398                                                                  05339899
053399                                                                  05339999
053400 LINKAGE SECTION.                                                 05340099
053410                                                                  05341099
053420 01  DFHCOMMAREA.                                                 05342099
053430     05  FILLER                         OCCURS  1 TO 4072 TIMES   05343099
053440                                        DEPENDING ON EIBCALEN.    05344099
053450         10  FILLER                     PIC X.                    05345099
053460                                                                  05346099
053470 PROCEDURE DIVISION.                                              05347099
053480******************************************************************05348099
053490**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05349099
053500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05350099
053600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05360099
053700******************************************************************05370099
053800 0000-MAIN-MODULE.                                                05380099
053900     INITIALIZE DP030-CICS-API-FIELDS.                            05390099
054000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05400099
054100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05410099
054200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05420099
054300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05430099
054400     MOVE LENGTH OF AP367AI        TO DP030-MAP-LENGTH (1).       05440099
054500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05450099
054600     PERFORM 0001-CALL-CICS-ARCH-API.                             05460099
054700*                                                                 05470099
054800     EXEC SQL                                                     05480099
054900         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 05490099
055000     END-EXEC.                                                    05500099
055100*                                                                 05510099
055200     PERFORM 1000-CONTROL-PROCESSING                              05520099
055300*                                                                 05530099
055400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05540099
055500     PERFORM 0001-CALL-CICS-ARCH-API.                             05550099
055600                                                                  05560099
055700******************************************************************05570099
055800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05580099
055900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05590099
056000******************************************************************05600099
056100 0001-CALL-CICS-ARCH-API.                                         05610099
056200     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     05620099
056300                                     DFHCOMMAREA                  05630099
056400                                     DP030-CICS-API-FIELDS        05640099
056500                                     DP020-STANDARD-COMMAREA      05650099
056600                                     AP367AI.                     05660099
056700*                                                                 05670099
056800     IF  DP030-RC-CALL-SUCCESSFUL                                 05680099
056900         CONTINUE                                                 05690099
057000     ELSE                                                         05700099
057100         SET DP013-NO-ROLLBACK                                    05710099
057200             DP013-XCTL-DISPLAY-RESTART                           05720099
057300             DP013-CICS-ABEND      TO TRUE                        05730099
057400         MOVE '0001-CALL-CICS-ARCH-API'                           05740099
057500                                   TO DP013-PARAGRAPH             05750099
057710         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05771099
057720-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05772099
057800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05780099
057900         PERFORM DP013-0000-PROCESS-ABEND                         05790099
058000     END-IF.                                                      05800099
058100*----------------------------------------------------------------*05810099
058200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05820099
058300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05830099
058400*                                                                *05840099
058500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05850099
058600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05860099
058700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05870099
058800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05880099
058900*----------------------------------------------------------------*05890099
059000                                                                  05900099
059100 1000-CONTROL-PROCESSING.                                         05910099
059200                                                                  05920099
059300     EVALUATE TRUE                                                05930099
059400         WHEN DP020-NEXT-ACT-INITIAL                              05940099
059500             INITIALIZE ASC-SPECIFIC-COMMAREA                     05950099
059600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05960099
059700                                      ASC-SEL-TERM-ID             05970099
059800             MOVE DP020-SRC-TASK-NUMBER                           05980099
059900                                   TO ASC-LIST-TASK-NUMBER        05990099
060000                                      ASC-SEL-TASK-NUMBER         06000099
060100             MOVE PC-LIST-QUEUE-SEQ                               06010099
060200                                   TO ASC-LIST-SEQ                06020099
060300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06030099
060400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06040099
060500***-----$TEMPLATE NOTE$-------------------------------------------06050099
060600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06060099
060700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06070099
060800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06080099
060900***---------------------------------------------------------------06090099
061000             IF  PS-COMMAREA-NOT-VALID                            06100099
061100***              MOVE PC-TSYMSG-99901                             06110099
061200***                                TO DP020-MSG-NUMBER            06120099
061300***              SET DP020-MSG-FATAL                              06130099
061400***                                TO TRUE                        06140099
061500                 SET DP020-NEXT-ACT-APPL-ERROR                    06150099
061600                                   TO TRUE                        06160099
061700             ELSE                                                 06170099
061800                 PERFORM 4000-BUILD-INITIAL-PANEL                 06180099
061900             END-IF                                               06190099
062000                                                                  06200099
062100         WHEN DP020-NEXT-ACT-READ-MAP                             06210099
062200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06220099
062300                                   TO PV-TOP-ITEM                 06230099
062400             PERFORM 2000-PROCESS-PANEL                           06240099
062500                                                                  06250099
062600         WHEN DP020-NEXT-ACT-RETURN                               06260099
062700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06270099
062800                                   TO PV-TOP-ITEM                 06280099
062900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06290099
063000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06300099
063100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06310099
063200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06320099
063300                                                                  06330099
063400         WHEN OTHER                                               06340099
063500             SET DP013-LOGIC-ABEND TO TRUE                        06350099
063600             SET DP013-NO-ROLLBACK TO TRUE                        06360099
063700             MOVE '1000-CONTROL-PROCESSING'                       06370099
063800                                   TO DP013-PARAGRAPH             06380099
063900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06390099
064000                                   TO DP013-MESSAGE-TEXT(1)       06400099
064100             PERFORM DP013-0000-PROCESS-ABEND                     06410099
064200     END-EVALUATE.                                                06420099
064300                                                                  06430099
064400*----------------------------------------------------------------*06440099
064500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06450099
064600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06460099
064700*----------------------------------------------------------------*06470099
064800                                                                  06480099
064900 1100-PROCESS-INTER-APPL-COMM.                                    06490099
065000                                                                  06500099
065100     SET ASC-UPDATE-NOT-COMPLETED  TO TRUE                        06510099
065200     SET PS-COMMAREA-VALID         TO TRUE.                       06520099
065300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06530099
065400                                                                  06540099
065500     MOVE AP300-PO-NBR          TO ASC-KEY-PO-NBR                 06550099
065600                                   ASC-ALP-PO-NBR.                06560099
065700     PERFORM 1150-EDIT-PO-NBR.                                    06570099
065800     IF PS-ERROR                                                  06580099
065900         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    06590099
066000     END-IF.                                                      06600099
066100                                                                  06610099
066200*----------------------------------------------------------------*06620099
066300* VLAIDATES THE PO NUMBER THAT WAS ENTERED.                      *06630099
066400*----------------------------------------------------------------*06640099
066500                                                                  06650099
066600 1150-EDIT-PO-NBR.                                                06660099
066700                                                                  06670099
066800     IF ASC-ALP-PO-NBR = SPACES                                   06680099
066900       OR ASC-KEY-PO-NBR = ZEROS                                  06690099
067000*        -- MUST EXIST --                                         06700099
067100         IF PS-NO-ERROR                                           06710099
067200             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             06720099
067300         END-IF                                                   06730099
067400         SET DP020-MSG-FATAL                                      06740099
067500             PS-ERROR            TO TRUE                          06750099
067600     ELSE                                                         06760099
067700         MOVE ASC-ALP-PO-NBR     TO DP010I-UNEDITED-FIELD         06770099
067800         MOVE 9                  TO DP010I-MAXIMUM-DIGITS         06780099
067900         MOVE 0                  TO DP010I-MAXIMUM-DECIMALS       06790099
068000         SET  DP010I-NEGATIVE-NOT-ALLOWED                         06800099
068100                                 TO TRUE                          06810099
068210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06821099
068220                         USING DP010I-NUMERIC-EDIT-AREA           06822099
068300         IF DP010I-ERROR-DETECTED                                 06830099
068400*            -- MUST BE NUMERIC --                                06840099
068500             IF PS-NO-ERROR                                       06850099
068600                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         06860099
068700             END-IF                                               06870099
068800             SET DP020-MSG-FATAL                                  06880099
068900                 PS-ERROR        TO TRUE                          06890099
069000         END-IF                                                   06900099
069100     END-IF.                                                      06910099
069200                                                                  06920099
069300     IF PS-NO-ERROR                                               06930099
069400         PERFORM 1200-GET-TPURCHS-DATA                            06940099
069500         IF PS-TPURCHS-NOT-FOUND                                  06950099
069600             IF PS-NO-ERROR                                       06960099
069700*  -- PURCHASE ORDER NOT FOUND --                                 06970099
069800                 MOVE PC-TSYMSG-00726                             06980099
069900                                 TO DP020-MSG-NUMBER              06990099
070000             END-IF                                               07000099
070100             SET DP020-MSG-FATAL                                  07010099
070200                 PS-ERROR        TO TRUE                          07020099
070300         ELSE                                                     07030099
070400             IF (PURCHS-PO-TYP-CDE NOT = 'IM') AND                07040099
070500                (PURCHS-PO-TYP-CDE NOT = 'IF') AND                07050099
070600                (PURCHS-PO-TYP-CDE NOT = 'IE') AND                07060099
070610                (PURCHS-PO-TYP-CDE NOT = 'CD')                    07061099
070700                 MOVE EXTENT-DUN-NBR                              07070099
070800                                 TO ASC-VENDOR-NBR                07080099
070900                 MOVE ENTNME-ENT-NAME-DESC                        07090099
071000                                 TO ASC-VENDOR-NAME               07100099
071100             ELSE                                                 07110099
071200                 IF PS-NO-ERROR                                   07120099
071300*  -- INVALID PURCHASE ORDER TYPE CODE FOR THIS FUNCTION --       07130099
071400                     MOVE PC-TSYMSG-00587                         07140099
071500                                 TO DP020-MSG-NUMBER              07150099
071600                 END-IF                                           07160099
071700                 SET DP020-MSG-FATAL                              07170099
071800                     PS-ERROR    TO TRUE                          07180099
071900             END-IF                                               07190099
072000         END-IF                                                   07200099
072100     END-IF.                                                      07210099
072200                                                                  07220099
072300     IF PS-NO-ERROR                                               07230099
072400        PERFORM 1300-CHECK-TPOSTRR-PO                             07240099
072500        IF PV-POSTRR-COUNT > 0                                    07250099
072600           IF PS-NO-ERROR                                         07260099
072700*  -- UPDATE NOT ALLOWED; PO PAY RELEASE IS PENDING --            07270099
072800               MOVE PC-TSYMSG-00904 TO DP020-MSG-NUMBER           07280099
072900           END-IF                                                 07290099
073000           SET DP020-MSG-FATAL                                    07300099
073100               PS-ERROR             TO TRUE                       07310099
073200        END-IF                                                    07320099
073300     END-IF.                                                      07330099
073400                                                                  07340099
073500*----------------------------------------------------------------*07350099
073600*  GET THE PO INFORMATION FOR THE PO THAT WAS ENTERED.           *07360099
073700*----------------------------------------------------------------*07370099
073800                                                                  07380099
073900 1200-GET-TPURCHS-DATA.                                           07390099
074000                                                                  07400099
074100     PERFORM                                                      07410099
074200         WITH TEST AFTER                                          07420099
074300         VARYING PV-RETRY-COUNTER                                 07430099
074400         FROM 1 BY 1                                              07440099
074500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07450099
074600            OR (SQLCODE = +0)                                     07460099
074700            OR (SQLCODE = +100))                                  07470099
074800                                                                  07480099
074900         EXEC SQL                                                 07490099
075000           SELECT    P.PO_TYP_CDE                                 07500099
075100                    ,P.DIR_STR_IND                                07510099
075200                    ,N.ENT_NAME_DESC                              07520099
075300                    ,E.DUN_NBR                                    07530099
075400             INTO    :PURCHS-PO-TYP-CDE                           07540099
075500                    ,:PURCHS-DIR-STR-IND                          07550099
075600                    ,:ENTNME-ENT-NAME-DESC                        07560099
075700                    ,:EXTENT-DUN-NBR                              07570099
075800             FROM    TPURCHS P                                    07580099
075900                    ,TENTNME N                                    07590099
076000                    ,TEXTENT E                                    07600099
076100            WHERE    PO_NBR           = :ASC-KEY-PO-NBR           07610099
076200              AND    P.VER_STATUS_CDE = 'A'                       07620099
076300              AND    N.TYPE_CDE       = '01'                      07630099
076400              AND    P.ENT_ID         = N.ENT_ID                  07640099
076500              AND    P.ENT_ID         = E.ENT_ID                  07650099
076600         END-EXEC                                                 07660099
076700                                                                  07670099
076800         EVALUATE TRUE                                            07680099
076900             WHEN SQLCODE = +0                                    07690099
077000                 SET PS-TPURCHS-FOUND      TO TRUE                07700099
077100             WHEN SQLCODE = +100                                  07710099
077200                 SET PS-TPURCHS-NOT-FOUND  TO TRUE                07720099
077300             WHEN SQLCODE = -904                                  07730099
077400             WHEN SQLCODE = -913                                  07740099
077500                 CONTINUE                                         07750099
077600                                                                  07760099
077700             WHEN SQLWARN0 NOT = SPACES                           07770099
077800             WHEN SQLCODE < ZERO                                  07780099
077900             WHEN SQLCODE > ZERO                                  07790099
078000                 MOVE '1200-GET-TPURCHS-DATA'                     07800099
078100                                 TO DP013-PARAGRAPH               07810099
078200                 MOVE 'SELECT ON TPURCHS'                         07820099
078300                                 TO DP013-MESSAGE-TEXT (1)        07830099
078400                 MOVE SQLCA TO DP013-SQLCA                        07840099
078500                 MOVE 'TPURCHS'  TO DP013-DB2-TABLE-NAME (1)      07850099
078600                 SET DP013-DB2-ABEND                              07860099
078700                     DP013-XCTL-DISPLAY-RESTART                   07870099
078800                                 TO TRUE                          07880099
078900                 PERFORM DP013-0000-PROCESS-ABEND                 07890099
079000         END-EVALUATE                                             07900099
079100     END-PERFORM.                                                 07910099
079200                                                                  07920099
079300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07930099
079400         MOVE '1200-GET-TPURCHS-DATA'                             07940099
079500                                 TO DP013-PARAGRAPH               07950099
079600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     07960099
079700                                 TO DP013-MESSAGE-TEXT (1)        07970099
079800         MOVE SQLCA              TO DP013-SQLCA                   07980099
079900         MOVE 'TPURCHS'          TO DP013-DB2-TABLE-NAME (1)      07990099
080000         SET DP013-DB2-ABEND                                      08000099
080100             DP013-XCTL-DISPLAY-RESTART                           08010099
080200                                 TO TRUE                          08020099
080300         PERFORM DP013-0000-PROCESS-ABEND                         08030099
080400     END-IF.                                                      08040099
080500                                                                  08050099
080600*----------------------------------------------------------------*08060099
080700* CHECK THE TPOSTRR TABLE FOR OCCURRENCES.  IF ANY ARE FOUND THEN*08070099
080800* DENY THE USER THE ABILITY TO CHANGE THE INVOICES TO BULK.      *08080099
080900*----------------------------------------------------------------*08090099
081000                                                                  08100099
081100 1300-CHECK-TPOSTRR-PO.                                           08110099
081200                                                                  08120099
081300     PERFORM                                                      08130099
081400         WITH TEST AFTER                                          08140099
081500         VARYING PV-RETRY-COUNTER                                 08150099
081600         FROM 1 BY 1                                              08160099
081700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08170099
081800            OR (SQLCODE = +0)                                     08180099
081900            OR (SQLCODE = +100))                                  08190099
082000                                                                  08200099
082100         EXEC SQL                                                 08210099
082200           SELECT    COUNT (*)                                    08220099
082300             INTO    :PV-POSTRR-COUNT                             08230099
082400             FROM    TPOSTRR                                      08240099
082500            WHERE    PO_NBR           = :ASC-KEY-PO-NBR           08250099
082600         END-EXEC                                                 08260099
082700                                                                  08270099
082800         EVALUATE TRUE                                            08280099
082900             WHEN SQLCODE = +0                                    08290099
083000             WHEN SQLCODE = +100                                  08300099
083100             WHEN SQLCODE = -904                                  08310099
083200             WHEN SQLCODE = -913                                  08320099
083300                 CONTINUE                                         08330099
083400                                                                  08340099
083500             WHEN SQLWARN0 NOT = SPACES                           08350099
083600             WHEN SQLCODE < ZERO                                  08360099
083700             WHEN SQLCODE > ZERO                                  08370099
083800                 MOVE '1300-CHECK-TPOSTRR-PO'                     08380099
083900                                 TO DP013-PARAGRAPH               08390099
084000                 MOVE 'SELECT ON TPOSTRR'                         08400099
084100                                 TO DP013-MESSAGE-TEXT (1)        08410099
084200                 MOVE SQLCA TO DP013-SQLCA                        08420099
084300                 MOVE 'TPOSTRR'  TO DP013-DB2-TABLE-NAME (1)      08430099
084400                 SET DP013-DB2-ABEND                              08440099
084500                     DP013-XCTL-DISPLAY-RESTART                   08450099
084600                                 TO TRUE                          08460099
084700                 PERFORM DP013-0000-PROCESS-ABEND                 08470099
084800         END-EVALUATE                                             08480099
084900     END-PERFORM.                                                 08490099
085000                                                                  08500099
085100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08510099
085200         MOVE '1300-CHECK-TPOSTRR-PO'                             08520099
085300                                 TO DP013-PARAGRAPH               08530099
085400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     08540099
085500                                 TO DP013-MESSAGE-TEXT (1)        08550099
085600         MOVE SQLCA              TO DP013-SQLCA                   08560099
085700         MOVE 'TPOSTRR'          TO DP013-DB2-TABLE-NAME (1)      08570099
085800         SET DP013-DB2-ABEND                                      08580099
085900             DP013-XCTL-DISPLAY-RESTART                           08590099
086000                                 TO TRUE                          08600099
086100         PERFORM DP013-0000-PROCESS-ABEND                         08610099
086200     END-IF.                                                      08620099
086300                                                                  08630099
086400*----------------------------------------------------------------*08640099
086500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08650099
086600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08660099
086700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08670099
086800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08680099
086900* FUNCTION KEYS CAN GET THIS FAR.                                *08690099
087000*----------------------------------------------------------------*08700099
087100                                                                  08710099
087200 2000-PROCESS-PANEL.                                              08720099
087300     EVALUATE TRUE                                                08730099
087400         WHEN DP020-SRC-AID = DP016-CLEAR                         08740099
087500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08750099
087600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08760099
087700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08770099
087800                                                                  08780099
087900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08790099
088000             MOVE ASC-KEY-PO-NBR TO AP-KEY-PO-NBR                 08800099
088100             PERFORM 2050-DELETE-LIST-QUEUE                       08810099
088200             PERFORM 4000-BUILD-INITIAL-PANEL                     08820099
088300                                                                  08830099
088400         WHEN OTHER                                               08840099
088500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08850099
088600             IF  PS-NO-ERROR                                      08860099
088700                 SET DP030-CONTINUE-GO                            08870099
088800                                 TO TRUE                          08880099
088900                 PERFORM 2100-CHECK-FUNCTION-KEY                  08890099
089000             ELSE                                                 08900099
089100                 SET DP030-OVERRIDE-GO                            08910099
089200                                 TO TRUE                          08920099
089300             END-IF                                               08930099
089400     END-EVALUATE.                                                08940099
089500                                                                  08950099
089600*----------------------------------------------------------------*08960099
089700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08970099
089800*----------------------------------------------------------------*08980099
089900 2050-DELETE-LIST-QUEUE.                                          08990099
090000                                                                  09000099
090100     EXEC CICS                                                    09010099
090200         DELETEQ TS                                               09020099
090300             QUEUE (ASC-LIST-QUEUE-NAME)                          09030099
090400             RESP  (PV-CICS-RESP)                                 09040099
090500     END-EXEC.                                                    09050099
090600                                                                  09060099
090700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09070099
090800        (PV-CICS-RESP = DFHRESP(QIDERR))                          09080099
090900         CONTINUE                                                 09090099
091000     ELSE                                                         09100099
091100         SET DP013-CICS-ABEND      TO TRUE                        09110099
091200         SET DP013-NO-ROLLBACK     TO TRUE                        09120099
091300                                                                  09130099
091400         MOVE '2050-DELETE-LIST-QUEUE'                            09140099
091500                                   TO DP013-PARAGRAPH             09150099
091600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09160099
091700                                   TO DP013-MESSAGE-TEXT (1)      09170099
091800         PERFORM DP013-0000-PROCESS-ABEND                         09180099
091900     END-IF.                                                      09190099
092000                                                                  09200099
092100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09210099
092200                                                                  09220099
092300*----------------------------------------------------------------*09230099
092400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09240099
092500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09250099
092600* CICS ARCHITECTURE API.                                         *09260099
092700*----------------------------------------------------------------*09270099
092800 2100-CHECK-FUNCTION-KEY.                                         09280099
092900                                                                  09290099
093000     EVALUATE TRUE                                                09300099
093100                                                                  09310099
093200         WHEN DP020-SRC-AID = DP016-PF15                          09320099
093300             IF NOT ASC-UPDATE-COMPLETED                          09330099
093400                SET DP030-CONTINUE-GO  TO TRUE                    09340099
093500                MOVE ZERO TO ASC-ITEMS-UPDATED, AUPDITO           09350099
093600                PERFORM 5050-UPDATE-STORE-NUMBER                  09360099
093700                SET ASC-UPDATE-TSQ    TO TRUE                     09370099
093800                MOVE ASC-ITEM-AT-TOP-OF-PANEL                     09380099
093900                                      TO PV-TOP-ITEM              09390099
094000                MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL 09400099
094100                PERFORM 6000-REFRESH-PANEL-FROM-TEMP              09410099
094200                PERFORM 3000-EDIT-DATA-IN-COMMAREA                09420099
094300                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              09430099
094400                IF PS-ERROR                                       09440099
094410                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           09441099
094420                ELSE                                              09442099
094430*  -- UPDATE(S) SUCCESSFUL --                                     09443099
094440                   MOVE PC-TSYMSG-00059                           09444099
094450                                       TO DP020-MSG-NUMBER        09445099
094460                   MOVE +0            TO ASC-ITEM-AT-TOP-OF-PANEL 09446099
094470                   SET ASC-UPDATE-COMPLETED                       09447099
094480                                       TO TRUE                    09448099
094490                   MOVE ASC-KEY-PO-NBR TO AP-KEY-PO-NBR           09449099
094500                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           09450099
094600                END-IF                                            09460099
094700             ELSE                                                 09470099
094800                IF PS-NO-ERROR                                    09480099
094900                   OR ASC-UPDATE-COMPLETED                        09490099
095000*  -- DATA NOT CHANGED; NO UPDATE PERFORMED --                    09500099
095100                   MOVE PC-TSYMSG-00046                           09510099
095200                            TO DP020-MSG-NUMBER                   09520099
095300                   SET DP020-MSG-INFORMATIONAL                    09530099
095400                            TO TRUE                               09540099
095500                END-IF                                            09550099
095600             END-IF                                               09560099
095700                                                                  09570099
095800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09580099
095900             MOVE +1               TO PV-TOP-ITEM                 09590099
096000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09600099
096100                                                                  09610099
096200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09620099
096300             PERFORM 2110-BROWSE-BACKWARD                         09630099
096400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09640099
096500                                                                  09650099
096600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09660099
096700             PERFORM 2120-BROWSE-FORWARD                          09670099
096800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09680099
096900                                                                  09690099
097000         WHEN DP020-SRC-AID = DP016-ENTER                         09700099
097100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09710099
097200         WHEN OTHER                                               09720099
097300             SET DP013-NO-ROLLBACK                                09730099
097400                 DP013-XCTL-DISPLAY-RESTART                       09740099
097500                 DP013-CICS-ABEND  TO TRUE                        09750099
097600             MOVE '2100-CHECK-FUNCTION-KEY'                       09760099
097700                                   TO DP013-PARAGRAPH             09770099
097800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09780099
097900                                   TO DP013-MESSAGE-TEXT (1)      09790099
098000             PERFORM DP013-0000-PROCESS-ABEND                     09800099
098100     END-EVALUATE.                                                09810099
098200                                                                  09820099
098300*----------------------------------------------------------------*09830099
098400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09840099
098500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09850099
098600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09860099
098700*    MESSAGE.                                                    *09870099
098800*----------------------------------------------------------------*09880099
098900                                                                  09890099
099000 2110-BROWSE-BACKWARD.                                            09900099
099100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09910099
099200         GIVING PV-TOP-ITEM.                                      09920099
099300*                                                                 09930099
099400     IF  ((PV-TOP-ITEM < +1)                                      09940099
099500       OR (PV-TOP-ITEM = +1))                                     09950099
099600         MOVE +1                   TO PV-TOP-ITEM                 09960099
099700*        -- TOP OF LIST --                                        09970099
099800         MOVE PC-TSYMSG-00069   TO DP020-MSG-NUMBER               09980099
099900         SET DP020-MSG-INFORMATIONAL TO TRUE                      09990099
100000     END-IF.                                                      10000099
100100                                                                  10010099
100200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-BOT-OF-PANEL    10020099
100300         GIVING PV-BOTTOM-ITEM.                                   10030099
100400                                                                  10040099
100500     IF  PV-BOTTOM-ITEM            >= ASC-NBR-OF-ITEMS-IN-DB      10050099
100600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10060099
100700         SET DP020-MSG-INFORMATIONAL TO TRUE                      10070099
100800     END-IF.                                                      10080099
100900                                                                  10090099
101000*----------------------------------------------------------------*10100099
101100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10110099
101200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10120099
101300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10130099
101400*----------------------------------------------------------------*10140099
101500                                                                  10150099
101600 2120-BROWSE-FORWARD.                                             10160099
101700                                                                  10170099
101800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10180099
101900         GIVING PV-TOP-ITEM.                                      10190099
102000                                                                  10200099
102100     COMPUTE PV-BOTTOM-ITEM =                                     10210099
102200         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1.                    10220099
102300                                                                  10230099
102400     IF PV-TOP-ITEM                    > ASC-NUMBER-OF-ITEMS-READ 10240099
102500        IF ASC-ITEM-AT-BOT-OF-PANEL    = ASC-NUMBER-OF-ITEMS-READ 10250099
102600           IF PV-BOTTOM-ITEM           > ASC-NUMBER-OF-ITEMS-READ 10260099
102700              IF ASC-ITEM-AT-TOP-OF-PANEL                         10270099
102800                                       >= ASC-NUMBER-OF-ITEMS-READ10280099
102900                 MOVE ASC-ITEM-AT-TOP-OF-PANEL                    10290099
103000                                 TO PV-TOP-ITEM                   10300099
103100              ELSE                                                10310099
103200                 COMPUTE PV-NEXT-TOP-ITEM = PV-BOTTOM-ITEM -      10320099
103300                         ASC-NBR-OF-ITEMS-IN-DB                   10330099
103400                 IF PV-NEXT-TOP-ITEM   > PC-ITEMS-PER-PANEL       10340099
103500                    MOVE ASC-ITEM-AT-TOP-OF-PANEL                 10350099
103600                                      TO PV-TOP-ITEM              10360099
103700                 ELSE                                             10370099
103800                    IF PV-NEXT-TOP-ITEM                           10380099
103900                                     = PC-ITEMS-PER-PANEL         10390099
104000                      IF ASC-NBR-OF-ITEMS-IN-DB                   10400099
104100                                     < ASC-NUMBER-OF-ITEMS-READ   10410099
104200                         MOVE ASC-ITEM-AT-TOP-OF-PANEL            10420099
104300                                     TO PV-TOP-ITEM               10430099
104400                      END-IF                                      10440099
104500                    ELSE                                          10450099
104600                      MOVE ASC-ITEM-AT-TOP-OF-PANEL               10460099
104700                                     TO PV-TOP-ITEM               10470099
104800                    END-IF                                        10480099
104900                 END-IF                                           10490099
105000              END-IF                                              10500099
105100           END-IF                                                 10510099
105200        ELSE                                                      10520099
105300           MOVE ASC-ITEM-AT-TOP-OF-PANEL                          10530099
105400                                      TO PV-TOP-ITEM              10540099
105500        END-IF                                                    10550099
105600        MOVE PC-TSYMSG-00070          TO DP020-MSG-NUMBER         10560099
105700        SET DP020-MSG-INFORMATIONAL   TO TRUE                     10570099
105800     ELSE                                                         10580099
105900        IF PV-BOTTOM-ITEM              > ASC-NUMBER-OF-ITEMS-READ 10590099
106000           MOVE PC-TSYMSG-00070       TO DP020-MSG-NUMBER         10600099
106100           SET DP020-MSG-INFORMATIONAL                            10610099
106200                                      TO TRUE                     10620099
106300        ELSE                                                      10630099
106400           IF PV-BOTTOM-ITEM           = ASC-NUMBER-OF-ITEMS-READ 10640099
106500              MOVE PC-TSYMSG-00070    TO DP020-MSG-NUMBER         10650099
106600              SET DP020-MSG-INFORMATIONAL  TO TRUE                10660099
106700           END-IF                                                 10670099
106800        END-IF                                                    10680099
106900     END-IF.                                                      10690099
107000                                                                  10700099
107100     IF PV-BOTTOM-ITEM                 = ASC-NBR-OF-ITEMS-IN-DB   10710099
107200        MOVE PC-TSYMSG-00070          TO DP020-MSG-NUMBER         10720099
107300        SET DP020-MSG-INFORMATIONAL                               10730099
107400                                      TO TRUE                     10740099
107500     END-IF.                                                      10750099
107600                                                                  10760099
107700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10770099
107800     MOVE +1                       TO PV-SUB.                     10780099
107900                                                                  10790099
108000     PERFORM 3100-SET-SUBSCRIPTS.                                 10800099
108100                                                                  10810099
108200                                                                  10820099
108300******************************************************************10830099
108400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10840099
108500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10850099
108600******************************************************************10860099
108700 2200-MOVE-SCREEN-TO-COMMAREA.                                    10870099
108800                                                                  10880099
108900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10890099
109000*                                                                 10900099
109100     PERFORM 3100-SET-SUBSCRIPTS.                                 10910099
109200     IF  ASTRTITL > ZERO                                          10920099
109300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10930099
109400     ELSE                                                         10940099
109500         IF  ASTRTITF = DP015-ERASE-EOF                           10950099
109600             INITIALIZE ASC-START-ITEM-REQUEST                    10960099
109700         END-IF                                                   10970099
109800     END-IF.                                                      10980099
109900     SET PS-NO-ERROR               TO TRUE.                       10990099
110000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11000099
110100         VARYING PV-SUB                                           11010099
110200         FROM 1 BY 1                                              11020099
110300         UNTIL PV-SUB > 14.                                       11030099
110400     IF PS-HOLD-ERROR                                             11040099
110500         SET PS-ERROR TO TRUE                                     11050099
110600     END-IF.                                                      11060099
110700******************************************************************11070099
110800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**11080099
110900******************************************************************11090099
111000 2210-MOVE-LINES-TO-COMMAREA.                                     11100099
111100     MOVE PV-SUB TO ASC-ITEM-SUB.                                 11110099
111200     IF  MR-SELECTL (PV-SUB) > ZERO OR MR-SELECT (PV-SUB) = 'S'   11120099
111300       OR ASC-SELECTED-SW (ASC-BLK-SUB, ASC-ITEM-SUB) = 'S'       11130099
111400       OR ASC-TEMP-SELECTED-SW (ASC-BLK-SUB, ASC-ITEM-SUB) = 'S'  11140099
111500           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE           11150099
111600           SET PS-SEL-YES                       TO TRUE           11160099
111700           IF MR-SELECTL (PV-SUB) > 0                             11170099
111800              MOVE MR-SELECT (PV-SUB)                             11180099
111900                                   TO ASC-TEMP-SELECTED-SW        11190099
112000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11200099
112100           ELSE                                                   11210099
112200              IF ASC-SELECTED-SW (ASC-BLK-SUB, ASC-ITEM-SUB) = 'S'11220099
112300                 MOVE 'S' TO ASC-TEMP-SELECTED-SW                 11230099
112400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11240099
112500                 MOVE 'S' TO MR-SELECT (PV-SUB)                   11250099
112600              END-IF                                              11260099
112700           END-IF                                                 11270099
112800     ELSE                                                         11280099
112900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11290099
113000             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         11300099
113100             MOVE SPACE        TO ASC-TEMP-SELECTED-SW            11310099
113200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11320099
113300         END-IF                                                   11330099
113400     END-IF.                                                      11340099
113500                                                                  11350099
113600     MOVE MR-INVC-NBR (PV-SUB)    TO ASC-INVC-NBR                 11360099
113700                                  (ASC-BLK-SUB, ASC-ITEM-SUB).    11370099
113800     MOVE 0                       TO ASC-STR-NBR                  11380099
113900                                  (ASC-BLK-SUB, ASC-ITEM-SUB).    11390099
114000     MOVE MR-TYPE (PV-SUB)        TO ASC-TYPE                     11400099
114100                                  (ASC-BLK-SUB, ASC-ITEM-SUB).    11410099
114200     MOVE MR-STATUS (PV-SUB)      TO ASC-STATUS                   11420099
114300                                  (ASC-BLK-SUB, ASC-ITEM-SUB).    11430099
114400     MOVE MR-GROSS-AMT-N (PV-SUB) TO ASC-GROSS-AMT                11440099
114500                                  (ASC-BLK-SUB, ASC-ITEM-SUB).    11450099
114600     MOVE MR-ENTR-DTE (PV-SUB)    TO ASC-ENTR-DTE                 11460099
114700                                  (ASC-BLK-SUB, ASC-ITEM-SUB).    11470099
114800     MOVE 0                       TO ASC-DC-NBR                   11480099
114900                                  (ASC-BLK-SUB, ASC-ITEM-SUB).    11490099
115000     MOVE MR-MTCH-LVL (PV-SUB)    TO ASC-MTCH-LVL-CDE             11500099
115100                                  (ASC-BLK-SUB, ASC-ITEM-SUB).    11510099
115200                                                                  11520099
115300                                                                  11530099
115400     ADD +1                        TO ASC-ITEM-SUB.               11540099
115500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11550099
115600         ADD +1                    TO ASC-BLK-SUB                 11560099
115700         MOVE +1                   TO ASC-ITEM-SUB                11570099
115800     END-IF.                                                      11580099
115900******************************************************************11590099
116000** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **11600099
116100** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **11610099
116200******************************************************************11620099
116300 3000-EDIT-DATA-IN-COMMAREA.                                      11630099
116400     MOVE PC-ITEMS-PER-PANEL       TO PV-SUB.                     11640099
116500**                                                                11650099
116600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11660099
116700* EDITTING IS DONE FROM THE BOTTOM UP.                            11670099
116800*                                                                 11680099
116900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11690099
117000         PC-ITEMS-PER-PANEL  - 1.                                 11700099
117100                                                                  11710099
117200     PERFORM 3100-SET-SUBSCRIPTS.                                 11720099
117300     PERFORM 3300-EDIT-SELECTIONS                                 11730099
117400         VARYING PV-SUB                                           11740099
117500         FROM PV-SUB BY -1                                        11750099
117600         UNTIL PV-SUB < +1.                                       11760099
117700                                                                  11770099
117800*----------------------------------------------------------------*11780099
117900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11790099
118000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11800099
118100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11810099
118200*                                                                *11820099
118300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11830099
118400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11840099
118500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11850099
118600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11860099
118700*----------------------------------------------------------------*11870099
118800                                                                  11880099
118900 3100-SET-SUBSCRIPTS.                                             11890099
119000                                                                  11900099
119100     COMPUTE ASC-ITEM-SUB =                                       11910099
119200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11920099
119300                                                                  11930099
119400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11940099
119500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11950099
119600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11960099
119700     ELSE                                                         11970099
119800         MOVE +1                     TO ASC-BLK-SUB               11980099
119900     END-IF.                                                      11990099
120000                                                                  12000099
120100******************************************************************12010099
120200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **12020099
120300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **12030099
120400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **12040099
120500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **12050099
120600******************************************************************12060099
120700 3300-EDIT-SELECTIONS.                                            12070099
120800     EVALUATE TRUE                                                12080099
120900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12090099
121000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12100099
121100                 CONTINUE                                         12110099
121200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12120099
121300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12130099
121400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12140099
121500                 MOVE ASC-TEMP-SELECTED-SW                        12150099
121600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12160099
121700                                TO ASC-SELECTED-SW                12170099
121800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12180099
121900             END-IF                                               12190099
122000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12200099
122100                 = SPACE                                          12210099
122200             EVALUATE TRUE                                        12220099
122300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12230099
122400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12240099
122500                     MOVE SPACE TO ASC-SELECTED-SW                12250099
122600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12260099
122700             END-EVALUATE                                         12270099
122800         WHEN OTHER                                               12280099
122900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12290099
123000             SET DP020-MSG-FATAL    TO TRUE                       12300099
123100             SET PS-ERROR TO TRUE                                 12310099
123200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12320099
123300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12330099
123400                 MOVE SPACE         TO ASC-SELECTED-SW            12340099
123500                                        (ASC-BLK-SUB ASC-ITEM-SUB)12350099
123600             END-IF                                               12360099
123700     END-EVALUATE.                                                12370099
123800                                                                  12380099
123900     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             12390099
124000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12400099
124100     IF  ASC-ITEM-SUB < 1                                         12410099
124200         SUBTRACT +1 FROM ASC-BLK-SUB                             12420099
124300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12430099
124400     END-IF.                                                      12440099
124500                                                                  12450099
124600*----------------------------------------------------------------*12460099
124700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *12470099
124800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *12480099
124900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *12490099
125000*    DISPLAY THE PANEL TO USER.                                  *12500099
125100*----------------------------------------------------------------*12510099
125200                                                                  12520099
125300 4000-BUILD-INITIAL-PANEL.                                        12530099
125400                                                                  12540099
125500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            12550099
125600                                 ASC-BLOCK-ENTRIES (2).           12560099
125700     MOVE +1                 TO ASC-BLK-SUB.                      12570099
125800     SET ASC-ITEMS-LEFT-ON-DB                                     12580099
125900                             TO TRUE.                             12590099
126000                                                                  12600099
126100     MOVE +0                 TO ASC-ITEM-SUB                      12610099
126200                                ASC-NUMBER-OF-ITEMS-READ          12620099
126300                                ASC-NUMBER-OF-SELECTED-ITEMS      12630099
126400                                ASC-HIGHEST-BLOCK-WRITTEN         12640099
126500                                ASC-START-OF-SELECTED-RANGE       12650099
126600                                ASC-END-OF-SELECTED-RANGE         12660099
126700                                ASC-ITEM-AT-TOP-OF-PANEL          12670099
126800                                ASC-ITEMS-UPDATED                 12680099
126900                                AUPDITO.                          12690099
127000                                                                  12700099
127100     PERFORM 4010-OPEN-CURSOR.                                    12710099
127200                                                                  12720099
127300     PERFORM 4300-READ-ITEMS-FROM-DB.                             12730099
127400                                                                  12740099
127500     PERFORM 4020-CLOSE-CURSOR.                                   12750099
127600                                                                  12760099
127700     IF PV-TOP-ITEM <             1                               12770099
127800         MOVE +1                   TO  PV-TOP-ITEM                12780099
127900     END-IF.                                                      12790099
128000                                                                  12800099
128100*    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12810099
128200                                                                  12820099
128300     IF ASC-NUMBER-OF-ITEMS-READ = ZERO                           12830099
128400         SET DP020-NEXT-ACT-APPL-ERROR                            12840099
128500             DP020-MSG-FATAL     TO TRUE                          12850099
128600         MOVE PC-TSYMSG-00050    TO DP020-MSG-NUMBER              12860099
128700     ELSE                                                         12870099
128800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     12880099
128900     END-IF.                                                      12890099
129000                                                                  12900099
129100*----------------------------------------------------------------*12910099
129200* OPEN THE INVOICE CURSOR.                                       *12920099
129300*----------------------------------------------------------------*12930099
129400                                                                  12940099
129500 4010-OPEN-CURSOR.                                                12950099
129600     PERFORM                                                      12960099
129700         WITH TEST AFTER                                          12970099
129800         VARYING PV-RETRY-COUNTER                                 12980099
129900         FROM 1 BY 1                                              12990099
130000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13000099
130100                   OR (SQLCODE = ZERO))                           13010099
130200         EXEC SQL                                                 13020099
130300             OPEN INVOICE-CSR                                     13030099
130400         END-EXEC                                                 13040099
130500                                                                  13050099
130600         EVALUATE TRUE                                            13060099
130700             WHEN SQLCODE = ZERO                                  13070099
130800             WHEN SQLCODE = -904                                  13080099
130900             WHEN SQLCODE = -913                                  13090099
131000                 CONTINUE                                         13100099
131100             WHEN SQLWARN0 NOT = SPACES                           13110099
131200             WHEN SQLCODE < ZERO                                  13120099
131300             WHEN SQLCODE > ZERO                                  13130099
131400                 MOVE '4010-OPEN-CURSOR'                          13140099
131500                                   TO DP013-PARAGRAPH             13150099
131600                 MOVE 'OPEN INVOICE CURSOR - '                    13160099
131700                                   TO DP013-MESSAGE-TEXT (1)      13170099
131800                 MOVE SQLCA        TO DP013-SQLCA                 13180099
131900                 MOVE 'TINVOIC '   TO DP013-DB2-TABLE-NAME (1)    13190099
132000                 SET DP013-DB2-ABEND                              13200099
132100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13210099
132200                 PERFORM DP013-0000-PROCESS-ABEND                 13220099
132300         END-EVALUATE                                             13230099
132400     END-PERFORM.                                                 13240099
132500*                                                                 13250099
132600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13260099
132700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             13270099
132800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   13280099
132900                                   TO DP013-MESSAGE-TEXT (1)      13290099
133000         MOVE SQLCA                TO DP013-SQLCA                 13300099
133100         MOVE 'TINVOIC '           TO DP013-DB2-TABLE-NAME (1)    13310099
133200         SET DP013-DB2-ABEND                                      13320099
133300             DP013-XCTL-DISPLAY-RESTART                           13330099
133400                                   TO TRUE                        13340099
133500         PERFORM DP013-0000-PROCESS-ABEND                         13350099
133600     END-IF.                                                      13360099
133700                                                                  13370099
133800                                                                  13380099
133900*----------------------------------------------------------------*13390099
134000* CLOSE THE INVOICE CURSOR.                                      *13400099
134100*----------------------------------------------------------------*13410099
134200                                                                  13420099
134300 4020-CLOSE-CURSOR.                                               13430099
134400     EXEC SQL                                                     13440099
134500         CLOSE INVOICE-CSR                                        13450099
134600     END-EXEC                                                     13460099
134700                                                                  13470099
134800     EVALUATE TRUE                                                13480099
134900         WHEN SQLCODE = ZERO                                      13490099
135000             CONTINUE                                             13500099
135100         WHEN SQLWARN0 NOT = SPACES                               13510099
135200         WHEN SQLCODE < ZERO                                      13520099
135300         WHEN SQLCODE > ZERO                                      13530099
135400             MOVE '4020-CLOSE-CURSOR'                             13540099
135500                               TO DP013-PARAGRAPH                 13550099
135600             MOVE 'CLOSE THE INVOICE CURSOR '                     13560099
135700                               TO DP013-MESSAGE-TEXT (1)          13570099
135800             MOVE SQLCA        TO DP013-SQLCA                     13580099
135900             MOVE 'TINVOIC '   TO DP013-DB2-TABLE-NAME (1)        13590099
136000             SET DP013-DB2-ABEND                                  13600099
136100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13610099
136200             PERFORM DP013-0000-PROCESS-ABEND                     13620099
136300     END-EVALUATE.                                                13630099
136400                                                                  13640099
136500                                                                  13650099
136600*----------------------------------------------------------------*13660099
136700*    SET UP THE HOST VARIABLES.                                  *13670099
136800*----------------------------------------------------------------*13680099
136900                                                                  13690099
137000*----------------------------------------------------------------*13700099
137100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *13710099
137200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *13720099
137300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *13730099
137400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *13740099
137500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *13750099
137600*                                                                *13760099
137700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *13770099
137800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *13780099
137900*    UPON INITIALIZATION.                                        *13790099
138000*----------------------------------------------------------------*13800099
138100                                                                  13810099
138200 4300-READ-ITEMS-FROM-DB.                                         13820099
138300                                                                  13830099
138400     PERFORM                                                      13840099
138500         VARYING PV-READ-COUNT                                    13850099
138600         FROM 1 BY 1                                              13860099
138700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    13870099
138800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         13880099
138900                                                                  13890099
139000         PERFORM 4310-FETCH                                       13900099
139100                                                                  13910099
139200         IF  ASC-ITEMS-LEFT-ON-DB                                 13920099
139300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                13930099
139400                 ADD +1            TO ASC-ITEM-SUB                13940099
139500             ELSE                                                 13950099
139600                 ADD +1            TO ASC-BLK-SUB                 13960099
139700                 MOVE +1           TO ASC-ITEM-SUB                13970099
139800                                                                  13980099
139900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         13990099
140000                     MOVE +1       TO ASC-BLK-SUB                 14000099
140100                     SET ASC-BLOCK-MODIFIED (1)                   14010099
140200                                   TO TRUE                        14020099
140300                     PERFORM 5100-WRITE-TEMP-STORAGE              14030099
140400                     MOVE ASC-BLOCK-ENTRIES                       14040099
140500                               (PC-MAX-BLOCKS-IN-ARRAY)           14050099
140600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 14060099
140700                     ADD +1        TO ASC-BLK-SUB                 14070099
140800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   14080099
140900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      14090099
141000                                   TO TRUE                        14100099
141100                 END-IF                                           14110099
141200             END-IF                                               14120099
141300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    14130099
141400             MOVE ASC-NUMBER-OF-ITEMS-READ                        14140099
141500                                   TO ASC-LIST-ITEM-NUMBER        14150099
141600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14160099
141700             MOVE 'S'              TO ASC-SELECTED-SW             14170099
141800                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14180099
141900             MOVE INVOIC-PAYT-REQ-SEQ-NBR                         14190099
142000                                   TO ASC-PAYT-REQ-SEQ-NBR        14200099
142100                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14210099
142200             SET ASC-ITEM-UPD (ASC-BLK-SUB, ASC-ITEM-SUB)         14220099
142300                                   TO TRUE                        14230099
142400             MOVE INVOIC-INVC-ID   TO ASC-INVC-NBR                14240099
142500                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14250099
142600             MOVE INVOIC-INVC-DTE  TO ASC-INVC-DTE                14260099
142700                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14270099
142800             MOVE INVOIC-STR-NBR   TO ASC-STR-NBR                 14280099
142900                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14290099
143000             MOVE INVOIC-INVC-TYP-CDE                             14300099
143100                                   TO ASC-TYPE                    14310099
143200                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14320099
143300             MOVE INVOIC-STATUS-CDE                               14330099
143400                                   TO ASC-STATUS                  14340099
143500                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14350099
143600             MOVE INVOIC-GRO-COST-AMT                             14360099
143700                                   TO ASC-GROSS-AMT               14370099
143800                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14380099
143900             MOVE INVOIC-CRE-DTE                                  14390099
144000                                   TO ASC-ENTR-DTE                14400099
144100                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14410099
144200             MOVE INVOIC-DC-NBR    TO ASC-DC-NBR                  14420099
144300                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14430099
144400             MOVE INVOIC-MTCH-LVL-CDE                             14440099
144500                                   TO ASC-MTCH-LVL-CDE            14450099
144600                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14460099
144700             MOVE PURCHS-DIR-STR-IND                              14470099
144800                                   TO ASC-DIR-STR-IND             14480099
144900                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 14490099
145000         END-IF                                                   14500099
145100     END-PERFORM.                                                 14510099
145200                                                                  14520099
145300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          14530099
145400         MOVE +1               TO ASC-BLK-SUB                     14540099
145500         PERFORM 5100-WRITE-TEMP-STORAGE                          14550099
145600         ADD +1                TO ASC-BLK-SUB                     14560099
145700         PERFORM 5100-WRITE-TEMP-STORAGE                          14570099
145800                                                                  14580099
145900         MOVE 1                TO ASC-BLK-SUB                     14590099
146000                                  PV-BLOCK-NUMBER                 14600099
146100         PERFORM 4410-READ-TEMP-STORAGE                           14610099
146200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             14620099
146300             MOVE 2            TO ASC-BLK-SUB                     14630099
146400                                  PV-BLOCK-NUMBER                 14640099
146500             PERFORM 4410-READ-TEMP-STORAGE                       14650099
146600         END-IF                                                   14660099
146700     END-IF.                                                      14670099
146800                                                                  14680099
146900*----------------------------------------------------------------*14690099
147000*    FETCH THE INVOICE CURSOR.                                   *14700099
147100*----------------------------------------------------------------*14710099
147200                                                                  14720099
147300 4310-FETCH.                                                      14730099
147400                                                                  14740099
147500     EXEC SQL                                                     14750099
147600          FETCH INVOICE-CSR                                       14760099
147700          INTO  :INVOIC-PAYT-REQ-SEQ-NBR                          14770099
147800               ,:INVOIC-INVC-ID                                   14780099
147900               ,:INVOIC-INVC-DTE                                  14790099
148000               ,:INVOIC-STR-NBR                                   14800099
148100               ,:INVOIC-INVC-TYP-CDE                              14810099
148200               ,:INVOIC-STATUS-CDE                                14820099
148300               ,:INVOIC-GRO-COST-AMT                              14830099
148400               ,:INVOIC-DC-NBR                                    14840099
148500               ,:INVOIC-MTCH-LVL-CDE                              14850099
148600               ,:INVOIC-CRE-DTE                                   14860099
148700     END-EXEC.                                                    14870099
148710                                                                  14871099
148720     EVALUATE TRUE                                                14872099
148730         WHEN SQLCODE = ZERO                                      14873099
148740              CONTINUE                                            14874099
148750         WHEN SQLCODE = +100                                      14875099
148760              MOVE ASC-NUMBER-OF-ITEMS-READ                       14876099
148770                                        TO ASC-NBR-OF-ITEMS-IN-DB 14877099
148780              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 14878099
148790         WHEN SQLWARN0 NOT = SPACE                                14879099
148800         WHEN SQLCODE NOT = ZERO                                  14880099
148900              MOVE '4310-FETCH-CURSOR'                            14890099
149000                               TO DP013-PARAGRAPH                 14900099
149100              MOVE 'FETCH INVOICE CURSOR'                         14910099
149200                               TO DP013-MESSAGE-TEXT (1)          14920099
149300              MOVE SQLCA       TO DP013-SQLCA                     14930099
149400              SET DP013-DB2-ABEND                                 14940099
149500                               TO TRUE                            14950099
149600              PERFORM DP013-0000-PROCESS-ABEND                    14960099
149700     END-EVALUATE.                                                14970099
149800                                                                  14980099
149900     IF  SQLCODE EQUAL +100                                       14990099
150000         SET ASC-NO-ITEMS-LEFT-ON-DB                              15000099
150100                                   TO TRUE                        15010099
150200     END-IF.                                                      15020099
150300                                                                  15030099
150400                                                                  15040099
150500*----------------------------------------------------------------*15050099
150600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *15060099
150700*----------------------------------------------------------------*15070099
150800                                                                  15080099
150900 4400-MOVE-COMMAREA-TO-SCREEN.                                    15090099
151000     MOVE ASC-KEY-PO-NBR         TO APONBRO.                      15100099
151100     MOVE ASC-VENDOR-NBR         TO AVNDNBRO.                     15110099
151200     MOVE ASC-VENDOR-NAME        TO AVNDNMEO.                     15120099
151300                                                                  15130099
151400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15140099
151500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15150099
151600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15160099
151700             MOVE +1    TO ASC-BLK-SUB                            15170099
151800             PERFORM 5100-WRITE-TEMP-STORAGE                      15180099
151900             ADD +1     TO ASC-BLK-SUB                            15190099
152000             PERFORM 5100-WRITE-TEMP-STORAGE                      15200099
152100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15210099
152200                 GIVING PV-BLOCK-NUMBER                           15220099
152300                 REMAINDER PV-REMAINDER                           15230099
152400             IF  PV-REMAINDER > ZERO                              15240099
152500                 ADD +1 TO PV-BLOCK-NUMBER                        15250099
152600             END-IF                                               15260099
152700             MOVE +1    TO ASC-BLK-SUB                            15270099
152800             PERFORM 4410-READ-TEMP-STORAGE                       15280099
152900             ADD +1     TO ASC-BLK-SUB                            15290099
153000                           PV-BLOCK-NUMBER                        15300099
153100             PERFORM 4410-READ-TEMP-STORAGE                       15310099
153200     END-IF.                                                      15320099
153300     MOVE +1            TO ASC-BLK-SUB.                           15330099
153400     COMPUTE ASC-ITEM-SUB =                                       15340099
153500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              15350099
153600         + PC-ITEMS-PER-PANEL).                                   15360099
153700*                                                                 15370099
153800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15380099
153900         ADD +1         TO ASC-BLK-SUB                            15390099
154000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15400099
154100     END-IF.                                                      15410099
154200*                                                                 15420099
154300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15430099
154400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15440099
154500     PERFORM 4420-FORMAT-LIST-LINES                               15450099
154600         VARYING PV-SUB                                           15460099
154700         FROM PC-ITEMS-PER-PANEL BY -1                            15470099
154800         UNTIL PV-SUB < +1.                                       15480099
154900*                                                                 15490099
155000     COMPUTE ASC-ITEMS-DISPLAYED =                                15500099
155100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15510099
155200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    15520099
155300                                      ASTRTITO.                   15530099
155400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    15540099
155500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    15550099
155600     MOVE ASC-ITEMS-UPDATED        TO AUPDITO.                    15560099
155700*                                                                 15570099
155800     IF  DP020-MSG-NUMBER-X = SPACE                               15580099
155900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  15590099
156000*            --- MORE ITEMS TO DISPLAY ----                       15600099
156100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            15610099
156200             SET DP020-MSG-INFORMATIONAL TO TRUE                  15620099
156300         END-IF                                                   15630099
156400     END-IF.                                                      15640099
156500*----------------------------------------------------------------*15650099
156600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *15660099
156700*----------------------------------------------------------------*15670099
156800                                                                  15680099
156900 4410-READ-TEMP-STORAGE.                                          15690099
157000                                                                  15700099
157100     EXEC CICS                                                    15710099
157200         READQ TS                                                 15720099
157300             QUEUE (ASC-LIST-QUEUE-NAME)                          15730099
157400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               15740099
157500             ITEM  (PV-BLOCK-NUMBER)                              15750099
157600             RESP  (PV-CICS-RESP)                                 15760099
157700     END-EXEC.                                                    15770099
157800                                                                  15780099
157900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       15790099
158000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     15800099
158100         CONTINUE                                                 15810099
158200     ELSE                                                         15820099
158300         SET DP013-CICS-ABEND     TO TRUE                         15830099
158400         SET DP013-NO-ROLLBACK    TO TRUE                         15840099
158500         MOVE '4410-READ-TEMP-STORAGE'                            15850099
158600                                  TO DP013-PARAGRAPH              15860099
158700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      15870099
158800                                  TO DP013-MESSAGE-TEXT(1)        15880099
158900         PERFORM DP013-0000-PROCESS-ABEND                         15890099
159000     END-IF.                                                      15900099
159100                                                                  15910099
159200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             15920099
159300*                                                                 15930099
159400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         15940099
159500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               15950099
159600     END-IF.                                                      15960099
159700                                                                  15970099
159800*----------------------------------------------------------------*15980099
159900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *15990099
160000*----------------------------------------------------------------*16000099
160100                                                                  16010099
160200 4420-FORMAT-LIST-LINES.                                          16020099
160300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16030099
160400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16040099
160500         MOVE SPACES          TO    MR-SELECT      (PV-SUB)       16050099
160600                                    MR-INVC-NBR    (PV-SUB)       16060099
160700                                    MR-INVC-DTE    (PV-SUB)       16070099
160800                                    MR-STR-NBR-X   (PV-SUB)       16080099
160900                                    MR-DC-NBR-X    (PV-SUB)       16090099
161000                                    MR-TYPE        (PV-SUB)       16100099
161100                                    MR-STATUS      (PV-SUB)       16110099
161200                                    MR-MTCH-LVL    (PV-SUB)       16120099
161300                                    MR-GROSS-AMT-X (PV-SUB)       16130099
161400                                    MR-ENTR-DTE    (PV-SUB)       16140099
161500     ELSE                                                         16150099
161600* THIS PROGRAM WAS BASED ON A SELECTABLE LIST UPDATE PROGRAM. THIS16160099
161700* PROGRAM NEEDS TO BE A NON-SELECTABLE LIST UPDATE PROGRAM.       16170099
161800* BY MOVING DP015-PRO-DRK-MDT TO MR-SELECTA THE 'S' THAT IS IN    16180099
161900* MR-SELECT WILL NOT BE DISPLAYED ON THE ONLINE SCREEN.  THAT     16190099
162000* WAY THE CODE THAT USES MR-SELECT IN 2210-MOVE-LINES-TO-COMMAREA 16200099
162100* WILL NOT HAVE TO BE CHANGED.                                    16210099
162200         MOVE DP015-PRO-DRK-MDT  TO MR-SELECTA (PV-SUB)           16220099
162300         MOVE 'S'                TO MR-SELECT (PV-SUB)            16230099
162400*                                                                 16240099
162500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           16250099
162600             MOVE ASC-INVC-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         16260099
162700                                 TO MR-INVC-NBR (PV-SUB)          16270099
162800             MOVE ASC-INVC-DTE (ASC-BLK-SUB ASC-ITEM-SUB)         16280099
162900                                 TO PV-DATE-FORMAT-DB2            16290099
163000             MOVE PV-DATE-DB2-MM TO PV-DATE-MM                    16300099
163100             MOVE PV-DATE-DB2-DD TO PV-DATE-DD                    16310099
163200             MOVE PV-DATE-DB2-CC TO PV-DATE-CC                    16320099
163300             MOVE PV-DATE-DB2-YY TO PV-DATE-YY                    16330099
163400             MOVE PV-DATE-FORMAT TO MR-INVC-DTE (PV-SUB)          16340099
163500             MOVE ASC-STR-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          16350099
163600                                 TO PV-STR-NBR                    16360099
163700             MOVE PV-STR-NBR     TO MR-STR-NBR-N (PV-SUB)         16370099
163800             MOVE ASC-DC-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)          16380099
163900                                 TO PV-DC-NBR                     16390099
164000             MOVE PV-DC-NBR      TO MR-DC-NBR-N (PV-SUB)          16400099
164100             MOVE ASC-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)             16410099
164200                                 TO MR-TYPE (PV-SUB)              16420099
164300             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           16430099
164400                                 TO MR-STATUS (PV-SUB)            16440099
164500             MOVE ASC-MTCH-LVL-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     16450099
164600                                 TO MR-MTCH-LVL (PV-SUB)          16460099
164700             MOVE ASC-GROSS-AMT (ASC-BLK-SUB ASC-ITEM-SUB)        16470099
164800                                 TO MR-GROSS-AMT-N (PV-SUB)       16480099
164900             MOVE ASC-ENTR-DTE (ASC-BLK-SUB ASC-ITEM-SUB)         16490099
165000                                 TO PV-DATE-FORMAT-DB2            16500099
165100             MOVE PV-DATE-DB2-MM TO PV-DATE-MM                    16510099
165200             MOVE PV-DATE-DB2-DD TO PV-DATE-DD                    16520099
165300             MOVE PV-DATE-DB2-CC TO PV-DATE-CC                    16530099
165400             MOVE PV-DATE-DB2-YY TO PV-DATE-YY                    16540099
165500             MOVE PV-DATE-FORMAT TO MR-ENTR-DTE (PV-SUB)          16550099
165600         END-IF                                                   16560099
165700     END-IF.                                                      16570099
165800     SUBTRACT +1 FROM ASC-ITEM-SUB                                16580099
165900     IF  ASC-ITEM-SUB < + 1                                       16590099
166000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  16600099
166100         MOVE +1                 TO ASC-BLK-SUB                   16610099
166200     END-IF.                                                      16620099
166300                                                                  16630099
166400*-----------------------------------------------------------------16640099
166500*  UPDATE THE STORE NUMBER FOR ALL ROWS FETCHED FROM TINVOIC.     16650099
166600*-----------------------------------------------------------------16660099
166700 5050-UPDATE-STORE-NUMBER.                                        16670099
166800     MOVE ASC-LIST-ITEM-NUMBER (1 1)                              16680099
166900                                 TO PV-LIST-ITEM-NUMBER.          16690099
167000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16700099
167100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16710099
167200     MOVE +1                     TO ASC-BLK-SUB.                  16720099
167300     PERFORM 5100-WRITE-TEMP-STORAGE.                             16730099
167400     ADD +1                      TO ASC-BLK-SUB.                  16740099
167500     PERFORM 5100-WRITE-TEMP-STORAGE.                             16750099
167600     PERFORM                                                      16760099
167700        VARYING PV-ITEM                                           16770099
167800        FROM 1 BY 1                                               16780099
167900        UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN           16790099
168000                                                                  16800099
168100        PERFORM 6112-READ-LIST-QUEUE                              16810099
168200                                                                  16820099
168300        IF PV-CICS-RESP = DFHRESP(NORMAL)                         16830099
168400           PERFORM                                                16840099
168500              VARYING LQW-IDX                                     16850099
168600              FROM 1 BY 1                                         16860099
168700              UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                  16870099
168800                 OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO         16880099
168900                 OR PS-ERROR                                      16890099
169000              EVALUATE TRUE                                       16900099
169100                 WHEN LQW-SELECT (LQW-IDX) OR                     16910099
169200                      LQW-TEMP-SELECT (LQW-IDX)                   16920099
169300                         INITIALIZE PV-SAVE-MTCH-LVL-CDE          16930099
169400                                    PV-SAVE-DC-NBR                16940099
169500                         IF LQW-DIR-STR-IND (LQW-IDX) = 'Y'       16950099
169600                            MOVE LQW-MTCH-LVL-CDE (LQW-IDX) TO    16960099
169700                                 PV-SAVE-MTCH-LVL-CDE             16970099
169800                            MOVE LQW-DC-NBR (LQW-IDX) TO          16980099
169900                                 PV-SAVE-DC-NBR                   16990099
169910                            PERFORM 6800-DIR-STR-UPDATE           16991099
169911                            PERFORM 5400-PROCESS-NINREC-ROLLUP    16991199
169912                            MOVE PC-BULK-IND TO                   16991299
169913                                 LQW-MTCH-LVL-CDE (LQW-IDX)       16991399
169914                         ELSE                                     16991499
169915                            MOVE LQW-MTCH-LVL-CDE (LQW-IDX) TO    16991599
169916                                 PV-SAVE-MTCH-LVL-CDE             16991699
169917                            MOVE LQW-DC-NBR (LQW-IDX)       TO    16991799
169918                                 PV-SAVE-DC-NBR                   16991899
169919                            PERFORM 6900-TINVOIC-ROLLUP-UPDATE    16991999
169920                            PERFORM 5400-PROCESS-NINREC-ROLLUP    16992099
169921                            IF LQW-MTCH-LVL-CDE (LQW-IDX) = 'S'   16992199
169922                               MOVE PC-DC-IND TO                  16992299
169923                                    LQW-MTCH-LVL-CDE (LQW-IDX)    16992399
169924                            ELSE                                  16992499
169925                               MOVE PC-BULK-IND TO                16992599
169926                                    LQW-MTCH-LVL-CDE (LQW-IDX)    16992699
169927                            END-IF                                16992799
169928                         END-IF                                   16992899
169929                    IF LQW-INVC-NBR (LQW-IDX) = PV-SAVE-INVC-NBR  16992999
169930                       MOVE LQW-INVC-NBR (LQW-IDX) TO             16993099
169940                            PV-SAVE-INVC-NBR                      16994099
169941                    ELSE                                          16994199
169942                       MOVE LQW-INVC-NBR (LQW-IDX) TO             16994299
169943                            PV-SAVE-INVC-NBR                      16994399
169944                       PERFORM 6700-INSERT-AUDINC                 16994499
169945                    END-IF                                        16994599
169946                    PERFORM 5300-REWRITE-LIST-QUEUE               16994699
169947              END-EVALUATE                                        16994799
169948           END-PERFORM                                            16994899
169949        END-IF                                                    16994999
169950     END-PERFORM.                                                 16995099
169960                                                                  16996099
169970*----------------------------------------------------------------*16997099
169980*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *16998099
169990*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *16999099
170000*----------------------------------------------------------------*17000099
170100                                                                  17010099
170200 5100-WRITE-TEMP-STORAGE.                                         17020099
170300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     17030099
170400                                   TO PV-LIST-ITEM-NUMBER.        17040099
170500     COMPUTE PV-BLOCK-NUMBER =                                    17050099
170600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17060099
170700                                                                  17070099
170800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             17080099
170900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             17090099
171000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      17100099
171100             PERFORM 5105-REWRITE-ASC-LISTQ                       17110099
171200         END-IF                                                   17120099
171300     ELSE                                                         17130099
171400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       17140099
171500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            17150099
171600         PERFORM 5110-WRITE-ASC-LISTQ                             17160099
171700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   17170099
171800     END-IF.                                                      17180099
171900                                                                  17190099
172000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17200099
172100******************************************************************17210099
172200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **17220099
172300** SPECIFIC COMMAREA.                                           **17230099
172400******************************************************************17240099
172500 5105-REWRITE-ASC-LISTQ.                                          17250099
172600     EXEC CICS                                                    17260099
172700         WRITEQ TS                                                17270099
172800             QUEUE (ASC-LIST-QUEUE-NAME)                          17280099
172900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17290099
173000             ITEM  (PV-BLOCK-NUMBER)                              17300099
173100             REWRITE                                              17310099
173200             RESP  (PV-CICS-RESP)                                 17320099
173300     END-EXEC.                                                    17330099
173400                                                                  17340099
173500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           17350099
173600         CONTINUE                                                 17360099
173700     ELSE                                                         17370099
173800         SET DP013-CICS-ABEND            TO TRUE                  17380099
173900         SET DP013-NO-ROLLBACK           TO TRUE                  17390099
174000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       17400099
174100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     17410099
174200                                         TO DP013-MESSAGE-TEXT(1) 17420099
174300         PERFORM DP013-0000-PROCESS-ABEND                         17430099
174400     END-IF.                                                      17440099
174500                                                                  17450099
174600******************************************************************17460099
174700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **17470099
174800** SPECIFIC COMMAREA.                                           **17480099
174900******************************************************************17490099
175000 5110-WRITE-ASC-LISTQ.                                            17500099
175100     EXEC CICS                                                    17510099
175200         WRITEQ TS                                                17520099
175300             QUEUE (ASC-LIST-QUEUE-NAME)                          17530099
175400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17540099
175500             ITEM  (PV-BLOCK-NUMBER)                              17550099
175600             RESP  (PV-CICS-RESP)                                 17560099
175700     END-EXEC.                                                    17570099
175800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      17580099
175900         SET DP013-CICS-ABEND      TO TRUE                        17590099
176000         SET DP013-NO-ROLLBACK     TO TRUE                        17600099
176100         MOVE '5110-WRITE-ASC-LISTQ'                              17610099
176200                                   TO DP013-PARAGRAPH             17620099
176300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           17630099
176400                                   TO DP013-MESSAGE-TEXT(1)       17640099
176500         PERFORM DP013-0000-PROCESS-ABEND                         17650099
176600     END-IF.                                                      17660099
176700                                                                  17670099
176800*----------------------------------------------------------------*17680099
176900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*17690099
177000*----------------------------------------------------------------*17700099
177100 5300-REWRITE-LIST-QUEUE.                                         17710099
177200                                                                  17720099
177300     EXEC CICS                                                    17730099
177400         WRITEQ TS                                                17740099
177500             QUEUE (ASC-LIST-QUEUE-NAME)                          17750099
177600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     17760099
177700             ITEM  (PV-ITEM)                                      17770099
177800             REWRITE                                              17780099
177900             RESP  (PV-CICS-RESP)                                 17790099
178000     END-EXEC.                                                    17800099
178100                                                                  17810099
178200     IF PV-CICS-RESP = DFHRESP (NORMAL)                           17820099
178300         CONTINUE                                                 17830099
178400     ELSE                                                         17840099
178500         SET DP013-CICS-ABEND        TO TRUE                      17850099
178600         SET DP013-NO-ROLLBACK       TO TRUE                      17860099
178700         MOVE '5300-REWRITE-LIST-QUEUE'                           17870099
178800                                     TO DP013-PARAGRAPH           17880099
178900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  17890099
179000                                     TO DP013-MESSAGE-TEXT(1)     17900099
179100         PERFORM DP013-0000-PROCESS-ABEND                         17910099
179200     END-IF.                                                      17920099
179300                                                                  17930099
179400*----------------------------------------------------------------*17940099
179500*    PROCESS PO RETRIEVED BY NINREC CURSOR.                      *17950099
179600*----------------------------------------------------------------*17960099
179700 5400-PROCESS-NINREC-ROLLUP.                                      17970099
179800     PERFORM 6200-OPEN-NINREC-CSR.                                17980099
179900     PERFORM 6300-FETCH-NINREC-CSR.                               17990099
180000     IF NINREC-END-OF-CSR                                         18000099
180100        PERFORM 6400-CLOSE-NINREC-CSR                             18010099
180200     ELSE                                                         18020099
180300        MOVE NINREC-PO-NBR TO HOLD-PO-NBR                         18030099
180400        MOVE NINREC-PO-LNE-NBR TO HOLD-PO-LNE-NBR                 18040099
180500        MOVE NINREC-UNT-COST-AMT TO HOLD-UNT-COST-AMT             18050099
180600        PERFORM 5500-PROCESS-NINREC-CSR                           18060099
180700           UNTIL NINREC-END-OF-CSR                                18070099
180800        PERFORM 5600-PROCESS-LAST-PO-LNE-NBR                      18080099
180900        MOVE +1                     TO ASC-BLK-SUB                18090099
181000        MOVE PV-FIRST-BLOCK-IN-ARRAY                              18100099
181100                                    TO PV-BLOCK-NUMBER            18110099
181200        PERFORM 4410-READ-TEMP-STORAGE                            18120099
181300        ADD +1                      TO PV-BLOCK-NUMBER            18130099
181400                                       ASC-BLK-SUB                18140099
181500        PERFORM 4410-READ-TEMP-STORAGE                            18150099
181600        IF NINREC-END-OF-CSR                                      18160099
181700           PERFORM 6400-CLOSE-NINREC-CSR                          18170099
181800        ELSE                                                      18180099
181900           CONTINUE                                               18190099
182000        END-IF                                                    18200099
182100     END-IF.                                                      18210099
182200                                                                  18220099
182300*----------------------------------------------------------------*18230099
182400*    PROCESS NINRECS RETRIEVED BY NINREC CURSOR UNTIL            *18240099
182500*    NINREC-END-OF-CSR IS REACHED.                               *18250099
182600*----------------------------------------------------------------*18260099
182700 5500-PROCESS-NINREC-CSR.                                         18270099
182800     IF (NINREC-PO-NBR = HOLD-PO-NBR                              18280099
182900        AND NINREC-PO-LNE-NBR = HOLD-PO-LNE-NBR                   18290099
183000        AND NINREC-UNT-COST-AMT = HOLD-UNT-COST-AMT)              18300099
183100           ADD NINREC-NON-INVC-UNT-QTY TO ACCUM-QTY               18310099
183200           PERFORM 6500-UPDATE-NINREC                             18320099
183300     ELSE                                                         18330099
183400        MOVE ACCUM-QTY TO PV-NON-INVC-UNT-QTY                     18340099
183500        MULTIPLY HOLD-UNT-COST-AMT BY ACCUM-QTY GIVING            18350099
183600                 TOTAL-LNE-COST                                   18360099
183700        ADD TOTAL-LNE-COST TO TOTAL-PO-COST                       18370099
183800        PERFORM 6600-INSERT-NINREC                                18380099
183900        MOVE NINREC-PO-NBR TO HOLD-PO-NBR                         18390099
184000        MOVE NINREC-PO-LNE-NBR TO HOLD-PO-LNE-NBR                 18400099
184100        MOVE NINREC-UNT-COST-AMT TO HOLD-UNT-COST-AMT             18410099
184200        MOVE 0 TO ACCUM-QTY                                       18420099
184300        MOVE NINREC-NON-INVC-UNT-QTY TO ACCUM-QTY                 18430099
184400        PERFORM 6500-UPDATE-NINREC                                18440099
184500     END-IF.                                                      18450099
184600                                                                  18460099
184700     MOVE NINREC-PO-NBR           TO PV-PO-NBR.                   18470099
184710     MOVE NINREC-VER-NBR          TO PV-VER-NBR.                  18471099
184720     MOVE NINREC-PO-LNE-NBR       TO PV-PO-LNE-NBR                18472099
184730                                     HOLD-PO-LNE-NBR.             18473099
184740     IF LQW-DIR-STR-IND (LQW-IDX) = 'Y'                           18474099
184750        MOVE ZERO                    TO PV-STR-NBR                18475099
184760                                        PV-DC-NBR                 18476099
184770     ELSE                                                         18477099
184780        IF PV-SAVE-MTCH-LVL-CDE = 'S'                             18478099
184781           MOVE NINREC-DC-NBR        TO PV-STR-NBR                18478199
184782                                        PV-DC-NBR                 18478299
184783        ELSE                                                      18478399
184784           IF PV-SAVE-MTCH-LVL-CDE = 'D'                          18478499
184785              MOVE ZERO              TO PV-STR-NBR                18478599
184786                                        PV-DC-NBR                 18478699
184787           END-IF                                                 18478799
184788        END-IF                                                    18478899
184789     END-IF.                                                      18478999
184790     MOVE NINREC-NON-INVC-UNT-QTY TO PV-NON-INVC-UNT-QTY.         18479099
184791     MOVE NINREC-UNT-COST-AMT     TO PV-UNT-COST-AMT              18479199
184792                                     HOLD-UNT-COST-AMT.           18479299
184793     MOVE NINREC-PAYT-RLSE-TMST   TO PV-PAYT-RLSE-TMST.           18479399
184794     MOVE NINREC-STATUS-CDE       TO PV-STATUS-CDE.               18479499
184795     MOVE NINREC-PAYT-DTE         TO PV-PAYT-DTE.                 18479599
184796     MOVE NINREC-REC-TMST         TO PV-REC-TMST.                 18479699
184797     MOVE NINREC-ORIG-DISC-PCT    TO PV-ORIG-DISC-PCT.            18479799
184798                                                                  18479899
184799     PERFORM 6300-FETCH-NINREC-CSR.                               18479999
184800                                                                  18480099
184801*----------------------------------------------------------------*18480199
184802*    PROCESS THE LAST PO-LNE-NBR RETRIEVED BY THE NINREC CURSOR. *18480299
184803*----------------------------------------------------------------*18480399
184804 5600-PROCESS-LAST-PO-LNE-NBR.                                    18480499
184805                                                                  18480599
184806     IF NINREC-END-OF-CSR                                         18480699
184807        MOVE NINREC-PO-NBR           TO PV-PO-NBR                 18480799
184808        MOVE NINREC-VER-NBR          TO PV-VER-NBR                18480899
184809        MOVE NINREC-PO-LNE-NBR       TO PV-PO-LNE-NBR             18480999
184810                                        HOLD-PO-LNE-NBR           18481099
184811        IF LQW-DIR-STR-IND (LQW-IDX) = 'Y'                        18481199
184812           MOVE ZERO                    TO PV-STR-NBR             18481299
184813                                           PV-DC-NBR              18481399
184814        ELSE                                                      18481499
184815           IF PV-SAVE-MTCH-LVL-CDE = 'S'                          18481599
184816              MOVE NINREC-DC-NBR        TO PV-STR-NBR             18481699
184817                                           PV-DC-NBR              18481799
184818           ELSE                                                   18481899
184819              IF PV-SAVE-MTCH-LVL-CDE = 'D'                       18481999
184820                 MOVE ZERO              TO PV-STR-NBR             18482099
184821                                           PV-DC-NBR              18482199
184822              END-IF                                              18482299
184823           END-IF                                                 18482399
184824        END-IF                                                    18482499
184825        MOVE NINREC-NON-INVC-UNT-QTY TO PV-NON-INVC-UNT-QTY       18482599
184826        MOVE NINREC-UNT-COST-AMT     TO PV-UNT-COST-AMT           18482699
184827                                        HOLD-UNT-COST-AMT         18482799
184828        MOVE NINREC-PAYT-RLSE-TMST   TO PV-PAYT-RLSE-TMST         18482899
184829        MOVE NINREC-STATUS-CDE       TO PV-STATUS-CDE             18482999
184830        MOVE NINREC-PAYT-DTE         TO PV-PAYT-DTE               18483099
184831        MOVE NINREC-REC-TMST         TO PV-REC-TMST               18483199
184832        MOVE NINREC-ORIG-DISC-PCT    TO PV-ORIG-DISC-PCT          18483299
184833        MOVE ACCUM-QTY               TO PV-NON-INVC-UNT-QTY       18483399
184834        MULTIPLY HOLD-UNT-COST-AMT BY ACCUM-QTY GIVING            18483499
184835                 TOTAL-LNE-COST                                   18483599
184836        ADD TOTAL-LNE-COST           TO TOTAL-PO-COST             18483699
184837                                                                  18483799
184838        PERFORM 6600-INSERT-NINREC                                18483899
184839                                                                  18483999
184840        MOVE NINREC-PO-NBR           TO HOLD-PO-NBR               18484099
184841        MOVE NINREC-PO-LNE-NBR       TO HOLD-PO-LNE-NBR           18484199
184842        MOVE NINREC-UNT-COST-AMT     TO HOLD-UNT-COST-AMT         18484299
184843        MOVE 0                       TO ACCUM-QTY                 18484399
184844        MOVE NINREC-NON-INVC-UNT-QTY TO ACCUM-QTY                 18484499
184845                                                                  18484599
184846        PERFORM 6500-UPDATE-NINREC                                18484699
184847     END-IF.                                                      18484799
184848                                                                  18484899
184849******************************************************************18484999
184850** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **18485099
184860** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **18486099
184870** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **18487099
184880** THE USER.                                                    **18488099
184890******************************************************************18489099
184900 6000-REFRESH-PANEL-FROM-TEMP.                                    18490099
185000     IF  ASC-UPDATE-TSQ                                           18500099
185100         SET ASC-NO-TSQ-UPDATE TO TRUE                            18510099
185200         MOVE ZERO                 TO PV-SAVE-ITEM                18520099
185300                                      PV-SEL-QUEUE-ITEM           18530099
185400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        18540099
185500                                   TO PV-HOLD-SELECTED-ITEMS      18550099
185600         MOVE +1                   TO PV-ITEMS-PROCESSED          18560099
185700         PERFORM 6100-UPDATE-TSQ                                  18570099
185800             UNTIL PV-ITEMS-PROCESSED >                           18580099
185900                                     PV-HOLD-SELECTED-ITEMS       18590099
186000         PERFORM 6010-DELETE-SEL-QUEUE                            18600099
186100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         18610099
186200                    ASC-BLOCK-ENTRIES (2)                         18620099
186300     END-IF.                                                      18630099
186400                                                                  18640099
186500*----------------------------------------------------------------*18650099
186600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *18660099
186700*----------------------------------------------------------------*18670099
186800 6010-DELETE-SEL-QUEUE.                                           18680099
186900                                                                  18690099
187000     EXEC CICS                                                    18700099
187100         DELETEQ TS                                               18710099
187200             QUEUE (ASC-SEL-QUEUE-NAME)                           18720099
187300             RESP  (PV-CICS-RESP)                                 18730099
187400     END-EXEC.                                                    18740099
187500                                                                  18750099
187600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      18760099
187700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         18770099
187800         CONTINUE                                                 18780099
187900     ELSE                                                         18790099
188000         SET DP013-CICS-ABEND TO TRUE                             18800099
188100         SET DP013-NO-ROLLBACK TO TRUE                            18810099
188200         MOVE '6010-DELETE-SEL-QUEUE'                             18820099
188300                        TO DP013-PARAGRAPH                        18830099
188400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         18840099
188500                        TO DP013-MESSAGE-TEXT (1)                 18850099
188600         PERFORM DP013-0000-PROCESS-ABEND                         18860099
188700     END-IF.                                                      18870099
188800                                                                  18880099
188900*----------------------------------------------------------------*18890099
189000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *18900099
189100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *18910099
189200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *18920099
189300*    THE TEMP QUEUE.                                             *18930099
189400*----------------------------------------------------------------*18940099
189500                                                                  18950099
189600 6100-UPDATE-TSQ.                                                 18960099
189700     CONTINUE.                                                    18970099
189800*----------------------------------------------------------------*18980099
189900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *18990099
190000*----------------------------------------------------------------*19000099
190100*                                                                 19010099
190200 6111-WRITE-LIST-QUEUE.                                           19020099
190300                                                                  19030099
190400     EXEC CICS                                                    19040099
190500         WRITEQ TS                                                19050099
190600             QUEUE (ASC-LIST-QUEUE-NAME)                          19060099
190700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     19070099
190800             ITEM  (PV-SAVE-ITEM)                                 19080099
190900             REWRITE                                              19090099
191000             RESP  (PV-CICS-RESP)                                 19100099
191100     END-EXEC.                                                    19110099
191200                                                                  19120099
191300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          19130099
191400         CONTINUE                                                 19140099
191500     ELSE                                                         19150099
191600         SET DP013-CICS-ABEND  TO  TRUE                           19160099
191700         SET DP013-NO-ROLLBACK TO  TRUE                           19170099
191800         MOVE '6111-WRITE-LIST-QUEUE'                             19180099
191900                               TO  DP013-PARAGRAPH                19190099
192000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  19200099
192100                               TO  DP013-MESSAGE-TEXT(1)          19210099
192200         PERFORM DP013-0000-PROCESS-ABEND                         19220099
192300     END-IF.                                                      19230099
192400                                                                  19240099
192500                                                                  19250099
192600*----------------------------------------------------------------*19260099
192700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*19270099
192800*----------------------------------------------------------------*19280099
192900                                                                  19290099
193000 6112-READ-LIST-QUEUE.                                            19300099
193100                                                                  19310099
193200     EXEC CICS                                                    19320099
193300         READQ TS                                                 19330099
193400             QUEUE (ASC-LIST-QUEUE-NAME)                          19340099
193500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     19350099
193600             ITEM  (PV-ITEM)                                      19360099
193700             RESP  (PV-CICS-RESP)                                 19370099
193800     END-EXEC.                                                    19380099
193900*                                                                 19390099
194000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          19400099
194100         CONTINUE                                                 19410099
194200     ELSE                                                         19420099
194300         SET DP013-CICS-ABEND        TO TRUE                      19430099
194400         SET DP013-NO-ROLLBACK       TO TRUE                      19440099
194500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           19450099
194600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    19460099
194700                                     TO DP013-MESSAGE-TEXT(1)     19470099
194800         PERFORM DP013-0000-PROCESS-ABEND                         19480099
194900     END-IF.                                                      19490099
195000                                                                  19500099
195100*-----------------------------------------------------------      19510099
195200*  OPENS THE NINREC_CSR                                           19520099
195300*-----------------------------------------------------------      19530099
195400 6200-OPEN-NINREC-CSR.                                            19540099
195410     EXEC SQL                                                     19541099
195420         OPEN NINREC_CSR                                          19542099
195430     END-EXEC.                                                    19543099
195440     EVALUATE TRUE                                                19544099
195450        WHEN SQLCODE = ZERO                                       19545099
195460           CONTINUE                                               19546099
195470        WHEN OTHER                                                19547099
195480           MOVE '6200-OPEN-NINREC-CSR'   TO DP013-PARAGRAPH       19548099
195490           MOVE 'UNSUCCESSFUL OPEN '     TO DP013-MESSAGE-TEXT(1) 19549099
195491           PERFORM DP013-0000-PROCESS-ABEND                       19549199
195492     END-EVALUATE.                                                19549299
195493 EJECT                                                            19549399
195494                                                                  19549499
195495*-----------------------------------------------------------      19549599
195496* FETCH ROWS FROM THE NINREC_CSR                                  19549699
195497*-----------------------------------------------------------      19549799
195498 6300-FETCH-NINREC-CSR.                                           19549899
195499     EXEC SQL                                                     19549999
195500         FETCH  NINREC_CSR                                        19550099
195501          INTO :NINREC-PO-NBR                                     19550199
195502             , :NINREC-VER-NBR                                    19550299
195503             , :NINREC-PO-LNE-NBR                                 19550399
195504             , :NINREC-NON-INVC-SEQ-NBR                           19550499
195505             , :NINREC-STR-NBR                                    19550599
195506             , :NINREC-NON-INVC-UNT-QTY                           19550699
195507             , :NINREC-UNT-COST-AMT                               19550799
195508             , :NINREC-PAYT-RLSE-TMST                             19550899
195509             , :NINREC-STATUS-CDE                                 19550999
195510             , :NINREC-PAYT-DTE                                   19551099
195511             , :NINREC-REC-TMST                                   19551199
195512             , :NINREC-ORIG-DISC-PCT                              19551299
195513             , :NINREC-DC-NBR                                     19551399
195514     END-EXEC.                                                    19551499
195515                                                                  19551599
195516     EVALUATE TRUE                                                19551699
195517        WHEN SQLCODE = ZERO                                       19551799
195518           CONTINUE                                               19551899
195519        WHEN SQLCODE = +100                                       19551999
195520           SET NINREC-END-OF-CSR TO TRUE                          19552099
195521        WHEN SQLCODE  NOT = ZERO                                  19552199
195522           MOVE '6300-FETCH-NINREC-CSR'  TO DP013-PARAGRAPH       19552299
195523           MOVE 'UNSUCCESSFUL FETCH'     TO DP013-MESSAGE-TEXT(1) 19552399
195524           PERFORM DP013-0000-PROCESS-ABEND                       19552499
195525     END-EVALUATE.                                                19552599
195526                                                                  19552699
195527*-----------------------------------------------------------      19552799
195528*  CLOSES THE NINREC_CSR                                          19552899
195529*-----------------------------------------------------------      19552999
195530 6400-CLOSE-NINREC-CSR.                                           19553099
195540     EXEC SQL                                                     19554099
195541         CLOSE NINREC_CSR                                         19554199
195542     END-EXEC.                                                    19554299
195543     EVALUATE TRUE                                                19554399
195544        WHEN SQLCODE = ZERO                                       19554499
195545           CONTINUE                                               19554599
195546        WHEN OTHER                                                19554699
195547           MOVE '6400-CLOSE-NINREC-CSR'  TO DP013-PARAGRAPH       19554799
195548           MOVE 'UNSUCCESSFUL CLOSE'     TO DP013-MESSAGE-TEXT(1) 19554899
195549           PERFORM DP013-0000-PROCESS-ABEND                       19554999
195550     END-EVALUATE.                                                19555099
195551 EJECT                                                            19555199
195552                                                                  19555299
195553*-----------------------------------------------------------      19555399
195554* UPDATE NINREC ROWS TO 'X' STATUS                                19555499
195555*-----------------------------------------------------------      19555599
195556 6500-UPDATE-NINREC.                                              19555699
195557     EXEC SQL                                                     19555799
195558         UPDATE TNINREC                                           19555899
195559            SET STATUS_CDE = 'X '                                 19555999
195560          WHERE PO_NBR           = :NINREC-PO-NBR                 19556099
195561            AND PO_LNE_NBR       = :NINREC-PO-LNE-NBR             19556199
195562            AND NON_INVC_SEQ_NBR = :NINREC-NON-INVC-SEQ-NBR       19556299
195563     END-EXEC.                                                    19556399
195564                                                                  19556499
195565     EVALUATE TRUE                                                19556599
195566        WHEN SQLCODE = ZERO                                       19556699
195567           CONTINUE                                               19556799
195568        WHEN SQLCODE NOT = ZERO                                   19556899
195569           MOVE '6500-UPDATE-NINREC'     TO DP013-PARAGRAPH       19556999
195570           MOVE 'UNSUCCESSFUL UPDATE'    TO DP013-MESSAGE-TEXT(1) 19557099
195580           PERFORM DP013-0000-PROCESS-ABEND                       19558099
195581     END-EVALUATE.                                                19558199
195582                                                                  19558299
195583*-----------------------------------------------------------      19558399
195584* INSERTS NEW ROW INTO NINREC TABLE                               19558499
195585*-----------------------------------------------------------      19558599
195586 6600-INSERT-NINREC.                                              19558699
195587                                                                  19558799
195588** CREATES NEW SEQUENCE NUMBER                                    19558899
195589     EXEC SQL                                                     19558999
195590          SET :KEY-TIMESTAMP = CURRENT TIMESTAMP                  19559099
195591     END-EXEC                                                     19559199
195592                                                                  19559299
195593     IF SQLCODE NOT = ZERO                                        19559399
195594        MOVE '6600-INSERT-NINREC'         TO DP013-PARAGRAPH      19559499
195595        MOVE 'UNSUCCESSFUL SET TIMESTAMP' TO DP013-MESSAGE-TEXT(1)19559599
195596        PERFORM DP013-0000-PROCESS-ABEND                          19559699
195597     END-IF.                                                      19559799
195598                                                                  19559899
195599     MOVE KEY-NANOSEC-2     TO PV-RANDOM-KEY-NANOSEC-1            19559999
195600     MOVE KEY-NANOSEC-1     TO PV-RANDOM-KEY-NANOSEC-2            19560099
195610     MOVE KEY-MINUTE        TO PV-RANDOM-KEY-MINUTE               19561099
195611     MOVE KEY-SECOND        TO PV-RANDOM-KEY-SECOND               19561199
195612     MOVE PV-RANDOM-KEY     TO PV-RANDOM-KEY-INT                  19561299
195613     MOVE PV-RANDOM-KEY-INT TO PV-NON-INVC-SEQ-NBR                19561399
195614                                                                  19561499
195615     EXEC SQL                                                     19561599
195616         INSERT INTO TNINREC                                      19561699
195617                ( PO_NBR                                          19561799
195618                , VER_NBR                                         19561899
195619                , PO_LNE_NBR                                      19561999
195620                , NON_INVC_SEQ_NBR                                19562099
195621                , STR_NBR                                         19562199
195622                , NON_INVC_UNT_QTY                                19562299
195623                , UNT_COST_AMT                                    19562399
195624                , PAYT_RLSE_TMST                                  19562499
195625                , STATUS_CDE                                      19562599
195626                , PAYT_DTE                                        19562699
195627                , REC_TMST                                        19562799
195628                , ORIG_DISC_PCT                                   19562899
195629                , DC_NBR                                          19562999
195630                )                                                 19563099
195631          VALUES( :PV-PO-NBR                                      19563199
195632                , :PV-VER-NBR                                     19563299
195633                , :PV-PO-LNE-NBR                                  19563399
195634                , :PV-NON-INVC-SEQ-NBR                            19563499
195635                , :PV-STR-NBR                                     19563599
195636                , :PV-NON-INVC-UNT-QTY                            19563699
195637                , :PV-UNT-COST-AMT                                19563799
195638                , :PV-PAYT-RLSE-TMST                              19563899
195639                , :PV-STATUS-CDE                                  19563999
195640                , :PV-PAYT-DTE                                    19564099
195641                , :PV-REC-TMST                                    19564199
195642                , :PV-ORIG-DISC-PCT                               19564299
195643                , :PV-DC-NBR                                      19564399
195644                )                                                 19564499
195645     END-EXEC.                                                    19564599
195646                                                                  19564699
195647     EVALUATE TRUE                                                19564799
195648        WHEN SQLCODE = ZERO                                       19564899
195649           CONTINUE                                               19564999
195650        WHEN SQLCODE  NOT = ZERO                                  19565099
195651           MOVE '6600-INSERT-NINREC'     TO DP013-PARAGRAPH       19565199
195652           MOVE 'UNSUCCESSFUL INSERT'    TO DP013-MESSAGE-TEXT(1) 19565299
195653           PERFORM DP013-0000-PROCESS-ABEND                       19565399
195654     END-EVALUATE.                                                19565499
195655                                                                  19565599
195656*-----------------------------------------------------------      19565699
195657* INSERTS NEW ROW INTO AUDINC TABLE                               19565799
195658*-----------------------------------------------------------      19565899
195659 6700-INSERT-AUDINC.                                              19565999
195660                                                                  19566099
195670     MOVE 'OL'                 TO AUDINC-CRE-PRC-CDE.             19567099
195680     MOVE 'RL'                 TO AUDINC-ACT-CDE.                 19568099
195681     MOVE DP020-USERID         TO AUDINC-CRE-ID.                  19568199
195682     MOVE DP020-TERM-ID        TO AUDINC-LTERM-ID.                19568299
195683                                                                  19568399
195684*    THE UNIQUE KEY TO TAUDINC IS TMST, TABLE, FLD_CDE.           19568499
195685*    BECAUSE MULTIPLE ROWS CAN BE CREATED ON TAUDINC, BUMP UP     19568599
195686*    THE MILLISECONDS FIELD TO ASSURE UNIQUENESS.                 19568699
195687                                                                  19568799
195688     ADD  1                    TO ASC-MILLISECONDS.               19568899
195689     MOVE ASC-WORK-TIMESTAMP   TO AUDINC-AUD-TMST.                19568999
195690                                                                  19569099
195700     MOVE 11                   TO AUDINC-AUD-FLD-CDE.             19570099
195710     MOVE 'TINVOIC'            TO AUDINC-AUD-TAB-NAME.            19571099
195720                                                                  19572099
195730     MOVE ASC-KEY-PO-NBR       TO AUDINC-PO-NBR.                  19573099
195731     MOVE LQW-INVC-NBR (LQW-IDX)                                  19573199
195732                               TO AUDINC-INVC-ID.                 19573299
195733                                                                  19573399
195734     IF LQW-DIR-STR-IND (LQW-IDX) = 'N'                           19573499
195735        IF PV-SAVE-MTCH-LVL-CDE = 'S'                             19573599
195736           MOVE 'S'            TO AUDINC-FLD-VAL-BEF              19573699
195737           MOVE 'D'            TO AUDINC-FLD-VAL-AFT              19573799
195738        ELSE                                                      19573899
195739           IF PV-SAVE-MTCH-LVL-CDE = 'D'                          19573999
195740              MOVE 'D'         TO AUDINC-FLD-VAL-BEF              19574099
195741              MOVE 'P'         TO AUDINC-FLD-VAL-AFT              19574199
195742           END-IF                                                 19574299
195743        END-IF                                                    19574399
195744     ELSE                                                         19574499
195745        MOVE 'S'               TO AUDINC-FLD-VAL-BEF              19574599
195746        MOVE 'P'               TO AUDINC-FLD-VAL-AFT              19574699
195747     END-IF.                                                      19574799
195748                                                                  19574899
195749     PERFORM                                                      19574999
195750         WITH TEST AFTER                                          19575099
195751         VARYING PV-RETRY-COUNTER                                 19575199
195752         FROM 1 BY 1                                              19575299
195753         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19575399
195754             OR (SQLCODE = +0))                                   19575499
195755                                                                  19575599
195756         EXEC SQL                                                 19575699
195757              INSERT INTO TAUDINC                                 19575799
195758                  (                                               19575899
195759                   CRE_PRC_CDE                                    19575999
195760                  ,CRE_ID                                         19576099
195761                  ,LTERM_ID                                       19576199
195762                  ,AUD_TMST                                       19576299
195763                  ,AUD_TAB_NAME                                   19576399
195764                  ,AUD_FLD_CDE                                    19576499
195765                  ,ACT_CDE                                        19576599
195766                  ,FLD_VAL_BEF                                    19576699
195767                  ,FLD_VAL_AFT                                    19576799
195768                  ,PO_NBR                                         19576899
195769                  ,INVC_ID                                        19576999
195770                   )                                              19577099
195771            VALUES (                                              19577199
195772                  :AUDINC-CRE-PRC-CDE                             19577299
195773                 ,:AUDINC-CRE-ID                                  19577399
195774                 ,:AUDINC-LTERM-ID                                19577499
195775                 , CURRENT TIMESTAMP                              19577599
195776                 ,:AUDINC-AUD-TAB-NAME                            19577699
195777                 ,:AUDINC-AUD-FLD-CDE                             19577799
195778                 ,:AUDINC-ACT-CDE                                 19577899
195779                 ,:AUDINC-FLD-VAL-BEF                             19577999
195780                 ,:AUDINC-FLD-VAL-AFT                             19578099
195781                 ,:AUDINC-PO-NBR                                  19578199
195782                 ,:AUDINC-INVC-ID                                 19578299
195783                   )                                              19578399
195784         END-EXEC                                                 19578499
195785                                                                  19578599
195786         EVALUATE TRUE                                            19578699
195787             WHEN SQLCODE = +0                                    19578799
195788             WHEN SQLCODE = -904                                  19578899
195789             WHEN SQLCODE = -913                                  19578999
195790                  CONTINUE                                        19579099
195791                                                                  19579199
195792             WHEN SQLWARN0 NOT = SPACES                           19579299
195793             WHEN SQLCODE < +0                                    19579399
195794             WHEN SQLCODE > +0                                    19579499
195795                  MOVE '6700-INSERT-TAUDINC'                      19579599
195796                                  TO DP013-PARAGRAPH              19579699
195797                  MOVE 'UNSUCCESSFUL INSERT FOR TAUDINC'          19579799
195798                                  TO DP013-MESSAGE-TEXT (1)       19579899
195799                  MOVE SQLCA      TO DP013-SQLCA                  19579999
195800                  MOVE 'TAUDINC ' TO DP013-DB2-TABLE-NAME (1)     19580099
195801                  SET DP013-DB2-ABEND                             19580199
195802                      DP013-XCTL-DISPLAY-RESTART                  19580299
195803                                  TO TRUE                         19580399
195804                  PERFORM DP013-0000-PROCESS-ABEND                19580499
195805         END-EVALUATE                                             19580599
195806     END-PERFORM.                                                 19580699
195807                                                                  19580799
195808     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19580899
195809         MOVE '6700-INSERT-TAUDINC'                               19580999
195810                                  TO DP013-PARAGRAPH              19581099
195811         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON TAUDINC'        19581199
195812                                  TO DP013-MESSAGE-TEXT (1)       19581299
195813         MOVE SQLCA               TO DP013-SQLCA                  19581399
195814         MOVE 'TAUDINC '          TO DP013-DB2-TABLE-NAME (1)     19581499
195815         SET DP013-DB2-ABEND                                      19581599
195816             DP013-XCTL-DISPLAY-RESTART                           19581699
195817                                  TO TRUE                         19581799
195818         PERFORM DP013-0000-PROCESS-ABEND                         19581899
195819     END-IF.                                                      19581999
195820                                                                  19582099
195821*-----------------------------------------------------------      19582199
195822* UPDATES TINVOIC FOR A ROLLUP FROM DIRECT STORE TO BULK.         19582299
195823*-----------------------------------------------------------      19582399
195824 6800-DIR-STR-UPDATE.                                             19582499
195825                                                                  19582599
195826     MOVE LQW-PAYT-REQ-SEQ-NBR (LQW-IDX) TO PV-PAYT-REQ-SEQ-NBR.  19582699
195827                                                                  19582799
195828     EXEC SQL                                                     19582899
195829        UPDATE TINVOIC                                            19582999
195830        SET MTCH_LVL_CDE = :PC-BULK-IND                           19583099
195831           ,STATUS_CHG_TMST = CURRENT TIMESTAMP                   19583199
195832        WHERE PAYT_REQ_SEQ_NBR = :PV-PAYT-REQ-SEQ-NBR             19583299
195833     END-EXEC                                                     19583399
195834                                                                  19583499
195835     EVALUATE TRUE                                                19583599
195836        WHEN SQLCODE = ZERO                                       19583699
195837           COMPUTE ASC-ITEMS-UPDATED = ASC-ITEMS-UPDATED + 1      19583799
195838        WHEN SQLCODE = +100                                       19583899
195839           SET PS-ERROR                                           19583999
195840               DP020-MSG-FATAL  TO TRUE                           19584099
195850           SET ASC-AT-ITEM TO LQW-IDX                             19585099
195860           MOVE PC-TSYMSG-02417 TO DP020-MSG-NUMBER               19586099
195870        WHEN SQLCODE = -904                                       19587099
195880        WHEN SQLCODE = -913                                       19588099
195890           CONTINUE                                               19589099
195900        WHEN SQLWARN0 NOT = SPACES                                19590099
195910        WHEN SQLCODE < ZERO                                       19591099
195920        WHEN SQLCODE > ZERO                                       19592099
195921           MOVE '6800-DIR-STR-UPDATE' TO DP013-PARAGRAPH          19592199
195922           MOVE 'UPDATE ROW ON TINVOIC TABLE'                     19592299
195923                                      TO DP013-MESSAGE-TEXT(1)    19592399
195924           MOVE SQLCA                 TO DP013-SQLCA              19592499
195925           MOVE 'TINVOIC'             TO DP013-DB2-TABLE-NAME (1) 19592599
195926           SET DP013-DB2-ABEND                                    19592699
195927               DP013-XCTL-DISPLAY-RESTART TO TRUE                 19592799
195928           PERFORM DP013-0000-PROCESS-ABEND                       19592899
195929     END-EVALUATE.                                                19592999
195930                                                                  19593099
195931*-----------------------------------------------------------      19593199
195932* UPDATES TINVOIC FOR A ROLLUP FROM STORE TO DC ('S' TO 'D')      19593299
195933* OR FROM DC TO BULK ('D' TO 'P').                                19593399
195934*-----------------------------------------------------------      19593499
195935 6900-TINVOIC-ROLLUP-UPDATE.                                      19593599
195936                                                                  19593699
195937     MOVE LQW-PAYT-REQ-SEQ-NBR (LQW-IDX) TO PV-PAYT-REQ-SEQ-NBR.  19593799
195938                                                                  19593899
195939     IF LQW-MTCH-LVL-CDE (LQW-IDX) = 'S'                          19593999
195940        MOVE 'D' TO PV-MTCH-LVL-IND                               19594099
195941           EXEC SQL                                               19594199
195942              UPDATE TINVOIC                                      19594299
195943              SET MTCH_LVL_CDE = :PV-MTCH-LVL-IND                 19594399
195944                 ,STATUS_CHG_TMST = CURRENT TIMESTAMP             19594499
195945              WHERE PAYT_REQ_SEQ_NBR = :PV-PAYT-REQ-SEQ-NBR       19594599
195946           END-EXEC                                               19594699
195947           EVALUATE TRUE                                          19594799
195948              WHEN SQLCODE = ZERO                                 19594899
195949                 COMPUTE ASC-ITEMS-UPDATED =                      19594999
195950                            ASC-ITEMS-UPDATED + 1                 19595099
195951              WHEN SQLCODE = +100                                 19595199
195952                 SET PS-ERROR                                     19595299
195953                     DP020-MSG-FATAL  TO TRUE                     19595399
195954                 SET ASC-AT-ITEM TO LQW-IDX                       19595499
195955                 MOVE PC-TSYMSG-02417 TO DP020-MSG-NUMBER         19595599
195956              WHEN SQLCODE = -904                                 19595699
195957              WHEN SQLCODE = -913                                 19595799
195958                 CONTINUE                                         19595899
195959              WHEN SQLWARN0 NOT = SPACES                          19595999
195960              WHEN SQLCODE < ZERO                                 19596099
195961              WHEN SQLCODE > ZERO                                 19596199
195962                 MOVE '6900-TINVOIC-ROLLUP-UPDATE'                19596299
195963                         TO DP013-PARAGRAPH                       19596399
195964                 MOVE 'UPDATE ROW ON TINVOIC TABLE'               19596499
195965                                        TO DP013-MESSAGE-TEXT(1)  19596599
195966                 MOVE SQLCA             TO DP013-SQLCA            19596699
195967                 MOVE 'TINVOIC'         TO DP013-DB2-TABLE-NAME(1)19596799
195968                 SET DP013-DB2-ABEND                              19596899
195969                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19596999
195970                 PERFORM DP013-0000-PROCESS-ABEND                 19597099
195971           END-EVALUATE                                           19597199
195972        ELSE                                                      19597299
195973           IF LQW-MTCH-LVL-CDE (LQW-IDX) = 'D'                    19597399
195974              MOVE 'P' TO PV-MTCH-LVL-IND                         19597499
195975                 EXEC SQL                                         19597599
195976                    UPDATE TINVOIC                                19597699
195977                    SET MTCH_LVL_CDE = :PV-MTCH-LVL-IND           19597799
195978                       ,STATUS_CHG_TMST = CURRENT TIMESTAMP       19597899
195979                    WHERE PAYT_REQ_SEQ_NBR = :PV-PAYT-REQ-SEQ-NBR 19597999
195980                 END-EXEC                                         19598099
195981                 EVALUATE TRUE                                    19598199
195982                    WHEN SQLCODE = ZERO                           19598299
195983                       COMPUTE ASC-ITEMS-UPDATED =                19598399
195984                               ASC-ITEMS-UPDATED + 1              19598499
195985                    WHEN SQLCODE = +100                           19598599
195986                       SET PS-ERROR                               19598699
195987                           DP020-MSG-FATAL  TO TRUE               19598799
195988                       SET ASC-AT-ITEM TO LQW-IDX                 19598899
195989                       MOVE PC-TSYMSG-02417 TO DP020-MSG-NUMBER   19598999
195990                    WHEN SQLCODE = -904                           19599099
195991                    WHEN SQLCODE = -913                           19599199
195992                       CONTINUE                                   19599299
195993                    WHEN SQLWARN0 NOT = SPACES                    19599399
195994                    WHEN SQLCODE < ZERO                           19599499
195995                    WHEN SQLCODE > ZERO                           19599599
195996                    MOVE '6900-TINVOIC-ROLLUP-UPDATE'             19599699
195997                            TO DP013-PARAGRAPH                    19599799
195998                    MOVE 'UPDATE ROW ON TINVOIC TABLE'            19599899
195999                                       TO DP013-MESSAGE-TEXT(1)   19599999
196000                    MOVE SQLCA         TO DP013-SQLCA             19600099
196001                    MOVE 'TINVOIC'     TO DP013-DB2-TABLE-NAME(1) 19600199
196002                    SET DP013-DB2-ABEND                           19600299
196003                        DP013-XCTL-DISPLAY-RESTART TO TRUE        19600399
196004                    PERFORM DP013-0000-PROCESS-ABEND              19600499
196005                 END-EVALUATE                                     19600599
196006           END-IF                                                 19600699
196007        END-IF.                                                   19600799
196008                                                                  19600899
196009*----------------------------------------------------------------*19600999
196010*    ABEND PROCESSOR MODULE                                      *19601099
196020*----------------------------------------------------------------*19602099
196030     COPY DPPD013.                                                19603099
196040                                                                  19604099
