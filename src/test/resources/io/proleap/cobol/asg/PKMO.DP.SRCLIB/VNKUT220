000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.     VNKUT220.                                        00020030
000300 AUTHOR.         ANANDKUMAR S D.                                  00030030
000400 DATE-WRITTEN.   01/08/2015.                                      00040030
000500 DATE-COMPILED.                                                   00050002
000600***************************************************************** 00060002
000700*  COBOL WITH SQL                                               * 00070002
000800*                                                               * 00080002
000900*  ACTIVE VENDORS LIST.                                         * 00090046
001000*                                                               * 00100002
001100*  CREATE FILE OF ALL ACTIVE VENDORS FROM PREV MONTH.           * 00110030
001200*                                                               * 00120002
001300***************************************************************** 00130002
001400*---------------------------------------------------------------* 00140002
001500* CHANGE LOG:                                                   * 00150002
001600*                                                               * 00160002
001700*                                                               * 00170025
001800*---------------------------------------------------------------* 00180002
001900                                                                  00190002
002000 ENVIRONMENT DIVISION.                                            00200002
002100 CONFIGURATION SECTION.                                           00210002
002200 SOURCE-COMPUTER.    IBM-3090.                                    00220002
002300 OBJECT-COMPUTER.    IBM-3090.                                    00230002
002400                                                                  00240002
002500 INPUT-OUTPUT SECTION.                                            00250002
002600 FILE-CONTROL.                                                    00260002
002700     SELECT ACTIVE-VEND-FILE     ASSIGN TO OUT01.                 00270033
002800                                                                  00280002
002900 DATA DIVISION.                                                   00290002
003000 FILE SECTION.                                                    00300002
003100                                                                  00310043
003200 FD  ACTIVE-VEND-FILE                                             00320030
003300     RECORDING MODE IS F                                          00330002
003400     LABEL RECORDS ARE STANDARD                                   00340002
003500     BLOCK CONTAINS 0 RECORDS.                                    00350002
003600                                                                  00360043
003700 01  ACTIVE-VEND-REC             PIC X(80).                       00370045
003800                                                                  00380043
003900 WORKING-STORAGE SECTION.                                         00390002
004000                                                                  00400002
004100 01  ACTIVE-DETAIL-VEND-REC.                                      00410043
004200     05  AC-DTL-VEND             PIC X(30).                       00420043
004300     05  AC-DTL-DELIMIT-01       PIC X(01) VALUE ",".             00430044
004400     05  AC-DTL-DUNNBR           PIC X(09).                       00440043
004500     05  AC-DTL-DELIMIT-02       PIC X(01) VALUE ",".             00450044
004600     05  AC-DTL-DATE             PIC X(10).                       00460043
004700     05  AC-DTL-DELIMIT-03       PIC X(01) VALUE ",".             00470044
004800     05  AC-DTL-STATUS           PIC X(01).                       00480043
004900     05  FILLER                  PIC X(27) VALUE SPACES.          00490085
005000                                                                  00500043
005100 01  PV-PROGRAM-VARIABLES.                                        00510002
005200     05  FILLER                  PIC  X(31)  VALUE                00520033
005300         '** BEGINNING OF VNKUT220 W/S **'.                       00530030
005400     05  PV-PROGRAM-NAME         PIC  X(08)  VALUE 'VNKUT220'.    00540033
005500     05  PV-DATE-ADDED           PIC  X(10)  VALUE SPACES.        00550033
005600     05  PV-ENT-NAME             PIC  X(30)  VALUE SPACES.        00560033
005700     05  PV-DUN-NBR              PIC  X(09)  VALUE SPACES.        00570033
005800     05  PV-CRE-DATE             PIC  X(10)  VALUE SPACES.        00580033
005900     05  PV-STATUS               PIC  X(01)  VALUE SPACES.        00590033
006000     05  CR-PREV-DATE1           PIC  X(10)  VALUE SPACES.        00600085
006100     05  CR-PREV-DATE2           PIC  X(10)  VALUE SPACES.        00610085
006200     05  PV-RETURN-CODE          PIC  X(04)  VALUE SPACES.        00620092
006300 01  PC-COUNTERS.                                                 00630033
006400     05  PC-COUNT-ACTIVE-VEND-READ PIC  9(07)  VALUE ZEROS.       00640033
006500     05  PC-COUNT-VEND-WRITTEN     PIC  9(07)  VALUE ZEROS.       00650033
006600                                                                  00660022
006700 01  PS-PROGRAM-SWITCHES.                                         00670022
006800     05  PS-END-OF-ACTIVE-SW     PIC X(01)        VALUE 'N'.      00680026
006900         88  MORE-ACTIVE-CSR                      VALUE 'N'.      00690026
007000         88  END-OF-ACTIVE-CSR                    VALUE 'Y'.      00700026
007200*----------------------------------------------------------------*00720022
007300*  COMMUNICATIONS AREA2 FOR DB2                                  *00730022
007400*----------------------------------------------------------------*00740022
007500     COPY SQLCA2.                                                 00750022
007600                                                                  00760022
007700     EXEC SQL                                                     00770022
007800          INCLUDE SQLCA                                           00780022
007900     END-EXEC.                                                    00790022
008000                                                                  00800022
008100*----------------------------------------------------------------*00810022
008200*  ENTITY NAME TABLE                                             *00820022
008300*----------------------------------------------------------------*00830022
008400     EXEC SQL                                                     00840022
008500          INCLUDE TENTNME                                         00850022
008600     END-EXEC.                                                    00860022
008700                                                                  00870022
008800*----------------------------------------------------------------*00880022
008900*  ENTITY TABLE                                                  *00890030
009000*----------------------------------------------------------------*00900022
009100     EXEC SQL                                                     00910022
009200          INCLUDE TEXTENT                                         00920030
009300     END-EXEC.                                                    00930022
009400                                                                  00940030
009500*----------------------------------------------------------------*00950022
009600*   VENDOR_CSR                                                   *00960030
009700*----------------------------------------------------------------*00970022
009800     EXEC SQL                                                     00980042
009900       DECLARE VENDOR_CSR CURSOR FOR                              00990042
010000         SELECT SUBSTR(ENT_NAME_DESC,1,30)                        01000042
010100               ,DUN_NBR                                           01010042
010200               ,DATE(CRE_TMST)                                    01020042
010300               ,STATUS_CDE                                        01030042
010400           FROM TEXTENT A                                         01040042
010500               ,TENTNME B                                         01050042
010600          WHERE PRIM_TYP_CDE = 'M'                                01060042
010700            AND (DATE(CRE_TMST) BETWEEN :CR-PREV-DATE1            01070042
010800                                   AND :CR-PREV-DATE2)            01080085
010900            AND TYPE_CDE = '01'                                   01090085
011000            AND A.ENT_ID = B.ENT_ID                               01100085
011100            AND A.STATUS_CDE = 'A'                                01110096
011200     END-EXEC.                                                    01120042
011300                                                                  01130042
011400*----------------------------------------------------------------*01140022
011500*  ABEND DATA AREAS                                              *01150022
011600*----------------------------------------------------------------*01160022
011700 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01170022
011800                                             COMP SYNC.           01180022
011900     88  AC-BAD-DATA                         VALUE +4003.         01190022
012000     88  AC-DB2-ERROR                        VALUE +4013.         01200022
012100                                                                  01210022
012200 01  ABEND-AREAS.                                                 01220022
012300     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01230022
012400             '*****       ABEND'.                                 01240022
012500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01250022
012600             '*****   PROGRAM: VNKUT220'.                         01260031
012700     05  AA-PARAGRAPH-LIT.                                        01270022
012800         10  FILLER              PIC  X(17)  VALUE                01280022
012900             '***** PARAGRAPH: '.                                 01290022
013000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01300022
013100     05  AA-MESSAGE-LINE.                                         01310022
013200         10  FILLER              PIC  X(06)  VALUE '*****'.       01320022
013300         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01330022
013400     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01340022
013500             '*****    DB2 ERROR'.                                01350022
013600     05  AA-DB2-OPERATION-LIT.                                    01360022
013700         10  FILLER              PIC  X(17)  VALUE                01370022
013800             '***** OPERATION: '.                                 01380022
013900         10  AA-DB2-OPERATION.                                    01390022
014000             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01400022
014100             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01410022
014200     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01420022
014300     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01430022
014400     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        01440022
014500     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        01450032
014600                                                                  01460022
014700     COPY DPWS004.                                                01470022
014800 01  FILLER                      PIC  X(25)  VALUE                01480022
014900     '** END OF VNKUT220 W/S **'.                                 01490031
015000                                                                  01500022
015100 PROCEDURE DIVISION.                                              01510022
015200                                                                  01520042
015300 A100-MAIN.                                                       01530022
015600     PERFORM B100-INITIALIZATION.                                 01560022
015700                                                                  01570022
015800     PERFORM B200-PROCESS-ACTIVE-VEND                             01580031
015900       UNTIL END-OF-ACTIVE-CSR.                                   01590026
016000                                                                  01600022
016100     PERFORM B300-END-PROGRAM.                                    01610022
016200                                                                  01620022
016300     GOBACK.                                                      01630022
016400                                                                  01640022
016500 B100-INITIALIZATION.                                             01650022
016600*----------------------------------------------------------------*01660022
016700*    OPEN OUTPUT FILE AND PERFORM INITIALIZATION.                *01670022
016800*----------------------------------------------------------------*01680022
016900     OPEN OUTPUT ACTIVE-VEND-FILE.                                01690031
017000                                                                  01700022
017100     INITIALIZE DCLTENTNME                                        01710031
017200                DCLTEXTENT                                        01720031
017300                ACTIVE-VEND-REC                                   01730092
017400                PV-RETURN-CODE.                                   01740092
017500** THIS INITIAL WRITE PUTS A RECORD OF HEADINGS AS THE FIRST      01750043
017600** RECORD ON THE FILE.                                            01760043
017700                                                                  01770043
017710     PERFORM S200-SET-CURRENT-DATE.                               01771097
017720                                                                  01772097
017800     PERFORM Y100-OPEN-ACTIVE-CSR.                                01780026
017900                                                                  01790022
018000     PERFORM S100-FETCH-ACTIVE-VEND.                              01800097
018100     IF END-OF-ACTIVE-CSR                                         01810026
018200         DISPLAY '***  VNKUT220  ***'                             01820031
018300         DISPLAY 'FIRST FETCH OF ACTIVE VEND CURSOR '             01830026
018400         DISPLAY 'NO VENDORS FOUND                  '             01840033
018500         MOVE  4095 TO PV-RETURN-CODE                             01850092
018600     END-IF.                                                      01860022
018700                                                                  01870022
018800 B200-PROCESS-ACTIVE-VEND.                                        01880031
018900*----------------------------------------------------------------*01890022
019000*    CREATING OUTPUT FILE BY MOVING FIELDS FETCHED INTO THEIR    *01900022
019100*    CORRESPONDING VARIABLE FIELDS.                              *01910022
019200*----------------------------------------------------------------*01920022
019300     INITIALIZE ACTIVE-VEND-REC.                                  01930045
019400                                                                  01940022
019500     MOVE PV-ENT-NAME              TO AC-DTL-VEND.                01950043
019600     MOVE ','                      TO AC-DTL-DELIMIT-01.          01960044
019700     MOVE PV-DUN-NBR               TO AC-DTL-DUNNBR.              01970043
019800     MOVE ','                      TO AC-DTL-DELIMIT-02.          01980044
019900     MOVE PV-CRE-DATE              TO AC-DTL-DATE.                01990043
020000     MOVE ','                      TO AC-DTL-DELIMIT-03.          02000044
020100     MOVE PV-STATUS                TO AC-DTL-STATUS.              02010043
020200     MOVE ACTIVE-DETAIL-VEND-REC   TO ACTIVE-VEND-REC.            02020043
020300                                                                  02030022
020400     PERFORM W100-WRITE-ACTIVE-VEND-REC.                          02040031
020500                                                                  02050022
020600     PERFORM S100-FETCH-ACTIVE-VEND.                              02060097
020700                                                                  02070022
020800 B300-END-PROGRAM.                                                02080022
020900*----------------------------------------------------------------*02090022
021000*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *02100022
021100*----------------------------------------------------------------*02110022
021200     CLOSE ACTIVE-VEND-FILE.                                      02120031
021300                                                                  02130022
021400     DISPLAY '       '                                            02140022
021500     DISPLAY '**********************************'                 02150022
021600     DISPLAY '******** VNKUT220 SUMMARY ********'.                02160031
021700     DISPLAY 'TOTAL RECORDS FETCHED = '                           02170031
021800                                       PC-COUNT-ACTIVE-VEND-READ. 02180031
021900     DISPLAY 'TOTAL RECORDS WRITTEN  = '                          02190026
022000                                       PC-COUNT-VEND-WRITTEN.     02200031
022100     DISPLAY '**********************************'                 02210026
022300                                                                  02230092
022400     PERFORM Y200-CLOSE-ACTIVE-CSR                                02240092
022500     MOVE PV-RETURN-CODE TO RETURN-CODE.                          02250092
022510                                                                  02251092
022600 S100-FETCH-ACTIVE-VEND.                                          02260097
022700*----------------------------------------------------------------*02270026
022800*  RETRIEVES THE VENDOR_CSR DATA                                 *02280026
022900*----------------------------------------------------------------*02290026
023000     EXEC SQL                                                     02300042
023100         FETCH   VENDOR_CSR                                       02310042
023200          INTO  :PV-ENT-NAME                                      02320042
023300               ,:PV-DUN-NBR                                       02330042
023400               ,:PV-CRE-DATE                                      02340042
023500               ,:PV-STATUS                                        02350042
023600     END-EXEC.                                                    02360042
023700                                                                  02370041
023800     EVALUATE TRUE                                                02380026
023900         WHEN SQLCODE = ZERO                                      02390026
024000             ADD 1 TO PC-COUNT-ACTIVE-VEND-READ                   02400032
024100         WHEN SQLCODE = +100                                      02410026
024200             SET END-OF-ACTIVE-CSR TO TRUE                        02420026
024300                                                                  02430026
024400         WHEN SQLWARN0 NOT = SPACES                               02440026
024500         WHEN SQLCODE  NOT = ZERO                                 02450026
024600             MOVE 'S100-FETCH-ACTIVE-VEND'                        02460097
024700                                        TO AA-PARAGRAPH-NAME      02470026
024800             MOVE 'UNSUCCESSFUL FETCH WITH VENDOR_CSR'            02480026
024900                                        TO AA-DB2-OPERATION       02490026
025000             MOVE 'TENTNME'             TO AA-DB2-TABLE-1         02500032
025100             MOVE 'TEXTENT'             TO AA-DB2-TABLE-2         02510032
025200             PERFORM Z998-DB2-ABEND                               02520026
025300     END-EVALUATE.                                                02530026
025400                                                                  02540026
025500*---------------------------------------------------------------  02550085
025600*    GETS THE CURRENT DATE FROM DB2.                              02560085
025700*---------------------------------------------------------------  02570085
025800 S200-SET-CURRENT-DATE.                                           02580097
025900                                                                  02590085
026000     EXEC SQL                                                     02600085
026100        SET :CR-PREV-DATE1 = CURRENT DATE - 1 MONTH               02610085
026200          , :CR-PREV-DATE2 = CURRENT DATE - 1 DAY                 02620085
026300     END-EXEC.                                                    02630085
026400                                                                  02640085
026500     EVALUATE TRUE                                                02650085
026600        WHEN SQLCODE = ZERO                                       02660085
026700           DISPLAY 'MONTH BEGIN DATE: ' CR-PREV-DATE1             02670085
026800           DISPLAY 'MONTH END DATE: ' CR-PREV-DATE2               02680085
026900                                                                  02690085
027000        WHEN SQLCODE  NOT = ZERO                                  02700085
027100           MOVE 'S200-SET-CURRENT-DATE'                           02710097
027200                                  TO AA-PARAGRAPH-NAME            02720085
027300           MOVE 'UNSUCCESSFUL SET DATE'                           02730085
027400                                  TO AA-DB2-OPERATION             02740085
027500           MOVE SPACES            TO AA-DB2-TABLE-1               02750085
027600                                     AA-DB2-TABLE-2               02760085
027700                                     AA-DB2-TABLE-3               02770085
027800           PERFORM Z998-DB2-ABEND                                 02780085
027900     END-EVALUATE.                                                02790085
028000                                                                  02800085
028100 W100-WRITE-ACTIVE-VEND-REC.                                      02810032
028200*----------------------------------------------------------------*02820026
028300*    WRITE THE RECEIPT RECORDS TO THE FILE                       *02830032
028400*----------------------------------------------------------------*02840026
028500                                                                  02850026
028600**   WRITE ACTIVE-VEND-REC FROM ACTIVE-RECEIPT-RECORD.            02860043
028700     WRITE ACTIVE-VEND-REC.                                       02870045
028800                                                                  02880026
028900     ADD 1 TO PC-COUNT-VEND-WRITTEN.                              02890032
029000                                                                  02900026
029100**   INITIALIZE ACTIVE-VEND-REC.                                  02910045
029200                                                                  02920026
029300 Y100-OPEN-ACTIVE-CSR.                                            02930026
029400*---------------------------------------------------------------- 02940026
029500*    OPEN VENDOR_CSR CURSOR.                                      02950033
029600*---------------------------------------------------------------- 02960026
029700                                                                  02970026
029800     EXEC SQL                                                     02980026
029900         OPEN VENDOR_CSR                                          02990026
030000     END-EXEC.                                                    03000026
030100                                                                  03010026
030200     EVALUATE TRUE                                                03020026
030300         WHEN SQLCODE = ZERO                                      03030026
030400             CONTINUE                                             03040026
030500         WHEN SQLWARN0 NOT = SPACES                               03050026
030600         WHEN SQLCODE  NOT = ZERO                                 03060026
030700             MOVE 'Y100-OPEN-ACTIVE-CSR'                          03070026
030800                                 TO AA-PARAGRAPH-NAME             03080026
030900             MOVE 'UNSUCCESSFUL OPEN ON VENDOR_CSR'               03090026
031000                                 TO AA-DB2-OPERATION              03100026
031100             MOVE 'TENTNME'      TO AA-DB2-TABLE-1                03110032
031200             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                03120097
031300             MOVE SPACES         TO AA-MESSAGE                    03130026
031400             PERFORM Z998-DB2-ABEND                               03140026
031500     END-EVALUATE.                                                03150026
031600                                                                  03160026
031700 Y200-CLOSE-ACTIVE-CSR.                                           03170026
031800*---------------------------------------------------------------- 03180026
031900*    CLOSE THE VENDOR_CSR CURSOR.                               * 03190026
032000*---------------------------------------------------------------- 03200026
032100                                                                  03210026
032200     EXEC SQL                                                     03220026
032300         CLOSE VENDOR_CSR                                         03230026
032400     END-EXEC.                                                    03240026
032500                                                                  03250026
032600     EVALUATE TRUE                                                03260026
032700         WHEN SQLCODE = ZERO                                      03270026
032800              CONTINUE                                            03280026
032900                                                                  03290026
033000         WHEN SQLWARN0 NOT = SPACES                               03300026
033100         WHEN SQLCODE  NOT = ZERO                                 03310026
033200             MOVE 'Y200-CLOSE-ACTIVE-CSR'                         03320026
033300                                 TO AA-PARAGRAPH-NAME             03330026
033400             MOVE 'UNSUCCESSFUL CLOSE ON VENDOR_CSR'              03340026
033500                                 TO AA-DB2-OPERATION              03350026
033600             MOVE 'TENTNME'      TO AA-DB2-TABLE-1                03360032
033700             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                03370097
033800             MOVE SPACES         TO AA-MESSAGE                    03380026
033900             PERFORM Z998-DB2-ABEND                               03390026
034000     END-EVALUATE.                                                03400026
034100                                                                  03410026
034200 Z998-DB2-ABEND.                                                  03420026
034300*----------------------------------------------------------------*03430026
034400*    ABEND ROUTINE FOR DB2 ERRORS                                *03440026
034500*----------------------------------------------------------------*03450026
034600     CLOSE ACTIVE-VEND-FILE.                                      03460032
034700                                                                  03470026
034800     DISPLAY AA-ABEND-LIT.                                        03480026
034900     DISPLAY AA-DB2-ERROR-LIT.                                    03490026
035000     DISPLAY AA-PROGRAM-LIT.                                      03500026
035100     DISPLAY AA-PARAGRAPH-LIT.                                    03510026
035200     DISPLAY AA-DB2-OPERATION-LIT.                                03520026
035300     DISPLAY AA-DB2-TABLE-1.                                      03530026
035400     DISPLAY AA-DB2-TABLE-2.                                      03540026
035500     SET AC-DB2-ERROR TO TRUE.                                    03550026
035600                                                                  03560026
035700     COPY DPPD004.                                                03570026
035800                                                                  03580026
035900     CALL 'ILBOABN0' USING ABEND-CODE.                            03590026
036000                                                                  03600026
