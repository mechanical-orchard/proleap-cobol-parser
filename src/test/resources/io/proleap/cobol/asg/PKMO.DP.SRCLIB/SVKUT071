000100 IDENTIFICATION DIVISION.                                         00010005
000200 PROGRAM-ID.         SVKUT071.                                    00020006
000300 AUTHOR.             MADHURA PETHE.                               00030027
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040006
000500 DATE-WRITTEN.       JULY 2012.                                   00050027
000600 DATE-COMPILED.                                                   00060006
000700                                                                  00070006
000800******************************************************************00080006
000900* THIS PROGRAM EXTRACTS THE DAILY STORED VALUE INCOMM TRANSACTION*00090027
001000* ACTIVITY FROM TABLE SVT_KOHLS_CRD_TXN, SVT_3RD_PTY_TRN AND     *00100027
001100* SVT_CRD_STK_DNMNTN TABLES.                                     *00110027
001110*                                                                *00111028
001200* OUTPUT FILES:  KMC-DAILY-ACTIVITY        DDNAME = OUT01        *00120006
001300*                                                                *00130006
001400******************************************************************00140006
001500                                                                  00150006
001600******************************************************************00160006
001700 ENVIRONMENT DIVISION.                                            00170006
001800******************************************************************00180006
001900                                                                  00190006
002000 CONFIGURATION SECTION.                                           00200006
002100                                                                  00210006
002200 SOURCE-COMPUTER.    IBM-3090.                                    00220006
002300 OBJECT-COMPUTER.    IBM-3090.                                    00230006
002400                                                                  00240006
002500 INPUT-OUTPUT SECTION.                                            00250006
002600                                                                  00260006
002700 FILE-CONTROL.                                                    00270006
002800                                                                  00280006
002900     SELECT KMC-DAILY-ACTIVITY   ASSIGN TO OUT01.                 00290006
003000                                                                  00300006
003100******************************************************************00310006
003200 DATA DIVISION.                                                   00320006
003300******************************************************************00330006
003400                                                                  00340006
003500 FILE SECTION.                                                    00350006
003600                                                                  00360006
003700 FD  KMC-DAILY-ACTIVITY                                           00370006
003800     RECORDING MODE IS F                                          00380006
003900     BLOCK CONTAINS 0 RECORDS                                     00390006
004000     LABEL RECORDS ARE OMITTED.                                   00400006
004100                                                                  00410006
004200 01  KMC-DAILY-RECORD            PIC  X(110).                     00420016
004300                                                                  00430006
004400 WORKING-STORAGE SECTION.                                         00440006
004500                                                                  00450006
004600 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00460006
004700                                                                  00470006
004800******************************************************************00480006
004900*    PC-PROGRAM CONSTANTS                                        *00490006
005000******************************************************************00500006
005100 01  PC-PROGRAM-CONSTANTS.                                        00510006
005200     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'SVKUT071'. 00520006
005300                                                                  00530006
005400******************************************************************00540006
005500*    PV-PROGRAM VARIABLES                                        *00550006
005600******************************************************************00560006
005700 01  PV-PROGRAM-VARIABLES.                                        00570006
005800     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.00580006
005900     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.00590006
006000     05  PV-CARD-BALANCE              PIC S9(07)V9(02)            00600006
006100                                                     VALUE ZEROES 00610006
006200                                                     COMP-3.      00620006
006210     05  PV-TODAY-MINUS-90-DAYS       PIC  X(10)     VALUE SPACES.00621030
006220     05  PV-POS-DATE.                                             00622029
006221         10 PV-POS-YYYY             PIC 9(04) VALUE ZEROES.       00622129
006222         10 FILLER                  PIC X(01) VALUE SPACES.       00622229
006223         10 PV-POS-MM               PIC 9(02) VALUE ZEROES.       00622329
006224         10 FILLER                  PIC X(01) VALUE SPACES.       00622429
006225         10 PV-POS-DD               PIC 9(02) VALUE ZEROES.       00622529
006226     05  PV-REFORMAT-DATE.                                        00622629
006227         10 PV-REFORMAT-YYYY        PIC 9(04) VALUE ZEROES.       00622729
006228         10 FILLER                  PIC X(01) VALUE '/'.          00622829
006229         10 PV-REFORMAT-MM          PIC 9(02) VALUE ZEROES.       00622929
006230         10 FILLER                  PIC X(01) VALUE '/'.          00623029
006240         10 PV-REFORMAT-DD          PIC 9(02) VALUE ZEROES.       00624029
006250                                                                  00625029
006300                                                                  00630006
006400******************************************************************00640006
006500*    PS-PROGRAM SWITCHES                                         *00650006
006600******************************************************************00660006
006700 01  PS-PROGRAM-SWITCHES.                                         00670006
006800     05  PS-END-OF-ACTIVITY-CSR-SW    PIC  X(01)     VALUE 'N'.   00680014
006900         88  PS-END-OF-ACTIVITY-CURSOR               VALUE 'Y'.   00690014
007000                                                                  00700006
007100******************************************************************00710006
007200*    PA-PROGRAM ACCUMULATORS                                     *00720006
007300******************************************************************00730006
007400 01  PA-PROGRAM-ACCUMULATORS.                                     00740006
007500     05  PA-ACTIVITY-ROWS-FETCHED     PIC S9(11)     COMP-3       00750006
007600                                                     VALUE ZEROES.00760006
007700     05  PA-ACTIVITY-ROWS-WRITTEN     PIC S9(11)     COMP-3       00770006
007800                                                     VALUE ZEROES.00780006
007900                                                                  00790006
008000******************************************************************00800006
008100*    KMC DAILY EXTRACT RECORD LAYOUT                             *00810006
008200******************************************************************00820006
008300     COPY SVRD071.                                                00830006
008400                                                                  00840006
008500******************************************************************00850006
008600*    REFUND AUTHORIZATION CONSTANTS                              *00860006
008700******************************************************************00870006
008800     COPY SVWS004.                                                00880006
008900                                                                  00890006
009000******************************************************************00900006
009100*    DATE ROUTINE COPY MEMBERS                                   *00910006
009200******************************************************************00920006
009300     COPY DPWS500.                                                00930006
009400                                                                  00940006
009500******************************************************************00950006
009600*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *00960006
009700******************************************************************00970006
009800     COPY DPWS004.                                                00980006
009900                                                                  00990006
009910******************************************************************00991029
009920*    SV-KOHL'S STORED VALUE 3RD PARTY TRAN TABLE                 *00992029
009930******************************************************************00993029
009940     EXEC SQL                                                     00994029
009950         INCLUDE SVT00015                                         00995029
009960     END-EXEC.                                                    00996029
009970                                                                  00997029
009980******************************************************************00998029
009990*    SV-KOHL'S STORED VALUE CARD STK DENOMINATION TABLE          *00999029
009991******************************************************************00999129
009992     EXEC SQL                                                     00999229
009993         INCLUDE SVT00008                                         00999329
009994     END-EXEC.                                                    00999429
009995                                                                  00999529
010000******************************************************************01000006
010100*    SV-KOHL'S STORED VALUE CARD ACTIVITY TABLE                  *01010006
010200******************************************************************01020006
010300     EXEC SQL                                                     01030006
010400         INCLUDE SVT00002                                         01040006
010500     END-EXEC.                                                    01050006
010600                                                                  01060006
010700******************************************************************01070006
010800*    SV-KOHL'S STORED VALUE CARD TABLE                           *01080006
010900******************************************************************01090006
011000     EXEC SQL                                                     01100006
011100         INCLUDE SVT00001                                         01110006
011200     END-EXEC.                                                    01120006
011300                                                                  01130006
011400                                                                  01140006
011500******************************************************************01150006
011600*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *01160006
011700******************************************************************01170006
011800     EXEC SQL                                                     01180006
011900         INCLUDE SQLCA                                            01190006
012000     END-EXEC.                                                    01200006
012100                                                                  01210006
012200     COPY SQLCA2.                                                 01220006
012300                                                                  01230006
012400******************************************************************01240006
012500*    CURSOR DECLARATION FOR KMC ACTIVITY CURSOR                  *01250006
      * ACTVY-STAT-CDE 1 INDICATES THE TRANSACTION IS NOT YET VERIFIED.*01251032
      * SVKUP085 UPDATES STAT-CDE TO 3 FOR ALL VERIFIED RECORDS SO THE *01252032
      * TRANACTION DOES NOT GET PULLED IN NEXT DAYS EXTRACT FILE       *01253032
012600******************************************************************01260006
012700     EXEC SQL                                                     01270006
012800         DECLARE  KMC_ACTVY_CURSOR CURSOR FOR                     01280006
012900          SELECT  D.CRD_NBR                                       01290013
013000                 ,D.TRN_AUTH_TMST                                 01300029
013100                 ,D.TRN_RVRSL_CDE                                 01310013
013400                 ,D.POS_DTE                                       01340013
013800                 ,D.APP_AUTH_AMT                                  01380013
014100                 ,D.ACTVY_STAT_CDE                                01410013
014200                 ,E.SELR_NM                                       01420029
014300                 ,C.UPC_NBR                                       01430029
014400                 ,E.POS_REF_NBR                                   01440029
014410            FROM  SVT_CRD_PROD A                                  01441029
014420                 ,SVT_KOHLS_CRD_ACCT B                            01442029
014430                 ,SVT_CRD_STK_DNMNTN C                            01443029
014500                 ,SVT_KOHLS_CRD_TXN D                             01450013
014600                 ,SVT_3RD_PTY_TRN E                               01460029
014610           WHERE A.CRD_PROD_YR   = B.CRD_PROD_YR                  01461029
014620             AND A.SHIPT_REQ_NBR = B.SHIPT_REQ_NBR                01462029
014630             AND B.CRD_TYP_CDE   = C.CRD_TYP_CDE                  01463029
014640             AND A.CRD_STK_TYP_ID = C.CRD_STK_TYP_ID              01464029
014650             AND A.PRE_DNNTD_CRD_AMT = C.PRE_DNNTD_CRD_AMT        01465029
014700             AND D.CRD_NBR = B.CRD_NBR                            01470013
014710             AND D.CRD_NBR = E.CRD_NBR                            01471029
014720             AND D.TRN_AUTH_TMST = E.TRN_AUTH_TMST                01472014
014800             AND D.STR_NBR = 676                                  01480013
014900             AND D.APVL_USR_ID = 'INCOMM'                         01490013
015000             AND D.ACTVY_TYP_CDE = 2                              01500013
015100             AND D.ACTVY_STAT_CDE = 1                             01510013
015110             AND D.POS_DTE >= :PV-TODAY-MINUS-90-DAYS             01511030
015122           WITH UR                                                01512213
015130     END-EXEC.                                                    01513006
015140                                                                  01514006
015150 PROCEDURE DIVISION.                                              01515006
015160                                                                  01516006
015170******************************************************************01517006
015180 A100-MAINLINE.                                                   01518006
015190******************************************************************01519006
015200                                                                  01520006
015300     PERFORM B100-INITIALIZE.                                     01530006
015400                                                                  01540006
015500     PERFORM B200-PROCESS-CARD-ACTIVITY                           01550006
015600         UNTIL PS-END-OF-ACTIVITY-CURSOR.                         01560014
015700                                                                  01570006
015800     PERFORM B300-EOJ-ROUTINE.                                    01580006
015900                                                                  01590006
016000     GOBACK.                                                      01600006
016100******************************************************************01610006
016200*     B100-INITIALIZE                                            *01620006
016300* ==> PROCESSES:                                                 *01630006
016400*     -ACCEPTS TODAYS DATE AND SUBTRACT 7 DAYS FROM IT           *01640007
016410*     -OPENS ACTIVITY CURSOR AND FETCHES THE FIRST ROW           *01641028
016900* ==> PERFORMED FROM: A100-MAINLINE                              *01690006
017000******************************************************************01700006
017100 B100-INITIALIZE.                                                 01710006
017200                                                                  01720006
017230**   ACCEPT TODAYS DATE AND SUBTRACT 7 DAYS FROM IT.            **01723014
017261     PERFORM S100-GET-COMPARE-DATE.                               01726111
017262**                                                              **01726214
017300     OPEN OUTPUT KMC-DAILY-ACTIVITY.                              01730006
017400     PERFORM C200-OPEN-ACTIVITY-CURSOR.                           01740014
017500     PERFORM D100-FETCH-ACTIVITY-CURSOR.                          01750014
017600                                                                  01760006
017700******************************************************************01770006
017800*     B200-PROCESS-CARD-ACTIVITY                                 *01780006
017900* ==> PROCESSES:                                                 *01790006
018000*     -FETCHES THE NEXT ROW FROM THE CURSOR AND WRITES OUT       *01800028
018100* ==> PERFORMED FROM: A100-MAINLINE                              *01810006
018200******************************************************************01820006
018300 B200-PROCESS-CARD-ACTIVITY.                                      01830006
018400                                                                  01840006
018500     PERFORM E200-WRITE-ACTIVITY-REC.                             01850014
018600     PERFORM D100-FETCH-ACTIVITY-CURSOR.                          01860014
018700                                                                  01870006
018800******************************************************************01880006
018900*     B300-EOJ-ROUTINE                                           *01890006
019000* ==> PROCESSES:                                                 *01900006
019100*     -CLOSES THE ACTIVITY CURSOR                                *01910028
019200* ==> PERFORMED FROM: A100-MAINLINE                              *01920006
019300******************************************************************01930006
019400 B300-EOJ-ROUTINE.                                                01940006
019500                                                                  01950006
019600     PERFORM C300-CLOSE-ACTIVITY-CURSOR                           01960014
019700                                                                  01970006
019800     CLOSE KMC-DAILY-ACTIVITY.                                    01980006
019900                                                                  01990006
020000     DISPLAY ' '.                                                 02000006
020100     DISPLAY PC-PROGRAM-NAME                                      02010006
020200             '  ROWS FETCHED FROM SVT_KOHLS_CRD_TXN: '            02020028
020300                                        PA-ACTIVITY-ROWS-FETCHED. 02030006
020400     DISPLAY PC-PROGRAM-NAME '  ROWS WRITTEN TO OUTPUT FILE:  '   02040006
020500                                        PA-ACTIVITY-ROWS-WRITTEN. 02050006
020600     DISPLAY ' '.                                                 02060006
020700                                                                  02070006
020800******************************************************************02080006
020900*     C200-OPEN-ACTIVITY-CURSOR.                                 *02090014
021000* ==> PROCESSES:                                                 *02100006
021100*     -OPENS THE KMC ACTIVITY CURSOR                             *02110006
021200* ==> PERFORMED FROM: B100-INITIALIZE                            *02120006
021300******************************************************************02130006
021400 C200-OPEN-ACTIVITY-CURSOR.                                       02140014
021500                                                                  02150006
021600     EXEC SQL                                                     02160006
021700         OPEN KMC_ACTVY_CURSOR                                    02170006
021800     END-EXEC.                                                    02180006
021900                                                                  02190006
022000     EVALUATE TRUE                                                02200006
022100         WHEN SQLCODE = +0                                        02210006
022200             CONTINUE                                             02220006
022300         WHEN OTHER                                               02230006
022400             MOVE 'C200-OPEN-ACTIVITY-CURSOR       '              02240014
022500                               TO PV-PARAGRAPH-NAME               02250006
022600             MOVE 'OPEN KMC ACTIVITY CURSOR      '                02260006
022700                               TO PV-DB2-OPERATION-ATTEMPTED      02270006
022800             PERFORM Z900-SQL-ABEND                               02280006
022900     END-EVALUATE.                                                02290006
023000                                                                  02300006
023100******************************************************************02310006
023200*     C300-CLOSE-ACTIVITY-CURSOR.                                *02320014
023300* ==> PROCESSES:                                                 *02330006
023400*     -CLOSES THE KMC ACTIVITY CURSOR                            *02340006
023500* ==> PERFORMED FROM: B300-EOJ-ROUTINE                           *02350006
023600******************************************************************02360006
023700 C300-CLOSE-ACTIVITY-CURSOR.                                      02370014
023800                                                                  02380006
023900     EXEC SQL                                                     02390006
024000         CLOSE KMC_ACTVY_CURSOR                                   02400006
024100     END-EXEC.                                                    02410006
024200                                                                  02420006
024300     EVALUATE TRUE                                                02430006
024400         WHEN SQLCODE = +0                                        02440006
024500             CONTINUE                                             02450006
024600         WHEN OTHER                                               02460006
024700             MOVE 'C300-CLOSE-ACTIVITY-CURSOR      '              02470014
024800                               TO PV-PARAGRAPH-NAME               02480006
024900             MOVE 'CLOSE KMC ACTIVITY CURSOR     '                02490006
025000                               TO PV-DB2-OPERATION-ATTEMPTED      02500006
025100             PERFORM Z900-SQL-ABEND                               02510006
025200     END-EVALUATE.                                                02520006
025300                                                                  02530006
025400******************************************************************02540006
025500*     D100-FETCH-ACTIVITY-CURSOR.                                *02550014
025600* ==> PROCESSES:                                                 *02560006
025700*     -FETCHES A ROW FROM THE KMC ACTIVITY CURSOR                *02570006
025800* ==> PERFORMED FROM: B100-INITIALIZE                            *02580006
025900*                     B200-PROCESS-CARD-ACTIVITY                 *02590006
026000******************************************************************02600006
026100 D100-FETCH-ACTIVITY-CURSOR.                                      02610014
026200                                                                  02620006
026300     EXEC SQL                                                     02630006
026400         FETCH  KMC_ACTVY_CURSOR                                  02640006
026500          INTO  :SVT00002-CRD-NBR                                 02650006
026700               ,:SVT00002-TRN-AUTH-TMST                           02670016
026800               ,:SVT00002-TRN-RVRSL-CDE                           02680016
027000               ,:SVT00002-POS-DTE                                 02700006
027400               ,:SVT00002-APP-AUTH-AMT                            02740006
027700               ,:SVT00002-ACTVY-STAT-CDE                          02770006
027800               ,:SVT00015-SELR-NM                                 02780026
027900               ,:SVT00008-UPC-NBR                                 02790014
028000               ,:SVT00015-POS-REF-NBR                             02800014
028100     END-EXEC.                                                    02810006
028200                                                                  02820006
028300     EVALUATE TRUE                                                02830006
028400         WHEN SQLCODE = +0                                        02840006
028500             ADD +1 TO PA-ACTIVITY-ROWS-FETCHED                   02850006
028600         WHEN SQLCODE = +100                                      02860006
028700             SET PS-END-OF-ACTIVITY-CURSOR                        02870014
028800                               TO TRUE                            02880006
028900         WHEN OTHER                                               02890006
029000             MOVE 'D100-FETCH-ACTIVITY-CURSOR      '              02900014
029100                               TO PV-PARAGRAPH-NAME               02910006
029200             MOVE 'FETCH KMC ACTIVITY CURSOR     '                02920006
029300                               TO PV-DB2-OPERATION-ATTEMPTED      02930006
029400             PERFORM Z900-SQL-ABEND                               02940006
029500     END-EVALUATE.                                                02950006
029600                                                                  02960006
029700******************************************************************02970006
029800*     E200-WRITE-ACTIVITY-REC                                    *02980014
029900* ==> PROCESSES:                                                 *02990006
030000*     -WRITES THE OUTPUT RECORD                                  *03000006
030100*     -DETERMINE THE TYPE OF TRANSACTION BASED ON THE VALUES OF  *03010028
030200*      REVERSAL INDICATOR AND TRANSACTION AMOUNT. THEN POPULATE  *03020028
030300*      TRANS-ORDER TO BE PASSED INTO SVKUT072 WHICH WILL BE USED *03030028
030400*      TO MATCH AND VERIFY KOHLS AND INCOMM RECORDS.             *03040028
030600* ==> PERFORMED FROM:  D100-FETCH-ACTIVITY-CURSOR                *03060014
030700******************************************************************03070006
030800 E200-WRITE-ACTIVITY-REC.                                         03080014
030900                                                                  03090006
031000     INITIALIZE SV071-KMCACT-EXTRACT-RECORD.                      03100006
031100                                                                  03110006
031300     MOVE SVT00002-CRD-NBR        TO SV071-CRD-NBR.               03130014
032100     MOVE SVT00002-TRN-AUTH-TMST  TO SV071-TRN-AUTH-TMST.         03210016
032200     MOVE SVT00002-TRN-RVRSL-CDE  TO SV071-TRN-RVRSL-CDE.         03220016
032400     MOVE SVT00002-POS-DTE        TO PV-POS-DATE.                 03240022
032410     MOVE PV-POS-YYYY             TO PV-REFORMAT-YYYY.            03241022
032420     MOVE PV-POS-MM               TO PV-REFORMAT-MM.              03242022
032430     MOVE PV-POS-DD               TO PV-REFORMAT-DD.              03243022
032440     MOVE PV-REFORMAT-DATE        TO SV071-POS-DTE.               03244022
032800     MOVE SVT00002-APP-AUTH-AMT   TO SV071-APP-AUTH-AMT.          03280006
032900     MOVE SVT00002-ACTVY-STAT-CDE TO SV071-ACTVY-STAT-CDE.        03290006
033300     MOVE SVT00015-POS-REF-NBR    TO SV071-POS-REF-NO.            03330015
033310     MOVE SVT00008-UPC-NBR        TO SV071-UPC-NBR.               03331015
033320     MOVE SVT00015-SELR-NM        TO SV071-SELR-NM.               03332024
033400                                                                  03340006
033401***************************************************************** 03340128
033402*  SET THE TRANS-ORDER HERE TO BE USED IN THE SVKUT072 PROGRAM  * 03340231
033403*  TRANS-ORDER  TYPE OF TRANSACTION                             * 03340328
033404*    0       -  ACTIVATION                                      * 03340428
033405*    1       -  REVERSAL OF ACTIVATION                          * 03340528
033406*    2       -  DEACTIVATION                                    * 03340628
033407*    3       -  REVERSAL OF DEACTIVATION                        * 03340728
033408***************************************************************** 03340828
033410     EVALUATE SV071-TRN-RVRSL-CDE ALSO TRUE                       03341018
033420          WHEN 0  ALSO SV071-APP-AUTH-AMT < 0                     03342018
033430               MOVE 02 TO SV071-TRANS-ORDER                       03343020
033440          WHEN 0  ALSO SV071-APP-AUTH-AMT >= 0                    03344018
033450               MOVE 00 TO SV071-TRANS-ORDER                       03345020
033460          WHEN 1  ALSO SV071-APP-AUTH-AMT < 0                     03346018
033470               MOVE 01 TO SV071-TRANS-ORDER                       03347020
033480          WHEN 1  ALSO SV071-APP-AUTH-AMT >= 0                    03348018
033490               MOVE 03 TO SV071-TRANS-ORDER                       03349020
033493     END-EVALUATE.                                                03349318
033494                                                                  03349418
033500     WRITE KMC-DAILY-RECORD                                       03350006
033600         FROM SV071-KMCACT-EXTRACT-RECORD.                        03360006
033700                                                                  03370006
033800     ADD +1 TO PA-ACTIVITY-ROWS-WRITTEN.                          03380006
033900                                                                  03390006
033933******************************************************************03393311
033934* SELECT TODAYS DATE AND SUBTRACT 90 DAYS. THIS DATE IS USED TO   03393431
033935* EXTRACT ONLY THOSE TRANSACTIONS THAT ARE LESS THAN 91 DAYS OLD  03393531
033936* FROM KOHLS DATABASE TO MATCH AGAINST INCOMM DAILY FILE.         03393631
033937* THE ASSUMPTION HERE IS THAT INCOMM WOULD NOT SEND ANY TRANSACTIO03393731
033938* NS 90 DAYS OLD. IF THEY DO, THE TRANSACTION WOULD END UP IN THE 03393831
033939* AUDIT REPORT AS MISSING KOHLS TRANSACTION.                      03393931
033940******************************************************************03394011
033941 S100-GET-COMPARE-DATE.                                           03394111
033950     MOVE 'S100-GET-COMPARE-DATE'        TO PV-PARAGRAPH-NAME.    03395011
033960                                                                  03396011
033970     EXEC SQL                                                     03397011
033980         SELECT (CURRENT DATE - 90 DAY)                           03398030
033990           INTO :PV-TODAY-MINUS-90-DAYS                           03399030
033991           FROM SYSIBM.SYSDUMMY1                                  03399111
033992           WITH UR                                                03399211
033993     END-EXEC.                                                    03399311
033994                                                                  03399411
033995     EVALUATE SQLCODE                                             03399511
033996         WHEN 0                                                   03399611
033997             DISPLAY '90 DAY BACK DATE: ' PV-TODAY-MINUS-90-DAYS  03399730
033998         WHEN OTHER                                               03399811
033999             MOVE 'S100-GET-COMPARE-DATE'                         03399911
034000                                           TO PV-PARAGRAPH-NAME   03400011
034001             MOVE 'ERROR SELECTING PROCESSING DATE'               03400111
034002                                  TO PV-DB2-OPERATION-ATTEMPTED   03400212
034003             PERFORM Z900-SQL-ABEND                               03400311
034004     END-EVALUATE.                                                03400411
034005                                                                  03400511
034010******************************************************************03401006
034100*     Z900-SQL-ABEND                                             *03410006
034200* ==> PROCESSES:                                                 *03420006
034300*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *03430006
034400* ==> PERFORMED FROM:                                            *03440006
034500******************************************************************03450006
034600 Z900-SQL-ABEND.                                                  03460006
034700                                                                  03470006
034800     DISPLAY 'Z900-SQL-ABEND'.                                    03480006
034900     DISPLAY '**  ABEND     **'.                                  03490006
035000     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               03500006
035100     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             03510006
035200     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    03520006
035300                                                                  03530006
035400******************************************************************03540006
035500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *03550006
035600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *03560006
035700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *03570006
035800* FORMAT.                                                        *03580006
035900******************************************************************03590006
036000     COPY DPPD004.                                                03600006
036100                                                                  03610006
036200     MOVE +4013 TO ABEND-CODE.                                    03620006
036300     CALL 'ILBOABN0' USING ABEND-CODE.                            03630006
