000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKRP235.                                         00020000
000300 AUTHOR.        NANCY EILBES.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   OCTOBER 2004.                                     00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*  BROADCAST AGREEMENTS REPORT PROGRAM.                          *00090000
001000*                                                                *00100000
001100*  PURPOSE:                                                      *00110000
001200*  THIS PROGRAM CREATES A REPORT OF ALL OF THE BROADCAST         *00120000
001300*  AGREEMENTS FROM THE VENDOR AGREEMENT DATABASE.  THE REPORT    *00130000
001310*  IS ORDERED BY LAST UPDATE DATE SO THAT THE MOST RECENT        *00131000
001320*  CHANGES ARE LISTED FIRST.                                     *00132000
001400*----------------------------------------------------------------*00140000
001500* DB2 TABLES:                                                    *00150000
001600*  1. VENDOR AGREEMENT TABLE                  TVNDAGR            *00160000
001700*  2. EXTERNAL ENTITY TABLE                   TEXTENT            *00170000
001800*  3. ENTITY NAME TABLE                       TENTNME            *00180000
002000*  4. MERCHANDISE AREA TABLE                  TMDSEAR            *00200001
002100*                                                                *00210000
002200* OUTPUT:                                                        *00220000
002300*                                                                *00230000
002400*  1. VENDOR AGREEMENTS REPORT                                   *00240000
002500*                                                                *00250000
002600*----------------------------------------------------------------*00260000
002700******************************************************************00270000
002800* CHANGE LOG:                                                    *00280000
002900*   DATE  10/26/2004                                             *00290001
003000*       CHANGE MADE: INITIAL VERSION.                            *00300001
003200*       MADE BY: NANCY EILBES            WR/IR #: WR26677        *00320001
003300*                                                                *00330000
003400******************************************************************00340000
003500 ENVIRONMENT DIVISION.                                            00350000
003600 CONFIGURATION SECTION.                                           00360000
003700 SOURCE-COMPUTER.        IBM-3090.                                00370000
003800 OBJECT-COMPUTER.        IBM-3090.                                00380000
003900                                                                  00390000
004000 INPUT-OUTPUT SECTION.                                            00400000
004100 FILE-CONTROL.                                                    00410000
004200                                                                  00420000
004300     SELECT REPORT-FILE                  ASSIGN TO RPT01.         00430000
004400                                                                  00440000
004500 DATA DIVISION.                                                   00450000
004600 FILE SECTION.                                                    00460000
004700                                                                  00470000
004800 FD  REPORT-FILE                                                  00480000
004900     RECORDING MODE IS F                                          00490000
005000     LABEL RECORDS ARE STANDARD                                   00500000
005100     BLOCK CONTAINS 0 RECORDS                                     00510000
005200     DATA RECORD IS REPORT-REC.                                   00520000
005300 01  REPORT-REC                  PIC  X(132).                     00530000
005400                                                                  00540000
005500 WORKING-STORAGE SECTION.                                         00550000
005600                                                                  00560000
005700 01  PC-PROGRAM-CONSTANTS.                                        00570000
005800     05  PC-PROGRAM-NAME     PIC X(08) VALUE 'APKRP235'.          00580000
008300                                                                  00830000
008400 01  PS-PROGRAM-SWITCHES.                                         00840000
008500     05  PS-END-OF-CSR-SW        PIC  X         VALUE 'N'.        00850000
008600         88  NOT-END-OF-CSR                     VALUE 'N'.        00860000
008700         88  END-OF-CSR                         VALUE 'Y'.        00870000
009100                                                                  00910000
009200 01  PV-REPORT-CONTROLS.                                          00920000
009300     05  PV-LAST-UPD-DATE        PIC X(10)      VALUE SPACES.     00930000
009400     05  PV-LINE-COUNT           PIC S999       VALUE +0.         00940000
009500     05  PC-LINES-PER-PAGE-MAX   PIC S999       VALUE +60.        00950000
009600     05  PV-PAGE-COUNT           PIC S9(05) VALUE +0.             00960000
009700                                                                  00970000
009800 01  PV-PROGRAM-VARIABLES.                                        00980000
010000     05  SAVE-VND-NAME               PIC  X(30) VALUE SPACES.     01000000
010100     05  PV-DISCOUNT-PCT             PIC S99V99 COMP-3.           01010000
010200     05  PV-AGR-CSR-COUNT            PIC  9(08) VALUE ZEROS.      01020000
010500     05  WS-HEADER-DATE              PIC X(10).                   01050000
010600     05  WS-HEADER-DATE-RED REDEFINES WS-HEADER-DATE.             01060000
010700         10  WS-HEADER-MM            PIC 9(2).                    01070000
010800         10  WS-HD-SLASH-1           PIC X(1).                    01080000
010900         10  WS-HEADER-DD            PIC 9(2).                    01090000
011000         10  WS-HD-SLASH-2           PIC X(1).                    01100000
011100         10  WS-HEADER-CCYY          PIC 9(4).                    01110000
011200                                                                  01120000
011300     05  PV-CURRENT-DATE.                                         01130000
011400         10  PV-CURRENT-CCYY.                                     01140000
011500             15  PV-CURRENT-CC     PIC  9(02) VALUE ZEROES.       01150000
011600             15  PV-CURRENT-YEAR   PIC  9(02) VALUE ZEROES.       01160000
011700         10  PV-CURRENT-MONTH      PIC  9(02) VALUE ZEROES.       01170000
011800         10  PV-CURRENT-DAY        PIC  9(02) VALUE ZEROES.       01180000
011900     05  PV-CURRENT-TIME.                                         01190000
012000         10  PV-CURRENT-HOUR       PIC  9(02) VALUE ZEROES.       01200000
012100         10  PV-CURRENT-MINUTE     PIC  9(02) VALUE ZEROES.       01210000
012200         10  FILLER                PIC  9(02) VALUE ZEROES.       01220000
012300                                                                  01230000
012400                                                                  01240000
012500*----------------------------------------------------------------*01250000
012600*    STANDARD HEADER LAYOUT                                       01260000
012700*----------------------------------------------------------------*01270000
012800     COPY DPWS132.                                                01280000
012900                                                                  01290000
013000                                                                  01300000
013100*----------------------------------------------------------------*01310000
013200*    REPORT LAYOUT                                                01320000
013300*----------------------------------------------------------------*01330000
013400                                                                  01340000
013500 01  HEADING-LINE-1.                                              01350000
013600     05  FILLER                  PIC  X(53) VALUE SPACES.         01360000
013700     05  H1-TITLE                PIC  X(27) VALUE                 01370000
013800         'BROADCAST AGREEMENTS REPORT'.                           01380000
013900     05  FILLER                  PIC  X(52) VALUE SPACES.         01390000
014000                                                                  01400000
014100 01  HEADING-LINE-2.                                              01410000
014200     05  FILLER                  PIC  X(58) VALUE SPACES.         01420000
014300     05  FILLER                  PIC  X(06) VALUE                 01430000
014400         'AS OF '.                                                01440000
014500     05  H2-DATE                 PIC  X(10).                      01450000
014600     05  FILLER                  PIC  X(58) VALUE SPACES.         01460000
014700                                                                  01470000
015100                                                                  01510000
015200 01  DETAIL-HEADING-LINE.                                         01520000
015300     05  FILLER                  PIC X(30) VALUE 'VENDOR NAME'.   01530000
015400     05  FILLER                  PIC X(02) VALUE SPACES.          01540000
015500     05  FILLER                  PIC X(09) VALUE 'VENDOR # '.     01550000
015600     05  FILLER                  PIC X(02) VALUE SPACES.          01560000
015700     05  FILLER                  PIC X(04) VALUE 'DEPT'.          01570000
015800     05  FILLER                  PIC X(05) VALUE SPACES.          01580000
015900     05  FILLER                  PIC X(03) VALUE 'DIV'.           01590000
016000     05  FILLER                  PIC X(02) VALUE SPACES.          01600000
016100     05  FILLER                  PIC X(05) VALUE 'PCNT '.         01610000
016200     05  FILLER                  PIC X(01) VALUE SPACES.          01620000
016300     05  FILLER                  PIC X(03) VALUE 'RTV'.           01630000
016400     05  FILLER                  PIC X(01) VALUE SPACES.          01640000
016500     05  FILLER                  PIC X(03) VALUE 'DSC'.           01650000
016600     05  FILLER                  PIC X(01) VALUE SPACES.          01660000
016700     05  FILLER                  PIC X(04) VALUE 'FREQ'.          01670000
016800     05  FILLER                  PIC X(02) VALUE SPACES.          01680000
016900     05  FILLER                  PIC X(10) VALUE 'EFFECTIVE '.    01690000
017000     05  FILLER                  PIC X(02) VALUE SPACES.          01700000
017100     05  FILLER                  PIC X(10) VALUE 'EXPIRES   '.    01710000
017200     05  FILLER                  PIC X(02) VALUE SPACES.          01720000
017210     05  FILLER                  PIC X(12) VALUE 'LAST UPDATED'.  01721000
017220     05  FILLER                  PIC X(02) VALUE SPACES.          01722000
017300                                                                  01730000
017400 01  BLANK-LINE                  PIC X(132) VALUE SPACES.         01740000
017500                                                                  01750000
017600 01  DETAIL-LINE.                                                 01760000
017700     05  DL-VENDOR-NAME          PIC X(30) VALUE SPACES.          01770000
017800     05  FILLER                  PIC X(02) VALUE SPACES.          01780000
017900     05  DL-VENDOR-NBR           PIC X(09) VALUE SPACES.          01790000
018000     05  FILLER                  PIC X(02) VALUE SPACES.          01800000
018100     05  DL-DEPT-NBR             PIC X(03) VALUE SPACES.          01810000
018200     05  FILLER                  PIC X(06) VALUE SPACES.          01820000
018310     05  DL-DMA-NBR              PIC X(02) VALUE SPACES.          01831000
018400     05  FILLER                  PIC X(02) VALUE SPACES.          01840000
018500     05  DL-DISCOUNT-PCT         PIC ZZ.99.                       01850000
018600     05  FILLER                  PIC X(02) VALUE SPACES.          01860000
018700     05  DL-RTV-IND              PIC X(01).                       01870000
018800     05  FILLER                  PIC X(03) VALUE SPACES.          01880000
018900     05  DL-DSC-IND              PIC X(01).                       01890000
019000     05  FILLER                  PIC X(03) VALUE SPACES.          01900000
019100     05  DL-POSTING-FREQUENCY    PIC X(02).                       01910000
019200     05  FILLER                  PIC X(03) VALUE SPACES.          01920000
019300     05  DL-EFFECTIVE-DATE       PIC X(10).                       01930000
019400     05  FILLER                  PIC X(02) VALUE SPACES.          01940000
019500     05  DL-EXPIRATION-DATE      PIC X(10).                       01950000
019600     05  FILLER                  PIC X(04) VALUE SPACES.          01960001
019610     05  DL-LAST-UPDATE          PIC X(10).                       01961000
019620     05  FILLER                  PIC X(02) VALUE SPACES.          01962000
019700                                                                  01970000
021600 01  END-OF-REPORT.                                               02160000
021700     05  FILLER                  PIC  X(49) VALUE SPACES.         02170000
021800     05  FILLER                  PIC  X(33) VALUE                 02180000
021900         '***  E N D  O F  R E P O R T  ***'.                     02190000
022000     05  FILLER                  PIC  X(50) VALUE SPACES.         02200000
022100                                                                  02210000
022200*---------------------------------------------------------------* 02220000
022300*    DB2 AREA FOR TEXTENT                                       * 02230000
022400*---------------------------------------------------------------* 02240000
022500     EXEC SQL                                                     02250000
022600          INCLUDE TEXTENT                                         02260000
022700     END-EXEC.                                                    02270000
022800                                                                  02280000
022900*---------------------------------------------------------------* 02290000
023000*    DB2 AREA FOR TENTNME                                       * 02300000
023100*---------------------------------------------------------------* 02310000
023200     EXEC SQL                                                     02320000
023300          INCLUDE TENTNME                                         02330000
023400     END-EXEC.                                                    02340000
023500                                                                  02350000
024300*---------------------------------------------------------------* 02430000
024400*    DB2 AREA FOR TVNDAGR                                       * 02440000
024500*---------------------------------------------------------------* 02450000
024600     EXEC SQL                                                     02460000
024700          INCLUDE TVNDAGR                                         02470000
024800     END-EXEC.                                                    02480000
024900                                                                  02490000
025000*---------------------------------------------------------------* 02500000
025100*    DB2 AREA FOR TMDSEAR                                       * 02510000
025200*---------------------------------------------------------------* 02520000
025300     EXEC SQL                                                     02530000
025400          INCLUDE TMDSEAR                                         02540000
025500     END-EXEC.                                                    02550000
025600                                                                  02560000
025700*---------------------------------------------------------------* 02570000
025800*    DB2 AREA FOR COMMUNICATIONS                                * 02580000
025900*---------------------------------------------------------------* 02590000
026000     EXEC SQL                                                     02600000
026100          INCLUDE SQLCA                                           02610000
026200     END-EXEC.                                                    02620000
026300                                                                  02630000
026400*----------------------------------------------------------------*02640000
026500*                                                                 02650000
026600*----------------------------------------------------------------*02660000
026700     EXEC SQL                                                     02670000
026800        DECLARE AGREEMENT_CSR CURSOR FOR                          02680000
026900        SELECT A.AP_TRN_CDE                                       02690000
027000             , A.DISCOUNT_PCT                                     02700000
027100             , CHAR(A.EFFECTIVE_DATE,USA)                         02710000
027200             , CHAR(A.EXPIRATION_DATE,USA)                        02720000
027210             , CHAR(DATE(A.LAST_UPD_TMST),USA)                    02721000
027300             , A.PSTG_FRQ_CDE                                     02730000
027400             , A.DED_DISC_IND                                     02740000
027500             , A.DED_RTV_IND                                      02750000
027700             , D.ENT_NAME_DESC                                    02770000
027800             , C.DUN_NBR                                          02780000
027900             , A.DEPT_NBR                                         02790000
028000             , E.DMA_NBR                                          02800000
028100          FROM TVNDAGR A                                          02810000
028300             , TEXTENT C                                          02830000
028400             , TENTNME D                                          02840000
028500             , TMDSEAR E                                          02850000
028600         WHERE A.AP_TRN_CDE      = '88'                           02860000
028700           AND A.AGRMT_TYP_ID    = '6'                            02870000
028800           AND A.TYP_CDE         = 6                              02880000
030100           AND  A.ENT_ID     = C.ENT_ID                           03010000
030200           AND  C.ENT_ID     = D.ENT_ID                           03020000
030300           AND  A.DEPT_NBR   = E.DEPT_NBR                         03030000
030400           AND  D.TYPE_CDE   = '01'                               03040000
030500           AND  E.MDSELV_CDE = 'DPT'                              03050000
030600           AND  CURRENT DATE BETWEEN E.STRT_DTE AND E.END_DTE     03060000
030700         ORDER BY A.LAST_UPD_TMST DESC                            03070000
030800                 ,D.ENT_NAME_DESC                                 03080000
030900                 ,A.DEPT_NBR                                      03090000
031100                 ,A.EXPIRATION_DATE DESC                          03110000
031200                 ,A.EFFECTIVE_DATE ASC                            03120000
031300     END-EXEC.                                                    03130000
031400                                                                  03140000
031500*----------------------------------------------------------------*03150000
031600*    ABEND DATA AREAS                                             03160000
031700*----------------------------------------------------------------*03170000
031800 01  ABEND-CODE                    PIC S9(4) VALUE ZEROES         03180000
031900                                   COMP         SYNC.             03190000
032000                                                                  03200000
032100     88  AC-ANY-ERROR                           VALUE  +4001      03210000
032200                                                THRU   +4019.     03220000
032300     88  AC-OPEN-ERROR                          VALUE  +4005.     03230000
032400     88  AC-CLOSE-ERROR                         VALUE  +4006.     03240000
032500     88  AC-INVALID-DATA                        VALUE  +4008.     03250000
032600     88  AC-DB2-ERROR                           VALUE  +4013.     03260000
032700     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     03270000
032800     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     03280000
032900                                                                  03290000
033000 01  ABEND-AREAS.                                                 03300000
033100     05  AA-ABEND-LIT              PIC  X(40) VALUE               03310000
033200             '*****       ABEND'.                                 03320000
033300     05  AA-PROGRAM-LIT            PIC  X(40) VALUE               03330000
033400             '*****   PROGRAM: APKRPOFF'.                         03340000
033500     05  AA-PARAGRAPH-LIT.                                        03350000
033600         10  FILLER                PIC  X(17) VALUE               03360000
033700             '***** PARAGRAPH: '.                                 03370000
033800         10  AA-PARAGRAPH-NAME     PIC  X(35) VALUE SPACES.       03380000
033900     05  AA-MESSAGE-LINE-1.                                       03390000
034000         10  FILLER                PIC  X(06) VALUE '*****'.      03400000
034100         10  AA-MESSAGE-1          PIC  X(80) VALUE SPACES.       03410000
034200     05  AA-MESSAGE-LINE-2.                                       03420000
034300         10  FILLER                PIC  X(06) VALUE '*****'.      03430000
034400         10  AA-MESSAGE-2          PIC  X(80) VALUE SPACES.       03440000
034500     05  AA-DB2-ERROR-LIT          PIC  X(40) VALUE               03450000
034600             '*****    DB2 ERROR'.                                03460000
034700     05  AA-DB2-OPERATION-LIT.                                    03470000
034800         10  FILLER                PIC  X(17) VALUE               03480000
034900             '***** OPERATION: '.                                 03490000
035000         10  AA-DB2-OPERATION.                                    03500000
035100             15  AA-DB2-OP-1       PIC  X(25) VALUE SPACES.       03510000
035200             15  AA-DB2-OP-2       PIC  X(25) VALUE SPACES.       03520000
035300     05  AA-DB2-TABLE-1            PIC  X(08) VALUE SPACES.       03530000
035400     05  AA-DB2-TABLE-2            PIC  X(08) VALUE SPACES.       03540000
035500     05  AA-DB2-TABLE-3            PIC  X(08) VALUE SPACES.       03550000
035600     05  AA-DB2-TABLE-4            PIC  X(08) VALUE SPACES.       03560000
035700     05  AA-DB2-TABLE-5            PIC  X(08) VALUE SPACES.       03570000
035800     05  AA-DB2-TABLE-6            PIC  X(08) VALUE SPACES.       03580000
035900                                                                  03590000
036000                                                                  03600000
036100*---------------------------------------------------------------* 03610000
036200*  DB2 FORMATTED MESSAGE AREA                                     03620000
036300*---------------------------------------------------------------* 03630000
036400     COPY DPWS004.                                                03640000
036500                                                                  03650000
036600                                                                  03660000
036700 PROCEDURE DIVISION.                                              03670000
036800                                                                  03680000
036900 A100-PROGRAM-MAINLINE.                                           03690000
037000                                                                  03700000
037100     PERFORM B100-INITIALIZE.                                     03710000
037200                                                                  03720000
037300     PERFORM B200-CREATE-REPORT                                   03730000
037400         UNTIL END-OF-CSR.                                        03740000
037500                                                                  03750000
037600     PERFORM B300-EOJ-ROUTINE.                                    03760000
037700                                                                  03770000
037800     GOBACK.                                                      03780000
037900                                                                  03790000
038000                                                                  03800000
038100******************************************************************03810000
038200*  INITIALIZATIONS                                               *03820000
038300******************************************************************03830000
038400 B100-INITIALIZE.                                                 03840000
038500                                                                  03850000
038600     OPEN OUTPUT REPORT-FILE.                                     03860000
038700                                                                  03870000
038800     INITIALIZE DCLTEXTENT                                        03880000
038900                DCLTENTNME                                        03890000
039100                DCLTVNDAGR                                        03910000
039200                DCLTMDSEAR.                                       03920000
039300                                                                  03930000
039400                                                                  03940000
039500*    FORMAT HEADING DATA                                          03950000
039600     MOVE FUNCTION CURRENT-DATE       TO PV-CURRENT-DATE.         03960000
039700     MOVE PV-CURRENT-MONTH            TO DP132-RUN-MONTH          03970000
039800                                         WS-HEADER-MM.            03980000
039900     MOVE PV-CURRENT-DAY              TO DP132-RUN-DAY            03990000
040000                                         WS-HEADER-DD.            04000000
040100     MOVE PV-CURRENT-CCYY             TO DP132-RUN-YEAR           04010000
040200                                         WS-HEADER-CCYY.          04020000
040300     MOVE '/'                         TO WS-HD-SLASH-1            04030000
040400                                         WS-HD-SLASH-2.           04040000
040500     MOVE WS-HEADER-DATE              TO H2-DATE.                 04050000
040600                                                                  04060000
040700     ACCEPT PV-CURRENT-TIME           FROM TIME.                  04070000
040800     MOVE PV-CURRENT-HOUR             TO DP132-RUN-HOUR.          04080000
040900     MOVE PV-CURRENT-MINUTE           TO DP132-RUN-MINUTE.        04090000
041000     MOVE PC-PROGRAM-NAME             TO DP132-PROGRAM-NAME.      04100000
041100     MOVE 1                           TO DP132-REPORT-NUMBER.     04110000
041200                                                                  04120000
041300*    PERFORM OPEN AND INITIAL FETCH OF THE AGREEMENTS CURSOR      04130000
041400     PERFORM X100-OPEN-AGREEMENTS-CSR.                            04140000
041500                                                                  04150000
041600     PERFORM S200-FETCH-AGREEMENTS-CSR.                           04160000
041700                                                                  04170000
041800     IF END-OF-CSR                                                04180000
041900        DISPLAY 'NO RECORDS FOUND WITH CURSOR!!!'                 04190000
042000     END-IF.                                                      04200000
042100                                                                  04210000
042300     PERFORM W100-WRITE-HEADINGS.                                 04230000
042400                                                                  04240000
042500                                                                  04250000
042600******************************************************************04260000
042700*  CREATE REPORT DETAILS FROM ROWS FETCHED FROM CURSOR.           04270000
042800******************************************************************04280000
042900 B200-CREATE-REPORT.                                              04290000
043000                                                                  04300000
043700     PERFORM C100-POPULATE-REPORT-RECORD.                         04370000
043800     PERFORM W200-WRITE-REPORT-RECORD.                            04380000
043900                                                                  04390000
044000     PERFORM S200-FETCH-AGREEMENTS-CSR.                           04400000
044100                                                                  04410000
044200                                                                  04420000
044300******************************************************************04430000
044400*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *04440000
044500******************************************************************04450000
044600 B300-EOJ-ROUTINE.                                                04460000
044700                                                                  04470000
045000     PERFORM W400-WRITE-EOR.                                      04500000
045100                                                                  04510000
045200     PERFORM X200-CLOSE-AGREEMENTS-CSR.                           04520000
045300                                                                  04530000
045400     CLOSE REPORT-FILE.                                           04540000
045500                                                                  04550000
045600     DISPLAY '** TOTAL RECORDS FETCHED= ' PV-AGR-CSR-COUNT.       04560000
045700                                                                  04570000
045800******************************************************************04580000
045900*  FORMAT REPORT DETAIL                                           04590000
046000******************************************************************04600000
046100 C100-POPULATE-REPORT-RECORD.                                     04610000
046200                                                                  04620000
046300     IF  ENTNME-ENT-NAME-DESC = SAVE-VND-NAME                     04630000
046400         MOVE SPACES                TO DL-VENDOR-NAME             04640000
046500                                       DL-VENDOR-NBR              04650000
046600     ELSE                                                         04660000
046700         MOVE ENTNME-ENT-NAME-DESC  TO DL-VENDOR-NAME             04670000
046800                                       SAVE-VND-NAME              04680000
046900         MOVE EXTENT-DUN-NBR        TO DL-VENDOR-NBR              04690000
047000         PERFORM W600-WRITE-BLANK-LINE                            04700000
047100     END-IF.                                                      04710000
047200                                                                  04720000
047300     MOVE VNDAGR-DEPT-NBR           TO DL-DEPT-NBR.               04730000
047400     MULTIPLY VNDAGR-DISCOUNT-PCT BY 100 GIVING PV-DISCOUNT-PCT.  04740000
047500     MOVE PV-DISCOUNT-PCT           TO DL-DISCOUNT-PCT.           04750000
047700     MOVE VNDAGR-DED-RTV-IND        TO DL-RTV-IND.                04770000
047800     MOVE VNDAGR-DED-DISC-IND       TO DL-DSC-IND.                04780000
047900     MOVE VNDAGR-PSTG-FRQ-CDE       TO DL-POSTING-FREQUENCY.      04790000
048000     MOVE VNDAGR-EFFECTIVE-DATE     TO DL-EFFECTIVE-DATE.         04800000
048100     MOVE VNDAGR-EXPIRATION-DATE    TO DL-EXPIRATION-DATE.        04810000
048110     MOVE PV-LAST-UPD-DATE          TO DL-LAST-UPDATE.            04811000
048200     MOVE MDSEAR-DMA-NBR            TO DL-DMA-NBR.                04820000
048300                                                                  04830000
048700*---------------------------------------------------------------- 04870000
048800*    FETCH THE AGREEMENT_CSR CURSOR.                              04880000
048900*---------------------------------------------------------------- 04890000
049000 S200-FETCH-AGREEMENTS-CSR.                                       04900000
049100                                                                  04910000
049200     EXEC SQL                                                     04920000
049300         FETCH  AGREEMENT_CSR                                     04930000
049400         INTO  :VNDAGR-AP-TRN-CDE                                 04940000
049500             , :VNDAGR-DISCOUNT-PCT                               04950000
049600             , :VNDAGR-EFFECTIVE-DATE                             04960000
049700             , :VNDAGR-EXPIRATION-DATE                            04970000
049710             , :PV-LAST-UPD-DATE                                  04971000
049800             , :VNDAGR-PSTG-FRQ-CDE                               04980000
049900             , :VNDAGR-DED-DISC-IND                               04990000
050000             , :VNDAGR-DED-RTV-IND                                05000000
050200             , :ENTNME-ENT-NAME-DESC                              05020000
050300             , :EXTENT-DUN-NBR                                    05030000
050400             , :VNDAGR-DEPT-NBR                                   05040000
050500             , :MDSEAR-DMA-NBR                                    05050000
050600     END-EXEC.                                                    05060000
050700                                                                  05070000
050800     EVALUATE TRUE                                                05080000
050900         WHEN SQLCODE = ZERO                                      05090000
051000             ADD 1 TO PV-AGR-CSR-COUNT                            05100000
051100                                                                  05110000
051200         WHEN SQLCODE = +100                                      05120000
051300             SET END-OF-CSR TO TRUE                               05130000
051400                                                                  05140000
051500         WHEN SQLWARN0 NOT = SPACES                               05150000
051600         WHEN SQLCODE  NOT = ZERO                                 05160000
051700             MOVE 'S200-FETCH-AGREEMENTS-CSR'                     05170000
051800                                 TO AA-PARAGRAPH-NAME             05180000
051900             MOVE 'UNSUCCESSFUL FETCH FROM AGREEMENT_CSR'         05190000
052000                                 TO AA-DB2-OPERATION              05200000
052100             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                05210000
052300             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                05230000
052400             MOVE 'TENTNME'      TO AA-DB2-TABLE-3                05240000
052500             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-4                05250000
052600             PERFORM Z999-DB2-ABEND                               05260000
052700     END-EVALUATE.                                                05270000
052800                                                                  05280000
055100                                                                  05510000
055200*----------------------------------------------------------------*05520000
055300*    WRITE PAGE HEADING LINES                                    *05530000
055400*----------------------------------------------------------------*05540000
055500 W100-WRITE-HEADINGS.                                             05550000
055600                                                                  05560000
055700     ADD +1             TO PV-PAGE-COUNT.                         05570000
055800     MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     05580000
055900                                                                  05590000
056000* HEADING LINE 1 (STANDARD)                                       05600000
056100     WRITE REPORT-REC FROM DP132-STANDRD-HEADER-132-COLS          05610000
056200       AFTER ADVANCING PAGE.                                      05620000
056300                                                                  05630000
056400     WRITE REPORT-REC FROM HEADING-LINE-1                         05640000
056500       AFTER ADVANCING +1 LINES.                                  05650000
056600                                                                  05660000
056700     WRITE REPORT-REC FROM HEADING-LINE-2                         05670000
056800       AFTER ADVANCING +1 LINES.                                  05680000
056900                                                                  05690000
057000     WRITE REPORT-REC FROM DETAIL-HEADING-LINE                    05700000
057100       AFTER ADVANCING +2 LINES.                                  05710000
057200                                                                  05720000
057300     WRITE REPORT-REC FROM BLANK-LINE                             05730000
057400       AFTER ADVANCING +1 LINES.                                  05740000
057500                                                                  05750000
058400     MOVE +6 TO PV-LINE-COUNT.                                    05840000
058500                                                                  05850000
058600     MOVE ENTNME-ENT-NAME-DESC  TO DL-VENDOR-NAME.                05860000
058700     MOVE EXTENT-DUN-NBR        TO DL-VENDOR-NBR.                 05870000
058800                                                                  05880000
058900******************************************************************05890000
059000*  WRITE OUT REPORT DETAIL LINE                                  *05900000
059100******************************************************************05910000
059200 W200-WRITE-REPORT-RECORD.                                        05920000
059300                                                                  05930000
059400     IF PV-LINE-COUNT > PC-LINES-PER-PAGE-MAX                     05940000
059500         PERFORM W100-WRITE-HEADINGS                              05950000
059600     END-IF.                                                      05960000
059700                                                                  05970000
059800     WRITE REPORT-REC FROM DETAIL-LINE                            05980000
059900       AFTER ADVANCING +1 LINES.                                  05990000
060000                                                                  06000000
060100     ADD +1 TO PV-LINE-COUNT.                                     06010000
060200                                                                  06020000
060300     INITIALIZE DETAIL-LINE.                                      06030000
060400                                                                  06040000
062000                                                                  06200000
062100*----------------------------------------------------------------*06210000
062200*    WRITE END OF REPORT LINE                                    *06220000
062300*----------------------------------------------------------------*06230000
062400 W400-WRITE-EOR.                                                  06240000
062500                                                                  06250000
062600     IF (PV-LINE-COUNT + 3) > PC-LINES-PER-PAGE-MAX               06260000
062700         PERFORM W100-WRITE-HEADINGS                              06270000
062800     END-IF.                                                      06280000
062900                                                                  06290000
063000     WRITE REPORT-REC FROM END-OF-REPORT                          06300000
063100       AFTER ADVANCING +3 LINES.                                  06310000
063200                                                                  06320000
063300                                                                  06330000
065300                                                                  06530000
065400*----------------------------------------------------------------*06540000
065500*    WRITE BLANK LINE                                            *06550000
065600*----------------------------------------------------------------*06560000
065700 W600-WRITE-BLANK-LINE.                                           06570000
065800                                                                  06580000
065900     IF (PV-LINE-COUNT + 2) > PC-LINES-PER-PAGE-MAX               06590000
066000         PERFORM W100-WRITE-HEADINGS                              06600000
066100     ELSE                                                         06610000
066200         WRITE REPORT-REC FROM BLANK-LINE                         06620000
066300           AFTER ADVANCING +1 LINES                               06630000
066400         ADD +1 TO PV-LINE-COUNT                                  06640000
066500     END-IF.                                                      06650000
066600                                                                  06660000
066700*---------------------------------------------------------------- 06670000
066800*    OPEN AGREEMENT_CSR CURSOR                                    06680000
066900*---------------------------------------------------------------- 06690000
067000 X100-OPEN-AGREEMENTS-CSR.                                        06700000
067100                                                                  06710000
067200     EXEC SQL                                                     06720000
067300         OPEN AGREEMENT_CSR                                       06730000
067400     END-EXEC.                                                    06740000
067500                                                                  06750000
067600     EVALUATE TRUE                                                06760000
067700         WHEN SQLCODE = ZERO                                      06770000
067800             CONTINUE                                             06780000
067900                                                                  06790000
068000         WHEN SQLWARN0 NOT = SPACES                               06800000
068100         WHEN SQLCODE  NOT = ZERO                                 06810000
068200             MOVE 'X100-OPEN-AGREEMENTS-CSR'                      06820000
068300                                 TO AA-PARAGRAPH-NAME             06830000
068400             MOVE 'UNSUCCESSFUL OPEN ON AGREEMENT_CSR'            06840000
068500                                 TO AA-DB2-OPERATION              06850000
068600             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                06860000
068800             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                06880000
068900             MOVE 'TENTNME'      TO AA-DB2-TABLE-3                06890000
069000             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-4                06900000
069100             PERFORM Z999-DB2-ABEND                               06910000
069200     END-EVALUATE.                                                06920000
069300                                                                  06930000
069400                                                                  06940000
069500*---------------------------------------------------------------- 06950000
069600*    CLOSE THE AGREEMENT_CSR CURSOR                               06960000
069700*---------------------------------------------------------------- 06970000
069800 X200-CLOSE-AGREEMENTS-CSR.                                       06980000
069900                                                                  06990000
070000     EXEC SQL                                                     07000000
070100         CLOSE AGREEMENT_CSR                                      07010000
070200     END-EXEC.                                                    07020000
070300                                                                  07030000
070400     EVALUATE TRUE                                                07040000
070500         WHEN SQLCODE = ZERO                                      07050000
070600             CONTINUE                                             07060000
070700                                                                  07070000
070800         WHEN SQLWARN0 NOT = SPACES                               07080000
070900         WHEN SQLCODE  NOT = ZERO                                 07090000
071000             MOVE 'X200-CLOSE-AGREEMENTS-CSR'                     07100000
071100                                 TO AA-PARAGRAPH-NAME             07110000
071200             MOVE 'UNSUCCESSFUL CLOSE ON AGREEMENT_CSR'           07120000
071300                                 TO AA-DB2-OPERATION              07130000
071400             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                07140000
071600             MOVE 'TEXTENT'      TO AA-DB2-TABLE-2                07160000
071700             MOVE 'TENTNME'      TO AA-DB2-TABLE-3                07170000
071800             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-4                07180000
071900             PERFORM Z999-DB2-ABEND                               07190000
072000       END-EVALUATE.                                              07200000
072100                                                                  07210000
072200                                                                  07220000
072300******************************************************************07230000
072400*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *07240000
072500*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *07250000
072600*  SQL ERROR OR WARNING CODE OCCURS.                             *07260000
072700******************************************************************07270000
072800 Z999-DB2-ABEND.                                                  07280000
072900                                                                  07290000
073000     DISPLAY AA-ABEND-LIT.                                        07300000
073100     DISPLAY AA-MESSAGE-LINE-1.                                   07310000
073200     DISPLAY AA-MESSAGE-LINE-2.                                   07320000
073300     DISPLAY AA-DB2-ERROR-LIT.                                    07330000
073400     DISPLAY AA-PROGRAM-LIT.                                      07340000
073500     DISPLAY AA-PARAGRAPH-LIT.                                    07350000
073600     DISPLAY AA-DB2-OPERATION-LIT.                                07360000
073700     DISPLAY AA-DB2-TABLE-1.                                      07370000
073800     DISPLAY AA-DB2-TABLE-2.                                      07380000
073900     DISPLAY AA-DB2-TABLE-3.                                      07390000
074000     DISPLAY AA-DB2-TABLE-4.                                      07400000
074200                                                                  07420000
074300*----------------------------------------------------------------*07430000
074400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *07440000
074500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *07450000
074600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *07460000
074700* FORMAT.                                                        *07470000
074800*----------------------------------------------------------------*07480000
074900     COPY DPPD004.                                                07490000
075000                                                                  07500000
075100*----------------------------------------------------------------*07510000
075200* CALL ABEND                                                     *07520000
075300*----------------------------------------------------------------*07530000
075400     MOVE +4013                  TO ABEND-CODE.                   07540000
075500     CALL 'ILBOABN0' USING ABEND-CODE.                            07550000
075600*                                                                 07560000
