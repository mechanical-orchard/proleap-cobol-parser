000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    TMKCS600.                                         00020001
000300 AUTHOR.        MARGARET MORRISON.                                00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  05/99.                                            00050001
000600 DATE-COMPILED.                                                   00060001
000700*----------------------------------------------------------------*00070001
000800*    Y600 - TROUBLE MANAGEMENT CRITERIA SPECIFICATION            *00080001
000900*                   FOR IMPORT EXCEPTIONS                        *00090001
001000*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00100001
001100*    SUBSEQUENT PROGRAMS TO CREATE A LIST OF TROUBLE RECORDS     *00110001
001200*    ASSOCIATED WITH A FOB, POE, OTB, DEPT, PO, BUYER,           *00120001
001201*    CONSOLIDATOR, DECONSOLIDATOR, CUSTOMS BROKER, OR OPERATING  *00130001
001202*    UNIT.                                                       *        
001203*    THE LIST CAN BE IN PO SEQUENCE OR FROM OLDEST TO NEWEST     *00140001
001204*    TROUBLE SEQUENCE.                                           *00150001
001300*----------------------------------------------------------------*00190001
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*----------------------------------------------------------------*        
CICS  * CHANGED 11/09/2022    BY JIM HUNTER      WR: CHG0278008                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001400                                                                  00200001
001500 ENVIRONMENT DIVISION.                                            00210001
001600 DATA DIVISION.                                                   00220001
001700 WORKING-STORAGE SECTION.                                         00230001
001800                                                                  00240001
001900 01  PC-PROGRAM-CONSTANTS.                                        00250001
002000     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'TM600A  '. 00260001
002100     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'TMKM600 '. 00270001
002200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'TMKCS600'. 00280001
002300     05  PC-MAX-RETRIES            PIC S9(04)  VALUE    +3.       00290001
003200     05  PC-KOHLS-OPER-CO          PIC  X(02)  VALUE   '03'.      00300001
003201     05  PC-CORPORATE-OFFICE       PIC  X(03)  VALUE   '090'.     00310001
003202     05  PC-ACTIVE-STATUS          PIC  X(01)  VALUE   'A'.       00320001
003203     05  PC-ALL                    PIC  X(03)  VALUE   'ALL'.     00320001
003209     05  PC-A                      PIC  X(01)  VALUE   'A'.       00390001
003210     05  PC-B                      PIC  X(01)  VALUE   'B'.       00390001
003211     05  PC-D                      PIC  X(01)  VALUE   'D'.       00390001
003212     05  PC-N                      PIC  X(01)  VALUE   'N'.       00410001
003213     05  PC-I                      PIC  X(01)  VALUE   'I'.       00420001
003214     05  PC-R                      PIC  X(01)  VALUE   'R'.       00430001
003215     05  PC-S                      PIC  X(01)  VALUE   'S'.       00440001
003216     05  PC-T                      PIC  X(01)  VALUE   'T'.       00440001
003217     05  PC-0001                   PIC S9(04)  VALUE  +0001.      00450001
003219******************* SYSTEM MESSAGES ****************************  00480001
003220     05  PC-TSYMSG-NUMBERS.                                       00490001
003300*  INVALID ENTRY                                                  00500001
003400         10  PC-TSYMSG-00005       PIC  9(05)  VALUE 00005.       00510001
003500*  REQUIRED ENTRY                                                 00520001
003600         10  PC-TSYMSG-00007       PIC  9(05)  VALUE 00007.       00530001
003700*  MUST BE NUMBERIC                                               00540001
003800         10  PC-TSYMSG-00008       PIC  9(05)  VALUE 00008.       00550001
003900*  INVALID DATE                                                   00560001
004000         10  PC-TSYMSG-00009       PIC  9(05)  VALUE 00009.       00570001
004100*  PURCHASE ORDER DOES NOT EXIST                                  00580001
004200         10  PC-TSYMSG-00083       PIC  9(05)  VALUE 00083.       00590001
004300*  FROM DATE MUST BE LESS THAN OR EQUAL TO THE TO DATE            00600001
004400         10  PC-TSYMSG-00395       PIC  9(05)  VALUE 00395.       00610001
004500*  ENTER AN "S" TO SELECT                                         00620001
004600         10  PC-TSYMSG-00397       PIC  9(05)  VALUE 00397.       00630001
004601*  DEPARTMENT NUMBER IS REQUIRED FOR SELECTED FUNCTION            00640001
004602         10  PC-TSYMSG-00486       PIC  9(05)  VALUE 00486.       00650001
004700*  WAIT 15 SECONDS;RETRY FUNCTION AGAIN, IF UNSUCCESSFUL          00660001
004710*  CALL HELP DESK                                                 00670001
004800         10  PC-TSYMSG-00551       PIC  9(05)  VALUE 00551.       00680001
004801*  PURCHASE ORDER NOT FOUND                                       00690001
004802         10  PC-TSYMSG-00726       PIC  9(05)  VALUE 00726.       00700001
004803*  RECEIVER SEQUENCE NUMBER REQUIRED                              00710001
004804         10  PC-TSYMSG-00737       PIC  9(05)  VALUE 00737.       00720001
004805*  NOT AUTHORIZED TO VIEW THIS INFORMATION                        00730001
004806         10  PC-TSYMSG-00840       PIC  9(05)  VALUE 00840.       00740001
004807*  ONLY ONE MAY BE SELECTED                                       00750001
004808         10  PC-TSYMSG-00973       PIC  9(05)  VALUE 00973.       00760001
004809*  DEPARTMENT, BUYER OR PO NBR REQUIRED FOR LIST                  00770001
004810         10  PC-TSYMSG-01029       PIC  9(05)  VALUE 01029.       00780001
004811*  INVALID TROUBLE SELECTION REASON ENTERED                       00790001
004812*  NOTE: THIS MESSAGE IS RETURNED FROM LIST SCREEN PGM TMKCS601   00800001
004813         10  PC-TSYMSG-01030       PIC  9(05)  VALUE 01030.       00810001
004816*  RECEIVER NOT FOUND                                             00840001
004817         10  PC-TSYMSG-01298       PIC  9(05)  VALUE 01298.       00850001
004818*  THE FOB CODE IS INVALID                                        00840001
004819         10  PC-TSYMSG-01451       PIC  9(05)  VALUE 01451.       00850001
004820*  THE PORT CODE IS INVALID                                       00840001
004821         10  PC-TSYMSG-01452       PIC  9(05)  VALUE 01452.       00850001
004822*  A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK                00860001
004823         10  PC-TSYMSG-01570       PIC  9(05)  VALUE 01570.       00870001
004824*  ONLY ONE MAY BE ENTERED                                        00880001
004825         10  PC-TSYMSG-01693       PIC  9(05)  VALUE 01693.       00890001
004826*  ONE MUST BE SELECTED                                           00900001
004827         10  PC-TSYMSG-01698       PIC  9(05)  VALUE 01698.       00910001
004828*  LIST SEQUENCE REQUIRED FOR THIS FUNCTION                       00920001
004829         10  PC-TSYMSG-01739       PIC  9(05)  VALUE 01739.       00930001
004830*  ONLY DEPARTMENT, PO, PO/RECEIVER MAY BE ENTERED FOR THIS       00940001
004831*  FUNCTION                                                       00950001
004832         10  PC-TSYMSG-01740       PIC  9(05)  VALUE 01740.       00960001
004833*  INVALID OPERATING UNIT                                         00970001
004840         10  PC-TSYMSG-01741       PIC  9(05)  VALUE 01741.       00980001
004900*                                                                 00990001
005000 01  PS-PROGRAM-SWITCHES.                                         01000001
005100     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        01010001
005200         88  PS-ERROR                          VALUE  'Y'.        01020001
005300         88  PS-NO-ERROR                       VALUE  'N'.        01030001
005301     05  PS-SQL-ERROR-SW           PIC  X(01)  VALUE  'N'.        01040001
005302         88  PS-SQL-ERROR                      VALUE  'Y'.        01050001
005303         88  PS-NO-SQL-ERROR                   VALUE  'N'.        01060001
005307     05  PS-ERROR-MSG-SW           PIC  X(01)  VALUE  ' '.        01100001
005308         88  PS-PO-RCVR-NOT-FOUND              VALUE  'P'.        01110001
005309         88  PS-RETRY-EXCEEDED                 VALUE  'X'.        01120001
005310         88  PS-SEVERE-ERROR                   VALUE  'S'.        01130001
005311     05  PS-ALL-TRBL-SW            PIC  X(01)  VALUE  'N'.        01170001
005312         88  PS-ALL-TRBL-ENTERED               VALUE  'Y'.        01180001
005313         88  PS-ALL-TRBL-NOT-ENTERED           VALUE  'N'.        01190001
005314     05  PS-OTB-SW                 PIC  X(01)  VALUE  'N'.        01170001
005315         88  PS-OTB-ENTERED                    VALUE  'Y'.        01180001
005316         88  PS-OTB-NOT-ENTERED                VALUE  'N'.        01190001
005317     05  PS-FOB-CDE-SW             PIC  X(01)  VALUE  'N'.        01170001
005318         88  PS-FOB-CDE-ENTERED                VALUE  'Y'.        01180001
005319         88  PS-FOB-CDE-NOT-ENTERED            VALUE  'N'.        01190001
005320     05  PS-POE-CDE-SE             PIC  X(01)  VALUE  'N'.        01170001
005321         88  PS-POE-CDE-ENTERED                VALUE  'Y'.        01180001
005322         88  PS-POE-CDE-NOT-ENTERED            VALUE  'N'.        01190001
005323     05  PS-DEPT-NBR-SW            PIC  X(01)  VALUE  'N'.        01170001
005324         88  PS-DEPT-NBR-ENTERED               VALUE  'Y'.        01180001
005325         88  PS-DEPT-NBR-NOT-ENTERED           VALUE  'N'.        01190001
005326     05  PS-BUYER-NBR-SW           PIC  X(01)  VALUE  'N'.        01200001
005327         88  PS-BUYER-NBR-ENTERED              VALUE  'Y'.        01210001
005328         88  PS-BUYER-NBR-NOT-ENTERED          VALUE  'N'.        01220001
005329     05  PS-PO-NBR-SW              PIC  X(01)  VALUE  'N'.        01230001
005330         88  PS-PO-NBR-ENTERED                 VALUE  'Y'.        01240001
005331         88  PS-PO-NBR-NOT-ENTERED             VALUE  'N'.        01250001
005332     05  PS-LIST-SEQ-SW            PIC  X(01)  VALUE  'N'.        01290001
005333         88  PS-LIST-SEQ-ENTERED               VALUE  'Y'.        01300001
005334         88  PS-LIST-SEQ-NOT-ENTERED           VALUE  'N'.        01310001
005335     05  PS-RCVR-STAT-SW           PIC  X(01)  VALUE  'N'.        01350001
005336         88  PS-RCVR-STAT-ENTERED              VALUE  'Y'.        01360001
005337         88  PS-RCVR-STAT-NOT-ENTERED          VALUE  'N'.        01370001
005338     05  PS-TRBL-RESN-SW           PIC  X(01)  VALUE  'N'.        01380001
005339         88  PS-TRBL-RESN-ENTERED              VALUE  'Y'.        01390001
005340         88  PS-TRBL-RESN-NOT-ENTERED          VALUE  'N'.        01400001
005341     05  PS-HOURS-SW               PIC  X(01)  VALUE  'N'.        01410001
005342         88  PS-HOURS-ENTERED                  VALUE  'Y'.        01420001
005343         88  PS-HOURS-NOT-ENTERED              VALUE  'N'.        01430001
005344     05  PS-DAYS-SW                PIC  X(01)  VALUE  'N'.        01440001
005345         88  PS-DAYS-ENTERED                   VALUE  'Y'.        01450001
005346         88  PS-DAYS-NOT-ENTERED               VALUE  'N'.        01460001
005347     05  PS-VALID-FOB-SW           PIC  X(01)  VALUE  'N'.        01440001
005348         88  PS-VALID-FOB                      VALUE  'Y'.        01450001
005349         88  PS-INVALID-FOB                    VALUE  'N'.        01460001
005350     05  PS-VALID-POE-SW           PIC  X(01)  VALUE  'N'.        01440001
005351         88  PS-VALID-POE                      VALUE  'Y'.        01450001
005360         88  PS-INVALID-POE                    VALUE  'N'.        01460001
005370     05  PS-VALID-PO-NBR-SW        PIC  X(01)  VALUE  'N'.        01440001
005380         88  PS-VALID-PO-NBR                   VALUE  'Y'.        01450001
005390         88  PS-INVALID-PO-NBR                 VALUE  'N'.        01460001
005400*                                                                 01470001
005500 01  PV-PROGRAM-VARIABLES.                                        01480001
005600     05  PV-SQL-SUB                PIC S9(04)  VALUE +0           01490001
005700                                               COMP SYNC.         01500001
005800     05  PV-RETRY-COUNTER          PIC S9(04)  VALUE ZERO         01510001
005900                                               COMP SYNC.         01520001
006000     05  PV-COMMAREA-LENGTH        PIC S9(04)  VALUE +0           01530001
006100                                               COMP SYNC.         01540001
006200     05  PV-DB2-COUNT              PIC S9(09)  VALUE +0           01550001
006300                                               COMP-3.            01560001
006400     05  PV-LOCATION.                                             01570001
006500         10  FILLER                PIC  X(01)  VALUE '0'.         01580001
006600         10  PV-DP020-LOCATION     PIC  X(03)  VALUE '000'.       01590001
006700     05  PV-TIMESTAMP              PIC X(26)   VALUE SPACES.      01600001
008400     05  PV-SAVE-OPER-UNT          PIC  X(04)       VALUE SPACES. 01610001
008500     05  PV-SAVE-OPER-UNT-N REDEFINES                             01620001
008600         PV-SAVE-OPER-UNT          PIC  9(04).                    01630001
008601     05  PV-FOB-CDE                PIC  X(04)  VALUE SPACES.              
008602     05  PV-POE-CDE                PIC  X(03)  VALUE SPACES.              
008603*                                                                 01640001
008604 01  DK-DB2-KEYS.                                                 01650001
008605     05  DK-OPER-UNT-ID            PIC S9(04)  COMP VALUE +0.     01660001
008606     05  DK-FCLTY-ID               PIC S9(04)  COMP VALUE +0.     01670001
008607     05  DK-PO-NBR                 PIC S9(09)  COMP VALUE +0.     01680001
008608     05  DK-REC-SEQ-NBR            PIC S9(09)  COMP VALUE +0.     01690001
008609     05  DK-LOW-REC-SEQ-NBR        PIC S9(09)  COMP VALUE +0.     01700001
008610     05  DK-HI-REC-SEQ-NBR         PIC S9(09)  COMP VALUE +0.     01710001
008611     05  DK-FOB-CDE                PIC  X(04)       VALUE SPACES.         
008612     05  DK-POE-CDE                PIC  X(03)       VALUE SPACES.         
008613     05  DK-DEPT-NBR               PIC  X(03)       VALUE SPACES. 01720001
008614     05  DK-DEPT-NBR-N             REDEFINES                      01730001
008615         DK-DEPT-NBR               PIC  9(03).                    01740001
008616     05  DK-BUYER-NBR              PIC  X(03)       VALUE SPACES. 01750001
008617     05  DK-BUYER-NBR-N            REDEFINES                      01760001
008618         DK-BUYER-NBR              PIC  9(03).                    01770001
008700     05  DK-DMA-NBR                PIC  X(02)       VALUE SPACES. 01780001
008800     05  DK-DMA-NBR-N              REDEFINES                      01790001
008900         DK-DMA-NBR                PIC  9(02).                    01800001
009000     05  DK-GMA-NBR                PIC  X(02)       VALUE SPACES. 01810001
009100     05  DK-GMA-NBR-N              REDEFINES                      01820001
009200         DK-GMA-NBR                PIC  9(02).                    01830001
009201     05  DK-STORE-NMBR.                                           01840001
009202         10  FILLER                PIC  X(01)  VALUE SPACES.      01850001
009203         10  DK-THREE-DIG-STORE-NMBR PIC  X(03)  VALUE SPACES.    01860001
009700/                                                                 01870001
009800     COPY TMKM600.                                                01880001
009900/                                                                 01890001
010000*    ATTRIBUTE SETTINGS COPYBOOK.                                *01900001
010100                                                                  01910001
010200     COPY DPWS015.                                                01920001
010300                                                                  01930001
010400*    FUNCTION KEYS COPYBOOK                                      *01940001
010500                                                                  01950001
010600     COPY DPWS016.                                                01960001
010700/                                                                 01970001
010800** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01980001
010900** SUB-ROUTINE (DPKUT100).                                      **01990001
011000     COPY DPWS010I.                                               02000001
011100/                                                                 02010001
011500*  WORK AREA PASSED IN CALL TO DPKUT500                          *02020001
011600     COPY DPWS500.                                                02030001
011700/                                                                 02040001
055700*---------------------------------------------------------------*         
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
055900*---------------------------------------------------------------*         
011800     COPY DPWS030.                                                02050001
CICS       COPY DPWS930.                                                        
011900/                                                                 02060001
012000*    STANDARD COMMAREA.                                           02070001
012100                                                                  02080001
012200     COPY DPWS020.                                                02090001
012300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02100001
012400         10  INTER-APPL-COMM-AREA PIC X(200).                     02110001
012506**** USED FOR TROUBLE LISTS FROM IMPORT EXCEPTION CRIT SPEC       02120001
012507     COPY TMWS006.                                                02130001
012600***************************************************************** 02180001
012700*    SPECIFIC COMMMAREA FOR TMKCS600.                             02190001
012800***************************************************************** 02200001
012900         10  ASC-SPECIFIC-COMMAREA.                               02210001
013103             15  FILLER                         PIC X(01).                
013104             15  ASC-NUMBER-OF-SELECTED-ITEMS   PIC S9(09)                
013105                                                    COMP-3.               
013106             15  ASC-NUMBER-OF-TS-ITEMS         PIC S9(05)                
013107                                                    COMP-3.               
013108             15  ASC-SEL-QUEUE-NAME             PIC X(08).                
013109             15  ASC-FOB-CDE                    PIC X(04).                
013110             15  ASC-POE-CDE                    PIC X(03).                
013111             15  ASC-OTB                        PIC X(04).                
013112             15  ASC-OTB-N  REDEFINES                                     
013113                 ASC-OTB                        PIC 9(04).                
013114             15  ASC-DEPT                       PIC X(03).                
013115             15  ASC-DEPT-N  REDEFINES                                    
013116                 ASC-DEPT                       PIC 9(03).                
013117             15  ASC-PO-NBR                     PIC X(09).                
013118             15  ASC-PO-NBR-N REDEFINES                                   
013119                 ASC-PO-NBR                     PIC 9(09).                
013121             15  ASC-BUYER                      PIC X(03).                
013122             15  ASC-BUYER-N  REDEFINES                                   
013123                 ASC-BUYER                      PIC 9(03).                
013124             15  ASC-OPER-UNT-ID                PIC X(04).                
013125             15  ASC-OPER-UNT-ID-N  REDEFINES                             
013126                 ASC-OPER-UNT-ID                PIC 9(04).                
013127             15  ASC-FCLTY-ID                   PIC X(04).                
013128             15  ASC-FCLTY-ID-N  REDEFINES                                
013129                 ASC-FCLTY-ID                   PIC 9(04).                
013130             15  ASC-FCLTY-NME                  PIC X(20).                
013131             15  ASC-FCLTY-SHORT-NME            PIC X(04).                
013132             15  ASC-ALL-TRBL                   PIC X(04).                
013133             15  ASC-LIST-SEQ-SW.                                         
013134                 20  ASC-LS-PO                  PIC X(01).                
013135                 20  ASC-LS-OLD-NEW-TRBL        PIC X(01).                
013136             15  ASC-RESPONSIBILITY-AREA.                                 
013137                 20  ASC-RA-BUYER-ANALYST       PIC X(01).                
013138                 20  ASC-RA-BUYER-ANALYST-DC    PIC X(01).                
013139                 20  ASC-RA-DC                  PIC X(01).                
013140             15  ASC-TRBL-REASON                PIC X(03).                
013141             15  ASC-TRBL-RSN-DESC              PIC X(20).                
013142             15  ASC-NOTIF-STATUS               PIC X(01).                
013143                 88  ASC-ALL-NOTIF-STATS        VALUE ' '.                
013144                 88  ASC-RESOLVD-STAT-ONLY      VALUE 'R'.                
013145                 88  ASC-UNRSLVD-STAT-ONLY      VALUE 'U'.                
013146             15  ASC-STAT-NEW                   PIC X(01).                
013147             15  ASC-STAT-IN-PRC                PIC X(01).                
013148             15  ASC-STAT-RSLVD                 PIC X(01).                
013149             15  ASC-STAT-ACKNW                 PIC X(01).                
013150             15  ASC-LIST-TRBL-HOURS            PIC 9(02).                
013151             15  ASC-LIST-TRBL-DAYS             PIC 9(01).                
013160             15  FILLER                         PIC X(79).                
019602/                                                                 02770001
019603*    ABEND PROCESSING COPYBOOK.                                  *02780001
019604                                                                  02790001
019605     COPY DPWS013.                                                02800001
019606/                                                                 02810001
020601*  SQL AND COBOL DECLARATIONS FOR THE FACILITY TABLE             *02880001
020602                                                                  02890001
020603     EXEC SQL                                                     02900001
020604         INCLUDE TFACLTY                                          02910001
020605     END-EXEC.                                                    02920001
020606/                                                                 02930001
020607*  SQL AND COBOL DECLARATIONS FOR THE MERCHANDISE AREA TABLE     *02940001
020608                                                                  02950001
020609     EXEC SQL                                                     02960001
020610         INCLUDE TMDSEAR                                          02970001
020611     END-EXEC.                                                    02980001
020612/                                                                 02990001
022302*  SQL AND COBOL DECLARATIONS FOR THE IMPORTS FOB TABLE          *03120001
022303                                                                  03130001
022304     EXEC SQL                                                     03140001
022305         INCLUDE TIMFOB                                           03150001
022306     END-EXEC.                                                    03160001
022307/                                                                 03170001
022308*  SQL AND COBOL DECLARATIONS FOR THE IMPORTS POE TABLE          *03120001
022309                                                                  03130001
022310     EXEC SQL                                                     03140001
022311         INCLUDE TIMPOE                                           03150001
022312     END-EXEC.                                                    03160001
022313/                                                                 03170001
022314*  SQL AND COBOL DECLARATIONS FOR THE PURCHASE ORDER TABLE       *03120001
022315                                                                  03130001
022316     EXEC SQL                                                     03140001
022317         INCLUDE TPURCHS                                          03150001
022318     END-EXEC.                                                    03160001
022319/                                                                 03170001
022500     EXEC SQL                                                     03240001
022600         INCLUDE SQLCA                                            03250001
022700     END-EXEC.                                                    03260001
022800/                                                                 03270001
022811*---------------------------------------------------------------*         
022812*    CURSOR DECLARATION FOR SELECTING POE CODE.                 *         
022813*---------------------------------------------------------------*         
022814                                                                          
022815     EXEC SQL                                                             
022816          DECLARE  POE-CSR CURSOR                                         
022817              FOR  SELECT DISTINCT                                        
022818                   POE_CDE                                                
022819             FROM  TIMPOE                                                 
022820            WHERE  POE_CDE    = :DK-POE-CDE                               
022821              AND  STAT_CDE   = 'A'                                       
022822         ORDER BY  POE_CDE                                                
022823     END-EXEC.                                                            
022826                                                                          
022830 EJECT                                                            04110099
022840                                                                          
022900 LINKAGE SECTION.                                                 03280001
023000                                                                  03290001
023100 01  DFHCOMMAREA.                                                 03300001
023200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03310001
023300                                        DEPENDING ON EIBCALEN.    03320001
023400         10  FILLER                     PIC X.                    03330001
023500                                                                  03340001
023600                                                                  03350001
023700 PROCEDURE DIVISION.                                              03360001
023800                                                                  03370001
023900 0000-MAIN-MODULE.                                                03380001
024000     INITIALIZE DP030-CICS-API-FIELDS.                            03390001
024100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03400001
024200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03410001
024300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03420001
024400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03430001
024500     MOVE LENGTH OF TM600AI        TO DP030-MAP-LENGTH (1).       03440001
024600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03450001
024700     PERFORM 0001-CALL-CICS-ARCH-API.                             03460001
024800                                                                  03470001
024900     PERFORM 1000-CONTROL-PROCESSING                              03480001
025000                                                                  03490001
025100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03500001
025200     PERFORM 0001-CALL-CICS-ARCH-API.                             03510001
025300                                                                  03520001
025400 0001-CALL-CICS-ARCH-API.                                         03530001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03540001
025600                           DFHCOMMAREA                            03550001
025700                           DP030-CICS-API-FIELDS                  03560001
025800                           DP020-STANDARD-COMMAREA                03570001
025900                           TM600AI.                               03580001
026000                                                                  03590001
026100     IF  DP030-RC-CALL-SUCCESSFUL                                 03600001
026200         CONTINUE                                                 03610001
026300     ELSE                                                         03620001
026400         SET DP013-NO-ROLLBACK                                    03630001
026500             DP013-XCTL-DISPLAY-RESTART                           03640001
026600             DP013-CICS-ABEND      TO TRUE                        03650001
026700         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        03660001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
027100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03690001
027300         PERFORM DP013-0000-PROCESS-ABEND                         03700001
027400     END-IF.                                                      03710001
027500/                                                                 03720001
027600 1000-CONTROL-PROCESSING.                                         03730001
027800     EVALUATE TRUE                                                03740001
027900         WHEN DP020-NEXT-ACT-INITIAL                              03750001
028000             INITIALIZE ASC-SPECIFIC-COMMAREA                     03760001
028100             MOVE DP020-LOCATION TO PV-DP020-LOCATION             03770001
028200             IF  PV-DP020-LOCATION = PC-CORPORATE-OFFICE          03780001
028300                 MOVE SPACES     TO ASC-OPER-UNT-ID               03790001
028400                                    ASC-FCLTY-ID                  03800001
028500                                    ASC-FCLTY-NME                 03810001
028600             ELSE                                                 03820001
028700                 MOVE PV-LOCATION                                 03830001
028800                                 TO ASC-OPER-UNT-ID               03840001
028900                 MOVE 0001       TO ASC-FCLTY-ID                  03850001
029000             END-IF                                               03860001
029100             PERFORM 4000-BUILD-INITIAL-PANEL                     03870001
029200                                                                  03880001
029300         WHEN DP020-NEXT-ACT-READ-MAP                             03890001
029400             PERFORM 2000-FKEY-PROCESSING                         03900001
029500                                                                  03910001
029600         WHEN DP020-NEXT-ACT-RETURN                               03920001
029700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03930001
029800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03940001
029900                                                                  03950001
030000         WHEN OTHER                                               03960001
030100             SET DP013-LOGIC-ABEND                                03970001
030200                 DP013-NO-ROLLBACK TO TRUE                        03980001
030300             MOVE '1000-CONTROL-PROCESSING' TO  DP013-PARAGRAPH   03990001
030500             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04000001
030600                                   TO  DP013-MESSAGE-TEXT(1)      04010001
030700             MOVE DP020-NEXT-APPL-ACTIVITY                        04020001
030800                                   TO DP013-MESSAGE-TEXT(2)       04030001
030900             PERFORM DP013-0000-PROCESS-ABEND                     04040001
031000     END-EVALUATE.                                                04050001
031100/                                                                 04060001
031200 2000-FKEY-PROCESSING.                                            04070001
031400     EVALUATE TRUE                                                04080001
031600         WHEN DP020-SRC-AID = DP016-CLEAR                         04090001
031700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04100001
031800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04110001
031900                                                                  04120001
032000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04130001
032100             INITIALIZE ASC-SPECIFIC-COMMAREA                     04140001
032200             PERFORM 4000-BUILD-INITIAL-PANEL                     04150001
032300             PERFORM 3200-RESET-ATTRIBUTES                        04160001
032400                                                                  04170001
032500         WHEN OTHER                                               04180001
032600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04190001
032700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04200001
032800             IF  PS-NO-ERROR                                      04210001
032900                 SET DP030-CONTINUE-GO TO TRUE                    04220001
033000                 PERFORM 2100-CHECK-FUNCTION-KEY                  04230001
033100             ELSE                                                 04240001
033200                 SET DP030-OVERRIDE-GO TO TRUE                    04250001
033300             END-IF                                               04260001
033400     END-EVALUATE.                                                04270001
033500/                                                                 04280001
033600 2100-CHECK-FUNCTION-KEY.                                         04290001
033700     EVALUATE TRUE                                                04300001
033800         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               04310001
033801         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               04320001
033802         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               04330001
033900             PERFORM 2110-PREPARE-INTER-APPL-COMM                 04360001
034000                                                                  04370001
034100         WHEN DP020-SRC-AID = DP016-ENTER                         04380001
034200             CONTINUE                                             04390001
034300                                                                  04400001
034400         WHEN OTHER                                               04410001
034500             SET DP013-NO-ROLLBACK                                04420001
034600                 DP013-XCTL-DISPLAY-RESTART                       04430001
034700                 DP013-CICS-ABEND  TO TRUE                        04440001
034800             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    04450001
035000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04460001
035100                                   TO DP013-MESSAGE-TEXT (1)      04470001
035200             PERFORM DP013-0000-PROCESS-ABEND                     04480001
035300     END-EVALUATE.                                                04490001
035400/                                                                 04500001
035500 2110-PREPARE-INTER-APPL-COMM.                                    04510001
035501     EVALUATE TRUE                                                04520001
036204         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               04590001
036205         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               04600001
036206         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               04610001
036207             INITIALIZE TM006-INTER-APPL-COMMAREA                 04620001
036208             IF  ASC-OPER-UNT-ID = SPACES                         04630001
036209                 MOVE ZEROS           TO TM006-OPER-UNT-ID        04640001
036210             ELSE                                                 04650001
036211                 MOVE ASC-OPER-UNT-ID TO TM006-OPER-UNT-ID        04660001
036212             END-IF                                               04670001
036213             MOVE ASC-FCLTY-ID    TO TM006-FCLTY-ID               04680001
036214             MOVE ASC-FCLTY-NME   TO TM006-FCLTY-NME              04690001
036215             MOVE ASC-FCLTY-SHORT-NME TO TM006-FCLTY-SHORT-NME    04700001
036216             MOVE ASC-DEPT        TO TM006-DEPT                   04710001
036217             MOVE ASC-BUYER       TO TM006-BUYER                  04720001
036218             MOVE ASC-PO-NBR      TO TM006-PO-NBR                 04730001
036219             MOVE ASC-OTB         TO TM006-OTB                            
036220             MOVE ASC-FOB-CDE     TO TM006-FOB-CDE                        
036221             MOVE ASC-POE-CDE     TO TM006-POE-CDE                        
036222             MOVE ASC-ALL-TRBL    TO TM006-ALL-TRBL                       
036223             IF ASC-LS-PO = PC-S                                          
036224                 SET TM006-LS-PO       TO TRUE                    04760001
036225             END-IF                                               04770001
036226             IF ASC-LS-OLD-NEW-TRBL = PC-S                        04780001
036227                 SET TM006-LS-OLDEST-TRBL TO TRUE                 04790001
036228             END-IF                                               04800001
036229***  BUYER, ANALYST AND DC IS THE DEFAULT FOR RESPOSIBILITY AREA  04810092
036230             SET TM006-RA-BUY-ANALYST-DC-SW TO TRUE               04820092
036231             MOVE PC-B TO TM006-RA-BUYER                          04830092
036232             MOVE PC-A TO TM006-RA-ANALYST                        04840092
036233             MOVE PC-D TO TM006-RA-DC                             04850092
036234             IF ASC-RA-BUYER-ANALYST = PC-S                       04860092
036235                 SET TM006-RA-BUY-ANALYST-SW TO TRUE              04870092
036236                 MOVE PC-B TO TM006-RA-BUYER                      04880092
036237                 MOVE PC-A TO TM006-RA-ANALYST                    04890092
036238                 MOVE SPACE TO TM006-RA-DC                        04900092
036239             END-IF                                               04910092
036240             IF ASC-RA-DC = PC-S                                  04920092
036241                 SET TM006-RA-DC-SW TO TRUE                       04930092
036242                 MOVE SPACE TO TM006-RA-BUYER                     04940092
036243                 MOVE SPACE TO TM006-RA-ANALYST                   04950092
036244                 MOVE PC-D TO TM006-RA-DC                         04960092
036245             END-IF                                               04970092
038400****    THE DEFAULT FOR NOTIF. STATUS IS ALL                      04980001
038410****    DEPENDS ON F KEY PRESSED                                  04990001
038500             EVALUATE TRUE                                        05000001
038501                 WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)       05010001
038502****************     RESOLVED TROUBLE, NOT ACKNOWLEDGED           05020001
038503                     SET TM006-RESOLVD-STAT-ONLY TO TRUE          05030001
039700                     MOVE PC-R TO TM006-STAT-RSLVD                05040001
039701                 WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)       05050001
039702****************     UNRESOLVED TROUBLE                           05060001
039703                     SET TM006-UNRSLVD-STAT-ONLY TO TRUE          05070001
039704                     MOVE PC-N TO TM006-STAT-NEW                  05080001
039705                     MOVE PC-I TO TM006-STAT-IN-PRC               05090001
039706                 WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)       05100001
039707****************     ALL RESOLVED AND UNRESOLVED TROUBLE          05110001
039708                     SET TM006-ALL-NOTIF-STATS TO TRUE            05120001
039709                     MOVE PC-R TO TM006-STAT-RSLVD                05130001
039710                     MOVE PC-A TO TM006-STAT-ACKNW                05140001
039711                     MOVE PC-N TO TM006-STAT-NEW                  05150001
039712                     MOVE PC-I TO TM006-STAT-IN-PRC               05160001
039713             END-EVALUATE                                         05170001
039714             IF ASC-TRBL-REASON = SPACES                                  
039715                 MOVE PC-ALL TO ASC-TRBL-REASON                           
039716             END-IF                                                       
039904             MOVE ASC-TRBL-REASON   TO TM006-TRBL-REASON          05260001
039905             MOVE ASC-TRBL-RSN-DESC TO TM006-TRBL-RSN-DESC        05270001
040003     END-EVALUATE.                                                05350001
040800/                                                                 05360001
040900 2200-MOVE-SCREEN-TO-COMMAREA.                                    05370001
041000                                                                          
057000     IF  AFOBL    > ZERO                                          05380001
057100         MOVE AFOBI      TO ASC-FOB-CDE                           05390001
057200     ELSE                                                         05400001
057300         IF  AFOBF   = DP015-ERASE-EOF                            05410001
057400             MOVE SPACE  TO ASC-FOB-CDE                           05420001
057500         END-IF                                                   05430001
057600     END-IF.                                                      05440001
057700                                                                  05450001
057701     IF  APOEL    > ZERO                                          05380001
057702         MOVE APOEI      TO ASC-POE-CDE                           05390001
057703     ELSE                                                         05400001
057704         IF  APOEF   = DP015-ERASE-EOF                            05410001
057705             MOVE SPACE  TO ASC-POE-CDE                           05420001
057706         END-IF                                                   05430001
057707     END-IF.                                                      05440001
057708                                                                  05450001
057709     IF  AOTBL    > ZERO                                          05380001
057710         MOVE AOTBI      TO ASC-OTB                               05390001
057711     ELSE                                                         05400001
057712         IF  AOTBF   = DP015-ERASE-EOF                            05410001
057713             MOVE SPACE  TO ASC-OTB                               05420001
057714         END-IF                                                   05430001
057715     END-IF.                                                      05440001
057724                                                                  05450001
057725     IF  ADEPTL  > ZERO                                           05460001
057726         MOVE ADEPTI    TO ASC-DEPT                               05470001
057727     ELSE                                                         05480001
057728         IF  ADEPTF  = DP015-ERASE-EOF                            05490001
057729             MOVE SPACE  TO ASC-DEPT                              05500001
057730         END-IF                                                   05510001
057731     END-IF.                                                      05520001
057732                                                                          
057733     IF  APONBRL > ZERO                                           05620001
057734         MOVE APONBRI    TO ASC-PO-NBR                            05630001
057735     ELSE                                                         05640001
057736         IF  APONBRF = DP015-ERASE-EOF                            05650001
057737             MOVE SPACE  TO ASC-PO-NBR                            05660001
057738         END-IF                                                   05670001
057739     END-IF.                                                      05680001
057740                                                                  05690001
057750     IF  ABUYERL > ZERO                                           05540001
057751         MOVE ABUYERI   TO ASC-BUYER                              05550001
057752     ELSE                                                         05560001
057753         IF  ABUYERF = DP015-ERASE-EOF                            05570001
057754             MOVE SPACE  TO ASC-BUYER                             05580001
057755         END-IF                                                   05590001
057756     END-IF.                                                      05600001
057781                                                                  05610001
057783     IF  AOPUNITL > ZERO                                          05380001
057784         MOVE AOPUNITI   TO ASC-OPER-UNT-ID                       05390001
057785     ELSE                                                         05400001
057786         IF  AOPUNITF = DP015-ERASE-EOF                           05410001
057787             MOVE SPACE  TO ASC-OPER-UNT-ID                       05420001
057788         END-IF                                                   05430001
057789     END-IF.                                                      05440001
057790                                                                  05450001
057791     IF  AALLTRBL > ZERO                                          05380001
057792         MOVE AALLTRBI   TO ASC-ALL-TRBL                          05390001
057793     ELSE                                                         05400001
057794         IF  AALLTRBF = DP015-ERASE-EOF                           05410001
057795             MOVE SPACE  TO ASC-ALL-TRBL                          05420001
057796         END-IF                                                   05430001
057797     END-IF.                                                      05440001
057798                                                                  05450001
057799     IF  ASEQTRL > ZERO                                           05780001
057801         MOVE ASEQTRI   TO ASC-LS-OLD-NEW-TRBL                    05790001
057802     ELSE                                                         05800001
057803         IF  ASEQTRF = DP015-ERASE-EOF                            05810001
057805             MOVE SPACE  TO ASC-LS-OLD-NEW-TRBL                   05820001
057806         END-IF                                                   05830001
057807     END-IF.                                                      05840001
057808                                                                  05850001
057809     IF  ASEQPOL > ZERO                                           05860001
057810         MOVE ASEQPOI   TO ASC-LS-PO                              05870001
057812     ELSE                                                         05880001
057813         IF  ASEQPOF = DP015-ERASE-EOF                            05890001
057814             MOVE SPACE  TO ASC-LS-PO                             05900001
057816         END-IF                                                   05910001
057817     END-IF.                                                      05920001
057818                                                                  05930001
057848     IF  ATRBRSNL > ZERO                                          06270001
057849         MOVE ATRBRSNI  TO ASC-TRBL-REASON                        06280001
057850     ELSE                                                         06290001
057851         IF  ATRBRSNF = DP015-ERASE-EOF                           06300001
057852             MOVE SPACE  TO ASC-TRBL-REASON                       06310001
057853         END-IF                                                   06320001
057860     END-IF.                                                      06330001
057900                                                                  06340001
062600 3000-EDIT-DATA-IN-COMMAREA.                                      06350001
062700     PERFORM 3200-RESET-ATTRIBUTES.                               06360001
062710     PERFORM 3010-INITIAL-EDITS.                                  06370001
062800                                                                  06380001
062801     IF PS-NO-ERROR                                               06390001
062802         PERFORM 3100-REMAINING-EDITS                             06400001
062803     END-IF.                                                      06410001
176300                                                                  06420001
194500     IF  PS-NO-ERROR                                              06430001
194600         MOVE -1                   TO AFOBL                       06440001
194700         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06450001
194900     END-IF.                                                      06460001
195000                                                                  06470001
195001*****************************************************************         
195002*  PROCESS THE INITIAL EDITS.                                   *         
195004*****************************************************************         
195005 3010-INITIAL-EDITS.                                              06480001
195010                                                                  06570001
195012     PERFORM 3015-CHK-LIST-SEQ.                                   06510001
195013     PERFORM 3055-CHK-ALL-TRBL.                                           
195016     PERFORM 3025-CHK-BUYER-NBR.                                  06540001
195017     PERFORM 3030-CHK-PO-NBR.                                     06530001
195019     PERFORM 3035-CHK-DEPT-NBR.                                   06550001
195020     PERFORM 3040-CHK-OTB.                                                
195021     PERFORM 3045-CHK-POE.                                                
195022     PERFORM 3050-CHK-FOB.                                                
195023                                                                  06570001
195076***************************************************************** 07530001
195077*  CHECK LIST SEQUENCE                                          *         
195078*  SEQUENCE MUST BE SELECTED FOR F20, F21, AND F22              * 07540001
195080***************************************************************** 07530001
195119 3015-CHK-LIST-SEQ.                                               07520001
195120                                                                          
195125     IF (ASC-LS-OLD-NEW-TRBL = SPACES) AND                        07570092
195126        (ASC-LS-PO           = SPACES)                                    
195127         SET PS-ERROR                                             07580092
195128             DP020-MSG-FATAL TO TRUE                              07590092
195129             MOVE PC-TSYMSG-01739 TO DP020-MSG-NUMBER             07600092
195130             MOVE DP015-UNP-ALP-BRT-OFF TO ASEQTRA                07610092
195131                                           ASEQPOA                07620092
195132             MOVE DP015-RED TO ASEQTRC                            07630092
195133                               ASEQPOC                            07640092
195134             MOVE DP015-REVERSE TO ASEQTRH                        07650092
195135                                   ASEQPOH                        07660092
195136         MOVE -1                TO ASEQTRL                        07670092
195137         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      07680092
195138     END-IF                                                       07690092
195139     IF (ASC-LS-OLD-NEW-TRBL > SPACES)                            07700092
195140         IF ASC-LS-OLD-NEW-TRBL NOT = PC-S                        07710092
195141             SET PS-ERROR                                         07720092
195142                 DP020-MSG-FATAL TO TRUE                          07730092
195143             MOVE PC-TSYMSG-00397 TO DP020-MSG-NUMBER             07740092
195144             MOVE DP015-UNP-ALP-BRT-OFF TO ASEQTRA                07750092
195145             MOVE DP015-RED            TO ASEQTRC                 07760092
195146             MOVE DP015-REVERSE TO ASEQTRH                        07770092
195147             MOVE -1                   TO ASEQTRL                 07780092
195148             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07790092
195149         ELSE                                                     07800092
195150             IF ASC-LS-PO           > SPACES                      07810092
195151                 SET PS-ERROR                                     07820092
195152                     DP020-MSG-FATAL TO TRUE                      07830092
195153                 MOVE PC-TSYMSG-00973 TO DP020-MSG-NUMBER         07840092
195154                 MOVE DP015-UNP-ALP-BRT-OFF TO ASEQTRA            07850092
195155                                               ASEQPOA            07860092
195156                 MOVE DP015-RED TO ASEQTRC                        07870092
195157                                   ASEQPOC                        07880092
195158                 MOVE DP015-REVERSE TO ASEQTRH                    07890092
195159                                       ASEQPOH                    07900092
195160                 MOVE -1                TO ASEQTRL                07910092
195161                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07920092
195162             END-IF                                               07930092
195163         END-IF                                                   07940092
195164     END-IF                                                       07950092
195165                                                                  07960092
195166     IF (ASC-LS-PO > SPACES)                                      07970092
195167         IF ASC-LS-PO  NOT = PC-S                                 07980092
195168             SET PS-ERROR                                         07990092
195169                 DP020-MSG-FATAL TO TRUE                          08000092
195170             MOVE PC-TSYMSG-00397 TO DP020-MSG-NUMBER             08010092
195171             MOVE DP015-UNP-ALP-BRT-OFF TO ASEQPOA                08020092
195172             MOVE DP015-RED            TO ASEQPOC                 08030092
195173             MOVE DP015-REVERSE TO ASEQPOH                        08040092
195174             MOVE -1                   TO ASEQPOL                 08050092
195175             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08060092
195176         END-IF                                                   08070092
195177     END-IF.                                                      08080092
195178                                                                  08090092
195180     IF (ASC-LS-OLD-NEW-TRBL > SPACES)                            08100092
195181     OR (ASC-LS-PO           > SPACES)                            08110092
195182         SET PS-LIST-SEQ-ENTERED TO TRUE                          08120092
195183     END-IF.                                                      08130092
195271                                                                  08440001
195301***************************************************************** 07530001
195302*  CHECK FOR NUMERIC BUYER NUMBER.                              *         
195304***************************************************************** 07530001
195305 3025-CHK-BUYER-NBR.                                              08760001
195306                                                                          
195307     IF (ASC-BUYER     > SPACES)                                  08780001
195308         MOVE ASC-BUYER                TO DP010I-UNEDITED-FIELD   08790001
195309         MOVE LENGTH OF ASC-BUYER                                 08800001
195310                               TO DP010I-MAXIMUM-DIGITS           08810001
195311         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08820001
195312         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08830001
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
195314         IF DP010I-ERROR-DETECTED                                 08850001
195315             SET PS-ERROR                                         08860001
195316                 DP020-MSG-FATAL TO TRUE                          08870001
195317             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             08880001
195318             MOVE DP015-UNP-ALP-BRT-OFF TO ABUYERA                08890001
195319             MOVE DP015-RED TO ABUYERC                            08900001
195320             MOVE DP015-REVERSE TO ABUYERH                        08910001
195321             MOVE -1               TO ABUYERL                     08920001
195322             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08930001
195323         ELSE                                                     08940001
195324             MOVE DP010I-NUMERIC-FIELD TO ASC-BUYER-N             08950001
195325                                          DK-BUYER-NBR-N          08960001
195326             SET PS-BUYER-NBR-ENTERED TO TRUE                     08970001
195327         END-IF                                                   08980001
195328     END-IF.                                                      08990001
195329                                                                  09000001
195330                                                                  08440001
195331***************************************************************** 07530001
195332*  CHECK FOR NUMERIC PURCHASE ORDER NUMBER.                     *         
195333***************************************************************** 07530001
195334 3030-CHK-PO-NBR.                                                 08450001
195335                                                                  08460001
195336     IF (ASC-PO-NBR > SPACES)                                     08470001
195342         MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD       08480001
195343         MOVE LENGTH OF ASC-PO-NBR                                08490001
195344                               TO DP010I-MAXIMUM-DIGITS           08500001
195345         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08510001
195346         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08520001
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
195348         IF DP010I-ERROR-DETECTED                                 08540001
195349             SET PS-ERROR                                         08550001
195350                 DP020-MSG-FATAL TO TRUE                          08560001
195351             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             08570001
195352             MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA                08580001
195353             MOVE DP015-RED TO APONBRC                            08590001
195354             MOVE DP015-REVERSE TO APONBRH                        08600001
195355             MOVE -1               TO APONBRL                     08610001
195356             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08620001
195357         ELSE                                                     08630001
195358             MOVE DP010I-NUMERIC-FIELD TO ASC-PO-NBR-N            08640001
195359             MOVE ASC-PO-NBR-N TO DK-PO-NBR                       08650001
195360             SET PS-PO-NBR-ENTERED TO TRUE                        08660001
195361     END-IF.                                                      08730001
195370                                                                  08740001
195375                                                                  08750001
195376***************************************************************** 07530001
195377*  CHECK FOR NUMERIC DEPARTMENT NUMBER.                         *         
195378***************************************************************** 07530001
195379 3035-CHK-DEPT-NBR.                                               09010001
195380                                                                  09020001
195381     IF (ASC-DEPT > SPACES)                                       09030001
195382         MOVE ASC-DEPT             TO DP010I-UNEDITED-FIELD       09040001
195383         MOVE LENGTH OF ASC-DEPT TO DP010I-MAXIMUM-DIGITS         09050001
195384         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     09060001
195385         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09070001
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
195387         IF DP010I-ERROR-DETECTED                                 09090001
195388             SET PS-ERROR                                         09100001
195389                 DP020-MSG-FATAL TO TRUE                          09110001
195390             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             09120001
195391             MOVE DP015-UNP-ALP-BRT-OFF TO ADEPTA                 09130001
195392             MOVE DP015-RED TO ADEPTC                             09140001
195393             MOVE DP015-REVERSE TO ADEPTH                         09150001
195394             MOVE -1               TO ADEPTL                      09160001
195395             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09170001
195396         ELSE                                                     09180001
195397             MOVE DP010I-NUMERIC-FIELD TO ASC-DEPT-N              09190001
195398                                          DK-DEPT-NBR-N           09200001
195399             SET PS-DEPT-NBR-ENTERED TO TRUE                      09210001
195400         END-IF                                                   09220001
195401     END-IF.                                                      09230001
195402                                                                  09240001
195403***************************************************************** 07530001
195404*  CHECK FOR NUMERIC OTB.                                       *         
195405***************************************************************** 07530001
195406 3040-CHK-OTB.                                                    09010001
195407                                                                  09020001
195408     IF (ASC-OTB  > SPACES)                                       09030001
195409         MOVE ASC-OTB              TO DP010I-UNEDITED-FIELD       09040001
195410         MOVE LENGTH OF ASC-OTB  TO DP010I-MAXIMUM-DIGITS         09050001
195411         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     09060001
195412         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09070001
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
195414         IF DP010I-ERROR-DETECTED                                 09090001
195415             SET PS-ERROR                                         09100001
195416                 DP020-MSG-FATAL TO TRUE                          09110001
195417             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             09120001
195418             MOVE DP015-UNP-ALP-BRT-OFF TO AOTBA                  09130001
195419             MOVE DP015-RED TO AOTBC                              09140001
195420             MOVE DP015-REVERSE TO AOTBH                          09150001
195421             MOVE -1               TO AOTBL                       09160001
195422             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09170001
195423         ELSE                                                     09180001
195424             MOVE DP010I-NUMERIC-FIELD TO ASC-OTB-N               09190001
195425             SET PS-OTB-ENTERED TO TRUE                           09210001
195426         END-IF                                                   09220001
195427     END-IF.                                                      09230001
195428                                                                  09240001
195449***************************************************************** 07530001
195450*  CHECK FOR POE CODE.                                          *         
195451***************************************************************** 07530001
195452 3045-CHK-POE.                                                            
195453                                                                  09020001
195454     IF (ASC-POE-CDE > SPACES)                                    09030001
195455         MOVE ASC-POE-CDE TO DK-POE-CDE                           09200001
195456         SET PS-POE-CDE-ENTERED TO TRUE                           09210001
195457     END-IF.                                                      09230001
195458                                                                  09240001
195459***************************************************************** 07530001
195460*  CHECK FOR FOB CODE.                                          *         
195461***************************************************************** 07530001
195462 3050-CHK-FOB.                                                            
195463                                                                  09020001
195464     IF (ASC-FOB-CDE > SPACES)                                    09030001
195465         MOVE ASC-FOB-CDE TO DK-FOB-CDE                           09200001
195466         SET PS-FOB-CDE-ENTERED TO TRUE                           09210001
195467     END-IF.                                                      09230001
195468                                                                  09240001
195469***************************************************************** 07530001
195470*  CHECK TO SEE IF ALL TROUBLE WAS SELECTED.                    *         
195471***************************************************************** 07530001
195472 3055-CHK-ALL-TRBL.                                                       
195473                                                                  09020001
195474     IF (ASC-ALL-TRBL > SPACES)                                   09030001
195476         SET PS-ALL-TRBL-ENTERED TO TRUE                          09210001
195477     END-IF.                                                      09230001
195478                                                                  09240001
195479*****************************************************************         
195480*  ADDITIONAL EDITS FOR RELATIONSHIPS BETWEEN FIELDS AND        *         
195481*  VALIDATION OF ENTERED FIELDS.                                *         
195482*****************************************************************         
195483 3100-REMAINING-EDITS.                                            09540001
195484                                                                  09570001
195485     PERFORM 3105-CHECK-IF-FIELD-ENTERED.                         09580001
195486                                                                  09590001
195487     IF PS-ERROR                                                          
195488         CONTINUE                                                         
195489     ELSE                                                                 
195490         EVALUATE TRUE                                                    
195491             WHEN PS-FOB-CDE-ENTERED                                      
195492                 PERFORM 3120-VALIDATE-FOB                                
195493             WHEN PS-POE-CDE-ENTERED                                      
195495                 PERFORM 3125-OPEN-POE-CURSOR                             
195496                 PERFORM 3127-FETCH-POE-CURSOR                            
195497                 PERFORM 3126-CLOSE-POE-CURSOR                            
195498             WHEN PS-DEPT-NBR-ENTERED                                     
195499                 PERFORM 3130-VALIDATE-DEPT-NBR                           
195500             WHEN PS-PO-NBR-ENTERED                                       
195501                 PERFORM 3132-VALIDATE-PO-NBR                             
195502             WHEN PS-BUYER-NBR-ENTERED                                    
195503                 PERFORM 3135-VALIDATE-BUYER-NBR                          
195504         END-EVALUATE                                                     
195505                                                                          
195506         EVALUATE TRUE                                                    
195507             WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                  
195508             WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                  
195509                 PERFORM 3140-CHK2-LIST-SEQ                               
195510             WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                  
195511                 PERFORM 3140-CHK2-LIST-SEQ                               
195512             WHEN OTHER                                                   
195513                 CONTINUE                                                 
195514         END-EVALUATE                                                     
195520     END-IF.                                                              
195600                                                                          
221409*****************************************************************         
221410*  CHECK TO SEE IF FIELD WAS ENTERED.                           *         
221412*****************************************************************         
221413 3105-CHECK-IF-FIELD-ENTERED.                                             
221414                                                                          
221415     EVALUATE TRUE                                                        
221416** CHECK IF FIELDS ARE BLANK                                              
221417         WHEN ASC-FOB-CDE      = SPACES  AND                              
221418              ASC-POE-CDE      = SPACES  AND                              
221419              ASC-OTB          = SPACES  AND                              
221420              ASC-DEPT         = SPACES  AND                              
221421              ASC-PO-NBR       = SPACES  AND                              
221424              ASC-BUYER        = SPACES  AND                              
221425              ASC-ALL-TRBL     = SPACES                                   
221430             PERFORM 3110-MSG-1698-ERROR                                  
221452                                                                          
221453         WHEN ASC-FOB-CDE      > SPACES  AND                              
221454              ASC-POE-CDE      > SPACES  AND                              
221455              ASC-OTB          > SPACES  AND                              
221456              ASC-DEPT         > SPACES  AND                              
221457              ASC-PO-NBR       > SPACES  AND                              
221458              ASC-BUYER        > SPACES  AND                              
221459              ASC-ALL-TRBL     > SPACES                                   
221462             PERFORM 3115-MSG-1693-ERROR                                  
221463                                                                          
221464         WHEN ASC-FOB-CDE      > SPACES  AND                              
221470              ASC-POE-CDE      > SPACES  AND                              
221480              ASC-OTB          > SPACES  AND                              
221481              ASC-DEPT         > SPACES  AND                              
221482              ASC-PO-NBR       > SPACES  AND                              
221483              ASC-BUYER        > SPACES  AND                              
221484              ASC-ALL-TRBL     = SPACES                                   
221485             PERFORM 3115-MSG-1693-ERROR                                  
221486                                                                          
221487         WHEN ASC-FOB-CDE      > SPACES  AND                              
221488              ASC-POE-CDE      > SPACES  AND                              
221489              ASC-OTB          > SPACES  AND                              
221490              ASC-DEPT         > SPACES  AND                              
221491              ASC-PO-NBR       > SPACES  AND                              
221492              ASC-BUYER        = SPACES  AND                              
221493              ASC-ALL-TRBL     = SPACES                                   
221494             PERFORM 3115-MSG-1693-ERROR                                  
221495                                                                          
221496         WHEN ASC-FOB-CDE      > SPACES  AND                              
221497              ASC-POE-CDE      > SPACES  AND                              
221498              ASC-OTB          > SPACES  AND                              
221499              ASC-DEPT         > SPACES  AND                              
221500              ASC-PO-NBR       = SPACES  AND                              
221501              ASC-BUYER        = SPACES  AND                              
221502              ASC-ALL-TRBL     = SPACES                                   
221503             PERFORM 3115-MSG-1693-ERROR                                  
221504                                                                          
221505         WHEN ASC-FOB-CDE      > SPACES  AND                              
221506              ASC-POE-CDE      > SPACES  AND                              
221507              ASC-OTB          > SPACES  AND                              
221508              ASC-DEPT         = SPACES  AND                              
221509              ASC-PO-NBR       = SPACES  AND                              
221510              ASC-BUYER        = SPACES  AND                              
221511              ASC-ALL-TRBL     = SPACES                                   
221512             PERFORM 3115-MSG-1693-ERROR                                  
221513                                                                          
221514         WHEN ASC-FOB-CDE      > SPACES  AND                              
221515              ASC-POE-CDE      > SPACES  AND                              
221516              ASC-OTB          = SPACES  AND                              
221517              ASC-DEPT         = SPACES  AND                              
221518              ASC-PO-NBR       = SPACES  AND                              
221519              ASC-BUYER        = SPACES  AND                              
221520              ASC-ALL-TRBL     = SPACES                                   
221521             PERFORM 3115-MSG-1693-ERROR                                  
221522                                                                          
221523         WHEN ASC-FOB-CDE      = SPACES  AND                              
221524              ASC-POE-CDE      > SPACES  AND                              
221525              ASC-OTB          > SPACES  AND                              
221526              ASC-DEPT         > SPACES  AND                              
221527              ASC-PO-NBR       > SPACES  AND                              
221528              ASC-BUYER        > SPACES  AND                              
221529              ASC-ALL-TRBL     > SPACES                                   
221530             PERFORM 3115-MSG-1693-ERROR                                  
221531                                                                          
221532         WHEN ASC-FOB-CDE      = SPACES  AND                              
221533              ASC-POE-CDE      = SPACES  AND                              
221534              ASC-OTB          > SPACES  AND                              
221535              ASC-DEPT         > SPACES  AND                              
221536              ASC-PO-NBR       > SPACES  AND                              
221537              ASC-BUYER        > SPACES  AND                              
221538              ASC-ALL-TRBL     > SPACES                                   
221539             PERFORM 3115-MSG-1693-ERROR                                  
221540                                                                          
221541         WHEN ASC-FOB-CDE      = SPACES  AND                              
221542              ASC-POE-CDE      = SPACES  AND                              
221543              ASC-OTB          = SPACES  AND                              
221544              ASC-DEPT         > SPACES  AND                              
221545              ASC-PO-NBR       > SPACES  AND                              
221546              ASC-BUYER        > SPACES  AND                              
221547              ASC-ALL-TRBL     > SPACES                                   
221548             PERFORM 3115-MSG-1693-ERROR                                  
221549                                                                          
221550         WHEN ASC-FOB-CDE      = SPACES  AND                              
221551              ASC-POE-CDE      = SPACES  AND                              
221552              ASC-OTB          = SPACES  AND                              
221553              ASC-DEPT         = SPACES  AND                              
221554              ASC-PO-NBR       > SPACES  AND                              
221555              ASC-BUYER        > SPACES  AND                              
221556              ASC-ALL-TRBL     > SPACES                                   
221557             PERFORM 3115-MSG-1693-ERROR                                  
221558                                                                          
221559         WHEN ASC-FOB-CDE      = SPACES  AND                              
221560              ASC-POE-CDE      = SPACES  AND                              
221561              ASC-OTB          = SPACES  AND                              
221562              ASC-DEPT         = SPACES  AND                              
221563              ASC-PO-NBR       = SPACES  AND                              
221564              ASC-BUYER        > SPACES  AND                              
221565              ASC-ALL-TRBL     > SPACES                                   
221566             PERFORM 3115-MSG-1693-ERROR                                  
221567                                                                          
221568         WHEN ASC-FOB-CDE      = SPACES  AND                              
221569              ASC-POE-CDE      = SPACES  AND                              
221570              ASC-OTB          = SPACES  AND                              
221571              ASC-DEPT         = SPACES  AND                              
221572              ASC-PO-NBR       > SPACES  AND                              
221573              ASC-BUYER        = SPACES  AND                              
221574              ASC-ALL-TRBL     > SPACES                                   
221575             PERFORM 3115-MSG-1693-ERROR                                  
221576                                                                          
221577         WHEN ASC-FOB-CDE      = SPACES  AND                              
221578              ASC-POE-CDE      > SPACES  AND                              
221579              ASC-OTB          > SPACES  AND                              
221580              ASC-DEPT         > SPACES  AND                              
221581              ASC-PO-NBR       > SPACES  AND                              
221582              ASC-BUYER        > SPACES  AND                              
221583              ASC-ALL-TRBL     = SPACES                                   
221584             PERFORM 3115-MSG-1693-ERROR                                  
221585                                                                          
221586         WHEN ASC-FOB-CDE      = SPACES  AND                              
221587              ASC-POE-CDE      > SPACES  AND                              
221588              ASC-OTB          > SPACES  AND                              
221589              ASC-DEPT         > SPACES  AND                              
221590              ASC-PO-NBR       > SPACES  AND                              
221591              ASC-BUYER        = SPACES  AND                              
221592              ASC-ALL-TRBL     = SPACES                                   
221593             PERFORM 3115-MSG-1693-ERROR                                  
221594                                                                          
221595         WHEN ASC-FOB-CDE      = SPACES  AND                              
221596              ASC-POE-CDE      > SPACES  AND                              
221597              ASC-OTB          > SPACES  AND                              
221598              ASC-DEPT         > SPACES  AND                              
221599              ASC-PO-NBR       = SPACES  AND                              
221600              ASC-BUYER        = SPACES  AND                              
221601              ASC-ALL-TRBL     = SPACES                                   
221602             PERFORM 3115-MSG-1693-ERROR                                  
221603                                                                          
221604         WHEN ASC-FOB-CDE      = SPACES  AND                              
221605              ASC-POE-CDE      > SPACES  AND                              
221606              ASC-OTB          > SPACES  AND                              
221607              ASC-DEPT         = SPACES  AND                              
221608              ASC-PO-NBR       = SPACES  AND                              
221609              ASC-BUYER        = SPACES  AND                              
221610              ASC-ALL-TRBL     = SPACES                                   
221611             PERFORM 3115-MSG-1693-ERROR                                  
221612                                                                          
221613         WHEN ASC-FOB-CDE      = SPACES  AND                              
221614              ASC-POE-CDE      = SPACES  AND                              
221615              ASC-OTB          > SPACES  AND                              
221616              ASC-DEPT         > SPACES  AND                              
221617              ASC-PO-NBR       > SPACES  AND                              
221618              ASC-BUYER        > SPACES  AND                              
221619              ASC-ALL-TRBL     = SPACES                                   
221620                                                                          
221621         WHEN ASC-FOB-CDE      = SPACES  AND                              
221622              ASC-POE-CDE      = SPACES  AND                              
221623              ASC-OTB          > SPACES  AND                              
221624              ASC-DEPT         > SPACES  AND                              
221625              ASC-PO-NBR       > SPACES  AND                              
221626              ASC-BUYER        = SPACES  AND                              
221627              ASC-ALL-TRBL     = SPACES                                   
221628                                                                          
221629         WHEN ASC-FOB-CDE      = SPACES  AND                              
221630              ASC-POE-CDE      = SPACES  AND                              
221631              ASC-OTB          > SPACES  AND                              
221632              ASC-DEPT         > SPACES  AND                              
221633              ASC-PO-NBR       = SPACES  AND                              
221634              ASC-BUYER        = SPACES  AND                              
221635              ASC-ALL-TRBL     = SPACES                                   
221636             PERFORM 3115-MSG-1693-ERROR                                  
221637                                                                          
221638         WHEN ASC-FOB-CDE      = SPACES  AND                              
221639              ASC-POE-CDE      = SPACES  AND                              
221640              ASC-OTB          = SPACES  AND                              
221641              ASC-DEPT         > SPACES  AND                              
221642              ASC-PO-NBR       > SPACES  AND                              
221643              ASC-BUYER        = SPACES  AND                              
221644              ASC-ALL-TRBL     = SPACES                                   
221645             PERFORM 3115-MSG-1693-ERROR                                  
221646                                                                          
221647         WHEN ASC-FOB-CDE      = SPACES  AND                              
221648              ASC-POE-CDE      = SPACES  AND                              
221649              ASC-OTB          = SPACES  AND                              
221650              ASC-DEPT         > SPACES  AND                              
221651              ASC-PO-NBR       = SPACES  AND                              
221652              ASC-BUYER        = SPACES  AND                              
221653              ASC-ALL-TRBL     > SPACES                                   
221654             PERFORM 3115-MSG-1693-ERROR                                  
221655                                                                          
221656         WHEN ASC-FOB-CDE      = SPACES  AND                              
221657              ASC-POE-CDE      = SPACES  AND                              
221658              ASC-OTB          > SPACES  AND                              
221659              ASC-DEPT         = SPACES  AND                              
221660              ASC-PO-NBR       = SPACES  AND                              
221661              ASC-BUYER        = SPACES  AND                              
221662              ASC-ALL-TRBL     > SPACES                                   
221663             PERFORM 3115-MSG-1693-ERROR                                  
221664                                                                          
221665         WHEN ASC-FOB-CDE      > SPACES  AND                              
221666              ASC-POE-CDE      = SPACES  AND                              
221667              ASC-OTB          = SPACES  AND                              
221668              ASC-DEPT         = SPACES  AND                              
221669              ASC-PO-NBR       = SPACES  AND                              
221670              ASC-BUYER        = SPACES  AND                              
221671              ASC-ALL-TRBL     > SPACES                                   
221672             PERFORM 3115-MSG-1693-ERROR                                  
221673                                                                          
221674         WHEN ASC-FOB-CDE      = SPACES  AND                              
221675              ASC-POE-CDE      > SPACES  AND                              
221676              ASC-OTB          = SPACES  AND                              
221677              ASC-DEPT         = SPACES  AND                              
221678              ASC-PO-NBR       = SPACES  AND                              
221679              ASC-BUYER        = SPACES  AND                              
221680              ASC-ALL-TRBL     > SPACES                                   
221681             PERFORM 3115-MSG-1693-ERROR                                  
221682     END-EVALUATE.                                                        
221683                                                                          
221684*****************************************************************         
221685*  ISSUE "ONE MUST BE SELECTED" ERROR MESSAGE.                  *         
221686*****************************************************************         
221687 3110-MSG-1698-ERROR.                                                     
221688     SET PS-ERROR                                                         
221689         DP020-MSG-FATAL TO TRUE.                                         
221690     MOVE PC-TSYMSG-01698 TO DP020-MSG-NUMBER.                            
221691     MOVE DP015-UNP-ALP-BRT-OFF  TO AFOBA                                 
221692                                    APOEA                                 
221693                                    AOTBA                                 
221694                                    ADEPTA                                
221695                                    APONBRA                               
221696                                    ABUYERA                               
221697                                    AALLTRBA.                             
221698     MOVE DP015-RED              TO AFOBC                                 
221699                                    APOEC                                 
221700                                    AOTBC                                 
221701                                    ADEPTC                                
221702                                    APONBRC                               
221703                                    ABUYERC                               
221704                                    AALLTRBC.                             
221705     MOVE DP015-REVERSE          TO AFOBH                                 
221706                                    APOEH                                 
221707                                    AOTBH                                 
221708                                    ADEPTH                                
221709                                    APONBRH                               
221710                                    ABUYERH                               
221711                                    AALLTRBH.                             
221712     MOVE -1                     TO AFOBL.                                
221713     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                                 
221714                                                                          
221715*****************************************************************         
221716*  ISSUE "ONLY ONE MAY BE ENTERED" ERROR MESSAGE.               *         
221717*****************************************************************         
221718 3115-MSG-1693-ERROR.                                                     
221719     SET PS-ERROR                                                         
221720         DP020-MSG-FATAL TO TRUE.                                         
221721     MOVE PC-TSYMSG-01693 TO DP020-MSG-NUMBER.                            
221722     MOVE DP015-UNP-ALP-BRT-OFF  TO AFOBA                                 
221723                                    APOEA                                 
221724                                    AOTBA                                 
221725                                    ADEPTA                                
221726                                    APONBRA                               
221727                                    ABUYERA                               
221728                                    AALLTRBA.                             
221729     MOVE DP015-RED              TO AFOBC                                 
221730                                    APOEC                                 
221731                                    AOTBC                                 
221732                                    ADEPTC                                
221733                                    APONBRC                               
221734                                    ABUYERC                               
221735                                    AALLTRBC.                             
221736     MOVE DP015-REVERSE          TO AFOBH                                 
221737                                    APOEH                                 
221738                                    AOTBH                                 
221739                                    ADEPTH                                
221740                                    APONBRH                               
221741                                    ABUYERH                               
221742                                    AALLTRBH.                             
221743     MOVE -1                     TO AFOBL.                                
221744     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                                 
221745                                                                          
221746*****************************************************************         
221747*  VALIDATE THE FOB CODE.                                       *         
221748*****************************************************************         
221749 3120-VALIDATE-FOB.                                               12280001
221750                                                                          
221751     PERFORM                                                      14430001
221752         WITH TEST AFTER                                          14440001
221753         VARYING PV-SQL-SUB FROM 1 BY 1                           14450001
221754         UNTIL   PV-SQL-SUB > PC-MAX-RETRIES  OR                  14470001
221755                 SQLCODE = +0                 OR                  14480001
221756                 SQLCODE = -811               OR                  14480001
221757                 SQLCODE = +100                                   14490001
221758                                                                  14500001
221759         EXEC SQL                                                         
221760             SELECT FOB_CDE                                               
221761              INTO :PV-FOB-CDE                                            
221762               FROM TIMFOB                                                
221763              WHERE FOB_CDE     =   :DK-FOB-CDE                           
221764                AND STAT_CDE    =   'A'                                   
221765         END-EXEC                                                         
221766                                                                          
221767         EVALUATE TRUE                                            14700001
221768             WHEN SQLCODE = +0                                    14760001
221769             WHEN SQLCODE = -811                                          
221770                 SET PS-VALID-FOB    TO TRUE                      14770001
221771                                                                          
221772             WHEN SQLCODE = +100                                          
221773                 SET PS-INVALID-FOB                                       
221774                     PS-ERROR                                             
221775                     DP020-MSG-FATAL TO TRUE                              
221776                 MOVE PC-TSYMSG-01451 TO DP020-MSG-NUMBER                 
221777                 MOVE DP015-UNP-ALP-BRT-OFF TO AFOBA                      
221778                 MOVE DP015-RED TO AFOBC                                  
221779                 MOVE DP015-REVERSE TO AFOBH                              
221780                 MOVE -1            TO AFOBL                              
221781                 SET DP030-SET-CURSOR-APPL-1 TO TRUE                      
221782                                                                          
221783             WHEN SQLCODE = -913                                          
221784                 CONTINUE                                                 
221785                                                                          
221786             WHEN SQLWARN0 NOT EQUAL SPACE                                
221787             WHEN SQLCODE NOT EQUAL ZERO                                  
221788                 MOVE '3120-VALIDATE-FOB'                         14810001
221789                                  TO DP013-PARAGRAPH              14820001
221790                 MOVE 'SELECT FOB CODE'                           14830001
221791                                  TO DP013-MESSAGE-TEXT (1)       14840001
221792                 MOVE SQLCA       TO DP013-SQLCA                  14850001
221793                 MOVE 'TIMFOB  '  TO DP013-DB2-TABLE-NAME (1)     14860001
221794                 SET DP013-DB2-ABEND                              14870001
221795                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14880001
221796                 PERFORM DP013-0000-PROCESS-ABEND                 14890001
221797         END-EVALUATE                                             14900001
221798     END-PERFORM.                                                 14910001
221799                                                                  14920001
221800     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES AND               14930001
221801         (SQLCODE NOT = ZERO    AND                                       
221802          SQLCODE NOT = -811    AND                                       
221803          SQLCODE NOT = +100)                                             
221804         MOVE '3120-VALIDATE-FOB'         TO DP013-PARAGRAPH      14940001
221805         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   14950001
221806                               TO  DP013-MESSAGE-TEXT (1)         14960001
221807         MOVE 'OF A FOB CODE          ' TO  DP013-MESSAGE-TEXT (2)14970001
221808         MOVE SQLCA            TO  DP013-SQLCA                    14980001
221809         MOVE 'TIMFOB  '       TO DP013-DB2-TABLE-NAME (1)        14990001
221810         SET DP013-DB2-ABEND                                      15000001
221811             DP013-XCTL-DISPLAY-RESTART TO TRUE                   15010001
221812         PERFORM DP013-0000-PROCESS-ABEND                         15020001
221813     END-IF.                                                      15030001
221814                                                                          
221815 EJECT                                                                    
221816                                                                  12420001
221888*----------------------------------------------------------------*        
221889*   OPEN THE POE CODE CURSOR                                     *        
221890*----------------------------------------------------------------*        
221891 3125-OPEN-POE-CURSOR.                                                    
221892                                                                          
221893     PERFORM                                                              
221894         WITH TEST AFTER                                                  
221895         VARYING PV-RETRY-COUNTER                                         
221896         FROM 1 BY 1                                                      
221897         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
221898                   OR (SQLCODE = ZERO))                                   
221899                                                                          
221900         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)            
221901                                                                          
221902         EXEC SQL                                                         
221903              OPEN POE-CSR                                                
221904         END-EXEC                                                         
221905                                                                          
221906         EVALUATE TRUE                                                    
221907             WHEN SQLCODE = ZERO                                          
221908             WHEN SQLCODE = -904                                          
221909             WHEN SQLCODE = -913                                          
221910                 CONTINUE                                                 
221911             WHEN SQLWARN0 NOT = SPACES                                   
221912             WHEN SQLCODE < ZERO                                          
221913             WHEN SQLCODE > ZERO                                          
221914                 MOVE '3125-OPEN-POE-CURSOR'                              
221915                                   TO DP013-PARAGRAPH                     
221916                 MOVE 'OPEN POE CURSOR - '                                
221917                                   TO DP013-MESSAGE-TEXT (1)              
221918                 MOVE SQLCA        TO DP013-SQLCA                         
221919                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)            
221920                 SET DP013-DB2-ABEND                                      
221921                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
221922                 PERFORM DP013-0000-PROCESS-ABEND                         
221923         END-EVALUATE                                                     
221924     END-PERFORM.                                                         
221925*                                                                         
221926     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
221927         MOVE '3125-OPEN-POE-CURSOR' TO DP013-PARAGRAPH                   
221928         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
221929                                   TO DP013-MESSAGE-TEXT (1)              
221930         MOVE SQLCA                TO DP013-SQLCA                         
221931         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)            
221932         SET DP013-DB2-ABEND                                              
221933             DP013-XCTL-DISPLAY-RESTART                                   
221934                                   TO TRUE                                
221935         PERFORM DP013-0000-PROCESS-ABEND                                 
221936     END-IF.                                                              
221937                                                                          
221938 EJECT                                                                    
221939*----------------------------------------------------------------*        
221940*   CLOSE THE POE CODE CURSOR                                    *        
221941*----------------------------------------------------------------*        
221942 3126-CLOSE-POE-CURSOR.                                                   
221943                                                                          
221944     EXEC SQL                                                             
221945          CLOSE POE-CSR                                                   
221946     END-EXEC.                                                            
221947                                                                          
221948     EVALUATE TRUE                                                        
221949         WHEN SQLCODE = ZERO                                              
221950             CONTINUE                                                     
221951         WHEN SQLWARN0 NOT = SPACES                                       
221952         WHEN SQLCODE < ZERO                                              
221953         WHEN SQLCODE > ZERO                                              
221954             MOVE '3126-CLOSE-POE-CURSOR'                                 
221955                               TO DP013-PARAGRAPH                         
221956             MOVE 'CLOSE POE CURSOR '                                     
221957                               TO DP013-MESSAGE-TEXT (1)                  
221958             MOVE SQLCA        TO DP013-SQLCA                             
221959             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)                
221960             SET DP013-DB2-ABEND                                          
221961                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
221962             PERFORM DP013-0000-PROCESS-ABEND                             
221963     END-EVALUATE.                                                        
221964                                                                          
221965 EJECT                                                                    
221966*----------------------------------------------------------------*        
221967*    FETCH THE POE CODE CURSOR                                   *        
221968*----------------------------------------------------------------*        
221969 3127-FETCH-POE-CURSOR.                                                   
221970                                                                          
221971     EXEC SQL                                                             
221972          FETCH POE-CSR                                                   
221973          INTO  :PV-POE-CDE                                               
221974     END-EXEC.                                                            
221975                                                                          
221976     EVALUATE TRUE                                                        
221977         WHEN SQLCODE = ZERO                                              
221978         WHEN SQLCODE = -811                                              
221979              SET PS-VALID-POE   TO TRUE                                  
221980         WHEN SQLCODE = +100                                              
221982             SET PS-INVALID-POE                                           
221983                 PS-ERROR                                                 
221984                 DP020-MSG-FATAL TO TRUE                                  
221985             MOVE PC-TSYMSG-01452 TO DP020-MSG-NUMBER                     
221986             MOVE DP015-UNP-ALP-BRT-OFF TO APOEA                          
221987             MOVE DP015-RED TO APOEC                                      
221988             MOVE DP015-REVERSE TO APOEH                                  
221989             MOVE -1            TO APOEL                                  
221990             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
221991                                                                          
221992         WHEN SQLWARN0 NOT = SPACE                                        
221993         WHEN SQLCODE NOT = ZERO                                          
221994              MOVE '3127-FETCH-POE-CURSOR'                                
221995                               TO DP013-PARAGRAPH                         
221996              MOVE 'FETCH POE CURSOR'                                     
221997                               TO DP013-MESSAGE-TEXT (1)                  
221998              MOVE SQLCA       TO DP013-SQLCA                             
221999              SET DP013-DB2-ABEND                                         
222000                               TO TRUE                                    
222001              PERFORM DP013-0000-PROCESS-ABEND                            
222002     END-EVALUATE.                                                        
222003                                                                          
222004 EJECT                                                                    
222005*****************************************************************         
222006*  VALIDATE THE DEPARTMENT NUMBER TO MAKE SURE THAT IT EXISTS.  *         
222007*****************************************************************         
222008 3130-VALIDATE-DEPT-NBR.                                          12140001
222009                                                                  12150001
222010     INITIALIZE PV-DB2-COUNT.                                     12160001
222011     PERFORM 3700-COUNT-DEPT.                                     12170001
222012     IF PV-DB2-COUNT = +0                                         12180001
222013         SET PS-ERROR                                             12190001
222014             DP020-MSG-FATAL TO TRUE                              12200001
222015             MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER             12210001
222016             MOVE DP015-UNP-ALP-BRT-OFF TO ADEPTA                 12220001
222017             MOVE DP015-RED TO ADEPTC                             12230001
222018             MOVE DP015-REVERSE TO ADEPTH                         12240001
222019             MOVE -1            TO ADEPTL                         12250001
222020             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12260001
222021     END-IF.                                                      12270001
222022                                                                          
222023*****************************************************************         
222024*  VALIDATE THE PURCHASE ORDER NUMBER TO MAKE SURE IT EXISTS.   *         
222025*****************************************************************         
222026 3132-VALIDATE-PO-NBR.                                            12140001
222027                                                                  12150001
222028     PERFORM 3760-CHECK-PO-NUMBER.                                12170001
222029     IF PS-INVALID-PO-NBR                                         12180001
222030         SET PS-ERROR                                             12190001
222031             DP020-MSG-FATAL TO TRUE                              12200001
222032             MOVE PC-TSYMSG-00083 TO DP020-MSG-NUMBER             12210001
222033             MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA                12220001
222034             MOVE DP015-RED TO APONBRC                            12230001
222035             MOVE DP015-REVERSE TO APONBRH                        12240001
222036             MOVE -1            TO APONBRL                        12250001
222037             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12260001
222038     END-IF.                                                      12270001
222039                                                                          
222040*****************************************************************         
222041*  VALIDATE THE BUYER NUMBER TO MAKE SURE THAT IS EXISTS.       *         
222042*****************************************************************         
222043 3135-VALIDATE-BUYER-NBR.                                         12280001
222044                                                                  12290001
222045     INITIALIZE PV-DB2-COUNT                                      12300001
222046     PERFORM 3750-COUNT-BUYER                                     12310001
222047     IF PV-DB2-COUNT = +0                                         12320001
222048         SET PS-ERROR                                             12330001
222049             DP020-MSG-FATAL TO TRUE                              12340001
222050             MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER             12350001
222051             MOVE DP015-UNP-ALP-BRT-OFF TO ABUYERA                12360001
222052             MOVE DP015-RED TO ABUYERC                            12370001
222053             MOVE DP015-REVERSE TO ABUYERH                        12380001
222054             MOVE -1            TO ABUYERL                        12390001
222055             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12400001
222056     END-IF.                                                      12410001
222057                                                                          
222058*****************************************************************         
222059*  CHECK TO MAKE SURE THAT A LIST SEQUENCE WAS ENTERED.         *         
222060*****************************************************************         
222061 3140-CHK2-LIST-SEQ.                                              12430001
222062                                                                          
222063     IF PS-LIST-SEQ-ENTERED                                       12440001
222064         CONTINUE                                                 12450001
222065     ELSE                                                         12460001
222066         SET PS-ERROR                                             12470001
222067             DP020-MSG-FATAL TO TRUE                              12480001
222068         MOVE PC-TSYMSG-01739 TO DP020-MSG-NUMBER                 12490001
222069         MOVE DP015-UNP-ALP-BRT-OFF TO ASEQTRA                    12500001
222070                                       ASEQPOA                    12510001
222071         MOVE DP015-RED TO ASEQTRC                                12520001
222072                           ASEQPOC                                12530001
222073         MOVE DP015-REVERSE TO ASEQTRH                            12540001
222074                               ASEQPOH                            12550001
222075         MOVE -1                    TO ASEQTRL                    12560001
222076         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      12570001
222077     END-IF.                                                      12580001
222080                                                                  12590001
222147*****************************************************************         
222148*  RESET THE SCREEN ATTRIBUTES.                                 *         
222149*****************************************************************         
222150 3200-RESET-ATTRIBUTES.                                           14020001
222151                                                                          
222152     MOVE DP015-UNP-ALP-NOR-OFF    TO AFOBA                       14030001
222153                                      APOEA                               
222154                                      AOTBA                               
222155                                      ADEPTA                      14040001
222156                                      APONBRA                     14060001
222157                                      ABUYERA                     14050001
222158                                      AALLTRBA                    14030001
222159                                      ASEQTRA                     14080001
222160                                      ASEQPOA                     14090001
222161                                      ATRBRSNA.                   14140001
222162                                                                  14150001
222163     MOVE DP015-GREEN              TO AFOBC                       14030001
222164                                      APOEC                               
222165                                      AOTBC                               
222166                                      ADEPTC                      14040001
222167                                      APONBRC                     14060001
222168                                      ABUYERC                     14050001
222169                                      AALLTRBC                    14030001
222170                                      ASEQTRC                     14080001
222171                                      ASEQPOC                     14090001
222172                                      ATRBRSNC.                   14140001
222173                                                                  14280001
222174     MOVE DP015-UNDERLINE          TO AFOBH                       14030001
222175                                      APOEH                               
222176                                      AOTBH                               
222177                                      ADEPTH                      14040001
222178                                      APONBRH                     14060001
222179                                      ABUYERH                     14050001
222180                                      AALLTRBH                    14030001
222181                                      ASEQTRH                     14080001
222182                                      ASEQPOH                     14090001
222183                                      ATRBRSNH.                   14140001
222190                                                                  14410001
402501*****************************************************************         
402502*  VALIDATE THE DEPARTMENT NUMBER.                              *         
402503*****************************************************************         
402504 3700-COUNT-DEPT.                                                 15680001
402505     PERFORM                                                      15690001
402506         WITH TEST AFTER                                          15700001
402507         VARYING PV-RETRY-COUNTER                                 15710001
402508         FROM 1 BY 1                                              15720001
402509         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15730001
402510             OR (SQLCODE = +0)                                    15740001
402511             OR (SQLCODE = +100))                                 15750001
402512                                                                  15760001
402513         EXEC SQL                                                 15770001
402514              SELECT COUNT(*)                                     15780001
402515                INTO :PV-DB2-COUNT                                15790001
402516                FROM TMDSEAR A                                    15800001
402517               WHERE                                              15810001
402518                     A.DEPT_NBR   = :DK-DEPT-NBR                  15820001
402519                 AND A.MDSELV_CDE  = 'DPT'                        15830001
402520                 AND A.OPERCO_NBR  = '03'                         15840001
402521                 AND A.STRT_DTE <= CURRENT DATE                   15850001
402522                 AND A.END_DTE  >= CURRENT DATE                   15860001
402523         END-EXEC                                                 15870001
402524                                                                  15880001
402525         EVALUATE TRUE                                            15890001
402526             WHEN SQLCODE = +0                                    15900001
402527             WHEN SQLCODE = +100                                  15910001
402528             WHEN SQLCODE = -904                                  15920001
402529             WHEN SQLCODE = -913                                  15930001
402530                  CONTINUE                                        15940001
402531                                                                  15950001
402532             WHEN SQLWARN0 NOT = SPACES                           15960001
402533             WHEN SQLCODE < +0                                    15970001
402534             WHEN SQLCODE > +0                                    15980001
402535                  MOVE '3700-COUNT-DEPT' TO DP013-PARAGRAPH       15990001
402536                  MOVE 'UNSUCCESSFUL COUNT ON MDSEAR'             16000001
402537                                  TO DP013-MESSAGE-TEXT (1)       16010001
402538                  MOVE SQLCA      TO DP013-SQLCA                  16020001
402539                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     16030001
402540                  SET DP013-DB2-ABEND                             16040001
402541                      DP013-XCTL-DISPLAY-RESTART TO TRUE          16050001
402542                  PERFORM DP013-0000-PROCESS-ABEND                16060001
402543         END-EVALUATE                                             16070001
402544     END-PERFORM.                                                 16080001
402545                                                                  16090001
402546     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16100001
402547         MOVE '3700-COUNT-DEPT' TO DP013-PARAGRAPH                16110001
402548         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TMDSEAR'          16120001
402549                                  TO DP013-MESSAGE-TEXT (1)       16130001
402550         MOVE SQLCA               TO DP013-SQLCA                  16140001
402551         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     16150001
402552         SET DP013-DB2-ABEND                                      16160001
402553             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16170001
402554         PERFORM DP013-0000-PROCESS-ABEND                         16180001
402555     END-IF.                                                      16190001
402556                                                                  16200001
402558*****************************************************************         
402559*  VALIDATE THE BUYER NUMBER.                                   *         
402560*****************************************************************         
402561 3750-COUNT-BUYER.                                                16220001
402562     PERFORM                                                      16230001
402563         WITH TEST AFTER                                          16240001
402564         VARYING PV-RETRY-COUNTER                                 16250001
402565         FROM 1 BY 1                                              16260001
402566         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16270001
402567             OR (SQLCODE = +0)                                    16280001
402568             OR (SQLCODE = +100))                                 16290001
402569                                                                  16300001
402570         EXEC SQL                                                 16310001
402571            SELECT                                                16320001
402572                  COUNT(*)                                        16330001
402573              INTO :PV-DB2-COUNT                                  16340001
402574              FROM                                                16350001
402575                  TMDSEAR A                                       16360001
402576                                                                  16370001
402577             WHERE                                                16380001
402578                  A.OPERCO_NBR = '03'                             16390001
402579              AND A.STRT_DTE  <= CURRENT DATE                     16400001
402580              AND A.END_DTE   >= CURRENT DATE                     16410001
402581              AND A.MDSELV_CDE = 'DPT'                            16420001
402582              AND A.BYR_NBR    = :DK-BUYER-NBR                    16430001
402583         END-EXEC                                                 16440001
402584                                                                  16450001
402585         EVALUATE TRUE                                            16460001
402586             WHEN SQLCODE = +0                                    16470001
402587             WHEN SQLCODE = +100                                  16480001
402588             WHEN SQLCODE = -904                                  16490001
402589             WHEN SQLCODE = -913                                  16500001
402590                  CONTINUE                                        16510001
402591                                                                  16520001
402592             WHEN SQLWARN0 NOT = SPACES                           16530001
402593             WHEN SQLCODE < +0                                    16540001
402594             WHEN SQLCODE > +0                                    16550001
402595                  MOVE '3750-COUNT-BUYER' TO DP013-PARAGRAPH      16560001
402596                  MOVE 'UNSUCCESSFUL COUNT ON MDSEAR'             16570001
402597                                  TO DP013-MESSAGE-TEXT (1)       16580001
402598                  MOVE SQLCA      TO DP013-SQLCA                  16590001
402599                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     16600001
402600                  SET DP013-DB2-ABEND                             16610001
402601                      DP013-XCTL-DISPLAY-RESTART TO TRUE          16620001
402602                  PERFORM DP013-0000-PROCESS-ABEND                16630001
402603         END-EVALUATE                                             16640001
402604     END-PERFORM.                                                 16650001
402605                                                                  16660001
402606     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16670001
402607         MOVE '3750-COUNT-BUYER' TO DP013-PARAGRAPH               16680001
402608         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TMDSEAR'          16690001
402609                                  TO DP013-MESSAGE-TEXT (1)       16700001
402610         MOVE SQLCA               TO DP013-SQLCA                  16710001
402611         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     16720001
402612         SET DP013-DB2-ABEND                                      16730001
402613             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16740001
402614         PERFORM DP013-0000-PROCESS-ABEND                         16750001
402615     END-IF.                                                      16760001
402617/                                                                 16780001
402618*****************************************************************         
402619*  VALIDATE THE PURCHASE ORDER NUMBER.                          *         
402620*****************************************************************         
402621 3760-CHECK-PO-NUMBER.                                            16220001
402622     PERFORM                                                      16230001
402623         WITH TEST AFTER                                          16240001
402624         VARYING PV-RETRY-COUNTER                                 16250001
402625         FROM 1 BY 1                                              16260001
402626         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16270001
402627             OR (SQLCODE = +0)                                    16280001
402628             OR (SQLCODE = +100)                                  16290001
402629             OR (SQLCODE = -811))                                 16290001
402630                                                                  16300001
402631         EXEC SQL                                                 16310001
402632            SELECT                                                16320001
402633                  A.PO_NBR                                        16330001
402634              INTO :PURCHS-PO-NBR                                 16340001
402635              FROM                                                16350001
402636                  TPURCHS A                                       16360001
402637                                                                  16370001
402638             WHERE                                                16380001
402639                  A.PO_NBR  = :DK-PO-NBR                          16390001
402640              AND A.VER_STATUS_CDE = :PC-A                                
402643         END-EXEC                                                 16440001
402644                                                                  16450001
402645         EVALUATE TRUE                                            16460001
402646             WHEN SQLCODE = +0                                    16470001
402647             WHEN SQLCODE = -811                                  16470001
402651                  SET PS-VALID-PO-NBR TO TRUE                     16510001
402652                                                                  16520001
402653             WHEN SQLCODE = +100                                  16480001
402654                  SET PS-INVALID-PO-NBR TO TRUE                   16510001
402655                                                                  16520001
402656             WHEN SQLCODE = -904                                  16490001
402657             WHEN SQLCODE = -913                                  16500001
402658                  CONTINUE                                        16510001
402659                                                                  16520001
402660             WHEN SQLWARN0 NOT = SPACES                           16530001
402661             WHEN SQLCODE < +0                                    16540001
402662             WHEN SQLCODE > +0                                    16550001
402663                  MOVE '3760-CHECK-PO-NBR' TO DP013-PARAGRAPH     16560001
402664                  MOVE 'UNSUCCESSFUL SELECT ON TPURCHS'           16570001
402665                                  TO DP013-MESSAGE-TEXT (1)       16580001
402666                  MOVE SQLCA      TO DP013-SQLCA                  16590001
402667                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     16600001
402668                  SET DP013-DB2-ABEND                             16610001
402669                      DP013-XCTL-DISPLAY-RESTART TO TRUE          16620001
402670                  PERFORM DP013-0000-PROCESS-ABEND                16630001
402671         END-EVALUATE                                             16640001
402672     END-PERFORM.                                                 16650001
402673                                                                  16660001
402674     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16670001
402675         MOVE '3760-CHECK-PO-NBR' TO DP013-PARAGRAPH              16680001
402676         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TPURCHS'         16690001
402677                                  TO DP013-MESSAGE-TEXT (1)       16700001
402678         MOVE SQLCA               TO DP013-SQLCA                  16710001
402679         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     16720001
402680         SET DP013-DB2-ABEND                                      16730001
402681             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16740001
402682         PERFORM DP013-0000-PROCESS-ABEND                         16750001
402683     END-IF.                                                      16760001
402684/                                                                 16780001
402685*****************************************************************         
402686*  BUILD THE INITIAL PANEL.                                     *         
402687*****************************************************************         
402688 4000-BUILD-INITIAL-PANEL.                                        16790001
402689     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        16800001
402690     MOVE -1                       TO AFOBL.                      16810001
402691                                                                  16820001
402692     MOVE PC-0001                  TO DK-FCLTY-ID                 16860001
402693                                      ASC-FCLTY-ID.               16870001
402694                                                                  16880001
402695     MOVE PC-CORPORATE-OFFICE      TO AOPUNITO                            
402696                                      ASC-OPER-UNT-ID                     
402697                                      DK-OPER-UNT-ID.             17180001
402698     PERFORM 4010-GET-FCLTY-NAME.                                 16950001
402699                                                                  16980001
402700**** DEFAULT TO PO LIST SEQUENCE                                  16990001
402701     MOVE PC-S TO ASC-LS-PO                                       17000001
402702                  ASEQPOO.                                        17010001
402703                                                                  17020001
402704*****************************************************************         
402705*  GET THE FACILITY NAME.                                       *         
402706*****************************************************************         
402707 4010-GET-FCLTY-NAME.                                             17030001
402708                                                                          
402709     PERFORM                                                      17040001
402710         WITH TEST AFTER                                          17050001
402711         VARYING PV-RETRY-COUNTER                                 17060001
402712         FROM 1 BY 1                                              17070001
402713         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17080001
402714             OR (SQLCODE = +0)                                    17090001
402715             OR (SQLCODE = +100))                                 17100001
402716                                                                  17110001
402717         EXEC SQL                                                 17120001
402718              SELECT FCLTY_NME                                    17130001
402719                    ,FCLTY_SHT_NME                                17140001
402720                INTO :FACLTY-FCLTY-NME                            17150001
402721                    ,:FACLTY-FCLTY-SHT-NME                        17160001
402722                FROM TFACLTY                                      17170001
402723               WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                17180001
402724                 AND FCLTY_ID    = :DK-FCLTY-ID                   17190001
402725         END-EXEC                                                 17200001
402726                                                                  17210001
402727         EVALUATE TRUE                                            17220001
402728             WHEN SQLCODE = +0                                    17230001
402729                  MOVE FACLTY-FCLTY-NME TO ASC-FCLTY-NME          17240001
402730                                           AOPDESO                17250001
402731                  MOVE FACLTY-FCLTY-SHT-NME TO ASC-FCLTY-SHORT-NME17260001
402732             WHEN SQLCODE = +100                                  17270001
402733                  MOVE SPACES     TO ASC-FCLTY-NME                17280001
402734                                     ASC-FCLTY-SHORT-NME          17290001
402735             WHEN SQLCODE = -904                                  17300001
402736             WHEN SQLCODE = -913                                  17310001
402737                  CONTINUE                                        17320001
402738             WHEN SQLWARN0 NOT = SPACES                           17330001
402739             WHEN SQLCODE < +0                                    17340001
402740             WHEN SQLCODE > +0                                    17350001
402741                  MOVE '4010-GET-FCLTY-NAME' TO DP013-PARAGRAPH   17360001
402742                  MOVE 'UNSUCCESSFUL SELECT ON FACILITY TABLE'    17370001
402743                                  TO DP013-MESSAGE-TEXT (1)       17380001
402744                  MOVE SQLCA      TO DP013-SQLCA                  17390001
402745                  MOVE 'TFACLTY ' TO DP013-DB2-TABLE-NAME (1)     17400001
402746                  SET DP013-DB2-ABEND                             17410001
402747                      DP013-XCTL-DISPLAY-RESTART TO TRUE          17420001
402748                  PERFORM DP013-0000-PROCESS-ABEND                17430001
402749         END-EVALUATE                                             17440001
402750     END-PERFORM.                                                 17450001
402751                                                                  17460001
402752     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17470001
402753         MOVE '4010-GET-FCLTY-NAME' TO DP013-PARAGRAPH            17480001
402754         MOVE 'MAX RETRIES EXCEEDED ON SELECT FACILITY TABLE'     17490001
402755                                  TO DP013-MESSAGE-TEXT (1)       17500001
402756         MOVE SQLCA               TO DP013-SQLCA                  17510001
402757         MOVE 'TFACLTY'           TO DP013-DB2-TABLE-NAME (1)     17520001
402758         SET DP013-DB2-ABEND                                      17530001
402759             DP013-XCTL-DISPLAY-RESTART TO TRUE                   17540001
402760         PERFORM DP013-0000-PROCESS-ABEND                         17550001
402761     END-IF.                                                      17560001
402762                                                                  17570001
402763*****************************************************************         
402764*  MOVE COMMAREA TO THE SCREEN.                                 *         
402765*****************************************************************         
402766 4400-MOVE-COMMAREA-TO-SCREEN.                                    17590001
402767                                                                          
402768     MOVE ASC-FOB-CDE              TO AFOBO.                              
402769     MOVE ASC-POE-CDE              TO APOEO.                              
402770     MOVE ASC-OTB-N                TO AOTBO.                              
402771     MOVE ASC-DEPT-N               TO ADEPTO.                     17620001
402772     MOVE ASC-PO-NBR               TO APONBRO.                    17640001
402773     MOVE ASC-BUYER-N              TO ABUYERO.                    17630001
402774     MOVE ASC-OPER-UNT-ID          TO AOPUNITO.                   17600001
402775     MOVE ASC-FCLTY-NME            TO AOPDESO.                    17610001
402776     MOVE ASC-ALL-TRBL             TO AALLTRBO.                           
402777     MOVE ASC-LS-OLD-NEW-TRBL      TO ASEQTRO.                    17670001
402778     MOVE ASC-LS-PO                TO ASEQPOO.                    17660001
402779     MOVE ASC-TRBL-REASON          TO ATRBRSNO.                   17720001
402780                                                                  17740001
402781**************************************************************    17750001
402782*     ABEND PROCESSING PARAGRAPH                             *    17760001
402783**************************************************************    17770001
402790     COPY DPPD013.                                                17780001
