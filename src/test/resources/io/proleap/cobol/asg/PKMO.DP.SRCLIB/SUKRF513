000100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00010010
000200 IDENTIFICATION DIVISION.                                         00020003
000300                                                                  00030003
000400 PROGRAM-ID.             SUKRF513.                                00040003
000500 AUTHOR.                 MICHAEL WALTERS.                         00050003
000600 INSTALLATION.           KOHLS.                                   00060003
000700 DATE-WRITTEN            SEPTEMBER, 1997.                         00070003
000800 DATE-COMPILED.                                                   00080003
000900                                                                  00090003
001000* THIS PROGRAM DISPLAYS THE UPC INFORMATION SCREEN WHICH WILL     00100003
001100* ALLOW THE USER TO COMPARE THE SYSTEM INFO WITH THE GOODS        00110003
001200                                                                  00120003
001300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00130003
001400*  NOTE:  COMMENTED OUT CODE THAT PERTAINED TO ITEM DIMENSIONS  * 00140003
001500*         ITEM DIMENSIONS ARE CAPTURED BY WMOS AT THE EFC       * 00150003
001600*         THAT IS THE SYSTEM OF RECORD.  MAINFRAM DATABASE      * 00160003
001700*         GETS UPDATED WITH THE DIMENSIONS THRU PIX TRANSACTION * 00170003
001800*                                                               * 00180003
001900*         COMMENTED OUT CODE STARTS WITH **DMH                  * 00190003
002000*         2/12/10 - DENISE HAHN                                 * 00200003
002100*02/01/14 RK BEG                                                * 00210008
002200*         RFID AUDIT CHANGES                                    * 00220008
002300*         ADDED LOGIC IN PARA 0000-PROGRAM-MAINLINE TO ENABLE   * 00230008
002400*         NAVIGATION TO SUKRF710 WHEN A COMBO AUDIT IS BEING    * 00240008
002500*         PROCESSED.                                            * 00250008
002600*         ADDED LOGIC IN PARA 5100-CHECK-SHIP-TABLE-SKU TO SET  * 00260008
002700*         NEW SWITCH WHEN PROCESSING RFID AUDIT.                * 00270008
002800* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00280003
002100*02/14/23 JEAN KURK                   CHG0281369                * 00281012
002200*         REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE           * 00282012
002800* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00285012
002900                                                                  00290003
003000 ENVIRONMENT DIVISION.                                            00300003
003100 DATA DIVISION.                                                   00310003
003200 WORKING-STORAGE SECTION.                                         00320003
003300                                                                  00330003
003400 01  CA-COMMAREA.                                                 00340003
003500     COPY SUWS006.                                                00350003
003600* * * * * * * * * * * *  PLEASE NOTE * * * * * * * * * * * *      00360003
003700* THE COMMAREA FROM HERE....                                      00370003
003800    05  CA-PROGRAM-COMMAREA.                                      00380003
003900      07  CA-LOOKUP-COMMAREA.                                     00390003
004000        10 CA-SCANNED-UPC                PIC X(15).               00400003
004100        10 CA-RETURN-MSG                 PIC X(19).               00410003
004200        10 CA-RETURN-ERROR-IND           PIC X(01) VALUE 'N'.     00420003
004300           88  CA-RETURN-ERROR                     VALUE 'Y'.     00430003
004400           88  CA-NO-RETURN-ERROR                  VALUE 'N'.     00440003
004500* ...TO HERE IS COPIED TO SUKRF518/521/524...                     00450003
004600      07  CA-DETAIL-COMMAREA.                                     00460003
004700        10 CA-RETAIL-X                   PIC X(08).               00470003
004800        10 CA-RETAIL REDEFINES CA-RETAIL-X                        00480003
004900                                         PIC ZZZZ9.99.            00490003
005000        10 CA-SKU-DESC                   PIC X(19).               00500003
005100        10 CA-COLOR                      PIC X(10).               00510003
005200        10 CA-SIZE                       PIC X(10).               00520003
005300        10 CA-VENDOR-STYLE               PIC X(19).               00530003
005400* ...AND TO HERE IS COPIED TO SUKRF517/522...                     00540003
005500      07  CA-VS-COMMAREA.                                         00550003
005600        10 CA-VENDOR-ENT-ID              PIC S9(09) COMP.         00560003
005700        10 CA-VENDOR-VS-NBR              PIC X(20).               00570003
005800        10 CA-VENDOR-VS-ID               PIC S9(09) COMP.         00580003
005900        10 CA-INTR-UPC-ID                PIC S9(09) COMP.         00590003
006000        10 CA-USE-UPC-IND                PIC X(01).               00600003
006100        10 FILLER                        PIC X(01)  VALUE 'N'.    00610003
006200*DMH    10 CA-WEBITM-ERR-IND             PIC X(01)  VALUE 'N'.    00620003
006300*DMH       88  CA-WEBITM-ERR                        VALUE 'Y'.    00630003
006400*DMH       88  CA-NO-WEBITM-ERR                     VALUE 'N'.    00640003
006500* ...AND TO HERE IS COPIED TO SUKRF514/532/533...                 00650003
006600* IF YOU CHANGE IT (THIS COMMAREA) PLEASE VERIFY THAT THE COMMAREA00660003
006700* PASSED TO THOSE PROGRAMS MATCHES                                00670003
006800      07  CA-SCREEN-COMMAREA.                                     00680003
006900        10 CA-INTERNAL-UPC-X             PIC X(15).               00690003
007000        10 CA-INTERNAL-UPC  REDEFINES CA-INTERNAL-UPC-X           00700003
007100                                         PIC 9(15).               00710003
007200        10 CA-VENDOR-NAME                PIC X(11).               00720003
007300        10 CA-ITEM-LOOKUP-IND            PIC X(01) VALUE ' '.     00730003
007400           88  CA-UPC-FOUND                        VALUE '1'.     00740003
007500           88  CA-UPC-NOT-FOUND                    VALUE '2'.     00750003
007600           88  CA-SKU-FOUND                        VALUE '3'.     00760003
007700           88  CA-SKU-NOT-FOUND                    VALUE '4'.     00770003
007800        10 CA-F4-IND                     PIC X(01) VALUE 'N'.     00780003
007900           88  CA-F4-NOT-PRESSED-YET               VALUE 'N'.     00790003
008000           88  CA-F4-PRESSED                       VALUE 'Y'.     00800003
008100         10 CA-PO-NBR                    PIC S9(09) COMP.         00810003
008200         10 CA-PO-LNE-NBR                PIC S9(09) COMP.         00820003
008300         10 CA-HANG-FOLD                 PIC X(01).               00830003
008400         10 CA-GOH-IND                   PIC X(01).               00840003
008500                                                                  00850003
008600 01  DK-DB2-KEYS.                                                 00860003
008700     05  DK-UPC-NUMBER                   PIC S9(15) COMP-3.       00870003
008800     05  DK-UPC-ID                       PIC S9(09) COMP.         00880003
008900     05  DK-DEST-NBR                     PIC S9(04) COMP.         00890003
009000     05  DK-OPER-UNIT-ID                 PIC S9(04) COMP.         00900003
009100     05  DK-PO                           PIC S9(09) COMP.         00910003
009200     05  DK-REC-SEQ-NBR                  PIC S9(03) COMP.         00920003
009300     05  DK-PO-LNE-NBR                   PIC S9(09) COMP.         00930003
009400     05  DK-COLOR-CDE                    PIC  X(03).              00940003
009500     05  DK-VENDOR-STYLE                 PIC  X(20).              00950003
009600     05  DK-ERR-MSG-CDE                  PIC  X(01).              00960003
009700                                                                  00970003
009800 01  PC-PROGRAM-CONSTANTS.                                        00980003
009900     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE 3      00990003
010000                                                     COMP.        01000003
010100     05  PC-CARTON-AUDIT-GROUP-CODE      PIC  X(03)  VALUE 'VA'.  01010003
010200     05  PC-DMGD-MDSE-VILN-SEQ           PIC S9(04)  VALUE 20     01020003
010300                                                     COMP.        01030003
010400     05  PC-01                           PIC  X(02)  VALUE '01'.  01040003
010500     05  PC-I                            PIC  X(01)  VALUE 'I'.   01050003
010600     05  PC-E                            PIC  X(01)  VALUE 'E'.   01060003
010700     05  PC-P                            PIC  X(01)  VALUE 'P'.   01070003
010800     05  PC-O                            PIC  X(01)  VALUE 'O'.   01080003
010900     05  PC-S                            PIC  X(01)  VALUE 'S'.   01090003
011000     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01100003
011100         'SUKRF513'.                                              01110003
011200     05  PC-MESSAGE-SCREEN-PROGRAM-NAME  PIC  X(08)  VALUE        01120003
011300         'SUKRF514'.                                              01130003
011400     05  PC-DATA-INFO-PROGRAM-NAME       PIC  X(08)  VALUE        01140003
011500         'SUKRF519'.                                              01150003
011600     05  PC-UPC-SCAN-PROGRAM-NAME        PIC  X(08)  VALUE        01160003
011700         'SUKRF518'.                                              01170003
011800*02/01/14 RK BEG                                                * 01180008
011900     05  PC-UPC-RFID-KEY-PGM-NAME        PIC  X(08)  VALUE        01190003
012000         'SUKRF710'.                                              01200003
012100*02/01/14 RK END                                                * 01210008
012200     05  PC-SKU-SCAN-PROGRAM-NAME        PIC  X(08)  VALUE        01220003
012300         'SUKRF521'.                                              01230003
012600     05  PC-LOCATION-MODULE              PIC  X(08)  VALUE        01260003
012700         'XLKUT071'.                                              01270003
012800     05  PC-UPC-SCAN-TRANID              PIC  X(04)  VALUE        01280003
012900         'S518'.                                                  01290003
013000     05  PC-SKU-SCAN-TRANID              PIC  X(04)  VALUE        01300003
013100         'S521'.                                                  01310003
013200     05  PC-TIX-NO-MTCH-PROGRAM-NAME     PIC  X(08)  VALUE        01320003
013300         'SUKRF517'.                                              01330003
013400     05  PC-UPC-KEY-QTY-PROGRAM          PIC  X(08)  VALUE        01340003
013500         'SUKRF537'.                                              01350003
013600     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S513'.01360003
013700     05  PC-INITIAL-KEYS-MSG             PIC  X(19)  VALUE        01370003
013800         'F2-OK F4-DMG F9-NO '.                                   01380003
013900     05  PC-AFTER-DAMAGE-KEYS-MSG        PIC  X(19)  VALUE        01390003
014000         'F2-OK  F9-NO MATCH'.                                    01400003
014100     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01410003
014200         'TRANS NOT AVAILABLE'.                                   01420003
014300                                                                  01430003
014400 01  PS-PROGRAM-SWITCHES.                                         01440003
014500     05  PS-DATABASE-CONTENTION-SW       PIC  X(01)  VALUE 'N'.   01450003
014600         88  PS-DATABASE-CONTENTION-NO               VALUE 'N'.   01460003
014700         88  PS-DATABASE-CONTENTION-YES              VALUE 'Y'.   01470003
014800     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   01480003
014900         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   01490003
015000         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   01500003
015100     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   01510003
015200         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   01520003
015300         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   01530003
015400     05  PS-DEST-TYPE-IND                PIC  X(01)  VALUE ' '.   01540003
015500         88  PS-DEST-IS-A-DC                         VALUE 'D'.   01550003
015600         88  PS-DEST-IS-A-STR                        VALUE 'S'.   01560003
015700     05  PS-EOC-PO-LINE-CURSOR-IND       PIC  X(01)  VALUE 'N'.   01570003
015800         88  PS-NOT-EOC-PO-LINE-CURSOR               VALUE 'N'.   01580003
015900         88  PS-EOC-PO-LINE-CURSOR                   VALUE 'Y'.   01590003
016000     05  PS-DONE-IND                     PIC  X(01)  VALUE 'N'.   01600003
016100         88  PS-NOT-DONE                             VALUE 'N'.   01610003
016200         88  PS-DONE                                 VALUE 'Y'.   01620003
016300     05  PS-NO-UPC-FOUND-SW              PIC  X(01)  VALUE 'N'.   01630003
016400         88  NO-UPC-FOUND                            VALUE 'Y'.   01640003
016500         88  PS-UPC-FOUND                            VALUE 'N'.   01650003
016600     05  PS-PO-VALIDATED-IND             PIC  X(01)  VALUE 'N'.   01660003
016700         88  PS-PO-ALREADY-VALIDATED                 VALUE 'Y'.   01670003
016800         88  PS-PO-NOT-VALIDATED                     VALUE 'N'.   01680003
016900     05  PS-NO-UPC-IND                   PIC  X(01)  VALUE 'Y'.   01690003
017000         88  PS-NO-UPC                               VALUE 'N'.   01700003
017100         88  PS-UPC-EXISTS                           VALUE 'Y'.   01710003
017200     05  PS-NO-WEB-ITEM-IND              PIC  X(01)  VALUE 'Y'.   01720003
017300         88  PS-NO-WEB-ITEM                          VALUE 'N'.   01730003
017400         88  PS-WEB-ITEM-EXISTS                      VALUE 'Y'.   01740003
017500     05  PS-MSG-XCTL-IND                 PIC  X(01)  VALUE 'Y'.   01750003
017600         88  PS-MSG-XCTL                             VALUE 'Y'.   01760003
017700         88  PS-NO-MSG-XCTL                          VALUE 'N'.   01770003
017800     05  PS-UPDATE-THIS-UPC-IND          PIC  X(01)  VALUE 'N'.   01780003
017900         88  PS-UPDATE-THIS-UPC                      VALUE 'Y'.   01790003
018000         88  PS-UPDATE-NO-UPC                        VALUE 'N'.   01800003
018100     05  PS-ALL-VALID-SIZ-WGT-IND        PIC  X(01)  VALUE 'N'.   01810003
018200         88  PS-ALL-VALID-SIZ-WGT                    VALUE 'Y'.   01820003
018300         88  PS-NOT-VALID-SIZ-WGT                    VALUE 'N'.   01830003
018400*DMH 05  PS-WEBITM-ERR-IND               PIC X(01)  VALUE 'N'.    01840003
018500*DMH     88  PS-WEBITM-ERR                          VALUE 'Y'.    01850003
018600*DMH     88  PS-NO-WEBITM-ERR                       VALUE 'N'.    01860003
018700     05  PS-BLACKOUT-SW                  PIC X(01)  VALUE 'N'.    01870003
018800         88  PS-BLACKOUT-YES                        VALUE 'Y'.    01880003
018900         88  PS-BLACKOUT-NO                         VALUE 'N'.    01890003
019000                                                                  01900003
019100 01  PV-PROGRAM-VARIABLES.                                        01910003
019200     05  PV-DISPLAY-KEYS.                                         01920003
019300         10 FILLER                       PIC X(12)                01930003
019400            VALUE 'KEY VALUES: '.                                 01940003
019500         10 PV-DISP-AUD-CNTL-NBR         PIC 9(09).               01950003
019600         10 FILLER                       PIC X(04)                01960003
019700            VALUE ' -- '.                                         01970003
019800         10 PV-DISP-SHIPT-UNT-ID         PIC 9(18).               01980003
019900         10 FILLER                       PIC X(04)                01990003
020000            VALUE ' -- '.                                         02000003
020100         10 PV-DISP-UPC-NBR              PIC 9(15).               02010003
020200         10 FILLER                       PIC X(04)                02020003
020300            VALUE ' -- '.                                         02030003
020400         10 PV-DISP-SCN-TMST             PIC X(26).               02040003
020500     05  PV-DISP-SKU-SQL-CDE             PIC 9(9).                02050003
020600     05  PV-DISP-VS-SQL-CDE              PIC 9(9).                02060003
020700     05  PV-DISP-SKU-STR-SQL-CDE         PIC 9(9).                02070003
020800     05  PV-DISP-WEB-SQL-CDE             PIC 9(9).                02080003
020900     05  PV-DISP-UPC-SQL-CDE             PIC 9(9).                02090003
021000     05  PV-DISP-VALUE                   PIC 9(15).               02100010
021100     05  PV-PREV-TRANID                  PIC  X(04)  VALUE SPACE. 02110003
021200     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACE. 02120003
021300     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZERO.  02130003
021400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   02140003
021500                                                     COMP SYNC.   02150003
021600     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 02160003
021700     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 02170003
021800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02180003
021900                                                     COMP SYNC.   02190003
022000     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 02200003
022100     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  02210003
022200                                                     COMP.        02220003
022300     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  02230003
022400                                                     COMP.        02240003
022500     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   02250003
022600                                                     COMP.        02260003
022700     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   02270003
022800                                                     COMP SYNC.   02280003
022900     05  PV-ITM-NBR                      PIC  S9(15)     COMP-3.  02290003
023000     05  PV-DC-E-BUS-LOC-IND             PIC   X(1).              02300003
023100     05  PV-DC-TYPE-CODE                 PIC   X(2).              02310003
023200     05  PV-SUB-CL-MDSEAR-ID             PIC  9(09).              02320003
023300     05  PV-KOHLS-SIZE-CDE               PIC  9(09).              02330003
023400     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02340003
023500     05  PV-DB2-COUNT                    PIC S9(09) VALUE +0      02350003
023600                                                 COMP-3.          02360003
023700/                                                                 02370003
023800*                                                                 02380003
023900*    (LOGISTICS DOMAIN ITEM ACCESS MODULE)                        02390003
024000     COPY XLWS001.                                                02400003
024100                                                                  02410003
024200*    (LOCATION ACCESS MODULE)                                     02420003
024300     COPY XLWS071.                                                02430003
024400                                                                  02440003
024500*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      02450003
024600     COPY DFHAID.                                                 02460003
024700                                                                  02470003
025100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                02510003
025200     COPY DPWS013.                                                02520003
025300                                                                  02530003
025400*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 02540003
025500     COPY DPWS010I.                                               02550003
025600                                                                  02560003
025700*  GENERATED DSECT FOR THE SUKM513 MAPSET                         02570003
025800     COPY SUKM513.                                                02580003
025900                                                                  02590003
026000*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   02600003
026100     COPY DPWS015.                                                02610003
026200                                                                  02620003
026300*  COPY BOOK CONTAINING MESSAGES USED IN THE MESSAGE SCREEN       02630003
026400*  (SUKRF514)                                                     02640003
026500     COPY SUWS007.                                                02650003
026600                                                                  02660003
026700*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      02670003
026800*  TO BE DISPLAYED ON THE LRT                                     02680003
026900     COPY SUWS005.                                                02690003
027000                                                                  02700003
027100* HELP SCREEN COMMAREA                                            02710003
027200     COPY PCWS192.                                                02720003
027300                                                                  02730003
027400* HELP SCREEN WORK AREA                                           02740003
027500     COPY PCWS188.                                                02750003
027600                                                                  02760003
027700*  SHIPPING UNIT UPC TABLE                                        02770003
027800     EXEC SQL                                                     02780003
027900         INCLUDE TSHUUPC                                          02790003
028000     END-EXEC.                                                    02800003
028100                                                                  02810003
028200*  SHIPPING UNIT AUDIT  TABLE                                     02820003
028300     EXEC SQL                                                     02830003
028400         INCLUDE TSUATRN                                          02840003
028500     END-EXEC.                                                    02850003
028600                                                                  02860003
028700*  PURCHASE ORDER TABLE (TPURCHS)                                 02870003
028800     EXEC SQL                                                     02880003
028900         INCLUDE TPURCHS                                          02890003
029000     END-EXEC.                                                    02900003
029100                                                                  02910003
029200*  EXTERNAL ENTERPRISE NAME TABLE (TENTNME)                       02920003
029300     EXEC SQL                                                     02930003
029400         INCLUDE TENTNME                                          02940003
029500     END-EXEC.                                                    02950003
029600                                                                  02960003
029700*  PURCHASE ORDER ITEM DETAIL TABLE                               02970003
029800     EXEC SQL                                                     02980003
029900         INCLUDE TPURITM                                          02990003
030000     END-EXEC.                                                    03000003
030100                                                                  03010003
030200*  SHIPPING UNIT                                                  03020003
030300*  UPC AUDIT TABLE                                                03030003
030400     EXEC SQL                                                     03040003
030500         INCLUDE TSUAUPC                                          03050003
030600     END-EXEC.                                                    03060003
030700                                                                  03070003
030800*  SHIPPING UNIT                                                  03080003
030900*  CONTENT AUDIT TABLE                                            03090003
031000     EXEC SQL                                                     03100003
031100         INCLUDE TSUEXCP                                          03110003
031200     END-EXEC.                                                    03120003
031300*  DCLGEN FOR THE XLV_SKU VIEW                                    03130003
031400     EXEC SQL                                                     03140003
031500         INCLUDE XLV00000                                         03150003
031600     END-EXEC.                                                    03160003
031700                                                                  03170003
031800*  DCLGEN FOR THE XLV_UPC VIEW                                    03180003
031900     EXEC SQL                                                     03190003
032000         INCLUDE XLV00003                                         03200003
032100     END-EXEC.                                                    03210003
032200                                                                  03220003
032300*  DCLGEN FOR THE XLT_UPC TABLE                                   03230003
032400     EXEC SQL                                                     03240003
032500         INCLUDE XLT00006                                         03250003
032600     END-EXEC.                                                    03260003
032700                                                                  03270003
032800*  DCLGEN FOR THE XLV_WEB_SKU VIEW                                03280003
032900     EXEC SQL                                                     03290003
033000         INCLUDE XLV00004                                         03300003
033100     END-EXEC.                                                    03310003
033200                                                                  03320003
033300*  DCLGEN FOR THE XLV_VND_STYL VIEW                               03330003
033400     EXEC SQL                                                     03340003
033500         INCLUDE XLV00001                                         03350003
033600     END-EXEC.                                                    03360003
033700                                                                  03370003
033800*  SKU/UPC TABLE                                                  03380003
033900*  (TUPCSKU)                                                      03390003
034000     EXEC SQL                                                     03400003
034100         INCLUDE TUPCSKU                                          03410003
034200     END-EXEC.                                                    03420003
034300                                                                  03430003
034400*  UPC TABLE                                                      03440003
034500     EXEC SQL                                                     03450003
034600         INCLUDE TUPC                                             03460003
034700     END-EXEC.                                                    03470003
034800                                                                  03480003
034900*  ALLOCIATION PLAN TABLE                                         03490003
035000     EXEC SQL                                                     03500003
035100         INCLUDE TALLPLN                                          03510003
035200     END-EXEC.                                                    03520003
035300                                                                  03530003
035400*  MERCHANDISE STORE DISTRIBUTION TABLE                           03540003
035500     EXEC SQL                                                     03550003
035600         INCLUDE TMESTDS                                          03560003
035700     END-EXEC.                                                    03570003
035800                                                                  03580003
035900*  MESSAGE TABLE                                                  03590003
036000*DMH REMOVED TLBVRMG 2/12/10 DMH                                  03600003
036100*DMH EXEC SQL                                                     03610003
036200*DMH     INCLUDE TLBVRMG                                          03620003
036300*DMH END-EXEC.                                                    03630003
036400                                                                  03640003
036500*  WEB ITEM TABLE                                                 03650003
036600*DMH REMOVED TWEBITM 2/12/10 DMH                                  03660003
036700*DMH EXEC SQL                                                     03670003
036800*DMH     INCLUDE TWEBITM                                          03680003
036900*DMH END-EXEC.                                                    03690003
037000                                                                  03700003
037100*  PO AGREEMENT TABLE                                             03710003
037200     EXEC SQL                                                     03720003
037300         INCLUDE TPOAGMT                                          03730003
037400     END-EXEC.                                                    03740003
037500                                                                  03750003
037600*  WST_INTGRTN_TYP                                                03760003
037700     EXEC SQL                                                     03770003
037800         INCLUDE WST00008                                         03780003
037900     END-EXEC.                                                    03790003
038000                                                                  03800003
038100*  WST_ATTR_DEFN                                                  03810003
038200     EXEC SQL                                                     03820003
038300         INCLUDE WST00009                                         03830003
038400     END-EXEC.                                                    03840003
038500                                                                  03850003
038600*  WST_ATTR_ELEM                                                  03860003
038700     EXEC SQL                                                     03870003
038800         INCLUDE WST00010                                         03880003
038900     END-EXEC.                                                    03890003
039000                                                                  03900003
039100     EXEC SQL                                                     03910003
039200         INCLUDE SQLCA                                            03920003
039300     END-EXEC.                                                    03930003
039400                                                                  03940003
039500     EXEC SQL                                                     03950003
039600          DECLARE PO-LINE-CURSOR CURSOR                           03960003
039700          FOR SELECT                                              03970003
039800                 B.PO_LNE_NBR                                     03980003
039900         FROM                                                     03990003
040000                 TPURCHS A                                        04000003
040100              ,  TPURITM B                                        04010003
040200         WHERE                                                    04020003
040300               A.PO_NBR         = :SU006-PO                       04030003
040400           AND A.PO_NBR         = B.PO_NBR                        04040003
040500           AND B.ITM_NBR        = :XL001-ITM-NBR                  04050003
040600           AND A.VER_STATUS_CDE = 'A'                             04060003
040700           AND B.VER_STATUS_CDE = 'A'                             04070003
040800           AND A.STATUS_CDE    IN ('AC', 'AP', 'CM'               04080003
040900                                  ,'CA', 'CB')                    04090003
041000           AND B.STATUS_CDE    IN ('AC', 'AP', 'CM'               04100003
041100                                  ,'CA', 'CB', 'RV')              04110003
041200     END-EXEC.                                                    04120003
041300                                                                  04130003
041400*DMH REMOVED CURSOR  2/12/10 DMH                                  04140003
041500*DMH EXEC SQL                                                     04150003
041600*DMH      DECLARE SIZE-WEIGHT-CURSOR CURSOR                       04160003
041700*DMH      FOR SELECT                                              04170003
041800*DMH             C.SHIP_WD_QTY                                    04180003
041900*DMH           , C.SHIP_DPTH_QTY                                  04190003
042000*DMH           , C.SHIP_HT_QTY                                    04200003
042100*DMH           , C.SHIP_WT_QTY                                    04210003
042200*DMH           , C.SHIP_DIM_SRC_CDE                               04220003
042300*DMH     FROM                                                     04230003
042400*DMH             XLV_SKU A                                        04240003
042500*DMH           , XLV_VND_STYL B                                   04250003
042600*DMH           , XLV_WEB_SKU C                                    04260003
042700*DMH     WHERE                                                    04270003
042800*DMH             A.KOHLS_SIZE_CDE     = :XLV00000-KOHLS-SIZE-CDE  04280003
042900*DMH      AND    B.VS_ID              = :XLV00001-VS-ID           04290003
043000*DMH      AND    A.STYL_ID            = B.STYL_ID                 04300003
043100*DMH      AND    A.INTR_UPC_ID        = C.INTR_UPC_ID             04310003
043200*DMH      AND   (C.SHIP_WD_QTY        = 0                         04320003
043300*DMH      OR     C.SHIP_DPTH_QTY      = 0                         04330003
043400*DMH      OR     C.SHIP_HT_QTY        = 0                         04340003
043500*DMH      OR     C.SHIP_WT_QTY        = 0                         04350003
043600*DMH      OR     C.SHIP_DIM_SRC_CDE   = 'E'                       04360003
043700*DMH      OR     C.SHIP_DIM_SRC_CDE   = 'P')                      04370003
043800*DMH     ORDER BY                                                 04380003
043900*DMH             C.SHIP_WD_QTY                                    04390003
044000*DMH           , C.SHIP_DPTH_QTY                                  04400003
044100*DMH           , C.SHIP_HT_QTY                                    04410003
044200*DMH           , C.SHIP_WT_QTY                                    04420003
044300*DMH END-EXEC.                                                    04430003
044400                                                                  04440003
044500 LINKAGE SECTION.                                                 04450003
044600 01  DFHCOMMAREA.                                                 04460003
044700     05  FILLER                         OCCURS  1 TO 4072 TIMES   04470003
044800                                        DEPENDING ON EIBCALEN.    04480003
044900         10  FILLER                     PIC X.                    04490003
045000                                                                  04500003
045100/                                                                 04510003
045200 PROCEDURE DIVISION.                                              04520003
045300 0000-PROGRAM-MAINLINE.                                           04530003
045400     IF EIBTRNID = 'Z278'                                         04540003
045500         MOVE DFHCOMMAREA            TO PC192-COMMAREA            04550003
045600         MOVE PC192-HOST-SAVE-AREA   TO CA-COMMAREA               04560003
045700     ELSE                                                         04570003
045800         MOVE DFHCOMMAREA            TO CA-COMMAREA               04580003
045900     END-IF.                                                      04590003
046000     MOVE LOW-VALUES   TO  SU513AI.                               04600003
046100                                                                  04610003
046200     EVALUATE TRUE                                                04620003
046300         WHEN EIBCALEN = ZERO                                     04630003
046400         WHEN EIBAID = DFHCLEAR                                   04640003
046500         WHEN SU006-INITIALIZE-SCREEN                             04650003
046600******************************************************************04660003
046700* COMMENTED OUT WEBITM LOGIC - EFC WMOS IS THE SYSTEM OF RECORD  *04670003
046800* DMH 1/12/10                                                    *04680003
046900******************************************************************04690003
047000************* IF A WEBITM ERROR WAS DETERMINED, THE WEBITM-ERR-IND04700003
047100************* IS SET TO TRUE AND THE MESSAGE SCREEN DISPLAYS THE  04710003
047200************* ERROR MESSAGE.  WHEN RETURNING SAVE THIS INDICATOR  04720003
047300************* SO THAT THE VALIDATION DOES NOT HAVE TO BE DONE     04730003
047400************* AGAIN.                                              04740003
047500*DMH         IF CA-WEBITM-ERR                                     04750003
047600*DMH             SET PS-WEBITM-ERR TO TRUE                        04760003
047700*DMH         ELSE                                                 04770003
047800*DMH             SET PS-NO-WEBITM-ERR TO TRUE                     04780003
047900*DMH         END-IF                                               04790003
048000             INITIALIZE CA-PROGRAM-COMMAREA                       04800003
048100             SET SU006-PROCESS-SCREEN                             04810003
048200                 SU006-UPC-CERTIFIED                              04820003
048300                 CA-F4-NOT-PRESSED-YET TO TRUE                    04830003
048400             PERFORM 1000-SETUP-SCREEN                            04840003
048500                                                                  04850003
048600*            PERFORM CHECK OF THE PO TABLES TO VALIDATE THAT THE  04860003
048700*            ITEM IS ON THE PO AND THE ALLOCATION TO BE SURE IT   04870003
048800*            SHOULD BE COMING THROUGH HERE AND NOW.               04880003
048900             PERFORM 3000-CHECK-PO                                04890003
049000                                                                  04900003
049100*            PERFORM CHECK OF THE SHIPPING TABLES TO VERIFY THAT  04910003
049200*            THE ITEM SHOULD ACTUALLY BE IN THIS CARTON (ONLY DONE04920003
049300*            IF THE ITEM WAS ENTERED BY UPC)                      04930003
049400             IF SU006-UPC-X > SPACES                              04940003
049500                 PERFORM 5000-CHECK-SHIPPING-TABLES               04950003
049600             END-IF                                               04960003
049700                                                                  04970003
049800*  AT THIS POINT ALL THE LOOKUPS HAVE BEEN DONE AND ALL THE       04980003
049900*  POSSIBLE EXCEPTIONS HAVE BEEN CREATED.  IF THE                 04990003
050000*  SU006-PGM-MSG-NBR VARIABLE IS GREATER THAN 0, IT MEANS IT HAS  05000003
050100*  ALREADY GONE THROUGH THE INITIALIZATION PART OF THIS PROGRAM,  05010003
050200*  AND FOUND EXCEPTIONS...IT TRANSFERRED TO THE MESSAGE SCREEN TO 05020003
050300*  DISPLAY THEM TO THE USER, AND IS NOW RETURNING TO THIS PROGRAM 05030003
050400*  FOR FURTHER PROCESSING.  THE PROGRAM WILL REDO THE             05040003
050500*  INITIALIZATION IN ORDER TO RE-FILL THE COMMAREA WITH THE       05050003
050600*  CORRECT INFO, BUT WE WANT TO SKIP THE CREATION OF THE AUDIT AND05060003
050700*  EXCEPTIONS THIS TIME THROUGH                                   05070003
050800                                                                  05080003
050900                                                                  05090003
051000             IF SU006-PGM-MSG-NBR > +0                            05100003
051100                 MOVE +0       TO SU006-PGM-MSG-NBR               05110003
051200             ELSE                                                 05120003
051300*                CREATE AN AUDIT ROW AND CREATE EXCEPTIONS IF ANY 05130003
051400*                WERE FOUND                                       05140003
051500                 MOVE 'N' TO SUAUPC-UPC-CERTD-IND                 05150003
051600                 PERFORM 1400-CREATE-AUDIT-ROW                    05160003
051700                 PERFORM 1500-CHECK-EXCEPTIONS                    05170003
051800             END-IF                                               05180003
051900                                                                  05190003
052900                                                                  05290003
053000             MOVE -1                   TO  AUPCL                  05300003
053100             PERFORM 8000-SEND-MAP                                05310003
053200             PERFORM 8200-RETURN-TRANID                           05320003
053300                                                                  05330003
053400                                                                  05340003
053500*        THE OK KEY WAS PRESSED....UPDATE THE AUDIT ROWS CREATED  05350003
053600*        IN SUKRF518 WITH THE DETAIL INFORMATION, THEN RETURN TO  05360003
053700*        THE UPC SCAN SCREEN                                      05370003
053800         WHEN EIBAID = DFHENTER                                   05380003
053900         WHEN EIBAID = DFHPF2                                     05390003
054000*            IF THE UPC HAS NOT BEEN CERTIFIED, CERTIFY IT AND    05400003
054100*            SET THE FLAG ON THE AUDIT ROW TO INDICATE THAT       05410003
054200*            IT WAS THE AUDIT PROCESS THAT CERTIFIED IT           05420003
054300             IF SU006-UPC-NOT-CERTIFIED                           05430003
054400                                                                  05440003
054500*     DO NOT EVEN ATTEMPT TO CERTIFY A TUPC                       05450003
054600*     DURING THE TIME THAT DB MAINTENANCE IS BEING DONE.          05460003
054700                PERFORM 7300-GET-BLACKOUT                         05470003
054800                IF PS-BLACKOUT-NO                                 05480003
054900                    MOVE 'Y'         TO SUAUPC-UPC-CERTD-IND      05490003
055000                    PERFORM 1700-CERTIFY-UPC                      05500003
055100                    PERFORM 1410-UPDATE-AUDIT-ROW                 05510003
055200                 END-IF                                           05520003
055300                                                                  05530003
055400             END-IF                                               05540003
055500             IF SU006-BULK-CSPK-PKGNG-CDE                         05550003
055600                MOVE PC-UPC-KEY-QTY-PROGRAM                       05560003
055700                                     TO  PV-TRANSFER-PROGRAM      05570003
055800             ELSE                                                 05580003
055900*02/01/14 RK BEG                                                * 05590008
056000                IF SU006-QC-AND-RFID-AUD                          05600003
056100                  MOVE PC-UPC-RFID-KEY-PGM-NAME                   05610003
056200                                     TO  PV-TRANSFER-PROGRAM      05620003
056300                ELSE                                              05630003
056400                MOVE PC-UPC-SCAN-PROGRAM-NAME                     05640003
056500                                     TO  PV-TRANSFER-PROGRAM      05650003
056600                END-IF                                            05660003
056700*02/01/14 RK END                                                * 05670008
056800             END-IF                                               05680003
056900             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                05690003
057000                                                                  05700003
057100         WHEN EIBAID = DFHPF1                                     05710003
057200              PERFORM 1300-HELP-SCREEN                            05720003
057300                                                                  05730003
057400*        THE "DAMAGED" MDSE KEY WAS PRESSED, CREATE EXCEPTION AND 05740003
057500*        STAY ON THIS SCREEN                                      05750003
057600         WHEN EIBAID = DFHPF4 AND CA-F4-NOT-PRESSED-YET           05760003
057700             SET CA-F4-PRESSED        TO TRUE                     05770003
057800             MOVE PC-AFTER-DAMAGE-KEYS-MSG                        05780003
057900                                      TO AMSGLNO                  05790003
058000             MOVE PC-CARTON-AUDIT-GROUP-CODE                      05800003
058100                                      TO SUEXCP-VILN-GP-CDE       05810003
058200             MOVE PC-DMGD-MDSE-VILN-SEQ                           05820003
058300                                      TO SUEXCP-VILN-GP-SEQ-NBR   05830003
058400             PERFORM 1501-CREATE-EXCEPTION                        05840003
058500                                                                  05850003
058600*        THE "WRONG" KEY WAS PRESSED -- CONTROL IS PASSED TO THE  05860003
058700*        TICKET NO MATCH SCREEN                                   05870003
058800         WHEN EIBAID = DFHPF9                                     05880003
058900             MOVE PC-TIX-NO-MTCH-PROGRAM-NAME                     05890003
059000                                        TO  PV-TRANSFER-PROGRAM   05900003
059100             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                05910003
059200                                                                  05920003
059300         WHEN OTHER                                               05930003
059400             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         05940003
059500                                                                  05950003
059600     END-EVALUATE.                                                05960003
059700                                                                  05970003
059800     PERFORM 8100-SEND-DATA-ONLY.                                 05980003
059900     PERFORM 8200-RETURN-TRANID.                                  05990003
060000                                                                  06000003
060100     GOBACK.                                                      06010003
060200                                                                  06020003
060300 1000-SETUP-SCREEN.                                               06030003
060400                                                                  06040003
060500*    DETERMINE IF THE ITEM EXISTS                                 06050003
060600     PERFORM 1010-LOOKUP-ITEM.                                    06060003
060700                                                                  06070003
060800*    GET THE SIZE                                                 06080003
060900     PERFORM 1130-GET-SIZE.                                       06090003
061000                                                                  06100003
061100*    GET THE VENDOR STYLE                                         06110003
061200     PERFORM 1140-GET-VENDOR-STYLE.                               06120003
061300                                                                  06130003
061400*    GET THE VENDOR-NAME                                          06140003
061500     PERFORM 1150-GET-VENDOR-NAME.                                06150003
061600                                                                  06160003
061700*    MOVE ITEM INFORMATION TO THE SCREEN                          06170003
061800     MOVE SU006-UPC-X           TO AUPCO.                         06180003
061900                                                                  06190003
062000     MOVE SU006-SKU-DPT         TO ADEPTO                         06200003
062100     MOVE SU006-SKU-MAJ-CLASS   TO AMAJCLSO                       06210003
062200     MOVE SU006-SKU-SUB-CLASS   TO ASUBCLSO                       06220003
062300                                                                  06230003
062400     MOVE CA-SKU-DESC        TO ASKDESCO.                         06240003
062500                                                                  06250003
062600     MOVE CA-COLOR           TO ACOLORO.                          06260003
062700                                                                  06270003
062800     MOVE CA-RETAIL             TO ARETAILO.                      06280003
062900                                                                  06290003
063000     MOVE CA-SIZE               TO ASIZEO.                        06300003
063100                                                                  06310003
063200     MOVE CA-VENDOR-STYLE       TO ASTYLEO.                       06320003
063300                                                                  06330003
063400     MOVE CA-VENDOR-NAME        TO AVNDNMEO.                      06340003
063500                                                                  06350003
063600     MOVE CA-HANG-FOLD          TO AHFMO.                         06360003
063700     MOVE CA-GOH-IND                  TO AHANGO.                  06370003
063800                                                                  06380003
063900*    SET-UP KEYS MESSAGE LINE                                     06390003
064000     MOVE PC-INITIAL-KEYS-MSG   TO AMSGLNO.                       06400003
064100                                                                  06410003
064200 1010-LOOKUP-ITEM.                                                06420003
064300                                                                  06430003
064400*    IF COMING FROM THE SKU SCAN SCREEN, DO A LOOKUP BY SKU       06440003
064500                                                                  06450003
064600     IF SU006-LAST-PROGRAM = PC-SKU-SCAN-PROGRAM-NAME             06460003
064700         PERFORM 1120-GET-SKU-INFO                                06470003
064800     ELSE                                                         06480003
064900         PERFORM 1100-SELECT-ITEM-BY-UPC-NBR                      06490003
065000     END-IF                                                       06500003
065100                                                                  06510003
065200     PERFORM 7200-GET-GARMENT-ON-HANGER.                          06520003
065300                                                                  06530003
065400     MOVE XL001-CERTD-IND             TO SU006-UPC-CERTIFIED-IND  06540003
065500     MOVE XL001-HNG-FOLD-CDE          TO CA-HANG-FOLD.            06550003
065600                                                                  06560003
065700                                                                  06570003
065800 1100-SELECT-ITEM-BY-UPC-NBR.                                     06580003
065900                                                                  06590003
066000     INITIALIZE XL001-ITEM-COMMAREA.                              06600009
066100     SET XL001-SELECT-SKU                                         06610003
066200         XL001-SELECT-VND-STYL                                    06620003
066300         XL001-SELECT-SKU-STR                                     06630003
066400***      XL001-SELECT-WEB-SKU                                     06640006
066500         XL001-SELECT-UPC                                         06650003
066600         XL001-BY-UPC-NBR             TO TRUE.                    06660009
066700                                                                  06670003
066800     MOVE SU006-UPC                   TO XL001-KEY-UPC-NBR        06680003
066900                                         PV-DISP-VALUE.           06690009
067000                                                                  06700003
067100     PERFORM 8600-CALL-XLKUT001.                                  06710003
067200                                                                  06720003
067300     EVALUATE TRUE                                                06730003
067400         WHEN XL001-SUCCESSFUL                                    06740003
067500             SET CA-UPC-FOUND        TO TRUE                      06750003
067600*ONLY VALIDATE THE UPC, DO NOT OVERLAY THE VENDOR UPC WITH        06760003
067700*THE INTERNAL CODE 4 UPC                                          06770003
067800             MOVE XL001-CSTM-CLOR-DESC TO CA-COLOR                06780003
067900             MOVE XL001-SKU-NBR       TO SU006-NUMERIC-SKU        06790003
068000             MOVE XL001-DEPT-NBR      TO SU006-SKU-DPT            06800003
068100             MOVE XL001-MAJ-CL-NBR-2CH TO SU006-SKU-MAJ-CLASS     06810003
068200             MOVE XL001-SUB-CL-NBR-2CH TO SU006-SKU-SUB-CLASS     06820003
068300             MOVE XL001-SKU-DESC      TO CA-SKU-DESC              06830003
068400             MOVE XL001-UNT-RTL-AMT                               06840003
068500                                      TO CA-RETAIL                06850003
068600             MOVE XL001-HNG-FOLD-CDE  TO CA-HANG-FOLD             06860003
068700         WHEN XL001-UPC-NOT-FOUND                                 06870003
068800             SET CA-UPC-NOT-FOUND TO TRUE                         06880003
068900             IF SU006-NO-UPC-LOOKUP-ERROR                         06890003
069000                 SET SU006-UPC-NOT-FOUND-ERROR                    06900003
069100                                      TO TRUE                     06910003
069200             END-IF                                               06920003
069300                                                                  06930003
069400*            SET UP MESSAGE SCREEN                                06940003
069500             SET PM-UPC-NOT-FOUND     TO TRUE                     06950003
069600             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        06960003
069700             MOVE PC-MESSAGE-SCREEN-PROGRAM-NAME                  06970003
069800                                      TO PV-TRANSFER-PROGRAM      06980003
069900             MOVE PC-SKU-SCAN-PROGRAM-NAME TO SU006-LAST-PROGRAM  06990003
070000                                                                  07000003
070100             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                07010003
070200             MOVE SPACES             TO CA-COLOR                  07020003
070300         WHEN OTHER                                               07030003
070400             MOVE '1100-SELECT-ITEM-BY-UPC-NBR'                   07040003
070500                                   TO DP013-PARAGRAPH             07050003
070600             MOVE 'CALL TO DPKUT800' TO DP013-MESSAGE-TEXT (1)    07060003
070700             MOVE SU006-UPC-X      TO DP013-MESSAGE-TEXT (2)      07070003
070800             STRING ' ERROR PARAGRAPH = '                         07080003
070900                 XL001-ERROR-PARAGRAPH-NBR                        07090003
071000                 DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT (3)    07100003
071100             MOVE XL001-SQLCA      TO DP013-SQLCA                 07110003
071200             MOVE 'XKUT001'        TO DP013-DB2-TABLE-NAME (1)    07120003
071300             SET DP013-DB2-ABEND   TO TRUE                        07130003
071400             SET DP013-NO-ROLLBACK TO TRUE                        07140003
071500             PERFORM 9999-WRITE-CICS-LOG-MSG                      07150003
071600             MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         07160003
071700             SET CA-RETURN-ERROR         TO TRUE                  07170003
071800                                                                  07180003
071900*            RETURN TO THE PROGRAM THAT CALLED IT                 07190003
072000             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   07200003
072100             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                07210003
072200     END-EVALUATE.                                                07220003
072300                                                                  07230003
072400 1120-GET-SKU-INFO.                                               07240003
072500                                                                  07250003
072600     INITIALIZE XL001-ITEM-COMMAREA.                              07260003
072700                                                                  07270003
072800     SET XL001-SELECT-SKU                                         07280003
072900         XL001-SELECT-VND-STYL                                    07290003
073000         XL001-SELECT-SKU-STR                                     07300003
073100****     XL001-SELECT-WEB-SKU                                     07310007
073200         XL001-SELECT-UPC                                         07320003
073300         XL001-BY-NUMERIC-SKU         TO TRUE.                    07330009
073400                                                                  07340003
073500     MOVE SU006-NUMERIC-SKU           TO XL001-KEY-SKU            07350003
073600                                         PV-DISP-VALUE.           07360009
073700                                                                  07370003
073800     PERFORM 8600-CALL-XLKUT001.                                  07380003
073900                                                                  07390003
074000     EVALUATE TRUE                                                07400003
074100         WHEN XL001-SUCCESSFUL                                    07410003
074200             SET CA-SKU-FOUND        TO TRUE                      07420003
074300             MOVE XL001-UPC-NBR       TO SU006-UPC                07430003
074400             MOVE XL001-CSTM-CLOR-DESC TO CA-COLOR                07440003
074500             MOVE XL001-UPC-ID        TO CA-INTERNAL-UPC          07450003
074600             MOVE XL001-DEPT-NBR      TO SU006-SKU-DPT            07460003
074700             MOVE XL001-MAJ-CL-NBR    TO SU006-SKU-MAJ-CLASS      07470003
074800             MOVE XL001-SUB-CL-NBR    TO SU006-SKU-SUB-CLASS      07480003
074900             MOVE XL001-SKU-DESC      TO CA-SKU-DESC              07490003
075000             MOVE XL001-UNT-RTL-AMT   TO CA-RETAIL                07500003
075100             MOVE XL001-HNG-FOLD-CDE  TO CA-HANG-FOLD             07510003
075200         WHEN XL001-SKU-NOT-FOUND                                 07520003
075300         WHEN XL001-VND-STYL-NOT-FOUND                            07530003
075400         WHEN XL001-SKU-STR-NOT-FOUND                             07540003
075500             SET CA-SKU-NOT-FOUND                                 07550003
075600                 SU006-SKU-NOT-FOUND-ERROR                        07560003
075700                 SU006-STYLE-SUB-ERROR TO TRUE                    07570003
075800                                                                  07580003
075900*            SET UP MESSAGE                                       07590003
076000             SET PM-SKU-NOT-FOUND     TO TRUE                     07600003
076100             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        07610003
076200             MOVE PC-MESSAGE-SCREEN-PROGRAM-NAME                  07620003
076300                                      TO PV-TRANSFER-PROGRAM      07630003
076400             MOVE PC-DATA-INFO-PROGRAM-NAME                       07640003
076500                                      TO SU006-LAST-PROGRAM       07650003
076600             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                07660003
076700         WHEN OTHER                                               07670003
076800             MOVE '1120-GET-SKU-INFO'                             07680003
076900                                   TO DP013-PARAGRAPH             07690003
077000             MOVE 'CALL TO XLKUT001' TO DP013-MESSAGE-TEXT (1)    07700003
077100             MOVE SU006-SKU-NBR       TO DP013-MESSAGE-TEXT (2)   07710003
077200             STRING ' ERROR PARA = ' XL001-ERROR-PARAGRAPH-NBR    07720003
077300                 DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT (3)    07730003
077400             MOVE XL001-SQLCA      TO DP013-SQLCA                 07740003
077500             SET DP013-DB2-ABEND   TO TRUE                        07750003
077600             SET DP013-NO-ROLLBACK TO TRUE                        07760003
077700             PERFORM 9999-WRITE-CICS-LOG-MSG                      07770003
077800             MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         07780003
077900             SET CA-RETURN-ERROR         TO TRUE                  07790003
078000*                                                                 07800003
078100*            RETURN TO THE PROGRAM THAT CALLED IT                 07810003
078200             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   07820003
078300             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                07830003
078400     END-EVALUATE.                                                07840003
078500                                                                  07850003
078600 1130-GET-SIZE.                                                   07860003
078700     MOVE XL001-SIZE-DESC         TO CA-SIZE.                     07870003
078800                                                                  07880003
078900                                                                  07890003
079000 1140-GET-VENDOR-STYLE.                                           07900003
079100                                                                  07910003
079200     MOVE XL001-VS-NBR                TO CA-VENDOR-STYLE          07920003
079300                                         CA-VENDOR-VS-NBR         07930003
079400     MOVE XL001-ENT-ID                TO CA-VENDOR-ENT-ID         07940003
079500     MOVE XL001-INTR-UPC-ID           TO CA-INTR-UPC-ID.          07950003
079600                                                                  07960003
079700 1150-GET-VENDOR-NAME.                                            07970003
079800                                                                  07980003
079900     EXEC SQL                                                     07990003
080000         SELECT                                                   08000003
080100                 A.ENT_NAME_DESC                                  08010003
080200               , B.ENT_ID                                         08020003
080300         INTO                                                     08030003
080400                 :ENTNME-ENT-NAME-DESC                            08040003
080500               , :PURCHS-ENT-ID                                   08050003
080600         FROM                                                     08060003
080700                 TENTNME A                                        08070003
080800               , TPURCHS B                                        08080003
080900         WHERE                                                    08090003
081000               B.PO_NBR         = :SU006-PO                       08100003
081100           AND B.VER_STATUS_CDE = 'A'                             08110003
081200           AND A.ENT_ID         = B.ENT_ID                        08120003
081300           AND A.TYPE_CDE       = '04'                            08130003
081400     END-EXEC.                                                    08140003
081500                                                                  08150003
081600     EVALUATE TRUE                                                08160003
081700         WHEN SQLCODE = ZERO                                      08170003
081800             MOVE ENTNME-ENT-NAME-DESC                            08180003
081900                                   TO CA-VENDOR-NAME              08190003
082000                                                                  08200003
082100*        IF THE SHORT VENDOR NAME WAS NOT FOUND, TRY THE LONG     08210003
082200         WHEN SQLCODE = +100                                      08220003
082300             PERFORM 1151-GET-LONG-VND-NAME                       08230003
082400                                                                  08240003
082500         WHEN SQLWARN0 NOT = SPACES                               08250003
082600         WHEN SQLCODE < ZERO                                      08260003
082700         WHEN SQLCODE > ZERO                                      08270003
082800             MOVE '1150-GET-VENDOR-NAME'                          08280003
082900                                   TO DP013-PARAGRAPH             08290003
083000             MOVE 'SELECT OF VENDOR NAME '                        08300003
083100                                   TO DP013-MESSAGE-TEXT (1)      08310003
083200             MOVE SU006-PO         TO DP013-MESSAGE-TEXT (2)      08320003
083300             MOVE SQLCA            TO DP013-SQLCA                 08330003
083400             MOVE 'TPURCHS'        TO DP013-DB2-TABLE-NAME (1)    08340003
083500             MOVE 'TENTNME'        TO DP013-DB2-TABLE-NAME (2)    08350003
083600             SET DP013-DB2-ABEND   TO TRUE                        08360003
083700             SET DP013-NO-ROLLBACK TO TRUE                        08370003
083800             PERFORM 9999-WRITE-CICS-LOG-MSG                      08380003
083900             MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         08390003
084000             SET CA-RETURN-ERROR         TO TRUE                  08400003
084100                                                                  08410003
084200*            RETURN TO THE PROGRAM THAT CALLED IT                 08420003
084300             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   08430003
084400             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                08440003
084500     END-EVALUATE.                                                08450003
084600                                                                  08460003
084700                                                                  08470003
084800 1151-GET-LONG-VND-NAME.                                          08480003
084900                                                                  08490003
085000     EXEC SQL                                                     08500003
085100         SELECT                                                   08510003
085200                 A.ENT_NAME_DESC                                  08520003
085300         INTO                                                     08530003
085400                 :ENTNME-ENT-NAME-DESC                            08540003
085500         FROM                                                     08550003
085600                 TENTNME A                                        08560003
085700         WHERE                                                    08570003
085800               A.ENT_ID         = :PURCHS-ENT-ID                  08580003
085900           AND A.TYPE_CDE       = '01'                            08590003
086000     END-EXEC.                                                    08600003
086100                                                                  08610003
086200     EVALUATE TRUE                                                08620003
086300         WHEN SQLCODE = ZERO                                      08630003
086400             MOVE ENTNME-ENT-NAME-DESC                            08640003
086500                                   TO CA-VENDOR-NAME              08650003
086600                                                                  08660003
086700         WHEN SQLCODE = +100                                      08670003
086800             MOVE SPACES           TO CA-VENDOR-NAME              08680003
086900                                                                  08690003
087000         WHEN SQLWARN0 NOT = SPACES                               08700003
087100         WHEN SQLCODE < ZERO                                      08710003
087200         WHEN SQLCODE > ZERO                                      08720003
087300             MOVE '1151-GET-LONG-VND-NAME'                        08730003
087400                                   TO DP013-PARAGRAPH             08740003
087500             MOVE 'SELECT OF VENDOR NAME'                         08750003
087600                                   TO DP013-MESSAGE-TEXT (1)      08760003
087700             MOVE PURCHS-ENT-ID    TO DP013-MESSAGE-TEXT (2)      08770003
087800             MOVE SQLCA            TO DP013-SQLCA                 08780003
087900             MOVE 'TENTNME'        TO DP013-DB2-TABLE-NAME (1)    08790003
088000             SET DP013-DB2-ABEND   TO TRUE                        08800003
088100             SET DP013-NO-ROLLBACK TO TRUE                        08810003
088200             PERFORM 9999-WRITE-CICS-LOG-MSG                      08820003
088300             MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         08830003
088400             SET CA-RETURN-ERROR         TO TRUE                  08840003
088500                                                                  08850003
088600*            RETURN TO THE PROGRAM THAT CALLED IT                 08860003
088700             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   08870003
088800             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                08880003
088900     END-EVALUATE.                                                08890003
089000                                                                  08900003
089100*                                                                 08910003
089200 1300-HELP-SCREEN.                                                08920003
089300     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      08930003
089400     MOVE 'SUKRF513'                  TO PC192-PROGRAM-NAME       08940003
089500     COPY PCPD188.                                                08950003
089600     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      08960003
089700     PERFORM 2200-XCTL-TO-HELP.                                   08970003
089800                                                                  08980003
089900                                                                  08990003
090000***************************************************************** 09000003
090100*   1400-CREATE-AUDIT-ROW                                       * 09010003
090200* CREATE AN AUDIT ROW FOR THE SCANNED/ENTERED UPC (OR ZEROS IF  * 09020003
090300* THERE IS NO UPC ENTERED                                       * 09030003
090400***************************************************************** 09040003
090500 1400-CREATE-AUDIT-ROW.                                           09050003
090600                                                                  09060003
090700     MOVE SU006-AUDIT-CNTL-NBR          TO SUAUPC-AUD-CNTL-NBR.   09070003
090800     MOVE SU006-SHIP-UNIT-NBR           TO SUAUPC-SHIPT-UNT-ID.   09080003
090900     MOVE SU006-UPC                     TO SUAUPC-UPC-NBR.        09090003
091000     MOVE SU006-USERID                  TO SUAUPC-AUD-USR-ID.     09100003
091100     MOVE CA-RETAIL                     TO SUAUPC-UPC-RTL-AMT.    09110003
091200     MOVE SU006-NUMERIC-SKU             TO SUAUPC-SKU-NBR         09120003
091300     MOVE CA-SKU-DESC                   TO SUAUPC-ITM-DESC        09130003
091400     MOVE CA-VENDOR-STYLE               TO SUAUPC-VND-STYL-DESC   09140003
091500     MOVE CA-COLOR                      TO SUAUPC-UPC-CLOR-DESC   09150003
091600     MOVE CA-SIZE                       TO SUAUPC-UPC-SIZE-DESC   09160003
091700     MOVE XL001-DEPT-NBR                TO SUAUPC-DEPT-NBR        09170003
091800     MOVE XL001-MAJ-CL-NBR              TO SUAUPC-MAJ-CL-NBR      09180003
091900     MOVE XL001-SUB-CL-NBR              TO SUAUPC-SUB-CL-NBR      09190003
092000** FOR PREPACKS, THE SCANNED TYPE IS 'P' FOR PREPACKS, 'O'        09200003
092100** FOR ODD UNITS OTHERWISE 'S' FOR THE DEFAULT OF SCANNED         09210003
092200** IF THE PREPACK IS CLOSED BY THE ASSOCIATE, ANY OTHER ITMES     09220003
092300** SCANNED ARE ODD UNITS                                          09230003
092400     IF SU006-PREPK-ITYPE-PKGNG-CDE                               09240003
092500        IF SU006-PREPACK-CLOSED                                   09250003
092600           MOVE PC-O        TO SUAUPC-SCN-TYP-CDE                 09260003
092700        ELSE                                                      09270003
092800           MOVE PC-P        TO SUAUPC-SCN-TYP-CDE                 09280003
092900        END-IF                                                    09290003
093000     ELSE                                                         09300003
093100        MOVE PC-S        TO SUAUPC-SCN-TYP-CDE                    09310003
093200     END-IF                                                       09320003
093300                                                                  09330003
093400                                                                  09340003
093500*    CONTINUE TO TRY INSERTING UNTIL SUCCESSFUL...IF -803 SQLCODE,09350003
093600*    RETRY WITH THE NEW TIMESTAMP (PART OF THE KEY)               09360003
093700     PERFORM                                                      09370003
093800         WITH TEST AFTER                                          09380003
093900         VARYING PV-RETRY-COUNTER                                 09390003
094000         FROM 1 BY 1                                              09400003
094100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09410003
094200                   OR (SQLCODE = ZERO))                           09420003
094300                                                                  09430003
094400         EXEC SQL                                                 09440003
094500             SET :SUAUPC-SCN-TMST = CURRENT TIMESTAMP             09450003
094600         END-EXEC                                                 09460003
094700                                                                  09470003
094800         EXEC SQL                                                 09480003
094900             INSERT INTO TSUAUPC                                  09490003
095000                 ( AUD_CNTL_NBR                                   09500003
095100                  ,SHIPT_UNT_ID                                   09510003
095200                  ,UPC_NBR                                        09520003
095300                  ,SCN_TMST                                       09530003
095400                  ,AUD_USR_ID                                     09540003
095500                  ,DEPT_NBR                                       09550003
095600                  ,MAJ_CL_NBR                                     09560003
095700                  ,SUB_CL_NBR                                     09570003
095800                  ,ITM_DESC                                       09580003
095900                  ,VND_STYL_DESC                                  09590003
096000                  ,UPC_CLOR_DESC                                  09600003
096100                  ,UPC_SIZE_DESC                                  09610003
096200                  ,UPC_RTL_AMT                                    09620003
096300                  ,UPC_CERTD_IND                                  09630003
096400                  ,SCN_TYP_CDE                                    09640003
096500                  ,SKU_NBR                                        09650003
096600                 )                                                09660003
096700             VALUES                                               09670003
096800                 (                                                09680003
096900                    :SUAUPC-AUD-CNTL-NBR                          09690003
097000                  , :SUAUPC-SHIPT-UNT-ID                          09700003
097100                  , :SUAUPC-UPC-NBR                               09710003
097200                  , :SUAUPC-SCN-TMST                              09720003
097300                  , :SUAUPC-AUD-USR-ID                            09730003
097400                  , :SUAUPC-DEPT-NBR                              09740003
097500                  , :SUAUPC-MAJ-CL-NBR                            09750003
097600                  , :SUAUPC-SUB-CL-NBR                            09760003
097700                  , :SUAUPC-ITM-DESC                              09770003
097800                  , :SUAUPC-VND-STYL-DESC                         09780003
097900                  , :SUAUPC-UPC-CLOR-DESC                         09790003
098000                  , :SUAUPC-UPC-SIZE-DESC                         09800003
098100                  , :SUAUPC-UPC-RTL-AMT                           09810003
098200                  , :SUAUPC-UPC-CERTD-IND                         09820003
098300                  , :SUAUPC-SCN-TYP-CDE                           09830003
098400                  , :SUAUPC-SKU-NBR                               09840003
098500                 )                                                09850003
098600         END-EXEC                                                 09860003
098700                                                                  09870003
098800         EVALUATE TRUE                                            09880003
098900             WHEN SQLCODE = ZERO                                  09890003
099000                 MOVE SUAUPC-SCN-TMST        TO SU006-SCN-TMST    09900003
099100             WHEN SQLCODE = -803                                  09910003
099200                 CONTINUE                                         09920003
099300             WHEN SQLWARN0 NOT = SPACES                           09930003
099400             WHEN SQLCODE < ZERO                                  09940003
099500             WHEN SQLCODE > ZERO                                  09950003
099600                 MOVE '1400-CREATE-AUDIT-ROW'                     09960003
099700                                             TO DP013-PARAGRAPH   09970003
099800                 MOVE 'INSERT TSUAUPC'  TO DP013-MESSAGE-TEXT(1)  09980003
099900                 MOVE SUAUPC-AUD-CNTL-NBR                         09990003
100000                                        TO PV-DISP-AUD-CNTL-NBR   10000003
100100                 MOVE SUAUPC-SHIPT-UNT-ID                         10010003
100200                                        TO PV-DISP-SHIPT-UNT-ID   10020003
100300                 MOVE SUAUPC-UPC-NBR    TO PV-DISP-UPC-NBR        10030003
100400                 MOVE SUAUPC-SCN-TMST   TO PV-DISP-SCN-TMST       10040003
100500                 MOVE PV-DISPLAY-KEYS   TO DP013-MESSAGE-TEXT(2)  10050003
100600                 MOVE SQLCA                  TO DP013-SQLCA       10060003
100700                 MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME(1) 10070003
100800                 SET DP013-DB2-ABEND         TO TRUE              10080003
100900                 SET DP013-NO-ROLLBACK       TO TRUE              10090003
101000                 SET SU006-INITIALIZE-SCREEN TO TRUE              10100003
101100                 PERFORM 9999-WRITE-CICS-LOG-MSG                  10110003
101200                 MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO           10120003
101300                 PERFORM 8100-SEND-DATA-ONLY                      10130003
101400                 PERFORM 8200-RETURN-TRANID                       10140003
101500         END-EVALUATE                                             10150003
101600     END-PERFORM.                                                 10160003
101700                                                                  10170003
101800                                                                  10180003
101900***************************************************************** 10190003
102000*   1410-UPDATE-AUDIT-ROW                                       * 10200003
102100* THE UPC WAS CERTIFIED, UPDATE THE CERTIFICATION INIDICATOR ON * 10210003
102200* TSUAUPC.                                                      * 10220003
102300***************************************************************** 10230003
102400 1410-UPDATE-AUDIT-ROW.                                           10240003
102500                                                                  10250003
102600      MOVE SU006-AUDIT-CNTL-NBR TO SUAUPC-AUD-CNTL-NBR.           10260003
102700      MOVE SU006-SHIP-UNIT-NBR TO SUAUPC-SHIPT-UNT-ID.            10270003
102800      MOVE SU006-UPC          TO SUAUPC-UPC-NBR.                  10280003
102900                                                                  10290003
103000         EXEC SQL                                                 10300003
103100             UPDATE TSUAUPC                                       10310003
103200             SET UPC_CERTD_IND  = :SUAUPC-UPC-CERTD-IND           10320003
103300             WHERE AUD_CNTL_NBR = :SUAUPC-AUD-CNTL-NBR            10330003
103400               AND SHIPT_UNT_ID = :SUAUPC-SHIPT-UNT-ID            10340003
103500               AND UPC_NBR      = :SUAUPC-UPC-NBR                 10350003
103600         END-EXEC                                                 10360003
103700                                                                  10370003
103800         EVALUATE TRUE                                            10380003
103900             WHEN SQLCODE = ZERO                                  10390003
104000                 CONTINUE                                         10400003
104100             WHEN SQLWARN0 NOT = SPACES                           10410003
104200             WHEN SQLCODE < ZERO                                  10420003
104300             WHEN SQLCODE > ZERO                                  10430003
104400                 MOVE '1410-UPDATE-AUDIT-ROW'                     10440003
104500                                             TO DP013-PARAGRAPH   10450003
104600                 MOVE 'UPDATE TSUAUPC'  TO DP013-MESSAGE-TEXT(1)  10460003
104700                 MOVE SU006-AUDIT-CNTL-NBR                        10470003
104800                                        TO PV-DISP-AUD-CNTL-NBR   10480003
104900                 MOVE SU006-SHIP-UNIT-NBR                         10490003
105000                                        TO PV-DISP-SHIPT-UNT-ID   10500003
105100                 MOVE SU006-UPC         TO PV-DISP-UPC-NBR        10510003
105200                 MOVE SU006-SCN-TMST    TO PV-DISP-SCN-TMST       10520003
105300                 MOVE PV-DISPLAY-KEYS   TO DP013-MESSAGE-TEXT(2)  10530003
105400                 MOVE SQLCA                  TO DP013-SQLCA       10540003
105500                 MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME(1) 10550003
105600                 SET DP013-DB2-ABEND         TO TRUE              10560003
105700                 SET DP013-NO-ROLLBACK       TO TRUE              10570003
105800                 PERFORM 9999-WRITE-CICS-LOG-MSG                  10580003
105900                 MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO           10590003
106000                 PERFORM 8100-SEND-DATA-ONLY                      10600003
106100                 PERFORM 8200-RETURN-TRANID                       10610003
106200         END-EVALUATE.                                            10620003
106300                                                                  10630003
106400***************************************************************** 10640003
106500*   1500-CHECK-EXCEPTIONS                                       * 10650003
106600* CHECK FLAGS TO DETERMINE WHICH EXCEPTIONS WERE FOUND DURING   * 10660003
106700* THE LOOKUP PROCESS                                            * 10670003
106800***************************************************************** 10680003
106900 1500-CHECK-EXCEPTIONS.                                           10690003
107000                                                                  10700003
107100     MOVE PC-CARTON-AUDIT-GROUP-CODE  TO SUEXCP-VILN-GP-CDE.      10710003
107200                                                                  10720003
107300*    IF A BARCODE LOOK-UP PROBLEM EXISTS FROM THE UPC SCAN SCREEN 10730003
107400*    CREATE AN EXCEPTION                                          10740003
107500     IF SU006-NO-BARCODE-LOOKUP-ERROR                             10750003
107600         CONTINUE                                                 10760003
107700     ELSE                                                         10770003
107800         MOVE SU006-BARCODE-LOOKUP-IND TO SUEXCP-VILN-GP-SEQ-NBR  10780003
107900         SET SU006-NO-BARCODE-LOOKUP-ERROR                        10790003
108000                                      TO TRUE                     10800003
108100         PERFORM 1501-CREATE-EXCEPTION                            10810003
108200     END-IF.                                                      10820003
108300                                                                  10830003
108400*    IF A UPC-LOOKUP PROBLEM EXISTS FROM THE UPC SCAN SCREEN      10840003
108500*    CREATE AN EXCEPTION                                          10850003
108600     IF SU006-NO-UPC-LOOKUP-ERROR                                 10860003
108700        CONTINUE                                                  10870003
108800     ELSE                                                         10880003
108900        MOVE SU006-UPC-LOOKUP-IND     TO SUEXCP-VILN-GP-SEQ-NBR   10890003
109000        SET SU006-NO-UPC-LOOKUP-ERROR    TO TRUE                  10900003
109100        PERFORM 1501-CREATE-EXCEPTION                             10910003
109200     END-IF.                                                      10920003
109300                                                                  10930003
109400*    WHEN A PO ALLOCATION PROBLEM OR A CARTONIZATION PROBLEM      10940003
109500*    EXISTS, CREATE THE EXCEPTION(S) AND XCTL TO THE MESSAGE      10950003
109600*    SCREEN.  WE ARE ONLY GOING TO GO TO THE MESSAGE SCREEN       10960003
109700*    ONCE PER "LOOKUP", SO BOTH ERRORS HAVE TO BE CHECKED AND     10970003
109800*    THE APPROPRIATE MESSAGE PARMS SET-UP FOR ALL COMBINATIONS    10980003
109900     MOVE PC-MESSAGE-SCREEN-PROGRAM-NAME                          10990003
110000                                      TO PV-TRANSFER-PROGRAM      11000003
110100     MOVE PC-CURRENT-PROGRAM-NAME     TO SU006-LAST-PROGRAM       11010003
110200     MOVE PC-CARTON-AUDIT-GROUP-CODE  TO SUEXCP-VILN-GP-CDE       11020003
110300                                                                  11030003
110400     EVALUATE TRUE                                                11040003
110500     WHEN SU006-NO-PO-ALLOC-ERROR                                 11050003
110600         IF SU006-NO-UPC-CARTON-ERROR                             11060003
110700               CONTINUE                                           11070003
110800         ELSE                                                     11080003
110900*            CARTONIZATION EXCEPTION                              11090003
111000             MOVE SU006-UPC-CARTON-IND                            11100004
111100                                      TO SUEXCP-VILN-GP-SEQ-NBR   11110004
111200             SET SU006-NO-UPC-CARTON-ERROR                        11120003
111300                                      TO TRUE                     11130003
111400             PERFORM 1501-CREATE-EXCEPTION                        11140003
111500*            XCTL TO MESSAGE SCREEN                               11150003
111600             SET PM-UPC-NOT-ON-CRTN   TO TRUE                     11160003
111700             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        11170003
111800             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                11180003
111900         END-IF                                                   11190003
112000                                                                  11200003
112100     WHEN SU006-STYLE-SUB-ERROR                                   11210003
112200         IF SU006-NO-UPC-CARTON-ERROR                             11220003
112300*            STYLE SUB EXCEPTION                                  11230003
112400             MOVE SU006-PO-ALLOC-IND  TO SUEXCP-VILN-GP-SEQ-NBR   11240003
112500             SET SU006-NO-PO-ALLOC-ERROR TO TRUE                  11250003
112600             PERFORM 1501-CREATE-EXCEPTION                        11260003
112700*            XCTL TO MESSAGE SCREEN                               11270003
112800             SET PM-STYLE-SUB         TO TRUE                     11280003
112900             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        11290003
113000             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                11300003
113100         ELSE                                                     11310003
113200*            CARTONIZATION EXCEPTION                              11320003
113300             MOVE SU006-UPC-CARTON-IND TO SUEXCP-VILN-GP-SEQ-NBR  11330003
113400             SET SU006-NO-UPC-CARTON-ERROR                        11340004
113500                                      TO TRUE                     11350004
113600             PERFORM 1501-CREATE-EXCEPTION                        11360003
113700*            STYLE SUB EXCEPTION                                  11370003
113800             MOVE SU006-PO-ALLOC-IND  TO SUEXCP-VILN-GP-SEQ-NBR   11380003
113900             SET SU006-NO-PO-ALLOC-ERROR TO TRUE                  11390003
114000             PERFORM 1501-CREATE-EXCEPTION                        11400003
114100*            XCTL TO MESSAGE SCREEN                               11410003
114200             SET PM-STYLE-SUB-NOT-ON-CRTN                         11420003
114300                                      TO TRUE                     11430003
114400             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        11440003
114500             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                11450003
114600         END-IF                                                   11460003
114700                                                                  11470003
114800     WHEN SU006-BULK-MISDIRECT-ERROR                              11480003
114900         IF SU006-NO-UPC-CARTON-ERROR                             11490003
115000*            BULK MISDIRECT EXCEPTION                             11500003
115100             MOVE SU006-PO-ALLOC-IND  TO SUEXCP-VILN-GP-SEQ-NBR   11510003
115200             SET SU006-NO-PO-ALLOC-ERROR TO TRUE                  11520003
115300             PERFORM 1501-CREATE-EXCEPTION                        11530003
115400*            XCTL TO MESSAGE SCREEN                               11540003
115500             SET PM-MISDIRECT         TO TRUE                     11550003
115600             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        11560003
115700             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                11570003
115800         ELSE                                                     11580003
115900*            CARTONIZATION EXCEPTION                              11590003
116000             MOVE SU006-UPC-CARTON-IND TO SUEXCP-VILN-GP-SEQ-NBR  11600003
116100             SET SU006-NO-UPC-CARTON-ERROR                        11610003
116200                                      TO TRUE                     11620003
116300             PERFORM 1501-CREATE-EXCEPTION                        11630003
116400*            BULK MISDIRECT EXCEPTION                             11640003
116500             MOVE SU006-PO-ALLOC-IND  TO SUEXCP-VILN-GP-SEQ-NBR   11650003
116600             SET SU006-NO-PO-ALLOC-ERROR TO TRUE                  11660003
116700             PERFORM 1501-CREATE-EXCEPTION                        11670003
116800*            XCTL TO MESSAGE SCREEN                               11680003
116900             SET PM-MISDIRECT-NOT-ON-CRTN                         11690003
117000                                      TO TRUE                     11700003
117100             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        11710003
117200             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                11720003
117300         END-IF                                                   11730003
117400                                                                  11740003
117500     WHEN SU006-PBS-NO-ALLOC-ERROR                                11750003
117600         IF SU006-NO-UPC-CARTON-ERROR                             11760003
117700*            NO ALLOCATION ERROR                                  11770003
117800             MOVE SU006-PO-ALLOC-IND  TO SUEXCP-VILN-GP-SEQ-NBR   11780003
117900             SET SU006-NO-PO-ALLOC-ERROR TO TRUE                  11790003
118000             PERFORM 1501-CREATE-EXCEPTION                        11800003
118100*            XCTL TO MESSAGE SCREEN                               11810003
118200             SET PM-NO-ALLOC          TO TRUE                     11820003
118300             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        11830003
118400             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                11840003
118500         ELSE                                                     11850003
118600*            CARTONIZATION EXCEPTION                              11860003
118700             MOVE SU006-UPC-CARTON-IND TO SUEXCP-VILN-GP-SEQ-NBR  11870003
118800             SET SU006-NO-UPC-CARTON-ERROR                        11880003
118900                                      TO TRUE                     11890003
119000             PERFORM 1501-CREATE-EXCEPTION                        11900003
119100*            NO ALLOCATION EXCEPTION                              11910003
119200             MOVE SU006-PO-ALLOC-IND  TO SUEXCP-VILN-GP-SEQ-NBR   11920003
119300             SET SU006-NO-PO-ALLOC-ERROR TO TRUE                  11930003
119400             PERFORM 1501-CREATE-EXCEPTION                        11940003
119500*            XCTL TO MESSAGE SCREEN                               11950003
119600             SET PM-NO-ALLOC-NOT-ON-CRTN                          11960003
119700                                      TO TRUE                     11970003
119800             MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR        11980003
119900             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                11990003
120000         END-IF                                                   12000003
120100     END-EVALUATE.                                                12010003
120200                                                                  12020003
120300***************************************************************** 12030003
120400*   1501-CREATE-EXCEPTION                                       * 12040003
120500* CREATE THE APPROPRIATE EXCEPTION..........                    * 12050003
120600***************************************************************** 12060003
120700 1501-CREATE-EXCEPTION.                                           12070003
120800     MOVE SU006-AUDIT-CNTL-NBR       TO SUEXCP-AUD-CNTL-NBR.      12080003
120900     MOVE SU006-SHIP-UNIT-NBR        TO SUEXCP-SHIPT-UNT-ID.      12090003
121000     MOVE SU006-SCN-TMST             TO SUEXCP-SCN-TMST.          12100003
121100     MOVE SU006-UPC                  TO SUEXCP-UPC-NBR.           12110003
121200     MOVE SPACES                     TO SUEXCP-OVRRID-SYS-DAT-TXT.12120003
121300                                                                  12130003
121400     EXEC SQL                                                     12140003
121500         INSERT  INTO  TSUEXCP                                    12150003
121600                (AUD_CNTL_NBR                                     12160003
121700               , SHIPT_UNT_ID                                     12170003
121800               , UPC_NBR                                          12180003
121900               , SCN_TMST                                         12190003
122000               , VILN_GP_CDE                                      12200003
122100               , VILN_GP_SEQ_NBR                                  12210003
122200               , OVRRID_SYS_DAT_TXT)                              12220003
122300         VALUES                                                   12230003
122400             (                                                    12240003
122500                :SUEXCP-AUD-CNTL-NBR                              12250003
122600              , :SUEXCP-SHIPT-UNT-ID                              12260003
122700              , :SUEXCP-UPC-NBR                                   12270003
122800              , :SUEXCP-SCN-TMST                                  12280003
122900              , :SUEXCP-VILN-GP-CDE                               12290003
123000              , :SUEXCP-VILN-GP-SEQ-NBR                           12300003
123100              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       12310003
123200     END-EXEC                                                     12320003
123300                                                                  12330003
123400     EVALUATE TRUE                                                12340003
123500         WHEN SQLCODE = ZERO                                      12350003
123600             CONTINUE                                             12360003
123700                                                                  12370003
123800         WHEN SQLWARN0 NOT = SPACES                               12380003
123900         WHEN SQLCODE < ZERO                                      12390003
124000         WHEN SQLCODE > ZERO                                      12400003
124100             MOVE '1501-CREATE-EXCEPTIONS'                        12410003
124200                 TO DP013-PARAGRAPH                               12420003
124300             MOVE 'INSERT TO TSUEXCP TABLE'                       12430003
124400                 TO DP013-MESSAGE-TEXT (1)                        12440003
124500             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 12450003
124600             MOVE SQLCA                  TO DP013-SQLCA           12460003
124700             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME(1) 12470003
124800             SET DP013-DB2-ABEND         TO TRUE                  12480003
124900             SET DP013-NO-ROLLBACK       TO TRUE                  12490003
125000             PERFORM 9999-WRITE-CICS-LOG-MSG                      12500003
125100             MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         12510003
125200             SET CA-RETURN-ERROR         TO TRUE                  12520003
125300                                                                  12530003
125400*            RETURN TO THE PROGRAM THAT CALLED IT                 12540003
125500             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   12550003
125600             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                12560003
125700     END-EVALUATE.                                                12570003
125800                                                                  12580003
125900*    IF THE CURRENT SHIPPING UNIT AUDIT RECORD DOES NOT HAVE ANY  12590003
126000*    EXCEPTIONS CREATED YET, SET THE INDICATOR TO SAY THAT IT     12600003
126100*    DOES NOW                                                     12610003
126200     IF SU006-NO-AUD-ERR                                          12620003
126300         PERFORM 1600-UPDATE-SHIP-UNIT                            12630003
126400     END-IF.                                                      12640003
126500                                                                  12650003
137400***************************************************************** 13740003
137500*   1600-UPDATE-SHIP-UNIT                                       * 13750003
137600* UPDATE THE AUDIT ERROR INDICATOR TO SAY THERE ARE EXCEPTIONS  * 13760003
137700* FOR THIS SHIPPING UNIT AUDIT                                  * 13770003
137800***************************************************************** 13780003
137900 1600-UPDATE-SHIP-UNIT.                                           13790003
138000                                                                  13800003
138100     MOVE SU006-AUDIT-CNTL-NBR TO SUATRN-AUD-CNTL-NBR.            13810003
138200     MOVE SU006-SHIP-UNIT-NBR TO SUATRN-SHIPT-UNT-ID.             13820003
138300                                                                  13830003
138400     EXEC SQL                                                     13840003
138500         UPDATE TSUATRN                                           13850003
138600            SET UNT_AUD_ERR_IND = 'Y'                             13860003
138700         WHERE   AUD_CNTL_NBR = :SUATRN-AUD-CNTL-NBR              13870003
138800           AND   SHIPT_UNT_ID = :SUATRN-SHIPT-UNT-ID              13880003
138900     END-EXEC                                                     13890003
139000                                                                  13900003
139100     EVALUATE TRUE                                                13910003
139200         WHEN SQLCODE = ZERO                                      13920003
139300             SET SU006-AUD-ERR TO TRUE                            13930003
139400                                                                  13940003
139500         WHEN SQLWARN0 NOT = SPACES                               13950003
139600         WHEN SQLCODE < ZERO                                      13960003
139700         WHEN SQLCODE > ZERO                                      13970003
139800             MOVE '1600-UPDATE-SHIP-UNIT'                         13980003
139900                 TO DP013-PARAGRAPH                               13990003
140000             MOVE 'UPDATE THE AUDIT ERROR CODE'                   14000003
140100                 TO DP013-MESSAGE-TEXT (1)                        14010003
140200             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT(2) 14020003
140300             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 14030003
140400             MOVE SQLCA                  TO DP013-SQLCA           14040003
140500             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME(1) 14050003
140600             SET DP013-DB2-ABEND         TO TRUE                  14060003
140700             SET DP013-NO-ROLLBACK       TO TRUE                  14070003
140800             PERFORM 9999-WRITE-CICS-LOG-MSG                      14080003
140900             MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         14090003
141000             SET CA-RETURN-ERROR         TO TRUE                  14100003
141100                                                                  14110003
141200*            RETURN TO THE PROGRAM THAT CALLED IT                 14120003
141300             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   14130003
141400             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                14140003
141500     END-EVALUATE.                                                14150003
141600                                                                  14160003
141700                                                                  14170003
141800***************************************************************** 14180003
141900*   1700-CERTIFY-UPC                                            * 14190003
142000* UPDATE THE UPC CERTIFICATION FLAG TO 'Y' ON BOTH TUPC AND     * 14200003
142100* TUPCSKU TABLES                                                * 14210003
142200***************************************************************** 14220003
142300 1700-CERTIFY-UPC.                                                14230003
142400                                                                  14240003
142500     MOVE SU006-UPC           TO DK-UPC-NUMBER.                   14250003
142600     SET  PS-DATABASE-CONTENTION-NO  TO  TRUE.                    14260003
142700                                                                  14270003
142800     EXEC SQL                                                     14280003
142900         UPDATE TUPC                                              14290003
143000            SET CERTD_IND             = 'Y'                       14300003
143100              , CERTD_DTE             =  CURRENT DATE             14310003
143200              , LAST_UPD_BY_USR_ID   = :SU006-USERID              14320003
143300              , LAST_UPD_TMST        =  CURRENT TIMESTAMP         14330003
143400         WHERE  UPC_NBR              = :DK-UPC-NUMBER             14340003
143500     END-EXEC                                                     14350003
143600                                                                  14360003
143700     EVALUATE TRUE                                                14370003
143800         WHEN SQLCODE = ZERO                                      14380003
143900             PERFORM 1701-UPDATE-XLT-UPC                          14390003
144000                                                                  14400003
144100         WHEN SQLCODE = -904                                      14410003
144200         WHEN SQLCODE = -913                                      14420003
144300              SET PS-DATABASE-CONTENTION-YES  TO  TRUE            14430003
144400                                                                  14440003
144500         WHEN SQLWARN0 NOT = SPACES                               14450003
144600         WHEN SQLCODE < ZERO                                      14460003
144700         WHEN SQLCODE > ZERO                                      14470003
144800             MOVE '1700-CERTIFY-UPC'                              14480003
144900                 TO DP013-PARAGRAPH                               14490003
145000             MOVE SU006-UPC-X            TO DP013-MESSAGE-TEXT(1) 14500003
145100             MOVE SQLCA                  TO DP013-SQLCA           14510003
145200             MOVE 'TUPC   '            TO DP013-DB2-TABLE-NAME(1) 14520003
145300             SET DP013-DB2-ABEND         TO TRUE                  14530003
145400             SET DP013-NO-ROLLBACK       TO TRUE                  14540003
145500             PERFORM 9999-WRITE-CICS-LOG-MSG                      14550003
145600             MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         14560003
145700             SET CA-RETURN-ERROR         TO TRUE                  14570003
145800                                                                  14580003
145900*            RETURN TO THE PROGRAM THAT CALLED IT                 14590003
146000             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   14600003
146100             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                14610003
146200     END-EVALUATE.                                                14620003
146300                                                                  14630003
146400     IF  PS-DATABASE-CONTENTION-NO                                14640003
146500         EXEC SQL                                                 14650003
146600             UPDATE TUPCSKU                                       14660003
146700                SET CERT_IND   = 'Y'                              14670003
146800                  , CERT_DTE   = CURRENT DATE                     14680003
146900             WHERE UPC_NBR    = :DK-UPC-NUMBER                    14690003
147000         END-EXEC                                                 14700003
147100                                                                  14710003
147200         EVALUATE TRUE                                            14720003
147300             WHEN SQLCODE = ZERO                                  14730003
147400                 CONTINUE                                         14740003
147500                                                                  14750003
147600             WHEN SQLWARN0 NOT = SPACES                           14760003
147700             WHEN SQLCODE < ZERO                                  14770003
147800             WHEN SQLCODE > ZERO                                  14780003
147900                 MOVE '1700-CERTIFY-UPC'                          14790003
148000                     TO DP013-PARAGRAPH                           14800003
148100                 MOVE SU006-UPC-X        TO DP013-MESSAGE-TEXT(1) 14810003
148200                 MOVE SQLCA              TO DP013-SQLCA           14820003
148300                 MOVE 'TUPCSKU'        TO DP013-DB2-TABLE-NAME(1) 14830003
148400                 SET DP013-DB2-ABEND     TO TRUE                  14840003
148500                 SET DP013-NO-ROLLBACK   TO TRUE                  14850003
148600                 PERFORM 9999-WRITE-CICS-LOG-MSG                  14860003
148700                 MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG     14870003
148800                 SET CA-RETURN-ERROR     TO TRUE                  14880003
148900                                                                  14890003
149000*                RETURN TO THE PROGRAM THAT CALLED IT             14900003
149100                 MOVE SU006-LAST-PROGRAM TO PV-TRANSFER-PROGRAM   14910003
149200                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            14920003
149300         END-EVALUATE                                             14930003
149400     END-IF.                                                      14940003
149500                                                                  14950003
149600 1701-UPDATE-XLT-UPC.                                             14960003
149700                                                                  14970003
149800     EXEC SQL                                                     14980003
149900         UPDATE XLT_UPC                                           14990003
150000            SET CERTD_IND             = 'Y'                       15000003
150100              , CERTD_DTE             =  CURRENT DATE             15010003
150200         WHERE  UPC_NBR              = :DK-UPC-NUMBER             15020003
150300     END-EXEC                                                     15030003
150400                                                                  15040003
150500     EVALUATE TRUE                                                15050003
150600         WHEN SQLCODE = ZERO                                      15060003
150700             CONTINUE                                             15070003
150800                                                                  15080003
150900         WHEN SQLWARN0 NOT = SPACES                               15090003
151000         WHEN SQLCODE < ZERO                                      15100003
151100         WHEN SQLCODE > ZERO                                      15110003
151200             MOVE '1701-UPDATE-XLT-UPC'                           15120003
151300                 TO DP013-PARAGRAPH                               15130003
151400             MOVE SU006-UPC-X            TO DP013-MESSAGE-TEXT(1) 15140003
151500             MOVE SQLCA                  TO DP013-SQLCA           15150003
151600             MOVE 'XLT_UPC'            TO DP013-DB2-TABLE-NAME(1) 15160003
151700             SET DP013-DB2-ABEND         TO TRUE                  15170003
151800             SET DP013-NO-ROLLBACK       TO TRUE                  15180003
151900             PERFORM 9999-WRITE-CICS-LOG-MSG                      15190003
152000             MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         15200003
152100             SET CA-RETURN-ERROR         TO TRUE                  15210003
152200                                                                  15220003
152300*            RETURN TO THE PROGRAM THAT CALLED IT                 15230003
152400             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   15240003
152500             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                15250003
152600     END-EVALUATE.                                                15260003
152700                                                                  15270003
152800                                                                  15280003
152900 2100-XCTL-TO-SELECTED-PROGRAM.                                   15290003
153000     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      15300003
153100     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        15310003
153200                                                                  15320003
153300     EXEC CICS                                                    15330003
153400         XCTL                                                     15340003
153500             PROGRAM   (PV-TRANSFER-PROGRAM)                      15350003
153600             COMMAREA  (CA-COMMAREA)                              15360003
153700             LENGTH    (PV-COMMAREA-LENGTH)                       15370003
153800             RESP      (PV-CICS-RESPONSE)                         15380003
153900     END-EXEC.                                                    15390003
154000                                                                  15400003
154100     EVALUATE TRUE                                                15410003
154200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15420003
154300              CONTINUE                                            15430003
154400         WHEN OTHER                                               15440003
154500              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                15450003
154600                                     TO DP013-PARAGRAPH           15460003
154700              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       15470003
154800                                     TO DP013-MESSAGE-TEXT (1)    15480003
154900              MOVE PV-TRANSFER-PROGRAM                            15490003
155000                                     TO DP013-MESSAGE-TEXT (2)    15500003
155100              SET DP013-CICS-ABEND   TO TRUE                      15510003
155200              SET DP013-NO-ROLLBACK  TO TRUE                      15520003
155300              PERFORM 9999-WRITE-CICS-LOG-MSG                     15530003
155400              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     15540003
155500                                     TO AMSGLNO                   15550003
155600              SET SU006-PROCESS-SCREEN TO TRUE                    15560003
155700              PERFORM 8100-SEND-DATA-ONLY                         15570003
155800              PERFORM 8200-RETURN-TRANID                          15580003
155900     END-EVALUATE.                                                15590003
156000                                                                  15600003
156100                                                                  15610003
156200                                                                  15620003
156300 2200-XCTL-TO-HELP.                                               15630003
156400                                                                  15640003
156500     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      15650003
156600     SET SU006-INITIALIZE-SCREEN      TO TRUE.                    15660003
156700     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    15670003
156800                                                                  15680003
156900     EXEC CICS                                                    15690003
157000         XCTL                                                     15700003
157100             PROGRAM   (PV-TRANSFER-PROGRAM)                      15710003
157200             COMMAREA  (PC192-COMMAREA)                           15720003
157300             LENGTH    (PV-COMMAREA-LENGTH)                       15730003
157400             RESP      (PV-CICS-RESPONSE)                         15740003
157500     END-EXEC.                                                    15750003
157600                                                                  15760003
157700     EVALUATE TRUE                                                15770003
157800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15780003
157900              CONTINUE                                            15790003
158000         WHEN OTHER                                               15800003
158100              MOVE '2200-XCTL-TO-HELP'                            15810003
158200                                     TO DP013-PARAGRAPH           15820003
158300              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       15830003
158400                                     TO DP013-MESSAGE-TEXT (1)    15840003
158500              MOVE PV-TRANSFER-PROGRAM                            15850003
158600                                     TO DP013-MESSAGE-TEXT (2)    15860003
158700              SET DP013-CICS-ABEND   TO TRUE                      15870003
158800              SET DP013-NO-ROLLBACK  TO TRUE                      15880003
158900              PERFORM 9999-WRITE-CICS-LOG-MSG                     15890003
159000              MOVE PC-TRANS-UNAVAILABLE-MSG                       15900003
159100                                     TO AMSGLNO                   15910003
159200              SET SU006-PROCESS-SCREEN TO TRUE                    15920003
159300              PERFORM 8100-SEND-DATA-ONLY                         15930003
159400              PERFORM 8200-RETURN-TRANID                          15940003
159500     END-EVALUATE.                                                15950003
159600*                                                                 15960003
159700******************************************************************15970003
159800* 3000-CHECK-PO                                                  *15980003
159900*  CHECK TO MAKE SURE THE UPC/SKU IS ON THE PO THAT THIS CARTON  *15990003
160000* IS ASSOCIATED TO -- IF IT IS, IT GETS THE LINE NUMBERS TO       16000003
160100* VERIFY THAT THE LINE IS ASSOCIATED TO THE STORE/DC BEING       *16010003
160200* PROCESSED.                                                     *16020003
160300******************************************************************16030003
160400 3000-CHECK-PO.                                                   16040003
160500                                                                  16050003
160600     PERFORM 3001-OPEN-PO-LINE-CURSOR.                            16060003
160700     PERFORM 3002-FETCH-PO-LINE-CURSOR.                           16070003
160800                                                                  16080003
160900*    IF THERE ARE NO LINES FOR THIS SKU ON THIS PO, IT IS STYLE   16090003
161000*    SUB                                                          16100003
161100     IF PS-EOC-PO-LINE-CURSOR                                     16110003
161200         SET SU006-STYLE-SUB-ERROR TO TRUE                        16120003
161300     ELSE                                                         16130003
161400*    DETERMINE WHAT TYPE OF DESTINATION IS ASSOCIATED TO THIS     16140003
161500*    CARTON (IE. GOING TO A DC OR A STORE?) ,,,,,,                16150003
161600         IF SU006-STORE = 0                                       16160003
161700             SET PS-DEST-IS-A-STR   TO TRUE                       16170003
161800         ELSE                                                     16180003
161900             PERFORM 3100-GET-DEST-TYPE                           16190003
162000         END-IF                                                   16200003
162100     END-IF.                                                      16210003
162200                                                                  16220003
162300*    ....THEN FOR EACH LINE THIS ITEM IS ON, CHECK THE DISTRO     16230003
162400*    DEPENDING ON THE TYPE OF THE DESTINATION (VERIFY THAT THE    16240003
162500*    PO/LINE IS SUPPOSE TO BE GOING THROUGH THIS DC.......        16250003
162600     PERFORM UNTIL PS-EOC-PO-LINE-CURSOR                          16260003
162700                OR PS-DONE                                        16270003
162800                                                                  16280003
162900*  IT WAS DECIDED NOT TO CHECK FOR STORE ALLOCATIONS AS OF        16290003
163000*  5/17/04 PER CATHY FAIRWEATHER                                  16300003
163100         IF PS-DEST-IS-A-DC                                       16310003
163200             PERFORM 3200-CHECK-DC-DISTRO                         16320003
163300         END-IF                                                   16330003
163400                                                                  16340003
163500         PERFORM 3002-FETCH-PO-LINE-CURSOR                        16350003
163600     END-PERFORM                                                  16360003
163700                                                                  16370003
163800*    CLOSE THE PO LINE CURSOR                                     16380003
163900     PERFORM 3003-CLOSE-PO-LINE-CURSOR.                           16390003
164000                                                                  16400003
164100******************************************************************16410003
164200* 3001-OPEN-PO-LINE-CURSOR                                       *16420003
164300*  OPEN THE PO LINE CURSOR                                       *16430003
164400******************************************************************16440003
164500 3001-OPEN-PO-LINE-CURSOR.                                        16450003
164600                                                                  16460003
164700     EXEC SQL                                                     16470003
164800         OPEN PO-LINE-CURSOR                                      16480003
164900     END-EXEC.                                                    16490003
165000                                                                  16500003
165100     EVALUATE TRUE                                                16510003
165200         WHEN SQLCODE = ZERO                                      16520003
165300             SET PS-NOT-EOC-PO-LINE-CURSOR   TO TRUE              16530003
165400                                                                  16540003
165500         WHEN SQLWARN0 NOT = SPACES                               16550003
165600         WHEN SQLCODE < ZERO                                      16560003
165700         WHEN SQLCODE > ZERO                                      16570003
165800             MOVE '3001-OPEN-PO-LINE-CUROSR'                      16580003
165900                                   TO DP013-PARAGRAPH             16590003
166000             MOVE 'OPEN PO-LINE-CURSOR'                           16600003
166100                                   TO DP013-MESSAGE-TEXT (1)      16610003
166200             MOVE SU006-PO         TO DP013-MESSAGE-TEXT (2)      16620003
166300             MOVE SU006-SKU-NBR    TO DP013-MESSAGE-TEXT (3)      16630003
166400             MOVE SQLCA            TO DP013-SQLCA                 16640003
166500             MOVE 'TPURCHS'        TO DP013-DB2-TABLE-NAME (1)    16650003
166600             MOVE 'TPURITM'        TO DP013-DB2-TABLE-NAME (2)    16660003
166700             SET DP013-DB2-ABEND   TO TRUE                        16670003
166800             SET DP013-NO-ROLLBACK TO TRUE                        16680003
166900             PERFORM 9999-WRITE-CICS-LOG-MSG                      16690003
167000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               16700003
167100             PERFORM 8100-SEND-DATA-ONLY                          16710003
167200             PERFORM 8200-RETURN-TRANID                           16720003
167300     END-EVALUATE.                                                16730003
167400                                                                  16740003
167500******************************************************************16750003
167600* 3002-FETCH-PO-LINE-CURSOR                                      *16760003
167700*  FETCH THE NEXT OCCURANCE OF THE PO-LINE-CURSOR                *16770003
167800******************************************************************16780003
167900 3002-FETCH-PO-LINE-CURSOR.                                       16790003
168000                                                                  16800003
168100     EXEC SQL                                                     16810003
168200         FETCH PO-LINE-CURSOR                                     16820003
168300         INTO    :PURITM-PO-LNE-NBR                               16830003
168400     END-EXEC.                                                    16840003
168500                                                                  16850003
168600     EVALUATE TRUE                                                16860003
168700         WHEN SQLCODE = ZERO                                      16870003
168800             CONTINUE                                             16880003
168900                                                                  16890003
169000         WHEN SQLCODE = +100                                      16900003
169100             SET PS-EOC-PO-LINE-CURSOR       TO TRUE              16910003
169200                                                                  16920003
169300         WHEN SQLWARN0 NOT = SPACES                               16930003
169400         WHEN SQLCODE < ZERO                                      16940003
169500         WHEN SQLCODE > ZERO                                      16950003
169600             MOVE '3002-FETCH-PO-LINE-CURSOR'                     16960003
169700                                   TO DP013-PARAGRAPH             16970003
169800             MOVE 'FETCH OF PO-LINE-CUROSR'                       16980003
169900                                   TO DP013-MESSAGE-TEXT (1)      16990003
170000             MOVE SU006-PO         TO DP013-MESSAGE-TEXT (2)      17000003
170100             MOVE SU006-SKU-NBR    TO DP013-MESSAGE-TEXT (3)      17010003
170200             MOVE SQLCA            TO DP013-SQLCA                 17020003
170300             MOVE 'TPURCHS'        TO DP013-DB2-TABLE-NAME (1)    17030003
170400             MOVE 'TPURITM'        TO DP013-DB2-TABLE-NAME (2)    17040003
170500             SET DP013-DB2-ABEND   TO TRUE                        17050003
170600             SET DP013-NO-ROLLBACK TO TRUE                        17060003
170700             PERFORM 9999-WRITE-CICS-LOG-MSG                      17070003
170800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               17080003
170900             PERFORM 8100-SEND-DATA-ONLY                          17090003
171000             PERFORM 8200-RETURN-TRANID                           17100003
171100     END-EVALUATE.                                                17110003
171200                                                                  17120003
171300******************************************************************17130003
171400* 3003-CLOSE-PO-LINE-CURSOR                                      *17140003
171500*  CLOSE THE PO LINE CURSOR                                      *17150003
171600******************************************************************17160003
171700 3003-CLOSE-PO-LINE-CURSOR.                                       17170003
171800                                                                  17180003
171900     EXEC SQL                                                     17190003
172000         CLOSE PO-LINE-CURSOR                                     17200003
172100     END-EXEC.                                                    17210003
172200                                                                  17220003
172300     EVALUATE TRUE                                                17230003
172400         WHEN SQLCODE = ZERO                                      17240003
172500             CONTINUE                                             17250003
172600                                                                  17260003
172700         WHEN SQLWARN0 NOT = SPACES                               17270003
172800         WHEN SQLCODE < ZERO                                      17280003
172900         WHEN SQLCODE > ZERO                                      17290003
173000             MOVE '3003-CLOSE-PO-LINE-CURSOR'                     17300003
173100                                   TO DP013-PARAGRAPH             17310003
173200             MOVE 'CLOSE OF PO-LINE-CURSOR'                       17320003
173300                                   TO DP013-MESSAGE-TEXT (1)      17330003
173400             MOVE SU006-PO         TO DP013-MESSAGE-TEXT (2)      17340003
173500             MOVE SU006-SKU-NBR    TO DP013-MESSAGE-TEXT (3)      17350003
173600             MOVE SQLCA            TO DP013-SQLCA                 17360003
173700             MOVE 'TPURCHS'        TO DP013-DB2-TABLE-NAME (1)    17370003
173800             MOVE 'TPURITM'        TO DP013-DB2-TABLE-NAME (2)    17380003
173900             SET DP013-DB2-ABEND   TO TRUE                        17390003
174000             SET DP013-NO-ROLLBACK TO TRUE                        17400003
174100             PERFORM 9999-WRITE-CICS-LOG-MSG                      17410003
174200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               17420003
174300             PERFORM 8100-SEND-DATA-ONLY                          17430003
174400             PERFORM 8200-RETURN-TRANID                           17440003
174500     END-EVALUATE.                                                17450003
174600                                                                  17460003
174700****************************************************************  17470003
174800  3100-GET-DEST-TYPE.                                             17480003
174900                                                                  17490003
175000     INITIALIZE XL071-COMMAREA-REC.                               17500003
175100     MOVE SU006-STORE TO XL071-LOCATION-NUMBER.                   17510003
175200                                                                  17520003
175300                                                                  17530003
175400     CALL PC-LOCATION-MODULE  USING DFHEIBLK                      17540003
175500                                    XL071-COMMAREA                17550003
175600                                    XL071-COMMAREA-REC.           17560003
175700                                                                  17570003
175800     IF XL071-NO-ERRORS                                           17580003
175900          IF XL071-LOC-TYP-CDE EQUAL 'DC'                         17590003
176000              SET PS-DEST-IS-A-DC    TO TRUE                      17600003
176100          ELSE                                                    17610003
176200               SET PS-DEST-IS-A-STR   TO TRUE                     17620003
176300          END-IF                                                  17630003
176400     ELSE                                                         17640003
176500         MOVE '3100-GET-DEST-TYPE'  TO DP013-PARAGRAPH            17650003
176600         MOVE 'SELECT OF XLT_LOC TABLE' TO DP013-MESSAGE-TEXT (1) 17660003
176700         MOVE SU006-STORE           TO DP013-MESSAGE-TEXT (2)     17670003
176800         MOVE SQLCA                 TO DP013-SQLCA                17680003
176900         MOVE 'XLT_LOC'        TO DP013-DB2-TABLE-NAME (1)        17690003
177000         SET DP013-DB2-ABEND        TO TRUE                       17700003
177100         SET DP013-NO-ROLLBACK      TO TRUE                       17710003
177200         PERFORM 9999-WRITE-CICS-LOG-MSG                          17720003
177300         MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO                   17730003
177400         PERFORM 8100-SEND-DATA-ONLY                              17740003
177500         PERFORM 8200-RETURN-TRANID                               17750003
177600     END-IF.                                                      17760003
177700                                                                  17770003
177800****************************************************************  17780003
177900* 3150-GET-E-BUS-IND                                           *  17790003
178000*      DETERMINE THE VALUE OF THE E-BUS-LOC-IND FOR THE DC     *  17800003
178100****************************************************************  17810003
178200 3150-GET-E-BUS-IND.                                              17820003
178300                                                                  17830003
178400     INITIALIZE XL071-COMMAREA-REC.                               17840003
178500     MOVE SU006-OPER-UNT-ID    TO XL071-LOCATION-NUMBER.          17850003
178600                                                                  17860003
178700     CALL PC-LOCATION-MODULE  USING DFHEIBLK                      17870003
178800                                    XL071-COMMAREA                17880003
178900                                    XL071-COMMAREA-REC.           17890003
179000                                                                  17900003
179100     IF XL071-NO-ERRORS                                           17910003
179200         MOVE XL071-E-BUS-IND   TO PV-DC-E-BUS-LOC-IND            17920003
179300         MOVE XL071-LOC-TYP-CDE TO PV-DC-TYPE-CODE                17930003
179400     ELSE                                                         17940003
179500         MOVE '3150-GET-E-BUS-IND'  TO DP013-PARAGRAPH            17950003
179600         MOVE 'SELECT OF XLT_LOC TABLE' TO DP013-MESSAGE-TEXT (1) 17960003
179700         MOVE DK-OPER-UNIT-ID       TO DP013-MESSAGE-TEXT (2)     17970003
179800         MOVE SQLCA                 TO DP013-SQLCA                17980003
179900         MOVE 'XLT_LOC'             TO DP013-DB2-TABLE-NAME (1)   17990003
180000         SET DP013-DB2-ABEND        TO TRUE                       18000003
180100         SET DP013-NO-ROLLBACK      TO TRUE                       18010003
180200         PERFORM 9999-WRITE-CICS-LOG-MSG                          18020003
180300         MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO                   18030003
180400         PERFORM 8100-SEND-DATA-ONLY                              18040003
180500         PERFORM 8200-RETURN-TRANID                               18050003
180600     END-IF.                                                      18060003
180700                                                                  18070003
180800****************************************************************  18080003
180900* 3200-CHECK-DC-DISTRO                                         *  18090003
181000*      CHECK THE DISTRO OF THE PO TO MAKE SURE THERE IS A SPLIT*  18100003
181100*  FOR THE DC BEING PROCESSED - IE, SHOULD THIS STUFF BE HERE? *  18110003
181200****************************************************************  18120003
181300 3200-CHECK-DC-DISTRO.                                            18130003
181400                                                                  18140003
181500     MOVE SU006-OPER-UNT-ID          TO DK-DEST-NBR.              18150003
181600                                                                  18160003
181700     EXEC SQL                                                     18170003
181800         SELECT  PLAN_NBR                                         18180003
181900           INTO  :ALLPLN-PLAN-NBR                                 18190003
182000           FROM  TALLPLN                                          18200003
182100          WHERE  PO_NBR         =  :SU006-PO                      18210003
182200            AND  PO_LNE_NBR     =  :PURITM-PO-LNE-NBR             18220003
182300            AND  DEST_NBR       =  :DK-DEST-NBR                   18230003
182400     END-EXEC.                                                    18240003
182500                                                                  18250003
182600     EVALUATE TRUE                                                18260003
182700*        IF AN ALLOCATION WAS FOUND, SET FLAG TO GET OUT OF LOOP  18270003
182800*        AND RESET ANY EXCEPTION THAT WAS CREATED FOR ANY OTHER   18280003
182900*        LINE THIS ITEM WAS ON                                    18290003
183000         WHEN SQLCODE = ZERO                                      18300003
183100             SET PS-DONE                                          18310003
183200                 SU006-NO-PO-ALLOC-ERROR TO TRUE                  18320003
183300                                                                  18330003
183400*        IF NO ALLOCATION WAS FOUND FOR THIS LINE, SET BULK       18340003
183500*        MISDIRECT FLAG -- THIS FLAG COULD BE RE-SET IF AN        18350003
183600*        ALLOCATION FOR THIS ITEM IS FOUND ON ANOTHER LINE        18360003
183700         WHEN SQLCODE = +100                                      18370003
183800             SET SU006-BULK-MISDIRECT-ERROR TO TRUE               18380003
183900                                                                  18390003
184000         WHEN SQLWARN0 NOT = SPACES                               18400003
184100         WHEN SQLCODE < ZERO                                      18410003
184200         WHEN SQLCODE > ZERO                                      18420003
184300             MOVE '3200-CHECK-DC-DISTRO'                          18430003
184400                                        TO DP013-PARAGRAPH        18440003
184500             MOVE 'SELECT OF ALLOCAITON'                          18450003
184600                                        TO DP013-MESSAGE-TEXT (1) 18460003
184700             MOVE SQLCA                 TO DP013-SQLCA            18470003
184800             MOVE 'TALLPLN'        TO DP013-DB2-TABLE-NAME (1)    18480003
184900             SET DP013-DB2-ABEND        TO TRUE                   18490003
185000             SET DP013-NO-ROLLBACK      TO TRUE                   18500003
185100             PERFORM 9999-WRITE-CICS-LOG-MSG                      18510003
185200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               18520003
185300             PERFORM 8100-SEND-DATA-ONLY                          18530003
185400             PERFORM 8200-RETURN-TRANID                           18540003
185500     END-EVALUATE.                                                18550003
185600                                                                  18560003
185700                                                                  18570003
185800****************************************************************  18580003
185900* 3201-CHECK-STR-DISTRO                                        *  18590003
186000*      CHECK THE DISTRO OF THE PO TO MAKE SURE THERE IS        *  18600003
186100*  ALLOATION FOR THE STORE ASSOCIATED TO THIS CARTON           *  18610003
186200****************************************************************  18620003
186300 3201-CHECK-STR-DISTRO.                                           18630003
186400                                                                  18640003
186500     MOVE SU006-OPER-UNT-ID          TO DK-DEST-NBR.              18650003
186600                                                                  18660003
186700     EXEC SQL                                                     18670003
186800         SELECT  A.PLAN_NBR                                       18680003
186900           INTO  :ALLPLN-PLAN-NBR                                 18690003
187000           FROM  TALLPLN A                                        18700003
187100              ,  TMESTDS B                                        18710003
187200          WHERE A.PO_NBR         =  :SU006-PO                     18720003
187300            AND A.PO_NBR         =  B.PO_NBR                      18730003
187400            AND A.PO_LNE_NBR     =  :PURITM-PO-LNE-NBR            18740003
187500            AND A.PO_LNE_NBR     =  B.PO_LNE_NBR                  18750003
187600            AND A.PLAN_NBR      =  B.PLAN_NBR                     18760003
187700            AND B.STR_NBR       =  :SU006-STORE                   18770003
187800     END-EXEC.                                                    18780003
187900                                                                  18790003
188000     EVALUATE TRUE                                                18800003
188100*        IF AN ALLOCATION WAS FOUND, SET FLAG TO GET OUT OF LOOP  18810003
188200*        AND RESET ANY EXCEPTION THAT WAS CREATED FOR ANY OTHER   18820003
188300*        LINE THIS ITEM WAS ON                                    18830003
188400         WHEN SQLCODE = ZERO                                      18840003
188500             SET PS-DONE                                          18850003
188600                 SU006-NO-PO-ALLOC-ERROR TO TRUE                  18860003
188700         WHEN SQLCODE = -811                                      18870003
188800             SET PS-DONE                                          18880003
188900                 SU006-NO-PO-ALLOC-ERROR TO TRUE                  18890003
189000                                                                  18900003
189100*        IF NO ALLOCATION WAS FOUND FOR THIS LINE, SET NO ALLOC   18910003
189200*        FLAG -- THIS FLAG COULD BE RE-SET IF AN ALLOCATION FOR   18920003
189300*        THIS ITEM IS FOUND ON ANOTHER LINE                       18930003
189400         WHEN SQLCODE = +100                                      18940003
189500             SET SU006-PBS-NO-ALLOC-ERROR TO TRUE                 18950003
189600                                                                  18960003
189700         WHEN SQLWARN0 NOT = SPACES                               18970003
189800         WHEN SQLCODE < ZERO                                      18980003
189900         WHEN SQLCODE > ZERO                                      18990003
190000             MOVE '3201-CHECK-STR-DISTRO'                         19000003
190100                                        TO DP013-PARAGRAPH        19010003
190200             MOVE 'SELECT OF ALLOCATION'                          19020003
190300                                        TO DP013-MESSAGE-TEXT (1) 19030003
190400             MOVE SQLCA                 TO DP013-SQLCA            19040003
190500             MOVE 'TALLPLN'        TO DP013-DB2-TABLE-NAME (1)    19050003
190600             MOVE 'TMESTDS'        TO DP013-DB2-TABLE-NAME (2)    19060003
190700             SET DP013-DB2-ABEND        TO TRUE                   19070003
190800             SET DP013-NO-ROLLBACK      TO TRUE                   19080003
190900             PERFORM 9999-WRITE-CICS-LOG-MSG                      19090003
191000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               19100003
191100             PERFORM 8100-SEND-DATA-ONLY                          19110003
191200             PERFORM 8200-RETURN-TRANID                           19120003
191300     END-EVALUATE.                                                19130003
191400                                                                  19140003
191500                                                                  19150003
191600******************************************************************19160003
191700*  5000-CHECK-SHIPPING-TABLES                                    *19170003
191800*  CHECK THE AUDIT CARTON TABLES TO SEE IF THIS UPC SHOULD BE    *19180003
191900*  IN THIS CARTON                                                *19190003
192000******************************************************************19200003
192100 5000-CHECK-SHIPPING-TABLES.                                      19210003
192200                                                                  19220003
192300*    FILL HOST VARIABLES                                          19230003
192400     MOVE SU006-SHIP-UNIT-NBR           TO SHUUPC-SHIPT-UNT-ID    19240003
192500     MOVE SU006-UPC                     TO SHUUPC-UPC-NBR.        19250003
192600     MOVE SU006-PO                      TO SHUUPC-TRN-NBR.        19260003
192700                                                                  19270003
192800*    UPDATE INFORMATION                                           19280003
192900     EXEC SQL                                                     19290003
193000         SELECT                                                   19300003
193100            UPC_NBR                                               19310003
193200          , TRN_LNE_NBR                                           19320003
193300         INTO                                                     19330003
193400            :SHUUPC-UPC-NBR                                       19340003
193500          , :SHUUPC-TRN-LNE-NBR                                   19350003
193600         FROM                                                     19360003
193700               TSHUUPC                                            19370003
193800          WHERE                                                   19380003
193900                 SHIPT_UNT_ID          = :SHUUPC-SHIPT-UNT-ID     19390003
194000             AND TRN_NBR               = :SHUUPC-TRN-NBR          19400003
194100             AND UPC_NBR               = :SHUUPC-UPC-NBR          19410003
194200     END-EXEC.                                                    19420003
194300                                                                  19430003
194400     EVALUATE TRUE                                                19440003
194500         WHEN SQLCODE = ZERO                                      19450003
194600         WHEN SQLCODE = -811                                      19460003
194700             CONTINUE                                             19470003
194800                                                                  19480003
194900         WHEN SQLCODE = +100                                      19490003
195000             PERFORM 5100-CHECK-SHIP-TABLE-SKU                    19500003
195100                                                                  19510003
195200         WHEN SQLWARN0 NOT = SPACES                               19520003
195300         WHEN SQLCODE < ZERO                                      19530003
195400         WHEN SQLCODE > ZERO                                      19540003
195500             MOVE '5000-CHECK-SHIPPING-TABLES'                    19550003
195600                 TO DP013-PARAGRAPH                               19560003
195700             MOVE SHUUPC-SHIPT-UNT-ID                             19570003
195800                 TO DP013-MESSAGE-TEXT (1)                        19580003
195900             MOVE SHUUPC-TRN-NBR                                  19590003
196000                 TO DP013-MESSAGE-TEXT (2)                        19600003
196100             MOVE SHUUPC-UPC-NBR                                  19610003
196200                 TO DP013-MESSAGE-TEXT (3)                        19620003
196300             MOVE SQLCA            TO DP013-SQLCA                 19630003
196400             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    19640003
196500             SET DP013-DB2-ABEND   TO TRUE                        19650003
196600             SET DP013-NO-ROLLBACK TO TRUE                        19660003
196700             PERFORM 9999-WRITE-CICS-LOG-MSG                      19670003
196800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               19680003
196900             PERFORM 8100-SEND-DATA-ONLY                          19690003
197000             PERFORM 8200-RETURN-TRANID                           19700003
197100     END-EVALUATE.                                                19710003
197200                                                                  19720003
197300                                                                  19730003
197400******************************************************************19740003
197500*  5100-CHECK-SHIP-TABLE-SKU                                     *19750003
197600*  CHECK THE AUDIT CARTON TABLES TO SEE IF THIS UPC SHOULD BE    *19760003
197700*  IN THIS CARTON                                                *19770003
197800******************************************************************19780003
197900 5100-CHECK-SHIP-TABLE-SKU.                                       19790003
198000                                                                  19800003
198100*    FILL HOST VARIABLES                                          19810003
198200     MOVE SU006-SHIP-UNIT-NBR           TO SHUUPC-SHIPT-UNT-ID    19820003
198300     MOVE SU006-PO                      TO SHUUPC-TRN-NBR.        19830003
198400                                                                  19840003
198500*    SELECT INFORMATION                                           19850003
198600     EXEC SQL                                                     19860003
198700         SELECT                                                   19870003
198800            XUPC.UPC_NBR                                          19880003
198900         INTO                                                     19890003
199000            :SHUUPC-UPC-NBR                                       19900003
199100         FROM                                                     19910003
199200               TSHUUPC SUPC                                       19920003
199300             , XLV_UPC XUPC                                       19930003
199400             , XLV_SKU XSKU                                       19940003
199500          WHERE                                                   19950003
199600                 SUPC.SHIPT_UNT_ID       = :SHUUPC-SHIPT-UNT-ID   19960003
199700             AND SUPC.TRN_NBR            = :SHUUPC-TRN-NBR        19970003
199800                                                                  19980003
199900             AND SUPC.UPC_NBR            = XUPC.UPC_NBR           19990003
200000             AND XUPC.INTR_UPC_ID        = XSKU.INTR_UPC_ID       20000003
200100                                                                  20010003
200200             AND XSKU.ITM_NBR            = :XL001-ITM-NBR         20020003
200300             AND XSKU.SKU_NBR            = :XL001-SKU-NBR         20030003
200400     END-EXEC.                                                    20040003
200500                                                                  20050003
200600     EVALUATE TRUE                                                20060003
200700         WHEN SQLCODE = ZERO                                      20070003
200800         WHEN SQLCODE = -811                                      20080003
200900             CONTINUE                                             20090003
201000                                                                  20100003
201100         WHEN SQLCODE = +100                                      20110003
201200*02/01/14 RK BEG                                                * 20120008
201300             IF SU006-RFID-AUD-ONLY                               20130004
201400               SET SU006-RF-UPC-NOT-IN-CRTN-ERROR                 20140004
201500                                      TO TRUE                     20150003
201600             ELSE                                                 20160004
201700               SET SU006-UPC-NOT-IN-CARTON-ERROR                  20170004
201800                                      TO TRUE                     20180004
201900             END-IF                                               20190004
202000*02/01/14 RK END                                                * 20200008
202100                                                                  20210003
202200         WHEN SQLWARN0 NOT = SPACES                               20220003
202300         WHEN SQLCODE < ZERO                                      20230003
202400         WHEN SQLCODE > ZERO                                      20240003
202500             MOVE '5100-CHECK-SHIP-TABLE-SKU'                     20250003
202600                 TO DP013-PARAGRAPH                               20260003
202700             MOVE SHUUPC-SHIPT-UNT-ID                             20270003
202800                 TO DP013-MESSAGE-TEXT (1)                        20280003
202900             MOVE SHUUPC-TRN-NBR                                  20290003
203000                 TO DP013-MESSAGE-TEXT (2)                        20300003
203100             MOVE SHUUPC-UPC-NBR                                  20310003
203200                 TO DP013-MESSAGE-TEXT (3)                        20320003
203300             MOVE SQLCA            TO DP013-SQLCA                 20330003
203400             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    20340003
203500             SET DP013-DB2-ABEND   TO TRUE                        20350003
203600             SET DP013-NO-ROLLBACK TO TRUE                        20360003
203700             PERFORM 9999-WRITE-CICS-LOG-MSG                      20370003
203800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               20380003
203900             PERFORM 8100-SEND-DATA-ONLY                          20390003
204000             PERFORM 8200-RETURN-TRANID                           20400003
204100     END-EVALUATE.                                                20410003
204200                                                                  20420003
204300***************************************************************** 20430003
204400* REMOVED THIS PARAGRAPH - 1/12/10 - DMH                        * 20440003
204500***************************************************************** 20450003
204600*DMH 6000-CHECK-FOR-NEW-PO-LINE.                                  20460003
204700***************************************************************** 20470003
204800*DMH MOVE SU006-PO         TO   DK-PO.                            20480003
204900*DMH MOVE SHUUPC-TRN-LNE-NBR                                      20490003
205000*DMH                       TO   DK-PO-LNE-NBR.                    20500003
205100*DMH MOVE 0                TO   DK-REC-SEQ-NBR.                   20510003
205200*DMH MOVE XL001-NRF-CLOR-CDE TO   DK-COLOR-CDE.                   20520003
205300*DMH MOVE XL001-VS-NBR     TO   DK-VENDOR-STYLE.                  20530003
205400*DMH MOVE 'F'              TO   DK-ERR-MSG-CDE.                   20540003
205500*DMH                                                              20550003
205600*DMH EXEC SQL                                                     20560003
205700*DMH     SELECT PO_NBR                                            20570003
205800*DMH     INTO   :LBVRMG-PO-NBR                                    20580003
205900*DMH     FROM   TLBVRMG                                           20590003
206000*DMH     WHERE PO_NBR          = :DK-PO                           20600003
206100*DMH       AND RCVR_SEQ_NBR    = :DK-REC-SEQ-NBR                  20610003
206200*DMH       AND PO_LNE_NBR      = :DK-PO-LNE-NBR                   20620003
206300*DMH       AND NRF_CLOR_CDE    = :DK-COLOR-CDE                    20630003
206400*DMH       AND VS_NBR          = :DK-VENDOR-STYLE                 20640003
206500*DMH       AND ERR_MSG_CDE     = :DK-ERR-MSG-CDE                  20650003
206600*DMH END-EXEC.                                                    20660003
206700*DMH                                                              20670003
206800*DMH     EVALUATE TRUE                                            20680003
206900*DMH         WHEN SQLCODE = ZERO                                  20690003
207000*DMH            SET PS-PO-ALREADY-VALIDATED TO TRUE               20700003
207100*DMH         WHEN SQLCODE = +100                                  20710003
207200*DMH            SET PS-PO-NOT-VALIDATED TO TRUE                   20720003
207300*DMH         WHEN SQLWARN0 NOT = SPACES                           20730003
207400*DMH         WHEN SQLCODE < ZERO                                  20740003
207500*DMH         WHEN SQLCODE > ZERO                                  20750003
207600*DMH             MOVE '6000-CHECK-FOR-NEW-PO-LINE'                20760003
207700*DMH                               TO DP013-PARAGRAPH             20770003
207800*DMH             MOVE 'SELECT FROM TABLE  - '                     20780003
207900*DMH                               TO DP013-MESSAGE-TEXT (1)      20790003
208000*DMH             MOVE SQLCA        TO DP013-SQLCA                 20800003
208100*DMH             MOVE 'TLBVRMG '   TO DP013-DB2-TABLE-NAME (1)    20810003
208200*DMH             SET DP013-DB2-ABEND                              20820003
208300*DMH                 DP013-XCTL-DISPLAY-RESTART TO TRUE           20830003
208400*DMH             SET DP013-ROLLBACK                               20840003
208500*DMH                               TO TRUE                        20850003
208600*DMH             PERFORM DP014-0000-PROCESS-ABEND                 20860003
208700*DMH     END-EVALUATE.                                            20870003
208800                                                                  20880003
208900                                                                  20890003
209000**********************************************************        20900003
209100*DMH  6100-UPDATE-MESSAGE-TABLE.                                  20910003
209200**********************************************************        20920003
209300*DMH EXEC SQL                                                     20930003
209400*DMH     INSERT INTO TLBVRMG                                      20940003
209500*DMH           ( PO_NBR                                           20950003
209600*DMH            ,RCVR_SEQ_NBR                                     20960003
209700*DMH            ,PO_LNE_NBR                                       20970003
209800*DMH            ,NRF_CLOR_CDE                                     20980003
209900*DMH            ,VS_NBR                                           20990003
210000*DMH            ,PREPK_ID                                         21000003
210100*DMH            ,WRKR_USR_ID                                      21010003
210200*DMH            ,TRIP_ID                                          21020003
210300*DMH            ,CICS_SESS_ID                                     21030003
210400*DMH            ,CRE_TMST                                         21040003
210500*DMH            ,ERR_MSG_CDE)                                     21050003
210600*DMH     VALUES (:DK-PO                                           21060003
210700*DMH           , :DK-REC-SEQ-NBR                                  21070003
210800*DMH           , :DK-PO-LNE-NBR                                   21080003
210900*DMH           , :DK-COLOR-CDE                                    21090003
211000*DMH           , :DK-VENDOR-STYLE                                 21100003
211100*DMH           ,  0                                               21110003
211200*DMH           , :SU006-USERID                                    21120003
211300*DMH           ,  0                                               21130003
211400*DMH           ,  ''                                              21140003
211500*DMH           , CURRENT TIMESTAMP                                21150003
211600*DMH           , :DK-ERR-MSG-CDE)                                 21160003
211700*DMH END-EXEC.                                                    21170003
211800*DMH                                                              21180003
211900*DMH     EVALUATE TRUE                                            21190003
212000*DMH         WHEN SQLCODE = ZERO                                  21200003
212100*DMH             CONTINUE                                         21210003
212200*DMH         WHEN SQLWARN0 NOT = SPACES                           21220003
212300*DMH         WHEN SQLCODE < ZERO                                  21230003
212400*DMH         WHEN SQLCODE > ZERO                                  21240003
212500*DMH             MOVE '6100-UPDATE-MESSAGE-TABLE'                 21250003
212600*DMH                               TO DP013-PARAGRAPH             21260003
212700*DMH             MOVE 'UPDATE TABLE       - '                     21270003
212800*DMH                               TO DP013-MESSAGE-TEXT (1)      21280003
212900*DMH             MOVE SQLCA        TO DP013-SQLCA                 21290003
213000*DMH             MOVE 'TLBVRMG '   TO DP013-DB2-TABLE-NAME (1)    21300003
213100*DMH             SET DP013-DB2-ABEND                              21310003
213200*DMH                 DP013-XCTL-DISPLAY-RESTART TO TRUE           21320003
213300*DMH             SET DP013-ROLLBACK                               21330003
213400*DMH                               TO TRUE                        21340003
213500*DMH             PERFORM DP014-0000-PROCESS-ABEND                 21350003
213600*DMH     END-EVALUATE.                                            21360003
213700*DMH                                                              21370003
213800***************************************************************** 21380003
213900* REMOVED THIS PARAGRAPH 2/12/10 - DMH                          * 21390003
214000***************************************************************** 21400003
214100*DMH 7000-SELECT-UPC.                                             21410003
214200**********************************************************        21420003
214300*DMH                                                              21430003
214400*DMH MOVE SU006-UPC                   TO DK-UPC-NUMBER.           21440003
214500*DMH                                                              21450003
214600*DMH EXEC SQL                                                     21460003
214700*DMH     SELECT                                                   21470003
214800*DMH             C.VS_ID                                          21480003
214900*DMH           , B.KOHLS_SIZE_CDE                                 21490003
215000*DMH           , D.SHIP_WD_QTY                                    21500003
215100*DMH           , D.SHIP_DPTH_QTY                                  21510003
215200*DMH           , D.SHIP_HT_QTY                                    21520003
215300*DMH           , D.SHIP_WT_QTY                                    21530003
215400*DMH           , D.SHIP_DIM_SRC_CDE                               21540003
215500*DMH     INTO                                                     21550003
215600*DMH             :XLV00001-VS-ID                                  21560003
215700*DMH           , :XLV00000-KOHLS-SIZE-CDE                         21570003
215800*DMH           , :XLV00004-SHIP-WD-QTY                            21580003
215900*DMH           , :XLV00004-SHIP-DPTH-QTY                          21590003
216000*DMH           , :XLV00004-SHIP-HT-QTY                            21600003
216100*DMH           , :XLV00004-SHIP-WT-QTY                            21610003
216200*DMH           , :XLV00004-SHIP-DIM-SRC-CDE                       21620003
216300*DMH     FROM                                                     21630003
216400*DMH             XLV_UPC A                                        21640003
216500*DMH           , XLV_SKU B                                        21650003
216600*DMH           , XLV_VND_STYL C                                   21660003
216700*DMH           , XLV_WEB_SKU D                                    21670003
216800*DMH     WHERE                                                    21680003
216900*DMH             A.UPC_NBR            = :DK-UPC-NUMBER            21690003
217000*DMH      AND    A.INTR_UPC_ID        = B.INTR_UPC_ID             21700003
217100*DMH      AND    A.INTR_UPC_ID        = D.INTR_UPC_ID             21710003
217200*DMH      AND    B.STYL_ID            = C.STYL_ID                 21720003
217300*DMH END-EXEC.                                                    21730003
217400*DMH                                                              21740003
217500*DMH EVALUATE TRUE                                                21750003
217600*DMH     WHEN SQLCODE = ZERO                                      21760003
217700*DMH        SET PS-WEB-ITEM-EXISTS TO TRUE                        21770003
217800*DMH        IF XLV00004-SHIP-WD-QTY = ZERO      OR                21780003
217900*DMH           XLV00004-SHIP-DPTH-QTY = ZERO  OR                  21790003
218000*DMH           XLV00004-SHIP-HT-QTY = ZERO    OR                  21800003
218100*DMH           XLV00004-SHIP-WT-QTY = ZERO    OR                  21810003
218200*DMH           XLV00004-SHIP-DIM-SRC-CDE = PC-E OR                21820003
218300*DMH           XLV00004-SHIP-DIM-SRC-CDE = PC-P                   21830003
218400*DMH            SET PS-UPDATE-THIS-UPC TO TRUE                    21840003
218500*DMH            SET PS-ALL-VALID-SIZ-WGT TO TRUE                  21850003
218600*DMH        ELSE                                                  21860003
218700*DMH            SET PS-NOT-VALID-SIZ-WGT TO TRUE                  21870003
218800*DMH            PERFORM 7100-PROCESS-SIZE-WEIGHT-CSR              21880003
218900*DMH        END-IF                                                21890003
219000*DMH     WHEN SQLCODE = +100                                      21900003
219100*DMH        SET PS-NO-WEB-ITEM   TO TRUE                          21910003
219200*DMH     WHEN OTHER                                               21920003
219300*DMH         MOVE '7000-SELECT-UPC'                               21930003
219400*DMH                           TO DP013-PARAGRAPH                 21940003
219500*DMH         MOVE 'SELECT FROM TABLE  - '                         21950003
219600*DMH                           TO DP013-MESSAGE-TEXT (1)          21960003
219700*DMH         MOVE SQLCA        TO DP013-SQLCA                     21970003
219800*DMH         MOVE 'TUPC'       TO DP013-DB2-TABLE-NAME (1)        21980003
219900*DMH         MOVE 'TWEBITM'    TO DP013-DB2-TABLE-NAME (1)        21990003
220000*DMH         SET DP013-DB2-ABEND                                  22000003
220100*DMH             DP013-XCTL-DISPLAY-RESTART TO TRUE               22010003
220200*DMH         SET DP013-ROLLBACK                                   22020003
220300*DMH                           TO TRUE                            22030003
220400*DMH         PERFORM DP014-0000-PROCESS-ABEND                     22040003
220500*DMH END-EVALUATE.                                                22050003
220600                                                                  22060003
220700*** REMOVED CURSOR 2/11/10 DMH                                    22070003
220800*DMH 7100-PROCESS-SIZE-WEIGHT-CSR.                                22080003
220900*DMH PERFORM 7101-OPEN-SIZE-WEIGHT-CURSOR.                        22090003
221000*DMH PERFORM 7102-FETCH-SIZE-WEIGHT-CURSOR.                       22100003
221100*DMH PERFORM 7103-CLOSE-SIZE-WEIGHT-CURSOR.                       22110003
221200                                                                  22120003
221300******************************************************************22130003
221400* 7101-OPEN-SIZE-WEIGHT-CURSOR                                   *22140003
221500******************************************************************22150003
221600*DMH 7101-OPEN-SIZE-WEIGHT-CURSOR.                                22160003
221700*DMH                                                              22170003
221800*DMH EXEC SQL                                                     22180003
221900*DMH     OPEN SIZE-WEIGHT-CURSOR                                  22190003
222000*DMH END-EXEC.                                                    22200003
222100*DMH                                                              22210003
222200*DMH EVALUATE TRUE                                                22220003
222300*DMH     WHEN SQLCODE = ZERO                                      22230003
222400*DMH         CONTINUE                                             22240003
222500*DMH                                                              22250003
222600*DMH     WHEN SQLWARN0 NOT = SPACES                               22260003
222700*DMH     WHEN SQLCODE < ZERO                                      22270003
222800*DMH     WHEN SQLCODE > ZERO                                      22280003
222900*DMH         MOVE '7101-OPEN-SIZE-WEIGHT-CURSOR'                  22290003
223000*DMH                               TO DP013-PARAGRAPH             22300003
223100*DMH         MOVE 'OPEN SIZE-WEIGHT-CURSOR'                       22310003
223200*DMH                               TO DP013-MESSAGE-TEXT (1)      22320003
223300*DMH         MOVE UPC-VS-ID        TO DP013-MESSAGE-TEXT (2)      22330003
223400*DMH         MOVE UPC-SUB-CL-MDSEAR-ID                            22340003
223500*DMH                               TO DP013-MESSAGE-TEXT (3)      22350003
223600*DMH         MOVE UPC-KOHLS-SIZE-CDE                              22360003
223700*DMH                               TO DP013-MESSAGE-TEXT (4)      22370003
223800*DMH         MOVE SQLCA            TO DP013-SQLCA                 22380003
223900*DMH         MOVE 'TUPC'           TO DP013-DB2-TABLE-NAME (1)    22390003
224000*DMH         MOVE 'TWEBITM'        TO DP013-DB2-TABLE-NAME (2)    22400003
224100*DMH         SET DP013-DB2-ABEND   TO TRUE                        22410003
224200*DMH         SET DP013-NO-ROLLBACK TO TRUE                        22420003
224300*DMH         PERFORM 9999-WRITE-CICS-LOG-MSG                      22430003
224400*DMH         MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               22440003
224500*DMH         PERFORM 8100-SEND-DATA-ONLY                          22450003
224600*DMH         PERFORM 8200-RETURN-TRANID                           22460003
224700*DMH END-EVALUATE.                                                22470003
224800                                                                  22480003
224900******************************************************************22490003
225000* 7102-FETCH-SIZE-WEIGHT-CURSOR                                  *22500003
225100******************************************************************22510003
225200*DMH 7102-FETCH-SIZE-WEIGHT-CURSOR.                               22520003
225300*DMH                                                              22530003
225400*DMH EXEC SQL                                                     22540003
225500*DMH     FETCH SIZE-WEIGHT-CURSOR                                 22550003
225600*DMH     INTO    :XLV00004-SHIP-WD-QTY                            22560003
225700*DMH           , :XLV00004-SHIP-DPTH-QTY                          22570003
225800*DMH           , :XLV00004-SHIP-HT-QTY                            22580003
225900*DMH           , :XLV00004-SHIP-WT-QTY                            22590003
226000*DMH           , :XLV00004-SHIP-DIM-SRC-CDE                       22600003
226100*DMH END-EXEC.                                                    22610003
226200*DMH                                                              22620003
226300*DMH EVALUATE TRUE                                                22630003
226400*DMH     WHEN SQLCODE = ZERO                                      22640003
226500*DMH         CONTINUE                                             22650003
226600*DMH                                                              22660003
226700*DMH     WHEN SQLCODE = +100                                      22670003
226800*DMH         SET PS-ALL-VALID-SIZ-WGT        TO TRUE              22680003
226900*DMH                                                              22690003
227000*DMH     WHEN SQLWARN0 NOT = SPACES                               22700003
227100*DMH     WHEN SQLCODE < ZERO                                      22710003
227200*DMH     WHEN SQLCODE > ZERO                                      22720003
227300*DMH         MOVE '7102-FETCH-SIZE-WEIGHT-CURSOR'                 22730003
227400*DMH                               TO DP013-PARAGRAPH             22740003
227500*DMH         MOVE 'FETCH OF SIZE-WEIGHT-CURSOR'                   22750003
227600*DMH                               TO DP013-MESSAGE-TEXT (1)      22760003
227700*DMH         MOVE UPC-VS-ID        TO DP013-MESSAGE-TEXT (2)      22770003
227800*DMH         MOVE UPC-SUB-CL-MDSEAR-ID                            22780003
227900*DMH                               TO DP013-MESSAGE-TEXT (3)      22790003
228000*DMH         MOVE UPC-KOHLS-SIZE-CDE                              22800003
228100*DMH                               TO DP013-MESSAGE-TEXT (4)      22810003
228200*DMH         MOVE SQLCA            TO DP013-SQLCA                 22820003
228300*DMH         MOVE 'TUPC'           TO DP013-DB2-TABLE-NAME (1)    22830003
228400*DMH         MOVE 'TWEBITM'        TO DP013-DB2-TABLE-NAME (2)    22840003
228500*DMH         MOVE SQLCA            TO DP013-SQLCA                 22850003
228600*DMH         SET DP013-DB2-ABEND   TO TRUE                        22860003
228700*DMH         SET DP013-NO-ROLLBACK TO TRUE                        22870003
228800*DMH         PERFORM 9999-WRITE-CICS-LOG-MSG                      22880003
228900*DMH         MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               22890003
229000*DMH         PERFORM 8100-SEND-DATA-ONLY                          22900003
229100*DMH         PERFORM 8200-RETURN-TRANID                           22910003
229200*DMH END-EVALUATE.                                                22920003
229300*DMH                                                              22930003
229400******************************************************************22940003
229500* 7103-CLOSE-SIZE-WEIGHT-CURSOR                                  *22950003
229600******************************************************************22960003
229700*DMH 7103-CLOSE-SIZE-WEIGHT-CURSOR.                               22970003
229800*DMH                                                              22980003
229900*DMH EXEC SQL                                                     22990003
230000*DMH     CLOSE SIZE-WEIGHT-CURSOR                                 23000003
230100*DMH END-EXEC.                                                    23010003
230200*DMH                                                              23020003
230300*DMH EVALUATE TRUE                                                23030003
230400*DMH     WHEN SQLCODE = ZERO                                      23040003
230500*DMH         CONTINUE                                             23050003
230600*DMH                                                              23060003
230700*DMH     WHEN SQLWARN0 NOT = SPACES                               23070003
230800*DMH     WHEN SQLCODE < ZERO                                      23080003
230900*DMH     WHEN SQLCODE > ZERO                                      23090003
231000*DMH         MOVE '7103-CLOSE-SIZE-WEIGHT-CURSOR'                 23100003
231100*DMH                               TO DP013-PARAGRAPH             23110003
231200*DMH         MOVE 'CLOSE OF SIZE-WEIGHT-CURSOR'                   23120003
231300*DMH                               TO DP013-MESSAGE-TEXT (1)      23130003
231400*DMH         MOVE SQLCA            TO DP013-SQLCA                 23140003
231500*DMH         MOVE UPC-VS-ID        TO DP013-MESSAGE-TEXT (2)      23150003
231600*DMH         MOVE UPC-SUB-CL-MDSEAR-ID                            23160003
231700*DMH                               TO DP013-MESSAGE-TEXT (3)      23170003
231800*DMH         MOVE UPC-KOHLS-SIZE-CDE                              23180003
231900*DMH                               TO DP013-MESSAGE-TEXT (4)      23190003
232000*DMH         MOVE SQLCA            TO DP013-SQLCA                 23200003
232100*DMH         MOVE 'TUPC'           TO DP013-DB2-TABLE-NAME (1)    23210003
232200*DMH         MOVE 'TWEBITM'        TO DP013-DB2-TABLE-NAME (2)    23220003
232300*DMH         SET DP013-DB2-ABEND   TO TRUE                        23230003
232400*DMH         SET DP013-NO-ROLLBACK TO TRUE                        23240003
232500*DMH         PERFORM 9999-WRITE-CICS-LOG-MSG                      23250003
232600*DMH         MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               23260003
232700*DMH         PERFORM 8100-SEND-DATA-ONLY                          23270003
232800*DMH         PERFORM 8200-RETURN-TRANID                           23280003
232900*DMH END-EVALUATE.                                                23290003
233000                                                                  23300003
233100                                                                  23310003
233200***************************************************************** 23320003
233300*                                                               * 23330003
233400***************************************************************** 23340003
233500 7200-GET-GARMENT-ON-HANGER.                                      23350003
233600                                                                  23360003
233700     INITIALIZE PV-DB2-COUNT.                                     23370003
233800     EXEC SQL                                                     23380003
233900         SELECT COUNT(*)                                          23390003
234000         INTO :PV-DB2-COUNT                                       23400003
234100         FROM TPOAGMT                                             23410003
234200         WHERE PO_NBR           = :SU006-PO                       23420003
234300             AND AGRMT_TYP_ID   = '4'                             23430003
234400             AND VER_STATUS_CDE = 'A'                             23440003
234500             AND TYP_CDE        = 2                               23450003
234600     END-EXEC                                                     23460003
234700                                                                  23470003
234800     EVALUATE TRUE                                                23480003
234900         WHEN SQLCODE = ZERO                                      23490003
235000         WHEN SQLCODE = +100                                      23500003
235100             IF  PV-DB2-COUNT > +0                                23510003
235200                 MOVE 'Y'        TO CA-GOH-IND                    23520003
235300             ELSE                                                 23530003
235400                 MOVE 'N'        TO CA-GOH-IND                    23540003
235500             END-IF                                               23550003
235600                                                                  23560003
235700         WHEN SQLWARN0 NOT = SPACES                               23570003
235800         WHEN SQLCODE < ZERO                                      23580003
235900         WHEN SQLCODE > ZERO                                      23590003
236000             MOVE '7200-GET-GARMENT-ON-HANGER'                    23600003
236100                                   TO DP013-PARAGRAPH             23610003
236200             MOVE 'SELECT TPOAGMT'                                23620003
236300                                   TO DP013-MESSAGE-TEXT (1)      23630003
236400             MOVE SQLCA            TO DP013-SQLCA                 23640003
236500             MOVE 'TPOAGMT'        TO DP013-DB2-TABLE-NAME (1)    23650003
236600             SET DP013-DB2-ABEND   TO TRUE                        23660003
236700             SET DP013-NO-ROLLBACK TO TRUE                        23670003
236800             PERFORM 9999-WRITE-CICS-LOG-MSG                      23680003
236900     END-EVALUATE.                                                23690003
237000/                                                                 23700003
237100 7300-GET-BLACKOUT.                                               23710003
237200                                                                  23720003
237300     SET PS-BLACKOUT-NO               TO TRUE                     23730003
237400                                                                  23740003
237500     EXEC SQL                                                     23750003
237600         SELECT 'Y'                                               23760003
237700         INTO                                                     23770003
237800             :PS-BLACKOUT-SW                                      23780003
237900          FROM WST_INTGRTN_TYP   A                                23790003
238000             , WST_ATTR_DEFN   B                                  23800003
238100             , WST_ATTR_ELEM   C                                  23810003
238200             , WST_ATTR_ELEM   D                                  23820003
238300         WHERE  A.INTGRTN_TYP_CDE    =  'TUPCNOUPD'               23830003
238400            AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE         23840003
238500            AND B.ATTR_DEFN_SEQ_NBR  =  1                         23850003
238600            AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE         23860003
238700            AND C.ATTR_DEFN_SEQ_NBR  =  1                         23870003
238800            AND B.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE         23880003
238900            AND D.ATTR_DEFN_SEQ_NBR  =  2                         23890003
239000            AND D.ATTR_ELEM_SEQ_NBR  =  C.ATTR_ELEM_SEQ_NBR       23900003
239100            AND CURRENT TIME >= TIME(C.ATTR_ELEM_TXT)             23910003
239200            AND CURRENT TIME <= TIME(D.ATTR_ELEM_TXT)             23920003
239300         WITH UR                                                  23930003
239400                                                                  23940003
239500     END-EXEC                                                     23950003
239600                                                                  23960003
239700     EVALUATE TRUE                                                23970003
239800         WHEN SQLCODE = ZERO                                      23980003
239900         WHEN SQLCODE = +100                                      23990003
240000             CONTINUE                                             24000003
240100                                                                  24010003
240200         WHEN SQLWARN0 NOT = SPACES                               24020003
240300         WHEN SQLCODE < ZERO                                      24030003
240400         WHEN SQLCODE > ZERO                                      24040003
240500             MOVE '7300-GET-BLACKOUT'                             24050003
240600                                   TO DP013-PARAGRAPH             24060003
240700             MOVE 'SELECT FROM INTEGRATION TBLS'                  24070003
240800                                   TO DP013-MESSAGE-TEXT (1)      24080003
240900             MOVE SQLCA            TO DP013-SQLCA                 24090003
241000             MOVE 'WST_INTGRTN_TYP' TO DP013-DB2-TABLE-NAME (1)   24100003
241100             MOVE 'WST_ATTR_DEFN' TO DP013-DB2-TABLE-NAME (2)     24110003
241200             MOVE 'WST_ATTR_ELEM' TO DP013-DB2-TABLE-NAME (3)     24120003
241300             SET DP013-DB2-ABEND   TO TRUE                        24130003
241400             SET DP013-NO-ROLLBACK TO TRUE                        24140003
241500             PERFORM 9999-WRITE-CICS-LOG-MSG                      24150003
241600     END-EVALUATE.                                                24160003
241700/                                                                 24170003
241800 8000-SEND-MAP.                                                   24180003
241900     EXEC CICS                                                    24190003
242000         SEND                                                     24200003
242100             MAP     ('SU513A')                                   24210003
242200             MAPSET  ('SUKM513')                                  24220003
242300             ERASE                                                24230003
242400             RESP    (PV-CICS-RESPONSE)                           24240003
242500     END-EXEC.                                                    24250003
242600                                                                  24260003
242700     EVALUATE TRUE                                                24270003
242800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 24280003
242900             CONTINUE                                             24290003
243000         WHEN OTHER                                               24300003
243100             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            24310003
243200             MOVE 'UNABLE TO SEND MAP'                            24320003
243300                                    TO DP013-MESSAGE-TEXT (1)     24330003
243400             SET DP013-CICS-ABEND   TO TRUE                       24340003
243500             SET DP013-NO-ROLLBACK  TO TRUE                       24350003
243600             PERFORM 9999-WRITE-CICS-LOG-MSG                      24360003
243700     END-EVALUATE.                                                24370003
243800*                                                                 24380003
243900 8100-SEND-DATA-ONLY.                                             24390003
244000                                                                  24400003
244100     EXEC CICS                                                    24410003
244200         SEND                                                     24420003
244300             MAP       ('SU513A')                                 24430003
244400             MAPSET    ('SUKM513')                                24440003
244500             CURSOR                                               24450003
244600             DATAONLY                                             24460003
244700             RESP      (PV-CICS-RESPONSE)                         24470003
244800     END-EXEC.                                                    24480003
244900                                                                  24490003
245000     EVALUATE TRUE                                                24500003
245100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 24510003
245200             CONTINUE                                             24520003
245300         WHEN OTHER                                               24530003
245400             MOVE '8100-SEND-DATA-ONLY'                           24540003
245500                                    TO DP013-PARAGRAPH            24550003
245600             MOVE 'UNABLE TO SEND DATA'                           24560003
245700                                    TO DP013-MESSAGE-TEXT (1)     24570003
245800             SET DP013-CICS-ABEND   TO TRUE                       24580003
245900             SET DP013-NO-ROLLBACK  TO TRUE                       24590003
246000             PERFORM 9999-WRITE-CICS-LOG-MSG                      24600003
246100     END-EVALUATE.                                                24610003
246200*                                                                 24620003
246300 8200-RETURN-TRANID.                                              24630003
246400     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          24640003
246500                                                                  24650003
246600     EXEC CICS                                                    24660003
246700         RETURN                                                   24670003
246800             TRANSID   (PC-CURRENT-TRANID)                        24680003
246900             COMMAREA  (CA-COMMAREA)                              24690003
247000             LENGTH    (PV-COMMAREA-LENGTH)                       24700003
247100             RESP      (PV-CICS-RESPONSE)                         24710003
247200     END-EXEC.                                                    24720003
247300                                                                  24730003
247400     EVALUATE TRUE                                                24740003
247500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 24750003
247600             CONTINUE                                             24760003
247700         WHEN OTHER                                               24770003
247800             MOVE '8200-RETURN-TRANID'                            24780003
247900                                    TO DP013-PARAGRAPH            24790003
248000             MOVE 'UNABLE TO RETURN TO TRANID'                    24800003
248100                                    TO DP013-MESSAGE-TEXT (1)     24810003
248200             SET DP013-CICS-ABEND   TO TRUE                       24820003
248300             SET DP013-NO-ROLLBACK  TO TRUE                       24830003
248400             PERFORM 9999-WRITE-CICS-LOG-MSG                      24840003
248500     END-EVALUATE.                                                24850003
248600/                                                                 24860003
248700 8600-CALL-XLKUT001.                                              24870003
248800                                                                  24880003
248900     CALL XL001-VSM-PGM  USING DFHEIBLK                           24890003
249000                              XL001-COMMAREA                      24900003
249100                              XL001-ITEM-COMMAREA.                24910003
249200                                                                  24920003
249300     EVALUATE TRUE                                                24930003
249400         WHEN XL001-SUCCESSFUL                                    24940003
249500         WHEN XL001-SKU-NOT-FOUND                                 24950003
249600         WHEN XL001-UPC-NOT-FOUND                                 24960003
249700             CONTINUE                                             24970003
249800         WHEN XL001-SQL-ERROR                                     24980003
249900         WHEN XL001-INVALID-ACCESS                                24990003
250000            MOVE XL001-SKU-SQLCODE TO  PV-DISP-SKU-SQL-CDE        25000003
250100            MOVE XL001-VND-STYL-SQLCODE TO                        25010003
250200                                       PV-DISP-VS-SQL-CDE         25020003
250300            MOVE XL001-SKU-STR-SQLCODE TO                         25030003
250400                                   PV-DISP-SKU-STR-SQL-CDE        25040003
250500            MOVE XL001-WEB-SKU-SQLCODE TO                         25050003
250600                                       PV-DISP-WEB-SQL-CDE        25060003
250700            MOVE XL001-UPC-SQLCODE TO  PV-DISP-UPC-SQL-CDE        25070003
250800             MOVE '8600-CALL-XLKUT001' TO DP013-PARAGRAPH         25080003
250900             STRING  'SUKRF513 - DB2 ERROR IN PROGRAM: '          25090003
251000                     XL001-RETURN-CODE                            25100003
251100                     '  UPC/SKU = '    PV-DISP-VALUE              25110009
251200                        DELIMITED BY SIZE                         25120003
251300                                    INTO DP013-MESSAGE-TEXT (1)   25130003
251400             STRING 'ERROR PARA = '                               25140003
251500                     XL001-ERROR-PARAGRAPH-NBR                    25150003
251600                    'CONT PARA = '                                25160003
251700                     XL001-CONTENTION-ERR-PARA-NBR                25170003
251800                        DELIMITED BY SIZE                         25180003
251900                                    INTO DP013-MESSAGE-TEXT (2)   25190003
252000             STRING 'SKU SQL = '                                  25200003
252100                     PV-DISP-SKU-SQL-CDE                          25210003
252200                    ' VND-STYL SQL = '                            25220003
252300                     PV-DISP-VS-SQL-CDE                           25230003
252400                        DELIMITED BY SIZE                         25240003
252500                                    INTO DP013-MESSAGE-TEXT (3)   25250003
252600             STRING ' SKU-STOR SQL = '                            25260003
252700                     PV-DISP-SKU-STR-SQL-CDE                      25270003
252800                    ' WEB-SKU SQL = '                             25280003
252900                     PV-DISP-WEB-SQL-CDE                          25290003
253000                    ' UPC SQL = '                                 25300003
253100                     PV-DISP-UPC-SQL-CDE                          25310003
253200                        DELIMITED BY SIZE                         25320003
253300                                    INTO DP013-MESSAGE-TEXT (4)   25330003
253400             SET DP013-CICS-ABEND                                 25340003
253500                 DP013-ROLLBACK       TO TRUE                     25350003
253600             PERFORM 9999-WRITE-CICS-LOG-MSG                      25360003
253700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               25370003
253800             PERFORM 8100-SEND-DATA-ONLY                          25380003
253900             PERFORM 8200-RETURN-TRANID                           25390003
254000         WHEN OTHER                                               25400003
254100             MOVE '8600-CALL-XLKUT001' TO DP013-PARAGRAPH         25410003
254200             MOVE 'SUKRF513 - UNDETERMINED ERROR IN PROGRAM: '    25420003
254300                                      TO DP013-MESSAGE-TEXT (1)   25430003
254400             MOVE 'XLKUT001'          TO DP013-MESSAGE-TEXT (2)   25440003
254500             SET DP013-CICS-ABEND                                 25450003
254600                 DP013-ROLLBACK       TO TRUE                     25460003
254700             PERFORM 9999-WRITE-CICS-LOG-MSG                      25470003
254800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               25480003
254900             PERFORM 8100-SEND-DATA-ONLY                          25490003
255000             PERFORM 8200-RETURN-TRANID                           25500003
255100     END-EVALUATE.                                                25510003
255200/                                                                 25520003
255300 9999-WRITE-CICS-LOG-MSG.                                         25530003
255400     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            25540003
255500     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           25550003
255600     INITIALIZE DP013-SRC-TASK-NUMBER                             25560003
255700                DP013-STACK.                                      25570003
255800     SET DP013-LINK-RETURN           TO TRUE.                     25580003
255900                                                                  25590003
256000     EXEC CICS                                                    25600003
256100         LINK                                                     25610003
256200             PROGRAM   (DP013-NAME)                               25620003
256300             COMMAREA  (DP013-PARAMETERS)                         25630003
256400             LENGTH    (DP013-LENGTH)                             25640003
256500     END-EXEC.                                                    25650003
256600                                                                  25660003
256700*----------------------------------------------------------------*25670003
256800*    ABEND PROCESSOR MODULE                                      *25680003
256900*----------------------------------------------------------------*25690003
257000                                                                  25700003
257100     COPY DPPD014.                                                25710003
257200                                                                  25720003
