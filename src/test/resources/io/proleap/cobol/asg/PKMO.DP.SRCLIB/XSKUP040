000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             XSKUP040.                                00050001
000600 AUTHOR.                 LIHUA LIANG.                             00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            DECEMBER 2002.                           00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100***************************************************************** 00110001
001200*                                                                 00120001
001300*  THIS PROGRAM WILL IDENTIFY ANY CHANGED RECORDS IN THE VENDOR   00130001
001400*  EXTRACT FILE AND PERFORM ANY NECESSARY MAINTENANCE TO THE      00140001
001400*  XS DOMAIN'S VENDOR (XST_VND) TABLE.                            00150001
001500*                                                                 00160001
001600*   INPUT: UPD01 - CONTAINS THE LAST SUCCESSFUL COMPLETION        00170002
001600*                  TIMESTAMP.                                     00180002
001700*          INP01 - CONTAINS ABEND THRESHOLD NUMBER.               00190002
001700*          INP02 - CONTAINS VENDOR INFORMATION.                   00201022
001700*   OUTPUT:OUT01 - CONTAINS ERROR RECORD(S).                      00210002
001900*                                                                 00220001
      **03/18/2003 CHANGED BY:SANDY POTTER  ADDED THIRD CONTROL CARD TO 00221019
      **           REPLACE LITERAL.  ADDED COUNTS AND DISPLAY OF COUNTS.00222019
      **           ADDED SETTING RETURN CODE TO 04 IF ANY ERRORS.       00223019
      **           REMOVED HISTORY TIMESTAMP AND NOW LOAD ALL VENDORS,  00224022
      **           EVEN REALLY OLD INACTIVE ONES.                       00225022
      **           CORRECTED EXTRACT AND ERROR RECORD LENGTHS.          00226023
007100***************************************************************** 00230001
007200 ENVIRONMENT DIVISION.                                            00240001
007300***************************************************************** 00250001
007400                                                                  00260001
007500 CONFIGURATION SECTION.                                           00270001
007600                                                                  00280001
007700 SOURCE-COMPUTER.        IBM-3090.                                00290001
007800 OBJECT-COMPUTER.        IBM-3090.                                00300001
007900                                                                  00310001
008000 INPUT-OUTPUT SECTION.                                            00320001
008100                                                                  00330001
008200 FILE-CONTROL.                                                    00340001
008300                                                                  00350001
008400     SELECT LAST-SUCCESSFUL-TMST-FILE                             00360007
008500         ASSIGN TO UPD01.                                         00370001
008600                                                                  00380001
008400     SELECT ABEND-THRESHOLD-NBR-FILE                              00390001
008500         ASSIGN TO INP01.                                         00400001
008600                                                                  00410001
008700     SELECT VENDOR-EXTRACT-FILE                                   00420002
008800         ASSIGN TO INP02.                                         00430022
008900                                                                  00440001
008700     SELECT ERROR-FILE                                            00450001
008800         ASSIGN TO OUT01.                                         00460001
008900                                                                  00470001
009100******************************************************************00480001
009200 DATA DIVISION.                                                   00490001
009300******************************************************************00500001
009400                                                                  00510001
009500 FILE SECTION.                                                    00520001
009600                                                                  00530001
009700 FD  LAST-SUCCESSFUL-TMST-FILE                                    00540007
009800     RECORDING MODE IS F                                          00550001
009900     BLOCK CONTAINS 0 RECORDS                                     00560001
010000     LABEL RECORDS ARE STANDARD.                                  00570001
010100                                                                  00580001
010200 01  LAST-SUCCESSFUL-TMST-RECORD      PIC X(80).                  00590013
010300                                                                  00600001
009700 FD  ABEND-THRESHOLD-NBR-FILE                                     00610001
009800     RECORDING MODE IS F                                          00620001
009900     BLOCK CONTAINS 0 RECORDS                                     00630001
010000     LABEL RECORDS ARE STANDARD.                                  00640001
010100                                                                  00650001
010200 01  ABEND-THRESHOLD-NBR-RECORD       PIC X(80).                  00660001
010300                                                                  00670001
010400 FD  VENDOR-EXTRACT-FILE                                          00680002
010500     RECORDING MODE IS F                                          00690001
010600     BLOCK CONTAINS 0  RECORDS.                                   00700001
010700                                                                  00710001
010800 01  VENDOR-EXTRACT-RECORD            PIC  X(150).                00720023
010900                                                                  00730001
010400 FD  ERROR-FILE                                                   00740001
010500     RECORDING MODE IS F                                          00750001
010600     BLOCK CONTAINS 0  RECORDS.                                   00760001
010700                                                                  00770001
010800 01  ERROR-RECORD                     PIC  X(150).                00780023
010900                                                                  00790001
011100******************************************************************00800001
011200 WORKING-STORAGE SECTION.                                         00810001
011300******************************************************************00820001
011600                                                                  00830001
011400 01  FILLER                           PIC X(50)  VALUE            00840001
011500     ' *** WORKING STORAGE STARTS HERE FOR XSKUP040 *** '.        00850001
011600                                                                  00860001
009100******************************************************************00870001
009200* CONTROL CARD 1 (UPD001). CONTAINS THE LAST SUCCESSFUL RUN DATE. 00880022
009300******************************************************************00890001
009000                                                                  00900001
009400 01  CC-CONTROL-CARD-1.                                           00910001
009500     05  CC-LAST-SUCCESS-TMST         PIC  X(26) VALUE SPACE.     00920010
010500     05  FILLER                       PIC  X(54) VALUE SPACE.     00930010
009000                                                                  00940001
009100******************************************************************00950001
009200* CONTROL CARD 2 (INP001). CONTAINS THE ABEND THRESHOLD NUMBER.   00960022
009300******************************************************************00970001
009000                                                                  00980001
009400 01  CC-CONTROL-CARD-2.                                           00990001
009500     05  CC-ABEND-THRESHOLD-NBR       PIC  9(04) VALUE ZERO.      01000001
010500     05  FILLER                       PIC  X(76) VALUE SPACE.     01010001
011000                                                                  01020001
013200******************************************************************01030001
013300*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01040001
013400******************************************************************01050001
013500     COPY DPWS500.                                                01060001
013600                                                                  01070001
013700 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       01080001
013800                                                 COMP SYNC.       01090001
013900     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     01100001
014000     88  AC-DB2-ERROR                            VALUE +4013.     01110001
014100     88  AC-CALENDAR-ROUTINE-ERROR               VALUE +4019.     01120001
014300                                                                  01130001
014500 01  PS-PROGRAM-SWITCHES.                                         01140001
014600     05  PS-END-OF-EXTRACT-FILE-SW    PIC  X(01) VALUE 'N'.       01150001
014700         88  PS-END-OF-EXTRACT-FILE-YES          VALUE 'Y'.       01160001
014800     05  PS-END-OF-FILE-1-SW          PIC  X(01) VALUE 'N'.       01170001
014900         88  PS-END-OF-FILE-1-YES                VALUE 'Y'.       01180001
015100     05  PS-END-OF-FILE-2-SW          PIC  X(01) VALUE 'N'.       01190001
015200         88  PS-END-OF-FILE-2-YES                VALUE 'Y'.       01200001
015100     05  PS-MOVE-ON-SW                PIC  X(01) VALUE 'N'.       01210011
015200         88  PS-MOVE-ON-YES                      VALUE 'Y'.       01220011
015200         88  PS-MOVE-ON-NO                       VALUE 'N'.       01230011
016200                                                                  01240001
016300 01  PC-CONSTANTS.                                                01250001
016700     05  PC-ROW-NOT-FOUND             PIC S9(04) VALUE +100.      01260001
016700     05  PC-INSERT                    PIC  X(01) VALUE 'I'.       01270001
016700     05  PC-UPDATE                    PIC  X(01) VALUE 'U'.       01280001
016700     05  PC-INACTIVE                  PIC  X(01) VALUE 'I'.       01290007
016700     05  PC-MAX-DB2-ERROR-5           PIC  9(01) VALUE 5.         01300001
016900     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE            01310001
017000                                      'XSKUP040'.                 01320005
016900     05  PC-ORIGINAL-TMSTMP           PIC  X(26) VALUE            01350005
017000         '0001-01-01-00.00.00.000000'.                            01360016
020100                                                                  01370001
022400 01  PV-MISC-FIELDS.                                              01380001
024200     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     01390001
024300     05  PV-DB2-ERROR-COUNT           PIC  9(01) VALUE ZERO.      01400001
024300     05  PV-ERROR-RECORD-COUNT        PIC  9(04) VALUE ZERO.      01410001
024400     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     01420001
024400     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     01430001
024500     05  PV-DB2-OPERATION             PIC  X(40) VALUE SPACE.     01440001
024500     05  PV-HOLD-TMST                 PIC  X(26) VALUE SPACE.     01450007
024300     05  PV-EXTRACT-READ-CNT          PIC  9(07) VALUE ZERO.      01451018
024300     05  PV-CHECK-VND-CNT             PIC  9(07) VALUE ZERO.      01452018
024300     05  PV-INSERT-VND-CNT            PIC  9(07) VALUE ZERO.      01453018
024300     05  PV-UPDATE-VND-CNT            PIC  9(07) VALUE ZERO.      01454018
024900                                                                  01460001
022400     COPY VNRD100.                                                01470024
024900                                                                  01480001
022400 01  OUT-ERROR-FILE.                                              01490001
000200     05  OUT-ENT-ID                   PIC S9(09) COMP.            01500001
000300     05  OUT-VND-NBR                  PIC  X(09).                 01510005
000500     05  OUT-PRIM-TYP-CDE             PIC  X(01).                 01520004
007300     05  OUT-PRIMARY-NAME             PIC  X(30).                 01530005
007400     05  OUT-STATUS-CDE               PIC  X(01).                 01540004
007600     05  OUT-CRE-TMST                 PIC  X(26).                 01550005
007800     05  OUT-LAST-UPD-TMST            PIC  X(26).                 01560005
000300     05  FILLER                       PIC  X(47).                 01571023
000300     05  OUT-INSRT-UPD-IND            PIC  X(01).                 01572023
000300     05  OUT-SQLCODE                  PIC S9(05).                 01580001
024900                                                                  01600001
046900******************************************************************01610001
047000*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01620001
047100******************************************************************01630001
047300                                                                  01640001
047200     COPY DPWS004.                                                01650001
047300                                                                  01660001
047400******************************************************************01670001
047500*  DB2 COMMUNICATION AREA.                                        01680001
047600******************************************************************01690001
047300                                                                  01700001
047700     EXEC SQL                                                     01710001
047800          INCLUDE SQLCA                                           01720001
047900     END-EXEC.                                                    01730001
047300                                                                  01740001
048000******************************************************************01750001
048100*  DB2 TABLE DB2PDBA.XST_VND - VENDOR TABLE.                      01760003
048200******************************************************************01770001
047300                                                                  01780001
048300     EXEC SQL                                                     01790001
048400          INCLUDE XST00018                                        01800003
048500     END-EXEC.                                                    01810001
047300                                                                  01820001
074100***************************************************************** 01830001
074400 PROCEDURE DIVISION.                                              01840001
074300***************************************************************** 01850001
074500                                                                  01860001
074600******************************************************************01870001
075000 0000-MAINLINE-PARAGRAPH.                                         01880001
074900******************************************************************01890001
075100                                                                  01900001
075200     PERFORM 1000-HOUSE-KEEPING.                                  01910001
075100                                                                  01920001
075300     PERFORM 2000-PROCESS-EXTRACT-FILE                            01930001
075400       UNTIL PS-END-OF-EXTRACT-FILE-YES.                          01940001
075100                                                                  01950001
075500     PERFORM 3000-CLOSE-FILES.                                    01960001
075100                                                                  01970001
075500     PERFORM 7500-UPDATE-CONTROL-CARD.                            01980001
075100                                                                  01990001
           PERFORM 9000-END-OF-PGM.                                     01991018
                                                                        01992018
075600     STOP RUN.                                                    02000001
075700                                                                  02010001
075900******************************************************************02020001
076500 1000-HOUSE-KEEPING.                                              02030001
076100*     OPEN INPUT FILES AND PROCESS CONTROL CARDS.                 02040001
076400******************************************************************02050001
076600                                                                  02060001
079763     OPEN INPUT LAST-SUCCESSFUL-TMST-FILE                         02070007
079763                ABEND-THRESHOLD-NBR-FILE                          02080001
076800                VENDOR-EXTRACT-FILE                               02090002
076800         OUTPUT ERROR-FILE.                                       02100001
079765                                                                  02110001
079794     READ LAST-SUCCESSFUL-TMST-FILE INTO CC-CONTROL-CARD-1        02120007
079795        AT END                                                    02130001
079796           SET PS-END-OF-FILE-1-YES    TO TRUE.                   02140001
079796                                                                  02150011
079796     MOVE CC-LAST-SUCCESS-TMST         TO PV-HOLD-TMST.           02160011
079797                                                                  02170001
079794     READ ABEND-THRESHOLD-NBR-FILE INTO CC-CONTROL-CARD-2         02180001
079795        AT END                                                    02190001
079796           SET PS-END-OF-FILE-2-YES    TO TRUE.                   02200001
079797                                                                  02210001
079779     CLOSE LAST-SUCCESSFUL-TMST-FILE                              02220007
079779           ABEND-THRESHOLD-NBR-FILE.                              02230022
079797                                                                  02240001
079779     IF PS-END-OF-FILE-1-YES OR                                   02250001
079779        PS-END-OF-FILE-2-YES                                      02260022
079780        MOVE '1000-HOUSE-KEEPING'     TO PV-PARAGRAPH-NAME        02270001
079781        MOVE 'CONTROL CARD IS EMPTY'  TO PV-OPERATION-MSG-1       02280001
079782        SET AC-CONTROL-CARD-ERROR     TO TRUE                     02290001
079783        PERFORM 9999-ABEND                                        02300001
079784     END-IF.                                                      02310001
079797                                                                  02320001
079785     DISPLAY 'PROGRAM NAME:       ' PC-CURRENT-PROGRAM-NAME.      02330001
079785     DISPLAY 'CONTROL CARD 1:     ' CC-CONTROL-CARD-1.            02340001
079785     DISPLAY 'CONTROL CARD 2:     ' CC-CONTROL-CARD-2.            02350001
079797                                                                  02360001
079787     IF CC-ABEND-THRESHOLD-NBR IS NUMERIC                         02370001
079787        CONTINUE                                                  02380001
079787     ELSE                                                         02390001
079780        MOVE '1000-HOUSE-KEEPING'     TO PV-PARAGRAPH-NAME        02400001
079781        MOVE 'INVALID THRESHOLD NBR'  TO PV-OPERATION-MSG-1       02410001
079781        MOVE CC-ABEND-THRESHOLD-NBR   TO PV-OPERATION-MSG-2       02420001
079782        SET AC-CONTROL-CARD-ERROR     TO TRUE                     02430001
079783        PERFORM 9999-ABEND                                        02440001
079787     END-IF.                                                      02450001
079797                                                                  02460001
090200******************************************************************02470001
090600 2000-PROCESS-EXTRACT-FILE.                                       02480001
090400*     IF LAST UPDATE TIMESTAMP EQUAL                              02510022
090400*     0001-01-01-00.00.000000 AND CREATE TIMESTAMP GREATER THAN   02520006
090400*     CONTROL CARD TIMESTAMP, OR LAST UPDATE TIMESTAMP NOT EQUAL  02530006
090400*     0001-01-01-00.00.000000 AND LAST UPDATE TIMESTAMP GREATER   02540006
090400*     THAN CONTROL CARD TIMESTAMP, SELECT VENDOR TABLE TO         02550006
090400*     DETERMINE IF UPDATE/INSERT IS NEEDED.                       02560006
090500******************************************************************02570001
090700                                                                  02580001
079794     READ VENDOR-EXTRACT-FILE INTO VN100-VENDOR-EXTRACT-RECD      02590007
079795        AT END                                                    02600001
079796           SET PS-END-OF-EXTRACT-FILE-YES TO TRUE.                02610001
079797                                                                  02620001
079797     IF NOT PS-END-OF-EXTRACT-FILE-YES                            02630001
              ADD +1 TO PV-EXTRACT-READ-CNT                             02631018
                                                                        02632018
079797        IF VN100-LAST-UPD-TMST      = PC-ORIGINAL-TMSTMP          02690022
079797           IF VN100-CRE-TMST        = CC-LAST-SUCCESS-TMST OR     02700022
079797              VN100-CRE-TMST        > CC-LAST-SUCCESS-TMST        02710022
                    ADD +1 TO PV-CHECK-VND-CNT                          02711022
079797              PERFORM 4000-SELECT-VENDOR                          02720022
079797           END-IF                                                 02730022
079797        ELSE                                                      02740022
079797           IF VN100-LAST-UPD-TMST   = CC-LAST-SUCCESS-TMST OR     02750022
079797              VN100-LAST-UPD-TMST   > CC-LAST-SUCCESS-TMST        02760022
                    ADD +1 TO PV-CHECK-VND-CNT                          02761022
134300              PERFORM 4000-SELECT-VENDOR                          02770022
079797           END-IF                                                 02780022
079797        END-IF                                                    02790022
079797     END-IF.                                                      02810001
091300                                                                  02820001
091400******************************************************************02830001
091900 3000-CLOSE-FILES.                                                02840001
091600*     CLOSE EXTRACT FILE.                                         02850001
091800******************************************************************02860001
092000                                                                  02870001
092300     CLOSE VENDOR-EXTRACT-FILE.                                   02880002
092400                                                                  02890001
129600******************************************************************02900001
129900 4000-SELECT-VENDOR.                                              02910002
129800******************************************************************02920001
129500                                                                  02930001
130000     MOVE VN100-ENT-ID                TO XST00018-ENT-ID.         02940003
129500                                                                  02950001
130000     EXEC SQL                                                     02960001
130100        SELECT ENT_NM_DESC                                        02970006
130100              ,VND_NBR                                            02980006
130200          INTO :XST00018-ENT-NM-DESC                              02990005
130200              ,:XST00018-VND-NBR                                  03000005
131400          FROM XST_VND                                            03010006
131500         WHERE ENT_ID      = :XST00018-ENT-ID                     03020006
131500               WITH UR                                            03030006
131800     END-EXEC.                                                    03040001
131900                                                                  03050001
132000     EVALUATE SQLCODE                                             03060001
132100        WHEN ZERO                                                 03070001
079797           IF XST00018-ENT-NM-DESC     = VN100-PRIMARY-NAME AND   03080007
079797              XST00018-VND-NBR         = VN100-VND-NBR            03090006
079797              CONTINUE                                            03100006
079797           ELSE                                                   03110006
134300              MOVE VN100-PRIMARY-NAME TO XST00018-ENT-NM-DESC     03120006
134300              MOVE VN100-VND-NBR      TO XST00018-VND-NBR         03130006
079797              PERFORM 6000-UPDATE-VENDOR                          03140006
079797                 UNTIL PS-MOVE-ON-YES                             03150011
132200              SET PS-MOVE-ON-NO       TO TRUE                     03160011
132200              IF VN100-LAST-UPD-TMST   > PV-HOLD-TMST             03170007
132200                 MOVE VN100-LAST-UPD-TMST                         03180007
132200                                      TO PV-HOLD-TMST             03190007
132200              END-IF                                              03200007
079797           END-IF                                                 03210006
132300        WHEN PC-ROW-NOT-FOUND                                     03220001
134300           MOVE VN100-PRIMARY-NAME    TO XST00018-ENT-NM-DESC     03230009
134300           MOVE VN100-VND-NBR         TO XST00018-VND-NBR         03240009
079797           PERFORM 5000-INSERT-VENDOR                             03250007
079797              UNTIL PS-MOVE-ON-YES                                03260011
132200           SET PS-MOVE-ON-NO          TO TRUE                     03270011
132200           IF VN100-CRE-TMST           > PV-HOLD-TMST             03280007
132200              MOVE VN100-CRE-TMST     TO PV-HOLD-TMST             03290007
132200           END-IF                                                 03300007
132500        WHEN OTHER                                                03310001
132700           MOVE '4000-SELECT-VENDOR'  TO PV-PARAGRAPH-NAME        03320002
133100           PERFORM 9100-SQL-ABEND                                 03330001
133200     END-EVALUATE.                                                03340001
133300                                                                  03350001
133400******************************************************************03360001
133700 5000-INSERT-VENDOR.                                              03370002
133600******************************************************************03380001
133800                                                                  03390001
133900     EXEC SQL                                                     03400001
134000        INSERT INTO XST_VND                                       03410002
134000        VALUES                                                    03420001
134000           (                                                      03430001
134000             :XST00018-ENT-ID                                     03440003
134000            ,:XST00018-ENT-NM-DESC                                03450007
134000            ,:XST00018-VND-NBR                                    03460007
134000            ,CURRENT TIMESTAMP                                    03470001
134000           )                                                      03480001
134100     END-EXEC.                                                    03490001
134200                                                                  03500001
132000     EVALUATE SQLCODE                                             03510004
132100        WHEN ZERO                                                 03520004
                 ADD +1                     TO PV-INSERT-VND-CNT        03521018
132200           SET PS-MOVE-ON-YES         TO TRUE                     03530011
132500        WHEN -904                                                 03540004
132500        WHEN -911                                                 03550004
132500        WHEN -913                                                 03560004
132200           ADD 1                      TO PV-DB2-ERROR-COUNT       03570004
129900           IF PV-DB2-ERROR-COUNT       > PC-MAX-DB2-ERROR-5       03580004
000200              MOVE VN100-ENT-ID       TO OUT-ENT-ID               03590004
000300              MOVE VN100-VND-NBR      TO OUT-VND-NBR              03600004
000500              MOVE VN100-PRIM-TYP-CDE TO OUT-PRIM-TYP-CDE         03610004
000700              MOVE VN100-PRIMARY-NAME TO OUT-PRIMARY-NAME         03620004
007400              MOVE VN100-STATUS-CDE   TO OUT-STATUS-CDE           03630004
007600              MOVE VN100-CRE-TMST     TO OUT-CRE-TMST             03640004
007600              MOVE VN100-LAST-UPD-TMST TO OUT-LAST-UPD-TMST       03650004
129900              MOVE SQLCODE            TO OUT-SQLCODE              03660004
129900              PERFORM 7000-WRITE-ERROR-RECORD                     03670004
129900              ADD 1                   TO PV-ERROR-RECORD-COUNT    03680004
132200              SET PS-MOVE-ON-YES      TO TRUE                     03690011
132200              MOVE ZERO               TO PV-DB2-ERROR-COUNT       03700011
129900              IF PV-ERROR-RECORD-COUNT > CC-ABEND-THRESHOLD-NBR   03710004
134800                 MOVE '5000-INSERT-VENDOR'                        03720004
134800                                      TO PV-PARAGRAPH-NAME        03730004
134800                 MOVE PC-INSERT       TO OUT-INSRT-UPD-IND        03740004
129900                 PERFORM 9100-SQL-ABEND                           03750004
129900              END-IF                                              03760004
129900           END-IF                                                 03770004
132500        WHEN OTHER                                                03780004
000200           MOVE VN100-ENT-ID          TO OUT-ENT-ID               03790004
000300           MOVE VN100-VND-NBR         TO OUT-VND-NBR              03800004
000500           MOVE VN100-PRIM-TYP-CDE    TO OUT-PRIM-TYP-CDE         03810004
007300           MOVE VN100-PRIMARY-NAME    TO OUT-PRIMARY-NAME         03820004
007400           MOVE VN100-STATUS-CDE      TO OUT-STATUS-CDE           03830004
007600           MOVE VN100-CRE-TMST        TO OUT-CRE-TMST             03840004
007800           MOVE VN100-LAST-UPD-TMST   TO OUT-LAST-UPD-TMST        03850004
129900           MOVE SQLCODE               TO OUT-SQLCODE              03860004
129900           PERFORM 7000-WRITE-ERROR-RECORD                        03870004
129900           ADD 1                      TO PV-ERROR-RECORD-COUNT    03880004
132200           SET PS-MOVE-ON-YES         TO TRUE                     03890011
129900           IF PV-ERROR-RECORD-COUNT > CC-ABEND-THRESHOLD-NBR      03900004
134800              MOVE '5000-INSERT-VENDOR'                           03910004
134800                                      TO PV-PARAGRAPH-NAME        03920004
134800              MOVE PC-INSERT          TO OUT-INSRT-UPD-IND        03930004
129900              PERFORM 9100-SQL-ABEND                              03940004
129900           END-IF                                                 03950004
133200     END-EVALUATE.                                                03960004
134200                                                                  03970001
133400******************************************************************03980001
133700 6000-UPDATE-VENDOR.                                              03990002
133600******************************************************************04000001
133800                                                                  04010001
133900     EXEC SQL                                                     04020001
134000        UPDATE XST_VND                                            04030002
134000           SET ENT_NM_DESC   = :XST00018-ENT-NM-DESC              04040007
134000              ,VND_NBR       = :XST00018-VND-NBR                  04050007
134000              ,LAST_UPD_TMST = CURRENT TIMESTAMP                  04060007
134000         WHERE ENT_ID        = :XST00018-ENT-ID                   04070003
134100     END-EXEC.                                                    04080001
134200                                                                  04090001
132000     EVALUATE SQLCODE                                             04100004
132100        WHEN ZERO                                                 04110004
132200           SET PS-MOVE-ON-YES         TO TRUE                     04120011
                 ADD +1                     TO PV-UPDATE-VND-CNT        04121018
132500        WHEN -904                                                 04130004
132500        WHEN -911                                                 04140004
132500        WHEN -913                                                 04150004
132200           ADD 1                      TO PV-DB2-ERROR-COUNT       04160004
129900           IF PV-DB2-ERROR-COUNT       > PC-MAX-DB2-ERROR-5       04170004
000200              MOVE VN100-ENT-ID       TO OUT-ENT-ID               04180004
000300              MOVE VN100-VND-NBR      TO OUT-VND-NBR              04190004
000500              MOVE VN100-PRIM-TYP-CDE TO OUT-PRIM-TYP-CDE         04200004
007300              MOVE VN100-PRIMARY-NAME TO OUT-PRIMARY-NAME         04210004
007400              MOVE VN100-STATUS-CDE   TO OUT-STATUS-CDE           04220004
007600              MOVE VN100-CRE-TMST     TO OUT-CRE-TMST             04230004
007700              MOVE VN100-LAST-UPD-TMST                            04240004
007700                                      TO OUT-LAST-UPD-TMST        04250007
129900              MOVE SQLCODE            TO OUT-SQLCODE              04260004
129900              PERFORM 7000-WRITE-ERROR-RECORD                     04270004
129900              ADD 1                   TO PV-ERROR-RECORD-COUNT    04280004
132200              SET PS-MOVE-ON-YES      TO TRUE                     04290011
132200              MOVE ZERO               TO PV-DB2-ERROR-COUNT       04300011
129900              IF PV-ERROR-RECORD-COUNT > CC-ABEND-THRESHOLD-NBR   04310004
134800                 MOVE '6000-UPDATE-VENDOR'                        04320004
134800                                      TO PV-PARAGRAPH-NAME        04330004
134800                 MOVE PC-UPDATE       TO OUT-INSRT-UPD-IND        04340004
129900                 PERFORM 9100-SQL-ABEND                           04350004
129900              END-IF                                              04360004
129900           END-IF                                                 04370004
132500        WHEN OTHER                                                04380004
000200           MOVE VN100-ENT-ID          TO OUT-ENT-ID               04390004
000300           MOVE VN100-VND-NBR         TO OUT-VND-NBR              04400004
000500           MOVE VN100-PRIM-TYP-CDE    TO OUT-PRIM-TYP-CDE         04410004
007300           MOVE VN100-PRIMARY-NAME    TO OUT-PRIMARY-NAME         04420004
007400           MOVE VN100-STATUS-CDE      TO OUT-STATUS-CDE           04430004
007600           MOVE VN100-CRE-TMST        TO OUT-CRE-TMST             04440004
007700           MOVE VN100-LAST-UPD-TMST   TO OUT-LAST-UPD-TMST        04450004
129900           MOVE SQLCODE               TO OUT-SQLCODE              04460004
129900           PERFORM 7000-WRITE-ERROR-RECORD                        04470004
129900           ADD 1                      TO PV-ERROR-RECORD-COUNT    04480004
132200           SET PS-MOVE-ON-YES         TO TRUE                     04490011
129900           IF PV-ERROR-RECORD-COUNT > CC-ABEND-THRESHOLD-NBR      04500004
134800              MOVE '6000-UPDATE-VENDOR'                           04510004
134800                                      TO PV-PARAGRAPH-NAME        04520004
134800              MOVE PC-UPDATE          TO OUT-INSRT-UPD-IND        04530004
129900              PERFORM 9100-SQL-ABEND                              04540004
129900           END-IF                                                 04550004
133200     END-EVALUATE.                                                04560004
134200                                                                  04570001
116867******************************************************************04580001
116868 7000-WRITE-ERROR-RECORD.                                         04590001
116869*     WRITE ERROR RECORD OUT TO THE FILE.                         04600001
116870******************************************************************04610001
116871                                                                  04620001
116873     WRITE ERROR-RECORD                                           04630001
116873        FROM OUT-ERROR-FILE.                                      04640001
118126                                                                  04650001
117500     INITIALIZE OUT-ERROR-FILE.                                   04660001
117000                                                                  04670001
116867******************************************************************04680001
116868 7500-UPDATE-CONTROL-CARD.                                        04690001
116869*     UPDATE CONTROL CARDS. CLOSE FILES.                          04700001
116870******************************************************************04710001
116871                                                                  04720001
116872     OPEN OUTPUT LAST-SUCCESSFUL-TMST-FILE.                       04730007
118126                                                                  04740001
116872     MOVE PV-HOLD-TMST           TO CC-LAST-SUCCESS-TMST.         04750007
116873     WRITE LAST-SUCCESSFUL-TMST-RECORD                            04760007
116874        FROM CC-CONTROL-CARD-1.                                   04770001
118126                                                                  04780001
117500     CLOSE LAST-SUCCESSFUL-TMST-FILE                              04790007
117500           ERROR-FILE.                                            04800001
059500                                                                  04801018
059600****************************************************************  04802018
059620* 9000-END-OF-PGM.                                                04803018
059630*     DISPLAYS PROGRAM TOTALS.                                    04804018
059631*     SETS THE RETURN CODE TO 04 IF ANY ERROR RECORDS WRITTEN.    04805018
059640***************************************************************** 04806018
059900 9000-END-OF-PGM.                                                 04807018
060000                                                                  04808018
060500     DISPLAY '******** COUNTS **************************'.        04809118
060600     DISPLAY ' EXTRACT REC READ CNT= ' PV-EXTRACT-READ-CNT.       04809218
060600     DISPLAY ' VND ROWS CHECKED CNT= ' PV-CHECK-VND-CNT.          04809320
060600     DISPLAY 'VND ROWS INSERTED CNT= ' PV-INSERT-VND-CNT.         04809420
060600     DISPLAY ' VND ROWS UPDATED CNT= ' PV-UPDATE-VND-CNT.         04809520
060800     DISPLAY '   ERROR RECS WRITTEN= ' PV-ERROR-RECORD-COUNT.     04809618
061000     DISPLAY '                              '.                    04809718
061400     DISPLAY '******************************************'.        04810118
061500                                                                  04810218
061600     IF  PV-ERROR-RECORD-COUNT > 0                                04810318
061700         MOVE 04               TO RETURN-CODE                     04810418
061800     END-IF.                                                      04810518
061900                                                                  04810618
117000                                                                  04811001
180900******************************************************************04820001
181000* 9100-SQL-ABEND                                                  04830001
181100*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.04840001
181200******************************************************************04850001
181300 9100-SQL-ABEND.                                                  04860001
181400     DISPLAY '** ABEND     **'.                                   04870001
181500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04880001
181600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04890001
181700     DISPLAY '** VENDOR ID ** = ' VN100-ENT-ID.                   04900002
181700     DISPLAY '** VENDOR NBR** = ' VN100-VND-NBR.                  04910002
181700     DISPLAY '** TIMESTAMP ** = ' VN100-LAST-UPD-TMST.            04920002
181800                                                                  04930001
181900******************************************************************04940001
182000* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     04950001
182100* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      04960001
182200******************************************************************04970001
182300     COPY DPPD004.                                                04980024
182400                                                                  04990001
182500     SET AC-DB2-ERROR TO TRUE.                                    05000001
182600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05010001
182700                                                                  05020001
182800******************************************************************05030001
182900* 9999-ABEND                                                      05040001
183000*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  05050001
183100******************************************************************05060001
183200 9999-ABEND.                                                      05070001
183300     DISPLAY '** ABEND           **'.                             05080001
183400     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  05090001
183500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05100001
183600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05110001
183700     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05120001
183800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05130001
