000100 IDENTIFICATION DIVISION.                                         00010003
000200 PROGRAM-ID.    ETKCS310.                                         00020003
000300 AUTHOR.        MARC BLAZICH.                                     00030003
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040003
000500 DATE-WRITTEN.  02-22-94.                                         00050003
000600 DATE-COMPILED.                                                   00060003
000700                                                                  00070003
000800*---------------------------------------------------------------* 00080003
000900*    E310 - TRADING PARTNER FUNCTIONAL GROUP LIST               * 00090003
001000*                                                               * 00100003
001100*    THIS PROGRAM WILL GENERATE A LIST OF FUNCTIONAL GROUPS FOR * 00110003
001200*    A GIVEN DKEY.                                              * 00120003
001300*                                                               * 00130003
001400*    CHANGES:                                                   * 00140003
001500*     03/20/97 TOM MEDREK - FIXED APPLICATION SPECIFIC SECTION. * 00150003
001600*       ADDED NRF CODE INDICATOR WHICH WAS ADDED TO ETWS300 &   * 00160003
001700*       ETWS301 EARLIER.                                        * 00170003
001800*---------------------------------------------------------------* 00180003
001810* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00181005
001820*            - CHANGE CALL OF DPKUT100 TO                       * 00182005
001830*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00183005
001840*              MAKING THE CALL DYNAMIC VS STATIC                * 00184005
001850*                                                               * 00185005
001860*---------------------------------------------------------------* 00186005
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00187007
CICS  *                                                               * 00188006
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00189006
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00189106
CICS  *---------------------------------------------------------------* 00189206
001900/                                                                 00190003
002000 ENVIRONMENT DIVISION.                                            00200003
002100                                                                  00210003
002200 DATA DIVISION.                                                   00220003
002300                                                                  00230003
002400 WORKING-STORAGE SECTION.                                         00240003
002500                                                                  00250003
002600 01  DK-DB2-KEYS.                                                 00260003
002700     05  DK-TP-DKEY                   PIC S9(09) VALUE +0         00270003
002800                                                 COMP.            00280003
002900                                                                  00290003
003000 01  PC-PROGRAM-CONSTANTS.                                        00300003
003100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00310003
003200                                                    'ET310A  '.   00320003
003300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00330003
003400                                                    'ETKM310 '.   00340003
003500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00350003
003600                                                    'ETKCS310'.   00360003
003700     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00370003
003800                                                    COMP.         00380003
003900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00390003
004000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00400003
004100     05  PC-WORK-ORDER-DIST-SHEET       PIC  9(03)  VALUE 001.    00410003
004200     05  PC-INTER-APPL-CODES.                                     00420003
004300         10 PC-INTER-APPL-CRIT-SPEC     PIC  X(01)  VALUE ' '.    00430003
004400         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '5'.    00440003
004500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00450003
004600                                                    COMP SYNC.    00460003
004700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00470003
004800                                                    COMP SYNC.    00480003
004900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00490003
005000                                                    +1000000      00500003
005100                                                    COMP-3.       00510003
005200     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00520003
005300                                                    COMP SYNC.    00530003
005400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00540003
005500                                                    COMP-3.       00550003
005600     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00560003
005700     05  PC-N                           PIC  X(01)  VALUE 'N'.    00570003
005800     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00580003
005900     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00590003
006000     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00600003
006100     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00610003
006200     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00620003
006300                                                                  00630003
006400     05  PC-TSYMSG-NUMBERS.                                       00640003
006500         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00650003
006600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00660003
006700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00670003
006800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00680003
006900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00690003
007000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00700003
007100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00710003
007200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00720003
007300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00730003
007400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00740003
007500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00750003
007600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00760003
007700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00770003
007800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00780003
007900         10  PC-TSYMSG-00736            PIC  9(05)  VALUE 00736.  00790003
008000         10  PC-TSYMSG-00737            PIC  9(05)  VALUE 00737.  00800003
008100         10  PC-TSYMSG-00738            PIC  9(05)  VALUE 00738.  00810003
008200         10  PC-TSYMSG-00739            PIC  9(05)  VALUE 00739.  00820003
008300         10  PC-TSYMSG-00740            PIC  9(05)  VALUE 00740.  00830003
008400                                                                  00840003
008500 01  PS-PROGRAM-SWITCHES.                                         00850003
008600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00860003
008700         88  PS-NO-ERROR                            VALUE 'Y'.    00870003
008800         88  PS-ERROR                               VALUE 'N'.    00880003
008900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00890003
009000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00900003
009100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00910003
009200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00920003
009300         88  PS-DONE                                VALUE 'Y'.    00930003
009400         88  PS-NOT-DONE                            VALUE 'N'.    00940003
009500     05  PS-START-ITEM-ERROR-SW       PIC  X        VALUE 'Y'.    00950003
009600         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    00960003
009700         88  PS-START-ITEM-ERROR                    VALUE 'N'.    00970003
009800                                                                  00980003
009900 01  PV-PROGRAM-VARIABLES.                                        00990003
010000     05  PV-SUB                         PIC S9(04)  VALUE +0      01000003
010100                                                    COMP SYNC.    01010003
010200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01020003
010300                                                    COMP SYNC.    01030003
010400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01040003
010500                                                    COMP-3.       01050003
010600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01060003
010700                                                    COMP-3.       01070003
010800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01080003
010900                                                    COMP-3.       01090003
011000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01100003
011100                                                    COMP-3.       01110003
011200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01120003
011300                                                    COMP-3.       01130003
011400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01140003
011500                                                    COMP-3.       01150003
011600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01160003
011700                                                    COMP-3.       01170003
011800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01180003
011900                                                    COMP SYNC.    01190003
012000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01200003
012100                                                    COMP SYNC.    01210003
012200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01220003
012300                                                    COMP SYNC.    01230003
012400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01240003
012500                                                    COMP SYNC.    01250003
012600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01260003
012700                                                    COMP SYNC.    01270003
012800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01280003
012900                                                    COMP SYNC.    01290003
013000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01300003
013100                                                    COMP SYNC.    01310003
013200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01320003
013300                                                    COMP SYNC.    01330003
013400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01340003
013500                                                    COMP SYNC.    01350003
013600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01360003
013700                                                    COMP SYNC.    01370003
013800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01380003
013900                                                    COMP SYNC.    01390003
014000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01400003
014100                                                    COMP SYNC.    01410003
014200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01420003
014300                                                    COMP SYNC.    01430003
014400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01440003
014500                                                    COMP SYNC.    01450003
014600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01460003
014700                                                    COMP SYNC.    01470003
014800     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01480003
014900                                                    COMP-3.       01490003
015000     05  PV-WO-NBR                      PIC S9(04)  VALUE +0      01500003
015100                                                    COMP SYNC.    01510003
015200     05  PV-RECVR-STATUS-CDE            PIC  X(02)  VALUE SPACES. 01520003
015300                                                                  01530003
015400*---------------------------------------------------------------* 01540003
015500*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01550003
015600*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01560003
015700*   APPLICATION-SPECIFIC COMMAREA.                              * 01570003
015800*---------------------------------------------------------------* 01580003
015900 01  LQW-LIST-QUEUE-WORK-AREA.                                    01590003
016000     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  01600003
016100     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01610003
016200                                        INDEXED BY LQW-IDX.       01620003
016300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01630003
016400         10  LQW-TEMP-SELECTED-SW       PIC X(01).                01640003
016500         10  LQW-SELECTED-SW            PIC X(01).                01650003
016600             88  LQW-SELECT                         VALUE 'S'.    01660003
016700             88  LQW-DESELECT                       VALUE ' '.    01670003
016800         10  LQW-ACTION                 PIC X(03).                01680003
016900         10  LQW-FUNC-CDE               PIC X(02).                01690003
017000         10  LQW-DIR-IND                PIC X(01).                01700003
017100/                                                                 01710003
017200*---------------------------------------------------------------* 01720003
017300*  RECORD LAYOUT FOR THE INPUT TEMP STORAGE QUEUE               * 01730003
017400*---------------------------------------------------------------* 01740003
017500                                                                  01750003
017600     COPY ETWS301.                                                01760003
017700                                                                  01770003
017800*---------------------------------------------------------------* 01780003
017900*    MAP LAYOUT                                                 * 01790003
018000*---------------------------------------------------------------* 01800003
018100                                                                  01810003
018200     COPY ETKM310.                                                01820003
018300                                                                  01830003
018400 01  MR-OCCURS-LAYOUT                   REDEFINES  ET310AO.       01840003
018500     05  FILLER                         PIC X(042).               01850003
018600                                                                  01860003
018700     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01870003
018800         10  MR-SELECTL                 PIC S9(04) COMP.          01880003
018900         10  MR-SELECTA                 PIC X(01).                01890003
019000         10  MR-SELECTC                 PIC X(01).                01900003
019100         10  MR-SELECTH                 PIC X(01).                01910003
019200         10  MR-SELECT                  PIC X(01).                01920003
019300                                                                  01930003
019400         10  FILLER                     PIC X(05).                01940003
019500         10  MR-ACTION                  PIC X(03).                01950003
019600                                                                  01960003
019700         10  FILLER                     PIC X(05).                01970003
019800         10  MR-VENDOR-NAME             PIC X(25).                01980003
019900                                                                  01990003
020000         10  FILLER                     PIC X(05).                02000003
020100         10  MR-VEND-INCHG-QUAL         PIC X(02).                02010003
020200                                                                  02020003
020300         10  FILLER                     PIC X(05).                02030003
020400         10  MR-VEND-INCHG-ID           PIC X(15).                02040003
020500                                                                  02050003
020600         10  FILLER                     PIC X(05).                02060003
020700         10  MR-NETWK-NAME              PIC X(10).                02070003
020800                                                                  02080003
020900         10  FILLER                     PIC X(05).                02090003
021000         10  MR-FUNC-CDE                PIC X(02).                02100003
021100                                                                  02110003
021200         10  FILLER                     PIC X(05).                02120003
021300         10  MR-DIR-IND                 PIC X(01).                02130003
021400                                                                  02140003
021500/                                                                 02150003
021600*---------------------------------------------------------------* 02160003
021700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02170003
021800*---------------------------------------------------------------* 02180003
021900                                                                  02190003
022000     COPY DPWS015.                                                02200003
022100                                                                  02210003
022200*---------------------------------------------------------------* 02220003
022300*    FUNCTION KEYS COPYBOOK.                                    * 02230003
022400*---------------------------------------------------------------* 02240003
022500                                                                  02250003
022600     COPY DPWS016.                                                02260003
022700                                                                  02270003
022800*---------------------------------------------------------------* 02280003
022900*    NUMERIC EDIT LAYOUT.                                       * 02290003
023000*---------------------------------------------------------------* 02300003
023100                                                                  02310003
023200     COPY DPWS010I.                                               02320003
023300                                                                  02330003
023400/                                                                 02340003
023500*---------------------------------------------------------------* 02350003
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02360006
023700*---------------------------------------------------------------* 02370003
023800                                                                  02380003
023900     COPY DPWS030.                                                02390003
CICS       COPY DPWS930.                                                02391006
024000                                                                  02400003
024100/                                                                 02410003
024200*---------------------------------------------------------------* 02420003
024300*    STANDARD COMMAREA.                                         * 02430003
024400*---------------------------------------------------------------* 02440003
024500                                                                  02450003
024600     COPY DPWS020.                                                02460003
024700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02470003
024800                                                                  02480003
024900*---------------------------------------------------------------* 02490003
025000* INTER-APPLICATION COMMAREA.                                   * 02500003
025100*---------------------------------------------------------------* 02510003
025200                                                                  02520003
025300         10  INTER-APPL-COMM-AREA       PIC X(200).               02530003
025400     COPY ETWS300.                                                02540003
025500*---------------------------------------------------------------* 02550003
025600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02560003
025700*---------------------------------------------------------------* 02570003
025800         10  ASC-SPECIFIC-COMMAREA.                               02580003
025900             15  ASC-LIST-KEYS.                                   02590003
026000                 20  ASC-KEY-TP-DKEY           PIC S9(9) COMP.    02600003
026100             15  ASC-ENT-ID                    PIC S9(9) COMP.    02610003
026200             15  ASC-VENDOR-NAME               PIC  X(30).        02620003
026300             15  ASC-VEND-INCHG-QUAL           PIC  X(02).        02630003
026400             15  ASC-VEND-INCHG-ID             PIC  X(15).        02640003
026500             15  ASC-NETWK-ID                  PIC  X(01).        02650003
026600             15  ASC-NRFC-ID                   PIC  X(01).        02660003
026700             15  ASC-NETWK-NAME                PIC  X(15).        02670003
026800             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           02680003
026900                 20  ASC-BLOCK-MODIFIED-SW                        02690003
027000                                        PIC X(01).                02700003
027100                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     02710003
027200                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     02720003
027300                                                                  02730003
027400                 20  ASC-ITEM-ARRAY.                              02740003
027500                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        02750003
027600                         30  ASC-LIST-ITEM-NUMBER                 02760003
027700                                        PIC S9(09) COMP-3.        02770003
027800                         30  ASC-TEMP-SELECTED-SW                 02780003
027900                                        PIC X(01).                02790003
028000                             88  ASC-VALID-SELECT  VALUE ' '      02800003
028100                                                         'S'      02810003
028200                                                         'B'      02820003
028300                                                         'E'.     02830003
028400                             88  ASC-TEMP-NO-SELECT               02840003
028500                                                   VALUE ' '.     02850003
028600                             88  ASC-TEMP-SELECT   VALUE 'S'.     02860003
028700                             88  ASC-TEMP-BEGIN    VALUE 'B'.     02870003
028800                             88  ASC-TEMP-END      VALUE 'E'.     02880003
028900                         30  ASC-SELECTED-SW                      02890003
029000                                        PIC X(01).                02900003
029100                             88  ASC-NO-SELECT     VALUE ' '.     02910003
029200                             88  ASC-SELECT        VALUE 'S'.     02920003
029300                             88  ASC-BEGIN         VALUE 'B'.     02930003
029400                             88  ASC-END           VALUE 'E'.     02940003
029500                         30  ASC-ACTION         PIC X(03).        02950003
029600                         30  ASC-FUNC-CDE       PIC X(02).        02960003
029700                         30  ASC-DIR-IND        PIC X(01).        02970003
029800                                                                  02980003
029900             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     02990003
030000             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03000003
030100             15  ASC-SEL-SUB            PIC S9(04) COMP.          03010003
030200             15  ASC-SEL-ITEM           PIC S9(04) COMP.          03020003
030300             15  ASC-NUMBER-OF-ITEMS-READ                         03030003
030400                                        PIC S9(09) COMP-3.        03040003
030500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03050003
030600                                        PIC S9(09) COMP-3.        03060003
030700             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        03070003
030800             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03080003
030900             15  ASC-ITEM-AT-TOP-OF-PANEL                         03090003
031000                                        PIC S9(09) COMP-3.        03100003
031100             15  ASC-ITEM-AT-BOT-OF-PANEL                         03110003
031200                                        PIC S9(09) COMP-3.        03120003
031300             15  ASC-HIGHEST-BLOCK-WRITTEN                        03130003
031400                                        PIC S9(04) COMP SYNC.     03140003
031500             15  ASC-START-OF-SELECTED-RANGE                      03150003
031600                                        PIC S9(09) COMP-3.        03160003
031700             15  ASC-END-OF-SELECTED-RANGE                        03170003
031800                                        PIC S9(09) COMP-3.        03180003
031900             15  ASC-ITEMS-LEFT-INDICATOR                         03190003
032000                                        PIC X(01).                03200003
032100                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03210003
032200                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03220003
032300             15  ASC-TEMP-QUEUE-UPDATE-SW                         03230003
032400                                        PIC X(01).                03240003
032500                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03250003
032600                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03260003
032700             15  ASC-LIST-QUEUE-NAME.                             03270003
032800                 20  ASC-LIST-TERM-ID   PIC X(04).                03280003
032900                 20  ASC-LIST-TASK-NUMBER                         03290003
033000                                        PIC S9(05) COMP-3.        03300003
033100                 20  ASC-LIST-SEQ       PIC 9(01).                03310003
033200             15  ASC-SEL-QUEUE-NAME-IN   PIC X(08).               03320003
033300             15  ASC-SEL-QUEUE-NAME-OUT.                          03330003
033400                 20  ASC-SEL-TERM-ID-OUT PIC X(04).               03340003
033500                 20  ASC-SEL-TASK-NUMBER-OUT                      03350003
033600                                         PIC S9(05) COMP-3.       03360003
033700                 20  ASC-SEL-SEQ-OUT     PIC 9(01).               03370003
033800                                                                  03380003
033900             15  ASC-START-ITEM-REQUEST.                          03390003
034000                 20  ASC-START-ITEM-REQUEST-N  PIC 9(07).         03400003
034100             15  ASC-USE-SELECTION-QUEUE-IND   PIC X(01).         03410003
034200                 88  ASC-USE-SELECTION-QUEUE   VALUE 'Y'.         03420003
034300/                                                                 03430003
034400*---------------------------------------------------------------* 03440003
034500*    ABEND PROCESSING COPYBOOK.                                 * 03450003
034600*---------------------------------------------------------------* 03460003
034700                                                                  03470003
034800     COPY DPWS013.                                                03480003
034900                                                                  03490003
035000/                                                                 03500003
035100*---------------------------------------------------------------* 03510003
035200*    DB2 AREA FOR THE TRADING PARTNER FUNCTIONAL GROUPS         * 03520003
035300*---------------------------------------------------------------* 03530003
035400     EXEC SQL                                                     03540003
035500          INCLUDE TTRDFNC                                         03550003
035600     END-EXEC.                                                    03560003
035700                                                                  03570003
035800/                                                                 03580003
035900*---------------------------------------------------------------* 03590003
036000*    DB2 AREA FOR THE EDI NETWORK                               * 03600003
036100*---------------------------------------------------------------* 03610003
036200     EXEC SQL                                                     03620003
036300          INCLUDE TNETWRK                                         03630003
036400     END-EXEC.                                                    03640003
036500                                                                  03650003
036600*---------------------------------------------------------------* 03660003
036700*    DB2 AREA FOR COMMUNICATIONS                                * 03670003
036800*---------------------------------------------------------------* 03680003
036900     EXEC SQL                                                     03690003
037000          INCLUDE SQLCA                                           03700003
037100     END-EXEC.                                                    03710003
037200                                                                  03720003
037300/                                                                 03730003
037400*---------------------------------------------------------------* 03740003
037500*  CURSOR TO FUNCTIONAL GROUPS                                  * 03750003
037600*---------------------------------------------------------------* 03760003
037700                                                                  03770003
037800     EXEC SQL                                                     03780003
037900          DECLARE TTRDFNC_CSR CURSOR FOR                          03790003
038000           SELECT FUNC_CDE                                        03800003
038100                 ,DIR_IND                                         03810003
038200           FROM   TTRDFNC                                         03820003
038300           WHERE  TP_DKEY        = :DK-TP-DKEY                    03830003
038400         ORDER BY FUNC_CDE                                        03840003
038500     END-EXEC.                                                    03850003
038600                                                                  03860003
038700/                                                                 03870003
038800 LINKAGE SECTION.                                                 03880003
038900                                                                  03890003
039000 01  DFHCOMMAREA.                                                 03900003
039100     05  FILLER                         OCCURS  1 TO 4072 TIMES   03910003
039200                                        DEPENDING ON EIBCALEN.    03920003
039300         10  FILLER                     PIC X.                    03930003
039400                                                                  03940003
039500/                                                                 03950003
039600 PROCEDURE DIVISION.                                              03960003
039700*---------------------------------------------------------------* 03970003
039800*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 03980003
039900*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 03990003
040000*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04000003
040100*---------------------------------------------------------------* 04010003
040200 0000-MAIN-MODULE.                                                04020003
040300                                                                  04030003
040400     INITIALIZE DP030-CICS-API-FIELDS.                            04040003
040500                                                                  04050003
040600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04060003
040700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04070003
040800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04080003
040900                                                                  04090003
041000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04100003
041100                                                                  04110003
041200     MOVE LENGTH OF ET310AI        TO DP030-MAP-LENGTH (1).       04120003
041300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04130003
041400                                                                  04140003
041500     PERFORM 0001-CALL-CICS-ARCH-API.                             04150003
041600     PERFORM 1000-CONTROL-PROCESSING                              04160003
041700                                                                  04170003
041800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04180003
041900     PERFORM 0001-CALL-CICS-ARCH-API.                             04190003
042000                                                                  04200003
042100*---------------------------------------------------------------* 04210003
042200*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 04220003
042300*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 04230003
042400*---------------------------------------------------------------* 04240003
042500 0001-CALL-CICS-ARCH-API.                                         04250003
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04260006
042700                                    DFHCOMMAREA                   04270006
042800                                    DP030-CICS-API-FIELDS         04280006
042900                                    DP020-STANDARD-COMMAREA       04290006
043000                                    ET310AI.                      04300006
043100                                                                  04310003
043200     IF  DP030-RC-CALL-SUCCESSFUL                                 04320003
043300         CONTINUE                                                 04330003
043400     ELSE                                                         04340003
043500         SET DP013-NO-ROLLBACK                                    04350003
043600             DP013-XCTL-DISPLAY-RESTART                           04360003
043700             DP013-CICS-ABEND      TO TRUE                        04370003
043800         MOVE '0001-CALL-CICS-ARCH-API'                           04380003
043900                                   TO DP013-PARAGRAPH             04390003
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04400006
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04410006
044200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04420003
044300         PERFORM DP013-0000-PROCESS-ABEND                         04430003
044400     END-IF.                                                      04440003
044500                                                                  04450003
044600*----------------------------------------------------------------*04460003
044700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04470003
044800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04480003
044900*                                                                *04490003
045000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04500003
045100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04510003
045200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04520003
045300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04530003
045400*----------------------------------------------------------------*04540003
045500                                                                  04550003
045600 1000-CONTROL-PROCESSING.                                         04560003
045700                                                                  04570003
045800     EVALUATE TRUE                                                04580003
045900         WHEN DP020-NEXT-ACT-INITIAL                              04590003
046000             INITIALIZE ASC-SPECIFIC-COMMAREA                     04600003
046100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04610003
046200                                      ASC-SEL-TERM-ID-OUT         04620003
046300             MOVE DP020-SRC-TASK-NUMBER                           04630003
046400                                   TO ASC-LIST-TASK-NUMBER        04640003
046500                                      ASC-SEL-TASK-NUMBER-OUT     04650003
046600             MOVE PC-LIST-QUEUE-SEQ                               04660003
046700                                   TO ASC-LIST-SEQ                04670003
046800             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             04680003
046900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04690003
047000             IF  PS-COMMAREA-NOT-VALID                            04700003
047100                 SET DP020-MSG-FATAL                              04710003
047200                     DP020-NEXT-ACT-APPL-ERROR                    04720003
047300                                   TO TRUE                        04730003
047400             ELSE                                                 04740003
047500                 PERFORM 4000-BUILD-INITIAL-PANEL                 04750003
047600             END-IF                                               04760003
047700                                                                  04770003
047800         WHEN DP020-NEXT-ACT-READ-MAP                             04780003
047900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04790003
048000                                   TO PV-TOP-ITEM                 04800003
048100             PERFORM 2000-PROCESS-PANEL                           04810003
048200                                                                  04820003
048300         WHEN DP020-NEXT-ACT-RETURN                               04830003
048400              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       04840003
048500                                   TO PV-TOP-ITEM                 04850003
048600              MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    04860003
048700              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                04870003
048800              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04880003
048900              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                04890003
049000                                                                  04900003
049100                                                                  04910003
049200         WHEN OTHER                                               04920003
049300             SET DP013-LOGIC-ABEND TO TRUE                        04930003
049400             SET DP013-NO-ROLLBACK TO TRUE                        04940003
049500             MOVE '1000-CONTROL-PROCESSING'                       04950003
049600                                   TO DP013-PARAGRAPH             04960003
049700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04970003
049800                                   TO DP013-MESSAGE-TEXT(1)       04980003
049900             PERFORM DP013-0000-PROCESS-ABEND                     04990003
050000     END-EVALUATE.                                                05000003
050100                                                                  05010003
050200/                                                                 05020003
050300*----------------------------------------------------------------*05030003
050400* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *05040003
050500*----------------------------------------------------------------*05050003
050600                                                                  05060003
050700 1100-PROCESS-INTER-APPL-COMM.                                    05070003
050800                                                                  05080003
050900     SET PS-COMMAREA-VALID         TO TRUE.                       05090003
051000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05100003
051100                                                                  05110003
051200     EVALUATE DP020-INT-APPL-FORMAT-IND                           05120003
051300                                                                  05130003
051400         WHEN PC-INTER-APPL-CRIT-SPEC                             05140003
051500                                                                  05150003
051600**           THIS PROGRAM ASSUMES THAT INTER-APPL FIELDS ARE      05160003
051700**           PROPERLY INITIALIZED...                              05170003
051800             MOVE ET300-TP-DKEY           TO                      05180003
051900                  ASC-KEY-TP-DKEY                                 05190003
052000             MOVE ET300-ENT-ID            TO                      05200003
052100                  ASC-ENT-ID                                      05210003
052200             MOVE ET300-VENDOR-NAME       TO                      05220003
052300                  ASC-VENDOR-NAME                                 05230003
052400             MOVE ET300-VENDOR-NAME       TO                      05240003
052500                  ASC-VENDOR-NAME                                 05250003
052600             MOVE ET300-VEND-INCHG-QUAL   TO                      05260003
052700                  ASC-VEND-INCHG-QUAL                             05270003
052800             MOVE ET300-VEND-INCHG-ID     TO                      05280003
052900                  ASC-VEND-INCHG-ID                               05290003
053000             MOVE ET300-NETWK-ID          TO                      05300003
053100                  ASC-NETWK-ID                                    05310003
053200             MOVE ET300-NETWORK-NAME      TO                      05320003
053300                  ASC-NETWK-NAME                                  05330003
053400                                                                  05340003
053500         WHEN PC-INTER-APPL-LIST                                  05350003
053600              SET ASC-USE-SELECTION-QUEUE                         05360003
053700                                   TO TRUE                        05370003
053800              MOVE ET300-NBR-SELECTED-ITEMS                       05380003
053900                                   TO ASC-NUMBER-OF-SELECTED-ITEMS05390003
054000              MOVE ET300-NUMBER-OF-TS-ITEMS                       05400003
054100                                   TO ASC-NUMBER-OF-TS-ITEMS      05410003
054200              MOVE ET300-SEL-QUEUE-NAME                           05420003
054300                                   TO ASC-SEL-QUEUE-NAME-IN       05430003
054400              PERFORM 1120-PREPARE-LIST-ENTRY                     05440003
054500                                                                  05450003
054600     END-EVALUATE.                                                05460003
054700                                                                  05470003
054800*----------------------------------------------------------------*05480003
054900*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *05490003
055000*  QUEUE PASSED FROM THE LIST.                                   *05500003
055100*----------------------------------------------------------------*05510003
055200                                                                  05520003
055300 1120-PREPARE-LIST-ENTRY.                                         05530003
055400      MOVE ET301-MAX-ITEMS         TO ASC-SEL-SUB.                05540003
055500      MOVE ZERO                    TO ASC-SEL-ITEM.               05550003
055600      PERFORM 2300-GET-NEXT-RECORD.                               05560003
055700                                                                  05570003
055800/                                                                 05580003
055900*----------------------------------------------------------------*05590003
056000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05600003
056100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05610003
056200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05620003
056300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05630003
056400* FUNCTION KEYS CAN GET THIS FAR.                                *05640003
056500*----------------------------------------------------------------*05650003
056600                                                                  05660003
056700 2000-PROCESS-PANEL.                                              05670003
056800     EVALUATE TRUE                                                05680003
056900         WHEN DP020-SRC-AID = DP016-CLEAR                         05690003
057000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05700003
057100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05710003
057200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05720003
057300                                                                  05730003
057400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05740003
057500             PERFORM 2050-DELETE-LIST-QUEUE                       05750003
057600             PERFORM 4000-BUILD-INITIAL-PANEL                     05760003
057700                                                                  05770003
057800         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   05780003
057900             PERFORM 2140-DESELECT-ALL-ITEMS                      05790003
058000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05800003
058100                                                                  05810003
058200         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 05820003
058300              PERFORM 2150-SELECT-ALL-ITEMS                       05830003
058400              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05840003
058500                                                                  05850003
058600         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05860003
058700             IF ASC-USE-SELECTION-QUEUE                           05870003
058800                 PERFORM 6200-DEL-LIST-QUEUE                      05880003
058900                 PERFORM 2300-GET-NEXT-RECORD                     05890003
059000                 PERFORM 3200-RESET-ATTRIBUTES                    05900003
059100                 PERFORM 4000-BUILD-INITIAL-PANEL                 05910003
059200             ELSE                                                 05920003
059300*                --- BOTTOM OF LIST ---                           05930003
059400                 MOVE PC-TSYMSG-00070                             05940003
059500                                   TO DP020-MSG-NUMBER            05950003
059600                 SET DP020-MSG-INFORMATIONAL                      05960003
059700                                   TO TRUE                        05970003
059800             END-IF                                               05980003
059900                                                                  05990003
060000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06000003
060100             IF ASC-USE-SELECTION-QUEUE                           06010003
060200                 PERFORM 6200-DEL-LIST-QUEUE                      06020003
060300                 PERFORM 2310-GET-PREV-RECORD                     06030003
060400                 PERFORM 3200-RESET-ATTRIBUTES                    06040003
060500                 PERFORM 4000-BUILD-INITIAL-PANEL                 06050003
060600             ELSE                                                 06060003
060700*                --- TOP OF LIST ---                              06070003
060800                 MOVE PC-TSYMSG-00069                             06080003
060900                                   TO DP020-MSG-NUMBER            06090003
061000                 SET DP020-MSG-INFORMATIONAL                      06100003
061100                                   TO TRUE                        06110003
061200             END-IF                                               06120003
061300         WHEN OTHER                                               06130003
061400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06140003
061500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06150003
061600             IF  PS-NO-ERROR                                      06160003
061700                 SET DP030-CONTINUE-GO TO TRUE                    06170003
061800                 PERFORM 2100-CHECK-FUNCTION-KEY                  06180003
061900             ELSE                                                 06190003
062000                 SET DP030-OVERRIDE-GO TO TRUE                    06200003
062100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06210003
062200             END-IF                                               06220003
062300     END-EVALUATE.                                                06230003
062400                                                                  06240003
062500/                                                                 06250003
062600*----------------------------------------------------------------*06260003
062700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06270003
062800*----------------------------------------------------------------*06280003
062900 2050-DELETE-LIST-QUEUE.                                          06290003
063000                                                                  06300003
063100     EXEC CICS                                                    06310003
063200         DELETEQ TS                                               06320003
063300           QUEUE (ASC-LIST-QUEUE-NAME)                            06330003
063400            RESP (PV-CICS-RESP)                                   06340003
063500     END-EXEC.                                                    06350003
063600                                                                  06360003
063700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06370003
063800        (PV-CICS-RESP = DFHRESP(QIDERR))                          06380003
063900         CONTINUE                                                 06390003
064000     ELSE                                                         06400003
064100         SET DP013-CICS-ABEND      TO TRUE                        06410003
064200         SET DP013-NO-ROLLBACK     TO TRUE                        06420003
064300                                                                  06430003
064400         MOVE '2050-DELETE-LIST-QUEUE'                            06440003
064500                                   TO DP013-PARAGRAPH             06450003
064600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06460003
064700                                   TO DP013-MESSAGE-TEXT (1)      06470003
064800         PERFORM DP013-0000-PROCESS-ABEND                         06480003
064900     END-IF.                                                      06490003
065000                                                                  06500003
065100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06510003
065200                                                                  06520003
065300/                                                                 06530003
065400*----------------------------------------------------------------*06540003
065500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06550003
065600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06560003
065700* CICS ARCHITECTURE API.                                         *06570003
065800*----------------------------------------------------------------*06580003
065900 2100-CHECK-FUNCTION-KEY.                                         06590003
066000                                                                  06600003
066100     EVALUATE TRUE                                                06610003
066200         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 06620003
066300             IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0                 06630003
066400                 SET DP030-OVERRIDE-GO                            06640003
066500                                   TO TRUE                        06650003
066600                 MOVE PC-TSYMSG-00057                             06660003
066700                                   TO DP020-MSG-NUMBER            06670003
066800                 SET DP020-MSG-WARNING                            06680003
066900                                   TO TRUE                        06690003
067000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06700003
067100             ELSE                                                 06710003
067200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO             06720003
067300                      ET300-NBR-SELECTED-ITEMS                    06730003
067400                 PERFORM 5000-PREPARE-SEL-QUEUE                   06740003
067500                                                                  06750003
067600                 PERFORM 7000-FORMAT-COMMAREA                     06760003
067700             END-IF                                               06770003
067800                                                                  06780003
067900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06790003
068000             MOVE +1               TO PV-TOP-ITEM                 06800003
068100             PERFORM 3200-RESET-ATTRIBUTES                        06810003
068200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06820003
068300                                                                  06830003
068400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06840003
068500             PERFORM 2110-BROWSE-BACKWARD                         06850003
068600             PERFORM 3200-RESET-ATTRIBUTES                        06860003
068700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06870003
068800                                                                  06880003
068900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06890003
069000             PERFORM 2120-BROWSE-FORWARD                          06900003
069100             PERFORM 3200-RESET-ATTRIBUTES                        06910003
069200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06920003
069300                                                                  06930003
069400         WHEN DP020-SRC-AID = DP016-ENTER                         06940003
069500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06950003
069600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06960003
069700                                                                  06970003
069800         WHEN OTHER                                               06980003
069900             SET DP013-NO-ROLLBACK                                06990003
070000                 DP013-XCTL-DISPLAY-RESTART                       07000003
070100                 DP013-CICS-ABEND  TO TRUE                        07010003
070200             MOVE '2100-CHECK-FUNCTION-KEY'                       07020003
070300                                   TO DP013-PARAGRAPH             07030003
070400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07040003
070500                                   TO DP013-MESSAGE-TEXT (1)      07050003
070600             PERFORM DP013-0000-PROCESS-ABEND                     07060003
070700     END-EVALUATE.                                                07070003
070800                                                                  07080003
070900/                                                                 07090003
071000*----------------------------------------------------------------*07100003
071100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07110003
071200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07120003
071300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07130003
071400*    MESSAGE.                                                    *07140003
071500*----------------------------------------------------------------*07150003
071600                                                                  07160003
071700 2110-BROWSE-BACKWARD.                                            07170003
071800                                                                  07180003
071900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07190003
072000         GIVING PV-TOP-ITEM.                                      07200003
072100                                                                  07210003
072200     IF  ((PV-TOP-ITEM < +1)                                      07220003
072300       OR (PV-TOP-ITEM = +1))                                     07230003
072400         MOVE +1                   TO PV-TOP-ITEM                 07240003
072500*        -- TOP OF LIST --                                        07250003
072600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07260003
072700         SET DP020-MSG-INFORMATIONAL                              07270003
072800                                   TO TRUE                        07280003
072900     END-IF.                                                      07290003
073000                                                                  07300003
073100/                                                                 07310003
073200*----------------------------------------------------------------*07320003
073300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07330003
073400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07340003
073500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07350003
073600*----------------------------------------------------------------*07360003
073700                                                                  07370003
073800 2120-BROWSE-FORWARD.                                             07380003
073900                                                                  07390003
074000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07400003
074100         GIVING PV-TOP-ITEM.                                      07410003
074200                                                                  07420003
074300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07430003
074400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07440003
074500                                   TO PV-TOP-ITEM                 07450003
074600*        -- BOTTOM OF LIST --                                     07460003
074700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07470003
074800         SET DP020-MSG-INFORMATIONAL                              07480003
074900                                   TO TRUE                        07490003
075000     ELSE                                                         07500003
075100         COMPUTE PV-BOTTOM-ITEM =                                 07510003
075200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07520003
075300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07530003
075400*            -- BOTTOM OF LIST --                                 07540003
075500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07550003
075600             SET DP020-MSG-INFORMATIONAL                          07560003
075700                                   TO TRUE                        07570003
075800         END-IF                                                   07580003
075900     END-IF.                                                      07590003
076000                                                                  07600003
076100/                                                                 07610003
076200*----------------------------------------------------------------*07620003
076300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07630003
076400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07640003
076500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07650003
076600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07660003
076700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07670003
076800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07680003
076900*----------------------------------------------------------------*07690003
077000                                                                  07700003
077100 2130-CHECK-FOR-JUMP-BROWSE.                                      07710003
077200                                                                  07720003
077300     IF (ASC-START-ITEM-REQUEST = SPACE)                          07730003
077400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07740003
077500                                   TO PV-TOP-ITEM                 07750003
077600     ELSE                                                         07760003
077700         MOVE ASC-START-ITEM-REQUEST                              07770003
077800                                   TO DP010I-UNEDITED-FIELD       07780003
077900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07790003
078000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07800003
078100         SET DP010I-NEGATIVE-NOT-ALLOWED                          07810003
078200                                   TO TRUE                        07820003
078310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07831004
078320                         USING DP010I-NUMERIC-EDIT-AREA           07832004
078400                                                                  07840003
078500         IF  NOT DP010I-ERROR-DETECTED                            07850003
078600             MOVE DP010I-NUMERIC-FIELD                            07860003
078700                                   TO ASC-START-ITEM-REQUEST-N    07870003
078800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07880003
078900                 IF  ASC-START-ITEM-REQUEST-N >                   07890003
079000                                          ASC-NUMBER-OF-ITEMS-READ07900003
079100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07910003
079200                     COMPUTE PV-TOP-ITEM =                        07920003
079300                             ASC-NUMBER-OF-ITEMS-READ             07930003
079400                             - PC-ITEMS-PER-PANEL + 1             07940003
079500                     IF  PV-TOP-ITEM < +1                         07950003
079600                         MOVE +1   TO PV-TOP-ITEM                 07960003
079700                         MOVE PC-TSYMSG-00070                     07970003
079800                                   TO DP020-MSG-NUMBER            07980003
079900                         SET DP020-MSG-INFORMATIONAL              07990003
080000                                   TO TRUE                        08000003
080100                     END-IF                                       08010003
080200                 ELSE                                             08020003
080300                     MOVE ASC-START-ITEM-REQUEST-N                08030003
080400                                   TO PV-TOP-ITEM                 08040003
080500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08050003
080600                     COMPUTE PV-BOTTOM-ITEM =                     08060003
080700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08070003
080800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08080003
080900*                        -- BOTTOM OF LIST --                     08090003
081000                         MOVE PC-TSYMSG-00070                     08100003
081100                                   TO DP020-MSG-NUMBER            08110003
081200                         SET DP020-MSG-INFORMATIONAL              08120003
081300                                   TO TRUE                        08130003
081400                     END-IF                                       08140003
081500                 END-IF                                           08150003
081600             ELSE                                                 08160003
081700*                --- VALUE OUT OF RANGE ----                      08170003
081800                 MOVE PC-TSYMSG-00101                             08180003
081900                                   TO DP020-MSG-NUMBER            08190003
082000                 MOVE -1           TO ASTRTITL                    08200003
082100                 SET DP030-SET-CURSOR-APPL-1                      08210003
082200                                   TO TRUE                        08220003
082300                 MOVE DP015-REVERSE                               08230003
082400                                   TO ASTRTITH                    08240003
082500                 MOVE DP015-RED    TO ASTRTITC                    08250003
082600                 MOVE DP015-UNP-NUM-BRT-OFF                       08260003
082700                                   TO ASTRTITA                    08270003
082800                 SET DP020-MSG-FATAL                              08280003
082900                     PS-START-ITEM-ERROR                          08290003
083000                                   TO TRUE                        08300003
083100             END-IF                                               08310003
083200                                                                  08320003
083300         ELSE                                                     08330003
083400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08340003
083500             MOVE -1               TO ASTRTITL                    08350003
083600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08360003
083700             MOVE DP015-REVERSE    TO ASTRTITH                    08370003
083800             MOVE DP015-RED        TO ASTRTITC                    08380003
083900             MOVE DP015-UNP-NUM-BRT-OFF                           08390003
084000                                   TO ASTRTITA                    08400003
084100             SET DP020-MSG-FATAL                                  08410003
084200                 PS-START-ITEM-ERROR                              08420003
084300                                   TO TRUE                        08430003
084400         END-IF                                                   08440003
084500     END-IF.                                                      08450003
084600                                                                  08460003
084700/                                                                 08470003
084800*----------------------------------------------------------------*08480003
084900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08490003
085000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08500003
085100*----------------------------------------------------------------*08510003
085200 2140-DESELECT-ALL-ITEMS.                                         08520003
085300                                                                  08530003
085400     MOVE +1                       TO ASC-BLK-SUB.                08540003
085500                                                                  08550003
085600     PERFORM 2141-CLEAR-SELECTED-INDS                             08560003
085700         VARYING ASC-ITEM-SUB                                     08570003
085800         FROM 1 BY 1                                              08580003
085900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08590003
086000                                                                  08600003
086100     ADD +1                        TO ASC-BLK-SUB.                08610003
086200                                                                  08620003
086300     PERFORM 2141-CLEAR-SELECTED-INDS                             08630003
086400         VARYING ASC-ITEM-SUB                                     08640003
086500         FROM 1 BY 1                                              08650003
086600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08660003
086700                                                                  08670003
086800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08680003
086900                                   TO PV-LIST-ITEM-NUMBER.        08690003
087000                                                                  08700003
087100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08710003
087200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08720003
087300                                                                  08730003
087400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08740003
087500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08750003
087600         MOVE +1                   TO ASC-BLK-SUB                 08760003
087700                                                                  08770003
087800         PERFORM 5100-WRITE-TEMP-STORAGE                          08780003
087900                                                                  08790003
088000         MOVE +1                   TO PV-BLOCK-NUMBER             08800003
088100                                                                  08810003
088200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08820003
088300             PV-FIRST-BLOCK-IN-ARRAY - 1                          08830003
088400                                                                  08840003
088500         PERFORM                                                  08850003
088600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08860003
088700                                                                  08870003
088800             PERFORM 4410-READ-TEMP-STORAGE                       08880003
088900                                                                  08890003
089000             PERFORM 2141-CLEAR-SELECTED-INDS                     08900003
089100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08910003
089200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08920003
089300                                                                  08930003
089400             PERFORM 5100-WRITE-TEMP-STORAGE                      08940003
089500                                                                  08950003
089600             ADD +1                TO PV-BLOCK-NUMBER             08960003
089700                                                                  08970003
089800         END-PERFORM                                              08980003
089900                                                                  08990003
090000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09000003
090100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09010003
090200                                                                  09020003
090300         PERFORM                                                  09030003
090400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09040003
090500                   ASC-HIGHEST-BLOCK-WRITTEN                      09050003
090600                                                                  09060003
090700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09070003
090800                                   TO PV-BLOCK-NUMBER             09080003
090900                                                                  09090003
091000             PERFORM 4410-READ-TEMP-STORAGE                       09100003
091100                                                                  09110003
091200             PERFORM 2141-CLEAR-SELECTED-INDS                     09120003
091300                 VARYING ASC-ITEM-SUB                             09130003
091400                 FROM 1 BY 1                                      09140003
091500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09150003
091600                                                                  09160003
091700             PERFORM 5100-WRITE-TEMP-STORAGE                      09170003
091800                                                                  09180003
091900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09190003
092000                                                                  09200003
092100         END-PERFORM                                              09210003
092200                                                                  09220003
092300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09230003
092400                                   TO PV-BLOCK-NUMBER             09240003
092500                                                                  09250003
092600         PERFORM 4410-READ-TEMP-STORAGE                           09260003
092700     END-IF.                                                      09270003
092800                                                                  09280003
092900                                                                  09290003
093000     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS09300003
093100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09310003
093200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09320003
093300                                                                  09330003
093400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09340003
093500                                                                  09350003
093600/                                                                 09360003
093700*----------------------------------------------------------------*09370003
093800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09380003
093900*----------------------------------------------------------------*09390003
094000                                                                  09400003
094100 2141-CLEAR-SELECTED-INDS.                                        09410003
094200                                                                  09420003
094300     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          09430003
094400             NOT EQUAL ZERO                                       09440003
094500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09450003
094600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09460003
094700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09470003
094800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09480003
094900                                   TO TRUE                        09490003
095000         END-IF                                                   09500003
095100     END-IF.                                                      09510003
095200                                                                  09520003
095300/                                                                 09530003
095400*----------------------------------------------------------------*09540003
095500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09550003
095600*  FOR ALL ITEMS.                                                *09560003
095700*----------------------------------------------------------------*09570003
095800                                                                  09580003
095900 2150-SELECT-ALL-ITEMS.                                           09590003
096000                                                                  09600003
096100     MOVE +1                       TO ASC-BLK-SUB.                09610003
096200                                                                  09620003
096300     PERFORM 2151-SET-SELECTED-INDS                               09630003
096400         VARYING ASC-ITEM-SUB                                     09640003
096500         FROM 1 BY 1                                              09650003
096600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09660003
096700                                                                  09670003
096800     ADD +1                        TO ASC-BLK-SUB.                09680003
096900                                                                  09690003
097000     PERFORM 2151-SET-SELECTED-INDS                               09700003
097100         VARYING ASC-ITEM-SUB                                     09710003
097200         FROM 1 BY 1                                              09720003
097300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09730003
097400                                                                  09740003
097500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09750003
097600                                   TO PV-LIST-ITEM-NUMBER.        09760003
097700                                                                  09770003
097800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09780003
097900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09790003
098000                                                                  09800003
098100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09810003
098200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09820003
098300         MOVE +1                   TO ASC-BLK-SUB                 09830003
098400                                                                  09840003
098500         PERFORM 5100-WRITE-TEMP-STORAGE                          09850003
098600                                                                  09860003
098700         MOVE +1                   TO PV-BLOCK-NUMBER             09870003
098800                                                                  09880003
098900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09890003
099000             PV-FIRST-BLOCK-IN-ARRAY - 1                          09900003
099100                                                                  09910003
099200         PERFORM                                                  09920003
099300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09930003
099400                                                                  09940003
099500             PERFORM 4410-READ-TEMP-STORAGE                       09950003
099600                                                                  09960003
099700             PERFORM 2151-SET-SELECTED-INDS                       09970003
099800                 VARYING ASC-ITEM-SUB                             09980003
099900                 FROM 1 BY 1                                      09990003
100000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10000003
100100                                                                  10010003
100200             PERFORM 5100-WRITE-TEMP-STORAGE                      10020003
100300                                                                  10030003
100400             ADD +1                TO PV-BLOCK-NUMBER             10040003
100500         END-PERFORM                                              10050003
100600                                                                  10060003
100700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10070003
100800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10080003
100900                                                                  10090003
101000         PERFORM                                                  10100003
101100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10110003
101200                   ASC-HIGHEST-BLOCK-WRITTEN                      10120003
101300                                                                  10130003
101400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10140003
101500                                   TO PV-BLOCK-NUMBER             10150003
101600                                                                  10160003
101700             PERFORM 4410-READ-TEMP-STORAGE                       10170003
101800                                                                  10180003
101900             PERFORM 2151-SET-SELECTED-INDS                       10190003
102000                 VARYING ASC-ITEM-SUB                             10200003
102100                 FROM 1 BY 1                                      10210003
102200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10220003
102300                                                                  10230003
102400             PERFORM 5100-WRITE-TEMP-STORAGE                      10240003
102500                                                                  10250003
102600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10260003
102700         END-PERFORM                                              10270003
102800                                                                  10280003
102900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10290003
103000                                   TO PV-BLOCK-NUMBER             10300003
103100                                                                  10310003
103200         PERFORM 4410-READ-TEMP-STORAGE                           10320003
103300     END-IF.                                                      10330003
103400                                                                  10340003
103500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10350003
103600          ASC-NUMBER-OF-SELECTED-ITEMS.                           10360003
103700                                                                  10370003
103800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10380003
103900                                                                  10390003
104000/                                                                 10400003
104100*----------------------------------------------------------------*10410003
104200*    MARK EACH ITEM AS BEING SELECTED.                           *10420003
104300*----------------------------------------------------------------*10430003
104400                                                                  10440003
104500 2151-SET-SELECTED-INDS.                                          10450003
104600                                                                  10460003
104700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10470003
104800             NOT EQUAL ZERO                                       10480003
104900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10490003
105000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10500003
105100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10510003
105200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10520003
105300                                   TO TRUE                        10530003
105400         END-IF                                                   10540003
105500     END-IF.                                                      10550003
105600                                                                  10560003
105700/                                                                 10570003
105800*----------------------------------------------------------------*10580003
105900*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *10590003
106000*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *10600003
106100*----------------------------------------------------------------*10610003
106200 2200-MOVE-SCREEN-TO-COMMAREA.                                    10620003
106300                                                                  10630003
106400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10640003
106500     MOVE +1                       TO PV-SUB.                     10650003
106600                                                                  10660003
106700     PERFORM 3100-SET-SUBSCRIPTS.                                 10670003
106800                                                                  10680003
106900     IF  ASTRTITL > ZERO                                          10690003
107000         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      10700003
107100     ELSE                                                         10710003
107200         IF  ASTRTITF = DP015-ERASE-EOF                           10720003
107300             INITIALIZE ASC-START-ITEM-REQUEST                    10730003
107400         END-IF                                                   10740003
107500     END-IF.                                                      10750003
107600                                                                  10760003
107700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10770003
107800         VARYING PV-SUB                                           10780003
107900         FROM 1 BY 1                                              10790003
108000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10800003
108100                                                                  10810003
108200/                                                                 10820003
108300*----------------------------------------------------------------*10830003
108400*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *10840003
108500*----------------------------------------------------------------*10850003
108600 2210-MOVE-LINES-TO-COMMAREA.                                     10860003
108700                                                                  10870003
108800     IF  MR-SELECTL (PV-SUB) > ZERO                               10880003
108900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     10890003
109000                                   TO TRUE                        10900003
109100         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        10910003
109200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10920003
109300     ELSE                                                         10930003
109400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10940003
109500             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         10950003
109600             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        10960003
109700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10970003
109800         END-IF                                                   10980003
109900     END-IF.                                                      10990003
110000                                                                  11000003
110100     ADD +1                        TO ASC-ITEM-SUB.               11010003
110200                                                                  11020003
110300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11030003
110400         ADD +1                    TO ASC-BLK-SUB                 11040003
110500         MOVE +1                   TO ASC-ITEM-SUB                11050003
110600     END-IF.                                                      11060003
110700                                                                  11070003
110800/                                                                 11080003
110900******************************************************************11090003
111000* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *11100003
111100* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *11110003
111200******************************************************************11120003
111300 2300-GET-NEXT-RECORD.                                            11130003
111400                                                                  11140003
111500     ADD +1                        TO ASC-SEL-SUB.                11150003
111600     IF ASC-SEL-SUB > ET301-MAX-ITEMS                             11160003
111700         ADD +1                    TO ASC-SEL-ITEM                11170003
111800         MOVE +1                   TO ASC-SEL-SUB                 11180003
111900     END-IF.                                                      11190003
112000     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 11200003
112100         PERFORM 9100-READ-SEL-QUEUE                              11210003
112200         IF ET301-ITEM (ASC-SEL-SUB) > ZERO                       11220003
112300             INITIALIZE ASC-LIST-KEYS                             11230003
112400             MOVE ET301-TP-DKEY            (ASC-SEL-SUB) TO       11240003
112500                  ASC-KEY-TP-DKEY                                 11250003
112600             MOVE ET301-ENT-ID             (ASC-SEL-SUB) TO       11260003
112700                  ASC-ENT-ID                                      11270003
112800             MOVE ET301-VENDOR-NAME        (ASC-SEL-SUB) TO       11280003
112900                  ASC-VENDOR-NAME                                 11290003
113000             MOVE ET301-VEND-INCHG-QUAL    (ASC-SEL-SUB) TO       11300003
113100                  ASC-VEND-INCHG-QUAL                             11310003
113200             MOVE ET301-VEND-INCHG-ID      (ASC-SEL-SUB) TO       11320003
113300                  ASC-VEND-INCHG-ID                               11330003
113400             MOVE ET301-NETWK-ID           (ASC-SEL-SUB) TO       11340003
113500                  ASC-NETWK-ID                                    11350003
113600             MOVE ET301-NETWK-NAME         (ASC-SEL-SUB) TO       11360003
113700                  ASC-NETWK-NAME                                  11370003
113800             SET ET301-INQ (ASC-SEL-SUB)           TO TRUE        11380003
113900             PERFORM 9200-REWRITE-LIST-QUEUE                      11390003
114000         ELSE                                                     11400003
114100             SUBTRACT +1 FROM ASC-SEL-SUB                         11410003
114200*            --- BOTTOM OF LIST ---                               11420003
114300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11430003
114400             SET DP020-MSG-INFORMATIONAL                          11440003
114500                                   TO TRUE                        11450003
114600         END-IF                                                   11460003
114700     ELSE                                                         11470003
114800         SUBTRACT +1 FROM ASC-SEL-ITEM                            11480003
114900         MOVE ET301-MAX-ITEMS      TO ASC-SEL-SUB                 11490003
115000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11500003
115100         SET DP020-MSG-INFORMATIONAL                              11510003
115200                                   TO TRUE                        11520003
115300     END-IF.                                                      11530003
115400                                                                  11540003
115500/                                                                 11550003
115600******************************************************************11560003
115700* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *11570003
115800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *11580003
115900******************************************************************11590003
116000 2310-GET-PREV-RECORD.                                            11600003
116100                                                                  11610003
116200     SUBTRACT +1 FROM ASC-SEL-SUB.                                11620003
116300     IF ASC-SEL-SUB < +1                                          11630003
116400         SUBTRACT +1 FROM ASC-SEL-ITEM                            11640003
116500         MOVE ET301-MAX-ITEMS      TO ASC-SEL-SUB                 11650003
116600     END-IF.                                                      11660003
116700                                                                  11670003
116800     IF ASC-SEL-ITEM > ZERO                                       11680003
116900         PERFORM 9100-READ-SEL-QUEUE                              11690003
117000         INITIALIZE ASC-LIST-KEYS                                 11700003
117100         MOVE ET301-TP-DKEY            (ASC-SEL-SUB) TO           11710003
117200              ASC-KEY-TP-DKEY                                     11720003
117300         MOVE ET301-ENT-ID             (ASC-SEL-SUB) TO           11730003
117400              ASC-ENT-ID                                          11740003
117500         MOVE ET301-VENDOR-NAME        (ASC-SEL-SUB) TO           11750003
117600              ASC-VENDOR-NAME                                     11760003
117700         MOVE ET301-VEND-INCHG-QUAL    (ASC-SEL-SUB) TO           11770003
117800              ASC-VEND-INCHG-QUAL                                 11780003
117900         MOVE ET301-VEND-INCHG-ID      (ASC-SEL-SUB) TO           11790003
118000              ASC-VEND-INCHG-ID                                   11800003
118100         MOVE ET301-NETWK-ID           (ASC-SEL-SUB) TO           11810003
118200              ASC-NETWK-ID                                        11820003
118300         MOVE ET301-NETWK-NAME         (ASC-SEL-SUB) TO           11830003
118400              ASC-NETWK-NAME                                      11840003
118500     ELSE                                                         11850003
118600         MOVE +1                   TO ASC-SEL-ITEM                11860003
118700                                      ASC-SEL-SUB                 11870003
118800*        --- TOP OF LIST ---                                      11880003
118900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11890003
119000         SET DP020-MSG-INFORMATIONAL                              11900003
119100                                   TO TRUE                        11910003
119200     END-IF.                                                      11920003
119300                                                                  11930003
119400/                                                                 11940003
119500*----------------------------------------------------------------*11950003
119600*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *11960003
119700*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *11970003
119800*----------------------------------------------------------------*11980003
119900 3000-EDIT-DATA-IN-COMMAREA.                                      11990003
120000                                                                  12000003
120100     SET PS-NO-ERROR               TO TRUE.                       12010003
120200                                                                  12020003
120300     PERFORM 3200-RESET-ATTRIBUTES.                               12030003
120400                                                                  12040003
120500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12050003
120600**                                                                12060003
120700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12070003
120800* EDITTING IS DONE FROM THE BOTTOM UP.                            12080003
120900**                                                                12090003
121000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12100003
121100         ASC-ITEMS-DISPLAYED - 1.                                 12110003
121200                                                                  12120003
121300     PERFORM 3100-SET-SUBSCRIPTS.                                 12130003
121400     PERFORM 3300-EDIT-SELECTIONS                                 12140003
121500         VARYING PV-SUB                                           12150003
121600         FROM PV-SUB BY -1                                        12160003
121700         UNTIL PV-SUB < +1                                        12170003
121800                                                                  12180003
121900     IF  PS-NO-ERROR                                              12190003
122000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12200003
122100     END-IF.                                                      12210003
122200                                                                  12220003
122300     IF  ((PS-NO-ERROR)                                           12230003
122400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12240003
122500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12250003
122600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12260003
122700     END-IF.                                                      12270003
122800                                                                  12280003
122900/                                                                 12290003
123000*----------------------------------------------------------------*12300003
123100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12310003
123200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12320003
123300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12330003
123400*                                                                *12340003
123500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12350003
123600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12360003
123700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12370003
123800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12380003
123900*----------------------------------------------------------------*12390003
124000                                                                  12400003
124100 3100-SET-SUBSCRIPTS.                                             12410003
124200                                                                  12420003
124300     COMPUTE ASC-ITEM-SUB =                                       12430003
124400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12440003
124500                                                                  12450003
124600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12460003
124700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12470003
124800                                                                  12480003
124900         MOVE PC-MAX-BLOCKS-IN-ARRAY                              12490003
125000                                   TO ASC-BLK-SUB                 12500003
125100     ELSE                                                         12510003
125200         MOVE +1                   TO ASC-BLK-SUB                 12520003
125300     END-IF.                                                      12530003
125400                                                                  12540003
125500*----------------------------------------------------------------*12550003
125600*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *12560003
125700*----------------------------------------------------------------*12570003
125800                                                                  12580003
125900 3200-RESET-ATTRIBUTES.                                           12590003
126000                                                                  12600003
126100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12610003
126200     MOVE DP015-GREEN              TO ASTRTITC.                   12620003
126300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12630003
126400                                                                  12640003
126500     PERFORM                                                      12650003
126600         VARYING PV-SUB                                           12660003
126700         FROM 1 BY 1                                              12670003
126800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12680003
126900         MOVE DP015-UNP-ALP-NOR-OFF                               12690003
127000                                   TO MR-SELECTA (PV-SUB)         12700003
127100         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         12710003
127200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         12720003
127300     END-PERFORM.                                                 12730003
127400                                                                  12740003
127500/                                                                 12750003
127600*----------------------------------------------------------------*12760003
127700*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *12770003
127800*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *12780003
127900*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *12790003
128000*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *12800003
128100*----------------------------------------------------------------*12810003
128200 3300-EDIT-SELECTIONS.                                            12820003
128300                                                                  12830003
128400     EVALUATE TRUE                                                12840003
128500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12850003
128600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12860003
128700                 CONTINUE                                         12870003
128800                                                                  12880003
128900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12890003
129000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12900003
129100                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS12910003
129200                 MOVE ASC-TEMP-SELECTED-SW                        12920003
129300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12930003
129400                                   TO ASC-SELECTED-SW             12940003
129500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12950003
129600             END-IF                                               12960003
129700                                                                  12970003
129800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12980003
129900                 = SPACE                                          12990003
130000             EVALUATE TRUE                                        13000003
130100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13010003
130200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13020003
130300                     MOVE SPACE    TO ASC-SELECTED-SW             13030003
130400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13040003
130500                                                                  13050003
130600                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13060003
130700                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 13070003
130800                     MOVE SPACE    TO ASC-SELECTED-SW             13080003
130900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13090003
131000                                                                  13100003
131100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13110003
131200                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   13120003
131300                     MOVE SPACE    TO ASC-SELECTED-SW             13130003
131400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13140003
131500             END-EVALUATE                                         13150003
131600                                                                  13160003
131700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13170003
131800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13180003
131900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13190003
132000             END-IF                                               13200003
132100             PERFORM 3310-EDIT-RANGE                              13210003
132200                                                                  13220003
132300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13230003
132400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13240003
132500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13250003
132600             END-IF                                               13260003
132700             PERFORM 3310-EDIT-RANGE                              13270003
132800                                                                  13280003
132900         WHEN OTHER                                               13290003
133000             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            13300003
133100             SET DP020-MSG-FATAL   TO TRUE                        13310003
133200             MOVE -1               TO MR-SELECTL (PV-SUB)         13320003
133300             SET DP030-SET-CURSOR-APPL-1                          13330003
133400                                   TO TRUE                        13340003
133500             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         13350003
133600             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         13360003
133700             SET PS-ERROR          TO TRUE                        13370003
133800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13380003
133900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13390003
134000                 MOVE SPACE        TO ASC-SELECTED-SW             13400003
134100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13410003
134200             END-IF                                               13420003
134300     END-EVALUATE.                                                13430003
134400                                                                  13440003
134500     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             13450003
134600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13460003
134700                                                                  13470003
134800     IF  ASC-ITEM-SUB < 1                                         13480003
134900         SUBTRACT +1 FROM ASC-BLK-SUB                             13490003
135000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13500003
135100     END-IF.                                                      13510003
135200                                                                  13520003
135300*----------------------------------------------------------------*13530003
135400*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *13540003
135500*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *13550003
135600*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *13560003
135700*  THE ENDING.                                                   *13570003
135800*----------------------------------------------------------------*13580003
135900 3310-EDIT-RANGE.                                                 13590003
136000                                                                  13600003
136100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13610003
136200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13620003
136300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13630003
136400                                   TO ASC-SELECTED-SW             13640003
136500                                        (ASC-BLK-SUB ASC-ITEM-SUB)13650003
136600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13660003
136700         ELSE                                                     13670003
136800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13680003
136900                 CONTINUE                                         13690003
137000             ELSE                                                 13700003
137100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13710003
137200                 MOVE PC-TSYMSG-00054                             13720003
137300                                   TO DP020-MSG-NUMBER            13730003
137400                 SET DP020-MSG-FATAL                              13740003
137500                                   TO TRUE                        13750003
137600                 MOVE -1           TO MR-SELECTL (PV-SUB)         13760003
137700                 SET DP030-SET-CURSOR-APPL-1                      13770003
137800                                   TO TRUE                        13780003
137900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13790003
138000                 MOVE DP015-UNDERLINE                             13800003
138100                                   TO MR-SELECTH (PV-SUB)         13810003
138200                 SET PS-ERROR      TO TRUE                        13820003
138300             END-IF                                               13830003
138400         END-IF                                                   13840003
138500     ELSE                                                         13850003
138600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13860003
138700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13870003
138800                                   TO ASC-SELECTED-SW             13880003
138900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13890003
139000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13900003
139100         ELSE                                                     13910003
139200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13920003
139300                 CONTINUE                                         13930003
139400             ELSE                                                 13940003
139500*                -- ONLY ONE END-OF-RANGE ALLOWED --              13950003
139600                 MOVE PC-TSYMSG-00055                             13960003
139700                                   TO DP020-MSG-NUMBER            13970003
139800                 SET DP020-MSG-FATAL                              13980003
139900                                   TO TRUE                        13990003
140000                 MOVE -1           TO MR-SELECTL (PV-SUB)         14000003
140100                 SET DP030-SET-CURSOR-APPL-1                      14010003
140200                                   TO TRUE                        14020003
140300                 SET PS-ERROR      TO TRUE                        14030003
140400             END-IF                                               14040003
140500         END-IF                                                   14050003
140600     END-IF.                                                      14060003
140700                                                                  14070003
140800*----------------------------------------------------------------*14080003
140900*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *14090003
141000*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *14100003
141100*----------------------------------------------------------------*14110003
141200 3400-CHECK-RANGE-SEQUENCE.                                       14120003
141300                                                                  14130003
141400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14140003
141500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14150003
141600       AND  ASC-START-OF-SELECTED-RANGE >                         14160003
141700                                         ASC-END-OF-SELECTED-RANGE14170003
141800*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14180003
141900         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            14190003
142000         SET DP020-MSG-FATAL       TO TRUE                        14200003
142100         SET PS-ERROR              TO TRUE                        14210003
142200         PERFORM 3410-POSITION-AT-ERROR                           14220003
142300     END-IF.                                                      14230003
142400                                                                  14240003
142500*----------------------------------------------------------------*14250003
142600*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *14260003
142700*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *14270003
142800*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *14280003
142900*----------------------------------------------------------------*14290003
143000 3410-POSITION-AT-ERROR.                                          14300003
143100                                                                  14310003
143200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14320003
143300                                                                  14330003
143400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14340003
143500                    - PV-TOP-ITEM + 1.                            14350003
143600                                                                  14360003
143700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14370003
143800         CONTINUE                                                 14380003
143900     ELSE                                                         14390003
144000         MOVE -1                   TO MR-SELECTL (PV-SUB)         14400003
144100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14410003
144200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14420003
144300     END-IF.                                                      14430003
144400                                                                  14440003
144500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14450003
144600                    - PV-TOP-ITEM + 1.                            14460003
144700                                                                  14470003
144800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14480003
144900         CONTINUE                                                 14490003
145000     ELSE                                                         14500003
145100         MOVE -1                   TO MR-SELECTL (PV-SUB)         14510003
145200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14520003
145300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14530003
145400     END-IF.                                                      14540003
145500                                                                  14550003
145600/                                                                 14560003
145700*----------------------------------------------------------------*14570003
145800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14580003
145900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14590003
146000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14600003
146100*----------------------------------------------------------------*14610003
146200                                                                  14620003
146300 3500-MARK-RANGE-AS-SELECTED.                                     14630003
146400                                                                  14640003
146500     MOVE +1                       TO ASC-BLK-SUB.                14650003
146600                                                                  14660003
146700     PERFORM 3510-MARK-SELECTED-INDS                              14670003
146800         VARYING ASC-ITEM-SUB                                     14680003
146900         FROM 1 BY 1                                              14690003
147000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14700003
147100                                                                  14710003
147200     ADD +1                        TO ASC-BLK-SUB.                14720003
147300                                                                  14730003
147400     PERFORM 3510-MARK-SELECTED-INDS                              14740003
147500         VARYING ASC-ITEM-SUB                                     14750003
147600         FROM 1 BY 1                                              14760003
147700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14770003
147800                                                                  14780003
147900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14790003
148000                                   TO PV-LIST-ITEM-NUMBER.        14800003
148100                                                                  14810003
148200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14820003
148300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14830003
148400               PC-ITEMS-PER-PANEL).                               14840003
148500                                                                  14850003
148600     MOVE ASC-START-OF-SELECTED-RANGE                             14860003
148700                                   TO PV-START-OF-SELECTED-RANGE. 14870003
148800                                                                  14880003
148900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14890003
149000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14900003
149100               PC-ITEMS-PER-PANEL).                               14910003
149200                                                                  14920003
149300     MOVE ASC-END-OF-SELECTED-RANGE                               14930003
149400                                   TO PV-END-OF-SELECTED-RANGE.   14940003
149500                                                                  14950003
149600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14960003
149700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14970003
149800               PC-ITEMS-PER-PANEL).                               14980003
149900                                                                  14990003
150000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15000003
150100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15010003
150200                                                                  15020003
150300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15030003
150400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15040003
150500         MOVE +1                   TO ASC-BLK-SUB                 15050003
150600         PERFORM 5100-WRITE-TEMP-STORAGE                          15060003
150700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15070003
150800             PV-FIRST-BLOCK-IN-ARRAY - 1                          15080003
150900                                                                  15090003
151000         PERFORM                                                  15100003
151100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15110003
151200                   PV-PREV-BLOCK-IN-ARRAY                         15120003
151300             MOVE PV-FIRST-BLOCK-IN-RANGE                         15130003
151400                                   TO PV-BLOCK-NUMBER             15140003
151500             PERFORM 4410-READ-TEMP-STORAGE                       15150003
151600             PERFORM 3510-MARK-SELECTED-INDS                      15160003
151700                 VARYING ASC-ITEM-SUB                             15170003
151800                 FROM 1 BY 1                                      15180003
151900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15190003
152000             PERFORM 5100-WRITE-TEMP-STORAGE                      15200003
152100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15210003
152200         END-PERFORM                                              15220003
152300                                                                  15230003
152400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15240003
152500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15250003
152600         PERFORM                                                  15260003
152700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15270003
152800                   PV-LAST-BLOCK-IN-RANGE                         15280003
152900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15290003
153000                                   TO PV-BLOCK-NUMBER             15300003
153100             PERFORM 4410-READ-TEMP-STORAGE                       15310003
153200             PERFORM 3510-MARK-SELECTED-INDS                      15320003
153300                 VARYING ASC-ITEM-SUB                             15330003
153400                 FROM 1 BY 1                                      15340003
153500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15350003
153600             PERFORM 5100-WRITE-TEMP-STORAGE                      15360003
153700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15370003
153800         END-PERFORM                                              15380003
153900                                                                  15390003
154000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15400003
154100                                   TO PV-BLOCK-NUMBER             15410003
154200         PERFORM 4410-READ-TEMP-STORAGE                           15420003
154300     END-IF.                                                      15430003
154400                                                                  15440003
154500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15450003
154600                                      ASC-END-OF-SELECTED-RANGE.  15460003
154700                                                                  15470003
154800/                                                                 15480003
154900*----------------------------------------------------------------*15490003
155000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15500003
155100*----------------------------------------------------------------*15510003
155200                                                                  15520003
155300 3510-MARK-SELECTED-INDS.                                         15530003
155400                                                                  15540003
155500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         15550003
155600         ASC-START-OF-SELECTED-RANGE)                             15560003
155700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         15570003
155800         ASC-START-OF-SELECTED-RANGE)                             15580003
155900                                                                  15590003
156000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     15600003
156100             ASC-END-OF-SELECTED-RANGE)                           15610003
156200         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     15620003
156300             ASC-END-OF-SELECTED-RANGE)                           15630003
156400                                                                  15640003
156500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15650003
156600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15660003
156700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15670003
156800                                   TO TRUE                        15680003
156900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15690003
157000                                   TO TRUE                        15700003
157100                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS15710003
157200             END-IF                                               15720003
157300         END-IF                                                   15730003
157400     END-IF.                                                      15740003
157500                                                                  15750003
157600/                                                                 15760003
157700*----------------------------------------------------------------*15770003
157800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15780003
157900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15790003
158000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15800003
158100*    DISPLAY THE PANEL TO USER.                                  *15810003
158200*----------------------------------------------------------------*15820003
158300                                                                  15830003
158400 4000-BUILD-INITIAL-PANEL.                                        15840003
158500                                                                  15850003
158600     INITIALIZE ASC-BLOCK-ENTRIES (1)                             15860003
158700                ASC-BLOCK-ENTRIES (2).                            15870003
158800                                                                  15880003
158900     MOVE +1                       TO ASC-BLK-SUB.                15890003
159000                                                                  15900003
159100     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       15910003
159200                                                                  15920003
159300     MOVE +0                       TO ASC-ITEM-SUB                15930003
159400                                      ASC-NUMBER-OF-ITEMS-READ    15940003
159500                                      ASC-NUMBER-OF-SELECTED-ITEMS15950003
159600                                      ASC-HIGHEST-BLOCK-WRITTEN   15960003
159700                                      ASC-START-OF-SELECTED-RANGE 15970003
159800                                      ASC-END-OF-SELECTED-RANGE   15980003
159900                                      ASC-ITEM-AT-TOP-OF-PANEL.   15990003
160000                                                                  16000003
160100     PERFORM 4100-PREPARE-CURSOR.                                 16010003
160200                                                                  16020003
160300     PERFORM 4010-OPEN-CURSOR.                                    16030003
160400                                                                  16040003
160500     PERFORM 4300-READ-ITEMS-FROM-DB.                             16050003
160600                                                                  16060003
160700     PERFORM 4020-CLOSE-CURSOR.                                   16070003
160800                                                                  16080003
160900     MOVE +1                       TO PV-TOP-ITEM.                16090003
161000                                                                  16100003
161100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16110003
161200         SET DP020-NEXT-ACT-APPL-ERROR                            16120003
161300                                   TO TRUE                        16130003
161400         SET DP020-MSG-FATAL       TO TRUE                        16140003
161500         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            16150003
161600     ELSE                                                         16160003
161700         MOVE -1                   TO MR-SELECTL (1)              16170003
161800         SET DP030-SET-CURSOR-APPL-1                              16180003
161900                                   TO TRUE                        16190003
162000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16200003
162100     END-IF.                                                      16210003
162200                                                                  16220003
162300/                                                                 16230003
162400*----------------------------------------------------------------*16240003
162500* OPEN THE SHIPMENT CURSOR                                       *16250003
162600*----------------------------------------------------------------*16260003
162700                                                                  16270003
162800 4010-OPEN-CURSOR.                                                16280003
162900                                                                  16290003
163000     PERFORM                                                      16300003
163100         WITH TEST AFTER                                          16310003
163200         VARYING PV-RETRY-COUNTER                                 16320003
163300         FROM 1 BY 1                                              16330003
163400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16340003
163500            OR (SQLCODE = +0))                                    16350003
163600                                                                  16360003
163700         EXEC SQL                                                 16370003
163800             OPEN TTRDFNC_CSR                                     16380003
163900         END-EXEC                                                 16390003
164000                                                                  16400003
164100                                                                  16410003
164200         EVALUATE TRUE                                            16420003
164300             WHEN SQLCODE = +0                                    16430003
164400                  CONTINUE                                        16440003
164500             WHEN SQLCODE = -904                                  16450003
164600             WHEN SQLCODE = -913                                  16460003
164700                  CONTINUE                                        16470003
164800             WHEN SQLWARN0 NOT = SPACE                            16480003
164900             WHEN SQLCODE  NOT = +0                               16490003
165000                  MOVE '4010-OPEN-CURSOR'                         16500003
165100                                   TO DP013-PARAGRAPH             16510003
165200                  MOVE 'OPEN CURSOR'                              16520003
165300                                   TO DP013-MESSAGE-TEXT (1)      16530003
165400                  MOVE SQLCA       TO DP013-SQLCA                 16540003
165500                  MOVE 'TTRDFNC'   TO DP013-DB2-TABLE-NAME (1)    16550003
165600                  SET DP013-DB2-ABEND                             16560003
165700                                   TO TRUE                        16570003
165800                  PERFORM DP013-0000-PROCESS-ABEND                16580003
165900         END-EVALUATE                                             16590003
166000     END-PERFORM.                                                 16600003
166100                                                                  16610003
166200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16620003
166300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             16630003
166400         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              16640003
166500                                   TO DP013-MESSAGE-TEXT (1)      16650003
166600         MOVE SQLCA                TO DP013-SQLCA                 16660003
166700         SET DP013-DB2-ABEND       TO TRUE                        16670003
166800         PERFORM DP013-0000-PROCESS-ABEND                         16680003
166900     END-IF.                                                      16690003
167000                                                                  16700003
167100/                                                                 16710003
167200*----------------------------------------------------------------*16720003
167300* CLOSE THE SHIPMENT CURSOR                                      *16730003
167400*----------------------------------------------------------------*16740003
167500                                                                  16750003
167600 4020-CLOSE-CURSOR.                                               16760003
167700                                                                  16770003
167800     EXEC SQL                                                     16780003
167900         CLOSE TTRDFNC_CSR                                        16790003
168000     END-EXEC.                                                    16800003
168100                                                                  16810003
168200     EVALUATE TRUE                                                16820003
168300         WHEN SQLCODE = +0                                        16830003
168400              CONTINUE                                            16840003
168500         WHEN SQLWARN0 NOT = SPACE                                16850003
168600         WHEN SQLCODE  NOT = +0                                   16860003
168700              MOVE '4020-CLOSE-CURSOR'                            16870003
168800                                   TO DP013-PARAGRAPH             16880003
168900              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      16890003
169000              MOVE SQLCA           TO DP013-SQLCA                 16900003
169100              MOVE 'TTRDFNC'       TO DP013-DB2-TABLE-NAME (1)    16910003
169200              SET DP013-DB2-ABEND  TO TRUE                        16920003
169300              PERFORM DP013-0000-PROCESS-ABEND                    16930003
169400     END-EVALUATE.                                                16940003
169500                                                                  16950003
169600/                                                                 16960003
169700*----------------------------------------------------------------*16970003
169800*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *16980003
169900*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *16990003
170000*----------------------------------------------------------------*17000003
170100                                                                  17010003
170200 4100-PREPARE-CURSOR.                                             17020003
170300                                                                  17030003
170400     MOVE ASC-KEY-TP-DKEY  TO DK-TP-DKEY.                         17040003
170500/                                                                 17050003
170600*----------------------------------------------------------------*17060003
170700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17070003
170800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17080003
170900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17090003
171000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17100003
171100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17110003
171200*                                                                *17120003
171300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17130003
171400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17140003
171500*    UPON INITIALIZATION.                                        *17150003
171600*----------------------------------------------------------------*17160003
171700                                                                  17170003
171800 4300-READ-ITEMS-FROM-DB.                                         17180003
171900                                                                  17190003
172000     PERFORM                                                      17200003
172100         VARYING PV-READ-COUNT                                    17210003
172200         FROM 1 BY 1                                              17220003
172300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17230003
172400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17240003
172500                                                                  17250003
172600         PERFORM 4310-FETCH                                       17260003
172700                                                                  17270003
172800         IF  ASC-ITEMS-LEFT-ON-DB                                 17280003
172900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17290003
173000                 ADD +1            TO ASC-ITEM-SUB                17300003
173100             ELSE                                                 17310003
173200                 ADD +1            TO ASC-BLK-SUB                 17320003
173300                 MOVE +1           TO ASC-ITEM-SUB                17330003
173400                                                                  17340003
173500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17350003
173600                     MOVE +1       TO ASC-BLK-SUB                 17360003
173700                     SET ASC-BLOCK-MODIFIED (1)                   17370003
173800                                   TO TRUE                        17380003
173900                     PERFORM 5100-WRITE-TEMP-STORAGE              17390003
174000                     MOVE ASC-BLOCK-ENTRIES                       17400003
174100                               (PC-MAX-BLOCKS-IN-ARRAY)           17410003
174200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 17420003
174300                     ADD +1        TO ASC-BLK-SUB                 17430003
174400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17440003
174500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17450003
174600                                   TO TRUE                        17460003
174700                 END-IF                                           17470003
174800             END-IF                                               17480003
174900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17490003
175000             MOVE ASC-NUMBER-OF-ITEMS-READ                        17500003
175100                                   TO ASC-LIST-ITEM-NUMBER        17510003
175200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17520003
175300             MOVE TRDFNC-FUNC-CDE          TO                     17530003
175400                  ASC-FUNC-CDE        (ASC-BLK-SUB ASC-ITEM-SUB)  17540003
175500             MOVE TRDFNC-DIR-IND           TO                     17550003
175600                  ASC-DIR-IND         (ASC-BLK-SUB ASC-ITEM-SUB)  17560003
175700         END-IF                                                   17570003
175800     END-PERFORM.                                                 17580003
175900                                                                  17590003
176000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17600003
176100         MOVE +1                   TO ASC-BLK-SUB                 17610003
176200         PERFORM 5100-WRITE-TEMP-STORAGE                          17620003
176300         ADD +1                    TO ASC-BLK-SUB                 17630003
176400         PERFORM 5100-WRITE-TEMP-STORAGE                          17640003
176500                                                                  17650003
176600         MOVE 1                    TO ASC-BLK-SUB                 17660003
176700                                      PV-BLOCK-NUMBER             17670003
176800         PERFORM 4410-READ-TEMP-STORAGE                           17680003
176900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17690003
177000             MOVE 2                TO ASC-BLK-SUB                 17700003
177100                                      PV-BLOCK-NUMBER             17710003
177200             PERFORM 4410-READ-TEMP-STORAGE                       17720003
177300         END-IF                                                   17730003
177400     END-IF.                                                      17740003
177500                                                                  17750003
177600/                                                                 17760003
177700*----------------------------------------------------------------*17770003
177800*    FETCH A TTRDFNC ROW                                         *17780003
177900*----------------------------------------------------------------*17790003
178000                                                                  17800003
178100 4310-FETCH.                                                      17810003
178200                                                                  17820003
178300     EXEC SQL                                                     17830003
178400         FETCH TTRDFNC_CSR                                        17840003
178500            INTO :TRDFNC-FUNC-CDE                                 17850003
178600                ,:TRDFNC-DIR-IND                                  17860003
178700     END-EXEC.                                                    17870003
178800                                                                  17880003
178900     EVALUATE TRUE                                                17890003
179000         WHEN SQLCODE = +0                                        17900003
179100              CONTINUE                                            17910003
179200                                                                  17920003
179300         WHEN SQLCODE = +100                                      17930003
179400              SET ASC-NO-ITEMS-LEFT-ON-DB                         17940003
179500                                   TO TRUE                        17950003
179600                                                                  17960003
179700         WHEN SQLWARN0 NOT = SPACE                                17970003
179800         WHEN SQLCODE < +0                                        17980003
179900         WHEN SQLCODE > +0                                        17990003
180000              MOVE '4310-FETCH-CURSOR'                            18000003
180100                                   TO DP013-PARAGRAPH             18010003
180200              MOVE 'FETCH TTRDFNC CURSOR'                         18020003
180300                                   TO DP013-MESSAGE-TEXT (1)      18030003
180400              MOVE SQLCA           TO DP013-SQLCA                 18040003
180500              MOVE 'TTRDFNC'       TO DP013-DB2-TABLE-NAME (1)    18050003
180600              SET DP013-DB2-ABEND  TO TRUE                        18060003
180700              PERFORM DP013-0000-PROCESS-ABEND                    18070003
180800     END-EVALUATE.                                                18080003
180900                                                                  18090003
181000/                                                                 18100003
181100*----------------------------------------------------------------*18110003
181200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18120003
181300*----------------------------------------------------------------*18130003
181400                                                                  18140003
181500 4400-MOVE-COMMAREA-TO-SCREEN.                                    18150003
181600                                                                  18160003
181700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18170003
181800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18180003
181900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18190003
182000             MOVE +1               TO ASC-BLK-SUB                 18200003
182100             PERFORM 5100-WRITE-TEMP-STORAGE                      18210003
182200             ADD +1                TO ASC-BLK-SUB                 18220003
182300             PERFORM 5100-WRITE-TEMP-STORAGE                      18230003
182400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18240003
182500                 GIVING PV-BLOCK-NUMBER                           18250003
182600                 REMAINDER PV-REMAINDER                           18260003
182700             IF  PV-REMAINDER > ZERO                              18270003
182800                 ADD +1            TO PV-BLOCK-NUMBER             18280003
182900             END-IF                                               18290003
183000             MOVE +1               TO ASC-BLK-SUB                 18300003
183100             PERFORM 4410-READ-TEMP-STORAGE                       18310003
183200             ADD +1                TO ASC-BLK-SUB                 18320003
183300                                      PV-BLOCK-NUMBER             18330003
183400             PERFORM 4410-READ-TEMP-STORAGE                       18340003
183500     END-IF.                                                      18350003
183600                                                                  18360003
183700     MOVE +1                       TO ASC-BLK-SUB.                18370003
183800                                                                  18380003
183900     COMPUTE ASC-ITEM-SUB =                                       18390003
184000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18400003
184100         + PC-ITEMS-PER-PANEL).                                   18410003
184200                                                                  18420003
184300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18430003
184400         ADD +1                    TO ASC-BLK-SUB                 18440003
184500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18450003
184600     END-IF.                                                      18460003
184700                                                                  18470003
184800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18480003
184900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18490003
185000                                                                  18500003
185100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18510003
185200     PERFORM 4420-FORMAT-LIST-LINES                               18520003
185300         VARYING PV-SUB                                           18530003
185400         FROM PC-ITEMS-PER-PANEL BY -1                            18540003
185500         UNTIL PV-SUB < +1.                                       18550003
185600                                                                  18560003
185700     COMPUTE ASC-ITEMS-DISPLAYED =                                18570003
185800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18580003
185900                                                                  18590003
186000     IF PS-NO-START-ITEM-ERROR                                    18600003
186100         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL18610003
186200                                          ASTRTITO                18620003
186300         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  18630003
186400     ELSE                                                         18640003
186500         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                18650003
186600     END-IF.                                                      18660003
186700                                                                  18670003
186800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18680003
186900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18690003
187000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            18700003
187100                                   TO ASELITO.                    18710003
187200                                                                  18720003
187300     IF  DP020-MSG-NUMBER-X = SPACE                               18730003
187400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18740003
187500*            --- MORE ITEMS TO DISPLAY ----                       18750003
187600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18760003
187700             SET DP020-MSG-INFORMATIONAL                          18770003
187800                                   TO TRUE                        18780003
187900         END-IF                                                   18790003
188000     END-IF.                                                      18800003
188100                                                                  18810003
188200*----------------------------------------------------------------*18820003
188300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18830003
188400*----------------------------------------------------------------*18840003
188500                                                                  18850003
188600 4410-READ-TEMP-STORAGE.                                          18860003
188700                                                                  18870003
188800     EXEC CICS                                                    18880003
188900         READQ TS                                                 18890003
189000             QUEUE (ASC-LIST-QUEUE-NAME)                          18900003
189100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18910003
189200             ITEM  (PV-BLOCK-NUMBER)                              18920003
189300             RESP  (PV-CICS-RESP)                                 18930003
189400     END-EXEC.                                                    18940003
189500                                                                  18950003
189600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18960003
189700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18970003
189800         CONTINUE                                                 18980003
189900     ELSE                                                         18990003
190000         SET DP013-CICS-ABEND      TO TRUE                        19000003
190100         SET DP013-NO-ROLLBACK     TO TRUE                        19010003
190200         MOVE '4410-READ-TEMP-STORAGE'                            19020003
190300                                   TO DP013-PARAGRAPH             19030003
190400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19040003
190500                                   TO DP013-MESSAGE-TEXT(1)       19050003
190600         PERFORM DP013-0000-PROCESS-ABEND                         19060003
190700     END-IF.                                                      19070003
190800                                                                  19080003
190900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      19090003
191000                                   TO TRUE.                       19100003
191100                                                                  19110003
191200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19120003
191300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19130003
191400     END-IF.                                                      19140003
191500                                                                  19150003
191600/                                                                 19160003
191700*----------------------------------------------------------------*19170003
191800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19180003
191900*----------------------------------------------------------------*19190003
192000                                                                  19200003
192100 4420-FORMAT-LIST-LINES.                                          19210003
192200                                                                  19220003
192300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19230003
192400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19240003
192500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19250003
192600         MOVE SPACES             TO MR-SELECT  (PV-SUB)           19260003
192700                                    MR-ACTION  (PV-SUB)           19270003
192800                                    MR-VENDOR-NAME(PV-SUB)        19280003
192900                                    MR-VEND-INCHG-QUAL(PV-SUB)    19290003
193000                                    MR-VEND-INCHG-ID(PV-SUB)      19300003
193100                                    MR-NETWK-NAME(PV-SUB)         19310003
193200                                    MR-FUNC-CDE(PV-SUB)           19320003
193300                                    MR-DIR-IND (PV-SUB)           19330003
193400     ELSE                                                         19340003
193500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19350003
193600                                                   > SPACE        19360003
193700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19370003
193800                                   TO MR-SELECT (PV-SUB)          19380003
193900         ELSE                                                     19390003
194000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19400003
194100                                   TO MR-SELECT (PV-SUB)          19410003
194200         END-IF                                                   19420003
194300                                                                  19430003
194400         IF  DP030-SET-CURSOR-TRAILER                             19440003
194500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19450003
194600                 > SPACE)                                         19460003
194700               OR (PV-SUB = 1))                                   19470003
194800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19480003
194900                MOVE -1            TO MR-SELECTL (PV-SUB)         19490003
195000             END-IF                                               19500003
195100         END-IF                                                   19510003
195200                                                                  19520003
195300         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19530003
195400             MOVE ASC-ACTION          (ASC-BLK-SUB ASC-ITEM-SUB)  19540003
195500               TO MR-ACTION           (PV-SUB)                    19550003
195600             MOVE ASC-VENDOR-NAME                                 19560003
195700               TO MR-VENDOR-NAME      (PV-SUB)                    19570003
195800             MOVE ASC-VEND-INCHG-QUAL                             19580003
195900               TO MR-VEND-INCHG-QUAL  (PV-SUB)                    19590003
196000             MOVE ASC-VEND-INCHG-ID                               19600003
196100               TO MR-VEND-INCHG-ID    (PV-SUB)                    19610003
196200             MOVE ASC-NETWK-NAME                                  19620003
196300               TO MR-NETWK-NAME       (PV-SUB)                    19630003
196400             MOVE ASC-FUNC-CDE        (ASC-BLK-SUB ASC-ITEM-SUB)  19640003
196500               TO MR-FUNC-CDE         (PV-SUB)                    19650003
196600             MOVE ASC-DIR-IND         (ASC-BLK-SUB ASC-ITEM-SUB)  19660003
196700               TO MR-DIR-IND          (PV-SUB)                    19670003
196800         END-IF                                                   19680003
196900     END-IF.                                                      19690003
197000                                                                  19700003
197100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               19710003
197200                                                                  19720003
197300     IF  ASC-ITEM-SUB < + 1                                       19730003
197400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                19740003
197500         MOVE +1                   TO ASC-BLK-SUB                 19750003
197600     END-IF.                                                      19760003
197700                                                                  19770003
197800*----------------------------------------------------------------*19780003
197900*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *19790003
198000*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *19800003
198100*  ISSUE A WARNING.                                              *19810003
198200*----------------------------------------------------------------*19820003
198300 4430-CHECK-FOR-BEGIN-AND-END.                                    19830003
198400                                                                  19840003
198500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19850003
198600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19860003
198700*            -- NO END-OF-RANGE SPECFIED ---                      19870003
198800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            19880003
198900             SET DP020-MSG-WARNING TO TRUE                        19890003
199000             PERFORM 4431-POSITION-AT-WARNING                     19900003
199100         END-IF                                                   19910003
199200     ELSE                                                         19920003
199300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     19930003
199400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                19940003
199500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            19950003
199600             SET DP020-MSG-WARNING TO TRUE                        19960003
199700             PERFORM 4431-POSITION-AT-WARNING                     19970003
199800         END-IF                                                   19980003
199900     END-IF.                                                      19990003
200000                                                                  20000003
200100*----------------------------------------------------------------*20010003
200200*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *20020003
200300*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *20030003
200400*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *20040003
200500*  POSITION THE CURSOR THERE.                                    *20050003
200600*----------------------------------------------------------------*20060003
200700 4431-POSITION-AT-WARNING.                                        20070003
200800                                                                  20080003
200900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20090003
201000                    - PV-TOP-ITEM + 1.                            20100003
201100                                                                  20110003
201200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20120003
201300         CONTINUE                                                 20130003
201400     ELSE                                                         20140003
201500         SET DP030-SET-CURSOR-APPL-1                              20150003
201600                                   TO TRUE                        20160003
201700         MOVE -1                   TO MR-SELECTL (PV-SUB)         20170003
201800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20180003
201900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20190003
202000     END-IF.                                                      20200003
202100                                                                  20210003
202200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20220003
202300                    - PV-TOP-ITEM + 1.                            20230003
202400                                                                  20240003
202500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20250003
202600         CONTINUE                                                 20260003
202700     ELSE                                                         20270003
202800         SET DP030-SET-CURSOR-APPL-1                              20280003
202900                                   TO TRUE                        20290003
203000         MOVE -1                   TO MR-SELECTL (PV-SUB)         20300003
203100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20310003
203200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20320003
203300     END-IF.                                                      20330003
203400                                                                  20340003
203500/                                                                 20350003
203600*----------------------------------------------------------------*20360003
203700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20370003
203800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20380003
203900* FOR THE SELECTED ITEMS QUEUE.                                  *20390003
204000*                                                                *20400003
204100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20410003
204200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20420003
204300* THE ARRAY IS FULL.                                             *20430003
204400*----------------------------------------------------------------*20440003
204500                                                                  20450003
204600 5000-PREPARE-SEL-QUEUE.                                          20460003
204700                                                                  20470003
204800     MOVE +1                       TO ASC-BLK-SUB.                20480003
204900     PERFORM 5100-WRITE-TEMP-STORAGE.                             20490003
205000     ADD +1                        TO ASC-BLK-SUB.                20500003
205100     PERFORM 5100-WRITE-TEMP-STORAGE.                             20510003
205200                                                                  20520003
205300     MOVE ASC-SEL-QUEUE-NAME-OUT   TO ET300-SEL-QUEUE-NAME.       20530003
205400     PERFORM 6010-DELETE-SEL-QUEUE.                               20540003
205500                                                                  20550003
205600     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      20560003
205700         SET ASC-UPDATE-TSQ        TO TRUE                        20570003
205800     END-IF.                                                      20580003
205900                                                                  20590003
206000     SET ET301-IDX                 TO 1.                          20600003
206100     MOVE ZERO                     TO ET300-NUMBER-OF-TS-ITEMS.   20610003
206200     INITIALIZE ET301-SELECTED-ITEM-ARRAY.                        20620003
206300                                                                  20630003
206400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20640003
206500             VARYING PV-ITEM                                      20650003
206600             FROM 1 BY 1                                          20660003
206700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20670003
206800                                                                  20680003
206900     IF  ET301-IDX > 1                                            20690003
207000         PERFORM 5205-WRITE-SEL-QUEUE                             20700003
207100         ADD +1                    TO ET300-NUMBER-OF-TS-ITEMS    20710003
207200     END-IF.                                                      20720003
207300                                                                  20730003
207400/                                                                 20740003
207500*----------------------------------------------------------------*20750003
207600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20760003
207700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20770003
207800*----------------------------------------------------------------*20780003
207900                                                                  20790003
208000 5100-WRITE-TEMP-STORAGE.                                         20800003
208100                                                                  20810003
208200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20820003
208300                                   TO PV-LIST-ITEM-NUMBER.        20830003
208400     COMPUTE PV-BLOCK-NUMBER =                                    20840003
208500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20850003
208600                                                                  20860003
208700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20870003
208800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20880003
208900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20890003
209000             PERFORM 5105-REWRITE-ASC-LISTQ                       20900003
209100         END-IF                                                   20910003
209200     ELSE                                                         20920003
209300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20930003
209400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20940003
209500         PERFORM 5110-WRITE-ASC-LISTQ                             20950003
209600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20960003
209700     END-IF.                                                      20970003
209800                                                                  20980003
209900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      20990003
210000                                   TO TRUE.                       21000003
210100                                                                  21010003
210200/                                                                 21020003
210300*----------------------------------------------------------------*21030003
210400*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *21040003
210500*  SPECIFIC COMMAREA.                                            *21050003
210600*----------------------------------------------------------------*21060003
210700 5105-REWRITE-ASC-LISTQ.                                          21070003
210800                                                                  21080003
210900     EXEC CICS                                                    21090003
211000         WRITEQ TS                                                21100003
211100             QUEUE (ASC-LIST-QUEUE-NAME)                          21110003
211200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21120003
211300             ITEM  (PV-BLOCK-NUMBER)                              21130003
211400             REWRITE                                              21140003
211500             RESP  (PV-CICS-RESP)                                 21150003
211600     END-EXEC.                                                    21160003
211700                                                                  21170003
211800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           21180003
211900         CONTINUE                                                 21190003
212000     ELSE                                                         21200003
212100         SET DP013-CICS-ABEND      TO TRUE                        21210003
212200         SET DP013-NO-ROLLBACK     TO TRUE                        21220003
212300         MOVE '5105-REWRITE-ASC-LISTQ'                            21230003
212400                                   TO DP013-PARAGRAPH             21240003
212500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     21250003
212600                                   TO DP013-MESSAGE-TEXT(1)       21260003
212700         PERFORM DP013-0000-PROCESS-ABEND                         21270003
212800     END-IF.                                                      21280003
212900                                                                  21290003
213000/                                                                 21300003
213100*----------------------------------------------------------------*21310003
213200*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *21320003
213300*  SPECIFIC COMMAREA.                                            *21330003
213400*----------------------------------------------------------------*21340003
213500 5110-WRITE-ASC-LISTQ.                                            21350003
213600                                                                  21360003
213700     EXEC CICS                                                    21370003
213800         WRITEQ TS                                                21380003
213900             QUEUE (ASC-LIST-QUEUE-NAME)                          21390003
214000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21400003
214100             ITEM  (PV-BLOCK-NUMBER)                              21410003
214200             RESP  (PV-CICS-RESP)                                 21420003
214300     END-EXEC.                                                    21430003
214400                                                                  21440003
214500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      21450003
214600         SET DP013-CICS-ABEND      TO TRUE                        21460003
214700         SET DP013-NO-ROLLBACK     TO TRUE                        21470003
214800         MOVE '5110-WRITE-ASC-LISTQ'                              21480003
214900                                   TO DP013-PARAGRAPH             21490003
215000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21500003
215100                                   TO DP013-MESSAGE-TEXT(1)       21510003
215200         PERFORM DP013-0000-PROCESS-ABEND                         21520003
215300     END-IF.                                                      21530003
215400                                                                  21540003
215500/                                                                 21550003
215600*----------------------------------------------------------------*21560003
215700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21570003
215800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21580003
215900*----------------------------------------------------------------*21590003
216000                                                                  21600003
216100 5200-FILL-SEL-QUEUE-RECORD.                                      21610003
216200                                                                  21620003
216300     PERFORM 6112-READ-LIST-QUEUE.                                21630003
216400                                                                  21640003
216500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21650003
216600         PERFORM                                                  21660003
216700         VARYING LQW-IDX                                          21670003
216800         FROM 1 BY 1                                              21680003
216900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21690003
217000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          21700003
217100                                                                  21710003
217200*-->         *** DON'T ALLOW DELETED ITEMS TO BE SENT TO THE  *** 21720003
217300*-->         *** DETAIL SCREEN                                *** 21730003
217400             IF  LQW-SELECT (LQW-IDX) AND                         21740003
217500                (LQW-ACTION (LQW-IDX) NOT = PC-DEL)               21750003
217600                                                                  21760003
217700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              21770003
217800                                      TO ET301-ITEM    (ET301-IDX)21780003
217900                 MOVE SPACE           TO ET301-ACTION-SW          21790003
218000                                                       (ET301-IDX)21800003
218100                 MOVE ASC-KEY-TP-DKEY TO ET301-TP-DKEY (ET301-IDX)21810003
218200                 MOVE ASC-ENT-ID      TO ET301-ENT-ID  (ET301-IDX)21820003
218300                 MOVE ASC-VENDOR-NAME TO ET301-VENDOR-NAME        21830003
218400                                                       (ET301-IDX)21840003
218500                 MOVE ASC-VEND-INCHG-QUAL                         21850003
218600                                      TO ET301-VEND-INCHG-QUAL    21860003
218700                                                       (ET301-IDX)21870003
218800                 MOVE ASC-VEND-INCHG-ID                           21880003
218900                                      TO ET301-VEND-INCHG-ID      21890003
219000                                                       (ET301-IDX)21900003
219100                 MOVE ASC-NETWK-ID    TO ET301-NETWK-ID(ET301-IDX)21910003
219200                 MOVE ASC-NETWK-NAME  TO ET301-NETWK-NAME         21920003
219300                                                       (ET301-IDX)21930003
219400                 MOVE LQW-FUNC-CDE         (LQW-IDX)              21940003
219500                                      TO ET301-FUNC-CDE(ET301-IDX)21950003
219600                 MOVE LQW-DIR-IND  (LQW-IDX)                      21960003
219700                                      TO ET301-DIR-IND (ET301-IDX)21970003
219800                 SET ET301-IDX UP BY 1                            21980003
219900                 IF  ET301-IDX > ET301-MAX-ITEMS                  21990003
220000                     PERFORM 5205-WRITE-SEL-QUEUE                 22000003
220100                     ADD +1        TO ET300-NUMBER-OF-TS-ITEMS    22010003
220200                     INITIALIZE ET301-SELECTED-ITEM-ARRAY         22020003
220300                     SET ET301-IDX TO 1                           22030003
220400                 END-IF                                           22040003
220500             END-IF                                               22050003
220600         END-PERFORM                                              22060003
220700     END-IF.                                                      22070003
220800                                                                  22080003
220900/                                                                 22090003
221000*----------------------------------------------------------------*22100003
221100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *22110003
221200*----------------------------------------------------------------*22120003
221300                                                                  22130003
221400 5205-WRITE-SEL-QUEUE.                                            22140003
221500                                                                  22150003
221600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22160003
221700                                   TO ET301-SELECTED-ITEMS.       22170003
221800                                                                  22180003
221900     EXEC CICS                                                    22190003
222000          WRITEQ TS                                               22200003
222100              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      22210003
222200              FROM  (ET301-SELECTED-VNDRS)                        22220003
222300              ITEM  (PV-SEL-QUEUE-ITEM)                           22230003
222400              RESP  (PV-CICS-RESP)                                22240003
222500     END-EXEC.                                                    22250003
222600                                                                  22260003
222700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22270003
222800         CONTINUE                                                 22280003
222900     ELSE                                                         22290003
223000         SET DP013-CICS-ABEND      TO TRUE                        22300003
223100         SET DP013-NO-ROLLBACK     TO TRUE                        22310003
223200         MOVE '5205-WRITE-SEL-QUEUE'                              22320003
223300                                   TO DP013-PARAGRAPH             22330003
223400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          22340003
223500                                   TO DP013-MESSAGE-TEXT(1)       22350003
223600         PERFORM DP013-0000-PROCESS-ABEND                         22360003
223700     END-IF.                                                      22370003
223800                                                                  22380003
223900/                                                                 22390003
224000*----------------------------------------------------------------*22400003
224100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *22410003
224200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *22420003
224300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *22430003
224400*  THE USER.                                                     *22440003
224500*----------------------------------------------------------------*22450003
224600 6000-REFRESH-PANEL-FROM-TEMP.                                    22460003
224700                                                                  22470003
224800     IF  ASC-UPDATE-TSQ                                           22480003
224900         SET ASC-NO-TSQ-UPDATE     TO TRUE                        22490003
225000         MOVE ZERO                 TO PV-SAVE-ITEM                22500003
225100                                      PV-SEL-QUEUE-ITEM           22510003
225200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        22520003
225300                                   TO PV-HOLD-SELECTED-ITEMS      22530003
225400         PERFORM 6100-UPDATE-TSQ                                  22540003
225500             UNTIL PV-ITEMS-PROCESSED >                           22550003
225600                                     ASC-NUMBER-OF-SELECTED-ITEMS 22560003
225700         PERFORM 6010-DELETE-SEL-QUEUE                            22570003
225800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         22580003
225900                    ASC-BLOCK-ENTRIES (2)                         22590003
226000     END-IF.                                                      22600003
226100                                                                  22610003
226200/                                                                 22620003
226300*----------------------------------------------------------------*22630003
226400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *22640003
226500*----------------------------------------------------------------*22650003
226600 6010-DELETE-SEL-QUEUE.                                           22660003
226700                                                                  22670003
226800     EXEC CICS                                                    22680003
226900         DELETEQ TS                                               22690003
227000             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       22700003
227100             RESP  (PV-CICS-RESP)                                 22710003
227200     END-EXEC.                                                    22720003
227300                                                                  22730003
227400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22740003
227500         (PV-CICS-RESP = DFHRESP(QIDERR)))                        22750003
227600         CONTINUE                                                 22760003
227700     ELSE                                                         22770003
227800         SET DP013-CICS-ABEND      TO TRUE                        22780003
227900         SET DP013-NO-ROLLBACK     TO TRUE                        22790003
228000         MOVE '6010-DELETE-SEL-QUEUE'                             22800003
228100                                   TO DP013-PARAGRAPH             22810003
228200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22820003
228300                                   TO DP013-MESSAGE-TEXT (1)      22830003
228400         PERFORM DP013-0000-PROCESS-ABEND                         22840003
228500     END-IF.                                                      22850003
228600                                                                  22860003
228700/                                                                 22870003
228800*----------------------------------------------------------------*22880003
228900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22890003
229000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22900003
229100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22910003
229200*    THE TEMP QUEUE.                                             *22920003
229300*----------------------------------------------------------------*22930003
229400                                                                  22940003
229500 6100-UPDATE-TSQ.                                                 22950003
229600                                                                  22960003
229700     ADD 1                         TO PV-SEL-QUEUE-ITEM.          22970003
229800     PERFORM 6105-READ-SEL-QUEUE.                                 22980003
229900                                                                  22990003
230000     PERFORM                                                      23000003
230100         VARYING ET301-IDX                                        23010003
230200         FROM 1 BY 1                                              23020003
230300         UNTIL ((PV-ITEMS-PROCESSED >                             23030003
230400                              PV-HOLD-SELECTED-ITEMS)             23040003
230500         OR (ET301-IDX GREATER THAN ET301-MAX-ITEMS))             23050003
230600         IF  ET301-ACTION-SW (ET301-IDX) > SPACE                  23060003
230700             PERFORM 6110-PROCESS-ITEMS                           23070003
230800         END-IF                                                   23080003
230900         ADD +1                    TO PV-ITEMS-PROCESSED          23090003
231000     END-PERFORM.                                                 23100003
231100                                                                  23110003
231200     PERFORM 6111-WRITE-LIST-QUEUE.                               23120003
231300                                                                  23130003
231400/                                                                 23140003
231500*----------------------------------------------------------------*23150003
231600*    READ THE LIST QUEUE RECORD.                                 *23160003
231700*----------------------------------------------------------------*23170003
231800                                                                  23180003
231900 6105-READ-SEL-QUEUE.                                             23190003
232000                                                                  23200003
232100     EXEC CICS                                                    23210003
232200          READQ TS                                                23220003
232300              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      23230003
232400              INTO  (ET301-SELECTED-VNDRS)                        23240003
232500              ITEM  (PV-SEL-QUEUE-ITEM)                           23250003
232600              RESP  (PV-CICS-RESP)                                23260003
232700     END-EXEC.                                                    23270003
232800                                                                  23280003
232900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23290003
233000         CONTINUE                                                 23300003
233100     ELSE                                                         23310003
233200         SET DP013-CICS-ABEND      TO TRUE                        23320003
233300         SET DP013-NO-ROLLBACK     TO TRUE                        23330003
233400         MOVE '6105-READ-SEL-QUEUE'                               23340003
233500                                   TO DP013-PARAGRAPH             23350003
233600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           23360003
233700                                   TO DP013-MESSAGE-TEXT(1)       23370003
233800         PERFORM DP013-0000-PROCESS-ABEND                         23380003
233900     END-IF.                                                      23390003
234000                                                                  23400003
234100/                                                                 23410003
234200*----------------------------------------------------------------*23420003
234300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*23430003
234400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*23440003
234500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *23450003
234600*----------------------------------------------------------------*23460003
234700                                                                  23470003
234800 6110-PROCESS-ITEMS.                                              23480003
234900                                                                  23490003
235000     COMPUTE PV-ITEM = 1 + ((ET301-ITEM (ET301-IDX) - 1)          23500003
235100                     / PC-ITEMS-PER-PANEL).                       23510003
235200                                                                  23520003
235300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           23530003
235400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          23540003
235500             PERFORM 6111-WRITE-LIST-QUEUE                        23550003
235600         END-IF                                                   23560003
235700         MOVE PV-ITEM              TO PV-SAVE-ITEM                23570003
235800                                                                  23580003
235900         PERFORM 6112-READ-LIST-QUEUE                             23590003
236000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               23600003
236100             CONTINUE                                             23610003
236200         END-IF                                                   23620003
236300     END-IF.                                                      23630003
236400                                                                  23640003
236500     COMPUTE PV-SUB = (ET301-ITEM (ET301-IDX)                     23650003
236600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              23660003
236700                                                                  23670003
236800     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       23680003
236900     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        23690003
237000                                     (PV-SUB).                    23700003
237100                                                                  23710003
237200     EVALUATE TRUE                                                23720003
237300         WHEN ET301-INQ (ET301-IDX)                               23730003
237400              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23740003
237500                                                                  23750003
237600         WHEN ET301-UPD (ET301-IDX)                               23760003
237700              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             23770003
237800                                                                  23780003
237900         WHEN ET301-DEL (ET301-IDX)                               23790003
238000              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             23800003
238100                                                                  23810003
238200         WHEN ET301-ERR (ET301-IDX)                               23820003
238300              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             23830003
238400     END-EVALUATE.                                                23840003
238500                                                                  23850003
238600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23860003
238700                                                                  23870003
238800/                                                                 23880003
238900*----------------------------------------------------------------*23890003
239000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23900003
239100*----------------------------------------------------------------*23910003
239200                                                                  23920003
239300 6111-WRITE-LIST-QUEUE.                                           23930003
239400                                                                  23940003
239500     EXEC CICS                                                    23950003
239600         WRITEQ TS                                                23960003
239700             QUEUE (ASC-LIST-QUEUE-NAME)                          23970003
239800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23980003
239900             ITEM  (PV-SAVE-ITEM)                                 23990003
240000             REWRITE                                              24000003
240100             RESP  (PV-CICS-RESP)                                 24010003
240200     END-EXEC.                                                    24020003
240300                                                                  24030003
240400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24040003
240500         CONTINUE                                                 24050003
240600     ELSE                                                         24060003
240700         SET DP013-CICS-ABEND      TO TRUE                        24070003
240800         SET DP013-NO-ROLLBACK     TO TRUE                        24080003
240900         MOVE '6111-WRITE-LIST-QUEUE'                             24090003
241000                                   TO DP013-PARAGRAPH             24100003
241100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  24110003
241200                                   TO DP013-MESSAGE-TEXT(1)       24120003
241300         PERFORM DP013-0000-PROCESS-ABEND                         24130003
241400     END-IF.                                                      24140003
241500                                                                  24150003
241600/                                                                 24160003
241700*----------------------------------------------------------------*24170003
241800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24180003
241900*----------------------------------------------------------------*24190003
242000                                                                  24200003
242100 6112-READ-LIST-QUEUE.                                            24210003
242200                                                                  24220003
242300     EXEC CICS                                                    24230003
242400         READQ TS                                                 24240003
242500             QUEUE (ASC-LIST-QUEUE-NAME)                          24250003
242600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24260003
242700             ITEM  (PV-ITEM)                                      24270003
242800             RESP  (PV-CICS-RESP)                                 24280003
242900     END-EXEC.                                                    24290003
243000                                                                  24300003
243100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24310003
243200         CONTINUE                                                 24320003
243300     ELSE                                                         24330003
243400         SET DP013-CICS-ABEND      TO TRUE                        24340003
243500         SET DP013-NO-ROLLBACK     TO TRUE                        24350003
243600         MOVE '6112-READ-LIST-QUEUE'                              24360003
243700                                   TO DP013-PARAGRAPH             24370003
243800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    24380003
243900                                   TO DP013-MESSAGE-TEXT(1)       24390003
244000         PERFORM DP013-0000-PROCESS-ABEND                         24400003
244100     END-IF.                                                      24410003
244200                                                                  24420003
244300/                                                                 24430003
244400******************************************************************24440003
244500* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *24450003
244600******************************************************************24460003
244700 6200-DEL-LIST-QUEUE.                                             24470003
244800                                                                  24480003
244900     EXEC CICS                                                    24490003
245000         DELETEQ TS                                               24500003
245100             QUEUE (ASC-LIST-QUEUE-NAME)                          24510003
245200             RESP  (PV-CICS-RESP)                                 24520003
245300     END-EXEC.                                                    24530003
245400                                                                  24540003
245500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      24550003
245600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         24560003
245700         CONTINUE                                                 24570003
245800     ELSE                                                         24580003
245900        SET DP013-CICS-ABEND       TO TRUE                        24590003
246000        SET DP013-NO-ROLLBACK      TO TRUE                        24600003
246100        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             24610003
246200        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               24620003
246300                                   TO DP013-MESSAGE-TEXT (1)      24630003
246400        PERFORM DP013-0000-PROCESS-ABEND                          24640003
246500     END-IF.                                                      24650003
246600                                                                  24660003
246700/                                                                 24670003
246800 7000-FORMAT-COMMAREA.                                            24680003
246900                                                                  24690003
247000     MOVE ASC-KEY-TP-DKEY     TO ET300-TP-DKEY                    24700003
247100     MOVE ASC-ENT-ID          TO ET300-ENT-ID                     24710003
247200     MOVE ASC-VENDOR-NAME     TO ET300-VENDOR-NAME                24720003
247300     MOVE ASC-VEND-INCHG-ID   TO ET300-VEND-INCHG-ID              24730003
247400     MOVE ASC-VEND-INCHG-QUAL TO ET300-VEND-INCHG-QUAL            24740003
247500     MOVE ASC-NETWK-ID        TO ET300-NETWK-ID                   24750003
247600     MOVE ASC-NETWK-NAME      TO ET300-NETWORK-NAME.              24760003
247700                                                                  24770003
247800/                                                                 24780003
247900******************************************************************24790003
248000* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *24800003
248100******************************************************************24810003
248200 9100-READ-SEL-QUEUE.                                             24820003
248300     EXEC CICS                                                    24830003
248400         READQ TS                                                 24840003
248500             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        24850003
248600             INTO  (ET301-SELECTED-VNDRS)                         24860003
248700             ITEM  (ASC-SEL-ITEM)                                 24870003
248800             RESP  (PV-CICS-RESP)                                 24880003
248900     END-EXEC.                                                    24890003
249000                                                                  24900003
249100     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        24910003
249200         CONTINUE                                                 24920003
249300     ELSE                                                         24930003
249400         SET DP013-LOGIC-ABEND                                    24940003
249500             DP013-NO-ROLLBACK     TO TRUE                        24950003
249600         MOVE '9100-READ-SEL-QUEUE'                               24960003
249700                                   TO DP013-PARAGRAPH             24970003
249800         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    24980003
249900                                   TO DP013-MESSAGE-TEXT (1)      24990003
250000         PERFORM DP013-0000-PROCESS-ABEND                         25000003
250100     END-IF.                                                      25010003
250200                                                                  25020003
250300/                                                                 25030003
250400******************************************************************25040003
250500* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *25050003
250600******************************************************************25060003
250700 9200-REWRITE-LIST-QUEUE.                                         25070003
250800     EXEC CICS                                                    25080003
250900          WRITEQ TS                                               25090003
251000              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     25100003
251100              FROM    (ET301-SELECTED-VNDRS)                      25110003
251200              ITEM    (ASC-SEL-ITEM)                              25120003
251300              RESP    (PV-CICS-RESP)                              25130003
251400              REWRITE                                             25140003
251500     END-EXEC.                                                    25150003
251600                                                                  25160003
251700     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    25170003
251800         SET DP013-CICS-ABEND                                     25180003
251900             DP013-NO-ROLLBACK     TO TRUE                        25190003
252000         MOVE '9200-REWRITE-LIST-QUEUE'                           25200003
252100                                   TO DP013-PARAGRAPH             25210003
252200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   25220003
252300                                   TO DP013-MESSAGE-TEXT (1)      25230003
252400         PERFORM DP013-0000-PROCESS-ABEND                         25240003
252500     END-IF.                                                      25250003
252600                                                                  25260003
252700/                                                                 25270003
252800*----------------------------------------------------------------*25280003
252900*    ABEND PROCESSOR MODULE                                      *25290003
253000*----------------------------------------------------------------*25300003
253100                                                                  25310003
253200     COPY DPPD013.                                                25320003
