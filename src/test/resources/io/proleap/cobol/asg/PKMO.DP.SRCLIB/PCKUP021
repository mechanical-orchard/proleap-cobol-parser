000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    PCKUP021.                                         00040000
000500 AUTHOR.        EKTA AGRAWAL.                                     00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN.  JUNE 2010.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM EXTRACTS ALL THE RECORDS FROM THE               * 00100000
001100*  RECIEVER LINE DETAIL TABLE FOR THE PULL NUMBER AND THE PULL  * 00110000
001200*  LINE NUMBER AND WRITES IT TO THE OUTPUT FILE.                * 00120000
001300***************************************************************** 00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600                                                                  00160000
001700 FILE-CONTROL.                                                    00170000
001800                                                                  00180000
001900     SELECT RCVR-LNE-DTL-FILE                                     00190000
002000         ASSIGN TO OUT01.                                         00200000
002100                                                                  00210000
002200***************************************************************** 00220000
002300 DATA DIVISION.                                                   00230000
002400***************************************************************** 00240000
002500 FILE SECTION.                                                    00250000
002600                                                                  00260000
002700 FD  RCVR-LNE-DTL-FILE                                            00270000
002800     RECORDING MODE IS F                                          00280000
002900     BLOCK CONTAINS 0 RECORDS                                     00290000
003000     LABEL RECORDS ARE STANDARD.                                  00300000
003100                                                                  00310000
003200 01 RCVR-LNE-DTL-RECORD    PIC X(107).                            00320000
003300                                                                  00330000
003400***************************************************************** 00340000
003500 WORKING-STORAGE SECTION.                                         00350000
003600                                                                  00360000
003700 01  PS-PROGRAM-SWITCHES.                                         00370000
003800     05  PS-END-OF-CSR-SW             PIC  X(01) VALUE 'N'.       00380000
003900         88  PS-END-OF-RCVR-LNE-DTL-CSR          VALUE 'Y'.       00390000
004000         88  PS-NOT-END-OF-RCVR-LNE-DTL-CSR      VALUE 'N'.       00400000
004100                                                                  00410000
004200 01  PV-PROGRAM-VARIABLES.                                        00420000
004300     05  PV-RECORDS-EXTRACTED         PIC  9(09) VALUE  0.        00430000
004400     05  PV-RECORDS-WRITTEN           PIC  9(09) VALUE  0.        00440000
004500     05  PV-SQLCODE                   PIC  S9(04).                00450000
005800                                                                  00580000
005900 01  PV-ABEND-FIELDS.                                             00590000
006000     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00600000
006100                                                 COMP SYNC.       00610000
006200     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PCKUP021'.00620000
006300     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00630000
006400     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00640000
006500     05  PV-DB2-TABLE-NAME            PIC  X(20) VALUE SPACES.    00650000
006600     05  PV-ABEND-SQL-CDE             PIC  X(4).                  00660000
006700     05  PV-ABEND-PULL-NBR            PIC  X(7).                  00670000
006800     05  PV-ABEND-PULL-LNE-NBR        PIC  X(7).                  00680000
006900     05  PV-ABEND-OPER-UNT-ID         PIC  X(4).                  00690000
007000                                                                  00700000
007100***********************************************************       00710000
007200*  COPYBOOK USED FOR THE RCVR-LNE-DTL-FILE  OUTPUT FILE   *       00720000
007300***********************************************************       00730000
007400     COPY PCWS261.                                                00740000
007500                                                                  00750000
007600***********************************************************       00760000
007700*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00770000
007800***********************************************************       00780000
007900     COPY DPWS004.                                                00790000
008000                                                                  00800000
008100***********************************************************       00810000
008200*  DB2 SQL COMMUNICATION AREA                             *       00820000
008300***********************************************************       00830000
008400     EXEC SQL                                                     00840000
008500          INCLUDE SQLCA                                           00850000
008600     END-EXEC.                                                    00860000
008700                                                                  00870000
008800***********************************************************       00880000
008900*  PCT_RCVR_LNE_DTL TABLE                                 *       00890000
009000***********************************************************       00900000
009100     EXEC SQL                                                     00910000
009200          INCLUDE PCT00007                                        00920000
009300     END-EXEC.                                                    00930000
009400                                                                  00940000
009598*---------------------------------------------------------------* 00959803
009600*  CURSOR TO EXTRACT RCVR-LNE-DTL RECORDS                       * 00960003
009700*---------------------------------------------------------------* 00970000
009800     EXEC SQL                                                     00980000
009900          DECLARE RCVR_LNE_DTL_CSR CURSOR FOR                     00990000
010092           SELECT  PO_NBR                                         01009200
010100                  ,RCVR_SEQ_NBR                                   01010000
010110                  ,PO_LNE_NBR                                     01011000
010120                  ,ACTN_CDE                                       01012000
010130                  ,WRKD_UNT_TMST                                  01013000
010140                  ,BUS_DTE                                        01014000
010150                  ,OPER_UNT_ID                                    01015000
010200                  ,SHFT_NBR                                       01020000
010300                  ,UNT_QTY                                        01030000
010400                  ,CART_QTY                                       01040000
010500                  ,PRCG_AREA_CDE                                  01050000
010600                  ,EXTD_RTL_AMT                                   01060000
010800           FROM PCT_RCVR_LNE_DTL                                  01080000
010900           WHERE RCVR_SEQ_NBR = 0                                 01090000
011000             AND ACTN_CDE = 'V'                                   01100000
011100             AND PRCG_AREA_CDE = 'REPLEN'                         01110000
011300     END-EXEC                                                     01130000
011400***************************************************************** 01140000
011500 PROCEDURE DIVISION.                                              01150000
011600***************************************************************** 01160000
011700     DISPLAY '**** BEGINNING PCKUP021 ****'.                      01170000
011800     DISPLAY '****************************************'.          01180000
011900     DISPLAY ' '.                                                 01190000
012000     PERFORM 0100-INITIALIZATION.                                 01200000
012100                                                                  01210000
012110                                                                  01211003
012120     PERFORM 1000-PROCESS-RCVR-LNE-DTL.                           01212003
012140                                                                  01214003
012150* CLOSE OUTPUT FILE                                               01215003
012160                                                                  01216003
012170     CLOSE RCVR-LNE-DTL-FILE.                                     01217004
012190                                                                  01219003
012191     DISPLAY 'NO. OF RCVR REC EXTRACTED==>' PV-RECORDS-EXTRACTED. 01219103
012192     DISPLAY 'NO. OF RCVR REC WRITTEN==>'   PV-RECORDS-WRITTEN.   01219203
012195     DISPLAY ' '.                                                 01219503
012196     DISPLAY '****************************************'.          01219603
012197                                                                  01219703
012198     DISPLAY '****  END OF PCKUP021  ****'.                       01219804
012199                                                                  01219903
012200     STOP RUN.                                                    01220003
012201                                                                  01220103
015000******************************************************************01500000
015100 0100-INITIALIZATION.                                             01510000
015200******************************************************************01520000
015300     MOVE '0100-INITIALIZATION        ' TO PV-ABEND-PARAGRAPH.    01530000
015400                                                                  01540000
015500     OPEN OUTPUT RCVR-LNE-DTL-FILE.                               01550004
015610                                                                  01561003
015620******************************************************************01562003
015630 1000-PROCESS-RCVR-LNE-DTL.                                       01563003
015640******************************************************************01564003
015650                                                                  01565003
015660* OPEN RCVR_LNE_DTL_CSR                                           01566003
015670     PERFORM 0200-OPEN-RCVR-LNE-DTL-CSR.                          01567003
015680                                                                  01568003
015690* FETCH RCVR_LNE_DTL_CSR UNTILL END OF TABLE                      01569003
015691                                                                  01569103
015692     SET PS-NOT-END-OF-RCVR-LNE-DTL-CSR TO TRUE.                  01569203
015693     PERFORM 0300-FETCH-RCVR-LNE-DTL-CSR                          01569303
015694           UNTIL PS-END-OF-RCVR-LNE-DTL-CSR.                      01569403
015695                                                                  01569503
015696* CLOSE RCVR_LNE_DTL_CSR                                          01569603
015697                                                                  01569703
015698     PERFORM 0500-CLOSE-RCVR-LNE-DTL-CSR.                         01569803
015699                                                                  01569903
015720******************************************************************01572000
015800 0200-OPEN-RCVR-LNE-DTL-CSR.                                      01580000
015900******************************************************************01590000
016000                                                                  01600000
016100         EXEC SQL                                                 01610000
016200              OPEN RCVR_LNE_DTL_CSR                               01620000
016300         END-EXEC                                                 01630000
016400                                                                  01640000
016500                                                                  01650000
016600         EVALUATE TRUE                                            01660000
016700             WHEN SQLCODE = ZERO                                  01670000
016800                 CONTINUE                                         01680000
016900             WHEN SQLWARN0 NOT = SPACES                           01690000
017000             WHEN SQLCODE < ZERO                                  01700000
017100             WHEN SQLCODE > ZERO                                  01710000
017200                 MOVE '0200-OPEN-RCVR-LNE-DTL-CSR'                01720000
017300                                          TO PV-ABEND-PARAGRAPH   01730000
017400                 MOVE 'OPEN'              TO PV-ABEND-OPERATION   01740000
017500                 MOVE SQLCODE             TO PV-SQLCODE           01750000
017600                 MOVE 'PCT_RCVR_LNE_DTL'  TO PV-DB2-TABLE-NAME    01760000
017700                 PERFORM 9900-DB2-ABEND                           01770000
017800         END-EVALUATE.                                            01780000
017900                                                                  01790000
018000******************************************************************01800000
018100 0300-FETCH-RCVR-LNE-DTL-CSR.                                     01810000
018200******************************************************************01820000
018300                                                                  01830000
018400     INITIALIZE DCLPCT00007.                                      01840000
018900                                                                  01890000
019000     EXEC SQL                                                     01900000
019100        FETCH RCVR_LNE_DTL_CSR                                    01910000
019200        INTO   :PCT00007-PO-NBR                                   01920000
019300              ,:PCT00007-RCVR-SEQ-NBR                             01930000
019400              ,:PCT00007-PO-LNE-NBR                               01940000
019500              ,:PCT00007-ACTN-CDE                                 01950000
019600              ,:PCT00007-WRKD-UNT-TMST                            01960000
019700              ,:PCT00007-BUS-DTE                                  01970000
019800              ,:PCT00007-OPER-UNT-ID                              01980000
019900              ,:PCT00007-SHFT-NBR                                 01990000
020000              ,:PCT00007-UNT-QTY                                  02000000
020001              ,:PCT00007-CART-QTY                                 02000100
020002              ,:PCT00007-PRCG-AREA-CDE                            02000200
020003              ,:PCT00007-EXTD-RTL-AMT                             02000300
020010     END-EXEC.                                                    02001000
020100                                                                  02010000
020200     EVALUATE TRUE                                                02020000
020300       WHEN SQLCODE = ZEROS                                       02030000
020400            ADD 1 TO PV-RECORDS-EXTRACTED                         02040000
020500       WHEN SQLCODE = +100                                        02050000
020600                SET PS-END-OF-RCVR-LNE-DTL-CSR TO TRUE            02060000
020700       WHEN OTHER                                                 02070000
020800             MOVE '0300-FETCH-RCVR-LNE-DTL-CSR'                   02080000
020900                                          TO PV-ABEND-PARAGRAPH   02090000
021000             MOVE 'FETCH'                 TO PV-ABEND-OPERATION   02100000
021100             MOVE SQLCODE                 TO PV-SQLCODE           02110000
021200             MOVE 'PCT_RCVR_LNE_DTL'      TO PV-DB2-TABLE-NAME    02120000
021300             MOVE PCT00007-PO-NBR         TO PV-ABEND-PULL-NBR    02130000
021400             MOVE PCT00007-PO-LNE-NBR     TO PV-ABEND-PULL-LNE-NBR02140000
021500             MOVE PCT00007-OPER-UNT-ID    TO PV-ABEND-OPER-UNT-ID 02150000
021600             PERFORM 9900-DB2-ABEND                               02160000
021700     END-EVALUATE.                                                02170000
021800                                                                  02180000
021900     IF PS-NOT-END-OF-RCVR-LNE-DTL-CSR                            02190000
022000        PERFORM 0400-WRITE-RCVR-LNE-DTL-FILE                      02200000
022100     END-IF.                                                      02210000
022200                                                                  02220000
022300******************************************************************02230000
022400 0400-WRITE-RCVR-LNE-DTL-FILE.                                    02240000
022500******************************************************************02250000
022600                                                                  02260000
022610     INITIALIZE PC261-RCVR-LNE-RECORD.                            02261000
022620                                                                  02262000
022640     MOVE PCT00007-PO-NBR               TO PC261-PO-NBR.          02264000
022650     MOVE PCT00007-RCVR-SEQ-NBR         TO PC261-RCVR-SEQ-NBR.    02265000
022660     MOVE PCT00007-PO-LNE-NBR           TO PC261-PO-LNE-NBR.      02266000
022670     MOVE PCT00007-ACTN-CDE             TO PC261-ACTN-CDE.        02267000
022680     MOVE PCT00007-WRKD-UNT-TMST        TO PC261-WRKD-UNT-TMST.   02268000
022690     MOVE PCT00007-BUS-DTE              TO PC261-BUS-DTE.         02269000
022691     MOVE PCT00007-OPER-UNT-ID          TO PC261-OPER-UNT-ID.     02269100
022692     MOVE PCT00007-SHFT-NBR             TO PC261-SHFT-NBR.        02269200
022693     MOVE PCT00007-UNT-QTY              TO PC261-UNT-QTY.         02269300
022694     MOVE PCT00007-CART-QTY             TO PC261-CART-QTY.        02269400
022695     MOVE PCT00007-PRCG-AREA-CDE        TO PC261-PRCG-AREA-CDE.   02269500
022696     MOVE PCT00007-EXTD-RTL-AMT         TO PC261-EXTD-RTL-AMT.    02269600
022697                                                                  02269700
022698     WRITE RCVR-LNE-DTL-RECORD FROM PC261-RCVR-LNE-RECORD.        02269800
022699                                                                  02269900
022700     ADD 1 TO PV-RECORDS-WRITTEN.                                 02270000
022701                                                                  02270100
025100******************************************************************02510000
025200 0500-CLOSE-RCVR-LNE-DTL-CSR.                                     02520000
025300******************************************************************02530000
025400                                                                  02540000
025500         EXEC SQL                                                 02550000
025600             CLOSE RCVR_LNE_DTL_CSR                               02560000
025700         END-EXEC                                                 02570000
025800                                                                  02580000
025900         EVALUATE TRUE                                            02590000
026000             WHEN SQLCODE = ZERO                                  02600000
026100                 CONTINUE                                         02610000
026200             WHEN SQLWARN0 NOT = SPACES                           02620000
026300             WHEN SQLCODE < ZERO                                  02630000
026400             WHEN SQLCODE > ZERO                                  02640000
026500             MOVE '0500-CLOSE-RCVR-LNE-DTL-CSR'                   02650000
026600                                          TO PV-ABEND-PARAGRAPH   02660000
026700             MOVE 'CLOSE'                 TO PV-ABEND-OPERATION   02670000
026800             MOVE SQLCODE                 TO PV-SQLCODE           02680000
026900             MOVE 'PCT_RCVR_LNE_DTL'      TO PV-DB2-TABLE-NAME    02690000
027000             PERFORM 9900-DB2-ABEND                               02700000
027100         END-EVALUATE.                                            02710000
027200                                                                  02720000
027390******************************************************************02739000
027400 9900-DB2-ABEND.                                                  02740000
027500******************************************************************02750000
027600*    MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    02760000
027700                                                                  02770000
027800     DISPLAY '*** DB2 ERROR '.                                    02780000
027900     DISPLAY '*** SQLCODE       = ' PV-SQLCODE.                   02790000
028000     DISPLAY '*** OPERATION     = ' PV-ABEND-OPERATION.           02800000
028100     DISPLAY '*** PROGRAM       = ' PV-ABEND-PROGRAM.             02810000
028200     DISPLAY '*** PARAGRAPH     = ' PV-ABEND-PARAGRAPH.           02820000
028300     DISPLAY '*** TABLE NAME    = ' PV-DB2-TABLE-NAME.            02830000
028400     DISPLAY '*** PULL NUMBER   = ' PV-ABEND-PULL-NBR.            02840000
028500     DISPLAY '*** PULL LINE NUM = ' PV-ABEND-PULL-LNE-NBR.        02850000
028600     DISPLAY '*** OPER UNIT ID  = ' PV-ABEND-OPER-UNT-ID.         02860000
028700                                                                  02870000
028800     COPY DPPD004.                                                02880000
028900                                                                  02890000
029000     MOVE +4013 TO PV-ABEND-CODE.                                 02900000
029100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02910000
