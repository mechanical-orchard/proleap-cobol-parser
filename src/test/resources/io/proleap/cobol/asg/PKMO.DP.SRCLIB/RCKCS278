000100*-----------------------*                                         00010057
000200 IDENTIFICATION DIVISION.                                         00020057
000300*-----------------------*                                         00030057
000400 PROGRAM-ID.    RCKCS278.                                         00040057
000500 AUTHOR.        MARY SARDINA - KOHLS                              00050057
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060057
000700 DATE-WRITTEN.  02/96.                                            00070057
000800 DATE-COMPILED.                                                   00080057
000900                                                                  00090057
001000*---------------------------------------------------------------* 00100057
001100*    E278 - VERIFIED COUNT ADJ BY LINE                          * 00110057
001200*                                                               * 00120057
001300* RCKCS278 - THIS PROGRAM WILL BE USED FOR A SCREEN WHICH WILL  * 00130057
001400*            LIST LINES FOR A RECEIVER ASSOCIATED TO THE        * 00140057
001500*            ADJUSTMENT OF A VERIFIED POSTED RECEIVER.          * 00150057
001600*                                                               * 00160057
001900*---------------------------------------------------------------* 00190057
002000* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00200068
002010* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00201069
002020* MAKING THE CALL DYNAMIC VS STATIC.                              00202069
002030*---------------------------------------------------------------* 00203069
002100 ENVIRONMENT DIVISION.                                            00210057
002300 DATA DIVISION.                                                   00230057
002400                                                                  00240057
002500 WORKING-STORAGE SECTION.                                         00250057
002600                                                                  00260057
002700 01  PC-PROGRAM-CONSTANTS.                                        00270057
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00280057
002900                                                    'RC278A  '.   00290057
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00300057
003100                                                    'RCKM278 '.   00310057
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00320057
003300                                                    'RCKCS278'.   00330057
003310     05  PC-LOCATION-MODULE             PIC  X(08)  VALUE         00331069
003320                                                    'XLKUT071'.   00332064
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340064
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350057
003600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00360057
003700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00370057
003800                                                    COMP SYNC.    00380057
003900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00390057
004000                                                    COMP SYNC.    00400057
004100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00410057
004200                                                    +1000000      00420057
004300                                                    COMP-3.       00430057
004400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00440057
004500                                                    COMP SYNC.    00450057
004600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00460057
004700                                                    COMP-3.       00470057
004800     05  PC-ZERO                        PIC S9(09)  VALUE ZERO    00480057
004900                                                    COMP.         00490057
005000*----------------------------------------------------------------*00500057
005100* INCLUDED NEW CONSTANTS PC-000 AND PC-999.          WR # 21361  *00510063
005200*----------------------------------------------------------------*00520057
005300     05  PC-000                         PIC X(03)   VALUE '000'.  00530057
005400     05  PC-999                         PIC X(03)   VALUE '999'.  00540057
005500*----------------------------------------------------------------*00550057
005600* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *00560063
005700*----------------------------------------------------------------*00570057
005800     05  PC-9999                        PIC S9(04)  VALUE 9999    00580057
005900                                                    COMP.         00590057
006000     05  PV-CURRENT-TIMESTAMP           PIC X(26)   VALUE         00600057
006100                                                       SPACES.    00610057
006200     05  PV-RECEIV-CURRENT-TIMESTAMP    PIC X(26)   VALUE         00620057
006300                                                       SPACES.    00630057
006400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00640057
006500     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00650057
006600     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00660057
006700     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00670057
006800     05  PC-R                           PIC  X(01)  VALUE 'R'.    00680057
006900     05  PC-M                           PIC  X(01)  VALUE 'M'.    00690057
007000     05  PC-N                           PIC  X(01)  VALUE 'N'.    00700057
007100     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    00710057
007200     05  PC-A                           PIC  X(01)  VALUE 'A'.    00720057
007300     05  PC-I                           PIC  X(01)  VALUE 'I'.    00730057
007400     05  PC-U                           PIC  X(01)  VALUE 'U'.    00740057
007500     05  PC-AP                          PIC  X(02)  VALUE 'AP'.   00750057
007600     05  PC-AC                          PIC  X(02)  VALUE 'AC'.   00760057
007700     05  PC-CM                          PIC  X(02)  VALUE 'CM'.   00770057
007800     05  PC-CB                          PIC  X(02)  VALUE 'CB'.   00780057
007900     05  PC-CA                          PIC  X(02)  VALUE 'CA'.   00790057
008000     05  PC-DC                          PIC  X(02)  VALUE 'DC'.   00800057
008100     05  PC-IP                          PIC  X(02)  VALUE 'IP'.   00810057
008200     05  PC-VE                          PIC  X(02)  VALUE 'VE'.   00820057
008300     05  PC-COMPANY                     PIC  X(02)  VALUE '03'.   00830057
008400                                                                  00840057
008500     05  PC-TSYMSG-NUMBERS.                                       00850057
008600         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00860057
008700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00870057
008800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00880057
008900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00890057
009000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00900057
009100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00910057
009200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00920057
009300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00930057
009400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00940057
009500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00950057
009600         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00960057
009700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00970057
009800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00980057
009900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00990057
010000         10  PC-TSYMSG-00223            PIC  9(05)  VALUE 00223.  01000057
010100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01010057
010200         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01020057
010300         10  PC-TSYMSG-01061            PIC  9(05)  VALUE 01061.  01030057
010400         10  PC-TSYMSG-01127            PIC  9(05)  VALUE 01127.  01040057
010500         10  PC-TSYMSG-01128            PIC  9(05)  VALUE 01128.  01050057
010600         10  PC-TSYMSG-01129            PIC  9(05)  VALUE 01129.  01060057
010700         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01070057
010800*                                                                 01080057
010900 01  PS-PROGRAM-SWITCHES.                                         01090057
011000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01100057
011100         88  PS-NO-ERROR                            VALUE 'Y'.    01110057
011200         88  PS-ERROR                               VALUE 'N'.    01120057
011300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01130057
011400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01140057
011500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01150057
011600     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01160057
011700         88  PS-DONE                                VALUE 'Y'.    01170057
011800         88  PS-NOT-DONE                            VALUE 'N'.    01180057
011900     05  PS-STORE-REC-SW                PIC  X(01)  VALUE 'N'.    01190057
012000         88  PS-STORE-REC                           VALUE 'Y'.    01200057
012100         88  PS-NO-STORE-REC                        VALUE 'N'.    01210057
012200     05  PS-DATA-OK-SW                  PIC  X(01)  VALUE 'N'.    01220057
012300         88  PS-DATA-OK                             VALUE 'Y'.    01230057
012400         88  PS-DATA-NOT-OK                         VALUE 'N'.    01240057
012500     05  PS-TROUBLE-SW                  PIC  X(01)  VALUE 'N'.    01250057
012600         88  PS-IN-TROUBLE                          VALUE 'Y'.    01260057
012700         88  PS-NOT-IN-TROUBLE                      VALUE 'N'.    01270057
012800     05  PS-RECDIS-CSR-SW               PIC  X(01)  VALUE 'N'.    01280057
012900         88  PS-RECDIS-END-OF-CSR                   VALUE 'Y'.    01290057
013000         88  PS-RECDIS-NOT-END-OF-CSR               VALUE 'N'.    01300057
013100     05  PS-UPDATE-SW                 PIC  X    VALUE 'N'.        01310057
013200         88  PS-NO-UPDATES-DONE                 VALUE 'N'.        01320057
013300         88  PS-UPDATES-DONE                    VALUE 'Y'.        01330057
013400     05  PS-NEXT-SCREEN-SW            PIC  X    VALUE 'N'.        01340057
013500         88  PS-NO-NEXT-SCREEN                  VALUE 'N'.        01350057
013600         88  PS-NEXT-SCREEN                     VALUE 'Y'.        01360057
013700*----------------------------------------------------------------*01370057
013800*  INCLUDED PROGRAM SWITCHES FOR XLKUT001       **   WR # 21361  *01380063
013900*----------------------------------------------------------------*01390057
014000     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        01400057
014100         88  PS-CALL-API-NO                     VALUE 'N'.        01410057
014200         88  PS-CALL-API-YES                    VALUE 'Y'.        01420057
014300*----------------------------------------------------------------*01430057
014400* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *01440063
014500*----------------------------------------------------------------*01450057
014600*                                                                 01460057
014700 01  PV-PROGRAM-VARIABLES.                                        01470057
014800     05  PV-SUB                         PIC S9(04)  VALUE +0      01480057
014900                                                    COMP SYNC.    01490057
015000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01500057
015100                                                    COMP SYNC.    01510057
015200     05  PV-NULL-IND                    PIC S9(04)  VALUE +0      01520057
015300                                                    COMP SYNC.    01530057
015400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01540057
015500                                                    COMP-3.       01550057
015600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01560057
015700                                                    COMP-3.       01570057
015800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01580057
015900                                                    COMP-3.       01590057
016000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01600057
016100                                                    COMP-3.       01610057
016200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01620057
016300                                                    COMP-3.       01630057
016400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01640057
016500                                                    COMP-3.       01650057
016600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01660057
016700                                                    COMP-3.       01670057
016800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01680057
016900                                                    COMP SYNC.    01690057
017000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01700057
017100                                                    COMP SYNC.    01710057
017200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01720057
017300                                                    COMP SYNC.    01730057
017400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01740057
017500                                                    COMP SYNC.    01750057
017600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01760057
017700                                                    COMP SYNC.    01770057
017800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01780057
017900                                                    COMP SYNC.    01790057
018000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01800057
018100                                                    COMP SYNC.    01810057
018200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01820057
018300                                                    COMP SYNC.    01830057
018400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01840057
018500                                                    COMP SYNC.    01850057
018600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01860057
018700                                                    COMP SYNC.    01870057
018800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01880057
018900                                                    COMP SYNC.    01890057
019000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01900057
019100                                                    COMP SYNC.    01910057
019200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01920057
019300                                                    COMP SYNC.    01930057
019400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01940057
019500                                                    COMP SYNC.    01950057
019600     05  PV-NBR-FALLOUTS                PIC S9(05)  VALUE ZERO    01960057
019700                                                    COMP-3.       01970057
019800     05  PV-NBR-TO-CORRECT              PIC S9(05)  VALUE ZERO    01980057
019900                                                    COMP-3.       01990057
020000     05  PV-HOLD-AREA-NBR               PIC S9(08)  VALUE ZERO    02000057
020100                                                    COMP SYNC.    02010057
020200     05  PV-START-ITEM-REQUEST          PIC  X(05).               02020057
020300     05  PV-DB2-COUNT                   PIC S9(9)   VALUE +0      02030057
020400                                                    COMP-3.       02040057
020500     05  PV-DB2-TROUBLE-COUNT           PIC S9(9)   VALUE +0      02050057
020600                                                    COMP-3.       02060057
020700     05  PV-WORK-STORE-X.                                         02070057
020800         10  PV-WORK-STORE              PIC  9(03).               02080057
020900*----------------------------------------------------------------*02090057
021000* CHANGED THE STRUCTURE OF PV-DISPLAY-SKU. ** WR # 21361.        *02100063
021200*----------------------------------------------------------------*02120057
021900     05  PV-DS-DEPT-NBR                 PIC  X(03).               02190057
022000     05  PV-DISPLAY-SKU.                                          02200057
022100         10  PV-DS-CL-NBR               PIC  X(02).               02210057
022200         10  FILLER                     PIC  X(01)  VALUE SPACE.  02220057
022300         10  PV-SKU-NBR                 PIC  X(08).               02230063
022500*----------------------------------------------------------------*02250057
022600*   CHANGES MADE FOR WR # 21361 ENDS HERE.                        02260063
022700*----------------------------------------------------------------*02270057
022800     05  PV-STATUS-CDE                  PIC  X(02).               02280057
022900     05  PV-AUDIT-STATUS-CDE            PIC  X(02).               02290057
023000     05  PV-COUNT-STATUS-CDE            PIC  X(02).               02300057
023100     05  PV-RCPT-DISTR-UPD-CDE          PIC  X(01).               02310057
023200     05  PV-RECEIV-VRFY-INFO.                                     02320057
023300         10  PV-LEFT-PAREN              PIC X(01).                02330057
023400         10  PV-VRFY-DATE               PIC X(10).                02340057
023500         10  FILLER                     PIC X(01).                02350057
023600         10  PV-VRFY-TIME               PIC X(05).                02360057
023700         10  PV-SEPARATOR               PIC X(03).                02370057
023800         10  PV-VRFY-USERID             PIC X(07).                02380057
023900         10  PV-RIGHT-PAREN             PIC X(01).                02390057
024000     05  PV-WORK-TIMESTAMP.                                       02400057
024100         10  PV-WORK-YEAR               PIC X(04).                02410057
024200         10  FILLER                     PIC X(01).                02420057
024300         10  PV-WORK-MONTH              PIC X(02).                02430057
024400         10  FILLER                     PIC X(01).                02440057
024500         10  PV-WORK-DAY                PIC X(02).                02450057
024600         10  FILLER                     PIC X(01).                02460057
024700         10  PV-WORK-HH                 PIC X(02).                02470057
024800         10  FILLER                     PIC X(01).                02480057
024900         10  PV-WORK-MM                 PIC X(02).                02490057
025000         10  FILLER                     PIC X(10).                02500057
025100     05  PV-DISPLAY-DATE.                                         02510057
025200         10  PV-DISPLAY-MONTH           PIC X(02).                02520057
025300         10  PV-SLASH-1                 PIC X(01).                02530057
025400         10  PV-DISPLAY-DAY             PIC X(02).                02540057
025500         10  PV-SLASH-2                 PIC X(01).                02550057
025600         10  PV-DISPLAY-YEAR            PIC X(04).                02560057
025700     05  PV-DISPLAY-TIME.                                         02570057
025800         10  PV-DISPLAY-HH              PIC X(02).                02580057
025900         10  PV-COLON-1                 PIC X(01).                02590057
026000         10  PV-DISPLAY-MM              PIC X(02).                02600057
026100*----------------------------------------------------------------*02610057
026200*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *02620057
026300*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *02630057
026400*   APPLICATION-SPECIFIC COMMAREA.                               *02640057
026500*----------------------------------------------------------------*02650057
026600*----------------------------------------------------------------*02660057
026700*                                                **   WR # 21361 *02670063
026800* CHANGE THE STRUCTURE OF LQW TO MATCH WITH ASC STRUCTURE        *02680057
026900*----------------------------------------------------------------*02690057
027000 01  LQW-LIST-QUEUE-WORK-AREA.                                    02700057
027100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02710057
027200     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02720057
027300                                        INDEXED BY LQW-IDX.       02730057
027400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02740057
027500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02750057
027600         10  LQW-SELECTED-SW            PIC  X(01).               02760057
027700             88  LQW-SELECT                         VALUE 'S'.    02770057
027800             88  LQW-DESELECT                       VALUE ' '.    02780057
027900         10  LQW-ACTION                 PIC  X(03).               02790057
028000             88  LQW-UPDATE                         VALUE 'UPD'.  02800057
028100             88  LQW-ERROR                          VALUE 'ERR'.  02810057
028200         10  LQW-PO-LNE-NBR             PIC S9(09)  COMP.         02820057
028400         10  LQW-SKU                    PIC  X(11).               02840057
028500         10  LQW-VFY-QTY                PIC S9(09)  COMP.         02850057
028600         10  LQW-EXP-QTY                PIC S9(09)  COMP.         02860057
028700         10  LQW-ACTUAL-QTY             PIC S9(09)  COMP.         02870057
028800         10  LQW-LINE-TRBL-SW           PIC  X(01).               02880057
028900         10  LQW-DISTR-UPD-SW           PIC  X(01).               02890057
029000*----------------------------------------------------------------*02900057
029100*   CHANGES MADE FOR WR # 21361 ENDS HERE.                        02910063
029200*----------------------------------------------------------------*02920057
029300                                                                  02930064
029400*---------------------------------------------------------------* 02940057
029500*    RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.        * 02950057
029600*---------------------------------------------------------------* 02960057
029800     COPY RCWS013.                                                02980057
029900                                                                  02990057
029910*---------------------------------------------------------------* 02991064
029920*    RECORD LAYOUT FOR THE LOCATION MODULE                        02992064
029930*---------------------------------------------------------------* 02993064
029940     COPY XLWS071.                                                02994064
029950                                                                  02995064
030100*---------------------------------------------------------------* 03010057
030200*    MAP LAYOUT                                                 * 03020057
030300*---------------------------------------------------------------* 03030057
030500     COPY RCKM278.                                                03050057
030600*                                                                 03060057
030700*----------------------------------------------------------------*03070057
030800*                                                    WR # 21361  *03080063
030900* CHANGED THE FILLER OF MR-OCCURS-LAYOUT FROM X(188) TO X(196)   *03090057
031000* AS A NEW FIELD DEPT IS ADDED IN THE MAP RCKM278.               *03100057
031100*----------------------------------------------------------------*03110057
031200 01  MR-OCCURS-LAYOUT                   REDEFINES  RC278AO.       03120057
031400     05  FILLER                         PIC X(196).               03140057
031500     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          03150057
031600         10  MR-SELECTL                 PIC S9(04) COMP.          03160057
031700         10  MR-SELECTA                 PIC  X(01).               03170057
031800         10  MR-SELECTC                 PIC  X(01).               03180057
031900         10  MR-SELECTH                 PIC  X(01).               03190057
032000         10  MR-SELECTI                 PIC  X(01).               03200057
032100                                                                  03210057
032200         10  MR-ACTIONL                 PIC S9(04) COMP.          03220057
032300         10  MR-ACTIONA                 PIC  X(01).               03230057
032400         10  MR-ACTIONC                 PIC  X(01).               03240057
032500         10  MR-ACTIONH                 PIC  X(01).               03250057
032600         10  MR-ACTION                  PIC  X(03).               03260057
032700                                                                  03270057
032800         10  MR-PO-LNE-NBRL             PIC S9(04) COMP.          03280057
032900         10  MR-PO-LNE-NBRA             PIC  X(01).               03290057
033000         10  MR-PO-LNE-NBRC             PIC  X(01).               03300057
033100         10  MR-PO-LNE-NBRH             PIC  X(01).               03310057
033200         10  MR-PO-LNE-NBR-X.                                     03320057
033300             15  MR-PO-LNE-NBR          PIC ZZZZZZZ9.             03330057
033400                                                                  03340057
033500                                                                  03350057
033600         10  MR-SKUL                    PIC S9(04) COMP.          03360057
033700         10  MR-SKUA                    PIC  X(01).               03370057
033800         10  MR-SKUC                    PIC  X(01).               03380057
033900         10  MR-SKUH                    PIC  X(01).               03390057
034100         10  MR-SKU                     PIC  X(11).               03410057
034200                                                                  03420057
034300         10  MR-EXP-QTYL                PIC S9(04) COMP.          03430057
034400         10  MR-EXP-QTYA                PIC  X(01).               03440057
034500         10  MR-EXP-QTYC                PIC  X(01).               03450057
034600         10  MR-EXP-QTYH                PIC  X(01).               03460057
034700         10  MR-EXP-QTY-X.                                        03470057
034800             15  MR-EXP-QTY             PIC  ZZZZ9.               03480057
034900                                                                  03490057
035000         10  MR-ACT-QTYL                PIC S9(04) COMP.          03500057
035100         10  MR-ACT-QTYA                PIC  X(01).               03510057
035200         10  MR-ACT-QTYC                PIC  X(01).               03520057
035300         10  MR-ACT-QTYH                PIC  X(01).               03530057
035400         10  MR-ACT-QTY-X.                                        03540057
035500             15  MR-ACT-QTY             PIC  ZZZZ9.               03550057
035600                                                                  03560057
035700         10  MR-VFY-QTYL                PIC S9(04) COMP.          03570057
035800         10  MR-VFY-QTYA                PIC  X(01).               03580057
035900         10  MR-VFY-QTYC                PIC  X(01).               03590057
036000         10  MR-VFY-QTYH                PIC  X(01).               03600057
036100         10  MR-VFY-QTY-X.                                        03610057
036200             15  MR-VFY-QTY             PIC  ZZZZ9.               03620057
036300     05  FILLER                         PIC X(12).                03630057
036400*----------------------------------------------------------------*03640057
036500* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *03650063
036600*----------------------------------------------------------------*03660057
036700/                                                                 03670057
036800*----------------------------------------------------------------*03680057
036900**  SECURITY SUBROUTINE PARAMETERS                                03690057
037000*----------------------------------------------------------------*03700057
037100                                                                  03710057
037200     COPY DPWS008.                                                03720057
037300                                                                  03730057
037400*---------------------------------------------------------------* 03740057
037500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03750057
037600*---------------------------------------------------------------* 03760057
037700                                                                  03770057
037800     COPY DPWS015.                                                03780057
037900                                                                  03790057
038000*---------------------------------------------------------------* 03800057
038100*    FUNCTION KEYS COPYBOOK.                                    * 03810057
038200*---------------------------------------------------------------* 03820057
038300                                                                  03830057
038400     COPY DPWS016.                                                03840057
038500                                                                  03850057
038600*---------------------------------------------------------------* 03860057
038700*    NUMERIC EDIT LAYOUT.                                       * 03870057
038800*---------------------------------------------------------------* 03880057
038900                                                                  03890057
039000     COPY DPWS010I.                                               03900057
039100/                                                                 03910057
039200******************************************************************03920069
039300** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **03930069
039310** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **03931069
039400******************************************************************03940069
039500                                                                  03950057
039600     COPY DPWS030.                                                03960057
039610     COPY DPWS930.                                                03961069
039700/                                                                 03970057
039800*---------------------------------------------------------------* 03980057
039900*    STANDARD COMMAREA.                                         * 03990057
040000*---------------------------------------------------------------* 04000057
040100                                                                  04010057
040200     COPY DPWS020.                                                04020057
040300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04030057
040400                                                                  04040057
040500         10  INTER-APPL-COMM-AREA       PIC X(200).               04050062
040600     COPY RCWS017.                                                04060057
040700     COPY RCWS012.                                                04070057
040800*---------------------------------------------------------------* 04080057
040900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04090057
041000*---------------------------------------------------------------* 04100057
041100         10  ASC-SPECIFIC-COMMAREA.                               04110057
041200             15  ASC-LIST-KEYS.                                   04120057
041300                 20  ASC-OPER-UNT-ID                 PIC S9(04)   04130057
041400                                                     COMP.        04140057
041500                 20  ASC-FCLTY-ID                    PIC S9(04)   04150057
041600                                                     COMP.        04160057
041700                 20  ASC-PO-NBR                      PIC S9(09)   04170057
041800                                                     COMP.        04180057
041900                 20  ASC-REC-SEQ-NBR                 PIC S9(09)   04190057
042000                                                     COMP.        04200057
042100                 20  ASC-PO-LNE-NBR-LOW              PIC S9(09)   04210057
042200                                                     COMP.        04220057
042300                 20  ASC-PO-LNE-NBR-HIGH             PIC S9(09)   04230057
042400                                                     COMP.        04240057
042500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04250057
042600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04260057
042700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04270057
042800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04280057
042900                                                                  04290057
043000                 20  ASC-ITEM-ARRAY.                              04300057
043100                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        04310057
043200                         30  ASC-LIST-ITEM-NUMBER                 04320057
043300                                                     PIC S9(09)   04330057
043400                                                     COMP-3.      04340057
043500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04350057
043600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04360057
043700                             88  ASC-TEMP-SELECT     VALUE 'S'.   04370057
043800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04380057
043900                             88  ASC-TEMP-END        VALUE 'E'.   04390057
044000                         30  ASC-SELECTED-SW         PIC  X(01).  04400057
044100                             88  ASC-NO-SELECT       VALUE ' '.   04410057
044200                             88  ASC-SELECT          VALUE 'S'.   04420057
044300                             88  ASC-BEGIN           VALUE 'B'.   04430057
044400                             88  ASC-END             VALUE 'E'.   04440057
044500                         30  ASC-ACTION              PIC  X(03).  04450057
044600                         30  ASC-PO-LNE-NBR          PIC S9(09)   04460057
044700                                                          COMP.   04470057
044800*----------------------------------------------------------------*04480057
044900*                                             WR # 21361         *04490063
045000* CHANGED THE STRUCTURE OF ASC TO MATCH THE APPL COMMAREA.       *04500057
045100* ASC-SKU FIELD IS INCREASED FROM X(10) TO X(11).                *04510057
045200*----------------------------------------------------------------*04520057
045400                         30  ASC-SKU                 PIC  X(11).  04540057
045500*----------------------------------------------------------------*04550057
045600* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *04560063
045700*----------------------------------------------------------------*04570057
045800                         30  ASC-VFY-QTY             PIC S9(09)   04580057
045900                                                          COMP.   04590057
046000                         30  ASC-EXP-QTY             PIC S9(09)   04600057
046100                                                          COMP.   04610057
046200                         30  ASC-ACTUAL-QTY          PIC S9(09)   04620057
046300                                                          COMP.   04630057
046400                         30  ASC-LINE-TRBL-SW        PIC  X(01).  04640057
046500                         30  ASC-DISTR-UPD-SW        PIC  X(01).  04650057
046600                                                                  04660057
046700             15  ASC-BLK-SUB                         PIC S9(04)   04670057
046800                                                          COMP    04680057
046900                                                          SYNC.   04690057
047000             15  ASC-ITEM-SUB                        PIC S9(04)   04700057
047100                                                          COMP    04710057
047200                                                          SYNC.   04720057
047300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04730057
047400                                                          COMP-3. 04740057
047500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04750057
047600                                                          COMP-3. 04760057
047700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04770057
047800                                                          COMP-3. 04780057
047900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04790057
048000                                                          COMP-3. 04800057
048100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04810057
048200                                                          COMP-3. 04820057
048300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04830057
048400                                                          COMP    04840057
048500                                                          SYNC.   04850057
048600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04860057
048700                                                          COMP-3. 04870057
048800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04880057
048900                                                          COMP-3. 04890057
049000                                                                  04900057
049100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04910057
049200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04920057
049300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04930057
049400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04940057
049500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04950057
049600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04960057
049700             15  ASC-AREA-ASTERISK-SW                PIC  X(01).  04970057
049800                 88  ASC-AREA-ASTERISK               VALUE 'Y'.   04980057
049900             15  ASC-DISPLAY-COMPLETE-SW             PIC  X(01).  04990057
050000                 88  ASC-DISPLAY-COMPLETE            VALUE 'Y'.   05000057
050100             15  ASC-VERIFY-SW                       PIC  X(01).  05010057
050200                 88  ASC-CAN-VERIFY                  VALUE 'Y'.   05020057
050300                 88  ASC-CANT-VERIFY                 VALUE 'N'.   05030057
050400             15  ASC-UNVERIFY-SW                     PIC  X(01).  05040057
050500                 88  ASC-CAN-UNVERIFY                VALUE 'Y'.   05050057
050600                 88  ASC-CANT-UNVERIFY-FS            VALUE 'F'.   05060057
050700                 88  ASC-CANT-UNVERIFY-ST            VALUE 'S'.   05070057
050800                 88  ASC-CANT-UNVERIFY               VALUE 'N'.   05080057
050900                                                                  05090057
051000             15  ASC-FASHION-UPDATE                  PIC  X(01).  05100057
051100                 88  ASC-FASHION-UPDATED             VALUE 'Y'.   05110057
051200                 88  ASC-FASHION-NOT-UPDATED         VALUE 'N'.   05120057
051300                                                                  05130057
051400             15  ASC-STORE-TYPE-SW                   PIC  X(01).  05140057
051500                 88  ASC-NOT-DC-STORE-TYPE           VALUE 'N'.   05150057
051600                 88  ASC-DC-STORE-TYPE               VALUE 'D'.   05160057
051700             15  ASC-TROUBLE-SW                      PIC  X(01).  05170057
051800                 88  ASC-IN-TROUBLE                  VALUE 'Y'.   05180057
051900                 88  ASC-NOT-IN-TROUBLE              VALUE 'N'.   05190057
052000             15  ASC-CONFIRM-SWITCH        PIC X.                 05200057
052100                 88  ASC-CONFIRM           VALUE 'Y'.             05210057
052200                 88  ASC-NOT-CONFIRM       VALUE 'N'.             05220057
052300                                                                  05230057
052400             15  ASC-TRB-QUEUE-NAME-IN               PIC X(08).   05240057
052500             15  ASC-LIST-QUEUE-NAME.                             05250057
052600                 20  ASC-LIST-TERM-ID                PIC  X(04).  05260057
052700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05270057
052800                                                          COMP-3. 05280057
052900                 20  ASC-LIST-SEQ                    PIC  9(01).  05290057
053000             15  ASC-SEL-QUEUE-NAME.                              05300057
053100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05310057
053200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05320057
053300                                                          COMP-3. 05330057
053400                 20  ASC-SEL-SEQ                     PIC  9(01).  05340057
053500                                                                  05350057
053600             15  ASC-TOT-EXP-QTY                     PIC S9(09)   05360057
053700                                                          COMP-3. 05370057
053800             15  ASC-TOT-ACTUAL-QTY                  PIC S9(09)   05380057
053900                                                          COMP-3. 05390057
054000             15  ASC-TOT-VERFYD-QTY                  PIC S9(09)   05400057
054100                                                          COMP-3. 05410057
054200             15  ASC-DEPT-NBR                        PIC  X(03).  05420057
054300             15  ASC-RECEIV-STATUS-CDE               PIC  X(02).  05430057
054400                 88 ASC-RECEIV-STATUS-VERIFY         VALUE 'VE'.  05440057
054500             15  ASC-RECEIV-VRFY-INFO                PIC  X(28).  05450057
054600             15  ASC-FCLTY-NME                       PIC  X(25).  05460057
054700             15  ASC-CURSOR-SW                       PIC  X(01).  05470057
054800                 88  ASC-NO-CURSOR                   VALUE 'Z'.   05480057
054900                 88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.   05490057
055000                 88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.   05500057
055100                 88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.   05510057
055200             15  ASC-START-ITEM-REQUEST.                          05520057
055300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05530057
055400             15  ASC-PREPK-ID                        PIC S9(04)   05540057
055500                                                     COMP.        05550057
055600             15  ASC-HOLD-INTER-APPL                 PIC X(200).  05560057
055700/                                                                 05570057
055800*---------------------------------------------------------------* 05580057
055900*    HOLD TROUBLE COPYBOOK                                        05590057
056000*---------------------------------------------------------------* 05600057
056100     COPY TMWS003.                                                05610064
056200/                                                                 05620057
056300*---------------------------------------------------------------* 05630057
056400*    ABEND PROCESSING COPYBOOK.                                 * 05640057
056500*---------------------------------------------------------------* 05650057
056600                                                                  05660057
056700     COPY DPWS013.                                                05670057
056800                                                                  05680057
056900/                                                                 05690057
057000*----------------------------------------------------------------*05700057
057100*  COPYBOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 21361  *05710063
057200*----------------------------------------------------------------*05720057
057300     COPY XLWS001.                                                05730057
057400*----------------------------------------------------------------*05740057
057500* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *05750063
057600*----------------------------------------------------------------*05760057
057700*---------------------------------------------------------------* 05770057
057800*    DB2 AREA FOR PURCHASE ORDER HEADER TABLE                   * 05780057
057900*---------------------------------------------------------------* 05790057
058000     EXEC SQL                                                     05800057
058100          INCLUDE TPURCHS                                         05810057
058200     END-EXEC.                                                    05820057
058300/                                                                 05830057
058400*---------------------------------------------------------------* 05840057
058500*    DB2 AREA FOR PURCHASE ORDER ITEM TABLE                     * 05850057
058600*---------------------------------------------------------------* 05860057
058700     EXEC SQL                                                     05870057
058800          INCLUDE TPURITM                                         05880057
058900     END-EXEC.                                                    05890057
059000/                                                                 05900057
059100*---------------------------------------------------------------* 05910057
059200*    DB2 AREA FOR RECEIPT HEADER TABLE                          * 05920057
059300*---------------------------------------------------------------* 05930057
059400     EXEC SQL                                                     05940057
059500          INCLUDE TRECEIV                                         05950057
059600     END-EXEC.                                                    05960057
059700*---------------------------------------------------------------* 05970057
059800*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 05980057
059900*---------------------------------------------------------------* 05990057
060000     EXEC SQL                                                     06000057
060100          INCLUDE TRECITM                                         06010057
060200     END-EXEC.                                                    06020057
060300*---------------------------------------------------------------* 06030057
060400*    DB2 AREA FOR RECEIPT DISTRIBUTION TABLE                    * 06040057
060500*---------------------------------------------------------------* 06050057
060600     EXEC SQL                                                     06060057
060700          INCLUDE TRECDIS                                         06070057
060800     END-EXEC.                                                    06080057
061500*---------------------------------------------------------------* 06150057
061600*    DB2 AREA FOR TROUBLE NOTIFICATION TABLE                    * 06160057
061700*---------------------------------------------------------------* 06170057
061800     EXEC SQL                                                     06180057
061900          INCLUDE TTRBNTF                                         06190057
062000     END-EXEC.                                                    06200057
062100                                                                  06210057
062200*---------------------------------------------------------------* 06220057
062300*    DB2 AREA FOR TROUBLE REASON TABLE                          * 06230057
062400*---------------------------------------------------------------* 06240057
062500     EXEC SQL                                                     06250057
062600          INCLUDE TTRBRSN                                         06260057
062700     END-EXEC.                                                    06270057
062800                                                                  06280057
062900*---------------------------------------------------------------* 06290057
063000*    DB2 AREA FOR COMMUNICATIONS                                * 06300057
063100*---------------------------------------------------------------* 06310057
063200     EXEC SQL                                                     06320057
063300          INCLUDE SQLCA                                           06330057
063400     END-EXEC.                                                    06340057
063500                                                                  06350057
063600*---------------------------------------------------------------* 06360057
063700*    TRECITM CURSOR DECLARATION.                                * 06370057
063800*---------------------------------------------------------------* 06380057
063900*---------------------------------------------------------------* 06390057
064000*                                              ** WR # 21361    * 06400063
064100* ADDED CODE TO RETRIEVE ITEM NUMBER FROM TPURITM TABLE.        * 06410057
064200*---------------------------------------------------------------* 06420057
064300                                                                  06430057
064400     EXEC SQL                                                     06440057
064500          DECLARE LIST-CSR CURSOR                                 06450057
064600          FOR SELECT                                              06460057
064700                A.FS_POST_TMST                                    06470057
064800              , B.ORD_LNE_NBR                                     06480057
064900              , B.STATUS_CDE                                      06490057
065000              , B.RCPT_DISTR_UPD_CDE                              06500057
065100              , C.CL_NBR                                          06510057
065200              , C.SKU_SEQ_NBR                                     06520057
065300              , B.PREPK_ID                                        06530057
065400              , C.ITM_NBR                                         06540057
065500          FROM                                                    06550057
065600                  TRECEIV  A                                      06560057
065700              ,   TRECITM  B                                      06570057
065800              ,   TPURITM  C                                      06580057
065900          WHERE                                                   06590057
066000                A.ORD_NBR          =  :ASC-PO-NBR                 06600057
066100           AND  A.ORD_NBR          =  B.ORD_NBR                   06610057
066200           AND  A.ORD_NBR          =  C.PO_NBR                    06620057
066300           AND  A.VER_STATUS_CDE   =  :PC-A                       06630057
066400           AND  B.VER_STATUS_CDE   =  :PC-A                       06640057
066500*          AND  C.VER_STATUS_CDE   =  :PC-A                       06650057
066600           AND  A.OPER_UNT_ID      =  :ASC-OPER-UNT-ID            06660057
066700           AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID               06670057
066800           AND  A.FCLTY_ID         =  :ASC-FCLTY-ID               06680057
066900           AND  A.FCLTY_ID         =  B.FCLTY_ID                  06690057
067000           AND  A.REC_SEQ_NBR      =  :ASC-REC-SEQ-NBR            06700057
067100           AND  A.REC_SEQ_NBR      =  B.REC_SEQ_NBR               06710057
067200           AND  B.ORD_LNE_NBR      =  C.APP_PO_LNE_NBR            06720057
067300           AND  B.PO_VER_NBR       =  C.VER_NBR                   06730057
067400           AND  B.ORD_LNE_NBR BETWEEN :ASC-PO-LNE-NBR-LOW         06740057
067500                                 AND  :ASC-PO-LNE-NBR-HIGH        06750057
067600          ORDER BY                                                06760057
067700                B.ORD_LNE_NBR                                     06770057
067800     END-EXEC.                                                    06780057
067900*----------------------------------------------------------------*06790057
068000* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *06800063
068100*----------------------------------------------------------------*06810057
068200                                                                  06820057
068300/                                                                 06830057
068400 LINKAGE SECTION.                                                 06840057
068500                                                                  06850057
068600 01  DFHCOMMAREA.                                                 06860057
068700     05  FILLER                         OCCURS  1 TO 4072 TIMES   06870057
068800                                        DEPENDING ON EIBCALEN.    06880057
068900         10  FILLER                     PIC X.                    06890057
069000                                                                  06900057
069100 PROCEDURE DIVISION.                                              06910057
069200******************************************************************06920057
069300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06930057
069400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06940057
069500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06950057
069600******************************************************************06960057
069700                                                                  06970057
069800 0000-MAIN-MODULE.                                                06980057
069900                                                                  06990057
070000     INITIALIZE DP030-CICS-API-FIELDS.                            07000057
070100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07010057
070200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07020057
070300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07030057
070400     SET DP030-RECEIVE-APPL-MAP                                   07040057
070500         DP030-OVERRIDE-APPL-ERROR TO TRUE.                       07050057
070600                                                                  07060057
070700     MOVE LENGTH OF RC278AI        TO DP030-MAP-LENGTH (1).       07070057
070800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07080057
070900     PERFORM 0001-CALL-CICS-ARCH-API.                             07090057
071000                                                                  07100057
071100     PERFORM 1000-CONTROL-PROCESSING                              07110057
071200                                                                  07120057
071300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07130057
071400     PERFORM 0001-CALL-CICS-ARCH-API.                             07140057
071500                                                                  07150057
071600*----------------------------------------------------------------*07160057
071700*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *07170057
071800*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *07180057
071900*----------------------------------------------------------------*07190057
072000                                                                  07200057
072100 0001-CALL-CICS-ARCH-API.                                         07210057
072200                                                                  07220057
072310     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07231069
072400                                    DFHCOMMAREA                   07240069
072500                                    DP030-CICS-API-FIELDS         07250069
072600                                    DP020-STANDARD-COMMAREA       07260069
072700                                    RC278AI.                      07270069
072800                                                                  07280057
072900     IF  DP030-RC-CALL-SUCCESSFUL OR                              07290057
073000         DP030-RC-APPL-ERROR                                      07300057
073100         CONTINUE                                                 07310057
073200     ELSE                                                         07320057
073300         SET DP013-NO-ROLLBACK                                    07330057
073400             DP013-XCTL-DISPLAY-RESTART                           07340057
073500             DP013-CICS-ABEND      TO TRUE                        07350057
073600         MOVE '0001-CALL-CICS-ARCH-API'                           07360057
073700                                   TO DP013-PARAGRAPH             07370057
073720         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O07372069
073730-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07373069
074000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07400057
074100         PERFORM DP013-0000-PROCESS-ABEND                         07410057
074200     END-IF.                                                      07420057
074300                                                                  07430057
074400*----------------------------------------------------------------*07440057
074500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07450057
074600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07460057
074700*                                                                *07470057
074800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07480057
074900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07490057
075000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07500057
075100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07510057
075200*----------------------------------------------------------------*07520057
075300                                                                  07530057
075400 1000-CONTROL-PROCESSING.                                         07540057
075500                                                                  07550057
075600*    SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       07560057
075700     EVALUATE TRUE                                                07570057
075800         WHEN DP020-NEXT-ACT-INITIAL                              07580057
075900              INITIALIZE ASC-SPECIFIC-COMMAREA                    07590057
076000              MOVE EIBTRMID        TO ASC-LIST-TERM-ID            07600057
076100                                      ASC-SEL-TERM-ID             07610057
076200              MOVE DP020-SRC-TASK-NUMBER                          07620057
076300                                   TO ASC-LIST-TASK-NUMBER        07630057
076400                                      ASC-SEL-TASK-NUMBER         07640057
076500              MOVE PC-LIST-QUEUE-SEQ                              07650057
076600                                   TO ASC-LIST-SEQ                07660057
076700              MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                07670057
076800                                                                  07680057
076900              MOVE INTER-APPL-COMM-AREA                           07690057
077000                                   TO ASC-HOLD-INTER-APPL         07700057
077100              PERFORM 4100-PREPARE-CURSOR                         07710057
077200              PERFORM 4000-BUILD-INITIAL-PANEL                    07720057
077300              PERFORM 3200-RESET-ATTRIBUTES                       07730057
077400              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07740057
077500              IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                 07750057
077600                  SET DP020-NEXT-ACT-APPL-ERROR TO TRUE           07760057
077700              END-IF                                              07770057
077800                                                                  07780057
077900         WHEN DP020-NEXT-ACT-READ-MAP                             07790057
078000              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       07800057
078100                                   TO PV-TOP-ITEM                 07810057
078200              PERFORM 2000-PROCESS-PANEL                          07820057
078300                                                                  07830057
078400         WHEN DP020-NEXT-ACT-RETURN                               07840057
078500              MOVE RC017-NUMBER-OF-TS-ITEMS                       07850057
078600                                   TO PV-HOLD-SELECTED-ITEMS      07860057
078700              MOVE ASC-HOLD-INTER-APPL                            07870057
078800                                   TO INTER-APPL-COMM-AREA        07880057
078900              PERFORM 2050-DELETE-LIST-QUEUE                      07890057
079000              PERFORM 4000-BUILD-INITIAL-PANEL                    07900057
079100              PERFORM 3200-RESET-ATTRIBUTES                       07910057
079200              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       07920057
079300                                   TO PV-TOP-ITEM                 07930057
079400              MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    07940057
079500              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                07950057
079600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07960057
079700*             PERFORM 3000-EDIT-DATA-IN-COMMAREA                  07970057
079800*             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07980057
079900                                                                  07990057
080000         WHEN OTHER                                               08000057
080100              SET DP013-LOGIC-ABEND TO TRUE                       08010057
080200              SET DP013-NO-ROLLBACK TO TRUE                       08020057
080300              MOVE '1000-CONTROL-PROCESSING'                      08030057
080400                                   TO DP013-PARAGRAPH             08040057
080500              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'   08050057
080600                                   TO DP013-MESSAGE-TEXT(1)       08060057
080700              PERFORM DP013-0000-PROCESS-ABEND                    08070057
080800     END-EVALUATE.                                                08080057
080900/                                                                 08090057
081000*----------------------------------------------------------------*08100057
081100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08110057
081200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08120057
081300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08130057
081400* OF THE  UNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08140057
081500* FUNCTION KEYS CAN GET THIS FAR.                                *08150057
081600*----------------------------------------------------------------*08160057
081700                                                                  08170057
081800 2000-PROCESS-PANEL.                                              08180057
081900                                                                  08190057
082000     SET PS-NEXT-SCREEN TO TRUE.                                  08200057
082100                                                                  08210057
082200     MOVE ASC-HOLD-INTER-APPL     TO INTER-APPL-COMM-AREA.        08220057
082300                                                                  08230057
082400     EVALUATE TRUE                                                08240057
082500         WHEN DP020-SRC-AID = DP016-CLEAR                         08250057
082600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08260057
082700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08270057
082800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08280057
082900                                                                  08290057
083000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08300057
083100             PERFORM 2050-DELETE-LIST-QUEUE                       08310057
083200             PERFORM 4000-BUILD-INITIAL-PANEL                     08320057
083300             PERFORM 3200-RESET-ATTRIBUTES                        08330057
083400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08340057
083500                                                                  08350057
083600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08360057
083700             PERFORM 2140-DESELECT-ALL-ITEMS                      08370057
083800             PERFORM 3200-RESET-ATTRIBUTES                        08380057
083900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08390057
084000                                                                  08400057
084100         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08410057
084200             PERFORM 2150-SELECT-ALL-ITEMS                        08420057
084300             PERFORM 3200-RESET-ATTRIBUTES                        08430057
084400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08440057
084500                                                                  08450057
084600         WHEN OTHER                                               08460057
084700              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                08470057
084800                  PERFORM 3000-EDIT-DATA-IN-COMMAREA              08480057
084900                  IF  PS-NO-ERROR                                 08490057
085000                      SET DP030-CONTINUE-GO                       08500057
085100                                 TO TRUE                          08510057
085200                      PERFORM 2100-CHECK-FUNCTION-KEY             08520057
085300                  ELSE                                            08530057
085400                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        08540057
085500                      SET DP030-OVERRIDE-GO                       08550057
085600                                 TO TRUE                          08560057
085700                  END-IF                                          08570057
085800     END-EVALUATE.                                                08580057
085900 EJECT                                                            08590057
086000*----------------------------------------------------------------*08600057
086100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08610057
086200*----------------------------------------------------------------*08620057
086300 2050-DELETE-LIST-QUEUE.                                          08630057
086400                                                                  08640057
086500     EXEC CICS                                                    08650057
086600         DELETEQ TS                                               08660057
086700             QUEUE (ASC-LIST-QUEUE-NAME)                          08670057
086800             RESP  (PV-CICS-RESP)                                 08680057
086900     END-EXEC.                                                    08690057
087000                                                                  08700057
087100     IF (PV-CICS-RESP = DFHRESP(NORMAL)                           08710057
087200     OR  PV-CICS-RESP = DFHRESP(QIDERR))                          08720057
087300         CONTINUE                                                 08730057
087400     ELSE                                                         08740057
087500         SET DP013-CICS-ABEND      TO TRUE                        08750057
087600         SET DP013-NO-ROLLBACK     TO TRUE                        08760057
087700                                                                  08770057
087800         MOVE '2050-DELETE-LIST-QUEUE'                            08780057
087900                                   TO DP013-PARAGRAPH             08790057
088000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08800057
088100                                   TO DP013-MESSAGE-TEXT (1)      08810057
088200         PERFORM DP013-0000-PROCESS-ABEND                         08820057
088300     END-IF.                                                      08830057
088400                                                                  08840057
088500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08850057
088600/                                                                 08860057
088700*----------------------------------------------------------------*08870057
088800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08880057
088900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08890057
089000* CICS ARCHITECTURE API.                                         *08900057
089100*----------------------------------------------------------------*08910057
089200                                                                  08920057
089300 2100-CHECK-FUNCTION-KEY.                                         08930057
089400                                                                  08940057
089500     EVALUATE TRUE                                                08950057
089600         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  08960057
089700             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    08970057
089800                            TO RC013-SELECTED-ITEMS               08980057
089900             PERFORM 5000-PREPARE-SEL-QUEUE                       08990057
090000             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    09000057
090100                            TO RC017-NUMBER-OF-SELECTED-ITEMS     09010057
090200                                                                  09020057
090300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09030057
090400             MOVE +1               TO PV-TOP-ITEM                 09040057
090500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09050057
090600                                                                  09060057
090700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09070057
090800             PERFORM 2110-BROWSE-BACKWARD                         09080057
090900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09090057
091000                                                                  09100057
091100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09110057
091200             PERFORM 2120-BROWSE-FORWARD                          09120057
091300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09130057
091400                                                                  09140057
091500         WHEN DP020-SRC-AID = DP016-ENTER                         09150057
091600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09160057
091700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09170057
091800                                                                  09180057
091900         WHEN OTHER                                               09190057
092000             PERFORM 2050-DELETE-LIST-QUEUE                       09200057
092100             PERFORM 4000-BUILD-INITIAL-PANEL                     09210057
092200             PERFORM 3200-RESET-ATTRIBUTES                        09220057
092300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09230057
092400*            SET DP013-NO-ROLLBACK                                09240057
092500*                DP013-XCTL-DISPLAY-RESTART                       09250057
092600*                DP013-CICS-ABEND  TO TRUE                        09260057
092700*            MOVE '2100-CHECK-FUNCTION-KEY'                       09270057
092800*                                  TO DP013-PARAGRAPH             09280057
092900*            MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09290057
093000*                                  TO DP013-MESSAGE-TEXT (1)      09300057
093100*            PERFORM DP013-0000-PROCESS-ABEND                     09310057
093200     END-EVALUATE.                                                09320057
093300                                                                  09330057
093400*----------------------------------------------------------------*09340057
093500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09350057
093600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09360057
093700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09370057
093800*    MESSAGE.                                                    *09380057
093900*----------------------------------------------------------------*09390057
094000                                                                  09400057
094100 2110-BROWSE-BACKWARD.                                            09410057
094200                                                                  09420057
094300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09430057
094400         GIVING PV-TOP-ITEM.                                      09440057
094500                                                                  09450057
094600     IF  ((PV-TOP-ITEM < +1)                                      09460057
094700       OR (PV-TOP-ITEM = +1))                                     09470057
094800         MOVE +1                   TO PV-TOP-ITEM                 09480057
094900*        -- TOP OF LIST --                                        09490057
095000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09500057
095100         SET DP020-MSG-INFORMATIONAL TO TRUE                      09510057
095200     END-IF.                                                      09520057
095300                                                                  09530057
095400/                                                                 09540057
095500*----------------------------------------------------------------*09550057
095600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09560057
095700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09570057
095800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09580057
095900*----------------------------------------------------------------*09590057
096000                                                                  09600057
096100 2120-BROWSE-FORWARD.                                             09610057
096200                                                                  09620057
096300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09630057
096400         GIVING PV-TOP-ITEM.                                      09640057
096500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09650057
096600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09660057
096700                                   TO PV-TOP-ITEM                 09670057
096800*        -- BOTTOM OF LIST --                                     09680057
096900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09690057
097000         SET DP020-MSG-INFORMATIONAL                              09700057
097100                                   TO TRUE                        09710057
097200     ELSE                                                         09720057
097300         COMPUTE PV-BOTTOM-ITEM =                                 09730057
097400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09740057
097500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09750057
097600*            -- BOTTOM OF LIST --                                 09760057
097700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09770057
097800             SET DP020-MSG-INFORMATIONAL                          09780057
097900                                   TO TRUE                        09790057
098000         END-IF                                                   09800057
098100     END-IF.                                                      09810057
098200/                                                                 09820057
098300*----------------------------------------------------------------*09830057
098400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09840057
098500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09850057
098600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09860057
098700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09870057
098800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09880057
098900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09890057
099000*----------------------------------------------------------------*09900057
099100                                                                  09910057
099200 2130-CHECK-FOR-JUMP-BROWSE.                                      09920057
099300                                                                  09930057
099400     SET PS-NO-ERROR               TO TRUE.                       09940057
099500     IF  ASC-START-ITEM-REQUEST = SPACE                           09950057
099600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09960057
099700                                   TO PV-TOP-ITEM                 09970057
099800     ELSE                                                         09980057
099900         MOVE ASC-START-ITEM-REQUEST                              09990057
100000                                   TO DP010I-UNEDITED-FIELD       10000057
100100                                      PV-START-ITEM-REQUEST       10010057
100200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10020057
100300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10030057
100400         SET DP010I-NEGATIVE-NOT-ALLOWED                          10040057
100500                                   TO TRUE                        10050057
100610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10061067
100620              USING DP010I-NUMERIC-EDIT-AREA                      10062067
100700                                                                  10070057
100800         IF  NOT DP010I-ERROR-DETECTED                            10080057
100900             MOVE DP010I-NUMERIC-FIELD                            10090057
101000                                   TO  ASC-START-ITEM-REQUEST-N   10100057
101100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10110057
101200                 IF  ASC-START-ITEM-REQUEST-N >                   10120057
101300                                          ASC-NUMBER-OF-ITEMS-READ10130057
101400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10140057
101500                     COMPUTE PV-TOP-ITEM =                        10150057
101600                             ASC-NUMBER-OF-ITEMS-READ             10160057
101700                             - PC-ITEMS-PER-PANEL + 1             10170057
101800                     IF  PV-TOP-ITEM < +1                         10180057
101900                         MOVE +1   TO PV-TOP-ITEM                 10190057
102000                         MOVE PC-TSYMSG-00070                     10200057
102100                                   TO DP020-MSG-NUMBER            10210057
102200                         SET DP020-MSG-INFORMATIONAL              10220057
102300                                   TO TRUE                        10230057
102400                     END-IF                                       10240057
102500                 ELSE                                             10250057
102600                     MOVE ASC-START-ITEM-REQUEST-N                10260057
102700                                   TO PV-TOP-ITEM                 10270057
102800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10280057
102900                     COMPUTE PV-BOTTOM-ITEM =                     10290057
103000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10300057
103100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10310057
103200*                        -- BOTTOM OF LIST --                     10320057
103300                         MOVE PC-TSYMSG-00070                     10330057
103400                                   TO DP020-MSG-NUMBER            10340057
103500                         SET DP020-MSG-INFORMATIONAL              10350057
103600                                   TO TRUE                        10360057
103700                     END-IF                                       10370057
103800                 END-IF                                           10380057
103900             ELSE                                                 10390057
104000*                --- VALUE OUT OF RANGE ----                      10400057
104100                 MOVE PC-TSYMSG-00101                             10410057
104200                                   TO DP020-MSG-NUMBER            10420057
104300                 MOVE -1           TO ASTRTITL                    10430057
104400                 SET DP030-SET-CURSOR-APPL-1                      10440057
104500                                   TO TRUE                        10450057
104600                 MOVE DP015-REVERSE                               10460057
104700                                   TO ASTRTITH                    10470057
104800                 MOVE DP015-RED    TO ASTRTITC                    10480057
104900                 MOVE DP015-UNP-NUM-BRT-OFF                       10490057
105000                                   TO ASTRTITA                    10500057
105100                 SET DP020-MSG-FATAL                              10510057
105200                                   TO TRUE                        10520057
105300                 SET PS-ERROR      TO TRUE                        10530057
105400             END-IF                                               10540057
105500                                                                  10550057
105600         ELSE                                                     10560057
105700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10570057
105800             MOVE -1               TO ASTRTITL                    10580057
105900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10590057
106000             MOVE DP015-REVERSE    TO ASTRTITH                    10600057
106100             MOVE DP015-RED        TO ASTRTITC                    10610057
106200             MOVE DP015-UNP-NUM-BRT-OFF                           10620057
106300                                   TO ASTRTITA                    10630057
106400             SET DP020-MSG-FATAL   TO TRUE                        10640057
106500             SET PS-ERROR          TO TRUE                        10650057
106600         END-IF                                                   10660057
106700     END-IF.                                                      10670057
106800/                                                                 10680057
106900*----------------------------------------------------------------*10690057
107000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10700057
107100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10710057
107200*----------------------------------------------------------------*10720057
107300                                                                  10730057
107400 2140-DESELECT-ALL-ITEMS.                                         10740057
107500                                                                  10750057
107600     MOVE +1                       TO ASC-BLK-SUB.                10760057
107700                                                                  10770057
107800     PERFORM 2141-CLEAR-SELECTED-INDS                             10780057
107900         VARYING ASC-ITEM-SUB                                     10790057
108000         FROM 1 BY 1                                              10800057
108100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10810057
108200                                                                  10820057
108300     ADD +1                        TO ASC-BLK-SUB.                10830057
108400                                                                  10840057
108500     PERFORM 2141-CLEAR-SELECTED-INDS                             10850057
108600         VARYING ASC-ITEM-SUB                                     10860057
108700         FROM 1 BY 1                                              10870057
108800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10880057
108900                                                                  10890057
109000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10900057
109100                                   TO PV-LIST-ITEM-NUMBER.        10910057
109200                                                                  10920057
109300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10930057
109400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10940057
109500                                                                  10950057
109600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10960057
109700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10970057
109800         MOVE +1                   TO ASC-BLK-SUB                 10980057
109900                                                                  10990057
110000         PERFORM 5100-WRITE-TEMP-STORAGE                          11000057
110100                                                                  11010057
110200         MOVE +1                   TO PV-BLOCK-NUMBER             11020057
110300                                                                  11030057
110400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11040057
110500             PV-FIRST-BLOCK-IN-ARRAY - 1                          11050057
110600                                                                  11060057
110700         PERFORM                                                  11070057
110800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11080057
110900                                                                  11090057
111000             PERFORM 4410-READ-TEMP-STORAGE                       11100057
111100                                                                  11110057
111200             PERFORM 2141-CLEAR-SELECTED-INDS                     11120057
111300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11130057
111400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11140057
111500                                                                  11150057
111600             PERFORM 5100-WRITE-TEMP-STORAGE                      11160057
111700                                                                  11170057
111800             ADD +1                TO PV-BLOCK-NUMBER             11180057
111900                                                                  11190057
112000         END-PERFORM                                              11200057
112100                                                                  11210057
112200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11220057
112300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11230057
112400                                                                  11240057
112500         PERFORM                                                  11250057
112600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11260057
112700                   ASC-HIGHEST-BLOCK-WRITTEN                      11270057
112800                                                                  11280057
112900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11290057
113000                                   TO PV-BLOCK-NUMBER             11300057
113100                                                                  11310057
113200             PERFORM 4410-READ-TEMP-STORAGE                       11320057
113300                                                                  11330057
113400             PERFORM 2141-CLEAR-SELECTED-INDS                     11340057
113500                 VARYING ASC-ITEM-SUB                             11350057
113600                 FROM 1 BY 1                                      11360057
113700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11370057
113800                                                                  11380057
113900             PERFORM 5100-WRITE-TEMP-STORAGE                      11390057
114000                                                                  11400057
114100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11410057
114200                                                                  11420057
114300         END-PERFORM                                              11430057
114400                                                                  11440057
114500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11450057
114600                                   TO PV-BLOCK-NUMBER             11460057
114700                                                                  11470057
114800         PERFORM 4410-READ-TEMP-STORAGE                           11480057
114900     END-IF.                                                      11490057
115000                                                                  11500057
115100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11510057
115200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11520057
115300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11530057
115400                                                                  11540057
115500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11550057
115600                                                                  11560057
115700/                                                                 11570057
115800*----------------------------------------------------------------*11580057
115900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11590057
116000*----------------------------------------------------------------*11600057
116100                                                                  11610057
116200 2141-CLEAR-SELECTED-INDS.                                        11620057
116300                                                                  11630057
116400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11640057
116500             NOT EQUAL ZERO                                       11650057
116600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11660057
116700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11670057
116800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11680057
116900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11690057
117000                                   TO TRUE                        11700057
117100         END-IF                                                   11710057
117200     END-IF.                                                      11720057
117300                                                                  11730057
117400/                                                                 11740057
117500*----------------------------------------------------------------*11750057
117600*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11760057
117700*  FOR ALL ITEMS.                                                *11770057
117800*----------------------------------------------------------------*11780057
117900                                                                  11790057
118000 2150-SELECT-ALL-ITEMS.                                           11800057
118100                                                                  11810057
118200     MOVE +1                       TO ASC-BLK-SUB.                11820057
118300                                                                  11830057
118400     PERFORM 2151-SET-SELECTED-INDS                               11840057
118500         VARYING ASC-ITEM-SUB                                     11850057
118600         FROM 1 BY 1                                              11860057
118700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11870057
118800                                                                  11880057
118900     ADD +1                        TO ASC-BLK-SUB.                11890057
119000                                                                  11900057
119100     PERFORM 2151-SET-SELECTED-INDS                               11910057
119200         VARYING ASC-ITEM-SUB                                     11920057
119300         FROM 1 BY 1                                              11930057
119400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11940057
119500                                                                  11950057
119600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11960057
119700                                   TO PV-LIST-ITEM-NUMBER.        11970057
119800                                                                  11980057
119900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11990057
120000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12000057
120100                                                                  12010057
120200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12020057
120300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12030057
120400         MOVE +1                   TO ASC-BLK-SUB                 12040057
120500                                                                  12050057
120600         PERFORM 5100-WRITE-TEMP-STORAGE                          12060057
120700                                                                  12070057
120800         MOVE +1                   TO PV-BLOCK-NUMBER             12080057
120900                                                                  12090057
121000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12100057
121100             PV-FIRST-BLOCK-IN-ARRAY - 1                          12110057
121200                                                                  12120057
121300         PERFORM                                                  12130057
121400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12140057
121500                                                                  12150057
121600             PERFORM 4410-READ-TEMP-STORAGE                       12160057
121700                                                                  12170057
121800             PERFORM 2151-SET-SELECTED-INDS                       12180057
121900                 VARYING ASC-ITEM-SUB                             12190057
122000                 FROM 1 BY 1                                      12200057
122100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12210057
122200                                                                  12220057
122300             PERFORM 5100-WRITE-TEMP-STORAGE                      12230057
122400                                                                  12240057
122500             ADD +1                TO PV-BLOCK-NUMBER             12250057
122600                                                                  12260057
122700         END-PERFORM                                              12270057
122800                                                                  12280057
122900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12290057
123000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12300057
123100                                                                  12310057
123200         PERFORM                                                  12320057
123300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12330057
123400                   ASC-HIGHEST-BLOCK-WRITTEN                      12340057
123500                                                                  12350057
123600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12360057
123700                                   TO PV-BLOCK-NUMBER             12370057
123800                                                                  12380057
123900             PERFORM 4410-READ-TEMP-STORAGE                       12390057
124000                                                                  12400057
124100             PERFORM 2151-SET-SELECTED-INDS                       12410057
124200                 VARYING ASC-ITEM-SUB                             12420057
124300                 FROM 1 BY 1                                      12430057
124400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12440057
124500                                                                  12450057
124600             PERFORM 5100-WRITE-TEMP-STORAGE                      12460057
124700                                                                  12470057
124800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12480057
124900                                                                  12490057
125000         END-PERFORM                                              12500057
125100                                                                  12510057
125200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12520057
125300                                   TO PV-BLOCK-NUMBER             12530057
125400                                                                  12540057
125500         PERFORM 4410-READ-TEMP-STORAGE                           12550057
125600     END-IF.                                                      12560057
125700                                                                  12570057
125800                                                                  12580057
125900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12590057
126000                       ASC-NUMBER-OF-SELECTED-ITEMS.              12600057
126100                                                                  12610057
126200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12620057
126300                                                                  12630057
126400/                                                                 12640057
126500*----------------------------------------------------------------*12650057
126600*    MARK EACH ITEM AS BEING SELECTED.                           *12660057
126700*----------------------------------------------------------------*12670057
126800                                                                  12680057
126900 2151-SET-SELECTED-INDS.                                          12690057
127000                                                                  12700057
127100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12710057
127200             NOT EQUAL ZERO                                       12720057
127300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12730057
127400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12740057
127500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12750057
127600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12760057
127700                               TO  TRUE                           12770057
127800         END-IF                                                   12780057
127900     END-IF.                                                      12790057
128000/                                                                 12800057
128100*----------------------------------------------------------------*12810057
128200*    MARK EACH ITEM AS BEING SELECTED.                           *12820057
128300*----------------------------------------------------------------*12830057
128400                                                                  12840057
128500 2170-CHECK-RACF-ACCESS.                                          12850057
128600     SET DP008-RSRC-TYPE-FUNC     TO TRUE                         12860057
128700     MOVE 'RCUNVER '              TO DP008-FUNCTION-NAME          12870057
128800     SET DP008-ACCESS-TYPE-USE    TO TRUE                         12880057
128900                                                                  12890057
129000     EXEC CICS                                                    12900057
129100        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                  12910057
129200             COMMAREA (DP008-SECURITY-COMMAREA)                   12920057
129300             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)              12930057
129400     END-EXEC                                                     12940057
129500                                                                  12950057
129600     IF DP008-CALL-SUCCESSFUL                                     12960057
129700         CONTINUE                                                 12970057
129800     ELSE                                                         12980057
129900        MOVE '2170-CHECK-RACF-ACCESS'                             12990057
130000                              TO DP013-PARAGRAPH                  13000057
130100         MOVE 'UNABLE TO ACCESS CICS'                             13010057
130200                              TO DP013-MESSAGE-TEXT (1)           13020057
130300         MOVE SQLCA           TO DP013-SQLCA                      13030057
130400         SET DP013-DB2-ABEND                                      13040057
130500             DP013-XCTL-DISPLAY-RESTART                           13050057
130600                              TO TRUE                             13060057
130700         PERFORM DP013-0000-PROCESS-ABEND                         13070057
130800     END-IF.                                                      13080057
130900*----------------------------------------------------------------*13090057
131000*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13100057
131100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *13110057
131200*----------------------------------------------------------------*13120057
131300                                                                  13130057
131400 2200-MOVE-SCREEN-TO-COMMAREA.                                    13140057
131500                                                                  13150057
131600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13160057
131700     MOVE +1                       TO PV-SUB.                     13170057
131800                                                                  13180057
131900     IF  ASTRTITL > ZERO                                          13190057
132000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13200057
132100     ELSE                                                         13210057
132200         IF  ASTRTITF EQUAL DP015-ERASE-EOF                       13220057
132300             INITIALIZE ASC-START-ITEM-REQUEST                    13230057
132400         END-IF                                                   13240057
132500     END-IF.                                                      13250057
132600                                                                  13260057
132700     PERFORM 3100-SET-SUBSCRIPTS.                                 13270057
132800                                                                  13280057
132900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13290057
133000         VARYING PV-SUB                                           13300057
133100         FROM 1 BY 1                                              13310057
133200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13320057
133300                                                                  13330057
133400******************************************************************13340057
133500** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**13350057
133600******************************************************************13360057
133700                                                                  13370057
133800 2210-MOVE-LINES-TO-COMMAREA.                                     13380057
133900                                                                  13390057
134000     IF  MR-SELECTL (PV-SUB) > ZERO                               13400057
134100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13410057
134200         MOVE MR-SELECTI (PV-SUB)                                 13420057
134300                                   TO ASC-TEMP-SELECTED-SW        13430057
134400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13440057
134500     ELSE                                                         13450057
134600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13460057
134700                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13470057
134800                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13480057
134900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13490057
135000         END-IF                                                   13500057
135100     END-IF.                                                      13510057
135200                                                                  13520057
135300     ADD +1                        TO ASC-ITEM-SUB.               13530057
135400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13540057
135500         ADD +1                    TO ASC-BLK-SUB                 13550057
135600         MOVE +1                   TO ASC-ITEM-SUB                13560057
135700     END-IF.                                                      13570057
135800                                                                  13580057
135900*----------------------------------------------------------------*13590057
136000*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *13600057
136100*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *13610057
136200*----------------------------------------------------------------*13620057
136300                                                                  13630057
136400 3000-EDIT-DATA-IN-COMMAREA.                                      13640057
136500                                                                  13650057
136600     SET PS-NO-ERROR               TO TRUE.                       13660057
136700     PERFORM 3200-RESET-ATTRIBUTES.                               13670057
136800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13680057
136900**                                                                13690057
137000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13700057
137100* EDITTING IS DONE FROM THE BOTTOM UP.                            13710057
137200**                                                                13720057
137300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13730057
137400         ASC-ITEMS-DISPLAYED - 1.                                 13740057
137500     PERFORM 3100-SET-SUBSCRIPTS.                                 13750057
137600     PERFORM 3300-EDIT-SELECTIONS                                 13760057
137700         VARYING PV-SUB                                           13770057
137800         FROM PV-SUB BY -1                                        13780057
137900         UNTIL PV-SUB < +1.                                       13790057
138000                                                                  13800057
138100     IF  PS-NO-ERROR                                              13810057
138200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13820057
138300     END-IF.                                                      13830057
138400                                                                  13840057
138500     IF  ((PS-NO-ERROR)                                           13850057
138600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13860057
138700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13870057
138800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13880057
138900     END-IF.                                                      13890057
139000/                                                                 13900057
139100*----------------------------------------------------------------*13910057
139200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13920057
139300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13930057
139400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13940057
139500*                                                                *13950057
139600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13960057
139700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13970057
139800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13980057
139900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13990057
140000*----------------------------------------------------------------*14000057
140100                                                                  14010057
140200 3100-SET-SUBSCRIPTS.                                             14020057
140300                                                                  14030057
140400     COMPUTE ASC-ITEM-SUB =                                       14040057
140500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14050057
140600                                                                  14060057
140700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14070057
140800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14080057
140900                                                                  14090057
141000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14100057
141100     ELSE                                                         14110057
141200         MOVE +1                     TO ASC-BLK-SUB               14120057
141300     END-IF.                                                      14130057
141400                                                                  14140057
141500*----------------------------------------------------------------*14150057
141600*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *14160057
141700*----------------------------------------------------------------*14170057
141800                                                                  14180057
141900 3200-RESET-ATTRIBUTES.                                           14190057
142000                                                                  14200057
142100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14210057
142200     MOVE DP015-GREEN              TO ASTRTITC.                   14220057
142300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14230057
142400                                                                  14240057
142500*    IF  ASC-IN-TROUBLE                                           14250057
142600*        PERFORM                                                  14260057
142700*            VARYING PV-SUB                                       14270057
142800*            FROM 1 BY 1                                          14280057
142900*            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    14290057
143000*            MOVE DP015-ASK-NOR-OFF                               14300057
143100*                                  TO MR-SELECTA (PV-SUB)         14310057
143200*            MOVE DP015-BLUE       TO MR-SELECTC (PV-SUB)         14320057
143300*            MOVE DP015-HL-OFF     TO MR-SELECTH (PV-SUB)         14330057
143400*        END-PERFORM                                              14340057
143500*    ELSE                                                         14350057
143600         PERFORM                                                  14360057
143700             VARYING PV-SUB                                       14370057
143800             FROM 1 BY 1                                          14380057
143900             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    14390057
144000             MOVE DP015-UNP-ALP-NOR-OFF                           14400057
144100                                   TO MR-SELECTA (PV-SUB)         14410057
144200             MOVE DP015-GREEN      TO MR-SELECTC (PV-SUB)         14420057
144300             MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)         14430057
144400         END-PERFORM.                                             14440057
144500*    END-IF.                                                      14450057
144600                                                                  14460057
144700*----------------------------------------------------------------*14470057
144800*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *14480057
144900*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *14490057
145000*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *14500057
145100*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *14510057
145200*----------------------------------------------------------------*14520057
145300                                                                  14530057
145400 3300-EDIT-SELECTIONS.                                            14540057
145500                                                                  14550057
145600     EVALUATE TRUE                                                14560057
145700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14570057
145800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14580057
145900                 CONTINUE                                         14590057
146000                                                                  14600057
146100         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14610057
146200             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14620057
146300                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14630057
146400                 MOVE ASC-TEMP-SELECTED-SW                        14640057
146500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14650057
146600                                TO ASC-SELECTED-SW                14660057
146700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14670057
146800             END-IF                                               14680057
146900                                                                  14690057
147000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14700057
147100                 = SPACE                                          14710057
147200             EVALUATE TRUE                                        14720057
147300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14730057
147400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14740057
147500                     MOVE SPACE TO ASC-SELECTED-SW                14750057
147600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14760057
147700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14770057
147800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14780057
147900                     MOVE SPACE TO ASC-SELECTED-SW                14790057
148000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14800057
148100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14810057
148200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14820057
148300                     MOVE SPACE TO ASC-SELECTED-SW                14830057
148400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14840057
148500             END-EVALUATE                                         14850057
148600                                                                  14860057
148700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14870057
148800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14880057
148900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14890057
149000             END-IF                                               14900057
149100             PERFORM 3310-EDIT-RANGE                              14910057
149200                                                                  14920057
149300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14930057
149400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14940057
149500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14950057
149600             END-IF                                               14960057
149700             PERFORM 3310-EDIT-RANGE                              14970057
149800                                                                  14980057
149900         WHEN OTHER                                               14990057
150000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15000057
150100             SET DP020-MSG-FATAL    TO TRUE                       15010057
150200             MOVE -1                TO MR-SELECTL (PV-SUB)        15020057
150300             SET DP030-SET-CURSOR-APPL-1                          15030057
150400                                    TO TRUE                       15040057
150500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15050057
150600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15060057
150700             SET PS-ERROR TO TRUE                                 15070057
150800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15080057
150900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15090057
151000                 MOVE SPACE         TO ASC-SELECTED-SW            15100057
151100                                        (ASC-BLK-SUB ASC-ITEM-SUB)15110057
151200             END-IF                                               15120057
151300                                                                  15130057
151400     END-EVALUATE.                                                15140057
151500                                                                  15150057
151600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15160057
151700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15170057
151800     IF  ASC-ITEM-SUB < 1                                         15180057
151900         SUBTRACT +1 FROM ASC-BLK-SUB                             15190057
152000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15200057
152100     END-IF.                                                      15210057
152200                                                                  15220057
152300*----------------------------------------------------------------*15230057
152400*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *15240057
152500*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *15250057
152600*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *15260057
152700*  THE ENDING.                                                   *15270057
152800*----------------------------------------------------------------*15280057
152900                                                                  15290057
153000 3310-EDIT-RANGE.                                                 15300057
153100                                                                  15310057
153200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15320057
153300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15330057
153400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15340057
153500                                   TO ASC-SELECTED-SW             15350057
153600                                        (ASC-BLK-SUB ASC-ITEM-SUB)15360057
153700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15370057
153800         ELSE                                                     15380057
153900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15390057
154000                 CONTINUE                                         15400057
154100             ELSE                                                 15410057
154200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15420057
154300                 MOVE PC-TSYMSG-00054                             15430057
154400                                   TO DP020-MSG-NUMBER            15440057
154500                 SET DP020-MSG-FATAL                              15450057
154600                                   TO TRUE                        15460057
154700                 MOVE -1           TO MR-SELECTL (PV-SUB)         15470057
154800                 SET DP030-SET-CURSOR-APPL-1                      15480057
154900                                   TO TRUE                        15490057
155000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15500057
155100                 MOVE DP015-UNDERLINE                             15510057
155200                                   TO MR-SELECTH (PV-SUB)         15520057
155300                 SET PS-ERROR      TO TRUE                        15530057
155400             END-IF                                               15540057
155500         END-IF                                                   15550057
155600     ELSE                                                         15560057
155700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15570057
155800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15580057
155900                                   TO ASC-SELECTED-SW             15590057
156000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15600057
156100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15610057
156200         ELSE                                                     15620057
156300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15630057
156400                 CONTINUE                                         15640057
156500             ELSE                                                 15650057
156600*                -- ONLY ONE END-OF-RANGE ALLOWED --              15660057
156700                 MOVE PC-TSYMSG-00055                             15670057
156800                                   TO DP020-MSG-NUMBER            15680057
156900                 SET DP020-MSG-FATAL                              15690057
157000                                   TO TRUE                        15700057
157100                 MOVE -1           TO MR-SELECTL (PV-SUB)         15710057
157200                 SET DP030-SET-CURSOR-APPL-1                      15720057
157300                                   TO TRUE                        15730057
157400                 SET PS-ERROR      TO TRUE                        15740057
157500             END-IF                                               15750057
157600         END-IF                                                   15760057
157700     END-IF.                                                      15770057
157800                                                                  15780057
157900*----------------------------------------------------------------*15790057
158000*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *15800057
158100*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *15810057
158200*----------------------------------------------------------------*15820057
158300                                                                  15830057
158400 3400-CHECK-RANGE-SEQUENCE.                                       15840057
158500                                                                  15850057
158600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15860057
158700       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15870057
158800       AND  ASC-START-OF-SELECTED-RANGE >                         15880057
158900                                         ASC-END-OF-SELECTED-RANGE15890057
159000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15900057
159100         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15910057
159200         SET DP020-MSG-FATAL TO TRUE                              15920057
159300         SET PS-ERROR TO TRUE                                     15930057
159400         PERFORM 3410-POSITION-AT-ERROR                           15940057
159500     END-IF.                                                      15950057
159600                                                                  15960057
159700*----------------------------------------------------------------*15970057
159800*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *15980057
159900*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *15990057
160000*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *16000057
160100*----------------------------------------------------------------*16010057
160200                                                                  16020057
160300 3410-POSITION-AT-ERROR.                                          16030057
160400                                                                  16040057
160500     SET DP030-SET-CURSOR-APPL-1                                  16050057
160600                                   TO TRUE.                       16060057
160700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16070057
160800                    - PV-TOP-ITEM + 1.                            16080057
160900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16090057
161000         CONTINUE                                                 16100057
161100     ELSE                                                         16110057
161200         MOVE -1                   TO MR-SELECTL (PV-SUB)         16120057
161300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16130057
161400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16140057
161500     END-IF.                                                      16150057
161600*                                                                 16160057
161700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16170057
161800                    - PV-TOP-ITEM + 1.                            16180057
161900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16190057
162000         CONTINUE                                                 16200057
162100     ELSE                                                         16210057
162200         MOVE -1                   TO MR-SELECTL (PV-SUB)         16220057
162300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16230057
162400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16240057
162500     END-IF.                                                      16250057
162600/                                                                 16260057
162700*----------------------------------------------------------------*16270057
162800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16280057
162900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16290057
163000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16300057
163100*----------------------------------------------------------------*16310057
163200                                                                  16320057
163300 3500-MARK-RANGE-AS-SELECTED.                                     16330057
163400                                                                  16340057
163500     MOVE +1                       TO  ASC-BLK-SUB.               16350057
163600     PERFORM 3510-MARK-SELECTED-INDS                              16360057
163700         VARYING ASC-ITEM-SUB                                     16370057
163800         FROM 1 BY 1                                              16380057
163900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16390057
164000                                                                  16400057
164100     ADD +1                        TO ASC-BLK-SUB.                16410057
164200     PERFORM 3510-MARK-SELECTED-INDS                              16420057
164300         VARYING ASC-ITEM-SUB                                     16430057
164400         FROM 1 BY 1                                              16440057
164500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16450057
164600                                                                  16460057
164700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16470057
164800                                   TO  PV-LIST-ITEM-NUMBER.       16480057
164900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16490057
165000         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16500057
165100               PC-ITEMS-PER-PANEL).                               16510057
165200                                                                  16520057
165300     MOVE ASC-START-OF-SELECTED-RANGE                             16530057
165400                                   TO PV-START-OF-SELECTED-RANGE. 16540057
165500     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16550057
165600         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16560057
165700               PC-ITEMS-PER-PANEL).                               16570057
165800                                                                  16580057
165900     MOVE ASC-END-OF-SELECTED-RANGE                               16590057
166000                                   TO  PV-END-OF-SELECTED-RANGE.  16600057
166100     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16610057
166200         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16620057
166300               PC-ITEMS-PER-PANEL).                               16630057
166400     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16640057
166500         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16650057
166600                                                                  16660057
166700     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16670057
166800        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16680057
166900         MOVE +1                   TO ASC-BLK-SUB                 16690057
167000         PERFORM 5100-WRITE-TEMP-STORAGE                          16700057
167100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16710057
167200             PV-FIRST-BLOCK-IN-ARRAY - 1                          16720057
167300                                                                  16730057
167400         PERFORM                                                  16740057
167500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16750057
167600                   PV-PREV-BLOCK-IN-ARRAY                         16760057
167700             MOVE PV-FIRST-BLOCK-IN-RANGE                         16770057
167800                                   TO PV-BLOCK-NUMBER             16780057
167900             PERFORM 4410-READ-TEMP-STORAGE                       16790057
168000             PERFORM 3510-MARK-SELECTED-INDS                      16800057
168100                 VARYING ASC-ITEM-SUB                             16810057
168200                 FROM 1 BY 1                                      16820057
168300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16830057
168400             PERFORM 5100-WRITE-TEMP-STORAGE                      16840057
168500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16850057
168600         END-PERFORM                                              16860057
168700                                                                  16870057
168800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16880057
168900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16890057
169000         PERFORM                                                  16900057
169100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16910057
169200                   PV-LAST-BLOCK-IN-RANGE                         16920057
169300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16930057
169400                                   TO PV-BLOCK-NUMBER             16940057
169500             PERFORM 4410-READ-TEMP-STORAGE                       16950057
169600             PERFORM 3510-MARK-SELECTED-INDS                      16960057
169700                 VARYING ASC-ITEM-SUB                             16970057
169800                 FROM 1 BY 1                                      16980057
169900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16990057
170000             PERFORM 5100-WRITE-TEMP-STORAGE                      17000057
170100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17010057
170200         END-PERFORM                                              17020057
170300                                                                  17030057
170400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17040057
170500                                   TO PV-BLOCK-NUMBER             17050057
170600         PERFORM 4410-READ-TEMP-STORAGE                           17060057
170700     END-IF.                                                      17070057
170800                                                                  17080057
170900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17090057
171000                                      ASC-END-OF-SELECTED-RANGE.  17100057
171100/                                                                 17110057
171200*----------------------------------------------------------------*17120057
171300* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17130057
171400*----------------------------------------------------------------*17140057
171500                                                                  17150057
171600 3510-MARK-SELECTED-INDS.                                         17160057
171700                                                                  17170057
171800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17180057
171900                                ASC-ITEM-SUB) >                   17190057
172000         ASC-START-OF-SELECTED-RANGE)                             17200057
172100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17210057
172200                                ASC-ITEM-SUB) =                   17220057
172300         ASC-START-OF-SELECTED-RANGE)                             17230057
172400                                                                  17240057
172500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17250057
172600                                    ASC-ITEM-SUB) <               17260057
172700             ASC-END-OF-SELECTED-RANGE)                           17270057
172800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17280057
172900                                    ASC-ITEM-SUB) =               17290057
173000             ASC-END-OF-SELECTED-RANGE)                           17300057
173100                                                                  17310057
173200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17320057
173300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17330057
173400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17340057
173500                               TO TRUE                            17350057
173600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17360057
173700                               TO TRUE                            17370057
173800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17380057
173900             END-IF                                               17390057
174000         END-IF                                                   17400057
174100     END-IF.                                                      17410057
174200/                                                                 17420057
174300*----------------------------------------------------------------*17430057
174400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17440057
174500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17450057
174600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17460057
174700*    DISPLAY THE PANEL TO USER.                                  *17470057
174800*----------------------------------------------------------------*17480057
174900                                                                  17490057
175000 4000-BUILD-INITIAL-PANEL.                                        17500057
175100                                                                  17510057
175200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            17520057
175300                                 ASC-BLOCK-ENTRIES (2).           17530057
175400     MOVE +1                 TO ASC-BLK-SUB.                      17540057
175500     SET ASC-ITEMS-LEFT-ON-DB                                     17550057
175600         ASC-CAN-VERIFY                                           17560057
175700         ASC-CAN-UNVERIFY    TO TRUE.                             17570057
175800                                                                  17580057
175900     MOVE +0                 TO ASC-ITEM-SUB                      17590057
176000                                ASC-NUMBER-OF-ITEMS-READ          17600057
176100                                ASC-NUMBER-OF-SELECTED-ITEMS      17610057
176200                                ASC-HIGHEST-BLOCK-WRITTEN         17620057
176300                                ASC-START-OF-SELECTED-RANGE       17630057
176400                                ASC-END-OF-SELECTED-RANGE         17640057
176500                                ASC-ITEM-AT-TOP-OF-PANEL          17650057
176600                                ASC-TOT-EXP-QTY                   17660057
176700                                ASC-TOT-ACTUAL-QTY                17670057
176800                                ASC-TOT-VERFYD-QTY.               17680057
176900     PERFORM 4040-GET-DEPARTMENT.                                 17690057
177000                                                                  17700057
177100     PERFORM 4010-OPEN-CURSOR.                                    17710057
177200                                                                  17720057
177300     PERFORM 4300-READ-ITEMS-FROM-DB.                             17730057
177400                                                                  17740057
177500     PERFORM 4020-CLOSE-CURSOR.                                   17750057
177600                                                                  17760057
177700     MOVE +1                   TO  PV-TOP-ITEM.                   17770057
177800     MOVE SPACE                TO  ASC-START-ITEM-REQUEST.        17780057
177900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17790057
178000*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17800057
178100         SET DP020-FK-RETURN (DP020-SRC-AID)                      17810057
178200             DP020-MSG-FATAL   TO  TRUE                           17820057
178300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               17830057
178400     ELSE                                                         17840057
178500         MOVE -1               TO MR-SELECTL (1)                  17850057
178600         SET DP030-SET-CURSOR-APPL-1                              17860057
178700                               TO TRUE                            17870057
178800         PERFORM 5720-GET-TRECEIV-STATUS                          17880057
178900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17890057
179000         PERFORM 4030-GET-STORE-TYPE                              17900057
179100         MOVE ZERO             TO  RECDIS-ORD-LNE-NBR             17910057
179200         MOVE ZERO             TO  RECITM-PREPK-ID                17920057
179300         PERFORM 5475-CHECK-FOR-TROUBLE                           17930057
179400         MOVE PS-TROUBLE-SW    TO  ASC-TROUBLE-SW                 17940057
179500     END-IF.                                                      17950057
179600/                                                                 17960057
179700*----------------------------------------------------------------*17970057
179800* OPEN THE CURSOR.                                               *17980057
179900*----------------------------------------------------------------*17990057
180000                                                                  18000057
180100 4010-OPEN-CURSOR.                                                18010057
180200                                                                  18020057
180300     EXEC SQL                                                     18030057
180400          OPEN LIST-CSR                                           18040057
180500     END-EXEC.                                                    18050057
180600                                                                  18060057
180700     EVALUATE TRUE                                                18070057
180800         WHEN SQLCODE = ZERO                                      18080057
180900         WHEN SQLCODE = +100                                      18090057
181000         WHEN SQLCODE = -904                                      18100057
181100         WHEN SQLCODE = -913                                      18110057
181200              CONTINUE                                            18120057
181300         WHEN SQLWARN0 NOT = SPACES                               18130057
181400         WHEN SQLCODE < ZERO                                      18140057
181500         WHEN SQLCODE > ZERO                                      18150057
181600              MOVE '4010-OPEN-CURSOR'                             18160057
181700                                   TO  DP013-PARAGRAPH            18170057
181800              MOVE 'OPEN LIST CURSOR - '                          18180057
181900                                   TO  DP013-MESSAGE-TEXT (1)     18190057
182000              MOVE SQLCA           TO  DP013-SQLCA                18200057
182100              MOVE 'TRECEIV '      TO  DP013-DB2-TABLE-NAME (1)   18210057
182200              MOVE 'TRECITM '      TO  DP013-DB2-TABLE-NAME (2)   18220057
182300              SET DP013-DB2-ABEND                                 18230057
182400                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18240057
182500                 PERFORM DP013-0000-PROCESS-ABEND                 18250057
182600         END-EVALUATE.                                            18260057
182700/                                                                 18270057
182800*----------------------------------------------------------------*18280057
182900* CLOSE THE TRECITM CURSOR.                                      *18290057
183000*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *18300057
183100*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *18310057
183200*   USER.                                                        *18320057
183300*----------------------------------------------------------------*18330057
183400                                                                  18340057
183500 4020-CLOSE-CURSOR.                                               18350057
183600                                                                  18360057
183700     EXEC SQL                                                     18370057
183800          CLOSE LIST-CSR                                          18380057
183900     END-EXEC.                                                    18390057
184000                                                                  18400057
184100     EVALUATE TRUE                                                18410057
184200         WHEN SQLCODE = ZERO                                      18420057
184300             CONTINUE                                             18430057
184400         WHEN SQLWARN0 NOT = SPACES                               18440057
184500         WHEN SQLCODE < ZERO                                      18450057
184600         WHEN SQLCODE > ZERO                                      18460057
184700             MOVE '4020-CLOSE-CURSOR'                             18470057
184800                               TO DP013-PARAGRAPH                 18480057
184900             MOVE 'CLOSE LIST CURSOR '                            18490057
185000                               TO DP013-MESSAGE-TEXT (1)          18500057
185100             MOVE SQLCA        TO DP013-SQLCA                     18510057
185200             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        18520057
185300             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        18530057
185400             SET DP013-DB2-ABEND                                  18540057
185500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18550057
185600             PERFORM DP013-0000-PROCESS-ABEND                     18560057
185700     END-EVALUATE.                                                18570057
185800                                                                  18580066
185900*----------------------------------------------------------------*18590057
186000*    GET THE STORE TYPE FOR THE "IP" STATUS CODES.               *18600057
186100*----------------------------------------------------------------*18610057
186300 4030-GET-STORE-TYPE.                                             18630057
186400                                                                  18640057
186740     INITIALIZE XL071-COMMAREA-REC.                               18674064
186750     MOVE ASC-OPER-UNT-ID    TO XL071-LOCATION-NUMBER.            18675064
186760                                                                  18676064
186770     CALL PC-LOCATION-MODULE  USING DFHEIBLK                      18677064
186780                                    XL071-COMMAREA                18678064
186790                                    XL071-COMMAREA-REC.           18679064
186791                                                                  18679164
186792     IF XL071-NO-ERRORS                                           18679264
186793          IF XL071-LOC-TYP-CDE EQUAL PC-DC                        18679364
186794              SET ASC-DC-STORE-TYPE     TO  TRUE                  18679464
186795          ELSE                                                    18679564
186796              SET ASC-NOT-DC-STORE-TYPE TO  TRUE                  18679664
186797          END-IF                                                  18679764
186798     ELSE                                                         18679864
189200         MOVE '4030-GET-STORE-TYPE'  TO DP013-PARAGRAPH           18920064
189400         MOVE 'GET STORE TYPE'       TO DP013-MESSAGE-TEXT (1)    18940064
189600         MOVE SQLCA        TO DP013-SQLCA                         18960064
189700         MOVE 'XLT_LOC '   TO DP013-DB2-TABLE-NAME (1)            18970064
189800         SET DP013-DB2-ABEND                                      18980064
189900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18990064
190000         PERFORM DP013-0000-PROCESS-ABEND                         19000064
190010     END-IF.                                                      19001064
190200                                                                  19020064
190300 4040-GET-DEPARTMENT.                                             19030057
190400                                                                  19040057
190500     EXEC SQL                                                     19050057
190600          SELECT DEPT_NBR                                         19060057
190700          INTO                                                    19070057
190800                :PV-DS-DEPT-NBR                                   19080057
190900          FROM                                                    19090057
191000                 TPURCHS                                          19100057
191100          WHERE                                                   19110057
191200                 PO_NBR             =  :ASC-PO-NBR                19120057
191300          AND    VER_STATUS_CDE     =  :PC-A                      19130057
191400     END-EXEC.                                                    19140057
191500                                                                  19150057
191600     EVALUATE TRUE                                                19160057
191700         WHEN SQLCODE = ZERO                                      19170057
191800              CONTINUE                                            19180057
191900         WHEN SQLCODE = -904                                      19190057
192000         WHEN SQLCODE = -911                                      19200057
192100         WHEN SQLCODE = -913                                      19210057
192200             PERFORM 9900-SOFT-ABORT                              19220057
192300         WHEN SQLCODE = +100                                      19230057
192400              CONTINUE                                            19240057
192500         WHEN SQLWARN0 NOT = SPACE                                19250057
192600         WHEN SQLCODE NOT = ZERO                                  19260057
192700              MOVE '4040-GET-DEPARTMENT'                          19270057
192800                               TO DP013-PARAGRAPH                 19280057
192900              MOVE 'GET THE DEPARTMENT NUMBER'                    19290057
193000                               TO DP013-MESSAGE-TEXT (1)          19300057
193100              MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)        19310057
193200              MOVE SQLCA       TO DP013-SQLCA                     19320057
193300              SET DP013-DB2-ABEND                                 19330057
193400                               TO TRUE                            19340057
193500              PERFORM DP013-0000-PROCESS-ABEND                    19350057
193600     END-EVALUATE.                                                19360057
193700/                                                                 19370057
193800*----------------------------------------------------------------*19380057
193900*    SET UP THE HOST VARIABLES.                                  *19390057
194000*----------------------------------------------------------------*19400057
194100                                                                  19410057
194200 4100-PREPARE-CURSOR.                                             19420057
194300                                                                  19430057
194400     MOVE RC017-OPER-UNT-ID       TO  ASC-OPER-UNT-ID.            19440057
194500     MOVE RC017-FCLTY-ID          TO  ASC-FCLTY-ID.               19450057
194600     MOVE RC017-PO-NBR            TO  ASC-PO-NBR.                 19460057
194700     MOVE RC017-REC-SEQ-NBR       TO  ASC-REC-SEQ-NBR.            19470057
194800     MOVE RC017-FCLTY-NME         TO  ASC-FCLTY-NME.              19480057
194900                                                                  19490057
195000     IF  RC017-PO-LNE-NBR GREATER THAN ZERO                       19500057
195100         MOVE RC017-PO-LNE-NBR    TO  ASC-PO-LNE-NBR-LOW          19510057
195200                                      ASC-PO-LNE-NBR-HIGH         19520057
195300     ELSE                                                         19530057
195400         MOVE ZERO                TO  ASC-PO-LNE-NBR-LOW          19540057
195500         MOVE PC-9999             TO  ASC-PO-LNE-NBR-HIGH         19550057
195600     END-IF.                                                      19560057
195700/                                                                 19570057
195800*----------------------------------------------------------------*19580057
195900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19590057
196000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19600057
196100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19610057
196200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19620057
196300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19630057
196400*                                                                *19640057
196500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19650057
196600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19660057
196700*    UPON INITIALIZATION.                                        *19670057
196800*----------------------------------------------------------------*19680057
196900                                                                  19690057
197000 4300-READ-ITEMS-FROM-DB.                                         19700057
197100                                                                  19710057
197200     PERFORM                                                      19720057
197300         VARYING PV-READ-COUNT                                    19730057
197400         FROM 1 BY 1                                              19740057
197500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19750057
197600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19760057
197700                                                                  19770057
197800         PERFORM 4310-FETCH                                       19780057
197900                                                                  19790057
198000         MOVE RECITM-PREPK-ID      TO  ASC-PREPK-ID               19800057
198100                                                                  19810057
198200*----------------------------------------------------------------*19820057
198300*                                               **   WR # 21361  *19830063
198400* ADDED CODE TO CHECK FOR THE DUMMY SKU AND CALL TO XLKUT001.    *19840060
198410* ADDED CODE TO MOVE PV-DS-DEPT-NBR TO ASC-DEPT-NBR.             *19841062
198500*----------------------------------------------------------------*19850057
198600         IF PURITM-ITM-NBR < 0                                    19860057
198700            MOVE '4300-READ-ITEMS-FROM-DB'                        19870057
198800                             TO DP013-PARAGRAPH                   19880057
198900            MOVE 'FETCH LIST CURSOR'                              19890057
199000                             TO DP013-MESSAGE-TEXT (1)            19900057
199100            MOVE SQLCA       TO DP013-SQLCA                       19910057
199200            SET DP013-DB2-ABEND                                   19920057
199300                             TO TRUE                              19930057
199400            PERFORM DP013-0000-PROCESS-ABEND                      19940057
199500         END-IF                                                   19950057
199600                                                                  19960057
199700         IF PURITM-ITM-NBR = 0                                    19970057
199800            IF PURITM-SKU-SEQ-NBR = PC-000                        19980057
199900               MOVE '00000000'     TO PV-SKU-NBR                  19990063
200000            ELSE                                                  20000062
200100               IF PURITM-SKU-SEQ-NBR = PC-999                     20010062
200200                  MOVE '99999999'  TO PV-SKU-NBR                  20020063
200570               ELSE                                               20057062
200571                  MOVE '4300-READ-ITEMS-FROM-DB'                  20057162
200572                                   TO DP013-PARAGRAPH             20057262
200573                  MOVE 'SELECT ROW FROM PURITM'                   20057362
200574                                   TO DP013-MESSAGE-TEXT (1)      20057462
200575                  MOVE SQLCA       TO DP013-SQLCA                 20057562
200576                  SET DP013-DB2-ABEND                             20057662
200577                                   TO TRUE                        20057762
200578                  PERFORM DP013-0000-PROCESS-ABEND                20057862
200597               END-IF                                             20059762
200598            END-IF                                                20059862
200599         END-IF                                                   20059962
200600                                                                  20060062
200610         IF PURITM-ITM-NBR > 0 AND                                20061057
200700            PS-CALL-API-YES    AND                                20070057
200800            ((PURITM-SKU-SEQ-NBR NOT = PC-000) AND                20080057
200900             (PURITM-SKU-SEQ-NBR NOT = PC-999))                   20090057
201000              PERFORM 4315-CALL-XLKUT-DOMAIN-PGM                  20100057
201100         END-IF                                                   20110057
201200                                                                  20120057
201300         IF  ASC-ITEMS-LEFT-ON-DB                                 20130057
201400                                                                  20140057
201500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                20150057
201600                 ADD +1            TO  ASC-ITEM-SUB               20160057
201700             ELSE                                                 20170057
201800                 ADD +1            TO  ASC-BLK-SUB                20180057
201900                 MOVE +1           TO  ASC-ITEM-SUB               20190057
202000                                                                  20200057
202100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         20210057
202200                     MOVE +1       TO  ASC-BLK-SUB                20220057
202300                     SET ASC-BLOCK-MODIFIED (1)                   20230057
202400                                   TO  TRUE                       20240057
202500                     PERFORM 5100-WRITE-TEMP-STORAGE              20250057
202600                     MOVE ASC-BLOCK-ENTRIES                       20260057
202700                               (PC-MAX-BLOCKS-IN-ARRAY)           20270057
202800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 20280057
202900                     ADD +1        TO  ASC-BLK-SUB                20290057
203000                     INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)    20300057
203100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      20310057
203200                                   TO  TRUE                       20320057
203300                 END-IF                                           20330057
203400             END-IF                                               20340057
203500                                                                  20350057
203600                 ADD +1            TO ASC-NUMBER-OF-ITEMS-READ    20360057
203700                 MOVE ASC-NUMBER-OF-ITEMS-READ                    20370057
203800                                   TO  ASC-LIST-ITEM-NUMBER       20380057
203900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20390057
204000                 MOVE RECITM-ORD-LNE-NBR                          20400057
204100                                   TO  ASC-PO-LNE-NBR             20410057
204200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20420057
204300                 MOVE PURITM-CL-NBR TO PV-DS-CL-NBR               20430057
204310                 MOVE PV-DS-DEPT-NBR TO ASC-DEPT-NBR              20431062
204600                 MOVE PV-DISPLAY-SKU                              20460057
204700                                   TO  ASC-SKU                    20470057
204800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20480057
204900                 MOVE RECITM-ORD-LNE-NBR                          20490057
205000                                       TO  RECDIS-ORD-LNE-NBR     20500057
205100                 PERFORM 5475-CHECK-FOR-TROUBLE                   20510057
205200                 MOVE PS-TROUBLE-SW    TO  ASC-LINE-TRBL-SW       20520057
205300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20530057
205400                 MOVE RECITM-RCPT-DISTR-UPD-CDE TO                20540057
205500                                           ASC-DISTR-UPD-SW       20550057
205600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20560057
205700                 PERFORM 4320-SUM-TRECDIS                         20570057
205800                 MOVE RECDIS-AP-VERIFY-ITM-QTY                    20580057
205900                                   TO  ASC-VFY-QTY                20590057
206000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20600057
206100                 ADD RECDIS-AP-VERIFY-ITM-QTY                     20610057
206200                                   TO  ASC-TOT-VERFYD-QTY         20620057
206300                 MOVE RECDIS-EXPTED-ITM-QTY                       20630057
206400                                   TO  ASC-EXP-QTY                20640057
206500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20650057
206600                 ADD RECDIS-EXPTED-ITM-QTY                        20660057
206700                                   TO  ASC-TOT-EXP-QTY            20670057
206800                 MOVE RECDIS-VERIFY-ITM-QTY                       20680057
206900                                   TO  ASC-ACTUAL-QTY             20690057
207000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20700057
207100                 ADD RECDIS-VERIFY-ITM-QTY                        20710057
207200                                   TO  ASC-TOT-ACTUAL-QTY         20720057
207300         END-IF                                                   20730057
207400     END-PERFORM.                                                 20740057
207500*----------------------------------------------------------------*20750057
207600* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *20760063
207700*----------------------------------------------------------------*20770057
207800                                                                  20780057
207900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20790057
208000         MOVE +1               TO ASC-BLK-SUB                     20800057
208100         PERFORM 5100-WRITE-TEMP-STORAGE                          20810057
208200         ADD +1                TO ASC-BLK-SUB                     20820057
208300         PERFORM 5100-WRITE-TEMP-STORAGE                          20830057
208400                                                                  20840057
208500         MOVE 1                TO ASC-BLK-SUB                     20850057
208600                                  PV-BLOCK-NUMBER                 20860057
208700         PERFORM 4410-READ-TEMP-STORAGE                           20870057
208800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20880057
208900             MOVE 2            TO ASC-BLK-SUB                     20890057
209000                                  PV-BLOCK-NUMBER                 20900057
209100             PERFORM 4410-READ-TEMP-STORAGE                       20910057
209200         END-IF                                                   20920057
209300     END-IF.                                                      20930057
209400/                                                                 20940057
209500*----------------------------------------------------------------*20950057
209600*    FETCH THE CURSOR.                                           *20960057
209700*----------------------------------------------------------------*20970057
209800******************************************************************20980057
209900*                                                   WR # 21361   *20990063
210000* ADDED CODE TO RETRIEVE ITEM NUMBER FROM TPURITM TABLE.         *21000057
210100******************************************************************21010057
210200                                                                  21020057
210300 4310-FETCH.                                                      21030057
210400                                                                  21040057
210410     SET PS-CALL-API-NO TO TRUE                                   21041062
210420                                                                  21042061
210500     EXEC SQL                                                     21050057
210600          FETCH                                                   21060057
210700                LIST-CSR                                          21070057
210800          INTO                                                    21080057
210900                :RECEIV-FS-POST-TMST                              21090057
211000              , :RECITM-ORD-LNE-NBR                               21100057
211100              , :RECITM-STATUS-CDE                                21110057
211200              , :RECITM-RCPT-DISTR-UPD-CDE                        21120057
211300              , :PURITM-CL-NBR                                    21130057
211400              , :PURITM-SKU-SEQ-NBR                               21140057
211500              , :RECITM-PREPK-ID                                  21150057
211600              , :PURITM-ITM-NBR                                   21160057
211700     END-EXEC.                                                    21170057
211800                                                                  21180057
211900******************************************************************21190057
212000* IF THE SQL STATEMENT IS SUCCESSFUL, THEN SET PS-CALL-API-YES   *21200057
212100* TO TRUE.                                ** WR # 21361          *21210063
212200******************************************************************21220057
212300     EVALUATE TRUE                                                21230057
212400         WHEN SQLCODE = ZERO                                      21240057
212500              SET PS-CALL-API-YES TO TRUE                         21250057
212600         WHEN SQLCODE = +100                                      21260057
212700              CONTINUE                                            21270057
212800         WHEN SQLWARN0 NOT = SPACE                                21280057
212900         WHEN SQLCODE NOT = ZERO                                  21290057
213000              MOVE '4310-FETCH-CURSOR'                            21300057
213100                               TO DP013-PARAGRAPH                 21310057
213200              MOVE 'FETCH LIST CURSOR'                            21320057
213300                               TO DP013-MESSAGE-TEXT (1)          21330057
213400              MOVE SQLCA       TO DP013-SQLCA                     21340057
213500              SET DP013-DB2-ABEND                                 21350057
213600                               TO TRUE                            21360057
213700              PERFORM DP013-0000-PROCESS-ABEND                    21370057
213800     END-EVALUATE.                                                21380057
213900                                                                  21390057
214000     IF  SQLCODE EQUAL +100                                       21400057
214100         SET ASC-NO-ITEMS-LEFT-ON-DB                              21410057
214200             PS-STORE-REC      TO  TRUE                           21420057
214300     END-IF.                                                      21430057
214400*----------------------------------------------------------------*21440057
214500* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *21450063
214600*----------------------------------------------------------------*21460057
214700/                                                                 21470057
214800*----------------------------------------------------------------*21480057
214900*                                               **   WR # 21361  *21490063
215000* CODE FOR ACCESSING LOGISTICS DOMAIN ITEM ACCESS MODULE         *21500057
215100*----------------------------------------------------------------*21510057
215200 4315-CALL-XLKUT-DOMAIN-PGM.                                      21520057
215300                                                                  21530057
215400     INITIALIZE XL001-ITEM-COMMAREA                               21540057
215600                                                                  21560057
215700     MOVE PURITM-ITM-NBR            TO XL001-KEY-ITM-NBR          21570057
215800                                                                  21580057
215900     SET  XL001-BY-ITEM                                           21590057
216000          XL001-SELECT-SKU          TO TRUE                       21600057
216100                                                                  21610057
216200     CALL XL001-VSM-PGM USING  DFHEIBLK                           21620057
216300                               XL001-COMMAREA                     21630057
216400                               XL001-ITEM-COMMAREA                21640057
216500                                                                  21650057
216600     EVALUATE TRUE                                                21660057
216700         WHEN XL001-SUCCESSFUL                                    21670057
216800               MOVE XL001-SKU-NBR   TO PV-SKU-NBR                 21680063
217000                                                                  21700057
217100         WHEN XL001-SKU-SQLCODE = +100                            21710057
217200               MOVE SPACES          TO PV-SKU-NBR                 21720063
217300                                                                  21730057
217400         WHEN XL001-SKU-CONTENTION                                21740057
217500               MOVE '7020-SELECT-SKU-BY-ITM'                      21750057
217600                                    TO DP013-PARAGRAPH            21760057
217700               MOVE 'SKU CONTENTION'                              21770057
217800                                    TO DP013-MESSAGE-TEXT (1)     21780057
217900               MOVE XL001-SQLCA     TO DP013-SQLCA                21790057
218000               SET DP013-DB2-ABEND  TO TRUE                       21800057
218100               PERFORM DP013-0000-PROCESS-ABEND                   21810057
218200                                                                  21820057
218300         WHEN OTHER                                               21830057
218400               MOVE '7020-SELECT-SKU-BY-ITM'                      21840057
218500                                    TO DP013-PARAGRAPH            21850057
218600               MOVE 'SELECT ROW FROM XLV_SKU'                     21860057
218700                                    TO DP013-MESSAGE-TEXT (1)     21870057
218800               MOVE XL001-SQLCA     TO DP013-SQLCA                21880057
218900               SET DP013-DB2-ABEND  TO TRUE                       21890057
219000               PERFORM DP013-0000-PROCESS-ABEND                   21900057
219100                                                                  21910057
219200     END-EVALUATE.                                                21920057
219300*----------------------------------------------------------------*21930057
219400* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *21940063
219500*----------------------------------------------------------------*21950057
219600                                                                  21960057
219700 4320-SUM-TRECDIS.                                                21970057
219800                                                                  21980057
219900     MOVE ZERO                 TO  RECDIS-EXPTED-ITM-QTY          21990057
220000                                   RECDIS-VERIFY-ITM-QTY          22000057
220100                                   RECDIS-AP-VERIFY-ITM-QTY.      22010057
220200                                                                  22020057
220300     EXEC SQL                                                     22030057
220400          SELECT                                                  22040057
220500                 SUM(EXPTED_ITM_QTY)                              22050057
220600               , SUM(VERIFY_ITM_QTY)                              22060057
220700               , SUM(AP_VERIFY_ITM_QTY)                           22070057
220800          INTO                                                    22080057
220900                :RECDIS-EXPTED-ITM-QTY                            22090057
221000              , :RECDIS-VERIFY-ITM-QTY                            22100057
221100              , :RECDIS-AP-VERIFY-ITM-QTY                         22110057
221200          FROM                                                    22120057
221300                 TRECDIS                                          22130057
221400          WHERE                                                   22140057
221500                ORD_NBR          =  :ASC-PO-NBR                   22150057
221600           AND  ORD_LNE_NBR      =  :RECITM-ORD-LNE-NBR           22160057
221700           AND  REC_SEQ_NBR      =  :ASC-REC-SEQ-NBR              22170057
221800           AND  FCLTY_ID         =  :ASC-FCLTY-ID                 22180057
221900           AND  OPER_UNT_ID      =  :ASC-OPER-UNT-ID              22190057
222100     END-EXEC.                                                    22210057
222200                                                                  22220057
222300     EVALUATE TRUE                                                22230057
222400         WHEN SQLCODE = ZERO                                      22240057
222500         WHEN SQLCODE = +100                                      22250057
222600         WHEN SQLCODE = -305                                      22260057
222700              CONTINUE                                            22270057
222800         WHEN SQLWARN0 NOT = SPACE                                22280057
222900         WHEN SQLCODE NOT = ZERO                                  22290057
223000              MOVE '4320-SUM-TRECDIS'                             22300057
223100                               TO DP013-PARAGRAPH                 22310057
223200              MOVE 'SUMMARIZE AP VERIFIED COUNT'                  22320057
223300                               TO DP013-MESSAGE-TEXT (1)          22330057
223400              MOVE SQLCA       TO DP013-SQLCA                     22340057
223500              SET DP013-DB2-ABEND                                 22350057
223600                               TO TRUE                            22360057
223700              PERFORM DP013-0000-PROCESS-ABEND                    22370057
223800     END-EVALUATE.                                                22380057
223900/                                                                 22390057
224000*----------------------------------------------------------------*22400057
224100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22410057
224200*----------------------------------------------------------------*22420057
224300                                                                  22430057
224400 4400-MOVE-COMMAREA-TO-SCREEN.                                    22440057
224500                                                                  22450057
224600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22460057
224700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22470057
224800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22480057
224900             MOVE +1    TO ASC-BLK-SUB                            22490057
225000             PERFORM 5100-WRITE-TEMP-STORAGE                      22500057
225100             ADD +1     TO ASC-BLK-SUB                            22510057
225200             PERFORM 5100-WRITE-TEMP-STORAGE                      22520057
225300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22530057
225400                 GIVING PV-BLOCK-NUMBER                           22540057
225500                 REMAINDER PV-REMAINDER                           22550057
225600             IF  PV-REMAINDER > ZERO                              22560057
225700                 ADD +1 TO PV-BLOCK-NUMBER                        22570057
225800             END-IF                                               22580057
225900             MOVE +1    TO ASC-BLK-SUB                            22590057
226000             PERFORM 4410-READ-TEMP-STORAGE                       22600057
226100             ADD +1     TO ASC-BLK-SUB                            22610057
226200                           PV-BLOCK-NUMBER                        22620057
226300             PERFORM 4410-READ-TEMP-STORAGE                       22630057
226400     END-IF.                                                      22640057
226500                                                                  22650057
226600     MOVE +1            TO ASC-BLK-SUB.                           22660057
226700     COMPUTE ASC-ITEM-SUB =                                       22670057
226800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22680057
226900         + PC-ITEMS-PER-PANEL).                                   22690057
227000                                                                  22700057
227100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22710057
227200         ADD +1         TO ASC-BLK-SUB                            22720057
227300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22730057
227400     END-IF.                                                      22740057
227500                                                                  22750057
227600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22760057
227700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22770057
227800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22780057
227900     PERFORM 4420-FORMAT-LIST-LINES                               22790057
228000         VARYING PV-SUB                                           22800057
228100         FROM PC-ITEMS-PER-PANEL BY -1                            22810057
228200         UNTIL PV-SUB < +1.                                       22820057
228300                                                                  22830057
228400     COMPUTE ASC-ITEMS-DISPLAYED =                                22840057
228500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22850057
228600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   22860057
228700     IF  PS-NO-ERROR                                              22870057
228800         MOVE PV-TOP-ITEM          TO ASTRTITO                    22880057
228900     END-IF.                                                      22890057
229000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22900057
229100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22910057
229200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22920057
229300                                   TO ASELITO.                    22930057
229400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     22940057
229500                                                                  22950057
229600     IF  DP020-MSG-NUMBER-X = SPACE                               22960057
229700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22970057
229800*            --- MORE ITEMS TO DISPLAY ----                       22980057
229900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22990057
230000             SET DP020-MSG-INFORMATIONAL TO TRUE                  23000057
230100         END-IF                                                   23010057
230200     END-IF.                                                      23020057
230300                                                                  23030057
230310*----------------------------------------------------------------*23031060
230311*                                               ** WR # 21361    *23031163
230312* ADDED CODE TO MOVE ASC-DEPT-NBR TO MAP OUTPUT FIELD.           *23031260
230320*----------------------------------------------------------------*23032060
230400     MOVE ASC-PO-NBR               TO ARCVNBRO.                   23040057
230500     MOVE ASC-REC-SEQ-NBR          TO ARCVSEQO.                   23050057
230600     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     23060057
230700     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    23070057
230800     MOVE ASC-FCLTY-NME            TO AFCLNAMO.                   23080057
230810     MOVE ASC-DEPT-NBR             TO ADEPTO.                     23081060
230900     MOVE ASC-RECEIV-STATUS-CDE    TO ARCSTATO.                   23090057
231000     MOVE ASC-RECEIV-VRFY-INFO     TO ARCVFYAO.                   23100057
231100     MOVE ASC-TOT-EXP-QTY          TO ATPSLPQO.                   23110057
231200     MOVE ASC-TOT-ACTUAL-QTY       TO ATACTLQO.                   23120057
231300     MOVE ASC-TOT-VERFYD-QTY       TO ATVFYDQO.                   23130057
231400                                                                  23140057
231410*----------------------------------------------------------------*23141060
231420* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *23142063
231430*----------------------------------------------------------------*23143060
231500*----------------------------------------------------------------*23150057
231600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23160057
231700*----------------------------------------------------------------*23170057
231800                                                                  23180057
231900 4410-READ-TEMP-STORAGE.                                          23190057
232000                                                                  23200057
232100     EXEC CICS                                                    23210057
232200         READQ TS                                                 23220057
232300             QUEUE (ASC-LIST-QUEUE-NAME)                          23230057
232400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23240057
232500             ITEM  (PV-BLOCK-NUMBER)                              23250057
232600             RESP  (PV-CICS-RESP)                                 23260057
232700     END-EXEC.                                                    23270057
232800                                                                  23280057
232900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23290057
233000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23300057
233100         CONTINUE                                                 23310057
233200     ELSE                                                         23320057
233300         SET DP013-CICS-ABEND     TO TRUE                         23330057
233400         SET DP013-NO-ROLLBACK    TO TRUE                         23340057
233500         MOVE '4410-READ-TEMP-STORAGE'                            23350057
233600                                  TO DP013-PARAGRAPH              23360057
233700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23370057
233800                                  TO DP013-MESSAGE-TEXT(1)        23380057
233900         PERFORM DP013-0000-PROCESS-ABEND                         23390057
234000     END-IF.                                                      23400057
234100                                                                  23410057
234200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23420057
234300                                                                  23430057
234400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23440057
234500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23450057
234600     END-IF.                                                      23460057
234700/                                                                 23470057
234800*----------------------------------------------------------------*23480057
234900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23490057
235000*----------------------------------------------------------------*23500057
235100                                                                  23510057
235200 4420-FORMAT-LIST-LINES.                                          23520057
235300                                                                  23530057
235400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23540057
235500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23550057
235600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      23560057
235700         MOVE SPACE              TO MR-SELECTI      (PV-SUB)      23570057
235800                                    MR-ACTION       (PV-SUB)      23580057
235900                                    MR-PO-LNE-NBR-X (PV-SUB)      23590057
236000                                    MR-EXP-QTY-X    (PV-SUB)      23600057
236100                                    MR-ACT-QTY-X    (PV-SUB)      23610057
236200                                    MR-VFY-QTY-X    (PV-SUB)      23620057
236300                                    MR-SKU          (PV-SUB)      23630057
236400     ELSE                                                         23640057
236500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23650057
236600                                                   > SPACE        23660057
236700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23670057
236800                                 TO MR-SELECTI (PV-SUB)           23680057
236900         ELSE                                                     23690057
237000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23700057
237100                                 TO MR-SELECTI (PV-SUB)           23710057
237200         END-IF                                                   23720057
237300                                                                  23730057
237400         IF  DP030-SET-CURSOR-TRAILER                             23740057
237500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)23750057
237600                 > SPACE)                                         23760057
237700               OR (PV-SUB = 1))                                   23770057
237800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23780057
237900                MOVE -1          TO MR-SELECTL (PV-SUB)           23790057
238000             END-IF                                               23800057
238100         END-IF                                                   23810057
238200                                                                  23820057
238300         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23830057
238400             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           23840057
238500                                 TO MR-ACTION         (PV-SUB)    23850057
238600             MOVE ASC-PO-LNE-NBR   (ASC-BLK-SUB ASC-ITEM-SUB)     23860057
238700                                 TO MR-PO-LNE-NBR     (PV-SUB)    23870057
238800             MOVE ASC-VFY-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)     23880057
238900                                 TO MR-VFY-QTY        (PV-SUB)    23890057
239000             MOVE ASC-EXP-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)     23900057
239100                                 TO MR-EXP-QTY        (PV-SUB)    23910057
239200             MOVE ASC-ACTUAL-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)  23920057
239300                                 TO MR-ACT-QTY        (PV-SUB)    23930057
239400             MOVE ASC-SKU          (ASC-BLK-SUB ASC-ITEM-SUB)     23940057
239500                                 TO MR-SKU            (PV-SUB)    23950057
239600         END-IF                                                   23960057
239700     END-IF.                                                      23970057
239800                                                                  23980057
239900     SUBTRACT +1 FROM ASC-ITEM-SUB                                23990057
240000     IF  ASC-ITEM-SUB < + 1                                       24000057
240100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24010057
240200         MOVE +1                 TO ASC-BLK-SUB                   24020057
240300     END-IF.                                                      24030057
240400                                                                  24040057
240500******************************************************************24050057
240600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **24060057
240700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **24070057
240800** ISSUE A WARNING.                                             **24080057
240900******************************************************************24090057
241000                                                                  24100057
241100 4430-CHECK-FOR-BEGIN-AND-END.                                    24110057
241200                                                                  24120057
241300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24130057
241400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24140057
241500*            -- NO END-OF-RANGE SPECFIED ---                      24150057
241600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24160057
241700             SET DP020-MSG-WARNING TO TRUE                        24170057
241800             PERFORM 4431-POSITION-AT-WARNING                     24180057
241900         END-IF                                                   24190057
242000     ELSE                                                         24200057
242100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24210057
242200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24220057
242300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24230057
242400             SET DP020-MSG-WARNING TO TRUE                        24240057
242500             PERFORM 4431-POSITION-AT-WARNING                     24250057
242600         END-IF                                                   24260057
242700     END-IF.                                                      24270057
242800******************************************************************24280057
242900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **24290057
243000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **24300057
243100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **24310057
243200** POSITION THE CURSOR THERE.                                   **24320057
243300******************************************************************24330057
243400                                                                  24340057
243500 4431-POSITION-AT-WARNING.                                        24350057
243600                                                                  24360057
243700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24370057
243800                    - PV-TOP-ITEM + 1.                            24380057
243900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24390057
244000         CONTINUE                                                 24400057
244100     ELSE                                                         24410057
244200         SET DP030-SET-CURSOR-APPL-1                              24420057
244300                                   TO TRUE                        24430057
244400         MOVE -1                   TO MR-SELECTL (PV-SUB)         24440057
244500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24450057
244600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24460057
244700     END-IF.                                                      24470057
244800                                                                  24480057
244900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24490057
245000                    - PV-TOP-ITEM + 1.                            24500057
245100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24510057
245200         CONTINUE                                                 24520057
245300     ELSE                                                         24530057
245400         SET DP030-SET-CURSOR-APPL-1                              24540057
245500                                   TO TRUE                        24550057
245600         MOVE -1                   TO MR-SELECTL (PV-SUB)         24560057
245700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24570057
245800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24580057
245900     END-IF.                                                      24590057
246000/                                                                 24600057
246100*----------------------------------------------------------------*24610057
246200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *24620057
246300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *24630057
246400* FOR THE SELECTED ITEMS QUEUE.                                  *24640057
246500*                                                                *24650057
246600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *24660057
246700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *24670057
246800* THE ARRAY IS FULL.                                             *24680057
246900*----------------------------------------------------------------*24690057
247000                                                                  24700057
247100 5000-PREPARE-SEL-QUEUE.                                          24710057
247200                                                                  24720057
247300     MOVE +1                   TO  ASC-BLK-SUB.                   24730057
247400     PERFORM 5100-WRITE-TEMP-STORAGE.                             24740057
247500     ADD +1                    TO  ASC-BLK-SUB.                   24750057
247600     PERFORM 5100-WRITE-TEMP-STORAGE.                             24760057
247700                                                                  24770057
247800*    INITIALIZE RC017-INTER-APPL-COMMAREA.                        24780057
247900     MOVE ASC-OPER-UNT-ID      TO  RC017-OPER-UNT-ID.             24790057
248000     MOVE ASC-FCLTY-ID         TO  RC017-FCLTY-ID.                24800057
248100     MOVE ASC-PO-NBR           TO  RC017-PO-NBR.                  24810057
248200     MOVE ASC-REC-SEQ-NBR      TO  RC017-REC-SEQ-NBR.             24820057
248300     MOVE ASC-SEL-QUEUE-NAME   TO  RC017-SEL-QUEUE-NAME.          24830057
248400     MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)                      24840057
248500                               TO  PV-DISPLAY-SKU.                24850057
248600*    MOVE PV-DS-DEPT-NBR       TO  RC017-DEPT.                    24860057
248700*    MOVE PV-DS-CL-NBR         TO  RC017-CL.                      24870057
249300*    MOVE PV-SKU-NBR           TO  RC017-SEQ.                     24930063
249800     MOVE ASC-RECEIV-STATUS-CDE                                   24980057
249900                               TO  RC017-PKSL-STAT-CDES.          24990057
250000     PERFORM 6010-DELETE-SEL-QUEUE.                               25000057
250100                                                                  25010057
250200     SET ASC-UPDATE-TSQ        TO  TRUE.                          25020057
250300                                                                  25030057
250400     SET RC013-IDX             TO  1.                             25040057
250500     MOVE ZERO                 TO RC017-NUMBER-OF-TS-ITEMS.       25050057
250600     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        25060057
250700                                                                  25070057
250800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25080057
250900             VARYING PV-ITEM                                      25090057
251000             FROM 1 BY 1                                          25100057
251100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25110057
251200                                                                  25120057
251300     IF  RC013-IDX > 1                                            25130057
251400         PERFORM 5205-WRITE-SEL-QUEUE                             25140057
251500         ADD +1                TO RC017-NUMBER-OF-TS-ITEMS        25150057
251600     END-IF.                                                      25160057
251700/                                                                 25170057
251800/                                                                 25180057
251900*----------------------------------------------------------------*25190057
252000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25200057
252100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25210057
252200*----------------------------------------------------------------*25220057
252300                                                                  25230057
252400 5100-WRITE-TEMP-STORAGE.                                         25240057
252500                                                                  25250057
252600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25260057
252700                                   TO PV-LIST-ITEM-NUMBER.        25270057
252800     COMPUTE PV-BLOCK-NUMBER =                                    25280057
252900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25290057
253000                                                                  25300057
253100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25310057
253200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25320057
253300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25330057
253400             PERFORM 5105-REWRITE-ASC-LISTQ                       25340057
253500         END-IF                                                   25350057
253600     ELSE                                                         25360057
253700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25370057
253800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25380057
253900         PERFORM 5110-WRITE-ASC-LISTQ                             25390057
254000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25400057
254100     END-IF.                                                      25410057
254200                                                                  25420057
254300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25430057
254400                                                                  25440057
254500******************************************************************25450057
254600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **25460057
254700** SPECIFIC COMMAREA.                                           **25470057
254800******************************************************************25480057
254900                                                                  25490057
255000 5105-REWRITE-ASC-LISTQ.                                          25500057
255100                                                                  25510057
255200     EXEC CICS                                                    25520057
255300         WRITEQ TS                                                25530057
255400             QUEUE (ASC-LIST-QUEUE-NAME)                          25540057
255500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25550057
255600             ITEM  (PV-BLOCK-NUMBER)                              25560057
255700             REWRITE                                              25570057
255800             RESP  (PV-CICS-RESP)                                 25580057
255900     END-EXEC.                                                    25590057
256000                                                                  25600057
256100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25610057
256200         CONTINUE                                                 25620057
256300     ELSE                                                         25630057
256400         SET DP013-CICS-ABEND            TO TRUE                  25640057
256500         SET DP013-NO-ROLLBACK           TO TRUE                  25650057
256600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25660057
256700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25670057
256800                                         TO DP013-MESSAGE-TEXT(1) 25680057
256900         PERFORM DP013-0000-PROCESS-ABEND                         25690057
257000     END-IF.                                                      25700057
257100                                                                  25710057
257200******************************************************************25720057
257300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **25730057
257400** SPECIFIC COMMAREA.                                           **25740057
257500******************************************************************25750057
257600                                                                  25760057
257700 5110-WRITE-ASC-LISTQ.                                            25770057
257800                                                                  25780057
257900     EXEC CICS                                                    25790057
258000         WRITEQ TS                                                25800057
258100             QUEUE (ASC-LIST-QUEUE-NAME)                          25810057
258200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25820057
258300             ITEM  (PV-BLOCK-NUMBER)                              25830057
258400             RESP  (PV-CICS-RESP)                                 25840057
258500     END-EXEC.                                                    25850057
258600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25860057
258700         SET DP013-CICS-ABEND      TO TRUE                        25870057
258800         SET DP013-NO-ROLLBACK     TO TRUE                        25880057
258900         MOVE '5110-WRITE-ASC-LISTQ'                              25890057
259000                                   TO DP013-PARAGRAPH             25900057
259100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25910057
259200                                   TO DP013-MESSAGE-TEXT(1)       25920057
259300         PERFORM DP013-0000-PROCESS-ABEND                         25930057
259400     END-IF.                                                      25940057
259500/                                                                 25950057
259600*----------------------------------------------------------------*25960057
259700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25970057
259800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25980057
259900*----------------------------------------------------------------*25990057
260000                                                                  26000057
260100 5200-FILL-SEL-QUEUE-RECORD.                                      26010057
260200                                                                  26020057
260300     PERFORM 6112-READ-LIST-QUEUE.                                26030057
260400                                                                  26040057
260500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26050057
260600         PERFORM                                                  26060057
260700         VARYING LQW-IDX                                          26070057
260800         FROM 1 BY 1                                              26080057
260900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26090057
261000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26100057
261100                                                                  26110057
261200             IF  LQW-SELECT (LQW-IDX)                             26120057
261300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26130057
261400                                   TO RC013-ITEM (RC013-IDX)      26140057
261500                 MOVE LQW-PO-LNE-NBR     (LQW-IDX)                26150057
261600                                   TO RC013-PKSL-LNE-NBR-N        26160057
261700                                        (RC013-IDX)               26170057
261800                 MOVE LQW-ACTION (LQW-IDX)                        26180057
261900                            TO RC013-ACTION-SW (RC013-IDX)        26190057
262000                                                                  26200057
262100                 SET RC013-IDX UP BY 1                            26210057
262200                 IF  RC013-IDX > RC013-MAX-ITEMS                  26220057
262300                     PERFORM 5205-WRITE-SEL-QUEUE                 26230057
262400                     ADD +1        TO RC017-NUMBER-OF-TS-ITEMS    26240057
262500                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         26250057
262600                     SET RC013-IDX TO  1                          26260057
262700                 END-IF                                           26270057
262800             END-IF                                               26280057
262900         END-PERFORM                                              26290057
263000     END-IF.                                                      26300057
263100/                                                                 26310057
263200*----------------------------------------------------------------*26320057
263300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26330057
263400*----------------------------------------------------------------*26340057
263500                                                                  26350057
263600 5205-WRITE-SEL-QUEUE.                                            26360057
263700                                                                  26370057
263800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26380057
263900                                   TO RC013-SELECTED-ITEMS.       26390057
264000                                                                  26400057
264100     EXEC CICS                                                    26410057
264200          WRITEQ TS                                               26420057
264300              QUEUE (ASC-SEL-QUEUE-NAME)                          26430057
264400              FROM  (RC013-DC-SELECT-RECORD)                      26440057
264500              ITEM  (PV-SEL-QUEUE-ITEM)                           26450057
264600              RESP  (PV-CICS-RESP)                                26460057
264700     END-EXEC.                                                    26470057
264800                                                                  26480057
264900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26490057
265000         CONTINUE                                                 26500057
265100     ELSE                                                         26510057
265200         SET DP013-CICS-ABEND      TO TRUE                        26520057
265300         SET DP013-NO-ROLLBACK     TO TRUE                        26530057
265400         MOVE '5205-WRITE-SEL-QUEUE'                              26540057
265500                                   TO DP013-PARAGRAPH             26550057
265600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26560057
265700                                   TO DP013-MESSAGE-TEXT(1)       26570057
265800         PERFORM DP013-0000-PROCESS-ABEND                         26580057
265900     END-IF.                                                      26590057
266000/                                                                 26600057
266100                                                                  26610057
266200                                                                  26620057
266300/                                                                 26630057
266400/                                                                 26640057
266500 5475-CHECK-FOR-TROUBLE.                                          26650057
266600                                                                  26660057
266700     MOVE ZERO                   TO  PV-DB2-TROUBLE-COUNT.        26670057
266800     EXEC SQL                                                     26680057
266900          SELECT COUNT(*)                                         26690057
267000          INTO  :PV-DB2-TROUBLE-COUNT :PV-NULL-IND                26700057
267100          FROM   TTRBNTF A                                        26710057
267200                ,TTRBRSN B                                        26720057
267300          WHERE  A.PO_NBR           =  :ASC-PO-NBR                26730057
267400          AND  ((A.PO_LNE_NBR       =  :RECDIS-ORD-LNE-NBR        26740057
267500          AND    B.TRBL_LVL_IND      <>  :PC-M)                   26750057
267600          OR    (A.PREPK_ID         =  :RECITM-PREPK-ID           26760057
267700          AND    B.TRBL_LVL_IND      =   :PC-M))                  26770057
267800          AND    A.REC_SEQ_NBR      =  :ASC-REC-SEQ-NBR           26780057
267900          AND    A.OPER_UNT_ID      =  :ASC-OPER-UNT-ID           26790057
268000          AND    A.FCLTY_ID         =  :ASC-FCLTY-ID              26800057
268100          AND   (A.RESOLVED_IND     =  :PC-N                      26810057
268200           OR    A.RESOLVED_IND     =  :PC-I)                     26820057
268300          AND    A.TRBL_RSN_CDE     = B.TRBL_RSN_CDE              26830057
268400     END-EXEC.                                                    26840057
268500                                                                  26850057
268600     EVALUATE TRUE                                                26860057
268700         WHEN SQLCODE = ZERO                                      26870057
268800         WHEN SQLCODE = +100                                      26880057
268900              CONTINUE                                            26890057
269000         WHEN SQLCODE = -904                                      26900057
269100         WHEN SQLCODE = -911                                      26910057
269200         WHEN SQLCODE = -913                                      26920057
269300              PERFORM 9900-SOFT-ABORT                             26930057
269400         WHEN SQLWARN0 NOT = SPACE                                26940057
269500         WHEN SQLCODE NOT = ZERO                                  26950057
269600              MOVE '5475-CHECK-FOR-TROUBLE'                       26960057
269700                                    TO DP013-PARAGRAPH            26970057
269800              MOVE 'SELECT RESOLVE IND FROM TROUBLE TABLE'        26980057
269900                                    TO DP013-MESSAGE-TEXT (1)     26990057
270000              MOVE SQLCA       TO DP013-SQLCA                     27000057
270100              SET DP013-DB2-ABEND                                 27010057
270200                               TO TRUE                            27020057
270300              PERFORM DP013-0000-PROCESS-ABEND                    27030057
270400     END-EVALUATE.                                                27040057
270500                                                                  27050057
270600     IF  PV-DB2-TROUBLE-COUNT EQUAL ZERO                          27060057
270700         SET PS-NOT-IN-TROUBLE TO  TRUE                           27070057
270800     ELSE                                                         27080057
270900         SET PS-IN-TROUBLE     TO  TRUE                           27090057
271000     END-IF.                                                      27100057
271100/                                                                 27110057
271200                                                                  27120057
271300                                                                  27130057
271400/                                                                 27140057
271500 5720-GET-TRECEIV-STATUS.                                         27150057
271600                                                                  27160057
271700     EXEC SQL                                                     27170057
271800          SELECT                                                  27180057
271900             ORD_NBR                                              27190057
272000            ,REC_SEQ_NBR                                          27200057
272100            ,CRE_TMST                                             27210057
272200            ,CRE_UID                                              27220057
272300            ,PO_VER_NBR                                           27230057
272400            ,OPER_UNT_ID                                          27240057
272500            ,FCLTY_ID                                             27250057
272600            ,STATUS_CDE                                           27260057
272700            ,SYST_CRE_CDE                                         27270057
272800            ,REC_TYP_CDE                                          27280057
272900            ,VER_STATUS_CDE                                       27290057
273000            ,PACK_BY_ST_IND                                       27300057
273100            ,REC_TMST                                             27310057
273200            ,EXPTED_CART_CNT                                      27320057
273300            ,ACTL_CART_CNT                                        27330057
273400            ,EXPTED_ITM_QTY                                       27340057
273500            ,ACTL_ITM_QTY                                         27350057
273600            ,RCVR_NBR                                             27360057
273700            ,ML_POST_TMST                                         27370057
273800            ,FS_POST_TMST                                         27380057
273900            ,PRE_TKT_IND                                          27390057
274000            ,AD_INFO_DESC                                         27400057
274100            ,IN_TRBL_TMST                                         27410057
274200            ,IN_TRBL_MIN_CNT                                      27420057
274300            ,IN_TRBL_HOUR_CNT                                     27430057
274400            ,VERFYD_TMST                                          27440057
274500            ,RCVG_CLERK_INIT_ID                                   27450057
274600            ,REFER_BACK_SEQ_NBR                                   27460057
274700            ,AP_PRC_CDE                                           27470057
274800            ,AP_PRC_DTE                                           27480057
274900            ,MIS_DIRECT_IND                                       27490057
275000            ,IMPRT_IND                                            27500057
275100            ,CRE_OPER_UNT_ID                                      27510057
275200            ,CRE_FCLTY_ID                                         27520057
275300            ,CURR_OPER_UNT_ID                                     27530057
275400            ,CURR_FCLTY_ID                                        27540057
275500            ,UPD_TMST                                             27550057
275600            ,UPD_UID                                              27560057
275700            ,UPD_PGM_ID                                           27570057
275800            ,APRON_LOC_DESC                                       27580057
275900            ,MKNG_APRN_PRT_TMST                                   27590057
276000            ,GOH_IND                                              27600057
276100            ,CURRENT TIMESTAMP                                    27610057
276200            ,VRFD_USR_ID                                          27620057
276300        INTO                                                      27630057
276400             :RECEIV-ORD-NBR                                      27640057
276500           , :RECEIV-REC-SEQ-NBR                                  27650057
276600           , :RECEIV-CRE-TMST                                     27660057
276700           , :RECEIV-CRE-UID                                      27670057
276800           , :RECEIV-PO-VER-NBR                                   27680057
276900           , :RECEIV-OPER-UNT-ID                                  27690057
277000           , :RECEIV-FCLTY-ID                                     27700057
277100           , :RECEIV-STATUS-CDE                                   27710057
277200           , :RECEIV-SYST-CRE-CDE                                 27720057
277300           , :RECEIV-REC-TYP-CDE                                  27730057
277400           , :RECEIV-VER-STATUS-CDE                               27740057
277500           , :RECEIV-PACK-BY-ST-IND                               27750057
277600           , :RECEIV-REC-TMST                                     27760057
277700           , :RECEIV-EXPTED-CART-CNT                              27770057
277800           , :RECEIV-ACTL-CART-CNT                                27780057
277900           , :RECEIV-EXPTED-ITM-QTY                               27790057
278000           , :RECEIV-ACTL-ITM-QTY                                 27800057
278100           , :RECEIV-RCVR-NBR                                     27810057
278200           , :RECEIV-ML-POST-TMST                                 27820057
278300           , :RECEIV-FS-POST-TMST                                 27830057
278400           , :RECEIV-PRE-TKT-IND                                  27840057
278500           , :RECEIV-AD-INFO-DESC                                 27850057
278600           , :RECEIV-IN-TRBL-TMST                                 27860057
278700           , :RECEIV-IN-TRBL-MIN-CNT                              27870057
278800           , :RECEIV-IN-TRBL-HOUR-CNT                             27880057
278900           , :RECEIV-VERFYD-TMST                                  27890057
279000           , :RECEIV-RCVG-CLERK-INIT-ID                           27900057
279100           , :RECEIV-REFER-BACK-SEQ-NBR                           27910057
279200           , :RECEIV-AP-PRC-CDE                                   27920057
279300           , :RECEIV-AP-PRC-DTE                                   27930057
279400           , :RECEIV-MIS-DIRECT-IND                               27940057
279500           , :RECEIV-IMPRT-IND                                    27950057
279600           , :RECEIV-CRE-OPER-UNT-ID                              27960057
279700           , :RECEIV-CRE-FCLTY-ID                                 27970057
279800           , :RECEIV-CURR-OPER-UNT-ID                             27980057
279900           , :RECEIV-CURR-FCLTY-ID                                27990057
280000           , :RECEIV-UPD-TMST                                     28000057
280100           , :RECEIV-UPD-UID                                      28010057
280200           , :RECEIV-UPD-PGM-ID                                   28020057
280300           , :RECEIV-APRON-LOC-DESC                               28030057
280400           , :RECEIV-MKNG-APRN-PRT-TMST                           28040057
280500           , :RECEIV-GOH-IND                                      28050057
280600           , :PV-RECEIV-CURRENT-TIMESTAMP                         28060057
280700           , :RECEIV-VRFD-USR-ID                                  28070057
280800          FROM  TRECEIV                                           28080057
280900          WHERE                                                   28090057
281000                 ORD_NBR          =  :ASC-PO-NBR                  28100057
281100          AND    REC_SEQ_NBR      =  :ASC-REC-SEQ-NBR             28110057
281200          AND    OPER_UNT_ID      =  :ASC-OPER-UNT-ID             28120057
281300          AND    FCLTY_ID         =  :ASC-FCLTY-ID                28130057
281400          AND    VER_STATUS_CDE   =  :PC-A                        28140057
281500     END-EXEC.                                                    28150057
281600                                                                  28160057
281700     EVALUATE TRUE                                                28170057
281800         WHEN SQLCODE = ZERO                                      28180057
281900              MOVE RECEIV-STATUS-CDE TO ASC-RECEIV-STATUS-CDE     28190057
282000              IF  ASC-RECEIV-STATUS-VERIFY                        28200057
282100                  MOVE  RECEIV-VERFYD-TMST TO PV-WORK-TIMESTAMP   28210057
282200                  MOVE  PV-WORK-YEAR       TO PV-DISPLAY-YEAR     28220057
282300                  MOVE  PV-WORK-MONTH      TO PV-DISPLAY-MONTH    28230057
282400                  MOVE  PV-WORK-DAY        TO PV-DISPLAY-DAY      28240057
282500                  MOVE  '/'                TO PV-SLASH-1          28250057
282600                  MOVE  '/'                TO PV-SLASH-2          28260057
282700                  MOVE  PV-WORK-HH         TO PV-DISPLAY-HH       28270057
282800                  MOVE  PV-WORK-MM         TO PV-DISPLAY-MM       28280057
282900                  MOVE  ':'                TO PV-COLON-1          28290057
283000                  MOVE  '('                TO PV-LEFT-PAREN       28300057
283100                  MOVE  PV-DISPLAY-DATE    TO PV-VRFY-DATE        28310057
283200                  MOVE  PV-DISPLAY-TIME    TO PV-VRFY-TIME        28320057
283300                  MOVE  ' - '              TO PV-SEPARATOR        28330057
283400                  MOVE  RECEIV-VRFD-USR-ID TO PV-VRFY-USERID      28340057
283500                  MOVE  ')'                TO PV-RIGHT-PAREN      28350057
283600                  MOVE  PV-RECEIV-VRFY-INFO                       28360057
283700                                           TO ASC-RECEIV-VRFY-INFO28370057
283800              ELSE                                                28380057
283900                  MOVE  SPACES             TO ASC-RECEIV-VRFY-INFO28390057
284000              END-IF                                              28400057
284100         WHEN SQLCODE = +100                                      28410057
284200              SET PS-DATA-NOT-OK    TO  TRUE                      28420057
284300         WHEN SQLCODE = -904                                      28430057
284400         WHEN SQLCODE = -911                                      28440057
284500         WHEN SQLCODE = -913                                      28450057
284600              PERFORM 9900-SOFT-ABORT                             28460057
284700         WHEN SQLWARN0 NOT = SPACE                                28470057
284800         WHEN SQLCODE NOT = ZERO                                  28480057
284900              MOVE '5720-GET-RECEIV-STATUS'                       28490057
285000                               TO DP013-PARAGRAPH                 28500057
285100              MOVE 'SELECT TRECEIV'                               28510057
285200                               TO DP013-MESSAGE-TEXT (1)          28520057
285300              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        28530057
285400              MOVE SQLCA       TO DP013-SQLCA                     28540057
285500              SET DP013-DB2-ABEND                                 28550057
285600                               TO TRUE                            28560057
285700              PERFORM DP013-0000-PROCESS-ABEND                    28570057
285800     END-EVALUATE.                                                28580057
285900/                                                                 28590057
286000                                                                  28600057
286100/                                                                 28610057
286200/                                                                 28620057
286300/                                                                 28630057
286400*----------------------------------------------------------------*28640057
286500*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *28650057
286600*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *28660057
286700*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *28670057
286800*  THE USER.                                                     *28680057
286900*----------------------------------------------------------------*28690057
287000                                                                  28700057
287100 6000-REFRESH-PANEL-FROM-TEMP.                                    28710057
287200                                                                  28720057
287300     IF  ASC-UPDATE-TSQ                                           28730057
287400         SET ASC-NO-TSQ-UPDATE TO TRUE                            28740057
287500         MOVE ZERO                 TO PV-SAVE-ITEM                28750057
287600                                      PV-SEL-QUEUE-ITEM           28760057
287700*        MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        28770057
287800*                                  TO PV-HOLD-SELECTED-ITEMS      28780057
287900         PERFORM 6100-UPDATE-TSQ                                  28790057
288000             UNTIL PV-ITEMS-PROCESSED >                           28800057
288100                                     ASC-NUMBER-OF-SELECTED-ITEMS 28810057
288200         PERFORM 6010-DELETE-SEL-QUEUE                            28820057
288300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         28830057
288400                    ASC-BLOCK-ENTRIES (2)                         28840057
288500                                                                  28850057
288600         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 28860057
288700                GIVING PV-BLOCK-NUMBER                            28870057
288800                REMAINDER PV-REMAINDER                            28880057
288900         IF  PV-REMAINDER > ZERO                                  28890057
289000             ADD +1     TO PV-BLOCK-NUMBER                        28900057
289100         END-IF                                                   28910057
289200         MOVE +1        TO ASC-BLK-SUB                            28920057
289300         PERFORM 4410-READ-TEMP-STORAGE                           28930057
289400         ADD +1         TO ASC-BLK-SUB                            28940057
289500                           PV-BLOCK-NUMBER                        28950057
289600         PERFORM 4410-READ-TEMP-STORAGE                           28960057
289700                                                                  28970057
289800     END-IF.                                                      28980057
289900                                                                  28990057
290000*----------------------------------------------------------------*29000057
290100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *29010057
290200*----------------------------------------------------------------*29020057
290300                                                                  29030057
290400 6010-DELETE-SEL-QUEUE.                                           29040057
290500                                                                  29050057
290600     EXEC CICS                                                    29060057
290700         DELETEQ TS                                               29070057
290800             QUEUE (ASC-SEL-QUEUE-NAME)                           29080057
290900             RESP  (PV-CICS-RESP)                                 29090057
291000     END-EXEC.                                                    29100057
291100                                                                  29110057
291200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      29120057
291300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         29130057
291400         CONTINUE                                                 29140057
291500     ELSE                                                         29150057
291600         SET DP013-CICS-ABEND TO TRUE                             29160057
291700         SET DP013-NO-ROLLBACK TO TRUE                            29170057
291800         MOVE '6010-DELETE-SEL-QUEUE'                             29180057
291900                        TO DP013-PARAGRAPH                        29190057
292000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         29200057
292100                        TO DP013-MESSAGE-TEXT (1)                 29210057
292200         PERFORM DP013-0000-PROCESS-ABEND                         29220057
292300     END-IF.                                                      29230057
292400                                                                  29240057
292500*----------------------------------------------------------------*29250057
292600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *29260057
292700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *29270057
292800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *29280057
292900*    THE TEMP QUEUE.                                             *29290057
293000*----------------------------------------------------------------*29300057
293100                                                                  29310057
293200 6100-UPDATE-TSQ.                                                 29320057
293300                                                                  29330057
293400     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             29340057
293500     PERFORM 6105-READ-SEL-QUEUE.                                 29350057
293600     PERFORM                                                      29360057
293700         VARYING RC013-IDX                                        29370057
293800         FROM 1 BY 1                                              29380057
293900         UNTIL ((PV-ITEMS-PROCESSED >                             29390057
294000                              PV-HOLD-SELECTED-ITEMS)             29400057
294100         OR (RC013-IDX GREATER THAN RC013-MAX-ITEMS))             29410057
294200         IF  RC013-ACTION-SW (RC013-IDX) > SPACE                  29420057
294300             PERFORM 6110-PROCESS-ITEMS                           29430057
294400         END-IF                                                   29440057
294500         ADD +1                TO PV-ITEMS-PROCESSED              29450057
294600     END-PERFORM.                                                 29460057
294700     PERFORM 6111-WRITE-LIST-QUEUE.                               29470057
294800*----------------------------------------------------------------*29480057
294900*    READ THE LIST QUEUE RECORD.                                 *29490057
295000*----------------------------------------------------------------*29500057
295100                                                                  29510057
295200 6105-READ-SEL-QUEUE.                                             29520057
295300                                                                  29530057
295400     EXEC CICS                                                    29540057
295500          READQ TS                                                29550057
295600              QUEUE (ASC-SEL-QUEUE-NAME)                          29560057
295700              INTO  (RC013-DC-SELECT-RECORD)                      29570057
295800              ITEM  (PV-SEL-QUEUE-ITEM)                           29580057
295900              RESP  (PV-CICS-RESP)                                29590057
296000     END-EXEC.                                                    29600057
296100                                                                  29610057
296200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29620057
296300         CONTINUE                                                 29630057
296400     ELSE                                                         29640057
296500         SET DP013-CICS-ABEND      TO  TRUE                       29650057
296600         SET DP013-NO-ROLLBACK     TO  TRUE                       29660057
296700         MOVE '6105-READ-SEL-QUEUE'                               29670057
296800                                   TO  DP013-PARAGRAPH            29680057
296900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           29690057
297000                                   TO  DP013-MESSAGE-TEXT(1)      29700057
297100         PERFORM DP013-0000-PROCESS-ABEND                         29710057
297200     END-IF.                                                      29720057
297300/                                                                 29730057
297400*----------------------------------------------------------------*29740057
297500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*29750057
297600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*29760057
297700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *29770057
297800*----------------------------------------------------------------*29780057
297900                                                                  29790057
298000 6110-PROCESS-ITEMS.                                              29800057
298100                                                                  29810057
298200     COMPUTE PV-ITEM = 1 + ((RC013-ITEM (RC013-IDX) - 1)          29820057
298300                     / PC-ITEMS-PER-PANEL).                       29830057
298400                                                                  29840057
298500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           29850057
298600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          29860057
298700             PERFORM 6111-WRITE-LIST-QUEUE                        29870057
298800         END-IF                                                   29880057
298900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    29890057
299000                                                                  29900057
299100         PERFORM 6112-READ-LIST-QUEUE                             29910057
299200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               29920057
299300             CONTINUE                                             29930057
299400         END-IF                                                   29940057
299500     END-IF.                                                      29950057
299600                                                                  29960057
299700     COMPUTE PV-SUB = (RC013-ITEM (RC013-IDX)                     29970057
299800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              29980057
299900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         29990057
300000     MOVE LQW-SELECTED-SW (PV-SUB)                                30000057
300100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  30010057
300200     EVALUATE TRUE                                                30020057
300300         WHEN RC013-INQ (RC013-IDX)                               30030057
300400              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             30040057
300500                                                                  30050057
300600         WHEN RC013-UPD (RC013-IDX)                               30060057
300700              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             30070057
300800                                                                  30080057
300900         WHEN RC013-DEL (RC013-IDX)                               30090057
301000              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             30100057
301100                                                                  30110057
301200         WHEN RC013-ERR (RC013-IDX)                               30120057
301300              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             30130057
301400     END-EVALUATE.                                                30140057
301500                                                                  30150057
301600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                30160057
301700                                                                  30170057
301800*----------------------------------------------------------------*30180057
301900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *30190057
302000*----------------------------------------------------------------*30200057
302100                                                                  30210057
302200 6111-WRITE-LIST-QUEUE.                                           30220057
302300                                                                  30230057
302400     EXEC CICS                                                    30240057
302500         WRITEQ TS                                                30250057
302600             QUEUE (ASC-LIST-QUEUE-NAME)                          30260057
302700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     30270057
302800             ITEM  (PV-SAVE-ITEM)                                 30280057
302900             REWRITE                                              30290057
303000             RESP  (PV-CICS-RESP)                                 30300057
303100     END-EXEC.                                                    30310057
303200                                                                  30320057
303300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30330057
303400         CONTINUE                                                 30340057
303500     ELSE                                                         30350057
303600         SET DP013-CICS-ABEND  TO  TRUE                           30360057
303700         SET DP013-NO-ROLLBACK TO  TRUE                           30370057
303800         MOVE '6111-WRITE-LIST-QUEUE'                             30380057
303900                               TO  DP013-PARAGRAPH                30390057
304000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  30400057
304100                               TO  DP013-MESSAGE-TEXT(1)          30410057
304200         PERFORM DP013-0000-PROCESS-ABEND                         30420057
304300     END-IF.                                                      30430057
304400/                                                                 30440057
304500*----------------------------------------------------------------*30450057
304600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*30460057
304700*----------------------------------------------------------------*30470057
304800                                                                  30480057
304900 6112-READ-LIST-QUEUE.                                            30490057
305000                                                                  30500057
305100     EXEC CICS                                                    30510057
305200         READQ TS                                                 30520057
305300             QUEUE (ASC-LIST-QUEUE-NAME)                          30530057
305400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     30540057
305500             ITEM  (PV-ITEM)                                      30550057
305600             RESP  (PV-CICS-RESP)                                 30560057
305700     END-EXEC.                                                    30570057
305800                                                                  30580057
305900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30590057
306000         CONTINUE                                                 30600057
306100     ELSE                                                         30610057
306200         SET DP013-CICS-ABEND        TO TRUE                      30620057
306300         SET DP013-NO-ROLLBACK       TO TRUE                      30630057
306400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           30640057
306500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    30650057
306600                                     TO DP013-MESSAGE-TEXT(1)     30660057
306700         PERFORM DP013-0000-PROCESS-ABEND                         30670057
306800     END-IF.                                                      30680057
306900/                                                                 30690057
307000******************************************************************30700057
307100*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *30710057
307200*    AND THE ERROR SWITCHES.                                     *30720057
307300******************************************************************30730057
307400 9900-SOFT-ABORT.                                                 30740057
307500     SET PS-ERROR         TO TRUE.                                30750057
307600     SET DP020-MSG-FATAL  TO TRUE.                                30760057
307700     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    30770057
307800     IF PS-NO-NEXT-SCREEN                                         30780057
307900        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     30790057
308000     END-IF.                                                      30800057
308100     IF PS-UPDATES-DONE AND SQLCODE = -913                        30810057
308200        PERFORM 9901-BACKUP                                       30820057
308300     END-IF.                                                      30830057
308400     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          30840057
308500     PERFORM 0001-CALL-CICS-ARCH-API.                             30850057
308600                                                                  30860057
308700 9901-BACKUP.                                                     30870057
308800     EXEC CICS SYNCPOINT                                          30880057
308900          ROLLBACK                                                30890057
309000     END-EXEC.                                                    30900057
309100                                                                  30910057
309200/                                                                 30920057
309300*----------------------------------------------------------------*30930057
309400*    ABEND PROCESSOR MODULE                                      *30940057
309500*----------------------------------------------------------------*30950057
309600                                                                  30960057
309700     COPY DPPD013.                                                30970057
