000100 ID DIVISION.                                                     00010044
000200 PROGRAM-ID.         APKUP252.                                    00020044
000300 AUTHOR.             MARY KING.                                   00030044
000400 DATE-WRITTEN.       SEPT 1994.                                   00040044
000500 DATE-COMPILED.                                                   00050044
000600*************************************************************     00060044
000700*    COBOL 2 WITH SQL                                       *     00070044
000800*                                                           *     00080044
000900*    STATUS UPDATE PROGRAM.                                 *     00090044
001000*                    APKUP252                               *     00100044
001100*   PROGRAM OVERVIEW:                                       *     00110044
001200*                                                           *     00120044
001300*     THIS PROGRAM UPDATES THE TINVOIC TABLE BASED ON AN    *     00130044
001400*   OPEN TO PAY RESULTS FILE.  THE TINVOIC TABLE WILL BE    *     00140044
001500*   UPDATED TO ONE OF A NUMBER OF CURRENT STATUS CODES ALONG*     00150044
001600*   THE PAYMENT DATE.                                       *     00160044
001700*                                                           *     00170044
001800*     THE TRECEIV TABLE IS THEN UPDATED BASED ON  THE       *     00180044
001900*   RECEIVE UPDATE FILE.  THE RECEIVE TABLE WILL BE SET TO  *     00190044
002000*   AN AP PROCESS CODE OF 'J' (JOURNALIZED) AND THE AP      *     00200044
002100*   PROCESS DATE PASSED.                                    *     00210044
002200*     TRECDIS AND TNINREC ROWS ARE MARKED AS 'J' FOR        *     00220044
002300*   JOURNALIZED IN APKUP254.  IF TRECEIV WERE UPDATED       *     00230044
002400*   IN APKUP254 ALSO, TRECDIS WOULD HAVE TO BE CHECKED      *     00240044
002500*   TO SEE IF ALL ROWS HAVE BEEN SET TO 'J' FOR A BY STORE  *     00250044
002600*   SITUATION EACH TIME A PO WAS PROCESSED.  (THE SAME PO   *     00260044
002700*   NUMBER MAY BE PROCESSED MULTIPLE TIMES IF IT HAS        *     00270044
002800*   DIFFERENT STORE NUMBERS SPECIFIED ON TPOSTRR).  THIS    *     00280044
002900*   BECOMES INEFFICIENT AS TRECDIS MAY BE VERY LARGE.  THIS *     00290044
003000*   IS THE REASON TRECEIV IS SET TO JOURNALIZED IN THIS     *     00300044
003100*   PROGRAM.                                                *     00310044
003200*                                                           *     00320044
003300*   INPUT:                                                  *     00330044
003400*                                                           *     00340044
003500*     1. INVOICE STATUS FILE                                *     00350044
003600*     2. RECEIVE STATUS FILE                                *     00360044
003700*                                                           *     00370044
003800*   OUTPUT:                                                 *     00380044
003900*                                                           *     00390044
004000*        TINVOIC - INVOICE DB2 TABLE                        *     00400044
004100*        TRECEIV - RECEIVER DB2 TABLE                       *     00410044
004200*                                                           *     00420044
004300*************************************************************     00430044
004400*   CHANGES:                                                *     00440044
004500*                                                           *     00450044
004600*   10/10/94   FIXED INCREMENT OF RECEIVER UPDATE COUNT.    *     00460044
004700*   M. KING                                                 *     00470044
004800*                                                           *     00480044
004900*   09/19/95   CHANGED TO PROCESS NEW TRECDIS AND TNINREC   *     00490044
005000*   P.KEBER    UPDATE RECORDS ON THE RECEIVE UPDATE FILE.   *     00500044
005100*              CHECKPOINT RESTART LOGIC WILL ALSO BE ADDED. *     00510044
005200*                                                           *     00520044
005300*   05/31/96   REMOVED UPDATE OF PAYT_RLSE_TMST WHEN TNINREC*     00530044
005400*   M. KING    IS JOURNALIZED.                              *     00540044
005500*                                                           *     00550044
005600*   08/25/97   MODIFIED PARAGRAPH 2000-OPEN-TO-PAY-PROCESS  *     00560044
005700*   J. KNOKE   LOGIC WHICH CHECKED THE INVOICE TYPE TO      *     00570044
005800*              DETERMINE WHAT VALUE TO PUT IN THE STATUS    *     00580044
005900*              CODE WAS CHANGED TO JUST MOVING AP252-STATUS-*     00590044
006000*              UPDATE-CDE TO THE INVOIC-STATUS-CDE. REMOVED *     00600044
006100*              STATUS_CDE = 'RL' FROM THE WHERE CLAUSE IN   *     00610044
006200*              THE UPDATE OF TINVOIC, SO THAT STATUS CODE   *     00620044
006300*              IS ALWAYS UPDATED.                           *     00630044
006400*                                                           *     00640044
006500*   06/01/98   MODIFIED PROGRAM TO PROCESS THE AP-PRC-CDE   *     00650044
006600*   R.BERNOSKI AND AP-PRC-DTE WHEN UPDATING THE TINVOIC     *     00660044
006700*              TABLE.  THE PROGRAM IS NOW ABLE TO HANDLE    *     00670044
006800*              INPUT RECORDS THAT HAVE INFO TO UPDATE ONLY  *     00680044
006900*              STATUS, ONLY AP PROCSS CODE, OR BOTH.  THESE *     00690044
007000*              UPDATE STATEMENTS WILL BE HANDLED SEPARATELY.*     00700044
007100*                                                           *     00710044
007200*   02/23/00   ADDED PV-CHECK-CDE4 (DELETE) TO SELECT FOR   *     00720044
007300*   C.GIFFORD  TRECDIS.                                     *     00730044
007400*                                                           *     00740044
007500*   03/09/00   ADDED LOGIC TO UPDATE THE PAYT-DTE ON TINVOIC*     00750044
007600*              WHEN THE STATUS CODE IS BEING UPDATED TO     *     00760044
007700*              PAID ('PD').  IN 2000-OPEN-TO-PAY-PROCESSING,*     00770044
007800*              PUT A CHECK TO SEE IF THE STATUS IS BEING    *     00780044
007900*              UPDATED TO 'PD', THEN MOVE THE AP-PRC-DTE TO *     00790044
008000*              THE PAYT-DTE, OTHERWISE, MOVE THE DEFAULT    *     00800044
008100*              DATE '9999-09-09', WHICH IS WHAT WOULD BE IN *     00810044
008200*              THAT FIELD ALREADY.  ALSO CHANGED TO 2 UPDATE*     00820044
008300*              SQL STATEMENTS THAT UPDATE THE STATUS CODE   *     00830044
008400*              SO THAT PAYT-DTE WOULD ALSO BE UPDATED.      *     00840044
008500*   MADE BY: NANCY EILBES                                   *     00850044
008600*                                                           *     00860044
008700*   01/24/02   REMOVED THE WHERE CONDITIONS INVOLVING THE   *     00870044
008800*              CRE_TMST.  SINCE THIS IS NOT A KEY ON TRECEIV*     00880044
008900*              AND TRECDIS, IT IS NO LONGER NECCESSARY TO   *     00890044
009000*              USE IT IN SQL.                               *     00900044
009100*   MADE BY: MIKE BESKE                     WR#: 23005      *     00910044
009200*                                                           *     00920044
009300*   06/17/2002 ARK PO PROJECT PHASE 1.  CHANGED UPDATE      *     00930044
009400*              STATEMENTS FOR TABLE TINVOIC TO USE PO_NBR   *     00940044
009500*              AND INVC_ID INSTEAD OF PAYT_REQ_SEQ_NBR.     *     00950044
009600*              PARAGRAPHS CHANGED ARE 2000, U050, U100,     *     00960044
009700*              AND U150.                                    *     00970044
009800*   MADE BY:  KEVIN CATLIN              WR/IR #: 23500      *     00980044
009900*                                                           *     00990044
010000*   11/04/2002 COLBY DATING PROJECT. BROUGHT THE LAYOUT OF  *     01000044
010100*              PROGRAM UP TO CURRENT STANDARDS.  MODIFIED   *     01010044
010200*              THE CODE IN B200- TO HANDLE COPYBOOK CHANGES *     01020044
010300*              INVOLVED WITH APRD252 INC LRECL INCREASED TO *     01030044
010400*              80 BYTES.                                    *     01040044
010500*   MADE BY:  MIKE BESKE                WR/IR #: 23750      *     01050044
010600*                                                           *     01060044
010610*   09/17/2003 ADDED -911 AS ACCEPTABLE SQLCODE IN ALL      *     01061044
010620*              RETRY LOGIC.                                 *     01062044
010630*   MADE BY:  NANCY EILBES              WR/IR #: P00587093  *     01063047
010631*                                                           *     01063148
010640*   02/06/2017 CHANGED QUERY IN S150,S175 TO FETCH FIRST    *     01064048
010650*              ONE ROW ONLY. ADDED WORK FIELDS AND MODIFIED *     01065048
010651*              LOGIC IN S100 TO CHECK WHETHER RECDIS ROW    *     01065148
010652*              WAS FOUND TO DECIDE WHETHER TO CONTINUE WITH *     01065248
010653*              TRECEIV UPDATE.                              *     01065348
010654*              ADDED DISPLAYS TO ALLOW TRACKING PROGRESS    *     01065449
010655*              OF UPDATES TO TRECDIS AND TRECEIV.           *     01065549
010660*   MADE BY:  COGNIZANT                 WR/IR #: CHG0161780 *     01066048
010670*                                                           *     01067044
010680*************************************************************     01068044
010690/                                                                 01069044
010700 ENVIRONMENT DIVISION.                                            01070044
010800 CONFIGURATION SECTION.                                           01080044
010900 SOURCE-COMPUTER.        IBM-370.                                 01090044
011000 OBJECT-COMPUTER.        IBM-370.                                 01100044
011100                                                                  01110044
011200 INPUT-OUTPUT SECTION.                                            01120044
011300 FILE-CONTROL.                                                    01130044
011400     SELECT INVOICE-STATUS-FILE ASSIGN TO INP01.                  01140044
011500     SELECT RECEIV-UPDATE-FILE  ASSIGN TO INP02.                  01150044
011600                                                                  01160044
011700 DATA DIVISION.                                                   01170044
011800 FILE SECTION.                                                    01180044
011900 FD  INVOICE-STATUS-FILE                                          01190044
012000     RECORDING MODE IS F                                          01200044
012100     LABEL RECORDS ARE STANDARD                                   01210044
012200     BLOCK CONTAINS 0 RECORDS                                     01220044
012300     RECORD CONTAINS 80 CHARACTERS                                01230044
012400     DATA RECORD IS INVOICE-STATUS-DATA.                          01240044
012500 01  INVOICE-STATUS-DATA        PIC X(80).                        01250044
012600                                                                  01260044
012700                                                                  01270044
012800 FD  RECEIV-UPDATE-FILE                                           01280044
012900     RECORDING MODE IS F                                          01290044
013000     LABEL RECORDS ARE STANDARD                                   01300044
013100     BLOCK CONTAINS 0 RECORDS                                     01310044
013200     DATA RECORD IS RECEIV-UPDATE-REC.                            01320044
013300 01  RECEIV-UPDATE-REC          PIC X(72).                        01330044
013400/                                                                 01340044
013500 WORKING-STORAGE SECTION.                                         01350044
013600                                                                  01360044
013700 01  FILLER                       PIC X(58)     VALUE             01370044
013800     '************WORKING STORAGE STARTS HERE*******************'.01380044
013900                                                                  01390044
014000 01  PV-PROGRAM-VARIABLES.                                        01400044
014100     05  PV-PROGRAM-NAME          PIC  X(08)    VALUE 'APKUP252'. 01410044
014200     05  PV-CKPT-STAT-CODE        PIC X(01)     VALUE SPACE.      01420044
014300     05  PV-CURRENT-PARAGRAPH     PIC X(50)     VALUE SPACES.     01430044
014400     05  PV-CURRENT-TMST          PIC X(26)     VALUE SPACES.     01440044
014500     05  PV-DISPLAY-ORD-NBR       PIC 9(09)     VALUE ZERO.       01450044
014800     05  PV-CHECK-CDE1            PIC X(01)     VALUE SPACE.      01480044
014900     05  PV-CHECK-CDE2            PIC X(01)     VALUE SPACE.      01490044
015000     05  PV-CHECK-CDE3            PIC X(01)     VALUE SPACE.      01500044
015100     05  PV-CHECK-CDE4            PIC X(01)     VALUE SPACE.      01510044
015200                                                                  01520044
015300     05  PV-UPDATE-AP-PRC-CDE     PIC X(01)     VALUE SPACE.      01530044
015400                                                                  01540044
015500     05  PV-INV-INPUT-COUNT       PIC 9(09)     VALUE ZERO        01550044
015600                                                COMP-3.           01560044
015700     05  PV-INV-UPDATE-COUNT      PIC 9(09)     VALUE ZERO        01570044
015800                                                COMP-3.           01580044
015900     05  PV-RECV-INPUT-COUNT      PIC 9(09)     VALUE ZERO        01590044
016000                                                COMP-3.           01600044
016100     05  PV-TNINREC-INPUT-COUNT   PIC 9(09)     VALUE ZERO        01610044
016200                                                COMP-3.           01620044
016300     05  PV-TNINREC-UPDATE-COUNT  PIC 9(09)     VALUE ZERO        01630044
016400                                                COMP-3.           01640044
016500     05  PV-TRECDIS-INPUT-COUNT   PIC 9(09)     VALUE ZERO        01650044
016600                                                COMP-3.           01660044
016700     05  PV-TRECDIS-UPDATE-COUNT  PIC 9(09)     VALUE ZERO        01670044
016800                                                COMP-3.           01680044
016900     05  PV-TRECEIV-INPUT-COUNT   PIC 9(09)     VALUE ZERO        01690044
017000                                                COMP-3.           01700044
017100     05  PV-TRECEIV-UPDATE-COUNT  PIC 9(09)     VALUE ZERO        01710044
017200                                                COMP-3.           01720044
017210     05  PV-TRECDIS-DISPLAY-COUNT PIC 9(09)     VALUE 1000        01721051
017220                                                COMP-3.           01722048
017230     05  PV-TRECEIV-DISPLAY-COUNT PIC 9(09)     VALUE 100         01723051
017240                                                COMP-3.           01724048
017300                                                                  01730044
017400 01  PC-PROGRAM-CONSTANTS.                                        01740044
017500     05  PC-RETRY-MAX             PIC S9(04)    VALUE +3          01750044
017600                                                COMP SYNC.        01760044
017700     05  PC-RETRY-COUNT           PIC S9(04)    VALUE ZEROS.      01770044
017800     05  PC-IN-PROCESS-CODE       PIC X(01)     VALUE '9'.        01780044
017900     05  PC-RUN-COMPLETE-CODE     PIC X(01)     VALUE '0'.        01790044
018000     05  PC-ZEROS-5               PIC S9(05)    VALUE ZEROS.      01800044
018100     05  PC-JOURNALIZED           PIC X(01)     VALUE 'J'.        01810044
018200     05  PC-CONVERSION            PIC X(01)     VALUE 'C'.        01820044
018300     05  PC-WRITE-OFF             PIC X(01)     VALUE 'W'.        01830044
018400     05  PC-DELETE                PIC X(01)     VALUE 'D'.        01840044
018500                                                                  01850044
018600 01  PS-PROGRAM-SWITCHES.                                         01860044
018610     05  PS-TRECDIS-FOUND-SW      PIC  X(01)    VALUE 'N'.        01861044
018620         88  PS-TRECDIS-FOUND                   VALUE 'Y'.        01862044
018630         88  PS-TRECDIS-NOT-FOUND               VALUE 'N'.        01863044
018640     05  PS-COMMITS-TAKEN-SW      PIC  X(01)    VALUE 'N'.        01864044
018650         88  COMMITS-TAKEN                      VALUE 'T'.        01865044
018660         88  NO-COMMITS-TAKEN                   VALUE 'N'.        01866044
018670     05  PS-END-INVOICES-SW       PIC  X(01)    VALUE 'M'.        01867044
018680         88  MORE-INVOICES                      VALUE 'M'.        01868044
018690         88  END-OF-INVOICES                    VALUE 'E'.        01869044
018700     05  PS-END-RECEIVING-SW      PIC  X(01)    VALUE 'M'.        01870044
018800         88  MORE-RECEIVING                     VALUE 'M'.        01880044
018900         88  END-OF-RECEIVING                   VALUE 'E'.        01890044
019000     05  PS-RUN-TYPE-SW           PIC  X(01)    VALUE ' '.        01900044
019100         88  NORMAL-RUN                         VALUE '0'.        01910044
019200         88  RESTART-RUN                        VALUE '9'.        01920044
019300     05  PS-UPDATE-AP-PRC-SW      PIC  X(01)    VALUE 'N'.        01930044
019400         88  UPDATE-AP-PRC                      VALUE 'Y'.        01940044
019500         88  NOT-UPDATE-AP-PRC                  VALUE 'N'.        01950044
019600                                                                  01960044
019700 01  WS-COUNTER.                                                  01970044
019800     05  WS-HOLD-TMST             PIC X(26)     VALUE SPACES.     01980044
019900     05  WS-TMST                  PIC X(26)     VALUE SPACES.     01990044
020000                                                                  02000044
020100 01  CKPT-RESTART-INFO.                                           02010044
020200     05  CR-INPUT-FILE-SW         PIC X(01)     VALUE 'I'.        02020044
020300         88  INPUT-INVOICE-FILE                 VALUE 'I'.        02030044
020400         88  INPUT-RECEIVE-FILE                 VALUE 'R'.        02040044
020500     05  CR-INVOICE-RECS-WORKED   PIC  9(9)     VALUE ZERO.       02050044
020600     05  CR-RECEIVE-RECS-WORKED   PIC  9(9)     VALUE ZERO.       02060044
020700                                                                  02070044
020800*----------------------------------------------------------------*02080044
020900*  ABEND DATA AREAS                                              *02090044
021000*----------------------------------------------------------------*02100044
021100 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02110044
021200                                             COMP SYNC.           02120044
021300     88  AC-BAD-RECEIVE-DATA                 VALUE +4001.         02130044
021400     88  AC-BAD-DATA                         VALUE +4008.         02140044
021500     88  AC-DB2-ERROR                        VALUE +4013.         02150044
021600     88  AC-DATE-ERROR                       VALUE +4019.         02160044
021700                                                                  02170044
021800                                                                  02180044
021900 01  ABEND-AREAS.                                                 02190044
022000     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02200044
022100             '*****       ABEND'.                                 02210044
022200     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02220044
022300             '*****   PROGRAM: APKUP252'.                         02230044
022400     05  AA-PARAGRAPH-LIT.                                        02240044
022500         10  FILLER              PIC  X(17)  VALUE                02250044
022600             '***** PARAGRAPH: '.                                 02260044
022700         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02270044
022800     05  AA-MESSAGE-LINE-1.                                       02280044
022900         10  FILLER              PIC  X(06)  VALUE '*****'.       02290044
023000         10  AA-MESSAGE-1        PIC  X(127) VALUE SPACES.        02300044
023100     05  AA-MESSAGE-LINE-2.                                       02310044
023200         10  FILLER              PIC  X(06)  VALUE '*****'.       02320044
023300         10  AA-MESSAGE-2        PIC  X(127) VALUE SPACES.        02330044
023400     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02340044
023500             '*****    DB2 ERROR'.                                02350044
023600     05  AA-DB2-OPERATION-LIT.                                    02360044
023700         10  FILLER              PIC  X(17)  VALUE                02370044
023800             '***** OPERATION: '.                                 02380044
023900         10  AA-DB2-OPERATION    PIC  X(50)  VALUE SPACES.        02390044
024000     05  AA-DB2-TABLE            PIC  X(08)  VALUE SPACES.        02400044
024100     05  AA-BAD-RECEIVE-DATA-MSG-1.                               02410044
024200         10  FILLER              PIC  X(23)  VALUE                02420044
024300             'INVALID RECORD TYPE OF '.                           02430044
024400         10  AA-BAD-RECEIVE-TYPE PIC  9(01)  VALUE ZERO.          02440044
024500         10  FILLER              PIC  X(30)  VALUE                02450044
024600             ' ON INPUT RECEIVE UPDATES FILE'.                    02460044
024700*                                                                 02470044
024800*      INVOICE STATUS LAYOUT                                      02480044
024900*                                                                 02490044
025000     COPY APRD252.                                                02500044
025100*                                                                 02510044
025200*      RECEIV UPDATE LAYOUT                                       02520044
025300*                                                                 02530044
025400     COPY APRD254.                                                02540044
025500*                                                                 02550044
025600     COPY DPWS004.                                                02560044
025700*                                                                 02570044
025800*      INVOICE TABLE LAYOUT                                       02580044
025900*                                                                 02590044
026000         EXEC SQL                                                 02600044
026100             INCLUDE TINVOIC                                      02610044
026200         END-EXEC.                                                02620044
026300*                                                                 02630044
026400*      TRECEIV TABLE LAYOUT                                       02640044
026500*                                                                 02650044
026600         EXEC SQL                                                 02660044
026700             INCLUDE TRECEIV                                      02670044
026800         END-EXEC.                                                02680044
026900*                                                                 02690044
027000*      TRECDIS TABLE LAYOUT                                       02700044
027100*                                                                 02710044
027200         EXEC SQL                                                 02720044
027300             INCLUDE TRECDIS                                      02730044
027400         END-EXEC.                                                02740044
027500*                                                                 02750044
027600*      TNINREC TABLE LAYOUT                                       02760044
027700*                                                                 02770044
027800         EXEC SQL                                                 02780044
027900             INCLUDE TNINREC                                      02790044
028000         END-EXEC.                                                02800044
028100*                                                                 02810044
028200*      TCKRSTCNTL TABLE LAYOUT                                    02820044
028300*                                                                 02830044
028400         EXEC SQL                                                 02840044
028500             INCLUDE TCKRSTCN                                     02850044
028600         END-EXEC.                                                02860044
028700*                                                                 02870044
028800*      TCKRSTINF TABLE LAYOUT                                     02880044
028900*                                                                 02890044
029000         EXEC SQL                                                 02900044
029100             INCLUDE TCKRSTIN                                     02910044
029200         END-EXEC.                                                02920044
029300******************************************************************02930044
029400*  DB2 COMMUNICATION AREA                                         02940044
029500*                                                                 02950044
029600     EXEC SQL                                                     02960044
029700         INCLUDE SQLCA                                            02970044
029800     END-EXEC.                                                    02980044
029900*                                                                 02990044
030000*  DB2 COMMUNICATION AREA2                                        03000044
030100*                                                                 03010044
030200     COPY SQLCA2.                                                 03020044
030300/                                                                 03030044
030400 PROCEDURE DIVISION.                                              03040044
030500*----------------------------------------------------------------*03050044
030600*    MAIN DRIVER PARAGRAPH HANDLING THE 2 INPUT FILES: INVOICE   *03060044
030700*    AND RECEIVING.                                              *03070044
030800*----------------------------------------------------------------*03080044
030900 A000-MAINLINE-ROUTINE.                                           03090044
031000                                                                  03100044
031100     PERFORM B100-INITIALIZATION.                                 03110044
031200                                                                  03120044
031300     PERFORM B200-INVOICE-STATUS-PROCESSING                       03130044
031400             UNTIL END-OF-INVOICES.                               03140044
031500                                                                  03150044
031600     PERFORM B300-RECEIVING-PROCESSING                            03160044
031700             UNTIL END-OF-RECEIVING.                              03170044
031800                                                                  03180044
031900     PERFORM B400-EOJ-PROCESSING.                                 03190044
032000                                                                  03200044
032100     GOBACK.                                                      03210044
032200/                                                                 03220044
032300*----------------------------------------------------------------*03230044
032400*    INITIALIZATION LOOKING FOR POSSIBLE CHECKPOINT RESTART CON- *03240044
032500*    DITION.  IF NOT A RESTART SITUATION THEN INITIAL READS OF   *03250044
032600*    BOTH INPUT FILES ARE DONE.                                  *03260044
032700*----------------------------------------------------------------*03270044
032800 B100-INITIALIZATION.                                             03280044
032900                                                                  03290044
033000     OPEN INPUT INVOICE-STATUS-FILE                               03300044
033100                RECEIV-UPDATE-FILE.                               03310044
033200                                                                  03320044
033300     INITIALIZE  DCLTINVOIC                                       03330044
033400                 DCLTRECEIV                                       03340044
033500                 DCLTRECDIS                                       03350044
033600                 DCLTNINREC                                       03360044
033700                 DCLTCKRSTCNTL                                    03370044
033800                 DCLTCKRSTINF.                                    03380044
033900                                                                  03390044
034000     EXEC SQL                                                     03400044
034100         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 03410044
034200     END-EXEC.                                                    03420044
034300                                                                  03430044
034400     PERFORM S200-GET-CHECKPOINT-CNTL.                            03440044
034500     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    03450044
034600                                                                  03460044
034700     IF RESTART-RUN                                               03470044
034800         PERFORM X200-CHECKPOINT-RESTART                          03480044
034900     ELSE                                                         03490044
035000         PERFORM R100-READ-INVOICE-STATUS-FILE                    03500044
035100         PERFORM R200-READ-REC-FILE                               03510044
035200     END-IF.                                                      03520044
035300                                                                  03530044
035400     PERFORM S400-SET-CHECKPOINT-TIME.                            03540044
035500/                                                                 03550044
035600*----------------------------------------------------------------*03560044
035700*    PROCESS THE INVOICE STATUS FILE DATA.                       *03570044
035800*----------------------------------------------------------------*03580044
035900 B200-INVOICE-STATUS-PROCESSING.                                  03590044
036000                                                                  03600044
036100     MOVE AP252-PO-NBR              TO INVOIC-PO-NBR.             03610044
036200     MOVE AP252-INVOICE-ID          TO INVOIC-INVC-ID.            03620044
036300     MOVE AP252-NEW-STATUS-CDE      TO INVOIC-STATUS-CDE.         03630044
036400     MOVE AP252-AP-PRC-CDE          TO INVOIC-AP-PRC-CDE.         03640044
036500     MOVE AP252-AP-PRC-DTE          TO INVOIC-AP-PRC-DTE.         03650044
036600     MOVE AP252-PAYT-DTE            TO INVOIC-PAYT-DTE            03660044
036700                                                                  03670044
036800     IF AP252-AP-PRC-CDE = SPACE                                  03680044
036900        IF AP252-NEW-STATUS-CDE  = SPACE                          03690044
037000           CONTINUE                                               03700044
037100        ELSE                                                      03710044
037200           PERFORM U100-UPDATE-INVOICE-STATUS-CDE                 03720044
037300        END-IF                                                    03730044
037400     ELSE                                                         03740044
037500        IF AP252-NEW-STATUS-CDE = SPACE                           03750044
037600           PERFORM U050-UPDATE-INVOICE-PRC-CDE                    03760044
037700        ELSE                                                      03770044
037800           PERFORM U150-UPDATE-INVOICE                            03780044
037900        END-IF                                                    03790044
038000     END-IF.                                                      03800044
038100                                                                  03810044
038200     PERFORM X100-CHECKPOINT-CHECK.                               03820044
038300                                                                  03830044
038400     PERFORM R100-READ-INVOICE-STATUS-FILE.                       03840044
038500/                                                                 03850044
038600*----------------------------------------------------------------*03860044
038700*    PROCESS THE RECEIVING FILE DATA.                            *03870044
038800*----------------------------------------------------------------*03880044
038900 B300-RECEIVING-PROCESSING.                                       03890044
039000                                                                  03900044
039100     IF AP254-RECORD-TYPE = 1                                     03910044
039200        PERFORM C100-PROCESS-TRECDIS                              03920044
039300     ELSE                                                         03930044
039400        IF AP254-RECORD-TYPE = 2                                  03940044
039500           PERFORM C200-PROCESS-TRECEIV                           03950044
039600        ELSE                                                      03960044
039700           IF AP254-RECORD-TYPE = 3                               03970044
039800              PERFORM C300-PROCESS-TNINREC                        03980044
039900           END-IF                                                 03990044
040000        END-IF                                                    04000044
040100     END-IF.                                                      04010044
040200                                                                  04020044
040300     PERFORM R200-READ-REC-FILE.                                  04030044
040400/                                                                 04040044
040500*----------------------------------------------------------------*04050044
040600*    END OF JOB PROCESSING.                                      *04060044
040700*----------------------------------------------------------------*04070044
040800 B400-EOJ-PROCESSING.                                             04080044
040900                                                                  04090044
041000     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              04100044
041100     PERFORM U500-UPDATE-TCKRSTCNTL.                              04110044
041200                                                                  04120044
041300     CLOSE  INVOICE-STATUS-FILE                                   04130044
041400            RECEIV-UPDATE-FILE.                                   04140044
041500                                                                  04150044
041600     DISPLAY '** APKUP252 SUMMARY **'.                            04160044
041700     DISPLAY '** INVOICE INPUT COUNT  = ' PV-INV-INPUT-COUNT.     04170044
041800     DISPLAY '** INVOICE UPDATE COUNT = ' PV-INV-UPDATE-COUNT.    04180044
041900     DISPLAY '** TRECDIS INPUT COUNT  = ' PV-TRECDIS-INPUT-COUNT. 04190044
042000     DISPLAY '** TRECDIS UPDATE COUNT = ' PV-TRECDIS-UPDATE-COUNT.04200044
042100     DISPLAY '** TRECEIV INPUT COUNT  = ' PV-TRECEIV-INPUT-COUNT. 04210044
042200     DISPLAY '** TRECEIV UPDATE COUNT = ' PV-TRECEIV-UPDATE-COUNT.04220044
042300     DISPLAY '** TNINREC INPUT COUNT  = ' PV-TNINREC-INPUT-COUNT. 04230044
042400     DISPLAY '** TNINREC UPDATE COUNT = ' PV-TNINREC-UPDATE-COUNT.04240044
042500/                                                                 04250044
042600*----------------------------------------------------------------*04260044
042700*    CONTROLS UPDATING OF THE TRECDIS TABLE.                     *04270044
042800*----------------------------------------------------------------*04280044
042900 C100-PROCESS-TRECDIS.                                            04290044
043000                                                                  04300044
043100     MOVE 'C100-PROCESS-TRECDIS' TO PV-CURRENT-PARAGRAPH.         04310044
043200                                                                  04320044
043300     PERFORM U300-UPDATE-RECDIS.                                  04330044
043400                                                                  04340044
043410     IF  PV-TRECDIS-UPDATE-COUNT > PV-TRECDIS-DISPLAY-COUNT       04341048
043420         DISPLAY 'TRECDIS UPDATE COUNT = ' PV-TRECDIS-UPDATE-COUNT04342048
043430         ADD +10000 TO PV-TRECDIS-DISPLAY-COUNT                   04343048
043440     END-IF.                                                      04344048
043450                                                                  04345048
043500     PERFORM X100-CHECKPOINT-CHECK.                               04350044
043600/                                                                 04360044
043700*----------------------------------------------------------------*04370044
043800*    CONTROLS UPDATING OF THE TRECEIV TABLE. CHECK RECDIS TO     *04380044
043900*    DETERMINE TRECEIV UPDATE CODE.  IF ALL ASSOCIATED TRECDIS   *04390044
044000*    ROWS HAVE BEEN JOURNALIZED(AND/OR WRITTEN OFF) THEN THE     *04400044
044100*    TRECEIV TABLE MAY BE MARKED AS JOURNALIZED ALSO.            *04410044
044200*----------------------------------------------------------------*04420044
044300 C200-PROCESS-TRECEIV.                                            04430044
044400                                                                  04440044
044500     MOVE 'C200-PROCESS-TRECEIV' TO PV-CURRENT-PARAGRAPH.         04450044
044600                                                                  04460044
044700     PERFORM S100-CHECK-RECDIS.                                   04470044
044800                                                                  04480044
044900     IF UPDATE-AP-PRC                                             04490044
045000        PERFORM U200-UPDATE-RECEIV                                04500044
045020        IF  PV-TRECEIV-UPDATE-COUNT > PV-TRECEIV-DISPLAY-COUNT    04502048
045030            DISPLAY 'TRECEIV UPDATE COUNT = '                     04503048
045031                      PV-TRECEIV-UPDATE-COUNT                     04503148
045040            ADD +1000 TO PV-TRECEIV-DISPLAY-COUNT                 04504048
045050        END-IF                                                    04505048
045100        PERFORM X100-CHECKPOINT-CHECK                             04510044
045200     END-IF.                                                      04520044
045300/                                                                 04530044
045400*----------------------------------------------------------------*04540044
045500*    CONTROLS UPDATING OF THE TNINREC TABLE.                     *04550044
045600*----------------------------------------------------------------*04560044
045700 C300-PROCESS-TNINREC.                                            04570044
045800                                                                  04580044
045900     MOVE 'C300-PROCESS-TNINREC' TO PV-CURRENT-PARAGRAPH.         04590044
046000                                                                  04600044
046100     PERFORM U400-UPDATE-NINREC.                                  04610044
046200                                                                  04620044
046300     PERFORM X100-CHECKPOINT-CHECK.                               04630044
046400/                                                                 04640044
046500*----------------------------------------------------------------*04650044
046600*    READ THE INVOICE STATUS FILE.                               *04660044
046700*----------------------------------------------------------------*04670044
046800 R100-READ-INVOICE-STATUS-FILE.                                   04680044
046900                                                                  04690044
047000     READ INVOICE-STATUS-FILE                                     04700044
047100          INTO AP252-RECORD                                       04710044
047200          AT END SET END-OF-INVOICES                              04720044
047300                     INPUT-RECEIVE-FILE TO TRUE.                  04730044
047400                                                                  04740044
047500     IF MORE-INVOICES                                             04750044
047600         ADD 1 TO PV-INV-INPUT-COUNT                              04760044
047700     END-IF.                                                      04770044
047800/                                                                 04780044
047900*----------------------------------------------------------------*04790044
048000*    READ THE RECEIVING UPDATE FILE.                             *04800044
048100*----------------------------------------------------------------*04810044
048200 R200-READ-REC-FILE.                                              04820044
048300                                                                  04830044
048400     READ RECEIV-UPDATE-FILE                                      04840044
048500          INTO AP254-RECORD                                       04850044
048600          AT END                                                  04860044
048700                SET END-OF-RECEIVING     TO TRUE                  04870044
048800          NOT AT END                                              04880044
048900                ADD 1 TO PV-RECV-INPUT-COUNT                      04890044
049000                IF AP254-RECORD-TYPE = 1                          04900044
049100                    ADD 1 TO PV-TRECDIS-INPUT-COUNT               04910044
049200                ELSE                                              04920044
049300                    IF AP254-RECORD-TYPE = 2                      04930044
049400                        ADD 1 TO PV-TRECEIV-INPUT-COUNT           04940044
049500                    ELSE                                          04950044
049600                        IF AP254-RECORD-TYPE = 3                  04960044
049700                            ADD 1 TO PV-TNINREC-INPUT-COUNT       04970044
049800                        ELSE                                      04980044
049900                            MOVE AP254-RECORD-TYPE TO             04990044
050000                                AA-BAD-RECEIVE-TYPE               05000044
050100                            MOVE AA-BAD-RECEIVE-DATA-MSG-1 TO     05010044
050200                                AA-MESSAGE-1                      05020044
050300                            SET AC-BAD-RECEIVE-DATA TO TRUE       05030044
050400                            PERFORM Z900-PROCESS-ABEND            05040044
050500                        END-IF                                    05050044
050600                    END-IF                                        05060044
050700                END-IF.                                           05070044
050800/                                                                 05080044
050900*----------------------------------------------------------------*05090044
051000*    CHECK IF ALL TRECDIS ROWS FOR A ORDER NUMBER ARE JOURNALIZED*05100044
051100*    OR WRITTEN-OFF BEFORE JOURNALIZING TRECEIV.                 *05110044
051200*----------------------------------------------------------------*05120044
051300 S100-CHECK-RECDIS.                                               05130044
051400                                                                  05140044
051500     MOVE 'S100-CHECK-RECDIS       ' TO PV-CURRENT-PARAGRAPH.     05150044
051600                                                                  05160044
051700     SET  NOT-UPDATE-AP-PRC          TO TRUE.                     05170044
051800                                                                  05180044
051900     IF AP254-JRNLZD                                              05190044
052000        MOVE PC-JOURNALIZED          TO PV-CHECK-CDE1             05200044
052100        MOVE PC-CONVERSION           TO PV-CHECK-CDE2             05210044
052200        MOVE PC-WRITE-OFF            TO PV-CHECK-CDE3             05220044
052300        MOVE PC-DELETE               TO PV-CHECK-CDE4             05230044
052400        PERFORM S150-SELECT-RECDIS                                05240044
052500        IF PS-TRECDIS-NOT-FOUND                                   05250044
052600           MOVE PC-JOURNALIZED       TO PV-UPDATE-AP-PRC-CDE      05260044
052700           SET  UPDATE-AP-PRC        TO TRUE                      05270044
052800        END-IF                                                    05280044
052900     ELSE                                                         05290044
053000        IF AP254-WRT-OFF                                          05300044
053100           MOVE PC-WRITE-OFF         TO PV-CHECK-CDE1             05310044
053200           PERFORM S175-SELECT-RECDIS                             05320044
053300           IF PS-TRECDIS-NOT-FOUND                                05330044
053400              MOVE PC-WRITE-OFF      TO PV-UPDATE-AP-PRC-CDE      05340044
053500              SET  UPDATE-AP-PRC        TO TRUE                   05350044
053600           ELSE                                                   05360044
053700              MOVE PC-JOURNALIZED    TO PV-CHECK-CDE1             05370044
053800              MOVE PC-CONVERSION     TO PV-CHECK-CDE2             05380044
053900              MOVE PC-WRITE-OFF      TO PV-CHECK-CDE3             05390044
054000              MOVE PC-DELETE         TO PV-CHECK-CDE4             05400044
054100              PERFORM S150-SELECT-RECDIS                          05410044
054200              IF PS-TRECDIS-NOT-FOUND                             05420044
054300                 MOVE PC-JOURNALIZED  TO PV-UPDATE-AP-PRC-CDE     05430044
054400                 SET  UPDATE-AP-PRC        TO TRUE                05440044
054500              END-IF                                              05450044
054600           END-IF                                                 05460044
054700        END-IF                                                    05470044
054800     END-IF.                                                      05480044
054900/                                                                 05490044
055000*----------------------------------------------------------------*05500044
055100*    SELECT COUNT OF RECDIS THAT ARE NOT JOURNALIZED.            *05510044
055200*----------------------------------------------------------------*05520044
055300 S150-SELECT-RECDIS.                                              05530044
055400                                                                  05540044
055500     MOVE 'S150-SELECT-RECDIS      ' TO PV-CURRENT-PARAGRAPH.     05550044
055600     INITIALIZE PS-TRECDIS-FOUND-SW                               05560044
055700                RECDIS-ORD-NBR.                                   05570044
055800     PERFORM WITH TEST AFTER                                      05580044
055900             VARYING PC-RETRY-COUNT FROM 1 BY 1                   05590044
056000             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX                05600047
056100                OR   SQLCODE = ZERO                               05610047
056110                OR   SQLCODE = +100                               05611047
056200                                                                  05620044
056300         EXEC SQL                                                 05630044
056400           SELECT ORD_NBR                                         05640044
056500             INTO :RECDIS-ORD-NBR                                 05650044
056600             FROM TRECDIS                                         05660044
056700            WHERE ORD_NBR      =  :AP254-RC-PURCHASE-ORDER        05670044
056800              AND REC_SEQ_NBR  =  :AP254-RC-RECVR-SEQ-NBR         05680044
056900              AND VER_STATUS_CDE  = 'A'                           05690044
057000              AND AP_PRC_CDE NOT IN                               05700044
057100                          (:PV-CHECK-CDE1,:PV-CHECK-CDE2,         05710044
057200                           :PV-CHECK-CDE3,:PV-CHECK-CDE4)         05720044
057300            FETCH FIRST 1 ROW ONLY                                05730044
057400         END-EXEC                                                 05740044
057500                                                                  05750044
057600         EVALUATE TRUE                                            05760044
057700             WHEN SQLCODE = ZERO                                  05770044
057800              SET  PS-TRECDIS-FOUND TO TRUE                       05780044
057900             WHEN SQLCODE = +100                                  05790044
058000              SET  PS-TRECDIS-NOT-FOUND TO TRUE                   05800044
058100             WHEN SQLCODE = -904                                  05810044
058200             WHEN SQLCODE = -911                                  05820044
058300             WHEN SQLCODE = -913                                  05830044
058400                  CONTINUE                                        05840044
058500             WHEN SQLWARN0 NOT = SPACES                           05850044
058600             WHEN SQLCODE  NOT = ZERO                             05860044
058700                 MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME  05870044
058800                 DISPLAY '******** PLAN_NAME:' PV-PROGRAM-NAME    05880044
058900                 MOVE SPACES                TO AA-MESSAGE-1       05890044
059000                                               AA-MESSAGE-2       05900044
059100                 MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION   05910044
059200                 MOVE 'TRECDIS   '          TO AA-DB2-TABLE       05920044
059300                 MOVE RECDIS-ORD-NBR        TO PV-DISPLAY-ORD-NBR 05930044
059400                 DISPLAY 'ORDER-NO = ' PV-DISPLAY-ORD-NBR         05940044
059410                 DISPLAY 'RECDIS-ORD-NBR ' RECDIS-ORD-NBR         05941046
059500                 PERFORM Z999-DB2-ABEND                           05950044
059600         END-EVALUATE                                             05960044
059700     END-PERFORM.                                                 05970044
059800                                                                  05980044
059900     IF PC-RETRY-COUNT > PC-RETRY-MAX                             05990044
060000         MOVE PV-CURRENT-PARAGRAPH                                06000044
060100                             TO AA-PARAGRAPH-NAME                 06010044
060200         DISPLAY '******** PLAN_NAME:'                            06020044
060300                  PV-PROGRAM-NAME                                 06030044
060400         MOVE SPACES TO AA-MESSAGE-1                              06040044
060500                        AA-MESSAGE-2                              06050044
060600         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    06060044
060700                             TO AA-DB2-OPERATION                  06070044
060800         MOVE 'TRECDIS   '   TO AA-DB2-TABLE                      06080044
060900         PERFORM Z999-DB2-ABEND                                   06090044
061000     END-IF.                                                      06100044
061100/                                                                 06110044
061200*----------------------------------------------------------------*06120044
061300*    SELECT COUNT OF RECDIS THAT ARE NOT WRITTEN-OFF.            *06130044
061400*----------------------------------------------------------------*06140044
061500 S175-SELECT-RECDIS.                                              06150044
061600                                                                  06160044
061700     MOVE 'S175-SELECT-RECDIS      ' TO PV-CURRENT-PARAGRAPH.     06170044
061800     INITIALIZE PS-TRECDIS-FOUND-SW                               06180044
061900                RECDIS-ORD-NBR.                                   06190044
062000     PERFORM WITH TEST AFTER                                      06200044
062100             VARYING PC-RETRY-COUNT FROM 1 BY 1                   06210044
062200             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX                06220047
062300                OR   SQLCODE = ZERO                               06230047
062310                OR   SQLCODE = +100                               06231047
062400                                                                  06240044
062500         EXEC SQL                                                 06250044
062600           SELECT ORD_NBR                                         06260044
062700             INTO :RECDIS-ORD-NBR                                 06270044
062800             FROM TRECDIS                                         06280044
062900            WHERE ORD_NBR      =  :AP254-RC-PURCHASE-ORDER        06290044
063000              AND REC_SEQ_NBR  =  :AP254-RC-RECVR-SEQ-NBR         06300044
063100              AND VER_STATUS_CDE  = 'A'                           06310044
063200              AND AP_PRC_CDE NOT IN  (:PV-CHECK-CDE1)             06320044
063300            FETCH FIRST 1 ROW ONLY                                06330044
063400         END-EXEC                                                 06340044
063500                                                                  06350044
063600         EVALUATE TRUE                                            06360044
063700             WHEN SQLCODE = ZERO                                  06370044
063701              SET PS-TRECDIS-FOUND TO TRUE                        06370144
063702             WHEN SQLCODE = +100                                  06370244
063703              SET PS-TRECDIS-NOT-FOUND TO TRUE                    06370344
063704             WHEN SQLCODE = -904                                  06370444
063705             WHEN SQLCODE = -911                                  06370544
063706             WHEN SQLCODE = -913                                  06370644
063707                  CONTINUE                                        06370744
063708             WHEN SQLWARN0 NOT = SPACES                           06370844
063709             WHEN SQLCODE  NOT = ZERO                             06370944
063710                 MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME  06371044
063720                 DISPLAY '******** PLAN_NAME:' PV-PROGRAM-NAME    06372044
063730                 MOVE SPACES                TO AA-MESSAGE-1       06373044
063740                                               AA-MESSAGE-2       06374044
063750                 MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION   06375044
063760                 MOVE 'TRECDIS   '          TO AA-DB2-TABLE       06376044
063770                 MOVE RECDIS-ORD-NBR        TO PV-DISPLAY-ORD-NBR 06377044
063780                 DISPLAY 'ORDER-NO = ' PV-DISPLAY-ORD-NBR         06378044
063790                 PERFORM Z999-DB2-ABEND                           06379044
063800         END-EVALUATE                                             06380044
063900     END-PERFORM.                                                 06390044
064000                                                                  06400044
064100     IF PC-RETRY-COUNT > PC-RETRY-MAX                             06410044
064200         MOVE PV-CURRENT-PARAGRAPH                                06420044
064300                             TO AA-PARAGRAPH-NAME                 06430044
064400         DISPLAY '******** PLAN_NAME:'                            06440044
064410                 DISPLAY 'ORDER-NO = ' PV-DISPLAY-ORD-NBR         06441045
064420                 DISPLAY 'RECDIS-ORD-NBR ' RECDIS-ORD-NBR         06442046
064430         DISPLAY 'AP254-RC-PURCHASE-ORDER 'AP254-RC-PURCHASE-ORDER06443046
064440         DISPLAY 'AP254-RC-RECVR-SEQ-NBR ' AP254-RC-RECVR-SEQ-NBR 06444046
064450         DISPLAY 'PV-CHECK-CDE1 ' PV-CHECK-CDE1                   06445046
064500                  PV-PROGRAM-NAME                                 06450044
064600         MOVE SPACES TO AA-MESSAGE-1                              06460044
064700                        AA-MESSAGE-2                              06470044
064800         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    06480044
064900                             TO AA-DB2-OPERATION                  06490044
065000         MOVE 'TRECDIS   '   TO AA-DB2-TABLE                      06500044
065100         PERFORM Z999-DB2-ABEND                                   06510044
065200     END-IF.                                                      06520044
065300/                                                                 06530044
065400*----------------------------------------------------------------*06540044
065500*    SELECT CHECKPOINT RESTART CONTROL INFO.                     *06550044
065600*----------------------------------------------------------------*06560044
065700 S200-GET-CHECKPOINT-CNTL.                                        06570044
065800                                                                  06580044
065900     MOVE 'S200-GET-CHECKPOINT-CNTL' TO PV-CURRENT-PARAGRAPH.     06590044
066000                                                                  06600044
066100     PERFORM WITH TEST AFTER                                      06610044
066200             VARYING PC-RETRY-COUNT FROM 1 BY 1                   06620044
066300             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             06630044
066400                     SQLCODE = ZERO                               06640044
066500                                                                  06650044
066600             EXEC SQL                                             06660044
066700              SELECT CKPT_STAT_CODE                               06670044
066800               INTO :PV-CKPT-STAT-CODE                            06680044
066900               FROM TCKRSTCNTL                                    06690044
067000               WHERE PLAN_NAME = :PV-PROGRAM-NAME                 06700044
067100             END-EXEC                                             06710044
067200                                                                  06720044
067300             EVALUATE TRUE                                        06730044
067400                 WHEN SQLCODE = ZERO                              06740044
067500                 WHEN SQLCODE = -904                              06750044
067600                 WHEN SQLCODE = -911                              06760044
067700                 WHEN SQLCODE = -913                              06770044
067800                      CONTINUE                                    06780044
067900                                                                  06790044
068000                 WHEN SQLWARN0 NOT = SPACES                       06800044
068100                 WHEN SQLCODE  NOT = ZERO                         06810044
068200                     MOVE PV-CURRENT-PARAGRAPH                    06820044
068300                                         TO AA-PARAGRAPH-NAME     06830044
068400                     DISPLAY '******** PLAN_NAME:'                06840044
068500                              PV-PROGRAM-NAME                     06850044
068600                     MOVE SPACES TO AA-MESSAGE-1                  06860044
068700                                    AA-MESSAGE-2                  06870044
068800                     MOVE 'UNSUCCESSFUL SELECT'                   06880044
068900                                         TO AA-DB2-OPERATION      06890044
069000                     MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE          06900044
069100                     PERFORM Z999-DB2-ABEND                       06910044
069200             END-EVALUATE                                         06920044
069300     END-PERFORM.                                                 06930044
069400                                                                  06940044
069500     IF PC-RETRY-COUNT > PC-RETRY-MAX                             06950044
069600         MOVE PV-CURRENT-PARAGRAPH                                06960044
069700                             TO AA-PARAGRAPH-NAME                 06970044
069800         DISPLAY '******** PLAN_NAME:'                            06980044
069900                  PV-PROGRAM-NAME                                 06990044
070000         MOVE SPACES TO AA-MESSAGE-1                              07000044
070100                        AA-MESSAGE-2                              07010044
070200         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    07020044
070300                             TO AA-DB2-OPERATION                  07030044
070400         MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE                      07040044
070500         PERFORM Z999-DB2-ABEND                                   07050044
070600     END-IF.                                                      07060044
070700/                                                                 07070044
070800*----------------------------------------------------------------*07080044
070900*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO  *07090044
071000*----------------------------------------------------------------*07100044
071100 S300-GET-CHECKPOINT-INFO.                                        07110044
071200                                                                  07120044
071300     MOVE 'S300-GET-CHECKPOINT-INFO' TO PV-CURRENT-PARAGRAPH.     07130044
071400                                                                  07140044
071500     PERFORM WITH TEST AFTER                                      07150044
071600             VARYING PC-RETRY-COUNT FROM 1 BY 1                   07160044
071700             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             07170044
071800                     SQLCODE = ZERO                               07180044
071900                                                                  07190044
072000             EXEC SQL                                             07200044
072100              SELECT WORK_STRG_DESC                               07210044
072200               INTO :TCKRSTINF-WORK-STRG-DESC                     07220044
072300               FROM TCKRSTINF                                     07230044
072400               WHERE PLAN_NAME = :PV-PROGRAM-NAME                 07240044
072500             END-EXEC                                             07250044
072600                                                                  07260044
072700             EVALUATE TRUE                                        07270044
072800                 WHEN SQLCODE = ZERO                              07280044
072900                 WHEN SQLCODE = -904                              07290044
073000                 WHEN SQLCODE = -911                              07300044
073100                 WHEN SQLCODE = -913                              07310044
073200                      CONTINUE                                    07320044
073300                                                                  07330044
073400                 WHEN SQLWARN0 NOT = SPACES                       07340044
073500                 WHEN SQLCODE  NOT = ZERO                         07350044
073600                     MOVE PV-CURRENT-PARAGRAPH                    07360044
073700                                         TO AA-PARAGRAPH-NAME     07370044
073800                     DISPLAY '******** PLAN_NAME:'                07380044
073900                              PV-PROGRAM-NAME                     07390044
074000                     MOVE SPACES TO AA-MESSAGE-1                  07400044
074100                                    AA-MESSAGE-2                  07410044
074200                     MOVE 'UNSUCCESSFUL SELECT'                   07420044
074300                                         TO AA-DB2-OPERATION      07430044
074400                     MOVE 'TCKRSTINF'    TO AA-DB2-TABLE          07440044
074500                     PERFORM Z999-DB2-ABEND                       07450044
074600             END-EVALUATE                                         07460044
074700     END-PERFORM.                                                 07470044
074800                                                                  07480044
074900     IF PC-RETRY-COUNT > PC-RETRY-MAX                             07490044
075000         MOVE PV-CURRENT-PARAGRAPH                                07500044
075100                             TO AA-PARAGRAPH-NAME                 07510044
075200         DISPLAY '******** PLAN_NAME:'                            07520044
075300                  PV-PROGRAM-NAME                                 07530044
075400         MOVE SPACES TO AA-MESSAGE-1                              07540044
075500                        AA-MESSAGE-2                              07550044
075600         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    07560044
075700                             TO AA-DB2-OPERATION                  07570044
075800         MOVE 'TCKRSTINF'    TO AA-DB2-TABLE                      07580044
075900         PERFORM Z999-DB2-ABEND                                   07590044
076000     END-IF.                                                      07600044
076100/                                                                 07610044
076200*----------------------------------------------------------------*07620044
076300*    SET THE TIME FOR THE NEXT CHECKPOINT.                       *07630044
076400*----------------------------------------------------------------*07640044
076500 S400-SET-CHECKPOINT-TIME.                                        07650044
076600                                                                  07660044
076700     MOVE 'S400-SET-CHECKPOINT-TIME' TO PV-CURRENT-PARAGRAPH.     07670044
076800                                                                  07680044
076900     PERFORM WITH TEST AFTER                                      07690044
077000             VARYING PC-RETRY-COUNT FROM 1 BY 1                   07700044
077100             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             07710044
077200                     SQLCODE = ZERO                               07720044
077300                                                                  07730044
077400             EXEC SQL                                             07740044
077500              SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)07750044
077600               INTO :WS-HOLD-TMST                                 07760044
077700               FROM TCKRSTCNTL                                    07770044
077800               WHERE PLAN_NAME = :PV-PROGRAM-NAME                 07780044
077900             END-EXEC                                             07790044
078000                                                                  07800044
078100             EVALUATE TRUE                                        07810044
078200                 WHEN SQLCODE = ZERO                              07820044
078300                 WHEN SQLCODE = -904                              07830044
078400                 WHEN SQLCODE = -911                              07840044
078500                 WHEN SQLCODE = -913                              07850044
078600                      CONTINUE                                    07860044
078700                                                                  07870044
078800                 WHEN SQLWARN0 NOT = SPACES                       07880044
078900                 WHEN SQLCODE  NOT = ZERO                         07890044
079000                     MOVE PV-CURRENT-PARAGRAPH                    07900044
079100                                         TO AA-PARAGRAPH-NAME     07910044
079200                     DISPLAY '******** PLAN_NAME:'                07920044
079300                              PV-PROGRAM-NAME                     07930044
079400                     MOVE SPACES TO AA-MESSAGE-1                  07940044
079500                                    AA-MESSAGE-2                  07950044
079600                     MOVE 'UNSUCCESSFUL SELECT'                   07960044
079700                                         TO AA-DB2-OPERATION      07970044
079800                     MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE          07980044
079900                     PERFORM Z999-DB2-ABEND                       07990044
080000             END-EVALUATE                                         08000044
080100     END-PERFORM.                                                 08010044
080200                                                                  08020044
080300     IF PC-RETRY-COUNT > PC-RETRY-MAX                             08030044
080400         MOVE PV-CURRENT-PARAGRAPH                                08040044
080500                             TO AA-PARAGRAPH-NAME                 08050044
080600         DISPLAY '******** PLAN_NAME:'                            08060044
080700                  PV-PROGRAM-NAME                                 08070044
080800         MOVE SPACES TO AA-MESSAGE-1                              08080044
080900                        AA-MESSAGE-2                              08090044
081000         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    08100044
081100                             TO AA-DB2-OPERATION                  08110044
081200         MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE                      08120044
081300         PERFORM Z999-DB2-ABEND                                   08130044
081400     END-IF.                                                      08140044
081500/                                                                 08150044
081600*----------------------------------------------------------------*08160044
081700*    UPDATES THE INVOICE TABLE.  THE PROCESSING CODE AND THE     *08170044
081800*    PROCESSING DATE ARE SET ACCORDING TO THE VALUES PREVIOUSLY  *08180044
081900*    GIVEN.                                                      *08190044
082000*----------------------------------------------------------------*08200044
082100 U050-UPDATE-INVOICE-PRC-CDE.                                     08210044
082200                                                                  08220044
082300     MOVE 'U050-UPDATE-INVOICE-PRC-CDE' TO PV-CURRENT-PARAGRAPH.  08230044
082400                                                                  08240044
082500     PERFORM WITH TEST AFTER                                      08250044
082600             VARYING PC-RETRY-COUNT FROM 1 BY 1                   08260044
082700             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             08270044
082800                     SQLCODE = ZERO                               08280044
082900                                                                  08290044
083000             EXEC SQL                                             08300044
083100                 UPDATE TINVOIC                                   08310044
083200                   SET AP_PRC_CDE         = :INVOIC-AP-PRC-CDE    08320044
083300                     , AP_PRC_DTE         = :INVOIC-AP-PRC-DTE    08330044
083400                 WHERE  PO_NBR            = :INVOIC-PO-NBR        08340044
083500                   AND  INVC_ID           = :INVOIC-INVC-ID       08350044
083600             END-EXEC                                             08360044
083700                                                                  08370044
083800             EVALUATE TRUE                                        08380044
083900                 WHEN SQLCODE = ZERO                              08390044
084000                     ADD 1 TO PV-INV-UPDATE-COUNT                 08400044
084100                                                                  08410044
084200                 WHEN SQLCODE = -904                              08420044
084300                 WHEN SQLCODE = -911                              08430044
084400                 WHEN SQLCODE = -913                              08440044
084500                      CONTINUE                                    08450044
084600                                                                  08460044
084700                 WHEN SQLCODE = +100                              08470044
084800                     MOVE PV-CURRENT-PARAGRAPH                    08480044
084900                                         TO AA-PARAGRAPH-NAME     08490044
085000                     DISPLAY '******** PO NBR: '                  08500044
085100                              AP252-PO-NBR                        08510044
085200                     DISPLAY '******** INVOICE ID: '              08520044
085300                              AP252-INVOICE-ID                    08530044
085400                     MOVE 'INVOICE NOT ON TABLE ********'         08540044
085500                              TO AA-MESSAGE-1                     08550044
085600                     MOVE SPACES TO AA-MESSAGE-2                  08560044
085700                     MOVE 'UNSUCCESSFUL UPDATE'                   08570044
085800                              TO AA-DB2-OPERATION                 08580044
085900                     MOVE 'TINVOIC'  TO AA-DB2-TABLE              08590044
086000                     PERFORM Z999-DB2-ABEND                       08600044
086100                 WHEN SQLWARN0 NOT = SPACES                       08610044
086200                 WHEN SQLCODE  NOT = ZERO                         08620044
086300                     MOVE PV-CURRENT-PARAGRAPH                    08630044
086400                                         TO AA-PARAGRAPH-NAME     08640044
086500                     DISPLAY '******** PO NBR: '                  08650044
086600                              AP252-PO-NBR                        08660044
086700                     DISPLAY '******** INVOICE ID: '              08670044
086800                              AP252-INVOICE-ID                    08680044
086900                     MOVE SPACES TO AA-MESSAGE-1                  08690044
087000                                    AA-MESSAGE-2                  08700044
087100                     MOVE 'UNSUCCESSFUL UPDATE'                   08710044
087200                                         TO AA-DB2-OPERATION      08720044
087300                     MOVE 'TINVOIC'      TO AA-DB2-TABLE          08730044
087400                     PERFORM Z999-DB2-ABEND                       08740044
087500             END-EVALUATE                                         08750044
087600     END-PERFORM.                                                 08760044
087700                                                                  08770044
087800     IF PC-RETRY-COUNT > PC-RETRY-MAX                             08780044
087900         MOVE PV-CURRENT-PARAGRAPH                                08790044
088000                             TO AA-PARAGRAPH-NAME                 08800044
088100         DISPLAY '******** PO NBR: '                              08810044
088200                  AP252-PO-NBR                                    08820044
088300         DISPLAY '******** INVOICE ID: '                          08830044
088400                  AP252-INVOICE-ID                                08840044
088500         MOVE SPACES TO AA-MESSAGE-1                              08850044
088600                        AA-MESSAGE-2                              08860044
088700         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    08870044
088800                             TO AA-DB2-OPERATION                  08880044
088900         MOVE 'TINVOIC'      TO AA-DB2-TABLE                      08890044
089000         PERFORM Z999-DB2-ABEND                                   08900044
089100     END-IF.                                                      08910044
089200/                                                                 08920044
089300*----------------------------------------------------------------*08930044
089400*    UPDATES THE INVOICE TABLE.  THE STATUS CODE IS SET FROM THE *08940044
089500*    APRD252 RECORD AND THE STATUS CHANGE TIMESTAMP IS SET TO    *08950044
089600*    THE CURRENT TIMESTAMP.                                      *08960044
089700*----------------------------------------------------------------*08970044
089800 U100-UPDATE-INVOICE-STATUS-CDE.                                  08980044
089900                                                                  08990044
090000     MOVE 'U100-UPDATE-INVOICE-STATUS-CDE' TO PV-CURRENT-PARAGRAPH09000044
090100                                                                  09010044
090200     PERFORM WITH TEST AFTER                                      09020044
090300             VARYING PC-RETRY-COUNT FROM 1 BY 1                   09030044
090400             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             09040044
090500                     SQLCODE = ZERO                               09050044
090600                                                                  09060044
090700             EXEC SQL                                             09070044
090800                 UPDATE TINVOIC                                   09080044
090900                   SET STATUS_CDE         = :INVOIC-STATUS-CDE    09090044
091000                     , STATUS_CHG_TMST    = CURRENT TIMESTAMP     09100044
091100                     , PAYT_DTE           = :INVOIC-PAYT-DTE      09110044
091200                 WHERE  PO_NBR            = :INVOIC-PO-NBR        09120044
091300                   AND  INVC_ID           = :INVOIC-INVC-ID       09130044
091400             END-EXEC                                             09140044
091500                                                                  09150044
091600             EVALUATE TRUE                                        09160044
091700                 WHEN SQLCODE = ZERO                              09170044
091800                     ADD 1 TO PV-INV-UPDATE-COUNT                 09180044
091900                                                                  09190044
092000                 WHEN SQLCODE = -904                              09200044
092100                 WHEN SQLCODE = -911                              09210044
092200                 WHEN SQLCODE = -913                              09220044
092300                      CONTINUE                                    09230044
092400                                                                  09240044
092500                 WHEN SQLCODE = +100                              09250044
092600                     MOVE PV-CURRENT-PARAGRAPH                    09260044
092700                                         TO AA-PARAGRAPH-NAME     09270044
092800                     DISPLAY '******** PO NBR: '                  09280044
092900                              AP252-PO-NBR                        09290044
093000                     DISPLAY '******** INVOICE ID: '              09300044
093100                              AP252-INVOICE-ID                    09310044
093200                     MOVE 'INVOICE NOT ON TABLE ********'         09320044
093300                              TO AA-MESSAGE-1                     09330044
093400                     MOVE SPACES TO AA-MESSAGE-2                  09340044
093500                     MOVE 'UNSUCCESSFUL UPDATE'                   09350044
093600                              TO AA-DB2-OPERATION                 09360044
093700                     MOVE 'TINVOIC'  TO AA-DB2-TABLE              09370044
093800                     PERFORM Z999-DB2-ABEND                       09380044
093900                 WHEN SQLWARN0 NOT = SPACES                       09390044
094000                 WHEN SQLCODE  NOT = ZERO                         09400044
094100                     MOVE PV-CURRENT-PARAGRAPH                    09410044
094200                                         TO AA-PARAGRAPH-NAME     09420044
094300                     DISPLAY '******** PO NBR: '                  09430044
094400                              AP252-PO-NBR                        09440044
094500                     DISPLAY '******** INVOICE ID: '              09450044
094600                              AP252-INVOICE-ID                    09460044
094700                     MOVE SPACES TO AA-MESSAGE-1                  09470044
094800                                    AA-MESSAGE-2                  09480044
094900                     MOVE 'UNSUCCESSFUL UPDATE'                   09490044
095000                                         TO AA-DB2-OPERATION      09500044
095100                     MOVE 'TINVOIC'      TO AA-DB2-TABLE          09510044
095200                     PERFORM Z999-DB2-ABEND                       09520044
095300             END-EVALUATE                                         09530044
095400     END-PERFORM.                                                 09540044
095500                                                                  09550044
095600     IF PC-RETRY-COUNT > PC-RETRY-MAX                             09560044
095700         MOVE PV-CURRENT-PARAGRAPH                                09570044
095800                             TO AA-PARAGRAPH-NAME                 09580044
095900         DISPLAY '******** PO NBR: '                              09590044
096000                  AP252-PO-NBR                                    09600044
096100         DISPLAY '******** INVOICE ID: '                          09610044
096200                  AP252-INVOICE-ID                                09620044
096300         MOVE SPACES TO AA-MESSAGE-1                              09630044
096400                        AA-MESSAGE-2                              09640044
096500         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    09650044
096600                             TO AA-DB2-OPERATION                  09660044
096700         MOVE 'TINVOIC'      TO AA-DB2-TABLE                      09670044
096800         PERFORM Z999-DB2-ABEND                                   09680044
096900     END-IF.                                                      09690044
097000/                                                                 09700044
097100*----------------------------------------------------------------*09710044
097200*    UPDATES THE INVOICE TABLE.  THE STATUS CODE IS SET FROM THE *09720044
097300*    APRD252 RECORD, THE STATUS CHANGE TIMESTAMP IS SET TO       *09730044
097400*    THE CURRENT TIMESTAMP AND THE AP PROCESSED COLS ARE UPDATED.*09740044
097500*----------------------------------------------------------------*09750044
097600 U150-UPDATE-INVOICE.                                             09760044
097700                                                                  09770044
097800     MOVE 'U150-UPDATE-INVOICE' TO PV-CURRENT-PARAGRAPH.          09780044
097900                                                                  09790044
098000     PERFORM WITH TEST AFTER                                      09800044
098100             VARYING PC-RETRY-COUNT FROM 1 BY 1                   09810044
098200             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             09820044
098300                     SQLCODE = ZERO                               09830044
098400                                                                  09840044
098500             EXEC SQL                                             09850044
098600                 UPDATE TINVOIC                                   09860044
098700                   SET STATUS_CDE         = :INVOIC-STATUS-CDE    09870044
098800                     , STATUS_CHG_TMST    = CURRENT TIMESTAMP     09880044
098900                     , PAYT_DTE           = :INVOIC-PAYT-DTE      09890044
099000                     , AP_PRC_CDE         = :INVOIC-AP-PRC-CDE    09900044
099100                     , AP_PRC_DTE         = :INVOIC-AP-PRC-DTE    09910044
099200                 WHERE  PO_NBR            = :INVOIC-PO-NBR        09920044
099300                   AND  INVC_ID           = :INVOIC-INVC-ID       09930044
099400             END-EXEC                                             09940044
099500                                                                  09950044
099600             EVALUATE TRUE                                        09960044
099700                 WHEN SQLCODE = ZERO                              09970044
099800                     ADD 1 TO PV-INV-UPDATE-COUNT                 09980044
099900                                                                  09990044
100000                 WHEN SQLCODE = -904                              10000044
100100                 WHEN SQLCODE = -911                              10010044
100200                 WHEN SQLCODE = -913                              10020044
100300                      CONTINUE                                    10030044
100400                                                                  10040044
100500                 WHEN SQLCODE = +100                              10050044
100600                     MOVE PV-CURRENT-PARAGRAPH                    10060044
100700                                         TO AA-PARAGRAPH-NAME     10070044
100800                     DISPLAY '******** PO NBR: '                  10080044
100900                              AP252-PO-NBR                        10090044
101000                     DISPLAY '******** INVOICE ID: '              10100044
101100                              AP252-INVOICE-ID                    10110044
101200                     MOVE 'INVOICE NOT ON TABLE ********'         10120044
101300                              TO AA-MESSAGE-1                     10130044
101400                     MOVE SPACES TO AA-MESSAGE-2                  10140044
101500                     MOVE 'UNSUCCESSFUL UPDATE'                   10150044
101600                              TO AA-DB2-OPERATION                 10160044
101700                     MOVE 'TINVOIC'  TO AA-DB2-TABLE              10170044
101800                     PERFORM Z999-DB2-ABEND                       10180044
101900                 WHEN SQLWARN0 NOT = SPACES                       10190044
102000                 WHEN SQLCODE  NOT = ZERO                         10200044
102100                     MOVE PV-CURRENT-PARAGRAPH                    10210044
102200                                         TO AA-PARAGRAPH-NAME     10220044
102300                     DISPLAY '******** PO NBR: '                  10230044
102400                              AP252-PO-NBR                        10240044
102500                     DISPLAY '******** INVOICE ID: '              10250044
102600                              AP252-INVOICE-ID                    10260044
102700                     MOVE SPACES TO AA-MESSAGE-1                  10270044
102800                                    AA-MESSAGE-2                  10280044
102900                     MOVE 'UNSUCCESSFUL UPDATE'                   10290044
103000                                         TO AA-DB2-OPERATION      10300044
103100                     MOVE 'TINVOIC'      TO AA-DB2-TABLE          10310044
103200                     PERFORM Z999-DB2-ABEND                       10320044
103300             END-EVALUATE                                         10330044
103400     END-PERFORM.                                                 10340044
103500                                                                  10350044
103600     IF PC-RETRY-COUNT > PC-RETRY-MAX                             10360044
103700         MOVE PV-CURRENT-PARAGRAPH                                10370044
103800                             TO AA-PARAGRAPH-NAME                 10380044
103900         DISPLAY '******** PO NBR: '                              10390044
104000                  AP252-PO-NBR                                    10400044
104100         DISPLAY '******** INVOICE ID: '                          10410044
104200                  AP252-INVOICE-ID                                10420044
104300         MOVE SPACES TO AA-MESSAGE-1                              10430044
104400                        AA-MESSAGE-2                              10440044
104500         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    10450044
104600                             TO AA-DB2-OPERATION                  10460044
104700         MOVE 'TINVOIC'      TO AA-DB2-TABLE                      10470044
104800         PERFORM Z999-DB2-ABEND                                   10480044
104900     END-IF.                                                      10490044
105000/                                                                 10500044
105100*----------------------------------------------------------------*10510044
105200*    UPDATES THE RECEIVER TABLE.  THE AP PROCESS CODE IS SET     *10520044
105300*    TO 'J' (JOURNALIZED) AND THE AP PROCESS DATE IS SET TO      *10530044
105400*    THE CURRENT DATE.                                           *10540044
105500*----------------------------------------------------------------*10550044
105600 U200-UPDATE-RECEIV.                                              10560044
105700                                                                  10570044
105800     MOVE 'U200-UPDATE-RECEIV' TO PV-CURRENT-PARAGRAPH.           10580044
105900                                                                  10590044
106000     PERFORM WITH TEST AFTER                                      10600044
106100             VARYING PC-RETRY-COUNT FROM 1 BY 1                   10610044
106200             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             10620044
106300                     SQLCODE = ZERO                               10630044
106400                                                                  10640044
106500             EXEC SQL                                             10650044
106600                 UPDATE TRECEIV                                   10660044
106700                 SET AP_PRC_CDE = :PV-UPDATE-AP-PRC-CDE           10670044
106800                   , AP_PRC_DTE = :AP254-AP-PRC-DTE               10680044
106900                 WHERE ORD_NBR        = :AP254-RC-PURCHASE-ORDER  10690044
107000                   AND REC_SEQ_NBR    = :AP254-RC-RECVR-SEQ-NBR   10700044
107100                   AND VER_STATUS_CDE = 'A'                       10710044
107200             END-EXEC                                             10720044
107300                                                                  10730044
107400             EVALUATE TRUE                                        10740044
107500                 WHEN SQLCODE = ZERO                              10750044
107600                 WHEN SQLCODE = -904                              10760044
107700                 WHEN SQLCODE = -911                              10770044
107800                 WHEN SQLCODE = -913                              10780044
107900                      CONTINUE                                    10790044
108000                                                                  10800044
108100                 WHEN SQLWARN0 NOT = SPACES                       10810044
108200                 WHEN SQLCODE  NOT = ZERO                         10820044
108300                     MOVE PV-CURRENT-PARAGRAPH                    10830044
108400                                         TO AA-PARAGRAPH-NAME     10840044
108500                     DISPLAY '******** PO:'                       10850044
108600                              AP254-RC-PURCHASE-ORDER             10860044
108700                     DISPLAY '******** RECVR SEQ:'                10870044
108800                              AP254-RC-RECVR-SEQ-NBR              10880044
108900                     MOVE SPACES TO AA-MESSAGE-1                  10890044
109000                                    AA-MESSAGE-2                  10900044
109100                     MOVE 'UNSUCCESSFUL UPDATE'                   10910044
109200                                         TO AA-DB2-OPERATION      10920044
109300                     MOVE 'TRECEIV'      TO AA-DB2-TABLE          10930044
109400                     PERFORM Z999-DB2-ABEND                       10940044
109500             END-EVALUATE                                         10950044
109600     END-PERFORM.                                                 10960044
109700                                                                  10970044
109800     IF PC-RETRY-COUNT > PC-RETRY-MAX                             10980044
109900         MOVE PV-CURRENT-PARAGRAPH                                10990044
110000                             TO AA-PARAGRAPH-NAME                 11000044
110100         DISPLAY '******** PO:'                                   11010044
110200                  AP254-RC-PURCHASE-ORDER                         11020044
110300         DISPLAY '******** RECVR SEQ:'                            11030044
110400                  AP254-RC-RECVR-SEQ-NBR                          11040044
110500         MOVE SPACES TO AA-MESSAGE-1                              11050044
110600                        AA-MESSAGE-2                              11060044
110700         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    11070044
110800                             TO AA-DB2-OPERATION                  11080044
110900         MOVE 'TRECEIV'      TO AA-DB2-TABLE                      11090044
111000         PERFORM Z999-DB2-ABEND                                   11100044
111100     END-IF.                                                      11110044
111200                                                                  11120044
111300     EVALUATE TRUE                                                11130044
111400         WHEN SQLCODE = ZEROS                                     11140044
111500             ADD 1 TO PV-TRECEIV-UPDATE-COUNT                     11150044
111600         WHEN OTHER                                               11160044
111700             MOVE PV-CURRENT-PARAGRAPH                            11170044
111800                                 TO AA-PARAGRAPH-NAME             11180044
111900             DISPLAY '******** PO:'                               11190044
112000                      AP254-RC-PURCHASE-ORDER                     11200044
112100             DISPLAY '******** RECVR SEQ:'                        11210044
112200                      AP254-RC-RECVR-SEQ-NBR                      11220044
112300             MOVE SPACES TO AA-MESSAGE-1                          11230044
112400                            AA-MESSAGE-2                          11240044
112500             MOVE 'UNSUCCESSFUL UPDATE'                           11250044
112600                                 TO AA-DB2-OPERATION              11260044
112700             MOVE 'TRECEIV'      TO AA-DB2-TABLE                  11270044
112800             PERFORM Z999-DB2-ABEND                               11280044
112900     END-EVALUATE.                                                11290044
113000/                                                                 11300044
113100*----------------------------------------------------------------*11310044
113200*    UPDATES THE RECEIPT DISTRIBUTION TABLE.  THE AP PROCESS      11320044
113300*    CODE IS SET TO 'J' (JOURNALIZED) AND THE AP PROCESS DATE     11330044
113400*    IS SET TO THE CURRENT DATE.                                  11340044
113500*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE SHOULD NEVER   11350044
113600*           OCCUR SINCE RECEIPT DISTRIBUTION KEY WAS RETRIEVED    11360044
113700*           WITH A CALL IN APKUP254.  IF A NOT FOUND CONDITION    11370044
113800*           DOES OCCUR, IT SIGNALS A PROBLEM AND THE PROGRAM      11380044
113900*           WILL ABEND.                                           11390044
114000*----------------------------------------------------------------*11400044
114100 U300-UPDATE-RECDIS.                                              11410044
114200                                                                  11420044
114300     MOVE 'U300-UPDATE-RECDIS' TO PV-CURRENT-PARAGRAPH.           11430044
114400                                                                  11440044
114500     PERFORM WITH TEST AFTER                                      11450044
114600             VARYING PC-RETRY-COUNT FROM 1 BY 1                   11460044
114700             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             11470044
114800                     SQLCODE = ZERO                               11480044
114900                                                                  11490044
115000             EXEC SQL                                             11500044
115100                 UPDATE TRECDIS                                   11510044
115200                 SET AP_PRC_CDE = :AP254-AP-PRC-CDE               11520044
115300                   , AP_PRC_DTE = :AP254-AP-PRC-DTE               11530044
115400                 WHERE ORD_NBR        = :AP254-RD-PURCHASE-ORDER  11540044
115500                   AND ORD_LNE_NBR    = :AP254-RD-PO-LNE-NBR      11550044
115600                   AND REC_SEQ_NBR    = :AP254-RD-REC-SEQ-NBR     11560044
115700                   AND OPER_UNT_ID    = :AP254-RD-OPER-UNIT-ID    11570044
115800                   AND FCLTY_ID       = :AP254-RD-FACILITY-ID     11580044
115900                   AND STR_NBR        = :AP254-RD-STORE-NBR       11590044
116000                   AND STR_FCLTY_ID   = :AP254-RD-STORE-FCLTY-ID  11600044
116100             END-EXEC                                             11610044
116200                                                                  11620044
116300             EVALUATE TRUE                                        11630044
116400                 WHEN SQLCODE = ZERO                              11640044
116500                 WHEN SQLCODE = -904                              11650044
116600                 WHEN SQLCODE = -911                              11660044
116700                 WHEN SQLCODE = -913                              11670044
116800                      CONTINUE                                    11680044
116900                                                                  11690044
117000                 WHEN SQLWARN0 NOT = SPACES                       11700044
117100                 WHEN SQLCODE  NOT = ZERO                         11710044
117200                     MOVE PV-CURRENT-PARAGRAPH                    11720044
117300                                         TO AA-PARAGRAPH-NAME     11730044
117400                     DISPLAY '******** PO:'                       11740044
117500                              AP254-RD-PURCHASE-ORDER             11750044
117600                     DISPLAY '******** PO LINE NBR:'              11760044
117700                              AP254-RD-PO-LNE-NBR                 11770044
117800                     DISPLAY '******** RECVR SEQ:'                11780044
117900                              AP254-RD-REC-SEQ-NBR                11790044
118000                     MOVE SPACES TO AA-MESSAGE-1                  11800044
118100                                    AA-MESSAGE-2                  11810044
118200                     MOVE 'UNSUCCESSFUL UPDATE'                   11820044
118300                                         TO AA-DB2-OPERATION      11830044
118400                     MOVE 'TRECDIS'      TO AA-DB2-TABLE          11840044
118500                     PERFORM Z999-DB2-ABEND                       11850044
118600             END-EVALUATE                                         11860044
118700     END-PERFORM.                                                 11870044
118800                                                                  11880044
118900     IF PC-RETRY-COUNT > PC-RETRY-MAX                             11890044
119000         MOVE PV-CURRENT-PARAGRAPH                                11900044
119100                             TO AA-PARAGRAPH-NAME                 11910044
119200         DISPLAY '******** PO:'                                   11920044
119300                  AP254-RD-PURCHASE-ORDER                         11930044
119400         DISPLAY '******** PO LINE NBR:'                          11940044
119500                  AP254-RD-PO-LNE-NBR                             11950044
119600         DISPLAY '******** RECVR SEQ:'                            11960044
119700                  AP254-RD-REC-SEQ-NBR                            11970044
119800         MOVE SPACES TO AA-MESSAGE-1                              11980044
119900                        AA-MESSAGE-2                              11990044
120000         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    12000044
120100                             TO AA-DB2-OPERATION                  12010044
120200         MOVE 'TRECDIS'      TO AA-DB2-TABLE                      12020044
120300         PERFORM Z999-DB2-ABEND                                   12030044
120400     END-IF.                                                      12040044
120500                                                                  12050044
120600     EVALUATE TRUE                                                12060044
120700         WHEN SQLCODE = ZEROS                                     12070044
120800             ADD 1 TO PV-TRECDIS-UPDATE-COUNT                     12080044
120900         WHEN OTHER                                               12090044
121000             MOVE PV-CURRENT-PARAGRAPH                            12100044
121100                                 TO AA-PARAGRAPH-NAME             12110044
121200             DISPLAY '******** PO:'                               12120044
121300                      AP254-RD-PURCHASE-ORDER                     12130044
121400             DISPLAY '******** PO LINE NBR:'                      12140044
121500                      AP254-RD-PO-LNE-NBR                         12150044
121600             DISPLAY '******** RECVR SEQ:'                        12160044
121700                      AP254-RD-REC-SEQ-NBR                        12170044
121800             MOVE SPACES TO AA-MESSAGE-1                          12180044
121900                            AA-MESSAGE-2                          12190044
122000             MOVE 'UNSUCCESSFUL UPDATE'                           12200044
122100                                 TO AA-DB2-OPERATION              12210044
122200             MOVE 'TRECDIS'      TO AA-DB2-TABLE                  12220044
122300             PERFORM Z999-DB2-ABEND                               12230044
122400     END-EVALUATE.                                                12240044
122500/                                                                 12250044
122600*----------------------------------------------------------------*12260044
122700*    UPDATES THE NON-INVOICED RECEIPT TABLE.  THE STATUS CODE    *12270044
122800*    IS SET TO 'J' (JOURNALIZED) AND THE PAYMENT RELEASE         *12280044
122900*    TIMESTAMP IS SET TO THE CURRENT TIMESTAMP.                  *12290044
123000*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE SHOULD NEVER  *12300044
123100*           OCCUR SINCE NON-INVOICED RECEIPT KEY WAS RETRIEVED   *12310044
123200*           WITH A CALL IN APKUP254.  IF A NOT FOUND CONDITION   *12320044
123300*           DOES OCCUR, IT SIGNALS A PROBLEM AND THE PROGRAM     *12330044
123400*           WILL ABEND.                                          *12340044
123500*----------------------------------------------------------------*12350044
123600 U400-UPDATE-NINREC.                                              12360044
123700                                                                  12370044
123800     MOVE 'U400-UPDATE-NINREC' TO PV-CURRENT-PARAGRAPH.           12380044
123900                                                                  12390044
124000     PERFORM WITH TEST AFTER                                      12400044
124100             VARYING PC-RETRY-COUNT FROM 1 BY 1                   12410044
124200             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             12420044
124300                     SQLCODE = ZERO                               12430044
124400                                                                  12440044
124500             EXEC SQL                                             12450044
124600                 UPDATE TNINREC                                   12460044
124700                 SET STATUS_CDE       = :AP254-AP-PRC-CDE         12470044
124800                 WHERE PO_NBR         = :AP254-NR-PURCHASE-ORDER  12480044
124900                   AND PO_LNE_NBR     = :AP254-NR-PO-LNE-NBR      12490044
125000                   AND NON_INVC_SEQ_NBR                           12500044
125100                                      = :AP254-NR-NINVC-SEQ-NBR   12510044
125200             END-EXEC                                             12520044
125300                                                                  12530044
125400             EVALUATE TRUE                                        12540044
125500                 WHEN SQLCODE = ZERO                              12550044
125600                 WHEN SQLCODE = -904                              12560044
125700                 WHEN SQLCODE = -911                              12570044
125800                 WHEN SQLCODE = -913                              12580044
125900                      CONTINUE                                    12590044
126000                                                                  12600044
126100                 WHEN SQLWARN0 NOT = SPACES                       12610044
126200                 WHEN SQLCODE  NOT = ZERO                         12620044
126300                     MOVE PV-CURRENT-PARAGRAPH                    12630044
126400                                         TO AA-PARAGRAPH-NAME     12640044
126500                     DISPLAY '******** PO:'                       12650044
126600                              AP254-NR-PURCHASE-ORDER             12660044
126700                     DISPLAY '******** PO LINE NBR:'              12670044
126800                              AP254-NR-PO-LNE-NBR                 12680044
126900                     DISPLAY '******** NON INV SEQ:'              12690044
127000                              AP254-NR-NINVC-SEQ-NBR              12700044
127100                     MOVE SPACES TO AA-MESSAGE-1                  12710044
127200                                    AA-MESSAGE-2                  12720044
127300                     MOVE 'UNSUCCESSFUL UPDATE'                   12730044
127400                                         TO AA-DB2-OPERATION      12740044
127500                     MOVE 'TNINREC'      TO AA-DB2-TABLE          12750044
127600                     PERFORM Z999-DB2-ABEND                       12760044
127700             END-EVALUATE                                         12770044
127800     END-PERFORM.                                                 12780044
127900                                                                  12790044
128000     IF PC-RETRY-COUNT > PC-RETRY-MAX                             12800044
128100         MOVE PV-CURRENT-PARAGRAPH                                12810044
128200                             TO AA-PARAGRAPH-NAME                 12820044
128300         DISPLAY '******** PO:'                                   12830044
128400                  AP254-NR-PURCHASE-ORDER                         12840044
128500         DISPLAY '******** PO LINE NBR:'                          12850044
128600                  AP254-NR-PO-LNE-NBR                             12860044
128700         DISPLAY '******** NON INV SEQ:'                          12870044
128800                  AP254-NR-NINVC-SEQ-NBR                          12880044
128900         MOVE SPACES TO AA-MESSAGE-1                              12890044
129000                        AA-MESSAGE-2                              12900044
129100         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    12910044
129200                             TO AA-DB2-OPERATION                  12920044
129300         MOVE 'TNINREC'      TO AA-DB2-TABLE                      12930044
129400         PERFORM Z999-DB2-ABEND                                   12940044
129500     END-IF.                                                      12950044
129600                                                                  12960044
129700     EVALUATE TRUE                                                12970044
129800         WHEN SQLCODE = ZEROS                                     12980044
129900             ADD 1 TO PV-TNINREC-UPDATE-COUNT                     12990044
130000         WHEN OTHER                                               13000044
130100             MOVE PV-CURRENT-PARAGRAPH                            13010044
130200                                 TO AA-PARAGRAPH-NAME             13020044
130300             DISPLAY '******** PO:'                               13030044
130400                      AP254-NR-PURCHASE-ORDER                     13040044
130500             DISPLAY '******** PO LINE NBR:'                      13050044
130600                      AP254-NR-PO-LNE-NBR                         13060044
130700             DISPLAY '******** NON INV SEQ:'                      13070044
130800                      AP254-NR-NINVC-SEQ-NBR                      13080044
130900             MOVE SPACES TO AA-MESSAGE-1                          13090044
131000                            AA-MESSAGE-2                          13100044
131100             MOVE 'UNSUCCESSFUL UPDATE'                           13110044
131200                                 TO AA-DB2-OPERATION              13120044
131300             MOVE 'TNINREC'      TO AA-DB2-TABLE                  13130044
131400             PERFORM Z999-DB2-ABEND                               13140044
131500     END-EVALUATE.                                                13150044
131600/                                                                 13160044
131700*----------------------------------------------------------------*13170044
131800*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *13180044
131900*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *13190044
132000*----------------------------------------------------------------*13200044
132100 U500-UPDATE-TCKRSTCNTL.                                          13210044
132200                                                                  13220044
132300     MOVE 'U500-UPDATE-TCKRSTCNTL' TO PV-CURRENT-PARAGRAPH.       13230044
132400                                                                  13240044
132500     PERFORM WITH TEST AFTER                                      13250044
132600             VARYING PC-RETRY-COUNT FROM 1 BY 1                   13260044
132700             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             13270044
132800                     SQLCODE = ZERO                               13280044
132900                                                                  13290044
133000             EXEC SQL                                             13300044
133100                 UPDATE TCKRSTCNTL                                13310044
133200                 SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE          13320044
133300                 WHERE PLAN_NAME      = :PV-PROGRAM-NAME          13330044
133400             END-EXEC                                             13340044
133500                                                                  13350044
133600             EVALUATE TRUE                                        13360044
133700                 WHEN SQLCODE = ZERO                              13370044
133800                 WHEN SQLCODE = -904                              13380044
133900                 WHEN SQLCODE = -911                              13390044
134000                 WHEN SQLCODE = -913                              13400044
134100                      CONTINUE                                    13410044
134200                                                                  13420044
134300                 WHEN SQLWARN0 NOT = SPACES                       13430044
134400                 WHEN SQLCODE  NOT = ZERO                         13440044
134500                     MOVE PV-CURRENT-PARAGRAPH                    13450044
134600                                         TO AA-PARAGRAPH-NAME     13460044
134700                     DISPLAY '******** PLAN_NAME:'                13470044
134800                              PV-PROGRAM-NAME                     13480044
134900                     MOVE SPACES TO AA-MESSAGE-1                  13490044
135000                                    AA-MESSAGE-2                  13500044
135100                     MOVE 'UNSUCCESSFUL UPDATE'                   13510044
135200                                         TO AA-DB2-OPERATION      13520044
135300                     MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE          13530044
135400                     PERFORM Z999-DB2-ABEND                       13540044
135500             END-EVALUATE                                         13550044
135600     END-PERFORM.                                                 13560044
135700                                                                  13570044
135800     IF PC-RETRY-COUNT > PC-RETRY-MAX                             13580044
135900         MOVE PV-CURRENT-PARAGRAPH                                13590044
136000                             TO AA-PARAGRAPH-NAME                 13600044
136100         DISPLAY '******** PLAN_NAME:'                            13610044
136200                  PV-PROGRAM-NAME                                 13620044
136300         MOVE SPACES TO AA-MESSAGE-1                              13630044
136400                        AA-MESSAGE-2                              13640044
136500         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    13650044
136600                             TO AA-DB2-OPERATION                  13660044
136700         MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE                      13670044
136800         PERFORM Z999-DB2-ABEND                                   13680044
136900     END-IF.                                                      13690044
137000/                                                                 13700044
137100*----------------------------------------------------------------*13710044
137200*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *13720044
137300*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *13730044
137400*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.        *13740044
137500*----------------------------------------------------------------*13750044
137600 U600-UPDATE-TCKRSTINF.                                           13760044
137700                                                                  13770044
137800     MOVE 'U600-UPDATE-TCKRSTINF' TO PV-CURRENT-PARAGRAPH.        13780044
137900                                                                  13790044
138000     MOVE PV-INV-INPUT-COUNT  TO CR-INVOICE-RECS-WORKED.          13800044
138100     MOVE PV-RECV-INPUT-COUNT TO CR-RECEIVE-RECS-WORKED.          13810044
138200     MOVE CKPT-RESTART-INFO   TO TCKRSTINF-WORK-STRG-DESC-TEXT.   13820044
138300     MOVE 4022                TO TCKRSTINF-WORK-STRG-DESC-LEN.    13830044
138400                                                                  13840044
138500     PERFORM WITH TEST AFTER                                      13850044
138600             VARYING PC-RETRY-COUNT FROM 1 BY 1                   13860044
138700             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             13870044
138800                     SQLCODE = ZERO                               13880044
138900                                                                  13890044
139000             EXEC SQL                                             13900044
139100                 UPDATE TCKRSTINF                                 13910044
139200                 SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC 13920044
139300                 WHERE PLAN_NAME      = :PV-PROGRAM-NAME          13930044
139400             END-EXEC                                             13940044
139500                                                                  13950044
139600             EVALUATE TRUE                                        13960044
139700                 WHEN SQLCODE = ZERO                              13970044
139800                 WHEN SQLCODE = -904                              13980044
139900                 WHEN SQLCODE = -911                              13990044
140000                 WHEN SQLCODE = -913                              14000044
140100                      CONTINUE                                    14010044
140200                                                                  14020044
140300                 WHEN SQLWARN0 NOT = SPACES                       14030044
140400                 WHEN SQLCODE  NOT = ZERO                         14040044
140500                     MOVE PV-CURRENT-PARAGRAPH                    14050044
140600                                         TO AA-PARAGRAPH-NAME     14060044
140700                     DISPLAY '******** PLAN_NAME:'                14070044
140800                              PV-PROGRAM-NAME                     14080044
140900                     MOVE SPACES TO AA-MESSAGE-1                  14090044
141000                                    AA-MESSAGE-2                  14100044
141100                     MOVE 'UNSUCCESSFUL UPDATE'                   14110044
141200                                         TO AA-DB2-OPERATION      14120044
141300                     MOVE 'TCKRSTINF'    TO AA-DB2-TABLE          14130044
141400                     PERFORM Z999-DB2-ABEND                       14140044
141500             END-EVALUATE                                         14150044
141600     END-PERFORM.                                                 14160044
141700                                                                  14170044
141800     IF PC-RETRY-COUNT > PC-RETRY-MAX                             14180044
141900         MOVE PV-CURRENT-PARAGRAPH                                14190044
142000                             TO AA-PARAGRAPH-NAME                 14200044
142100         DISPLAY '******** PLAN_NAME:'                            14210044
142200                  PV-PROGRAM-NAME                                 14220044
142300         MOVE SPACES TO AA-MESSAGE-1                              14230044
142400                        AA-MESSAGE-2                              14240044
142500         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    14250044
142600                             TO AA-DB2-OPERATION                  14260044
142700         MOVE 'TCKRSTINF'    TO AA-DB2-TABLE                      14270044
142800         PERFORM Z999-DB2-ABEND                                   14280044
142900     END-IF.                                                      14290044
143000/                                                                 14300044
143100*----------------------------------------------------------------*14310044
143200*    ISSUES AN SQL COMMIT WORK AFTER A LUW HAS BEEN COMPLETED.   *14320044
143300*----------------------------------------------------------------*14330044
143400 U900-COMMIT.                                                     14340044
143500                                                                  14350044
143600     MOVE 'U900-COMMIT'    TO PV-CURRENT-PARAGRAPH.               14360044
143700                                                                  14370044
143800     EXEC SQL                                                     14380044
143900         COMMIT                                                   14390044
144000     END-EXEC.                                                    14400044
144100                                                                  14410044
144200     EVALUATE TRUE                                                14420044
144300         WHEN SQLCODE = ZEROS                                     14430044
144400             CONTINUE                                             14440044
144500         WHEN OTHER                                               14450044
144600             MOVE PV-CURRENT-PARAGRAPH                            14460044
144700                                 TO AA-PARAGRAPH-NAME             14470044
144800             MOVE SPACES TO AA-MESSAGE-1                          14480044
144900                            AA-MESSAGE-2                          14490044
145000             MOVE 'UNSUCCESSFUL COMMIT'                           14500044
145100                                 TO AA-DB2-OPERATION              14510044
145200             MOVE SPACES         TO AA-DB2-TABLE                  14520044
145300             PERFORM Z999-DB2-ABEND                               14530044
145400     END-EVALUATE.                                                14540044
145500/                                                                 14550044
145600*----------------------------------------------------------------*14560044
145700*    CHECK TO SEE IF A CHECKPOINT SHOULD BE TAKEN.               *14570044
145800*----------------------------------------------------------------*14580044
145900 X100-CHECKPOINT-CHECK.                                           14590044
146000                                                                  14600044
146100     MOVE 'X100-CHECKPOINT-CHECK' TO PV-CURRENT-PARAGRAPH.        14610044
146200                                                                  14620044
146300     EXEC SQL                                                     14630044
146400       SET :WS-TMST = CURRENT TIMESTAMP                           14640044
146500     END-EXEC.                                                    14650044
146600                                                                  14660044
146700     IF SQLCODE = +0                                              14670044
146800         CONTINUE                                                 14680044
146900     ELSE                                                         14690044
147000         MOVE PV-CURRENT-PARAGRAPH                                14700044
147100                             TO AA-PARAGRAPH-NAME                 14710044
147200         MOVE SPACES TO AA-MESSAGE-1                              14720044
147300                        AA-MESSAGE-2                              14730044
147400         MOVE 'BAD SET COMMAND'                                   14740044
147500                             TO AA-DB2-OPERATION                  14750044
147600         MOVE SPACES             TO AA-DB2-TABLE                  14760044
147700         PERFORM Z999-DB2-ABEND                                   14770044
147800     END-IF.                                                      14780044
147900                                                                  14790044
148000     IF WS-TMST > WS-HOLD-TMST                                    14800044
148100         IF NO-COMMITS-TAKEN                                      14810044
148200             MOVE PC-IN-PROCESS-CODE TO PV-CKPT-STAT-CODE         14820044
148300             PERFORM U500-UPDATE-TCKRSTCNTL                       14830044
148400             SET COMMITS-TAKEN TO TRUE                            14840044
148500         END-IF                                                   14850044
148600         PERFORM U600-UPDATE-TCKRSTINF                            14860044
148700         PERFORM U900-COMMIT                                      14870044
148800         PERFORM S400-SET-CHECKPOINT-TIME                         14880044
148900     END-IF.                                                      14890044
149000/                                                                 14900044
149100*----------------------------------------------------------------*14910044
149200*    CHECK TO SEE IF A CHECKPOINT SHOULD BE TAKEN.               *14920044
149300*----------------------------------------------------------------*14930044
149400 X200-CHECKPOINT-RESTART.                                         14940044
149500                                                                  14950044
149600     MOVE 'X200-CHECKPOINT-RESTART' TO PV-CURRENT-PARAGRAPH.      14960044
149700                                                                  14970044
149800     PERFORM S300-GET-CHECKPOINT-INFO.                            14980044
149900     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     14990044
150000                                                                  15000044
150100     DISPLAY '** APKUP252 CHECKPOINT RESTART **'                  15010044
150200     DISPLAY '** INVOICE RECS BYPASSED ON RESTART = '             15020044
150300              CR-INVOICE-RECS-WORKED.                             15030044
150400     DISPLAY '** RECEIVE RECS BYPASSED ON RESTART = '             15040044
150500              CR-RECEIVE-RECS-WORKED.                             15050044
150600     DISPLAY '***********************************************'    15060044
150700                                                                  15070044
150800     IF INPUT-INVOICE-FILE                                        15080044
150900         PERFORM R100-READ-INVOICE-STATUS-FILE                    15090044
151000             CR-INVOICE-RECS-WORKED TIMES                         15100044
151100         PERFORM R100-READ-INVOICE-STATUS-FILE                    15110044
151200     ELSE                                                         15120044
151300         MOVE CR-INVOICE-RECS-WORKED TO PV-INV-INPUT-COUNT        15130044
151400         SET END-OF-INVOICES TO TRUE                              15140044
151500         PERFORM R200-READ-REC-FILE                               15150044
151600             CR-RECEIVE-RECS-WORKED TIMES                         15160044
151700         PERFORM R200-READ-REC-FILE                               15170044
151800     END-IF.                                                      15180044
151900/                                                                 15190044
152000*----------------------------------------------------------------*15200044
152100*    ABEND ROUTINE.                                              *15210044
152200*----------------------------------------------------------------*15220044
152300 Z900-PROCESS-ABEND.                                              15230044
152400                                                                  15240044
152500     DISPLAY '*** ABEND'.                                         15250044
152600     DISPLAY '*** PROGRAM   = APKUP252'.                          15260044
152700     DISPLAY '*** PARAGRAPH = ' PV-CURRENT-PARAGRAPH.             15270044
152800     DISPLAY AA-MESSAGE-LINE-1.                                   15280044
152900     DISPLAY AA-MESSAGE-LINE-2.                                   15290044
153000     COPY DPPD004.                                                15300044
153100     CALL 'ILBOABN0' USING ABEND-CODE.                            15310044
153200/                                                                 15320044
153300*----------------------------------------------------------------*15330044
153400*    DB2 ABEND ROUTINE.                                          *15340044
153500*----------------------------------------------------------------*15350044
153600 Z999-DB2-ABEND.                                                  15360044
153700                                                                  15370044
153800     DISPLAY AA-ABEND-LIT.                                        15380044
153900     DISPLAY AA-DB2-ERROR-LIT.                                    15390044
154000     DISPLAY AA-PROGRAM-LIT.                                      15400044
154100     DISPLAY AA-PARAGRAPH-LIT.                                    15410044
154200     DISPLAY AA-DB2-OPERATION-LIT.                                15420044
154300     DISPLAY AA-DB2-TABLE.                                        15430044
154400     SET AC-DB2-ERROR TO TRUE.                                    15440044
154500                                                                  15450044
154600     COPY DPPD004.                                                15460044
154700                                                                  15470044
154800     CALL 'ILBOABN0' USING ABEND-CODE.                            15480044
