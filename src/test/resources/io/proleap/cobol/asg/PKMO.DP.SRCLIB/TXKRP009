000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             TXKRP009.                                00050001
000600 AUTHOR.                 BARB ERTL - SAFENET CONSULTING.          00060001
000700 INSTALLATION.           KOHLS.                                   00070001
000800 DATE-WRITTEN            11-16-2000.                              00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100***************************************************************** 00110001
001200*                                                                 00120001
001300*  THIS PROGRAM SEQUENTIALLY PROCESSES THE TEPTAX DB2 TABLE       00130001
001400*  AND CREATES THE MONTHLY TAX EXEMPT ID SALES DETAIL AND         00140001
001500*  SUMMARY REPORTS.  A DATE CARD IS ACCEPTED TO BE USED IN THE    00150001
001600*  CURSOR FOR THE FIRST AND LAST DAYS OF THE MONTH TO BE INCLUDED 00160001
001700*  IN THE REPORTS.                                                00170001
001800***************************************************************** 00180001
001900 ENVIRONMENT DIVISION.                                            00190001
002000***************************************************************** 00200001
002100                                                                  00210001
002200 CONFIGURATION SECTION.                                           00220001
002300                                                                  00230001
002400 SOURCE-COMPUTER.        IBM-3090.                                00240001
002500                                                                  00250001
002600 OBJECT-COMPUTER.        IBM-3090.                                00260001
002700                                                                  00270001
002800 INPUT-OUTPUT SECTION.                                            00280001
002900                                                                  00290001
003000 FILE-CONTROL.                                                    00300001
003100                                                                  00310001
003200     SELECT POS-DATE-CARD-FILE                                    00320001
003300         ASSIGN TO INP01.                                         00330001
003400                                                                  00340001
003500     SELECT TAX-EXEMPT-STORE-SUMMARY                              00350001
003600         ASSIGN TO RPT01.                                         00360001
003700                                                                  00370001
003800     SELECT TAX-EXEMPT-STORE-DETAIL                               00380001
003900         ASSIGN TO RPT02.                                         00390001
004000                                                                  00400001
004100******************************************************************00410001
004200 DATA DIVISION.                                                   00420001
004300******************************************************************00430001
004400                                                                  00440001
004500 FILE SECTION.                                                    00450001
004600                                                                  00460001
004700 FD  POS-DATE-CARD-FILE                                           00470001
004800     RECORDING MODE IS F                                          00480001
004900     BLOCK CONTAINS 0 RECORDS                                     00490001
005000     LABEL RECORDS ARE STANDARD.                                  00500001
005100                                                                  00510001
005200 01  POS-DATE-CARD-RECORD            PIC X(80).                   00520001
005300                                                                  00530001
005400 FD  TAX-EXEMPT-STORE-SUMMARY                                     00540001
005500     RECORDING MODE IS F                                          00550001
005600     BLOCK CONTAINS 0  RECORDS.                                   00560001
005700                                                                  00570001
005800 01  TAX-EXEMPT-SUMMARY-RCD          PIC  X(132).                 00580012
005900                                                                  00590001
006000 FD  TAX-EXEMPT-STORE-DETAIL                                      00600001
006100     RECORDING MODE IS F                                          00610001
006200     BLOCK CONTAINS 0  RECORDS.                                   00620001
006300                                                                  00630001
006400 01  TAX-EXEMPT-DETAIL-RCD           PIC  X(132).                 00640012
006500******************************************************************00650001
006600 WORKING-STORAGE SECTION.                                         00660001
006700******************************************************************00670001
006800 01  FILLER                            PIC X(50)  VALUE           00680001
006900     ' *** WORKING STORAGE STARTS HERE FOR TXKRP009 *** '.        00690001
007000                                                                  00700001
007100******************************************************************00710001
007200* RECORD LAYOUT FOR INPUT DATE CARD                               00720001
007300******************************************************************00730001
007400 01  CC-DATE-CARD.                                                00740001
007500     05  CC-EOM-DATE                    PIC X(10).                00750009
007600     05  FILLER                         PIC X(70) VALUE SPACES.   00760009
007700 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00770001
007800                                                  COMP SYNC.      00780001
007900     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00790001
008000     88  AC-DB2-ERROR                             VALUE +4013.    00800001
008100     88  AC-CAL-SUB-ERROR                         VALUE +4019.    00810009
008200                                                                  00820001
008300 01  PS-PROGRAM-SWITCHES.                                         00830001
008400     05  PS-END-OF-TEPTAX-SW           PIC X(01)  VALUE 'N'.      00840001
008500         88  PS-END-OF-TEPTAX                     VALUE 'Y'.      00850001
008600     05  PS-END-OF-DATE-FILE-SW        PIC X(01)  VALUE 'N'.      00860001
008700         88  PS-END-OF-DATE-FILE                  VALUE 'Y'.      00870001
008800                                                                  00880001
008900 01  PC-CONSTANTS.                                                00890001
009000     05  PC-LINE-LIMIT               PIC S9(04)  VALUE +60.       00900001
009100     05  PC-ROW-NOT-FOUND            PIC S9(04)  VALUE +100       00910001
009200                                                 COMP SYNC.       00920001
009300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)  VALUE            00930001
009400                                                 'TXKRP009'.      00940001
009500     05  PC-REPORT-NBR-1             PIC  9(01)  VALUE 1.         00950001
009600     05  PC-REPORT-NBR-2             PIC  9(01)  VALUE 2.         00960001
009700 01  PV-MISC-COUNT-FIELDS            COMP-3.                      00970001
009800     05  PV-PAGE-CNT1                PIC S9(05)    VALUE ZERO.    00980001
009900     05  PV-LINE-CNT1                PIC S9(03)    VALUE +65.     00990001
010000     05  PV-PAGE-CNT2                PIC S9(05)    VALUE ZERO.    01000001
010100     05  PV-LINE-CNT2                PIC S9(03)    VALUE +65.     01010001
010200                                                                  01020001
010300 01  PV-SAVE-AREA.                                                01030001
010400     05  PV-SAVE-STORE               PIC S9(04)    VALUE ZERO     01040001
010500                                                   COMP.          01050001
010600     05  PV-SAVE-STATE               PIC  X(02)    VALUE SPACES.  01060001
010700                                                                  01070001
010800 01  PV-MISC-FIELDS.                                              01080001
010900     05  PV-PRINT-RECORD             PIC X(133)    VALUE SPACE.   01090004
011000     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     01100001
011100                                                   COMP SYNC.     01110001
011200     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01120001
011300     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01130001
011400     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01140001
011500     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01150001
011600     05  PV-PARM-FROM-DATE           PIC  X(10).                  01160001
011700     05  PV-PARM-TO-DATE             PIC  X(10).                  01170001
011800     05  PV-ACCUM                    PIC S9(7)V99  VALUE ZERO.    01180001
011900     05  PV-ACCUM-STATE              PIC S9(9)V99  VALUE ZERO.    01190001
012000     05  PV-ACCUM-TOTAL              PIC S9(11)V99 VALUE ZERO.    01200001
012010     05  PV-TX-EXMPT-AGCY-NM-TEMP.                                01201033
012011         10  PV-TX-EXMPT-AGCY-NM-LEN PIC  9(4) COMP.              01201132
012012         10  PV-TX-EXMPT-AGCY-NM     PIC  X(25)    VALUE SPACE.   01201231
012013         10  FILLER                  PIC  X(33)    VALUE SPACE.   01201331
012100 01  PV-DATE-AND-TIME-FIELDS.                                     01210001
012200     05  PV-POS-CCYY-MM-DD           PIC X(10)     VALUE SPACE.   01220001
012300     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      01230001
012400         10  PV-POS-CCYY             PIC X(04).                   01240001
012500         10  FILLER                  PIC X(01).                   01250001
012600         10  PV-POS-MM               PIC X(02).                   01260001
012700         10  FILLER                  PIC X(01).                   01270001
012800         10  PV-POS-DD               PIC X(02).                   01280001
012900     05  PV-CURR-DATE-CCYYMMDD.                                   01290001
013000         10  PV-CURR-DATE-CCYY       PIC  9(04).                  01300001
013100         10  PV-CURR-DATE-MM         PIC  9(02).                  01310001
013200         10  PV-CURR-DATE-DD         PIC  9(02).                  01320001
013300     05  PV-CURR-TIME.                                            01330001
013400         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    01340001
013500         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    01350001
013600         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    01360001
013700     05  PV-HEADER-DATE.                                          01370001
013800         10  PV-HEADER-MM            PIC XX.                      01380001
013900         10  PV-HEADER-SLASH-1       PIC X.                       01390001
014000         10  PV-HEADER-DD            PIC XX.                      01400001
014100         10  PV-HEADER-SLASH-2       PIC X.                       01410001
014200         10  PV-HEADER-CCYY          PIC X(04).                   01420001
014300                                                                  01430001
014400******************************************************************01440001
014500*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT.  01450001
014600******************************************************************01460001
014700     COPY DPWS132.                                                01470005
014800                                                                  01480001
014900************************************************************      01490009
015000* DATE ROUTINE COPY MEMBERS                                       01500009
015100************************************************************      01510009
015200     COPY DPWS500.                                                01520009
015300                                                                  01530009
015400******************************************************************01540001
015500*  HEADING LINES FOR THE TAX EXEMPT SUMMARY REPORT                01550001
015600******************************************************************01560001
015700                                                                  01570001
015800 01  HL2-HEADING-LINE-2.                                          01580001
015900     05  FILLER                  PIC X(47)   VALUE SPACE.         01590004
016000     05  FILLER                  PIC X(40)   VALUE                01600001
016100         'TAX EXEMPT ID SALES - ALL STORE SUMMARY '.              01610001
016200     05  FILLER                  PIC X(45)   VALUE SPACES.        01620004
016300                                                                  01630001
016400 01  HL2-HEADING-LINE-3.                                          01640001
016500     05  FILLER                  PIC X(52)   VALUE SPACE.         01650004
016600     05  FILLER                  PIC X(05)   VALUE 'FROM '.       01660001
016700     05  HL2-FROM-DATE           PIC X(10)   VALUE SPACES.        01670001
016800     05  FILLER                  PIC X(04)   VALUE ' TO '.        01680001
016900     05  HL2-TO-DATE             PIC X(10)   VALUE SPACES.        01690001
017000     05  FILLER                  PIC X(51)   VALUE SPACES.        01700004
017100                                                                  01710001
017200 01  HL2-HEADING-LINE-4.                                          01720001
017300     05  FILLER                  PIC X(02)   VALUE SPACE.         01730001
017400     05  FILLER                  PIC X(5)    VALUE 'STATE'.       01740001
017500     05  FILLER                  PIC X(3)    VALUE ' - '.         01750001
017600     05  HL2-STATE               PIC X(02)   VALUE SPACES.        01760001
017700     05  FILLER                  PIC X(120)  VALUE SPACES.        01770004
017800                                                                  01780001
017900 01  HL2-HEADING-LINE-5.                                          01790001
018000     05  FILLER                  PIC X(10)   VALUE SPACE.         01800001
018100     05  FILLER                  PIC X(5)    VALUE 'STORE'.       01810001
018200     05  FILLER                  PIC X(5)    VALUE SPACE.         01820001
018300     05  FILLER                  PIC X(13)   VALUE                01830001
018400                                           'TOTAL DOLLARS'.       01840001
018500     05  FILLER                  PIC X(99)   VALUE SPACES.        01850004
018600                                                                  01860001
018700******************************************************************01870001
018800*  HEADING LINES FOR THE TAX EXEMPT DETAIL REPORT                 01880001
018900******************************************************************01890001
019000                                                                  01900001
019100 01  HL3-HEADING-LINE-2.                                          01910001
019200     05  FILLER                  PIC X(47)   VALUE SPACE.         01920004
019300     05  FILLER                  PIC X(40)   VALUE                01930001
019400         'TAX EXEMPT ID SALES - ALL STORE DETAIL  '.              01940001
019500     05  FILLER                  PIC X(45)   VALUE SPACES.        01950004
019600                                                                  01960001
019700 01  HL3-HEADING-LINE-3.                                          01970001
019800     05  FILLER                  PIC X(52)   VALUE SPACE.         01980004
019900     05  FILLER                  PIC X(05)   VALUE 'FROM '.       01990001
020000     05  HL3-FROM-DATE           PIC X(10)   VALUE SPACES.        02000001
020100     05  FILLER                  PIC X(04)   VALUE ' TO '.        02010001
020200     05  HL3-TO-DATE             PIC X(10)   VALUE SPACES.        02020001
020300     05  FILLER                  PIC X(51)   VALUE SPACES.        02030004
020400                                                                  02040001
020500 01  HL3-HEADING-LINE-4.                                          02050001
020600     05  FILLER                  PIC X(02)   VALUE SPACE.         02060001
020700     05  FILLER                  PIC X(5)    VALUE 'STATE'.       02070001
020800     05  FILLER                  PIC X(3)    VALUE ' - '.         02080001
020900     05  HL3-STATE               PIC X(02)   VALUE SPACES.        02090001
021000     05  FILLER                  PIC X(120)  VALUE SPACES.        02100004
021100                                                                  02110001
021200 01  HL3-HEADING-LINE-5.                                          02120001
021300     05  FILLER                  PIC X(3)    VALUE SPACE.         02130001
021400     05  FILLER                  PIC X(5)    VALUE 'STORE'.       02140001
021500     05  FILLER                  PIC X(5)    VALUE SPACE.         02150001
021600     05  FILLER                  PIC X(13)   VALUE                02160001
021700                                           'TOTAL DOLLARS'.       02170001
021800     05  FILLER                  PIC X(04)   VALUE SPACES.        02180001
021900     05  FILLER                  PIC X(9)    VALUE 'EXEMPT ID'.   02190001
022000     05  FILLER                  PIC X(18)   VALUE SPACES.        02200001
022700     05  FILLER                  PIC X(11)   VALUE 'AGENCY NAME'. 02201020
022800     05  FILLER                  PIC X(16)   VALUE SPACES.        02202020
022100     05  FILLER                  PIC X(10)   VALUE 'CUST PHONE'.  02210004
022200     05  FILLER                  PIC X(02)   VALUE SPACES.        02220004
022300     05  FILLER                  PIC X(10)   VALUE 'TRANS DATE'.  02230004
022400     05  FILLER                  PIC X(02)   VALUE SPACES.        02240001
022500     05  FILLER                  PIC X(06)   VALUE 'RGST #'.      02250011
022600     05  FILLER                  PIC X(02)   VALUE SPACES.        02260011
022700     05  FILLER                  PIC X(06)   VALUE 'TRAN #'.      02270011
022600     05  FILLER                  PIC X(10)   VALUE SPACES.        02270120
022900                                                                  02290001
023000******************************************************************02300001
023100*  DETAIL LINE FOR THE TAX EXEMPT SUMMARY REPORT.                 02310001
023200******************************************************************02320001
023300                                                                  02330001
023400 01  D1-DETAIL-LINE-1.                                            02340001
023500     05  FILLER                  PIC X(10)   VALUE SPACES.        02350001
023600     05  DTL1-STORE              PIC 9(4).                        02360001
023700     05  FILLER                  PIC X(6)    VALUE SPACES.        02370001
023800     05  DTL1-DOLLARS            PIC Z,ZZZ,ZZZ.99-.               02380001
023900     05  FILLER                  PIC X(42)   VALUE SPACES.        02390001
024000                                                                  02400001
024100******************************************************************02410001
024200*  DETAIL LINE FOR THE TAX EXEMPT DETAIL REPORT.                  02420001
024300******************************************************************02430001
024400                                                                  02440001
024500 01  D2-DETAIL-LINE-2.                                            02450001
024600     05  FILLER                  PIC X(3)    VALUE SPACES.        02460001
024700     05  DTL2-STORE              PIC 9(4).                        02470001
024800     05  FILLER                  PIC X(6)    VALUE SPACES.        02480001
024900     05  DTL2-DOLLARS            PIC Z,ZZZ,ZZZ.99-.               02490001
025000     05  FILLER                  PIC X(04)   VALUE SPACES.        02500001
025100     05  DTL2-TAX-EXEMPT-ID      PIC X(25).                       02510001
025200     05  FILLER                  PIC X(2)    VALUE SPACES.        02520001
034700     05  DTL2-TX-EXMPT-AGCY-NM   PIC X(25).                       02521020
026000     05  FILLER                  PIC X(02)   VALUE SPACES.        02522020
025300     05  DTL2-CUST-PHN-NBR       PIC X(10)   VALUE SPACES.        02530013
025400     05  FILLER                  PIC X(2)    VALUE SPACES.        02540004
025500     05  DTL2-TRANS-DATE         PIC X(10).                       02550004
025600     05  FILLER                  PIC X(3)    VALUE SPACES.        02560001
025700     05  DTL2-RGST-ID            PIC Z(04).                       02570011
025800     05  FILLER                  PIC X(4)    VALUE SPACES.        02580011
025900     05  DTL2-TRANS-NBR          PIC 9(04).                       02590011
025800     05  FILLER                  PIC X(11)   VALUE SPACES.        02590120
026100******************************************************************02610001
026200*  DOTTED LINE FOR TOTALS                                         02620001
026300******************************************************************02630001
026400                                                                  02640001
026500 01  D2-DETAIL-LINE-3.                                            02650001
026600     05  FILLER                  PIC X(13)   VALUE SPACES.        02660001
026700     05  FILLER                  PIC X(13)   VALUE                02670001
026800                                             '-------------'.     02680001
026900     05  FILLER                  PIC X(106)  VALUE SPACES.        02690004
027000******************************************************************02700001
027100*  TOTAL LINE FOR DETAIL REPORT                                   02710001
027200******************************************************************02720001
027300                                                                  02730001
027400 01  D2-DETAIL-LINE-4.                                            02740001
027500     05  FILLER                  PIC X(13)   VALUE                02750001
027600                                    'STORE TOTAL: '.              02760001
027700     05  DTL4-DOLLARS            PIC Z,ZZZ,ZZZ.99-.               02770001
027800     05  FILLER                  PIC X(106)  VALUE SPACES.        02780004
027900******************************************************************02790001
028000*  STATE TOTAL LINE FOR SUMMARY AND DETAIL REPORT                 02800001
028100******************************************************************02810001
028200                                                                  02820001
028300 01  D2-DETAIL-LINE-5.                                            02830001
028400     05  FILLER                  PIC X(13)   VALUE                02840001
028500                                    'STATE TOTAL: '.              02850001
028600     05  DTL5-DOLLARS            PIC Z,ZZZ,ZZZ.99-.               02860001
028700     05  FILLER                  PIC X(106)  VALUE SPACES.        02870004
028800******************************************************************02880001
028900*  GRAND TOTAL LINE FOR SUMMARY AND DETAIL REPORT                 02890001
029000******************************************************************02900001
029100                                                                  02910001
029200 01  D2-DETAIL-LINE-6.                                            02920001
029300     05  FILLER                  PIC X(13)   VALUE                02930001
029400                                    'GRAND TOTAL: '.              02940001
029500     05  DTL6-DOLLARS            PIC ZZZ,ZZZ,ZZZ.99-.             02950001
029600     05  FILLER                  PIC X(104)  VALUE SPACES.        02960004
029700******************************************************************02970001
029800*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            02980001
029900******************************************************************02990001
030000     COPY DPWS004.                                                03000001
030100******************************************************************03010001
030200*  DB2 COMMUNICATION AREA.                                        03020001
030300******************************************************************03030001
030400     EXEC SQL                                                     03040001
030500          INCLUDE SQLCA                                           03050001
030600     END-EXEC.                                                    03060001
030700******************************************************************03070001
030800*  DB2 TABLE DB2PDBA.TEPTAX  - TAX EXEMPT TABLE                   03080001
030900******************************************************************03090001
031000     EXEC SQL                                                     03100001
031100          INCLUDE TEPTAX                                          03110001
031200     END-EXEC.                                                    03120001
031300******************************************************************03130001
031400*  DB2 TABLE DB2PDBA.TEPTRN  - TRANSACTION TABLE                  03140001
031500******************************************************************03150001
031600     EXEC SQL                                                     03160001
031700          INCLUDE TEPTRN                                          03170001
031800     END-EXEC.                                                    03180001
031900******************************************************************03190001
032000*  DB2 TABLE DB2PDBA.TEPPART - PARTITION CONTROL TABLE            03200001
032100******************************************************************03210001
032200     EXEC SQL                                                     03220001
032300          INCLUDE TEPPART                                         03230001
032400     END-EXEC.                                                    03240001
032500******************************************************************03250001
032600*   XST_LOC - XS SELLING & CUST SERVICE DOMAIN LOCATION TABLE    *03260001
032700******************************************************************03270001
032800     EXEC SQL                                                     03280001
032900         INCLUDE XST00001                                         03290001
033000     END-EXEC.                                                    03300001
033100******************************************************************03310001
033200*  CURSOR FOR FETCHING TEPTAX                                     03320001
033300******************************************************************03330001
033400     EXEC SQL                                                     03340001
033500         DECLARE TEPTAX-CURSOR CURSOR                             03350001
033600         FOR SELECT A.PARTN_NBR                                   03360001
033700                   ,A.STR_NBR                                     03370001
033800                   ,A.RGST_ID                                     03380001
033900                   ,A.TRN_NBR                                     03390001
034000                   ,A.STRT_TM                                     03400001
034100                   ,A.SLS_CORR_SEQ_NBR                            03410001
034200                   ,A.TX_EXMPT_ID                                 03420001
034300                   ,A.CUST_PHN_NBR                                03430014
034400                   ,B.TRN_TYP_CDE                                 03440001
034500                   ,B.TRN_DTE                                     03450001
034600                   ,B.ACCM_TOT_AMT                                03460001
034700                   ,D.ST_CDE                                      03470001
034700                   ,A.TX_EXMPT_AGCY_NM                            03471015
034800         FROM TEPTAX A                                            03480001
034900             ,TEPTRN B                                            03490001
035000             ,TEPPART C                                           03500001
035100             ,XST_LOC D                                           03510001
035200         WHERE C.SLS_DTE BETWEEN :PV-PARM-FROM-DATE               03520001
035300                             AND :PV-PARM-TO-DATE                 03530001
035400           AND C.PARTN_NBR = A.PARTN_NBR                          03540001
035500           AND C.PARTN_NBR = B.PARTN_NBR                          03550001
035600           AND A.STR_NBR = B.STR_NBR                              03560001
035700           AND A.RGST_ID = B.RGST_ID                              03570001
035800           AND A.TRN_NBR = B.TRN_NBR                              03580001
035900           AND A.STRT_TM = B.STRT_TM                              03590001
036000           AND A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR            03600001
036100           AND B.VOID_ABRT_CDE = 'N'                              03610001
036200           AND A.STR_NBR = D.LOC_NBR                              03620001
036300         ORDER BY D.ST_CDE                                        03630001
036400                 ,B.STR_NBR                                       03640001
036500                 ,B.TRN_DTE                                       03650001
036600         WITH UR                                                  03660001
036700     END-EXEC.                                                    03670001
036800***************************************************************** 03680001
036900* PROCEDURE DIVISION.                                           * 03690001
037000***************************************************************** 03700001
037100 PROCEDURE DIVISION.                                              03710001
037200******************************************************************03720001
037300* 0000-MAINLINE-PARAGRAPH                                         03730001
037400*      PRODUCE TAX EXEMPT ID SUMMARY AND DETAIL REPORTS           03740001
037500******************************************************************03750001
037600 0000-MAINLINE-PARAGRAPH.                                         03760001
037700                                                                  03770001
037800     PERFORM 1000-INITIALIZE-PROGRAM.                             03780001
037900                                                                  03790001
038000     PERFORM 8000-OPEN-TEPTAX-CURSOR.                             03800001
038100                                                                  03810001
038200     PERFORM 8100-FETCH-TEPTAX-CURSOR.                            03820001
038300                                                                  03830001
038400     MOVE XST00001-ST-CDE TO PV-SAVE-STATE.                       03840001
038500     MOVE EPTAX-STR-NBR   TO PV-SAVE-STORE.                       03850001
038600                                                                  03860001
038700     PERFORM 2000-PROCESS-TEPTAX                                  03870001
038800       UNTIL PS-END-OF-TEPTAX.                                    03880001
038900                                                                  03890001
039000     PERFORM 8200-CLOSE-TEPTAX-CURSOR.                            03900001
039100                                                                  03910001
039200     PERFORM 2200-STORE-TOTALS.                                   03920001
039300                                                                  03930001
039400     CLOSE TAX-EXEMPT-STORE-SUMMARY                               03940001
039500           TAX-EXEMPT-STORE-DETAIL.                               03950001
039600                                                                  03960001
039700     GOBACK.                                                      03970001
039800                                                                  03980001
039900******************************************************************03990001
040000* 1000-INITIALIZE-PROGRAM                                         04000001
040100*     OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS    04010001
040200******************************************************************04020001
040300                                                                  04030001
040400 1000-INITIALIZE-PROGRAM.                                         04040001
040500                                                                  04050001
040600     OPEN INPUT  POS-DATE-CARD-FILE                               04060001
040700          OUTPUT TAX-EXEMPT-STORE-SUMMARY                         04070001
040800                 TAX-EXEMPT-STORE-DETAIL.                         04080001
040900                                                                  04090001
041000     PERFORM 1300-PROCESS-DATE-CARD.                              04100001
041100                                                                  04110001
041200     PERFORM 1500-FORMAT-HEADINGS.                                04120001
041300******************************************************************04130001
041400* 1300-PROCESS-DATE-CARD                                          04140001
041500******************************************************************04150001
041600                                                                  04160001
041700 1300-PROCESS-DATE-CARD.                                          04170001
041800                                                                  04180001
041900     READ POS-DATE-CARD-FILE INTO CC-DATE-CARD                    04190001
042000         AT END                                                   04200001
042100             SET PS-END-OF-DATE-FILE TO TRUE.                     04210001
042200                                                                  04220001
042300     IF PS-END-OF-DATE-FILE                                       04230001
042400         MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME      04240001
042500         MOVE 'DATE CARD MISSING      ' TO PV-OPERATION-MSG-1     04250001
042600         SET AC-CONTROL-CARD-ERROR TO TRUE                        04260001
042700         PERFORM 9999-ABEND                                       04270001
042800     END-IF.                                                      04280001
042900                                                                  04290001
043000     INITIALIZE DPG51 DPG52 DPG53                                 04300009
043100                DPG54 DPG55 DPG56.                                04310009
043200                                                                  04320009
043300     SET DPG51-FISCAL-454-CALENDAR   TO TRUE.                     04330009
043400     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     04340009
043500                                                                  04350009
043600     MOVE CC-EOM-DATE             TO DPG52-LK-DATE-INPUT.         04360009
043700                                                                  04370009
043800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04380009
043900                                             DPG54 DPG55 DPG56.   04390009
044000                                                                  04400009
044100     IF  DPG54-SEVERE-ERROR                                       04410009
044200         DISPLAY '*********************************'              04420009
044300         DISPLAY '** ABEND FROM CALL SUB         **'              04430009
044400         DISPLAY '** PROGRAM = TXKRP009          **'              04440009
044500         DISPLAY '** DATE = ' CC-EOM-DATE '      **'              04450009
044600         DISPLAY '*********************************'              04460009
044700         DISPLAY DPG54-ERROR-MESSAGE                              04470009
044800         MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME      04480009
044900         MOVE 'CALENDAR ROUTINE ERROR ' TO PV-OPERATION-MSG-1     04490009
045000         SET AC-CAL-SUB-ERROR  TO TRUE                            04500009
045100         PERFORM 9999-ABEND                                       04510009
045200     ELSE                                                         04520009
045300         IF DPG54-DATE-INVALID                                    04530009
045400             DISPLAY '*********************************'          04540009
045500             DISPLAY '** ABEND INVALID END DATE      **'          04550009
045600             DISPLAY '** PROGRAM = TXKRP009          **'          04560009
045700             DISPLAY '** DATE = ' CC-EOM-DATE '      **'          04570009
045800             DISPLAY '*********************************'          04580009
045900             DISPLAY DPG54-ERROR-MESSAGE                          04590009
046000             MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME  04600009
046100             MOVE 'INVALID DATE           ' TO PV-OPERATION-MSG-1 04610009
046200             SET AC-CONTROL-CARD-ERROR TO TRUE                    04620009
046300             PERFORM 9999-ABEND                                   04630009
046400         END-IF                                                   04640009
046500     END-IF.                                                      04650009
046600                                                                  04660009
046700     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-PARM-FROM-DATE.        04670009
046800     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO PV-PARM-TO-DATE.          04680009
046900                                                                  04690009
047000     DISPLAY 'FROM ' PV-PARM-FROM-DATE ' TO ' PV-PARM-TO-DATE.    04700009
047100                                                                  04710001
047200******************************************************************04720001
047300* 1500-FORMAT-HEADINGS                                            04730001
047400*     GET CURRENT DATE AND TIME FROM SYSTEM.                      04740001
047500*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          04750001
047600*     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              04760001
047700******************************************************************04770001
047800 1500-FORMAT-HEADINGS.                                            04780001
047900                                                                  04790001
048000     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   04800001
048100     ACCEPT PV-CURR-TIME FROM TIME.                               04810001
048200                                                                  04820001
048300     MOVE PV-CURR-DATE-MM             TO DP132-RUN-MONTH.         04830005
048400     MOVE PV-CURR-DATE-DD             TO DP132-RUN-DAY.           04840005
048500     MOVE PV-CURR-DATE-CCYY           TO DP132-RUN-YEAR.          04850005
048600                                                                  04860001
048700     MOVE PV-CURR-TIME-HH             TO DP132-RUN-HOUR.          04870005
048800     MOVE PV-CURR-TIME-MM             TO DP132-RUN-MINUTE.        04880005
048900     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132-PROGRAM-NAME.      04890005
049000                                                                  04900001
049100     MOVE PV-PARM-FROM-DATE           TO PV-POS-CCYY-MM-DD.       04910001
049200     MOVE PV-POS-MM                   TO PV-HEADER-MM.            04920001
049300     MOVE '/'                         TO PV-HEADER-SLASH-1.       04930001
049400     MOVE PV-POS-DD                   TO PV-HEADER-DD.            04940001
049500     MOVE '/'                         TO PV-HEADER-SLASH-2.       04950001
049600     MOVE PV-POS-CCYY                 TO PV-HEADER-CCYY.          04960001
049700     MOVE PV-HEADER-DATE              TO HL2-FROM-DATE            04970001
049800                                         HL3-FROM-DATE.           04980001
049900                                                                  04990001
050000     MOVE PV-PARM-TO-DATE             TO PV-POS-CCYY-MM-DD.       05000001
050100     MOVE PV-POS-MM                   TO PV-HEADER-MM.            05010001
050200     MOVE '/'                         TO PV-HEADER-SLASH-1.       05020001
050300     MOVE PV-POS-DD                   TO PV-HEADER-DD.            05030001
050400     MOVE '/'                         TO PV-HEADER-SLASH-2.       05040001
050500     MOVE PV-POS-CCYY                 TO PV-HEADER-CCYY.          05050001
050600     MOVE PV-HEADER-DATE              TO HL2-TO-DATE              05060001
050700                                         HL3-TO-DATE.             05070001
050800                                                                  05080001
050900******************************************************************05090001
051000* 2000-PROCESS-TEPTAX.                                            05100001
051100*     PROCESS A TRANSACTION RECORD.  PRINT EACH DETAIL LINE,      05110001
051200*     ACCUMULATE FOR SUMMARY REPORT.  AT STORE BREAK, PRINT       05120001
051300*     STORE TOTAL ON DETAIL REPORT AND PRINT SUMMARY LINE ON      05130001
051400*     SUMMARY REPORT.                                             05140001
051500******************************************************************05150001
051600 2000-PROCESS-TEPTAX.                                             05160001
051700                                                                  05170001
051800     IF XST00001-ST-CDE = PV-SAVE-STATE                           05180001
051900         IF EPTAX-STR-NBR = PV-SAVE-STORE                         05190001
052000             PERFORM 2100-ACCUM-DOLLARS                           05200001
052100         ELSE                                                     05210001
052200             PERFORM 2200-STORE-TOTALS                            05220001
052300             MOVE EPTAX-STR-NBR         TO PV-SAVE-STORE          05230001
052400             MOVE ZERO                  TO PV-ACCUM               05240001
052500             PERFORM 2100-ACCUM-DOLLARS                           05250001
052600         END-IF                                                   05260001
052700     ELSE                                                         05270001
052800         PERFORM 2200-STORE-TOTALS                                05280001
052900         MOVE EPTAX-STR-NBR         TO PV-SAVE-STORE              05290001
053000         MOVE ZERO                  TO PV-ACCUM                   05300001
053100                                       PV-ACCUM-STATE             05310001
053200         PERFORM 2100-ACCUM-DOLLARS                               05320001
053300         PERFORM 2150-STATE-BREAK                                 05330001
053400     END-IF.                                                      05340001
053500                                                                  05350001
053600     PERFORM 8100-FETCH-TEPTAX-CURSOR.                            05360001
053700                                                                  05370001
053800******************************************************************05380001
053900* 2100-ACCUM-DOLLARS.                                             05390001
054000*     ACCUMULATE THE TOTALS FOR SUMMARY.  PRINT THE DETAIL LINE.  05400001
054100******************************************************************05410001
054200 2100-ACCUM-DOLLARS.                                              05420001
054300                                                                  05430001
054400     ADD EPTRN-ACCM-TOT-AMT TO PV-ACCUM                           05440001
054500                               PV-ACCUM-STATE                     05450001
054600                               PV-ACCUM-TOTAL.                    05460001
054700     PERFORM 6000-DTL-PROC.                                       05470001
054800                                                                  05480001
054900******************************************************************05490001
055000* 2150-STATE-BREAK.                                              *05500001
055100*     PRINT STATE HEADER LINE.                                   *05510001
055200******************************************************************05520001
055300 2150-STATE-BREAK.                                                05530001
055400                                                                  05540001
055500     MOVE XST00001-ST-CDE TO PV-SAVE-STATE                        05550001
055600                             HL2-STATE                            05560001
055700                             HL3-STATE.                           05570001
055800     ADD +4 TO PV-LINE-CNT1.                                      05580001
055900     MOVE PC-REPORT-NBR-1        TO DP132-REPORT-NUMBER.          05590005
056000                                                                  05600001
056100     IF PV-LINE-CNT1 GREATER THAN PC-LINE-LIMIT                   05610001
056200         PERFORM 9000-HEADER-ROUTINE-1                            05620001
056300     ELSE                                                         05630001
056400         SUBTRACT +4 FROM PV-LINE-CNT1                            05640001
056500         MOVE +1                     TO PV-LINE-SPACING           05650001
056600         MOVE SPACES                 TO PV-PRINT-RECORD           05660001
056700         PERFORM 9900-WRITE-REPORT-LINE                           05670001
056800         MOVE HL2-HEADING-LINE-4     TO PV-PRINT-RECORD           05680001
056900         PERFORM 9900-WRITE-REPORT-LINE                           05690001
057000         MOVE SPACES                 TO PV-PRINT-RECORD           05700001
057100         PERFORM 9900-WRITE-REPORT-LINE                           05710001
057200     END-IF.                                                      05720001
057300                                                                  05730001
057400******************************************************************05740001
057500* 2200-STORE-TOTALS.                                              05750001
057600*     PRINT TOTALS ON DETAIL REPORT AND SUMMARY REPORT.           05760001
057700******************************************************************05770001
057800 2200-STORE-TOTALS.                                               05780001
057900                                                                  05790001
058000     IF PV-LINE-CNT1 GREATER THAN PC-LINE-LIMIT                   05800001
058100         PERFORM 9000-HEADER-ROUTINE-1                            05810001
058200     END-IF.                                                      05820001
058300                                                                  05830001
058400     MOVE PV-SAVE-STORE   TO DTL1-STORE.                          05840001
058500     MOVE PV-ACCUM        TO DTL1-DOLLARS.                        05850001
058600     MOVE PC-REPORT-NBR-1 TO DP132-REPORT-NUMBER.                 05860005
058700     MOVE +1              TO PV-LINE-SPACING.                     05870001
058800                                                                  05880001
058900     MOVE D1-DETAIL-LINE-1         TO PV-PRINT-RECORD.            05890001
059000     PERFORM 9900-WRITE-REPORT-LINE.                              05900001
059100                                                                  05910001
059200     IF XST00001-ST-CDE NOT EQUAL PV-SAVE-STATE                   05920001
059300         MOVE PV-ACCUM-STATE  TO DTL5-DOLLARS                     05930001
059400         MOVE D2-DETAIL-LINE-5 TO PV-PRINT-RECORD                 05940001
059500         PERFORM 9900-WRITE-REPORT-LINE                           05950001
059600         IF PS-END-OF-TEPTAX                                      05960001
059700             MOVE PV-ACCUM-TOTAL TO DTL6-DOLLARS                  05970001
059800             MOVE D2-DETAIL-LINE-6 TO PV-PRINT-RECORD             05980001
059900             PERFORM 9900-WRITE-REPORT-LINE                       05990001
060000         END-IF                                                   06000001
060100     END-IF.                                                      06010001
060200                                                                  06020001
060300     MOVE PV-SAVE-STATE          TO HL3-STATE.                    06030001
060400                                                                  06040001
060500     IF PV-LINE-CNT2 GREATER THAN PC-LINE-LIMIT                   06050001
060600         PERFORM 9100-HEADER-ROUTINE-2                            06060001
060700     END-IF.                                                      06070001
060800                                                                  06080001
060900     MOVE PC-REPORT-NBR-2  TO DP132-REPORT-NUMBER.                06090005
061000     MOVE D2-DETAIL-LINE-3 TO PV-PRINT-RECORD.                    06100001
061100     MOVE +1               TO PV-LINE-SPACING.                    06110001
061200     PERFORM 9900-WRITE-REPORT-LINE.                              06120001
061300                                                                  06130001
061400     MOVE PV-ACCUM         TO DTL4-DOLLARS.                       06140001
061500     MOVE D2-DETAIL-LINE-4 TO PV-PRINT-RECORD.                    06150001
061600     PERFORM 9900-WRITE-REPORT-LINE.                              06160001
061700                                                                  06170001
061800                                                                  06180001
061900     IF XST00001-ST-CDE NOT EQUAL PV-SAVE-STATE                   06190001
062000         MOVE D2-DETAIL-LINE-5 TO PV-PRINT-RECORD                 06200001
062100         PERFORM 9900-WRITE-REPORT-LINE                           06210001
062200         IF PS-END-OF-TEPTAX                                      06220001
062300             MOVE D2-DETAIL-LINE-6 TO PV-PRINT-RECORD             06230001
062400             PERFORM 9900-WRITE-REPORT-LINE                       06240001
062500         END-IF                                                   06250001
062600     END-IF.                                                      06260001
062700                                                                  06270001
062800     MOVE SPACES           TO PV-PRINT-RECORD.                    06280001
062900     PERFORM 9900-WRITE-REPORT-LINE.                              06290001
063000                                                                  06300001
063100******************************************************************06310001
063200* 6000-DTL-PROC                                                   06320001
063300*     PRINT THE DETAIL LINE                                       06330001
063400******************************************************************06340001
063500 6000-DTL-PROC.                                                   06350001
063600                                                                  06360001
063700     IF XST00001-ST-CDE NOT EQUAL PV-SAVE-STATE                   06370001
063800         MOVE XST00001-ST-CDE    TO HL3-STATE                     06380001
063900         ADD +4 TO PV-LINE-CNT2                                   06390001
064000         MOVE PC-REPORT-NBR-2    TO DP132-REPORT-NUMBER           06400005
064100                                                                  06410001
064200         IF PV-LINE-CNT2 GREATER THAN PC-LINE-LIMIT               06420001
064300             PERFORM 9100-HEADER-ROUTINE-2                        06430001
064400         ELSE                                                     06440001
064500             SUBTRACT +4 FROM PV-LINE-CNT2                        06450001
064600             MOVE +1                     TO PV-LINE-SPACING       06460001
064700             MOVE SPACES                 TO PV-PRINT-RECORD       06470001
064800             PERFORM 9900-WRITE-REPORT-LINE                       06480001
064900             MOVE HL3-HEADING-LINE-4     TO PV-PRINT-RECORD       06490001
065000             PERFORM 9900-WRITE-REPORT-LINE                       06500001
065100             MOVE SPACES                 TO PV-PRINT-RECORD       06510001
065200             PERFORM 9900-WRITE-REPORT-LINE                       06520001
065300         END-IF                                                   06530001
065400     ELSE                                                         06540001
065500         MOVE PV-SAVE-STATE          TO HL3-STATE                 06550001
065600         IF PV-LINE-CNT2 GREATER THAN PC-LINE-LIMIT               06560001
065700             PERFORM 9100-HEADER-ROUTINE-2                        06570001
065800         END-IF                                                   06580001
065900     END-IF.                                                      06590001
066000                                                                  06600001
066100     MOVE +1 TO PV-LINE-SPACING.                                  06610001
066200                                                                  06620001
066300     MOVE EPTAX-STR-NBR      TO DTL2-STORE.                       06630001
066400     MOVE EPTRN-ACCM-TOT-AMT TO DTL2-DOLLARS.                     06640001
066500     MOVE EPTAX-TX-EXMPT-ID  TO DTL2-TAX-EXEMPT-ID.               06650001
066600     MOVE EPTRN-TRN-DTE      TO DTL2-TRANS-DATE.                  06660001
066700     MOVE EPTAX-RGST-ID      TO DTL2-RGST-ID.                     06670011
066800     MOVE EPTAX-TRN-NBR      TO DTL2-TRANS-NBR.                   06680011
066900     MOVE EPTAX-CUST-PHN-NBR TO DTL2-CUST-PHN-NBR.                06690014
066910     MOVE EPTAX-TX-EXMPT-AGCY-NM                                  06691033
066920                             TO PV-TX-EXMPT-AGCY-NM-TEMP.         06692033
067000                                                                  06700033
067030     IF PV-TX-EXMPT-AGCY-NM-LEN = ZERO                            06703033
067031        MOVE 'AGENCY NAME NOT FOUND'                              06703122
067032                             TO DTL2-TX-EXMPT-AGCY-NM             06703233
067033     ELSE                                                         06703322
067034        MOVE PV-TX-EXMPT-AGCY-NM                                  06703433
067035                             TO DTL2-TX-EXMPT-AGCY-NM             06703533
067050     END-IF.                                                      06705022
067060                                                                  06706022
067100     MOVE PC-REPORT-NBR-2    TO DP132-REPORT-NUMBER.              06710033
067200     MOVE D2-DETAIL-LINE-2   TO PV-PRINT-RECORD.                  06720033
067210                                                                  06721033
067300     PERFORM 9900-WRITE-REPORT-LINE.                              06730001
067310                                                                  06731031
067400******************************************************************06740031
067500* 8000-OPEN-TEPTAX-CURSOR.                                        06750001
067600*     OPEN TEPTAX CURSOR                                          06760001
067700******************************************************************06770001
067800 8000-OPEN-TEPTAX-CURSOR.                                         06780001
067900                                                                  06790001
068000     EXEC SQL                                                     06800001
068100          OPEN TEPTAX-CURSOR                                      06810001
068200     END-EXEC.                                                    06820001
068300                                                                  06830001
068400     EVALUATE TRUE                                                06840001
068500         WHEN SQLCODE = ZERO                                      06850001
068600              CONTINUE                                            06860001
068700         WHEN SQLWARN0 NOT EQUAL SPACE                            06870001
068800         WHEN SQLCODE NOT EQUAL ZERO                              06880001
068900             MOVE '8000-OPEN-TEPTAX-CURSOR'                       06890001
069000                                            TO PV-PARAGRAPH-NAME  06900001
069100             MOVE 'ERROR ON OPEN OF TEPTAX-CURSOR'                06910001
069200                                            TO PV-DB2-OPERATION   06920001
069300             PERFORM 9100-SQL-ABEND                               06930001
069400     END-EVALUATE.                                                06940001
069500                                                                  06950001
069600******************************************************************06960001
069700* 8100-FETCH-TEPTAX-CURSOR                                        06970001
069800******************************************************************06980001
069900 8100-FETCH-TEPTAX-CURSOR.                                        06990001
070000                                                                  07000001
070010     MOVE SPACES TO EPTAX-TX-EXMPT-AGCY-NM.                       07001027
070020                                                                  07002026
070100     EXEC SQL                                                     07010001
070200          FETCH TEPTAX-CURSOR                                     07020001
070300           INTO :EPTAX-PARTN-NBR                                  07030001
070400               ,:EPTAX-STR-NBR                                    07040001
070500               ,:EPTAX-RGST-ID                                    07050001
070600               ,:EPTAX-TRN-NBR                                    07060001
070700               ,:EPTAX-STRT-TM                                    07070001
070800               ,:EPTAX-SLS-CORR-SEQ-NBR                           07080001
070900               ,:EPTAX-TX-EXMPT-ID                                07090001
071000               ,:EPTAX-CUST-PHN-NBR                               07100014
071100               ,:EPTRN-TRN-TYP-CDE                                07110001
071200               ,:EPTRN-TRN-DTE                                    07120001
071300               ,:EPTRN-ACCM-TOT-AMT                               07130001
071400               ,:XST00001-ST-CDE                                  07140001
034700               ,:EPTAX-TX-EXMPT-AGCY-NM                           07141015
071500     END-EXEC.                                                    07150001
071600                                                                  07160001
071700     EVALUATE TRUE                                                07170001
071800         WHEN SQLCODE = ZERO                                      07180001
071900             CONTINUE                                             07190001
072000         WHEN SQLCODE = PC-ROW-NOT-FOUND                          07200001
072100             SET PS-END-OF-TEPTAX TO TRUE                         07210001
072200             MOVE 'ZZ'            TO PV-SAVE-STATE                07220001
072300         WHEN SQLWARN0 NOT EQUAL SPACE                            07230001
072400         WHEN SQLCODE NOT EQUAL ZERO                              07240001
072500             MOVE '8100-FETCH-TEPTAX-CURSOR'                      07250001
072600                                            TO PV-PARAGRAPH-NAME  07260001
072700             MOVE 'ERROR ON FETCH OF TEPTAX-CURSOR'               07270001
072800                                            TO PV-DB2-OPERATION   07280001
072900             PERFORM 9100-SQL-ABEND                               07290001
073000     END-EVALUATE.                                                07300001
073100                                                                  07310001
073200******************************************************************07320001
073300* 8200-CLOSE-TEPTAX-CURSOR                                        07330001
073400******************************************************************07340001
073500 8200-CLOSE-TEPTAX-CURSOR.                                        07350001
073600                                                                  07360001
073700     EXEC SQL                                                     07370001
073800          CLOSE TEPTAX-CURSOR                                     07380001
073900     END-EXEC.                                                    07390001
074000                                                                  07400001
074100     EVALUATE TRUE                                                07410001
074200         WHEN SQLCODE = ZERO                                      07420001
074300              CONTINUE                                            07430001
074400         WHEN SQLWARN0 NOT EQUAL SPACE                            07440001
074500         WHEN SQLCODE NOT EQUAL ZERO                              07450001
074600             MOVE '8200-CLOSE-TEPTAX-CURSOR'                      07460001
074700                                            TO PV-PARAGRAPH-NAME  07470001
074800             MOVE 'ERROR ON CLOSE OF TEPTAX-CURSOR'               07480001
074900                                            TO PV-DB2-OPERATION   07490001
075000             PERFORM 9100-SQL-ABEND                               07500001
075100     END-EVALUATE.                                                07510001
075200******************************************************************07520001
075300* 9000-HEADER-ROUTINE-1                                           07530001
075400*     PRINT THE HEADINGS FOR THE SUMMARY REPORT.                  07540001
075500******************************************************************07550001
075600                                                                  07560001
075700 9000-HEADER-ROUTINE-1.                                           07570001
075800                                                                  07580001
075900     MOVE PV-SAVE-STATE          TO HL2-STATE.                    07590001
076000     MOVE PC-REPORT-NBR-1        TO DP132-REPORT-NUMBER.          07600005
076100     ADD +1                      TO PV-PAGE-CNT1.                 07610001
076200     MOVE PV-PAGE-CNT1           TO DP132-PAGE-NUMBER.            07620005
076300     MOVE DP132-STANDRD-HEADER-132-COLS                           07630006
076400                                 TO PV-PRINT-RECORD.              07640001
076500     PERFORM 9800-WRITE-RPT-TOP-OF-PAGE.                          07650001
076600                                                                  07660001
076700     MOVE HL2-HEADING-LINE-2     TO PV-PRINT-RECORD.              07670001
076800     MOVE +2                     TO PV-LINE-SPACING.              07680001
076900     PERFORM 9900-WRITE-REPORT-LINE.                              07690001
077000                                                                  07700001
077100     MOVE HL2-HEADING-LINE-3     TO PV-PRINT-RECORD.              07710001
077200     MOVE +2                     TO PV-LINE-SPACING.              07720001
077300     PERFORM 9900-WRITE-REPORT-LINE.                              07730001
077400                                                                  07740001
077500     MOVE HL2-HEADING-LINE-4     TO PV-PRINT-RECORD.              07750001
077600     MOVE +2                     TO PV-LINE-SPACING.              07760001
077700     PERFORM 9900-WRITE-REPORT-LINE.                              07770001
077800                                                                  07780001
077900     MOVE HL2-HEADING-LINE-5     TO PV-PRINT-RECORD.              07790001
078000     MOVE +2                     TO PV-LINE-SPACING.              07800001
078100     PERFORM 9900-WRITE-REPORT-LINE.                              07810001
078200                                                                  07820001
078300     MOVE SPACES                 TO PV-PRINT-RECORD.              07830001
078400     MOVE +1                     TO PV-LINE-SPACING.              07840001
078500     PERFORM 9900-WRITE-REPORT-LINE.                              07850001
078600                                                                  07860001
078700******************************************************************07870001
078800* 9100-HEADER-ROUTINE-2                                           07880001
078900*     PRINT THE HEADINGS FOR THE DETAIL REPORT.                   07890001
079000******************************************************************07900001
079100                                                                  07910001
079200 9100-HEADER-ROUTINE-2.                                           07920001
079300                                                                  07930001
079400     MOVE PC-REPORT-NBR-2        TO DP132-REPORT-NUMBER.          07940005
079500     ADD +1                      TO PV-PAGE-CNT2.                 07950001
079600     MOVE PV-PAGE-CNT2           TO DP132-PAGE-NUMBER.            07960005
079700     MOVE DP132-STANDRD-HEADER-132-COLS                           07970007
079800                                 TO PV-PRINT-RECORD.              07980001
079900     PERFORM 9800-WRITE-RPT-TOP-OF-PAGE.                          07990001
080000                                                                  08000001
080100     MOVE HL3-HEADING-LINE-2     TO PV-PRINT-RECORD.              08010001
080200     MOVE +2                     TO PV-LINE-SPACING.              08020001
080300     PERFORM 9900-WRITE-REPORT-LINE.                              08030001
080400                                                                  08040001
080500     MOVE HL3-HEADING-LINE-3     TO PV-PRINT-RECORD.              08050001
080600     MOVE +2                     TO PV-LINE-SPACING.              08060001
080700     PERFORM 9900-WRITE-REPORT-LINE.                              08070001
080800                                                                  08080001
080900     MOVE HL3-HEADING-LINE-4     TO PV-PRINT-RECORD.              08090001
081000     MOVE +2                     TO PV-LINE-SPACING.              08100001
081100     PERFORM 9900-WRITE-REPORT-LINE.                              08110001
081200                                                                  08120001
081300     MOVE HL3-HEADING-LINE-5     TO PV-PRINT-RECORD.              08130001
081400     MOVE +2                     TO PV-LINE-SPACING.              08140001
081500     PERFORM 9900-WRITE-REPORT-LINE.                              08150001
081600                                                                  08160001
081700     MOVE SPACES                 TO PV-PRINT-RECORD.              08170001
081800     MOVE +1                     TO PV-LINE-SPACING.              08180001
081900     PERFORM 9900-WRITE-REPORT-LINE.                              08190001
082000                                                                  08200001
082100******************************************************************08210001
082200* 9800-WRITE-RPT-TOP-OF-PAGE                                      08220001
082300*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   08230001
082400******************************************************************08240001
082500 9800-WRITE-RPT-TOP-OF-PAGE.                                      08250001
082600                                                                  08260001
082700     IF DP132-REPORT-NUMBER = '1'                                 08270005
082800         WRITE TAX-EXEMPT-SUMMARY-RCD                             08280001
082900           FROM PV-PRINT-RECORD                                   08290001
083000             AFTER ADVANCING PAGE                                 08300001
083100         MOVE +1 TO PV-LINE-CNT1                                  08310001
083200     ELSE                                                         08320001
083300         WRITE TAX-EXEMPT-DETAIL-RCD                              08330001
083400           FROM PV-PRINT-RECORD                                   08340001
083500             AFTER ADVANCING PAGE                                 08350001
083600         MOVE +1 TO PV-LINE-CNT2                                  08360001
083700     END-IF.                                                      08370001
083800******************************************************************08380001
083900* 9900-WRITE-REPORT-LINE                                          08390001
084000*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             08400001
084100******************************************************************08410001
084200 9900-WRITE-REPORT-LINE.                                          08420001
084300                                                                  08430001
084400     IF DP132-REPORT-NUMBER = '1'                                 08440005
084500         WRITE TAX-EXEMPT-SUMMARY-RCD                             08450001
084600           FROM PV-PRINT-RECORD                                   08460001
084700             AFTER ADVANCING PV-LINE-SPACING                      08470001
084800                                                                  08480001
084900         ADD PV-LINE-SPACING TO PV-LINE-CNT1                      08490001
085000     ELSE                                                         08500001
085100         WRITE TAX-EXEMPT-DETAIL-RCD                              08510001
085200           FROM PV-PRINT-RECORD                                   08520001
085300             AFTER ADVANCING PV-LINE-SPACING                      08530001
085400                                                                  08540001
085500         ADD PV-LINE-SPACING TO PV-LINE-CNT2                      08550001
085600     END-IF.                                                      08560001
085700******************************************************************08570001
085800* 9100-SQL-ABEND                                                  08580001
085900*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.08590001
086000******************************************************************08600001
086100 9100-SQL-ABEND.                                                  08610001
086200     DISPLAY '** ABEND     **'.                                   08620001
086300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08630001
086400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08640001
086500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               08650001
086600                                                                  08660001
086700******************************************************************08670001
086800* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     08680001
086900* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      08690001
087000******************************************************************08700001
087100     COPY DPPD004.                                                08710001
087200                                                                  08720001
087300     SET AC-DB2-ERROR TO TRUE.                                    08730001
087400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         08740001
087500                                                                  08750001
087600******************************************************************08760001
087700* 9999-ABEND                                                      08770001
087800*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  08780001
087900******************************************************************08790001
088000 9999-ABEND.                                                      08800001
088100     DISPLAY '** ABEND           **'.                             08810001
088200     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  08820001
088300     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08830001
088400     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       08840001
088500     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       08850001
088600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         08860001
