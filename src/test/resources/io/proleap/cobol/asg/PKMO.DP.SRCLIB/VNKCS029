000100*-----------------------*                                         00010031
000200 IDENTIFICATION DIVISION.                                         00020031
000300*-----------------------*                                         00030031
000400 PROGRAM-ID.    VNKCS029.                                         00040031
000500 AUTHOR.        JACK KRAMER.                                      00050031
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060031
000700 DATE-WRITTEN.  JANUARY 2005.                                     00070031
000800*---------------------------------------------------------------* 00080031
000900*    V029 - VENDOR CAPABILITY INQUIRY PROGRAM.                  * 00090031
001000*                                                               * 00100031
001100*    THIS PROGRAM DISPLAYS CAPABILITY DATA FOR A VENDOR. THE    * 00110031
001200*    USER CAN PAGE FORWARD OR BACKWARD FOR THE HISTORY OF THE   * 00120031
001300*    CAPABILITY BEING DISPLAYED.                                * 00130031
001400*                                                               * 00140031
001400*    CHANGE LOG:                                                * 00140137
001400*    DATE: 01/05/2023                                           * 00140237
001420*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00141037
001450*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00142037
001500*---------------------------------------------------------------* 00150031
001600 ENVIRONMENT DIVISION.                                            00160031
001700 DATA DIVISION.                                                   00170031
001800                                                                  00180031
001900 WORKING-STORAGE SECTION.                                         00190031
002000                                                                  00200031
002100 01  PC-PROGRAM-CONSTANTS.                                        00210031
002200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00220031
002300                                                    'VN029A  '.   00230031
002400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00240031
002500                                                    'VNKM029 '.   00250031
002600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00260031
002700                                                    'VNKCS029'.   00270031
002800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00280031
002900     05  PC-INTER-APPL-CODES.                                     00290031
003000         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '1'.    00300031
003100         10 PC-INTER-APPL-DETAIL        PIC  X(01)  VALUE '2'.    00310031
003200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +01     00320031
003300                                                    COMP SYNC.    00330031
003400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00340031
003500                                                    COMP SYNC.    00350031
003600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00360031
003700                                                    +1000000      00370031
003800                                                    COMP-3.       00380031
003900     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00390031
004000                                                    COMP SYNC.    00400031
004100     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00410031
004200                                                    COMP-3.       00420031
004300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00430031
004400     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00440031
004500     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00450031
004600     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00460031
004700     05  PC-MAX-DATE                    PIC  X(10)  VALUE         00470031
004800                                                    '12/31/9999'. 00480031
004900                                                                  00490031
005000     05  PC-TSYMSG-NUMBERS.                                       00500031
005100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00510031
005200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00520031
005300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00530031
005400         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00540031
005500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00550031
005600         10  PC-TSYMSG-03367            PIC  9(05)  VALUE 03367.  00560031
005700         10  PC-TSYMSG-03368            PIC  9(05)  VALUE 03368.  00570031
005800         10  PC-TSYMSG-03631            PIC  9(05)  VALUE 03631.  00580033
005900         10  PC-TSYMSG-03633            PIC  9(05)  VALUE 03633.  00590033
006000         10  PC-TSYMSG-03636            PIC  9(05)  VALUE 03636.  00600033
006100         10  PC-TSYMSG-03637            PIC  9(05)  VALUE 03637.  00610033
006200         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00620031
006300                                                                  00630031
006400 01  PS-PROGRAM-SWITCHES.                                         00640031
006500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00650031
006600         88  PS-NO-ERROR                            VALUE 'Y'.    00660031
006700         88  PS-ERROR                               VALUE 'N'.    00670031
006800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00680031
006900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00690031
007000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00700031
007100                                                                  00710031
007200 01  PV-PROGRAM-VARIABLES.                                        00720031
007300     05  PV-ONE                         PIC X       VALUE SPACE.  00730034
007400     05  PV-SUB                         PIC S9(04)  VALUE +0      00740031
007500                                                    COMP SYNC.    00750031
007600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00760031
007700                                                    COMP SYNC.    00770031
007800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00780031
007900                                                    COMP-3.       00790031
008000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00800031
008100                                                    COMP-3.       00810031
008200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00820031
008300                                                    COMP-3.       00830031
008400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00840031
008500                                                    COMP-3.       00850031
008600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00860031
008700                                                    COMP-3.       00870031
008800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00880031
008900                                                    COMP-3.       00890031
009000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00900031
009100                                                    COMP SYNC.    00910031
009200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00920031
009300                                                    COMP SYNC.    00930031
009400     05  PV-ITEM                        PIC S9(04)  VALUE +0      00940031
009500                                                    COMP SYNC.    00950031
009600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00960031
009700                                                    COMP SYNC.    00970031
009800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00980031
009900                                                    COMP SYNC.    00990031
010000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01000031
010100                                                    COMP SYNC.    01010031
010200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01020031
010300                                                    COMP SYNC.    01030031
010400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01040031
010500                                                    COMP SYNC.    01050031
010600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01060031
010700                                                    COMP SYNC.    01070031
010800     05  PV-WORK-DATE.                                            01080031
010900         10  PV-WORK-MM                 PIC XX      VALUE SPACES. 01090031
011000         10  PV-SLASH1                  PIC X       VALUE '/'.    01100031
011100         10  PV-WORK-DD                 PIC XX      VALUE SPACES. 01110031
011200         10  PV-SLASH2                  PIC X       VALUE '/'.    01120031
011300         10  PV-WORK-YYYY               PIC XXXX    VALUE SPACES. 01130031
011400                                                                  01140031
011500*---------------------------------------------------------------* 01150031
011600*  RECORD LAYOUT FOR THE VENDOR CAPABILITIES TEMP STORAGE QUEUE * 01160031
011700*---------------------------------------------------------------* 01170031
011800     COPY VNWS019.                                                01180031
011900                                                                  01190031
012000*---------------------------------------------------------------* 01200031
012100*    MAP LAYOUT                                                 * 01210031
012200*---------------------------------------------------------------* 01220031
012300     COPY VNKM029.                                                01230031
012400                                                                  01240031
012500*---------------------------------------------------------------* 01250031
012600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01260031
012700*---------------------------------------------------------------* 01270031
012800     COPY DPWS015.                                                01280031
012900                                                                  01290031
013000*---------------------------------------------------------------* 01300031
013100*    FUNCTION KEYS COPYBOOK.                                    * 01310031
013200*---------------------------------------------------------------* 01320031
013300     COPY DPWS016.                                                01330031
013400                                                                  01340031
013500*---------------------------------------------------------------* 01350031
013600*    NUMERIC EDIT LAYOUT.                                       * 01360031
013700*---------------------------------------------------------------* 01370031
013800     COPY DPWS010I.                                               01380031
013900                                                                  01390031
014000*---------------------------------------------------------------* 01400031
014100*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 01410037
014200*---------------------------------------------------------------* 01420031
014300     COPY DPWS030.                                                01430031
014300     COPY DPWS930.                                                01431037
014400                                                                  01440031
014500*---------------------------------------------------------------* 01450031
014600*    STANDARD COMMAREA.                                         * 01460031
014700*---------------------------------------------------------------* 01470031
014800     COPY DPWS020.                                                01480031
014900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01490031
015000*---------------------------------------------------------------* 01500031
015100* INTER-APPLICATION COMMAREA.                                   * 01510031
015200*   VNWS018 - IS THE INPUT LAYOUT FROM THE LIST PROGRAM AND THE * 01520031
015300*             OUTPUT LAYOUT FOR A LOCAL-GO FUNCTION.            * 01530031
015400*---------------------------------------------------------------* 01540031
015500         10  INTER-APPL-COMM-AREA       PIC X(200).               01550031
015600     COPY VNWS018.                                                01560031
015700         10  ASC-SPECIFIC-COMMAREA.                               01570031
015800             15  ASC-KEYS.                                        01580031
015900                 20  ASC-KEY-ENT-ID                  PIC S9(09)   01590031
016000                                                     COMP.        01600031
016100                 20  ASC-KEY-CAPBLTY-CDE             PIC  X(03).  01610031
016200                 20  ASC-KEY-CAPBLTY-NAME            PIC  X(30).  01620031
016300                 20  ASC-KEY-VENDOR-NAME             PIC  X(30).  01630031
016400                 20  ASC-KEY-VENDOR-ID               PIC  X(09).  01640031
016500             15  ASC-MAX-EXP-DATE                    PIC  X(10).  01650031
016600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01660031
016700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  01670031
016800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   01680031
016900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   01690031
017000                                                                  01700031
017100                 20  ASC-ITEM-ARRAY.                              01710031
017200                     25  ASC-ITEM-ENTRIES OCCURS 1 TIMES.         01720031
017300                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   01730031
017400                                                     COMP-3.      01740031
017500                         30  ASC-EFF-DATE            PIC  X(10).  01750031
017600                         30  ASC-EXP-DATE            PIC  X(10).  01760031
017700                         30  ASC-DATE-ADDED          PIC  X(10).  01770031
017800                         30  ASC-LAST-UPD-ID         PIC  X(08).  01780031
017900                         30  ASC-LAST-UPD-DATE       PIC  X(10).  01790031
018000                                                                  01800031
018100             15  ASC-BLK-SUB                         PIC S9(04)   01810031
018200                                                          COMP    01820031
018300                                                          SYNC.   01830031
018400             15  ASC-ITEM-SUB                        PIC S9(04)   01840031
018500                                                          COMP    01850031
018600                                                          SYNC.   01860031
018700             15  ASC-SEL-SUB                         PIC S9(04)   01870031
018800                                                          COMP.   01880031
018900             15  ASC-SEL-ITEM                        PIC S9(04)   01890031
019000                                                          COMP.   01900031
019100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   01910031
019200                                                          COMP-3. 01920031
019300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   01930031
019400                                                          COMP-3. 01940031
019500             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   01950031
019600                                                          COMP-3. 01960031
019700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   01970031
019800                                                          COMP-3. 01980031
019900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   01990031
020000                                                          COMP-3. 02000031
020100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02010031
020200                                                          COMP-3. 02020031
020300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02030031
020400                                                          COMP    02040031
020500                                                          SYNC.   02050031
020600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02060031
020700                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   02070031
020800                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   02080031
020900             15  ASC-LONGNAME-FOUND-SW               PIC  X(01).  02090034
021000                 88  ASC-LONGNAME-FOUND              VALUE 'Y'.   02100034
021100                 88  ASC-LONGNAME-NOT-FOUND          VALUE 'N'.   02110034
021200             15  ASC-LIST-QUEUE-NAME.                             02120031
021300                 20  ASC-LIST-TERM-ID                PIC  X(04).  02130031
021400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02140031
021500                                                          COMP-3. 02150031
021600                 20  ASC-LIST-SEQ                    PIC  9(01).  02160031
021700             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).  02170031
021800                                                                  02180031
021900             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02190031
022000                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   02200031
022100             15  ASC-DISPLAY-ENT-ID                  PIC  9(09).  02210036
022200                                                                  02220031
022300*---------------------------------------------------------------* 02230031
022400*    ABEND PROCESSING COPYBOOK.                                 * 02240031
022500*---------------------------------------------------------------* 02250031
022600     COPY DPWS013.                                                02260031
022700                                                                  02270031
022800*---------------------------------------------------------------* 02280031
022900*    DB2 AREA FOR TENTNME                                       * 02290031
023000*---------------------------------------------------------------* 02300031
023100     EXEC SQL                                                     02310031
023200          INCLUDE TENTNME                                         02320031
023300     END-EXEC.                                                    02330031
023400                                                                  02340031
023500*---------------------------------------------------------------* 02350034
023600*    DB2 AREA FOR TEXTENT                                       * 02360034
023700*---------------------------------------------------------------* 02370034
023800     EXEC SQL                                                     02380034
023900          INCLUDE TEXTENT                                         02390034
024000     END-EXEC.                                                    02400034
024100                                                                  02410034
024200*---------------------------------------------------------------* 02420031
024300*    DB2 AREA FOR VNT_VND_CPBL                                  * 02430031
024400*---------------------------------------------------------------* 02440031
024500     EXEC SQL                                                     02450031
024600          INCLUDE VNT00001                                        02460031
024700     END-EXEC.                                                    02470031
024800                                                                  02480031
024900*--------------------------------------------------------------*  02490034
025000* TABLE USED FOR EXISTENCE CHECKING                            *  02500034
025100*--------------------------------------------------------------*  02510034
025200     EXEC SQL                                                     02520034
025300          INCLUDE SYSDUMMY                                        02530034
025400     END-EXEC.                                                    02540034
025500                                                                  02550034
025600*---------------------------------------------------------------* 02560031
025700*    DB2 AREA FOR COMMUNICATIONS                                * 02570031
025800*---------------------------------------------------------------* 02580031
025900     EXEC SQL                                                     02590031
026000          INCLUDE SQLCA                                           02600031
026100     END-EXEC.                                                    02610031
026200                                                                  02620031
026300*---------------------------------------------------------------* 02630031
026400*   CURSOR TO SELECT VENDOR CAPABILITIES                        * 02640031
026500*---------------------------------------------------------------* 02650031
026600                                                                  02660031
026700     EXEC SQL                                                     02670031
026800             DECLARE CAPABILITY-CSR CURSOR FOR                    02680031
026900                SELECT  EFF_BEG_DTE                               02690031
027000                       ,EFF_END_DTE                               02700031
027100                       ,CRE_DTE                                   02710031
027200                       ,LAST_UPD_TMST                             02720031
027300                       ,LAST_UPD_BY_USR_ID                        02730031
027400                FROM VNT_VND_CPBL                                 02740031
027500                 WHERE ENT_ID       = :ASC-KEY-ENT-ID             02750031
027600                   AND VND_CPBL_CDE = :ASC-KEY-CAPBLTY-CDE        02760031
027700                   ORDER BY EFF_END_DTE                           02770031
027800     END-EXEC.                                                    02780031
027900                                                                  02790031
028000 LINKAGE SECTION.                                                 02800031
028100                                                                  02810031
028200 01  DFHCOMMAREA.                                                 02820031
028300     05  FILLER  OCCURS 1 TO 4072 TIMES                           02830031
028400                 DEPENDING ON EIBCALEN.                           02840031
028500         10  FILLER  PIC X.                                       02850031
028600                                                                  02860031
028700 PROCEDURE DIVISION.                                              02870031
028800***************************************************************** 02880031
028900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 02890031
029000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 02900031
029100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 02910031
029200***************************************************************** 02920031
029300 0000-MAIN-MODULE.                                                02930031
029400                                                                  02940031
029500     INITIALIZE DP030-CICS-API-FIELDS.                            02950031
029600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02960031
029700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02970031
029800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02980031
029900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02990031
030000     MOVE LENGTH OF VN029AI        TO DP030-MAP-LENGTH (1).       03000031
030100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03010031
030200     PERFORM 0001-CALL-CICS-ARCH-API.                             03020031
030300                                                                  03030031
030400     PERFORM 1000-CONTROL-PROCESSING                              03040031
030500                                                                  03050031
030600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03060031
030700     PERFORM 0001-CALL-CICS-ARCH-API.                             03070031
030800                                                                  03080031
030900***************************************************************** 03090031
031000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 03100031
031100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 03110031
031200***************************************************************** 03120031
031300 0001-CALL-CICS-ARCH-API.                                         03130031
031400                                                                  03140031
031500*    CALL 'DPKCS030' USING DFHEIBLK                               03150037
031500     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03151037
031600                           DFHCOMMAREA                            03160031
031700                           DP030-CICS-API-FIELDS                  03170031
031800                           DP020-STANDARD-COMMAREA                03180031
031900                           VN029AI.                               03190031
032000                                                                  03200031
032100     IF  DP030-RC-CALL-SUCCESSFUL                                 03210031
032200         CONTINUE                                                 03220031
032300     ELSE                                                         03230031
032400         SET DP013-NO-ROLLBACK                                    03240031
032500             DP013-XCTL-DISPLAY-RESTART                           03250031
032600             DP013-CICS-ABEND      TO TRUE                        03260031
032700         MOVE '0001-CALL-CICS-ARCH-API'                           03270031
032800                                   TO DP013-PARAGRAPH             03280031
032900*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03290037
033000*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03300037
032900         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03301037
033000-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03302037
033100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03310031
033200         PERFORM DP013-0000-PROCESS-ABEND                         03320031
033300     END-IF.                                                      03330031
033400                                                                  03340031
033500*----------------------------------------------------------------*03350031
033600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03360031
033700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03370031
033800*                                                                *03380031
033900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *03390031
034000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *03400031
034100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *03410031
034200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *03420031
034300*----------------------------------------------------------------*03430031
034400 1000-CONTROL-PROCESSING.                                         03440031
034500                                                                  03450031
034600     EVALUATE TRUE                                                03460031
034700         WHEN DP020-NEXT-ACT-INITIAL                              03470031
034800             INITIALIZE ASC-SPECIFIC-COMMAREA                     03480031
034900             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            03490031
035000             MOVE DP020-SRC-TASK-NUMBER                           03500031
035100                                   TO ASC-LIST-TASK-NUMBER        03510031
035200             MOVE PC-LIST-QUEUE-SEQ                               03520031
035300                                   TO ASC-LIST-SEQ                03530031
035400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03540031
035500             IF  PS-COMMAREA-NOT-VALID                            03550031
035600                 SET DP020-MSG-FATAL                              03560031
035700                     DP020-NEXT-ACT-APPL-ERROR                    03570031
035800                                   TO TRUE                        03580031
035900             ELSE                                                 03590031
036000                 PERFORM 4000-BUILD-INITIAL-PANEL                 03600031
036100             END-IF                                               03610031
036200                                                                  03620031
036300         WHEN DP020-NEXT-ACT-READ-MAP                             03630031
036400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        03640031
036500                                   TO PV-TOP-ITEM                 03650031
036600             PERFORM 2000-PROCESS-PANEL                           03660031
036700                                                                  03670031
036800         WHEN DP020-NEXT-ACT-RETURN                               03680031
036900             PERFORM 2050-DELETE-LIST-QUEUE                       03690031
037000             PERFORM 4000-BUILD-INITIAL-PANEL                     03700031
037100                                                                  03710031
037200         WHEN OTHER                                               03720031
037300             SET DP013-LOGIC-ABEND TO TRUE                        03730031
037400             SET DP013-NO-ROLLBACK TO TRUE                        03740031
037500             MOVE '1000-CONTROL-PROCESSING'                       03750031
037600                                   TO DP013-PARAGRAPH             03760031
037700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03770031
037800                                   TO DP013-MESSAGE-TEXT(1)       03780031
037900             PERFORM DP013-0000-PROCESS-ABEND                     03790031
038000     END-EVALUATE.                                                03800031
038100                                                                  03810031
038200*----------------------------------------------------------------*03820031
038300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *03830031
038400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *03840031
038500*----------------------------------------------------------------*03850031
038600 1100-PROCESS-INTER-APPL-COMM.                                    03860031
038700                                                                  03870031
038800     EVALUATE DP020-INT-APPL-FORMAT-IND                           03880031
038900         WHEN PC-INTER-APPL-LIST                                  03890031
039000              SET PS-COMMAREA-VALID                               03900031
039100                  ASC-USE-SELECTION-QUEUE                         03910031
039200                                   TO TRUE                        03920031
039300              MOVE VN018-ENT-ID TO ASC-KEY-ENT-ID                 03930031
039400                                   ASC-DISPLAY-ENT-ID             03940031
039500              MOVE VN018-VENDOR-NAME  TO ASC-KEY-VENDOR-NAME      03950031
039600              MOVE VN018-VENDOR-ID    TO ASC-KEY-VENDOR-ID        03960031
039700              MOVE VN018-NUMBER-OF-SELECTED-ITEMS                 03970031
039800                                   TO ASC-NUMBER-OF-SELECTED-ITEMS03980031
039900              MOVE VN018-NUMBER-OF-TS-ITEMS                       03990031
040000                                   TO ASC-NUMBER-OF-TS-ITEMS      04000031
040100              MOVE VN018-SEL-QUEUE-NAME                           04010031
040200                                   TO ASC-SEL-QUEUE-NAME-IN       04020031
040300              PERFORM 1120-PREPARE-LIST-ENTRY                     04030031
040400                                                                  04040031
040500         WHEN PC-INTER-APPL-DETAIL                                04050031
040600              SET PS-COMMAREA-VALID   TO TRUE                     04060031
040700              MOVE VN018-ENT-ID       TO ASC-KEY-ENT-ID           04070031
040800                                         ASC-DISPLAY-ENT-ID       04080031
040900              MOVE VN018-VENDOR-NAME  TO ASC-KEY-VENDOR-NAME      04090031
041000              MOVE VN018-VENDOR-ID    TO ASC-KEY-VENDOR-ID        04100031
041100              MOVE VN018-CAPBLTY-CDE  TO ASC-KEY-CAPBLTY-CDE      04110031
041200              MOVE VN018-CAPBLTY-NAME TO ASC-KEY-CAPBLTY-NAME     04120031
041300                                                                  04130031
041400         WHEN OTHER                                               04140031
041500                 MOVE PC-TSYMSG-00148                             04150031
041600                                   TO DP020-MSG-NUMBER            04160031
041700                 SET PS-COMMAREA-NOT-VALID                        04170031
041800                                   TO TRUE                        04180031
041900     END-EVALUATE.                                                04190031
042000                                                                  04200031
042100*----------------------------------------------------------------*04210031
042200*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *04220031
042300*  QUEUE PASSED FROM THE LIST.                                   *04230031
042400*                                                                *04240031
042500*----------------------------------------------------------------*04250031
042600 1120-PREPARE-LIST-ENTRY.                                         04260031
042700                                                                  04270031
042800      MOVE VN019-MAX-ITEMS TO ASC-SEL-SUB.                        04280031
042900      MOVE ZERO            TO ASC-SEL-ITEM.                       04290031
043000                                                                  04300031
043100      PERFORM 2300-GET-NEXT-MESSAGE.                              04310031
043200                                                                  04320031
043300                                                                  04330031
043400*----------------------------------------------------------------*04340031
043500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04350031
043600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04360031
043700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04370031
043800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04380031
043900* FUNCTION KEYS CAN GET THIS FAR.                                *04390031
044000*----------------------------------------------------------------*04400031
044100 2000-PROCESS-PANEL.                                              04410031
044200                                                                  04420031
044300     EVALUATE TRUE                                                04430031
044400         WHEN DP020-SRC-AID = DP016-CLEAR                         04440031
044500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04450031
044600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04460031
044700                                                                  04470031
044800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04480031
044900             PERFORM 2050-DELETE-LIST-QUEUE                       04490031
045000             PERFORM 4000-BUILD-INITIAL-PANEL                     04500031
045100                                                                  04510031
045200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04520031
045300             IF ASC-USE-SELECTION-QUEUE                           04530031
045400                 PERFORM 6200-DEL-LIST-QUEUE                      04540031
045500                 PERFORM 2300-GET-NEXT-MESSAGE                    04550031
045600                 PERFORM 4000-BUILD-INITIAL-PANEL                 04560031
045700             ELSE                                                 04570031
045800*                --- BOTTOM OF LIST ---                           04580031
045900                 MOVE PC-TSYMSG-00070                             04590031
046000                                   TO DP020-MSG-NUMBER            04600031
046100                 SET DP020-MSG-INFORMATIONAL                      04610031
046200                                   TO TRUE                        04620031
046300             END-IF                                               04630031
046400                                                                  04640031
046500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04650031
046600             IF ASC-USE-SELECTION-QUEUE                           04660031
046700                 PERFORM 6200-DEL-LIST-QUEUE                      04670031
046800                 PERFORM 2310-GET-PREV-MESSAGE                    04680031
046900                 PERFORM 4000-BUILD-INITIAL-PANEL                 04690031
047000             ELSE                                                 04700031
047100*                --- TOP OF LIST ---                              04710031
047200                 MOVE PC-TSYMSG-00069                             04720031
047300                                   TO DP020-MSG-NUMBER            04730031
047400                 SET DP020-MSG-INFORMATIONAL                      04740031
047500                                   TO TRUE                        04750031
047600             END-IF                                               04760031
047700                                                                  04770031
047800         WHEN OTHER                                               04780031
047900             SET DP030-CONTINUE-GO TO TRUE                        04790031
048000             PERFORM 2100-CHECK-FUNCTION-KEY                      04800031
048100     END-EVALUATE.                                                04810031
048200                                                                  04820031
048300*----------------------------------------------------------------*04830031
048400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *04840031
048500*----------------------------------------------------------------*04850031
048600 2050-DELETE-LIST-QUEUE.                                          04860031
048700                                                                  04870031
048800     EXEC CICS                                                    04880031
048900         DELETEQ TS                                               04890031
049000             QUEUE (ASC-LIST-QUEUE-NAME)                          04900031
049100             RESP  (PV-CICS-RESP)                                 04910031
049200     END-EXEC.                                                    04920031
049300                                                                  04930031
049400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       04940031
049500        (PV-CICS-RESP = DFHRESP(QIDERR))                          04950031
049600         CONTINUE                                                 04960031
049700     ELSE                                                         04970031
049800         SET DP013-CICS-ABEND      TO TRUE                        04980031
049900         SET DP013-NO-ROLLBACK     TO TRUE                        04990031
050000                                                                  05000031
050100         MOVE '2050-DELETE-LIST-QUEUE'                            05010031
050200                                   TO DP013-PARAGRAPH             05020031
050300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05030031
050400                                   TO DP013-MESSAGE-TEXT (1)      05040031
050500         PERFORM DP013-0000-PROCESS-ABEND                         05050031
050600     END-IF.                                                      05060031
050700                                                                  05070031
050800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05080031
050900                                                                  05090031
051000*----------------------------------------------------------------*05100031
051100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05110031
051200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05120031
051300* CICS ARCHITECTURE API.                                         *05130031
051400*----------------------------------------------------------------*05140031
051500 2100-CHECK-FUNCTION-KEY.                                         05150031
051600                                                                  05160031
051700     EVALUATE TRUE                                                05170031
051800         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               05180031
051900             IF ASC-MAX-EXP-DATE = PC-MAX-DATE                    05190031
052000                 SET DP030-OVERRIDE-GO                            05200031
052100                     DP030-SET-CURSOR-TRAILER                     05210031
052200                     DP020-MSG-FATAL  TO TRUE                     05220031
052300                 MOVE PC-TSYMSG-03367 TO DP020-MSG-NUMBER         05230031
052400             ELSE                                                 05240031
052500                 INITIALIZE VN018-INTER-APPL-COMMAREA             05250031
052600                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05260031
052700                                TO VN018-NUMBER-OF-SELECTED-ITEMS 05270031
052800                 MOVE ASC-KEY-ENT-ID                              05280031
052900                                TO VN018-ENT-ID                   05290031
053000                 MOVE ASC-KEY-VENDOR-NAME  TO VN018-VENDOR-NAME   05300031
053100                 MOVE ASC-KEY-VENDOR-ID    TO VN018-VENDOR-ID     05310031
053200                 MOVE ASC-KEY-CAPBLTY-CDE  TO VN018-CAPBLTY-CDE   05320031
053300                 MOVE ASC-KEY-CAPBLTY-NAME TO VN018-CAPBLTY-NAME  05330031
053400                 PERFORM 2600-CHECK-PARTNER-STATS                 05340034
053500             END-IF                                               05350031
053600                                                                  05360031
053700         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               05370031
053800             IF ASC-MAX-EXP-DATE NOT = PC-MAX-DATE                05380031
053900                 SET DP030-OVERRIDE-GO                            05390031
054000                     DP030-SET-CURSOR-TRAILER                     05400031
054100                     DP020-MSG-FATAL  TO TRUE                     05410031
054200                 MOVE PC-TSYMSG-03368 TO DP020-MSG-NUMBER         05420031
054300             ELSE                                                 05430031
054400                 INITIALIZE VN018-INTER-APPL-COMMAREA             05440031
054500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05450031
054600                                TO VN018-NUMBER-OF-SELECTED-ITEMS 05460031
054700                 MOVE ASC-KEY-ENT-ID                              05470031
054800                                TO VN018-ENT-ID                   05480031
054900                 MOVE ASC-KEY-VENDOR-NAME  TO VN018-VENDOR-NAME   05490031
055000                 MOVE ASC-KEY-VENDOR-ID    TO VN018-VENDOR-ID     05500031
055100                 MOVE ASC-KEY-CAPBLTY-CDE  TO VN018-CAPBLTY-CDE   05510031
055200                 MOVE ASC-KEY-CAPBLTY-NAME TO VN018-CAPBLTY-NAME  05520031
055300                 PERFORM 2600-CHECK-PARTNER-STATS                 05530034
055400             END-IF                                               05540031
055500                                                                  05550031
055600                                                                  05560031
055700         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               05570031
055800             PERFORM 2110-BROWSE-BACKWARD                         05580031
055900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05590031
056000                                                                  05600031
056100         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               05610031
056200             PERFORM 2120-BROWSE-FORWARD                          05620031
056300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05630031
056400                                                                  05640031
056500         WHEN DP020-SRC-AID = DP016-ENTER                         05650031
056600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05660031
056700                                                                  05670031
056800         WHEN OTHER                                               05680031
056900             SET DP013-NO-ROLLBACK                                05690031
057000                 DP013-XCTL-DISPLAY-RESTART                       05700031
057100                 DP013-CICS-ABEND  TO TRUE                        05710031
057200             MOVE '2100-CHECK-FUNCTION-KEY'                       05720031
057300                                   TO DP013-PARAGRAPH             05730031
057400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05740031
057500                                   TO DP013-MESSAGE-TEXT (1)      05750031
057600             PERFORM DP013-0000-PROCESS-ABEND                     05760031
057700     END-EVALUATE.                                                05770031
057800                                                                  05780031
057900*----------------------------------------------------------------*05790031
058000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *05800031
058100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *05810031
058200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *05820031
058300*    MESSAGE.                                                    *05830031
058400*----------------------------------------------------------------*05840031
058500 2110-BROWSE-BACKWARD.                                            05850031
058600                                                                  05860031
058700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    05870031
058800         GIVING PV-TOP-ITEM.                                      05880031
058900                                                                  05890031
059000     IF  ((PV-TOP-ITEM < +1)                                      05900031
059100       OR (PV-TOP-ITEM = +1))                                     05910031
059200         MOVE +1                   TO PV-TOP-ITEM                 05920031
059300*        -- TOP OF LIST --                                        05930031
059400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05940031
059500         SET DP020-MSG-INFORMATIONAL TO TRUE                      05950031
059600     END-IF.                                                      05960031
059700                                                                  05970031
059800*----------------------------------------------------------------*05980031
059900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *05990031
060000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06000031
060100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06010031
060200*----------------------------------------------------------------*06020031
060300 2120-BROWSE-FORWARD.                                             06030031
060400                                                                  06040031
060500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06050031
060600         GIVING PV-TOP-ITEM.                                      06060031
060700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06070031
060800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06080031
060900                                   TO PV-TOP-ITEM                 06090031
061000*        -- BOTTOM OF LIST --                                     06100031
061100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06110031
061200         SET DP020-MSG-INFORMATIONAL                              06120031
061300                                   TO TRUE                        06130031
061400     ELSE                                                         06140031
061500         COMPUTE PV-BOTTOM-ITEM =                                 06150031
061600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06160031
061700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06170031
061800*            -- BOTTOM OF LIST --                                 06180031
061900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06190031
062000             SET DP020-MSG-INFORMATIONAL                          06200031
062100                                   TO TRUE                        06210031
062200         END-IF                                                   06220031
062300     END-IF.                                                      06230031
062400                                                                  06240031
062500******************************************************************06250031
062600* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *06260031
062700* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *06270031
062800******************************************************************06280031
062900 2300-GET-NEXT-MESSAGE.                                           06290031
063000                                                                  06300031
063100     ADD +1                        TO ASC-SEL-SUB.                06310031
063200     IF ASC-SEL-SUB > VN019-MAX-ITEMS                             06320031
063300         ADD +1                    TO ASC-SEL-ITEM                06330031
063400         MOVE +1                   TO ASC-SEL-SUB                 06340031
063500     END-IF.                                                      06350031
063600     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 06360031
063700         PERFORM 9100-READ-SEL-QUEUE                              06370031
063800         IF VN019-ITEM (ASC-SEL-SUB) > ZERO                       06380031
063900             MOVE VN019-CAPBLTY-CDE (ASC-SEL-SUB)                 06390031
064000                                   TO ASC-KEY-CAPBLTY-CDE         06400031
064100             MOVE VN019-CAPBLTY-NAME (ASC-SEL-SUB)                06410031
064200                                   TO ASC-KEY-CAPBLTY-NAME        06420031
064300             SET VN019-INQ (ASC-SEL-SUB)                          06430031
064400                                   TO TRUE                        06440031
064500             PERFORM 9200-REWRITE-LIST-QUEUE                      06450031
064600         ELSE                                                     06460031
064700             SUBTRACT +1 FROM ASC-SEL-SUB                         06470031
064800*            --- BOTTOM OF LIST ---                               06480031
064900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06490031
065000             SET DP020-MSG-INFORMATIONAL                          06500031
065100                                   TO TRUE                        06510031
065200         END-IF                                                   06520031
065300     ELSE                                                         06530031
065400         SUBTRACT +1 FROM ASC-SEL-ITEM                            06540031
065500         MOVE VN019-MAX-ITEMS      TO ASC-SEL-SUB                 06550031
065600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06560031
065700         SET DP020-MSG-INFORMATIONAL                              06570031
065800                                   TO TRUE                        06580031
065900     END-IF.                                                      06590031
066000                                                                  06600031
066100******************************************************************06610031
066200* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *06620031
066300* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *06630031
066400******************************************************************06640031
066500 2310-GET-PREV-MESSAGE.                                           06650031
066600                                                                  06660031
066700     SUBTRACT +1 FROM ASC-SEL-SUB.                                06670031
066800     IF ASC-SEL-SUB < +1                                          06680031
066900         SUBTRACT +1 FROM ASC-SEL-ITEM                            06690031
067000         MOVE VN019-MAX-ITEMS      TO ASC-SEL-SUB                 06700031
067100     END-IF.                                                      06710031
067200                                                                  06720031
067300     IF ASC-SEL-ITEM > ZERO                                       06730031
067400         PERFORM 9100-READ-SEL-QUEUE                              06740031
067500         MOVE VN019-CAPBLTY-CDE (ASC-SEL-SUB)                     06750031
067600                                   TO ASC-KEY-CAPBLTY-CDE         06760031
067700         MOVE VN019-CAPBLTY-NAME (ASC-SEL-SUB)                    06770031
067800                                   TO ASC-KEY-CAPBLTY-NAME        06780031
067900     ELSE                                                         06790031
068000         MOVE +1                   TO ASC-SEL-ITEM                06800031
068100                                      ASC-SEL-SUB                 06810031
068200*        --- TOP OF LIST ---                                      06820031
068300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06830031
068400         SET DP020-MSG-INFORMATIONAL                              06840031
068500                                   TO TRUE                        06850031
068600     END-IF.                                                      06860031
068700                                                                  06870031
068800*----------------------------------------------------------------*06880034
068900* CHECK IF ENT-ID BEING PROCESSED IS A PARTNER TYPE OF IMPORT    *06890034
069000* PARENT (S2) OR FACTORY (FA) THAT IS IN RMS PO AND HAS A LONG   *06900034
069100* NAME.  THE ADD OR UPDATE OF A CAPABILITY WILL BE BLOCKED       *06910034
069200* UNTIL THE PARTNER (S2, FA) HAS A LONGNAME AND IS IN RMS PO.    *06920034
069300*----------------------------------------------------------------*06930034
069400 2600-CHECK-PARTNER-STATS.                                        06940034
069500     MOVE SPACE TO ASC-LONGNAME-FOUND-SW.                         06950034
069600                                                                  06960034
069700     PERFORM 3320-GET-VENDOR-INFO.                                06970034
069800                                                                  06980034
069900     IF EXTENT-PRTNR-IND = 'Y'                                    06990034
070000        IF EXTENT-PRTNR-TYP-CDE = 'S2' OR 'FA'                    07000034
070100           IF EXTENT-VND-IN-RMS-IND = 'Y'                         07010034
070200              PERFORM 3330-CHECK-LONGNAME-EXISTENCE               07020034
070300              IF ASC-LONGNAME-NOT-FOUND                           07030034
070400                 SET PS-ERROR          TO TRUE                    07040034
070500                 SET DP030-OVERRIDE-GO                            07050034
070600                     DP030-SET-CURSOR-APPL-1                      07060034
070700                     DP020-MSG-FATAL  TO TRUE                     07070034
070800*                MOVE -1  TO MR-SELECTL (1)                       07080035
070900                 IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)        07090034
071000***      --- CANNOT ADD A CAPABILITY UNTIL A LONG NAME            07100034
071100***      --- HAS BEEN ADDED                                       07110034
071200                    MOVE PC-TSYMSG-03631  TO DP020-MSG-NUMBER     07120034
071300                 END-IF                                           07130034
071400                 IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)        07140034
071500***      --- CANNOT UPDATE A CAPABILITY UNTIL A LONG NAME         07150034
071600***      --- HAS BEEN ADDED                                       07160034
071700                    MOVE PC-TSYMSG-03636  TO DP020-MSG-NUMBER     07170034
071800                 END-IF                                           07180034
071900              END-IF                                              07190034
072000           ELSE                                                   07200034
072100              SET PS-ERROR          TO TRUE                       07210034
072200              SET DP030-OVERRIDE-GO                               07220034
072300                  DP030-SET-CURSOR-APPL-1                         07230034
072400                  DP020-MSG-FATAL  TO TRUE                        07240034
072500*             MOVE -1  TO MR-SELECTL (1)                          07250035
072600              IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)           07260034
072700***      --- CANNOT ADD A CAPABILITY BECAUSE PARTNER (S2, FA)     07270034
072800***      --- IS NOT IN RMS PO                                     07280034
072900                 MOVE PC-TSYMSG-03633  TO DP020-MSG-NUMBER        07290034
073000              END-IF                                              07300034
073100              IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)           07310034
073200***      --- CANNOT UPDATE A CAPABILITY BECAUSE PARTNER           07320034
073300***      --- (S2, FA) IS NOT IN RMS PO                            07330034
073400                 MOVE PC-TSYMSG-03637  TO DP020-MSG-NUMBER        07340034
073500              END-IF                                              07350034
073600           END-IF                                                 07360034
073700        END-IF                                                    07370034
073800     END-IF.                                                      07380034
073900                                                                  07390034
074000*----------------------------------------------------------------*07400034
074100* SELECT THE VENDOR INFO FOR THE ENTID BEING PROCESSED.          *07410034
074200*----------------------------------------------------------------*07420034
074300 3320-GET-VENDOR-INFO.                                            07430034
074400     PERFORM                                                      07440034
074500         WITH TEST AFTER                                          07450034
074600         VARYING PV-RETRY-COUNTER                                 07460034
074700         FROM 1 BY 1                                              07470034
074800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07480034
074900                   OR (SQLCODE = ZERO))                           07490034
075000                                                                  07500034
075100         EXEC SQL                                                 07510034
075200             SELECT PRTNR_IND                                     07520034
075300                   ,VND_IN_RMS_IND                                07530034
075400                   ,PRTNR_TYP_CDE                                 07540034
075500              INTO  :EXTENT-PRTNR-IND                             07550034
075600                   ,:EXTENT-VND-IN-RMS-IND                        07560034
075700                   ,:EXTENT-PRTNR-TYP-CDE                         07570034
075800              FROM  TEXTENT                                       07580034
075900             WHERE  ENT_ID   = :ASC-KEY-ENT-ID                    07590034
076000         END-EXEC                                                 07600034
076100                                                                  07610034
076200         EVALUATE TRUE                                            07620034
076300             WHEN SQLCODE = ZERO                                  07630034
076400             WHEN SQLCODE = -904                                  07640034
076500             WHEN SQLCODE = -913                                  07650034
076600                 CONTINUE                                         07660034
076700             WHEN SQLWARN0 NOT = SPACES                           07670034
076800             WHEN SQLCODE < ZERO                                  07680034
076900             WHEN SQLCODE > ZERO                                  07690034
077000                 MOVE '3320-GET-VENDOR-INFO     '                 07700034
077100                                   TO DP013-PARAGRAPH             07710034
077200                 MOVE 'SELECT VENDOR NUMBER'                      07720034
077300                                   TO DP013-MESSAGE-TEXT (1)      07730034
077400                 MOVE SQLCA        TO DP013-SQLCA                 07740034
077500                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    07750034
077600                 SET DP013-DB2-ABEND                              07760034
077700                     DP013-XCTL-DISPLAY-RESTART                   07770034
077800                                   TO TRUE                        07780034
077900                 PERFORM DP013-0000-PROCESS-ABEND                 07790034
078000         END-EVALUATE                                             07800034
078100     END-PERFORM.                                                 07810034
078200*                                                                 07820034
078300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07830034
078400         MOVE '3320-GET-VENDOR-INFO     '                         07840034
078500                                   TO DP013-PARAGRAPH             07850034
078600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     07860034
078700                                   TO DP013-MESSAGE-TEXT (1)      07870034
078800         MOVE 'VENDOR NUMBER'      TO DP013-MESSAGE-TEXT (2)      07880034
078900         MOVE SQLCA                TO DP013-SQLCA                 07890034
079000         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    07900034
079100         SET DP013-DB2-ABEND                                      07910034
079200             DP013-XCTL-DISPLAY-RESTART                           07920034
079300                                   TO TRUE                        07930034
079400         PERFORM DP013-0000-PROCESS-ABEND                         07940034
079500     END-IF.                                                      07950034
079600                                                                  07960034
079700*----------------------------------------------------------------*07970034
079800*  CHECK FOR IF TYPE CODE FOR LONG NAME EXISTS ON TENTNME FOR THE 07980034
079900*  VENDOR BEING PROCESSED.                                        07990034
080000*----------------------------------------------------------------*08000034
080100 3330-CHECK-LONGNAME-EXISTENCE.                                   08010034
080200     PERFORM                                                      08020034
080300         WITH TEST AFTER                                          08030034
080400         VARYING PV-RETRY-COUNTER                                 08040034
080500         FROM 1 BY 1                                              08050034
080600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08060034
080700                   OR (SQLCODE = ZERO)                            08070034
080800                   OR (SQLCODE = +100)                            08080034
080900                   OR (SQLCODE = -811))                           08090034
081000                                                                  08100034
081100         EXEC SQL                                                 08110034
081200           SELECT '1'                                             08120034
081300            INTO  :PV-ONE                                         08130034
081400             FROM SYSIBM.SYSDUMMY1 X                              08140034
081500            WHERE EXISTS (SELECT 1                                08150034
081600                            FROM TENTNME                          08160034
081700                           WHERE ENT_ID = :ASC-KEY-ENT-ID         08170034
081800                             AND TYPE_CDE = '05'                  08180034
081900                             AND X.IBMREQD = X.IBMREQD)           08190034
082000         END-EXEC                                                 08200034
082100                                                                  08210034
082200         EVALUATE TRUE                                            08220034
082300             WHEN SQLCODE = ZERO                                  08230034
082400             WHEN SQLCODE = -811                                  08240034
082500                 SET ASC-LONGNAME-FOUND TO TRUE                   08250034
082600             WHEN SQLCODE = +100                                  08260034
082700                 SET ASC-LONGNAME-NOT-FOUND TO TRUE               08270034
082800             WHEN SQLCODE = -904                                  08280034
082900             WHEN SQLCODE = -913                                  08290034
083000                 CONTINUE                                         08300034
083100             WHEN SQLWARN0 NOT = SPACES                           08310034
083200             WHEN SQLCODE < ZERO                                  08320034
083300             WHEN SQLCODE > ZERO                                  08330034
083400                 MOVE '3330-CHECK-LONGNAME-EXISTENCE'             08340034
083500                                   TO DP013-PARAGRAPH             08350034
083600                 MOVE 'CHECK IF LONG NAME ALREADY EXISTS'         08360034
083700                                   TO DP013-MESSAGE-TEXT (1)      08370034
083800                 MOVE SPACE        TO DP013-MESSAGE-TEXT (2)      08380034
083900                 MOVE SQLCA        TO DP013-SQLCA                 08390034
084000                 MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (1)    08400034
084100                 SET DP013-DB2-ABEND                              08410034
084200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           08420034
084300                 PERFORM DP013-0000-PROCESS-ABEND                 08430034
084400         END-EVALUATE                                             08440034
084500     END-PERFORM.                                                 08450034
084600                                                                  08460034
084700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08470034
084800         MOVE '3330-CHECK-LONGNAME-EXISTENCE'                     08480034
084900                                   TO DP013-PARAGRAPH             08490034
085000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO CHECK '     08500034
085100                                   TO DP013-MESSAGE-TEXT (1)      08510034
085200         MOVE 'FOR LONG NAME EXISTENCE '                          08520034
085300                                   TO DP013-MESSAGE-TEXT (2)      08530034
085400         MOVE SPACE                TO DP013-MESSAGE-TEXT (3)      08540034
085500         MOVE SQLCA                TO DP013-SQLCA                 08550034
085600         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    08560034
085700         SET DP013-DB2-ABEND                                      08570034
085800             DP013-XCTL-DISPLAY-RESTART                           08580034
085900                                   TO TRUE                        08590034
086000         PERFORM DP013-0000-PROCESS-ABEND                         08600034
086100     END-IF.                                                      08610034
086200                                                                  08620034
086300*----------------------------------------------------------------*08630031
086400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08640031
086500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08650031
086600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08660031
086700*    DISPLAY THE PANEL TO USER.                                  *08670031
086800*----------------------------------------------------------------*08680031
086900 4000-BUILD-INITIAL-PANEL.                                        08690031
087000                                                                  08700031
087100     INITIALIZE ASC-BLOCK-ENTRIES (1)                             08710031
087200                ASC-BLOCK-ENTRIES (2).                            08720031
087300     MOVE +1 TO ASC-BLK-SUB.                                      08730031
087400     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            08740031
087500     MOVE ZERO TO ASC-ITEM-SUB                                    08750031
087600                  ASC-NUMBER-OF-ITEMS-READ                        08760031
087700                  ASC-NUMBER-OF-SELECTED-ITEMS                    08770031
087800                  ASC-HIGHEST-BLOCK-WRITTEN                       08780031
087900                  ASC-ITEM-AT-TOP-OF-PANEL.                       08790031
088000                                                                  08800031
088100     PERFORM 4010-OPEN-CURSOR.                                    08810031
088200                                                                  08820031
088300     PERFORM 4300-READ-ITEMS-FROM-DB.                             08830031
088400                                                                  08840031
088500     PERFORM 4020-CLOSE-CURSOR.                                   08850031
088600                                                                  08860031
088700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          08870031
088800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    08880031
088900         SET DP020-MSG-FATAL   TO  TRUE                           08890031
089000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               08900031
089100     ELSE                                                         08910031
089200         MOVE ASC-HIGHEST-BLOCK-WRITTEN TO PV-TOP-ITEM            08920031
089300         SET DP030-SET-CURSOR-TRAILER TO TRUE                     08930031
089400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08940031
089500     END-IF.                                                      08950031
089600                                                                  08960031
089700 4010-OPEN-CURSOR.                                                08970031
089800                                                                  08980031
089900     PERFORM                                                      08990031
090000         WITH TEST AFTER                                          09000031
090100         VARYING PV-RETRY-COUNTER                                 09010031
090200         FROM 1 BY 1                                              09020031
090300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09030031
090400                   OR (SQLCODE = ZERO))                           09040031
090500                                                                  09050031
090600         EXEC SQL                                                 09060031
090700             OPEN CAPABILITY-CSR                                  09070031
090800         END-EXEC                                                 09080031
090900                                                                  09090031
091000         EVALUATE TRUE                                            09100031
091100             WHEN SQLCODE = ZERO                                  09110031
091200             WHEN SQLCODE = -904                                  09120031
091300             WHEN SQLCODE = -913                                  09130031
091400                 CONTINUE                                         09140031
091500                                                                  09150031
091600             WHEN SQLWARN0 NOT = SPACES                           09160031
091700             WHEN SQLCODE < ZERO                                  09170031
091800             WHEN SQLCODE > ZERO                                  09180031
091900                 MOVE '4010-OPEN-CURSOR'                          09190031
092000                                   TO DP013-PARAGRAPH             09200031
092100                 MOVE 'OPEN VENDOR CAPABILITY CURSOR - '          09210031
092200                                   TO DP013-MESSAGE-TEXT (1)      09220031
092300                 MOVE SQLCA        TO DP013-SQLCA                 09230031
092400                 MOVE 'VNT_VND_CPBL_CDE'                          09240031
092500                                   TO DP013-DB2-TABLE-NAME (1)    09250031
092600                 SET DP013-DB2-ABEND                              09260031
092700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09270031
092800                 PERFORM DP013-0000-PROCESS-ABEND                 09280031
092900         END-EVALUATE                                             09290031
093000     END-PERFORM.                                                 09300031
093100                                                                  09310031
093200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09320031
093300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             09330031
093400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09340031
093500                                   TO DP013-MESSAGE-TEXT (1)      09350031
093600         MOVE SQLCA                TO DP013-SQLCA                 09360031
093700         MOVE 'VNT_VND_CPBL_CDE'   TO DP013-DB2-TABLE-NAME (1)    09370031
093800         SET DP013-DB2-ABEND                                      09380031
093900             DP013-XCTL-DISPLAY-RESTART                           09390031
094000                                   TO TRUE                        09400031
094100         PERFORM DP013-0000-PROCESS-ABEND                         09410031
094200     END-IF.                                                      09420031
094300                                                                  09430031
094400 4020-CLOSE-CURSOR.                                               09440031
094500                                                                  09450031
094600     EXEC SQL                                                     09460031
094700         CLOSE CAPABILITY-CSR                                     09470031
094800     END-EXEC                                                     09480031
094900                                                                  09490031
095000     EVALUATE TRUE                                                09500031
095100         WHEN SQLCODE = ZERO                                      09510031
095200             CONTINUE                                             09520031
095300                                                                  09530031
095400         WHEN SQLWARN0 NOT = SPACES                               09540031
095500         WHEN SQLCODE < ZERO                                      09550031
095600         WHEN SQLCODE > ZERO                                      09560031
095700             MOVE '4020-CLOSE-CURSOR'                             09570031
095800                               TO DP013-PARAGRAPH                 09580031
095900             MOVE 'CLOSE VENDOR DEPARTMENT CURSOR '               09590031
096000                               TO DP013-MESSAGE-TEXT (1)          09600031
096100             MOVE SQLCA        TO DP013-SQLCA                     09610031
096200             MOVE 'VNT_VND_CPBL_CDE'   TO DP013-DB2-TABLE-NAME (1)09620031
096300             SET DP013-DB2-ABEND                                  09630031
096400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09640031
096500             PERFORM DP013-0000-PROCESS-ABEND                     09650031
096600     END-EVALUATE.                                                09660031
096700                                                                  09670031
096800*---------------------------------------------------------------* 09680031
096900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE   * 09690031
097000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,    * 09700031
097100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND * 09710031
097200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE    * 09720031
097300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                  * 09730031
097400*---------------------------------------------------------------* 09740031
097500                                                                  09750031
097600 4300-READ-ITEMS-FROM-DB.                                         09760031
097700                                                                  09770031
097800     PERFORM                                                      09780031
097900         VARYING PV-READ-COUNT                                    09790031
098000         FROM 1 BY 1                                              09800031
098100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    09810031
098200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         09820031
098300                                                                  09830031
098400         PERFORM 4310-FETCH                                       09840031
098500                                                                  09850031
098600         IF  ASC-ITEMS-LEFT-ON-DB                                 09860031
098700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                09870031
098800                 ADD +1            TO ASC-ITEM-SUB                09880031
098900             ELSE                                                 09890031
099000                 ADD +1            TO ASC-BLK-SUB                 09900031
099100                 MOVE +1           TO ASC-ITEM-SUB                09910031
099200                                                                  09920031
099300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         09930031
099400                     MOVE +1       TO ASC-BLK-SUB                 09940031
099500                     SET ASC-BLOCK-MODIFIED (1)                   09950031
099600                                   TO TRUE                        09960031
099700                     PERFORM 5100-WRITE-TEMP-STORAGE              09970031
099800                     MOVE ASC-BLOCK-ENTRIES                       09980031
099900                               (PC-MAX-BLOCKS-IN-ARRAY)           09990031
100000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 10000031
100100                     ADD +1        TO ASC-BLK-SUB                 10010031
100200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   10020031
100300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      10030031
100400                                   TO TRUE                        10040031
100500                 END-IF                                           10050031
100600             END-IF                                               10060031
100700             ADD +1                   TO ASC-NUMBER-OF-ITEMS-READ 10070031
100800             MOVE ASC-NUMBER-OF-ITEMS-READ                        10080031
100900                                      TO ASC-LIST-ITEM-NUMBER     10090031
101000                                        (ASC-BLK-SUB ASC-ITEM-SUB)10100031
101100             MOVE VNT00001-EFF-BEG-DTE(6:2)                       10110031
101200                                      TO PV-WORK-MM               10120031
101300             MOVE VNT00001-EFF-BEG-DTE(9:2)                       10130031
101400                                      TO PV-WORK-DD               10140031
101500             MOVE VNT00001-EFF-BEG-DTE(1:4)                       10150031
101600                                      TO PV-WORK-YYYY             10160031
101700             MOVE PV-WORK-DATE        TO ASC-EFF-DATE             10170031
101800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10180031
101900             MOVE VNT00001-EFF-END-DTE(6:2)                       10190031
102000                                      TO PV-WORK-MM               10200031
102100             MOVE VNT00001-EFF-END-DTE(9:2)                       10210031
102200                                      TO PV-WORK-DD               10220031
102300             MOVE VNT00001-EFF-END-DTE(1:4)                       10230031
102400                                      TO PV-WORK-YYYY             10240031
102500             MOVE PV-WORK-DATE        TO ASC-EXP-DATE             10250031
102600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10260031
102700                                         ASC-MAX-EXP-DATE         10270031
102800             MOVE VNT00001-LAST-UPD-TMST(6:2)                     10280031
102900                                      TO PV-WORK-MM               10290031
103000             MOVE VNT00001-LAST-UPD-TMST(9:2)                     10300031
103100                                      TO PV-WORK-DD               10310031
103200             MOVE VNT00001-LAST-UPD-TMST(1:4)                     10320031
103300                                      TO PV-WORK-YYYY             10330031
103400             MOVE PV-WORK-DATE        TO ASC-LAST-UPD-DATE        10340031
103500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10350031
103600             MOVE VNT00001-LAST-UPD-BY-USR-ID                     10360031
103700                                      TO ASC-LAST-UPD-ID          10370031
103800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10380031
103900             MOVE VNT00001-CRE-DTE(6:2)                           10390031
104000                                      TO PV-WORK-MM               10400031
104100             MOVE VNT00001-CRE-DTE(9:2)                           10410031
104200                                      TO PV-WORK-DD               10420031
104300             MOVE VNT00001-CRE-DTE(1:4)                           10430031
104400                                      TO PV-WORK-YYYY             10440031
104500             MOVE PV-WORK-DATE        TO ASC-DATE-ADDED           10450031
104600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   10460031
104700         END-IF                                                   10470031
104800     END-PERFORM.                                                 10480031
104900                                                                  10490031
105000     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           10500031
105100         MOVE +1 TO ASC-BLK-SUB                                   10510031
105200                                                                  10520031
105300         PERFORM 5100-WRITE-TEMP-STORAGE                          10530031
105400                                                                  10540031
105500         ADD  +1 TO ASC-BLK-SUB                                   10550031
105600                                                                  10560031
105700         PERFORM 5100-WRITE-TEMP-STORAGE                          10570031
105800                                                                  10580031
105900         MOVE 1 TO ASC-BLK-SUB                                    10590031
106000*        MOVE ASC-HIGHEST-BLOCK-WRITTEN TO ASC-BLK-SUB            10600031
106100                   PV-BLOCK-NUMBER                                10610031
106200                                                                  10620031
106300         PERFORM 4410-READ-TEMP-STORAGE                           10630031
106400                                                                  10640031
106500         IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1              10650031
106600             MOVE 2 TO ASC-BLK-SUB                                10660031
106700                       PV-BLOCK-NUMBER                            10670031
106800                                                                  10680031
106900             PERFORM 4410-READ-TEMP-STORAGE                       10690031
107000         END-IF                                                   10700031
107100     END-IF.                                                      10710031
107200*----------------------------------------------------------------*10720031
107300*----------------------------------------------------------------*10730031
107400                                                                  10740031
107500 4310-FETCH.                                                      10750031
107600                                                                  10760031
107700     EXEC SQL                                                     10770031
107800             FETCH CAPABILITY-CSR                                 10780031
107900              INTO :VNT00001-EFF-BEG-DTE                          10790031
108000                  ,:VNT00001-EFF-END-DTE                          10800031
108100                  ,:VNT00001-CRE-DTE                              10810031
108200                  ,:VNT00001-LAST-UPD-TMST                        10820031
108300                  ,:VNT00001-LAST-UPD-BY-USR-ID                   10830031
108400     END-EXEC                                                     10840031
108500                                                                  10850031
108600     EVALUATE TRUE                                                10860031
108700         WHEN SQLCODE = ZERO                                      10870031
108800         WHEN SQLCODE = +100                                      10880031
108900              CONTINUE                                            10890031
109000                                                                  10900031
109100         WHEN SQLWARN0 NOT = SPACE                                10910031
109200         WHEN SQLCODE NOT = ZERO                                  10920031
109300              MOVE '4310-FETCH-CURSOR'                            10930031
109400                               TO DP013-PARAGRAPH                 10940031
109500              MOVE 'FETCH VENDOR DEPARTMENT CURSOR'               10950031
109600                               TO DP013-MESSAGE-TEXT (1)          10960031
109700              MOVE SQLCA       TO DP013-SQLCA                     10970031
109800              SET DP013-DB2-ABEND                                 10980031
109900                               TO TRUE                            10990031
110000              PERFORM DP013-0000-PROCESS-ABEND                    11000031
110100     END-EVALUATE.                                                11010031
110200                                                                  11020031
110300     IF SQLCODE = +100                                            11030031
110400         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE.                     11040031
110500                                                                  11050031
110600*----------------------------------------------------------------*11060031
110700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *11070031
110800*----------------------------------------------------------------*11080031
110900 4400-MOVE-COMMAREA-TO-SCREEN.                                    11090031
111000                                                                  11100031
111100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             11110031
111200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          11120031
111300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          11130031
111400             MOVE +1    TO ASC-BLK-SUB                            11140031
111500             PERFORM 5100-WRITE-TEMP-STORAGE                      11150031
111600             ADD +1     TO ASC-BLK-SUB                            11160031
111700             PERFORM 5100-WRITE-TEMP-STORAGE                      11170031
111800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             11180031
111900                 GIVING PV-BLOCK-NUMBER                           11190031
112000                 REMAINDER PV-REMAINDER                           11200031
112100             IF  PV-REMAINDER > ZERO                              11210031
112200                 ADD +1 TO PV-BLOCK-NUMBER                        11220031
112300             END-IF                                               11230031
112400             MOVE +1    TO ASC-BLK-SUB                            11240031
112500             PERFORM 4410-READ-TEMP-STORAGE                       11250031
112600             ADD +1     TO ASC-BLK-SUB                            11260031
112700                           PV-BLOCK-NUMBER                        11270031
112800             PERFORM 4410-READ-TEMP-STORAGE                       11280031
112900     END-IF.                                                      11290031
113000     MOVE +1            TO ASC-BLK-SUB.                           11300031
113100     COMPUTE ASC-ITEM-SUB =                                       11310031
113200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              11320031
113300         + PC-ITEMS-PER-PANEL).                                   11330031
113400                                                                  11340031
113500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11350031
113600         ADD +1         TO ASC-BLK-SUB                            11360031
113700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11370031
113800     END-IF.                                                      11380031
113900                                                                  11390031
114000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           11400031
114100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                11410031
114200                                                                  11420031
114300     COMPUTE ASC-ITEMS-DISPLAYED =                                11430031
114400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          11440031
114500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   11450031
114600     MOVE ASC-KEY-VENDOR-NAME      TO AVENDO.                     11460031
114700     MOVE ASC-KEY-VENDOR-ID        TO AVNDIDO.                    11470031
114800     MOVE ASC-DISPLAY-ENT-ID       TO AENTIDO.                    11480031
114900     MOVE ASC-KEY-CAPBLTY-NAME     TO ACPBLTYO.                   11490031
115000     MOVE ASC-EFF-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AEFFDTO.     11500031
115100     MOVE ASC-EXP-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AEXPDTO.     11510031
115200     MOVE ASC-DATE-ADDED (ASC-BLK-SUB ASC-ITEM-SUB) TO AADDDTO.   11520031
115300     MOVE ASC-LAST-UPD-ID (ASC-BLK-SUB ASC-ITEM-SUB) TO AUPDBYO.  11530031
115400     MOVE ASC-LAST-UPD-DATE (ASC-BLK-SUB ASC-ITEM-SUB) TO AUPDDTO.11540031
115500     IF  DP020-MSG-NUMBER-X = SPACE                               11550031
115600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  11560031
115700*            --- MORE ITEMS TO DISPLAY ----                       11570031
115800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            11580031
115900             SET DP020-MSG-INFORMATIONAL TO TRUE                  11590031
116000         END-IF                                                   11600031
116100     END-IF.                                                      11610031
116200                                                                  11620031
116300*----------------------------------------------------------------*11630031
116400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *11640031
116500*----------------------------------------------------------------*11650031
116600 4410-READ-TEMP-STORAGE.                                          11660031
116700                                                                  11670031
116800     EXEC CICS                                                    11680031
116900         READQ TS                                                 11690031
117000             QUEUE (ASC-LIST-QUEUE-NAME)                          11700031
117100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               11710031
117200             ITEM  (PV-BLOCK-NUMBER)                              11720031
117300             RESP  (PV-CICS-RESP)                                 11730031
117400     END-EXEC.                                                    11740031
117500                                                                  11750031
117600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       11760031
117700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     11770031
117800         CONTINUE                                                 11780031
117900     ELSE                                                         11790031
118000         SET DP013-CICS-ABEND     TO TRUE                         11800031
118100         SET DP013-NO-ROLLBACK    TO TRUE                         11810031
118200         MOVE '4410-READ-TEMP-STORAGE'                            11820031
118300                                  TO DP013-PARAGRAPH              11830031
118400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      11840031
118500                                  TO DP013-MESSAGE-TEXT(1)        11850031
118600         PERFORM DP013-0000-PROCESS-ABEND                         11860031
118700     END-IF.                                                      11870031
118800                                                                  11880031
118900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             11890031
119000                                                                  11900031
119100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         11910031
119200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               11920031
119300     END-IF.                                                      11930031
119400                                                                  11940031
119500                                                                  11950031
119600*----------------------------------------------------------------*11960031
119700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *11970031
119800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *11980031
119900*----------------------------------------------------------------*11990031
120000 5100-WRITE-TEMP-STORAGE.                                         12000031
120100                                                                  12010031
120200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     12020031
120300                                   TO PV-LIST-ITEM-NUMBER.        12030031
120400     COMPUTE PV-BLOCK-NUMBER =                                    12040031
120500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12050031
120600                                                                  12060031
120700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             12070031
120800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             12080031
120900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      12090031
121000             PERFORM 5105-REWRITE-ASC-LISTQ                       12100031
121100         END-IF                                                   12110031
121200     ELSE                                                         12120031
121300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       12130031
121400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            12140031
121500         PERFORM 5110-WRITE-ASC-LISTQ                             12150031
121600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   12160031
121700     END-IF.                                                      12170031
121800                                                                  12180031
121900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             12190031
122000                                                                  12200031
122100***************************************************************** 12210031
122200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    * 12220031
122300** SPECIFIC COMMAREA.                                           * 12230031
122400***************************************************************** 12240031
122500 5105-REWRITE-ASC-LISTQ.                                          12250031
122600                                                                  12260031
122700     EXEC CICS                                                    12270031
122800         WRITEQ TS                                                12280031
122900             QUEUE (ASC-LIST-QUEUE-NAME)                          12290031
123000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12300031
123100             ITEM  (PV-BLOCK-NUMBER)                              12310031
123200             REWRITE                                              12320031
123300             RESP  (PV-CICS-RESP)                                 12330031
123400     END-EXEC.                                                    12340031
123500                                                                  12350031
123600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           12360031
123700         CONTINUE                                                 12370031
123800     ELSE                                                         12380031
123900         SET DP013-CICS-ABEND            TO TRUE                  12390031
124000         SET DP013-NO-ROLLBACK           TO TRUE                  12400031
124100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       12410031
124200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     12420031
124300                                         TO DP013-MESSAGE-TEXT(1) 12430031
124400         PERFORM DP013-0000-PROCESS-ABEND                         12440031
124500     END-IF.                                                      12450031
124600                                                                  12460031
124700***************************************************************** 12470031
124800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      * 12480031
124900** SPECIFIC COMMAREA.                                           * 12490031
125000***************************************************************** 12500031
125100 5110-WRITE-ASC-LISTQ.                                            12510031
125200                                                                  12520031
125300     EXEC CICS                                                    12530031
125400         WRITEQ TS                                                12540031
125500             QUEUE (ASC-LIST-QUEUE-NAME)                          12550031
125600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12560031
125700             ITEM  (PV-BLOCK-NUMBER)                              12570031
125800             RESP  (PV-CICS-RESP)                                 12580031
125900     END-EXEC.                                                    12590031
126000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      12600031
126100         SET DP013-CICS-ABEND      TO TRUE                        12610031
126200         SET DP013-NO-ROLLBACK     TO TRUE                        12620031
126300         MOVE '5110-WRITE-ASC-LISTQ'                              12630031
126400                                   TO DP013-PARAGRAPH             12640031
126500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           12650031
126600                                   TO DP013-MESSAGE-TEXT(1)       12660031
126700         PERFORM DP013-0000-PROCESS-ABEND                         12670031
126800     END-IF.                                                      12680031
126900                                                                  12690031
127000******************************************************************12700031
127100* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *12710031
127200******************************************************************12720031
127300 6200-DEL-LIST-QUEUE.                                             12730031
127400                                                                  12740031
127500     EXEC CICS                                                    12750031
127600         DELETEQ TS                                               12760031
127700             QUEUE (ASC-LIST-QUEUE-NAME)                          12770031
127800             RESP  (PV-CICS-RESP)                                 12780031
127900     END-EXEC.                                                    12790031
128000                                                                  12800031
128100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      12810031
128200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         12820031
128300         CONTINUE                                                 12830031
128400     ELSE                                                         12840031
128500        SET DP013-CICS-ABEND       TO TRUE                        12850031
128600        SET DP013-NO-ROLLBACK      TO TRUE                        12860031
128700        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             12870031
128800        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               12880031
128900                                   TO DP013-MESSAGE-TEXT (1)      12890031
129000        PERFORM DP013-0000-PROCESS-ABEND                          12900031
129100     END-IF.                                                      12910031
129200                                                                  12920031
129300******************************************************************12930031
129400* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *12940031
129500******************************************************************12950031
129600 9100-READ-SEL-QUEUE.                                             12960031
129700                                                                  12970031
129800     EXEC CICS                                                    12980031
129900         READQ TS                                                 12990031
130000             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        13000031
130100             INTO  (VN019-CAPABILITY-REC)                         13010031
130200             ITEM  (ASC-SEL-ITEM)                                 13020031
130300             RESP  (PV-CICS-RESP)                                 13030031
130400     END-EXEC.                                                    13040031
130500                                                                  13050031
130600     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        13060031
130700         CONTINUE                                                 13070031
130800     ELSE                                                         13080031
130900         SET DP013-LOGIC-ABEND                                    13090031
131000             DP013-NO-ROLLBACK     TO TRUE                        13100031
131100         MOVE '9100-READ-SEL-QUEUE'                               13110031
131200                                   TO DP013-PARAGRAPH             13120031
131300         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    13130031
131400                                   TO DP013-MESSAGE-TEXT (1)      13140031
131500         PERFORM DP013-0000-PROCESS-ABEND                         13150031
131600     END-IF.                                                      13160031
131700                                                                  13170031
131800******************************************************************13180031
131900* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *13190031
132000******************************************************************13200031
132100 9200-REWRITE-LIST-QUEUE.                                         13210031
132200                                                                  13220031
132300     EXEC CICS                                                    13230031
132400          WRITEQ TS                                               13240031
132500              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     13250031
132600              FROM    (VN019-CAPABILITY-REC)                      13260031
132700              ITEM    (ASC-SEL-ITEM)                              13270031
132800              RESP    (PV-CICS-RESP)                              13280031
132900              REWRITE                                             13290031
133000     END-EXEC.                                                    13300031
133100                                                                  13310031
133200     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    13320031
133300         SET DP013-CICS-ABEND                                     13330031
133400             DP013-NO-ROLLBACK     TO TRUE                        13340031
133500         MOVE '9200-REWRITE-LIST-QUEUE'                           13350031
133600                                   TO DP013-PARAGRAPH             13360031
133700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   13370031
133800                                   TO DP013-MESSAGE-TEXT (1)      13380031
133900         PERFORM DP013-0000-PROCESS-ABEND                         13390031
134000     END-IF.                                                      13400031
134100                                                                  13410031
134200*---------------------------------------------------------------- 13420031
134300*    ABEND PROCESSOR MODULE                                       13430031
134400*---------------------------------------------------------------- 13440031
134500     COPY DPPD013.                                                13450031
134600*---------------------------------------------------------------- 13460031
