000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000500 PROGRAM-ID.             SUKUT091.                                00050001
000600 AUTHOR.                 LYNN MCADAMS.                            00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            SEPTEMBER, 2004.                         00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001200*----------------------------------------------------------------*00120001
001300* THIS IS THE SUMMARY SML EXTRACT FILE FOR CARTONS CREATED       *00130001
001400* AND MANIFESTED TO A TRAILER - PO-RCVR                          *00140001
001500*                                                                *00150001
001600* THE LAYOUT FOR THE INPUT FILE IS SURD045.                      *00160001
001700* THE LAYOUT FOR THE OUTPUT FILE IS SURD046.                     *00170001
001800*----------------------------------------------------------------*00180001
002100 ENVIRONMENT DIVISION.                                            00210001
002300 INPUT-OUTPUT SECTION.                                            00230001
002400                                                                  00240001
002500 FILE-CONTROL.                                                    00250001
002600                                                                  00260001
002700     SELECT INPUT-FILE ASSIGN TO INP01.                           00270001
002800                                                                  00280001
002900     SELECT EXTRACT-FILE ASSIGN TO OUT01.                         00290001
003000                                                                  00300001
003100***************************************************************** 00310001
003200 DATA DIVISION.                                                   00320001
003400 FILE SECTION.                                                    00340001
003600*                                                                 00360001
003700 FD  INPUT-FILE                                                   00370001
003800     RECORDING MODE IS F                                          00380001
003900     LABEL RECORDS ARE STANDARD                                   00390001
004000     BLOCK CONTAINS 0 RECORDS.                                    00400001
004100 01  INPUT-RECORD                PIC X(200).                      00410001
004200                                                                  00420001
004300 FD  EXTRACT-FILE                                                 00430001
004400     RECORDING MODE IS F                                          00440001
004500     LABEL RECORDS ARE STANDARD                                   00450001
004600     BLOCK CONTAINS 0 RECORDS.                                    00460001
004700 01  EXTRACT-RECORD              PIC X(150).                      00470002
004900*                                                                 00490001
005000***************************************************************** 00500001
005100 WORKING-STORAGE SECTION.                                         00510001
005200                                                                  00520001
005300 01  PS-PROGRAM-SWITCHES.                                         00530001
005400     05  PS-FIRST-TIME-SW                PIC X(01) VALUE 'N'.     00540028
005500         88  PS-FIRST-TIME-YES                     VALUE 'Y'.     00550028
005600         88  PS-FIRST-TIME-NO                      VALUE 'N'.     00560028
005700     05  PS-END-OF-INPUT-FILE-SW        PIC X(01)  VALUE 'N'.     00570028
005800         88  PS-END-OF-INPUT-FILE                  VALUE 'Y'.     00580028
005900         88  PS-NOT-END-OF-INPUT-FILE              VALUE 'N'.     00590028
006000     05  PS-CURRENT-LINE-HAS-WO-SW      PIC X(01)  VALUE 'N'.     00600001
006100         88  PS-CURRENT-LINE-HAS-WO-YES            VALUE 'Y'.     00610001
006200         88  PS-CURRENT-LINE-HAS-WO-NO             VALUE 'N'.     00620001
006300     05  PS-FIRST-TIME-CURR-LINE-SW     PIC X(01)  VALUE 'N'.     00630001
006400         88  PS-FIRST-TIME-CURRENT-LINE-YES        VALUE 'Y'.     00640001
006500         88  PS-FIRST-TIME-CURRENT-LINE-NO         VALUE 'N'.     00650001
006600                                                                  00660001
006700 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00670001
006800                                                 COMP SYNC.       00680001
006900     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     00690001
007000                                                                  00700001
007100 01  PV-PROGRAM-VARIABLES.                                        00710001
007200     05  PV-PREVIOUS-PO               PIC S9(09)  VALUE ZEROES.   00720001
007300     05  PV-PREVIOUS-RCVR             PIC S9(09)  VALUE ZEROES.   00730001
007400     05  PV-PREVIOUS-LINE             PIC S9(09)  VALUE ZEROES.   00740001
007500     05  PV-PREVIOUS-CRTN-ID          PIC S9(18)  VALUE ZEROES.   00750002
007600                                                                  00760001
007700                                                                  00770001
007800     05  PV-TOTAL-LINES               PIC S9(09) VALUE ZERO       00780002
007900                                                  COMP SYNC.      00790002
008000     05  PV-VERIFIED-LINES            PIC S9(09) VALUE ZERO       00800002
008100                                                  COMP SYNC.      00810002
008200     05  PV-MFST-CRTN-CNT             PIC S9(09) VALUE ZERO       00820002
008300                                                  COMP SYNC.      00830002
008400     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       00840001
008500                                                  COMP SYNC.      00850001
008600     05  PV-WRITE-EXTR-COUNT          PIC S9(09) VALUE ZERO       00860001
008700                                                  COMP SYNC.      00870001
008800                                                                  00880001
008900     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            00890001
009000     05  PV-DISPLAY-WRITE-CNT         PIC ZZZ,ZZZ,ZZ9.            00900001
009100                                                                  00910001
009200     05  PV-DISPLAY-TRN-NBR           PIC 999999999-.             00920001
009300     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC 999999999-.             00930001
009400                                                                  00940001
009500     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACE.     00950001
009600     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACE.     00960001
009700     05  PV-DB2-TABLE-NAME1           PIC X(08)  VALUE SPACE.     00970001
009800     05  PV-DB2-TABLE-NAME2           PIC X(08)  VALUE SPACE.     00980001
009900                                                                  00990001
010000 01  DK-DB-KEYS.                                                  01000001
010100     05  DK-TRN-NBR                  PIC  S9(09) COMP.            01010001
010200     05  DK-RCVR-SEQ-NBR             PIC  S9(09) COMP.            01020001
010300                                                                  01030001
010400 01 PC-PROGRAM-CONSTANTS.                                         01040001
010500     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT091'. 01050001
010600     05 PC-DEFAULT-TMST              PIC X(26)                    01060001
010700             VALUE '9999-09-09-09.09.09.999999'.                  01070001
010800     05 PC-01                       PIC  X(01)  VALUE '1'.        01080001
010900                                                                  01090001
011000 01  PV-ABEND-FIELDS.                                             01100001
011100     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01110001
011200                                                 COMP SYNC.       01120001
011300     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT091'.01130001
011400     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01140001
011500     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01150001
011600     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01160001
011700     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01170001
011800     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01180001
011900     05  PV-SQL-RETURN-CD             PIC  999-.                  01190001
012000     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01200001
012100     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01210001
012200     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01220001
012300     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01230001
012400                                                                  01240001
012500******************************************************************01250001
012600*  USED FOR DB2 ERROR MESSAGE BUILDING                            01260001
012700******************************************************************01270001
012800     COPY DPWS004.                                                01280001
012900                                                                  01290001
013000*----------------------------------------------------------------*01300001
013100*    ABEND PROCESSING COPYBOOK.                                  *01310001
013200*----------------------------------------------------------------*01320001
013400     COPY DPWS013.                                                01340001
013410                                                                  01341064
013500******************************************************************01350001
013600*   DB2 SQL COMMUNICATION AREA                                    01360001
013700******************************************************************01370001
013800     EXEC SQL                                                     01380001
013900          INCLUDE SQLCA                                           01390001
014000     END-EXEC.                                                    01400001
014100                                                                  01410001
014500******************************************************************01450001
014600*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   01460001
014700*   RC-PACK SLIP TABLE                                            01470002
014800******************************************************************01480001
014900     EXEC SQL                                                     01490001
015000          INCLUDE TPKSLIP                                         01500002
015100     END-EXEC.                                                    01510001
015200                                                                  01520001
015300******************************************************************01530002
015400*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   01540002
015500*   RC-RECEIVER TABLE                                             01550002
015600******************************************************************01560002
015700     EXEC SQL                                                     01570002
015800          INCLUDE TRECEIV                                         01580002
015900     END-EXEC.                                                    01590002
016000                                                                  01600002
016100******************************************************************01610002
016200*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   01620002
016300*   RC-RECEIPT ITEM TABLE                                         01630002
016400******************************************************************01640002
016500     EXEC SQL                                                     01650002
016600          INCLUDE TRECITM                                         01660002
016700     END-EXEC.                                                    01670002
016800                                                                  01680002
016900******************************************************************01690002
017000*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   01700002
017100*   SU-OUTBOUND /UPC ASSOCIATION TABLE                            01710002
017200*   SU_OTBND_UPC                                                  01720002
017300******************************************************************01730002
017400     EXEC SQL                                                     01740002
017500          INCLUDE SUT00028                                        01750002
017600     END-EXEC.                                                    01760002
017700                                                                  01770001
017710******************************************************************01771065
017720*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   01772043
017730*   SU-OUTBOUND CARTON TABLE                                      01773043
017740*   SU_OTBND_CART                                                 01774043
017750******************************************************************01775043
017760     EXEC SQL                                                     01776043
017770          INCLUDE SUT00024                                        01777043
017780     END-EXEC.                                                    01778043
017790                                                                  01779043
017800***********************************************************       01780001
017900*  RECORD LAYOUTS                                                 01790002
018000***********************************************************       01800001
018100*INPUT FILE LAYOUT                                                01810001
018200     COPY SURD045.                                                01820002
018210                                                                  01821045
018300*OUTPUT FILE LAYOUT                                               01830001
018400     COPY SURD046.                                                01840002
018500                                                                  01850001
018800***********************************************************       01880001
018900 PROCEDURE DIVISION.                                              01890001
019000***********************************************************       01900001
019100     DISPLAY '***BEGINNING SUKUT091***'.                          01910001
019200                                                                  01920001
019300     PERFORM 1000-INITIALIZE.                                     01930001
019400                                                                  01940001
019500     PERFORM 2000-PROCESS-EXTRACTS                                01950001
019600         UNTIL PS-END-OF-INPUT-FILE.                              01960001
019700                                                                  01970001
019710     PERFORM 8000-WRITE-EXTRACT.                                  01971064
019800     PERFORM 9000-CLOSE-FILES.                                    01980001
019900                                                                  01990001
020000     GOBACK.                                                      02000001
020200                                                                  02020001
020300******************************************************************02030001
020400*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        02040001
020600******************************************************************02060001
020610 1000-INITIALIZE.                                                 02061045
020700     OPEN INPUT  INPUT-FILE                                       02070001
020800          OUTPUT EXTRACT-FILE.                                    02080001
020900                                                                  02090001
021000     PERFORM 7000-READ-INPUT-FILE.                                02100001
021200                                                                  02120001
021210     PERFORM 2100-XPTD-CRTN-CNT.                                  02121034
021220     PERFORM 2200-RCVR-STATUS.                                    02122034
021230     PERFORM 2400-MFST-CRTN-CNT.                                  02123034
021240                                                                  02124034
021260     INITIALIZE SU046-EXTRACT-RECORD                              02126034
021270     MOVE SU045-ORGN-LOC-NBR     TO SU046-ORGN-LOC-NBR            02127034
021280     MOVE SU045-TRN-NBR          TO SU046-TRN-NBR                 02128034
021290     MOVE SU045-RCVR-SEQ-NBR     TO SU046-RCVR-SEQ-NBR            02129034
021291     MOVE SU045-CART-SRC-CDE     TO SU046-CARTON-SOURCE           02129134
021292     MOVE SU045-VENDOR-ID        TO SU046-VENDOR-ID               02129234
021293     MOVE SU045-VENDOR-NAME      TO SU046-VENDOR-NAME             02129334
021294     MOVE SU045-NEW-STR-IND      TO SU046-NEW-STR-IND             02129453
021295     MOVE SU045-SEASET-NAME      TO SU046-SEASET-NAME             02129551
021296     MOVE SU045-LNE-LOC-CDE      TO SU046-LNE-LOC-CDE             02129651
021297     MOVE SU045-PRC-AREA-ID      TO SU046-PRC-AREA-ID             02129751
021298     MOVE SU045-TYP-CDE          TO SU046-TYP-CDE                 02129862
021299     MOVE SU045-VERIFY-DATE      TO SU046-VERIFY-DATE             02129962
021300     MOVE SU045-VERIFY-TIME      TO SU046-VERIFY-TIME             02130062
021301     MOVE SU045-TRBL-IND         TO SU046-TRBL-IND                02130162
021302     MOVE PKSLIP-EXPTED-PKG-QTY  TO SU046-EXPTD-CRTNS             02130262
021303     MOVE PV-MFST-CRTN-CNT       TO SU046-NBR-CRTNS-MFSTD         02130362
021304     ADD 1                       TO SU046-NBR-CRTNS-NO-TRLR       02130462
021306                                                                  02130651
021307     MOVE RECEIV-STATUS-CDE      TO SU046-VRFD-STATUS.            02130751
021308     IF  RECEIV-STATUS-CDE = 'VE'                                 02130851
021309         SET SU046-ALL-LINES            TO TRUE                   02130951
021310     ELSE                                                         02131051
021311         PERFORM 2300-VRFD-LINE-COUNT                             02131151
021312     END-IF.                                                      02131251
021313                                                                  02131351
021314     IF  SU046-SOME-LINES  OR                                     02131451
021315         SU046-ALL-LINES                                          02131551
021316           ADD 1           TO SU046-VRFD-CRTN-CNT                 02131651
021317     END-IF.                                                      02131751
021318                                                                  02131851
021319     MOVE SU045-SHIPT-UNT-ID    TO PV-PREVIOUS-CRTN-ID.           02131951
021320     MOVE SU045-TRN-NBR         TO PV-PREVIOUS-PO.                02132051
021321     MOVE SU045-RCVR-SEQ-NBR    TO PV-PREVIOUS-RCVR.              02132151
021322                                                                  02132251
021330                                                                  02133034
021400***************************************************************** 02140001
021500 2000-PROCESS-EXTRACTS.                                           02150001
021600***************************************************************** 02160001
021700     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       02170001
021800                                                                  02180001
021900        IF SU045-TRN-NBR        = PV-PREVIOUS-PO   AND            02190002
022000           SU045-RCVR-SEQ-NBR   = PV-PREVIOUS-RCVR                02200002
022100           IF SU045-LNE-LOC-CDE = SU046-LNE-LOC-CDE               02210002
022200              CONTINUE                                            02220002
022300           ELSE                                                   02230001
022400              SET SU046-LNE-LOC-MULT TO TRUE                      02240002
022500           END-IF                                                 02250002
022600                                                                  02260002
022700           IF SU045-PRC-AREA-ID    = SU046-PRC-AREA-ID            02270002
022800              CONTINUE                                            02280002
022900           ELSE                                                   02290002
023000              SET SU046-PRC-AREA-MULT   TO TRUE                   02300002
023100           END-IF                                                 02310002
023200                                                                  02320002
023210           IF SU045-TYP-CDE     = SU046-TYP-CDE                   02321060
023220              CONTINUE                                            02322060
023230           ELSE                                                   02323060
023240              SET SU046-TYP-CDE-MULTI  TO TRUE                    02324061
023250           END-IF                                                 02325060
023260                                                                  02326060
023270           IF SU045-CART-SRC-CDE = SU046-CARTON-SOURCE            02327063
023280              CONTINUE                                            02328063
023290           ELSE                                                   02329063
023291              MOVE 'MLT'   TO SU046-CARTON-SOURCE                 02329163
023292           END-IF                                                 02329263
023293                                                                  02329363
023300           IF SU046-TRBL-NO                                       02330002
023400              IF SU045-TRBL-YES                                   02340002
023500                 SET SU046-TRBL-YES TO TRUE                       02350002
023600              END-IF                                              02360002
023700           END-IF                                                 02370002
023800                                                                  02380001
023810           IF SU046-NEW-STR-NO                                    02381057
023820              IF SU045-NEW-STR-YES                                02382058
023830                 SET SU046-NEW-STR-YES TO TRUE                    02383055
023840              END-IF                                              02384055
023850           END-IF                                                 02385055
023860                                                                  02386055
023900           IF SU045-SHIPT-UNT-ID = PV-PREVIOUS-CRTN-ID            02390027
024000              CONTINUE                                            02400030
024100           ELSE                                                   02410027
024200              ADD 1                 TO SU046-NBR-CRTNS-NO-TRLR    02420049
024300              IF SU045-LINE-VRFD-YES                              02430033
024400                 ADD 1           TO SU046-VRFD-CRTN-CNT           02440027
024500              END-IF                                              02450027
024600           END-IF                                                 02460027
024610           ADD  SU045-RETAIL-AMT TO SU046-RETAIL-AMT              02461050
024700                                                                  02470027
025100        ELSE                                                      02510001
025110                                                                  02511034
025300           PERFORM 8000-WRITE-EXTRACT                             02530034
025700                                                                  02570028
025800           PERFORM 2100-XPTD-CRTN-CNT                             02580002
025900           PERFORM 2200-RCVR-STATUS                               02590002
026000           PERFORM 2400-MFST-CRTN-CNT                             02600002
026100                                                                  02610002
026300           MOVE SU045-ORGN-LOC-NBR     TO SU046-ORGN-LOC-NBR      02630003
026400           MOVE SU045-TRN-NBR          TO SU046-TRN-NBR           02640003
026500           MOVE SU045-RCVR-SEQ-NBR     TO SU046-RCVR-SEQ-NBR      02650002
026600           MOVE SU045-CART-SRC-CDE     TO SU046-CARTON-SOURCE     02660016
026700           MOVE SU045-VENDOR-ID        TO SU046-VENDOR-ID         02670002
026800           MOVE SU045-VENDOR-NAME      TO SU046-VENDOR-NAME       02680002
026820           MOVE SU045-SEASET-NAME      TO SU046-SEASET-NAME       02682052
026900           MOVE SU045-LNE-LOC-CDE      TO SU046-LNE-LOC-CDE       02690002
027000           MOVE SU045-PRC-AREA-ID      TO SU046-PRC-AREA-ID       02700002
027010           MOVE SU045-TYP-CDE          TO SU046-TYP-CDE           02701062
027100           MOVE SU045-VERIFY-DATE      TO SU046-VERIFY-DATE       02710003
027200           MOVE SU045-VERIFY-TIME      TO SU046-VERIFY-TIME       02720003
027300           MOVE SU045-TRBL-IND         TO SU046-TRBL-IND          02730002
027310           MOVE SU045-NEW-STR-IND      TO SU046-NEW-STR-IND       02731059
027400           MOVE PKSLIP-EXPTED-PKG-QTY  TO SU046-EXPTD-CRTNS       02740016
027500           MOVE PV-MFST-CRTN-CNT       TO SU046-NBR-CRTNS-MFSTD   02750016
027510           ADD 1                       TO SU046-NBR-CRTNS-NO-TRLR 02751035
027520           ADD  SU045-RETAIL-AMT       TO SU046-RETAIL-AMT        02752048
027600                                                                  02760018
027700           MOVE RECEIV-STATUS-CDE      TO SU046-VRFD-STATUS       02770039
027800           IF RECEIV-STATUS-CDE = 'VE'                            02780018
027900              SET SU046-ALL-LINES            TO TRUE              02790018
028000           ELSE                                                   02800018
028100              PERFORM 2300-VRFD-LINE-COUNT                        02810018
028200           END-IF                                                 02820018
028210                                                                  02821036
028220           IF  SU046-SOME-LINES  OR                               02822036
028230               SU046-ALL-LINES                                    02823036
028240                 ADD 1           TO SU046-VRFD-CRTN-CNT           02824036
028300           END-IF                                                 02830036
028310        END-IF.                                                   02831036
028400                                                                  02840002
028500        MOVE SU045-TRN-NBR         TO PV-PREVIOUS-PO.             02850035
028600        MOVE SU045-RCVR-SEQ-NBR    TO PV-PREVIOUS-RCVR.           02860035
028610        MOVE SU045-SHIPT-UNT-ID    TO PV-PREVIOUS-CRTN-ID.        02861035
028700                                                                  02870012
028800        PERFORM 7000-READ-INPUT-FILE.                             02880001
028900                                                                  02890034
029100***************************************************************** 02910001
029200 2100-XPTD-CRTN-CNT.                                              02920002
029300***************************************************************** 02930001
029400     MOVE SU045-TRN-NBR       TO DK-TRN-NBR                       02940002
029500     MOVE SU045-RCVR-SEQ-NBR  TO DK-RCVR-SEQ-NBR                  02950002
029600                                                                  02960002
029700     EXEC SQL                                                     02970002
029800       SELECT SUM (EXPTED_PKG_QTY)                                02980014
029900         INTO  :PKSLIP-EXPTED-PKG-QTY                             02990013
030000         FROM  TPKSLIP                                            03000002
030100        WHERE PO_NBR        = :DK-TRN-NBR                         03010002
030200          AND REC_SEQ_NBR   = :DK-RCVR-SEQ-NBR                    03020002
030300          AND VER_STAT_CDE  = 'A'                                 03030002
030310        WITH UR                                                   03031065
030400     END-EXEC.                                                    03040002
030500                                                                  03050002
030600     EVALUATE TRUE                                                03060029
030700         WHEN SQLCODE = +0                                        03070002
030800         WHEN SQLCODE = +100                                      03080022
030900         WHEN SQLCODE = -305                                      03090022
031000              CONTINUE                                            03100022
031100         WHEN SQLWARN0 NOT = SPACE                                03110002
031200         WHEN SQLCODE  NOT = +0                                   03120002
031300              MOVE '2100-XPTD-CRTN-CNT'                           03130002
031400                                   TO PV-ABEND-PARAGRAPH          03140002
031500              MOVE 'ATTEMPTING TO SELECT TPKSLIP'                 03150002
031600                                   TO PV-ABEND-OPERATION          03160002
031700              MOVE DK-TRN-NBR      TO                             03170002
031800                                PV-DISPLAY-TRN-NBR                03180002
031900              MOVE DK-RCVR-SEQ-NBR    TO                          03190002
032000                                PV-DISPLAY-RCVR-SEQ-NBR           03200002
032100              PERFORM Z999-SQL-ABEND                              03210002
032200     END-EVALUATE.                                                03220002
032300                                                                  03230002
032500***************************************************************** 03250001
032600 2200-RCVR-STATUS.                                                03260002
032700***************************************************************** 03270001
032800     MOVE SU045-TRN-NBR      TO DK-TRN-NBR                        03280001
032900     MOVE SU045-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR                   03290001
033000                                                                  03300001
033100     EXEC SQL                                                     03310001
033200       SELECT STATUS_CDE                                          03320002
033300         INTO  :RECEIV-STATUS-CDE                                 03330002
033400         FROM TRECEIV                                             03340002
033500        WHERE ORD_NBR      = :DK-TRN-NBR                          03350002
033600          AND REC_SEQ_NBR  = :DK-RCVR-SEQ-NBR                     03360002
033610        WITH UR                                                   03361065
033700     END-EXEC.                                                    03370001
033800                                                                  03380001
033900     EVALUATE TRUE                                                03390001
034000         WHEN SQLCODE = +0                                        03400001
034100         WHEN SQLCODE = +100                                      03410023
034200              CONTINUE                                            03420017
034300         WHEN SQLWARN0 NOT = SPACE                                03430001
034400         WHEN SQLCODE  NOT = +0                                   03440001
034500              MOVE '2200-RCVR-STATUS'                             03450002
034600                                   TO PV-ABEND-PARAGRAPH          03460001
034700              MOVE 'ATTEMPTING TO SELECT TRECEIV'                 03470002
034800                                   TO PV-ABEND-OPERATION          03480001
034900              MOVE DK-TRN-NBR      TO                             03490001
035000                                PV-DISPLAY-TRN-NBR                03500001
035100              MOVE DK-RCVR-SEQ-NBR    TO                          03510001
035200                                PV-DISPLAY-RCVR-SEQ-NBR           03520001
035300              PERFORM Z999-SQL-ABEND                              03530001
035400     END-EVALUATE.                                                03540001
035600                                                                  03560001
035700***************************************************************** 03570001
035800 2300-VRFD-LINE-COUNT.                                            03580002
035900                                                                  03590001
036000     EXEC SQL                                                     03600002
036100       SELECT COUNT(*)                                            03610002
036200         INTO  :PV-TOTAL-LINES                                    03620002
036300         FROM TRECITM                                             03630002
036400        WHERE ORD_NBR          = :DK-TRN-NBR                      03640002
036500          AND REC_SEQ_NBR      = :DK-RCVR-SEQ-NBR                 03650004
036600          AND VER_STATUS_CDE   = 'A'                              03660002
036610        WITH UR                                                   03661065
036700     END-EXEC.                                                    03670002
036800                                                                  03680002
037900     EVALUATE TRUE                                                03790002
038000         WHEN SQLCODE = +0                                        03800002
038010              PERFORM 2350-VRFD-LINE-COUNT                        03801037
038020                                                                  03802037
039000         WHEN SQLCODE = +100                                      03900002
039100         WHEN SQLWARN0 NOT = SPACE                                03910002
039200         WHEN SQLCODE  NOT = +0                                   03920002
039300              MOVE '2300-VRFD-LINE-COUNT'                         03930002
039400                                   TO PV-ABEND-PARAGRAPH          03940002
039500              MOVE 'ATTEMPTING TO SELECT TRECITM'                 03950002
039600                                   TO PV-ABEND-OPERATION          03960002
039700              MOVE DK-TRN-NBR      TO                             03970002
039800                                PV-DISPLAY-TRN-NBR                03980002
039900              MOVE DK-RCVR-SEQ-NBR    TO                          03990002
040000                                PV-DISPLAY-RCVR-SEQ-NBR           04000002
040100              PERFORM Z999-SQL-ABEND                              04010002
040200     END-EVALUATE.                                                04020002
040300                                                                  04030002
040310***************************************************************** 04031037
040320 2350-VRFD-LINE-COUNT.                                            04032037
040330                                                                  04033037
040394     EXEC SQL                                                     04039437
040395       SELECT COUNT(*)                                            04039537
040396         INTO  :PV-VERIFIED-LINES                                 04039637
040397         FROM TRECITM                                             04039737
040398        WHERE ORD_NBR          = :DK-TRN-NBR                      04039837
040399          AND REC_SEQ_NBR      = :DK-RCVR-SEQ-NBR                 04039937
040400          AND VER_STATUS_CDE   = 'A'                              04040037
040401          AND STATUS_CDE       = 'VE'                             04040137
040402        WITH UR                                                   04040265
040403     END-EXEC.                                                    04040337
040404                                                                  04040437
040405     EVALUATE TRUE                                                04040537
040406         WHEN SQLCODE = +0                                        04040637
040407              IF PV-VERIFIED-LINES = 0                            04040737
040408                 SET SU046-NO-LINES        TO TRUE                04040837
040409              ELSE                                                04040937
040410              IF PV-VERIFIED-LINES = PV-TOTAL-LINES               04041037
040411                 SET SU046-ALL-LINES       TO TRUE                04041137
040412              ELSE                                                04041237
040413                 SET SU046-SOME-LINES      TO TRUE                04041337
040414              END-IF                                              04041437
040415              END-IF                                              04041537
040416         WHEN SQLCODE = +100                                      04041637
040417         WHEN SQLWARN0 NOT = SPACE                                04041737
040418         WHEN SQLCODE  NOT = +0                                   04041837
040419              MOVE '2350-VRFD-LINE-COUNT'                         04041937
040420                                   TO PV-ABEND-PARAGRAPH          04042037
040421              MOVE 'ATTEMPTING TO SELECT TRECITM'                 04042137
040422                                   TO PV-ABEND-OPERATION          04042237
040423              MOVE DK-TRN-NBR      TO                             04042337
040424                                PV-DISPLAY-TRN-NBR                04042437
040425              MOVE DK-RCVR-SEQ-NBR    TO                          04042537
040426                                PV-DISPLAY-RCVR-SEQ-NBR           04042637
040427              PERFORM Z999-SQL-ABEND                              04042737
040428     END-EVALUATE.                                                04042837
040429                                                                  04042937
040430***************************************************************** 04043002
040500 2400-MFST-CRTN-CNT.                                              04050002
040600***************************************************************** 04060002
040700     MOVE SU045-TRN-NBR       TO DK-TRN-NBR                       04070002
040800     MOVE SU045-RCVR-SEQ-NBR  TO DK-RCVR-SEQ-NBR                  04080002
040900                                                                  04090002
041000     EXEC SQL                                                     04100002
041100       SELECT COUNT(DISTINCT(A.SHIPT_UNT_ID))                     04110040
041200         INTO  :PV-MFST-CRTN-CNT                                  04120002
041300         FROM  SUT_OTBND_UPC  A                                   04130040
041310            ,  SUT_OTBND_CART B                                   04131040
041400        WHERE A.TRN_NBR        = :DK-TRN-NBR                      04140042
041500          AND A.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR                 04150042
041510          AND A.SHPD_UNT_QTY   > 0                                04151042
041520          AND A.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                    04152042
041521          AND B.CART_SRC_CDE  <> 'DMG'                            04152142
041530          AND B.ACTV_IND       = 'Y'                              04153042
041540        WITH UR                                                   04154065
041600     END-EXEC.                                                    04160002
041700                                                                  04170002
041800     EVALUATE TRUE                                                04180002
041900         WHEN SQLCODE = +0                                        04190002
042000              CONTINUE                                            04200016
042100         WHEN SQLCODE = +100                                      04210002
042200         WHEN SQLWARN0 NOT = SPACE                                04220002
042300         WHEN SQLCODE  NOT = +0                                   04230002
042400              MOVE '2400-MFST-CRTN-CNT'                           04240002
042500                                   TO PV-ABEND-PARAGRAPH          04250002
042600              MOVE 'ATTEMPTING TO SELECT SUT_OTBND_UPC'           04260002
042700                                   TO PV-ABEND-OPERATION          04270002
042800              MOVE DK-TRN-NBR      TO PV-DISPLAY-TRN-NBR          04280044
043000              MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR     04300044
043200              PERFORM Z999-SQL-ABEND                              04320002
043300     END-EVALUATE.                                                04330002
043500                                                                  04350002
043600***************************************************************** 04360002
043700 7000-READ-INPUT-FILE.                                            04370002
043800***************************************************************** 04380002
043900      READ INPUT-FILE INTO SU045-EXTRACT-RECORD                   04390002
044000        AT END                                                    04400002
044100           SET PS-END-OF-INPUT-FILE TO TRUE                       04410002
044200        NOT AT END                                                04420002
044300           ADD +1 TO PV-READ-COUNT                                04430002
044400      END-READ.                                                   04440002
044500                                                                  04450002
044700***************************************************************** 04470002
044800 8000-WRITE-EXTRACT.                                              04480002
044900***************************************************************** 04490002
045000     WRITE EXTRACT-RECORD                                         04500002
045100       FROM SU046-EXTRACT-RECORD.                                 04510007
045200                                                                  04520007
045300     ADD +1 TO PV-WRITE-EXTR-COUNT.                               04530019
045310     INITIALIZE SU046-EXTRACT-RECORD.                             04531046
045400                                                                  04540002
045500***************************************************************** 04550002
045600 9000-CLOSE-FILES.                                                04560002
045700                                                                  04570002
045800     MOVE PV-READ-COUNT              TO PV-DISPLAY-READ-CNT.      04580002
045900     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-READ-CNT.      04590002
046000                                                                  04600002
046100     MOVE PV-WRITE-EXTR-COUNT        TO PV-DISPLAY-WRITE-CNT.     04610002
046200     DISPLAY 'TOT RECS WRITTEN    : '   PV-DISPLAY-WRITE-CNT.     04620002
046300                                                                  04630002
046400*DISPLAY READ TOTAL SHOULD EQUAL WRITE TOTAL                      04640002
046500     CLOSE INPUT-FILE                                             04650002
046600           EXTRACT-FILE.                                          04660002
046800                                                                  04680002
046900***************************************************************** 04690002
047000 Z999-SQL-ABEND.                                                  04700002
047100***************************************************************** 04710002
047200     MOVE SQLCODE                     TO PV-DISPLAY-SQLCODE.      04720002
047300                                                                  04730002
047400     DISPLAY '** ABEND ** '.                                      04740045
047500     DISPLAY '** PROGRAM      ** = ' PC-PROGRAM-NAME.             04750045
047600     DISPLAY '** TRN NBR      ** = ' PV-DISPLAY-TRN-NBR.          04760002
047700     DISPLAY '** RCVR SEQ NBR ** = ' PV-DISPLAY-RCVR-SEQ-NBR.     04770002
047800                                                                  04780002
047900                                                                  04790002
048000     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             04800002
048100     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                04810002
048200     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             04820002
048300     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME2.             04830002
048400     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE.             04840002
048500                                                                  04850002
048600     MOVE +4013                  TO PV-ABEND-CODE.                04860002
048700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04870002
048800******************************************************************04880002
