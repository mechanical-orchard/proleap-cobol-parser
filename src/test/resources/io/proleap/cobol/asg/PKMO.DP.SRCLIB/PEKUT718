       IDENTIFICATION DIVISION.                                                 
      *=======================*                                                 
                                                                                
       PROGRAM-ID.         PEKUT718.                                            
       AUTHOR.             COGNIZANT.                                           
       INSTALLATION.       KOHL CORPORATION.                                    
       DATE-WRITTEN.       26/12/2010.                                          
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * Remarks                                                        *        
      * -------                                                        *        
      *                                                                *        
      * Title        - Get SKU's on Mark1 Clearance document for Perm  *        
      *                Clearance Report (CE1)                          *        
      *                                                                *        
      * Description  - This Program gets the SKU informations on MARK1 *        
      *                clearance document in approved status with      *        
      *                future effective date. The informations will be *        
      *                used to prepare perm Clearance Report for reason*        
      *                code CE1                                        *        
      *                CE1 - On Mark 1 Within 30 days of Last Receipt  *        
      * Change History                                                 *        
      ******************************************************************        
      * WR Number     Programmer       Date                            *        
      * ---------------------------------------------------------------*        
      * WR34795       COGNIZANT        26/12/2010                      *        
      * ORIGINAL VERSION                                               *        
      *                                                                *        
      * PKE8389       COGNIZANT        09/02/2012                      *        
      *                                                                *        
      * MARK1_SKU_CSR  HAS BEEN MODIFIED TO HANDLE NULL VALUE          *        
P53282* P53282  05-13-2015 COGNIZANT Union and distinct are removed in          
P53282*                              MARK1 Cursor to improve performance        
      *                                                                *        
      * CHG0204126    COGNIZANT        07/30/2018                      *        
      * DESCRIPTION:  ORACLE LOGON STANDARDS PROGRAM CHANGE *                   
      ******************************************************************        
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
      *=====================*                                                   
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT SMPL-STR-INFILE                                               
              ASSIGN                        TO INP01.                           
                                                                                
           SELECT REP-DATE-INFILE                                               
              ASSIGN                        TO INP02.                           
                                                                                
           SELECT PERM-MARK1-SKU-OUTFILE                                        
              ASSIGN                        TO RPT01.                           
                                                                                
           SELECT ORACLE-LOGON-FILE                                             
               ASSIGN                       TO ORALOGON.                        
                                                                                
       DATA DIVISION.                                                           
      *==============*                                                          
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  SMPL-STR-INFILE                                                      
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           DATA RECORD IS SMPL-STR-INFILE-REC.                                  
       01  SMPL-STR-INFILE-REC           PIC X(80).                             
                                                                                
       FD  REP-DATE-INFILE                                                      
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           DATA RECORD IS REP-DATE-INFILE-REC.                                  
                                                                                
       01  REP-DATE-INFILE-REC           PIC X(80).                             
                                                                                
       FD  PERM-MARK1-SKU-OUTFILE                                               
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           DATA RECORD IS PERM-MARK1-SKU-REC.                                   
       01  PERM-MARK1-SKU-REC            PIC X(351).                            
                                                                                
       FD  ORACLE-LOGON-FILE                                                    
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                              
       01  OL-ORACLE-LOGON-RECORD      PIC X(80).                               
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  ABEND-CODE                    PIC S9(04) COMP VALUE +0.              
           88  ABEND-4001-WRITE-ERROR                VALUE +4001.               
           88  ABEND-4002-READ-ERROR                 VALUE +4002.               
           88  ABEND-4003-CTRL-CARD-ERROR            VALUE +4003.               
           88  ABEND-4004-TABLE-ERROR                VALUE +4004.               
           88  ABEND-4005-OPEN-ERROR                 VALUE +4005.               
           88  ABEND-4006-CLOSE-ERROR                VALUE +4006.               
           88  ABEND-4007-SEQUENCE-ERROR             VALUE +4007.               
           88  ABEND-4008-DATA-ERROR                 VALUE +4008.               
           88  ABEND-4009-KEY-DATA-ERROR             VALUE +4009.               
           88  ABEND-4013-SQL-ERROR                  VALUE +4013.               
           88  ABEND-4014-ORACLE-LOGON-ERROR         VALUE +4014.               
           88  ABEND-4019-DATE-ROUTINE-ERROR         VALUE +4019.               
           88  ABEND-4444-FORCED-ABEND               VALUE +4444.               
                                                                                
      *****************************************************************         
      * The layout for input file - SMPL-STR-INFILE                   *         
      *****************************************************************         
       01  CC-SMPL-STR-INFILE-REC.                                              
           03  CC-STR-NBR                PIC  9(04)  VALUE 0.                   
           03  FILLER                    PIC  X(76)  VALUE SPACES.              
                                                                                
      *****************************************************************         
      *    THE LAYOUT FOR DATE INPUT FILE                             *         
      *****************************************************************         
       01  CC-RUN-DATE-GAP-REC.                                                 
           03  CC-REP-DATE-GAP           PIC +9(02).                            
           03  FILLER                    PIC  X(76)  VALUE SPACES.              
                                                                                
      *****************************************************************         
      * Program constants                                                       
      *****************************************************************         
       01  PC-PROGRAM-CONSTANTS.                                                
           03  PC-PROGRAM-NAME           PIC  X(08)  VALUE 'PEKUT718'.          
                                                                                
      *****************************************************************         
      * Program switches                                                        
      *****************************************************************         
       01  PS-PROGRAM-SWITCHES.                                                 
006510     03  PS-END-OF-LOGON-FILE-SW   PIC X(1)    VALUE 'N'.                 
006530         88  PS-END-OF-LOGON-FILE              VALUE 'Y'.                 
           03  PS-ORA-SRC-CTL-DONE-SW    PIC X(1)    VALUE 'N'.                 
               88  PS-ORA-SRC-EMPTY                  VALUE 'Y'.                 
           03  PS-MARK1-SKU-CSR-SW       PIC  X(01)  VALUE 'N'.                 
               88  EOF-MAR1-SKU-CSR                  VALUE 'Y'.                 
               88  NOT-EOF-MAR1-SKU-CSR              VALUE 'N'.                 
           03  PS-STORE-FILE-ST-SW       PIC  X(01)  VALUE 'N'.                 
               88  EOF-STORE-FILE                    VALUE 'Y'.                 
               88  NOT-EOF-STORE-FILE                VALUE 'N'.                 
           03  PS-CONTROL-CARD-REP-DT    PIC  X(01)  VALUE 'N'.                 
               88  EOF-DATE-GAP-FILE                 VALUE 'Y'.                 
               88  NOT-EOF-DATE-GAP-FILE             VALUE 'N'.                 
                                                                                
       01  CC-ORACLE-CONNECTION.                                                
           03  CC-ORACLE-USERID             PIC X(40).                          
               88 CC-AUTO-LOGON                         VALUE '/'.              
           03  CC-ORACLE-PASSWORD           PIC X(40).                          
                                                                                
      *****************************************************************         
      * Program variables                                                       
      *****************************************************************         
       01  PV-PROGRAM-VARIABLES.                                                
           03  PV-ORACLE-USERID-LEN      PIC S9(04)  VALUE ZEROS                
                                                     COMP SYNC.                 
           03  PV-ORACLE-PASSWORD-LEN    PIC S9(04)  VALUE ZEROS                
                                                     COMP SYNC.                 
           03  PV-PARAGRAPH-NAME         PIC  X(30)  VALUE SPACES.              
           03  PV-TABLE-NAME             PIC  X(30)  VALUE SPACES.              
           03  PV-DATE-GAP               PIC  S9(02) VALUE 0.                   
           03  PV-PREV-SKU-NBR           PIC  9(08)  VALUE 0.                   
           03  PV-OPERATION-MSG          PIC  X(60)  VALUE SPACES.              
           03  PV-CNT-STRS               PIC  9(02)  VALUE ZEROES.              
           03  PV-MARK1-FILE.                                                   
               05  PV-DMA-NBR            PIC  9(04)  VALUE 0.                   
               05  PV-DMM-FRST-NM        PIC  X(20)  VALUE SPACES.              
               05  PV-DMM-LAST-NM        PIC  X(30)  VALUE SPACES.              
               05  PV-BYR-NBR            PIC  9(04)  VALUE 0.                   
               05  PV-FRST-NM            PIC  X(40)  VALUE SPACES.              
               05  PV-LAST-NM            PIC  X(40)  VALUE SPACES.              
               05  PV-DEPT-NBR           PIC  9(04)  VALUE 0.                   
               05  PV-DEPT-NM            PIC  X(20)  VALUE SPACES.              
               05  PV-SUB-CL-NBR         PIC  9(04)  VALUE 0.                   
               05  PV-VS-NBR             PIC  X(20)  VALUE SPACES.              
               05  PV-VS-DESC            PIC  X(30)  VALUE SPACES.              
               05  PV-SKU-NBR            PIC  9(08)  VALUE 0.                   
               05  PV-SKU-STAT-CDE       PIC  X(02)  VALUE SPACES.              
               05  PV-SKU-DESC           PIC  X(30)  VALUE SPACES.              
               05  PV-CSTM-CLOR-DESC     PIC  X(10)  VALUE SPACES.              
               05  PV-PRCHG-ID           PIC  9(10)  VALUE 0.                   
               05  PV-ALL-RMNG-STR-IND   PIC  X(01)  VALUE SPACES.              
               05  PV-EFF-DTE            PIC  X(10)  VALUE SPACES.              
               05  PV-EFF-DTE-PLUS30     PIC  X(10)  VALUE SPACES.              
               05  PV-PRCHG-TYP-CDE      PIC  X(03)  VALUE SPACES.              
               05  PV-PRCHG-ST-CDE       PIC  X(03)  VALUE SPACES.              
               05  PV-ITM-NBR            PIC  9(15)  VALUE 0.                   
               05  PV-STYL-ID            PIC  9(08)  VALUE 0.                   
               05  PV-INTR-UPC-ID        PIC  9(10)  VALUE 0.                   
               05  PV-SKU-STAT-DESC      PIC  X(10)  VALUE SPACES.              
               05  PV-STORE-NBR          PIC  9(05)  VALUE 0.                   
                                                                                
           03  PV-HOST-STRS.                                                    
               05  PV-HOST-STR-1         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-2         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-3         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-4         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-5         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-6         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-7         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-8         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-9         PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-10        PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-11        PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-12        PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-13        PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-14        PIC  S9(04) VALUE +0 COMP-3.           
               05  PV-HOST-STR-15        PIC  S9(04) VALUE +0 COMP-3.           
           03  PV-HOST-STRS-RED    REDEFINES  PV-HOST-STRS.                     
               05  PV-STR                PIC  S9(04) COMP-3                     
                                                    OCCURS 15 TIMES.            
                                                                                
      *****************************************************************         
      *                      O  R  A  C  L  E                                   
      *----------------------------------------------------------------*        
      *    ORACLE DECLARE SECTION                                               
      *----------------------------------------------------------------*        
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                             
                                                                                
      *---------------------------------------------------------------*         
      * ORACLE LOGON WORKING STORAGE COPYBOOK                                   
      *---------------------------------------------------------------*         
       01      PC-ENT01-TYPE-CDE          PIC X(02)      VALUE '01'.            
       01      PV-ORACLE-ID               PIC X(1)       VALUE '/'.             
                                                                                
       01      USERNAME                   PIC X(10)      VARYING.               
       01      PASSWD                     PIC X(10)      VARYING.               
                                                                                
       01      ORACLE-RETURN              PIC X(200)     VALUE SPACES.          
                                                                                
           EXEC SQL END DECLARE SECTION END-EXEC.                               
           EXEC SQL INCLUDE SQLCACOB    END-EXEC.                               
                                                                                
      *****************************************************************         
      *    MARK1 Cursor - To Get SKU's on Mark1 Clearance document    *         
      *****************************************************************         
           EXEC SQL                                                             
                DECLARE MARK1_SKU_CSR CURSOR FOR                                
                 SELECT  XDM.DMA_NBR                                            
PK8389                  ,NVL(XDM.DMM_FRST_NM,' ')                               
PK8389*                 ,XDM.DMM_FRST_NM                                        
                        ,XDM.DMM_LAST_NM                                        
                        ,XDM.BYR_NBR                                            
PK8389                  ,NVL(XDM.BYR_FRST_NM,' ')                               
PK8389*                 ,XDM.BYR_FRST_NM                                        
                        ,XDM.BYR_LAST_NM                                        
                        ,VT1.DEPT_NBR                                           
                        ,XDM.DEPT_NM                                            
                        ,XVS.SUB_CL_NBR                                         
                        ,XVS.VS_NBR                                             
                        ,XVS.VS_DESC                                            
                        ,VT1.SKU_NBR                                            
                        ,XS.SKU_STAT_CDE                                        
                        ,XS.SKU_DESC                                            
                        ,XS.CSTM_CLOR_DESC                                      
                        ,VT1.PRCHG_ID                                           
                        ,VT1.ALL_RMNG_STR_IND                                   
                        ,VT1.EFF_DTE                                            
                        ,VT1.EFF_DTE_30DAYS                                     
                        ,VT1.PRCHG_TYP_CDE                                      
                        ,VT1.PRCHG_ST_CDE                                       
                        ,XS.ITM_NBR                                             
                        ,XS.STYL_ID                                             
                        ,XS.INTR_UPC_ID                                         
                        ,XS.SKU_STAT_DESC                                       
                        ,VT2.SN                                                 
                   FROM                                                         
P53282          (SELECT                                                         
                        E.SKU_NBR                                               
                       ,C.PRCHG_ID                                              
                       ,C.ALL_RMNG_STR_IND                                      
                       ,C.PRCHG_TYP_CDE                                         
                       ,C.PRCHG_ST_CDE                                          
                       ,A.EFF_DTE                                               
                       ,TRUNC(A.EFF_DTE + :PV-DATE-GAP) EFF_DTE_30DAYS          
                       ,C.DEPT_NBR                                              
                       ,B.STR_SELN_ID                                           
                       ,C.CURR_STR_GP_TYP_CDE                                   
                   FROM PET_PERM_EVNT             A                             
                       ,PET_STR_GP_PRCHG_ASSN     B                             
                       ,PET_PRCHG                 C                             
                       ,PET_STR_GP_MDSE_LNE_PRICG D                             
                       ,PET_PRCHG_MDSE_SELN_LNE   E                             
                       ,PET_PRCHG_MDSE_SELN       F                             
                  WHERE A.PERM_EVNT_ID       = B.PERM_EVNT_ID                   
                    AND B.PRCHG_ID           = C.PRCHG_ID                       
                    AND D.STR_GP_PRCHG_ASSN_ID                                  
                                             = B.STR_GP_PRCHG_ASSN_ID           
                    AND D.PRCHG_MDSE_SELN_LNE_ID                                
                                             = E.PRCHG_MDSE_SELN_LNE_ID         
                    AND F.PRCHG_MDSE_SELN_ID = E.PRCHG_MDSE_SELN_ID             
                    AND F.MDSE_HIER_CDE      = 'SKU'                            
                    AND C.PRCHG_TYP_CDE      = 'RCP'                            
                    AND C.PRCHG_ST_CDE       = 'APR'                            
                    AND TRUNC(A.EFF_DTE)     > TRUNC(SYSDATE)                   
                    AND A.STAT_CDE           = 'S'                              
                    AND B.STAT_CDE           = 'S'                              
                    AND C.STAT_CDE           = 'S'                              
                    AND D.STAT_CDE           = 'S'                              
                    AND E.STAT_CDE           = 'S'                              
P53282              AND F.STAT_CDE           = 'S') VT1,                        
                (SELECT DISTINCT                                                
                        II.STR_SELN_ID           SS1                            
                       ,III.STR_SELN_ID          SS2                            
                       ,KKK.STR_GP_TYP_CDE       STR_GP_TYP_CDE4                
                       ,JJ.EFF_BEG_DTE           BD1                            
                       ,JJ.EFF_END_DTE           ED1                            
                       ,KK.EFF_BEG_DTE           BD2                            
                       ,KK.EFF_END_DTE           ED2                            
                       ,JJJ.EFF_BEG_DTE          BD3                            
                       ,JJJ.EFF_END_DTE          ED3                            
                       ,KKK.EFF_BEG_DTE          BD4                            
                       ,KKK.EFF_END_DTE          ED4                            
                       ,KK.STR_NBR               SN                             
                   FROM PMT_STR_SELN     II                                     
                       ,XKT_STR_GP_DTE   JJ                                     
                       ,XKT_STR_GP_MBSHP KK                                     
                       ,PMT_STR_SELN     III                                    
                       ,XKT_STR_GP_DTE   JJJ                                    
                       ,XKT_STR_GP_MBSHP KKK                                    
                  WHERE II.EFF_STR_GP_ID   = JJ.EFF_STR_GP_ID                   
                    AND JJ.STR_GP_ID       = KK.STR_GP_ID                       
                    AND KK.STR_GP_TYP_CDE  = JJ.STR_GP_TYP_CDE                  
                    AND KK.STR_GP_TYP_CDE  = 5000                               
                    AND KKK.STR_NBR        = KK.STR_NBR                         
                    AND III.EFF_STR_GP_ID  = JJJ.EFF_STR_GP_ID                  
                    AND JJJ.STR_GP_ID      = KKK.STR_GP_ID                      
                    AND KKK.STR_GP_TYP_CDE = JJJ.STR_GP_TYP_CDE                 
                    AND KK.STR_NBR IN ( :PV-HOST-STR-1                          
                                       ,:PV-HOST-STR-2                          
                                       ,:PV-HOST-STR-3                          
                                       ,:PV-HOST-STR-4                          
                                       ,:PV-HOST-STR-5                          
                                       ,:PV-HOST-STR-6                          
                                       ,:PV-HOST-STR-7                          
                                       ,:PV-HOST-STR-8                          
                                       ,:PV-HOST-STR-9                          
                                       ,:PV-HOST-STR-10                         
                                       ,:PV-HOST-STR-11                         
                                       ,:PV-HOST-STR-12                         
                                       ,:PV-HOST-STR-13                         
                                       ,:PV-HOST-STR-14                         
                                       ,:PV-HOST-STR-15                         
                                      )                                         
                                      )VT2,                                     
                        XKT_SKU        XS                                       
                       ,XKT_VND_STYL   XVS                                      
                       ,PMV_PRSN_MDSE_HIER XDM                                  
                  WHERE VT2.SS2             = VT1.STR_SELN_ID                   
                    AND XS.SKU_NBR          = VT1.SKU_NBR                       
                    AND XVS.STYL_ID         = XS.STYL_ID                        
                    AND VT2.STR_GP_TYP_CDE4 = VT1.CURR_STR_GP_TYP_CDE           
                    AND VT1.EFF_DTE   BETWEEN VT2.BD1                           
                                          AND NVL(VT2.ED1, VT1.EFF_DTE)         
                    AND VT1.EFF_DTE   BETWEEN VT2.BD2                           
                                          AND NVL(VT2.ED2, VT1.EFF_DTE)         
                    AND VT1.EFF_DTE   BETWEEN VT2.BD3                           
                                          AND NVL(VT2.ED3, VT1.EFF_DTE)         
                    AND VT1.EFF_DTE   BETWEEN VT2.BD4                           
                                          AND NVL(VT2.ED4, VT1.EFF_DTE)         
                    AND XDM.DEPT_NBR        = VT1.DEPT_NBR                      
           END-EXEC.                                                            
                                                                                
       PROCEDURE DIVISION.                                                      
      *==================*                                                      
                                                                                
      *****************************************************************         
      * Main processing flow                                                    
      *****************************************************************         
       A100-MAINLINE.                                                           
                                                                                
           PERFORM B100-INITIALIZE.                                             
                                                                                
           PERFORM C300-PROCESS-MARK1-SKU                                       
             UNTIL EOF-MAR1-SKU-CSR.                                            
                                                                                
           PERFORM D900-CLOSE-PARA.                                             
                                                                                
           STOP RUN.                                                            
                                                                                
      *****************************************************************         
      * Initialise fields and working storage                                   
      *****************************************************************         
       B100-INITIALIZE.                                                         
                                                                                
      *    PERFORM PM700-A000-ORACLE-SETUP.                                     
           PERFORM B110-ORACLE-SETUP.                                           
                                                                                
      ******************************************************************        
      * This copy book member contains the procedure division that     *        
      * logons to oracle.                                              *        
      ******************************************************************        
      *    COPY PMPD700.                                                        
                                                                                
           OPEN INPUT  SMPL-STR-INFILE                                          
                INPUT  REP-DATE-INFILE                                          
                OUTPUT PERM-MARK1-SKU-OUTFILE.                                  
                                                                                
           PERFORM B200-READ-DATE-FILE.                                         
                                                                                
           PERFORM B300-READ-SMPL-STR-FILE                                      
             UNTIL EOF-STORE-FILE.                                              
                                                                                
           PERFORM X100-OPEN-MARK1-SKU-CSR.                                     
                                                                                
           INITIALIZE                          PV-MARK1-FILE.                   
           PERFORM X200-FETCH-MARK1-SKU-CSR.                                    
           MOVE PV-SKU-NBR                  TO PV-PREV-SKU-NBR.                 
                                                                                
      *****************************************************************         
      * B110-ORACLE-SETUP                                             *         
      *****************************************************************         
       B110-ORACLE-SETUP.                                                       
                                                                                
           OPEN INPUT ORACLE-LOGON-FILE.                                        
                                                                                
           PERFORM B120-READ-ORACLE-LOGON.                                      
                                                                                
           CLOSE ORACLE-LOGON-FILE.                                             
                                                                                
           IF ((PS-END-OF-LOGON-FILE)                                           
                   OR (CC-ORACLE-CONNECTION = SPACES))                          
               DISPLAY '** ABEND **'                                            
               DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '          
                         'NOT PROVIDED'                                         
               SET PS-ORA-SRC-EMPTY TO TRUE                                     
               CALL 'ILBOABN0' USING ABEND-CODE                                 
           END-IF.                                                              
                                                                                
           IF CC-AUTO-LOGON                                                     
               DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'                
               EXEC SQL                                                         
                    CONNECT :USERNAME                                           
               END-EXEC                                                         
           ELSE                                                                 
               INITIALIZE PV-ORACLE-USERID-LEN                                  
                          PV-ORACLE-PASSWORD-LEN                                
               INSPECT CC-ORACLE-USERID                                         
                   TALLYING PV-ORACLE-USERID-LEN                                
                FOR CHARACTERS BEFORE INITIAL SPACE                             
            INSPECT CC-ORACLE-PASSWORD                                          
                TALLYING PV-ORACLE-PASSWORD-LEN                                 
                FOR CHARACTERS BEFORE INITIAL SPACE                             
            MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO                   
                      USERNAME-ARR                                              
            MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                           
            MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO               
                      PASSWD-ARR                                                
            MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                           
            DISPLAY PC-PROGRAM-NAME ' - LOGON TO ORACLE AS USER '               
                      USERNAME-ARR                                              
            EXEC SQL                                                            
              CONNECT :USERNAME IDENTIFIED BY :PASSWD                           
            END-EXEC                                                            
            INITIALIZE CC-ORACLE-PASSWORD                                       
                       PASSWD                                                   
            END-IF.                                                             
                                                                                
020500     IF (SQLCODE NOT = 0)                                                 
020900         DISPLAY PV-PARAGRAPH-NAME                                        
020910         DISPLAY PC-PROGRAM-NAME ' - ERROR LOGGING ON TO ORACLE'          
021000*        PERFORM 9900-ORACLE-ABEND                                        
               PERFORM Z100-ABEND                                               
021200     END-IF.                                                              
                                                                                
      *****************************************************************         
      *  B120-READ-ORACLE-LOGON.                                      *         
      *****************************************************************         
       B120-READ-ORACLE-LOGON.                                                  
                                                                                
034510     READ ORACLE-LOGON-FILE                                               
034520         INTO CC-ORACLE-CONNECTION                                        
034530         AT END                                                           
034540             SET PS-END-OF-LOGON-FILE TO TRUE                             
034550     END-READ.                                                            
                                                                                
      ****************************************************************          
      * GETS THE DATE GAP TO GET EFFECTIVE DATE + 30 DAYS            *          
      ****************************************************************          
       B200-READ-DATE-FILE.                                                     
                                                                                
           READ REP-DATE-INFILE           INTO CC-RUN-DATE-GAP-REC              
           AT END                                                               
              SET EOF-DATE-GAP-FILE         TO TRUE                             
           END-READ.                                                            
                                                                                
           IF  EOF-DATE-GAP-FILE                                                
           OR  CC-REP-DATE-GAP = SPACES                                         
               MOVE 'PEKUT718'             TO PC-PROGRAM-NAME                   
               MOVE 'B200-READ-DATE-FILE'  TO PV-PARAGRAPH-NAME                 
               MOVE 'INVALID DATE GAP IN CONTROL CARD'                          
                                            TO PV-OPERATION-MSG                 
               SET ABEND-4003-CTRL-CARD-ERROR                                   
                                            TO TRUE                             
               PERFORM Z200-ABEND                                               
           END-IF                                                               
                                                                                
           MOVE CC-REP-DATE-GAP             TO PV-DATE-GAP.                     
                                                                                
      ****************************************************************          
      * Read in sample store info from SMPL-STR-INFILE                          
      ****************************************************************          
       B300-READ-SMPL-STR-FILE.                                                 
                                                                                
           READ SMPL-STR-INFILE           INTO CC-SMPL-STR-INFILE-REC           
             AT END SET EOF-STORE-FILE      TO TRUE                             
           END-READ.                                                            
                                                                                
           ADD 1                            TO PV-CNT-STRS.                     
                                                                                
           IF  (EOF-STORE-FILE                                                  
           AND PV-CNT-STRS = 1)                                                 
           OR  PV-CNT-STRS > 15                                                 
               MOVE 'B250-READ-SMPL-STR-FILE'                                   
                                            TO PV-PARAGRAPH-NAME                
               MOVE 'CONTROL CARD IS EMPTY / STORE COUNT > 15'                  
                                            TO PV-OPERATION-MSG                 
               SET ABEND-4003-CTRL-CARD-ERROR                                   
                                            TO TRUE                             
               PERFORM Z200-ABEND                                               
           END-IF.                                                              
                                                                                
           MOVE CC-STR-NBR                  TO PV-STR(PV-CNT-STRS).             
                                                                                
      *****************************************************************         
      *   C300-PROCESS-MARK1-SKU.                                               
      *****************************************************************         
       C300-PROCESS-MARK1-SKU.                                                  
                                                                                
           WRITE PERM-MARK1-SKU-REC       FROM PV-MARK1-FILE.                   
           INITIALIZE                          PV-MARK1-FILE.                   
                                                                                
           PERFORM X200-FETCH-MARK1-SKU-CSR.                                    
           MOVE PV-SKU-NBR                  TO PV-PREV-SKU-NBR.                 
                                                                                
      *****************************************************************         
      *    CLOSE FILES                                                          
      *****************************************************************         
       D900-CLOSE-PARA.                                                         
                                                                                
           CLOSE                            SMPL-STR-INFILE                     
                                            PERM-MARK1-SKU-OUTFILE.             
                                                                                
           PERFORM X300-CLOSE-MARK1-SKU-CSR.                                    
                                                                                
      ***********************************************************               
      * X100-OPEN-MARK1-SKU-CSR.                                                
      ***********************************************************               
       X100-OPEN-MARK1-SKU-CSR.                                                 
                                                                                
           EXEC SQL                                                             
                OPEN MARK1_SKU_CSR                                              
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE 'X100-OPEN-MARK1-SKU-CSR'                              
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR ON OPEN MARK1_SKU_CSR'                          
                                            TO PV-OPERATION-MSG                 
                    PERFORM Z100-ABEND                                          
           END-EVALUATE.                                                        
                                                                                
      ***********************************************************               
      * X200-FETCH-MARK1-SKU-CSR.                                               
      ***********************************************************               
       X200-FETCH-MARK1-SKU-CSR.                                                
                                                                                
           EXEC SQL                                                             
                FETCH  MARK1_SKU_CSR                                            
                 INTO :PV-DMA-NBR                                               
                     ,:PV-DMM-FRST-NM                                           
                     ,:PV-DMM-LAST-NM                                           
                     ,:PV-BYR-NBR                                               
                     ,:PV-FRST-NM                                               
                     ,:PV-LAST-NM                                               
                     ,:PV-DEPT-NBR                                              
                     ,:PV-DEPT-NM                                               
                     ,:PV-SUB-CL-NBR                                            
                     ,:PV-VS-NBR                                                
                     ,:PV-VS-DESC                                               
                     ,:PV-SKU-NBR                                               
                     ,:PV-SKU-STAT-CDE                                          
                     ,:PV-SKU-DESC                                              
                     ,:PV-CSTM-CLOR-DESC                                        
                     ,:PV-PRCHG-ID                                              
                     ,:PV-ALL-RMNG-STR-IND                                      
                     ,:PV-EFF-DTE                                               
                     ,:PV-EFF-DTE-PLUS30                                        
                     ,:PV-PRCHG-TYP-CDE                                         
                     ,:PV-PRCHG-ST-CDE                                          
                     ,:PV-ITM-NBR                                               
                     ,:PV-STYL-ID                                               
                     ,:PV-INTR-UPC-ID                                           
                     ,:PV-SKU-STAT-DESC                                         
                     ,:PV-STORE-NBR                                             
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLCODE = 1403                                              
                    SET EOF-MAR1-SKU-CSR    TO TRUE                             
               WHEN OTHER                                                       
                    MOVE 'X200-FETCH-MARK1-SKU-CSR'                             
                                            TO PV-PARAGRAPH-NAME                
                    DISPLAY 'LAST SKU_NBR FETCHED = ' PV-PREV-SKU-NBR           
                    MOVE 'ERROR ON FETCH MARK1_SKU_CSR'                         
                                            TO PV-OPERATION-MSG                 
                    PERFORM Z100-ABEND                                          
           END-EVALUATE.                                                        
                                                                                
      ***********************************************************               
      * X300-CLOSE-MARK1-SKU-CSR                                                
      ***********************************************************               
       X300-CLOSE-MARK1-SKU-CSR.                                                
                                                                                
            EXEC SQL                                                            
                 CLOSE MARK1_SKU_CSR                                            
            END-EXEC.                                                           
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE 'X300-CLOSE-MARK1-SKU-CSR'                             
                                            TO PV-PARAGRAPH-NAME                
                    MOVE 'ERROR ON CLOSE MARK1_SKU_CSR'                         
                                            TO PV-OPERATION-MSG                 
                    PERFORM Z100-ABEND                                          
           END-EVALUATE.                                                        
                                                                                
      *****************************************************************         
      * Z100-ABEND.                                                   *         
      *  - PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE            *         
      *****************************************************************         
       Z100-ABEND.                                                              
                                                                                
           DISPLAY '                       '.                                   
           DISPLAY '** ABEND **       ** = SQLERROR'.                           
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.                   
           DISPLAY '** SQLCODE        ** = ' SQLCODE.                           
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                        
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                           
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                          
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                        
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.                 
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.                     
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.                  
           DISPLAY '                       '.                                   
                                                                                
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
      ************************************************************              
      * Z200-ABEND.                                                             
      *     PERFORMS A NON-SQL-ABEND.                                           
      ************************************************************              
       Z200-ABEND.                                                              
                                                                                
           DISPLAY '** ABEND           **'.                                     
           DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.                  
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.                
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.                 
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
