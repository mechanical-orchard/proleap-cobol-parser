000100******************************************************************00010007
000200 IDENTIFICATION DIVISION.                                         00020008
000300******************************************************************00030008
000400 PROGRAM-ID.             PCKRF883.                                00040008
000500 AUTHOR.                 DEANNA BRANTNER.                         00050008
000600 INSTALLATION.           KOHLS DEPARTMENT STORE.                  00060008
000700 DATE-WRITTEN            MAY 2001.                                00070008
000800 DATE-COMPILED.                                                   00080008
000900                                                                  00090008
001000******************************************************************00100008
001100* THIS PROGRAM DISPLAYS TRAILER INFORMATIONON THE                 00110008
001200* LRT (LASER RADIO TERMINAL) AND DOES NOT ACCEPT AN F-KEY.        00120008
001300******************************************************************00130008
001400 ENVIRONMENT DIVISION.                                            00140008
001500 DATA DIVISION.                                                   00150008
001600                                                                  00160008
001700 WORKING-STORAGE SECTION.                                         00170008
001800******************************************************************00180008
001900 01  CA-COMMAREA.                                                 00190008
002000     COPY PCWS038.                                                00200008
002010     COPY PCWS233.                                                00201021
002020   02  CA-COMMAREA-SW           PIC X(1).                         00202021
002030       88  CA-USE-PCWS233-COMMAREA    VALUE 'A'.                  00203021
002040       88  CA-USE-PCWS038-COMMAREA    VALUE 'B'.                  00204021
002050   02  CA-LAST-PROGRAM          PIC X(8).                         00205026
002060       88  CA-LAST-PROG-PCKRF868      VALUE 'PCKRF868'.           00206026
002070       88  CA-LAST-PROG-PCKRF884      VALUE 'PCKRF884'.           00207026
002100                                                                  00210008
002200******************************************************************00220008
002300* COMMAREA FOR PCKRF888                                           00230016
002400******************************************************************00240017
002500     COPY PCWS039.                                                00250017
002600                                                                  00260017
002700******************************************************************00270017
002800 01  DK-DB2-KEYS.                                                 00280017
002900     05  DK-OPER-UNT-ID           PIC S9(4)   COMP.               00290019
003000     05  DK-CARTON-ID             PIC S9(18)V COMP-3.             00300017
003100     05  DK-CARTON-ID2            PIC  9(18).                     00310017
003200     05  DK-CARTON-ID3.                                           00320017
003300         10  DK-FIRST-CARTON      PIC 9(2).                       00330017
003400         10  DK-CARTON-ID4        PIC 9(18).                      00340017
003500         10  DK-LAST-CARTON       PIC 9(2).                       00350017
003600     05  DK-CARTON-ID-DB2.                                        00360017
003700         10  DK-FIRST-PART        PIC 9(7).                       00370017
003800         10  DK-REST-OF           PIC 9(11).                      00380017
003900     05  DK-STR-NBR               PIC S9(4) COMP.                 00390017
004000                                                                  00400017
004100 01  PC-PROGRAM-CONSTANTS.                                        00410017
004200     05  PC-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00420017
004300                                                     COMP SYNC.   00430017
004400     05  PC-CALLED-FROM-PROGRAM          PIC  X(08)  VALUE SPACES.00440017
004500     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00450017
004600         'PCKRF883'.                                              00460017
004700     05  PC-PREVIOUS-PGM                 PIC  X(08)  VALUE        00470017
004800         'PCKRF880'.                                              00480017
004900     05  PC-DC-RF-APPL-PGM               PIC  X(08)  VALUE        00490017
005000         'MPKCS027'.                                              00500017
005100     05  PC-DUPLICATE                    PIC  X(04)  VALUE 'E883'.00510017
005200     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00520017
005300         'END OF SESSION     '.                                   00530017
005400     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00540017
005500         'INVALID SELECTION  '.                                   00550017
005600     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00560017
005700         'UNRECOGNIZED PF KEY'.                                   00570017
005800     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00580017
005900         'USER NOT AUTHORIZED'.                                   00590017
006000     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00600017
006100         'TRANS NOT AVAILABLE'.                                   00610017
006200     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00620017
006300         'CICS ABEND -CALL DP'.                                   00630017
006400     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00640017
006500         'CICSAUTH BAD RETURN'.                                   00650017
006600     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00660017
006700         'SELECTION NOT AVAIL'.                                   00670017
006800     05  PC-NO-LABEL-AVAILABLE           PIC X(19)   VALUE        00680017
006900         'NO LABEL AVAILABLE '.                                   00690017
007000     05  PC-A                       PIC X(01)   VALUE 'A'.        00700017
007100     05  PC-E                       PIC X(01)   VALUE 'E'.        00710017
007200     05  PC-I                       PIC X(01)   VALUE 'I'.        00720017
007300     05  PC-N                       PIC X(01)   VALUE 'N'.        00730017
007400     05  PC-S                       PIC X(01)   VALUE 'S'.        00740017
007500     05  PC-Y                       PIC X(01)   VALUE 'Y'.        00750017
007600     05  PC-01                      PIC X(02)   VALUE '01'.       00760017
007700     05  PC-03                      PIC X(02)   VALUE '03'.       00770017
007800     05  PC-05                      PIC X(02)   VALUE '05'.       00780017
007900     05  PC-90                      PIC  X(02)  VALUE  '90'.      00790017
008000     05  PC-MGMX                    PIC X(04)   VALUE 'MGMX'.     00800017
008100     05  PC-SHOF                    PIC X(04)   VALUE 'SHOF'.     00810017
008200     05  PC-SHON                    PIC X(04)   VALUE 'SHON'.     00820017
009200     05  PC-SPACES                  PIC X(03) VALUE '   '.        00920017
009300     05  PC-DEFAULT-TIMESTAMP       PIC  X(26)                    00930017
009400                          VALUE  '9999-09-09-09.09.09.999999'.    00940017
009500                                                                  00950017
009600 01  PS-PROGRAM-SWITCHES.                                         00960017
009700     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00970017
009800         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00980017
009900         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00990017
010000                                                                  01000017
010100 01  PV-PROGRAM-VARIABLES.                                        01010017
010110     05  PV-OPER-UNT-ID            PIC 9(04).                     01011018
010120     05  PV-STR-NBR                PIC 9(04).                     01012018
010200     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01020017
010300     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01030017
010400                                                     COMP SYNC.   01040017
010500     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01050017
010600     05  PV-DUPLICATE-IND                PIC  X(01)  VALUE SPACE. 01060017
010700         88 PV-VALID-DUP-IND             VALUE 'Y', 'N'.          01070017
010800     05  PV-FKEY-MSG1.                                            01080017
010900         10  FILLER                      PIC  X(19)  VALUE        01090017
011000             'PRESS ENTER TO CONT'.                               01100017
011100     05  PV-DB2-TIMESTAMP1         PIC  X(26).                    01110017
011200     05  PV-DB2-TIMESTAMP2.                                       01120017
011300         20  PV-CENTURY            PIC  X(04).                    01130017
011400         20  FILLER                PIC  X(01).                    01140017
011500         20  PV-MONTH              PIC  X(02).                    01150017
011600         20  FILLER                PIC  X(01).                    01160017
011700         20  PV-DAY                PIC  X(02).                    01170017
011800         20  FILLER                PIC  X(01).                    01180017
011900         20  PV-HOUR               PIC  X(02).                    01190017
012000         20  FILLER                PIC  X(01).                    01200017
012100         20  PV-MINUTE             PIC  X(02).                    01210017
012200         20  PV-REST               PIC  X(10).                    01220017
012300     05  PV-DB2-REFORMAT-DATE.                                    01230017
012400         10  PV-DB2-DATE-MM              PIC  X(02).              01240017
012500         10  FILLER                      PIC  X(01) VALUE '/'.    01250017
012600         10  PV-DB2-DATE-DD              PIC  X(02).              01260017
012700         10  FILLER                      PIC  X(01) VALUE '/'.    01270017
012800         10  PV-DB2-DATE-CCYY            PIC  X(04).              01280017
012900     05  PV-DB2-REFORMAT-TIME.                                    01290017
013000         10  PV-DB2-TIME-HH              PIC  X(02).              01300017
013100         10  FILLER                      PIC  X(01)  VALUE ':'.   01310017
013200         10  PV-DB2-TIME-MM              PIC  X(02).              01320017
013300     05  PV-SU-BC-DIVERT-CODE.                                    01330017
013400         10  FILLER                      PIC X(02).               01340017
013500         10  PV-SU-BC-DIVERT-CD          PIC Z(03).               01350017
013600                                                                  01360017
013700******************************************************************01370017
013800*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01380017
013900******************************************************************01390017
014000     COPY DPWS013.                                                01400017
014100                                                                  01410017
014200******************************************************************01420017
014300*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        01430017
014400******************************************************************01440017
014500     COPY DPWS008.                                                01450017
014600                                                                  01460017
014700******************************************************************01470017
014800*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01480017
014900******************************************************************01490017
015000     COPY DPWS010I.                                               01500017
015100                                                                  01510017
015200******************************************************************01520017
015300*  GENERATED DSECT FOR THE PCKM883 MAPSET                         01530017
015400******************************************************************01540017
015500     COPY PCKM883.                                                01550017
015600                                                                  01560017
015700******************************************************************01570017
015800*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01580017
015900******************************************************************01590017
016000     COPY DPWS015.                                                01600017
016100                                                                  01610017
016200******************************************************************01620017
016300*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01630017
016400******************************************************************01640017
016500     COPY DFHAID.                                                 01650017
016600                                                                  01660017
016700******************************************************************01670017
016800*  COMPILE INFORMATION FOR HELP SCREEN                            01680017
016900******************************************************************01690017
017000     COPY PCWS188.                                                01700017
017100                                                                  01710017
017200******************************************************************01720017
017300*  COMMUNICATION AREA FOR HELP SCREEN PROGRAM                     01730017
017400******************************************************************01740017
017500     COPY PCWS192.                                                01750017
017600                                                                  01760017
017700*-----------------------------------------------------------------01770017
017800     EXEC SQL                                                     01780017
017900         INCLUDE TSUOBTR                                          01790017
018000     END-EXEC.                                                    01800017
018100                                                                  01810017
018200*-----------------------------------------------------------------01820017
018300     EXEC SQL                                                     01830017
018400         INCLUDE TSUOBTS                                          01840017
018500     END-EXEC.                                                    01850017
018600                                                                  01860017
018700*-----------------------------------------------------------------01870017
018800     EXEC SQL                                                     01880017
018900         INCLUDE TSUOBSC                                          01890017
019000     END-EXEC.                                                    01900017
019100                                                                  01910017
019200*-----------------------------------------------------------------01920017
019300     EXEC SQL                                                     01930017
019400         INCLUDE TCNTRID                                          01940017
019500     END-EXEC.                                                    01950017
019600                                                                  01960017
019700*-----------------------------------------------------------------01970017
019800     EXEC SQL                                                     01980017
019900         INCLUDE TCNDRST                                          01990017
020000     END-EXEC.                                                    02000017
020100                                                                  02010017
020110*-----------------------------------------------------------------02011030
020120     EXEC SQL                                                     02012030
020130         INCLUDE TCNDCDR                                          02013030
020140     END-EXEC.                                                    02014030
020150                                                                  02015030
020200*-----------------------------------------------------------------02020017
020300*  COMMUNICATIONS AREA FOR DB2                                    02030017
020400*-----------------------------------------------------------------02040017
020500     EXEC SQL                                                     02050017
020600         INCLUDE SQLCA                                            02060017
020700     END-EXEC.                                                    02070017
020800                                                                  02080017
020900******************************************************************02090017
021000 LINKAGE SECTION.                                                 02100017
021100******************************************************************02110017
021200 01  DFHCOMMAREA.                                                 02120017
021300     05  FILLER                       OCCURS 1 TO 4072 TIMES      02130017
021400                                      DEPENDING ON EIBCALEN.      02140017
021500         10  FILLER                   PIC X.                      02150017
021600                                                                  02160017
021700******************************************************************02170017
021800 PROCEDURE DIVISION.                                              02180017
021900******************************************************************02190017
022000 0000-PROGRAM-MAINLINE.                                           02200017
022100                                                                  02210017
022200     INITIALIZE  CA-COMMAREA.                                     02220017
022300     MOVE DFHCOMMAREA                TO CA-COMMAREA.              02230017
022400     MOVE LOW-VALUES                 TO PC883AI.                  02240017
022500     PERFORM 0500-BEGIN-PROCESS.                                  02250017
022600                                                                  02260017
022700******************************************************************02270017
022800 0500-BEGIN-PROCESS.                                              02280017
022900******************************************************************02290017
023000     EVALUATE TRUE                                                02300017
023100         WHEN EIBTRNID = 'Z278'                                   02310017
023200             MOVE DFHCOMMAREA          TO PC192-COMMAREA          02320017
023300             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             02330017
023400             SET PC038-PROCESS-SCREEN  TO TRUE                    02340017
023500             MOVE PC192-HOST-SAVE-MAP  TO PC883AO                 02350017
023600             MOVE -1                   TO ACARTNIDL               02360017
023700             PERFORM 1050-INITIALIZE-RETURN                       02370017
023800             PERFORM 8000-SEND-MAP                                02380017
023900             PERFORM 8200-RETURN-TRANID                           02390017
024000                                                                  02400017
024100         WHEN EIBCALEN = ZERO                                     02410017
024200         WHEN EIBAID = DFHCLEAR                                   02420017
024300         WHEN PC038-INITIALIZE-SCREEN                             02430017
024400             SET PC038-PROCESS-SCREEN     TO TRUE                 02440017
024500             MOVE -1                      TO ACARTNIDL            02450017
024600             PERFORM 1000-INITIALIZE                              02460017
024700             MOVE PC-CURRENT-PROGRAM-NAME TO PC038-LAST-PROGRAM   02470017
024800             PERFORM 8000-SEND-MAP                                02480017
024900             PERFORM 8200-RETURN-TRANID                           02490017
025000                                                                  02500017
025100         WHEN EIBAID = DFHPF3                                     02510017
025200             MOVE PC-N               TO PV-DUPLICATE-IND          02520017
025300             MOVE PC038-CALLED-PGM-NME TO PC-CALLED-FROM-PROGRAM  02530017
025400             INITIALIZE PC038-COMMON-DATA                         02540017
025500             MOVE PC-CALLED-FROM-PROGRAM TO PC038-CALLED-PGM-NME  02550017
025600             MOVE PC-PREVIOUS-PGM    TO PV-TRANSFER-PROGRAM       02560017
025700             PERFORM 8300-XCTL-TO-SELECTED-PROGRAM                02570017
025800                                                                  02580017
025900         WHEN EIBAID = DFHENTER                                   02590017
026000             MOVE PC038-CALLED-PGM-NME TO PC-CALLED-FROM-PROGRAM  02600017
026100             INITIALIZE PC038-COMMON-DATA                         02610017
026200             MOVE PC-CALLED-FROM-PROGRAM TO PC038-CALLED-PGM-NME  02620017
026300             MOVE PC-PREVIOUS-PGM TO PV-TRANSFER-PROGRAM          02630017
026400             PERFORM 8300-XCTL-TO-SELECTED-PROGRAM                02640017
026500                                                                  02650017
026600         WHEN EIBAID = DFHPF1                                     02660017
026700             PERFORM 8400-RECEIVE-MAP                             02670017
026800             MOVE PC883AO             TO PC192-HOST-SAVE-MAP      02680017
026900             PERFORM 1200-HELP-SCREEN                             02690017
027000             PERFORM 8200-RETURN-TRANID                           02700017
027100                                                                  02710017
027200         WHEN OTHER                                               02720017
027300              MOVE PC-UNRECOGNIZED-PF-KEY-MSG TO AFKMSGO          02730017
027400              MOVE -1        TO ACARTNIDL                         02740017
027500              PERFORM 8100-SEND-DATA-ONLY                         02750017
027600              PERFORM 8200-RETURN-TRANID                          02760017
027700     END-EVALUATE.                                                02770017
027800                                                                  02780017
027900     GOBACK.                                                      02790017
028000*-----------------------------------------------------------------02800017
028100 1000-INITIALIZE.                                                 02810017
028200*-----------------------------------------------------------------02820017
028300     MOVE PC038-CARTON-ID-ENTERED TO ACARTNIDO.                   02830017
028400     IF PC038-OTBND-TRIP IS > +0                                  02840017
028500         PERFORM 2000-GET-REST-OF-DATA                            02850017
028600     ELSE                                                         02860017
028700         PERFORM 3000-GET-REST-OF-DATA                            02870017
028800     END-IF.                                                      02880017
028900                                                                  02890017
029000*-----------------------------------------------------------------02900017
029100 1050-INITIALIZE-RETURN.                                          02910017
029200*-----------------------------------------------------------------02920017
029300     MOVE PC038-CARTON-ID-ENTERED TO  ACARTNIDO.                  02930017
029400     MOVE PC038-SCAC              TO  ASCACO.                     02940017
029500     MOVE PC038-TRLR-NBR          TO  ANBRO.                      02950017
029510     MOVE PC038-OTBND-TMST        TO  PV-DB2-TIMESTAMP2.          02951017
029520     MOVE PV-MONTH                TO  PV-DB2-DATE-MM.             02952017
029530     MOVE PV-DAY                  TO  PV-DB2-DATE-DD.             02953017
029540     MOVE PV-CENTURY              TO  PV-DB2-DATE-CCYY.           02954017
029550     MOVE PV-HOUR                 TO  PV-DB2-TIME-HH              02955017
029560     MOVE PV-MINUTE               TO  PV-DB2-TIME-MM              02956017
029570     MOVE PV-DB2-REFORMAT-DATE    TO  ADATEO                      02957017
029580     MOVE PV-DB2-REFORMAT-TIME    TO  ATIMEO                      02958017
029590     MOVE PC038-STATUS-USERID     TO  ABYO                        02959017
029591     MOVE PC038-DEST-OPR-ID       TO  ASTOREO.                    02959117
029592     MOVE PC038-DOOR-ID           TO  ADOORO.                     02959217
029593     MOVE PC038-TRLR-STATUS       TO  ATRLSTTO.                   02959317
029594                                                                  02959417
029595*-----------------------------------------------------------------02959517
029596 1200-HELP-SCREEN.                                                02959617
029597*-----------------------------------------------------------------02959717
029598     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02959817
029599     MOVE 'PCKRF883'                  TO PC192-PROGRAM-NAME       02959917
029600     COPY PCPD188.                                                02960017
029700     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02970017
029800     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     02980017
029900     PERFORM 8220-XCTL-TO-HELP.                                   02990017
030000                                                                  03000017
030100*-----------------------------------------------------------------03010017
030200 2000-GET-REST-OF-DATA.                                           03020017
030300*-----------------------------------------------------------------03030017
030400     EXEC SQL                                                     03040017
030500          SELECT A.DEST_OPER_UNT_ID                               03050017
030600                ,A.TRLR_SRL_NBR                                   03060017
030700                ,B.DOOR_ID                                        03070017
030800                ,B.OTBND_STAT_TMST                                03080017
030900                ,B.TRIP_STAT_CDE                                  03090017
031000                ,C.TRIP_STAT_DESC                                 03100017
031100                ,D.SCAC_CDE                                       03110017
031200           INTO :SUOBTR-DEST-OPER-UNT-ID                          03120017
031300               ,:SUOBTR-TRLR-SRL-NBR                              03130017
031400               ,:SUOBTS-DOOR-ID                                   03140017
031500               ,:PV-DB2-TIMESTAMP1                                03150017
031600               ,:SUOBTS-TRIP-STAT-CDE                             03160017
031700               ,:SUOBSC-TRIP-STAT-DESC                            03170017
031800               ,:CNTRID-SCAC-CDE                                  03180017
031900           FROM  TSUOBTR A                                        03190017
032000                ,TSUOBTS B                                        03200017
032100                ,TSUOBSC C                                        03210017
032200                ,TCNTRID D                                        03220017
032300           WHERE A.OTBND_TRIP_ID = :PC038-OTBND-TRIP              03230017
032400             AND A.OTBND_TRIP_ID = B.OTBND_TRIP_ID                03240017
032500             AND B.TRIP_STAT_CDE = C.TRIP_STAT_CDE                03250017
032600             AND A.TRLR_SRL_NBR  = D.TRLR_SRL_NBR                 03260017
032700             AND B.OTBND_STAT_TMST IN                             03270017
032800                     (SELECT MAX(Y.OTBND_STAT_TMST)               03280017
032900                        FROM TSUOBTR X                            03290017
033000                            ,TSUOBTS Y                            03300017
033100                       WHERE X.OTBND_TRIP_ID = :PC038-OTBND-TRIP  03310017
033200                         AND X.OTBND_TRIP_ID = Y.OTBND_TRIP_ID)   03320017
033300     END-EXEC.                                                    03330017
033400                                                                  03340017
033500     EVALUATE TRUE                                                03350017
033600         WHEN SQLCODE = ZERO                                      03360017
033700             MOVE CNTRID-SCAC-CDE           TO  ASCACO            03370017
033800                                                PC038-SCAC        03380017
033900             MOVE SUOBTR-TRLR-SRL-NBR       TO  ANBRO             03390017
034000                                                PC038-TRLR-NBR    03400017
034100             MOVE PV-DB2-TIMESTAMP1         TO  PV-DB2-TIMESTAMP2 03410017
034200             MOVE PV-DB2-TIMESTAMP2         TO  PC038-OTBND-TMST  03420017
034300             MOVE PV-MONTH                  TO  PV-DB2-DATE-MM    03430017
034400             MOVE PV-DAY                    TO  PV-DB2-DATE-DD    03440017
034500             MOVE PV-CENTURY                TO  PV-DB2-DATE-CCYY  03450017
034600             MOVE PV-HOUR                   TO  PV-DB2-TIME-HH    03460017
034700             MOVE PV-MINUTE                 TO  PV-DB2-TIME-MM    03470017
034800             MOVE PV-DB2-REFORMAT-DATE      TO  ADATEO            03480017
034900             MOVE PV-DB2-REFORMAT-TIME      TO  ATIMEO            03490017
035000             MOVE PC038-STATUS-USERID       TO  ABYO              03500017
035100             MOVE SUOBTR-DEST-OPER-UNT-ID   TO  ASTOREO           03510017
035200                                                PC038-DEST-OPR-ID 03520017
035300             MOVE SUOBTS-DOOR-ID             TO  ADOORO           03530017
035400                                                PC038-DOOR-ID     03540017
035500             MOVE SUOBSC-TRIP-STAT-DESC      TO  ATRLSTTO         03550017
035600                                                PC038-TRLR-STATUS 03560017
035700         WHEN SQLCODE = +100                                      03570017
035800                 MOVE SPACES                 TO  ASCACO           03580017
035900                                                 ANBRO            03590017
036000                                                 ABYO             03600017
036100                                                 ASTOREO          03610017
036200                                                 ADOORO           03620017
036300                                                 ATRLSTTO         03630017
036400         WHEN SQLWARN0 NOT = SPACES                               03640017
036500         WHEN SQLCODE NOT EQUAL ZERO                              03650017
036600             MOVE '2000-GET-REST-OF-DATA' TO DP013-PARAGRAPH      03660017
036700             MOVE SQLCA                TO DP013-SQLCA             03670017
036800             MOVE 'TSUOBTR'            TO DP013-DB2-TABLE-NAME(1) 03680017
036900             SET DP013-DB2-ABEND                                  03690017
037000                 DP013-ROLLBACK                                   03700017
037100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               03710017
037200             PERFORM DP014-0000-PROCESS-ABEND                     03720017
037300     END-EVALUATE.                                                03730017
037400                                                                  03740017
037500*-----------------------------------------------------------------03750017
037600 3000-GET-REST-OF-DATA.                                           03760017
037700*-----------------------------------------------------------------03770017
037801     MOVE PC038-SHPUNT-ORGN-OPER     TO DK-OPER-UNT-ID.           03780124
037802     MOVE PC038-SHPUNT-DEST-OPER     TO DK-STR-NBR.               03780225
037803                                                                  03780324
037810     EXEC SQL                                                     03781019
037900         SELECT A.DOOR_ID                                         03790030
038000          INTO :CNDRST-DOOR-ID                                    03800017
038100          FROM TCNDRST A                                          03810030
038110             , TCNDCDR B                                          03811030
038200         WHERE A.OPER_UNT_ID    =  :DK-OPER-UNT-ID                03820030
038300           AND A.STR_NBR        =  :DK-STR-NBR                    03830030
038400           AND A.END_TMST       =  :PC-DEFAULT-TIMESTAMP          03840030
038401           AND A.OPER_UNT_ID    =  B.OPER_UNT_ID                  03840130
038402           AND A.DOOR_ID        =  B.DOOR_ID                      03840230
038410           AND B.DOOR_LOC_DESC NOT LIKE '%RE-OPEN%'               03841030
038420           AND B.DOOR_LOC_DESC NOT LIKE '%UPS%'                   03842030
038430           AND B.DOOR_LOC_DESC NOT LIKE '%VIRTUAL%'               03843030
038500     END-EXEC.                                                    03850017
038600                                                                  03860017
038700     EVALUATE TRUE                                                03870017
038800         WHEN SQLCODE = ZERO                                      03880017
038900             MOVE SPACES                  TO  ASCACO              03890019
039000                                              ANBRO               03900019
039100                                              ADATEO              03910019
039200                                              ATIMEO              03920019
039300                                              ATRLSTTO            03930019
039400             MOVE PC038-STATUS-USERID     TO  ABYO                03940019
039500             MOVE DK-STR-NBR              TO  ASTOREO             03950019
039600             MOVE CNDRST-DOOR-ID          TO  ADOORO              03960019
039700         WHEN SQLCODE = +100                                      03970017
039800             MOVE SPACES                  TO  ASCACO              03980019
039900                                              ANBRO               03990019
040000                                              ABYO                04000019
040100                                              ASTOREO             04010019
040200                                              ADOORO              04020019
040300                                              ATRLSTTO            04030019
040400         WHEN SQLCODE = -811                                      04040017
040500             MOVE SPACES                  TO  ASCACO              04050019
040600                                              ANBRO               04060019
040700                                              ATRLSTTO            04070019
040800             MOVE PC038-STATUS-USERID     TO  ABYO                04080019
040900             MOVE DK-STR-NBR              TO  ASTOREO             04090019
041000             MOVE 'MULT'                  TO  ADOORO              04100019
041100         WHEN SQLWARN0 NOT = SPACES                               04110017
041200         WHEN SQLCODE NOT EQUAL ZERO                              04120017
041300             MOVE '3000-GET-REST-OF-DATA'  TO DP013-PARAGRAPH     04130017
041400             MOVE SQLCA                    TO DP013-SQLCA         04140019
041500             MOVE 'TCNDRST'            TO DP013-DB2-TABLE-NAME(1) 04150017
041510             MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID          04151018
041520             MOVE DK-STR-NBR           TO PV-STR-NBR              04152018
041530             MOVE PV-OPER-UNT-ID       TO DP013-MESSAGE-TEXT(1)   04153018
041540             MOVE PV-STR-NBR           TO DP013-MESSAGE-TEXT(2)   04154018
041600             SET DP013-DB2-ABEND                                  04160017
041700                 DP013-ROLLBACK                                   04170017
041800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               04180017
041900             PERFORM DP014-0000-PROCESS-ABEND                     04190017
042000     END-EVALUATE.                                                04200017
042100                                                                  04210017
042200*---------------------------------------------------------------- 04220017
042300 8000-SEND-MAP.                                                   04230017
042400*-----------------------------------------------------------------04240017
042500     EXEC CICS                                                    04250017
042600         SEND MAP       ('PC883A')                                04260017
042700              MAPSET    ('PCKM883')                               04270017
042800              ERASE                                               04280017
042900              CURSOR                                              04290017
043000              RESP      (PV-CICS-RESPONSE)                        04300017
043100     END-EXEC.                                                    04310017
043200                                                                  04320017
043300     EVALUATE TRUE                                                04330017
043400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04340017
043500              CONTINUE                                            04350017
043600         WHEN OTHER                                               04360017
043700              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           04370017
043800              MOVE 'UNABLE TO SEND MAP'                           04380017
043900                                     TO DP013-MESSAGE-TEXT (1)    04390017
044000              SET DP013-CICS-ABEND   TO TRUE                      04400017
044100              SET DP013-ROLLBACK     TO TRUE                      04410017
044200              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04420017
044300     END-EVALUATE.                                                04430017
044400                                                                  04440017
044500*-----------------------------------------------------------------04450017
044600 8100-SEND-DATA-ONLY.                                             04460017
044700*-----------------------------------------------------------------04470017
044800     EXEC CICS                                                    04480017
044900         SEND MAP       ('PC883A')                                04490017
045000              MAPSET    ('PCKM883')                               04500017
045100              CURSOR                                              04510017
045200              DATAONLY                                            04520017
045300              RESP      (PV-CICS-RESPONSE)                        04530017
045400     END-EXEC.                                                    04540017
045500                                                                  04550017
045600     EVALUATE TRUE                                                04560017
045700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04570017
045800              CONTINUE                                            04580017
045900         WHEN OTHER                                               04590017
046000              MOVE '8100-SEND-DATA-ONLY' TO DP013-PARAGRAPH       04600017
046100              MOVE 'UNABLE TO SEND DATA'                          04610017
046200                                     TO DP013-MESSAGE-TEXT (1)    04620017
046300              SET DP013-CICS-ABEND   TO TRUE                      04630017
046400              SET DP013-ROLLBACK     TO TRUE                      04640017
046500              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04650017
046600     END-EVALUATE.                                                04660017
046700                                                                  04670017
046800*-----------------------------------------------------------------04680017
046900 8200-RETURN-TRANID.                                              04690017
047000*-----------------------------------------------------------------04700017
047100     MOVE LENGTH OF CA-COMMAREA   TO PC-COMMAREA-LENGTH           04710017
047200     EXEC CICS                                                    04720017
047300         RETURN TRANSID   (PC-DUPLICATE)                          04730017
047400                COMMAREA  (CA-COMMAREA)                           04740017
047500                LENGTH    (PC-COMMAREA-LENGTH)                    04750017
047600                RESP      (PV-CICS-RESPONSE)                      04760017
047700     END-EXEC.                                                    04770017
047800                                                                  04780017
047900     EVALUATE TRUE                                                04790017
048000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04800017
048100              CONTINUE                                            04810017
048200         WHEN OTHER                                               04820017
048300              MOVE '8200-RETURN-TRANID' TO DP013-PARAGRAPH        04830017
048400              MOVE 'UNABLE TO RETURN TO TRANID'                   04840017
048500                                     TO DP013-MESSAGE-TEXT (1)    04850017
048600              SET DP013-CICS-ABEND   TO TRUE                      04860017
048700              SET DP013-ROLLBACK     TO TRUE                      04870017
048800              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04880017
048900     END-EVALUATE.                                                04890017
049000                                                                  04900017
049100*-----------------------------------------------------------------04910017
049200 8220-XCTL-TO-HELP.                                               04920017
049300*-----------------------------------------------------------------04930017
049400     MOVE LENGTH OF PC192-COMMAREA    TO PC-COMMAREA-LENGTH       04940017
049500                                                                  04950017
049600     EXEC CICS                                                    04960017
049700         XCTL                                                     04970017
049800             PROGRAM   (PV-TRANSFER-PROGRAM)                      04980017
049900             COMMAREA  (PC192-COMMAREA)                           04990017
050000             LENGTH    (PC-COMMAREA-LENGTH)                       05000017
050100             RESP      (PV-CICS-RESPONSE)                         05010017
050200     END-EXEC.                                                    05020017
050300                                                                  05030017
050400     EVALUATE TRUE                                                05040017
050500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05050017
050600              CONTINUE                                            05060017
050700         WHEN OTHER                                               05070017
050800             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          05080017
050900             MOVE 'PCKRF883 - UNABLE TO XCTL TO PROGRAM: '        05090017
051000                                      TO DP013-MESSAGE-TEXT (1)   05100017
051100             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   05110017
051200             SET DP013-CICS-ABEND                                 05120017
051300                 DP013-ROLLBACK       TO TRUE                     05130017
051400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05140017
051500             MOVE PC-TRANS-UNAVAILABLE-MSG TO AFKMSGO             05150017
051600             SET PC038-PROCESS-SCREEN TO TRUE                     05160017
051700             MOVE -1                  TO AFKMSGL                  05170017
051800             PERFORM 8000-SEND-MAP                                05180017
051900             PERFORM 8200-RETURN-TRANID                           05190017
052000     END-EVALUATE.                                                05200017
052100                                                                  05210017
052200*-----------------------------------------------------------------05220017
052300 8300-XCTL-TO-SELECTED-PROGRAM.                                   05230017
052400*-----------------------------------------------------------------05240017
052500     SET PC038-INITIALIZE-SCREEN     TO TRUE.                     05250017
052600     MOVE PC-CURRENT-PROGRAM-NAME    TO PC038-LAST-PROGRAM.       05260017
052700                                                                  05270017
052800     MOVE LENGTH OF CA-COMMAREA   TO PC-COMMAREA-LENGTH           05280017
052900     EXEC CICS                                                    05290017
053000         XCTL                                                     05300017
053100             PROGRAM   (PV-TRANSFER-PROGRAM)                      05310017
053200             COMMAREA  (CA-COMMAREA)                              05320017
053300             LENGTH    (PC-COMMAREA-LENGTH)                       05330017
053400             RESP      (PV-CICS-RESPONSE)                         05340017
053500     END-EXEC.                                                    05350017
053600                                                                  05360017
053700     EVALUATE TRUE                                                05370017
053800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05380017
053900              CONTINUE                                            05390017
054000         WHEN OTHER                                               05400017
054100              MOVE '8300-XCTL-TO-SELECTED-PROGRAM'                05410017
054200                                               TO DP013-PARAGRAPH 05420017
054300              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       05430017
054400                                        TO DP013-MESSAGE-TEXT (1) 05440017
054500              MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)  05450017
054600              SET DP013-CICS-ABEND   TO TRUE                      05460017
054700              SET DP013-ROLLBACK     TO TRUE                      05470017
054800              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              05480017
054900              MOVE PC-TRANS-UNAVAILABLE-MSG TO AFKMSGO            05490017
055000              SET PC038-PROCESS-SCREEN TO TRUE                    05500017
055100              PERFORM 8100-SEND-DATA-ONLY                         05510017
055200              PERFORM 8200-RETURN-TRANID                          05520017
055300     END-EVALUATE.                                                05530017
055400                                                                  05540017
055500*-----------------------------------------------------------------05550017
055600 8400-RECEIVE-MAP.                                                05560017
055700*-----------------------------------------------------------------05570017
055800     EXEC CICS                                                    05580017
055900         RECEIVE MAP    ('PC883A')                                05590017
056000                 MAPSET ('PCKM883')                               05600017
056100                 RESP   (PV-CICS-RESPONSE)                        05610017
056200     END-EXEC.                                                    05620017
056300                                                                  05630017
056400     EVALUATE TRUE                                                05640017
056500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05650017
056600         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                05660017
056700              CONTINUE                                            05670017
056800         WHEN OTHER                                               05680017
056900              MOVE '8400-RECEIVE-MAP' TO DP013-PARAGRAPH          05690017
057000              MOVE 'UNABLE TO RECEIVE MAP'                        05700017
057100                                     TO DP013-MESSAGE-TEXT (1)    05710017
057200              SET DP013-LOGIC-ABEND  TO TRUE                      05720017
057300              SET DP013-ROLLBACK     TO TRUE                      05730017
057400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              05740017
057500     END-EVALUATE.                                                05750017
057600                                                                  05760017
057700*-----------------------------------------------------------------05770017
057800 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  05780017
057900*-----------------------------------------------------------------05790017
058000     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            05800017
058100     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           05810017
058200     INITIALIZE DP013-SRC-TASK-NUMBER                             05820017
058300                DP013-STACK.                                      05830017
058400     SET DP013-LINK-RETURN           TO TRUE.                     05840017
058500                                                                  05850017
058600     EXEC CICS                                                    05860017
058700         LINK                                                     05870017
058800             PROGRAM   (DP013-NAME)                               05880017
058900             COMMAREA  (DP013-PARAMETERS)                         05890017
059000             LENGTH    (DP013-LENGTH)                             05900017
059100     END-EXEC.                                                    05910017
059200                                                                  05920017
059300*----------------------------------------------------------------*05930017
059400*    ABEND PROCESSOR MODULE                                      *05940017
059500*----------------------------------------------------------------*05950017
059600     COPY DPPD014.                                                05960017
