000100*-----------------------*                                         00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300*-----------------------*                                         00030004
000400 PROGRAM-ID.    RCKCS261.                                         00040004
000500 AUTHOR.        LARRY SCHLEICHER - STRATAGEM.                     00050004
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060004
000700 DATE-WRITTEN.  04-04-95.                                         00070004
000800 DATE-COMPILED.                                                   00080004
000900                                                                  00090004
001000*---------------------------------------------------------------* 00100004
001100*    E261 - RECEIVING SHIPMENT LIST.                            * 00110004
001200*                                                               * 00120004
001300*    THIS PROGRAM GENERATES A LIST OF SHIPMENTS THAT ARE        * 00130004
001400*    ASSOCIATED TO THE SPECIFIED VEHICLE AND ALSO ALL OF        * 00140004
001500*    FORECAST SHIPMENTS FOR THE ORIGIN OR THE DELIVERY SCAC.    * 00150004
001600*                                                               * 00160004
001700*---------------------------------------------------------------* 00170004
001710* CHANGED 12-01-2011 CHRISTINE TWIEHAUS WR#40574                 *00171004
001711*         ADDED CAN (CARR_AUTH_ID)                               *00171104
001712*---------------------------------------------------------------* 00171204
001713* CHANGED 08/15/2022    BY BARB SCHULTZ    WR: CHG0273427        *00171309
001714* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE    *00171410
001715* MAKING THE CALL DYNAMIC VS STATIC.                             *00171510
001717*---------------------------------------------------------------* 00171706
001718 EJECT                                                            00171806
001719 ENVIRONMENT DIVISION.                                            00171906
001720                                                                  00172006
001721 DATA DIVISION.                                                   00172106
001722                                                                  00172206
001723 WORKING-STORAGE SECTION.                                         00172306
001724                                                                  00172406
001725 01  DK-DB2-KEYS.                                                 00172506
001730     05  DK-DEPT-NBR                    PIC X(03)  VALUE SPACES.  00173004
001740     05  DK-PO-NBR                      PIC S9(09)  COMP VALUE +0.00174004
001750     05  DK-REC-SEQ-NBR                 PIC S9(09)  COMP VALUE +0.00175004
001760     05  DK-RCVR-NBR                    PIC S9(09)  COMP VALUE +0.00176004
001770     05  DK-OPER-SET-ID                 PIC S9(04)  COMP VALUE +0.00177004
001780     05  DK-AGRMT-TYP-ID                PIC  X(01)  VALUE SPACE.  00178004
001790     05  DK-TYP-CDE                     PIC S9(04)  VALUE ZERO    00179004
001800                                                    COMP.         00180004
001900     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00190004
002000                                                    COMP.         00200004
002100     05  DK-FCLTY-ID                    PIC S9(04)  VALUE ZERO    00210004
002200                                                    COMP.         00220004
002300     05  DK-ORIGIN-SCAC-ID              PIC  X(04)  VALUE SPACE.  00230004
002400     05  DK-DELIVERY-SCAC-ID            PIC  X(04)  VALUE SPACE.  00240004
002500     05  DK-SCAC-ID                     PIC  X(04)  VALUE SPACE.  00250004
002600     05  DK-VEHICLE-NBR                 PIC  X(10)  VALUE SPACE.  00260004
002700     05  DK-VEH-NBR                     PIC  X(10)  VALUE SPACE.  00270004
002800     05  DK-SHIPT-ID                    PIC S9(09)  VALUE +0      00280004
002900                                                    COMP.         00290004
003000     05  DK-TRIP-ID                     PIC S9(09)  VALUE +0      00300004
003100                                                    COMP.         00310004
003200     05  DK-PRO-B                       PIC  X(22)  VALUE SPACE.  00320004
003300     05  DK-PRO-E                       PIC  X(22)  VALUE SPACE.  00330004
003400     05  DK-BOL-B                       PIC  X(30)  VALUE SPACES. 00340004
003500     05  DK-BOL-E                       PIC  X(30)  VALUE SPACES. 00350004
003600 01  DN-DB2-NULL-INDICATORS.                                      00360004
003700     05  DN-TRIP-ID                   PIC S9(04) COMP VALUE +0.   00370004
003800     05  DN-EST-AR-TMST               PIC S9(04) COMP VALUE +0.   00380004
003900     05  DN-VEH-NBR                   PIC S9(04) COMP VALUE +0.   00390004
004000     05  DN-CURR-TRIP-ID              PIC S9(04) COMP VALUE +0.   00400004
004100                                                                  00410004
004200 01  PC-PROGRAM-CONSTANTS.                                        00420004
004300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00430004
004400                                                    'RC261A  '.   00440004
004500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00450004
004600                                                    'RCKM261 '.   00460004
004700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00470004
004800                                                    'RCKCS261'.   00480004
004900     05  PC-RANDNBR-PGM                 PIC X(08)   VALUE         00490004
005000                                                    'DPKUT902'.   00500004
005100     05  PC-DPKUT500                    PIC  X(08)  VALUE         00510004
005200                                                    'DPKUT500'.   00520004
005500     05  PC-TROUBLE-RTN                 PIC X(08)   VALUE         00550004
005600                                                    'TMKCS520'.   00560004
005700* JAK 04/2007 - ADD NEW FIELDS - START                            00570004
005800     05  PC-WMS-CONTROL-MOD             PIC X(8) VALUE 'WSKCS305'.00580004
005900     05  PC-DEFAULT-NINES               PIC X(26)  VALUE          00590004
006000                              '9999-09-09-09.09.09.999999'.       00600004
006100* JAK 04/2007 - ADD NEW FIELDS - END                              00610004
006200     05  PC-TROUBLE-RTN-LENGTH          PIC S9(04)  VALUE         00620004
006300                                                    +600 COMP.    00630004
006400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00640004
006500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00650004
006600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00660004
006700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00670004
006800                                                    COMP SYNC.    00680004
006900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00690004
007000                                                    COMP SYNC.    00700004
007100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00710004
007200                                                    +1000000      00720004
007300                                                    COMP-3.       00730004
007400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00740004
007500                                                    COMP SYNC.    00750004
007600     05  PC-DEFAULT-TMST                PIC  X(26)  VALUE         00760004
007700                                   '0001-01-01-00.00.00.000000'.  00770004
007800     05  PC-DEFAULT-TMST-9S             PIC  X(26)  VALUE         00780004
007900                                   '9999-09-09-09.09.09.999999'.  00790004
008000     05  PC-DEFAULT-DATE                PIC  X(10)  VALUE         00800004
008100                                                    '0001-01-01'. 00810004
008200     05  PC-DEFAULT-9DATE               PIC  X(10)  VALUE         00820004
008300                                                    '9999-09-09'. 00830004
008400     05  PC-DEFAULT-TIME              PIC X(08)  VALUE            00840004
008500                                                 '00.00.00'.      00850004
008600     05  PC-DELETED-STATUS-CDE          PIC  X(02)  VALUE 'DE'.   00860004
008700     05  PC-I                           PIC  X(01)  VALUE  'I'.   00870004
008800     05  PC-A                           PIC  X(01)  VALUE  'A'.   00880004
008900     05  PC-U                           PIC  X(01)  VALUE  'U'.   00890004
009000     05  PC-49                          PIC  X(02)  VALUE  '49'.  00900004
009100     05  PC-EN                          PIC  X(02)  VALUE  'EN'.  00910004
009200     05  PC-ET                          PIC  X(02)  VALUE  'ET'.  00920004
009300*                                                                 00930004
009400     05  PC-TSYMSG-NUMBERS.                                       00940004
009500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00950004
009600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00960004
009700         10  PC-TSYMSG-00009            PIC  9(05)  VALUE 00009.  00970004
009800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00980004
009900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00990004
010000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01000004
010100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01010004
010200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01020004
010300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01030004
010400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01040004
010500         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01050004
010600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01060004
010700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01070004
010800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01080004
010900         10  PC-TSYMSG-00117            PIC  9(05)  VALUE 00117.  01090004
011000         10  PC-TSYMSG-00146            PIC  9(05)  VALUE 00146.  01100004
011100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01110004
011200         10  PC-TSYMSG-00391            PIC  9(05)  VALUE 00391.  01120004
011300         10  PC-TSYMSG-00743            PIC  9(05)  VALUE 00743.  01130004
011400         10  PC-TSYMSG-00847            PIC  9(05)  VALUE 00847.  01140004
011500         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01150004
011600         10  PC-TSYMSG-01015            PIC  9(05)  VALUE 01015.  01160004
011700         10  PC-TSYMSG-01061            PIC  9(05)  VALUE 01061.  01170004
011800         10  PC-TSYMSG-01088            PIC  9(05)  VALUE 01088.  01180004
011900         10  PC-TSYMSG-01160            PIC  9(05)  VALUE 01160.  01190004
012000         10  PC-TSYMSG-02285            PIC  9(05)  VALUE 02285.  01200004
012100         10  PC-TSYMSG-02301            PIC  9(05)  VALUE 02301.  01210004
012200* JAK 04/2007 - NEW MESSAGES - START                              01220004
012300         10  PC-TSYMSG-03138            PIC  9(05)  VALUE 03138.  01230004
012400         10  PC-TSYMSG-03533            PIC  9(05)  VALUE 03533.  01240004
012500         10  PC-TSYMSG-03534            PIC  9(05)  VALUE 03534.  01250004
012600         10  PC-TSYMSG-03543            PIC  9(05)  VALUE 03543.  01260004
012700         10  PC-TSYMSG-03546            PIC  9(05)  VALUE 03546.  01270004
012800         10  PC-TSYMSG-03548            PIC  9(05)  VALUE 03548.  01280004
012900         10  PC-TSYMSG-03561            PIC  9(05)  VALUE 03561.  01290004
013000* JAK 04/2007 - NEW MESSAGES - END                                01300004
013100*                                                                 01310004
013110 01  PS-PROGRAM-SWITCHES.                                         01311004
013120     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01312004
013130         88  PS-NO-ERROR                            VALUE 'Y'.    01313004
013140         88  PS-ERROR                               VALUE 'N'.    01314004
013150     05  PS-VEND-SHIP-DTE-SW            PIC  X(01)  VALUE 'N'.    01315004
013160         88  PS-NO-VND-SHP-DTE-ERR                  VALUE 'N'.    01316004
013170         88  PS-VEND-SHIP-DTE-ERROR                 VALUE 'Y'.    01317004
013180     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01318004
013190         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01319004
013200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01320004
013300     05  PS-END-OF-CURSOR-SW            PIC  X(01)  VALUE 'N'.    01330004
013400         88  PS-END-OF-CURSOR                       VALUE 'Y'.    01340004
013500         88  PS-NOT-END-OF-CURSOR                   VALUE 'N'.    01350004
013600     05  PS-END-OF-STATUS-CURSOR-SW     PIC  X(01)  VALUE 'N'.    01360004
013700         88  PS-END-OF-STATUS-CURSOR          VALUE 'Y'.          01370004
013800         88  PS-NOT-END-OF-STATUS-CURSOR      VALUE 'N'.          01380004
013900     05  PS-TRECVER-CURSOR-SW     PIC  X(01)  VALUE 'N'.          01390004
014000         88  PS-EOF-TRECVER-CSR               VALUE 'Y'.          01400004
014100         88  PS-NOT-EOF-TRECVER-CSR           VALUE 'N'.          01410004
014200     05  PS-TOSOPFA-CURSOR-SW     PIC  X(01)  VALUE 'N'.          01420004
014300         88  PS-EOF-TOSOPFA-CSR               VALUE 'Y'.          01430004
014400     05  PS-INSTRUCTION-SW        PIC  X(01)  VALUE 'N'.          01440004
014500         88  PS-FIRST-INSTRUCTION             VALUE 'Y'.          01450004
014600     05  PS-UPDATE-SHPTPO-SW      PIC  X(01)  VALUE 'N'.          01460004
014700         88  PS-UPDATE-SHPTPO                 VALUE 'Y'.          01470004
014800         88  PS-DONT-UPDATE-SHPTPO            VALUE 'N'.          01480004
014900     05  PS-CONTINUE-FUNC-03-SW   PIC  X(01)  VALUE 'N'.          01490004
015000         88  PS-CONTINUE-FUNC-03              VALUE 'Y'.          01500004
015100         88  PS-END-FUNC-03                   VALUE 'N'.          01510004
015200     05  PS-OR-AND-CURSOR-SW      PIC  X(01)  VALUE 'N'.          01520004
015300         88  PS-OR-CURSOR                     VALUE 'Y'.          01530004
015400         88  PS-AND-CURSOR                    VALUE 'N'.          01540004
015500     05  PS-DUPLICATE-SHIPMT-SW   PIC  X(01)  VALUE 'N'.          01550004
015600         88  PS-DUPLICATE-SHIPMT              VALUE 'Y'.          01560004
015700         88  PS-NO-DUPLICATE-SHIPMT           VALUE 'N'.          01570004
015800     05  PS-VALID-SHIPMT-SELECTED-SW PIC X(1) VALUE 'N'.          01580004
015900         88  PS-VALID-SHIPMT-SELECTED         VALUE 'Y'.          01590004
016000         88  PS-NO-VALID-SHIPMT-SELECTED      VALUE 'N'.          01600004
016100     05  PS-PO-NOW-ON-TRAILER-SW  PIC  X(01)  VALUE 'N'.          01610004
016200         88  PS-PO-NOW-ON-TRAILER             VALUE 'Y'.          01620004
016300         88  PS-PO-NOT-ON-TRAILER             VALUE 'N'.          01630004
016400     05  PS-COMPLETE-UPDATES-SW   PIC  X(01)  VALUE 'N'.          01640004
016500         88  PS-COMPLETE-UPDATES              VALUE 'Y'.          01650004
016600     05  PS-RCVR-FOUND-SW         PIC  X(01)  VALUE 'N'.          01660004
016700         88  PS-RCVR-FOUND                    VALUE 'Y'.          01670004
016800         88  PS-NO-RCVR-FOUND                 VALUE 'N'.          01680004
016900* JAK 04/2007 - ADD NEW SWITCHES - START                          01690004
017000     05  PS-ASNS-TO-WMS-SW            PIC X(01) VALUE 'N'.        01700004
017100         88  PS-ASNS-TO-WMS-YES                 VALUE 'Y'.        01710004
017200         88  PS-ASNS-TO-WMS-NO                  VALUE 'N'.        01720004
017300     05  PS-MSGS-TRNSCRB-SW           PIC X(01) VALUE 'N'.        01730004
017400         88  PS-MSGS-TRNSCRB-YES                VALUE 'Y'.        01740004
017500         88  PS-MSGS-TRNSCRB-NO                 VALUE 'N'.        01750004
017600     05  PS-RECEIVING-BEGUN-SW        PIC X(01) VALUE 'N'.        01760004
017700         88  PS-RECEIVING-BEGUN-YES             VALUE 'Y'.        01770004
017800         88  PS-RECEIVING-BEGUN-NO              VALUE 'N'.        01780004
017810     05  PS-WMS-MESSAGE-SW            PIC X(01) VALUE 'N'.        01781004
017820         88  PS-WMS-MESSAGE-YES                 VALUE 'Y'.        01782004
017830         88  PS-WMS-MESSAGE-NO                  VALUE 'N'.        01783004
017840     05  PS-TYPE-OF-WMS-SW            PIC X(01) VALUE 'I'.        01784004
017850         88  PS-WMS-INSERT                      VALUE 'I'.        01785004
017860         88  PS-WMS-DETACH                      VALUE 'D'.        01786004
017870* JAK 04/2007 - ADD NEW SWITCHES - END                            01787004
017880*                                                                 01788004
017890 01  PV-PROGRAM-VARIABLES.                                        01789004
017891     05  PV-SUB                         PIC S9(04)  VALUE +0      01789104
017892                                                    COMP SYNC.    01789204
017893* JAK 04/2007 - ADD NEW FIELDS - START                            01789304
017894     05  PV-SQL-COUNT                   PIC S9(09)  VALUE +0      01789404
017895                                                    COMP-3.       01789504
017896     05  PV-COMMAREA-LENGTH             PIC S9(04)  VALUE +0      01789604
017897                                                    COMP SYNC.    01789704
017898* JAK 04/2007 - ADD NEW FIELDS - END                              01789804
017899     05  PV-PACK-BY-ST-IND              PIC  X(01).               01789904
017900     05  PV-PRE-TICKET-IND              PIC  X(01).               01790004
018000     05  PV-GARM-ON-HNGR-IND            PIC  X(01).               01800004
018100     05  PV-WO-INSTR-SEQ-NBR            PIC S9(04)  VALUE +0      01810004
018200                                                    COMP SYNC.    01820004
018210     05  PV-ABSTIME                     PIC S9(15)  COMP.         01821004
018220     05  PV-CURRENT-DATE                PIC  9(06).               01822004
018230     05  PV-CURRENT-TIME                PIC  9(06).               01823004
018240     05  PV-SHIPMENT-COUNT              PIC S9(09)  VALUE +0      01824004
018250                                                    COMP-3.       01825004
018260     05  PV-NUMBER-OF-UPDATES           PIC S9(04)  VALUE +0      01826004
018270                                                    COMP-3.       01827004
018280     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01828004
018290                                                    COMP SYNC.    01829004
018300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01830004
018400                                                    COMP-3.       01840004
018500     05  PV-COUNT                       PIC S9(09)  VALUE +0      01850004
018600                                                    COMP-3.       01860004
018700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01870004
018800                                                    COMP-3.       01880004
018900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01890004
019000                                                    COMP-3.       01900004
019100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01910004
019200                                                    COMP-3.       01920004
019300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01930004
019400                                                    COMP SYNC.    01940004
019500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01950004
019600                                                    COMP SYNC.    01960004
019700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01970004
019800                                                    COMP SYNC.    01980004
019900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01990004
020000                                                    COMP SYNC.    02000004
020100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02010004
020200                                                    COMP SYNC.    02020004
020300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02030004
020400                                                    COMP SYNC.    02040004
020500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02050004
020600                                                    COMP SYNC.    02060004
020700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02070004
020800                                                    COMP SYNC.    02080004
020900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02090004
021000                                                    COMP SYNC.    02100004
021100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02110004
021200                                                    COMP SYNC.    02120004
021300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02130004
021400                                                    COMP SYNC.    02140004
021500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02150004
021600                                                    COMP SYNC.    02160004
021700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02170004
021800                                                    COMP SYNC.    02180004
021900     05  PV-SHIPMENT-CSR-IND            PIC  X(01)  VALUE SPACES. 02190004
022000     05  PV-VEND-SHIP-DTE               PIC  X(10)  VALUE SPACES. 02200004
022100     05  PV-DB2-COUNT                   PIC S9(04)  VALUE +0      02210004
022200                                                    COMP SYNC.    02220004
022300     05  PV-CURR-TRIP-ID                PIC S9(09)  VALUE +0      02230004
022400                                                    COMP SYNC.    02240004
022500     05  PV-TRIP-ID                     PIC S9(09)  VALUE +0      02250004
022600                                                    COMP SYNC.    02260004
022700     05  PV-SAVE-TRIP-ID                PIC S9(09)  VALUE +0      02270004
022800                                                    COMP SYNC.    02280004
022900     05  PV-VHTRIP-COUNT                PIC S9(09)  VALUE +0      02290004
023000                                                    COMP-3.       02300004
023100     05  PV-REC-SEQ-NBR                 PIC S9(09)  VALUE +0      02310004
023200                                                    COMP SYNC.    02320004
023300     05  PV-VER-NBR                     PIC S9(09)  VALUE +0      02330004
023400                                                    COMP SYNC.    02340004
023500     05  PV-TRN-CDE                     PIC X       VALUE SPACE.  02350004
023600     05  PV-CLASS-NBR-99                PIC 99.                   02360004
023700     05  PV-CLASS-NBR-2CH               PIC X(2).                 02370004
023800     05  PV-DISP-PO                     PIC Z(08)9.               02380004
023900     05  PV-DISP-RCVR                   PIC Z(04)9.               02390004
024000     05  PV-DISP-SHIPT-ID               PIC Z(09)9.               02400004
024100     05  PV-DISP-SHIPT-EXP-QTY          PIC Z(08)9.               02410004
024200     05  PV-DISP-SHIPT-ACT-QTY          PIC Z(08)9.               02420004
024300     05  PV-DISP-TRIP-ID                PIC Z(09)9.               02430004
024400     05  PV-DISP-OPER-ID                PIC Z(04)9.               02440004
024500     05  PV-DISP-FACILITY               PIC Z(04)9.               02450004
024600     05  PV-DISP-PO-VERSION             PIC Z(08)9.               02460004
024700     05  PV-DISP-PO-LINE                PIC Z(04)9.               02470004
024800     05  PV-DISP-TYPE-CD                PIC Z(03)9.               02480004
024900     05  PV-DISP-OPER-SET               PIC Z(04)9.               02490004
025000     05  PV-MESSAGE.                                              02500004
025100         10  PV-MESSAGE1                PIC X(10).                02510004
025200         10  PV-FILLER                  PIC X(01).                02520004
025300         10  PV-MESSAGE2                PIC X(10).                02530004
025310         10  PV-FILLER                  PIC X(01).                02531004
025320         10  PV-MESSAGE3                PIC X(10).                02532004
025330                                                                  02533004
025340     05  PV-CICS-MSG-AREA2     PIC  X(100) VALUE SPACE.           02534004
025350     05  PV-SOFT-ABORT-MSG.                                       02535004
025360         10  FILLER            PIC X(12) VALUE ' RCKCS261 - '.    02536004
025370         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       02537004
025380         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    02538004
025390         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    02539004
025400         10  PV-SOFT-PARAGRAPH PIC X(30).                         02540004
025500         10  FILLER            PIC X(11) VALUE ' LOCATION '.      02550004
025600         10  PV-LOCATION       PIC 9(03).                         02560004
025700         10  FILLER            PIC X(06) VALUE ' USER '.          02570004
025800         10  PV-USER           PIC X(08).                         02580004
025900                                                                  02590004
026000 01  PW-PROGRAM-WORKAREA.                                         02600004
026100     05  PW-CONTROL-REC.                                          02610004
026200         10  PW-CONTROL-KEYREC.                                   02620004
026300             20  PW-CONTROL-PANL-NBR.                             02630004
026301                 30  PW-CONTROL-PANEL    PIC 9(05)  VALUE ZERO.   02630104
026302                 30  PW-CONTROL-KEYREC-NBR                        02630204
026303                                         PIC 9(02)  VALUE ZERO.   02630304
026304             20  PW-CONTROL-PANL-NBR-9 REDEFINES                  02630404
026305                                       PW-CONTROL-PANL-NBR        02630504
026306                                         PIC 9(7).                02630604
026307             20  PW-CONTROL-CEHCK-DIG    PIC 9(01)  VALUE ZERO.   02630704
026308         10  PW-CONTROL-KEYREC-9 REDEFINES PW-CONTROL-KEYREC      02630804
026309                                         PIC 9(08).               02630904
026310         10  PW-CONTROL-FILLER           PIC X(73)  VALUE SPACE.  02631004
026320                                                                  02632004
026330     05  PW-SAVE-PANEL-NBR               PIC X(7)   VALUE SPACES. 02633004
026340                                                                  02634004
026350     05  PW-QUOTIENT                     PIC S9(7)  VALUE ZERO.   02635004
026360     05  PW-REMAINDER                    PIC S9     VALUE ZERO.   02636004
026370                                                                  02637004
026380******************************************************************02638004
026390**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02639004
026400**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02640004
026500**  APPLICATION-SPECIFIC COMMAREA.                              **02650004
026600******************************************************************02660004
026700 01  LQW-LIST-QUEUE-WORK-AREA.                                    02670004
026800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02680004
026900     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02690004
027000                                        INDEXED BY LQW-IDX.       02700004
027100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02710004
027200         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02720004
027300         10  LQW-SELECTED-SW            PIC  X(01).               02730004
027400             88  LQW-SELECT                         VALUE 'S'.    02740004
027500             88  LQW-DESELECT                       VALUE ' '.    02750004
027600         10  LQW-ACTION                 PIC  X(03).               02760004
027700         10  LQW-SHIPT-ID               PIC S9(09)  COMP.         02770004
027800         10  LQW-TRIP-ID                PIC S9(09)  COMP.         02780004
027900         10  LQW-VEND-SHIP-DTE          PIC  X(10).               02790004
028000         10  LQW-CSR-IND                PIC  X(01).               02800004
028100         10  LQW-STATUS                 PIC  X(02).               02810004
028200         10  LQW-FREIGHT-BILL           PIC  X(20).               02820004
028300         10  LQW-BILL-OF-LADING         PIC  X(20).               02830004
028400         10  LQW-CARTON-COUNT           PIC S9(09) COMP.          02840004
028500         10  LQW-EXP-CTN-CNT            PIC S9(09) COMP.          02850004
028600         10  LQW-VEND-CTN-CNT           PIC S9(09) COMP.          02860004
028700         10  LQW-NBR-OF-POS             PIC S9(09) COMP.          02870004
028800         10  LQW-VENDOR                 PIC  X(10).               02880004
028900         10  LQW-ORIGIN-SCAC            PIC  X(04).               02890004
029000                                                                  02900004
029100     EJECT                                                        02910004
029200*---------------------------------------------------------------* 02920004
029300*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 02930004
029400*---------------------------------------------------------------* 02940004
029500                                                                  02950004
029600     COPY RCWS013.                                                02960004
029700                                                                  02970004
029800*----------------------------------------------------------------*02980004
029900*  WORK AREA PASSED IN CALL TO DPKUT001                          *02990004
030000*----------------------------------------------------------------*03000004
030100     COPY DPWS902.                                                03010004
030200                                                                  03020004
030300/                                                                 03030004
030400*----------------------------------------------------------------*03040004
030500*  WORK AREA PASSED IN CALL TO DPKUT500                          *03050004
030600*----------------------------------------------------------------*03060004
030700     COPY DPWS500.                                                03070004
030800                                                                  03080004
030900*----------------------------------------------------------------*03090004
031000*    COPYBOOK FOR THE FIELDS PASSED TO THE TROUBLE SUBROUTINE     03100004
031100*----------------------------------------------------------------*03110004
031200     COPY TMWS500.                                                03120004
031300                                                                  03130004
031400* JAK 04/2007 - ADD NEW COPYBOOK                                  03140004
031500***************************************************************** 03150004
031600* COPYBOOK FOR WMS VENDOR SHIPMENT CONTROL MODULE               * 03160004
031700***************************************************************** 03170004
031800     COPY WSWS001.                                                03180004
031900                                                                  03190004
032000     EJECT                                                        03200004
032100*---------------------------------------------------------------* 03210004
032200*    MAP LAYOUT                                                 * 03220004
032300*---------------------------------------------------------------* 03230004
032400                                                                  03240004
032500     COPY RCKM261.                                                03250004
032600*                                                                 03260004
032700 01  MR-OCCURS-LAYOUT                   REDEFINES  RC261AO.       03270004
032800     05  FILLER                         PIC X(91).                03280004
032900     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          03290004
033000         10  MR-SELECTL                 PIC S9(04) COMP.          03300004
033100         10  MR-SELECTA                 PIC  X(01).               03310004
033200         10  MR-SELECTC                 PIC  X(01).               03320004
033300         10  MR-SELECTH                 PIC  X(01).               03330004
033400         10  MR-SELECTI                 PIC  X(01).               03340004
033500                                                                  03350004
033600         10  MR-STATUSL                 PIC S9(04) COMP.          03360004
033700         10  MR-STATUSA                 PIC  X(01).               03370004
033800         10  MR-STATUSC                 PIC  X(01).               03380004
033900         10  MR-STATUSH                 PIC  X(01).               03390004
034000         10  MR-STATUS                  PIC  X(02).               03400004
034100                                                                  03410004
034200         10  MR-FREIGHT-BILLL           PIC S9(04) COMP.          03420004
034300         10  MR-FREIGHT-BILLA           PIC  X(01).               03430004
034400         10  MR-FREIGHT-BILLC           PIC  X(01).               03440004
034500         10  MR-FREIGHT-BILLH           PIC  X(01).               03450004
034600         10  MR-FREIGHT-BILL            PIC  X(20).               03460004
034700                                                                  03470004
034800         10  MR-BILL-OF-LADINGL         PIC S9(04) COMP.          03480004
034900         10  MR-BILL-OF-LADINGA         PIC  X(01).               03490004
035000         10  MR-BILL-OF-LADINGC         PIC  X(01).               03500004
035100         10  MR-BILL-OF-LADINGH         PIC  X(01).               03510004
035200         10  MR-BILL-OF-LADING          PIC  X(20).               03520004
035300                                                                  03530004
035400         10  MR-CARTON-COUNTL           PIC S9(04) COMP.          03540004
035500         10  MR-CARTON-COUNTA           PIC  X(01).               03550004
035600         10  MR-CARTON-COUNTC           PIC  X(01).               03560004
035700         10  MR-CARTON-COUNTH           PIC  X(01).               03570004
035800         10  MR-CARTON-COUNT-X.                                   03580004
035900             15  MR-CARTON-COUNT        PIC ZZZZZ9.               03590004
036000                                                                  03600004
036100         10  MR-NBR-OF-POSL             PIC S9(04) COMP.          03610004
036200         10  MR-NBR-OF-POSA             PIC  X(01).               03620004
036300         10  MR-NBR-OF-POSC             PIC  X(01).               03630004
036400         10  MR-NBR-OF-POSH             PIC  X(01).               03640004
036500         10  MR-NBR-OF-POS-X.                                     03650004
036600             15  MR-NBR-OF-POS          PIC ZZZZZ9.               03660004
036700                                                                  03670004
036800         10  MR-VENDORL                 PIC S9(04) COMP.          03680004
036900         10  MR-VENDORA                 PIC  X(01).               03690004
037000         10  MR-VENDORC                 PIC  X(01).               03700004
037100         10  MR-VENDORH                 PIC  X(01).               03710004
037200         10  MR-VENDOR                  PIC  X(10).               03720004
037300                                                                  03730004
037400         10  MR-ORIGIN-SCACL            PIC S9(04) COMP.          03740004
037500         10  MR-ORIGIN-SCACA            PIC  X(01).               03750004
037600         10  MR-ORIGIN-SCACC            PIC  X(01).               03760004
037700         10  MR-ORIGIN-SCACH            PIC  X(01).               03770004
037800         10  MR-ORIGIN-SCAC             PIC  X(04).               03780004
037900                                                                  03790004
038000     EJECT                                                        03800004
038100/                                                                 03810004
038200*----------------------------------------------------------------*03820004
038300**  SECURITY SUBROUTINE PARAMETERS                                03830004
038400*----------------------------------------------------------------*03840004
038500     COPY DPWS008.                                                03850004
038600*---------------------------------------------------------------* 03860004
038700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03870004
038800*---------------------------------------------------------------* 03880004
038900                                                                  03890004
039000     COPY DPWS015.                                                03900004
039100                                                                  03910004
039200*---------------------------------------------------------------* 03920004
039300*    FUNCTION KEYS COPYBOOK.                                    * 03930004
039400*---------------------------------------------------------------* 03940004
039500                                                                  03950004
039600     COPY DPWS016.                                                03960004
039700                                                                  03970004
039800*---------------------------------------------------------------* 03980004
039900*    NUMERIC EDIT LAYOUT.                                       * 03990004
040000*---------------------------------------------------------------* 04000004
040100                                                                  04010004
040200     COPY DPWS010I.                                               04020004
040300 EJECT                                                            04030004
040400******************************************************************04040010
040500** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **04050010
040510** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **04051010
040600******************************************************************04060010
040700                                                                  04070004
040800     COPY DPWS030.                                                04080004
040810     COPY DPWS930.                                                04081010
040900 EJECT                                                            04090004
041000*---------------------------------------------------------------* 04100004
041100*    STANDARD COMMAREA.                                         * 04110004
041200*---------------------------------------------------------------* 04120004
041300                                                                  04130004
041400     COPY DPWS020.                                                04140004
041500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04150004
041600                                                                  04160004
041700*---------------------------------------------------------------* 04170004
041800* INTER-APPLICATION COMMAREA.                                   * 04180004
041900*   RCWS012 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 04190004
042000*             SPEC SCREEN.                                      * 04200004
042100*   RCWS015 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04210004
042200*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 04220004
042300*---------------------------------------------------------------* 04230004
042400                                                                  04240004
042500         10  INTER-APPL-COMM-AREA       PIC X(200).               04250004
042600     COPY RCWS012.                                                04260004
042700     COPY RCWS015.                                                04270004
042800*---------------------------------------------------------------* 04280004
042900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04290004
043000*---------------------------------------------------------------* 04300004
043100         10  ASC-SPECIFIC-COMMAREA.                               04310004
043200             15  ASC-LIST-KEYS.                                   04320004
043300                 20  ASC-KEY-OPER-UNT-ID             PIC  X(04).  04330004
043400                 20  ASC-KEY-OPER-UNT-ID-N REDEFINES              04340004
043500                     ASC-KEY-OPER-UNT-ID             PIC  9(04).  04350004
043600                 20  ASC-KEY-FCLTY-ID                PIC  X(04).  04360004
043700                 20  ASC-KEY-FCLTY-ID-N REDEFINES                 04370004
043800                     ASC-KEY-FCLTY-ID                PIC  9(04).  04380004
043900                 20  ASC-KEY-ORIGIN-SCAC-ID          PIC  X(04).  04390004
044000                 20  ASC-KEY-DELIVERY-SCAC-ID        PIC  X(04).  04400004
044100                 20  ASC-KEY-VEH-NBR                 PIC  X(10).  04410004
044200                 20  ASC-KEY-STATUS                  PIC  X(02).  04420004
044300                 20  ASC-KEY-TRIP-ID                 PIC S9(09)   04430004
044400                                                     COMP.        04440004
044500                 20  ASC-KEY-PRO-NBR                 PIC  X(22).  04450004
044600                 20  ASC-KEY-BOL-NBR                 PIC  X(30).  04460004
044700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04470004
044800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04480004
044900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04490004
045000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04500004
045100                                                                  04510004
045200                 20  ASC-ITEM-ARRAY.                              04520004
045300                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        04530004
045400                         30  ASC-LIST-ITEM-NUMBER                 04540004
045500                                                     PIC S9(09)   04550004
045600                                                     COMP-3.      04560004
045700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04570004
045800                             88  ASC-VALID-SELECT    VALUE ' '    04580004
045900                                                           'S'    04590004
046000                                                           'B'    04600004
046100                                                           'E'.   04610004
046200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04620004
046300                             88  ASC-TEMP-SELECT     VALUE 'S'.   04630004
046400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04640004
046500                             88  ASC-TEMP-END        VALUE 'E'.   04650004
046600                         30  ASC-SELECTED-SW         PIC  X(01).  04660004
046700                             88  ASC-NO-SELECT       VALUE ' '.   04670004
046800                             88  ASC-SELECT          VALUE 'S'.   04680004
046900                             88  ASC-BEGIN           VALUE 'B'.   04690004
047000                             88  ASC-END             VALUE 'E'.   04700004
047100                         30  ASC-ACTION              PIC  X(03).  04710004
047200                         30  ASC-SHIPT-ID            PIC S9(09)   04720004
047300                                                          COMP.   04730004
047400                         30  ASC-TRIP-ID             PIC S9(09)   04740004
047500                                                          COMP.   04750004
047600                         30  ASC-VEND-SHIP-DTE       PIC  X(10).  04760004
047700                         30  ASC-CSR-IND             PIC  X(01).  04770004
047800                         30  ASC-STATUS              PIC  X(02).  04780004
047900                         30  ASC-FREIGHT-BILL        PIC  X(20).  04790004
048000                         30  ASC-BILL-OF-LADING      PIC  X(20).  04800004
048100                         30  ASC-CARTON-COUNT        PIC S9(09)   04810004
048200                                                          COMP.   04820004
048300                         30  ASC-EXP-CTN-CNT         PIC S9(09)   04830004
048400                                                          COMP.   04840004
048500                         30  ASC-VEND-CTN-CNT        PIC S9(09)   04850004
048600                                                          COMP.   04860004
048700                         30  ASC-NBR-OF-POS          PIC S9(09)   04870004
048800                                                          COMP.   04880004
048900                         30  ASC-VENDOR              PIC  X(10).  04890004
049000                         30  ASC-ORIGIN-SCAC         PIC  X(04).  04900004
049100                                                                  04910004
049200             15  ASC-CONTINUE-FUNC-02-SW             PIC  X(01).  04920004
049300                 88  ASC-CONTINUE-FUNC-02            VALUE 'Y'.   04930004
049400             15  ASC-BLK-SUB                         PIC S9(04)   04940004
049500                                                          COMP    04950004
049600                                                          SYNC.   04960004
049700             15  ASC-ITEM-SUB                        PIC S9(04)   04970004
049800                                                          COMP    04980004
049900                                                          SYNC.   04990004
050000             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05000004
050100                                                          COMP-3. 05010004
050200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05020004
050300                                                          COMP-3. 05030004
050400             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05040004
050500                                                          COMP-3. 05050004
050600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05060004
050700                                                          COMP-3. 05070004
050800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05080004
050900                                                          COMP-3. 05090004
051000             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05100004
051100                                                          COMP    05110004
051200                                                          SYNC.   05120004
051300             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05130004
051400                                                          COMP-3. 05140004
051500             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05150004
051600                                                          COMP-3. 05160004
051700             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05170004
051800                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05180004
051900                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05190004
052000             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05200004
052100                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05210004
052200                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05220004
052300             15  ASC-LIST-QUEUE-NAME.                             05230004
052400                 20  ASC-LIST-TERM-ID                PIC  X(04).  05240004
052500                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05250004
052600                                                          COMP-3. 05260004
052700                 20  ASC-LIST-SEQ                    PIC  9(01).  05270004
052800             15  ASC-SEL-QUEUE-NAME.                              05280004
052900                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05290004
053000                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05300004
053100                                                          COMP-3. 05310004
053200                 20  ASC-SEL-SEQ                     PIC  9(01).  05320004
053300                                                                  05330004
053400             15  ASC-START-ITEM-REQUEST.                          05340004
053500                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  05350004
053600     EJECT                                                        05360004
053700*---------------------------------------------------------------* 05370004
053800*    ABEND PROCESSING COPYBOOK.                                 * 05380004
053900*---------------------------------------------------------------* 05390004
054000                                                                  05400004
054100     COPY DPWS013.                                                05410004
054200                                                                  05420004
054300 EJECT                                                            05430004
054400*----------------------------------------------------------------*05440004
054500*    DB2 DCLGEN FOR THE COMPANY CONTROL TABLE                     05450004
054600*----------------------------------------------------------------*05460004
054700     EXEC SQL                                                     05470004
054800          INCLUDE TCOCNTL                                         05480004
054900     END-EXEC.                                                    05490004
055000                                                                  05500004
055100*----------------------------------------------------------------*05510004
055200*    DB2 DCLGEN FOR THE RECEIVER NUMBER TABLE                     05520004
055300*----------------------------------------------------------------*05530004
055400     EXEC SQL                                                     05540004
055500          INCLUDE TRECVER                                         05550004
055600     END-EXEC.                                                    05560004
055700                                                                  05570004
055800*----------------------------------------------------------------*05580004
055900*    DB2 DCLGEN FOR THE PURCHASE ORDER  TABLE                     05590004
056000*----------------------------------------------------------------*05600004
056100     EXEC SQL                                                     05610004
056200          INCLUDE TPURCHS                                         05620004
056300     END-EXEC.                                                    05630004
056400                                                                  05640004
056500*----------------------------------------------------------------*05650004
056600*    DB2 DCLGEN FOR THE PURCHASE ITEM TABLE                       05660004
056700*----------------------------------------------------------------*05670004
056800     EXEC SQL                                                     05680004
056900          INCLUDE TPURITM                                         05690004
057000     END-EXEC.                                                    05700004
057100                                                                  05710004
057200*----------------------------------------------------------------*05720004
057300*    DB2 DCLGEN FOR THE OPER SET TABLE                            05730004
057400*----------------------------------------------------------------*05740004
057500     EXEC SQL                                                     05750004
057600          INCLUDE TOPRSET                                         05760004
057700     END-EXEC.                                                    05770004
057800                                                                  05780004
057900*----------------------------------------------------------------*05790004
058000*    DB2 DCLGEN FOR THE WORK ORDER TABLE                          05800004
058100*----------------------------------------------------------------*05810004
058200     EXEC SQL                                                     05820004
058300          INCLUDE TWRKORD                                         05830004
058400     END-EXEC.                                                    05840004
058500                                                                  05850004
058600*----------------------------------------------------------------*05860004
058700*    DB2 DCLGEN FOR THE EXTERNAL ENTITY NAME TABLE                05870004
058800*----------------------------------------------------------------*05880004
058900     EXEC SQL                                                     05890004
059000          INCLUDE TENTNME                                         05900004
059100     END-EXEC.                                                    05910004
059200                                                                  05920004
059300*----------------------------------------------------------------*05930004
059400*    DB2 AREA FOR OPERATION SET/FACILITY TABLE                   *05940004
059500*----------------------------------------------------------------*05950004
059600                                                                  05960004
059700     EXEC SQL                                                     05970004
059800          INCLUDE TOSOPFA                                         05980004
059900     END-EXEC.                                                    05990004
060000                                                                  06000004
060100*----------------------------------------------------------------*06010004
060200*    DB2 AREA FOR WORK ORDER INSTRUCTION TABLE                   *06020004
060300*----------------------------------------------------------------*06030004
060400                                                                  06040004
060500     EXEC SQL                                                     06050004
060600          INCLUDE TWKORIN                                         06060004
060700     END-EXEC.                                                    06070004
060800                                                                  06080004
060900*----------------------------------------------------------------*06090004
061000*    DB2 AREA FOR TDCFAAS  DEPT/CLASS FACILITY LOC. ASSIGNMENTS  *06100004
061100*----------------------------------------------------------------*06110004
061200                                                                  06120004
061300     EXEC SQL                                                     06130004
061400          INCLUDE TDCFAAS                                         06140004
061500     END-EXEC.                                                    06150004
061600                                                                  06160004
061700*---------------------------------------------------------------* 06170004
061800*    DB2 AREA FOR PO AGREEMENT TABLE                            * 06180004
061900*---------------------------------------------------------------* 06190004
062000     EXEC SQL                                                     06200004
062100          INCLUDE TPOAGMT                                         06210004
062200     END-EXEC.                                                    06220004
062300*---------------------------------------------------------------* 06230004
062400*    DB2 AREA FOR SHIPMENT TABLE                                * 06240004
062500*---------------------------------------------------------------* 06250004
062600     EXEC SQL                                                     06260004
062700          INCLUDE TSHIPMT                                         06270004
062800     END-EXEC.                                                    06280004
062900*---------------------------------------------------------------* 06290004
063000*    DB2 AREA FOR SHIPMENT PO AUDIT TABLE                       * 06300004
063100*---------------------------------------------------------------* 06310004
063200     EXEC SQL                                                     06320004
063300          INCLUDE TAUSHPO                                         06330004
063400     END-EXEC.                                                    06340004
063500*---------------------------------------------------------------* 06350004
063600*    DB2 AREA FOR THE SHIPMENT AUDIT TABLE                      * 06360004
063700*---------------------------------------------------------------* 06370004
063800     EXEC SQL                                                     06380004
063900          INCLUDE TAUSHIP                                         06390004
064000     END-EXEC.                                                    06400004
064100*---------------------------------------------------------------* 06410004
064200*    DB2 AREA FOR SHIPMENT STATUS TABLE                         * 06420004
064300*---------------------------------------------------------------* 06430004
064400     EXEC SQL                                                     06440004
064500          INCLUDE TSHIPST                                         06450004
064600     END-EXEC.                                                    06460004
064700*---------------------------------------------------------------* 06470004
064800*    DB2 AREA FOR SHIPMENT PO TABLE                             * 06480004
064900*---------------------------------------------------------------* 06490004
065000     EXEC SQL                                                     06500004
065100          INCLUDE TSHPTPO                                         06510004
065200     END-EXEC.                                                    06520004
065300*---------------------------------------------------------------* 06530004
065400*    DB2 AREA FOR STATUS TYPE TABLE                             * 06540004
065500*---------------------------------------------------------------* 06550004
065600     EXEC SQL                                                     06560004
065700          INCLUDE TSHSTYP                                         06570004
065800     END-EXEC.                                                    06580004
065900*---------------------------------------------------------------* 06590004
066000*    DB2 AREA FOR TRIP STATUS TABLE                             * 06600004
066100*---------------------------------------------------------------* 06610004
066200     EXEC SQL                                                     06620004
066300          INCLUDE TTRSTYP                                         06630004
066400     END-EXEC.                                                    06640004
066500*---------------------------------------------------------------* 06650004
066600*    DB2 AREA FOR VEHICLE TRIP TABLE                            * 06660004
066700*---------------------------------------------------------------* 06670004
066800     EXEC SQL                                                     06680004
066900          INCLUDE TVHTRIP                                         06690004
067000     END-EXEC.                                                    06700004
067100*---------------------------------------------------------------* 06710004
067200*    DB2 AREA FOR VEHICLE AUDIT TABLE                           * 06720004
067300*---------------------------------------------------------------* 06730004
067400     EXEC SQL                                                     06740004
067500          INCLUDE TAUTRIP                                         06750004
067600     END-EXEC.                                                    06760004
067700*---------------------------------------------------------------* 06770004
067800*    DB2 AREA FOR RECEIVER TABLE                                * 06780004
067900*---------------------------------------------------------------* 06790004
068000     EXEC SQL                                                     06800004
068100          INCLUDE TRECEIV                                         06810004
068200     END-EXEC.                                                    06820004
068300                                                                  06830004
068400     EXEC SQL                                                     06840004
068500          INCLUDE TPOSYNC                                         06850004
068600     END-EXEC.                                                    06860004
068700*---------------------------------------------------------------* 06870004
068800*    DB2 AREA FOR TRIP STATUS TABLE                             * 06880004
068900*---------------------------------------------------------------* 06890004
069000     EXEC SQL                                                     06900004
069100          INCLUDE TTRIPST                                         06910004
069200     END-EXEC.                                                    06920004
069300*---------------------------------------------------------------* 06930004
069400*    DB2 AREA FOR THE VEHICLE TABLE                             * 06940004
069500*---------------------------------------------------------------* 06950004
069600     EXEC SQL                                                     06960004
069700          INCLUDE TVEHICL                                         06970004
069800     END-EXEC.                                                    06980004
069900* JAK 04/2007 - ADD TKRPRPM, TPKSLIP, & SHPMT XREF TABLES         06990004
070000*---------------------------------------------------------------* 07000004
070100*    DB2 AREA FOR THE PARM TABLE                                * 07010004
070200*---------------------------------------------------------------* 07020004
070300     EXEC SQL                                                     07030004
070400          INCLUDE TKRPRPM                                         07040004
070500     END-EXEC.                                                    07050004
070600*---------------------------------------------------------------* 07060004
070700*    DB2 AREA FOR PACK SLIP HEADER TABLE                        * 07070004
070800*---------------------------------------------------------------* 07080004
070900     EXEC SQL                                                     07090004
071000          INCLUDE TPKSLIP                                         07100004
071100     END-EXEC.                                                    07110004
071110*---------------------------------------------------------------* 07111004
071120*    DB2 AREA FOR THE SHIPMENT XREF HEADER                      * 07112004
071130*---------------------------------------------------------------* 07113004
071140     EXEC SQL                                                     07114004
071150          INCLUDE WST00001                                        07115004
071160     END-EXEC.                                                    07116004
071170*---------------------------------------------------------------* 07117004
071180*    DB2 AREA FOR COMMUNICATIONS                                * 07118004
071190*---------------------------------------------------------------* 07119004
071191     EXEC SQL                                                     07119104
071192          INCLUDE SQLCA                                           07119204
071193     END-EXEC.                                                    07119304
071194                                                                  07119404
071195                                                                  07119504
071196******************************************************************07119604
071197*    DB2 DCLGEN XLV00000 (XLV_SKU)                                07119704
071198******************************************************************07119804
071199     EXEC SQL                                                     07119904
071200          INCLUDE XLV00000                                        07120004
071300     END-EXEC.                                                    07130004
071400                                                                  07140004
071500******************************************************************07150004
071600*    DB2 DCLGEN XLV00001 (XLV_VND_STYL)                           07160004
071700******************************************************************07170004
071800     EXEC SQL                                                     07180004
071900          INCLUDE XLV00001                                        07190004
072000     END-EXEC.                                                    07200004
072100                                                                  07210004
072200*---------------------------------------------------------------* 07220004
072300*    SHIPMENT CURSOR WHICH WILL LIST ALL SHIPMENTS ON A TRAILER,* 07230004
072400*    THEN LIST ALL FORECAST SHIPMENTS FOR THE CARRIER           * 07240004
072500*---------------------------------------------------------------* 07250004
072600                                                                  07260004
072700     EXEC SQL                                                     07270004
072800          DECLARE SHIPMENT-CSR CURSOR FOR                         07280004
072900              SELECT 'A'                                          07290004
073000              , A.TRIP_ID                                         07300004
073100              , A.SHIPT_ID                                        07310004
073200              , A.PRO_NBR                                         07320004
073300              , A.BOL_NBR                                         07330004
073400              , A.EXPTED_PKG_QTY                                  07340004
073500              , A.VEND_SHIP_DTE                                   07350004
073600              , A.ORIG_SCAC_ID                                    07360004
073700              , A.CARR_CART_CT                                    07370004
073800              , A.VEND_CART_CT                                    07380004
073900          FROM                                                    07390004
074000                TSHIPMT A                                         07400004
074100              , TVHTRIP B                                         07410004
074200              , TTRIPST C                                         07420004
074300              , TVEHICL D                                         07430004
074400          WHERE B.OWNER_SCAC_ID     = :DK-ORIGIN-SCAC-ID          07440004
074500            AND B.VEH_NBR           = :DK-VEHICLE-NBR             07450004
074600            AND C.OPER_UNT_ID       = :DK-OPER-UNT-ID             07460004
074700            AND C.FCLTY_ID          = :DK-FCLTY-ID                07470004
074800            AND B.TRIP_ID           = C.TRIP_ID                   07480004
074900            AND B.TRIP_ID           = A.TRIP_ID                   07490004
075000            AND D.CURR_TRIP_ID      = B.REF_TRIP_ID               07500004
075100       UNION                                                      07510004
075200          SELECT 'B'                                              07520004
075300              , A.TRIP_ID                                         07530004
075400              , A.SHIPT_ID                                        07540004
075500              , A.PRO_NBR                                         07550004
075600              , A.BOL_NBR                                         07560004
075700              , A.EXPTED_PKG_QTY                                  07570004
075800              , A.VEND_SHIP_DTE                                   07580004
075900              , A.ORIG_SCAC_ID                                    07590004
076000              , A.CARR_CART_CT                                    07600004
076100              , A.VEND_CART_CT                                    07610004
076200          FROM                                                    07620004
076300                TSHIPMT A                                         07630004
076400              , TVHTRIP B                                         07640004
076500              , TTRIPST C                                         07650004
076600          WHERE A.PRO_SCAC_ID      IN (:DK-DELIVERY-SCAC-ID,      07660004
076700                                      :DK-ORIGIN-SCAC-ID)         07670004
076800            AND C.OPER_UNT_ID       = :DK-OPER-UNT-ID             07680004
076900            AND C.FCLTY_ID          = :DK-FCLTY-ID                07690004
077000            AND B.TRIP_ID           = C.TRIP_ID                   07700004
077100            AND B.TRIP_ID           = A.TRIP_ID                   07710004
077200            AND B.VEH_NBR           IS NULL                       07720004
077300            AND A.PRO_NBR BETWEEN     :DK-PRO-B                   07730004
077400                          AND         :DK-PRO-E                   07740004
077500            AND A.BOL_NBR BETWEEN     :DK-BOL-B                   07750004
077600                         AND          :DK-BOL-E                   07760004
077700          ORDER BY 1, 4, 5                                        07770004
077800     END-EXEC.                                                    07780004
077900                                                                  07790004
078000                                                                  07800004
078100     EXEC SQL                                                     07810004
078200          DECLARE SHIPMENT-OR-CSR CURSOR FOR                      07820004
078300              SELECT 'A'                                          07830004
078400              , A.TRIP_ID                                         07840004
078500              , A.SHIPT_ID                                        07850004
078600              , A.PRO_NBR                                         07860004
078700              , A.BOL_NBR                                         07870004
078800              , A.EXPTED_PKG_QTY                                  07880004
078900              , A.VEND_SHIP_DTE                                   07890004
079000              , A.ORIG_SCAC_ID                                    07900004
079100              , A.CARR_CART_CT                                    07910004
079200              , A.VEND_CART_CT                                    07920004
079300          FROM                                                    07930004
079400                TSHIPMT A                                         07940004
079500              , TVHTRIP B                                         07950004
079600              , TTRIPST C                                         07960004
079700              , TVEHICL D                                         07970004
079800          WHERE B.OWNER_SCAC_ID     = :DK-ORIGIN-SCAC-ID          07980004
079900            AND B.VEH_NBR           = :DK-VEHICLE-NBR             07990004
080000            AND C.OPER_UNT_ID       = :DK-OPER-UNT-ID             08000004
080100            AND C.FCLTY_ID          = :DK-FCLTY-ID                08010004
080200            AND B.TRIP_ID           = C.TRIP_ID                   08020004
080300            AND B.TRIP_ID           = A.TRIP_ID                   08030004
080400            AND D.CURR_TRIP_ID      = B.REF_TRIP_ID               08040004
080500       UNION                                                      08050004
080600          SELECT 'B'                                              08060004
080700              , A.TRIP_ID                                         08070004
080800              , A.SHIPT_ID                                        08080004
080900              , A.PRO_NBR                                         08090004
081000              , A.BOL_NBR                                         08100004
081100              , A.EXPTED_PKG_QTY                                  08110004
081200              , A.VEND_SHIP_DTE                                   08120004
081300              , A.ORIG_SCAC_ID                                    08130004
081400              , A.CARR_CART_CT                                    08140004
081500              , A.VEND_CART_CT                                    08150004
081600          FROM                                                    08160004
081700                TSHIPMT A                                         08170004
081800              , TVHTRIP B                                         08180004
081900              , TTRIPST C                                         08190004
082000          WHERE A.PRO_SCAC_ID      IN (:DK-DELIVERY-SCAC-ID,      08200004
082100                                      :DK-ORIGIN-SCAC-ID)         08210004
082200            AND C.OPER_UNT_ID       = :DK-OPER-UNT-ID             08220004
082300            AND C.FCLTY_ID          = :DK-FCLTY-ID                08230004
082400            AND B.TRIP_ID           = C.TRIP_ID                   08240004
082500            AND B.TRIP_ID           = A.TRIP_ID                   08250004
082600            AND B.VEH_NBR           IS NULL                       08260004
082700            AND A.PRO_NBR           = :DK-PRO-B                   08270005
083000       UNION                                                      08300005
083010          SELECT 'B'                                              08301005
083020              , A.TRIP_ID                                         08302005
083030              , A.SHIPT_ID                                        08303005
083040              , A.PRO_NBR                                         08304005
083050              , A.BOL_NBR                                         08305005
083060              , A.EXPTED_PKG_QTY                                  08306005
083070              , A.VEND_SHIP_DTE                                   08307005
083080              , A.ORIG_SCAC_ID                                    08308005
083090              , A.CARR_CART_CT                                    08309005
083091              , A.VEND_CART_CT                                    08309105
083092          FROM                                                    08309205
083093                TSHIPMT A                                         08309305
083094              , TVHTRIP B                                         08309405
083095              , TTRIPST C                                         08309505
083096          WHERE A.PRO_SCAC_ID      IN (:DK-DELIVERY-SCAC-ID,      08309605
083097                                      :DK-ORIGIN-SCAC-ID)         08309705
083098            AND C.OPER_UNT_ID       = :DK-OPER-UNT-ID             08309805
083099            AND C.FCLTY_ID          = :DK-FCLTY-ID                08309905
083100            AND B.TRIP_ID           = C.TRIP_ID                   08310005
083101            AND B.TRIP_ID           = A.TRIP_ID                   08310105
083102            AND B.VEH_NBR           IS NULL                       08310205
083104            AND A.BOL_NBR           = :DK-BOL-B                   08310405
083110          ORDER BY 1, 4, 5                                        08311004
083200     END-EXEC.                                                    08320004
083300                                                                  08330004
083400     EXEC SQL                                                     08340004
083500          DECLARE SHPTPO-CSR CURSOR FOR                           08350004
083600          SELECT PO_NBR                                           08360004
083700               , REC_SEQ_NBR                                      08370004
083800               , EXPTED_CART_CNT                                  08380004
083900               , ACTL_CART_CNT                                    08390004
084000               , CARR_CART_CT                                     08400004
084100               , VEND_CART_CT                                     08410004
084200            FROM TSHPTPO                                          08420004
084300           WHERE SHIPT_ID = :DK-SHIPT-ID                          08430004
084400     END-EXEC                                                     08440004
084500                                                                  08450004
084600                                                                  08460004
084700     EXEC SQL                                                     08470004
084800         DECLARE SHIPST-CSR CURSOR FOR                            08480004
084900          SELECT  A.SHIPT_STATUS_CDE                              08490004
085000            FROM   TSHIPST A                                      08500004
085100                  ,TSHSTYP B                                      08510004
085200           WHERE  A.SHIPT_ID = :DK-SHIPT-ID                       08520004
085300             AND  B.PRTY_CDE > :PC-49                             08530004
085400             AND  A.SHIPT_STATUS_CDE = B.SHIPT_STATUS_CDE         08540004
085500     END-EXEC                                                     08550004
085600                                                                  08560004
085700                                                                  08570004
085800 EJECT                                                            08580004
085900 LINKAGE SECTION.                                                 08590004
086000                                                                  08600004
086100 01  DFHCOMMAREA.                                                 08610004
086200     05  FILLER                         OCCURS  1 TO 4072 TIMES   08620004
086300                                        DEPENDING ON EIBCALEN.    08630004
086400         10  FILLER                     PIC X.                    08640004
086500                                                                  08650004
086600 EJECT                                                            08660004
086700 PROCEDURE DIVISION.                                              08670004
086800******************************************************************08680004
086900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **08690004
087000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **08700004
087100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **08710004
087200******************************************************************08720004
087300 0000-MAIN-MODULE.                                                08730004
087400     INITIALIZE DP030-CICS-API-FIELDS.                            08740004
087500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       08750004
087600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          08760004
087700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         08770004
087800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       08780004
087900     MOVE LENGTH OF RC261AI        TO DP030-MAP-LENGTH (1).       08790004
088000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     08800004
088100     PERFORM 0001-CALL-CICS-ARCH-API.                             08810004
088200                                                                  08820004
088300     PERFORM 1000-CONTROL-PROCESSING                              08830004
088400                                                                  08840004
088500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     08850004
088600     PERFORM 0001-CALL-CICS-ARCH-API.                             08860004
088700                                                                  08870004
088800******************************************************************08880004
088900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **08890004
089000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **08900004
089100******************************************************************08910004
089200 0001-CALL-CICS-ARCH-API.                                         08920004
089310     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      08931010
089400                                    DFHCOMMAREA                   08940010
089500                                    DP030-CICS-API-FIELDS         08950010
089600                                    DP020-STANDARD-COMMAREA       08960010
089700                                    RC261AI.                      08970010
089800                                                                  08980004
089900     IF  DP030-RC-CALL-SUCCESSFUL                                 08990004
090000         CONTINUE                                                 09000004
090100     ELSE                                                         09010004
090200         SET DP013-NO-ROLLBACK                                    09020004
090300             DP013-XCTL-DISPLAY-RESTART                           09030004
090400             DP013-CICS-ABEND      TO TRUE                        09040004
090500         MOVE '0001-CALL-CICS-ARCH-API'                           09050004
090600                                   TO DP013-PARAGRAPH             09060004
090620         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O09062010
090630-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09063010
090900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09090004
091000         PERFORM DP013-0000-PROCESS-ABEND                         09100004
091100     END-IF.                                                      09110004
091200*----------------------------------------------------------------*09120004
091300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09130004
091400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09140004
091500*                                                                *09150004
091600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09160004
091700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09170004
091800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09180004
091900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09190004
092000*----------------------------------------------------------------*09200004
092100                                                                  09210004
092200 1000-CONTROL-PROCESSING.                                         09220004
092300                                                                  09230004
092400     EVALUATE TRUE                                                09240004
092500         WHEN DP020-NEXT-ACT-INITIAL                              09250004
092600             INITIALIZE ASC-SPECIFIC-COMMAREA                     09260004
092700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09270004
092800                                      ASC-SEL-TERM-ID             09280004
092900             MOVE DP020-SRC-TASK-NUMBER                           09290004
093000                                   TO ASC-LIST-TASK-NUMBER        09300004
093100                                      ASC-SEL-TASK-NUMBER         09310004
093200             MOVE PC-LIST-QUEUE-SEQ                               09320004
093300                                   TO ASC-LIST-SEQ                09330004
093400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 09340004
093500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 09350004
093600***-----$TEMPLATE NOTE$-------------------------------------------09360004
093700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,09370004
093800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  09380004
093900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.09390004
094000***---------------------------------------------------------------09400004
094100             IF  PS-COMMAREA-NOT-VALID                            09410004
094200                 SET DP020-NEXT-ACT-APPL-ERROR                    09420004
094300                                   TO TRUE                        09430004
094400             ELSE                                                 09440004
094500                 PERFORM 4000-BUILD-INITIAL-PANEL                 09450004
094600             END-IF                                               09460004
094700                                                                  09470004
094800         WHEN DP020-NEXT-ACT-READ-MAP                             09480004
094900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09490004
095000                                   TO PV-TOP-ITEM                 09500004
095100             PERFORM 2000-PROCESS-PANEL                           09510004
095200                                                                  09520004
095300         WHEN DP020-NEXT-ACT-RETURN                               09530004
095400             MOVE ASC-KEY-OPER-UNT-ID-N                           09540004
095500                                    TO DK-OPER-UNT-ID             09550004
095600             MOVE ASC-KEY-FCLTY-ID-N                              09560004
095700                                    TO DK-FCLTY-ID                09570004
095800             MOVE ASC-KEY-ORIGIN-SCAC-ID                          09580004
095900                                   TO DK-ORIGIN-SCAC-ID           09590004
096000             MOVE ASC-KEY-DELIVERY-SCAC-ID                        09600004
096100                                    TO DK-DELIVERY-SCAC-ID        09610004
096200             MOVE ASC-KEY-VEH-NBR   TO DK-VEHICLE-NBR             09620004
096300             IF ASC-KEY-PRO-NBR = SPACE                           09630004
096400                 MOVE SPACES            TO DK-PRO-B               09640004
096500                 MOVE HIGH-VALUES       TO DK-PRO-E               09650004
096600             ELSE                                                 09660004
096700                 MOVE ASC-KEY-PRO-NBR   TO DK-PRO-B               09670004
096800                 MOVE ASC-KEY-PRO-NBR   TO DK-PRO-E               09680004
096900             END-IF                                               09690004
097000             IF ASC-KEY-BOL-NBR = SPACES                          09700004
097100                 MOVE SPACES            TO DK-BOL-B               09710004
097200                 MOVE HIGH-VALUES       TO DK-BOL-E               09720004
097300             ELSE                                                 09730004
097400                 MOVE ASC-KEY-BOL-NBR   TO DK-BOL-B               09740004
097500                 MOVE ASC-KEY-BOL-NBR   TO DK-BOL-E               09750004
097600             END-IF                                               09760004
097700             IF ASC-KEY-PRO-NBR NOT = SPACE AND                   09770004
097800                ASC-KEY-BOL-NBR NOT = SPACES                      09780004
097900                 SET PS-OR-CURSOR TO TRUE                         09790004
098000             ELSE                                                 09800004
098100                 SET PS-AND-CURSOR TO TRUE                        09810004
098200             END-IF                                               09820004
098300             PERFORM 2050-DELETE-LIST-QUEUE                       09830004
098400             PERFORM 4000-BUILD-INITIAL-PANEL                     09840004
098500                                                                  09850004
098600                                                                  09860004
098700         WHEN OTHER                                               09870004
098800             SET DP013-LOGIC-ABEND TO TRUE                        09880004
098900             SET DP013-NO-ROLLBACK TO TRUE                        09890004
099000             MOVE '1000-CONTROL-PROCESSING'                       09900004
099100                                   TO DP013-PARAGRAPH             09910004
099200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    09920004
099300                                   TO DP013-MESSAGE-TEXT(1)       09930004
099400             PERFORM DP013-0000-PROCESS-ABEND                     09940004
099500     END-EVALUATE.                                                09950004
099600                                                                  09960004
099700 EJECT                                                            09970004
099800*----------------------------------------------------------------*09980004
099900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *09990004
100000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *10000004
100100*----------------------------------------------------------------*10010004
100200                                                                  10020004
100300 1100-PROCESS-INTER-APPL-COMM.                                    10030004
100400                                                                  10040004
100500     SET PS-COMMAREA-VALID          TO TRUE.                      10050004
100600     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    10060004
100700     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT AND      10070004
100800         RC012-OPER-UNT-ID > ZERO AND                             10080004
100900         RC012-FCLTY-ID > ZERO AND                                10090004
101000         RC012-TRIP-ID > ZERO AND                                 10100004
101100         RC012-STATUS NOT = PC-ET AND                             10110004
101200         (RC012-OWNER-SCAC-ID > SPACES OR                         10120004
101300          RC012-ORIGIN-SCAC-ID > SPACES)                          10130004
101400         MOVE RC012-OPER-UNT-ID     TO ASC-KEY-OPER-UNT-ID        10140004
101500         MOVE RC012-FCLTY-ID        TO ASC-KEY-FCLTY-ID           10150004
101600         MOVE RC012-OWNER-SCAC-ID   TO ASC-KEY-ORIGIN-SCAC-ID     10160004
101700         MOVE RC012-TRIP-ID         TO ASC-KEY-TRIP-ID            10170004
101800         MOVE RC012-PRO-NBR         TO ASC-KEY-PRO-NBR            10180004
101900         MOVE RC012-BOL-NBR         TO ASC-KEY-BOL-NBR            10190004
102000         IF RC012-ORIGIN-SCAC-ID > SPACES                         10200004
102100             MOVE RC012-ORIGIN-SCAC-ID                            10210004
102200                                    TO ASC-KEY-DELIVERY-SCAC-ID   10220004
102300         ELSE                                                     10230004
102400             MOVE RC012-OWNER-SCAC-ID                             10240004
102500                                    TO ASC-KEY-DELIVERY-SCAC-ID   10250004
102600         END-IF                                                   10260004
102700         MOVE RC012-VEH-NBR         TO ASC-KEY-VEH-NBR            10270004
102800         MOVE RC012-STATUS          TO ASC-KEY-STATUS             10280004
102900     ELSE                                                         10290004
103000         IF RC012-STATUS = PC-ET                                  10300004
103100             MOVE PC-TSYMSG-01015      TO DP020-MSG-NUMBER        10310004
103200             MOVE PC-ET                TO DP020-MSG-TEXT          10320004
103300             SET PS-COMMAREA-NOT-VALID TO TRUE                    10330004
103400         ELSE                                                     10340004
103500             MOVE PC-TSYMSG-00743      TO DP020-MSG-NUMBER        10350004
103600             SET PS-COMMAREA-NOT-VALID TO TRUE                    10360004
103700         END-IF                                                   10370004
103800     END-IF.                                                      10380004
103900                                                                  10390004
104000 EJECT                                                            10400004
104100*----------------------------------------------------------------*10410004
104200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10420004
104300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10430004
104400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10440004
104500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10450004
104600* FUNCTION KEYS CAN GET THIS FAR.                                *10460004
104700*----------------------------------------------------------------*10470004
104800                                                                  10480004
104900 2000-PROCESS-PANEL.                                              10490004
105000     EVALUATE TRUE                                                10500004
105100         WHEN DP020-SRC-AID = DP016-CLEAR                         10510004
105200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10520004
105300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10530004
105400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10540004
105500                                                                  10550004
105600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10560004
105700             MOVE ASC-KEY-OPER-UNT-ID-N                           10570004
105800                                    TO DK-OPER-UNT-ID             10580004
105900             MOVE ASC-KEY-FCLTY-ID-N                              10590004
106000                                    TO DK-FCLTY-ID                10600004
106100             MOVE ASC-KEY-ORIGIN-SCAC-ID                          10610004
106200                                   TO DK-ORIGIN-SCAC-ID           10620004
106300             MOVE ASC-KEY-DELIVERY-SCAC-ID                        10630004
106400                                    TO DK-DELIVERY-SCAC-ID        10640004
106500             MOVE ASC-KEY-VEH-NBR   TO DK-VEHICLE-NBR             10650004
106600             IF ASC-KEY-PRO-NBR = SPACE                           10660004
106700                 MOVE SPACES            TO DK-PRO-B               10670004
106800                 MOVE HIGH-VALUES       TO DK-PRO-E               10680004
106900             ELSE                                                 10690004
107000                 MOVE ASC-KEY-PRO-NBR   TO DK-PRO-B               10700004
107100                 MOVE ASC-KEY-PRO-NBR   TO DK-PRO-E               10710004
107200             END-IF                                               10720004
107300             IF ASC-KEY-BOL-NBR = SPACES                          10730004
107400                 MOVE SPACES            TO DK-BOL-B               10740004
107500                 MOVE HIGH-VALUES       TO DK-BOL-E               10750004
107600             ELSE                                                 10760004
107700                 MOVE ASC-KEY-BOL-NBR   TO DK-BOL-B               10770004
107800                 MOVE ASC-KEY-BOL-NBR   TO DK-BOL-E               10780004
107900             END-IF                                               10790004
108000             IF ASC-KEY-PRO-NBR NOT = SPACE AND                   10800004
108100                ASC-KEY-BOL-NBR NOT = SPACES                      10810004
108200                 SET PS-OR-CURSOR TO TRUE                         10820004
108300             ELSE                                                 10830004
108400                 SET PS-AND-CURSOR TO TRUE                        10840004
108500             END-IF                                               10850004
108600             PERFORM 2050-DELETE-LIST-QUEUE                       10860004
108700             PERFORM 4000-BUILD-INITIAL-PANEL                     10870004
108800                                                                  10880004
108900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    10890004
109000             PERFORM 2140-DESELECT-ALL-ITEMS                      10900004
109100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10910004
109200                                                                  10920004
109300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  10930004
109400             PERFORM 2150-SELECT-ALL-ITEMS                        10940004
109500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10950004
109600                                                                  10960004
109700         WHEN OTHER                                               10970004
109800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 10980004
109900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10990004
110000             IF  PS-NO-ERROR                                      11000004
110100                 SET DP030-CONTINUE-GO                            11010004
110200                                 TO TRUE                          11020004
110300                 PERFORM 2100-CHECK-FUNCTION-KEY                  11030004
110400             ELSE                                                 11040004
110500                 SET DP030-OVERRIDE-GO                            11050004
110600                                 TO TRUE                          11060004
110700             END-IF                                               11070004
110800     END-EVALUATE.                                                11080004
110900 EJECT                                                            11090004
111000*----------------------------------------------------------------*11100004
111100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *11110004
111200*----------------------------------------------------------------*11120004
111300 2050-DELETE-LIST-QUEUE.                                          11130004
111400                                                                  11140004
111500     EXEC CICS                                                    11150004
111600         DELETEQ TS                                               11160004
111700             QUEUE (ASC-LIST-QUEUE-NAME)                          11170004
111800             RESP  (PV-CICS-RESP)                                 11180004
111900     END-EXEC.                                                    11190004
112000                                                                  11200004
112100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       11210004
112200        (PV-CICS-RESP = DFHRESP(QIDERR))                          11220004
112300         CONTINUE                                                 11230004
112400     ELSE                                                         11240004
112500         SET DP013-CICS-ABEND      TO TRUE                        11250004
112600         SET DP013-NO-ROLLBACK     TO TRUE                        11260004
112700                                                                  11270004
112800         MOVE '2050-DELETE-LIST-QUEUE'                            11280004
112900                                   TO DP013-PARAGRAPH             11290004
113000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    11300004
113100                                   TO DP013-MESSAGE-TEXT (1)      11310004
113200         PERFORM DP013-0000-PROCESS-ABEND                         11320004
113300     END-IF.                                                      11330004
113400                                                                  11340004
113500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  11350004
113600 EJECT                                                            11360004
113700*----------------------------------------------------------------*11370004
113800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*11380004
113900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *11390004
114000* CICS ARCHITECTURE API.                                         *11400004
114100*----------------------------------------------------------------*11410004
114200 2100-CHECK-FUNCTION-KEY.                                         11420004
114300     EVALUATE TRUE                                                11430004
114400         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  11440004
114500             INITIALIZE RC015-INTER-APPL-COMMAREA                 11450004
114600             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    11460004
114700                            TO RC015-NUMBER-OF-SELECTED-ITEMS     11470004
114800             MOVE ASC-KEY-OPER-UNT-ID                             11480004
114900                                   TO RC015-OPER-UNT-ID           11490004
115000             MOVE ASC-KEY-FCLTY-ID TO RC015-FCLTY-ID              11500004
115100             MOVE ASC-KEY-TRIP-ID  TO RC015-TRIP-ID               11510004
115200             PERFORM 5000-PREPARE-SEL-QUEUE                       11520004
115300                                                                  11530004
115400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              11540004
115500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              11550004
115600         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              11560004
115700         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    11570004
115800             SET PS-CONTINUE-FUNC-03 TO TRUE                      11580004
115900             IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)            11590004
116000                 PERFORM 2170-CHECK-RACF-ACCESS                   11600004
116100                 IF DP008-ACCESS-DENIED                           11610004
116200*                    -- NO SECURITY CLEARANCE FOR FUNCTION --     11620004
116300                     SET DP030-OVERRIDE-GO                        11630004
116400                                       TO TRUE                    11640004
116500                     MOVE PC-TSYMSG-01061                         11650004
116600                                       TO DP020-MSG-NUMBER        11660004
116700                     SET DP020-MSG-WARNING                        11670004
116800                         PS-END-FUNC-03 TO TRUE                   11680004
116900                 END-IF                                           11690004
117000             END-IF                                               11700004
117100             IF PS-END-FUNC-03                                    11710004
117200                 CONTINUE                                         11720004
117300             ELSE                                                 11730004
117400             PERFORM 5800-SELECT-TVEHICL                          11740004
117500             IF SQLCODE = +100                                    11750004
117600                 SET DP030-OVERRIDE-GO                            11760004
117700                                   TO TRUE                        11770004
117800                 MOVE PC-TSYMSG-00743                             11780004
117900                                   TO DP020-MSG-NUMBER            11790004
118000                 SET DP020-MSG-WARNING                            11800004
118100                                   TO TRUE                        11810004
118200             ELSE                                                 11820004
118300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              11830004
118400                 INITIALIZE RC015-INTER-APPL-COMMAREA             11840004
118500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                11850004
118600                            TO RC015-NUMBER-OF-SELECTED-ITEMS     11860004
118700                 SET PS-PO-NOT-ON-TRAILER                         11870004
118800                     PS-NO-VALID-SHIPMT-SELECTED TO TRUE          11880004
118900                 PERFORM 5000-PREPARE-SEL-QUEUE                   11890004
119000                 IF PS-ERROR OR                                   11900004
119100                    PS-PO-NOW-ON-TRAILER                          11910004
119200                     IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)    11920004
119300                         SET ASC-CONTINUE-FUNC-02 TO TRUE         11930004
119400                     END-IF                                       11940004
119500                     CONTINUE                                     11950004
119600                 ELSE                                             11960004
119700                     IF (DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR11970004
119800                        DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID))   11980004
119900                        AND PS-VALID-SHIPMT-SELECTED              11990004
120000                         SET PS-COMPLETE-UPDATES TO TRUE          12000004
120100                         INITIALIZE RC015-INTER-APPL-COMMAREA     12010004
120200                         MOVE ASC-NUMBER-OF-SELECTED-ITEMS        12020004
120300                                TO RC015-NUMBER-OF-SELECTED-ITEMS 12030004
120400                         PERFORM 5000-PREPARE-SEL-QUEUE           12040004
120500                     END-IF                                       12050004
120600                     IF PV-NUMBER-OF-UPDATES > 0                  12060004
120700                         IF PS-VEND-SHIP-DTE-ERROR                12070004
120800                            CONTINUE                              12080004
120900                         ELSE                                     12090004
121000* JAK - 04/2007 - USE WMS MESSAGE, IF AVAILABLE                   12100004
121100*                           MOVE PC-TSYMSG-00059                  12110004
121200*                                       TO DP020-MSG-NUMBER       12120004
121300                            IF PS-WMS-MESSAGE-NO                  12130004
121400                                MOVE PC-TSYMSG-00059              12140004
121500                                        TO DP020-MSG-NUMBER       12150004
121600                            END-IF                                12160004
121700* JAK - 04/2007 - END                                             12170004
121800                         END-IF                                   12180004
121900                         MOVE ASC-KEY-OPER-UNT-ID-N               12190004
122000                                        TO DK-OPER-UNT-ID         12200004
122100                         MOVE ASC-KEY-FCLTY-ID-N                  12210004
122200                                        TO DK-FCLTY-ID            12220004
122300                         MOVE ASC-KEY-ORIGIN-SCAC-ID              12230004
122400                                       TO DK-ORIGIN-SCAC-ID       12240004
122500                         MOVE ASC-KEY-DELIVERY-SCAC-ID            12250004
122600                                        TO DK-DELIVERY-SCAC-ID    12260004
122700                         MOVE ASC-KEY-VEH-NBR   TO DK-VEHICLE-NBR 12270004
122800                         IF ASC-KEY-PRO-NBR = SPACE               12280004
122900                             MOVE SPACES            TO DK-PRO-B   12290004
123000                             MOVE HIGH-VALUES       TO DK-PRO-E   12300004
123100                         ELSE                                     12310004
123200                             MOVE ASC-KEY-PRO-NBR   TO DK-PRO-B   12320004
123300                             MOVE ASC-KEY-PRO-NBR   TO DK-PRO-E   12330004
123400                         END-IF                                   12340004
123500                         IF ASC-KEY-BOL-NBR = SPACES              12350004
123600                             MOVE SPACES            TO DK-BOL-B   12360004
123700                             MOVE HIGH-VALUES       TO DK-BOL-E   12370004
123800                         ELSE                                     12380004
123900                             MOVE ASC-KEY-BOL-NBR   TO DK-BOL-B   12390004
124000                             MOVE ASC-KEY-BOL-NBR   TO DK-BOL-E   12400004
124100                         END-IF                                   12410004
124200                         IF ASC-KEY-PRO-NBR NOT = SPACE AND       12420004
124300                            ASC-KEY-BOL-NBR NOT = SPACES          12430004
124400                             SET PS-OR-CURSOR TO TRUE             12440004
124500                         ELSE                                     12450004
124600                             SET PS-AND-CURSOR TO TRUE            12460004
124700                         END-IF                                   12470004
124800                         PERFORM 2050-DELETE-LIST-QUEUE           12480004
124900                         PERFORM 4000-BUILD-INITIAL-PANEL         12490004
125000                     ELSE                                         12500004
125100                         MOVE PC-TSYMSG-00146 TO DP020-MSG-NUMBER 12510004
125200                     END-IF                                       12520004
125300                                                                  12530004
125400                 END-IF                                           12540004
125500             ELSE                                                 12550004
125600                 SET DP030-OVERRIDE-GO                            12560004
125700                                   TO TRUE                        12570004
125800                 MOVE PC-TSYMSG-00057                             12580004
125900                                   TO DP020-MSG-NUMBER            12590004
126000                 SET DP020-MSG-WARNING                            12600004
126100                                   TO TRUE                        12610004
126200             END-IF                                               12620004
126300             END-IF                                               12630004
126400             END-IF                                               12640004
126500                                                                  12650004
126600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  12660004
126700             MOVE +1               TO PV-TOP-ITEM                 12670004
126800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12680004
126900                                                                  12690004
127000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   12700004
127100             PERFORM 2110-BROWSE-BACKWARD                         12710004
127200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12720004
127300                                                                  12730004
127400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   12740004
127500             PERFORM 2120-BROWSE-FORWARD                          12750004
127600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12760004
127700                                                                  12770004
127800         WHEN DP020-SRC-AID = DP016-ENTER                         12780004
127900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   12790004
128000             IF  PS-ERROR                                         12800004
128100                 CONTINUE                                         12810004
128200             ELSE                                                 12820004
128300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12830004
128400             END-IF                                               12840004
128500                                                                  12850004
128600         WHEN OTHER                                               12860004
128700             SET DP013-NO-ROLLBACK                                12870004
128800                 DP013-XCTL-DISPLAY-RESTART                       12880004
128900                 DP013-CICS-ABEND  TO TRUE                        12890004
129000             MOVE '2100-CHECK-FUNCTION-KEY'                       12900004
129100                                   TO DP013-PARAGRAPH             12910004
129200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      12920004
129300                                   TO DP013-MESSAGE-TEXT (1)      12930004
129400             PERFORM DP013-0000-PROCESS-ABEND                     12940004
129500     END-EVALUATE.                                                12950004
129600*                                                                 12960004
129700*----------------------------------------------------------------*12970004
129800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *12980004
129900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *12990004
130000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *13000004
130100*    MESSAGE.                                                    *13010004
130200*----------------------------------------------------------------*13020004
130300                                                                  13030004
130400 2110-BROWSE-BACKWARD.                                            13040004
130500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    13050004
130600         GIVING PV-TOP-ITEM.                                      13060004
130700                                                                  13070004
130800     IF  ((PV-TOP-ITEM < +1)                                      13080004
130900       OR (PV-TOP-ITEM = +1))                                     13090004
131000         MOVE +1                   TO PV-TOP-ITEM                 13100004
131100*        -- TOP OF LIST --                                        13110004
131200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13120004
131300         SET DP020-MSG-INFORMATIONAL TO TRUE                      13130004
131400     END-IF.                                                      13140004
131500                                                                  13150004
131600 EJECT                                                            13160004
131700*----------------------------------------------------------------*13170004
131800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *13180004
131900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *13190004
132000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *13200004
132100*----------------------------------------------------------------*13210004
132200                                                                  13220004
132300 2120-BROWSE-FORWARD.                                             13230004
132400                                                                  13240004
132500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              13250004
132600         GIVING PV-TOP-ITEM.                                      13260004
132700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   13270004
132800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13280004
132900                                   TO PV-TOP-ITEM                 13290004
133000*        -- BOTTOM OF LIST --                                     13300004
133100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13310004
133200         SET DP020-MSG-INFORMATIONAL                              13320004
133300                                   TO TRUE                        13330004
133400     ELSE                                                         13340004
133500         COMPUTE PV-BOTTOM-ITEM =                                 13350004
133600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 13360004
133700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            13370004
133800*            -- BOTTOM OF LIST --                                 13380004
133900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13390004
134000             SET DP020-MSG-INFORMATIONAL                          13400004
134100                                   TO TRUE                        13410004
134200         END-IF                                                   13420004
134300     END-IF.                                                      13430004
134400 EJECT                                                            13440004
134500*----------------------------------------------------------------*13450004
134600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *13460004
134700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *13470004
134800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *13480004
134900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *13490004
135000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *13500004
135100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *13510004
135200*----------------------------------------------------------------*13520004
135300                                                                  13530004
135400 2130-CHECK-FOR-JUMP-BROWSE.                                      13540004
135500     SET PS-NO-ERROR               TO TRUE.                       13550004
135600     IF (ASC-START-ITEM-REQUEST = SPACE)                          13560004
135700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13570004
135800                                   TO PV-TOP-ITEM                 13580004
135900     ELSE                                                         13590004
136000         MOVE ASC-START-ITEM-REQUEST                              13600004
136100                                   TO DP010I-UNEDITED-FIELD       13610004
136200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       13620004
136300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     13630004
136400         SET DP010I-NEGATIVE-NOT-ALLOWED                          13640004
136500                                   TO TRUE                        13650004
136610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13661009
136620              USING DP010I-NUMERIC-EDIT-AREA                      13662009
136700                                                                  13670004
136800         IF  NOT DP010I-ERROR-DETECTED                            13680004
136900             MOVE DP010I-NUMERIC-FIELD                            13690004
137000                                   TO  ASC-START-ITEM-REQUEST-N   13700004
137100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  13710004
137200                 IF  ASC-START-ITEM-REQUEST-N >                   13720004
137300                                          ASC-NUMBER-OF-ITEMS-READ13730004
137400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         13740004
137500                     COMPUTE PV-TOP-ITEM =                        13750004
137600                             ASC-NUMBER-OF-ITEMS-READ             13760004
137700                             - PC-ITEMS-PER-PANEL + 1             13770004
137800                     IF  PV-TOP-ITEM < +1                         13780004
137900                         MOVE +1   TO PV-TOP-ITEM                 13790004
138000                         MOVE PC-TSYMSG-00070                     13800004
138100                                   TO DP020-MSG-NUMBER            13810004
138200                         SET DP020-MSG-INFORMATIONAL              13820004
138300                                   TO TRUE                        13830004
138400                     END-IF                                       13840004
138500                 ELSE                                             13850004
138600                     MOVE ASC-START-ITEM-REQUEST-N                13860004
138700                                   TO PV-TOP-ITEM                 13870004
138800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      13880004
138900                     COMPUTE PV-BOTTOM-ITEM =                     13890004
139000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     13900004
139100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ13910004
139200*                        -- BOTTOM OF LIST --                     13920004
139300                         MOVE PC-TSYMSG-00070                     13930004
139400                                   TO DP020-MSG-NUMBER            13940004
139500                         SET DP020-MSG-INFORMATIONAL              13950004
139600                                   TO TRUE                        13960004
139700                     END-IF                                       13970004
139800                 END-IF                                           13980004
139900             ELSE                                                 13990004
140000*                --- VALUE OUT OF RANGE ----                      14000004
140100                 MOVE PC-TSYMSG-00101                             14010004
140200                                   TO DP020-MSG-NUMBER            14020004
140300                 MOVE -1           TO ASTRTITL                    14030004
140400                 SET DP030-SET-CURSOR-APPL-1                      14040004
140500                                   TO TRUE                        14050004
140600                 MOVE DP015-REVERSE                               14060004
140700                                   TO ASTRTITH                    14070004
140800                 MOVE DP015-RED    TO ASTRTITC                    14080004
140900                 MOVE DP015-UNP-NUM-BRT-MDT                       14090004
141000                                   TO ASTRTITA                    14100004
141100                 SET DP020-MSG-FATAL                              14110004
141200                                   TO TRUE                        14120004
141300                 SET PS-ERROR      TO TRUE                        14130004
141400             END-IF                                               14140004
141500                                                                  14150004
141600         ELSE                                                     14160004
141700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            14170004
141800             MOVE -1               TO ASTRTITL                    14180004
141900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14190004
142000             MOVE DP015-REVERSE    TO ASTRTITH                    14200004
142100             MOVE DP015-RED        TO ASTRTITC                    14210004
142200             MOVE DP015-UNP-NUM-BRT-MDT                           14220004
142300                                   TO ASTRTITA                    14230004
142400             SET DP020-MSG-FATAL   TO TRUE                        14240004
142500             SET PS-ERROR          TO TRUE                        14250004
142600         END-IF                                                   14260004
142700     END-IF.                                                      14270004
142800 EJECT                                                            14280004
142900*----------------------------------------------------------------*14290004
143000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *14300004
143100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *14310004
143200*----------------------------------------------------------------*14320004
143300 2140-DESELECT-ALL-ITEMS.                                         14330004
143400     MOVE +1                       TO ASC-BLK-SUB.                14340004
143500                                                                  14350004
143600     PERFORM 2141-CLEAR-SELECTED-INDS                             14360004
143700         VARYING ASC-ITEM-SUB                                     14370004
143800         FROM 1 BY 1                                              14380004
143900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14390004
144000                                                                  14400004
144100     ADD +1                        TO ASC-BLK-SUB.                14410004
144200                                                                  14420004
144300     PERFORM 2141-CLEAR-SELECTED-INDS                             14430004
144400         VARYING ASC-ITEM-SUB                                     14440004
144500         FROM 1 BY 1                                              14450004
144600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14460004
144700                                                                  14470004
144800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14480004
144900                                   TO PV-LIST-ITEM-NUMBER.        14490004
145000                                                                  14500004
145100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14510004
145200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14520004
145300                                                                  14530004
145400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14540004
145500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      14550004
145600         MOVE +1                   TO ASC-BLK-SUB                 14560004
145700                                                                  14570004
145800         PERFORM 5100-WRITE-TEMP-STORAGE                          14580004
145900                                                                  14590004
146000         MOVE +1                   TO PV-BLOCK-NUMBER             14600004
146100                                                                  14610004
146200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14620004
146300             PV-FIRST-BLOCK-IN-ARRAY - 1                          14630004
146400                                                                  14640004
146500         PERFORM                                                  14650004
146600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14660004
146700                                                                  14670004
146800             PERFORM 4410-READ-TEMP-STORAGE                       14680004
146900                                                                  14690004
147000             PERFORM 2141-CLEAR-SELECTED-INDS                     14700004
147100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 14710004
147200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14720004
147300                                                                  14730004
147400             PERFORM 5100-WRITE-TEMP-STORAGE                      14740004
147500                                                                  14750004
147600             ADD +1                TO PV-BLOCK-NUMBER             14760004
147700                                                                  14770004
147800         END-PERFORM                                              14780004
147900                                                                  14790004
148000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14800004
148100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14810004
148200                                                                  14820004
148300         PERFORM                                                  14830004
148400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14840004
148500                   ASC-HIGHEST-BLOCK-WRITTEN                      14850004
148600                                                                  14860004
148700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14870004
148800                                   TO PV-BLOCK-NUMBER             14880004
148900                                                                  14890004
149000             PERFORM 4410-READ-TEMP-STORAGE                       14900004
149100                                                                  14910004
149200             PERFORM 2141-CLEAR-SELECTED-INDS                     14920004
149300                 VARYING ASC-ITEM-SUB                             14930004
149400                 FROM 1 BY 1                                      14940004
149500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14950004
149600                                                                  14960004
149700             PERFORM 5100-WRITE-TEMP-STORAGE                      14970004
149800                                                                  14980004
149900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14990004
150000                                                                  15000004
150100         END-PERFORM                                              15010004
150200                                                                  15020004
150300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15030004
150400                                   TO PV-BLOCK-NUMBER             15040004
150500                                                                  15050004
150600         PERFORM 4410-READ-TEMP-STORAGE                           15060004
150700     END-IF.                                                      15070004
150800                                                                  15080004
150900                                                                  15090004
151000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 15100004
151100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.15110004
151200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  15120004
151300                                                                  15130004
151400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15140004
151500                                                                  15150004
151600 EJECT                                                            15160004
151700*----------------------------------------------------------------*15170004
151800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *15180004
151900*----------------------------------------------------------------*15190004
152000                                                                  15200004
152100 2141-CLEAR-SELECTED-INDS.                                        15210004
152200                                                                  15220004
152300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15230004
152400             NOT EQUAL ZERO                                       15240004
152500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15250004
152600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15260004
152700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    15270004
152800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15280004
152900                                   TO TRUE                        15290004
153000         END-IF                                                   15300004
153100     END-IF.                                                      15310004
153200                                                                  15320004
153300 EJECT                                                            15330004
153400*----------------------------------------------------------------*15340004
153500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15350004
153600*  FOR ALL ITEMS.                                                *15360004
153700*----------------------------------------------------------------*15370004
153800                                                                  15380004
153900 2150-SELECT-ALL-ITEMS.                                           15390004
154000                                                                  15400004
154100     MOVE +1                       TO ASC-BLK-SUB.                15410004
154200                                                                  15420004
154300     PERFORM 2151-SET-SELECTED-INDS                               15430004
154400         VARYING ASC-ITEM-SUB                                     15440004
154500         FROM 1 BY 1                                              15450004
154600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15460004
154700                                                                  15470004
154800     ADD +1                        TO ASC-BLK-SUB.                15480004
154900                                                                  15490004
155000     PERFORM 2151-SET-SELECTED-INDS                               15500004
155100         VARYING ASC-ITEM-SUB                                     15510004
155200         FROM 1 BY 1                                              15520004
155300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15530004
155400                                                                  15540004
155500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15550004
155600                                   TO PV-LIST-ITEM-NUMBER.        15560004
155700                                                                  15570004
155800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15580004
155900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15590004
156000                                                                  15600004
156100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15610004
156200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    15620004
156300         MOVE +1                   TO ASC-BLK-SUB                 15630004
156400                                                                  15640004
156500         PERFORM 5100-WRITE-TEMP-STORAGE                          15650004
156600                                                                  15660004
156700         MOVE +1                   TO PV-BLOCK-NUMBER             15670004
156800                                                                  15680004
156900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15690004
157000             PV-FIRST-BLOCK-IN-ARRAY - 1                          15700004
157100                                                                  15710004
157200         PERFORM                                                  15720004
157300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15730004
157400                                                                  15740004
157500             PERFORM 4410-READ-TEMP-STORAGE                       15750004
157600                                                                  15760004
157700             PERFORM 2151-SET-SELECTED-INDS                       15770004
157800                 VARYING ASC-ITEM-SUB                             15780004
157900                 FROM 1 BY 1                                      15790004
158000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15800004
158100                                                                  15810004
158200             PERFORM 5100-WRITE-TEMP-STORAGE                      15820004
158300                                                                  15830004
158400             ADD +1                TO PV-BLOCK-NUMBER             15840004
158500                                                                  15850004
158600         END-PERFORM                                              15860004
158700                                                                  15870004
158800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15880004
158900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15890004
159000                                                                  15900004
159100         PERFORM                                                  15910004
159200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15920004
159300                   ASC-HIGHEST-BLOCK-WRITTEN                      15930004
159400                                                                  15940004
159500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15950004
159600                                   TO PV-BLOCK-NUMBER             15960004
159700                                                                  15970004
159800             PERFORM 4410-READ-TEMP-STORAGE                       15980004
159900                                                                  15990004
160000             PERFORM 2151-SET-SELECTED-INDS                       16000004
160100                 VARYING ASC-ITEM-SUB                             16010004
160200                 FROM 1 BY 1                                      16020004
160300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16030004
160400                                                                  16040004
160500             PERFORM 5100-WRITE-TEMP-STORAGE                      16050004
160600                                                                  16060004
160700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16070004
160800                                                                  16080004
160900         END-PERFORM                                              16090004
161000                                                                  16100004
161100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16110004
161200                                   TO PV-BLOCK-NUMBER             16120004
161300                                                                  16130004
161400         PERFORM 4410-READ-TEMP-STORAGE                           16140004
161500     END-IF.                                                      16150004
161600                                                                  16160004
161700                                                                  16170004
161800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             16180004
161900                       ASC-NUMBER-OF-SELECTED-ITEMS.              16190004
162000                                                                  16200004
162100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16210004
162200                                                                  16220004
162300 EJECT                                                            16230004
162400*----------------------------------------------------------------*16240004
162500*    MARK EACH ITEM AS BEING SELECTED.                           *16250004
162600*----------------------------------------------------------------*16260004
162700                                                                  16270004
162800 2151-SET-SELECTED-INDS.                                          16280004
162900                                                                  16290004
163000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16300004
163100             NOT EQUAL ZERO                                       16310004
163200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16320004
163300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16330004
163400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16340004
163500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16350004
163600                               TO  TRUE                           16360004
163700         END-IF                                                   16370004
163800     END-IF.                                                      16380004
163900                                                                  16390004
164000 2170-CHECK-RACF-ACCESS.                                          16400004
164100     SET DP008-RSRC-TYPE-FUNC     TO TRUE                         16410004
164200     MOVE 'RCDETH  '              TO DP008-FUNCTION-NAME          16420004
164300     SET DP008-ACCESS-TYPE-USE    TO TRUE                         16430004
164400                                                                  16440004
164500     EXEC CICS                                                    16450004
164600        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                  16460004
164700             COMMAREA (DP008-SECURITY-COMMAREA)                   16470004
164800             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)              16480004
164900     END-EXEC                                                     16490004
165000                                                                  16500004
165100     IF DP008-CALL-SUCCESSFUL                                     16510004
165200         CONTINUE                                                 16520004
165300     ELSE                                                         16530004
165400        MOVE '2170-CHECK-RACF-ACCESS'                             16540004
165500                              TO DP013-PARAGRAPH                  16550004
165600         MOVE 'UNABLE TO ACCESS CICS'                             16560004
165700                              TO DP013-MESSAGE-TEXT (1)           16570004
165800         MOVE SQLCA           TO DP013-SQLCA                      16580004
165900         SET DP013-DB2-ABEND                                      16590004
166000             DP013-XCTL-DISPLAY-RESTART                           16600004
166100                              TO TRUE                             16610004
166200         PERFORM DP013-0000-PROCESS-ABEND                         16620004
166300     END-IF.                                                      16630004
166400                                                                  16640004
166500******************************************************************16650004
166600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **16660004
166700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **16670004
166800******************************************************************16680004
166900 2200-MOVE-SCREEN-TO-COMMAREA.                                    16690004
167000                                                                  16700004
167100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16710004
167200     MOVE +1                       TO PV-SUB.                     16720004
167300                                                                  16730004
167400     PERFORM 3100-SET-SUBSCRIPTS.                                 16740004
167500     IF  ASTRTITL > ZERO                                          16750004
167600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          16760004
167700     ELSE                                                         16770004
167800         IF  ASTRTITF = DP015-ERASE-EOF                           16780004
167900             INITIALIZE ASC-START-ITEM-REQUEST                    16790004
168000         END-IF                                                   16800004
168100     END-IF.                                                      16810004
168200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          16820004
168300         VARYING PV-SUB                                           16830004
168400         FROM 1 BY 1                                              16840004
168500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      16850004
168600******************************************************************16860004
168700** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**16870004
168800******************************************************************16880004
168900 2210-MOVE-LINES-TO-COMMAREA.                                     16890004
169000     IF  MR-SELECTL (PV-SUB) > ZERO                               16900004
169100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             16910004
169200         MOVE MR-SELECTI (PV-SUB)                                 16920004
169300                                   TO ASC-TEMP-SELECTED-SW        16930004
169400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16940004
169500     ELSE                                                         16950004
169600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                16960004
169700                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     16970004
169800                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        16980004
169900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16990004
170000         END-IF                                                   17000004
170100     END-IF.                                                      17010004
170200     ADD +1                        TO ASC-ITEM-SUB.               17020004
170300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17030004
170400         ADD +1                    TO ASC-BLK-SUB                 17040004
170500         MOVE +1                   TO ASC-ITEM-SUB                17050004
170600     END-IF.                                                      17060004
170700******************************************************************17070004
170800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **17080004
170900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **17090004
171000******************************************************************17100004
171100 3000-EDIT-DATA-IN-COMMAREA.                                      17110004
171200     SET PS-NO-ERROR               TO TRUE.                       17120004
171300     PERFORM 3200-RESET-ATTRIBUTES.                               17130004
171400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     17140004
171500**                                                                17150004
171600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              17160004
171700* EDITTING IS DONE FROM THE BOTTOM UP.                            17170004
171800**                                                                17180004
171900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       17190004
172000         ASC-ITEMS-DISPLAYED - 1.                                 17200004
172100     PERFORM 3100-SET-SUBSCRIPTS.                                 17210004
172200     PERFORM 3300-EDIT-SELECTIONS                                 17220004
172300         VARYING PV-SUB                                           17230004
172400         FROM PV-SUB BY -1                                        17240004
172500         UNTIL PV-SUB < +1                                        17250004
172600                                                                  17260004
172700     IF  PS-NO-ERROR                                              17270004
172800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        17280004
172900     END-IF.                                                      17290004
173000                                                                  17300004
173100     IF  ((PS-NO-ERROR)                                           17310004
173200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   17320004
173300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    17330004
173400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  17340004
173500     END-IF.                                                      17350004
173600 EJECT                                                            17360004
173700*----------------------------------------------------------------*17370004
173800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17380004
173900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*17390004
174000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17400004
174100*                                                                *17410004
174200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17420004
174300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17430004
174400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17440004
174500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *17450004
174600*----------------------------------------------------------------*17460004
174700                                                                  17470004
174800 3100-SET-SUBSCRIPTS.                                             17480004
174900                                                                  17490004
175000     COMPUTE ASC-ITEM-SUB =                                       17500004
175100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        17510004
175200                                                                  17520004
175300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         17530004
175400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17540004
175500                                                                  17550004
175600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               17560004
175700     ELSE                                                         17570004
175800         MOVE +1                     TO ASC-BLK-SUB               17580004
175900     END-IF.                                                      17590004
176000******************************************************************17600004
176100** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **17610004
176200******************************************************************17620004
176300                                                                  17630004
176400 3200-RESET-ATTRIBUTES.                                           17640004
176500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   17650004
176600     MOVE DP015-GREEN              TO ASTRTITC.                   17660004
176700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   17670004
176800                                                                  17680004
176900     PERFORM                                                      17690004
177000         VARYING PV-SUB                                           17700004
177100         FROM 1 BY 1                                              17710004
177200         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        17720004
177300         MOVE DP015-UNP-ALP-NOR-OFF                               17730004
177400                                   TO MR-SELECTA (PV-SUB)         17740004
177500         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         17750004
177600     END-PERFORM.                                                 17760004
177700******************************************************************17770004
177800** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **17780004
177900** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **17790004
178000** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **17800004
178100** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **17810004
178200******************************************************************17820004
178300 3300-EDIT-SELECTIONS.                                            17830004
178400     EVALUATE TRUE                                                17840004
178500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17850004
178600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         17860004
178700                 CONTINUE                                         17870004
178800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         17880004
178900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        17890004
179000                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   17900004
179100                 MOVE ASC-TEMP-SELECTED-SW                        17910004
179200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17920004
179300                                TO ASC-SELECTED-SW                17930004
179400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17940004
179500             END-IF                                               17950004
179600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17960004
179700                 = SPACE                                          17970004
179800             EVALUATE TRUE                                        17980004
179900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       17990004
180000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS18000004
180100                     MOVE SPACE TO ASC-SELECTED-SW                18010004
180200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18020004
180300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        18030004
180400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    18040004
180500                     MOVE SPACE TO ASC-SELECTED-SW                18050004
180600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18060004
180700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          18070004
180800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      18080004
180900                     MOVE SPACE TO ASC-SELECTED-SW                18090004
181000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18100004
181100             END-EVALUATE                                         18110004
181200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           18120004
181300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18130004
181400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18140004
181500             END-IF                                               18150004
181600             PERFORM 3310-EDIT-RANGE                              18160004
181700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             18170004
181800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18180004
181900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18190004
182000             END-IF                                               18200004
182100             PERFORM 3310-EDIT-RANGE                              18210004
182200         WHEN OTHER                                               18220004
182300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           18230004
182400             SET DP020-MSG-FATAL    TO TRUE                       18240004
182500             MOVE -1                TO MR-SELECTL (PV-SUB)        18250004
182600             SET DP030-SET-CURSOR-APPL-1                          18260004
182700                                    TO TRUE                       18270004
182800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        18280004
182900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        18290004
183000             SET PS-ERROR TO TRUE                                 18300004
183100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18310004
183200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     18320004
183300                 MOVE SPACE         TO ASC-SELECTED-SW            18330004
183400                                        (ASC-BLK-SUB ASC-ITEM-SUB)18340004
183500             END-IF                                               18350004
183600     END-EVALUATE.                                                18360004
183700                                                                  18370004
183800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 18380004
183900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18390004
184000     IF  ASC-ITEM-SUB < 1                                         18400004
184100         SUBTRACT +1 FROM ASC-BLK-SUB                             18410004
184200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                18420004
184300     END-IF.                                                      18430004
184400******************************************************************18440004
184500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **18450004
184600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **18460004
184700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**18470004
184800** THE ENDING.                                                  **18480004
184900******************************************************************18490004
185000 3310-EDIT-RANGE.                                                 18500004
185100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                18510004
185200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   18520004
185300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)18530004
185400                                   TO ASC-SELECTED-SW             18540004
185500                                        (ASC-BLK-SUB ASC-ITEM-SUB)18550004
185600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 18560004
185700         ELSE                                                     18570004
185800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     18580004
185900                 CONTINUE                                         18590004
186000             ELSE                                                 18600004
186100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        18610004
186200                 MOVE PC-TSYMSG-00054                             18620004
186300                                   TO DP020-MSG-NUMBER            18630004
186400                 SET DP020-MSG-FATAL                              18640004
186500                                   TO TRUE                        18650004
186600                 MOVE -1           TO MR-SELECTL (PV-SUB)         18660004
186700                 SET DP030-SET-CURSOR-APPL-1                      18670004
186800                                   TO TRUE                        18680004
186900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         18690004
187000                 MOVE DP015-UNDERLINE                             18700004
187100                                   TO MR-SELECTH (PV-SUB)         18710004
187200                 SET PS-ERROR      TO TRUE                        18720004
187300             END-IF                                               18730004
187400         END-IF                                                   18740004
187500     ELSE                                                         18750004
187600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18760004
187700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18770004
187800                                   TO ASC-SELECTED-SW             18780004
187900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18790004
188000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18800004
188100         ELSE                                                     18810004
188200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18820004
188300                 CONTINUE                                         18830004
188400             ELSE                                                 18840004
188500*                -- ONLY ONE END-OF-RANGE ALLOWED --              18850004
188600                 MOVE PC-TSYMSG-00055                             18860004
188700                                   TO DP020-MSG-NUMBER            18870004
188800                 SET DP020-MSG-FATAL                              18880004
188900                                   TO TRUE                        18890004
189000                 MOVE -1           TO MR-SELECTL (PV-SUB)         18900004
189100                 SET DP030-SET-CURSOR-APPL-1                      18910004
189200                                   TO TRUE                        18920004
189300                 SET PS-ERROR      TO TRUE                        18930004
189400             END-IF                                               18940004
189500         END-IF                                                   18950004
189600     END-IF.                                                      18960004
189700                                                                  18970004
189800******************************************************************18980004
189900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **18990004
190000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **19000004
190100******************************************************************19010004
190200 3400-CHECK-RANGE-SEQUENCE.                                       19020004
190300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19030004
190400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      19040004
190500       AND  ASC-START-OF-SELECTED-RANGE >                         19050004
190600                                         ASC-END-OF-SELECTED-RANGE19060004
190700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                19070004
190800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 19080004
190900         SET DP020-MSG-FATAL TO TRUE                              19090004
191000         SET PS-ERROR TO TRUE                                     19100004
191100         PERFORM 3410-POSITION-AT-ERROR                           19110004
191200     END-IF.                                                      19120004
191300******************************************************************19130004
191400** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **19140004
191500** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **19150004
191600** SHOULD BE POSITIONED ON A RANGE ERROR.                       **19160004
191700******************************************************************19170004
191800 3410-POSITION-AT-ERROR.                                          19180004
191900     SET DP030-SET-CURSOR-APPL-1                                  19190004
192000                                   TO TRUE.                       19200004
192100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19210004
192200                    - PV-TOP-ITEM + 1.                            19220004
192300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19230004
192400         CONTINUE                                                 19240004
192500     ELSE                                                         19250004
192600         MOVE -1                   TO MR-SELECTL (PV-SUB)         19260004
192700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19270004
192800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19280004
192900     END-IF.                                                      19290004
193000                                                                  19300004
193100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19310004
193200                    - PV-TOP-ITEM + 1.                            19320004
193300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19330004
193400         CONTINUE                                                 19340004
193500     ELSE                                                         19350004
193600         MOVE -1                   TO MR-SELECTL (PV-SUB)         19360004
193700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19370004
193800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19380004
193900     END-IF.                                                      19390004
194000 EJECT                                                            19400004
194100*----------------------------------------------------------------*19410004
194200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *19420004
194300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *19430004
194400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *19440004
194500*----------------------------------------------------------------*19450004
194600                                                                  19460004
194700 3500-MARK-RANGE-AS-SELECTED.                                     19470004
194800     MOVE +1                       TO  ASC-BLK-SUB.               19480004
194900     PERFORM 3510-MARK-SELECTED-INDS                              19490004
195000         VARYING ASC-ITEM-SUB                                     19500004
195100         FROM 1 BY 1                                              19510004
195200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19520004
195300                                                                  19530004
195400     ADD +1                        TO ASC-BLK-SUB.                19540004
195500     PERFORM 3510-MARK-SELECTED-INDS                              19550004
195600         VARYING ASC-ITEM-SUB                                     19560004
195700         FROM 1 BY 1                                              19570004
195800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19580004
195900                                                                  19590004
196000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19600004
196100                                   TO  PV-LIST-ITEM-NUMBER.       19610004
196200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19620004
196300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         19630004
196400               PC-ITEMS-PER-PANEL).                               19640004
196500                                                                  19650004
196600     MOVE ASC-START-OF-SELECTED-RANGE                             19660004
196700                                   TO PV-START-OF-SELECTED-RANGE. 19670004
196800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            19680004
196900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  19690004
197000               PC-ITEMS-PER-PANEL).                               19700004
197100                                                                  19710004
197200     MOVE ASC-END-OF-SELECTED-RANGE                               19720004
197300                                   TO  PV-END-OF-SELECTED-RANGE.  19730004
197400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19740004
197500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19750004
197600               PC-ITEMS-PER-PANEL).                               19760004
197700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19770004
197800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19780004
197900                                                                  19790004
198000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19800004
198100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19810004
198200         MOVE +1                   TO ASC-BLK-SUB                 19820004
198300         PERFORM 5100-WRITE-TEMP-STORAGE                          19830004
198400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19840004
198500             PV-FIRST-BLOCK-IN-ARRAY - 1                          19850004
198600                                                                  19860004
198700         PERFORM                                                  19870004
198800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19880004
198900                   PV-PREV-BLOCK-IN-ARRAY                         19890004
199000             MOVE PV-FIRST-BLOCK-IN-RANGE                         19900004
199100                                   TO PV-BLOCK-NUMBER             19910004
199200             PERFORM 4410-READ-TEMP-STORAGE                       19920004
199300             PERFORM 3510-MARK-SELECTED-INDS                      19930004
199400                 VARYING ASC-ITEM-SUB                             19940004
199500                 FROM 1 BY 1                                      19950004
199600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19960004
199700             PERFORM 5100-WRITE-TEMP-STORAGE                      19970004
199800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     19980004
199900         END-PERFORM                                              19990004
200000                                                                  20000004
200100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20010004
200200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20020004
200300         PERFORM                                                  20030004
200400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20040004
200500                   PV-LAST-BLOCK-IN-RANGE                         20050004
200600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20060004
200700                                   TO PV-BLOCK-NUMBER             20070004
200800             PERFORM 4410-READ-TEMP-STORAGE                       20080004
200900             PERFORM 3510-MARK-SELECTED-INDS                      20090004
201000                 VARYING ASC-ITEM-SUB                             20100004
201100                 FROM 1 BY 1                                      20110004
201200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20120004
201300             PERFORM 5100-WRITE-TEMP-STORAGE                      20130004
201400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20140004
201500         END-PERFORM                                              20150004
201600                                                                  20160004
201700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20170004
201800                                   TO PV-BLOCK-NUMBER             20180004
201900         PERFORM 4410-READ-TEMP-STORAGE                           20190004
202000     END-IF.                                                      20200004
202100                                                                  20210004
202200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 20220004
202300                                      ASC-END-OF-SELECTED-RANGE.  20230004
202400                                                                  20240004
202500 EJECT                                                            20250004
202600*----------------------------------------------------------------*20260004
202700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *20270004
202800*----------------------------------------------------------------*20280004
202900                                                                  20290004
203000 3510-MARK-SELECTED-INDS.                                         20300004
203100                                                                  20310004
203200     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         20320004
203300                                ASC-ITEM-SUB) >                   20330004
203400         ASC-START-OF-SELECTED-RANGE)                             20340004
203500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         20350004
203600                                ASC-ITEM-SUB) =                   20360004
203700         ASC-START-OF-SELECTED-RANGE)                             20370004
203800                                                                  20380004
203900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20390004
204000                                    ASC-ITEM-SUB) <               20400004
204100             ASC-END-OF-SELECTED-RANGE)                           20410004
204200         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20420004
204300                                    ASC-ITEM-SUB) =               20430004
204400             ASC-END-OF-SELECTED-RANGE)                           20440004
204500                                                                  20450004
204600             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20460004
204700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   20470004
204800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   20480004
204900                               TO TRUE                            20490004
205000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              20500004
205100                               TO TRUE                            20510004
205200                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    20520004
205300             END-IF                                               20530004
205400         END-IF                                                   20540004
205500     END-IF.                                                      20550004
205600                                                                  20560004
205700 EJECT                                                            20570004
205800*----------------------------------------------------------------*20580004
205900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *20590004
206000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *20600004
206100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *20610004
206200*    DISPLAY THE PANEL TO USER.                                  *20620004
206300*----------------------------------------------------------------*20630004
206400                                                                  20640004
206500 4000-BUILD-INITIAL-PANEL.                                        20650004
206600                                                                  20660004
206700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            20670004
206800                                 ASC-BLOCK-ENTRIES (2).           20680004
206900     MOVE +1                 TO ASC-BLK-SUB.                      20690004
207000     SET ASC-ITEMS-LEFT-ON-DB                                     20700004
207100                             TO TRUE.                             20710004
207200                                                                  20720004
207300     MOVE +0                 TO ASC-ITEM-SUB                      20730004
207400                                ASC-NUMBER-OF-ITEMS-READ          20740004
207500                                ASC-NUMBER-OF-SELECTED-ITEMS      20750004
207600                                ASC-HIGHEST-BLOCK-WRITTEN         20760004
207700                                ASC-START-OF-SELECTED-RANGE       20770004
207800                                ASC-END-OF-SELECTED-RANGE         20780004
207900                                ASC-ITEM-AT-TOP-OF-PANEL.         20790004
208000     PERFORM 4100-PREPARE-CURSOR                                  20800004
208100                                                                  20810004
208200     PERFORM 4010-OPEN-CURSOR.                                    20820004
208300                                                                  20830004
208400     PERFORM 4300-READ-ITEMS-FROM-DB.                             20840004
208500                                                                  20850004
208600     PERFORM 4020-CLOSE-CURSOR.                                   20860004
208700                                                                  20870004
208800     MOVE +1                   TO  PV-TOP-ITEM.                   20880004
208900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          20890004
209000         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    20900004
209100         SET DP020-MSG-FATAL   TO  TRUE                           20910004
209200         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               20920004
209300     ELSE                                                         20930004
209400         MOVE -1               TO MR-SELECTL (1)                  20940004
209500         SET DP030-SET-CURSOR-APPL-1                              20950004
209600                               TO TRUE                            20960004
209700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     20970004
209800     END-IF.                                                      20980004
209900 EJECT                                                            20990004
210000*----------------------------------------------------------------*21000004
210100* OPEN THE SHIPMT CURSOR.                                        *21010004
210200*----------------------------------------------------------------*21020004
210300                                                                  21030004
210400 4010-OPEN-CURSOR.                                                21040004
210500                                                                  21050004
210600     IF PS-OR-CURSOR                                              21060004
210700        EXEC SQL                                                  21070004
210800           OPEN SHIPMENT-OR-CSR                                   21080004
210900        END-EXEC                                                  21090004
211000     ELSE                                                         21100004
211100        EXEC SQL                                                  21110004
211200           OPEN SHIPMENT-CSR                                      21120004
211300        END-EXEC                                                  21130004
211400     END-IF.                                                      21140004
211500                                                                  21150004
211600     EVALUATE TRUE                                                21160004
211700         WHEN SQLCODE = ZERO                                      21170004
211800              CONTINUE                                            21180004
211900                                                                  21190004
212000         WHEN SQLCODE = -904                                      21200004
212100         WHEN SQLCODE = -913                                      21210004
212200              MOVE SQLCODE                TO PV-SOFT-SQLCODE      21220004
212300              MOVE '4010-OPEN-CURSOR'     TO PV-SOFT-PARAGRAPH    21230004
212400              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          21240004
212500              MOVE DP020-USERID           TO PV-USER              21250004
212600              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    21260004
212700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    21270004
212800                                          TO PV-COMMAREA-LENGTH   21280004
212900              EXEC CICS                                           21290004
213000                 WRITEQ TD                                        21300004
213100                  QUEUE  ('CSSL')                                 21310004
213200                   FROM  (PV-CICS-MSG-AREA2)                      21320004
213300                 LENGTH  (PV-COMMAREA-LENGTH)                     21330004
213310                   RESP  (PV-CICS-RESP)                           21331004
213311              END-EXEC                                            21331104
213312                                                                  21331204
213313              INITIALIZE  PV-CICS-MSG-AREA2                       21331304
213314              MOVE DK-OPER-UNT-ID     TO  PV-DISP-OPER-ID         21331404
213315              MOVE DK-FCLTY-ID        TO  PV-DISP-FACILITY        21331504
213316                                                                  21331604
213317              STRING ' RCKCS261 -'                                21331704
213318                     '   DELVRY SCAC:'  DK-DELIVERY-SCAC-ID       21331804
213319                     '   ORIG SCAC:'    DK-ORIGIN-SCAC-ID         21331904
213320                     '   VEHICLE:'      DK-VEHICLE-NBR            21332004
213330                     '   OPER/FCLTY:'   PV-DISP-OPER-ID ' '       21333004
213340                                        PV-DISP-FACILITY          21334004
213350                                        DELIMITED BY SIZE         21335004
213360                                   INTO PV-CICS-MSG-AREA2         21336004
213370              MOVE LENGTH OF PV-CICS-MSG-AREA2                    21337004
213371                                          TO PV-COMMAREA-LENGTH   21337104
213372              EXEC CICS                                           21337204
213373                 WRITEQ TD                                        21337304
213374                  QUEUE  ('CSSL')                                 21337404
213375                   FROM  (PV-CICS-MSG-AREA2)                      21337504
213376                 LENGTH  (PV-COMMAREA-LENGTH)                     21337604
213377                   RESP  (PV-CICS-RESP)                           21337704
213378              END-EXEC                                            21337804
213379                                                                  21337904
213380              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         21338004
213381              SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE             21338104
213382              PERFORM 9900-SOFT-ABORT                             21338204
213383              INITIALIZE PV-CICS-MSG-AREA2                        21338304
213384                                                                  21338404
213385         WHEN SQLWARN0 NOT = SPACES                               21338504
213386         WHEN SQLCODE < ZERO                                      21338604
213387         WHEN SQLCODE > ZERO                                      21338704
213388              MOVE '4010-OPEN-CURSOR'                             21338804
213389                                TO DP013-PARAGRAPH                21338904
213390              MOVE 'OPEN SHIPMT CURSOR - '                        21339004
213400                                TO DP013-MESSAGE-TEXT (1)         21340004
213500              MOVE SQLCA        TO DP013-SQLCA                    21350004
213600              MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)       21360004
213700              SET DP013-DB2-ABEND                                 21370004
213800                  DP013-XCTL-DISPLAY-RESTART TO TRUE              21380004
213900              PERFORM DP013-0000-PROCESS-ABEND                    21390004
214000     END-EVALUATE.                                                21400004
214100                                                                  21410004
214200                                                                  21420004
214300*----------------------------------------------------------------*21430004
214400* CLOSE THE TMESSAGE CURSOR.                                     *21440004
214500*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *21450004
214600*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *21460004
214700*   USER.                                                        *21470004
214800*----------------------------------------------------------------*21480004
214900                                                                  21490004
215000 4020-CLOSE-CURSOR.                                               21500004
215100     IF PS-OR-CURSOR                                              21510004
215200         EXEC SQL                                                 21520004
215300             CLOSE SHIPMENT-OR-CSR                                21530004
215400         END-EXEC                                                 21540004
215500     ELSE                                                         21550004
215600         EXEC SQL                                                 21560004
215700             CLOSE SHIPMENT-CSR                                   21570004
215800         END-EXEC                                                 21580004
215900     END-IF.                                                      21590004
216000                                                                  21600004
216100     EVALUATE TRUE                                                21610004
216200         WHEN SQLCODE = ZERO                                      21620004
216300             CONTINUE                                             21630004
216400         WHEN SQLWARN0 NOT = SPACES                               21640004
216500         WHEN SQLCODE < ZERO                                      21650004
216600         WHEN SQLCODE > ZERO                                      21660004
216700             MOVE '4020-CLOSE-CURSOR'                             21670004
216800                               TO DP013-PARAGRAPH                 21680004
216900             MOVE 'CLOSE SHIPMT CURSOR '                          21690004
217000                               TO DP013-MESSAGE-TEXT (1)          21700004
217100             MOVE SQLCA        TO DP013-SQLCA                     21710004
217200             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        21720004
217300             SET DP013-DB2-ABEND                                  21730004
217400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21740004
217500             PERFORM DP013-0000-PROCESS-ABEND                     21750004
217600     END-EVALUATE.                                                21760004
217700                                                                  21770004
217800 EJECT                                                            21780004
217900*----------------------------------------------------------------*21790004
218000*    SET UP THE HOST VARIABLES.                                  *21800004
218100*----------------------------------------------------------------*21810004
218200                                                                  21820004
218300 4100-PREPARE-CURSOR.                                             21830004
218400                                                                  21840004
218500     MOVE ASC-KEY-OPER-UNT-ID-N TO DK-OPER-UNT-ID.                21850004
218600     MOVE ASC-KEY-FCLTY-ID-N    TO DK-FCLTY-ID.                   21860004
218700     MOVE ASC-KEY-ORIGIN-SCAC-ID TO DK-ORIGIN-SCAC-ID.            21870004
218800     MOVE ASC-KEY-DELIVERY-SCAC-ID TO DK-DELIVERY-SCAC-ID.        21880004
218900     MOVE ASC-KEY-VEH-NBR       TO DK-VEHICLE-NBR.                21890004
219000     IF ASC-KEY-PRO-NBR = SPACE                                   21900004
219100         MOVE SPACES            TO DK-PRO-B                       21910004
219200         MOVE HIGH-VALUES       TO DK-PRO-E                       21920004
219300     ELSE                                                         21930004
219400         MOVE ASC-KEY-PRO-NBR   TO DK-PRO-B                       21940004
219500         MOVE ASC-KEY-PRO-NBR   TO DK-PRO-E                       21950004
219600     END-IF.                                                      21960004
219700     IF ASC-KEY-BOL-NBR = SPACES                                  21970004
219800         MOVE SPACES            TO DK-BOL-B                       21980004
219900         MOVE HIGH-VALUES       TO DK-BOL-E                       21990004
220000     ELSE                                                         22000004
220100         MOVE ASC-KEY-BOL-NBR   TO DK-BOL-B                       22010004
220200         MOVE ASC-KEY-BOL-NBR   TO DK-BOL-E                       22020004
220300     END-IF.                                                      22030004
220400     IF ASC-KEY-PRO-NBR NOT = SPACE AND                           22040004
220500        ASC-KEY-BOL-NBR NOT = SPACES                              22050004
220600         SET PS-OR-CURSOR TO TRUE                                 22060004
220700     ELSE                                                         22070004
220800         SET PS-AND-CURSOR TO TRUE                                22080004
220900     END-IF.                                                      22090004
221000                                                                  22100004
221100                                                                  22110004
221200 EJECT                                                            22120004
221300*----------------------------------------------------------------*22130004
221400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *22140004
221500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *22150004
221600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *22160004
221700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *22170004
221800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *22180004
221900*                                                                *22190004
222000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *22200004
222100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *22210004
222200*    UPON INITIALIZATION.                                        *22220004
222300*----------------------------------------------------------------*22230004
222400                                                                  22240004
222500 4300-READ-ITEMS-FROM-DB.                                         22250004
222600                                                                  22260004
222700     PERFORM                                                      22270004
222800         VARYING PV-READ-COUNT                                    22280004
222900         FROM 1 BY 1                                              22290004
223000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    22300004
223100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         22310004
223200                                                                  22320004
223300         PERFORM 4310-FETCH                                       22330004
223400                                                                  22340004
223500         IF  ASC-ITEMS-LEFT-ON-DB                                 22350004
223600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                22360004
223700                 ADD +1            TO ASC-ITEM-SUB                22370004
223800             ELSE                                                 22380004
223900                 ADD +1            TO ASC-BLK-SUB                 22390004
224000                 MOVE +1           TO ASC-ITEM-SUB                22400004
224100                                                                  22410004
224200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         22420004
224300                     MOVE +1       TO ASC-BLK-SUB                 22430004
224400                     SET ASC-BLOCK-MODIFIED (1)                   22440004
224500                                   TO TRUE                        22450004
224600                     PERFORM 5100-WRITE-TEMP-STORAGE              22460004
224700                     MOVE ASC-BLOCK-ENTRIES                       22470004
224800                               (PC-MAX-BLOCKS-IN-ARRAY)           22480004
224900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 22490004
225000                     ADD +1        TO ASC-BLK-SUB                 22500004
225100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   22510004
225200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      22520004
225300                                   TO TRUE                        22530004
225400                 END-IF                                           22540004
225500             END-IF                                               22550004
225600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    22560004
225700             MOVE ASC-NUMBER-OF-ITEMS-READ                        22570004
225800                                   TO ASC-LIST-ITEM-NUMBER        22580004
225900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22590004
226000             MOVE SHIPMT-SHIPT-ID  TO ASC-SHIPT-ID                22600004
226100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22610004
226200                                      DK-SHIPT-ID                 22620004
226300             MOVE SHIPMT-TRIP-ID   TO ASC-TRIP-ID                 22630004
226400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22640004
226500             MOVE SHIPMT-VEND-SHIP-DTE TO ASC-VEND-SHIP-DTE       22650004
226600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22660004
226700             PERFORM 4350-SELECT-TSHIPST                          22670004
226800             PERFORM 4370-COUNT-PO                                22680004
226900             MOVE PV-SHIPMENT-CSR-IND                             22690004
227000                                   TO ASC-CSR-IND                 22700004
227100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22710004
227200             MOVE SHIPST-SHIPT-STATUS-CDE                         22720004
227300                                   TO ASC-STATUS                  22730004
227400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22740004
227500             MOVE SHIPMT-PRO-NBR   TO ASC-FREIGHT-BILL            22750004
227600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22760004
227700             MOVE SHIPMT-BOL-NBR   TO ASC-BILL-OF-LADING          22770004
227800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22780004
227900             IF SHIPMT-EXPTED-PKG-QTY > ZERO                      22790004
228000                 MOVE SHIPMT-EXPTED-PKG-QTY                       22800004
228100                                   TO ASC-CARTON-COUNT            22810004
228200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22820004
228300             ELSE                                                 22830004
228400                 IF SHIPMT-CARR-CART-CT > ZERO                    22840004
228500                     MOVE SHIPMT-CARR-CART-CT                     22850004
228600                                   TO ASC-CARTON-COUNT            22860004
228700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22870004
228800                 ELSE                                             22880004
228900                     MOVE SHIPMT-VEND-CART-CT                     22890004
229000                                   TO ASC-CARTON-COUNT            22900004
229100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22910004
229200                 END-IF                                           22920004
229300             END-IF                                               22930004
229400             MOVE SHIPMT-EXPTED-PKG-QTY                           22940004
229500                                   TO ASC-EXP-CTN-CNT             22950004
229600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22960004
229700             MOVE SHIPMT-VEND-CART-CT                             22970004
229800                                   TO ASC-VEND-CTN-CNT            22980004
229900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 22990004
230000             MOVE PV-DB2-COUNT     TO ASC-NBR-OF-POS              23000004
230100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23010004
230200             MOVE SHIPMT-ORIG-SCAC-ID                             23020004
230300                                   TO ASC-ORIGIN-SCAC             23030004
230400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23040004
230500         END-IF                                                   23050004
230600     END-PERFORM.                                                 23060004
230700                                                                  23070004
230800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          23080004
230900         MOVE +1               TO ASC-BLK-SUB                     23090004
231000         PERFORM 5100-WRITE-TEMP-STORAGE                          23100004
231100         ADD +1                TO ASC-BLK-SUB                     23110004
231200         PERFORM 5100-WRITE-TEMP-STORAGE                          23120004
231300                                                                  23130004
231400         MOVE 1                TO ASC-BLK-SUB                     23140004
231500                                  PV-BLOCK-NUMBER                 23150004
231600         PERFORM 4410-READ-TEMP-STORAGE                           23160004
231700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             23170004
231800             MOVE 2            TO ASC-BLK-SUB                     23180004
231900                                  PV-BLOCK-NUMBER                 23190004
232000             PERFORM 4410-READ-TEMP-STORAGE                       23200004
232100         END-IF                                                   23210004
232200     END-IF.                                                      23220004
232300 EJECT                                                            23230004
232400*----------------------------------------------------------------*23240004
232500*    FETCH THE MESSAGE CURSOR.                                   *23250004
232600*----------------------------------------------------------------*23260004
232700                                                                  23270004
232800 4310-FETCH.                                                      23280004
232900                                                                  23290004
233000     IF PS-OR-CURSOR                                              23300004
233100         EXEC SQL                                                 23310004
233200              FETCH SHIPMENT-OR-CSR                               23320004
233300              INTO  :PV-SHIPMENT-CSR-IND                          23330004
233400                  , :SHIPMT-TRIP-ID                               23340004
233500                  , :SHIPMT-SHIPT-ID                              23350004
233600                  , :SHIPMT-PRO-NBR                               23360004
233700                  , :SHIPMT-BOL-NBR                               23370004
233800                  , :SHIPMT-EXPTED-PKG-QTY                        23380004
233900                  , :SHIPMT-VEND-SHIP-DTE                         23390004
234000                  , :SHIPMT-ORIG-SCAC-ID                          23400004
234100                  , :SHIPMT-CARR-CART-CT                          23410004
234200                  , :SHIPMT-VEND-CART-CT                          23420004
234300         END-EXEC                                                 23430004
234400     ELSE                                                         23440004
234500         EXEC SQL                                                 23450004
234600              FETCH SHIPMENT-CSR                                  23460004
234700              INTO  :PV-SHIPMENT-CSR-IND                          23470004
234800                  , :SHIPMT-TRIP-ID                               23480004
234900                  , :SHIPMT-SHIPT-ID                              23490004
235000                  , :SHIPMT-PRO-NBR                               23500004
235100                  , :SHIPMT-BOL-NBR                               23510004
235200                  , :SHIPMT-EXPTED-PKG-QTY                        23520004
235300                  , :SHIPMT-VEND-SHIP-DTE                         23530004
235400                  , :SHIPMT-ORIG-SCAC-ID                          23540004
235500                  , :SHIPMT-CARR-CART-CT                          23550004
235600                  , :SHIPMT-VEND-CART-CT                          23560004
235700         END-EXEC                                                 23570004
235800                                                                  23580004
235900                                                                  23590004
236000     EVALUATE TRUE                                                23600004
236100         WHEN SQLCODE = ZERO                                      23610004
236200         WHEN SQLCODE = +100                                      23620004
236300              CONTINUE                                            23630004
236400         WHEN SQLWARN0 NOT = SPACE                                23640004
236500         WHEN SQLCODE NOT = ZERO                                  23650004
236600              MOVE '4310-FETCH-CURSOR'                            23660004
236700                               TO DP013-PARAGRAPH                 23670004
236800              MOVE 'FETCH MESSAGE CURSOR'                         23680004
236900                               TO DP013-MESSAGE-TEXT (1)          23690004
237000              MOVE SQLCA       TO DP013-SQLCA                     23700004
237100              SET DP013-DB2-ABEND                                 23710004
237200                               TO TRUE                            23720004
237300              PERFORM DP013-0000-PROCESS-ABEND                    23730004
237400     END-EVALUATE.                                                23740004
237500                                                                  23750004
237600     IF  SQLCODE EQUAL +100                                       23760004
237700         SET ASC-NO-ITEMS-LEFT-ON-DB                              23770004
237800                                   TO TRUE                        23780004
237900     END-IF.                                                      23790004
238000                                                                  23800004
238100*----------------------------------------------------------------*23810004
238200*  SELECT LATEST SHIPMENT STATUS ROW                             *23820004
238300*----------------------------------------------------------------*23830004
238400 4350-SELECT-TSHIPST.                                             23840004
238500                                                                  23850004
238600     EXEC SQL                                                     23860004
238700          SELECT  A.SHIPT_ID                                      23870004
238800                 ,A.SHIPT_STATUS_CDE                              23880004
238900                 ,A.STATUS_DTE                                    23890004
239000                 ,A.STATUS_TME                                    23900004
239100                 ,A.STATUS_UID                                    23910004
239200                 ,A.DELAY_RSN_CDE                                 23920004
239300                 ,A.CARR_STATUS_CDE                               23930004
239400                 ,A.TIME_ZONE_CDE                                 23940004
239500                 ,A.CITY_NAME                                     23950004
239600                 ,A.STATE_CDE                                     23960004
239700          INTO    :SHIPST-SHIPT-ID                                23970004
239800                 ,:SHIPST-SHIPT-STATUS-CDE                        23980004
239900                 ,:SHIPST-STATUS-DTE                              23990004
240000                 ,:SHIPST-STATUS-TME                              24000004
240100                 ,:SHIPST-STATUS-UID                              24010004
240200                 ,:SHIPST-DELAY-RSN-CDE                           24020004
240300                 ,:SHIPST-CARR-STATUS-CDE                         24030004
240400                 ,:SHIPST-TIME-ZONE-CDE                           24040004
240500                 ,:SHIPST-CITY-NAME                               24050004
240600                 ,:SHIPST-STATE-CDE                               24060004
240700         FROM   TSHIPST A                                         24070004
240800               ,TSHSTYP B                                         24080004
240900        WHERE  A.SHIPT_ID = :DK-SHIPT-ID                          24090004
241000          AND  B.PRTY_CDE =                                       24100004
241100                  (SELECT MAX(D.PRTY_CDE)                         24110004
241200                     FROM TSHIPST C                               24120004
241300                         ,TSHSTYP D                               24130004
241400                    WHERE C.SHIPT_ID         = A.SHIPT_ID         24140004
241500                      AND C.SHIPT_STATUS_CDE = D.SHIPT_STATUS_CDE)24150004
241600          AND  A.SHIPT_STATUS_CDE = B.SHIPT_STATUS_CDE            24160004
241700     END-EXEC.                                                    24170004
241800                                                                  24180004
241900     EVALUATE TRUE                                                24190004
242000         WHEN SQLCODE = +0                                        24200004
242100              CONTINUE                                            24210004
242200                                                                  24220004
242300         WHEN SQLCODE = -904                                      24230004
242400         WHEN SQLCODE = -913                                      24240004
242500              DISPLAY 'SHIPMENT ID : ' DK-SHIPT-ID                24250004
242600              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     24260004
242700              MOVE '4350-SELECT-TSHIPST '  TO PV-SOFT-PARAGRAPH   24270004
242800              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         24280004
242900              MOVE DP020-USERID            TO PV-USER             24290004
243000              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   24300004
243100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    24310004
243200                                           TO PV-COMMAREA-LENGTH  24320004
243300              EXEC CICS                                           24330004
243400                 WRITEQ TD                                        24340004
243500                  QUEUE  ('CSSL')                                 24350004
243600                   FROM  (PV-CICS-MSG-AREA2)                      24360004
243700                 LENGTH  (PV-COMMAREA-LENGTH)                     24370004
243800                   RESP  (PV-CICS-RESP)                           24380004
243900              END-EXEC                                            24390004
244000              INITIALIZE PV-CICS-MSG-AREA2                        24400004
244100              MOVE DK-SHIPT-ID     TO  PV-DISP-SHIPT-ID           24410004
244200              STRING ' RCKCS261 -'             DELIMITED BY SIZE  24420004
244300                     ' 4350-SELECT-TSHIPST - ' DELIMITED BY SIZE  24430004
244400                     ' SHIPMENT ID - '         DELIMITED BY SIZE  24440004
244500                       PV-DISP-SHIPT-ID        DELIMITED BY SIZE  24450004
244600                                          INTO PV-CICS-MSG-AREA2  24460004
244700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    24470004
244800                                            TO PV-COMMAREA-LENGTH 24480004
244900              EXEC CICS                                           24490004
245000                   WRITEQ TD                                      24500004
245100                    QUEUE  ('CSSL')                               24510004
245200                     FROM  (PV-CICS-MSG-AREA2)                    24520004
245300                   LENGTH  (PV-COMMAREA-LENGTH)                   24530004
245400                     RESP  (PV-CICS-RESP)                         24540004
245500              END-EXEC                                            24550004
245600              INITIALIZE PV-CICS-MSG-AREA2                        24560004
245700              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         24570004
245800              SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE             24580004
245900              PERFORM 9900-SOFT-ABORT                             24590004
246000                                                                  24600004
246100         WHEN SQLWARN0 NOT = SPACES                               24610004
246200         WHEN SQLCODE < +0                                        24620004
246300         WHEN SQLCODE > +0                                        24630004
246400              DISPLAY 'SHIPMENT ID : ' DK-SHIPT-ID                24640004
246500              MOVE '4350-SELECT-TSHIPST'                          24650004
246501                                TO DP013-PARAGRAPH                24650104
246502              MOVE 'SELECT A TSHIPST ROW   '                      24650204
246503                                TO DP013-MESSAGE-TEXT(1)          24650304
246504              MOVE DK-SHIPT-ID  TO DP013-MESSAGE-TEXT(2)          24650404
246505              MOVE SQLCA        TO DP013-SQLCA                    24650504
246506              MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)       24650604
246507              SET DP013-DB2-ABEND                                 24650704
246508                  DP013-XCTL-DISPLAY-RESTART TO TRUE              24650804
246509              PERFORM DP013-0000-PROCESS-ABEND                    24650904
246510     END-EVALUATE.                                                24651004
246511                                                                  24651104
246512                                                                  24651204
246513*----------------------------------------------------------------*24651304
246514*    COUNT THE NUMBER OF PO'S FOR THE SHIPMENT                   *24651404
246515*----------------------------------------------------------------*24651504
246516 4370-COUNT-PO.                                                   24651604
246517                                                                  24651704
246518     EXEC SQL                                                     24651804
246519          SELECT COUNT(*)                                         24651904
246520            INTO :PV-DB2-COUNT                                    24652004
246530            FROM TSHPTPO                                          24653004
246540           WHERE SHIPT_ID = :DK-SHIPT-ID                          24654004
246550     END-EXEC.                                                    24655004
246560                                                                  24656004
246570     EVALUATE TRUE                                                24657004
246580         WHEN SQLCODE = +0                                        24658004
246590         WHEN SQLCODE = +100                                      24659004
246600              CONTINUE                                            24660004
246700                                                                  24670004
246800         WHEN SQLCODE = -904                                      24680004
246900         WHEN SQLCODE = -913                                      24690004
247000              MOVE SQLCODE                TO PV-SOFT-SQLCODE      24700004
247100              MOVE '4370-COUNT-PO       ' TO PV-SOFT-PARAGRAPH    24710004
247200              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          24720004
247300              MOVE DP020-USERID           TO PV-USER              24730004
247400              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    24740004
247500              MOVE LENGTH OF PV-CICS-MSG-AREA2                    24750004
247600                                          TO PV-COMMAREA-LENGTH   24760004
247700               EXEC CICS                                          24770004
247800                    WRITEQ TD                                     24780004
247900                     QUEUE  ('CSSL')                              24790004
248000                      FROM  (PV-CICS-MSG-AREA2)                   24800004
248100                    LENGTH  (PV-COMMAREA-LENGTH)                  24810004
248200                      RESP  (PV-CICS-RESP)                        24820004
248300               END-EXEC                                           24830004
248400                                                                  24840004
248500               INITIALIZE PV-CICS-MSG-AREA2                       24850004
248600               MOVE DK-SHIPT-ID     TO  PV-DISP-SHIPT-ID          24860004
248700               STRING ' RCKCS261 -'            DELIMITED BY SIZE  24870004
248800                      ' 4370-COUNT-PO - '      DELIMITED BY SIZE  24880004
248900                      ' SHIPMENT ID - '        DELIMITED BY SIZE  24890004
249000                        PV-DISP-SHIPT-ID       DELIMITED BY SIZE  24900004
249100                                          INTO PV-CICS-MSG-AREA2  24910004
249200               MOVE LENGTH OF PV-CICS-MSG-AREA2                   24920004
249300                    TO PV-COMMAREA-LENGTH                         24930004
249400               EXEC CICS                                          24940004
249500                  WRITEQ TD                                       24950004
249600                   QUEUE  ('CSSL')                                24960004
249700                    FROM  (PV-CICS-MSG-AREA2)                     24970004
249800                  LENGTH  (PV-COMMAREA-LENGTH)                    24980004
249900                    RESP  (PV-CICS-RESP)                          24990004
250000               END-EXEC                                           25000004
250100                                                                  25010004
250200               INITIALIZE PV-CICS-MSG-AREA2                       25020004
250300               MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER        25030004
250400               SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE            25040004
250500               PERFORM 9900-SOFT-ABORT                            25050004
250600                                                                  25060004
250700             WHEN SQLWARN0 NOT = SPACES                           25070004
250800         WHEN SQLCODE < +0                                        25080004
250900         WHEN SQLCODE > +0                                        25090004
251000              MOVE '4370-COUNT-PO'                                25100004
251100                              TO DP013-PARAGRAPH                  25110004
251200              MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO TABLE'         25120004
251300                              TO DP013-MESSAGE-TEXT (1)           25130004
251400              MOVE SQLCA      TO DP013-SQLCA                      25140004
251500              MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)         25150004
251600              SET DP013-DB2-ABEND                                 25160004
251700                  DP013-XCTL-DISPLAY-RESTART                      25170004
251800                              TO TRUE                             25180004
251900              PERFORM DP013-0000-PROCESS-ABEND                    25190004
252000     END-EVALUATE.                                                25200004
252100                                                                  25210004
252200                                                                  25220004
252300*----------------------------------------------------------------*25230004
252400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *25240004
252410*----------------------------------------------------------------*25241004
252420                                                                  25242004
252430 4400-MOVE-COMMAREA-TO-SCREEN.                                    25243004
252440     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             25244004
252450         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          25245004
252460         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          25246004
252470             MOVE +1    TO ASC-BLK-SUB                            25247004
252480             PERFORM 5100-WRITE-TEMP-STORAGE                      25248004
252490             ADD +1     TO ASC-BLK-SUB                            25249004
252500             PERFORM 5100-WRITE-TEMP-STORAGE                      25250004
252600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             25260004
252700                 GIVING PV-BLOCK-NUMBER                           25270004
252800                 REMAINDER PV-REMAINDER                           25280004
252900             IF  PV-REMAINDER > ZERO                              25290004
253000                 ADD +1 TO PV-BLOCK-NUMBER                        25300004
253100             END-IF                                               25310004
253200             MOVE +1    TO ASC-BLK-SUB                            25320004
253300             PERFORM 4410-READ-TEMP-STORAGE                       25330004
253400             ADD +1     TO ASC-BLK-SUB                            25340004
253500                           PV-BLOCK-NUMBER                        25350004
253600             PERFORM 4410-READ-TEMP-STORAGE                       25360004
253700     END-IF.                                                      25370004
253800     MOVE +1            TO ASC-BLK-SUB.                           25380004
253900     COMPUTE ASC-ITEM-SUB =                                       25390004
254000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              25400004
254100         + PC-ITEMS-PER-PANEL).                                   25410004
254200                                                                  25420004
254300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        25430004
254400         ADD +1         TO ASC-BLK-SUB                            25440004
254500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            25450004
254600     END-IF.                                                      25460004
254700                                                                  25470004
254800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           25480004
254900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                25490004
255000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        25500004
255100     PERFORM 4420-FORMAT-LIST-LINES                               25510004
255200         VARYING PV-SUB                                           25520004
255300         FROM PC-ITEMS-PER-PANEL BY -1                            25530004
255400         UNTIL PV-SUB < +1.                                       25540004
255500                                                                  25550004
255600     COMPUTE ASC-ITEMS-DISPLAYED =                                25560004
255700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          25570004
255800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    25580004
255900                                      ASTRTITO.                   25590004
256000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    25600004
256100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    25610004
256200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25620004
256300                                   TO ASELITO.                    25630004
256400     MOVE ASC-KEY-OPER-UNT-ID      TO AOPRUNTO.                   25640004
256500     MOVE ASC-KEY-FCLTY-ID         TO AFCLTYO.                    25650004
256600     MOVE ASC-KEY-ORIGIN-SCAC-ID   TO ADELSCAO.                   25660004
256700     MOVE ASC-KEY-VEH-NBR          TO ATRALERO.                   25670004
256800     MOVE ASC-KEY-STATUS           TO ASTATUSO.                   25680004
256900                                                                  25690004
257000     IF  DP020-MSG-NUMBER-X = SPACE                               25700004
257100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  25710004
257200*            --- MORE ITEMS TO DISPLAY ----                       25720004
257300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            25730004
257400             SET DP020-MSG-INFORMATIONAL TO TRUE                  25740004
257500         END-IF                                                   25750004
257600     END-IF.                                                      25760004
257700*----------------------------------------------------------------*25770004
257800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *25780004
257900*----------------------------------------------------------------*25790004
258000                                                                  25800004
258100 4410-READ-TEMP-STORAGE.                                          25810004
258200                                                                  25820004
258300     EXEC CICS                                                    25830004
258400         READQ TS                                                 25840004
258500             QUEUE (ASC-LIST-QUEUE-NAME)                          25850004
258600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25860004
258700             ITEM  (PV-BLOCK-NUMBER)                              25870004
258800             RESP  (PV-CICS-RESP)                                 25880004
258900     END-EXEC.                                                    25890004
259000                                                                  25900004
259100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       25910004
259200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     25920004
259300         CONTINUE                                                 25930004
259400     ELSE                                                         25940004
259500         SET DP013-CICS-ABEND     TO TRUE                         25950004
259600         SET DP013-NO-ROLLBACK    TO TRUE                         25960004
259700         MOVE '4410-READ-TEMP-STORAGE'                            25970004
259800                                  TO DP013-PARAGRAPH              25980004
259900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      25990004
260000                                  TO DP013-MESSAGE-TEXT(1)        26000004
260100         PERFORM DP013-0000-PROCESS-ABEND                         26010004
260200     END-IF.                                                      26020004
260300                                                                  26030004
260400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26040004
260500                                                                  26050004
260600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         26060004
260700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               26070004
260800     END-IF.                                                      26080004
260900 EJECT                                                            26090004
261000*----------------------------------------------------------------*26100004
261100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *26110004
261200*----------------------------------------------------------------*26120004
261300                                                                  26130004
261400 4420-FORMAT-LIST-LINES.                                          26140004
261500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      26150004
261600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                26160004
261700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           26170004
261800         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           26180004
261900         MOVE SPACE              TO MR-SELECTI (PV-SUB)           26190004
262000                                    MR-STATUS (PV-SUB)            26200004
262100                                    MR-FREIGHT-BILL (PV-SUB)      26210004
262200                                    MR-BILL-OF-LADING (PV-SUB)    26220004
262300                                    MR-CARTON-COUNT-X (PV-SUB)    26230004
262400                                    MR-NBR-OF-POS-X (PV-SUB)      26240004
262500                                    MR-VENDOR (PV-SUB)            26250004
262600                                    MR-ORIGIN-SCAC (PV-SUB)       26260004
262700     ELSE                                                         26270004
262800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26280004
262900                                                   > SPACE        26290004
263000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 26300004
263100                                 TO MR-SELECTI (PV-SUB)           26310004
263200         ELSE                                                     26320004
263300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      26330004
263400                                 TO MR-SELECTI (PV-SUB)           26340004
263500         END-IF                                                   26350004
263600                                                                  26360004
263700         IF  DP030-SET-CURSOR-TRAILER                             26370004
263800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)26380004
263900                 > SPACE)                                         26390004
264000               OR (PV-SUB = 1))                                   26400004
264100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               26410004
264200                MOVE -1          TO MR-SELECTL (PV-SUB)           26420004
264300             END-IF                                               26430004
264400         END-IF                                                   26440004
264500                                                                  26450004
264600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           26460004
264700             IF ASC-CSR-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'B'      26470004
264800                 MOVE DP015-YELLOW TO MR-STATUSC (PV-SUB)         26480004
264900                                      MR-FREIGHT-BILLC (PV-SUB)   26490004
265000                                      MR-BILL-OF-LADINGC (PV-SUB) 26500004
265100                                      MR-CARTON-COUNTC (PV-SUB)   26510004
265200                                      MR-NBR-OF-POSC (PV-SUB)     26520004
265300                                      MR-VENDORC (PV-SUB)         26530004
265400                                      MR-ORIGIN-SCACC (PV-SUB)    26540004
265500             ELSE                                                 26550004
265600                 MOVE DP015-GREEN  TO MR-STATUSC (PV-SUB)         26560004
265700                                      MR-FREIGHT-BILLC (PV-SUB)   26570004
265800                                      MR-BILL-OF-LADINGC (PV-SUB) 26580004
265900                                      MR-CARTON-COUNTC (PV-SUB)   26590004
266000                                      MR-NBR-OF-POSC (PV-SUB)     26600004
266100                                      MR-VENDORC (PV-SUB)         26610004
266200                                      MR-ORIGIN-SCACC (PV-SUB)    26620004
266300             END-IF                                               26630004
266400             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           26640004
266500                                 TO MR-STATUS (PV-SUB)            26650004
266600             MOVE ASC-FREIGHT-BILL (ASC-BLK-SUB ASC-ITEM-SUB)     26660004
266700                                 TO MR-FREIGHT-BILL (PV-SUB)      26670004
266800             MOVE ASC-BILL-OF-LADING (ASC-BLK-SUB ASC-ITEM-SUB)   26680004
266900                                 TO MR-BILL-OF-LADING (PV-SUB)    26690004
267000             MOVE ASC-CARTON-COUNT (ASC-BLK-SUB ASC-ITEM-SUB)     26700004
267100                                 TO MR-CARTON-COUNT (PV-SUB)      26710004
267200             MOVE ASC-NBR-OF-POS (ASC-BLK-SUB ASC-ITEM-SUB)       26720004
267300                                 TO MR-NBR-OF-POS (PV-SUB)        26730004
267400             MOVE ASC-VENDOR (ASC-BLK-SUB ASC-ITEM-SUB)           26740004
267500                                 TO MR-VENDOR (PV-SUB)            26750004
267600             MOVE ASC-ORIGIN-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)      26760004
267700                                 TO MR-ORIGIN-SCAC (PV-SUB)       26770004
267800         END-IF                                                   26780004
267900     END-IF.                                                      26790004
268000     SUBTRACT +1 FROM ASC-ITEM-SUB                                26800004
268100     IF  ASC-ITEM-SUB < + 1                                       26810004
268200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  26820004
268300         MOVE +1                 TO ASC-BLK-SUB                   26830004
268400     END-IF.                                                      26840004
268500******************************************************************26850004
268600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **26860004
268700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **26870004
268800** ISSUE A WARNING.                                             **26880004
268900******************************************************************26890004
269000 4430-CHECK-FOR-BEGIN-AND-END.                                    26900004
269100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       26910004
269200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     26920004
269300*            -- NO END-OF-RANGE SPECFIED ---                      26930004
269400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            26940004
269500             SET DP020-MSG-WARNING TO TRUE                        26950004
269600             PERFORM 4431-POSITION-AT-WARNING                     26960004
269700         END-IF                                                   26970004
269800     ELSE                                                         26980004
269900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     26990004
270000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                27000004
270100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            27010004
270200             SET DP020-MSG-WARNING TO TRUE                        27020004
270300             PERFORM 4431-POSITION-AT-WARNING                     27030004
270400         END-IF                                                   27040004
270500     END-IF.                                                      27050004
270600******************************************************************27060004
270700** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **27070004
270800** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **27080004
270900** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **27090004
271000** POSITION THE CURSOR THERE.                                   **27100004
271100******************************************************************27110004
271200 4431-POSITION-AT-WARNING.                                        27120004
271300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 27130004
271400                    - PV-TOP-ITEM + 1.                            27140004
271500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27150004
271600         CONTINUE                                                 27160004
271700     ELSE                                                         27170004
271800         SET DP030-SET-CURSOR-APPL-1                              27180004
271900                                   TO TRUE                        27190004
272000         MOVE -1                   TO MR-SELECTL (PV-SUB)         27200004
272100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27210004
272200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         27220004
272300     END-IF.                                                      27230004
272400                                                                  27240004
272500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   27250004
272600                    - PV-TOP-ITEM + 1.                            27260004
272700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27270004
272800         CONTINUE                                                 27280004
272900     ELSE                                                         27290004
273000         SET DP030-SET-CURSOR-APPL-1                              27300004
273100                                   TO TRUE                        27310004
273200         MOVE -1                   TO MR-SELECTL (PV-SUB)         27320004
273300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27330004
273400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         27340004
273500     END-IF.                                                      27350004
273600 EJECT                                                            27360004
273700*----------------------------------------------------------------*27370004
273800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *27380004
273900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *27390004
274000* FOR THE SELECTED ITEMS QUEUE.                                  *27400004
274100*                                                                *27410004
274200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *27420004
274300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *27430004
274400* THE ARRAY IS FULL.                                             *27440004
274500*----------------------------------------------------------------*27450004
274600                                                                  27460004
274700 5000-PREPARE-SEL-QUEUE.                                          27470004
274800                                                                  27480004
274900     MOVE +1                   TO  ASC-BLK-SUB.                   27490004
275000     PERFORM 5100-WRITE-TEMP-STORAGE.                             27500004
275100     ADD +1                    TO  ASC-BLK-SUB.                   27510004
275200     PERFORM 5100-WRITE-TEMP-STORAGE.                             27520004
275300                                                                  27530004
275400     MOVE ASC-SEL-QUEUE-NAME   TO  RC015-SEL-QUEUE-NAME.          27540004
275500     PERFORM 6010-DELETE-SEL-QUEUE.                               27550004
275600                                                                  27560004
275700     SET ASC-UPDATE-TSQ        TO  TRUE.                          27570004
275800                                                                  27580004
275900     SET RC013-IDX             TO  1.                             27590004
276000     MOVE ZERO                 TO RC015-NUMBER-OF-TS-ITEMS.       27600004
276100     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        27610004
276200                                                                  27620004
276300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           27630004
276400             VARYING PV-ITEM                                      27640004
276500             FROM 1 BY 1                                          27650004
276600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     27660004
276700                                                                  27670004
276800     IF  RC013-IDX > 1                                            27680004
276900         PERFORM 5205-WRITE-SEL-QUEUE                             27690004
277000         ADD +1                TO RC015-NUMBER-OF-TS-ITEMS        27700004
277100     END-IF.                                                      27710004
277200 EJECT                                                            27720004
277300*----------------------------------------------------------------*27730004
277400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *27740004
277500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *27750004
277600*----------------------------------------------------------------*27760004
277700                                                                  27770004
277800 5100-WRITE-TEMP-STORAGE.                                         27780004
277900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     27790004
278000                                   TO PV-LIST-ITEM-NUMBER.        27800004
278100     COMPUTE PV-BLOCK-NUMBER =                                    27810004
278200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    27820004
278300                                                                  27830004
278400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             27840004
278500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             27850004
278600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      27860004
278700             PERFORM 5105-REWRITE-ASC-LISTQ                       27870004
278800         END-IF                                                   27880004
278900     ELSE                                                         27890004
279000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       27900004
279100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            27910004
279200         PERFORM 5110-WRITE-ASC-LISTQ                             27920004
279300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   27930004
279400     END-IF.                                                      27940004
279500                                                                  27950004
279600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             27960004
279700******************************************************************27970004
279800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **27980004
279900** SPECIFIC COMMAREA.                                           **27990004
280000******************************************************************28000004
280100 5105-REWRITE-ASC-LISTQ.                                          28010004
280200     EXEC CICS                                                    28020004
280300         WRITEQ TS                                                28030004
280400             QUEUE (ASC-LIST-QUEUE-NAME)                          28040004
280500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28050004
280600             ITEM  (PV-BLOCK-NUMBER)                              28060004
280700             REWRITE                                              28070004
280800             RESP  (PV-CICS-RESP)                                 28080004
280900     END-EXEC.                                                    28090004
281000                                                                  28100004
281100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           28110004
281200         CONTINUE                                                 28120004
281300     ELSE                                                         28130004
281400         SET DP013-CICS-ABEND            TO TRUE                  28140004
281500         SET DP013-NO-ROLLBACK           TO TRUE                  28150004
281600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       28160004
281700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     28170004
281800                                         TO DP013-MESSAGE-TEXT(1) 28180004
281900         PERFORM DP013-0000-PROCESS-ABEND                         28190004
282000     END-IF.                                                      28200004
282100                                                                  28210004
282200******************************************************************28220004
282300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **28230004
282400** SPECIFIC COMMAREA.                                           **28240004
282500******************************************************************28250004
282600 5110-WRITE-ASC-LISTQ.                                            28260004
282700     EXEC CICS                                                    28270004
282800         WRITEQ TS                                                28280004
282900             QUEUE (ASC-LIST-QUEUE-NAME)                          28290004
283000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28300004
283100             ITEM  (PV-BLOCK-NUMBER)                              28310004
283200             RESP  (PV-CICS-RESP)                                 28320004
283300     END-EXEC.                                                    28330004
283400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      28340004
283500         SET DP013-CICS-ABEND      TO TRUE                        28350004
283600         SET DP013-NO-ROLLBACK     TO TRUE                        28360004
283700         MOVE '5110-WRITE-ASC-LISTQ'                              28370004
283800                                   TO DP013-PARAGRAPH             28380004
283900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           28390004
284000                                   TO DP013-MESSAGE-TEXT(1)       28400004
284100         PERFORM DP013-0000-PROCESS-ABEND                         28410004
284200     END-IF.                                                      28420004
284300 EJECT                                                            28430004
284400*----------------------------------------------------------------*28440004
284500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *28450004
284600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *28460004
284700*----------------------------------------------------------------*28470004
284800                                                                  28480004
284900 5200-FILL-SEL-QUEUE-RECORD.                                      28490004
285000                                                                  28500004
285100     PERFORM 6112-READ-LIST-QUEUE.                                28510004
285200                                                                  28520004
285300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       28530004
285400         PERFORM                                                  28540004
285500         VARYING LQW-IDX                                          28550004
285600         FROM 1 BY 1                                              28560004
285700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            28570004
285800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          28580004
285900                                                                  28590004
286000             IF  LQW-SELECT (LQW-IDX)                             28600004
286100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              28610004
286200                                   TO RC013-ITEM (RC013-IDX)      28620004
286300                 MOVE LQW-SHIPT-ID       (LQW-IDX)                28630004
286400                                   TO RC013-SHIPT-ID              28640004
286500                                        (RC013-IDX)               28650004
286600                                      DK-SHIPT-ID                 28660004
286700                 MOVE LQW-CSR-IND       (LQW-IDX)                 28670004
286800                                   TO RC013-CSR-IND               28680004
286900                                        (RC013-IDX)               28690004
287000                 MOVE LQW-TRIP-ID       (LQW-IDX)                 28700004
287100                                   TO RC013-TRIP-ID               28710004
287200                                        (RC013-IDX)               28720004
287300                 IF (DP020-FK-CONFIRM (DP020-SRC-AID) OR          28730004
287400                    PS-COMPLETE-UPDATES) AND                      28740004
287500                    LQW-CSR-IND (LQW-IDX) = 'B'                   28750004
287600                     MOVE SPACES TO LQW-SELECTED-SW (LQW-IDX)     28760004
287700                     ADD 1 TO PV-NUMBER-OF-UPDATES                28770004
287800                     MOVE LQW-TRIP-ID (LQW-IDX) TO                28780004
287900                                      PV-SAVE-TRIP-ID             28790004
288000                     MOVE LQW-VEND-SHIP-DTE  (LQW-IDX) TO         28800004
288100                                         PV-VEND-SHIP-DTE         28810004
288200                     IF LQW-EXP-CTN-CNT  (LQW-IDX) > 0            28820004
288300                         MOVE LQW-EXP-CTN-CNT  (LQW-IDX)          28830004
288400                             TO SHIPMT-EXPTED-PKG-QTY             28840004
288500                     ELSE                                         28850004
288600                         MOVE LQW-VEND-CTN-CNT (LQW-IDX)          28860004
288700                             TO SHIPMT-EXPTED-PKG-QTY             28870004
288800                     END-IF                                       28880004
288900                     PERFORM 5300-ASSIGN-SHIPMENT-TO-TRIP         28890004
289000                 ELSE                                             28900004
289100                 IF (DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR    28910004
289200                    DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)) AND   28920004
289300                    LQW-CSR-IND (LQW-IDX) = 'B'                   28930004
289400                     SET PS-NO-DUPLICATE-SHIPMT                   28940004
289500                         PS-VALID-SHIPMT-SELECTED TO TRUE         28950004
289600                     PERFORM 5270-SELECT-TSHIPMT                  28960004
289700                     IF SHIPMT-PRO-SCAC-ID NOT =                  28970004
289800                                 ASC-KEY-ORIGIN-SCAC-ID           28980004
289900                         PERFORM 5280-SELECT-TSHIPMT              28990004
290000                         IF SQLCODE = 0                           29000004
290100                             SET PS-DUPLICATE-SHIPMT TO TRUE      29010004
290200                         END-IF                                   29020004
290300                     END-IF                                       29030004
290400                     IF PS-DUPLICATE-SHIPMT                       29040004
290500                         MOVE PC-TSYMSG-01088                     29050004
290600                                           TO DP020-MSG-NUMBER    29060004
290700                         SET DP020-MSG-WARNING                    29070004
290800                             PS-ERROR TO TRUE                     29080004
290900                                                                  29090004
291000                     ELSE                                         29100004
291100                         PERFORM 5460-OPEN-CURSOR                 29110004
291200                         SET PS-NOT-END-OF-CURSOR TO TRUE         29120004
291300                         PERFORM 5485-FETCH-CURSOR                29130004
291400                             UNTIL PS-END-OF-CURSOR OR            29140004
291500                                   PS-PO-NOW-ON-TRAILER           29150004
291600                         PERFORM 5470-CLOSE-CURSOR                29160004
291700                         IF PS-PO-NOW-ON-TRAILER                  29170004
291800                             MOVE PC-TSYMSG-01160                 29180004
291900                                               TO DP020-MSG-NUMBER29190004
292000                             SET DP020-MSG-INFORMATIONAL          29200004
292100                                          TO TRUE                 29210004
292200                         ELSE                                     29220004
292300* JAK 04/2007 - START WMS CODE                                    29230004
292400*                            CONTINUE                             29240004
292500                             IF DP020-FK-LOCAL-FUNC-01            29250004
292600                                           (DP020-SRC-AID)        29260004
292700                                 SET PS-WMS-INSERT TO TRUE        29270004
292800                                 MOVE LQW-SHIPT-ID (LQW-IDX)      29280004
292900                                             TO DK-SHIPT-ID       29290004
293000*                                MOVE LQW-TRIP-ID (LQW-IDX)       29300004
293100*                                            TO DK-TRIP-ID        29310004
293200                                 PERFORM 8000-WMS-SHIPMENT-CHECK  29320004
293300                             END-IF                               29330004
293400* JAK 04/2007 - END WMS CODE                                      29340004
293500                         END-IF                                   29350004
293600                     END-IF                                       29360004
293700                 ELSE                                             29370004
293800                   IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID) AND  29380004
293900                      LQW-CSR-IND (LQW-IDX) = 'A'                 29390004
294000                       MOVE ZERO TO PV-DB2-COUNT                  29400004
294100                       PERFORM 5250-COUNT-VERIFIED-RCVRS          29410004
294200                       IF PV-DB2-COUNT = 0                        29420004
294300* JAK 04/2007 - ADD CALL TO 8000- FOR F16/DETACH                  29430004
294400                           SET PS-WMS-DETACH TO TRUE              29440004
294500                           MOVE LQW-SHIPT-ID (LQW-IDX)            29450004
294600                                             TO DK-SHIPT-ID       29460004
294700                           MOVE LQW-TRIP-ID (LQW-IDX)             29470004
294800                                             TO DK-TRIP-ID        29480004
294900                           PERFORM 8000-WMS-SHIPMENT-CHECK        29490004
295000                           IF PS-NO-ERROR                         29500004
295100                             ADD 1 TO PV-NUMBER-OF-UPDATES        29510004
295200                             PERFORM 7000-DETACH-SHIPMENT         29520004
295300                             PERFORM 5450-UPDATE-SHPTPO-RECS      29530004
295400                           END-IF                                 29540004
295500                       END-IF                                     29550004
295600                   ELSE                                           29560004
295700                     PERFORM 5270-SELECT-TSHIPMT                  29570004
295800                     MOVE SHIPMT-PRO-NBR                          29580004
295900                                   TO RC013-PRO-NBR               29590004
296000                                        (RC013-IDX)               29600004
296100                     MOVE SHIPMT-BOL-NBR                          29610004
296200                                   TO RC013-BOL-NBR               29620004
296300                                        (RC013-IDX)               29630004
296400                     MOVE SHIPMT-PRO-SCAC-ID                      29640004
296500                                   TO RC013-OWNER-SCAC-ID         29650004
296600                                        (RC013-IDX)               29660004
296700                     MOVE ASC-KEY-VEH-NBR                         29670004
296800                                   TO RC013-VEH-NBR               29680004
296900                                        (RC013-IDX)               29690004
297000                     MOVE ASC-KEY-STATUS                          29700004
297100                                   TO RC013-PKSL-STAT-CDE         29710004
297200                                        (RC013-IDX)               29720004
297300                     MOVE ASC-KEY-OPER-UNT-ID-N                   29730004
297400                                   TO RC013-OPER-UNT-ID           29740004
297500                                        (RC013-IDX)               29750004
297600                     MOVE ASC-KEY-FCLTY-ID-N                      29760004
297700                                   TO RC013-FCLTY-ID              29770004
297800                                        (RC013-IDX)               29780004
297900                   END-IF                                         29790004
298000                 END-IF                                           29800004
298100                 END-IF                                           29810004
298200                 MOVE SPACE        TO RC013-ACTION-SW (RC013-IDX) 29820004
298300                 SET RC013-IDX UP BY 1                            29830004
298400                 IF  RC013-IDX > RC013-MAX-ITEMS                  29840004
298500                     PERFORM 5205-WRITE-SEL-QUEUE                 29850004
298600                     ADD +1        TO RC015-NUMBER-OF-TS-ITEMS    29860004
298700                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         29870004
298800                     SET RC013-IDX TO  1                          29880004
298900                 END-IF                                           29890004
299000             END-IF                                               29900004
299100         END-PERFORM                                              29910004
299200     END-IF.                                                      29920004
299300                                                                  29930004
299400*----------------------------------------------------------------*29940004
299500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *29950004
299600*----------------------------------------------------------------*29960004
299700                                                                  29970004
299800 5205-WRITE-SEL-QUEUE.                                            29980004
299900                                                                  29990004
300000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            30000004
300100                                   TO RC013-SELECTED-ITEMS.       30010004
300200                                                                  30020004
300300     EXEC CICS                                                    30030004
300400          WRITEQ TS                                               30040004
300500              QUEUE (ASC-SEL-QUEUE-NAME)                          30050004
300600              FROM  (RC013-DC-SELECT-RECORD)                      30060004
300700              ITEM  (PV-SEL-QUEUE-ITEM)                           30070004
300800              RESP  (PV-CICS-RESP)                                30080004
300900     END-EXEC.                                                    30090004
301000                                                                  30100004
301100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30110004
301200         CONTINUE                                                 30120004
301300     ELSE                                                         30130004
301400         SET DP013-CICS-ABEND      TO TRUE                        30140004
301500         SET DP013-NO-ROLLBACK     TO TRUE                        30150004
301600         MOVE '5205-WRITE-SEL-QUEUE'                              30160004
301700                                   TO DP013-PARAGRAPH             30170004
301800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          30180004
301900                                   TO DP013-MESSAGE-TEXT(1)       30190004
302000         PERFORM DP013-0000-PROCESS-ABEND                         30200004
302100     END-IF.                                                      30210004
302200                                                                  30220004
302300*----------------------------------------------------------------*30230004
302400*    COUNT THE NUMBER OF VERIFIED RECEIVERS                      *30240004
302500*----------------------------------------------------------------*30250004
302600 5250-COUNT-VERIFIED-RCVRS.                                       30260004
302700                                                                  30270004
302800     EXEC SQL                                                     30280004
302900          SELECT COUNT(*)                                         30290004
303000            INTO :PV-DB2-COUNT                                    30300004
303100            FROM TSHIPMT A,                                       30310004
303200                 TSHPTPO B,                                       30320004
303300                 TRECEIV C                                        30330004
303400           WHERE A.SHIPT_ID    = :DK-SHIPT-ID                     30340004
303500             AND A.SHIPT_ID    = B.SHIPT_ID                       30350004
303600             AND B.REC_SEQ_NBR = C.REC_SEQ_NBR                    30360004
303700             AND B.PO_NBR      = C.ORD_NBR                        30370004
303800             AND C.VERFYD_TMST ^= :PC-DEFAULT-TMST-9S             30380004
303900     END-EXEC.                                                    30390004
304000                                                                  30400004
304100     EVALUATE TRUE                                                30410004
304200         WHEN SQLCODE = +0                                        30420004
304300         WHEN SQLCODE = +100                                      30430004
304400              CONTINUE                                            30440004
304500                                                                  30450004
304600         WHEN SQLCODE = -904                                      30460004
304700         WHEN SQLCODE = -913                                      30470004
304800              MOVE SQLCODE                   TO PV-SOFT-SQLCODE   30480004
304900              MOVE '5250-COUNT-VERIFIED-RCVRS'                    30490004
305000                                             TO PV-SOFT-PARAGRAPH 30500004
305100              MOVE ASC-KEY-OPER-UNT-ID-N     TO PV-LOCATION       30510004
305200              MOVE DP020-USERID              TO PV-USER           30520004
305300              MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2 30530004
305400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    30540004
305500                                             TO PV-COMMAREA-LENGTH30550004
305600              EXEC CICS                                           30560004
305700                   WRITEQ TD                                      30570004
305800                    QUEUE  ('CSSL')                               30580004
305900                     FROM  (PV-CICS-MSG-AREA2)                    30590004
306000                   LENGTH  (PV-COMMAREA-LENGTH)                   30600004
306100                     RESP  (PV-CICS-RESP)                         30610004
306200              END-EXEC                                            30620004
306300                                                                  30630004
306400              INITIALIZE PV-CICS-MSG-AREA2                        30640004
306500              MOVE DK-SHIPT-ID     TO  PV-DISP-SHIPT-ID           30650004
306600              STRING ' RCKCS261 -'             DELIMITED BY SIZE  30660004
306700               ' 5250-COUNT-VERIFIED-RCVRS - ' DELIMITED BY SIZE  30670004
306800                     ' SHIPMENT ID - '         DELIMITED BY SIZE  30680004
306900                       PV-DISP-SHIPT-ID        DELIMITED BY SIZE  30690004
307000                                          INTO PV-CICS-MSG-AREA2  30700004
307100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    30710004
307200                                            TO PV-COMMAREA-LENGTH 30720004
307300              EXEC CICS                                           30730004
307400                 WRITEQ TD                                        30740004
307500                  QUEUE  ('CSSL')                                 30750004
307600                   FROM  (PV-CICS-MSG-AREA2)                      30760004
307601                 LENGTH  (PV-COMMAREA-LENGTH)                     30760104
307602                   RESP  (PV-CICS-RESP)                           30760204
307603              END-EXEC                                            30760304
307604                                                                  30760404
307605              INITIALIZE PV-CICS-MSG-AREA2                        30760504
307606              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         30760604
307607              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             30760704
307608              PERFORM 9900-SOFT-ABORT                             30760804
307609                                                                  30760904
307610         WHEN SQLWARN0 NOT = SPACES                               30761004
307620         WHEN SQLCODE < +0                                        30762004
307630         WHEN SQLCODE > +0                                        30763004
307640              MOVE '5250-COUNT-VERIFIED-RCVRS'                    30764004
307650                              TO DP013-PARAGRAPH                  30765004
307660              MOVE 'UNSUCCESSFUL COUNT OF TRECEIV TABLE'          30766004
307670                              TO DP013-MESSAGE-TEXT (1)           30767004
307680              MOVE SQLCA      TO DP013-SQLCA                      30768004
307690              MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)         30769004
307700              MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (2)         30770004
307701              MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (3)         30770104
307702              SET DP013-DB2-ABEND                                 30770204
307703                  DP013-XCTL-DISPLAY-RESTART                      30770304
307704                              TO TRUE                             30770404
307705              PERFORM DP013-0000-PROCESS-ABEND                    30770504
307706     END-EVALUATE.                                                30770604
307707                                                                  30770704
307708                                                                  30770804
307709 5270-SELECT-TSHIPMT.                                             30770904
307710                                                                  30771004
307720     INITIALIZE DCLTAUSHIP.                                       30772004
307730                                                                  30773004
307740     EXEC SQL                                                     30774004
307750          SELECT  PRO_SCAC_ID                                     30775004
307760                 ,PRO_NBR                                         30776004
307770                 ,BOL_NBR                                         30777004
307780            INTO  :SHIPMT-PRO-SCAC-ID                             30778004
307790                 ,:SHIPMT-PRO-NBR                                 30779004
307800                 ,:SHIPMT-BOL-NBR                                 30780004
307900            FROM  TSHIPMT                                         30790004
308000           WHERE  SHIPT_ID = :DK-SHIPT-ID                         30800004
308100     END-EXEC.                                                    30810004
308200                                                                  30820004
308300     EVALUATE TRUE                                                30830004
308400         WHEN SQLCODE = +0                                        30840004
308500              CONTINUE                                            30850004
308600                                                                  30860004
308700         WHEN SQLCODE = -904                                      30870004
308800         WHEN SQLCODE = -913                                      30880004
308900              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     30890004
309000              MOVE '5270-SELECT-TSHIPMT '  TO PV-SOFT-PARAGRAPH   30900004
309100              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         30910004
309200              MOVE DP020-USERID            TO PV-USER             30920004
309300              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   30930004
309400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    30940004
309500                                           TO PV-COMMAREA-LENGTH  30950004
309600              EXEC CICS                                           30960004
309700                   WRITEQ TD                                      30970004
309800                    QUEUE  ('CSSL')                               30980004
309900                     FROM  (PV-CICS-MSG-AREA2)                    30990004
310000                   LENGTH  (PV-COMMAREA-LENGTH)                   31000004
310100                     RESP  (PV-CICS-RESP)                         31010004
310200              END-EXEC                                            31020004
310300                                                                  31030004
310400              INITIALIZE PV-CICS-MSG-AREA2                        31040004
310500              MOVE DK-SHIPT-ID     TO  PV-DISP-SHIPT-ID           31050004
310600              STRING ' RCKCS261 -'             DELIMITED BY SIZE  31060004
310700                     ' 5270-SELECT-TSHIPMT - ' DELIMITED BY SIZE  31070004
310800                     ' SHIPMENT ID - '         DELIMITED BY SIZE  31080004
310900                       PV-DISP-SHIPT-ID        DELIMITED BY SIZE  31090004
311000                                          INTO PV-CICS-MSG-AREA2  31100004
311100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    31110004
311200                                            TO PV-COMMAREA-LENGTH 31120004
311300              EXEC CICS                                           31130004
311400                 WRITEQ TD                                        31140004
311500                  QUEUE  ('CSSL')                                 31150004
311600                   FROM  (PV-CICS-MSG-AREA2)                      31160004
311700                 LENGTH  (PV-COMMAREA-LENGTH)                     31170004
311800                   RESP  (PV-CICS-RESP)                           31180004
311900              END-EXEC                                            31190004
312000                                                                  31200004
312100              INITIALIZE PV-CICS-MSG-AREA2                        31210004
312200              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         31220004
312300              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             31230004
312400              PERFORM 9900-SOFT-ABORT                             31240004
312500                                                                  31250004
312600                                                                  31260004
312700         WHEN SQLWARN0 NOT = SPACES                               31270004
312800         WHEN SQLCODE < +0                                        31280004
312900         WHEN SQLCODE > +0                                        31290004
313000              MOVE '5270-SELECT-TSHIPMT'                          31300004
313100                                TO DP013-PARAGRAPH                31310004
313200              MOVE 'SELECT A TSHIPMT ROW   '                      31320004
313300                                TO DP013-MESSAGE-TEXT(1)          31330004
313400              MOVE SQLCA        TO DP013-SQLCA                    31340004
313500              MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)       31350004
313600              SET DP013-DB2-ABEND                                 31360004
313700                  DP013-XCTL-DISPLAY-RESTART TO TRUE              31370004
313800              PERFORM DP013-0000-PROCESS-ABEND                    31380004
313810     END-EVALUATE.                                                31381004
313811                                                                  31381104
313812                                                                  31381204
313813 5280-SELECT-TSHIPMT.                                             31381304
313814                                                                  31381404
313815     INITIALIZE DCLTAUSHIP.                                       31381504
313816                                                                  31381604
313817     EXEC SQL                                                     31381704
313818          SELECT  PRO_SCAC_ID                                     31381804
313819            INTO  :SHIPMT-PRO-SCAC-ID                             31381904
313820            FROM  TSHIPMT                                         31382004
313830           WHERE  PRO_SCAC_ID = :ASC-KEY-ORIGIN-SCAC-ID           31383004
313840             AND  PRO_NBR     = :SHIPMT-PRO-NBR                   31384004
313850             AND  BOL_NBR     = :SHIPMT-BOL-NBR                   31385004
313860     END-EXEC.                                                    31386004
313870                                                                  31387004
313880     EVALUATE TRUE                                                31388004
313890         WHEN SQLCODE = +0                                        31389004
313900         WHEN SQLCODE = +100                                      31390004
314000             CONTINUE                                             31400004
314100                                                                  31410004
314200         WHEN SQLCODE = -904                                      31420004
314300         WHEN SQLCODE = -913                                      31430004
314400              MOVE SQLCODE                TO PV-SOFT-SQLCODE      31440004
314500              MOVE '5280-SELECT-TSHIPMT ' TO PV-SOFT-PARAGRAPH    31450004
314600              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          31460004
314700              MOVE DP020-USERID           TO PV-USER              31470004
314800              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    31480004
314900              MOVE LENGTH OF PV-CICS-MSG-AREA2                    31490004
315000                                          TO PV-COMMAREA-LENGTH   31500004
315100              EXEC CICS                                           31510004
315200                   WRITEQ TD                                      31520004
315300                    QUEUE  ('CSSL')                               31530004
315400                     FROM  (PV-CICS-MSG-AREA2)                    31540004
315500                   LENGTH  (PV-COMMAREA-LENGTH)                   31550004
315600                     RESP  (PV-CICS-RESP)                         31560004
315700              END-EXEC                                            31570004
315800                                                                  31580004
315900              INITIALIZE PV-CICS-MSG-AREA2                        31590004
316000              STRING ' RCKCS261 -'                                31600004
316100                     '  PRO:'             SHIPMT-PRO-NBR          31610004
316200                     '  BOL:'             SHIPMT-BOL-NBR          31620004
316300                     '  SCAC:'            ASC-KEY-ORIGIN-SCAC-ID  31630004
316400                                          DELIMITED BY SIZE       31640004
316500                                     INTO PV-CICS-MSG-AREA2       31650004
316600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    31660004
316700                                       TO PV-COMMAREA-LENGTH      31670004
316800              EXEC CICS                                           31680004
316900                 WRITEQ TD                                        31690004
317000                  QUEUE  ('CSSL')                                 31700004
317100                   FROM  (PV-CICS-MSG-AREA2)                      31710004
317200                 LENGTH  (PV-COMMAREA-LENGTH)                     31720004
317300                   RESP  (PV-CICS-RESP)                           31730004
317400              END-EXEC                                            31740004
317500                                                                  31750004
317600              INITIALIZE PV-CICS-MSG-AREA2                        31760004
317700              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         31770004
317800              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             31780004
317900              PERFORM 9900-SOFT-ABORT                             31790004
318000                                                                  31800004
318100         WHEN SQLWARN0 NOT = SPACES                               31810004
318200         WHEN SQLCODE < +0                                        31820004
318300         WHEN SQLCODE > +0                                        31830004
318400              MOVE '5280-SELECT-TSHIPMT'                          31840004
318500                                TO DP013-PARAGRAPH                31850004
318600              MOVE 'SELECT A TSHIPMT ROW   '                      31860004
318700                                TO DP013-MESSAGE-TEXT(1)          31870004
318800              MOVE SQLCA        TO DP013-SQLCA                    31880004
318900              MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)       31890004
319000              SET DP013-DB2-ABEND                                 31900004
319100                  DP013-XCTL-DISPLAY-RESTART TO TRUE              31910004
319200              PERFORM DP013-0000-PROCESS-ABEND                    31920004
319300     END-EVALUATE.                                                31930004
319400                                                                  31940004
319500                                                                  31950004
319600******************************************************************31960004
319700** THIS PARAGRAPH WILL ASSIGN THE SELECTED OPEN SHIPMENTS TO    **31970004
319800** A SPECIFIC TRIP.                                             **31980004
319900******************************************************************31990004
320000 5300-ASSIGN-SHIPMENT-TO-TRIP.                                    32000004
320100                                                                  32010004
320200     EXEC SQL                                                     32020004
320300          UPDATE TSHIPMT                                          32030004
320400             SET LAST_UPD_DTE     = CURRENT DATE,                 32040004
320500                 LAST_UPD_TME     = CURRENT TIME,                 32050004
320600                 LAST_UPD_UID     = :DP020-USERID,                32060004
320700                 EXPTED_PKG_QTY   = :SHIPMT-EXPTED-PKG-QTY,       32070004
320800                 LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME,     32080004
320900                 TRIP_ID          = :ASC-KEY-TRIP-ID  :DN-TRIP-ID,32090004
321000                 PRO_SCAC_ID      = :ASC-KEY-ORIGIN-SCAC-ID       32100004
321100          WHERE  SHIPT_ID         = :DK-SHIPT-ID                  32110004
321200     END-EXEC.                                                    32120004
321300                                                                  32130004
321400     EVALUATE TRUE                                                32140004
321500         WHEN SQLCODE = +0                                        32150004
321600              CONTINUE                                            32160004
321700                                                                  32170004
321800         WHEN SQLCODE = -904                                      32180004
321900         WHEN SQLCODE = -913                                      32190004
322000              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     32200004
322100              MOVE '5300-ASSIGN-SHIPMENT-TO-TRIP'                 32210004
322200                                           TO PV-SOFT-PARAGRAPH   32220004
322300              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         32230004
322400              MOVE DP020-USERID            TO PV-USER             32240004
322500              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   32250004
322600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    32260004
322700                                           TO PV-COMMAREA-LENGTH  32270004
322800              EXEC CICS                                           32280004
322900                   WRITEQ TD                                      32290004
323000                   QUEUE  ('CSSL')                                32300004
323100                     FROM  (PV-CICS-MSG-AREA2)                    32310004
323200                   LENGTH  (PV-COMMAREA-LENGTH)                   32320004
323300                     RESP  (PV-CICS-RESP)                         32330004
323400              END-EXEC                                            32340004
323500                                                                  32350004
323600              INITIALIZE PV-CICS-MSG-AREA2                        32360004
323700              MOVE ASC-KEY-TRIP-ID       TO PV-DISP-TRIP-ID       32370004
323800              MOVE SHIPMT-EXPTED-PKG-QTY TO PV-DISP-SHIPT-EXP-QTY 32380004
323900              STRING ' RCKCS261 -'                                32390004
324000                     '   USER ID:'       DP020-USERID             32400004
324100                     '   EXP PKG QTY:'   PV-DISP-SHIPT-EXP-QTY    32410004
324200                     '   TRIP ID:'       PV-DISP-TRIP-ID          32420004
324300                     '   SCAC:'          ASC-KEY-ORIGIN-SCAC-ID   32430004
324400                                               DELIMITED BY SIZE  32440004
324500                                          INTO PV-CICS-MSG-AREA2  32450004
324600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    32460004
324700                                            TO PV-COMMAREA-LENGTH 32470004
324800              EXEC CICS                                           32480004
324900                 WRITEQ TD                                        32490004
325000                  QUEUE  ('CSSL')                                 32500004
325100                   FROM  (PV-CICS-MSG-AREA2)                      32510004
325200                 LENGTH  (PV-COMMAREA-LENGTH)                     32520004
325300                   RESP  (PV-CICS-RESP)                           32530004
325400              END-EXEC                                            32540004
325500                                                                  32550004
325600               INITIALIZE PV-CICS-MSG-AREA2                       32560004
325700               MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER        32570004
325800               SET  DP030-SET-CURSOR-APPL-1    TO TRUE            32580004
325900               PERFORM 9900-SOFT-ABORT                            32590004
326000                                                                  32600004
326100          WHEN SQLWARN0 NOT = SPACES                              32610004
326200          WHEN SQLCODE < +0                                       32620004
326300          WHEN SQLCODE > +0                                       32630004
326400               MOVE '5300-ASSIGN-SHIPMENT-TO-TRIP'                32640004
326500                                 TO DP013-PARAGRAPH               32650004
326600               MOVE 'UPDATE INFO ON TSHIPMT     '                 32660004
326700                                 TO DP013-MESSAGE-TEXT(1)         32670004
326701               MOVE SQLCA        TO DP013-SQLCA                   32670104
326702               MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)      32670204
326703               SET DP013-DB2-ABEND                                32670304
326704                   DP013-XCTL-DISPLAY-RESTART TO TRUE             32670404
326705               PERFORM DP013-0000-PROCESS-ABEND                   32670504
326706     END-EVALUATE.                                                32670604
326707                                                                  32670704
326708     MOVE VEHICL-CURR-STATUS-CDE TO SHIPST-SHIPT-STATUS-CDE.      32670804
326709     PERFORM 5350-INSERT-TSHIPST.                                 32670904
326710     PERFORM 5370-AUDIT-TSHIPMT.                                  32671004
326711     PERFORM 5400-COUNT-REMAINING-SHIPMENTS.                      32671104
326712     PERFORM 5450-UPDATE-SHPTPO-RECS.                             32671204
326713                                                                  32671304
326714/                                                                 32671404
326715*----------------------------------------------------------------*32671504
326716*  INSERT A SHIPMENT STATUS ROW                                  *32671604
326717*----------------------------------------------------------------*32671704
326718 5350-INSERT-TSHIPST.                                             32671804
326719     MOVE DK-SHIPT-ID TO SHIPST-SHIPT-ID.                         32671904
326720                                                                  32672004
326730     EXEC SQL                                                     32673004
326740          INSERT                                                  32674004
326750            INTO TSHIPST                                          32675004
326760                 (SHIPT_ID                                        32676004
326770                 ,SHIPT_STATUS_CDE                                32677004
326780                 ,STATUS_DTE                                      32678004
326790                 ,STATUS_TME                                      32679004
326800                 ,STATUS_UID                                      32680004
326900                 ,CARR_STATUS_CDE                                 32690004
327000                 ,TIME_ZONE_CDE                                   32700004
327100                 ,CITY_NAME                                       32710004
327200                 ,STATE_CDE )                                     32720004
327300          VALUES                                                  32730004
327400                 (:SHIPST-SHIPT-ID                                32740004
327500                 ,:SHIPST-SHIPT-STATUS-CDE                        32750004
327600                 ,CURRENT DATE                                    32760004
327700                 ,CURRENT TIME                                    32770004
327800                 ,:DP020-USERID                                   32780004
327900                 ,:SHIPST-CARR-STATUS-CDE                         32790004
328000                 ,:SHIPST-TIME-ZONE-CDE                           32800004
328100                 ,:SHIPST-CITY-NAME                               32810004
328200                 ,:SHIPST-STATE-CDE )                             32820004
328300     END-EXEC.                                                    32830004
328400                                                                  32840004
328500     EVALUATE TRUE                                                32850004
328600         WHEN SQLCODE = +0                                        32860004
328700         WHEN SQLCODE = -803                                      32870004
328800              CONTINUE                                            32880004
328900                                                                  32890004
329000         WHEN SQLCODE = -904                                      32900004
329100         WHEN SQLCODE = -913                                      32910004
329200              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     32920004
329300              MOVE '5350-INSERT-TSHIPST '  TO PV-SOFT-PARAGRAPH   32930004
329400              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         32940004
329500              MOVE DP020-USERID            TO PV-USER             32950004
329600              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   32960004
329700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    32970004
329800                                           TO PV-COMMAREA-LENGTH  32980004
329900              EXEC CICS                                           32990004
330000                   WRITEQ TD                                      33000004
330100                    QUEUE  ('CSSL')                               33010004
330200                     FROM  (PV-CICS-MSG-AREA2)                    33020004
330300                   LENGTH  (PV-COMMAREA-LENGTH)                   33030004
330400                     RESP  (PV-CICS-RESP)                         33040004
330500              END-EXEC                                            33050004
330600                                                                  33060004
330700              INITIALIZE PV-CICS-MSG-AREA2                        33070004
330800              MOVE SHIPST-SHIPT-ID TO  PV-DISP-SHIPT-ID           33080004
330900              STRING ' RCKCS261 -'                                33090004
331000                     '  SHPMT ID:'        PV-DISP-SHIPT-ID        33100004
331100                     '  STAT CDE:'        SHIPST-SHIPT-STATUS-CDE 33110004
331200                     '  TIME ZONE:'       SHIPST-TIME-ZONE-CDE    33120004
331300                                               DELIMITED BY SIZE  33130004
331400                                          INTO PV-CICS-MSG-AREA2  33140004
331500              MOVE LENGTH OF PV-CICS-MSG-AREA2                    33150004
331600                                            TO PV-COMMAREA-LENGTH 33160004
331700              EXEC CICS                                           33170004
331800                   WRITEQ TD                                      33180004
331900                    QUEUE  ('CSSL')                               33190004
332000                     FROM  (PV-CICS-MSG-AREA2)                    33200004
332100                   LENGTH  (PV-COMMAREA-LENGTH)                   33210004
332200                     RESP  (PV-CICS-RESP)                         33220004
332300              END-EXEC                                            33230004
332400                                                                  33240004
332500              INITIALIZE PV-CICS-MSG-AREA2                        33250004
332600              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         33260004
332700              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             33270004
332800              PERFORM 9900-SOFT-ABORT                             33280004
332900                                                                  33290004
333000         WHEN SQLWARN0 NOT = SPACES                               33300004
333100         WHEN SQLCODE < +0                                        33310004
333200         WHEN SQLCODE > +0                                        33320004
333300              MOVE '5350-INSERT-TSHIPST'                          33330004
333400                                TO DP013-PARAGRAPH                33340004
333500              MOVE 'INSERT A ROW ON TSHIPST'                      33350004
333600                                TO DP013-MESSAGE-TEXT(1)          33360004
333700              MOVE SQLCA        TO DP013-SQLCA                    33370004
333800              MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)       33380004
333900              SET DP013-DB2-ABEND                                 33390004
334000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              33400004
334100              PERFORM DP013-0000-PROCESS-ABEND                    33410004
334200     END-EVALUATE.                                                33420004
334300                                                                  33430004
334400                                                                  33440004
334500*----------------------------------------------------------------*33450004
334600*  TAKE A SNAPSHOT OF THE AFTER IMAGE OF TSHIPMT AND WRITE       *33460004
334700*  TO THE AUDIT TABLE.                                           *33470004
334710*----------------------------------------------------------------*33471004
334711 5370-AUDIT-TSHIPMT.                                              33471104
334712                                                                  33471204
334713     INITIALIZE DCLTAUSHIP.                                       33471304
334714                                                                  33471404
334715* CLT 12-01-2011 WR40574 ADDED CARR-AUTH-ID BELOW                 33471504
334716     EXEC SQL                                                     33471604
334717          SELECT  TRIP_ID                                         33471704
334718                 ,SHIPT_ID                                        33471804
334719                 ,CRT_SRC_CDE                                     33471904
334720                 ,LAST_UPD_DTE                                    33472004
334730                 ,LAST_UPD_TME                                    33473004
334740                 ,LAST_UPD_UID                                    33474004
334750                 ,PRO_SCAC_ID                                     33475004
334760                 ,PRO_NBR                                         33476004
334770                 ,BOL_NBR                                         33477004
334780                 ,SHIPPER_NME                                     33478004
334790                 ,SHIPT_TYP_CDE                                   33479004
334800                 ,EXPTED_GRO_WGHT                                 33480004
334900                 ,PKG_TYP_CDE                                     33490004
335000                 ,EXPTED_PKG_QTY                                  33500004
335100                 ,FRGT_CHG_AMT                                    33510004
335200                 ,FRGT_TERMS_CDE                                  33520004
335300                 ,EXPTED_PLT_QTY                                  33530004
335400                 ,VEND_SHIP_DTE                                   33540004
335500                 ,EST_AR_TMST                                     33550004
335600                 ,ORIG_SCAC_ID                                    33560004
335700                 ,LAST_UPD_PGM_ID                                 33570004
335800                 ,CRE_USER_ID                                     33580004
335900                 ,CARR_CART_CT                                    33590004
336000                 ,CARR_LAST_UPD_DTE                               33600004
336100                 ,CARR_LAST_UPD_TIME                              33610004
336200                 ,VEND_CART_CT                                    33620004
336300                 ,VEND_LAST_UPD_DTE                               33630004
336400                 ,VEND_LAST_UPD_TIME                              33640004
336500                 ,VEH_NBR                                         33650004
336600                 ,AUTH_NBR                                        33660004
336700                 ,AUTH_DTE                                        33670004
336800                 ,CONFIRM_DTE                                     33680004
336900                 ,CONFIRM_TIME                                    33690004
337000                 ,COMPLETE_PRO_NBR                                33700004
337100                 ,COMPLETE_BOL_NBR                                33710004
337200                 ,PROCESSED_DTE                                   33720004
337300                 ,INVC_NBR                                        33730004
337400                 ,CARR_AUTH_ID                                    33740004
337500            INTO  :SHIPMT-TRIP-ID  :DN-TRIP-ID                    33750004
337600                 ,:SHIPMT-SHIPT-ID                                33760004
337700                 ,:SHIPMT-CRT-SRC-CDE                             33770004
337800                 ,:SHIPMT-LAST-UPD-DTE                            33780004
337900                 ,:SHIPMT-LAST-UPD-TME                            33790004
338000                 ,:SHIPMT-LAST-UPD-UID                            33800004
338100                 ,:SHIPMT-PRO-SCAC-ID                             33810004
338200                 ,:SHIPMT-PRO-NBR                                 33820004
338300                 ,:SHIPMT-BOL-NBR                                 33830004
338400                 ,:SHIPMT-SHIPPER-NME                             33840004
338500                 ,:SHIPMT-SHIPT-TYP-CDE                           33850004
338600                 ,:SHIPMT-EXPTED-GRO-WGHT                         33860004
338700                 ,:SHIPMT-PKG-TYP-CDE                             33870004
338800                 ,:SHIPMT-EXPTED-PKG-QTY                          33880004
338900                 ,:SHIPMT-FRGT-CHG-AMT                            33890004
339000                 ,:SHIPMT-FRGT-TERMS-CDE                          33900004
339100                 ,:SHIPMT-EXPTED-PLT-QTY                          33910004
339200                 ,:SHIPMT-VEND-SHIP-DTE                           33920004
339300                 ,:SHIPMT-EST-AR-TMST  :DN-EST-AR-TMST            33930004
339400                 ,:SHIPMT-ORIG-SCAC-ID                            33940004
339500                 ,:SHIPMT-LAST-UPD-PGM-ID                         33950004
339600                 ,:SHIPMT-CRE-USER-ID                             33960004
339700                 ,:SHIPMT-CARR-CART-CT                            33970004
339800                 ,:SHIPMT-CARR-LAST-UPD-DTE                       33980004
339900                 ,:SHIPMT-CARR-LAST-UPD-TIME                      33990004
340000                 ,:SHIPMT-VEND-CART-CT                            34000004
340100                 ,:SHIPMT-VEND-LAST-UPD-DTE                       34010004
340200                 ,:SHIPMT-VEND-LAST-UPD-TIME                      34020004
340300                 ,:SHIPMT-VEH-NBR                                 34030004
340400                 ,:SHIPMT-AUTH-NBR                                34040004
340500                 ,:SHIPMT-AUTH-DTE                                34050004
340600                 ,:SHIPMT-CONFIRM-DTE                             34060004
340700                 ,:SHIPMT-CONFIRM-TIME                            34070004
340800                 ,:SHIPMT-COMPLETE-PRO-NBR                        34080004
340900                 ,:SHIPMT-COMPLETE-BOL-NBR                        34090004
341000                 ,:SHIPMT-PROCESSED-DTE                           34100004
341100                 ,:SHIPMT-INVC-NBR                                34110004
341200                 ,:SHIPMT-CARR-AUTH-ID                            34120004
341300            FROM  TSHIPMT                                         34130004
341400           WHERE  SHIPT_ID = :DK-SHIPT-ID                         34140004
341500     END-EXEC.                                                    34150004
341600                                                                  34160004
341700     EVALUATE TRUE                                                34170004
341800         WHEN SQLCODE = +0                                        34180004
341900              CONTINUE                                            34190004
342000                                                                  34200004
342100         WHEN SQLCODE = -904                                      34210004
342200         WHEN SQLCODE = -913                                      34220004
342300              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     34230004
342400              MOVE '5370-AUDIT-TSHIPMT  '  TO PV-SOFT-PARAGRAPH   34240004
342500              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         34250004
342600              MOVE DP020-USERID            TO PV-USER             34260004
342700              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   34270004
342800              MOVE LENGTH OF PV-CICS-MSG-AREA2                    34280004
342900                                           TO PV-COMMAREA-LENGTH  34290004
343000              EXEC CICS                                           34300004
343100                   WRITEQ TD                                      34310004
343200                    QUEUE  ('CSSL')                               34320004
343300                     FROM  (PV-CICS-MSG-AREA2)                    34330004
343400                   LENGTH  (PV-COMMAREA-LENGTH)                   34340004
343500                     RESP  (PV-CICS-RESP)                         34350004
343600              END-EXEC                                            34360004
343700                                                                  34370004
343800              INITIALIZE PV-CICS-MSG-AREA2                        34380004
343900              MOVE DK-SHIPT-ID     TO  PV-DISP-SHIPT-ID           34390004
344000              STRING ' RCKCS261 -'                                34400004
344100                     ' SHPMT ID:'     PV-DISP-SHIPT-ID            34410004
344200                                      DELIMITED BY SIZE           34420004
344300                                 INTO PV-CICS-MSG-AREA2           34430004
344400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    34440004
344500                                   TO PV-COMMAREA-LENGTH          34450004
344600              EXEC CICS                                           34460004
344700                 WRITEQ TD                                        34470004
344800                  QUEUE  ('CSSL')                                 34480004
344900                   FROM  (PV-CICS-MSG-AREA2)                      34490004
345000                 LENGTH  (PV-COMMAREA-LENGTH)                     34500004
345100                   RESP  (PV-CICS-RESP)                           34510004
345200              END-EXEC                                            34520004
345300                                                                  34530004
345400              INITIALIZE PV-CICS-MSG-AREA2                        34540004
345500              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         34550004
345600              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             34560004
345700              PERFORM 9900-SOFT-ABORT                             34570004
345800                                                                  34580004
345900         WHEN SQLWARN0 NOT = SPACES                               34590004
346000         WHEN SQLCODE < +0                                        34600004
346100         WHEN SQLCODE > +0                                        34610004
346200              MOVE '5370-AUDIT-TSHIPMT'                           34620004
346300                                TO DP013-PARAGRAPH                34630004
346400              MOVE 'SELECT A TSHIPMT ROW   '                      34640004
346500                                TO DP013-MESSAGE-TEXT(1)          34650004
346600              MOVE SQLCA        TO DP013-SQLCA                    34660004
346700              MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)       34670004
346800              SET DP013-DB2-ABEND                                 34680004
346900                  DP013-XCTL-DISPLAY-RESTART TO TRUE              34690004
347000              PERFORM DP013-0000-PROCESS-ABEND                    34700004
347100     END-EVALUATE.                                                34710004
347200                                                                  34720004
347300* CLT 12-01-2011 WR40574 ADDED CARR-AUTH-ID BELOW                 34730004
347400     EXEC SQL                                                     34740004
347500          INSERT                                                  34750004
347600            INTO TAUSHIP                                          34760004
347700                 (TRIP_ID                                         34770004
347800                 ,SHIPT_ID                                        34780004
347900                 ,CRT_SRC_CDE                                     34790004
348000                 ,LAST_UPD_DTE                                    34800004
348100                 ,LAST_UPD_TME                                    34810004
348200                 ,LAST_UPD_UID                                    34820004
348300                 ,PRO_SCAC_ID                                     34830004
348400                 ,PRO_NBR                                         34840004
348500                 ,BOL_NBR                                         34850004
348600                 ,SHIPPER_NME                                     34860004
348700                 ,SHIPT_TYP_CDE                                   34870004
348800                 ,EXPTED_GRO_WGHT                                 34880004
348900                 ,PKG_TYP_CDE                                     34890004
349000                 ,EXPTED_PKG_QTY                                  34900004
349100                 ,FRGT_CHG_AMT                                    34910004
349200                 ,FRGT_TERMS_CDE                                  34920004
349300                 ,EST_AR_TMST                                     34930004
349400                 ,VEND_SHIP_DTE                                   34940004
349500                 ,EXPTED_PLT_QTY                                  34950004
349600                 ,ORIG_SCAC_ID                                    34960004
349700                 ,LAST_UPD_PGM_ID                                 34970004
349800                 ,CRE_USER_ID                                     34980004
349900                 ,CARR_CART_CT                                    34990004
350000                 ,CARR_LAST_UPD_DTE                               35000004
350100                 ,CARR_LAST_UPD_TIME                              35010004
350200                 ,VEND_CART_CT                                    35020004
350300                 ,VEND_LAST_UPD_DTE                               35030004
350400                 ,VEND_LAST_UPD_TIME                              35040004
350500                 ,VEH_NBR                                         35050004
350600                 ,AUTH_NBR                                        35060004
350700                 ,AUTH_DTE                                        35070004
350800                 ,CONFIRM_DTE                                     35080004
350900                 ,CONFIRM_TIME                                    35090004
351000                 ,PROCESSED_DTE                                   35100004
351100                 ,INVC_NBR                                        35110004
351200                 ,AUD_STATUS_CDE                                  35120004
351300                 ,CARR_AUTH_ID)                                   35130004
351400          VALUES                                                  35140004
351500                 (:SHIPMT-TRIP-ID  :DN-TRIP-ID                    35150004
351600                 ,:SHIPMT-SHIPT-ID                                35160004
351700                 ,:SHIPMT-CRT-SRC-CDE                             35170004
351800                 ,:SHIPMT-LAST-UPD-DTE                            35180004
351900                 ,:SHIPMT-LAST-UPD-TME                            35190004
352000                 ,:SHIPMT-LAST-UPD-UID                            35200004
352100                 ,:SHIPMT-PRO-SCAC-ID                             35210004
352200                 ,:SHIPMT-COMPLETE-PRO-NBR                        35220004
352300                 ,:SHIPMT-COMPLETE-BOL-NBR                        35230004
352400                 ,:SHIPMT-SHIPPER-NME                             35240004
352500                 ,:SHIPMT-SHIPT-TYP-CDE                           35250004
352600                 ,:SHIPMT-EXPTED-GRO-WGHT                         35260004
352700                 ,:SHIPMT-PKG-TYP-CDE                             35270004
352800                 ,:SHIPMT-EXPTED-PKG-QTY                          35280004
352900                 ,:SHIPMT-FRGT-CHG-AMT                            35290004
353000                 ,:SHIPMT-FRGT-TERMS-CDE                          35300004
353100                 ,:SHIPMT-EST-AR-TMST  :DN-EST-AR-TMST            35310004
353200                 ,:SHIPMT-VEND-SHIP-DTE                           35320004
353300                 ,:SHIPMT-EXPTED-PLT-QTY                          35330004
353400                 ,:SHIPMT-ORIG-SCAC-ID                            35340004
353500                 ,:SHIPMT-LAST-UPD-PGM-ID                         35350004
353600                 ,:SHIPMT-CRE-USER-ID                             35360004
353700                 ,:SHIPMT-CARR-CART-CT                            35370004
353800                 ,:SHIPMT-CARR-LAST-UPD-DTE                       35380004
353900                 ,:SHIPMT-CARR-LAST-UPD-TIME                      35390004
354000                 ,:SHIPMT-VEND-CART-CT                            35400004
354100                 ,:SHIPMT-VEND-LAST-UPD-DTE                       35410004
354200                 ,:SHIPMT-VEND-LAST-UPD-TIME                      35420004
354300                 ,:SHIPMT-VEH-NBR                                 35430004
354400                 ,:SHIPMT-AUTH-NBR                                35440004
354500                 ,:SHIPMT-AUTH-DTE                                35450004
354600                 ,:SHIPMT-CONFIRM-DTE                             35460004
354700                 ,:SHIPMT-CONFIRM-TIME                            35470004
354800                 ,:SHIPMT-PROCESSED-DTE                           35480004
354900                 ,:SHIPMT-INVC-NBR                                35490004
355000                 ,:SHIPST-SHIPT-STATUS-CDE                        35500004
355100                 ,:SHIPMT-CARR-AUTH-ID)                           35510004
355200     END-EXEC.                                                    35520004
355300                                                                  35530004
355400     EVALUATE TRUE                                                35540004
355500         WHEN SQLCODE = +0                                        35550004
355600              CONTINUE                                            35560004
355700                                                                  35570004
355800         WHEN SQLCODE = -904                                      35580004
355900         WHEN SQLCODE = -913                                      35590004
356000              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     35600004
356100              MOVE '5370-AUDIT-TSHIPMT  '  TO PV-SOFT-PARAGRAPH   35610004
356200              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         35620004
356300              MOVE DP020-USERID            TO PV-USER             35630004
356400              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   35640004
356500              MOVE LENGTH OF PV-CICS-MSG-AREA2                    35650004
356600                                           TO PV-COMMAREA-LENGTH  35660004
356700              EXEC CICS                                           35670004
356800                   WRITEQ TD                                      35680004
356900                    QUEUE  ('CSSL')                               35690004
357000                     FROM  (PV-CICS-MSG-AREA2)                    35700004
357100                   LENGTH  (PV-COMMAREA-LENGTH)                   35710004
357200                     RESP  (PV-CICS-RESP)                         35720004
357300              END-EXEC                                            35730004
357400                                                                  35740004
357500              INITIALIZE PV-CICS-MSG-AREA2                        35750004
357600              MOVE SHIPMT-TRIP-ID  TO  PV-DISP-TRIP-ID            35760004
357700              MOVE SHIPMT-SHIPT-ID TO  PV-DISP-SHIPT-ID           35770004
357800              STRING ' RCKCS261 -'             DELIMITED BY SIZE  35780004
357900                     ' 5370-AUDIT-TSHIPMT - '  DELIMITED BY SIZE  35790004
358000                     ' TRIP ID - '             DELIMITED BY SIZE  35800004
358100                       PV-DISP-TRIP-ID         DELIMITED BY SIZE  35810004
358200                     ' SHIPMENT ID - '         DELIMITED BY SIZE  35820004
358300                       PV-DISP-SHIPT-ID        DELIMITED BY SIZE  35830004
358400                     ' SOUCRE - '              DELIMITED BY SIZE  35840004
358500                       SHIPMT-CRT-SRC-CDE      DELIMITED BY SIZE  35850004
358600                     ' UPDATE DATE - '         DELIMITED BY SIZE  35860004
358700                       SHIPMT-LAST-UPD-DTE     DELIMITED BY SIZE  35870004
358800                     ' UPDATE TIME - '         DELIMITED BY SIZE  35880004
358900                       SHIPMT-LAST-UPD-TME     DELIMITED BY SIZE  35890004
359000                     ' UPDATE USER - '         DELIMITED BY SIZE  35900004
359100                       SHIPMT-LAST-UPD-UID     DELIMITED BY SIZE  35910004
359200                                           INTO PV-CICS-MSG-AREA2 35920004
359300              MOVE LENGTH OF PV-CICS-MSG-AREA2                    35930004
359400                   TO PV-COMMAREA-LENGTH                          35940004
359500              EXEC CICS                                           35950004
359600                 WRITEQ TD                                        35960004
359700                  QUEUE  ('CSSL')                                 35970004
359800                   FROM  (PV-CICS-MSG-AREA2)                      35980004
359900                 LENGTH  (PV-COMMAREA-LENGTH)                     35990004
360000                   RESP  (PV-CICS-RESP)                           36000004
360100              END-EXEC                                            36010004
360200                                                                  36020004
360300              INITIALIZE PV-CICS-MSG-AREA2                        36030004
360400              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         36040004
360500              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             36050004
360600              PERFORM 9900-SOFT-ABORT                             36060004
360700                                                                  36070004
360800         WHEN SQLWARN0 NOT = SPACES                               36080004
360801         WHEN SQLCODE < +0                                        36080104
360802         WHEN SQLCODE > +0                                        36080204
360803              MOVE '5370-AUDIT-TSHIPMT '                          36080304
360804                                TO DP013-PARAGRAPH                36080404
360805              MOVE 'INSERT A ROW ON TAUSHIP'                      36080504
360806                                TO DP013-MESSAGE-TEXT(1)          36080604
360807              MOVE SQLCA        TO DP013-SQLCA                    36080704
360808              MOVE 'TAUSHIP'    TO DP013-DB2-TABLE-NAME (1)       36080804
360809              SET DP013-DB2-ABEND                                 36080904
360810                  DP013-XCTL-DISPLAY-RESTART TO TRUE              36081004
360811              PERFORM DP013-0000-PROCESS-ABEND                    36081104
360812      END-EVALUATE.                                               36081204
360813                                                                  36081304
360814                                                                  36081404
360815******************************************************************36081504
360816** COUNT THE NUMBER OF REMAINING SHIPMENTS ASSIGNED TO THIS     **36081604
360817** SPECIFIC TRIP ID.  IF THERE ARE NO MORE SHIPMENTS ASSIGNED,  **36081704
360818** STATUS THE TRIP "DELETED".                                   **36081804
360819******************************************************************36081904
360820 5400-COUNT-REMAINING-SHIPMENTS.                                  36082004
360830                                                                  36083004
360840     EXEC SQL                                                     36084004
360850          SELECT                                                  36085004
360860                 COUNT(*)                                         36086004
360870            INTO                                                  36087004
360880                 :PV-SHIPMENT-COUNT                               36088004
360890            FROM                                                  36089004
360900                  TSHIPST A,                                      36090004
361000                  TSHIPMT B,                                      36100004
361100                  TVHTRIP C                                       36110004
361200            WHERE                                                 36120004
361300                  B.TRIP_ID = :PV-SAVE-TRIP-ID                    36130004
361400              AND C.VEH_NBR IS NULL                               36140004
361500              AND A.SHIPT_ID = B.SHIPT_ID                         36150004
361600              AND B.TRIP_ID = C.TRIP_ID                           36160004
361700     END-EXEC.                                                    36170004
361800                                                                  36180004
361900     EVALUATE TRUE                                                36190004
362000         WHEN SQLCODE = +0                                        36200004
362100              CONTINUE                                            36210004
362200                                                                  36220004
362300         WHEN SQLCODE = -904                                      36230004
362400         WHEN SQLCODE = -913                                      36240004
362500              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     36250004
362600              MOVE '5400-COUNT-REMAINING-SHIPMENTS'               36260004
362700                                           TO PV-SOFT-PARAGRAPH   36270004
362800              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         36280004
362900              MOVE DP020-USERID            TO PV-USER             36290004
363000              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   36300004
363100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    36310004
363200                                           TO PV-COMMAREA-LENGTH  36320004
363300              EXEC CICS                                           36330004
363400                   WRITEQ TD                                      36340004
363500                    QUEUE  ('CSSL')                               36350004
363600                     FROM  (PV-CICS-MSG-AREA2)                    36360004
363700                   LENGTH  (PV-COMMAREA-LENGTH)                   36370004
363800                     RESP  (PV-CICS-RESP)                         36380004
363900              END-EXEC                                            36390004
364000                                                                  36400004
364100              INITIALIZE PV-CICS-MSG-AREA2                        36410004
364200              MOVE PV-SAVE-TRIP-ID TO  PV-DISP-TRIP-ID            36420004
364300              STRING ' RCKCS261 -'                                36430004
364400                     ' TRIP ID:'                                  36440004
364500                       PV-DISP-TRIP-ID         DELIMITED BY SIZE  36450004
364600                                          INTO PV-CICS-MSG-AREA2  36460004
364700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    36470004
364800                                            TO PV-COMMAREA-LENGTH 36480004
364900              EXEC CICS                                           36490004
365000                 WRITEQ TD                                        36500004
365100                  QUEUE  ('CSSL')                                 36510004
365200                   FROM  (PV-CICS-MSG-AREA2)                      36520004
365300                 LENGTH  (PV-COMMAREA-LENGTH)                     36530004
365400                   RESP  (PV-CICS-RESP)                           36540004
365500              END-EXEC                                            36550004
365600                                                                  36560004
365700              INITIALIZE PV-CICS-MSG-AREA2                        36570004
365800              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         36580004
365900              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             36590004
366000              PERFORM 9900-SOFT-ABORT                             36600004
366100                                                                  36610004
366200         WHEN SQLWARN0 NOT = SPACES                               36620004
366300         WHEN SQLCODE < +0                                        36630004
366400         WHEN SQLCODE > +0                                        36640004
366500              MOVE '5400-COUNT-REMAINING-SHIPMENTS'               36650004
366600                                TO DP013-PARAGRAPH                36660004
366601              MOVE 'COUNTING OPEN SHIPMENTS FOR A TRIP'           36660104
366602                                TO DP013-MESSAGE-TEXT(1)          36660204
366603              MOVE SQLCA        TO DP013-SQLCA                    36660304
366604              MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)       36660404
366605              MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (2)       36660504
366606              MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (3)       36660604
366607              SET DP013-DB2-ABEND                                 36660704
366608                  DP013-XCTL-DISPLAY-RESTART TO TRUE              36660804
366609              PERFORM DP013-0000-PROCESS-ABEND                    36660904
366610     END-EVALUATE.                                                36661004
366620                                                                  36662004
366630     IF  PV-SHIPMENT-COUNT = +0                                   36663004
366640         PERFORM 5500-STATUS-TRIP-DELETED                         36664004
366650     END-IF.                                                      36665004
366660                                                                  36666004
366670                                                                  36667004
366680 5450-UPDATE-SHPTPO-RECS.                                         36668004
366690                                                                  36669004
366700     PERFORM 5460-OPEN-CURSOR.                                    36670004
366800     SET PS-NOT-END-OF-CURSOR TO TRUE.                            36680004
366900     PERFORM 5480-FETCH-CURSOR                                    36690004
367000         UNTIL PS-END-OF-CURSOR.                                  36700004
367100     PERFORM 5470-CLOSE-CURSOR.                                   36710004
367200                                                                  36720004
367300                                                                  36730004
367400*----------------------------------------------------------------*36740004
367500* OPEN THE SHPTPO CURSOR.                                        *36750004
367600*----------------------------------------------------------------*36760004
367700                                                                  36770004
367800 5460-OPEN-CURSOR.                                                36780004
367900                                                                  36790004
368000     EXEC SQL                                                     36800004
368100          OPEN SHPTPO-CSR                                         36810004
368200     END-EXEC.                                                    36820004
368300                                                                  36830004
368400     EVALUATE TRUE                                                36840004
368500         WHEN SQLCODE = ZERO                                      36850004
368600              CONTINUE                                            36860004
368700                                                                  36870004
368800         WHEN SQLCODE = -904                                      36880004
368900         WHEN SQLCODE = -913                                      36890004
369000              MOVE SQLCODE                TO PV-SOFT-SQLCODE      36900004
369100              MOVE '5460-OPEN-CURSOR'     TO PV-SOFT-PARAGRAPH    36910004
369200              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          36920004
369300              MOVE DP020-USERID           TO PV-USER              36930004
369400              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    36940004
369500              MOVE LENGTH OF PV-CICS-MSG-AREA2                    36950004
369600                                          TO PV-COMMAREA-LENGTH   36960004
369700              EXEC CICS                                           36970004
369800                   WRITEQ TD                                      36980004
369900                    QUEUE  ('CSSL')                               36990004
370000                     FROM  (PV-CICS-MSG-AREA2)                    37000004
370100                   LENGTH  (PV-COMMAREA-LENGTH)                   37010004
370200                     RESP  (PV-CICS-RESP)                         37020004
370300              END-EXEC                                            37030004
370400                                                                  37040004
370500              INITIALIZE  PV-CICS-MSG-AREA2                       37050004
370600              MOVE  DK-SHIPT-ID          TO  PV-DISP-SHIPT-ID     37060004
370700              STRING ' RCKCS261 - '                               37070004
370800                      'SHIPT-ID:'            PV-DISP-SHIPT-ID     37080004
370900                                             DELIMITED BY SIZE    37090004
371000                                       INTO  PV-CICS-MSG-AREA2    37100004
371100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    37110004
371200                                          TO PV-COMMAREA-LENGTH   37120004
371300              EXEC CICS                                           37130004
371400                   WRITEQ TD                                      37140004
371500                    QUEUE  ('CSSL')                               37150004
371600                     FROM  (PV-CICS-MSG-AREA2)                    37160004
371700                   LENGTH  (PV-COMMAREA-LENGTH)                   37170004
371800                     RESP  (PV-CICS-RESP)                         37180004
371900              END-EXEC                                            37190004
371910                                                                  37191004
371920              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         37192004
371930              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             37193004
371940              PERFORM 9900-SOFT-ABORT                             37194004
371950              INITIALIZE PV-CICS-MSG-AREA2                        37195004
371960                                                                  37196004
371970         WHEN SQLWARN0 NOT = SPACES                               37197004
371980         WHEN SQLCODE < ZERO                                      37198004
371990         WHEN SQLCODE > ZERO                                      37199004
372000              MOVE '5460-OPEN-CURSOR'                             37200004
372100                                TO DP013-PARAGRAPH                37210004
372200              MOVE 'OPEN SHPTPO CURSOR - '                        37220004
372300                                TO DP013-MESSAGE-TEXT (1)         37230004
372400              MOVE SQLCA        TO DP013-SQLCA                    37240004
372500              MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)       37250004
372600              SET DP013-DB2-ABEND                                 37260004
372700                  DP013-XCTL-DISPLAY-RESTART TO TRUE              37270004
372800              PERFORM DP013-0000-PROCESS-ABEND                    37280004
372900     END-EVALUATE.                                                37290004
373000                                                                  37300004
373100                                                                  37310004
373200*----------------------------------------------------------------*37320004
373300* CLOSE THE TMESSAGE CURSOR.                                     *37330004
373400*----------------------------------------------------------------*37340004
373500                                                                  37350004
373600 5470-CLOSE-CURSOR.                                               37360004
373700     EXEC SQL                                                     37370004
373800         CLOSE SHPTPO-CSR                                         37380004
373900     END-EXEC.                                                    37390004
374000                                                                  37400004
374100                                                                  37410004
374200     EVALUATE TRUE                                                37420004
374300         WHEN SQLCODE = ZERO                                      37430004
374400             CONTINUE                                             37440004
374500         WHEN SQLWARN0 NOT = SPACES                               37450004
374600         WHEN SQLCODE < ZERO                                      37460004
374700         WHEN SQLCODE > ZERO                                      37470004
374800             MOVE '5470-CLOSE-CURSOR'                             37480004
374900                               TO DP013-PARAGRAPH                 37490004
375000             MOVE 'CLOSE SHPTPO CURSOR '                          37500004
375100                               TO DP013-MESSAGE-TEXT (1)          37510004
375200             MOVE SQLCA        TO DP013-SQLCA                     37520004
375300             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        37530004
375400             SET DP013-DB2-ABEND                                  37540004
375500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               37550004
375600             PERFORM DP013-0000-PROCESS-ABEND                     37560004
375700     END-EVALUATE.                                                37570004
375800                                                                  37580004
375900                                                                  37590004
376000 5480-FETCH-CURSOR.                                               37600004
376100                                                                  37610004
376200     EXEC SQL                                                     37620004
376300          FETCH SHPTPO-CSR                                        37630004
376400           INTO  :SHPTPO-PO-NBR                                   37640004
376500              ,  :SHPTPO-REC-SEQ-NBR                              37650004
376600              ,  :SHPTPO-EXPTED-CART-CNT                          37660004
376700              ,  :SHPTPO-ACTL-CART-CNT                            37670004
376800              ,  :SHPTPO-CARR-CART-CT                             37680004
376900              ,  :SHPTPO-VEND-CART-CT                             37690004
377000     END-EXEC.                                                    37700004
377100                                                                  37710004
377200     EVALUATE TRUE                                                37720004
377300         WHEN SQLCODE = +0                                        37730004
377400              CONTINUE                                            37740004
377500                                                                  37750004
377600         WHEN SQLCODE = -904                                      37760004
377700         WHEN SQLCODE = -913                                      37770004
377800              MOVE SQLCODE                TO PV-SOFT-SQLCODE      37780004
377900              MOVE '5480-FETCH-CURSOR'    TO PV-SOFT-PARAGRAPH    37790004
378000              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          37800004
378100              MOVE DP020-USERID           TO PV-USER              37810004
378200              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    37820004
378300              MOVE LENGTH OF PV-CICS-MSG-AREA2                    37830004
378400                                          TO PV-COMMAREA-LENGTH   37840004
378500              EXEC CICS                                           37850004
378600                 WRITEQ TD                                        37860004
378700                  QUEUE  ('CSSL')                                 37870004
378800                   FROM  (PV-CICS-MSG-AREA2)                      37880004
378900                 LENGTH  (PV-COMMAREA-LENGTH)                     37890004
379000                   RESP  (PV-CICS-RESP)                           37900004
379100              END-EXEC                                            37910004
379200                                                                  37920004
379300              INITIALIZE  PV-CICS-MSG-AREA2                       37930004
379400              MOVE  DK-SHIPT-ID          TO  PV-DISP-SHIPT-ID     37940004
379500              STRING ' RCKCS261 - '                               37950004
379600                      'SHIPT-ID:'            PV-DISP-SHIPT-ID     37960004
379700                                             DELIMITED BY SIZE    37970004
379800                                       INTO  PV-CICS-MSG-AREA2    37980004
379900              MOVE LENGTH OF PV-CICS-MSG-AREA2                    37990004
380000                                          TO PV-COMMAREA-LENGTH   38000004
380010              EXEC CICS                                           38001004
380020                   WRITEQ TD                                      38002004
380030                    QUEUE  ('CSSL')                               38003004
380040                     FROM  (PV-CICS-MSG-AREA2)                    38004004
380050                   LENGTH  (PV-COMMAREA-LENGTH)                   38005004
380060                     RESP  (PV-CICS-RESP)                         38006004
380070              END-EXEC                                            38007004
380080                                                                  38008004
380081              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         38008104
380082              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             38008204
380083              PERFORM 9900-SOFT-ABORT                             38008304
380084                                                                  38008404
380085         WHEN SQLCODE = +100                                      38008504
380086              SET PS-END-OF-CURSOR TO TRUE                        38008604
380087                                                                  38008704
380088         WHEN SQLWARN0 NOT = SPACES                               38008804
380089         WHEN SQLCODE < +0                                        38008904
380090         WHEN SQLCODE > +0                                        38009004
380100              MOVE '5480-FETCH-CURSOR'                            38010004
380200                              TO DP013-PARAGRAPH                  38020004
380300              MOVE 'UNSUCCESSFUL FETCH ON TSHPTPO CURSOR'         38030004
380400                              TO DP013-MESSAGE-TEXT (1)           38040004
380500              MOVE SQLCA      TO DP013-SQLCA                      38050004
380600              MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)         38060004
380700              SET DP013-DB2-ABEND                                 38070004
380800                  DP013-XCTL-DISPLAY-RESTART                      38080004
380900                              TO TRUE                             38090004
381000              PERFORM DP013-0000-PROCESS-ABEND                    38100004
381100     END-EVALUATE.                                                38110004
381200                                                                  38120004
381300     IF SQLCODE = +0                                              38130004
381400         IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                38140004
381500             IF SHPTPO-REC-SEQ-NBR > 0                            38150004
381600                 MOVE PC-DEFAULT-TMST-9S TO RECEIV-REC-TMST       38160004
381700                 PERFORM 5530-UPDATE-RECEIVER                     38170004
381800             END-IF                                               38180004
381900         ELSE                                                     38190004
382000         IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID) OR             38200004
382100            ASC-CONTINUE-FUNC-02                                  38210004
382200             SET PS-DONT-UPDATE-SHPTPO TO TRUE                    38220004
382300             IF SHPTPO-EXPTED-CART-CNT > 0                        38230004
382400                 CONTINUE                                         38240004
382500             ELSE                                                 38250004
382600                 IF SHPTPO-CARR-CART-CT > 0                       38260004
382700                     MOVE SHPTPO-CARR-CART-CT                     38270004
382800                           TO SHPTPO-EXPTED-CART-CNT              38280004
382900                     SET PS-UPDATE-SHPTPO TO TRUE                 38290004
383000                 ELSE                                             38300004
383100                     IF SHPTPO-VEND-CART-CT > 0                   38310004
383200                         MOVE SHPTPO-VEND-CART-CT                 38320004
383300                               TO SHPTPO-EXPTED-CART-CNT          38330004
383400                         SET PS-UPDATE-SHPTPO TO TRUE             38340004
383500                     END-IF                                       38350004
383600                 END-IF                                           38360004
383700             END-IF                                               38370004
383800             IF SHPTPO-REC-SEQ-NBR = 0                            38380004
383900               IF SHIPMT-VEND-SHIP-DTE = '9999-09-09' OR          38390004
384000                  SHIPMT-VEND-SHIP-DTE = '0001-01-01'             38400004
384100                  SET PS-ERROR                                    38410004
384200                      PS-VEND-SHIP-DTE-ERROR TO TRUE              38420004
384300                  SET DP030-OVERRIDE-GO                           38430004
384400                                 TO TRUE                          38440004
384500                  MOVE PC-TSYMSG-02301                            38450004
384600                                 TO DP020-MSG-NUMBER              38460004
384700                  SET DP020-MSG-FATAL                             38470004
384800                                 TO TRUE                          38480004
384900               ELSE                                               38490004
385000                  PERFORM 5900-ADD-RECEIVER                       38500004
385100                  MOVE PV-REC-SEQ-NBR  TO SHPTPO-REC-SEQ-NBR      38510004
385200                  SET PS-UPDATE-SHPTPO TO TRUE                    38520004
385300               END-IF                                             38530004
385400             ELSE                                                 38540004
385500                 MOVE ASC-KEY-TRIP-ID        TO DK-TRIP-ID        38550004
385600                 PERFORM 5600-SELECT-TTRIPST                      38560004
385700                 IF TRSTYP-PRTY-CDE > PC-49                       38570004
385800                     STRING TRIPST-STATUS-DTE DELIMITED BY SIZE,  38580004
385900                            '-' DELIMITED BY SIZE,                38590004
386000                            TRIPST-STATUS-TME DELIMITED BY SIZE,  38600004
386100                            '.000000' DELIMITED BY SIZE           38610004
386200                            INTO                RECEIV-REC-TMST   38620004
386300                     PERFORM 5530-UPDATE-RECEIVER                 38630004
386400                 END-IF                                           38640004
386500             END-IF                                               38650004
386600                                                                  38660004
386700             IF PS-UPDATE-SHPTPO AND                              38670004
386800                PS-NO-ERROR                                       38680004
386900                 PERFORM 5490-UPDATE-SHPTPO                       38690004
387000             END-IF                                               38700004
387100         ELSE                                                     38710004
387200             IF SHPTPO-REC-SEQ-NBR > 0                            38720004
387300                 MOVE ASC-KEY-TRIP-ID        TO DK-TRIP-ID        38730004
387400                 PERFORM 5600-SELECT-TTRIPST                      38740004
387500                 IF TRSTYP-PRTY-CDE > PC-49                       38750004
387600                     STRING TRIPST-STATUS-DTE DELIMITED BY SIZE,  38760004
387700                            '-' DELIMITED BY SIZE,                38770004
387800                            TRIPST-STATUS-TME DELIMITED BY SIZE,  38780004
387900                            '.000000' DELIMITED BY SIZE           38790004
388000                            INTO                RECEIV-REC-TMST   38800004
388100                     PERFORM 5530-UPDATE-RECEIVER                 38810004
388200                 END-IF                                           38820004
388300             END-IF                                               38830004
388400             IF SHPTPO-REC-SEQ-NBR > 0                            38840004
388500                 IF SHPTPO-EXPTED-CART-CNT > 0                    38850004
388600                     CONTINUE                                     38860004
388700                 ELSE                                             38870004
388800                     IF SHPTPO-CARR-CART-CT > 0                   38880004
388900                         MOVE SHPTPO-CARR-CART-CT                 38890004
389000                               TO SHPTPO-EXPTED-CART-CNT          38900004
389100                         PERFORM 5490-UPDATE-SHPTPO               38910004
389200                     ELSE                                         38920004
389300                         IF SHPTPO-VEND-CART-CT > 0               38930004
389400                             MOVE SHPTPO-VEND-CART-CT             38940004
389500                                   TO SHPTPO-EXPTED-CART-CNT      38950004
389600                             PERFORM 5490-UPDATE-SHPTPO           38960004
389700                         END-IF                                   38970004
389800                     END-IF                                       38980004
389900                 END-IF                                           38990004
390000             END-IF                                               39000004
390100         END-IF                                                   39010004
390200         END-IF                                                   39020004
390300     END-IF.                                                      39030004
390400                                                                  39040004
390500 5485-FETCH-CURSOR.                                               39050004
390600                                                                  39060004
390700     EXEC SQL                                                     39070004
390800          FETCH SHPTPO-CSR                                        39080004
390900           INTO  :SHPTPO-PO-NBR                                   39090004
391000              ,  :SHPTPO-REC-SEQ-NBR                              39100004
391100              ,  :SHPTPO-EXPTED-CART-CNT                          39110004
391200              ,  :SHPTPO-ACTL-CART-CNT                            39120004
391300              ,  :SHPTPO-CARR-CART-CT                             39130004
391400              ,  :SHPTPO-VEND-CART-CT                             39140004
391500      END-EXEC.                                                   39150004
391600                                                                  39160004
391700      EVALUATE TRUE                                               39170004
391800          WHEN SQLCODE = +0                                       39180004
391900               CONTINUE                                           39190004
392000                                                                  39200004
392100          WHEN SQLCODE = -904                                     39210004
392200          WHEN SQLCODE = -913                                     39220004
392300               MOVE SQLCODE                TO PV-SOFT-SQLCODE     39230004
392400               MOVE '5485-FETCH-CURSOR'    TO PV-SOFT-PARAGRAPH   39240004
392500               MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION         39250004
392600               MOVE DP020-USERID           TO PV-USER             39260004
392700               MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2   39270004
392800               MOVE LENGTH OF PV-CICS-MSG-AREA2                   39280004
392900                                           TO PV-COMMAREA-LENGTH  39290004
393000               EXEC CICS                                          39300004
393100                  WRITEQ TD                                       39310004
393200                   QUEUE  ('CSSL')                                39320004
393300                    FROM  (PV-CICS-MSG-AREA2)                     39330004
393400                  LENGTH  (PV-COMMAREA-LENGTH)                    39340004
393500                    RESP  (PV-CICS-RESP)                          39350004
393600               END-EXEC                                           39360004
393700                                                                  39370004
393800              INITIALIZE  PV-CICS-MSG-AREA2                       39380004
393900              MOVE  DK-SHIPT-ID          TO  PV-DISP-SHIPT-ID     39390004
394000              STRING ' RCKCS261 - '                               39400004
394100                      'SHIPT-ID:'            PV-DISP-SHIPT-ID     39410004
394200                                             DELIMITED BY SIZE    39420004
394300                                       INTO  PV-CICS-MSG-AREA2    39430004
394400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    39440004
394500                                          TO PV-COMMAREA-LENGTH   39450004
394600              EXEC CICS                                           39460004
394700                   WRITEQ TD                                      39470004
394800                    QUEUE  ('CSSL')                               39480004
394900                     FROM  (PV-CICS-MSG-AREA2)                    39490004
394910                   LENGTH  (PV-COMMAREA-LENGTH)                   39491004
394920                     RESP  (PV-CICS-RESP)                         39492004
394930              END-EXEC                                            39493004
394940                                                                  39494004
394950               MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER        39495004
394960               SET  DP030-SET-CURSOR-APPL-1    TO TRUE            39496004
394970               PERFORM 9900-SOFT-ABORT                            39497004
394980                                                                  39498004
394990         WHEN SQLCODE = +100                                      39499004
395000              SET PS-END-OF-CURSOR TO TRUE                        39500004
395100                                                                  39510004
395200         WHEN SQLWARN0 NOT = SPACES                               39520004
395300         WHEN SQLCODE < +0                                        39530004
395400         WHEN SQLCODE > +0                                        39540004
395500              MOVE '5485-FETCH-CURSOR'                            39550004
395600                              TO DP013-PARAGRAPH                  39560004
395700              MOVE 'UNSUCCESSFUL FETCH ON TSHPTPO CURSOR'         39570004
395800                              TO DP013-MESSAGE-TEXT (1)           39580004
395900              MOVE SQLCA      TO DP013-SQLCA                      39590004
396000              MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)         39600004
396100              SET DP013-DB2-ABEND                                 39610004
396200                  DP013-XCTL-DISPLAY-RESTART                      39620004
396300                              TO TRUE                             39630004
396400              PERFORM DP013-0000-PROCESS-ABEND                    39640004
396500     END-EVALUATE.                                                39650004
396600                                                                  39660004
396700     IF SQLCODE = +0                                              39670004
396800         MOVE SHPTPO-PO-NBR TO DK-PO-NBR                          39680004
396900         MOVE SHPTPO-REC-SEQ-NBR TO DK-REC-SEQ-NBR                39690004
397000         MOVE ASC-KEY-TRIP-ID TO DK-TRIP-ID                       39700004
397100         PERFORM 5299-SELECT-SHPTPO                               39710004
397200         IF SQLCODE = +0 OR                                       39720004
397300            SQLCODE = -811                                        39730004
397400             SET PS-PO-NOW-ON-TRAILER TO TRUE                     39740004
397500         END-IF                                                   39750004
397600     END-IF.                                                      39760004
397700                                                                  39770004
397800 5490-UPDATE-SHPTPO.                                              39780004
397900                                                                  39790004
398000     EXEC SQL                                                     39800004
398100          UPDATE TSHPTPO                                          39810004
398200             SET REC_SEQ_NBR      = :SHPTPO-REC-SEQ-NBR,          39820004
398300                 EXPTED_CART_CNT  = :SHPTPO-EXPTED-CART-CNT,      39830004
398400                 LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME,     39840004
398500                 LAST_UPD_DTE     = CURRENT DATE,                 39850004
398600                 LAST_UPD_TIME    = CURRENT TIME,                 39860004
398700                 LAST_UPD_USER_ID = :DP020-USERID                 39870004
398800           WHERE SHIPT_ID         = :DK-SHIPT-ID                  39880004
398900             AND PO_NBR           = :SHPTPO-PO-NBR                39890004
399000     END-EXEC.                                                    39900004
399100                                                                  39910004
399200     EVALUATE TRUE                                                39920004
399300         WHEN SQLCODE = +0                                        39930004
399400              CONTINUE                                            39940004
399500                                                                  39950004
399600         WHEN SQLCODE = -904                                      39960004
399700         WHEN SQLCODE = -913                                      39970004
399800              MOVE SQLCODE                TO PV-SOFT-SQLCODE      39980004
399900              MOVE '5490-UPDATE-SHPTPO  ' TO PV-SOFT-PARAGRAPH    39990004
400000              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          40000004
400100              MOVE DP020-USERID           TO PV-USER              40010004
400200              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    40020004
400300              MOVE LENGTH OF PV-CICS-MSG-AREA2                    40030004
400400                                          TO PV-COMMAREA-LENGTH   40040004
400500              EXEC CICS                                           40050004
400600                   WRITEQ TD                                      40060004
400700                    QUEUE  ('CSSL')                               40070004
400800                     FROM  (PV-CICS-MSG-AREA2)                    40080004
400900                   LENGTH  (PV-COMMAREA-LENGTH)                   40090004
401000                     RESP  (PV-CICS-RESP)                         40100004
401100              END-EXEC                                            40110004
401200                                                                  40120004
401300              INITIALIZE PV-CICS-MSG-AREA2                        40130004
401400              MOVE DK-SHIPT-ID     TO  PV-DISP-SHIPT-ID           40140004
401500              MOVE SHPTPO-PO-NBR   TO  PV-DISP-PO                 40150004
401600              STRING ' RCKCS261 -'                                40160004
401700                     '   SHPMT ID:'           PV-DISP-SHIPT-ID    40170004
401800                     '   SHPMT PO:'           PV-DISP-PO          40180004
401900                                              DELIMITED BY SIZE   40190004
402000                                         INTO PV-CICS-MSG-AREA2   40200004
402100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    40210004
402200                                           TO PV-COMMAREA-LENGTH  40220004
402300              EXEC CICS                                           40230004
402400                   WRITEQ TD                                      40240004
402500                    QUEUE  ('CSSL')                               40250004
402600                     FROM  (PV-CICS-MSG-AREA2)                    40260004
402700                   LENGTH  (PV-COMMAREA-LENGTH)                   40270004
402800                     RESP  (PV-CICS-RESP)                         40280004
402900              END-EXEC                                            40290004
403000                                                                  40300004
403100              INITIALIZE PV-CICS-MSG-AREA2                        40310004
403200              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         40320004
403300              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             40330004
403400              PERFORM 9900-SOFT-ABORT                             40340004
403401                                                                  40340104
403402         WHEN SQLWARN0 NOT = SPACES                               40340204
403403         WHEN SQLCODE < +0                                        40340304
403404         WHEN SQLCODE > +0                                        40340404
403405              MOVE '5300-ASSIGN-SHIPMENT-TO-TRIP'                 40340504
403406                                  TO DP013-PARAGRAPH              40340604
403407              MOVE 'UPDATE INFO ON TSHIPMT     '                  40340704
403408                                  TO DP013-MESSAGE-TEXT(1)        40340804
403409              MOVE SQLCA        TO DP013-SQLCA                    40340904
403410              MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)       40341004
403411              SET DP013-DB2-ABEND                                 40341104
403412                  DP013-XCTL-DISPLAY-RESTART TO TRUE              40341204
403413              PERFORM DP013-0000-PROCESS-ABEND                    40341304
403414     END-EVALUATE.                                                40341404
403415                                                                  40341504
403416     EVALUATE TRUE                                                40341604
403417         WHEN SQLCODE = ZERO                                      40341704
403418              MOVE PC-U            TO PV-TRN-CDE                  40341804
403419              PERFORM 5495-INSERT-TAUSHPO                         40341904
403420     END-EVALUATE.                                                40342004
403430                                                                  40343004
403440                                                                  40344004
403450*----------------------------------------------------------------*40345004
403460*  INSERT THE PO TO THE SHIPEMENT PO ASSOCIATION AUDIT TABLE      40346004
403470*                                                                 40347004
403480*  PERFORMED FROM 5000-INSERT-TAUSHPO                             40348004
403490*----------------------------------------------------------------*40349004
403500                                                                  40350004
403600 5495-INSERT-TAUSHPO.                                             40360004
403700                                                                  40370004
403800     EXEC SQL                                                     40380004
403900          SELECT SHIPT_ID,                                        40390004
404000                 PO_NBR,                                          40400004
404100                 REC_SEQ_NBR,                                     40410004
404200                 EXPTED_CART_CNT,                                 40420004
404300                 ACTL_CART_CNT,                                   40430004
404400                 DMG_CART_CNT,                                    40440004
404500                 PKSL_IND,                                        40450004
404600                 VEND_NAME,                                       40460004
404700                 FRGT_CHG_AMT,                                    40470004
404800                 LAST_UPD_PGM_ID,                                 40480004
404900                 CRE_USER_ID,                                     40490004
405000                 CARR_CART_CT,                                    40500004
405100                 CARR_LAST_UPD_DTE,                               40510004
405200                 CARR_LAST_UPD_TIME,                              40520004
405300                 VEND_CART_CT,                                    40530004
405400                 VEND_LAST_UPD_DTE,                               40540004
405500                 VEND_LAST_UPD_TIME,                              40550004
405600                 CRE_TMST,                                        40560004
405700                 LAST_UPD_DTE,                                    40570004
405800                 LAST_UPD_TIME,                                   40580004
405900                 LAST_UPD_USER_ID,                                40590004
406000                 PRIM_SHIPT_IND,                                  40600004
406100                 SPLT_XMIT_IND,                                   40610004
406200                 SPLT_XMIT_DTE,                                   40620004
406300                 SPLT_XMIT_TM                                     40630004
406400            INTO :SHPTPO-SHIPT-ID,                                40640004
406500                 :SHPTPO-PO-NBR,                                  40650004
406600                 :SHPTPO-REC-SEQ-NBR,                             40660004
406700                 :SHPTPO-EXPTED-CART-CNT,                         40670004
406800                 :SHPTPO-ACTL-CART-CNT,                           40680004
406900                 :SHPTPO-DMG-CART-CNT,                            40690004
407000                 :SHPTPO-PKSL-IND,                                40700004
407100                 :SHPTPO-VEND-NAME,                               40710004
407200                 :SHPTPO-FRGT-CHG-AMT,                            40720004
407300                 :SHPTPO-LAST-UPD-PGM-ID,                         40730004
407400                 :SHPTPO-CRE-USER-ID,                             40740004
407500                 :SHPTPO-CARR-CART-CT,                            40750004
407600                 :SHPTPO-CARR-LAST-UPD-DTE,                       40760004
407700                 :SHPTPO-CARR-LAST-UPD-TIME,                      40770004
407800                 :SHPTPO-VEND-CART-CT,                            40780004
407900                 :SHPTPO-VEND-LAST-UPD-DTE,                       40790004
408000                 :SHPTPO-VEND-LAST-UPD-TIME,                      40800004
408100                 :SHPTPO-CRE-TMST,                                40810004
408200                 :SHPTPO-LAST-UPD-DTE,                            40820004
408300                 :SHPTPO-LAST-UPD-TIME,                           40830004
408400                 :SHPTPO-LAST-UPD-USER-ID,                        40840004
408500                 :SHPTPO-PRIM-SHIPT-IND,                          40850004
408600                 :SHPTPO-SPLT-XMIT-IND,                           40860004
408700                 :SHPTPO-SPLT-XMIT-DTE,                           40870004
408800                 :SHPTPO-SPLT-XMIT-TM                             40880004
408900            FROM TSHPTPO                                          40890004
409000           WHERE  SHIPT_ID = :DK-SHIPT-ID                         40900004
409100             AND  PO_NBR   = :SHPTPO-PO-NBR                       40910004
409200     END-EXEC.                                                    40920004
409300                                                                  40930004
409400     EVALUATE TRUE                                                40940004
409500         WHEN SQLCODE = ZERO                                      40950004
409600         WHEN SQLCODE = +100                                      40960004
409700             CONTINUE                                             40970004
409800                                                                  40980004
409900         WHEN SQLCODE = -904                                      40990004
410000         WHEN SQLCODE = -913                                      41000004
410100              MOVE SQLCODE                TO PV-SOFT-SQLCODE      41010004
410200              MOVE '5495-INSERT-TAUSHPO ' TO PV-SOFT-PARAGRAPH    41020004
410300              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          41030004
410400              MOVE DP020-USERID           TO PV-USER              41040004
410500              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    41050004
410600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    41060004
410700                                          TO PV-COMMAREA-LENGTH   41070004
410800              EXEC CICS                                           41080004
410900                   WRITEQ TD                                      41090004
411000                    QUEUE  ('CSSL')                               41100004
411100                     FROM  (PV-CICS-MSG-AREA2)                    41110004
411200                   LENGTH  (PV-COMMAREA-LENGTH)                   41120004
411300                     RESP  (PV-CICS-RESP)                         41130004
411400              END-EXEC                                            41140004
411500                                                                  41150004
411600              INITIALIZE PV-CICS-MSG-AREA2                        41160004
411700              MOVE DK-SHIPT-ID     TO  PV-DISP-SHIPT-ID           41170004
411800              MOVE SHPTPO-PO-NBR   TO  PV-DISP-PO                 41180004
411900              STRING ' RCKCS261 -'                                41190004
412000                     '   SHPMT ID:'      PV-DISP-SHIPT-ID         41200004
412100                     '   SHPMT PO:'      PV-DISP-PO               41210004
412200                                         DELIMITED BY SIZE        41220004
412300                                    INTO PV-CICS-MSG-AREA2        41230004
412400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    41240004
412500                                      TO PV-COMMAREA-LENGTH       41250004
412600              EXEC CICS                                           41260004
412700                 WRITEQ TD                                        41270004
412800                  QUEUE  ('CSSL')                                 41280004
412900                   FROM  (PV-CICS-MSG-AREA2)                      41290004
413000                 LENGTH  (PV-COMMAREA-LENGTH)                     41300004
413100                   RESP  (PV-CICS-RESP)                           41310004
413200              END-EXEC                                            41320004
413300                                                                  41330004
413400              INITIALIZE PV-CICS-MSG-AREA2                        41340004
413500              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         41350004
413600              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             41360004
413700              PERFORM 9900-SOFT-ABORT                             41370004
413800                                                                  41380004
413900         WHEN SQLWARN0 NOT = SPACE                                41390004
414000         WHEN SQLCODE  NOT = +0                                   41400004
414100              MOVE SPACES TO PV-MESSAGE                           41410004
414200              MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1                 41420004
414300              MOVE SHPTPO-PO-NBR   TO PV-MESSAGE2                 41430004
414301              MOVE '5495-INSERT-TAUSHPO'                          41430104
414302                                   TO DP013-PARAGRAPH             41430204
414303              MOVE 'SELECT TSHPTPO DATA'                          41430304
414304                                   TO DP013-MESSAGE-TEXT (1)      41430404
414305              MOVE PV-MESSAGE      TO DP013-MESSAGE-TEXT (2)      41430504
414306              MOVE SQLCA           TO DP013-SQLCA                 41430604
414307              MOVE 'TSHPTPO'       TO DP013-DB2-TABLE-NAME (1)    41430704
414308              SET DP013-DB2-ABEND  TO TRUE                        41430804
414309              PERFORM DP013-0000-PROCESS-ABEND                    41430904
414310     END-EVALUATE.                                                41431004
414320                                                                  41432004
414330     MOVE PV-TRN-CDE               TO AUSHPO-TRN-CDE.             41433004
414340                                                                  41434004
414350     EXEC SQL                                                     41435004
414360          INSERT                                                  41436004
414370            INTO TAUSHPO                                          41437004
414380                 (SHIPT_ID,                                       41438004
414390                  PO_NBR,                                         41439004
414400                  REC_SEQ_NBR,                                    41440004
414500                  EXPTED_CART_CNT,                                41450004
414600                  ACTL_CART_CNT,                                  41460004
414700                  DMG_CART_CNT,                                   41470004
414800                  PKSL_IND,                                       41480004
414900                  VEND_NAME,                                      41490004
415000                  FRGT_CHG_AMT,                                   41500004
415100                  LAST_UPD_PGM_ID,                                41510004
415200                  CRE_USER_ID,                                    41520004
415300                  CARR_CART_CT,                                   41530004
415400                  CARR_LAST_UPD_DTE,                              41540004
415500                  CARR_LAST_UPD_TIME,                             41550004
415600                  VEND_CART_CT,                                   41560004
415700                  VEND_LAST_UPD_DTE,                              41570004
415800                  VEND_LAST_UPD_TIME,                             41580004
415900                  CRE_TMST,                                       41590004
416000                  LAST_UPD_DTE,                                   41600004
416100                  LAST_UPD_TIME,                                  41610004
416200                  LAST_UPD_USER_ID,                               41620004
416300                  PRIM_SHIPT_IND,                                 41630004
416400                  SPLT_XMIT_IND,                                  41640004
416500                  SPLT_XMIT_DTE,                                  41650004
416600                  SPLT_XMIT_TM,                                   41660004
416700                  TRN_CDE )                                       41670004
416800          VALUES                                                  41680004
416900                 (:SHPTPO-SHIPT-ID,                               41690004
417000                  :SHPTPO-PO-NBR,                                 41700004
417100                  :SHPTPO-REC-SEQ-NBR,                            41710004
417200                  :SHPTPO-EXPTED-CART-CNT,                        41720004
417300                  :SHPTPO-ACTL-CART-CNT,                          41730004
417400                  :SHPTPO-DMG-CART-CNT,                           41740004
417500                  :SHPTPO-PKSL-IND,                               41750004
417600                  :SHPTPO-VEND-NAME,                              41760004
417700                  :SHPTPO-FRGT-CHG-AMT,                           41770004
417800                  :SHPTPO-LAST-UPD-PGM-ID,                        41780004
417900                  :SHPTPO-CRE-USER-ID,                            41790004
418000                  :SHPTPO-CARR-CART-CT,                           41800004
418100                  :SHPTPO-CARR-LAST-UPD-DTE,                      41810004
418200                  :SHPTPO-CARR-LAST-UPD-TIME,                     41820004
418300                  :SHPTPO-VEND-CART-CT,                           41830004
418400                  :SHPTPO-VEND-LAST-UPD-DTE,                      41840004
418500                  :SHPTPO-VEND-LAST-UPD-TIME,                     41850004
418600                  :SHPTPO-CRE-TMST,                               41860004
418700                  :SHPTPO-LAST-UPD-DTE,                           41870004
418800                  :SHPTPO-LAST-UPD-TIME,                          41880004
418900                  :SHPTPO-LAST-UPD-USER-ID,                       41890004
419000                  :SHPTPO-PRIM-SHIPT-IND,                         41900004
419100                  :SHPTPO-SPLT-XMIT-IND,                          41910004
419200                  :SHPTPO-SPLT-XMIT-DTE,                          41920004
419300                  :SHPTPO-SPLT-XMIT-TM,                           41930004
419400                  :AUSHPO-TRN-CDE )                               41940004
419500     END-EXEC.                                                    41950004
419600                                                                  41960004
419700     EVALUATE TRUE                                                41970004
419800         WHEN SQLCODE = +0                                        41980004
419900             CONTINUE                                             41990004
420000                                                                  42000004
420100         WHEN SQLCODE = -904                                      42010004
420200         WHEN SQLCODE = -913                                      42020004
420300              MOVE SQLCODE                TO PV-SOFT-SQLCODE      42030004
420400              MOVE '5495-INSERT-TAUSHPO ' TO PV-SOFT-PARAGRAPH    42040004
420500              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          42050004
420600              MOVE DP020-USERID           TO PV-USER              42060004
420700              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    42070004
420800              MOVE LENGTH OF PV-CICS-MSG-AREA2                    42080004
420900                                          TO PV-COMMAREA-LENGTH   42090004
421000                                                                  42100004
421100              MOVE SHPTPO-SHIPT-ID        TO PV-DISP-SHIPT-ID     42110004
421200              MOVE SHPTPO-PO-NBR          TO PV-DISP-PO           42120004
421300              MOVE SHPTPO-REC-SEQ-NBR     TO PV-DISP-RCVR         42130004
421400              MOVE SHPTPO-EXPTED-CART-CNT TO                      42140004
421500                   PV-DISP-SHIPT-EXP-QTY                          42150004
421600              MOVE SHPTPO-ACTL-CART-CNT   TO                      42160004
421700                   PV-DISP-SHIPT-ACT-QTY                          42170004
421800                                                                  42180004
421900              EXEC CICS                                           42190004
422000                   WRITEQ TD                                      42200004
422100                    QUEUE  ('CSSL')                               42210004
422200                     FROM  (PV-CICS-MSG-AREA2)                    42220004
422300                   LENGTH  (PV-COMMAREA-LENGTH)                   42230004
422400                     RESP  (PV-CICS-RESP)                         42240004
422500              END-EXEC                                            42250004
422600              INITIALIZE PV-CICS-MSG-AREA2                        42260004
422700                                                                  42270004
422800              STRING ' RCKCS261 -'                                42280004
422900                     '   SHPMT ID:'         PV-DISP-SHIPT-ID      42290004
423000                     '   SHPMT PO:'         PV-DISP-PO            42300004
423100                     '   RCVR:'             PV-DISP-RCVR          42310004
423200                     '   EXP CART:'         PV-DISP-SHIPT-EXP-QTY 42320004
423300                     '   ACT CART:'         PV-DISP-SHIPT-ACT-QTY 42330004
423400                                            DELIMITED BY SIZE     42340004
423500                                       INTO PV-CICS-MSG-AREA2     42350004
423600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    42360004
423700                                          TO PV-COMMAREA-LENGTH   42370004
423800              EXEC CICS                                           42380004
423900                 WRITEQ TD                                        42390004
424000                  QUEUE  ('CSSL')                                 42400004
424100                   FROM  (PV-CICS-MSG-AREA2)                      42410004
424200                 LENGTH  (PV-COMMAREA-LENGTH)                     42420004
424300                   RESP  (PV-CICS-RESP)                           42430004
424400              END-EXEC                                            42440004
424500                                                                  42450004
424600              INITIALIZE PV-CICS-MSG-AREA2                        42460004
424700              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         42470004
424800              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             42480004
424900              PERFORM 9900-SOFT-ABORT                             42490004
425000                                                                  42500004
425100         WHEN SQLWARN0 NOT = SPACES                               42510004
425200         WHEN SQLCODE < +0                                        42520004
425300         WHEN SQLCODE > +0                                        42530004
425400              MOVE SPACES TO PV-MESSAGE                           42540004
425500              MOVE SHPTPO-SHIPT-ID TO PV-MESSAGE1                 42550004
425600              MOVE SHPTPO-PO-NBR   TO PV-MESSAGE2                 42560004
425700              MOVE '5005-INSERT-TAUSHPO'                          42570004
425800                                TO DP013-PARAGRAPH                42580004
425900              MOVE 'INSERT A ROW ON TAUSHPO'                      42590004
426000                                TO DP013-MESSAGE-TEXT(1)          42600004
426010              MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)          42601004
426011              MOVE SQLCA        TO DP013-SQLCA                    42601104
426012              MOVE 'TAUSHPO'    TO DP013-DB2-TABLE-NAME (1)       42601204
426013              SET DP013-DB2-ABEND                                 42601304
426014                  DP013-XCTL-DISPLAY-RESTART TO TRUE              42601404
426015              PERFORM DP013-0000-PROCESS-ABEND                    42601504
426016     END-EVALUATE.                                                42601604
426017                                                                  42601704
426018                                                                  42601804
426019*----------------------------------------------------------------*42601904
426020*    CHECK IF THE PO IS ALREADY ATTACHED TO THE TRAILER          *42602004
426030*----------------------------------------------------------------*42603004
426040 5299-SELECT-SHPTPO.                                              42604004
426050                                                                  42605004
426060     EXEC SQL                                                     42606004
426070          SELECT PO_NBR                                           42607004
426080            INTO :SHPTPO-PO-NBR                                   42608004
426090            FROM TSHIPMT A,                                       42609004
426100                 TSHPTPO B                                        42610004
426200           WHERE A.TRIP_ID     = :DK-TRIP-ID                      42620004
426300             AND A.SHIPT_ID    = B.SHIPT_ID                       42630004
426400             AND B.PO_NBR      = :DK-PO-NBR                       42640004
426500     END-EXEC.                                                    42650004
426600                                                                  42660004
426700     EVALUATE TRUE                                                42670004
426800         WHEN SQLCODE = +0                                        42680004
426900         WHEN SQLCODE = +100                                      42690004
427000         WHEN SQLCODE = -811                                      42700004
427100              CONTINUE                                            42710004
427200                                                                  42720004
427300         WHEN SQLCODE = -904                                      42730004
427400         WHEN SQLCODE = -913                                      42740004
427500              MOVE SQLCODE                TO PV-SOFT-SQLCODE      42750004
427600              MOVE '5299-SELECT-SHPTPO  ' TO PV-SOFT-PARAGRAPH    42760004
427700              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          42770004
427800              MOVE DP020-USERID           TO PV-USER              42780004
427900              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    42790004
428000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    42800004
428100                                          TO PV-COMMAREA-LENGTH   42810004
428200              EXEC CICS                                           42820004
428300                   WRITEQ TD                                      42830004
428400                    QUEUE  ('CSSL')                               42840004
428500                     FROM  (PV-CICS-MSG-AREA2)                    42850004
428600                   LENGTH  (PV-COMMAREA-LENGTH)                   42860004
428700                     RESP  (PV-CICS-RESP)                         42870004
428800              END-EXEC                                            42880004
428900                                                                  42890004
429000              INITIALIZE PV-CICS-MSG-AREA2                        42900004
429100              MOVE DK-TRIP-ID      TO  PV-DISP-TRIP-ID            42910004
429200              MOVE DK-PO-NBR       TO  PV-DISP-PO                 42920004
429300              STRING ' RCKCS261 -'                                42930004
429400                     '   TRIP ID:'             PV-DISP-TRIP-ID    42940004
429500                     '   PO NBR:'              PV-DISP-PO         42950004
429600                                               DELIMITED BY SIZE  42960004
429700                                          INTO PV-CICS-MSG-AREA2  42970004
429800              MOVE LENGTH OF PV-CICS-MSG-AREA2                    42980004
429900                                            TO PV-COMMAREA-LENGTH 42990004
430000              EXEC CICS                                           43000004
430100                 WRITEQ TD                                        43010004
430200                  QUEUE  ('CSSL')                                 43020004
430300                   FROM  (PV-CICS-MSG-AREA2)                      43030004
430400                 LENGTH  (PV-COMMAREA-LENGTH)                     43040004
430500                   RESP  (PV-CICS-RESP)                           43050004
430600              END-EXEC                                            43060004
430700                                                                  43070004
430800              INITIALIZE PV-CICS-MSG-AREA2                        43080004
430900              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         43090004
431000              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             43100004
431100              PERFORM 9900-SOFT-ABORT                             43110004
431200                                                                  43120004
431300         WHEN SQLWARN0 NOT = SPACES                               43130004
431400         WHEN SQLCODE < +0                                        43140004
431500         WHEN SQLCODE > +0                                        43150004
431600              MOVE '5299-SELECT-SHPTPO'                           43160004
431700                              TO DP013-PARAGRAPH                  43170004
431800              MOVE 'UNSUCCESSFUL COUNT OF TRECEIV TABLE'          43180004
431900                              TO DP013-MESSAGE-TEXT (1)           43190004
431910              MOVE SQLCA      TO DP013-SQLCA                      43191004
431911              MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)         43191104
431912              MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (2)         43191204
431913              MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (3)         43191304
431914              SET DP013-DB2-ABEND                                 43191404
431915                  DP013-XCTL-DISPLAY-RESTART                      43191504
431916                              TO TRUE                             43191604
431917              PERFORM DP013-0000-PROCESS-ABEND                    43191704
431918     END-EVALUATE.                                                43191804
431919                                                                  43191904
431920                                                                  43192004
431930******************************************************************43193004
431940** WHEN THERE ARE NO MORE SHIPMENTS ASSIGNED TO THIS TRIP,      **43194004
431950** STATUS THE TRIP DELETED.                                     **43195004
431960******************************************************************43196004
431970 5500-STATUS-TRIP-DELETED.                                        43197004
431980                                                                  43198004
431990     MOVE PV-SAVE-TRIP-ID        TO DK-TRIP-ID.                   43199004
432000     PERFORM 5600-SELECT-TTRIPST.                                 43200004
432100                                                                  43210004
432200     MOVE PC-DELETED-STATUS-CDE  TO TRIPST-TRIP-STATUS-CDE.       43220004
432300                                                                  43230004
432400     PERFORM 5700-INSERT-TTRIPST.                                 43240004
432500                                                                  43250004
432600                                                                  43260004
432700 5530-UPDATE-RECEIVER.                                            43270004
432800                                                                  43280004
432900     EXEC SQL                                                     43290004
433000          UPDATE TRECEIV                                          43300004
433100             SET REC_TMST         = :RECEIV-REC-TMST,             43310004
433200                 UPD_TMST         = CURRENT TIMESTAMP,            43320004
433300                 UPD_UID          = :DP020-USERID,                43330004
433400                 UPD_PGM_ID       = :PC-CURRENT-PROGRAM-NAME      43340004
433500          WHERE  ORD_NBR          = :SHPTPO-PO-NBR                43350004
433600            AND  REC_SEQ_NBR      = :SHPTPO-REC-SEQ-NBR           43360004
433700     END-EXEC.                                                    43370004
433800                                                                  43380004
433900     EVALUATE TRUE                                                43390004
434000         WHEN SQLCODE = +0                                        43400004
434100              CONTINUE                                            43410004
434200                                                                  43420004
434300         WHEN SQLCODE = -904                                      43430004
434400         WHEN SQLCODE = -913                                      43440004
434500              MOVE SQLCODE                TO PV-SOFT-SQLCODE      43450004
434600              MOVE '5530-UPDATE-RECEIVER' TO PV-SOFT-PARAGRAPH    43460004
434700              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          43470004
434800              MOVE DP020-USERID           TO PV-USER              43480004
434900              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    43490004
435000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    43500004
435100                                          TO PV-COMMAREA-LENGTH   43510004
435200              EXEC CICS                                           43520004
435300                   WRITEQ TD                                      43530004
435400                    QUEUE  ('CSSL')                               43540004
435500                     FROM  (PV-CICS-MSG-AREA2)                    43550004
435600                   LENGTH  (PV-COMMAREA-LENGTH)                   43560004
435610                     RESP  (PV-CICS-RESP)                         43561004
435620              END-EXEC                                            43562004
435630                                                                  43563004
435640              INITIALIZE PV-CICS-MSG-AREA2                        43564004
435650              MOVE SHPTPO-REC-SEQ-NBR  TO  PV-DISP-RCVR           43565004
435660              MOVE SHPTPO-PO-NBR       TO  PV-DISP-PO             43566004
435670              STRING ' RCKCS261 -'                                43567004
435671                     '   PO:'              PV-DISP-PO             43567104
435672                     '-'                   PV-DISP-RCVR           43567204
435673                                           DELIMITED BY SIZE      43567304
435674                                      INTO PV-CICS-MSG-AREA2      43567404
435675              MOVE LENGTH OF PV-CICS-MSG-AREA2                    43567504
435676                                        TO PV-COMMAREA-LENGTH     43567604
435677              EXEC CICS                                           43567704
435678                 WRITEQ TD                                        43567804
435679                  QUEUE  ('CSSL')                                 43567904
435680                   FROM  (PV-CICS-MSG-AREA2)                      43568004
435690                 LENGTH  (PV-COMMAREA-LENGTH)                     43569004
435700                   RESP  (PV-CICS-RESP)                           43570004
435800              END-EXEC                                            43580004
435900                                                                  43590004
436000              INITIALIZE PV-CICS-MSG-AREA2                        43600004
436100              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         43610004
436200              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             43620004
436300              PERFORM 9900-SOFT-ABORT                             43630004
436400                                                                  43640004
436500         WHEN SQLWARN0 NOT = SPACE                                43650004
436600         WHEN SQLCODE < +0                                        43660004
436700         WHEN SQLCODE > +0                                        43670004
436701              MOVE '5530-UPDATE-RECEIVER'                         43670104
436702                              TO DP013-PARAGRAPH                  43670204
436703              MOVE 'UPDATE ON RECEIPTS TABLE'                     43670304
436704                              TO DP013-MESSAGE-TEXT (1)           43670404
436705              MOVE SQLCA      TO DP013-SQLCA                      43670504
436706              MOVE SHPTPO-PO-NBR          TO PV-DISP-PO           43670604
436707              MOVE SHPTPO-REC-SEQ-NBR     TO PV-DISP-RCVR         43670704
436708              STRING ' PO/RCVR = '                                43670804
436709                       PV-DISP-PO '/'                             43670904
436710                       PV-DISP-RCVR  DELIMITED BY SIZE            43671004
436720                                INTO DP013-MESSAGE-TEXT(1)        43672004
436730              MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (1)     43673004
436740              SET DP013-DB2-ABEND                                 43674004
436750                  DP013-XCTL-DISPLAY-RESTART                      43675004
436760                                     TO TRUE                      43676004
436770              PERFORM DP013-0000-PROCESS-ABEND                    43677004
436780     END-EVALUATE.                                                43678004
436790                                                                  43679004
436800                                                                  43680004
436900*----------------------------------------------------------------*43690004
437000*  SELECT CURRENT TRIP STATUS ROW                                *43700004
437100*----------------------------------------------------------------*43710004
437200 5600-SELECT-TTRIPST.                                             43720004
437300                                                                  43730004
437400     EXEC SQL                                                     43740004
437500          SELECT                                                  43750004
437600                  A.TRIP_ID,                                      43760004
437700                  A.TRIP_STATUS_CDE,                              43770004
437800                  A.STATUS_DTE,                                   43780004
437900                  A.STATUS_TME,                                   43790004
438000                  A.STATUS_UID,                                   43800004
438100                  A.OPER_UNT_ID,                                  43810004
438200                  A.FCLTY_ID,                                     43820004
438300                  A.FCLTY_AREA_ID,                                43830004
438400                  B.PRTY_CDE                                      43840004
438500            INTO                                                  43850004
438600                 :TRIPST-TRIP-ID,                                 43860004
438700                 :TRIPST-TRIP-STATUS-CDE,                         43870004
438800                 :TRIPST-STATUS-DTE,                              43880004
438900                 :TRIPST-STATUS-TME,                              43890004
439000                 :TRIPST-STATUS-UID,                              43900004
439100                 :TRIPST-OPER-UNT-ID,                             43910004
439200                 :TRIPST-FCLTY-ID,                                43920004
439300                 :TRIPST-FCLTY-AREA-ID,                           43930004
439400                 :TRSTYP-PRTY-CDE                                 43940004
439500            FROM                                                  43950004
439600                  TTRIPST A,                                      43960004
439700                  TTRSTYP B                                       43970004
439800           WHERE  A.TRIP_ID          = :DK-TRIP-ID                43980004
439900             AND  A.TRIP_STATUS_CDE ^= 'DE'                       43990004
440000             AND  B.PRTY_CDE =                                    44000004
440100                  (SELECT MAX(D.PRTY_CDE)                         44010004
440200                     FROM TTRIPST C,                              44020004
440300                          TTRSTYP D                               44030004
440400                    WHERE C.TRIP_ID         = A.TRIP_ID           44040004
440500                      AND C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)  44050004
440600             AND  A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE           44060004
440700     END-EXEC.                                                    44070004
440800                                                                  44080004
440900     EVALUATE TRUE                                                44090004
441000         WHEN SQLCODE = +0                                        44100004
441100             CONTINUE                                             44110004
441200                                                                  44120004
441300         WHEN SQLCODE = -904                                      44130004
441400         WHEN SQLCODE = -913                                      44140004
441500              MOVE SQLCODE                TO PV-SOFT-SQLCODE      44150004
441600              MOVE '5600-SELECT-TTRIPST ' TO PV-SOFT-PARAGRAPH    44160004
441700              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          44170004
441800              MOVE DP020-USERID           TO PV-USER              44180004
441900              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    44190004
442000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    44200004
442100                                          TO PV-COMMAREA-LENGTH   44210004
442200              EXEC CICS                                           44220004
442300                   WRITEQ TD                                      44230004
442400                    QUEUE  ('CSSL')                               44240004
442500                     FROM  (PV-CICS-MSG-AREA2)                    44250004
442600                   LENGTH  (PV-COMMAREA-LENGTH)                   44260004
442700                     RESP  (PV-CICS-RESP)                         44270004
442800              END-EXEC                                            44280004
442900                                                                  44290004
443000              INITIALIZE PV-CICS-MSG-AREA2                        44300004
443100              MOVE DK-TRIP-ID      TO  PV-DISP-TRIP-ID            44310004
443200              STRING ' RCKCS261 -'                                44320004
443300                     ' TRIP ID:'       PV-DISP-TRIP-ID            44330004
443400                                       DELIMITED BY SIZE          44340004
443500                                  INTO PV-CICS-MSG-AREA2          44350004
443600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    44360004
443610                                    TO PV-COMMAREA-LENGTH         44361004
443620              EXEC CICS                                           44362004
443630                 WRITEQ TD                                        44363004
443640                  QUEUE  ('CSSL')                                 44364004
443650                   FROM  (PV-CICS-MSG-AREA2)                      44365004
443660                 LENGTH  (PV-COMMAREA-LENGTH)                     44366004
443670                   RESP  (PV-CICS-RESP)                           44367004
443680              END-EXEC                                            44368004
443690                                                                  44369004
443700              INITIALIZE PV-CICS-MSG-AREA2                        44370004
443800              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         44380004
443900              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             44390004
444000              PERFORM 9900-SOFT-ABORT                             44400004
444100                                                                  44410004
444200         WHEN SQLWARN0 NOT = SPACES                               44420004
444300         WHEN SQLCODE < +0                                        44430004
444400         WHEN SQLCODE > +0                                        44440004
444401              MOVE '5600-SELECT-TTRIPST'                          44440104
444402                                TO DP013-PARAGRAPH                44440204
444403              MOVE 'SELECT A ROW ON TTRIPST'                      44440304
444404                                TO DP013-MESSAGE-TEXT(1)          44440404
444405              MOVE SQLCA        TO DP013-SQLCA                    44440504
444406              MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)       44440604
444407              MOVE 'TTRSTYP'    TO DP013-DB2-TABLE-NAME (2)       44440704
444408              SET DP013-DB2-ABEND                                 44440804
444409                  DP013-XCTL-DISPLAY-RESTART TO TRUE              44440904
444410              PERFORM DP013-0000-PROCESS-ABEND                    44441004
444420     END-EVALUATE.                                                44442004
444430                                                                  44443004
444440                                                                  44444004
444450*----------------------------------------------------------------*44445004
444460*  INSERT A ROW ON THE VEHICLE TRIP STATUS TABLE                 *44446004
444470*----------------------------------------------------------------*44447004
444480 5700-INSERT-TTRIPST.                                             44448004
444490                                                                  44449004
444500     EXEC SQL                                                     44450004
444600          INSERT                                                  44460004
444700            INTO TTRIPST                                          44470004
444800                 (TRIP_ID,                                        44480004
444900                  TRIP_STATUS_CDE,                                44490004
445000                  STATUS_DTE,                                     44500004
445100                  STATUS_TME,                                     44510004
445200                  STATUS_UID,                                     44520004
445300                  OPER_UNT_ID,                                    44530004
445400                  FCLTY_ID,                                       44540004
445500                  FCLTY_AREA_ID)                                  44550004
445600          VALUES                                                  44560004
445700                 (:TRIPST-TRIP-ID,                                44570004
445800                  :TRIPST-TRIP-STATUS-CDE,                        44580004
445900                   CURRENT DATE,                                  44590004
446000                   CURRENT TIME,                                  44600004
446100                  :DP020-USERID,                                  44610004
446200                  :TRIPST-OPER-UNT-ID,                            44620004
446300                  :TRIPST-FCLTY-ID,                               44630004
446400                  :TRIPST-FCLTY-AREA-ID)                          44640004
446500     END-EXEC.                                                    44650004
446600                                                                  44660004
446700     EVALUATE TRUE                                                44670004
446800         WHEN SQLCODE = +0                                        44680004
446900              CONTINUE                                            44690004
447000                                                                  44700004
447100         WHEN SQLCODE = -904                                      44710004
447200         WHEN SQLCODE = -913                                      44720004
447300              MOVE SQLCODE                TO PV-SOFT-SQLCODE      44730004
447400              MOVE '5700-INSERT-TTRIPST ' TO PV-SOFT-PARAGRAPH    44740004
447500              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          44750004
447600              MOVE DP020-USERID           TO PV-USER              44760004
447700              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    44770004
447800              MOVE LENGTH OF PV-CICS-MSG-AREA2                    44780004
447900                                          TO PV-COMMAREA-LENGTH   44790004
448000              EXEC CICS                                           44800004
448100                   WRITEQ TD                                      44810004
448200                    QUEUE  ('CSSL')                               44820004
448300                     FROM  (PV-CICS-MSG-AREA2)                    44830004
448400                   LENGTH  (PV-COMMAREA-LENGTH)                   44840004
448500                     RESP  (PV-CICS-RESP)                         44850004
448600              END-EXEC                                            44860004
448700                                                                  44870004
448800              INITIALIZE PV-CICS-MSG-AREA2                        44880004
448900              MOVE TRIPST-TRIP-ID     TO  PV-DISP-TRIP-ID         44890004
449000              MOVE TRIPST-OPER-UNT-ID TO  PV-DISP-OPER-ID         44900004
449100              MOVE TRIPST-FCLTY-ID    TO  PV-DISP-FACILITY        44910004
449200              STRING ' RCKCS261 -'                                44920004
449300                     ' 5700-INSERT-TTRIPST- '                     44930004
449400                     ' TRIP ID - '                                44940004
449500                       PV-DISP-TRIP-ID                            44950004
449600                     ' TRIP STAT CDE - '                          44960004
449700                       TRIPST-TRIP-STATUS-CDE                     44970004
449800                     ' OPER ID - '                                44980004
449900                       PV-DISP-OPER-ID                            44990004
450000                     ' FACILITY - '                               45000004
450100                       PV-DISP-FACILITY                           45010004
450200                     ' FAC AREA - '                               45020004
450300                       TRIPST-FCLTY-AREA-ID    DELIMITED BY SIZE  45030004
450400                                          INTO PV-CICS-MSG-AREA2  45040004
450500              MOVE LENGTH OF PV-CICS-MSG-AREA2                    45050004
450600                                            TO PV-COMMAREA-LENGTH 45060004
450700              EXEC CICS                                           45070004
450800                   WRITEQ TD                                      45080004
450900                    QUEUE  ('CSSL')                               45090004
451000                     FROM  (PV-CICS-MSG-AREA2)                    45100004
451100                   LENGTH  (PV-COMMAREA-LENGTH)                   45110004
451200                      RESP  (PV-CICS-RESP)                        45120004
451300              END-EXEC                                            45130004
451400                                                                  45140004
451500              INITIALIZE PV-CICS-MSG-AREA2                        45150004
451600              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         45160004
451700              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             45170004
451800              PERFORM 9900-SOFT-ABORT                             45180004
451900                                                                  45190004
452000         WHEN SQLWARN0 NOT = SPACES                               45200004
452100         WHEN SQLCODE < +0                                        45210004
452200         WHEN SQLCODE > +0                                        45220004
452300              MOVE '5700-INSERT-TTRIPST'                          45230004
452400                                TO DP013-PARAGRAPH                45240004
452500              MOVE 'INSERT A ROW ON TTRIPST'                      45250004
452501                                TO DP013-MESSAGE-TEXT(1)          45250104
452502              MOVE SQLCA        TO DP013-SQLCA                    45250204
452503              MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)       45250304
452504              SET DP013-DB2-ABEND                                 45250404
452505                  DP013-XCTL-DISPLAY-RESTART TO TRUE              45250504
452506              PERFORM DP013-0000-PROCESS-ABEND                    45250604
452507     END-EVALUATE.                                                45250704
452508                                                                  45250804
452509                                                                  45250904
452510*----------------------------------------------------------------*45251004
452520* SELECT A VEHICLE                                               *45252004
452530*----------------------------------------------------------------*45253004
452540 5800-SELECT-TVEHICL.                                             45254004
452550                                                                  45255004
452560     EXEC SQL                                                     45256004
452570          SELECT CURR_STATUS_CDE                                  45257004
452580            INTO  :VEHICL-CURR-STATUS-CDE                         45258004
452590            FROM   TVEHICL A                                      45259004
452600            WHERE  A.VEH_NBR       = :ASC-KEY-VEH-NBR             45260004
452700              AND  A.OWNER_SCAC_ID = :ASC-KEY-ORIGIN-SCAC-ID      45270004
452800     END-EXEC.                                                    45280004
452900                                                                  45290004
453000     EVALUATE TRUE                                                45300004
453100         WHEN SQLCODE = +0                                        45310004
453200         WHEN SQLCODE = +100                                      45320004
453300              CONTINUE                                            45330004
453400                                                                  45340004
453500         WHEN SQLCODE = -904                                      45350004
453600         WHEN SQLCODE = -913                                      45360004
453700              MOVE SQLCODE                TO PV-SOFT-SQLCODE      45370004
453800              MOVE '5800-SELECT-TVEHICL ' TO PV-SOFT-PARAGRAPH    45380004
453900              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          45390004
454000              MOVE DP020-USERID           TO PV-USER              45400004
454100              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    45410004
454200              MOVE LENGTH OF PV-CICS-MSG-AREA2                    45420004
454300                                          TO PV-COMMAREA-LENGTH   45430004
454400              EXEC CICS                                           45440004
454500                   WRITEQ TD                                      45450004
454600                    QUEUE  ('CSSL')                               45460004
454700                     FROM  (PV-CICS-MSG-AREA2)                    45470004
454800                   LENGTH  (PV-COMMAREA-LENGTH)                   45480004
454900                     RESP  (PV-CICS-RESP)                         45490004
455000              END-EXEC                                            45500004
455100                                                                  45510004
455200              INITIALIZE PV-CICS-MSG-AREA2                        45520004
455300              STRING ' RCKCS261 -'                                45530004
455400                     ' 5800-SELECT-TVEHICL- '                     45540004
455500                     ' VEHICLE NBR - '                            45550004
455600                       ASC-KEY-VEH-NBR                            45560004
455700                     ' SCAC CODE - '                              45570004
455800                       ASC-KEY-ORIGIN-SCAC-ID  DELIMITED BY SIZE  45580004
455900                                         INTO PV-CICS-MSG-AREA2   45590004
456000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    45600004
456100                                           TO PV-COMMAREA-LENGTH  45610004
456200              EXEC CICS                                           45620004
456300                   WRITEQ TD                                      45630004
456400                    QUEUE  ('CSSL')                               45640004
456500                     FROM  (PV-CICS-MSG-AREA2)                    45650004
456600                   LENGTH  (PV-COMMAREA-LENGTH)                   45660004
456700                     RESP  (PV-CICS-RESP)                         45670004
456800              END-EXEC                                            45680004
456900                                                                  45690004
457000              INITIALIZE PV-CICS-MSG-AREA2                        45700004
457100              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         45710004
457200              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             45720004
457300              PERFORM 9900-SOFT-ABORT                             45730004
457400                                                                  45740004
457500         WHEN SQLWARN0 NOT = SPACES                               45750004
457600         WHEN SQLCODE < ZERO                                      45760004
457700         WHEN SQLCODE > ZERO                                      45770004
457800              MOVE '5800-SELECT-TVEHICL'                          45780004
457900                                TO DP013-PARAGRAPH                45790004
458000              MOVE 'SELECT ON TVEHICL'                            45800004
458100                                TO DP013-MESSAGE-TEXT (1)         45810004
458200              MOVE SQLCA        TO DP013-SQLCA                    45820004
458300              MOVE 'TVEHICL'    TO DP013-DB2-TABLE-NAME (1)       45830004
458400              SET DP013-DB2-ABEND                                 45840004
458500                  DP013-XCTL-DISPLAY-RESTART                      45850004
458510                                TO TRUE                           45851004
458511              PERFORM DP013-0000-PROCESS-ABEND                    45851104
458512     END-EVALUATE.                                                45851204
458513                                                                  45851304
458514                                                                  45851404
458515 5900-ADD-RECEIVER.                                               45851504
458516                                                                  45851604
458517     MOVE SHPTPO-PO-NBR      TO DK-PO-NBR.                        45851704
458518     MOVE ASC-KEY-OPER-UNT-ID-N                                   45851804
458519                             TO DK-OPER-UNT-ID.                   45851904
458520     MOVE ASC-KEY-FCLTY-ID-N                                      45852004
458530                             TO DK-FCLTY-ID.                      45853004
458540                                                                  45854004
458550     PERFORM 5905-GET-MAX-SEQ-NBR.                                45855004
458560     PERFORM 5910-GET-ENT-NAME-DESC.                              45856004
458570     INITIALIZE PV-DB2-COUNT.                                     45857004
458580     MOVE 4                  TO DK-AGRMT-TYP-ID.                  45858004
458590     MOVE 4                  TO DK-TYP-CDE.                       45859004
458600     PERFORM 5915-CHECK-PO-SERVICE-INFO.                          45860004
458700     IF PV-DB2-COUNT > +0                                         45870004
458800         MOVE 'Y'                   TO PV-PACK-BY-ST-IND          45880004
458900     ELSE                                                         45890004
459000         MOVE 'N'                   TO PV-PACK-BY-ST-IND          45900004
459100     END-IF.                                                      45910004
459200     INITIALIZE PV-DB2-COUNT.                                     45920004
459300     MOVE 4                  TO DK-AGRMT-TYP-ID.                  45930004
459400     MOVE 2                  TO DK-TYP-CDE.                       45940004
459500     PERFORM 5915-CHECK-PO-SERVICE-INFO.                          45950004
459600     IF PV-DB2-COUNT > +0                                         45960004
459700         MOVE 'Y'                   TO PV-GARM-ON-HNGR-IND        45970004
459800     ELSE                                                         45980004
459900         MOVE 'N'                   TO PV-GARM-ON-HNGR-IND        45990004
460000     END-IF.                                                      46000004
460100     INITIALIZE PV-DB2-COUNT.                                     46010004
460200     MOVE 4                  TO DK-AGRMT-TYP-ID.                  46020004
460300     MOVE 1                  TO DK-TYP-CDE.                       46030004
460400     PERFORM 5915-CHECK-PO-SERVICE-INFO.                          46040004
460500     IF PV-DB2-COUNT > +0                                         46050004
460600         MOVE 'Y'                   TO PV-PRE-TICKET-IND          46060004
460700     ELSE                                                         46070004
460800         MOVE 'N'                   TO PV-PRE-TICKET-IND          46080004
460900     END-IF.                                                      46090004
461000     PERFORM 5920-BUILD-RECEIVER-INFO.                            46100004
461100     IF  PS-NO-ERROR                                              46110004
461200         PERFORM 5965-BUILD-ZERO-LINE-WORK-ORD                    46120004
461300     END-IF.                                                      46130004
461400                                                                  46140004
461500     IF  PS-NO-ERROR                                              46150004
461600         IF TM500-NO-TROUBLE                                      46160004
461700             MOVE PC-TSYMSG-00391    TO DP020-MSG-NUMBER          46170004
461800             MOVE PV-REC-SEQ-NBR     TO DP020-MSG-TEXT            46180004
461900         ELSE                                                     46190004
462000             MOVE PC-TSYMSG-00847    TO DP020-MSG-NUMBER          46200004
462100             MOVE PV-REC-SEQ-NBR     TO DP020-MSG-TEXT            46210004
462200         END-IF                                                   46220004
462300         SET DP020-MSG-INFORMATIONAL                              46230004
462400                                 TO TRUE                          46240004
462500     END-IF.                                                      46250004
462600                                                                  46260004
462700*----------------------------------------------------------------*46270004
462800* GET THE NEXT HIGHEST RECEIVER SEQ NBR                          *46280004
462900*----------------------------------------------------------------*46290004
463000 5905-GET-MAX-SEQ-NBR.                                            46300004
463100                                                                  46310004
463200     EXEC SQL                                                     46320004
463300          SELECT  MAX(REC_SEQ_NBR)                                46330004
463400            INTO :RECEIV-REC-SEQ-NBR                              46340004
463500            FROM  TRECEIV                                         46350004
463600           WHERE  ORD_NBR = :DK-PO-NBR                            46360004
463700     END-EXEC.                                                    46370004
463800                                                                  46380004
463900     EVALUATE TRUE                                                46390004
464000         WHEN SQLCODE = +0                                        46400004
464100              MOVE RECEIV-REC-SEQ-NBR  TO PV-REC-SEQ-NBR          46410004
464200              ADD +1                   TO PV-REC-SEQ-NBR          46420004
464300                                                                  46430004
464400         WHEN SQLCODE = +100                                      46440004
464500         WHEN SQLCODE = -305                                      46450004
464600              MOVE +1                  TO PV-REC-SEQ-NBR          46460004
464700                                                                  46470004
464800         WHEN SQLCODE = -904                                      46480004
464900         WHEN SQLCODE = -913                                      46490004
465000              MOVE SQLCODE                TO PV-SOFT-SQLCODE      46500004
465100              MOVE '5905-GET-MAX-SEQ-NBR' TO PV-SOFT-PARAGRAPH    46510004
465200              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          46520004
465300              MOVE DP020-USERID           TO PV-USER              46530004
465400              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    46540004
465500              MOVE LENGTH OF PV-CICS-MSG-AREA2                    46550004
465600                                          TO PV-COMMAREA-LENGTH   46560004
465700              EXEC CICS                                           46570004
465800                   WRITEQ TD                                      46580004
465900                    QUEUE  ('CSSL')                               46590004
466000                     FROM  (PV-CICS-MSG-AREA2)                    46600004
466100                   LENGTH  (PV-COMMAREA-LENGTH)                   46610004
466200                     RESP  (PV-CICS-RESP)                         46620004
466300              END-EXEC                                            46630004
466400                                                                  46640004
466500              INITIALIZE PV-CICS-MSG-AREA2                        46650004
466600              MOVE DK-PO-NBR       TO  PV-DISP-PO                 46660004
466700              STRING ' RCKCS261 -'                                46670004
466800                     ' 5905-GET-MAX-SEQ-NBR '                     46680004
466900                     ' PO NBR - '                                 46690004
467000                       PV-DISP-PO             DELIMITED BY SIZE   46700004
467100                                         INTO PV-CICS-MSG-AREA2   46710004
467200              MOVE LENGTH OF PV-CICS-MSG-AREA2                    46720004
467300                                           TO PV-COMMAREA-LENGTH  46730004
467400              EXEC CICS                                           46740004
467500                   WRITEQ TD                                      46750004
467600                    QUEUE  ('CSSL')                               46760004
467700                     FROM  (PV-CICS-MSG-AREA2)                    46770004
467800                   LENGTH  (PV-COMMAREA-LENGTH)                   46780004
467900                     RESP  (PV-CICS-RESP)                         46790004
468000              END-EXEC                                            46800004
468100                                                                  46810004
468200              INITIALIZE PV-CICS-MSG-AREA2                        46820004
468300              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         46830004
468400              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             46840004
468500              PERFORM 9900-SOFT-ABORT                             46850004
468600                                                                  46860004
468700         WHEN SQLWARN0 NOT = SPACE                                46870004
468800         WHEN SQLCODE < +0                                        46880004
468900         WHEN SQLCODE > +0                                        46890004
469000              MOVE '5905-GET-MAX-SEQ-NBR  '                       46900004
469100                              TO DP013-PARAGRAPH                  46910004
469200              MOVE 'SELECT MAX ON RECEIPTS TABLE'                 46920004
469300                              TO DP013-MESSAGE-TEXT (1)           46930004
469400              MOVE SQLCA      TO DP013-SQLCA                      46940004
469500              MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)         46950004
469600              SET DP013-DB2-ABEND                                 46960004
469700                  DP013-XCTL-DISPLAY-RESTART                      46970004
469800                              TO TRUE                             46980004
469900              PERFORM DP013-0000-PROCESS-ABEND                    46990004
470000     END-EVALUATE.                                                47000004
470100                                                                  47010004
470200                                                                  47020004
470300*----------------------------------------------------------------*47030004
470400*  RETRIEVE THE PRIMARY VENDOR NAME                               47040004
470500*----------------------------------------------------------------*47050004
470600                                                                  47060004
470700 5910-GET-ENT-NAME-DESC.                                          47070004
470800                                                                  47080004
470900     EXEC SQL                                                     47090004
471000          SELECT  A.DEPT_NBR                                      47100004
471100                 ,A.VER_NBR                                       47110004
471200                 ,B.ENT_NAME_DESC                                 47120004
471300            INTO :PURCHS-DEPT-NBR                                 47130004
471400                ,:PURCHS-VER-NBR                                  47140004
471500                ,:ENTNME-ENT-NAME-DESC                            47150004
471600            FROM  TPURCHS A                                       47160004
471700                 ,TENTNME B                                       47170004
471800           WHERE  A.PO_NBR         = :DK-PO-NBR                   47180004
471900             AND  A.VER_STATUS_CDE = 'A'                          47190004
472000             AND  B.TYPE_CDE       = '01'                         47200004
472100             AND  A.ENT_ID         =  B.ENT_ID                    47210004
472200     END-EXEC.                                                    47220004
472300                                                                  47230004
472400     EVALUATE TRUE                                                47240004
472500         WHEN SQLCODE = +0                                        47250004
472600              MOVE PURCHS-VER-NBR    TO PV-VER-NBR                47260004
472700              MOVE PURCHS-DEPT-NBR   TO DK-DEPT-NBR               47270004
472800                                                                  47280004
472900         WHEN SQLCODE = +100                                      47290004
473000              MOVE +1                TO PV-VER-NBR                47300004
473100              MOVE SPACES            TO DK-DEPT-NBR               47310004
473200                                                                  47320004
473300         WHEN SQLCODE = -904                                      47330004
473400         WHEN SQLCODE = -913                                      47340004
473500              MOVE SQLCODE                  TO PV-SOFT-SQLCODE    47350004
473600              MOVE '5910-GET-ENT-NAME-DESC' TO PV-SOFT-PARAGRAPH  47360004
473700              MOVE ASC-KEY-OPER-UNT-ID-N    TO PV-LOCATION        47370004
473800              MOVE DP020-USERID             TO PV-USER            47380004
473900              MOVE PV-SOFT-ABORT-MSG        TO PV-CICS-MSG-AREA2  47390004
474000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    47400004
474100                                            TO PV-COMMAREA-LENGTH 47410004
474200              EXEC CICS                                           47420004
474300                   WRITEQ TD                                      47430004
474400                    QUEUE  ('CSSL')                               47440004
474500                     FROM  (PV-CICS-MSG-AREA2)                    47450004
474600                   LENGTH  (PV-COMMAREA-LENGTH)                   47460004
474700                     RESP  (PV-CICS-RESP)                         47470004
474800              END-EXEC                                            47480004
474900                                                                  47490004
475000              INITIALIZE PV-CICS-MSG-AREA2                        47500004
475100              MOVE DK-PO-NBR       TO  PV-DISP-PO                 47510004
475200              STRING ' RCKCS261 -'                                47520004
475300                   ' 5910-GET-ENT-NAME-DESC -'                    47530004
475400                     ' PO NBR - '                                 47540004
475500                       PV-DISP-PO              DELIMITED BY SIZE  47550004
475600                                          INTO PV-CICS-MSG-AREA2  47560004
475700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    47570004
475800                                            TO PV-COMMAREA-LENGTH 47580004
475900              EXEC CICS                                           47590004
476000                   WRITEQ TD                                      47600004
476100                    QUEUE  ('CSSL')                               47610004
476200                     FROM  (PV-CICS-MSG-AREA2)                    47620004
476300                   LENGTH  (PV-COMMAREA-LENGTH)                   47630004
476400                     RESP  (PV-CICS-RESP)                         47640004
476500              END-EXEC                                            47650004
476600                                                                  47660004
476700              INITIALIZE PV-CICS-MSG-AREA2                        47670004
476800              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         47680004
476900              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             47690004
477000              PERFORM 9900-SOFT-ABORT                             47700004
477100                                                                  47710004
477200         WHEN SQLWARN0 NOT = SPACES                               47720004
477300         WHEN SQLCODE < +0                                        47730004
477400         WHEN SQLCODE > +0                                        47740004
477500              MOVE '5910-GET-ENT-NAME-DESC'                       47750004
477600                              TO DP013-PARAGRAPH                  47760004
477601              MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'          47760104
477602                              TO DP013-MESSAGE-TEXT (1)           47760204
477603              MOVE SQLCA      TO DP013-SQLCA                      47760304
477604              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)         47760404
477605              SET DP013-DB2-ABEND                                 47760504
477606                  DP013-XCTL-DISPLAY-RESTART                      47760604
477607                              TO TRUE                             47760704
477608              PERFORM DP013-0000-PROCESS-ABEND                    47760804
477609     END-EVALUATE.                                                47760904
477610                                                                  47761004
477620                                                                  47762004
477630*----------------------------------------------------------------*47763004
477640*    CHECK TO SEE WHAT TYPES OF SERVICES THIS PO HAS             *47764004
477650*----------------------------------------------------------------*47765004
477660 5915-CHECK-PO-SERVICE-INFO.                                      47766004
477670                                                                  47767004
477680     EXEC SQL                                                     47768004
477690          SELECT COUNT(*)                                         47769004
477700            INTO :PV-DB2-COUNT                                    47770004
477800            FROM TPOAGMT                                          47780004
477900           WHERE PO_NBR         = :DK-PO-NBR                      47790004
478000             AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID                47800004
478100             AND VER_STATUS_CDE = 'A'                             47810004
478200             AND TYP_CDE        = :DK-TYP-CDE                     47820004
478300     END-EXEC.                                                    47830004
478400                                                                  47840004
478500     EVALUATE TRUE                                                47850004
478600         WHEN SQLCODE = +0                                        47860004
478700         WHEN SQLCODE = +100                                      47870004
478800              CONTINUE                                            47880004
478900                                                                  47890004
479000         WHEN SQLCODE = -904                                      47900004
479100         WHEN SQLCODE = -913                                      47910004
479200              MOVE SQLCODE               TO PV-SOFT-SQLCODE       47920004
479300              MOVE '5915-CHECK-PO-SERVICE-INFO'                   47930004
479400                                         TO PV-SOFT-PARAGRAPH     47940004
479500              MOVE ASC-KEY-OPER-UNT-ID-N TO PV-LOCATION           47950004
479600              MOVE DP020-USERID          TO PV-USER               47960004
479700              MOVE PV-SOFT-ABORT-MSG     TO PV-CICS-MSG-AREA2     47970004
479800              MOVE LENGTH OF PV-CICS-MSG-AREA2                    47980004
479900                                         TO PV-COMMAREA-LENGTH    47990004
480000              EXEC CICS                                           48000004
480100                   WRITEQ TD                                      48010004
480200                    QUEUE  ('CSSL')                               48020004
480300                     FROM  (PV-CICS-MSG-AREA2)                    48030004
480400                   LENGTH  (PV-COMMAREA-LENGTH)                   48040004
480500                     RESP  (PV-CICS-RESP)                         48050004
480600              END-EXEC                                            48060004
480700                                                                  48070004
480800              INITIALIZE PV-CICS-MSG-AREA2                        48080004
480900              MOVE DK-PO-NBR       TO  PV-DISP-PO                 48090004
481000              MOVE DK-TYP-CDE      TO  PV-DISP-TYPE-CD            48100004
481100              STRING ' RCKCS261 -'                                48110004
481200               ' 5915-CHECK-PO-SERVICE-INFO- '                    48120004
481300                     ' PO NBR - '                                 48130004
481400                       PV-DISP-PO                                 48140004
481500                     ' AGREEMENT TYPE ID - '                      48150004
481600                       DK-AGRMT-TYP-ID                            48160004
481700                     ' TYPE CD - '                                48170004
481800                       PV-DISP-TYPE-CD         DELIMITED BY SIZE  48180004
481900                                          INTO PV-CICS-MSG-AREA2  48190004
482000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    48200004
482100                                            TO PV-COMMAREA-LENGTH 48210004
482200              EXEC CICS                                           48220004
482300                   WRITEQ TD                                      48230004
482400                    QUEUE  ('CSSL')                               48240004
482500                     FROM  (PV-CICS-MSG-AREA2)                    48250004
482600                   LENGTH  (PV-COMMAREA-LENGTH)                   48260004
482700                     RESP  (PV-CICS-RESP)                         48270004
482800              END-EXEC                                            48280004
482900                                                                  48290004
483000              INITIALIZE PV-CICS-MSG-AREA2                        48300004
483100              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         48310004
483200              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             48320004
483300              PERFORM 9900-SOFT-ABORT                             48330004
483400                                                                  48340004
483500         WHEN SQLWARN0 NOT = SPACES                               48350004
483600         WHEN SQLCODE < +0                                        48360004
483700         WHEN SQLCODE > +0                                        48370004
483701              MOVE '5915-CHECK-PO-SERVICE-INFO'                   48370104
483702                              TO DP013-PARAGRAPH                  48370204
483703              MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'       48370304
483704                              TO DP013-MESSAGE-TEXT (1)           48370404
483705              MOVE SQLCA      TO DP013-SQLCA                      48370504
483706              MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)         48370604
483707              SET DP013-DB2-ABEND                                 48370704
483708                  DP013-XCTL-DISPLAY-RESTART                      48370804
483709                              TO TRUE                             48370904
483710              PERFORM DP013-0000-PROCESS-ABEND                    48371004
483720     END-EVALUATE.                                                48372004
483730                                                                  48373004
483740                                                                  48374004
483750 5920-BUILD-RECEIVER-INFO.                                        48375004
483760                                                                  48376004
483770     INITIALIZE DCLTRECEIV.                                       48377004
483780                                                                  48378004
483790     MOVE SHPTPO-PO-NBR          TO RECEIV-ORD-NBR.               48379004
483800     MOVE PV-REC-SEQ-NBR         TO RECEIV-REC-SEQ-NBR            48380004
483900                                    RECEIV-REFER-BACK-SEQ-NBR.    48390004
484000     MOVE PV-VER-NBR             TO RECEIV-PO-VER-NBR.            48400004
484100     MOVE ASC-KEY-OPER-UNT-ID-N  TO RECEIV-OPER-UNT-ID.           48410004
484200     MOVE ASC-KEY-FCLTY-ID-N     TO RECEIV-FCLTY-ID.              48420004
484300     MOVE 'IP'                   TO RECEIV-STATUS-CDE.            48430004
484400     MOVE 'I'                    TO RECEIV-SYST-CRE-CDE.          48440004
484500     MOVE 'MR'                   TO RECEIV-REC-TYP-CDE.           48450004
484600     MOVE 'A'                    TO RECEIV-VER-STATUS-CDE.        48460004
484700     MOVE PV-PACK-BY-ST-IND      TO RECEIV-PACK-BY-ST-IND.        48470004
484800     MOVE PV-GARM-ON-HNGR-IND    TO RECEIV-GOH-IND.               48480004
484900     MOVE SHPTPO-EXPTED-CART-CNT TO RECEIV-EXPTED-CART-CNT.       48490004
485000     MOVE ZERO                   TO RECEIV-ACTL-CART-CNT.         48500004
485100     MOVE '9999-09-09'           TO RECEIV-AP-PRC-DTE.            48510004
485200     MOVE '9999-09-09-09.09.09.999999'                            48520004
485300                                 TO RECEIV-ML-POST-TMST           48530004
485400                                    RECEIV-FS-POST-TMST           48540004
485500                                    RECEIV-IN-TRBL-TMST           48550004
485600                                    RECEIV-VERFYD-TMST            48560004
485700                                    RECEIV-REC-TMST.              48570004
485800     MOVE ASC-KEY-TRIP-ID        TO DK-TRIP-ID.                   48580004
485900     PERFORM 5600-SELECT-TTRIPST.                                 48590004
486000     IF TRSTYP-PRTY-CDE > PC-49                                   48600004
486100         STRING TRIPST-STATUS-DTE DELIMITED BY SIZE,              48610004
486200                '-' DELIMITED BY SIZE,                            48620004
486300                TRIPST-STATUS-TME DELIMITED BY SIZE,              48630004
486400                '.000000' DELIMITED BY SIZE                       48640004
486500                INTO                RECEIV-REC-TMST               48650004
486600     END-IF.                                                      48660004
486700                                                                  48670004
486800     MOVE DP020-LOCATION-NBR      TO RECEIV-CURR-OPER-UNT-ID.     48680004
486900     MOVE ASC-KEY-OPER-UNT-ID-N   TO RECEIV-CRE-OPER-UNT-ID.      48690004
487000     MOVE DP020-FCLTY-ID          TO RECEIV-CURR-FCLTY-ID.        48700004
487100     MOVE ASC-KEY-FCLTY-ID-N      TO RECEIV-CRE-FCLTY-ID.         48710004
487200     MOVE DP020-USERID            TO RECEIV-UPD-UID.              48720004
487300     MOVE PC-CURRENT-PROGRAM-NAME TO RECEIV-UPD-PGM-ID.           48730004
487400                                                                  48740004
487500     MOVE PV-PRE-TICKET-IND      TO RECEIV-PRE-TKT-IND.           48750004
487600     MOVE SPACES                 TO RECEIV-RCVG-CLERK-INIT-ID.    48760004
487700                                                                  48770004
487800     SET PS-RCVR-FOUND TO TRUE.                                   48780004
487900     PERFORM VARYING PV-COUNT FROM 1 BY 1 UNTIL                   48790004
488000          PV-COUNT > 10 OR PS-NO-RCVR-FOUND                       48800004
488100         SET PS-NOT-EOF-TRECVER-CSR TO TRUE                       48810004
488200         PERFORM 5935-OPEN-TRECVER-CSR                            48820004
488300         PERFORM 5940-FETCH-TRECVER-CSR                           48830004
488400                                                                  48840004
488500         MOVE RECVER-MAX-RCVR-NBR  TO PW-CONTROL-PANL-NBR-9       48850004
488600         DIVIDE PW-CONTROL-PANL-NBR-9 BY 9 GIVING PW-QUOTIENT     48860004
488700                                       REMAINDER  PW-REMAINDER    48870004
488800         COMPUTE PW-CONTROL-CEHCK-DIG = ( 9 - PW-REMAINDER )      48880004
488900         COMPUTE RECEIV-RCVR-NBR = PW-CONTROL-KEYREC-9 * 1        48890004
489000         ADD +1                    TO RECVER-MAX-RCVR-NBR         48900004
489100         PERFORM 5945-DELETE-TRECVER-CSR                          48910004
489200         PERFORM 5950-INSERT-TRECVER                              48920004
489300         PERFORM 5955-CLOSE-TRECVER-CSR                           48930004
489400                                                                  48940004
489500         MOVE RECEIV-RCVR-NBR          TO DK-RCVR-NBR             48950004
489600                                                                  48960004
489700         INITIALIZE PV-DB2-COUNT                                  48970004
489800         PERFORM 5925-CHECK-DUPL-RCVR-NBR                         48980004
489900     END-PERFORM.                                                 48990004
490000     IF PS-RCVR-FOUND                                             49000004
490100         SET PS-ERROR                                             49010004
490200         DP020-MSG-FATAL       TO TRUE                            49020004
490300         MOVE PC-TSYMSG-00117  TO DP020-MSG-NUMBER                49030004
490400         SET DP030-SET-CURSOR-TRAILER                             49040004
490500                               TO TRUE                            49050004
490600     END-IF.                                                      49060004
490700                                                                  49070004
490800     PERFORM 5928-GET-PKGNG-CDE.                                  49080004
490900                                                                  49090004
491000     IF  PS-NO-ERROR                                              49100004
491100         PERFORM 5930-INSERT-TRECEIV                              49110004
491200         IF SQLCODE = ZERO                                        49120004
491300             PERFORM 5931-INSERT-TPOSYNC                          49130004
491400         END-IF                                                   49140004
491500         PERFORM 5960-CHECK-FOR-TROUBLE                           49150004
491600     END-IF.                                                      49160004
491700                                                                  49170004
491800/                                                                 49180004
491900*----------------------------------------------------------------*49190004
492000*    CHECK TO SEE IF RCVR NBR IS UNIQUE                          *49200004
492100*----------------------------------------------------------------*49210004
492200 5925-CHECK-DUPL-RCVR-NBR.                                        49220004
492300                                                                  49230004
492400     EXEC SQL                                                     49240004
492500          SELECT COUNT(*)                                         49250004
492600            INTO :PV-DB2-COUNT                                    49260004
492700            FROM TRECEIV                                          49270004
492800           WHERE RCVR_NBR = :DK-RCVR-NBR                          49280004
492900     END-EXEC.                                                    49290004
493000                                                                  49300004
493100     EVALUATE TRUE                                                49310004
493200         WHEN SQLCODE = +0                                        49320004
493300         WHEN SQLCODE = +100                                      49330004
493400              CONTINUE                                            49340004
493500                                                                  49350004
493600         WHEN SQLCODE = -904                                      49360004
493700         WHEN SQLCODE = -913                                      49370004
493800              MOVE SQLCODE                TO PV-SOFT-SQLCODE      49380004
493900              MOVE '5925-CHECK-DUPL-RCVR-NBR'                     49390004
494000                                          TO PV-SOFT-PARAGRAPH    49400004
494100              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          49410004
494200              MOVE DP020-USERID           TO PV-USER              49420004
494300              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    49430004
494400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    49440004
494500                                          TO PV-COMMAREA-LENGTH   49450004
494600              EXEC CICS                                           49460004
494700                   WRITEQ TD                                      49470004
494800                    QUEUE  ('CSSL')                               49480004
494900                     FROM  (PV-CICS-MSG-AREA2)                    49490004
495000                   LENGTH  (PV-COMMAREA-LENGTH)                   49500004
495100                     RESP  (PV-CICS-RESP)                         49510004
495200              END-EXEC                                            49520004
495300                                                                  49530004
495400              INITIALIZE PV-CICS-MSG-AREA2                        49540004
495500              MOVE DK-RCVR-NBR     TO  PV-DISP-RCVR               49550004
495600              STRING ' RCKCS261 -'                                49560004
495700                     ' 5925-CHECK-DUPL-RCVR-NBR - '               49570004
495800                     ' RCVR NBR - '                               49580004
495900                       PV-DISP-RCVR         DELIMITED BY SIZE     49590004
496000                                       INTO PV-CICS-MSG-AREA2     49600004
496100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    49610004
496200                                         TO PV-COMMAREA-LENGTH    49620004
496300              EXEC CICS                                           49630004
496400                   WRITEQ TD                                      49640004
496500                    QUEUE  ('CSSL')                               49650004
496600                     FROM  (PV-CICS-MSG-AREA2)                    49660004
496700                   LENGTH  (PV-COMMAREA-LENGTH)                   49670004
496800                     RESP  (PV-CICS-RESP)                         49680004
496900              END-EXEC                                            49690004
497000                                                                  49700004
497100              INITIALIZE PV-CICS-MSG-AREA2                        49710004
497200              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         49720004
497300              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             49730004
497400              PERFORM 9900-SOFT-ABORT                             49740004
497500                                                                  49750004
497600         WHEN SQLWARN0 NOT = SPACES                               49760004
497601         WHEN SQLCODE < +0                                        49760104
497602         WHEN SQLCODE > +0                                        49760204
497603              MOVE '5925-CHECK-DUPL-RCVR-NBR  '                   49760304
497604                              TO DP013-PARAGRAPH                  49760404
497605              MOVE 'UNSUCCESSFUL SELECT RCVR NBR '                49760504
497606                              TO DP013-MESSAGE-TEXT (1)           49760604
497607              MOVE SQLCA      TO DP013-SQLCA                      49760704
497608              MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)         49760804
497609              SET DP013-DB2-ABEND                                 49760904
497610                  DP013-XCTL-DISPLAY-RESTART                      49761004
497620                              TO TRUE                             49762004
497630              PERFORM DP013-0000-PROCESS-ABEND                    49763004
497640     END-EVALUATE.                                                49764004
497650                                                                  49765004
497660     IF SQLCODE = +0 AND                                          49766004
497670        PV-DB2-COUNT = +0                                         49767004
497680         SET PS-NO-RCVR-FOUND TO TRUE                             49768004
497690     END-IF.                                                      49769004
497700                                                                  49770004
497800                                                                  49780004
497900 5928-GET-PKGNG-CDE.                                              49790004
498000                                                                  49800004
498100     EXEC SQL                                                     49810004
498200          SELECT PKGNG_CDE                                        49820004
498300            INTO :PURCHS-PKGNG-CDE                                49830004
498400            FROM TPURCHS A                                        49840004
498500           WHERE PO_NBR         = :DK-PO-NBR                      49850004
498600             AND VER_STATUS_CDE = 'A'                             49860004
498700     END-EXEC.                                                    49870004
498800                                                                  49880004
498900     EVALUATE TRUE                                                49890004
499000         WHEN SQLCODE = +0                                        49900004
499100              MOVE PURCHS-PKGNG-CDE TO RECEIV-PKGNG-CDE           49910004
499200                                                                  49920004
499300         WHEN SQLCODE = +100                                      49930004
499400              CONTINUE                                            49940004
499500                                                                  49950004
499600         WHEN SQLCODE = -904                                      49960004
499700         WHEN SQLCODE = -913                                      49970004
499800              MOVE SQLCODE                TO PV-SOFT-SQLCODE      49980004
499900              MOVE '5928-GET-PKGNG-CDE  ' TO PV-SOFT-PARAGRAPH    49990004
500000              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          50000004
500100              MOVE DP020-USERID           TO PV-USER              50010004
500200              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    50020004
500300              MOVE LENGTH OF PV-CICS-MSG-AREA2                    50030004
500400                                          TO PV-COMMAREA-LENGTH   50040004
500500              EXEC CICS                                           50050004
500600                   WRITEQ TD                                      50060004
500700                    QUEUE  ('CSSL')                               50070004
500800                     FROM  (PV-CICS-MSG-AREA2)                    50080004
500900                   LENGTH  (PV-COMMAREA-LENGTH)                   50090004
501000                     RESP  (PV-CICS-RESP)                         50100004
501100              END-EXEC                                            50110004
501200                                                                  50120004
501300              INITIALIZE PV-CICS-MSG-AREA2                        50130004
501400              MOVE DK-PO-NBR       TO  PV-DISP-PO                 50140004
501500              STRING ' RCKCS261 -'                                50150004
501600                   ' 5928-GET-PKGNG-CDE - '                       50160004
501700                     ' PO NBR - '                                 50170004
501800                       PV-DISP-PO              DELIMITED BY SIZE  50180004
501900                                          INTO PV-CICS-MSG-AREA2  50190004
502000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    50200004
502100                                            TO PV-COMMAREA-LENGTH 50210004
502200              EXEC CICS                                           50220004
502300                 WRITEQ TD                                        50230004
502400                  QUEUE  ('CSSL')                                 50240004
502500                   FROM  (PV-CICS-MSG-AREA2)                      50250004
502600                 LENGTH  (PV-COMMAREA-LENGTH)                     50260004
502700                   RESP  (PV-CICS-RESP)                           50270004
502800              END-EXEC                                            50280004
502900                                                                  50290004
503000              INITIALIZE PV-CICS-MSG-AREA2                        50300004
503100              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         50310004
503200              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             50320004
503300              PERFORM 9900-SOFT-ABORT                             50330004
503400                                                                  50340004
503500         WHEN SQLWARN0 NOT = SPACES                               50350004
503600         WHEN SQLCODE < +0                                        50360004
503700         WHEN SQLCODE > +0                                        50370004
503701              MOVE '5928-GET-PKGNG-CDE'                           50370104
503702                              TO DP013-PARAGRAPH                  50370204
503703             MOVE 'UNSUCCESSFUL SELECT PKGNG-CDE'                 50370304
503704                              TO DP013-MESSAGE-TEXT (1)           50370404
503705              MOVE SQLCA      TO DP013-SQLCA                      50370504
503706              MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)         50370604
503707              SET DP013-DB2-ABEND                                 50370704
503708                  DP013-XCTL-DISPLAY-RESTART                      50370804
503709                              TO TRUE                             50370904
503710              PERFORM DP013-0000-PROCESS-ABEND                    50371004
503720     END-EVALUATE.                                                50372004
503730                                                                  50373004
503740                                                                  50374004
503750 5930-INSERT-TRECEIV.                                             50375004
503760                                                                  50376004
503770     EXEC SQL                                                     50377004
503780          INSERT                                                  50378004
503790            INTO TRECEIV                                          50379004
503800                 ( ORD_NBR                                        50380004
503900                  ,REC_SEQ_NBR                                    50390004
504000                  ,CRE_TMST                                       50400004
504100                  ,CRE_UID                                        50410004
504200                  ,PO_VER_NBR                                     50420004
504300                  ,OPER_UNT_ID                                    50430004
504400                  ,FCLTY_ID                                       50440004
504500                  ,STATUS_CDE                                     50450004
504600                  ,SYST_CRE_CDE                                   50460004
504700                  ,REC_TYP_CDE                                    50470004
504800                  ,VER_STATUS_CDE                                 50480004
504900                  ,PACK_BY_ST_IND                                 50490004
505000                  ,REC_TMST                                       50500004
505100                  ,EXPTED_CART_CNT                                50510004
505200                  ,ACTL_CART_CNT                                  50520004
505300                  ,EXPTED_ITM_QTY                                 50530004
505400                  ,ACTL_ITM_QTY                                   50540004
505500                  ,RCVR_NBR                                       50550004
505600                  ,ML_POST_TMST                                   50560004
505700                  ,FS_POST_TMST                                   50570004
505800                  ,PRE_TKT_IND                                    50580004
505900                  ,AD_INFO_DESC                                   50590004
506000                  ,IN_TRBL_TMST                                   50600004
506100                  ,IN_TRBL_MIN_CNT                                50610004
506200                  ,IN_TRBL_HOUR_CNT                               50620004
506300                  ,VERFYD_TMST                                    50630004
506400                  ,RCVG_CLERK_INIT_ID                             50640004
506500                  ,REFER_BACK_SEQ_NBR                             50650004
506600                  ,AP_PRC_CDE                                     50660004
506700                  ,AP_PRC_DTE                                     50670004
506800                  ,MIS_DIRECT_IND                                 50680004
506900                  ,IMPRT_IND                                      50690004
507000                  ,CRE_OPER_UNT_ID                                50700004
507100                  ,CRE_FCLTY_ID                                   50710004
507200                  ,CURR_OPER_UNT_ID                               50720004
507300                  ,CURR_FCLTY_ID                                  50730004
507400                  ,UPD_TMST                                       50740004
507500                  ,UPD_UID                                        50750004
507600                  ,UPD_PGM_ID                                     50760004
507700                  ,GOH_IND                                        50770004
507800                  ,MKNG_APRN_PRT_TMST                             50780004
507900                  ,AP_RVRSL_DTE                                   50790004
508000                  ,PKGNG_CDE                                      50800004
508100                 )                                                50810004
508200          VALUES ( :RECEIV-ORD-NBR                                50820004
508300                  ,:RECEIV-REC-SEQ-NBR                            50830004
508400                  , CURRENT TIMESTAMP                             50840004
508500                  ,:DP020-USERID                                  50850004
508600                  ,:RECEIV-PO-VER-NBR                             50860004
508700                  ,:RECEIV-OPER-UNT-ID                            50870004
508800                  ,:RECEIV-FCLTY-ID                               50880004
508900                  ,:RECEIV-STATUS-CDE                             50890004
509000                  ,:RECEIV-SYST-CRE-CDE                           50900004
509100                  ,:RECEIV-REC-TYP-CDE                            50910004
509200                  ,:RECEIV-VER-STATUS-CDE                         50920004
509300                  ,:RECEIV-PACK-BY-ST-IND                         50930004
509400                  ,:RECEIV-REC-TMST                               50940004
509500                  ,:RECEIV-EXPTED-CART-CNT                        50950004
509600                  ,:RECEIV-ACTL-CART-CNT                          50960004
509700                  ,:RECEIV-EXPTED-ITM-QTY                         50970004
509800                  ,:RECEIV-ACTL-ITM-QTY                           50980004
509900                  ,:RECEIV-RCVR-NBR                               50990004
510000                  ,:RECEIV-ML-POST-TMST                           51000004
510100                  ,:RECEIV-FS-POST-TMST                           51010004
510200                  ,:RECEIV-PRE-TKT-IND                            51020004
510300                  ,:RECEIV-AD-INFO-DESC                           51030004
510400                  ,:RECEIV-IN-TRBL-TMST                           51040004
510500                  ,:RECEIV-IN-TRBL-MIN-CNT                        51050004
510600                  ,:RECEIV-IN-TRBL-HOUR-CNT                       51060004
510700                  ,:RECEIV-VERFYD-TMST                            51070004
510800                  ,:RECEIV-RCVG-CLERK-INIT-ID                     51080004
510900                  ,:RECEIV-REFER-BACK-SEQ-NBR                     51090004
511000                  ,:RECEIV-AP-PRC-CDE                             51100004
511100                  ,:RECEIV-AP-PRC-DTE                             51110004
511200                  ,:RECEIV-MIS-DIRECT-IND                         51120004
511300                  ,:RECEIV-IMPRT-IND                              51130004
511400                  ,:RECEIV-CRE-OPER-UNT-ID                        51140004
511500                  ,:RECEIV-CRE-FCLTY-ID                           51150004
511600                  ,:RECEIV-CURR-OPER-UNT-ID                       51160004
511700                  ,:RECEIV-CURR-FCLTY-ID                          51170004
511800                  , CURRENT TIMESTAMP                             51180004
511900                  ,:RECEIV-UPD-UID                                51190004
512000                  ,:RECEIV-UPD-PGM-ID                             51200004
512100                  ,:RECEIV-GOH-IND                                51210004
512200                  ,:PC-DEFAULT-TMST-9S                            51220004
512300                  ,:PC-DEFAULT-9DATE                              51230004
512400                  ,:RECEIV-PKGNG-CDE                              51240004
512500                 )                                                51250004
512600     END-EXEC.                                                    51260004
512700                                                                  51270004
512800     EVALUATE TRUE                                                51280004
512900         WHEN SQLCODE = +0                                        51290004
513000              CONTINUE                                            51300004
513100                                                                  51310004
513200         WHEN SQLCODE = -904                                      51320004
513300         WHEN SQLCODE = -913                                      51330004
513400              MOVE SQLCODE                TO PV-SOFT-SQLCODE      51340004
513500              MOVE '5930-INSERT-TRECEIV ' TO PV-SOFT-PARAGRAPH    51350004
513600              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          51360004
513700              MOVE DP020-USERID           TO PV-USER              51370004
513800              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    51380004
513900              MOVE LENGTH OF PV-CICS-MSG-AREA2                    51390004
514000                                          TO PV-COMMAREA-LENGTH   51400004
514100              EXEC CICS                                           51410004
514200                    WRITEQ TD                                     51420004
514300                     QUEUE  ('CSSL')                              51430004
514400                      FROM  (PV-CICS-MSG-AREA2)                   51440004
514500                    LENGTH  (PV-COMMAREA-LENGTH)                  51450004
514600                      RESP  (PV-CICS-RESP)                        51460004
514700              END-EXEC                                            51470004
514800                                                                  51480004
514900              INITIALIZE PV-CICS-MSG-AREA2                        51490004
515000              MOVE RECEIV-REC-SEQ-NBR  TO  PV-DISP-RCVR           51500004
515100              MOVE RECEIV-ORD-NBR      TO  PV-DISP-PO             51510004
515200              MOVE RECEIV-PO-VER-NBR   TO  PV-DISP-PO-VERSION     51520004
515300              MOVE RECEIV-OPER-UNT-ID  TO  PV-DISP-OPER-ID        51530004
515400              MOVE RECEIV-FCLTY-ID     TO  PV-DISP-FACILITY       51540004
515500              STRING ' RCKCS261 -'                                51550004
515600                     ' RCVR:'              PV-DISP-OPER-ID        51560004
515700                                           PV-DISP-PO             51570004
515800                       '-'                 PV-DISP-RCVR           51580004
515900                       '   PBS:'           RECEIV-PACK-BY-ST-IND  51590004
516000                       '   PKGNG:'         RECEIV-PKGNG-CDE       51600004
516100                                           DELIMITED BY SIZE      51610004
516200                                      INTO PV-CICS-MSG-AREA2      51620004
516300              MOVE LENGTH OF PV-CICS-MSG-AREA2                    51630004
516400                                        TO PV-COMMAREA-LENGTH     51640004
516500              EXEC CICS                                           51650004
516600                   WRITEQ TD                                      51660004
516700                    QUEUE  ('CSSL')                               51670004
516800                     FROM  (PV-CICS-MSG-AREA2)                    51680004
516900                   LENGTH  (PV-COMMAREA-LENGTH)                   51690004
517000                     RESP  (PV-CICS-RESP)                         51700004
517100              END-EXEC                                            51710004
517200                                                                  51720004
517300              INITIALIZE PV-CICS-MSG-AREA2                        51730004
517400              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         51740004
517500              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             51750004
517600              PERFORM 9900-SOFT-ABORT                             51760004
517700                                                                  51770004
517800         WHEN SQLWARN0 NOT = SPACE                                51780004
517900         WHEN SQLCODE < +0                                        51790004
518000         WHEN SQLCODE > +0                                        51800004
518100              MOVE '5930-INSERT-TRECEIV'                          51810004
518200                              TO DP013-PARAGRAPH                  51820004
518300              MOVE 'INSERT ON RECEIPTS TABLE'                     51830004
518400                              TO DP013-MESSAGE-TEXT (1)           51840004
518500             MOVE SQLCA      TO DP013-SQLCA                       51850004
518600             MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)          51860004
518610             SET DP013-DB2-ABEND                                  51861004
518611                 DP013-XCTL-DISPLAY-RESTART                       51861104
518612                             TO TRUE                              51861204
518613             PERFORM DP013-0000-PROCESS-ABEND                     51861304
518614     END-EVALUATE.                                                51861404
518615                                                                  51861504
518616                                                                  51861604
518617 5931-INSERT-TPOSYNC.                                             51861704
518618     EXEC SQL                                                     51861804
518619         INSERT INTO TPOSYNC                                      51861904
518620           ( PO_NBR                                               51862004
518630            ,LAST_SYNC_TMST                                       51863004
518640            ,SYNC_STAT_CDE                                        51864004
518650           )                                                      51865004
518660         VALUES                                                   51866004
518670           ( :RECEIV-ORD-NBR                                      51867004
518680           , CURRENT TIMESTAMP                                    51868004
518690           , 'N'                                                  51869004
518700           )                                                      51870004
518800     END-EXEC                                                     51880004
518900                                                                  51890004
519000     EVALUATE TRUE                                                51900004
519100         WHEN SQLCODE = ZERO                                      51910004
519200         WHEN SQLCODE = -803                                      51920004
519300                 CONTINUE                                         51930004
519400         WHEN SQLCODE = -904                                      51940004
519500         WHEN SQLCODE = -913                                      51950004
519600         WHEN SQLCODE = -911                                      51960004
519700             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    51970004
519800             MOVE '5931-INSERT-TPOSYNC '    TO PV-SOFT-PARAGRAPH  51980004
519900             MOVE ASC-KEY-OPER-UNT-ID-N     TO PV-LOCATION        51990004
520000             MOVE DP020-USERID              TO PV-USER            52000004
520100             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  52010004
520200             MOVE LENGTH OF PV-CICS-MSG-AREA2                     52020004
520300               TO PV-COMMAREA-LENGTH                              52030004
520400             EXEC CICS                                            52040004
520500                  WRITEQ TD                                       52050004
520600                   QUEUE  ('CSSL')                                52060004
520700                    FROM  (PV-CICS-MSG-AREA2)                     52070004
520800                  LENGTH  (PV-COMMAREA-LENGTH)                    52080004
520900                    RESP  (PV-CICS-RESP)                          52090004
521000             END-EXEC                                             52100004
521100             INITIALIZE PV-CICS-MSG-AREA2                         52110004
521200               MOVE RECEIV-ORD-NBR  TO  PV-DISP-PO                52120004
521300               STRING ' RCKCS261 -'             DELIMITED BY SIZE 52130004
521400                    ' 5931-INSERT-TPOSYNC -'    DELIMITED BY SIZE 52140004
521500                      ' PO NBR - '              DELIMITED BY SIZE 52150004
521600                        PV-DISP-PO              DELIMITED BY SIZE 52160004
521700                                           INTO PV-CICS-MSG-AREA2 52170004
521800               MOVE LENGTH OF PV-CICS-MSG-AREA2                   52180004
521900                    TO PV-COMMAREA-LENGTH                         52190004
522000               EXEC CICS                                          52200004
522100                  WRITEQ TD                                       52210004
522200                   QUEUE  ('CSSL')                                52220004
522300                    FROM  (PV-CICS-MSG-AREA2)                     52230004
522400                  LENGTH  (PV-COMMAREA-LENGTH)                    52240004
522500                    RESP  (PV-CICS-RESP)                          52250004
522600               END-EXEC                                           52260004
522700             INITIALIZE PV-CICS-MSG-AREA2                         52270004
522800             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          52280004
522900             SET  DP030-SET-CURSOR-APPL-1    TO TRUE              52290004
523000             PERFORM 9900-SOFT-ABORT                              52300004
523100                                                                  52310004
523200         WHEN SQLWARN0 NOT = SPACE                                52320004
523300         WHEN SQLCODE < ZERO                                      52330004
523301         WHEN SQLCODE > ZERO                                      52330104
523302             MOVE '5931-INSERT-TPOSYNC'                           52330204
523303                                 TO DP013-PARAGRAPH               52330304
523304             MOVE 'INSERT ON POSYNC TABLE'                        52330404
523305                                 TO DP013-MESSAGE-TEXT (1)        52330504
523306             MOVE SQLCA      TO DP013-SQLCA                       52330604
523307             MOVE 'TPOSYNC'  TO DP013-DB2-TABLE-NAME (1)          52330704
523308             SET DP013-DB2-ABEND                                  52330804
523309                 DP013-XCTL-DISPLAY-RESTART                       52330904
523310                                     TO TRUE                      52331004
523320             PERFORM DP013-0000-PROCESS-ABEND                     52332004
523330     END-EVALUATE.                                                52333004
523340/                                                                 52334004
523350*----------------------------------------------------------------*52335004
523360* OPEN THE TRECVER CURSOR                                        *52336004
523370*----------------------------------------------------------------*52337004
523380                                                                  52338004
523390 5935-OPEN-TRECVER-CSR.                                           52339004
523400                                                                  52340004
523500     EXEC SQL                                                     52350004
523600          DECLARE TRECVER-CSR CURSOR FOR                          52360004
523700           SELECT MAX_RCVR_NBR                                    52370004
523800           FROM   TRECVER                                         52380004
523900           WHERE  OPERCO_NBR = '03'                               52390004
524000           FOR UPDATE OF MAX_RCVR_NBR                             52400004
524100     END-EXEC.                                                    52410004
524200                                                                  52420004
524300     EXEC SQL                                                     52430004
524400          OPEN TRECVER-CSR                                        52440004
524500     END-EXEC.                                                    52450004
524600                                                                  52460004
524700     EVALUATE TRUE                                                52470004
524800         WHEN SQLCODE = +0                                        52480004
524900              CONTINUE                                            52490004
525000                                                                  52500004
525100         WHEN SQLCODE = -904                                      52510004
525200         WHEN SQLCODE = -913                                      52520004
525300              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     52530004
525400              MOVE '5935-OPEN-TRECVER-CSR' TO PV-SOFT-PARAGRAPH   52540004
525500              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         52550004
525600              MOVE DP020-USERID            TO PV-USER             52560004
525700              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   52570004
525800              MOVE LENGTH OF PV-CICS-MSG-AREA2                    52580004
525900                                           TO PV-COMMAREA-LENGTH  52590004
526000              EXEC CICS                                           52600004
526100                   WRITEQ TD                                      52610004
526200                    QUEUE  ('CSSL')                               52620004
526300                     FROM  (PV-CICS-MSG-AREA2)                    52630004
526400                   LENGTH  (PV-COMMAREA-LENGTH)                   52640004
526500                     RESP  (PV-CICS-RESP)                         52650004
526600              END-EXEC                                            52660004
526700                                                                  52670004
526800              INITIALIZE PV-CICS-MSG-AREA2                        52680004
526900              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         52690004
527000              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             52700004
527100              PERFORM 9900-SOFT-ABORT                             52710004
527200                                                                  52720004
527300         WHEN SQLWARN0 NOT = SPACE                                52730004
527400         WHEN SQLCODE  NOT = +0                                   52740004
527500              MOVE '5935-OPEN-TRECVER-CSR'                        52750004
527600                                 TO DP013-PARAGRAPH               52760004
527700              MOVE 'OPEN TRECVER CURSOR'                          52770004
527800                                 TO DP013-MESSAGE-TEXT (1)        52780004
527900              MOVE SQLCA         TO DP013-SQLCA                   52790004
528000              MOVE 'TRECVER'     TO DP013-DB2-TABLE-NAME (1)      52800004
528100              SET DP013-DB2-ABEND                                 52810004
528200                                 TO TRUE                          52820004
528300              PERFORM DP013-0000-PROCESS-ABEND                    52830004
528400     END-EVALUATE.                                                52840004
528500                                                                  52850004
528600                                                                  52860004
528700*----------------------------------------------------------------*52870004
528800*    FETCH A TRECVER ROW                                         *52880004
528900*----------------------------------------------------------------*52890004
529000                                                                  52900004
529100 5940-FETCH-TRECVER-CSR.                                          52910004
529200                                                                  52920004
529300     EXEC SQL                                                     52930004
529400          FETCH TRECVER-CSR                                       52940004
529500          INTO :RECVER-MAX-RCVR-NBR                               52950004
529600     END-EXEC.                                                    52960004
529700                                                                  52970004
529800     EVALUATE TRUE                                                52980004
529900         WHEN SQLCODE = +0                                        52990004
530000              CONTINUE                                            53000004
530100                                                                  53010004
530200         WHEN SQLCODE = +100                                      53020004
530300              SET PS-EOF-TRECVER-CSR TO TRUE                      53030004
530400                                                                  53040004
530500         WHEN SQLWARN0 NOT = SPACE                                53050004
530600         WHEN SQLCODE < +0                                        53060004
530700         WHEN SQLCODE > +0                                        53070004
530800              MOVE '5940-FETCH-TRECVER-CSR'                       53080004
530900                                   TO DP013-PARAGRAPH             53090004
531000              MOVE 'FETCH TRECVER CURSOR'                         53100004
531100                                   TO DP013-MESSAGE-TEXT (1)      53110004
531200              MOVE SQLCA           TO DP013-SQLCA                 53120004
531300              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    53130004
531400              SET DP013-DB2-ABEND  TO TRUE                        53140004
531500              PERFORM DP013-0000-PROCESS-ABEND                    53150004
531600     END-EVALUATE.                                                53160004
531700                                                                  53170004
531800/                                                                 53180004
531900*----------------------------------------------------------------*53190004
532000*    UDPATE CURRENT CURSOR                                       *53200004
532100*----------------------------------------------------------------*53210004
532200                                                                  53220004
532300 5945-DELETE-TRECVER-CSR.                                         53230004
532400                                                                  53240004
532500     EXEC SQL                                                     53250004
532600          DELETE FROM TRECVER                                     53260004
532700            WHERE CURRENT OF TRECVER-CSR                          53270004
532800     END-EXEC.                                                    53280004
532900                                                                  53290004
533000     EVALUATE TRUE                                                53300004
533100         WHEN SQLCODE = +0                                        53310004
533200              CONTINUE                                            53320004
533300                                                                  53330004
533400         WHEN SQLWARN0 NOT = SPACE                                53340004
533500         WHEN SQLCODE < +0                                        53350004
533600         WHEN SQLCODE > +0                                        53360004
533700              MOVE '5945-DELETE-TRECVER-CSR'                      53370004
533800                                   TO DP013-PARAGRAPH             53380004
533900              MOVE 'DELETE TRECVER CURSOR'                        53390004
534000                                   TO DP013-MESSAGE-TEXT (1)      53400004
534100              MOVE SQLCA           TO DP013-SQLCA                 53410004
534200              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    53420004
534300              SET DP013-DB2-ABEND  TO TRUE                        53430004
534400              PERFORM DP013-0000-PROCESS-ABEND                    53440004
534500     END-EVALUATE.                                                53450004
534600                                                                  53460004
534700/                                                                 53470004
534800*----------------------------------------------------------------*53480004
534900* INSERT THE TRECVER ROW                                         *53490004
535000*----------------------------------------------------------------*53500004
535100                                                                  53510004
535200 5950-INSERT-TRECVER.                                             53520004
535300                                                                  53530004
535400     EXEC SQL                                                     53540004
535500          INSERT                                                  53550004
535600            INTO TRECVER                                          53560004
535700                 ( OPERCO_NBR                                     53570004
535800                  ,MAX_RCVR_NBR )                                 53580004
535900          VALUES ( '03'                                           53590004
536000                  ,:RECVER-MAX-RCVR-NBR )                         53600004
536100     END-EXEC.                                                    53610004
536200                                                                  53620004
536300     EVALUATE TRUE                                                53630004
536400         WHEN SQLCODE = +0                                        53640004
536500              CONTINUE                                            53650004
536600                                                                  53660004
536700         WHEN SQLCODE = -904                                      53670004
536800         WHEN SQLCODE = -913                                      53680004
536900              MOVE SQLCODE                TO PV-SOFT-SQLCODE      53690004
537000              MOVE '5950-INSERT-TRECVER ' TO PV-SOFT-PARAGRAPH    53700004
537100              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          53710004
537200              MOVE DP020-USERID           TO PV-USER              53720004
537300              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    53730004
537400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    53740004
537500                                          TO PV-COMMAREA-LENGTH   53750004
537600              EXEC CICS                                           53760004
537700                   WRITEQ TD                                      53770004
537800                    QUEUE  ('CSSL')                               53780004
537900                     FROM  (PV-CICS-MSG-AREA2)                    53790004
538000                   LENGTH  (PV-COMMAREA-LENGTH)                   53800004
538100                     RESP  (PV-CICS-RESP)                         53810004
538200              END-EXEC                                            53820004
538300                                                                  53830004
538400              INITIALIZE PV-CICS-MSG-AREA2                        53840004
538500              MOVE RECVER-MAX-RCVR-NBR TO PV-DISP-RCVR            53850004
538600              STRING ' RCKCS261 -'                                53860004
538700                   ' 5950-INSERT-TRECVER -'                       53870004
538710                     ' MAX RCVR NBR - '                           53871004
538720                       PV-DISP-RCVR           DELIMITED BY SIZE   53872004
538730                                         INTO PV-CICS-MSG-AREA2   53873004
538740              MOVE LENGTH OF PV-CICS-MSG-AREA2                    53874004
538750                                           TO PV-COMMAREA-LENGTH  53875004
538760              EXEC CICS                                           53876004
538770                   WRITEQ TD                                      53877004
538780                    QUEUE  ('CSSL')                               53878004
538790                     FROM  (PV-CICS-MSG-AREA2)                    53879004
538800                   LENGTH  (PV-COMMAREA-LENGTH)                   53880004
538900                     RESP  (PV-CICS-RESP)                         53890004
539000              END-EXEC                                            53900004
539100                                                                  53910004
539200              INITIALIZE PV-CICS-MSG-AREA2                        53920004
539300              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         53930004
539400              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             53940004
539500              PERFORM 9900-SOFT-ABORT                             53950004
539501                                                                  53950104
539502         WHEN SQLWARN0 NOT = SPACE                                53950204
539503         WHEN SQLCODE < +0                                        53950304
539504         WHEN SQLCODE > +0                                        53950404
539505              MOVE '5315-INSERT-TRECVER'                          53950504
539506                              TO DP013-PARAGRAPH                  53950604
539507              MOVE 'INSERT ON TRECVER TABLE   '                   53950704
539508                              TO DP013-MESSAGE-TEXT (1)           53950804
539509              MOVE SQLCA      TO DP013-SQLCA                      53950904
539510              MOVE 'TRECVER'  TO DP013-DB2-TABLE-NAME (1)         53951004
539520              SET DP013-DB2-ABEND                                 53952004
539530                  DP013-XCTL-DISPLAY-RESTART                      53953004
539540                              TO TRUE                             53954004
539550              PERFORM DP013-0000-PROCESS-ABEND                    53955004
539560     END-EVALUATE.                                                53956004
539570                                                                  53957004
539580                                                                  53958004
539590*----------------------------------------------------------------*53959004
539600* CLOSE THE TRECVER CURSOR                                       *53960004
539700*----------------------------------------------------------------*53970004
539800                                                                  53980004
539900 5955-CLOSE-TRECVER-CSR.                                          53990004
540000                                                                  54000004
540100     EXEC SQL                                                     54010004
540200          CLOSE TRECVER-CSR                                       54020004
540300     END-EXEC.                                                    54030004
540400                                                                  54040004
540500     EVALUATE TRUE                                                54050004
540600         WHEN SQLCODE = +0                                        54060004
540700              CONTINUE                                            54070004
540800         WHEN SQLWARN0 NOT = SPACE                                54080004
540900         WHEN SQLCODE  NOT = +0                                   54090004
541000              MOVE '5955-CLOSE-TRECVER-CSR'                       54100004
541100                                   TO DP013-PARAGRAPH             54110004
541200              MOVE 'CLOSE TRECVER CURSOR'                         54120004
541300                                   TO DP013-MESSAGE-TEXT (1)      54130004
541400              MOVE SQLCA           TO DP013-SQLCA                 54140004
541500              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    54150004
541600              SET DP013-DB2-ABEND  TO TRUE                        54160004
541700              PERFORM DP013-0000-PROCESS-ABEND                    54170004
541800     END-EVALUATE.                                                54180004
541900                                                                  54190004
542000/                                                                 54200004
542100 5960-CHECK-FOR-TROUBLE.                                          54210004
542200                                                                  54220004
542300     INITIALIZE TM500-FIELDS.                                     54230004
542400                                                                  54240004
542500     SET  TM500-CREATE-AUTO        TO TRUE.                       54250004
542600     SET  TM500-PO-LEVEL           TO TRUE.                       54260004
542700     SET  TM500-NO-DETAILS         TO TRUE.                       54270004
542800                                                                  54280004
542900     MOVE RECEIV-ORD-NBR           TO TM500-PO-NBR.               54290004
543000     MOVE RECEIV-OPER-UNT-ID       TO TM500-OPER-UNT-ID.          54300004
543100     MOVE RECEIV-FCLTY-ID          TO TM500-FCLTY-ID.             54310004
543200     MOVE PC-CURRENT-PROGRAM-NAME  TO TM500-NOTIF-UID.            54320004
543300     IF PV-VEND-SHIP-DTE = '0001-01-01'                           54330004
543400         MOVE SPACES               TO TM500-VEND-SHIP-DTE         54340004
543500     ELSE                                                         54350004
543600        MOVE PV-VEND-SHIP-DTE      TO DPG52-LK-DATE-INPUT         54360004
543700        INITIALIZE DPG51                                          54370004
543800        SET DPG51-ACTUAL-CALENDAR-ONLY                            54380004
543900            DPG51-DO-NOT-INCR-DECR-DATE                           54390004
544000            DPG52-LK-DTE-ISO-FMT TO TRUE                          54400004
544100        CALL PC-DPKUT500 USING DPG51 DPG52 DPG53                  54410004
544200                               DPG54 DPG55 DPG56                  54420004
544300        IF (DPG54-DATE-INVALID                                    54430004
544400        OR  DPG54-SEVERE-ERROR)                                   54440004
544500            SET PS-ERROR                                          54450004
544600                DP020-MSG-FATAL    TO TRUE                        54460004
544700            MOVE PC-TSYMSG-00009   TO DP020-MSG-NUMBER            54470004
544800        ELSE                                                      54480004
544900            MOVE DPG55-DB2-ISO-DATE-FMT                           54490004
545000                                   TO TM500-VEND-SHIP-DTE         54500004
545100     END-IF.                                                      54510004
545200     MOVE RECEIV-REC-SEQ-NBR       TO TM500-REC-SEQ-NBR.          54520004
545300                                                                  54530004
545400     EXEC CICS                                                    54540004
545500         LINK PROGRAM  (PC-TROUBLE-RTN)                           54550004
545600              COMMAREA (TM500-FIELDS)                             54560004
545700              LENGTH   (PC-TROUBLE-RTN-LENGTH)                    54570004
545800     END-EXEC.                                                    54580004
545900                                                                  54590004
546000     IF TM500-CALL-SUCCESSFUL        OR                           54600004
546100        TM500-TPURCHS-SELECT-NOT-FND OR                           54610004
546200        TM500-DUPLICATE-TROUBLE      OR                           54620004
546300        TM500-TTRBNTF-UPDATE-NOT-FND                              54630004
546400         CONTINUE                                                 54640004
546500     ELSE                                                         54650004
546600         MOVE '5960-CHECK-FOR-TROUBLE '                           54660004
546700                         TO DP013-PARAGRAPH                       54670004
546800         MOVE 'UNSUCCESSFUL CALL TO TROUBLE RTN'                  54680004
546900                         TO DP013-MESSAGE-TEXT (1)                54690004
547000         MOVE TM500-RETURN-MSG                                    54700004
547100                         TO DP013-MESSAGE-TEXT (2)                54710004
547200         MOVE TM500-SQLCA                                         54720004
547300                         TO DP013-SQLCA                           54730004
547400         SET DP013-DB2-ABEND                                      54740004
547500             DP013-XCTL-DISPLAY-RESTART                           54750004
547600                         TO TRUE                                  54760004
547700         PERFORM DP013-0000-PROCESS-ABEND                         54770004
547800     END-IF.                                                      54780004
547900                                                                  54790004
548000/                                                                 54800004
548100 5965-BUILD-ZERO-LINE-WORK-ORD.                                   54810004
548200                                                                  54820004
548300     INITIALIZE DCLTWRKORD.                                       54830004
548400                                                                  54840004
548500     MOVE SHPTPO-PO-NBR          TO WRKORD-ORD-NBR.               54850004
548600     MOVE PV-REC-SEQ-NBR         TO WRKORD-RCVR-SEQ-NBR.          54860004
548700     MOVE ASC-KEY-OPER-UNT-ID-N  TO WRKORD-OPER-UNT-ID.           54870004
548800     MOVE ASC-KEY-FCLTY-ID-N     TO WRKORD-FCLTY-ID.              54880004
548900     MOVE +1                     TO WRKORD-WORK-ORD-SEQ-NBR.      54890004
549000     MOVE ZERO                   TO WRKORD-ACTL-CART-CNT.         54900004
549100     MOVE SHPTPO-EXPTED-CART-CNT TO WRKORD-EXPTED-CART-CNT.       54910004
549200     MOVE 'A'                    TO WRKORD-VER-STATUS-CDE.        54920004
549300     MOVE 'IP'                   TO WRKORD-STAT-CDE.              54930004
549400     MOVE 'N'                    TO WRKORD-WORK-ORD-DISTR-IND.    54940004
549500     PERFORM 5994-GET-OPER-SET-INFO.                              54950004
549600     IF  SQLCODE = +0                                             54960004
549700         MOVE DCFAAS-OPER-SET-ID   TO DK-OPER-SET-ID              54970004
549800     ELSE                                                         54980004
549900         PERFORM 5967-GET-OPER-SET-ID                             54990004
550000         MOVE  COCNTL-DFLT-OPER-SET-ID  TO  DK-OPER-SET-ID        55000004
550100         PERFORM 5995-VALIDATE-OPER-SET-ID                        55010004
550200     END-IF.                                                      55020004
550300     MOVE DK-OPER-SET-ID         TO WRKORD-OPER-SET-ID.           55030004
550400                                                                  55040004
550500     PERFORM 5970-INACTIVATE-TWRKORD.                             55050004
550600     PERFORM 5975-INSERT-TWRKORD.                                 55060004
550700                                                                  55070004
550800     MOVE +0                     TO PV-WO-INSTR-SEQ-NBR.          55080004
550900     MOVE 'N'                    TO PS-TOSOPFA-CURSOR-SW.         55090004
551000     MOVE 'Y'                    TO PS-INSTRUCTION-SW.            55100004
551100                                                                  55110004
551200                                                                  55120004
551300     PERFORM 5980-OPEN-TOSOPFA-CSR.                               55130004
551400     PERFORM 5985-FETCH-TOSOPFA-CSR.                              55140004
551500                                                                  55150004
551600     PERFORM UNTIL PS-EOF-TOSOPFA-CSR                             55160004
551700        PERFORM 5991-BUILD-WORK-ORDER-INSTR                       55170004
551800        PERFORM 5985-FETCH-TOSOPFA-CSR                            55180004
551900     END-PERFORM.                                                 55190004
552000                                                                  55200004
552100     PERFORM 5990-CLOSE-TOSOPFA-CSR.                              55210004
552200                                                                  55220004
552300                                                                  55230004
552400*----------------------------------------------------------------*55240004
552500*  GET OPER-SET-ID FROM TCOCNTL                                  *55250004
552600*----------------------------------------------------------------*55260004
552700 5967-GET-OPER-SET-ID.                                            55270004
552800                                                                  55280004
552900     EXEC SQL                                                     55290004
553000          SELECT  DFLT_OPER_SET_ID                                55300004
553100            INTO :COCNTL-DFLT-OPER-SET-ID                         55310004
553200            FROM  TCOCNTL                                         55320004
553300           WHERE  OPER_UNT_ID    = :DK-OPER-UNT-ID                55330004
553400             AND  FCLTY_ID       = :DK-FCLTY-ID                   55340004
553500     END-EXEC.                                                    55350004
553600                                                                  55360004
553700     EVALUATE TRUE                                                55370004
553800         WHEN SQLCODE = +0                                        55380004
553900              CONTINUE                                            55390004
554000                                                                  55400004
554100         WHEN SQLCODE = +100                                      55410004
554200              MOVE  ZEROES  TO  COCNTL-DFLT-OPER-SET-ID           55420004
554300                                                                  55430004
554400         WHEN SQLWARN0 NOT = SPACES                               55440004
554500         WHEN SQLCODE < +0                                        55450004
554600         WHEN SQLCODE > +0                                        55460004
554700              MOVE '5967-GET-OPER-SET-ID'                         55470004
554800                                       TO DP013-PARAGRAPH         55480004
554900              MOVE 'SELECT OPERATION SET ID FROM TCOCNTL'         55490004
555000                                       TO DP013-MESSAGE-TEXT(1)   55500004
555100              MOVE SQLCA               TO DP013-SQLCA             55510004
555200              MOVE 'TCOCNTL'           TO DP013-DB2-TABLE-NAME(1) 55520004
555300              SET DP013-DB2-ABEND      TO TRUE                    55530004
555400              SET DP013-XCTL-DISPLAY-RESTART                      55540004
555500                                       TO TRUE                    55550004
555600              PERFORM DP013-0000-PROCESS-ABEND                    55560004
555700     END-EVALUATE.                                                55570004
555800                                                                  55580004
555900                                                                  55590004
556000*----------------------------------------------------------------*55600004
556100*                                                                *55610004
556200*----------------------------------------------------------------*55620004
556300 5970-INACTIVATE-TWRKORD.                                         55630004
556400                                                                  55640004
556500         EXEC SQL                                                 55650004
556600           UPDATE TWRKORD                                         55660004
556700              SET VER_STATUS_CDE   =  :PC-I                       55670004
556800           WHERE                                                  55680004
556900                 ORD_NBR           = :WRKORD-ORD-NBR              55690004
557000            AND  RCVR_SEQ_NBR      = :WRKORD-RCVR-SEQ-NBR         55700004
557100            AND  ORD_LNE_NBR       = :WRKORD-ORD-LNE-NBR          55710004
557200            AND  WORK_ORD_SEQ_NBR  = :WRKORD-WORK-ORD-SEQ-NBR     55720004
557300            AND  OPER_UNT_ID       = :WRKORD-OPER-UNT-ID          55730004
557400            AND  FCLTY_ID          = :WRKORD-FCLTY-ID             55740004
557500         END-EXEC.                                                55750004
557600                                                                  55760004
557700         EVALUATE TRUE                                            55770004
557800             WHEN SQLCODE = +0                                    55780004
557900             WHEN SQLCODE = +100                                  55790004
558000                 CONTINUE                                         55800004
558100                                                                  55810004
558200             WHEN SQLWARN0 NOT = SPACES                           55820004
558300             WHEN SQLCODE < +0                                    55830004
558400             WHEN SQLCODE > +0                                    55840004
558500                 MOVE '5970-INACTIVATE-TWRKORD'                   55850004
558600                                   TO DP013-PARAGRAPH             55860004
558700                 MOVE 'UPDATE VER STATUS CODE ON TWRKORD'         55870004
558800                                   TO DP013-MESSAGE-TEXT(1)       55880004
558900                 MOVE SQLCA        TO DP013-SQLCA                 55890004
559000                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    55900004
559100                 SET DP013-DB2-ABEND                              55910004
559200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           55920004
559300                 PERFORM DP013-0000-PROCESS-ABEND                 55930004
559400         END-EVALUATE.                                            55940004
559500/                                                                 55950004
559600 5975-INSERT-TWRKORD.                                             55960004
559700                                                                  55970004
559800     EXEC SQL                                                     55980004
559900          INSERT                                                  55990004
560000            INTO TWRKORD                                          56000004
560100                 ( ORD_NBR                                        56010004
560200                  ,RCVR_SEQ_NBR                                   56020004
560300                  ,ORD_LNE_NBR                                    56030004
560400                  ,WORK_ORD_SEQ_NBR                               56040004
560500                  ,OPER_UNT_ID                                    56050004
560600                  ,FCLTY_ID                                       56060004
560700                  ,CRE_TMST                                       56070004
560800                  ,VER_STATUS_CDE                                 56080004
560900                  ,CRE_UID_ID                                     56090004
561000                  ,EXPTED_CART_CNT                                56100004
561100                  ,ACTL_CART_CNT                                  56110004
561200                  ,EXPTED_ITM_CNT                                 56120004
561300                  ,ACTL_ITM_CNT                                   56130004
561400                  ,STAT_CDE                                       56140004
561500                  ,WORK_ORD_DISTR_IND                             56150004
561600                  ,OPER_SET_ID )                                  56160004
561700          VALUES                                                  56170004
561800                 (:WRKORD-ORD-NBR                                 56180004
561900                  ,:WRKORD-RCVR-SEQ-NBR                           56190004
562000                  ,:WRKORD-ORD-LNE-NBR                            56200004
562100                  ,:WRKORD-WORK-ORD-SEQ-NBR                       56210004
562200                  ,:WRKORD-OPER-UNT-ID                            56220004
562300                  ,:WRKORD-FCLTY-ID                               56230004
562400                  , CURRENT TIMESTAMP                             56240004
562500                  , :WRKORD-VER-STATUS-CDE                        56250004
562600                  ,:DP020-USERID                                  56260004
562700                  ,:WRKORD-EXPTED-CART-CNT                        56270004
562800                  ,:WRKORD-ACTL-CART-CNT                          56280004
562900                  ,:WRKORD-EXPTED-ITM-CNT                         56290004
563000                  ,:WRKORD-ACTL-ITM-CNT                           56300004
563100                  ,:WRKORD-STAT-CDE                               56310004
563200                  ,:WRKORD-WORK-ORD-DISTR-IND                     56320004
563300                  ,:WRKORD-OPER-SET-ID )                          56330004
563400     END-EXEC.                                                    56340004
563500                                                                  56350004
563600     EVALUATE TRUE                                                56360004
563700         WHEN SQLCODE = +0                                        56370004
563800              CONTINUE                                            56380004
563900                                                                  56390004
564000         WHEN SQLCODE = -904                                      56400004
564100         WHEN SQLCODE = -913                                      56410004
564200              MOVE SQLCODE                TO PV-SOFT-SQLCODE      56420004
564300              MOVE '5975-INSERT-TWRKORD ' TO PV-SOFT-PARAGRAPH    56430004
564400              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          56440004
564500              MOVE DP020-USERID           TO PV-USER              56450004
564600              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    56460004
564700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    56470004
564800                                          TO PV-COMMAREA-LENGTH   56480004
564900              EXEC CICS                                           56490004
565000                   WRITEQ TD                                      56500004
565100                    QUEUE  ('CSSL')                               56510004
565200                     FROM  (PV-CICS-MSG-AREA2)                    56520004
565300                   LENGTH  (PV-COMMAREA-LENGTH)                   56530004
565400                     RESP  (PV-CICS-RESP)                         56540004
565500              END-EXEC                                            56550004
565600                                                                  56560004
565700              INITIALIZE PV-CICS-MSG-AREA2                        56570004
565800              MOVE WRKORD-RCVR-SEQ-NBR      TO PV-DISP-RCVR       56580004
565900              MOVE WRKORD-ORD-NBR           TO PV-DISP-PO         56590004
566000              MOVE WRKORD-ORD-LNE-NBR       TO PV-DISP-PO-LINE    56600004
566100              MOVE WRKORD-WORK-ORD-SEQ-NBR  TO PV-DISP-PO-VERSION 56610004
566200              MOVE WRKORD-OPER-UNT-ID       TO PV-DISP-OPER-ID    56620004
566300              MOVE WRKORD-FCLTY-ID          TO PV-DISP-FACILITY   56630004
566400              STRING ' RCKCS261 -'                                56640004
566500                     '   PO:'                  PV-DISP-PO         56650004
566600                       '-'                     PV-DISP-RCVR       56660004
566700                       '-'                     PV-DISP-PO-LINE    56670004
566800                                               DELIMITED BY SIZE  56680004
566900                                          INTO PV-CICS-MSG-AREA2  56690004
567000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    56700004
567100                                            TO PV-COMMAREA-LENGTH 56710004
567200              EXEC CICS                                           56720004
567300                   WRITEQ TD                                      56730004
567400                    QUEUE  ('CSSL')                               56740004
567500                     FROM  (PV-CICS-MSG-AREA2)                    56750004
567600                   LENGTH  (PV-COMMAREA-LENGTH)                   56760004
567700                     RESP  (PV-CICS-RESP)                         56770004
567800              END-EXEC                                            56780004
567900                                                                  56790004
568000              INITIALIZE PV-CICS-MSG-AREA2                        56800004
568100              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         56810004
568200              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             56820004
568300              PERFORM 9900-SOFT-ABORT                             56830004
568400                                                                  56840004
568500         WHEN SQLWARN0 NOT = SPACE                                56850004
568600         WHEN SQLCODE < +0                                        56860004
568700         WHEN SQLCODE > +0                                        56870004
568800              MOVE '5975-INSERT-TWRKORD'                          56880004
568900                              TO DP013-PARAGRAPH                  56890004
569000              MOVE 'INSERT ON WORK ORDER TABLE'                   56900004
569100                              TO DP013-MESSAGE-TEXT (1)           56910004
569200              MOVE SQLCA      TO DP013-SQLCA                      56920004
569300              MOVE 'TWRKORD'  TO DP013-DB2-TABLE-NAME (1)         56930004
569310              SET DP013-DB2-ABEND                                 56931004
569311                  DP013-XCTL-DISPLAY-RESTART                      56931104
569312                              TO TRUE                             56931204
569313              PERFORM DP013-0000-PROCESS-ABEND                    56931304
569314     END-EVALUATE.                                                56931404
569315                                                                  56931504
569316                                                                  56931604
569317*----------------------------------------------------------------*56931704
569318* OPEN THE TOSOPFA CURSOR                                        *56931804
569319*----------------------------------------------------------------*56931904
569320                                                                  56932004
569330 5980-OPEN-TOSOPFA-CSR.                                           56933004
569340                                                                  56934004
569350     EXEC SQL                                                     56935004
569360          DECLARE TOSOPFA-CSR CURSOR FOR                          56936004
569370           SELECT OPER_SET_ID                                     56937004
569380                 ,OPER_ID                                         56938004
569390                 ,OPER_UNT_ID                                     56939004
569400                 ,FCLTY_ID                                        56940004
569500                 ,FCLTY_AREA_ID                                   56950004
569600                 ,PRC_FCLTY_AREA_ID                               56960004
569700                 ,SCRN_SEQ_NBR                                    56970004
569800           FROM   TOSOPFA                                         56980004
569900           WHERE  OPER_SET_ID    = :DK-OPER-SET-ID                56990004
570000             AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                57000004
570100             AND  FCLTY_ID       = :DK-FCLTY-ID                   57010004
570200             AND  VER_STATUS_CDE = 'A'                            57020004
570300           ORDER BY SCRN_SEQ_NBR                                  57030004
570400     END-EXEC.                                                    57040004
570500                                                                  57050004
570600     EXEC SQL                                                     57060004
570700          OPEN TOSOPFA-CSR                                        57070004
570800     END-EXEC.                                                    57080004
570900                                                                  57090004
571000     EVALUATE TRUE                                                57100004
571100         WHEN SQLCODE = +0                                        57110004
571200              CONTINUE                                            57120004
571300                                                                  57130004
571400         WHEN SQLCODE = -904                                      57140004
571500         WHEN SQLCODE = -913                                      57150004
571600              MOVE SQLCODE                 TO PV-SOFT-SQLCODE     57160004
571700              MOVE '5980-OPEN-TOSOPFA-CSR' TO PV-SOFT-PARAGRAPH   57170004
571800              MOVE ASC-KEY-OPER-UNT-ID-N   TO PV-LOCATION         57180004
571900              MOVE DP020-USERID            TO PV-USER             57190004
572000              MOVE PV-SOFT-ABORT-MSG       TO PV-CICS-MSG-AREA2   57200004
572100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    57210004
572200                                           TO PV-COMMAREA-LENGTH  57220004
572300              EXEC CICS                                           57230004
572400                   WRITEQ TD                                      57240004
572500                    QUEUE  ('CSSL')                               57250004
572600                     FROM  (PV-CICS-MSG-AREA2)                    57260004
572700                   LENGTH  (PV-COMMAREA-LENGTH)                   57270004
572800                     RESP  (PV-CICS-RESP)                         57280004
572900              END-EXEC                                            57290004
573000                                                                  57300004
573100              INITIALIZE PV-CICS-MSG-AREA2                        57310004
573200              MOVE  DK-OPER-SET-ID  TO  PV-DISP-OPER-SET          57320004
573300              STRING ' RCKCS261 - '                               57330004
573400                     '   OPER-SET-ID:'  PV-DISP-OPER-SET          57340004
573500                                        DELIMITED BY SIZE         57350004
573600                                   INTO PV-CICS-MSG-AREA2         57360004
573700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    57370004
573800                                           TO PV-COMMAREA-LENGTH  57380004
573900              EXEC CICS                                           57390004
574000                   WRITEQ TD                                      57400004
574100                    QUEUE  ('CSSL')                               57410004
574200                     FROM  (PV-CICS-MSG-AREA2)                    57420004
574300                   LENGTH  (PV-COMMAREA-LENGTH)                   57430004
574400                     RESP  (PV-CICS-RESP)                         57440004
574500              END-EXEC                                            57450004
574600                                                                  57460004
574700              INITIALIZE PV-CICS-MSG-AREA2                        57470004
574800              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         57480004
574900              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             57490004
575000              PERFORM 9900-SOFT-ABORT                             57500004
575100                                                                  57510004
575200         WHEN SQLWARN0 NOT = SPACE                                57520004
575300         WHEN SQLCODE  NOT = +0                                   57530004
575400              MOVE '5980-OPEN-TOSOPFA-CSR'                        57540004
575500                               TO DP013-PARAGRAPH                 57550004
575600              MOVE 'OPEN TOSOPFA CURSOR'                          57560004
575700                               TO DP013-MESSAGE-TEXT (1)          57570004
575800              MOVE SQLCA       TO DP013-SQLCA                     57580004
575801              MOVE 'TOSOPFA'   TO DP013-DB2-TABLE-NAME (1)        57580104
575802              SET DP013-DB2-ABEND                                 57580204
575803                               TO TRUE                            57580304
575804              PERFORM DP013-0000-PROCESS-ABEND                    57580404
575805     END-EVALUATE.                                                57580504
575806                                                                  57580604
575807                                                                  57580704
575808*----------------------------------------------------------------*57580804
575809*    FETCH A TOSOPFA ROW                                         *57580904
575810*----------------------------------------------------------------*57581004
575820                                                                  57582004
575830 5985-FETCH-TOSOPFA-CSR.                                          57583004
575840                                                                  57584004
575850     EXEC SQL                                                     57585004
575860          FETCH TOSOPFA-CSR                                       57586004
575870          INTO :OSOPFA-OPER-SET-ID                                57587004
575880              ,:OSOPFA-OPER-ID                                    57588004
575890              ,:OSOPFA-OPER-UNT-ID                                57589004
575900              ,:OSOPFA-FCLTY-ID                                   57590004
576000              ,:OSOPFA-FCLTY-AREA-ID                              57600004
576100              ,:OSOPFA-PRC-FCLTY-AREA-ID                          57610004
576200              ,:OSOPFA-SCRN-SEQ-NBR                               57620004
576300     END-EXEC.                                                    57630004
576400                                                                  57640004
576500     EVALUATE TRUE                                                57650004
576600         WHEN SQLCODE = +0                                        57660004
576700              CONTINUE                                            57670004
576800                                                                  57680004
576900         WHEN SQLCODE = +100                                      57690004
577000              SET PS-EOF-TOSOPFA-CSR TO TRUE                      57700004
577100                                                                  57710004
577200         WHEN SQLWARN0 NOT = SPACE                                57720004
577300         WHEN SQLCODE < +0                                        57730004
577400         WHEN SQLCODE > +0                                        57740004
577500              MOVE '5985-FETCH-TOSOPFA-CSR'                       57750004
577600                                   TO DP013-PARAGRAPH             57760004
577700              MOVE 'FETCH TOSOPFA CURSOR'                         57770004
577800                                   TO DP013-MESSAGE-TEXT (1)      57780004
577900              MOVE SQLCA           TO DP013-SQLCA                 57790004
578000              MOVE 'TOSOPFA'       TO DP013-DB2-TABLE-NAME (1)    57800004
578100              SET DP013-DB2-ABEND  TO TRUE                        57810004
578200              PERFORM DP013-0000-PROCESS-ABEND                    57820004
578300     END-EVALUATE.                                                57830004
578400                                                                  57840004
578500/                                                                 57850004
578600*----------------------------------------------------------------*57860004
578700* CLOSE THE TOSOPFA CURSOR                                       *57870004
578800*----------------------------------------------------------------*57880004
578900                                                                  57890004
579000 5990-CLOSE-TOSOPFA-CSR.                                          57900004
579100                                                                  57910004
579200     EXEC SQL                                                     57920004
579300          CLOSE TOSOPFA-CSR                                       57930004
579400     END-EXEC.                                                    57940004
579500                                                                  57950004
579600     EVALUATE TRUE                                                57960004
579700         WHEN SQLCODE = +0                                        57970004
579800              CONTINUE                                            57980004
579900         WHEN SQLWARN0 NOT = SPACE                                57990004
580000         WHEN SQLCODE  NOT = +0                                   58000004
580100              MOVE '5990-CLOSE-TOSOPFA-CSR'                       58010004
580200                                   TO DP013-PARAGRAPH             58020004
580300              MOVE 'CLOSE TOSOPFA CURSOR'                         58030004
580400                                   TO DP013-MESSAGE-TEXT (1)      58040004
580500              MOVE SQLCA           TO DP013-SQLCA                 58050004
580600              MOVE 'TOSOPFA'       TO DP013-DB2-TABLE-NAME (1)    58060004
580700              SET DP013-DB2-ABEND  TO TRUE                        58070004
580800              PERFORM DP013-0000-PROCESS-ABEND                    58080004
580900     END-EVALUATE.                                                58090004
581000                                                                  58100004
581100/                                                                 58110004
581200 5991-BUILD-WORK-ORDER-INSTR.                                     58120004
581300                                                                  58130004
581400     INITIALIZE DCLTWKORIN.                                       58140004
581500                                                                  58150004
581600     MOVE SHPTPO-PO-NBR          TO WKORIN-ORD-NBR.               58160004
581700     MOVE PV-REC-SEQ-NBR         TO WKORIN-RCVR-SEQ-NBR.          58170004
581800     MOVE +1                     TO WKORIN-WORK-ORD-SEQ-NBR.      58180004
581900     ADD +1                      TO PV-WO-INSTR-SEQ-NBR.          58190004
582000     MOVE PV-WO-INSTR-SEQ-NBR    TO WKORIN-WO-INSTR-SEQ-NBR.      58200004
582100     MOVE 'A'                    TO WKORIN-VER-STATUS-CDE.        58210004
582200     MOVE ASC-KEY-OPER-UNT-ID-N  TO WKORIN-OPER-UNT-ID.           58220004
582300     MOVE ASC-KEY-FCLTY-ID-N     TO WKORIN-FCLTY-ID.              58230004
582400     MOVE OSOPFA-OPER-ID         TO WKORIN-OPER-ID.               58240004
582500     MOVE OSOPFA-FCLTY-AREA-ID   TO WKORIN-FCLTY-AREA-ID.         58250004
582600     MOVE OSOPFA-PRC-FCLTY-AREA-ID                                58260004
582700                                 TO WKORIN-PRC-FCLTY-AREA-ID.     58270004
582800     MOVE OSOPFA-SCRN-SEQ-NBR    TO WKORIN-SCREEN-SEQ-NBR.        58280004
582900     IF  PS-FIRST-INSTRUCTION                                     58290004
583000         MOVE 'N'                TO PS-INSTRUCTION-SW             58300004
583100         MOVE SHPTPO-EXPTED-CART-CNT                              58310004
583200                                 TO WKORIN-EXPTED-CART-CNT        58320004
583300         MOVE ZERO                                                58330004
583400                                 TO WKORIN-ACTL-CART-CNT          58340004
583500     END-IF.                                                      58350004
583600     MOVE 'N'                    TO WKORIN-ALLOC-IND              58360004
583700                                    WKORIN-REPACK-IND.            58370004
583800     MOVE '9999-09-09-09.09.09.000000'                            58380004
583900                                 TO WKORIN-STRT-TMST              58390004
584000                                    WKORIN-STOP-TMST.             58400004
584100                                                                  58410004
584200     PERFORM 5992-INACTIVATE-TWKORIN.                             58420004
584300     PERFORM 5993-INSERT-TWKORIN.                                 58430004
584400                                                                  58440004
584500 5992-INACTIVATE-TWKORIN.                                         58450004
584600                                                                  58460004
584700     EXEC SQL                                                     58470004
584800          UPDATE                                                  58480004
584900                 TWKORIN                                          58490004
585000             SET                                                  58500004
585100                 VER_STATUS_CDE      =  :PC-I                     58510004
585200           WHERE                                                  58520004
585300                 ORD_NBR             =  :WKORIN-ORD-NBR           58530004
585400             AND RCVR_SEQ_NBR        =  :WKORIN-RCVR-SEQ-NBR      58540004
585500             AND ORD_LNE_NBR         =  :WKORIN-ORD-LNE-NBR       58550004
585600             AND WORK_ORD_SEQ_NBR    =  :WKORIN-WORK-ORD-SEQ-NBR  58560004
585700             AND WO_INSTR_SEQ_NBR    =  :WKORIN-WO-INSTR-SEQ-NBR  58570004
585800             AND VER_STATUS_CDE      =  :PC-A                     58580004
585900     END-EXEC.                                                    58590004
586000                                                                  58600004
586100     EVALUATE TRUE                                                58610004
586200         WHEN SQLCODE = ZERO                                      58620004
586300         WHEN SQLCODE = +100                                      58630004
586400              CONTINUE                                            58640004
586500         WHEN SQLWARN0 NOT = SPACES                               58650004
586600         WHEN SQLCODE NOT EQUAL ZERO                              58660004
586700              MOVE '5992-INACTIVATE-TWKORIN'                      58670004
586800                                   TO DP013-PARAGRAPH             58680004
586900              MOVE '"LOGICAL" DELETE; SET STATUS TO I'            58690004
587000                                   TO DP013-MESSAGE-TEXT (1)      58700004
587100              MOVE SQLCA           TO DP013-SQLCA                 58710004
587200              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    58720004
587300              SET DP013-DB2-ABEND                                 58730004
587400                  DP013-XCTL-DISPLAY-RESTART                      58740004
587500                                   TO TRUE                        58750004
587600              PERFORM DP013-0000-PROCESS-ABEND                    58760004
587700     END-EVALUATE.                                                58770004
587800                                                                  58780004
587900                                                                  58790004
588000 5993-INSERT-TWKORIN.                                             58800004
588100                                                                  58810004
588200     EXEC SQL                                                     58820004
588300          INSERT                                                  58830004
588400            INTO TWKORIN                                          58840004
588500                 ( ORD_NBR                                        58850004
588600                  ,RCVR_SEQ_NBR                                   58860004
588700                  ,ORD_LNE_NBR                                    58870004
588800                  ,WORK_ORD_SEQ_NBR                               58880004
588900                  ,OPER_UNT_ID                                    58890004
589000                  ,FCLTY_ID                                       58900004
589100                  ,WO_INSTR_SEQ_NBR                               58910004
589200                  ,CRE_TMST                                       58920004
589300                  ,VER_STATUS_CDE                                 58930004
589400                  ,CRE_UID_ID                                     58940004
589500                  ,OPER_ID                                        58950004
589600                  ,FCLTY_AREA_ID                                  58960004
589700                  ,PRC_FCLTY_AREA_ID                              58970004
589800                  ,EXPTED_CART_CNT                                58980004
589900                  ,ACTL_CART_CNT                                  58990004
590000                  ,ALLOC_IND                                      59000004
590100                  ,REPACK_IND                                     59010004
590200                  ,STRT_TMST                                      59020004
590300                  ,STOP_TMST                                      59030004
590400                  ,SCREEN_SEQ_NBR                                 59040004
590500                  ,LNE_LOC_CDE                                    59050004
590600                  ,REC_SEL_IND )                                  59060004
590700          VALUES                                                  59070004
590800                ( :WKORIN-ORD-NBR                                 59080004
590900                 ,:WKORIN-RCVR-SEQ-NBR                            59090004
591000                 ,:WKORIN-ORD-LNE-NBR                             59100004
591100                 ,:WKORIN-WORK-ORD-SEQ-NBR                        59110004
591200                 ,:WKORIN-OPER-UNT-ID                             59120004
591300                 ,:WKORIN-FCLTY-ID                                59130004
591400                 ,:WKORIN-WO-INSTR-SEQ-NBR                        59140004
591500                 , CURRENT TIMESTAMP                              59150004
591600                 ,:WKORIN-VER-STATUS-CDE                          59160004
591700                 ,:DP020-USERID                                   59170004
591800                 ,:WKORIN-OPER-ID                                 59180004
591900                 ,:WKORIN-FCLTY-AREA-ID                           59190004
592000                 ,:WKORIN-PRC-FCLTY-AREA-ID                       59200004
592100                 ,:WKORIN-EXPTED-CART-CNT                         59210004
592200                 ,:WKORIN-ACTL-CART-CNT                           59220004
592300                 ,:WKORIN-ALLOC-IND                               59230004
592400                 ,:WKORIN-REPACK-IND                              59240004
592500                 ,:WKORIN-STRT-TMST                               59250004
592600                 ,:WKORIN-STOP-TMST                               59260004
592700                 ,:WKORIN-SCREEN-SEQ-NBR                          59270004
592800                 ,:WKORIN-LNE-LOC-CDE                             59280004
592900                 ,:WKORIN-REC-SEL-IND )                           59290004
593000     END-EXEC.                                                    59300004
593100                                                                  59310004
593200     EVALUATE TRUE                                                59320004
593300         WHEN SQLCODE = +0                                        59330004
593400             CONTINUE                                             59340004
593500                                                                  59350004
593600         WHEN SQLCODE = -904                                      59360004
593700         WHEN SQLCODE = -913                                      59370004
593800              MOVE SQLCODE               TO PV-SOFT-SQLCODE       59380004
593900              MOVE '5993-INSERT-TWKORIN' TO PV-SOFT-PARAGRAPH     59390004
594000              MOVE ASC-KEY-OPER-UNT-ID-N TO PV-LOCATION           59400004
594100              MOVE DP020-USERID          TO PV-USER               59410004
594200              MOVE PV-SOFT-ABORT-MSG     TO PV-CICS-MSG-AREA2     59420004
594300              MOVE LENGTH OF PV-CICS-MSG-AREA2                    59430004
594400                                         TO PV-COMMAREA-LENGTH    59440004
594500              EXEC CICS                                           59450004
594600                   WRITEQ TD                                      59460004
594700                    QUEUE  ('CSSL')                               59470004
594800                     FROM  (PV-CICS-MSG-AREA2)                    59480004
594900                   LENGTH  (PV-COMMAREA-LENGTH)                   59490004
595000                     RESP  (PV-CICS-RESP)                         59500004
595100              END-EXEC                                            59510004
595200                                                                  59520004
595300              INITIALIZE PV-CICS-MSG-AREA2                        59530004
595400              MOVE WKORIN-RCVR-SEQ-NBR     TO PV-DISP-RCVR        59540004
595500              MOVE WKORIN-ORD-NBR          TO PV-DISP-PO          59550004
595600              MOVE WKORIN-ORD-LNE-NBR      TO PV-DISP-PO-LINE     59560004
595700              MOVE WKORIN-WORK-ORD-SEQ-NBR TO PV-DISP-PO-VERSION  59570004
595800              MOVE WKORIN-OPER-UNT-ID      TO PV-DISP-OPER-ID     59580004
595900              MOVE WKORIN-FCLTY-ID         TO PV-DISP-FACILITY    59590004
596000              STRING ' RCKCS261 -'                                59600004
596100                     '   PO:'                 PV-DISP-PO          59610004
596200                     '-'                      PV-DISP-RCVR        59620004
596300                     '-'                      PV-DISP-PO-LINE     59630004
596400                                           DELIMITED BY SIZE      59640004
596500                                      INTO PV-CICS-MSG-AREA2      59650004
596600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    59660004
596700                                         TO PV-COMMAREA-LENGTH    59670004
596800              EXEC CICS                                           59680004
596900                   WRITEQ TD                                      59690004
597000                    QUEUE  ('CSSL')                               59700004
597100                     FROM  (PV-CICS-MSG-AREA2)                    59710004
597200                   LENGTH  (PV-COMMAREA-LENGTH)                   59720004
597300                     RESP  (PV-CICS-RESP)                         59730004
597400              END-EXEC                                            59740004
597500                                                                  59750004
597600              INITIALIZE PV-CICS-MSG-AREA2                        59760004
597700              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         59770004
597800              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             59780004
597900              PERFORM 9900-SOFT-ABORT                             59790004
598000                                                                  59800004
598100         WHEN SQLWARN0 NOT = SPACE                                59810004
598200         WHEN SQLCODE < +0                                        59820004
598300         WHEN SQLCODE > +0                                        59830004
598301              MOVE '5993-INSERT-TWKORIN'                          59830104
598302                              TO DP013-PARAGRAPH                  59830204
598303              MOVE 'INSERT ON WORK ORDER INSTRUCTION TABLE'       59830304
598304                              TO DP013-MESSAGE-TEXT (1)           59830404
598305              MOVE SQLCA      TO DP013-SQLCA                      59830504
598306              MOVE 'TWKORIN'  TO DP013-DB2-TABLE-NAME (1)         59830604
598307              SET DP013-DB2-ABEND                                 59830704
598308                  DP013-XCTL-DISPLAY-RESTART                      59830804
598309                              TO TRUE                             59830904
598310              PERFORM DP013-0000-PROCESS-ABEND                    59831004
598320     END-EVALUATE.                                                59832004
598330                                                                  59833004
598340                                                                  59834004
598350 5994-GET-OPER-SET-INFO.                                          59835004
598360*  THIS IS THE OPER SET DEFAULT THAT IS ASSIGNED IN CNUDCLOC      59836004
598370*  BY OPER-UNIT, FACILTY, DEPT, AND CLASS.                        59837004
598380                                                                  59838004
598390     PERFORM 5994-GET-MIN-LNE-NBR.                                59839004
598400                                                                  59840004
598500     IF  SQLCODE = 0                                              59850004
598600         EXEC SQL                                                 59860004
598700              SELECT A.OPER_SET_ID                                59870004
598800                INTO :DCFAAS-OPER-SET-ID                          59880004
598900                FROM TDCFAAS A                                    59890004
599000                    ,TOPRSET B                                    59900004
599100               WHERE A.OPER_UNT_ID       = :DK-OPER-UNT-ID        59910004
599200                 AND A.FCLTY_ID          = :DK-FCLTY-ID           59920004
599300                 AND A.DEPT_NBR          = :DK-DEPT-NBR           59930004
599400                 AND A.FCLTY_LOC_TYP_CDE = 'PA'                   59940004
599500                 AND A.RANK_NBR          = 1                      59950004
599600                 AND B.VER_STATUS_CDE    = 'A'                    59960004
599700                 AND A.CL_NBR            = :PV-CLASS-NBR-2CH      59970004
599800                 AND A.OPER_SET_ID = B.OPER_SET_ID                59980004
599900                 AND A.OPER_UNT_ID       = B.OPER_UNT_ID          59990004
600000         END-EXEC                                                 60000004
600100                                                                  60010004
600200         EVALUATE TRUE                                            60020004
600300             WHEN SQLCODE = +0                                    60030004
600400             WHEN SQLCODE = +100                                  60040004
600500                  CONTINUE                                        60050004
600600                                                                  60060004
600700             WHEN SQLCODE = -904                                  60070004
600800             WHEN SQLCODE = -913                                  60080004
600900                  MOVE SQLCODE               TO PV-SOFT-SQLCODE   60090004
601000                  MOVE '5994-GET-OPER-SET-INFO'                   60100004
601100                                             TO PV-SOFT-PARAGRAPH 60110004
601200                  MOVE ASC-KEY-OPER-UNT-ID-N TO PV-LOCATION       60120004
601300                  MOVE DP020-USERID          TO PV-USER           60130004
601400                  MOVE PV-SOFT-ABORT-MSG     TO PV-CICS-MSG-AREA2 60140004
601500                  MOVE LENGTH OF PV-CICS-MSG-AREA2                60150004
601600                                             TO PV-COMMAREA-LENGTH60160004
601700                  EXEC CICS                                       60170004
601800                       WRITEQ TD                                  60180004
601900                        QUEUE  ('CSSL')                           60190004
602000                         FROM  (PV-CICS-MSG-AREA2)                60200004
602100                       LENGTH  (PV-COMMAREA-LENGTH)               60210004
602200                         RESP  (PV-CICS-RESP)                     60220004
602300                  END-EXEC                                        60230004
602400                                                                  60240004
602500                  INITIALIZE PV-CICS-MSG-AREA2                    60250004
602600                  MOVE DK-OPER-UNT-ID        TO PV-DISP-OPER-ID   60260004
602700                  MOVE DK-FCLTY-ID           TO PV-DISP-FACILITY  60270004
602800                  STRING ' RCKCS261 -'                            60280004
602900                         '   OPER/FCLTY:'       PV-DISP-OPER-ID   60290004
602910                         '/'                    PV-DISP-FACILITY  60291004
602920                         '   DEPT:'             DK-DEPT-NBR       60292004
602930                         '   CLASS:'            PV-CLASS-NBR-2CH  60293004
602940                                                DELIMITED BY SIZE 60294004
602950                                           INTO PV-CICS-MSG-AREA2 60295004
602960                  MOVE LENGTH OF PV-CICS-MSG-AREA2                60296004
602970                                             TO PV-COMMAREA-LENGTH60297004
602980                  EXEC CICS                                       60298004
602990                       WRITEQ TD                                  60299004
603000                        QUEUE  ('CSSL')                           60300004
603100                         FROM  (PV-CICS-MSG-AREA2)                60310004
603200                       LENGTH  (PV-COMMAREA-LENGTH)               60320004
603300                         RESP  (PV-CICS-RESP)                     60330004
603400                  END-EXEC                                        60340004
603500                                                                  60350004
603600                  INITIALIZE PV-CICS-MSG-AREA2                    60360004
603700                  MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER     60370004
603800                  SET  DP030-SET-CURSOR-APPL-1    TO TRUE         60380004
603900                  PERFORM 9900-SOFT-ABORT                         60390004
604000                                                                  60400004
604100             WHEN SQLWARN0 NOT = SPACES                           60410004
604200             WHEN SQLCODE < +0                                    60420004
604300             WHEN SQLCODE > +0                                    60430004
604400                  MOVE '5994-GET-OPER-SET-INFO'                   60440004
604500                                  TO DP013-PARAGRAPH              60450004
604501                  MOVE 'UNSUCCESSFUL SELECT ON TDCFAAS TABLE'     60450104
604502                                  TO DP013-MESSAGE-TEXT (1)       60450204
604503                  MOVE SQLCA      TO DP013-SQLCA                  60450304
604504                  MOVE 'TDCFAAS ' TO DP013-DB2-TABLE-NAME (1)     60450404
604505                  MOVE 'TOPRSET ' TO DP013-DB2-TABLE-NAME (2)     60450504
604506                  SET DP013-DB2-ABEND                             60450604
604507                      DP013-XCTL-DISPLAY-RESTART                  60450704
604508                                  TO TRUE                         60450804
604509                  PERFORM DP013-0000-PROCESS-ABEND                60450904
604510         END-EVALUATE                                             60451004
604520     END-IF.                                                      60452004
604530                                                                  60453004
604540                                                                  60454004
604550 5994-GET-MIN-LNE-NBR.                                            60455004
604560                                                                  60456004
604570     EXEC SQL                                                     60457004
604580          SELECT                                                  60458004
604590                  SUB_CL_NBR                                      60459004
604600            INTO :XLV00001-SUB-CL-NBR                             60460004
604700            FROM  XLV_SKU A,                                      60470004
604800                  XLV_VND_STYL B                                  60480004
604900           WHERE  A.STYL_ID = B.STYL_ID                           60490004
605000             AND  A.ITM_NBR =                                     60500004
605100                  (SELECT MIN(C.ITM_NBR)                          60510004
605200                     FROM TPURITM C                               60520004
605300                    WHERE C.PO_NBR         = :DK-PO-NBR           60530004
605400                      AND C.VER_STATUS_CDE = 'A'                  60540004
605500                      AND C.STATUS_CDE     IN ('AP','AC'))        60550004
605600     END-EXEC.                                                    60560004
605700                                                                  60570004
605800     EVALUATE TRUE                                                60580004
605900         WHEN SQLCODE = +0                                        60590004
606000              MOVE XLV00001-SUB-CL-NBR    TO PV-CLASS-NBR-99      60600004
606100              MOVE PV-CLASS-NBR-99        TO PV-CLASS-NBR-2CH     60610004
606200                                                                  60620004
606300         WHEN SQLCODE = +100                                      60630004
606400              CONTINUE                                            60640004
606500                                                                  60650004
606600         WHEN SQLCODE = -904                                      60660004
606700         WHEN SQLCODE = -913                                      60670004
606800              MOVE SQLCODE                TO PV-SOFT-SQLCODE      60680004
606900              MOVE '5994-GET-MIN-LNE-NBR' TO PV-SOFT-PARAGRAPH    60690004
607000              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          60700004
607100              MOVE DP020-USERID           TO PV-USER              60710004
607200              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    60720004
607300              MOVE LENGTH OF PV-CICS-MSG-AREA2                    60730004
607400                                          TO PV-COMMAREA-LENGTH   60740004
607500              EXEC CICS                                           60750004
607600                   WRITEQ TD                                      60760004
607700                    QUEUE  ('CSSL')                               60770004
607800                     FROM  (PV-CICS-MSG-AREA2)                    60780004
607900                   LENGTH  (PV-COMMAREA-LENGTH)                   60790004
608000                     RESP  (PV-CICS-RESP)                         60800004
608100              END-EXEC                                            60810004
608200                                                                  60820004
608300              INITIALIZE PV-CICS-MSG-AREA2                        60830004
608400              MOVE DK-PO-NBR                TO PV-DISP-PO         60840004
608500              STRING ' RCKCS261 -'                                60850004
608600                     ' PO NBR - '                                 60860004
608700                       PV-DISP-PO              DELIMITED BY SIZE  60870004
608800                                          INTO PV-CICS-MSG-AREA2  60880004
608900              MOVE LENGTH OF PV-CICS-MSG-AREA2                    60890004
609000                                            TO PV-COMMAREA-LENGTH 60900004
609100              EXEC CICS                                           60910004
609200                   WRITEQ TD                                      60920004
609300                    QUEUE  ('CSSL')                               60930004
609400                     FROM  (PV-CICS-MSG-AREA2)                    60940004
609500                   LENGTH  (PV-COMMAREA-LENGTH)                   60950004
609600                     RESP  (PV-CICS-RESP)                         60960004
609700              END-EXEC                                            60970004
609800                                                                  60980004
609900              INITIALIZE PV-CICS-MSG-AREA2                        60990004
610000              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         61000004
610100              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             61010004
610200              PERFORM 9900-SOFT-ABORT                             61020004
610300                                                                  61030004
610400         WHEN SQLWARN0 NOT = SPACES                               61040004
610500         WHEN SQLCODE < +0                                        61050004
610600         WHEN SQLCODE > +0                                        61060004
610700              MOVE '5994-GET-MIN-LNE-NBR'                         61070004
610800                              TO DP013-PARAGRAPH                  61080004
610900              MOVE 'UNSUCCESSFUL SELECT ON TPURITM TABLE'         61090004
611000                              TO DP013-MESSAGE-TEXT (1)           61100004
611100              MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT (2)           61110004
611200              MOVE SQLCA      TO DP013-SQLCA                      61120004
611300              MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)         61130004
611400              SET DP013-DB2-ABEND                                 61140004
611500                  DP013-XCTL-DISPLAY-RESTART                      61150004
611600                              TO TRUE                             61160004
611700              PERFORM DP013-0000-PROCESS-ABEND                    61170004
611800     END-EVALUATE.                                                61180004
611900                                                                  61190004
612000                                                                  61200004
612100 5995-VALIDATE-OPER-SET-ID.                                       61210004
612200                                                                  61220004
612300     EXEC SQL                                                     61230004
612400          SELECT  OPER_SET_DESC                                   61240004
612500            INTO :OPRSET-OPER-SET-DESC                            61250004
612600            FROM  TOPRSET                                         61260004
612700           WHERE  OPER_SET_ID    = :DK-OPER-SET-ID                61270004
612800             AND  VER_STATUS_CDE = 'A'                            61280004
612900             AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                61290004
613000             AND  FCLTY_ID       = :DK-FCLTY-ID                   61300004
613100     END-EXEC.                                                    61310004
613200                                                                  61320004
613300     EVALUATE TRUE                                                61330004
613400         WHEN SQLCODE = +0                                        61340004
613500         WHEN SQLCODE = +100                                      61350004
613600              CONTINUE                                            61360004
613700                                                                  61370004
613800         WHEN SQLCODE = -904                                      61380004
613900         WHEN SQLCODE = -913                                      61390004
614000              MOVE SQLCODE                TO PV-SOFT-SQLCODE      61400004
614100              MOVE '5995-VALIDATE-OPER-SET-ID'                    61410004
614200                                          TO PV-SOFT-PARAGRAPH    61420004
614300              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          61430004
614400              MOVE DP020-USERID           TO PV-USER              61440004
614500              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    61450004
614600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    61460004
614700                                          TO PV-COMMAREA-LENGTH   61470004
614800              EXEC CICS                                           61480004
614900                   WRITEQ TD                                      61490004
615000                    QUEUE  ('CSSL')                               61500004
615100                     FROM  (PV-CICS-MSG-AREA2)                    61510004
615200                   LENGTH  (PV-COMMAREA-LENGTH)                   61520004
615300                     RESP  (PV-CICS-RESP)                         61530004
615400              END-EXEC                                            61540004
615500                                                                  61550004
615600              INITIALIZE PV-CICS-MSG-AREA2                        61560004
615700              MOVE DK-OPER-UNT-ID           TO PV-DISP-OPER-ID    61570004
615800              MOVE DK-FCLTY-ID              TO PV-DISP-FACILITY   61580004
615900              MOVE DK-OPER-SET-ID           TO PV-DISP-OPER-SET   61590004
616000              STRING ' RCKCS261 -'                                61600004
616100                     '   OPER SET ID:'         PV-DISP-OPER-SET   61610004
616200                     '   OPER/FCLTY:'          PV-DISP-OPER-ID    61620004
616300                     '/'                       PV-DISP-FACILITY   61630004
616400                                               DELIMITED BY SIZE  61640004
616500                                          INTO PV-CICS-MSG-AREA2  61650004
616600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    61660004
616700                                            TO PV-COMMAREA-LENGTH 61670004
616800              EXEC CICS                                           61680004
616900                   WRITEQ TD                                      61690004
617000                    QUEUE  ('CSSL')                               61700004
617100                     FROM  (PV-CICS-MSG-AREA2)                    61710004
617200                   LENGTH  (PV-COMMAREA-LENGTH)                   61720004
617300                     RESP  (PV-CICS-RESP)                         61730004
617400              END-EXEC                                            61740004
617500                                                                  61750004
617600              INITIALIZE PV-CICS-MSG-AREA2                        61760004
617700              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         61770004
617800              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             61780004
617900              PERFORM 9900-SOFT-ABORT                             61790004
618000                                                                  61800004
618100         WHEN SQLWARN0 NOT = SPACES                               61810004
618200         WHEN SQLCODE < +0                                        61820004
618201         WHEN SQLCODE > +0                                        61820104
618202              MOVE '5995-VALIDATE-OPER-SET-ID'                    61820204
618203                              TO DP013-PARAGRAPH                  61820304
618204              MOVE 'SELECT OPERATION SET ID'                      61820404
618205                              TO DP013-MESSAGE-TEXT (1)           61820504
618206              MOVE SQLCA      TO DP013-SQLCA                      61820604
618207              MOVE 'TOPRSET'  TO DP013-DB2-TABLE-NAME (1)         61820704
618208              SET DP013-DB2-ABEND                                 61820804
618209                  DP013-XCTL-DISPLAY-RESTART                      61820904
618210                                 TO TRUE                          61821004
618220              PERFORM DP013-0000-PROCESS-ABEND                    61822004
618230     END-EVALUATE.                                                61823004
618240                                                                  61824004
618250                                                                  61825004
618260*----------------------------------------------------------------*61826004
618270*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *61827004
618280*----------------------------------------------------------------*61828004
618290 6010-DELETE-SEL-QUEUE.                                           61829004
618300                                                                  61830004
618400     EXEC CICS                                                    61840004
618500         DELETEQ TS                                               61850004
618600             QUEUE (ASC-SEL-QUEUE-NAME)                           61860004
618700             RESP  (PV-CICS-RESP)                                 61870004
618800     END-EXEC.                                                    61880004
618900                                                                  61890004
619000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      61900004
619100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         61910004
619200         CONTINUE                                                 61920004
619300     ELSE                                                         61930004
619400         SET DP013-CICS-ABEND TO TRUE                             61940004
619500         SET DP013-NO-ROLLBACK TO TRUE                            61950004
619600         MOVE '6010-DELETE-SEL-QUEUE'                             61960004
619700                        TO DP013-PARAGRAPH                        61970004
619800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         61980004
619900                        TO DP013-MESSAGE-TEXT (1)                 61990004
620000         PERFORM DP013-0000-PROCESS-ABEND                         62000004
620100     END-IF.                                                      62010004
620200                                                                  62020004
620300 EJECT                                                            62030004
620400*----------------------------------------------------------------*62040004
620500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*62050004
620600*----------------------------------------------------------------*62060004
620700                                                                  62070004
620800 6112-READ-LIST-QUEUE.                                            62080004
620900                                                                  62090004
621000     EXEC CICS                                                    62100004
621100         READQ TS                                                 62110004
621200             QUEUE (ASC-LIST-QUEUE-NAME)                          62120004
621300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     62130004
621400             ITEM  (PV-ITEM)                                      62140004
621500             RESP  (PV-CICS-RESP)                                 62150004
621600     END-EXEC.                                                    62160004
621700                                                                  62170004
621800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          62180004
621900         CONTINUE                                                 62190004
622000     ELSE                                                         62200004
622100         SET DP013-CICS-ABEND        TO TRUE                      62210004
622200         SET DP013-NO-ROLLBACK       TO TRUE                      62220004
622300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           62230004
622400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    62240004
622500                                     TO DP013-MESSAGE-TEXT(1)     62250004
622600         PERFORM DP013-0000-PROCESS-ABEND                         62260004
622700     END-IF.                                                      62270004
622800                                                                  62280004
622900 7000-DETACH-SHIPMENT.                                            62290004
623000     PERFORM 7010-GET-RANDOM-NUMBER.                              62300004
623100     PERFORM 7020-READ-DUPL-TVHTRIP                               62310004
623200          WITH TEST AFTER                                         62320004
623300          UNTIL PV-VHTRIP-COUNT = 0.                              62330004
623400     MOVE PV-CURR-TRIP-ID TO PV-TRIP-ID.                          62340004
623500     PERFORM 7100-INSERT-TVHTRIP.                                 62350004
623600     PERFORM 7500-UPDATE-TSHIPMT.                                 62360004
623700     PERFORM 5370-AUDIT-TSHIPMT.                                  62370004
623800     PERFORM 7200-OPEN-CURSOR.                                    62380004
623900     SET PS-NOT-END-OF-STATUS-CURSOR TO TRUE.                     62390004
624000     PERFORM 7260-FETCH-CURSOR                                    62400004
624100         UNTIL PS-END-OF-STATUS-CURSOR.                           62410004
624200     PERFORM 7230-CLOSE-CURSOR.                                   62420004
624300     INITIALIZE       SHIPST-CARR-STATUS-CDE                      62430004
624400                      SHIPST-TIME-ZONE-CDE                        62440004
624500                      SHIPST-CITY-NAME                            62450004
624600                      SHIPST-STATE-CDE                            62460004
624700     MOVE PC-EN TO SHIPST-SHIPT-STATUS-CDE.                       62470004
624800     PERFORM 5350-INSERT-TSHIPST.                                 62480004
624900*----------------------------------------------------------------*62490004
625000*  RETRIEVE A RANDOM NUMBER                                      *62500004
625100*----------------------------------------------------------------*62510004
625200 7010-GET-RANDOM-NUMBER.                                          62520004
625300     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     62530004
625400                                                                  62540004
625500     CALL PC-RANDNBR-PGM USING DFHEIBLK                           62550004
625600                               DFHCOMMAREA                        62560004
625700                               DP902-RANDNBR-ROUTINE-FIELDS.      62570004
625800                                                                  62580004
625900     IF  DP902-SUCCESSFUL                                         62590004
626000         NEXT SENTENCE                                            62600004
626100     ELSE                                                         62610004
626200         MOVE '7010-GET-RANDOM-NUMBER'  TO DP013-PARAGRAPH        62620004
626300         MOVE 'CALL TO DPKUT001 FAILED'                           62630004
626400                                   TO DP013-MESSAGE-TEXT(1)       62640004
626500         SET DP013-XCTL-DISPLAY-RESTART                           62650004
626600                                   TO TRUE                        62660004
626700         PERFORM DP013-0000-PROCESS-ABEND                         62670004
626800     END-IF.                                                      62680004
626900  EJECT                                                           62690004
627000                                                                  62700004
627100                                                                  62710004
627200 7020-READ-DUPL-TVHTRIP.                                          62720004
627300                                                                  62730004
627400     MOVE DP902-RANDOM-NUMBER   TO PV-CURR-TRIP-ID.               62740004
627500                                                                  62750004
627600     EXEC SQL                                                     62760004
627700          SELECT COUNT(*)                                         62770004
627800            INTO :PV-VHTRIP-COUNT                                 62780004
627900            FROM  TVHTRIP                                         62790004
628000           WHERE (TRIP_ID         = :PV-CURR-TRIP-ID)             62800004
628100     END-EXEC.                                                    62810004
628200                                                                  62820004
628300     EVALUATE TRUE                                                62830004
628400         WHEN SQLCODE = +0                                        62840004
628500              CONTINUE                                            62850004
628600                                                                  62860004
628700         WHEN SQLCODE = -904                                      62870004
628800         WHEN SQLCODE = -913                                      62880004
628900              MOVE SQLCODE                  TO PV-SOFT-SQLCODE    62890004
629000              MOVE '7020-READ-DUPL-TVHTRIP' TO PV-SOFT-PARAGRAPH  62900004
629100              MOVE ASC-KEY-OPER-UNT-ID-N    TO PV-LOCATION        62910004
629200              MOVE DP020-USERID             TO PV-USER            62920004
629300              MOVE PV-SOFT-ABORT-MSG        TO PV-CICS-MSG-AREA2  62930004
629400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    62940004
629500                                            TO PV-COMMAREA-LENGTH 62950004
629600              EXEC CICS                                           62960004
629700                   WRITEQ TD                                      62970004
629800                    QUEUE  ('CSSL')                               62980004
629900                     FROM  (PV-CICS-MSG-AREA2)                    62990004
630000                   LENGTH  (PV-COMMAREA-LENGTH)                   63000004
630100                     RESP  (PV-CICS-RESP)                         63010004
630200              END-EXEC                                            63020004
630300                                                                  63030004
630400               INITIALIZE PV-CICS-MSG-AREA2                       63040004
630500              MOVE PV-CURR-TRIP-ID          TO PV-DISP-TRIP-ID    63050004
630600              STRING ' RCKCS261 -'                                63060004
630700                     ' 7020-READ-DUPL-TVHTRIP - '                 63070004
630800                     ' TRIP ID- '                                 63080004
630900                       PV-DISP-TRIP-ID         DELIMITED BY SIZE  63090004
631000                                          INTO PV-CICS-MSG-AREA2  63100004
631100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    63110004
631200                                            TO PV-COMMAREA-LENGTH 63120004
631300              EXEC CICS                                           63130004
631400                   WRITEQ TD                                      63140004
631500                    QUEUE  ('CSSL')                               63150004
631600                     FROM  (PV-CICS-MSG-AREA2)                    63160004
631700                   LENGTH  (PV-COMMAREA-LENGTH)                   63170004
631800                     RESP  (PV-CICS-RESP)                         63180004
631900              END-EXEC                                            63190004
632000                                                                  63200004
632100              INITIALIZE PV-CICS-MSG-AREA2                        63210004
632200              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         63220004
632300              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             63230004
632400              PERFORM 9900-SOFT-ABORT                             63240004
632500                                                                  63250004
632600         WHEN SQLWARN0 NOT = SPACES                               63260004
632700         WHEN SQLCODE < +0                                        63270004
632800         WHEN SQLCODE > +0                                        63280004
632900              MOVE '7020-READ-DUPL-TVHTRIP'                       63290004
633000                                TO DP013-PARAGRAPH                63300004
633100              MOVE 'GET COUNT OF TRIPS'                           63310004
633200                                TO DP013-MESSAGE-TEXT(1)          63320004
633300              MOVE PV-CURR-TRIP-ID                                63330004
633400                                TO DP013-MESSAGE-TEXT(2)          63340004
633500              MOVE SQLCA        TO DP013-SQLCA                    63350004
633600              MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)       63360004
633700              SET DP013-DB2-ABEND                                 63370004
633800                  DP013-XCTL-DISPLAY-RESTART TO TRUE              63380004
633900              PERFORM DP013-0000-PROCESS-ABEND                    63390004
634000     END-EVALUATE.                                                63400004
634100                                                                  63410004
634200     IF PV-VHTRIP-COUNT > 0                                       63420004
634300         PERFORM 7010-GET-RANDOM-NUMBER                           63430004
634400     END-IF.                                                      63440004
634500                                                                  63450004
634600*----------------------------------------------------------------*63460004
634700*  INSERT A ROW TO THE TRIP TABLE                                 63470004
634800*----------------------------------------------------------------*63480004
634900 7100-INSERT-TVHTRIP.                                             63490004
635000                                                                  63500004
635100     INITIALIZE DCLTVHTRIP.                                       63510004
635200                                                                  63520004
635300     MOVE ASC-KEY-ORIGIN-SCAC-ID TO VHTRIP-OWNER-SCAC-ID.         63530004
635400                                                                  63540004
635500     MOVE -1               TO DN-VEH-NBR.                         63550004
635600     MOVE SPACES           TO VHTRIP-VEH-NBR.                     63560004
635700                                                                  63570004
635800     MOVE PV-TRIP-ID               TO VHTRIP-TRIP-ID              63580004
635900                                      VHTRIP-REF-TRIP-ID          63590004
636000                                      DK-TRIP-ID.                 63600004
636100     MOVE 'CE'                     TO VHTRIP-CRT-SRC-CDE.         63610004
636200     MOVE SPACES                   TO VHTRIP-MANIFEST-NBR         63620004
636300                                      VHTRIP-PLND-ACTVY-CDE.      63630004
636400     MOVE ZEROES                   TO VHTRIP-PLND-TRIP-SEQ.       63640004
636500     MOVE PC-DEFAULT-TMST          TO VHTRIP-EST-AR-TMST.         63650004
636600                                                                  63660004
636700     EXEC SQL                                                     63670004
636800          INSERT                                                  63680004
636900            INTO TVHTRIP                                          63690004
637000                ( OWNER_SCAC_ID                                   63700004
637100                 ,VEH_NBR                                         63710004
637200                 ,TRIP_ID                                         63720004
637300                 ,CRT_SRC_CDE                                     63730004
637400                 ,LAST_UPD_UID                                    63740004
637500                 ,MANIFEST_NBR                                    63750004
637600                 ,PLND_TRIP_SEQ                                   63760004
637700                 ,PLND_ACTVY_CDE                                  63770004
637800                 ,OWNR_SCAC_SHIP_DTE                              63780004
637900                 ,REF_TRIP_ID                                     63790004
638000                 ,EST_AR_TMST                                     63800004
638100                 ,SPLT_XMIT_IND                                   63810004
638200                 ,SPLT_XMIT_DTE                                   63820004
638300                 ,SPLT_XMIT_TM )                                  63830004
638400          VALUES                                                  63840004
638500                ( :VHTRIP-OWNER-SCAC-ID                           63850004
638600                 ,:VHTRIP-VEH-NBR :DN-VEH-NBR                     63860004
638700                 ,:VHTRIP-TRIP-ID                                 63870004
638800                 ,:VHTRIP-CRT-SRC-CDE                             63880004
638900                 ,:DP020-USERID                                   63890004
639000                 ,:VHTRIP-MANIFEST-NBR                            63900004
639100                 ,:VHTRIP-PLND-TRIP-SEQ                           63910004
639200                 ,:VHTRIP-PLND-ACTVY-CDE                          63920004
639300                 ,:PC-DEFAULT-DATE                                63930004
639400                 ,:VHTRIP-REF-TRIP-ID                             63940004
639500                 ,:VHTRIP-EST-AR-TMST                             63950004
639600                 ,:VHTRIP-SPLT-XMIT-IND                           63960004
639700                  ,:PC-DEFAULT-DATE                               63970004
639800                 ,:PC-DEFAULT-TIME )                              63980004
639900     END-EXEC.                                                    63990004
640000                                                                  64000004
640100     EVALUATE TRUE                                                64010004
640200         WHEN SQLCODE = +0                                        64020004
640300              CONTINUE                                            64030004
640400                                                                  64040004
640500         WHEN SQLCODE = -904                                      64050004
640600         WHEN SQLCODE = -913                                      64060004
640700              MOVE SQLCODE                TO PV-SOFT-SQLCODE      64070004
640800              MOVE '7100-INSERT-TVHTRIP ' TO PV-SOFT-PARAGRAPH    64080004
640900              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          64090004
641000              MOVE DP020-USERID           TO PV-USER              64100004
641100              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    64110004
641200              MOVE LENGTH OF PV-CICS-MSG-AREA2                    64120004
641300                                          TO PV-COMMAREA-LENGTH   64130004
641400              EXEC CICS                                           64140004
641500                   WRITEQ TD                                      64150004
641600                    QUEUE  ('CSSL')                               64160004
641700                     FROM  (PV-CICS-MSG-AREA2)                    64170004
641800                   LENGTH  (PV-COMMAREA-LENGTH)                   64180004
641900                     RESP  (PV-CICS-RESP)                         64190004
642000              END-EXEC                                            64200004
642100                                                                  64210004
642200              INITIALIZE PV-CICS-MSG-AREA2                        64220004
642300              MOVE VHTRIP-TRIP-ID           TO PV-DISP-TRIP-ID    64230004
642400              STRING ' RCKCS261 -'                                64240004
642500                     '  TRIP ID:'          PV-DISP-TRIP-ID        64250004
642600                     '  VEH:'              VHTRIP-VEH-NBR         64260004
642700                     '  SCAC:'             VHTRIP-OWNER-SCAC-ID   64270004
642800                     '  SOURCE:'           VHTRIP-CRT-SRC-CDE     64280004
642900                                           DELIMITED BY SIZE      64290004
643000                                      INTO PV-CICS-MSG-AREA2      64300004
643100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    64310004
643200                                        TO PV-COMMAREA-LENGTH     64320004
643300              EXEC CICS                                           64330004
643400                   WRITEQ TD                                      64340004
643500                    QUEUE  ('CSSL')                               64350004
643600                     FROM  (PV-CICS-MSG-AREA2)                    64360004
643700                   LENGTH  (PV-COMMAREA-LENGTH)                   64370004
643800                     RESP  (PV-CICS-RESP)                         64380004
643900              END-EXEC                                            64390004
644000                                                                  64400004
644100              INITIALIZE PV-CICS-MSG-AREA2                        64410004
644200              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         64420004
644300              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             64430004
644400              PERFORM 9900-SOFT-ABORT                             64440004
644500                                                                  64450004
644501         WHEN SQLWARN0 NOT = SPACES                               64450104
644502         WHEN SQLCODE < +0                                        64450204
644503         WHEN SQLCODE > +0                                        64450304
644504              MOVE SPACES TO PV-MESSAGE                           64450404
644505              MOVE VHTRIP-OWNER-SCAC-ID TO PV-MESSAGE1            64450504
644506              MOVE VHTRIP-VEH-NBR       TO PV-MESSAGE2            64450604
644507              MOVE VHTRIP-TRIP-ID       TO PV-MESSAGE3            64450704
644508              MOVE '7100-INSERT-TVHTRIP'                          64450804
644509                                TO DP013-PARAGRAPH                64450904
644510              MOVE 'INSERT A ROW ON TVHTRIP'                      64451004
644511                                TO DP013-MESSAGE-TEXT(1)          64451104
644512              MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)          64451204
644513              MOVE SQLCA        TO DP013-SQLCA                    64451304
644514              MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)       64451404
644515              SET DP013-DB2-ABEND                                 64451504
644516                  DP013-XCTL-DISPLAY-RESTART TO TRUE              64451604
644517              PERFORM DP013-0000-PROCESS-ABEND                    64451704
644518     END-EVALUATE.                                                64451804
644519                                                                  64451904
644520     EVALUATE TRUE                                                64452004
644530         WHEN SQLCODE = ZERO                                      64453004
644540              PERFORM 7110-INSERT-TTRIPST                         64454004
644550              PERFORM 7120-INSERT-TAUTRIP                         64455004
644560     END-EVALUATE.                                                64456004
644570                                                                  64457004
644580                                                                  64458004
644590*----------------------------------------------------------------*64459004
644600*  INSERT A ROW TO THE TRIP STATUS TABLE                          64460004
644700*----------------------------------------------------------------*64470004
644800 7110-INSERT-TTRIPST.                                             64480004
644900                                                                  64490004
645000     INITIALIZE DCLTTRIPST.                                       64500004
645100                                                                  64510004
645200     MOVE PV-TRIP-ID               TO TRIPST-TRIP-ID.             64520004
645300     MOVE 'EN'                     TO TRIPST-TRIP-STATUS-CDE.     64530004
645400     MOVE ASC-KEY-OPER-UNT-ID      TO TRIPST-OPER-UNT-ID.         64540004
645500     MOVE ASC-KEY-FCLTY-ID         TO TRIPST-FCLTY-ID.            64550004
645600     MOVE SPACES                   TO TRIPST-FCLTY-AREA-ID.       64560004
645700                                                                  64570004
645800     EXEC SQL                                                     64580004
645900          INSERT                                                  64590004
646000            INTO TTRIPST                                          64600004
646100                ( TRIP_ID                                         64610004
646200                 ,TRIP_STATUS_CDE                                 64620004
646300                 ,STATUS_UID                                      64630004
646400                 ,OPER_UNT_ID                                     64640004
646500                 ,FCLTY_ID                                        64650004
646600                 ,FCLTY_AREA_ID )                                 64660004
646700          VALUES                                                  64670004
646800                ( :TRIPST-TRIP-ID                                 64680004
646900                 ,:TRIPST-TRIP-STATUS-CDE                         64690004
647000                 ,:DP020-USERID                                   64700004
647100                 ,:TRIPST-OPER-UNT-ID                             64710004
647200                 ,:TRIPST-FCLTY-ID                                64720004
647300                 ,:TRIPST-FCLTY-AREA-ID )                         64730004
647400     END-EXEC.                                                    64740004
647500                                                                  64750004
647600     EVALUATE TRUE                                                64760004
647700         WHEN SQLCODE = +0                                        64770004
647800                 CONTINUE                                         64780004
647900                                                                  64790004
648000         WHEN SQLCODE = -904                                      64800004
648100         WHEN SQLCODE = -913                                      64810004
648200              MOVE SQLCODE                TO PV-SOFT-SQLCODE      64820004
648300              MOVE '7110-INSERT-TTRIPST ' TO PV-SOFT-PARAGRAPH    64830004
648400              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          64840004
648500              MOVE DP020-USERID           TO PV-USER              64850004
648600              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    64860004
648700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    64870004
648800                                          TO PV-COMMAREA-LENGTH   64880004
648900              EXEC CICS                                           64890004
649000                   WRITEQ TD                                      64900004
649100                    QUEUE  ('CSSL')                               64910004
649200                     FROM  (PV-CICS-MSG-AREA2)                    64920004
649300                   LENGTH  (PV-COMMAREA-LENGTH)                   64930004
649400                     RESP  (PV-CICS-RESP)                         64940004
649500              END-EXEC                                            64950004
649600                                                                  64960004
649700              INITIALIZE PV-CICS-MSG-AREA2                        64970004
649800              MOVE TRIPST-TRIP-ID           TO PV-DISP-TRIP-ID    64980004
649900              MOVE TRIPST-OPER-UNT-ID       TO PV-DISP-OPER-ID    64990004
650000              MOVE TRIPST-FCLTY-ID          TO PV-DISP-FACILITY   65000004
650100              STRING ' RCKCS261 -'                                65010004
650200                     '   TRIP ID:'          PV-DISP-TRIP-ID       65020004
650300                     '   STATUS:'           TRIPST-TRIP-STATUS-CDE65030004
650400                     '   OPER/FCLTY:'       PV-DISP-OPER-ID       65040004
650500                     '/'                    PV-DISP-FACILITY      65050004
650600                     '   AREA:'             TRIPST-FCLTY-AREA-ID  65060004
650700                       TRIPST-FCLTY-AREA-ID    DELIMITED BY SIZE  65070004
650800                                          INTO PV-CICS-MSG-AREA2  65080004
650900              MOVE LENGTH OF PV-CICS-MSG-AREA2                    65090004
651000                                            TO PV-COMMAREA-LENGTH 65100004
651100              EXEC CICS                                           65110004
651200                   WRITEQ TD                                      65120004
651300                    QUEUE  ('CSSL')                               65130004
651400                     FROM  (PV-CICS-MSG-AREA2)                    65140004
651500                   LENGTH  (PV-COMMAREA-LENGTH)                   65150004
651600                     RESP  (PV-CICS-RESP)                         65160004
651700              END-EXEC                                            65170004
651800                                                                  65180004
651900              INITIALIZE PV-CICS-MSG-AREA2                        65190004
652000              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         65200004
652100              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             65210004
652200              PERFORM 9900-SOFT-ABORT                             65220004
652300                                                                  65230004
652400         WHEN SQLWARN0 NOT = SPACES                               65240004
652500         WHEN SQLCODE < +0                                        65250004
652600         WHEN SQLCODE > +0                                        65260004
652700              MOVE SPACES TO PV-MESSAGE                           65270004
652800              MOVE TRIPST-TRIP-ID TO PV-MESSAGE1                  65280004
652900              MOVE TRIPST-TRIP-STATUS-CDE TO PV-MESSAGE2          65290004
653000              MOVE '7110-INSERT-TTRIPST'                          65300004
653100                                TO DP013-PARAGRAPH                65310004
653200              MOVE 'INSERT A ROW ON TTRIPST'                      65320004
653300                                TO DP013-MESSAGE-TEXT(1)          65330004
653400              MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)          65340004
653500              MOVE SQLCA        TO DP013-SQLCA                    65350004
653600              MOVE 'TTRIPST'    TO DP013-DB2-TABLE-NAME (1)       65360004
653700              SET DP013-DB2-ABEND                                 65370004
653710                  DP013-XCTL-DISPLAY-RESTART TO TRUE              65371004
653711              PERFORM DP013-0000-PROCESS-ABEND                    65371104
653712     END-EVALUATE.                                                65371204
653713                                                                  65371304
653714                                                                  65371404
653715*----------------------------------------------------------------*65371504
653716*  INSERT A ROW TO THE TRIP AUDIT TABLE                           65371604
653717*----------------------------------------------------------------*65371704
653718 7120-INSERT-TAUTRIP.                                             65371804
653719                                                                  65371904
653720                                                                  65372004
653730     INITIALIZE DCLTAUTRIP.                                       65373004
653740                                                                  65374004
653750     EXEC SQL                                                     65375004
653760          SELECT                                                  65376004
653770                  OWNER_SCAC_ID                                   65377004
653780                 ,VEH_NBR                                         65378004
653790                 ,TRIP_ID                                         65379004
653800                 ,TRIP_BEG_DTE                                    65380004
653900                 ,TRIP_BEG_TME                                    65390004
654000                 ,CRT_SRC_CDE                                     65400004
654100                 ,LAST_UPD_DTE                                    65410004
654200                 ,LAST_UPD_TME                                    65420004
654300                 ,LAST_UPD_UID                                    65430004
654400                 ,MANIFEST_NBR                                    65440004
654500                 ,PLND_TRIP_SEQ                                   65450004
654600                 ,PLND_ACTVY_CDE                                  65460004
654700                 ,OWNR_SCAC_SHIP_DTE                              65470004
654800                 ,REF_TRIP_ID                                     65480004
654900                 ,EST_AR_TMST                                     65490004
655000                 ,SPLT_XMIT_IND                                   65500004
655100                 ,SPLT_XMIT_DTE                                   65510004
655200                 ,SPLT_XMIT_TM                                    65520004
655300            INTO                                                  65530004
655400                  :VHTRIP-OWNER-SCAC-ID                           65540004
655500                 ,:VHTRIP-VEH-NBR   :DN-VEH-NBR                   65550004
655600                 ,:VHTRIP-TRIP-ID                                 65560004
655700                 ,:VHTRIP-TRIP-BEG-DTE                            65570004
655800                 ,:VHTRIP-TRIP-BEG-TME                            65580004
655900                 ,:VHTRIP-CRT-SRC-CDE                             65590004
656000                 ,:VHTRIP-LAST-UPD-DTE                            65600004
656100                 ,:VHTRIP-LAST-UPD-TME                            65610004
656200                 ,:VHTRIP-LAST-UPD-UID                            65620004
656300                 ,:VHTRIP-MANIFEST-NBR                            65630004
656400                 ,:VHTRIP-PLND-TRIP-SEQ                           65640004
656500                 ,:VHTRIP-PLND-ACTVY-CDE                          65650004
656600                 ,:VHTRIP-OWNR-SCAC-SHIP-DTE                      65660004
656700                 ,:VHTRIP-REF-TRIP-ID                             65670004
656800                 ,:VHTRIP-EST-AR-TMST   :DN-EST-AR-TMST           65680004
656900                 ,:VHTRIP-SPLT-XMIT-IND                           65690004
657000                 ,:VHTRIP-SPLT-XMIT-DTE                           65700004
657100                 ,:VHTRIP-SPLT-XMIT-TM                            65710004
657200            FROM   TVHTRIP                                        65720004
657300           WHERE   TRIP_ID       = :DK-TRIP-ID                    65730004
657400     END-EXEC.                                                    65740004
657500                                                                  65750004
657600     EVALUATE TRUE                                                65760004
657700         WHEN SQLCODE = +0                                        65770004
657800              CONTINUE                                            65780004
657900                                                                  65790004
658000         WHEN SQLCODE = -904                                      65800004
658100         WHEN SQLCODE = -913                                      65810004
658200              MOVE SQLCODE                TO PV-SOFT-SQLCODE      65820004
658300              MOVE '7120-INSERT-TAUTRIP ' TO PV-SOFT-PARAGRAPH    65830004
658400              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          65840004
658500              MOVE DP020-USERID           TO PV-USER              65850004
658600              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    65860004
658700              MOVE LENGTH OF PV-CICS-MSG-AREA2                    65870004
658800                                          TO PV-COMMAREA-LENGTH   65880004
658900              EXEC CICS                                           65890004
659000                   WRITEQ TD                                      65900004
659100                    QUEUE  ('CSSL')                               65910004
659200                     FROM  (PV-CICS-MSG-AREA2)                    65920004
659300                   LENGTH  (PV-COMMAREA-LENGTH)                   65930004
659400                     RESP  (PV-CICS-RESP)                         65940004
659500              END-EXEC                                            65950004
659600                                                                  65960004
659700              INITIALIZE PV-CICS-MSG-AREA2                        65970004
659800              MOVE DK-TRIP-ID               TO PV-DISP-TRIP-ID    65980004
659900              STRING ' RCKCS261 -'                                65990004
660000                     ' 7120-INSERT-TAUTRIP-'                      66000004
660100                     ' TRIP ID- '                                 66010004
660200                       PV-DISP-TRIP-ID         DELIMITED BY SIZE  66020004
660300                                          INTO PV-CICS-MSG-AREA2  66030004
660400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    66040004
660500                                            TO PV-COMMAREA-LENGTH 66050004
660600              EXEC CICS                                           66060004
660700                   WRITEQ TD                                      66070004
660800                    QUEUE  ('CSSL')                               66080004
660900                     FROM  (PV-CICS-MSG-AREA2)                    66090004
661000                   LENGTH  (PV-COMMAREA-LENGTH)                   66100004
661100                     RESP  (PV-CICS-RESP)                         66110004
661200              END-EXEC                                            66120004
661300                                                                  66130004
661400              INITIALIZE PV-CICS-MSG-AREA2                        66140004
661500              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         66150004
661600              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             66160004
661700              PERFORM 9900-SOFT-ABORT                             66170004
661800                                                                  66180004
661900         WHEN SQLWARN0 NOT = SPACES                               66190004
662000         WHEN SQLCODE < +0                                        66200004
662100         WHEN SQLCODE > +0                                        66210004
662200              MOVE SPACES TO PV-MESSAGE                           66220004
662300              MOVE VHTRIP-OWNER-SCAC-ID TO PV-MESSAGE1            66230004
662400              MOVE VHTRIP-VEH-NBR       TO PV-MESSAGE2            66240004
662410              MOVE VHTRIP-TRIP-ID       TO PV-MESSAGE3            66241004
662420              MOVE '7120-INSERT-TAUTRIP'                          66242004
662430                                TO DP013-PARAGRAPH                66243004
662440              MOVE 'SELECT A ROW ON TVHTRIP'                      66244004
662450                                TO DP013-MESSAGE-TEXT(1)          66245004
662460              MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)          66246004
662470              MOVE SQLCA        TO DP013-SQLCA                    66247004
662480              MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)       66248004
662490              SET DP013-DB2-ABEND                                 66249004
662500                  DP013-XCTL-DISPLAY-RESTART TO TRUE              66250004
662600              PERFORM DP013-0000-PROCESS-ABEND                    66260004
662700     END-EVALUATE.                                                66270004
662800                                                                  66280004
662900     MOVE 'CE'                     TO VHTRIP-CRT-SRC-CDE.         66290004
663000                                                                  66300004
663100     EXEC SQL                                                     66310004
663200          INSERT                                                  66320004
663300            INTO TAUTRIP                                          66330004
663400                 (OWNER_SCAC_ID                                   66340004
663500                 ,VEH_NBR                                         66350004
663600                 ,TRIP_ID                                         66360004
663700                 ,TRIP_BEG_DTE                                    66370004
663800                 ,TRIP_BEG_TME                                    66380004
663900                 ,CRT_SRC_CDE                                     66390004
664000                 ,LAST_UPD_DTE                                    66400004
664100                 ,LAST_UPD_TME                                    66410004
664200                 ,LAST_UPD_UID                                    66420004
664300                 ,MANIFEST_NBR                                    66430004
664400                 ,PLND_TRIP_SEQ                                   66440004
664500                 ,PLND_ACTVY_CDE                                  66450004
664600                 ,OWNR_SCAC_SHIP_DTE                              66460004
664700                 ,REF_TRIP_ID                                     66470004
664800                 ,EST_AR_TMST                                     66480004
664900                 ,AUD_STATUS_CDE                                  66490004
665000                 ,SPLT_XMIT_IND                                   66500004
665100                 ,SPLT_XMIT_DTE                                   66510004
665200                 ,SPLT_XMIT_TM)                                   66520004
665300          VALUES                                                  66530004
665400                 (:VHTRIP-OWNER-SCAC-ID                           66540004
665500                 ,:VHTRIP-VEH-NBR   :DN-VEH-NBR                   66550004
665600                 ,:VHTRIP-TRIP-ID                                 66560004
665700                 ,:VHTRIP-TRIP-BEG-DTE                            66570004
665800                 ,:VHTRIP-TRIP-BEG-TME                            66580004
665900                 ,:VHTRIP-CRT-SRC-CDE                             66590004
666000                 ,:VHTRIP-LAST-UPD-DTE                            66600004
666100                 ,:VHTRIP-LAST-UPD-TME                            66610004
666200                 ,:VHTRIP-LAST-UPD-UID                            66620004
666300                 ,:VHTRIP-MANIFEST-NBR                            66630004
666400                 ,:VHTRIP-PLND-TRIP-SEQ                           66640004
666500                 ,:VHTRIP-PLND-ACTVY-CDE                          66650004
666600                 ,:VHTRIP-OWNR-SCAC-SHIP-DTE                      66660004
666700                 ,:VHTRIP-REF-TRIP-ID                             66670004
666800                 ,:VHTRIP-EST-AR-TMST   :DN-EST-AR-TMST           66680004
666900                 ,:TRIPST-TRIP-STATUS-CDE                         66690004
667000                 ,:VHTRIP-SPLT-XMIT-IND                           66700004
667100                 ,:VHTRIP-SPLT-XMIT-DTE                           66710004
667200                 ,:VHTRIP-SPLT-XMIT-TM)                           66720004
667300     END-EXEC.                                                    66730004
667400                                                                  66740004
667500     EVALUATE TRUE                                                66750004
667600         WHEN SQLCODE = +0                                        66760004
667700              CONTINUE                                            66770004
667800                                                                  66780004
667900         WHEN SQLCODE = -904                                      66790004
668000         WHEN SQLCODE = -913                                      66800004
668100              MOVE SQLCODE                TO PV-SOFT-SQLCODE      66810004
668200              MOVE '7120-INSERT-TAUTRIP ' TO PV-SOFT-PARAGRAPH    66820004
668300              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          66830004
668400              MOVE DP020-USERID           TO PV-USER              66840004
668500              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    66850004
668600              MOVE LENGTH OF PV-CICS-MSG-AREA2                    66860004
668700                                          TO PV-COMMAREA-LENGTH   66870004
668800              EXEC CICS                                           66880004
668900                   WRITEQ TD                                      66890004
669000                    QUEUE  ('CSSL')                               66900004
669100                     FROM  (PV-CICS-MSG-AREA2)                    66910004
669200                   LENGTH  (PV-COMMAREA-LENGTH)                   66920004
669300                     RESP  (PV-CICS-RESP)                         66930004
669400              END-EXEC                                            66940004
669500                                                                  66950004
669600              INITIALIZE PV-CICS-MSG-AREA2                        66960004
669700              MOVE VHTRIP-TRIP-ID           TO PV-DISP-TRIP-ID    66970004
669800              STRING ' RCKCS261 -'                                66980004
669900                     '   SCAC:'             VHTRIP-OWNER-SCAC-ID  66990004
670000                     '   VEH:'              VHTRIP-VEH-NBR        67000004
670100                        'TRIP:'             PV-DISP-TRIP-ID       67010004
670200                     '   BEGIN:'            VHTRIP-TRIP-BEG-DTE   67020004
670300                     ' '                    VHTRIP-TRIP-BEG-TME   67030004
670400                     '   SRC:'              VHTRIP-CRT-SRC-CDE    67040004
670500                     '   UPD:'              VHTRIP-LAST-UPD-DTE   67050004
670600                     ' '                    VHTRIP-LAST-UPD-TME   67060004
670700                     ' '                    VHTRIP-LAST-UPD-UID   67070004
670800                                            DELIMITED BY SIZE     67080004
670900                                       INTO PV-CICS-MSG-AREA2     67090004
671000              MOVE LENGTH OF PV-CICS-MSG-AREA2                    67100004
671100                                         TO PV-COMMAREA-LENGTH    67110004
671200              EXEC CICS                                           67120004
671300                   WRITEQ TD                                      67130004
671400                    QUEUE  ('CSSL')                               67140004
671500                     FROM  (PV-CICS-MSG-AREA2)                    67150004
671600                   LENGTH  (PV-COMMAREA-LENGTH)                   67160004
671700                     RESP  (PV-CICS-RESP)                         67170004
671800              END-EXEC                                            67180004
671900                                                                  67190004
672000              INITIALIZE PV-CICS-MSG-AREA2                        67200004
672100              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         67210004
672200              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             67220004
672300              PERFORM 9900-SOFT-ABORT                             67230004
672400                                                                  67240004
672500         WHEN SQLWARN0 NOT = SPACES                               67250004
672600         WHEN SQLCODE < +0                                        67260004
672700         WHEN SQLCODE > +0                                        67270004
672800              MOVE SPACES TO PV-MESSAGE                           67280004
672900              MOVE VHTRIP-OWNER-SCAC-ID TO PV-MESSAGE1            67290004
673000              MOVE VHTRIP-VEH-NBR       TO PV-MESSAGE2            67300004
673100              MOVE VHTRIP-TRIP-ID       TO PV-MESSAGE3            67310004
673200              MOVE '7120-INSERT-TAUTRIP'                          67320004
673300                                TO DP013-PARAGRAPH                67330004
673400              MOVE 'INSERT A ROW ON TAUTRIP'                      67340004
673410                                TO DP013-MESSAGE-TEXT(1)          67341004
673411              MOVE PV-MESSAGE   TO DP013-MESSAGE-TEXT(2)          67341104
673412              MOVE SQLCA        TO DP013-SQLCA                    67341204
673413              MOVE 'TAUTRIP'    TO DP013-DB2-TABLE-NAME (1)       67341304
673414              SET DP013-DB2-ABEND                                 67341404
673415                  DP013-XCTL-DISPLAY-RESTART TO TRUE              67341504
673416              PERFORM DP013-0000-PROCESS-ABEND                    67341604
673417     END-EVALUATE.                                                67341704
673418                                                                  67341804
673419                                                                  67341904
673420*----------------------------------------------------------------*67342004
673430* OPEN THE SHIPST CURSOR.                                        *67343004
673440*----------------------------------------------------------------*67344004
673450                                                                  67345004
673460 7200-OPEN-CURSOR.                                                67346004
673470                                                                  67347004
673480     EXEC SQL                                                     67348004
673490          OPEN SHIPST-CSR                                         67349004
673500     END-EXEC.                                                    67350004
673600                                                                  67360004
673700     EVALUATE TRUE                                                67370004
673800         WHEN SQLCODE = ZERO                                      67380004
673900              CONTINUE                                            67390004
674000                                                                  67400004
674100         WHEN SQLCODE = -904                                      67410004
674200         WHEN SQLCODE = -913                                      67420004
674300              MOVE SQLCODE                TO PV-SOFT-SQLCODE      67430004
674400              MOVE '7200-OPEN-CURSOR'     TO PV-SOFT-PARAGRAPH    67440004
674500              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          67450004
674600              MOVE DP020-USERID           TO PV-USER              67460004
674700              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    67470004
674800              MOVE LENGTH OF PV-CICS-MSG-AREA2                    67480004
674900                                          TO PV-COMMAREA-LENGTH   67490004
675000              EXEC CICS                                           67500004
675100                   WRITEQ TD                                      67510004
675200                    QUEUE  ('CSSL')                               67520004
675300                     FROM  (PV-CICS-MSG-AREA2)                    67530004
675400                   LENGTH  (PV-COMMAREA-LENGTH)                   67540004
675500                     RESP  (PV-CICS-RESP)                         67550004
675600              END-EXEC                                            67560004
675700                                                                  67570004
675800              INITIALIZE PV-CICS-MSG-AREA2                        67580004
675900              MOVE  DK-SHIPT-ID        TO  PV-DISP-SHIPT-ID       67590004
676000              STRING ' RCKCS261 - '                               67600004
676100                     '   SHPMT ID:'       PV-DISP-SHIPT-ID        67610004
676200                                          DELIMITED BY SIZE       67620004
676300                                     INTO PV-CICS-MSG-AREA2       67630004
676400              MOVE LENGTH OF PV-CICS-MSG-AREA2                    67640004
676500                                       TO PV-COMMAREA-LENGTH      67650004
676600              EXEC CICS                                           67660004
676700                   WRITEQ TD                                      67670004
676800                    QUEUE  ('CSSL')                               67680004
676900                     FROM  (PV-CICS-MSG-AREA2)                    67690004
676910                   LENGTH  (PV-COMMAREA-LENGTH)                   67691004
676920                     RESP  (PV-CICS-RESP)                         67692004
676930              END-EXEC                                            67693004
676940                                                                  67694004
676950              INITIALIZE PV-CICS-MSG-AREA2                        67695004
676960              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         67696004
676970              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             67697004
676980              PERFORM 9900-SOFT-ABORT                             67698004
676990                                                                  67699004
677000         WHEN SQLWARN0 NOT = SPACES                               67700004
677100         WHEN SQLCODE < ZERO                                      67710004
677200         WHEN SQLCODE > ZERO                                      67720004
677300              MOVE '7200-OPEN-CURSOR'                             67730004
677400                                TO DP013-PARAGRAPH                67740004
677500              MOVE 'OPEN SHIPST CURSOR - '                        67750004
677600                                TO DP013-MESSAGE-TEXT (1)         67760004
677700              MOVE SQLCA        TO DP013-SQLCA                    67770004
677800              MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (1)       67780004
677900              SET DP013-DB2-ABEND                                 67790004
678000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              67800004
678100              PERFORM DP013-0000-PROCESS-ABEND                    67810004
678200     END-EVALUATE.                                                67820004
678300                                                                  67830004
678400                                                                  67840004
678500*----------------------------------------------------------------*67850004
678600* CLOSE THE TMESSAGE CURSOR.                                     *67860004
678700*----------------------------------------------------------------*67870004
678800                                                                  67880004
678900 7230-CLOSE-CURSOR.                                               67890004
679000     EXEC SQL                                                     67900004
679100         CLOSE SHIPST-CSR                                         67910004
679200     END-EXEC.                                                    67920004
679300                                                                  67930004
679400                                                                  67940004
679500     EVALUATE TRUE                                                67950004
679600         WHEN SQLCODE = ZERO                                      67960004
679700             CONTINUE                                             67970004
679800         WHEN SQLWARN0 NOT = SPACES                               67980004
679900         WHEN SQLCODE < ZERO                                      67990004
680000         WHEN SQLCODE > ZERO                                      68000004
680100             MOVE '7230-CLOSE-CURSOR'                             68010004
680200                               TO DP013-PARAGRAPH                 68020004
680300             MOVE 'CLOSE SHPTPO CURSOR '                          68030004
680400                               TO DP013-MESSAGE-TEXT (1)          68040004
680500             MOVE SQLCA        TO DP013-SQLCA                     68050004
680600             MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (1)        68060004
680700             SET DP013-DB2-ABEND                                  68070004
680800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               68080004
680900             PERFORM DP013-0000-PROCESS-ABEND                     68090004
681000     END-EVALUATE.                                                68100004
681100                                                                  68110004
681200                                                                  68120004
681300 7260-FETCH-CURSOR.                                               68130004
681400                                                                  68140004
681500     EXEC SQL                                                     68150004
681600          FETCH SHIPST-CSR                                        68160004
681700           INTO  :SHIPST-SHIPT-STATUS-CDE                         68170004
681800     END-EXEC.                                                    68180004
681900                                                                  68190004
682000     EVALUATE TRUE                                                68200004
682100         WHEN SQLCODE = +0                                        68210004
682200              CONTINUE                                            68220004
682300                                                                  68230004
682400         WHEN SQLCODE = -904                                      68240004
682500         WHEN SQLCODE = -913                                      68250004
682600              MOVE SQLCODE               TO PV-SOFT-SQLCODE       68260004
682700              MOVE '7260-FETCH-CURSOR'   TO PV-SOFT-PARAGRAPH     68270004
682800              MOVE ASC-KEY-OPER-UNT-ID-N TO PV-LOCATION           68280004
682900              MOVE DP020-USERID          TO PV-USER               68290004
683000              MOVE PV-SOFT-ABORT-MSG     TO PV-CICS-MSG-AREA2     68300004
683100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    68310004
683200                                         TO PV-COMMAREA-LENGTH    68320004
683300              EXEC CICS                                           68330004
683400                 WRITEQ TD                                        68340004
683500                  QUEUE  ('CSSL')                                 68350004
683600                   FROM  (PV-CICS-MSG-AREA2)                      68360004
683700                 LENGTH  (PV-COMMAREA-LENGTH)                     68370004
683800                   RESP  (PV-CICS-RESP)                           68380004
683900              END-EXEC                                            68390004
684000                                                                  68400004
684100              INITIALIZE PV-CICS-MSG-AREA2                        68410004
684200              MOVE  DK-SHIPT-ID        TO  PV-DISP-SHIPT-ID       68420004
684300              STRING ' RCKCS261 - '                               68430004
684400                     '   SHPMT ID:'       PV-DISP-SHIPT-ID        68440004
684500                                          DELIMITED BY SIZE       68450004
684510                                     INTO PV-CICS-MSG-AREA2       68451004
684520              MOVE LENGTH OF PV-CICS-MSG-AREA2                    68452004
684530                                       TO PV-COMMAREA-LENGTH      68453004
684540              EXEC CICS                                           68454004
684550                   WRITEQ TD                                      68455004
684560                    QUEUE  ('CSSL')                               68456004
684570                     FROM  (PV-CICS-MSG-AREA2)                    68457004
684580                   LENGTH  (PV-COMMAREA-LENGTH)                   68458004
684581                     RESP  (PV-CICS-RESP)                         68458104
684582              END-EXEC                                            68458204
684583                                                                  68458304
684584              INITIALIZE PV-CICS-MSG-AREA2                        68458404
684585              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         68458504
684586              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             68458604
684587              PERFORM 9900-SOFT-ABORT                             68458704
684588                                                                  68458804
684589         WHEN SQLCODE = +100                                      68458904
684590              SET PS-END-OF-STATUS-CURSOR TO TRUE                 68459004
684600                                                                  68460004
684700         WHEN SQLWARN0 NOT = SPACES                               68470004
684800         WHEN SQLCODE < +0                                        68480004
684900         WHEN SQLCODE > +0                                        68490004
685000              MOVE '7260-FETCH-CURSOR'                            68500004
685100                              TO DP013-PARAGRAPH                  68510004
685200              MOVE 'UNSUCCESSFUL FETCH ON TSHIPST CURSOR'         68520004
685300                              TO DP013-MESSAGE-TEXT (1)           68530004
685400              MOVE SQLCA      TO DP013-SQLCA                      68540004
685500              MOVE 'TSHIPST ' TO DP013-DB2-TABLE-NAME (1)         68550004
685600              SET DP013-DB2-ABEND                                 68560004
685700                  DP013-XCTL-DISPLAY-RESTART                      68570004
685800                              TO TRUE                             68580004
685900              PERFORM DP013-0000-PROCESS-ABEND                    68590004
686000     END-EVALUATE.                                                68600004
686100                                                                  68610004
686200     IF SQLCODE = +0                                              68620004
686300         PERFORM 7290-DELETE-SHIPST                               68630004
686400     END-IF.                                                      68640004
686500                                                                  68650004
686600 7290-DELETE-SHIPST.                                              68660004
686700                                                                  68670004
686800     EXEC SQL                                                     68680004
686900          DELETE                                                  68690004
687000            FROM  TSHIPST                                         68700004
687100           WHERE  SHIPT_ID         = :DK-SHIPT-ID                 68710004
687200             AND  SHIPT_STATUS_CDE = :SHIPST-SHIPT-STATUS-CDE     68720004
687300     END-EXEC.                                                    68730004
687400                                                                  68740004
687500     EVALUATE TRUE                                                68750004
687600         WHEN SQLCODE = +0                                        68760004
687700              CONTINUE                                            68770004
687800         WHEN SQLCODE = -904                                      68780004
687900         WHEN SQLCODE = -913                                      68790004
688000              MOVE SQLCODE                TO PV-SOFT-SQLCODE      68800004
688100              MOVE '7290-DELETE-SHIPST  ' TO PV-SOFT-PARAGRAPH    68810004
688200              MOVE ASC-KEY-OPER-UNT-ID-N  TO PV-LOCATION          68820004
688300              MOVE DP020-USERID           TO PV-USER              68830004
688400              MOVE PV-SOFT-ABORT-MSG      TO PV-CICS-MSG-AREA2    68840004
688500              MOVE LENGTH OF PV-CICS-MSG-AREA2                    68850004
688600                                          TO PV-COMMAREA-LENGTH   68860004
688700              EXEC CICS                                           68870004
688800                   WRITEQ TD                                      68880004
688900                    QUEUE  ('CSSL')                               68890004
689000                     FROM  (PV-CICS-MSG-AREA2)                    68900004
689100                   LENGTH  (PV-COMMAREA-LENGTH)                   68910004
689200                     RESP  (PV-CICS-RESP)                         68920004
689300              END-EXEC                                            68930004
689400                                                                  68940004
689500              INITIALIZE PV-CICS-MSG-AREA2                        68950004
689600              MOVE DK-SHIPT-ID         TO PV-DISP-SHIPT-ID        68960004
689700              STRING ' RCKCS261 -'                                68970004
689800                     '   SHPMT ID:'       PV-DISP-SHIPT-ID        68980004
689900                     '   STATUS:'         SHIPST-SHIPT-STATUS-CDE 68990004
690000                                          DELIMITED BY SIZE       69000004
690100                                     INTO PV-CICS-MSG-AREA2       69010004
690110              MOVE LENGTH OF PV-CICS-MSG-AREA2                    69011004
690120                                       TO PV-COMMAREA-LENGTH      69012004
690130              EXEC CICS                                           69013004
690140                   WRITEQ TD                                      69014004
690150                    QUEUE  ('CSSL')                               69015004
690160                     FROM  (PV-CICS-MSG-AREA2)                    69016004
690170                   LENGTH  (PV-COMMAREA-LENGTH)                   69017004
690180                     RESP  (PV-CICS-RESP)                         69018004
690190              END-EXEC                                            69019004
690200                                                                  69020004
690300              INITIALIZE PV-CICS-MSG-AREA2                        69030004
690400              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         69040004
690500              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             69050004
690600              PERFORM 9900-SOFT-ABORT                             69060004
690700                                                                  69070004
690800         WHEN SQLWARN0 NOT = SPACES                               69080004
690900         WHEN SQLCODE < +0                                        69090004
691000         WHEN SQLCODE > +0                                        69100004
691100              MOVE '7290-DELETE-SHIPST'                           69110004
691101                                TO DP013-PARAGRAPH                69110104
691102              MOVE 'DELETE INFO ON TSHIPST     '                  69110204
691103                                TO DP013-MESSAGE-TEXT(1)          69110304
691104              MOVE SQLCA        TO DP013-SQLCA                    69110404
691105              MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)       69110504
691106              SET DP013-DB2-ABEND                                 69110604
691107                  DP013-XCTL-DISPLAY-RESTART TO TRUE              69110704
691108              PERFORM DP013-0000-PROCESS-ABEND                    69110804
691109     END-EVALUATE.                                                69110904
691110                                                                  69111004
691120                                                                  69112004
691130*----------------------------------------------------------------*69113004
691140*  UPDATE THE CURRENT TRIP ID ON TSHIPMT                         *69114004
691150*----------------------------------------------------------------*69115004
691160 7500-UPDATE-TSHIPMT.                                             69116004
691170                                                                  69117004
691180     EXEC SQL                                                     69118004
691190          UPDATE TSHIPMT                                          69119004
691200             SET LAST_UPD_DTE    = CURRENT DATE                   69120004
691300               , LAST_UPD_TME    = CURRENT TIME                   69130004
691400               , LAST_UPD_UID    = :DP020-USERID                  69140004
691500               , TRIP_ID         = :PV-TRIP-ID                    69150004
691600               , LAST_UPD_PGM_ID = :PC-CURRENT-PROGRAM-NAME       69160004
691700          WHERE  SHIPT_ID        = :DK-SHIPT-ID                   69170004
691800     END-EXEC.                                                    69180004
691900                                                                  69190004
692000     EVALUATE TRUE                                                69200004
692100         WHEN SQLCODE = +0                                        69210004
692200              CONTINUE                                            69220004
692300                                                                  69230004
692400         WHEN SQLCODE = -904                                      69240004
692500         WHEN SQLCODE = -913                                      69250004
692600              MOVE SQLCODE               TO PV-SOFT-SQLCODE       69260004
692700              MOVE '7500-UPDATE-TSHIPMT' TO PV-SOFT-PARAGRAPH     69270004
692800              MOVE ASC-KEY-OPER-UNT-ID-N TO PV-LOCATION           69280004
692900              MOVE DP020-USERID          TO PV-USER               69290004
693000              MOVE PV-SOFT-ABORT-MSG     TO PV-CICS-MSG-AREA2     69300004
693100              MOVE LENGTH OF PV-CICS-MSG-AREA2                    69310004
693200                                         TO PV-COMMAREA-LENGTH    69320004
693300              EXEC CICS                                           69330004
693400                 WRITEQ TD                                        69340004
693500                  QUEUE  ('CSSL')                                 69350004
693600                   FROM  (PV-CICS-MSG-AREA2)                      69360004
693700                 LENGTH  (PV-COMMAREA-LENGTH)                     69370004
693800                   RESP  (PV-CICS-RESP)                           69380004
693900              END-EXEC                                            69390004
694000                                                                  69400004
694100              INITIALIZE PV-CICS-MSG-AREA2                        69410004
694200              MOVE PV-TRIP-ID               TO PV-DISP-TRIP-ID    69420004
694300              MOVE DK-SHIPT-ID              TO PV-DISP-SHIPT-ID   69430004
694400              STRING ' RCKCS261 -'                                69440004
694500                     '    TRIP:'               PV-DISP-TRIP-ID    69450004
694600                     '   SHPMT ID:'            PV-DISP-SHIPT-ID   69460004
694700                                               DELIMITED BY SIZE  69470004
694800                                          INTO PV-CICS-MSG-AREA2  69480004
694900              MOVE LENGTH OF PV-CICS-MSG-AREA2                    69490004
695000                                            TO PV-COMMAREA-LENGTH 69500004
695100              EXEC CICS                                           69510004
695200                   WRITEQ TD                                      69520004
695300                    QUEUE  ('CSSL')                               69530004
695400                     FROM  (PV-CICS-MSG-AREA2)                    69540004
695500                   LENGTH  (PV-COMMAREA-LENGTH)                   69550004
695600                     RESP  (PV-CICS-RESP)                         69560004
695700              END-EXEC                                            69570004
695800                                                                  69580004
695900              INITIALIZE PV-CICS-MSG-AREA2                        69590004
696000              MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER         69600004
696100              SET  DP030-SET-CURSOR-APPL-1    TO TRUE             69610004
696200              PERFORM 9900-SOFT-ABORT                             69620004
696300                                                                  69630004
696400         WHEN SQLWARN0 NOT = SPACES                               69640004
696500         WHEN SQLCODE < +0                                        69650004
696600         WHEN SQLCODE > +0                                        69660004
696700              MOVE '7500-UPDATE-TSHIPMT'                          69670004
696800                                TO DP013-PARAGRAPH                69680004
696900              MOVE 'UPDATE TRIP ID ON TSHIPMT'                    69690004
697000                                TO DP013-MESSAGE-TEXT(1)          69700004
697100              MOVE SHIPMT-SHIPT-ID TO DP013-MESSAGE-TEXT(2)       69710004
697200              MOVE SQLCA        TO DP013-SQLCA                    69720004
697300              MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)       69730004
697400              SET DP013-DB2-ABEND                                 69740004
697410                  DP013-XCTL-DISPLAY-RESTART TO TRUE              69741004
697420              PERFORM DP013-0000-PROCESS-ABEND                    69742004
697430     END-EVALUATE.                                                69743004
697440                                                                  69744004
697450* JAK 04/2007 - START - ADD WMS CODE                              69745004
697460*----------------------------------------------------------------*69746004
697470*  CHECK TO SEE IF THE RECEIVER NEEDS TO BE PROCESSED THRU THE    69747004
697480*  WMS VENDOR SHIPMENT CONTROL MODULE.                            69748004
697490*----------------------------------------------------------------*69749004
697500 8000-WMS-SHIPMENT-CHECK.                                         69750004
697600                                                                  69760004
697700*    CHECK TO SEE IF THE DC IS DOWNLOADING TO WMS                 69770004
697800*    IF THE DC IS DOWNLOADING                                     69780004
697900*        CHECK TO SEE IF THERE ARE TRANSCRIBED RCVRS ON THE SHIP  69790004
698000*        IF THERE ARE TRANSCRIBED RCVRS                           69800004
698100*           CHECK TO SEE IF RECEIVING HAS BEGUN ON THE TRAILER    69810004
698200*               IF RECEIVING HAS BEGUN                            69820004
698300*               & PS-WMS-DETACH                                   69830004
698400*                   RETURN WITH MESSAGE 3543                      69840004
698500*               ELSE                                              69850004
698600*                   DOWNLOAD TO ASN                               69860004
698700*                   IF PS-WMS-INSERT                              69870004
698800*                       RETURN WITH MESSAGE 3533                  69880004
698900*                   ELSE                                          69890004
699000*                       RETURN WITH MESSAGE 3561                  69900004
699100*        ELSE IF THERE ARE NO TRANSCRIBED RCVRS                   69910004
699200*            IF PS-WMS-INSERT                                     69920004
699300*                RETURN WITH MESSAGE 3534                         69930004
699400*            ELSE                                                 69940004
699500*                RETURN WITH MESSAGE 3561                         69950004
699600                                                                  69960004
699601     INITIALIZE PS-ASNS-TO-WMS-SW.                                69960104
699602     INITIALIZE PS-MSGS-TRNSCRB-SW.                               69960204
699603     INITIALIZE PS-RECEIVING-BEGUN-SW.                            69960304
699604     INITIALIZE PS-WMS-MESSAGE-SW.                                69960404
699605     MOVE ASC-KEY-OPER-UNT-ID-N TO DK-OPER-UNT-ID.                69960504
699606                                                                  69960604
699607     PERFORM 8010-CHECK-TKRPRPM.                                  69960704
699608     IF PS-ASNS-TO-WMS-YES                                        69960804
699609         PERFORM 8020-RCVR-TRANSCRIBED                            69960904
699610         IF PS-MSGS-TRNSCRB-YES                                   69961004
699620             PERFORM 8030-CHECK-RECEIVING                         69962004
699621* JAK 08/2007 - ERROR 3543 ONLY APPLIES TO DETACH                 69962104
699622             IF PS-RECEIVING-BEGUN-YES                            69962204
699623             AND PS-WMS-DETACH                                    69962304
699624                 MOVE PC-TSYMSG-03543      TO DP020-MSG-NUMBER    69962404
699625                 SET DP020-MSG-WARNING     TO TRUE                69962504
699626                 SET PS-COMMAREA-NOT-VALID TO TRUE                69962604
699627                 SET PS-WMS-MESSAGE-YES    TO TRUE                69962704
699628* JAK 08/2007 - ADD PS-ERROR SWITCH                               69962804
699629                 SET PS-ERROR              TO TRUE                69962904
699630             ELSE                                                 69963004
699631                 PERFORM 8040-CALL-WMS-MODULE                     69963104
699632                 IF PS-NO-ERROR                                   69963204
699633                    IF PS-WMS-INSERT                              69963304
699634                        MOVE PC-TSYMSG-03533  TO DP020-MSG-NUMBER 69963404
699635                    ELSE                                          69963504
699636                        MOVE PC-TSYMSG-03561  TO DP020-MSG-NUMBER 69963604
699637                    END-IF                                        69963704
699638                    SET DP020-MSG-INFORMATIONAL TO TRUE           69963804
699639                    SET PS-WMS-MESSAGE-YES    TO TRUE             69963904
699640                 END-IF                                           69964004
699641             END-IF                                               69964104
699642         ELSE                                                     69964204
699643             IF PS-WMS-INSERT                                     69964304
699644                 MOVE PC-TSYMSG-03534         TO DP020-MSG-NUMBER 69964404
699645             ELSE                                                 69964504
699646                 MOVE PC-TSYMSG-03561  TO DP020-MSG-NUMBER        69964604
699647             END-IF                                               69964704
699648             SET DP020-MSG-INFORMATIONAL   TO TRUE                69964804
699649             SET PS-WMS-MESSAGE-YES        TO TRUE                69964904
699650         END-IF                                                   69965004
699651     END-IF.                                                      69965104
699652                                                                  69965204
699653*----------------------------------------------------------------*69965304
699654*  CHECK PARM TABLE TO SEE IF DC IS TURNED ON TO DOWNLOAD ASN'S   69965404
699655*  TO WMS.                                                        69965504
699656*----------------------------------------------------------------*69965604
699657 8010-CHECK-TKRPRPM.                                              69965704
699658                                                                  69965804
699659     EXEC SQL                                                     69965904
699660          SELECT   FUNC_TXT                                       69966004
699661            INTO  :KRPRPM-FUNC-TXT                                69966104
699662            FROM                                                  69966204
699663                  TKRPRPM A                                       69966304
699664            WHERE                                                 69966404
699665                  LOC_ID            = :DK-OPER-UNT-ID             69966504
699666              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    69966604
699667              AND FUNC_PRC_STAT_CDE = 'AC'                        69966704
699668              AND INTFC_SYS_CDE     = 'KHL'                       69966804
699669              AND FUNC_TXT          = 'Y'                         69966904
699670              AND FUNC_BEG_TMST    < CURRENT TIMESTAMP            69967004
699671     END-EXEC.                                                    69967104
699672                                                                  69967204
699673     EVALUATE TRUE                                                69967304
699674         WHEN SQLCODE = ZERO                                      69967404
699675             SET PS-ASNS-TO-WMS-YES    TO TRUE                    69967504
699676         WHEN SQLCODE = +100                                      69967604
699677             SET PS-ASNS-TO-WMS-NO     TO TRUE                    69967704
699678         WHEN SQLWARN0 NOT = SPACES                               69967804
699679         WHEN SQLCODE  NOT = ZERO                                 69967904
699680             MOVE '8010-CHECK-TKRPRPM'                            69968004
699681                                 TO DP013-PARAGRAPH               69968104
699682             MOVE 'SELECT A TKRPRPM ROW   '                       69968204
699683                                 TO DP013-MESSAGE-TEXT(1)         69968304
699684             MOVE DK-OPER-UNT-ID TO DP013-MESSAGE-TEXT(2)         69968404
699685             MOVE SQLCA          TO DP013-SQLCA                   69968504
699686             MOVE 'TKRPRPM'      TO DP013-DB2-TABLE-NAME (1)      69968604
699687             SET DP013-DB2-ABEND                                  69968704
699688                 DP013-XCTL-DISPLAY-RESTART TO TRUE               69968804
699689             SET PS-WMS-MESSAGE-YES        TO TRUE                69968904
699690             PERFORM DP013-0000-PROCESS-ABEND                     69969004
699691     END-EVALUATE.                                                69969104
699692                                                                  69969204
699693                                                                  69969304
699694*----------------------------------------------------------------*69969404
699695*  CHECK TO SEE IF ANY OF THE RECEIVERS HAVE BEEN TRANSCRIBED     69969504
699696*----------------------------------------------------------------*69969604
699697 8020-RCVR-TRANSCRIBED.                                           69969704
699698                                                                  69969804
699699     EXEC SQL                                                     69969904
699700          SELECT   A.TRIP_ID                                      69970004
699701            INTO  :SHIPMT-TRIP-ID                                 69970104
699702            FROM                                                  69970204
699703                  TSHIPMT A                                       69970304
699704                 ,TSHPTPO B                                       69970404
699705                 ,TPKSLIP C                                       69970504
699706            WHERE                                                 69970604
699707                  A.SHIPT_ID        = :DK-SHIPT-ID                69970704
699708              AND A.SHIPT_ID        = B.SHIPT_ID                  69970804
699709              AND B.PO_NBR          = C.PO_NBR                    69970904
699710              AND B.REC_SEQ_NBR     = C.REC_SEQ_NBR               69971004
699711              AND C.VER_STAT_CDE    = 'A'                         69971104
699712              AND C.PKSL_STAT_CDE   = 'AC'                        69971204
699713     END-EXEC.                                                    69971304
699714                                                                  69971404
699715     EVALUATE TRUE                                                69971504
699716         WHEN SQLCODE = ZERO                                      69971604
699717         WHEN SQLCODE = -811                                      69971704
699718             SET PS-MSGS-TRNSCRB-YES   TO TRUE                    69971804
699719         WHEN SQLCODE = +100                                      69971904
699720             SET PS-MSGS-TRNSCRB-NO    TO TRUE                    69972004
699721         WHEN SQLWARN0 NOT = SPACES                               69972104
699722         WHEN SQLCODE  NOT = ZERO                                 69972204
699723             MOVE '8020-RCVR-TRANSCRIBED'                         69972304
699724                                 TO DP013-PARAGRAPH               69972404
699725             MOVE 'SELECT TRANSCRIBED RCVR COUNT'                 69972504
699726                                 TO DP013-MESSAGE-TEXT(1)         69972604
699727             MOVE DK-SHIPT-ID    TO DP013-MESSAGE-TEXT(2)         69972704
699728             MOVE SQLCA          TO DP013-SQLCA                   69972804
699729             MOVE 'TSHIPMT'      TO DP013-DB2-TABLE-NAME (1)      69972904
699730             MOVE 'TSHPTPO'      TO DP013-DB2-TABLE-NAME (2)      69973004
699731             MOVE 'TPKSLIP'      TO DP013-DB2-TABLE-NAME (3)      69973104
699732             SET DP013-DB2-ABEND                                  69973204
699733                 DP013-XCTL-DISPLAY-RESTART TO TRUE               69973304
699734             SET PS-WMS-MESSAGE-YES        TO TRUE                69973404
699735             PERFORM DP013-0000-PROCESS-ABEND                     69973504
699736     END-EVALUATE.                                                69973604
699737                                                                  69973704
699738                                                                  69973804
699739*----------------------------------------------------------------*69973904
699740*  CHECK TO SEE IF RECEIVING HAS BEGUN ON THE TRAILER             69974004
699741*----------------------------------------------------------------*69974104
699742 8030-CHECK-RECEIVING.                                            69974204
699743                                                                  69974304
699744     EXEC SQL                                                     69974404
699745         SELECT                                                   69974504
699746                 EXT_SHP_ID                                       69974604
699747         INTO                                                     69974704
699748                :WST00001-EXT-SHP-ID                              69974804
699749         FROM                                                     69974904
699750                 WST_SHPMT_XREF_HDR                               69975004
699751         WHERE   INTR_TRIP_ID  = :DK-TRIP-ID                      69975104
699752         AND     SOR_CDE       = 'RC'                             69975204
699753         AND     RCPT_TMST     <> :PC-DEFAULT-NINES               69975304
699754     END-EXEC.                                                    69975404
699755                                                                  69975504
699756     EVALUATE TRUE                                                69975604
699757         WHEN SQLCODE = ZERO                                      69975704
699758         WHEN SQLCODE = -811                                      69975804
699759             SET PS-RECEIVING-BEGUN-YES  TO TRUE                  69975904
699760         WHEN SQLCODE = +100                                      69976004
699761             SET PS-RECEIVING-BEGUN-NO   TO TRUE                  69976104
699762         WHEN SQLWARN0 NOT = SPACES                               69976204
699763         WHEN SQLCODE  NOT = ZERO                                 69976304
699764             MOVE '8030-CHECK-RECEIVING'                          69976404
699765                                   TO DP013-PARAGRAPH             69976504
699766             MOVE 'SELECT RECEIVED COUNT'                         69976604
699767                                   TO DP013-MESSAGE-TEXT(1)       69976704
699768             MOVE DK-TRIP-ID       TO DP013-MESSAGE-TEXT(2)       69976804
699769             MOVE SQLCA            TO DP013-SQLCA                 69976904
699770             MOVE 'WST_SHPMT_XREF_HDR'                            69977004
699771                                   TO DP013-DB2-TABLE-NAME (1)    69977104
699772             SET DP013-DB2-ABEND                                  69977204
699773                 DP013-XCTL-DISPLAY-RESTART TO TRUE               69977304
699774             SET PS-WMS-MESSAGE-YES        TO TRUE                69977404
699775             PERFORM DP013-0000-PROCESS-ABEND                     69977504
699776     END-EVALUATE.                                                69977604
699777                                                                  69977704
699778                                                                  69977804
699779*----------------------------------------------------------------*69977904
699780* CALL TO WMS VENDOR SHIPMENT CONTROL MODULE (WSKCS305) USING     69978004
699781*  COPYBOOK WSWS001.                                              69978104
699782*----------------------------------------------------------------*69978204
699783 8040-CALL-WMS-MODULE.                                            69978304
699784                                                                  69978404
699785     IF PS-WMS-INSERT                                             69978504
699786         SET WS001-INSERT        TO TRUE                          69978604
699787     ELSE                                                         69978704
699788         SET WS001-SHIPMT-DETACH TO TRUE                          69978804
699789     END-IF.                                                      69978904
699790                                                                  69979004
699791     MOVE DK-TRIP-ID             TO WS001-TRIP-ID.                69979104
699792     MOVE 'RC'                   TO WS001-SHIPMENT-SOURCE.        69979204
699793     MOVE DK-SHIPT-ID            TO WS001-KOHLS-SHIPT-ID.         69979304
699794     MOVE DK-OPER-UNT-ID         TO WS001-OPER-UNT-ID.            69979404
699795     MOVE DP020-USERID           TO WS001-USER-ID.                69979504
699796*    MOVE DK-PO-NBR              TO WS001-PO-NBR.                 69979604
699797*    MOVE DK-REC-SEQ-NBR         TO WS001-RCVR-NBR.               69979704
699798     MOVE ZEROS                  TO WS001-PO-NBR.                 69979804
699799     MOVE ZEROS                  TO WS001-RCVR-NBR.               69979904
699800     MOVE ZEROS                  TO WS001-PO-LNE-NBR.             69980004
699801     MOVE ZEROS                  TO WS001-PREPK-ID.               69980104
699802     MOVE ZEROS                  TO WS001-SKU-NBR.                69980204
699803     MOVE SPACES                 TO WS001-DTL-ASN-LEVEL-IND.      69980304
699804     MOVE 'RCKCS261'             TO WS001-CALLING-PROGRAM-NAME.   69980404
699805     MOVE DP020-SRC-TASK-NUMBER  TO WS001-SRC-TASK-NUMBER.        69980504
699806                                                                  69980604
699807                                                                  69980704
699808     MOVE LENGTH OF WS001-FIELDS TO PV-COMMAREA-LENGTH.           69980804
699809     EXEC CICS                                                    69980904
699810         LINK PROGRAM  (PC-WMS-CONTROL-MOD)                       69981004
699811              COMMAREA (WS001-FIELDS)                             69981104
699812              LENGTH   (PV-COMMAREA-LENGTH)                       69981204
699813     END-EXEC.                                                    69981304
699814                                                                  69981404
699815     EVALUATE TRUE                                                69981504
699816         WHEN WS001-SUCCESSFUL                                    69981604
699817             CONTINUE                                             69981704
699818         WHEN WS001-INVALID-SQL                                   69981804
699819         WHEN WS001-DATABASE-BUSY                                 69981904
699820             MOVE PC-TSYMSG-03546  TO DP020-MSG-NUMBER            69982004
699821             MOVE '8040-CALL-WMS-MODULE'                          69982104
699822                                   TO DP013-PARAGRAPH             69982204
699823             MOVE 'UNABLE TO CALL WMS CONTROL MOD'                69982304
699824                                   TO DP013-MESSAGE-TEXT (1)      69982404
699825             MOVE WS001-CRA-RET-MSG                               69982504
699826                                   TO DP013-MESSAGE-TEXT (2)      69982604
699827             SET DP013-DB2-ABEND                                  69982704
699828                 DP013-XCTL-DISPLAY-RESTART                       69982804
699829                                             TO TRUE              69982904
699830             SET PS-ERROR                    TO TRUE              69983004
699831             SET PS-WMS-MESSAGE-YES        TO TRUE                69983104
699832*            PERFORM DP013-0000-PROCESS-ABEND                     69983204
699833         WHEN OTHER                                               69983304
699834             MOVE PC-TSYMSG-03548  TO DP020-MSG-NUMBER            69983404
699835             MOVE '8040-CALL-WMS-MODULE'                          69983504
699836                                   TO DP013-PARAGRAPH             69983604
699837             MOVE 'INVALID RETURN FROM WMS CONTROL MOD'           69983704
699838                                   TO DP013-MESSAGE-TEXT (1)      69983804
699839             MOVE WS001-CRA-RET-MSG                               69983904
699840                         TO DP013-MESSAGE-TEXT (2)                69984004
699841             SET DP013-DB2-ABEND                                  69984104
699842                 DP013-XCTL-DISPLAY-RESTART                       69984204
699843                                             TO TRUE              69984304
699844             SET PS-ERROR                    TO TRUE              69984404
699845             SET PS-WMS-MESSAGE-YES        TO TRUE                69984504
699846*            PERFORM DP013-0000-PROCESS-ABEND                     69984604
699847     END-EVALUATE.                                                69984704
699848                                                                  69984804
699849* JAK 04/2007 - END - ADD WMS CODE                                69984904
699850                                                                  69985004
699860*----------------------------------------------------------------*69986004
699870*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *69987004
699880*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *69988004
699890*----------------------------------------------------------------*69989004
699900 9900-SOFT-ABORT.                                                 69990004
700000                                                                  70000004
700100     EXEC CICS SYNCPOINT                                          70010004
700200          ROLLBACK                                                70020004
700300     END-EXEC.                                                    70030004
700400                                                                  70040004
700500     SET  PS-ERROR                                                70050004
700501          DP020-MSG-FATAL       TO  TRUE.                         70050104
700502     MOVE 'PROGRAM EXIT CALL'   TO DP013-MESSAGE-TEXT (1).        70050204
700503     PERFORM 0001-CALL-CICS-ARCH-API.                             70050304
700504                                                                  70050404
700505                                                                  70050504
700506                                                                  70050604
700507 EJECT                                                            70050704
700508*----------------------------------------------------------------*70050804
700509*    ABEND PROCESSOR MODULE                                      *70050904
700510*----------------------------------------------------------------*70051004
700511                                                                  70051104
700512     COPY DPPD013.                                                70051204
