000100***************************************************************** 00010041
000200 IDENTIFICATION DIVISION.                                         00020041
000300***************************************************************** 00030041
000400                                                                  00040041
000500 PROGRAM-ID.             TCKUT025.                                00050041
000600 AUTHOR.                 COGNIZANT.                               00060041
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070041
000800 DATE-WRITTEN            APRIL 2015.                              00080041
000900 DATE-COMPILED.                                                   00090041
001000                                                                  00100041
001100***************************************************************** 00110041
001200*  PURPOSE:                                                       00120041
001300*  THE PROGRAM WILL TOKENIZE THE BELOW CARD NUMBER FIELD IN       00130041
001400*  MERCHANT ACTIVITY FILE IN ORDER TO ADHERE TO THE CURRENT PCI   00140041
001500*  AND PII DATA STANDARDS                                         00150041
001600*  1) TC001-CARD-NBR                                              00160041
001700*  PROTEGRITY MODULE WILL BE INVOKED TO TOKENIZE THE CARD NUMBER  00170041
001800*                                                                 00180041
001900*  INPUT:  MERCHANT ACTIVITY FILE                                 00190041
002000*  OUTPUT: MERCHANT ACTIVITY FILE WITH TOKENIZED CARD NUMBER      00200041
002100*                                                                 00210041
002200***************************************************************** 00220041
002300*----------------------------------------------------------------*00230041
002400*                                                                *00240041
002500* DATE:        03/24/2015                                        *00250041
002600* WR/IR#:      CHG0104429                                        *00260041
002700* PROGRAMMER:  COGNIZANT                                         *00270041
002800* DESCRIPTION: INITIAL VERSION CREATED FOR COSA DATA SECURITY    *00280041
002900*              PROJECT                                           *00290041
003000*                                                                *00300041
003100*----------------------------------------------------------------*00310041
003200***************************************************************** 00320041
003300 ENVIRONMENT DIVISION.                                            00330041
003400***************************************************************** 00340041
003500                                                                  00350041
003600 CONFIGURATION SECTION.                                           00360041
003700                                                                  00370041
003800 SOURCE-COMPUTER.        IBM-3090.                                00380041
003900                                                                  00390041
004000 OBJECT-COMPUTER.        IBM-3090.                                00400041
004100                                                                  00410041
004200 INPUT-OUTPUT SECTION.                                            00420041
004300                                                                  00430041
004400 FILE-CONTROL.                                                    00440041
004500                                                                  00450041
004600     SELECT MAF-INPUT-FILE                                        00460041
004700         ASSIGN TO INP01.                                         00470041
004800                                                                  00480041
004900     SELECT MAF-TOKEN-FILE                                        00490041
005000         ASSIGN TO OUT01.                                         00500041
005100                                                                  00510041
005200******************************************************************00520041
005300 DATA DIVISION.                                                   00530041
005400******************************************************************00540041
005500                                                                  00550041
005600 FILE SECTION.                                                    00560041
005700                                                                  00570041
005800 FD  MAF-INPUT-FILE                                               00580041
005900     RECORDING MODE IS F                                          00590041
006000     BLOCK CONTAINS 0 RECORDS                                     00600041
006100     LABEL RECORDS ARE STANDARD                                   00610041
006200     RECORD CONTAINS 80 CHARACTERS.                               00620041
006300                                                                  00630041
006400 01  MAF-INPUT-RECORD            PIC X(80).                       00640041
006500                                                                  00650041
006600 FD  MAF-TOKEN-FILE                                               00660041
006700     RECORDING MODE IS F                                          00670041
006800     BLOCK CONTAINS 0 RECORDS                                     00680041
006900     LABEL RECORDS ARE STANDARD                                   00690041
007000     RECORD CONTAINS 80 CHARACTERS.                               00700041
007100                                                                  00710041
007200 01  MAF-TOKEN-RECORD            PIC X(80).                       00720041
007300                                                                  00730041
007400******************************************************************00740041
007500 WORKING-STORAGE SECTION.                                         00750041
007600******************************************************************00760041
007700 01  FILLER                            PIC X(50)  VALUE           00770041
007800     ' *** WORKING STORAGE STARTS HERE FOR TCKUT025 *** '.        00780041
007900                                                                  00790041
008000 01  ABEND-CODE                        PIC S9(04) VALUE +0.       00800059
008100                                                                  00810059
008200 01  PS-PROGRAM-SWITCHES.                                         00820041
008300     05  PS-END-OF-MAF-SW              PIC X(01)  VALUE 'N'.      00830041
008400         88  PS-NOT-END-OF-MAF                    VALUE 'N'.      00840041
008500         88  PS-END-OF-MAF                        VALUE 'Y'.      00850041
008600                                                                  00860041
008700 01  PC-CONSTANTS.                                                00870041
008800     05  PC-PROGRAM-NAME               PIC  X(08) VALUE           00880041
008900                                                 'TCKUT025'.      00890041
009000 01  PV-PROGRAM-VARIABLES.                                        00900041
009100     05  PV-MAF-READ-COUNT             PIC  9(07) VALUE ZEROES.   00910041
009200     05  PV-MAF-WRITE-COUNT            PIC  9(07) VALUE ZEROES.   00920041
009300     05  PV-INPUT-LENGTH               PIC  9(09).                00930061
009400                                                                  00940043
009500******************************************************************00950041
009600* RECORD LAYOUT FOR MERCHANT ACTIVITY FILE - INPUT AND OUTPUT    *00960041
009700******************************************************************00970041
009800     COPY TCWS001.                                                00980041
009900                                                                  00990041
010000******************************************************************01000041
010100* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY *01010041
010200* MODULE                                                         *01020041
010300******************************************************************01030041
010400     COPY PTYCCSIP.                                               01040041
010500                                                                  01050041
010600******************************************************************01060041
010700* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY *01070041
010800* MODULE                                                         *01080041
010900******************************************************************01090041
011000     COPY DPWS031.                                                01100055
011100                                                                  01110041
011200******************************************************************01120041
011300                                                                  01130041
011400 PROCEDURE DIVISION.                                              01140041
011500                                                                  01150041
011600 0000-MAINLINE-PARA.                                              01160041
011700                                                                  01170041
011800     PERFORM 1000-INITIALIZE.                                     01180041
011900                                                                  01190041
012000     PERFORM 2000-PROCESS-RECORDS                                 01200041
012100           UNTIL PS-END-OF-MAF.                                   01210041
012200                                                                  01220041
012300     PERFORM 9000-EOJ-ROUTINE.                                    01230041
012400                                                                  01240041
012500     STOP RUN.                                                    01250041
012600                                                                  01260041
012700******************************************************************01270041
012800* 1000-INITIALIZE                                                 01280041
012900*     INITIALIZE THE VARIABLES, OPEN THE INPUT AND OUTPUT FILES   01290041
013000*     AND READ THE INPUT FILE                                     01300041
013100******************************************************************01310041
013200 1000-INITIALIZE.                                                 01320041
013300                                                                  01330041
013400     DISPLAY 'PROGRAM - ' PC-PROGRAM-NAME.                        01340041
013500     INITIALIZE PV-PROGRAM-VARIABLES.                             01350041
013600     MOVE PC-PROGRAM-NAME               TO DP031-PROGRAM-NAME.    01360058
013700                                                                  01370041
013800     OPEN INPUT  MAF-INPUT-FILE                                   01380041
013900          OUTPUT MAF-TOKEN-FILE.                                  01390041
014000                                                                  01400041
014100     PERFORM 2100-READ-MAF.                                       01410041
014200                                                                  01420041
014300******************************************************************01430041
014400* 2000-PROCESS-RECORDS                                            01440041
014500*   1. VALIDATE THE TRANSACTION TYPE:                             01450041
014600*   -  IF TRANSACTION TYPE IS 51, THEN PROCESS THE CARD NUMBER    01460041
014700*      TO TOKENIZE                                                01470041
014800*   2. WRITE THE RECORDS TO OUTPUT AND READ THE NEXT RECORD TO    01480041
014900*      PROCESS                                                    01490041
015000******************************************************************01500041
015100 2000-PROCESS-RECORDS.                                            01510041
015200                                                                  01520041
015300     MOVE ZEROES TO PV-INPUT-LENGTH.                              01530048
015400                                                                  01540048
015500     IF TC001-TRN1-TYP                                            01550041
015600        INSPECT FUNCTION REVERSE (TC001-CARD-NBR)                 01560045
015700             TALLYING PV-INPUT-LENGTH FOR LEADING SPACES          01570047
015800        COMPUTE PV-INPUT-LENGTH =                                 01580049
015900             LENGTH OF TC001-CARD-NBR - PV-INPUT-LENGTH           01590052
016000                                                                  01600050
016100        IF PV-INPUT-LENGTH < 7                                    01610054
016200           CONTINUE                                               01620041
016300        ELSE                                                      01630041
016400           PERFORM 2200-PROCESS-TRN1                              01640041
016500        END-IF                                                    01650041
016600     END-IF.                                                      01660041
016700                                                                  01670041
016800     PERFORM 3000-WRITE-MAF.                                      01680041
016900     PERFORM 2100-READ-MAF.                                       01690041
017000                                                                  01700041
017100******************************************************************01710041
017200* 2100-READ-MAF                                                   01720041
017300*      READ THE RECORDS IN MERCHANT ACTIVITY FILE                 01730041
017400******************************************************************01740041
017500 2100-READ-MAF.                                                   01750041
017600                                                                  01760041
017700     READ MAF-INPUT-FILE INTO TC001-MERCHANT-ACTIVITY-FILE        01770041
017800        AT END                                                    01780041
017900           SET PS-END-OF-MAF   TO TRUE                            01790041
018000        NOT AT END                                                01800041
018100           ADD 1               TO PV-MAF-READ-COUNT               01810041
018200     END-READ.                                                    01820041
018300                                                                  01830041
018400******************************************************************01840041
018500* 2200-PROCESS-TRN1                                               01850041
018600*      PROCESS CARD NUMBERS WITH TRANSACTION TYPE '51'            01860041
018700******************************************************************01870041
018800 2200-PROCESS-TRN1.                                               01880041
018900                                                                  01890041
019000     INITIALIZE CSI-PARAMETERS                                    01900050
019100                DP031-PROTEG-PGM-PARAMETERS.                      01910055
019200                                                                  01920050
019300     SET CSI-ENCRYPT-FUNCTION         TO TRUE.                    01930050
019400     SET DP031-ACCTNBR                TO TRUE.                    01940055
019500     MOVE 'TC001-CARD-NBR'            TO DP031-FIELD.             01950055
019600     MOVE TC001-CARD-NBR              TO DP031-CLEAR-TEXT.        01960055
019700     MOVE PV-INPUT-LENGTH             TO DP031-INPUT-LEN.         01970055
019800     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      01980055
019900                                                                  01990050
020000     IF CSI-RETURN-CODE NOT = ZERO                                02000050
020100        DISPLAY 'ABEND IN RECORD NUMBER - ' PV-MAF-READ-COUNT     02010050
020200        DISPLAY 'INPUT LENGTH - ' PV-INPUT-LENGTH                 02020062
020300        PERFORM DP031-9999-ABEND                                  02030055
020400     END-IF.                                                      02040050
020500     MOVE DP031-CIPHER-TEXT           TO TC001-CARD-NBR.          02050055
020600                                                                  02060041
020700******************************************************************02070041
020800* 3000-WRITE-MAF                                                  02080041
020900*      WRITE THE RECORDS TO OUTPUT                                02090041
021000******************************************************************02100041
021100 3000-WRITE-MAF.                                                  02110041
021200                                                                  02120041
021300     WRITE MAF-TOKEN-RECORD  FROM TC001-MERCHANT-ACTIVITY-FILE.   02130041
021400     ADD 1                   TO PV-MAF-WRITE-COUNT.               02140041
021500                                                                  02150041
021600                                                                  02160041
021700******************************************************************02170041
021800* 9000-EOJ-ROUTINE                                                02180041
021900*      CLOSE THE INPUT AND OUTPUT FILES, DISPLAY THE MESSAGES     02190041
022000*      AND TERMINATE THE PROCESS.                                 02200041
022100******************************************************************02210041
022200 9000-EOJ-ROUTINE.                                                02220041
022300                                                                  02230041
022400     CLOSE MAF-INPUT-FILE                                         02240041
022500           MAF-TOKEN-FILE.                                        02250041
022600                                                                  02260041
022700     IF PV-MAF-READ-COUNT = 0                                     02270041
022800        DISPLAY 'INPUT MERCHANT ACTIVITY FILE IS EMPTY'           02280041
022900     END-IF.                                                      02290041
023000     DISPLAY 'MAF RECORDS READ   : ' PV-MAF-READ-COUNT.           02300041
023100     DISPLAY 'MAF RECORDS WRITTEN: ' PV-MAF-WRITE-COUNT.          02310041
023200                                                                  02320041
023300******************************************************************02330041
023400*      COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE   02340055
023500*      PROTEGRITY MODULE FOR TOKENIZATION                         02350041
023600******************************************************************02360041
023700      COPY DPPD031.                                               02370055
023800                                                                  02380041
023900******************************************************************02390041
