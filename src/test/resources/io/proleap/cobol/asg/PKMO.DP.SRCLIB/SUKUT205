000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    SUKUT205.                                         00050000
000600 AUTHOR.        DENISE HAHN.                                      00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   DECEMBER 2020.                                    00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM CHECKS THE TUPLDER TABLE FOR CONVEYOR DIVERT     *00120000
001300*  ERRORS.                                                       *00130000
001301*                                                                 00130100
001302*         UPLDER-UPLD-TRN-CDE = 'B'                               00130200
001304*   ERR_CDE|                 DESCRIPTION                          00130400
001305*          |                                                      00130500
001306*    100   | SML IS NOT A TYPE-4 KOHLS LICENSE PLATE              00130600
001307*    101   | DOOR AND DIVERTER NOT DEFINED IN THIS DC             00130700
001308*    102   | EITHER SHIPT-UNT-ID, DC-NUMBER OR DIVERT NUMBER      00130800
001309*          | IS NOT NUMERIC                                       00130900
001310*    103   | DUPLICATE CARTON               (THESE ARE BYPASSED)  00131000
001311*    104   | TROUBLE SHOOTING LOGGING       (THESE ARE BYPASSED)  00131100
001312*    105   | NO READ                        (THESE ARE BYPASSED)  00131200
001313*    106   | CONVEYOR TO CONVEYOR           (THESE ARE BYPASSES)  00131300
001314*    107   | INVALID STORE NUMBER                                 00131400
001315*                                                                 00131500
001316*  ERR_CDE 103,104,105 & 106 ARE BYPASSED IN THIS CHECK           00131600
001317*                                                                 00131700
001318*  THERE IS A WST PARM "CNVYERRBYP" THAT IS SET UP BY DC FOR      00131800
001319*  SPECIFIC ERROR COMBINATIONS THAT CAN ALSO BE BYPASSED AS PART  00131900
001320*  OF THIS CHECK.                                                 00132000
001321*  THE WST PARM HAS, OPER, 'B' TRN CDE, ERR_CDE * DIVERT/DOOR     00132100
001330*  THAT SHOULD BE BYPASSED.                                       00133000
001331*                                                                 00133100
001340*  ANY RECORD NOT BYPASSED WILL BE WRITTEN TO AN ERROR GDG ANA AN 00134000
001350*  EMAIL WILL BE SENT TO INDICATE THAT THERE ARE DIVERTS IN       00135000
001360*  ERROR.                                                         00136000
001370******************************************************************00137000
001380                                                                  00138000
001390******************************************************************00139000
001400 ENVIRONMENT DIVISION.                                            00140000
001500******************************************************************00150000
001600                                                                  00160000
001700 CONFIGURATION SECTION.                                           00170000
001800                                                                  00180000
001900 SOURCE-COMPUTER.        IBM-3090.                                00190000
002000 OBJECT-COMPUTER.        IBM-3090.                                00200000
002100                                                                  00210000
002200 INPUT-OUTPUT SECTION.                                            00220000
002300                                                                  00230000
002400 FILE-CONTROL.                                                    00240000
002500                                                                  00250000
002600     SELECT SU-CNVYR-CNTL-FILE                                    00260000
002700         ASSIGN TO INP01.                                         00270000
002800                                                                  00280000
002900     SELECT ERROR-OUT-FILE                                        00290000
003000         ASSIGN TO OUT01.                                         00300000
003100                                                                  00310000
003110     SELECT ERROR-DTL-FILE                                        00311005
003120         ASSIGN TO OUT02.                                         00312005
003130                                                                  00313005
003200******************************************************************00320000
003300 DATA DIVISION.                                                   00330000
003400******************************************************************00340000
003500                                                                  00350000
003600 FILE SECTION.                                                    00360000
003700                                                                  00370005
003800 FD  SU-CNVYR-CNTL-FILE                                           00380000
003900     RECORDING MODE IS F                                          00390000
004000     LABEL RECORDS ARE STANDARD                                   00400000
004100     BLOCK CONTAINS 0 RECORDS.                                    00410000
004200 01  SU-CNVYR-CNTL-FILE-RECORD        PIC  X(75).                 00420000
004300                                                                  00430005
004400                                                                  00440005
004500 FD  ERROR-OUT-FILE                                               00450000
004600     RECORDING MODE IS F                                          00460000
004700     BLOCK CONTAINS 0 RECORDS                                     00470000
004800     LABEL RECORDS ARE STANDARD.                                  00480000
004900                                                                  00490000
005000 01  ERROR-OUT-RECORD             PIC X(80).                      00500073
005100                                                                  00510000
005200                                                                  00520000
005210 FD  ERROR-DTL-FILE                                               00521003
005220     RECORDING MODE IS F                                          00522003
005230     BLOCK CONTAINS 0 RECORDS                                     00523003
005240     LABEL RECORDS ARE STANDARD.                                  00524003
005250                                                                  00525003
005260 01  ERROR-DTL-RECORD             PIC X(250).                     00526005
005270                                                                  00527003
005280                                                                  00528003
005300******************************************************************00530000
005400 WORKING-STORAGE SECTION.                                         00540000
005500******************************************************************00550000
005600                                                                  00560005
005700                                                                  00570005
005800 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00580000
005900                                                   COMP SYNC.     00590000
006000                                                                  00600000
006100***************************************************************** 00610000
006200*    INPUT CONTROL CARD                                           00620000
006300***************************************************************** 00630000
006400 01  CC-CONTROL-CARD.                                             00640000
006500     05  CC-OPER-UNT-ID              PIC 9(04)     VALUE ZERO.    00650000
006600     05  FILLER                      PIC X(03)     VALUE SPACES.  00660000
006700     05  CC-FCLTY-NAME               PIC X(20)     VALUE SPACES.  00670000
006800     05  FILLER                      PIC X(03)     VALUE SPACES.  00680000
006900     05  CC-PERIOD                   PIC X(08)     VALUE SPACES.  00690000
007000     05  CC-PERIOD-R7 REDEFINES CC-PERIOD.                        00700000
007100         10  CC-PERIOD-7             PIC X(07).                   00710000
007200         10  FILLER                  PIC X(01).                   00720000
007210     05  CC-PERIOD-R6 REDEFINES CC-PERIOD.                        00721000
007220         10  CC-PERIOD-6             PIC X(06).                   00722000
007230         10  FILLER                  PIC X(02).                   00723000
007240     05  CC-PERIOD-R5 REDEFINES CC-PERIOD.                        00724000
007250         10  CC-PERIOD-5             PIC X(05).                   00725000
007260         10  FILLER                  PIC X(03).                   00726000
007270     05  CC-PERIOD-R4 REDEFINES CC-PERIOD.                        00727000
007280         10  CC-PERIOD-4             PIC X(04).                   00728000
007290         10  FILLER                  PIC X(04).                   00729000
007291     05  CC-PERIOD-R3 REDEFINES CC-PERIOD.                        00729100
007292         10  CC-PERIOD-3             PIC X(03).                   00729200
007293         10  FILLER                  PIC X(05).                   00729300
007294                                                                  00729400
007295 01  DK-DB2-KEYS.                                                 00729500
007296     05  DK-OPER-UNT-ID              PIC S9(04)    VALUE +0       00729600
007297                                                   COMP SYNC.     00729700
007298     05  DK-LOC-ID                   PIC S9(04)    VALUE +0       00729800
007299                                                   COMP SYNC.     00729900
007300 01  HEADING-OUT.                                                 00730000
007400     05  HEAD-REC                    PIC X(80)     VALUE SPACES.  00740000
007500                                                                  00750000
007541*  DC: 9999 ERROR: B-101  DIVERT/DOOR: XXXX/XXXX   COUNT: ZZZ,ZZZ 00754174
007542 01  OUTPUT-REC-COUNT.                                            00754274
007543     05  FILLER               PIC X(04)  VALUE ' DC:'.            00754374
007544     05  OR-DC-NBR            PIC Z(04)  VALUE ZEROES.            00754474
007545     05  FILLER               PIC X(06)  VALUE '  ERR:'.          00754574
007546     05  OR-TRN-CDE           PIC X(01)  VALUE SPACES.            00754674
007547     05  FILLER               PIC X(01)  VALUE '-'.               00754774
007548     05  OR-ERR-CDE           PIC X(04)  VALUE SPACES.            00754874
007549     05  FILLER               PIC X(11)  VALUE '  DVRT/LOC:'.     00754974
007550     05  OR-DIVERT            PIC X(04)  VALUE SPACES.            00755074
007551     05  FILLER               PIC X(01)  VALUE '/'.               00755174
007552     05  OR-DOOR              PIC X(04)  VALUE SPACES.            00755274
007553     05  FILLER               PIC X(06)  VALUE '  STR:'.          00755374
007554     05  OR-STR-NBR           PIC X(04)  VALUE SPACES.            00755474
007555     05  FILLER               PIC X(06)  VALUE '  CNT:'.          00755574
007556     05  OR-ERR-CNT           PIC ZZZ,ZZZ                         00755674
007557                                         VALUE ZEROES.            00755774
007558     05  FILLER               PIC X(02)  VALUE SPACES.            00755874
007560                                                                  00756074
007561*  ERROR REASON                                                   00756174
007562 01  OUTPUT-REC2.                                                 00756274
007563     05  FILLER               PIC X(08)  VALUE SPACES.            00756381
007564     05  OR-ERR-RSN           PIC X(71)  VALUE SPACES.            00756474
007565                                                                  00756574
007566*  DC:9999 DR:XXXX TYPE:XX XXXXXXXXXXXX XXXX/XXXX STR:9999        00756659
007567 01  DT1-REC.                                                     00756759
007568     05  FILLER               PIC X(08)  VALUE SPACES.            00756869
007569     05  FILLER               PIC X(16)  VALUE 'LANE ASSIGNMENT '.00756978
007570     05  DT1-DIVERT-NBR       PIC X(04)  VALUE SPACES.            00757078
007571     05  FILLER               PIC X(15)  VALUE ' DIVERT LOC ID '. 00757178
007574     05  DT1-LOC-ID           PIC X(04)  VALUE SPACES.            00757471
007575     05  FILLER               PIC X(10)  VALUE ' FOR DOOR '.      00757580
007576     05  DT1-DOOR             PIC X(04)  VALUE SPACES.            00757668
007581     05  FILLER               PIC X(06)  VALUE '  STR:'.          00758171
007582     05  DT1-STR              PIC Z(04)  VALUE ZEROES.            00758268
007583     05  FILLER               PIC X(07)  VALUE '  TYPE:'.         00758378
007584     05  DT1-TYPE             PIC X(02)  VALUE SPACES.            00758478
007588                                                                  00758859
007589*  STORE: XXXX IS CURRENTLY ASSIGNED TO DOOR: XXXX                00758960
007590 01  DT2-REC.                                                     00759060
007591     05  FILLER               PIC X(08)  VALUE SPACES.            00759169
007592     05  FILLER               PIC X(06)  VALUE 'STORE '.          00759282
007593     05  DT2-STR              PIC Z(04)  VALUE ZEROES.            00759360
007594     05  FILLER               PIC X(34)  VALUE                    00759471
007595             '  IS CURRENTLY ASSIGNED TO DOOR:  '.                00759571
007596     05  DT2-DOOR             PIC X(04)  VALUE SPACES.            00759660
007597     05  FILLER               PIC X(02)  VALUE SPACES.            00759776
007598     05  FILLER               PIC X(07)  VALUE 'SINCE  '.         00759882
007600     05  DT2-DATE             PIC X(10)  VALUE SPACES.            00760076
007601                                                                  00760160
007602*  STORE: XXXX IS CURRENTLY NOT ASSIGNED TO A SHIPPING DOOR       00760260
007603 01  DT3-REC.                                                     00760360
007604     05  FILLER               PIC X(08)  VALUE SPACES.            00760469
007605     05  FILLER               PIC X(07)  VALUE 'STORE '.          00760586
007606     05  DT3-STR              PIC Z(04)  VALUE ZEROES.            00760660
007607     05  FILLER               PIC X(46)  VALUE                    00760771
007608             '  IS CURRENTLY NOT ASSIGNED TO A SHIPPING DOOR'.    00760871
007609                                                                  00760960
007610*  DC: 9999 TUPLDER RECORDS BYPASSED               COUNT: ZZZ,ZZZ 00761058
007611 01  OUTPUT-TOTAL-COUNT.                                          00761163
007612     05  FILLER               PIC X(04)  VALUE ' DC:'.            00761263
007613     05  OR-DC                PIC Z(04)  VALUE ZEROES.            00761363
007614     05  OR-TOTAL-DESC        PIC X(27)  VALUE SPACES.            00761463
007615     05  FILLER               PIC X(16)  VALUE SPACES.            00761563
007616     05  OR-TOT-CNT           PIC ZZZ,ZZZ                         00761663
007617                                         VALUE ZEROES.            00761763
007618     05  FILLER               PIC X(22)  VALUE SPACES.            00761863
007619                                                                  00761921
007620 01  PC-PROGRAM-CONSTANTS.                                        00762000
007700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00770000
007800         'SUKUT205'.                                              00780000
007900     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00790000
008000                                                   COMP SYNC.     00800005
008100 01  PS-PROGRAM-SWITCHES.                                         00810000
008200     05  PS-EOF-CNTL-FILE-SW         PIC  X(01)    VALUE 'N'.     00820000
008300         88  PS-EOF-CNTL-FILE                      VALUE 'Y'.     00830000
008400         88  PS-NOT-EOF-CNTL-FILE                  VALUE 'N'.     00840000
008500     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     00850000
008600         88  PS-END-OF-CURSOR                      VALUE 'Y'.     00860000
008700         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     00870000
008701     05  PS-DIVERT-ERRORS-SW         PIC  X(01)    VALUE 'N'.     00870109
008702         88  PS-DIVERT-ERRORS                      VALUE 'Y'.     00870209
008703         88  PS-NO-DIVERT-ERRORS                   VALUE 'N'.     00870309
008704     05  PS-TUPLDER-BYPASS-SW        PIC  X(01)    VALUE 'N'.     00870409
008705         88  PS-TUPLDER-BYPASS-YES                 VALUE 'Y'.     00870509
008706         88  PS-TUPLDER-BYPASS-NO                  VALUE 'N'.     00870609
008707     05  PS-EOF-DOOR-STR-SW          PIC  X(01)    VALUE 'N'.     00870759
008708         88  PS-EOF-DOOR-STR                       VALUE 'Y'.     00870859
008709         88  PS-EOF-DOOR-STR-NO                    VALUE 'N'.     00870959
008710     05  PS-EOF-STORE-ASGMT-SW       PIC  X(01)    VALUE 'N'.     00871084
008711         88  PS-EOF-STORE-ASGMT                    VALUE 'Y'.     00871184
008712         88  PS-EOF-STORE-ASGMT-NO                 VALUE 'N'.     00871284
008713     05  PS-STORE-CSR-FIRST-SW       PIC  X(01)    VALUE 'N'.     00871386
008714         88  PS-STORE-CSR-FIRST                    VALUE 'Y'.     00871486
008715         88  PS-STORE-CSR-FIRST-NO                 VALUE 'N'.     00871586
008720                                                                  00872002
009570                                                                  00957003
009580 01  PV-PROGRAM-VARIABLES.                                        00958000
009581     05  PV-MAX-ERROR-COUNT          PIC S9(09) COMP.             00958153
009582     05  PV-BYPASS-PARM-CNT          PIC S9(09)  COMP.            00958253
009583     05  PV-CSR-OPER-UNT-ID          PIC S9(4) COMP.              00958353
009584     05  PV-CSR-UPLD-TRN-CDE         PIC  X(1).                   00958453
009585     05  PV-CSR-ERR-CDE              PIC  X(3).                   00958553
009586     05  PV-CSR-ERROR-REASON         PIC  X(71).                  00958674
009587     05  PV-CSR-PRC-TMST             PIC  X(26).                  00958753
009588     05  PV-CSR-DC-NBR               PIC  X(04).                  00958853
009589     05  PV-CSR-STR-NBR              PIC  X(04).                  00958953
009590     05  PV-CSR-BARCODE              PIC  X(22).                  00959053
009591     05  PV-CSR-DIVERT-NUMBER        PIC  X(04).                  00959153
009592     05  PV-CSR-DOOR-NUMBER          PIC  X(04).                  00959253
009593     05  PV-CSR-DIVERT-DATE          PIC  X(08).                  00959353
009594     05  PV-CSR-DIVERT-TIME          PIC  X(06).                  00959453
009595     05  PV-CSR-PKT-TXT              PIC  X(100).                 00959553
009596                                                                  00959653
009597     05  PV-PREV-OPER-UNT-ID         PIC S9(4) COMP.              00959753
009598     05  PV-PREV-UPLD-TRN-CDE        PIC  X(1).                   00959853
009599     05  PV-PREV-ERR-CDE             PIC  X(3).                   00959953
009601     05  PV-PREV-DIVERT-NUMBER       PIC  X(04).                  00960116
009602     05  PV-PREV-DOOR-NUMBER         PIC  X(04).                  00960216
009603     05  PV-PREV-STR-NBR             PIC  X(04).                  00960334
009604     05  PV-PREV-ERROR-REASON        PIC  X(71).                  00960474
009605                                                                  00960534
009606     05  PV-TOTAL-ERROR-CNT          PIC  9(09)    VALUE ZERO.    00960634
009607     05  PV-ERROR-COUNT              PIC  9(09)    VALUE ZERO.    00960734
009608     05  PV-BYPASS-COUNT             PIC  9(09)    VALUE ZERO.    00960834
009609     05  PV-COUNTER                  PIC S9(04)    VALUE ZERO.    00960934
009610                                                                  00961034
009611     05  PV-OPER-UNT-ID-DISP.                                     00961134
009620         10  PV-OPER-UNT-ID-N        PIC 9(04)     VALUE ZERO.    00962013
012700                                                                  01270000
012701     05  PV-STR-CSR-OPER-UNT-ID      PIC S9(4) COMP VALUE ZEROES. 01270163
012705     05  PV-CSR-DIVERT-NBR           PIC S9(9) COMP VALUE ZEROES. 01270559
012706     05  PV-CSR-DIVERT-LOC-ID        PIC  X(4)      VALUE SPACES. 01270659
012709     05  PV-CSR-ASGMT-DATE           PIC  X(10)     VALUE SPACES. 01270959
012710     05  PV-CSR-ASGMT-TIME           PIC  X(08)     VALUE SPACES. 01271059
012711                                                                  01271159
012712     05  PV-NULL-IND-1                  PIC S9(04)  VALUE ZEROS   01271259
012713                                                    COMP SYNC.    01271359
012714     05  PV-NULL-IND-2                  PIC S9(04)  VALUE ZEROS   01271459
012715                                                    COMP SYNC.    01271559
012716     05  PV-NULL-IND-3                  PIC S9(04)  VALUE ZEROS   01271659
012717                                                    COMP SYNC.    01271759
012718                                                                  01271859
012719 01  PV-ABEND-VARIABLES.                                          01271900
012720     05  PV-SQLCODE                  PIC S9(9).                   01272000
012721     05  PV-DISPLAY-SQLCODE          PIC -999.                    01272105
012722     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT205'.  01272200
012723     05  PV-ABEND-PARAGRAPH          PIC X(30) VALUE SPACES.      01272300
012724     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      01272400
012725     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      01272500
012726     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      01272600
012727     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      01272700
012728     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      01272800
012729     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      01272900
012730     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      01273000
012740     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      01274000
012750                                                                  01275001
012770******************************************************************01277000
012780** DIVERT MONITORING CONTROL CARD LAYOUT COPYBOOK               **01278000
012790******************************************************************01279000
012800     COPY SURD096.                                                01280000
013000                                                                  01300001
013010******************************************************************01301013
013020** OUTPUT FILE LAYOUT                                           **01302013
013030******************************************************************01303013
013040     COPY SURD172.                                                01304013
013050                                                                  01305013
013100******************************************************************01310000
013200** DB2 FORMATTED MESSAGE AREA                                   **01320000
013300******************************************************************01330000
013400     COPY DPWS004.                                                01340000
013600                                                                  01360001
013700******************************************************************01370000
013800** COMMUNICATIONS AREA FOR DB2                                  **01380000
013900******************************************************************01390000
014000     EXEC SQL                                                     01400000
014100          INCLUDE SQLCA                                           01410000
014200     END-EXEC.                                                    01420000
014300                                                                  01430001
014500******************************************************************01450000
014600** UPLOAD ERROR TABLE                                           **01460001
014800******************************************************************01480000
014900     EXEC SQL                                                     01490000
015000          INCLUDE TUPLDER                                         01500001
015100     END-EXEC.                                                    01510000
016200                                                                  01620001
016210******************************************************************01621053
016220** TKRPRPM                                                      **01622053
016230******************************************************************01623053
016240     EXEC SQL                                                     01624053
016250          INCLUDE TKRPRPM                                         01625053
016260     END-EXEC.                                                    01626053
016270                                                                  01627053
016300******************************************************************01630000
016400*  INTEGRATION TYPE - WST_INTGRTN_TYP                             01640001
016600******************************************************************01660000
016700     EXEC SQL                                                     01670000
016800         INCLUDE WST00008                                         01680000
016900     END-EXEC.                                                    01690000
017000                                                                  01700000
017100******************************************************************01710000
017200*  ATTRIBUTE DEFINITION - WST_ATTR_DEFN                           01720001
017400******************************************************************01740000
017500     EXEC SQL                                                     01750000
017600         INCLUDE WST00009                                         01760000
017700     END-EXEC.                                                    01770000
017800                                                                  01780000
017900******************************************************************01790000
018000*  ATTRIBUTE ELEMENTS - WST_ATTR_ELEM                             01800001
018200******************************************************************01820000
018300     EXEC SQL                                                     01830000
018400         INCLUDE WST00010                                         01840000
018500     END-EXEC.                                                    01850000
018600                                                                  01860000
018700******************************************************************01870059
018800*  DOOR DEFINITION                                                01880059
018900******************************************************************01890059
019000     EXEC SQL                                                     01900059
019100         INCLUDE TCNDCDR                                          01910059
019200     END-EXEC.                                                    01920059
019300                                                                  01930059
019301******************************************************************01930159
019302*  DOOR TYPE                                                      01930259
019303******************************************************************01930359
019304     EXEC SQL                                                     01930459
019305         INCLUDE TCNDRTY                                          01930559
019306     END-EXEC.                                                    01930659
019307                                                                  01930759
019310******************************************************************01931059
019320*  DOOR TO STORE ASSIGNMENT                                       01932059
019330******************************************************************01933059
019340     EXEC SQL                                                     01934059
019350         INCLUDE TCNDRST                                          01935059
019360     END-EXEC.                                                    01936059
019370                                                                  01937059
019400******************************************************************01940000
019500*  UPLOAD ERROR CURSOR - FOR GIVEN TIMEFRAME                      01950001
019600******************************************************************01960000
019700     EXEC SQL                                                     01970000
019800          DECLARE TUPLDER-CSR CURSOR FOR                          01980001
020000           SELECT OPER_UNT_ID                                     02000001
020100                , UPLD_TRN_CDE                                    02010001
020200                , ERR_CDE                                         02020001
020300                , CASE                                            02030001
020400                    WHEN ERR_CDE = '100' THEN                     02040001
020410                                'NOT TYPE-4 KOHLS BRCD'           02041034
020500                    WHEN ERR_CDE = '101' THEN                     02050001
020510             'LANE ASSIGNMENT/DIVERT LOC ID NOT DEFINED AT DC'    02051083
020600                    WHEN ERR_CDE = '102'  THEN                    02060001
020610                                'NON NUMERIC DATA     '           02061034
020800                    WHEN ERR_CDE = '103' THEN                     02080001
020810                                'DUPLICATE CARTON     '           02081034
020900                    WHEN ERR_CDE = '104' THEN                     02090001
020901                                'TROUBLE SHOOTING     '           02090134
020910                    WHEN ERR_CDE = '105' THEN                     02091001
020911                                'NO READ              '           02091134
020920                    WHEN ERR_CDE = '106' THEN                     02092001
020921                                'CONVEYOR TO CONVEYOR '           02092134
020930                    WHEN ERR_CDE = '107' THEN                     02093001
020931                        'STORE NOT ASSIGNED TO DOOR'              02093174
020940                    ELSE ERR_CDE                                  02094001
020950                  END AS ERROR_REASON                             02095001
020960                , PRC_TMST                                        02096001
020970                , SUBSTR(PKT_TXT,1,4)   AS DC_NBR                 02097001
020980                , SUBSTR(PKT_TXT,18,04) AS STR_NBR                02098039
020981                , SUBSTR(PKT_TXT,13,22) AS BARCODE                02098134
020990                , SUBSTR(PKT_TXT,35,4)  AS DIVERT_NUMBER          02099001
021000                , SUBSTR(PKT_TXT,39,4)  AS DOOR_NUMBER            02100001
021001                , SUBSTR(PKT_TXT,43,8)  AS DIVERT_DATE            02100101
021002                , SUBSTR(PKT_TXT,51,6)  AS DIVERT_TIME            02100201
021003                , PKT_TXT                                         02100301
021004             FROM TUPLDER                                         02100446
021005            WHERE OPER_UNT_ID  =  :DK-OPER-UNT-ID                 02100501
021006              AND UPLD_TRN_CDE =  'B'                             02100601
021007              AND NOT ERR_CDE IN  ('103','104','105','106')       02100701
021008              AND PRC_TMST    >=  :SU096-BACK-TMST                02100808
021009              AND PRC_TMST    <=  :SU096-CURR-TMST                02100902
021010              AND SUBSTR(PKT_TXT,13,22) LIKE '004%'               02101047
021011              AND NOT SUBSTR(PKT_TXT,25,8) = '00000000'           02101152
021012            ORDER BY OPER_UNT_ID                                  02101201
021013                   , UPLD_TRN_CDE                                 02101301
021014                   , ERR_CDE                                      02101401
021015                   , 9                                            02101545
021016                   , 10                                           02101645
021017                   , PRC_TMST                                     02101701
021137             WITH UR                                              02113701
021138     END-EXEC.                                                    02113800
021139                                                                  02113900
021140                                                                  02114000
021141******************************************************************02114159
021142*  DOOR DEFINITION/TYPE/STORE ASSIGNMENT CURS0R                   02114259
021143******************************************************************02114359
021150     EXEC SQL                                                     02115059
021160          DECLARE DOOR-STR-CSR CURSOR FOR                         02116059
021170           SELECT T1.OPER_UNT_ID                                  02117059
021180                , T1.DOOR_ID                                      02118059
021190                , T1.DOOR_TYP_CDE                                 02119059
021200                , T1.DOOR_LOC_DESC                                02120059
021300                , T1.DIVERT_NBR                                   02130059
021400                , T1.DIVERT_LOC_ID                                02140059
021500                , T1.DOOR_TYP_CDE_DESC                            02150059
021600                , T2.STR_NBR                                      02160059
021700                , T2.ASGMT_DATE                                   02170059
021800                , T2.ASGMT_TIME                                   02180059
021900           FROM                                                   02190059
022000           (SELECT A.OPER_UNT_ID                                  02200059
022100                 , A.DOOR_ID                                      02210059
022200                 , A.DOOR_TYP_CDE                                 02220059
022300                 , A.DOOR_LOC_DESC                                02230059
022400                 , A.DIVERT_NBR                                   02240059
022500                 , A.DIVERT_LOC_ID                                02250059
022600                 , B.DOOR_TYP_CDE_DESC                            02260059
022700              FROM TCNDCDR A                                      02270059
022800                 , TCNDRTY B                                      02280059
022900             WHERE A.OPER_UNT_ID   = :CNDCDR-OPER-UNT-ID          02290059
023000               AND A.DIVERT_NBR    = :CNDCDR-DIVERT-NBR           02300059
023100               AND A.DIVERT_LOC_ID = :CNDCDR-DIVERT-LOC-ID        02310059
023200               AND A.DOOR_TYP_CDE  =  B.DOOR_TYP_CDE              02320059
023300           )                                                      02330059
023400           AS T1                                                  02340059
023500           LEFT OUTER JOIN                                        02350059
023600           (SELECT C.OPER_UNT_ID                                  02360059
023700                 , C.DOOR_ID                                      02370059
023800                 , D.STR_NBR                                      02380059
023900                 , DATE(D.STRT_TMST) AS ASGMT_DATE                02390059
024000                 , TIME(D.STRT_TMST) AS ASGMT_TIME                02400059
024100              FROM TCNDCDR C                                      02410065
024200                 , TCNDRST D                                      02420065
024300             WHERE C.OPER_UNT_ID   = :CNDCDR-OPER-UNT-ID          02430059
024600               AND C.DIVERT_NBR    = :CNDCDR-DIVERT-NBR           02460059
024700               AND C.DIVERT_LOC_ID = :CNDCDR-DIVERT-LOC-ID        02470059
024800               AND C.OPER_UNT_ID   =  D.OPER_UNT_ID               02480059
024900               AND C.DOOR_ID       =  D.DOOR_ID                   02490059
025000               AND D.END_TMST      >  CURRENT TIMESTAMP           02500059
025010           )                                                      02501059
025020           AS T2                                                  02502059
025030           ON T1.OPER_UNT_ID  =  T2.OPER_UNT_ID AND               02503059
025040              T1.DOOR_ID      =  T2.DOOR_ID                       02504059
025050           WITH UR                                                02505059
025500     END-EXEC.                                                    02550059
025600                                                                  02560059
025601                                                                  02560184
025602******************************************************************02560284
025603*  STORE TO DOOR ASSIGNMENT CURSOR                                02560384
025604******************************************************************02560484
025610     EXEC SQL                                                     02561084
025611          DECLARE STORE-ASGMT-CSR CURSOR FOR                      02561184
025620          SELECT  A.DOOR_ID                                       02562084
025630               ,  A.STRT_TMST                                     02563084
025660            FROM TCNDRST A                                        02566084
025670               , TCNDCDR B                                        02567084
025680           WHERE A.OPER_UNT_ID         = :CNDRST-OPER-UNT-ID      02568084
025690             AND A.STR_NBR             = :CNDRST-STR-NBR          02569084
025691             AND A.OPER_UNT_ID         = B.OPER_UNT_ID            02569184
025692             AND A.DOOR_ID             = B.DOOR_ID                02569284
025693             AND A.END_TMST           >= CURRENT TIMESTAMP        02569384
025694             AND B.DOOR_LOC_DESC NOT LIKE '%RE-OPEN%'             02569487
025695             AND B.DOOR_LOC_DESC NOT LIKE '%REOPEN%'              02569587
025696             AND B.DOOR_LOC_DESC NOT LIKE '%UPS%'                 02569687
025697             AND B.DOOR_LOC_DESC NOT LIKE '%VIRTUAL%'             02569787
025698           ORDER BY A.DOOR_ID                                     02569884
025699            WITH UR                                               02569984
025700     END-EXEC.                                                    02570084
025800                                                                  02580059
025900                                                                  02590084
027031******************************************************************02703100
027032 PROCEDURE DIVISION.                                              02703200
027033******************************************************************02703300
027034                                                                  02703400
027035******************************************************************02703500
027036* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02703600
027037*      PROGRAM.                                                   02703700
027038******************************************************************02703800
027039 0000-PROGRAM-MAINLINE.                                           02703900
027040                                                                  02704000
027041     PERFORM 1000-INITIALIZE.                                     02704100
027042                                                                  02704200
027044     SET  PS-TUPLDER-BYPASS-NO                                    02704411
027045          PS-NOT-END-OF-CURSOR  TO  TRUE.                         02704511
027046                                                                  02704611
027047     PERFORM 3000-OPEN-TUPLDER-CSR.                               02704711
027048                                                                  02704811
027049     PERFORM 3005-FETCH-TUPLDER-CSR.                              02704911
027050                                                                  02705011
027051     PERFORM 3010-PROCESS-TUPLDER                                 02705111
027052       UNTIL PS-END-OF-CURSOR.                                    02705211
027053                                                                  02705311
027054     PERFORM 3015-CLOSE-TUPLDER-CSR.                              02705411
027055                                                                  02705511
027056     IF  PV-ERROR-COUNT  > 0                                      02705621
027057         PERFORM 4000-PRINT-ERROR-COUNT                           02705721
027058         PERFORM 3020-CHECK-DOOR-DEFN                             02705866
027059         PERFORM 3025-CHECK-STORE-DOOR                            02705966
027060     END-IF.                                                      02706021
029046                                                                  02904600
029047*    IF  PV-BYPASS-COUNT > 0                                      02904759
029048*        MOVE  SPACES                 TO HEAD-REC                 02904859
029049*        DISPLAY HEAD-REC                                         02904959
029050*        WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02905059
029051*                                                                 02905159
029066*        MOVE PV-PREV-OPER-UNT-ID TO  OR-DC                       02906659
029067*        MOVE PV-BYPASS-COUNT     TO  OR-TOT-CNT                  02906759
029068*        MOVE ' TUPLDER RECORDS BYPASSED '                        02906859
029069*                                 TO  OR-TOTAL-DESC               02906959
029070*        DISPLAY OUTPUT-TOTAL-COUNT                               02907059
029071*        WRITE ERROR-OUT-RECORD FROM OUTPUT-TOTAL-COUNT           02907159
029073*    END-IF.                                                      02907359
029074                                                                  02907421
029075                                                                  02907521
029076     IF  PV-TOTAL-ERROR-CNT > 0  AND                              02907653
029077         PV-TOTAL-ERROR-CNT > PV-MAX-ERROR-COUNT                  02907753
029078         SET  PS-DIVERT-ERRORS        TO TRUE                     02907853
029079     END-IF.                                                      02907953
029080                                                                  02908053
029081     IF  PV-TOTAL-ERROR-CNT > 0                                   02908153
029082         MOVE  SPACES                 TO HEAD-REC                 02908221
029083         DISPLAY HEAD-REC                                         02908321
029084         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02908421
029085                                                                  02908521
029086         MOVE PV-PREV-OPER-UNT-ID TO  OR-DC                       02908623
029087         MOVE PV-TOTAL-ERROR-CNT  TO  OR-TOT-CNT                  02908721
029088         MOVE ' TOTAL DIVERT ERROR RECORDS'                       02908838
029089                                  TO  OR-TOTAL-DESC               02908921
029090         DISPLAY OUTPUT-TOTAL-COUNT                               02909024
029091         DISPLAY ' '                                              02909183
029092         WRITE ERROR-OUT-RECORD FROM OUTPUT-TOTAL-COUNT           02909224
029093                                                                  02909383
029094         MOVE  SPACES             TO HEAD-REC                     02909483
029095         DISPLAY HEAD-REC                                         02909583
029096         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02909683
029097                                                                  02909783
029098     END-IF.                                                      02909821
029099                                                                  02909921
029100     CLOSE SU-CNVYR-CNTL-FILE                                     02910021
029101           ERROR-OUT-FILE                                         02910121
029102           ERROR-DTL-FILE.                                        02910221
029103                                                                  02910321
029104     IF PS-DIVERT-ERRORS                                          02910421
029105         MOVE 4051 TO RETURN-CODE                                 02910541
029106     END-IF.                                                      02910621
029107                                                                  02910721
029108     STOP RUN.                                                    02910821
029109                                                                  02910921
029110                                                                  02911021
029111***************************************************************** 02911121
029112*  INITIALIZATION PARAGRAPH                                       02911221
029113***************************************************************** 02911321
029114 1000-INITIALIZE.                                                 02911421
029115                                                                  02911521
029116     OPEN INPUT SU-CNVYR-CNTL-FILE                                02911621
029117         OUTPUT ERROR-OUT-FILE                                    02911721
029118                ERROR-DTL-FILE.                                   02911821
029120                                                                  02912000
029200     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           02920000
029300                                                                  02930000
029400     DISPLAY '*************************************'.             02940000
029500     DISPLAY '**                                  *'.             02950000
029600     DISPLAY '**           SUKUT205               *'.             02960000
029700     DISPLAY '**                                  *'.             02970000
029800     DISPLAY '*************************************'.             02980000
029900     DISPLAY '**                                  *'.             02990000
030000     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD.              03000000
030100                                                                  03010000
030200     MOVE CC-OPER-UNT-ID       TO DK-OPER-UNT-ID                  03020000
030300                                  DK-LOC-ID.                      03030000
030400     SET PS-NO-DIVERT-ERRORS   TO TRUE.                           03040002
030500                                                                  03050000
030510     READ SU-CNVYR-CNTL-FILE                                      03051002
030520         INTO SU096-DATE-CONTROL-REC                              03052002
030530             AT END                                               03053002
030540                 SET PS-EOF-CNTL-FILE TO TRUE.                    03054002
030550                                                                  03055002
030551     MOVE  SPACES                 TO HEAD-REC.                    03055148
030552     DISPLAY HEAD-REC.                                            03055248
030553     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        03055348
030554                                                                  03055448
030555     MOVE  '* * * * * * * * * * * * * * * * * * * * * *'          03055549
030556                                  TO HEAD-REC.                    03055648
030557     DISPLAY HEAD-REC                                             03055748
030558     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        03055848
030559                                                                  03055948
030570     MOVE '* FROM INPUT FILE - SUKUT205               '           03057051
030571                                  TO HEAD-REC.                    03057148
030572     DISPLAY HEAD-REC                                             03057248
030573     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        03057348
030574                                                                  03057448
030580     STRING '* FROM TIMESTAMP - ' SU096-BACK-TMST                 03058050
030581                                      DELIMITED BY SIZE           03058150
030582                                 INTO HEAD-REC.                   03058250
030583     DISPLAY HEAD-REC                                             03058350
030584     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        03058450
030585                                                                  03058550
030586     STRING  '* END  TIMESTAMP - ' SU096-CURR-TMST                03058650
030587                                      DELIMITED BY SIZE           03058750
030588                                 INTO HEAD-REC.                   03058850
030589     DISPLAY HEAD-REC                                             03058950
030590     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        03059050
030591                                                                  03059150
030592     MOVE  '* * * * * * * * * * * * * * * * * * * * * *'          03059250
030593                                  TO HEAD-REC.                    03059350
030594     DISPLAY HEAD-REC                                             03059450
030595     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        03059550
030596                                                                  03059650
030597     PERFORM 1100-GET-MAX-ALLOW-ERRORS.                           03059753
030598     MOVE  SPACES                 TO HEAD-REC.                    03059853
030599     DISPLAY HEAD-REC.                                            03059953
030600***  WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        03060086
030601                                                                  03060153
030602     MOVE KRPRPM-LOC-ID       TO  OR-DC.                          03060256
030603     MOVE PV-MAX-ERROR-COUNT  TO  OR-TOT-CNT.                     03060353
030604     MOVE ' MAX ERRORS ALLOWED-CNVYER:'                           03060453
030605                                  TO  OR-TOTAL-DESC.              03060553
030606     DISPLAY OUTPUT-TOTAL-COUNT.                                  03060653
030607***  WRITE ERROR-OUT-RECORD FROM OUTPUT-TOTAL-COUNT.              03060784
030608                                                                  03060853
030609                                                                  03060953
030610******************************************************************03061053
030611* GET THE MAXIMUM NUMBER OF CONVEYOR ERRORS ALLOWED FOR A DC      03061153
030612* BEFORE WE SEND OUT AN ALERT.                                    03061253
030613******************************************************************03061353
030614 1100-GET-MAX-ALLOW-ERRORS.                                       03061453
030620                                                                  03062053
030630     MOVE ZEROES  TO  PV-MAX-ERROR-COUNT.                         03063053
030640     MOVE CC-OPER-UNT-ID  TO  KRPRPM-LOC-ID                       03064056
030650                                                                  03065053
030693     EXEC SQL                                                     03069355
030694         SELECT  FUNC_QTY                                         03069457
030695           INTO :PV-MAX-ERROR-COUNT                               03069555
030696           FROM  TKRPRPM                                          03069655
030706           WHERE LOC_ID              = :KRPRPM-LOC-ID             03070656
030707             AND INTFC_SYS_CDE       = 'KHL'                      03070757
030708             AND SYS_PRC_FUNC_CDE    = 'CNVYER'                   03070857
030709             AND FUNC_PRC_STAT_CDE   = 'AC'                       03070955
030710             AND FUNC_BEG_TMST      <= CURRENT TIMESTAMP          03071055
030711             AND FUNC_END_TMST      >= CURRENT TIMESTAMP          03071155
030738           WITH UR                                                03073855
030739     END-EXEC                                                     03073955
030740                                                                  03074055
030741     EVALUATE TRUE                                                03074155
030742         WHEN SQLCODE = ZERO                                      03074255
030743              CONTINUE                                            03074355
030744                                                                  03074455
030749         WHEN SQLCODE = +100                                      03074955
030750         WHEN SQLCODE = -305                                      03075055
030753         WHEN SQLCODE = -904                                      03075355
030754         WHEN SQLCODE = -911                                      03075455
030755              MOVE ZEROES  TO  PV-MAX-ERROR-COUNT                 03075555
030757                                                                  03075755
030758         WHEN SQLWARN0 NOT = SPACES                               03075855
030759         WHEN SQLCODE < ZERO                                      03075955
030760         WHEN SQLCODE > ZERO                                      03076055
030761             MOVE '1100-GET-MAX-ALLOW-ERRORS      '               03076155
030762                             TO PV-ABEND-PARAGRAPH                03076255
030763             MOVE 'CHECK MAX # ERRORS ALLOWED     '               03076355
030764                             TO PV-ABEND-OPER-MESSAGE-1           03076455
030765             MOVE 'TKRPRPM ' TO PV-ABEND-TABLE-1                  03076555
030768             PERFORM 9100-SQL-ABEND                               03076855
030769                                                                  03076955
030770     END-EVALUATE.                                                03077055
030772                                                                  03077253
030800                                                                  03080053
092063******************************************************************09206300
092064* OPEN THE TUPLDER CURSOR                                         09206403
092066******************************************************************09206600
092067 3000-OPEN-TUPLDER-CSR.                                           09206703
092068                                                                  09206803
092069     PERFORM WITH TEST AFTER                                      09206903
092070       VARYING PV-COUNTER FROM 1 BY 1                             09207003
092071         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    09207103
092072                SQLCODE = ZERO)                                   09207203
092073                                                                  09207303
092074         EXEC SQL                                                 09207403
092075              OPEN TUPLDER-CSR                                    09207503
092076         END-EXEC                                                 09207603
092077                                                                  09207703
092078         EVALUATE TRUE                                            09207803
092079             WHEN SQLCODE = +0                                    09207903
092080             WHEN SQLCODE = -904                                  09208003
092081             WHEN SQLCODE = -911                                  09208103
092082             WHEN SQLCODE = -913                                  09208203
092083                 CONTINUE                                         09208303
092084             WHEN SQLWARN0 NOT EQUAL SPACE                        09208403
092085             WHEN SQLCODE NOT EQUAL ZERO                          09208503
092086                 MOVE '3000-OPEN-TUPLDER-CSR'                     09208603
092087                                      TO PV-ABEND-PARAGRAPH       09208703
092088                 MOVE 'ERROR OPENING ASSIGNMENT CURSOR'           09208803
092089                                      TO PV-ABEND-OPER-MESSAGE-1  09208903
092090                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09209003
092091                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09209103
092092                         PV-OPER-UNT-ID-DISP                      09209203
092093                                         DELIMITED BY SIZE        09209303
092094                                   INTO PV-ABEND-OPER-MESSAGE-2   09209403
092095                 MOVE 'DLT_ASGMT'     TO PV-ABEND-TABLE-1         09209503
092096                 PERFORM 9100-SQL-ABEND                           09209603
092097         END-EVALUATE                                             09209703
092098     END-PERFORM.                                                 09209803
092099                                                                  09209903
092100     IF  PV-COUNTER > PC-MAX-RETRIES                              09210003
092101         MOVE '3000-OPEN-ASGMT-CSR'                               09210103
092102                                      TO PV-ABEND-PARAGRAPH       09210203
092103         MOVE 'MAX RETRIES ERROR OPENING ASSIGNMENT CURSOR'       09210303
092104                                      TO PV-ABEND-OPER-MESSAGE-1  09210403
092105         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09210503
092106         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                09210603
092107                 PV-OPER-UNT-ID-DISP                              09210703
092108                                 DELIMITED BY SIZE                09210803
092109                                    INTO PV-ABEND-OPER-MESSAGE-2  09210903
092110         MOVE 'TUPLDER'               TO PV-ABEND-TABLE-1         09211012
092111         PERFORM 9100-SQL-ABEND                                   09211103
092112     END-IF.                                                      09211203
092113                                                                  09211303
092114                                                                  09211403
092115******************************************************************09211500
092116* FETCH TUPLDER CURSOR                                           *09211603
092118******************************************************************09211800
092119 3005-FETCH-TUPLDER-CSR.                                          09211903
092120                                                                  09212003
092121     EXEC SQL                                                     09212103
092122          FETCH TUPLDER-CSR                                       09212203
092127           INTO :PV-CSR-OPER-UNT-ID                               09212703
092128              , :PV-CSR-UPLD-TRN-CDE                              09212803
092129              , :PV-CSR-ERR-CDE                                   09212903
092148              , :PV-CSR-ERROR-REASON                              09214803
092149              , :PV-CSR-PRC-TMST                                  09214903
092150              , :PV-CSR-DC-NBR                                    09215016
092151              , :PV-CSR-STR-NBR                                   09215134
092152              , :PV-CSR-BARCODE                                   09215234
092153              , :PV-CSR-DIVERT-NUMBER                             09215334
092154              , :PV-CSR-DOOR-NUMBER                               09215434
092155              , :PV-CSR-DIVERT-DATE                               09215534
092156              , :PV-CSR-DIVERT-TIME                               09215634
092157              , :PV-CSR-PKT-TXT                                   09215734
092158     END-EXEC.                                                    09215834
092159                                                                  09215934
092160     EVALUATE TRUE                                                09216034
092161       WHEN SQLCODE = ZERO                                        09216134
092162            CONTINUE                                              09216234
092163                                                                  09216334
092164       WHEN SQLCODE = +100                                        09216434
092165           SET PS-END-OF-CURSOR      TO TRUE                      09216534
092166       WHEN SQLWARN0 NOT EQUAL SPACE                              09216634
092167       WHEN SQLCODE NOT EQUAL ZERO                                09216734
092168           MOVE '3005-FETCH-TUPLDER-CSR'                          09216834
092169                                     TO PV-ABEND-PARAGRAPH        09216934
092170           MOVE 'FETCH TUPLDER CURSOR '                           09217034
092171                                     TO PV-ABEND-OPER-MESSAGE-1   09217134
092172           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          09217234
092173           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              09217334
092174                   PV-OPER-UNT-ID-DISP                            09217434
092175                                   DELIMITED BY SIZE              09217534
092176                                   INTO PV-ABEND-OPER-MESSAGE-2   09217634
092177           MOVE 'DLT_ASGMT'          TO PV-ABEND-TABLE-1          09217734
092178           PERFORM 9100-SQL-ABEND                                 09217834
092179     END-EVALUATE.                                                09217934
092180                                                                  09218034
092181                                                                  09218134
092182******************************************************************09218234
092183*                                                                *09218334
092184******************************************************************09218434
092185 3010-PROCESS-TUPLDER.                                            09218534
092186                                                                  09218634
092187     IF  PV-CSR-OPER-UNT-ID    =  PV-PREV-OPER-UNT-ID   AND       09218734
092188         PV-CSR-UPLD-TRN-CDE   =  PV-PREV-UPLD-TRN-CDE  AND       09218834
092189         PV-CSR-ERR-CDE        =  PV-PREV-ERR-CDE       AND       09218934
092193         PV-CSR-DIVERT-NUMBER  =  PV-PREV-DIVERT-NUMBER AND       09219316
092194         PV-CSR-DOOR-NUMBER    =  PV-PREV-DOOR-NUMBER             09219416
092195         CONTINUE                                                 09219503
092196     ELSE                                                         09219603
092197         IF  PV-ERROR-COUNT  > 0                                  09219703
092198             PERFORM 4000-PRINT-ERROR-COUNT                       09219803
092199             MOVE  ZEROES  TO  PV-ERROR-COUNT                     09219903
092200             PERFORM 3020-CHECK-DOOR-DEFN                         09220066
092201             PERFORM 3025-CHECK-STORE-DOOR                        09220166
092202         END-IF                                                   09220203
092203                                                                  09220303
092204         PERFORM 3050-CHECK-BYPASS                                09220403
092205         MOVE PV-CSR-OPER-UNT-ID   TO PV-PREV-OPER-UNT-ID         09220503
092206         MOVE PV-CSR-UPLD-TRN-CDE  TO PV-PREV-UPLD-TRN-CDE        09220603
092207         MOVE PV-CSR-ERR-CDE       TO PV-PREV-ERR-CDE             09220703
092208         MOVE PV-CSR-DIVERT-NUMBER TO PV-PREV-DIVERT-NUMBER       09220816
092209         MOVE PV-CSR-DOOR-NUMBER   TO PV-PREV-DOOR-NUMBER         09220916
092210         MOVE PV-CSR-STR-NBR       TO PV-PREV-STR-NBR             09221034
092211         MOVE PV-CSR-ERROR-REASON  TO PV-PREV-ERROR-REASON        09221134
092212     END-IF.                                                      09221234
092213                                                                  09221334
092214     IF  PS-TUPLDER-BYPASS-YES                                    09221434
092215         ADD  1  TO  PV-BYPASS-COUNT                              09221534
092216     ELSE                                                         09221634
092217         ADD  1  TO  PV-ERROR-COUNT                               09221734
092218         PERFORM 4010-WRITE-ERROR-RECORD                          09221834
092221     END-IF.                                                      09222134
092222                                                                  09222234
092223     PERFORM 3005-FETCH-TUPLDER-CSR.                              09222334
092224                                                                  09222434
092225                                                                  09222534
092226******************************************************************09222634
092227* CLOSE TUPLDER CURSOR                                            09222734
092228******************************************************************09222834
092229 3015-CLOSE-TUPLDER-CSR.                                          09222934
092230                                                                  09223034
092231     PERFORM                                                      09223134
092232         WITH TEST AFTER                                          09223234
092233         VARYING PV-COUNTER                                       09223334
092234         FROM 1 BY 1                                              09223434
092235         UNTIL ((PV-COUNTER > PC-MAX-RETRIES) OR                  09223534
092236                (SQLCODE = ZERO))                                 09223634
092237         EXEC SQL                                                 09223734
092238             CLOSE TUPLDER-CSR                                    09223834
092239         END-EXEC                                                 09223934
092240                                                                  09224034
092241         EVALUATE TRUE                                            09224134
092242             WHEN SQLCODE = +0                                    09224234
092243             WHEN SQLCODE = -904                                  09224334
092244             WHEN SQLCODE = -911                                  09224434
092245             WHEN SQLCODE = -913                                  09224534
092246                 CONTINUE                                         09224634
092247             WHEN SQLWARN0 NOT EQUAL SPACE                        09224734
092248             WHEN SQLCODE NOT EQUAL ZERO                          09224834
092249                 MOVE '3015-CLOSE-TUPLDER-CSR'                    09224934
092250                                      TO PV-ABEND-PARAGRAPH       09225034
092251                 MOVE 'ERROR CLOSING TUPLDER CURSOR     '         09225134
092252                                      TO PV-ABEND-OPER-MESSAGE-1  09225234
092253                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09225334
092254                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09225434
092255                         PV-OPER-UNT-ID-DISP                      09225559
092258                                         DELIMITED BY SIZE        09225834
092259                                    INTO PV-ABEND-OPER-MESSAGE-2  09225934
092260                 MOVE 'TUPLDER'       TO PV-ABEND-TABLE-1         09226034
092261                 PERFORM 9100-SQL-ABEND                           09226134
092262         END-EVALUATE                                             09226234
092263     END-PERFORM.                                                 09226334
092264                                                                  09226434
092265     IF  PV-COUNTER > PC-MAX-RETRIES                              09226534
092266         MOVE '3015-CLOSE-TUPLDER-CSR'                            09226634
092267                                      TO PV-ABEND-PARAGRAPH       09226734
092268         MOVE 'MAX RETRIES ERROR CLOSING TUPLDER CURSOR'          09226834
092269                                      TO PV-ABEND-OPER-MESSAGE-1  09226934
092270         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09227034
092271         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        09227134
092272                 PV-OPER-UNT-ID-DISP  '-'                         09227259
092275                                         DELIMITED BY SIZE        09227558
092276                                    INTO PV-ABEND-OPER-MESSAGE-2  09227658
092277         MOVE 'TUPLDER'               TO PV-ABEND-TABLE-1         09227758
092278         PERFORM 9100-SQL-ABEND                                   09227858
092279     END-IF.                                                      09227958
092280                                                                  09228058
092281                                                                  09228158
092282******************************************************************09228259
092283* CHECK DOOR TYPE AND STORE ASSIGNMENT                           *09228359
092284******************************************************************09228459
092285 3020-CHECK-DOOR-DEFN.                                            09228559
092286                                                                  09228659
092287     SET  PS-EOF-DOOR-STR-NO  TO  TRUE.                           09228759
092288                                                                  09228859
092289     PERFORM 3030-OPEN-DOOR-STR-CSR.                              09228959
092290                                                                  09229059
092291     PERFORM 3035-FETCH-DOOR-STR-CSR                              09229159
092292       UNTIL PS-EOF-DOOR-STR.                                     09229259
092293                                                                  09229359
092294     PERFORM 3040-CLOSE-DOOR-STR.                                 09229459
092295                                                                  09229559
092350                                                                  09235059
092364******************************************************************09236459
092365* CHECK TCNDRST - CHECK WHAT DOOR THE CRTN STORE IS ASSIGNED TO  *09236560
092366******************************************************************09236659
092367 3025-CHECK-STORE-DOOR.                                           09236759
092376                                                                  09237684
092377     SET  PS-EOF-STORE-ASGMT-NO                                   09237786
092378          PS-STORE-CSR-FIRST     TO  TRUE.                        09237886
092379                                                                  09237986
092380     MOVE PV-PREV-OPER-UNT-ID TO  CNDRST-OPER-UNT-ID.             09238086
092381     MOVE PV-PREV-STR-NBR     TO  CNDRST-STR-NBR.                 09238186
092382                                                                  09238286
092383     PERFORM 3060-OPEN-STORE-ASGMT-CSR.                           09238386
092384                                                                  09238484
092385     PERFORM 3065-FETCH-STORE-ASGMT-CSR                           09238584
092386       UNTIL PS-EOF-STORE-ASGMT.                                  09238684
092387                                                                  09238784
092388     PERFORM 3070-CLOSE-STORE-ASGMT-CSR.                          09238884
092442                                                                  09244260
092443                                                                  09244360
092444******************************************************************09244460
092445* OPEN DOOR DEFINITION/TYPE/STORE ASGMT CURSOR                   *09244560
092446******************************************************************09244660
092447 3030-OPEN-DOOR-STR-CSR.                                          09244767
092448     MOVE PV-PREV-OPER-UNT-ID   TO CNDCDR-OPER-UNT-ID.            09244869
092449     MOVE PV-PREV-DIVERT-NUMBER TO CNDCDR-DIVERT-NBR.             09244969
092450     MOVE PV-PREV-DOOR-NUMBER   TO CNDCDR-DIVERT-LOC-ID.          09245069
092455                                                                  09245560
092456     PERFORM WITH TEST AFTER                                      09245660
092457       VARYING PV-COUNTER FROM 1 BY 1                             09245760
092458         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    09245860
092459                SQLCODE = ZERO)                                   09245960
092460                                                                  09246060
092461         EXEC SQL                                                 09246160
092462              OPEN DOOR-STR-CSR                                   09246260
092463         END-EXEC                                                 09246360
092464                                                                  09246460
092465         EVALUATE TRUE                                            09246560
092466             WHEN SQLCODE = +0                                    09246660
092467             WHEN SQLCODE = -904                                  09246760
092468             WHEN SQLCODE = -911                                  09246860
092469             WHEN SQLCODE = -913                                  09246960
092470                 CONTINUE                                         09247060
092471             WHEN SQLWARN0 NOT EQUAL SPACE                        09247160
092472             WHEN SQLCODE NOT EQUAL ZERO                          09247260
092473                 MOVE '3030-OPEN-DOOR-STR-CSR'                    09247360
092474                                      TO PV-ABEND-PARAGRAPH       09247460
092475                 MOVE 'ERROR OPENING DOOR-STR CURSOR  '           09247560
092476                                      TO PV-ABEND-OPER-MESSAGE-1  09247660
092477                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09247760
092478                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09247860
092479                         PV-OPER-UNT-ID-DISP  '-'                 09247960
092480                         PV-CSR-DIVERT-NUMBER '-'                 09248060
092481                         PV-CSR-DOOR-NUMBER                       09248160
092482                                         DELIMITED BY SIZE        09248260
092483                                   INTO PV-ABEND-OPER-MESSAGE-2   09248360
092484                 MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1         09248460
092485                 MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2         09248560
092486                 MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3         09248660
092487                 PERFORM 9100-SQL-ABEND                           09248760
092488         END-EVALUATE                                             09248860
092489     END-PERFORM.                                                 09248960
092490                                                                  09249060
092491     IF  PV-COUNTER > PC-MAX-RETRIES                              09249160
092492         MOVE '3030-OPEN-DOOR-STR-CSR'                            09249260
092493                                      TO PV-ABEND-PARAGRAPH       09249360
092494         MOVE 'MAX RETRIES ERROR OPENING DOOR-STR CURSOR  '       09249460
092495                                      TO PV-ABEND-OPER-MESSAGE-1  09249560
092496         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09249660
092497         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                09249760
092498                 PV-OPER-UNT-ID-DISP  '-'                         09249860
092499                 PV-CSR-DIVERT-NUMBER '-'                         09249960
092500                 PV-CSR-DOOR-NUMBER                               09250060
092501                                 DELIMITED BY SIZE                09250160
092502                                    INTO PV-ABEND-OPER-MESSAGE-2  09250260
092503         MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1                 09250360
092504         MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2                 09250460
092505         MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3                 09250560
092506         PERFORM 9100-SQL-ABEND                                   09250660
092507     END-IF.                                                      09250760
092508                                                                  09250860
092509                                                                  09250960
092510******************************************************************09251060
092511* FETCH DOOR DEFINITION/TYPE/STORE ASGMT CURSOR                  *09251160
092512******************************************************************09251260
092513 3035-FETCH-DOOR-STR-CSR.                                         09251360
092514                                                                  09251460
092515     EXEC SQL                                                     09251560
092516          FETCH DOOR-STR-CSR                                      09251660
092517           INTO :PV-STR-CSR-OPER-UNT-ID                           09251763
092518              , :CNDCDR-DOOR-ID                                   09251860
092519              , :CNDCDR-DOOR-TYP-CDE                              09251960
092520              , :CNDCDR-DOOR-LOC-DESC                             09252060
092521              , :PV-CSR-DIVERT-NBR                                09252160
092522              , :PV-CSR-DIVERT-LOC-ID                             09252260
092523              , :CNDRTY-DOOR-TYP-CDE-DESC                         09252360
092524              , :CNDRST-STR-NBR      :PV-NULL-IND-1               09252460
092525              , :PV-CSR-ASGMT-DATE   :PV-NULL-IND-2               09252560
092526              , :PV-CSR-ASGMT-TIME   :PV-NULL-IND-3               09252660
092527     END-EXEC.                                                    09252760
092528                                                                  09252860
092529     EVALUATE TRUE                                                09252960
092530       WHEN SQLCODE = ZERO                                        09253060
092531             IF  PV-NULL-IND-1  =  -1                             09253160
092532                 MOVE ZEROES            TO  CNDRST-STR-NBR        09253260
092533             END-IF                                               09253360
092534             IF  PV-NULL-IND-2  =  -1                             09253460
092535                 MOVE SPACES            TO  PV-CSR-ASGMT-DATE     09253560
092536             END-IF                                               09253660
092537             IF  PV-NULL-IND-3  =  -1                             09253760
092538                 MOVE SPACES            TO  PV-CSR-ASGMT-DATE     09253860
092539             END-IF                                               09253960
092540                                                                  09254060
092542            MOVE CNDCDR-DOOR-ID         TO  DT1-DOOR              09254260
092543            MOVE CNDCDR-DOOR-TYP-CDE    TO  DT1-TYPE              09254360
092545            MOVE PV-PREV-DIVERT-NUMBER  TO  DT1-DIVERT-NBR        09254569
092546            MOVE PV-PREV-DOOR-NUMBER    TO  DT1-LOC-ID            09254669
092547            MOVE CNDRST-STR-NBR         TO  DT1-STR               09254760
092550            WRITE ERROR-OUT-RECORD    FROM  DT1-REC               09255060
092551                                                                  09255160
092552       WHEN SQLCODE = +100                                        09255260
092553           SET PS-EOF-DOOR-STR       TO TRUE                      09255360
092554       WHEN SQLWARN0 NOT EQUAL SPACE                              09255460
092555       WHEN SQLCODE NOT EQUAL ZERO                                09255560
092556           MOVE '035-FETCH-DOOR-STR-CSR'                          09255660
092557                                     TO PV-ABEND-PARAGRAPH        09255760
092558           MOVE 'FETCH DOOR-STR CURSOR'                           09255860
092559                                     TO PV-ABEND-OPER-MESSAGE-1   09255960
092560           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          09256060
092561           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              09256160
092562                   PV-OPER-UNT-ID-DISP  '-'                       09256260
092563                   PV-CSR-DIVERT-NUMBER '-'                       09256360
092564                   PV-CSR-DOOR-NUMBER                             09256460
092565                                   DELIMITED BY SIZE              09256560
092566                                   INTO PV-ABEND-OPER-MESSAGE-2   09256660
092567           MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1               09256760
092568           MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2               09256860
092569           MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3               09256960
092570           PERFORM 9100-SQL-ABEND                                 09257060
092571     END-EVALUATE.                                                09257160
092572                                                                  09257260
092573                                                                  09257360
092574******************************************************************09257460
092575* CLOSE DOOR DEFINITION/TYPE/STORE ASGMT CURSOR                  *09257560
092576******************************************************************09257660
092577 3040-CLOSE-DOOR-STR.                                             09257760
092578                                                                  09257860
092579     PERFORM WITH TEST AFTER                                      09257960
092580       VARYING PV-COUNTER FROM 1 BY 1                             09258060
092581         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    09258160
092582                SQLCODE = ZERO)                                   09258260
092583                                                                  09258360
092584         EXEC SQL                                                 09258460
092585              CLOSE DOOR-STR-CSR                                  09258560
092586         END-EXEC                                                 09258660
092587                                                                  09258760
092588         EVALUATE TRUE                                            09258860
092589             WHEN SQLCODE = +0                                    09258960
092590             WHEN SQLCODE = -904                                  09259060
092591             WHEN SQLCODE = -911                                  09259160
092592             WHEN SQLCODE = -913                                  09259260
092593                 CONTINUE                                         09259360
092594             WHEN SQLWARN0 NOT EQUAL SPACE                        09259460
092595             WHEN SQLCODE NOT EQUAL ZERO                          09259560
092596                 MOVE '3040-CLOSE-DOOR-STR'                       09259660
092597                                      TO PV-ABEND-PARAGRAPH       09259760
092598                 MOVE 'ERROR CLOSE DOOR-STR CURSOR  '             09259860
092599                                      TO PV-ABEND-OPER-MESSAGE-1  09259960
092600                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09260060
092601                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09260160
092602                         PV-OPER-UNT-ID-DISP  '-'                 09260260
092603                         PV-CSR-DIVERT-NUMBER '-'                 09260360
092604                         PV-CSR-DOOR-NUMBER                       09260460
092605                                         DELIMITED BY SIZE        09260560
092606                                   INTO PV-ABEND-OPER-MESSAGE-2   09260660
092607                 MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1         09260760
092608                 MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2         09260860
092609                 MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3         09260960
092610                 PERFORM 9100-SQL-ABEND                           09261060
092611         END-EVALUATE                                             09261160
092612     END-PERFORM.                                                 09261260
092613                                                                  09261360
092614     IF  PV-COUNTER > PC-MAX-RETRIES                              09261460
092615         MOVE '3040-CLOSE-DOOR-STR   '                            09261560
092616                                      TO PV-ABEND-PARAGRAPH       09261660
092617         MOVE 'MAX RETRIES ERROR CLOSE DOOR-STR CURSOR  '         09261760
092618                                      TO PV-ABEND-OPER-MESSAGE-1  09261860
092619         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09261960
092620         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                09262060
092621                 PV-OPER-UNT-ID-DISP  '-'                         09262160
092622                 PV-CSR-DIVERT-NUMBER '-'                         09262260
092623                 PV-CSR-DOOR-NUMBER                               09262360
092624                                 DELIMITED BY SIZE                09262460
092625                                    INTO PV-ABEND-OPER-MESSAGE-2  09262560
092626         MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1                 09262660
092627         MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2                 09262760
092628         MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3                 09262860
092629         PERFORM 9100-SQL-ABEND                                   09262960
092630     END-IF.                                                      09263060
092631                                                                  09263160
092632                                                                  09263260
092633******************************************************************09263360
092634*                                                                *09263460
092635******************************************************************09263560
092636 3050-CHECK-BYPASS.                                               09263660
092637                                                                  09263760
092638     MOVE ZEROES  TO  PV-BYPASS-PARM-CNT.                         09263860
092639     SET  PS-TUPLDER-BYPASS-NO  TO  TRUE.                         09263960
092640                                                                  09264060
092641     PERFORM WITH TEST AFTER                                      09264160
092642       VARYING PV-COUNTER FROM 1 BY 1                             09264260
092643         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       09264360
092644                OR                                                09264460
092645                SQLCODE = ZERO)                                   09264560
092646                                                                  09264660
092647         EXEC SQL                                                 09264760
092648             SELECT COUNT(*)                                      09264860
092649               INTO :PV-BYPASS-PARM-CNT                           09264960
092650               FROM                                               09265060
092651                     WST_INTGRTN_TYP  A                           09265160
092652                  ,  WST_ATTR_DEFN    B                           09265260
092653                  ,  WST_ATTR_ELEM    C                           09265360
092654                  ,  WST_ATTR_ELEM    D                           09265460
092655                  ,  WST_ATTR_ELEM    E                           09265560
092656                  ,  WST_ATTR_ELEM    F                           09265660
092657                  ,  WST_ATTR_ELEM    G                           09265760
092658                  ,  WST_ATTR_ELEM    H                           09265860
092659                  ,  WST_ATTR_ELEM    I                           09265960
092660               WHERE                                              09266060
092661                     A.INTGRTN_TYP_CDE   = 'CNVYERRBYP'           09266160
092662                 AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE      09266260
092663                 AND B.ATTR_DEFN_SEQ_NBR = 1                      09266360
092664                 AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE      09266460
092665                 AND C.ATTR_DEFN_SEQ_NBR = 1                      09266560
092666                 AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE      09266660
092667                 AND D.ATTR_DEFN_SEQ_NBR = 2                      09266760
092668                 AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE      09266860
092669                 AND E.ATTR_DEFN_SEQ_NBR = 3                      09266960
092670                 AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE      09267060
092671                 AND F.ATTR_DEFN_SEQ_NBR = 4                      09267160
092672                 AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE      09267260
092673                 AND G.ATTR_DEFN_SEQ_NBR = 5                      09267360
092674                 AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE      09267460
092675                 AND H.ATTR_DEFN_SEQ_NBR = 6                      09267560
092676                 AND B.INTGRTN_TYP_CDE   = I.INTGRTN_TYP_CDE      09267660
092677                 AND I.ATTR_DEFN_SEQ_NBR = 7                      09267760
092678                 AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR    09267860
092679                 AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR    09267960
092680                 AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR    09268060
092681                 AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR    09268160
092682                 AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR    09268260
092683                 AND C.ATTR_ELEM_SEQ_NBR = I.ATTR_ELEM_SEQ_NBR    09268360
092684                                                                  09268460
092685                 AND C.ATTR_ELEM_TXT = :PV-CSR-UPLD-TRN-CDE       09268560
092686                 AND D.ATTR_ELEM_TXT = :PV-CSR-ERR-CDE            09268660
092687                 AND E.ATTR_ELEM_NBR = :PV-CSR-OPER-UNT-ID        09268760
092688                 AND F.ATTR_ELEM_TXT = :PV-CSR-DIVERT-NUMBER      09268860
092689                 AND G.ATTR_ELEM_TXT = :PV-CSR-DOOR-NUMBER        09268960
092690                 AND H.ATTR_ELEM_TXT = 'A'                        09269060
092691               FETCH FIRST 1 ROW ONLY                             09269160
092692               WITH UR                                            09269260
092693         END-EXEC                                                 09269360
092694                                                                  09269460
092695         EVALUATE TRUE                                            09269560
092696             WHEN SQLCODE = ZERO                                  09269660
092697                  IF  PV-BYPASS-PARM-CNT > 0                      09269760
092698                      SET PS-TUPLDER-BYPASS-YES  TO  TRUE         09269860
092699                  ELSE                                            09269960
092700                      SET PS-TUPLDER-BYPASS-NO   TO  TRUE         09270060
092701                  END-IF                                          09270160
092702                                                                  09270260
092703             WHEN SQLCODE = +100                                  09270360
092704             WHEN SQLCODE = -305                                  09270460
092705                  SET PS-TUPLDER-BYPASS-NO   TO  TRUE             09270560
092706                                                                  09270660
092707             WHEN SQLCODE = -904                                  09270760
092708             WHEN SQLCODE = -911                                  09270860
092709                 CONTINUE                                         09270960
092710                                                                  09271060
092711             WHEN SQLWARN0 NOT = SPACES                           09271160
092712             WHEN SQLCODE < ZERO                                  09271260
092713             WHEN SQLCODE > ZERO                                  09271360
092714                 MOVE '3050-CHECK-BYPASS              '           09271460
092715                                 TO PV-ABEND-PARAGRAPH            09271560
092716                 MOVE 'CHECK IF TUPLDER IS BYPASSED   '           09271660
092717                                 TO PV-ABEND-OPER-MESSAGE-1       09271760
092718                 MOVE 'WST00008' TO PV-ABEND-TABLE-1              09271860
092719                 MOVE 'WST00009' TO PV-ABEND-TABLE-2              09271960
092720                 MOVE 'WST00010' TO PV-ABEND-TABLE-3              09272060
092721                 PERFORM 9100-SQL-ABEND                           09272160
092722                                                                  09272260
092723         END-EVALUATE                                             09272360
092724     END-PERFORM.                                                 09272460
092725                                                                  09272560
092726     IF PV-COUNTER > PC-MAX-RETRIES                               09272660
092727         MOVE '3050-CHECK-BYPASS           '                      09272760
092728                                 TO PV-ABEND-PARAGRAPH            09272860
092729         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM WST    '09272960
092730                                 TO PV-ABEND-OPER-MESSAGE-1       09273060
092731         MOVE 'WST00008'         TO PV-ABEND-TABLE-1              09273160
092732         MOVE 'WST00009'         TO PV-ABEND-TABLE-2              09273260
092733         MOVE 'WST00010'         TO PV-ABEND-TABLE-3              09273360
092734         PERFORM 9100-SQL-ABEND                                   09273460
092735     END-IF.                                                      09273560
092736                                                                  09273660
092737                                                                  09273784
092738******************************************************************09273884
092739* OPEN  STORE TO DOOR ASSIGNMENT CURSOR                          *09273984
092740******************************************************************09274084
092741 3060-OPEN-STORE-ASGMT-CSR.                                       09274184
092742                                                                  09274284
092743     PERFORM WITH TEST AFTER                                      09274384
092744       VARYING PV-COUNTER FROM 1 BY 1                             09274484
092745         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    09274584
092746                SQLCODE = ZERO)                                   09274684
092747                                                                  09274784
092748         EXEC SQL                                                 09274884
092749              OPEN STORE-ASGMT-CSR                                09274984
092750         END-EXEC                                                 09275084
092751                                                                  09275184
092752         EVALUATE TRUE                                            09275284
092753             WHEN SQLCODE = +0                                    09275384
092754             WHEN SQLCODE = -904                                  09275484
092755             WHEN SQLCODE = -911                                  09275584
092756             WHEN SQLCODE = -913                                  09275684
092757                 CONTINUE                                         09275784
092758             WHEN SQLWARN0 NOT EQUAL SPACE                        09275884
092759             WHEN SQLCODE NOT EQUAL ZERO                          09275984
092760                 MOVE '3060-OPEN-STORE-ASGMT-CSR '                09276084
092761                                      TO PV-ABEND-PARAGRAPH       09276184
092762                 MOVE 'ERROR OPEN STORE-ASGMT CSR  '              09276284
092763                                      TO PV-ABEND-OPER-MESSAGE-1  09276384
092764                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09276484
092765                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09276584
092766                         PV-OPER-UNT-ID-DISP  '-'                 09276684
092767                         PV-CSR-DIVERT-NUMBER '-'                 09276784
092768                         PV-CSR-DOOR-NUMBER                       09276884
092769                                         DELIMITED BY SIZE        09276984
092770                                   INTO PV-ABEND-OPER-MESSAGE-2   09277084
092771                 MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1         09277184
092772                 MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2         09277284
092773                 MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3         09277384
092774                 PERFORM 9100-SQL-ABEND                           09277484
092775         END-EVALUATE                                             09277584
092776     END-PERFORM.                                                 09277684
092777                                                                  09277784
092778     IF  PV-COUNTER > PC-MAX-RETRIES                              09277884
092779         MOVE '3060-OPEN-STORE-ASGMT-CSR '                        09277984
092780                                      TO PV-ABEND-PARAGRAPH       09278084
092781         MOVE 'MAX RETRIES ERROR OPEN STORE-ASGMT CSR  '          09278184
092782                                      TO PV-ABEND-OPER-MESSAGE-1  09278284
092783         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09278384
092784         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                09278484
092785                 PV-OPER-UNT-ID-DISP  '-'                         09278584
092786                 PV-CSR-DIVERT-NUMBER '-'                         09278684
092787                 PV-CSR-DOOR-NUMBER                               09278784
092788                                 DELIMITED BY SIZE                09278884
092789                                    INTO PV-ABEND-OPER-MESSAGE-2  09278984
092790         MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1                 09279084
092791         MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2                 09279184
092792         MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3                 09279284
092793         PERFORM 9100-SQL-ABEND                                   09279384
092794     END-IF.                                                      09279484
092795                                                                  09279584
092798                                                                  09279884
092799******************************************************************09279984
092800* FETCH STORE TO DOOR ASSIGNMENT CURSOR                          *09280084
092801******************************************************************09280184
092802 3065-FETCH-STORE-ASGMT-CSR.                                      09280285
092805                                                                  09280584
092806     EXEC SQL                                                     09280684
092807          FETCH STORE-ASGMT-CSR                                   09280784
092808            INTO :CNDRST-DOOR-ID                                  09280884
092809               , :CNDRST-STRT-TMST                                09280984
092820     END-EXEC.                                                    09282084
092821                                                                  09282184
092822     EVALUATE TRUE                                                09282284
092823       WHEN SQLCODE = ZERO                                        09282384
092833                                                                  09283384
092834            MOVE  CNDRST-STR-NBR   TO  DT2-STR                    09283484
092835            MOVE  CNDRST-DOOR-ID   TO  DT2-DOOR                   09283584
092836            MOVE  CNDRST-STRT-TMST TO  DT2-DATE                   09283684
092837            WRITE ERROR-OUT-RECORD    FROM  DT2-REC               09283784
092844                                                                  09284484
092845       WHEN SQLCODE = +100                                        09284584
092846            IF  PS-STORE-CSR-FIRST                                09284686
092847                MOVE  PV-CSR-STR-NBR  TO  DT3-STR                 09284786
092848                WRITE ERROR-OUT-RECORD    FROM  DT3-REC           09284886
092849            END-IF                                                09284986
092850           SET PS-EOF-STORE-ASGMT    TO TRUE                      09285084
092851                                                                  09285184
092852       WHEN SQLWARN0 NOT EQUAL SPACE                              09285284
092853       WHEN SQLCODE NOT EQUAL ZERO                                09285384
092854           MOVE '3065-FETCH-STORE-ASGMT-CSR'                      09285484
092855                                     TO PV-ABEND-PARAGRAPH        09285584
092856           MOVE 'FETCH STORE-ASGMT CSR'                           09285684
092857                                     TO PV-ABEND-OPER-MESSAGE-1   09285784
092858           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          09285884
092859           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              09285984
092860                   PV-OPER-UNT-ID-DISP  '-'                       09286084
092861                   PV-CSR-DIVERT-NUMBER '-'                       09286184
092862                   PV-CSR-DOOR-NUMBER                             09286284
092863                                   DELIMITED BY SIZE              09286384
092864                                   INTO PV-ABEND-OPER-MESSAGE-2   09286484
092865           MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1               09286584
092866           MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-2               09286684
092867           PERFORM 9100-SQL-ABEND                                 09286784
092868     END-EVALUATE.                                                09286884
092869                                                                  09286984
092870     SET  PS-STORE-CSR-FIRST-NO  TO  TRUE.                        09287086
092871                                                                  09287184
092872******************************************************************09287284
092873* CLOSE STORE TO DOOR ASSIGNMENT CURSOR                          *09287384
092874******************************************************************09287484
092875 3070-CLOSE-STORE-ASGMT-CSR.                                      09287584
092876                                                                  09287684
092877     PERFORM WITH TEST AFTER                                      09287784
092878       VARYING PV-COUNTER FROM 1 BY 1                             09287884
092879         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    09287984
092880                SQLCODE = ZERO)                                   09288084
092881                                                                  09288184
092882         EXEC SQL                                                 09288284
092883              CLOSE STORE-ASGMT-CSR                               09288384
092884         END-EXEC                                                 09288484
092885                                                                  09288584
092886         EVALUATE TRUE                                            09288684
092887             WHEN SQLCODE = +0                                    09288784
092888             WHEN SQLCODE = -904                                  09288884
092889             WHEN SQLCODE = -911                                  09288984
092890             WHEN SQLCODE = -913                                  09289084
092891                 CONTINUE                                         09289184
092892             WHEN SQLWARN0 NOT EQUAL SPACE                        09289284
092893             WHEN SQLCODE NOT EQUAL ZERO                          09289384
092894                 MOVE '3070-CLOSE-STORE-ASGMT-CSR'                09289484
092895                                      TO PV-ABEND-PARAGRAPH       09289584
092896                 MOVE 'ERROR CLOSE STORE-ASGMT CSR  '             09289684
092897                                      TO PV-ABEND-OPER-MESSAGE-1  09289784
092898                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09289884
092899                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09289984
092900                         PV-OPER-UNT-ID-DISP  '-'                 09290084
092901                         PV-CSR-DIVERT-NUMBER '-'                 09290184
092902                         PV-CSR-DOOR-NUMBER                       09290284
092903                                         DELIMITED BY SIZE        09290384
092904                                   INTO PV-ABEND-OPER-MESSAGE-2   09290484
092905                 MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1         09290584
092906                 MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2         09290684
092907                 MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3         09290784
092908                 PERFORM 9100-SQL-ABEND                           09290884
092909         END-EVALUATE                                             09290984
092910     END-PERFORM.                                                 09291084
092911                                                                  09291184
092912     IF  PV-COUNTER > PC-MAX-RETRIES                              09291284
092913         MOVE '3070-CLOSE-STORE-ASGMT-CSR'                        09291384
092914                                      TO PV-ABEND-PARAGRAPH       09291484
092915         MOVE 'MAX RETRIES ERROR CLOSE STORE-ASGMT CSR  '         09291584
092916                                      TO PV-ABEND-OPER-MESSAGE-1  09291684
092917         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09291784
092918         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                09291884
092919                 PV-OPER-UNT-ID-DISP  '-'                         09291984
092920                 PV-CSR-DIVERT-NUMBER '-'                         09292084
092921                 PV-CSR-DOOR-NUMBER                               09292184
092922                                 DELIMITED BY SIZE                09292284
092923                                    INTO PV-ABEND-OPER-MESSAGE-2  09292384
092924         MOVE 'TCNDCDR  '     TO PV-ABEND-TABLE-1                 09292484
092925         MOVE 'TCNDRTY  '     TO PV-ABEND-TABLE-2                 09292584
092926         MOVE 'TCNDRST  '     TO PV-ABEND-TABLE-3                 09292684
092927         PERFORM 9100-SQL-ABEND                                   09292784
092928     END-IF.                                                      09292884
092929                                                                  09292984
092930                                                                  09293084
092931******************************************************************09293184
092932*  SET UP THE ERROR RECORD THAT WILL BE WRITTEN TO A FILE AND     09293284
092933*  ALSO DISPLAYED IN SYSOUT WHEN THERE ARE CARTON DIVERT ERRORS   09293384
092934*  IN TUPLDER DATABASE -  THIS IS A TOTAL BY ERROR                09293484
092935*                                                                 09293584
092936*  DC: 9999 ERROR: B-101  DIVERT/DOOR: XXXX/XXXX   COUNT: ZZZ,ZZZ 09293684
092937******************************************************************09293784
092938 4000-PRINT-ERROR-COUNT.                                          09293884
092939                                                                  09293984
092940     MOVE  PV-PREV-OPER-UNT-ID    TO OR-DC-NBR.                   09294084
092941     MOVE  PV-PREV-UPLD-TRN-CDE   TO OR-TRN-CDE.                  09294184
092942     MOVE  PV-PREV-ERR-CDE        TO OR-ERR-CDE.                  09294284
092943     MOVE  PV-PREV-DIVERT-NUMBER  TO OR-DIVERT.                   09294384
092944     MOVE  PV-PREV-DOOR-NUMBER    TO OR-DOOR.                     09294484
092945     MOVE  PV-PREV-STR-NBR        TO OR-STR-NBR.                  09294584
092946     MOVE  PV-ERROR-COUNT         TO OR-ERR-CNT.                  09294684
092947     MOVE  PV-PREV-ERROR-REASON   TO OR-ERR-RSN.                  09294784
092948                                                                  09294884
092949     MOVE  SPACES                 TO HEAD-REC.                    09294984
092950     DISPLAY HEAD-REC.                                            09295084
092951     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09295184
092952                                                                  09295284
092953     MOVE SPACES                        TO HEAD-REC.              09295384
092954     MOVE  OUTPUT-REC-COUNT             TO HEAD-REC.              09295484
092955     DISPLAY HEAD-REC.                                            09295584
092956     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09295684
092957     MOVE SPACES                        TO HEAD-REC.              09295784
092958     MOVE  OUTPUT-REC2                  TO HEAD-REC.              09295884
092959     DISPLAY HEAD-REC.                                            09295984
092960     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09296084
092961                                                                  09296184
092962                                                                  09296284
092963                                                                  09296384
092964******************************************************************09296484
092965*                                                                *09296584
092966******************************************************************09296684
092967 4010-WRITE-ERROR-RECORD.                                         09296784
092968                                                                  09296884
092969     MOVE  SPACES                TO  SU172-CONV-UPLDER-RECORD.    09296984
092970     MOVE  PV-CSR-OPER-UNT-ID    TO  SU172-OPER-UNT-ID.           09297084
092971     MOVE  PV-CSR-UPLD-TRN-CDE   TO  SU172-UPLD-TRN-CDE.          09297184
092972     MOVE  PV-CSR-ERR-CDE        TO  SU172-ERR-CDE.               09297284
092973     MOVE  PV-CSR-ERROR-REASON   TO  SU172-ERROR-REASON.          09297384
092974     MOVE  PV-CSR-PRC-TMST       TO  SU172-PRC-TMST.              09297484
092975     MOVE  PV-CSR-DC-NBR         TO  SU172-DC-NBR.                09297584
092976     MOVE  PV-CSR-STR-NBR        TO  SU172-STR-NBR.               09297684
092977     MOVE  PV-CSR-BARCODE        TO  SU172-BARCODE.               09297784
092978     MOVE  PV-CSR-DIVERT-NUMBER  TO  SU172-DIVERT-NUMBER.         09297884
092979     MOVE  PV-CSR-DOOR-NUMBER    TO  SU172-DOOR-NUMBER.           09297984
092980     MOVE  PV-CSR-DIVERT-DATE    TO  SU172-DIVERT-DATE.           09298084
092981     MOVE  PV-CSR-DIVERT-TIME    TO  SU172-DIVERT-TIME.           09298184
092982     MOVE  PV-CSR-PKT-TXT        TO  SU172-SURD014-PKT-TXT.       09298284
092983                                                                  09298384
092984     WRITE ERROR-DTL-RECORD FROM SU172-CONV-UPLDER-RECORD.        09298484
092985                                                                  09298584
092986     ADD  1  TO  PV-TOTAL-ERROR-CNT.                              09298684
092987                                                                  09298784
092988                                                                  09298884
092989******************************************************************09298984
092990*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    09299084
092991*  ERROR OR WARNING CODE OCCURS.                                  09299184
092992******************************************************************09299284
092993 9100-SQL-ABEND.                                                  09299384
092994     MOVE SQLCODE    TO PV-SQLCODE.                               09299484
092995     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       09299584
092996                                                                  09299684
092997     DISPLAY '9100-SQL-ABEND'.                                    09299784
092998     DISPLAY '** ABEND              **'.                          09299884
092999     DISPLAY '** SQLCODE            ** = ' PV-DISPLAY-SQLCODE.    09299984
093000     DISPLAY '** PROGRAM            ** = ' PC-CURRENT-PROGRAM-NAME09300084
093001     DISPLAY '** PARAGRAPH          ** = ' PV-ABEND-PARAGRAPH.    09300184
093002     DISPLAY '** TABLE(S) AFFECTED  ** = ' PV-ABEND-TABLE-1.      09300284
093003     DISPLAY '**                    ** = ' PV-ABEND-TABLE-2.      09300384
093004     DISPLAY '**                    ** = ' PV-ABEND-TABLE-3.      09300484
093005     DISPLAY '**                    ** = ' PV-ABEND-TABLE-4.      09300500
093010     DISPLAY '** OPERATION          ** = ' PV-ABEND-OPER-MESSAGE-109301000
093100     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-209310000
093200     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-309320000
093300     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-409330000
093400     DISPLAY '**                    ** = '                        09340000
093500                                                                  09350000
093600******************************************************************09360000
093700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09370000
093800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09380000
093900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09390000
094000* FORMAT.                                                         09400000
094100******************************************************************09410000
094200     COPY DPPD004.                                                09420000
094300                                                                  09430000
094400     MOVE +4013                  TO ABEND-CODE.                   09440000
094500     CALL 'ILBOABN0' USING ABEND-CODE.                            09450000
