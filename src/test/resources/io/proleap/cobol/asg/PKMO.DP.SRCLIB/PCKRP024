000100 IDENTIFICATION DIVISION.                                         00010006
000200 TITLE 'PRE-COUNT STORES UNBALANCED EXPECTED REPORT'.             00020006
000300                                                                  00030006
000400 PROGRAM-ID.             PCKRP024.                                00040006
000500 AUTHOR.                 DENNIS STEFFEN.                          00050006
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060006
000700 DATE-WRITTEN.           APRIL 2006.                              00070006
000800 DATE-COMPILED.                                                   00080006
000900                                                                  00090006
001000 ENVIRONMENT DIVISION.                                            00100006
001100 CONFIGURATION SECTION.                                           00110006
001200 SOURCE-COMPUTER.                        IBM-3090.                00120006
001300 OBJECT-COMPUTER.                        IBM-3090.                00130006
001400 INPUT-OUTPUT SECTION.                                            00140006
001500 FILE-CONTROL.                                                    00150006
001600                                                                  00160006
001700     SELECT EXTRACT-FILE                                          00170006
001800         ASSIGN TO INP01.                                         00180006
001900                                                                  00190006
002000     SELECT  REPORT-FILE                                          00200006
002100         ASSIGN TO RPT01.                                         00210006
002200                                                                  00220006
002300                                                                  00230006
002400 DATA DIVISION.                                                   00240006
002500 FILE SECTION.                                                    00250006
002600                                                                  00260006
002700 FD  EXTRACT-FILE                                                 00270006
002800     RECORDING MODE IS F                                          00280006
002900     LABEL RECORDS ARE STANDARD                                   00290006
003000     BLOCK CONTAINS 0 RECORDS.                                    00300006
003100 01  ERROR-RECORD                     PIC X(150).                 00310006
003200                                                                  00320006
003300 FD  REPORT-FILE                                                  00330006
003400     RECORDING MODE IS F                                          00340006
003500     LABEL RECORDS ARE STANDARD                                   00350006
003600     BLOCK CONTAINS 0 RECORDS.                                    00360006
003700 01  REPORT-RECORD                    PIC X(132).                 00370006
003800/                                                                 00380006
003900 WORKING-STORAGE SECTION.                                         00390006
004000 01  PS-SWITCHES.                                                 00400006
004100     05  PS-EOF-ERROR-SWITCH          PIC X(01) VALUE 'N'.        00410006
004200         88  PS-EOF-ERROR-FILE                  VALUE 'Y'.        00420006
004300                                                                  00430006
004400     05  PS-BLANK-LINE-SWITCH         PIC X(01) VALUE 'N'.        00440006
004500         88  PS-BLANK-LINE                      VALUE 'Y'.        00450006
004600         88  PS-BLANK-LINE-NO                   VALUE 'N'.        00460006
004700                                                                  00470006
004800                                                                  00480006
004900 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00490006
005000                                                 COMP SYNC.       00500006
005100     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00510006
005200                                                                  00520006
005300 01  SD-SYSTEM-DATE.                                              00530006
005400     05  SD-SYSTEM-DATE-YY          PIC  9(02)   VALUE ZERO.      00540006
005500     05  SD-SYSTEM-DATE-MM          PIC  9(02)   VALUE ZERO.      00550006
005600     05  SD-SYSTEM-DATE-DD          PIC  9(02)   VALUE ZERO.      00560006
005700                                                                  00570006
005800 01  ST-SYSTEM-TIME.                                              00580006
005900     05  ST-SYSTEM-HOUR             PIC  9(02)   VALUE ZERO.      00590006
006000     05  ST-SYSTEM-MINUTE           PIC  9(02)   VALUE ZERO.      00600006
006100     05  FILLER                     PIC  9(04)   VALUE ZERO.      00610006
006200                                                                  00620006
006300 01  PV-VARIABLES.                                                00630006
006400     05  PV-TMST                      PIC X(26) VALUE SPACES.     00640006
006500     05  PV-READ-COUNT                PIC S9(7) COMP-3            00650006
006600                                                VALUE ZERO.       00660006
006700     05  PV-BOSS-COUNT                PIC S9(7) COMP-3            00670006
006800                                                VALUE ZERO.       00680006
006900     05  PV-WRITE-COUNT               PIC S9(7) COMP-3            00690006
007000                                                VALUE ZERO.       00700006
007100     05  PV-PAGE-COUNT                PIC S9(7) COMP-3            00710006
007200                                                VALUE ZERO.       00720006
007300     05  PV-LINES-USED                PIC S9(4) COMP-3            00730006
007400                                                VALUE ZERO.       00740006
007500     05  PV-DB2-FUNCTION              PIC X(30) VALUE SPACES.     00750006
007600     05  PV-PARAGRAPH                 PIC X(30) VALUE SPACES.     00760006
007700     05  PV-DISP-NUMBER               PIC Z,ZZZ,ZZ9.              00770006
007800     05  PV-DISP-COUNT                PIC Z,ZZZ,ZZZ,ZZ9.          00780006
007900     05  PV-PREV-OPER                 PIC 9(05).                  00790006
008000     05  PV-CLEAN4-DAYS               PIC S9(09) COMP.            00800006
008100                                                                  00810006
008200     05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.     00820006
008300     05  PV-SAVE-START-DATE           PIC X(10) VALUE SPACES.     00830006
008400     05  PV-DB2-DATE.                                             00840006
008500         10  PV-DB2-CC                  PIC X(02).                00850006
008600         10  PV-DB2-YY                  PIC X(02).                00860006
008700         10  FILLER                     PIC X(01).                00870006
008800         10  PV-DB2-MM                  PIC X(02).                00880006
008900         10  FILLER                     PIC X(01).                00890006
009000         10  PV-DB2-DD                  PIC X(02).                00900006
009100         10  FILLER                     PIC X(01).                00910006
009200         10  PV-DB2-HH                  PIC X(02).                00920006
009300         10  FILLER                     PIC X(01).                00930006
009400         10  PV-DB2-MN                  PIC X(02).                00940006
009500         10  FILLER                     PIC X(01).                00950006
009600         10  PV-DB2-SS                  PIC X(09).                00960006
009700     05  PV-KEY-DATE.                                             00970006
009800         10  PV-KEY-MM               PIC X(02).                   00980006
009900         10  FILLER                  PIC X(01) VALUE '/'.         00990006
010000         10  PV-KEY-DD               PIC X(02).                   01000006
010100         10  FILLER                  PIC X(01) VALUE '/'.         01010006
010200         10  PV-KEY-YY               PIC X(02).                   01020006
010300     05  PV-BOSS-PARM-RECV           PIC S9(9) COMP.              01030006
010400     05  PV-BOSS-PARM-DISP           PIC -9(04).                  01040006
010500                                                                  01050006
010600 01  PC-CONSTANTS.                                                01060006
010700     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRP024'. 01070006
010800     05  PC-END-OF-PAGE               PIC S9(3) COMP-3 VALUE +60. 01080006
010900/                                                                 01090006
011000***  STANDARD REPORT HEADER FOR 132 COLUMN REPORT                 01100006
011100     COPY DPWS132O.                                               01110006
011200                                                                  01120006
011300*    ERROR EXTRACT                                                01130006
011400     COPY PCRD038.                                                01140006
011500                                                                  01150006
011600 01  HL-HEADING-LINE-1.                                           01160006
011700     05  FILLER                      PIC  X(40)  VALUE SPACES.    01170006
011800     05  FILLER                      PIC  X(41)  VALUE            01180006
011900      '   PRE COUNT STORE EXPECTED CLEAN        '.                01190006
012000     05  FILLER                      PIC  X(51)  VALUE SPACES.    01200008
012100                                                                  01210006
012200 01  HL-HEADING-LINE-1A.                                          01220006
012300     05  FILLER                      PIC  X(30)  VALUE SPACES.    01230006
012400     05  FILLER                      PIC  X(49)  VALUE            01240006
012500      '    COUNT STORES WITH UNBALANCED STORE EXPECTED >'.        01250006
012600     05  HL1-CLEAN4-DAYS             PIC  ZZZ9   VALUE ZERO.      01260006
012700     05  FILLER                      PIC  X(06) VALUE             01270006
012800         ' DAYS '.                                                01280006
012900     05  FILLER                      PIC  X(43)  VALUE SPACES.    01290008
013000                                                                  01300006
013100 01  HL-HEADING-LINE-2A.                                          01310006
013200     05  FILLER                      PIC  X(06) VALUE  SPACES.    01320007
013300     05  FILLER                      PIC  X(05) VALUE             01330007
013400         'STORE'.                                                 01340007
013500     05  FILLER                      PIC  X(16) VALUE  SPACES.    01350007
013600     05  FILLER                      PIC  X(03) VALUE             01360006
013700         'REC'.                                                   01370006
013800     05  FILLER                      PIC  X(23) VALUE  SPACES.    01380007
013900     05  FILLER                      PIC  X(09) VALUE             01390006
014000         'STORE EXP'.                                             01400006
014100     05  FILLER                      PIC  X(03) VALUE  SPACES.    01410007
014200     05  FILLER                      PIC  X(08) VALUE             01420006
014300         'LAST ACT'.                                              01430006
014400     05  FILLER                      PIC  X(05) VALUE  SPACES.    01440006
014500     05  FILLER                      PIC  X(10) VALUE             01450006
014600         'EXT RETAIL'.                                            01460006
014700     05  FILLER                      PIC  X(03) VALUE  SPACES.    01470007
014800     05  FILLER                      PIC  X(08) VALUE             01480006
014900         'CLEAN UP'.                                              01490006
015000     05  FILLER                      PIC  X(33) VALUE  SPACES.    01500007
015100                                                                  01510006
015200 01  HL-HEADING-LINE-2.                                           01520006
015300     05  FILLER                      PIC  X(01) VALUE  SPACES.    01530007
015400     05  FILLER                      PIC  X(02) VALUE             01540006
015500         'DC'.                                                    01550006
015600     05  FILLER                      PIC  X(04) VALUE  SPACES.    01560006
015700     05  FILLER                      PIC  X(03) VALUE             01570007
015800         'NBR'.                                                   01580007
015900     05  FILLER                      PIC  X(03) VALUE  SPACES.    01590007
016000     05  FILLER                      PIC  X(11) VALUE             01600006
016100         'PO/RECEIVER'.                                           01610006
016200     05  FILLER                      PIC  X(03) VALUE  SPACES.    01620007
016300     05  FILLER                      PIC  X(03) VALUE             01630006
016400         'TYP'.                                                   01640006
016410     05  FILLER                      PIC  X(02) VALUE  SPACES.    01641008
016420     05  FILLER                      PIC  X(04) VALUE             01642007
016430         'DEPT'.                                                  01643007
016500     05  FILLER                      PIC  X(01) VALUE  SPACES.    01650007
016600     05  FILLER                      PIC  X(04) VALUE             01660006
016700         'SEPH'.                                                  01670007
016800     05  FILLER                      PIC  X(04) VALUE  SPACES.    01680007
016900     05  FILLER                      PIC  X(03) VALUE             01690006
017000         'SKU'.                                                   01700006
017100     05  FILLER                      PIC  X(07) VALUE  SPACES.    01710007
017200     05  FILLER                      PIC  X(05) VALUE             01720006
017300         'UNITS'.                                                 01730006
017400     05  FILLER                      PIC  X(07) VALUE  SPACES.    01740007
017500     05  FILLER                      PIC  X(04) VALUE             01750006
017600         'DATE'.                                                  01760006
017700     05  FILLER                      PIC  X(06) VALUE  SPACES.    01770006
017800     05  FILLER                      PIC  X(11) VALUE             01780006
017900         'CALCULATION'.                                           01790006
018000     05  FILLER                      PIC  X(04) VALUE  SPACES.    01800007
018100     05  FILLER                      PIC  X(06) VALUE             01810008
018200         'REASON'.                                                01820006
018300     05  FILLER                      PIC  X(34) VALUE  SPACES.    01830007
018400                                                                  01840006
018500 01  HL-HEADING-LINE-3.                                           01850006
018700     05  FILLER                      PIC  X(04) VALUE             01870007
018800         '----'.                                                  01880007
018900     05  FILLER                      PIC  X(02) VALUE  SPACES.    01890007
019000     05  FILLER                      PIC  X(05) VALUE             01900007
019100         '-----'.                                                 01910007
019200     05  FILLER                      PIC  X(01) VALUE  SPACES.    01920007
019300     05  FILLER                      PIC  X(13) VALUE             01930007
019400         '-------------'.                                         01940007
019500     05  FILLER                      PIC  X(02) VALUE  SPACES.    01950007
019600     05  FILLER                      PIC  X(03) VALUE             01960006
019700         '---'.                                                   01970006
019800     05  FILLER                      PIC  X(02) VALUE  SPACES.    01980007
019900     05  FILLER                      PIC  X(04) VALUE             01990006
020000         '----'.                                                  02000006
020010     05  FILLER                      PIC  X(01) VALUE  SPACES.    02001007
020020     05  FILLER                      PIC  X(04) VALUE             02002007
020030         '----'.                                                  02003007
020100     05  FILLER                      PIC  X(02) VALUE  SPACES.    02010007
020200     05  FILLER                      PIC  X(08) VALUE             02020006
020300         '--------'.                                              02030006
020400     05  FILLER                      PIC  X(02) VALUE  SPACES.    02040007
020500     05  FILLER                      PIC  X(09) VALUE             02050006
020600         '---------'.                                             02060006
020700     05  FILLER                      PIC  X(02) VALUE  SPACES.    02070007
020800     05  FILLER                      PIC  X(10) VALUE             02080009
020900         '----------'.                                            02090009
021000     05  FILLER                      PIC  X(02) VALUE  SPACES.    02100007
021100     05  FILLER                      PIC  X(12) VALUE             02110006
021200         '------------'.                                          02120006
021300     05  FILLER                      PIC  X(02) VALUE  SPACES.    02130007
021400     05  FILLER                      PIC  X(42) VALUE             02140006
021500         '------------------------------------------'.            02150006
021700                                                                  02170006
021800 01  DL-DETAIL-LINE-1.                                            02180006
022000     05  DL-OPER-UNT-ID              PIC  ZZZ9 VALUE ZERO.        02200007
022100     05  FILLER                      PIC  X(02) VALUE  SPACES.    02210007
022200     05  DL-STORE-NBR                PIC  ZZZ9 VALUE ZERO.        02220007
022300     05  FILLER                      PIC  X(01) VALUE  SPACES.    02230007
022400     05  DL-PO-RCVR.                                              02240006
022500         10  DL-PO                   PIC  ZZZZZZZZ9  VALUE ZERO.  02250006
022600         10  DL-DASH                 PIC  X(01) VALUE  '-'.       02260006
022700         10  DL-RCVR                 PIC  9(03) VALUE  ZEROES.    02270006
022800         10  DL-RCVR-X  REDEFINES    DL-RCVR                      02280006
022900                                     PIC  X(03).                  02290006
023000     05  FILLER                      PIC  X(03) VALUE  SPACES.    02300007
023100     05  DL-REC-TYP                  PIC  X(03) VALUE  SPACES.    02310007
023200     05  FILLER                      PIC  X(02) VALUE  SPACES.    02320007
023300     05  DL-DEPT-NBR                 PIC  ZZZ9  VALUE  ZERO.      02330007
023400     05  FILLER                      PIC  X(02) VALUE  SPACES.    02340007
023410     05  DL-SEPHORA-ORDER            PIC  X(01) VALUE  SPACES.    02341007
023420     05  FILLER                      PIC  X(04) VALUE  SPACES.    02342007
023500     05  DL-SKU-NBR                  PIC  9(08) VALUE  ZEROES.    02350006
023600     05  FILLER                      PIC  X(04) VALUE  SPACES.    02360007
023700     05  DL-STORE-EXP-UNITS          PIC  ZZZZ9-.                 02370006
023800     05  FILLER                      PIC  X(03) VALUE  SPACES.    02380007
023900     05  DL-LAST-ACT-DATE            PIC  X(10) VALUE  ZEROES.    02390006
024000     05  FILLER                      PIC  X(03) VALUE  SPACES.    02400007
024100     05  DL-EXT-RTL-AMT              PIC ZZ,ZZZ.99.               02410006
024200     05  FILLER                      PIC  X(04) VALUE  SPACES.    02420007
024300     05  DL-CLEAN-REASON             PIC  X(42) VALUE  ZEROES.    02430007
024500                                                                  02450006
024600 01  EP-EMPTY-REPORT-LINE.                                        02460006
024700     05  FILLER                       PIC X(54)  VALUE SPACES.    02470006
024800     05  FILLER                       PIC X(25)  VALUE            02480006
024900         '******* NO DATA *********'.                             02490006
025000     05  FILLER                       PIC X(53)  VALUE SPACES.    02500010
025100 01  DL-BLANK-LINE                    PIC X(132) VALUE SPACES.    02510006
025200                                                                  02520006
025300 01  END-OF-REPORT-LINE.                                          02530006
025400     05  FILLER                  PIC  X(44)    VALUE SPACES.      02540006
025500     05  FILLER                  PIC  X(45)    VALUE              02550006
025600          '*******   E N D   O F   R E P O R T   *******'.        02560006
025700     05  FILLER                  PIC  X(43)    VALUE SPACES.      02570006
025800/                                                                 02580006
025900******************************************************************02590006
026000                                                                  02600006
026100     EXEC SQL                                                     02610006
026200         INCLUDE SQLCA                                            02620006
026300     END-EXEC.                                                    02630006
026400*----------------------------------------------------------------*02640006
026500*    DB2 DCLGEN FOR TKRPRPM TABLE                                 02650006
026600*----------------------------------------------------------------*02660006
026700     EXEC SQL                                                     02670006
026800          INCLUDE TKRPRPM                                         02680006
026900     END-EXEC.                                                    02690006
027000                                                                  02700006
027100                                                                  02710006
027200     COPY SQLCA2.                                                 02720006
027300/                                                                 02730006
027400 PROCEDURE DIVISION.                                              02740006
027500                                                                  02750006
027600 0000-MAINLINE.                                                   02760006
027700                                                                  02770006
027800     PERFORM 1000-INITIALIZE                                      02780006
027900                                                                  02790006
028000     PERFORM 2000-PROCESS UNTIL PS-EOF-ERROR-FILE                 02800006
028100                                                                  02810006
028200     PERFORM 9000-EOJ.                                            02820006
028300                                                                  02830006
028400 THE-DUMPER.                                                      02840006
028500     GOBACK.                                                      02850006
028600                                                                  02860006
028700 1000-INITIALIZE.                                                 02870006
028800                                                                  02880006
028900     DISPLAY ' PCKRP024 STARTED'                                  02890006
029000     EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC           02900006
029100                                                                  02910006
029200     OPEN OUTPUT REPORT-FILE                                      02920006
029300* LOAD SYSTEM DATE INTO HEADINGS                                  02930006
029400     ACCEPT SD-SYSTEM-DATE FROM DATE.                             02940006
029500     ACCEPT ST-SYSTEM-TIME FROM TIME.                             02950006
029600                                                                  02960006
029700     MOVE SD-SYSTEM-DATE-YY      TO DP132O-RUN-YEAR.              02970006
029800     MOVE SD-SYSTEM-DATE-MM      TO DP132O-RUN-MONTH.             02980006
029900     MOVE SD-SYSTEM-DATE-DD      TO DP132O-RUN-DAY.               02990006
030000     MOVE ST-SYSTEM-HOUR         TO DP132O-RUN-HOUR.              03000006
030100     MOVE ST-SYSTEM-MINUTE       TO DP132O-RUN-MINUTE.            03010006
030200                                                                  03020006
030300     MOVE PC-CURRENT-PROGRAM-NAME                                 03030006
030400                                 TO DP132O-PROGRAM-NAME.          03040006
030500     MOVE 1                      TO DP132O-REPORT-NUMBER          03050006
030600                                    DP132O-PAGE-NUMBER            03060006
030700                                                                  03070006
030800     PERFORM 2200-GET-CLEAN4-DAYS                                 03080006
030900     PERFORM 8100-WRITE-MAIN-HEADINGS                             03090006
031000                                                                  03100006
031100     OPEN INPUT EXTRACT-FILE                                      03110006
031200     PERFORM 8000-READ-EXTRACT                                    03120006
031300     MOVE PC038-OPER-UNT-ID  TO      PV-PREV-OPER                 03130006
031400     IF PS-EOF-ERROR-FILE                                         03140006
031500         DISPLAY ' -- NO UNBALANCED STR EXP -- '                  03150006
031600         WRITE REPORT-RECORD FROM EP-EMPTY-REPORT-LINE            03160006
031700             AFTER ADVANCING 3 LINES                              03170006
031800     END-IF.                                                      03180006
031900                                                                  03190006
032000     PERFORM 2300-GET-BOSS-PARM-RCVR.                             03200006
032100/                                                                 03210006
032200 2000-PROCESS.                                                    03220006
032300                                                                  03230006
032400     PERFORM 2100-BUILD-LINE.                                     03240006
032500     IF PS-BLANK-LINE                                             03250006
032600        WRITE REPORT-RECORD FROM DL-BLANK-LINE                    03260006
032700           AFTER ADVANCING 1 LINES                                03270006
032800        ADD 1                   TO PV-LINES-USED                  03280006
032900        SET PS-BLANK-LINE-NO    TO TRUE                           03290006
033000     END-IF                                                       03300006
033100                                                                  03310006
033200     WRITE REPORT-RECORD FROM DL-DETAIL-LINE-1                    03320006
033300            AFTER ADVANCING 1 LINES                               03330006
033400     ADD 1                        TO PV-LINES-USED                03340006
033500                                                                  03350006
033600     IF PV-LINES-USED > PC-END-OF-PAGE                            03360006
033700         PERFORM 8100-WRITE-MAIN-HEADINGS                         03370006
033800     END-IF                                                       03380006
033900                                                                  03390006
034000     PERFORM 8000-READ-EXTRACT.                                   03400006
034100/                                                                 03410006
034200 2100-BUILD-LINE.                                                 03420006
034300     IF   PC038-OPER-UNT-ID    =         PV-PREV-OPER             03430006
034400         MOVE PC038-OPER-UNT-ID       TO DL-OPER-UNT-ID           03440006
034500      ELSE                                                        03450006
034600         SET PS-BLANK-LINE            TO TRUE                     03460006
034700         MOVE PC038-OPER-UNT-ID       TO DL-OPER-UNT-ID           03470006
034800         MOVE PC038-OPER-UNT-ID       TO PV-PREV-OPER             03480006
034900     END-IF.                                                      03490006
035000     MOVE PC038-LOC-NBR               TO DL-STORE-NBR.            03500006
035100     MOVE PC038-PO-NBR                TO DL-PO                    03510006
035200     MOVE '-'                         TO DL-DASH.                 03520006
035300                                                                  03530006
035400     IF PC038-RCVR-SEQ-NBR = PV-BOSS-PARM-RECV                    03540006
035500        MOVE 'BSS'                    TO DL-RCVR-X                03550006
035600        ADD 1                         TO PV-BOSS-COUNT            03560006
035700     ELSE                                                         03570006
035800        MOVE PC038-RCVR-SEQ-NBR       TO DL-RCVR                  03580006
035900     END-IF.                                                      03590006
036000                                                                  03600006
036100     MOVE PC038-REC-TYP-CDE           TO DL-REC-TYP.              03610006
036200     MOVE PC038-DEPT-NBR              TO DL-DEPT-NBR.             03620006
036210     MOVE PC038-SEPHORA-IND           TO DL-SEPHORA-ORDER.        03621012
036300     MOVE PC038-SKU-9                 TO DL-SKU-NBR.              03630006
036400     MOVE PC038-STR-EXPECTED-UNITS    TO DL-STORE-EXP-UNITS.      03640006
036500     MOVE PC038-INTRNST-TRN-DTE       TO PV-DB2-DATE.             03650006
036600     MOVE PV-DB2-YY                   TO PV-KEY-YY.               03660006
036700     MOVE PV-DB2-MM                   TO PV-KEY-MM.               03670006
036800     MOVE PV-DB2-DD                   TO PV-KEY-DD.               03680006
036900     MOVE PV-KEY-DATE                 TO DL-LAST-ACT-DATE.        03690006
037000     MOVE PC038-EXTD-RTL-AMT          TO DL-EXT-RTL-AMT.          03700006
037100     MOVE PC038-CLEAN-REASON          TO DL-CLEAN-REASON.         03710006
037200/                                                                 03720006
037300 2200-GET-CLEAN4-DAYS.                                            03730006
037400      EXEC SQL                                                    03740006
037500          SELECT FUNC_QTY                                         03750006
037600            INTO  :PV-CLEAN4-DAYS                                 03760006
037700            FROM TKRPRPM                                          03770006
037800            WHERE                                                 03780006
037900               LOC_ID                = 90                         03790006
038000               AND INTFC_SYS_CDE     = 'KHL'                      03800006
038100               AND SYS_PRC_FUNC_CDE  = 'CLEAN4'                   03810006
038200               AND FUNC_PRC_STAT_CDE = 'AC'                       03820006
038300            WITH UR                                               03830006
038400      END-EXEC.                                                   03840006
038500                                                                  03850006
038600      EVALUATE TRUE                                               03860006
038700          WHEN SQLCODE = +0                                       03870006
038800              MOVE PV-CLEAN4-DAYS TO HL1-CLEAN4-DAYS              03880006
038900          WHEN SQLCODE = +100                                     03890006
039000              CONTINUE                                            03900006
039100          WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                 03910006
039200              DISPLAY '**************************************'    03920006
039300              DISPLAY '2200-GET-CLEAN4-DAYS'                      03930006
039400              DISPLAY 'SELECT TKRPRPM                        '    03940006
039500              DISPLAY '**************************************'    03950006
039600              PERFORM 9300-SQL-WARNING                            03960006
039700                                                                  03970006
039800          WHEN SQLCODE < ZERO                                     03980006
039900              DISPLAY '**************************************'    03990006
040000              DISPLAY 'ERROR ISSUED ON                       '    04000006
040100              DISPLAY 'SELECT TKRPRPM                        '    04010006
040200              DISPLAY '**************************************'    04020006
040300              PERFORM 9200-SQL-ERROR                              04030006
040400                                                                  04040006
040500      END-EVALUATE.                                               04050006
040600/                                                                 04060006
040700******************************************************************04070006
040800*- READ TKRPRPM TO RETRIEVE THE BOSS RECEIVER PARM                04080006
040900******************************************************************04090006
041000 2300-GET-BOSS-PARM-RCVR.                                         04100006
041100                                                                  04110006
041200     EXEC SQL                                                     04120006
041300         SELECT FUNC_QTY                                          04130006
041400           INTO :PV-BOSS-PARM-RECV                                04140006
041500           FROM TKRPRPM                                           04150006
041600          WHERE LOC_ID            = 90                            04160006
041700            AND INTFC_SYS_CDE     = 'GIV'                         04170006
041800            AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                      04180006
041900            AND FUNC_PRC_STAT_CDE = 'AC'                          04190006
042000          WITH UR                                                 04200006
042100     END-EXEC.                                                    04210006
042200                                                                  04220006
042300     EVALUATE TRUE                                                04230006
042400          WHEN SQLCODE = +0                                       04240006
042500              MOVE PV-BOSS-PARM-RECV     TO PV-BOSS-PARM-DISP     04250006
042600              DISPLAY ' BOSS PARM RECEIVER  = '                   04260006
042700                                            PV-BOSS-PARM-DISP     04270006
042800                                                                  04280006
042900          WHEN SQLCODE = +100                                     04290006
043000              MOVE ZEROES                TO PV-BOSS-PARM-RECV     04300006
043100                                                                  04310006
043200          WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                 04320006
043300              DISPLAY '**************************************'    04330006
043400              DISPLAY '2300-GET-BOSS-PARM-RCVR               '    04340006
043500              DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        '    04350006
043600              DISPLAY '**************************************'    04360006
043700              PERFORM 9300-SQL-WARNING                            04370006
043800                                                                  04380006
043900          WHEN SQLCODE < ZERO                                     04390006
044000              DISPLAY '**************************************'    04400006
044100              DISPLAY '2300-GET-BOSS-PARM-RCVR               '    04410006
044200              DISPLAY 'ERROR ISSUED ON                       '    04420006
044300              DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        '    04430006
044400              DISPLAY '**************************************'    04440006
044500              PERFORM 9200-SQL-ERROR                              04450006
044600                                                                  04460006
044700      END-EVALUATE.                                               04470006
044800                                                                  04480006
044900****************************************************************  04490006
045000 8000-READ-EXTRACT.                                               04500006
045100     READ EXTRACT-FILE                                            04510006
045200         INTO PC038-SE-UNBALANCED-RPT-REC                         04520006
045300     AT END                                                       04530006
045400         SET PS-EOF-ERROR-FILE        TO TRUE                     04540006
045500     NOT AT END                                                   04550006
045600         ADD 1                        TO PV-READ-COUNT            04560006
045700     END-READ.                                                    04570006
045800                                                                  04580006
045900 8100-WRITE-MAIN-HEADINGS.                                        04590006
046000                                                                  04600006
046100     ADD 1                            TO PV-PAGE-COUNT.           04610006
046200     MOVE PV-PAGE-COUNT               TO DP132O-PAGE-NUMBER.      04620006
046300     MOVE ZERO                        TO PV-LINES-USED            04630006
046400                                                                  04640006
046500     WRITE REPORT-RECORD FROM DP132O-STANDRD-HEADER-132-COLS      04650006
046600                 AFTER ADVANCING PAGE                             04660006
046700                                                                  04670006
046800     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1                   04680006
046900        AFTER ADVANCING 2 LINES.                                  04690006
047000     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1A                  04700006
047100        AFTER ADVANCING 1 LINES.                                  04710006
047200     WRITE REPORT-RECORD FROM DL-BLANK-LINE                       04720006
047300        AFTER ADVANCING 1 LINES.                                  04730006
047400     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2A                  04740006
047500        AFTER ADVANCING 1 LINES.                                  04750006
047600     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2                   04760006
047700        AFTER ADVANCING 1 LINES.                                  04770006
047800     ADD 6                            TO PV-LINES-USED.           04780006
047900                                                                  04790006
048000     WRITE REPORT-RECORD FROM HL-HEADING-LINE-3                   04800006
048100        AFTER ADVANCING 2 LINES.                                  04810006
048200                                                                  04820006
048300     WRITE REPORT-RECORD FROM DL-BLANK-LINE                       04830006
048400        AFTER ADVANCING 1 LINES.                                  04840006
048500                                                                  04850006
048600     INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR.                   04860006
048700     ADD  3                           TO PV-LINES-USED.           04870006
048800/                                                                 04880006
048900 9000-EOJ.                                                        04890006
049000                                                                  04900006
049100     WRITE REPORT-RECORD                                          04910006
049200       FROM END-OF-REPORT-LINE                                    04920006
049300         AFTER ADVANCING 2 LINES.                                 04930006
049400                                                                  04940006
049500     CLOSE REPORT-FILE                                            04950006
049600           EXTRACT-FILE.                                          04960006
049700     MOVE PV-READ-COUNT               TO PV-DISP-COUNT            04970006
049800     DISPLAY ' RECORDS READ       = ' PV-DISP-COUNT.              04980006
049900     MOVE PV-BOSS-COUNT               TO PV-DISP-COUNT            04990006
050000     DISPLAY ' BOSS RECORDS READ  = ' PV-DISP-COUNT.              05000006
050100/                                                                 05010006
050200 9100-ABEND.                                                      05020006
050300                                                                  05030006
050400     CLOSE EXTRACT-FILE                                           05040006
050500           REPORT-FILE                                            05050006
050600                                                                  05060006
050700     MOVE +4013                       TO ABEND-CODE.              05070006
050800     CALL 'ILBOABN0' USING ABEND-CODE.                            05080006
050900                                                                  05090006
051000 9200-SQL-ERROR.                                                  05100006
051100                                                                  05110006
051200     MOVE SQLCODE                     TO SQLCODE2.                05120006
051300     MOVE SQLERRD(3)                  TO SQLERRD3.                05130006
051400                                                                  05140006
051500     DISPLAY '** ABEND **         ** = SQLERROR'.                 05150006
051600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05160006
051700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   05170006
051800     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                05180006
051900                                                                  05190006
052000     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                05200006
052100     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                05210006
052200     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 05220006
052300     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                05230006
052400                                                                  05240006
052500                                                                  05250006
052600     MOVE +4013                       TO ABEND-CODE.              05260006
052700     CALL 'ILBOABN0' USING ABEND-CODE.                            05270006
052800                                                                  05280006
052900 9300-SQL-WARNING.                                                05290006
053000                                                                  05300006
053100     DISPLAY '9300-SQL-WARNING'.                                  05310006
053200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05320006
053300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   05330006
053400     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                05340006
053500                                                                  05350006
053600     MOVE SQLCODE                     TO SQLCODE2.                05360006
053700     MOVE SQLERRD(3)                  TO SQLERRD3.                05370006
053800     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05380006
053900     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05390006
054000     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05400006
054100     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  05410006
054200     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  05420006
054300     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  05430006
054400     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  05440006
054500     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  05450006
054600     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  05460006
054700     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  05470006
054800     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  05480006
054900                                                                  05490006
055000     MOVE +4013                       TO ABEND-CODE.              05500006
055100     CALL 'ILBOABN0' USING ABEND-CODE.                            05510006
055200                                                                  05520006
