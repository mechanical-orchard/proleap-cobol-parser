000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKRF522.                                00050000
000600 AUTHOR.                 MICHAEL WALTERS.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS THE TICKET NO MATCH SCREEN WHICH WILL     00120000
001300* ALLOW THE USER TO ENTER DATA THAT IS ON THE TICKET, BUT DOESN'T 00130000
001400* MATCH THE SYSTEM DATA                                           00131000
001500******************************************************************00132000
      * RLK 12/2013 BEG                                                         
      * CHANGE IS TO HAVE THIS PROGRAM XFER TO SUKRF710 WHEN PROCESSING         
      * A QC-RFID COMBO AUDIT SO THE RFID PIECE CAN BE COMPLETED.               
      * RLK 12/2013 END                                                         
001600                                                                  00133000
001700******************************************************************00134000
001800 ENVIRONMENT DIVISION.                                            00135000
001900******************************************************************00136000
002000                                                                  00137000
002100******************************************************************00138000
002200 DATA DIVISION.                                                   00139000
002300******************************************************************00140000
002400                                                                  00150000
002500******************************************************************00160000
002600 WORKING-STORAGE SECTION.                                         00170000
002700******************************************************************00180000
002800 01 CA-COMMAREA.                                                  00190000
002900     COPY SUWS006.                                                00200000
003000* * * * * * * * * * * *  PLEASE NOTE * * * * * * * * * * * *      00210000
003100* THE COMMAREA FROM HERE....                                      00220000
003200    05 CA-SUKRF513-COMMAREA.                                      00230000
003300       10 FILLER                        PIC X(35).                00230114
003400       10 CA-SYSTEM-RETAIL-X                PIC X(08).            00240000
003500       10 CA-SYSTEM-RETAIL        REDEFINES CA-SYSTEM-RETAIL-X    00250000
003600                                            PIC ZZZZ9.99.         00260000
003700                                                                  00270000
003800       10 CA-SYSTEM-SKU-DESC                PIC X(19).            00280000
003900       10 CA-SYSTEM-COLOR                   PIC X(10).            00290000
004000       10 CA-SYSTEM-SIZE                    PIC X(10).            00300000
004010       10 CA-SYSTEM-STYLE                   PIC X(19).            00300000
004100* ... TO HERE IS COPIED FROM SUKRF513 TO SUKRF517 AND THE ALLONG  00310001
004200* TO THIS PGM ANY CHANGED TO THIS AREA IN ANY OF THE PROGRAM MUST 00320001
004300* BE COPIED TO ALL THREE                                          00330000
004400    05 CA-PROGRAM-COMMAREA.                                       00340000
004500       10 CA-SCREEN-FIELDS.                                       00350000
004600          15 CA-SCRN-RETAIL-X              PIC X(08).             00360000
004700          15 CA-SCRN-RETAIL      REDEFINES CA-SCRN-RETAIL-X       00370000
004800                                           PIC ZZZZ9.99.          00380000
004900          15 CA-SCRN-RETAIL-INT  REDEFINES CA-SCRN-RETAIL-X       00381000
005000                                           PIC 9(08).             00382000
005100                                                                  00383000
005200          15 CA-SCRN-COLOR                 PIC X(10).             00384000
005300          15 CA-SCRN-SIZE                  PIC X(10).             00385000
005400          15 CA-SCRN-SKU-X.                                       00386000
005500             20 CA-SCRN-DEPT-X             PIC X(03).             00387000
005600             20 CA-SCRN-CLASS-X            PIC X(02).             00388000
005700             20 CA-SCRN-SEQ-X              PIC X(03).             00389000
005800          15 CA-SCRN-SKU         REDEFINES CA-SCRN-SKU-X.         00390000
005900             20 CA-SCRN-DEPT               PIC 9(03).             00400000
006000             20 CA-SCRN-CLASS              PIC 9(02).             00410000
006100             20 CA-SCRN-SEQ                PIC 9(03).             00420000
006110          15 CA-SIZE-STRIP-IND             PIC X(01).                     
006120          15 CA-SCRN-STYLE                 PIC X(12).                   00
006200*                                                                 00430000
006300 01  PC-PROGRAM-CONSTANTS.                                        00440000
006400     05  PC-CARTON-AUDIT-GROUP-CODE      PIC  X(03)  VALUE 'VA'.  00450000
006500     05  PC-MDSE-ERR-RETAIL-VILN-SEQ     PIC S9(04)  VALUE 17     00480001
006600                                                     COMP.        00490000
006700     05  PC-MDSE-ERR-COLOR-VILN-SEQ      PIC S9(04)  VALUE 18     00500001
006800                                                     COMP.        00510000
006900     05  PC-MDSE-ERR-SIZE-VILN-SEQ      PIC S9(04)  VALUE 19      00520010
007000                                                     COMP.        00530000
007010     05  PC-MDSE-ERR-SIZE-STRIP-SEQ     PIC S9(04)  VALUE 23      00520010
007020                                                     COMP.        00530000
007021     05  PC-MDSE-ERR-STYLE-VILN-SEQ     PIC S9(04)  VALUE 25      00520010
007022                                                     COMP.        00530000
007030     05  PC-MDSE-ERR-NO-TAG-VILN-SEQ    PIC S9(04)  VALUE 28      00520010
007040                                                     COMP.        00530000
007100     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00540000
007200         'SUKRF522'.                                              00550000
007300     05  PC-UPC-SCAN-SCREEN              PIC  X(08)  VALUE        00560001
007400         'SUKRF518'.                                              00570001
007410     05  PC-UPC-KEY-QTY-PROGRAM          PIC  X(08)  VALUE                
007420         'SUKRF537'.                                                      
010800     05  PC-UPC-RFID-KEY-PGM-NAME        PIC  X(08)  VALUE                
010900         'SUKRF710'.                                                      
007500     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S522'.00580000
007600                                                                  00590000
007700 01  PV-PROGRAM-VARIABLES.                                        00600000
007800     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   00610000
007900                                                     COMP SYNC.   00620000
008000     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00630000
008100                                                     COMP SYNC.   00640000
008200     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00650000
008300     05  PV-DECIMAL-COUNT                PIC S9(04)  VALUE ZERO   00650109
008400                                                     COMP.        00651009
008410     05  PV-SHORT-STYLE                  PIC  X(12)  VALUE SPACE. 00650109
008420     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE                       
008430                                           'TRANS NOT AVAILABLE'.         
008500*                                                                 00660000
008600******************************************************************00670000
008700*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      00680000
008800******************************************************************00690000
008900     COPY DFHAID.                                                 00700000
009000                                                                  00710000
009100                                                                  00720000
009200******************************************************************00730000
009300*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00740000
009400******************************************************************00750000
009500     COPY DPWS013.                                                00760000
009600                                                                  00770000
009700******************************************************************00780000
009800*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00790000
009900*****************************************************************.00800000
010000     COPY DPWS010I.                                               00810000
010100                                                                  00820000
010200******************************************************************00830000
010300*  GENERATED DSECT FOR THE SUKM522 MAPSET                         00840000
010400******************************************************************00850000
010500     COPY SUKM522.                                                00860000
010600                                                                  00870000
010700******************************************************************00880000
010800*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   00890000
010900******************************************************************00900000
011000     COPY DPWS015.                                                00910000
011100                                                                  00920000
011101*----------------------------------------------------------------*        
011102* HELP SCREEN COMMAREA                                                    
011103     COPY PCWS192.                                                        
011104*----------------------------------------------------------------*        
011105* HELP SCREEN WORK AREA                                                   
011106     COPY PCWS188.                                                        
011110                                                                  00920000
011200******************************************************************00930000
011300*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      00940000
011400*  TO BE DISPLAYED ON THE LRT                                     00950000
011500******************************************************************00960000
011600     COPY SUWS005.                                                00970000
011700                                                                  00980000
011800******************************************************************00990000
011900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT AUDIT01000000
012000*  TABLE (TSUATRN)                                                01010000
012100******************************************************************01020000
012200     EXEC SQL                                                     01030000
012300         INCLUDE TSUATRN                                          01040000
012400     END-EXEC.                                                    01050000
012500                                                                  01060000
012600******************************************************************01070000
012700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01080000
012800*  CONTENT AUDIT TABLE (TSUEXCP)                                  01090000
012900******************************************************************01100000
013000     EXEC SQL                                                     01110000
013100         INCLUDE TSUEXCP                                          01120000
013200     END-EXEC.                                                    01130000
013300                                                                  01140000
013400******************************************************************01150000
013500*  COMMUNICATIONS AREA FOR DB2                                    01160000
013600******************************************************************01170000
013700     EXEC SQL                                                     01180000
013800         INCLUDE SQLCA                                            01190000
013900     END-EXEC.                                                    01200000
014000                                                                  01210000
014100                                                                  01220000
014200                                                                  01230000
014300******************************************************************01240000
014400 LINKAGE SECTION.                                                 01250000
014500******************************************************************01260000
094400 01  DFHCOMMAREA.                                                 01270000
094500     05  FILLER                         OCCURS  1 TO 4072 TIMES   01280000
094600                                        DEPENDING ON EIBCALEN.    01290000
094700         10  FILLER                     PIC X.                    01300000
094800                                                                  01310000
094900                                                                  01320000
095000******************************************************************01330000
095100 PROCEDURE DIVISION.                                              01340000
095200******************************************************************01350000
095300 0000-PROGRAM-MAINLINE.                                           01360000
095400     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           01370000
095500     MOVE LOW-VALUES   TO  SU522AI.                               01380000
095600                                                                  01390000
095700     EVALUATE TRUE                                                01400000
095710****************************************************************          
095720* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                                
095730****************************************************************          
095740         WHEN EIBTRNID = 'Z278'                                           
095750             MOVE DFHCOMMAREA          TO PC192-COMMAREA                  
095760             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA                     
095770             SET SU006-PROCESS-SCREEN  TO TRUE                            
095780             PERFORM 1000-SETUP-SCREEN                            01460000
095790             PERFORM 8000-SEND-MAP                                        
095791             PERFORM 8200-RETURN-TRANID                                   
095792                                                                          
095800         WHEN EIBCALEN = ZERO                                     01410000
095900         WHEN EIBAID = DFHCLEAR                                   01420000
096000         WHEN SU006-INITIALIZE-SCREEN                             01430000
096100             INITIALIZE CA-PROGRAM-COMMAREA                       01440000
096200             SET SU006-PROCESS-SCREEN TO TRUE                     01450000
096300             PERFORM 1000-SETUP-SCREEN                            01460000
096400                                                                  01470000
096500             PERFORM 8000-SEND-MAP                                01480000
096600             PERFORM 8200-RETURN-TRANID                           01490000
096700                                                                  01500000
096713         WHEN EIBAID = DFHENTER                                   01510000
096714             PERFORM 1200-RECEIVE-MAP                             01520000
096715             PERFORM 1300-EDIT-SELECTION                          01530000
096716                                                                  01540000
096717             MOVE SU006-SHIP-UNIT-NBR-X TO AMSGLNO                01550000
096718                                                                  01560000
096719*        THE CONTINUE KEY WAS PRESSED...GET ANY CHANGES FROM THE  01570000
096720*        SCREEN, CREATE THE APPROPRIATE EXCEPTION AND CONTINUE TO 01580000
096721*        MERCHANDISE NO MATCH SCREEN                              01590000
096722         WHEN EIBAID = DFHPF2                                     01600000
096723             PERFORM 1200-RECEIVE-MAP                             01610000
096724             PERFORM 1300-EDIT-SELECTION                          01620000
096725                                                                  01630000
096726             PERFORM 1500-CHECK-EXCEPTIONS                        01640000
096727             IF SU006-BULK-CSPK-PKGNG-CDE                               00
096728                MOVE PC-UPC-KEY-QTY-PROGRAM                             01
096729                                        TO  PV-TRANSFER-PROGRAM         01
096730             ELSE                                                         
      * RLK 12/2013 BEG                                                         
      *        IF A COMBO AUD IS BEING DONE WE WANT TO XFER TO                  
      *        SUKRF710 TO PROCESS THE RFID PORTION OF AUDIT,                   
      *        OTHERWISE XFER TO SUKRF518.                                      
                     IF SU006-QC-AND-RFID-AUD                                   
096731                MOVE PC-UPC-RFID-KEY-PGM-NAME TO                        01
096731                                       PV-TRANSFER-PROGRAM              01
                     ELSE                                                       
096731                MOVE PC-UPC-SCAN-SCREEN TO  PV-TRANSFER-PROGRAM         01
                     END-IF                                                     
      * RLK 12/2013 END                                                         
096732             END-IF                                                       
096733             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                      00
096734                                                                  01690000
096735         WHEN EIBAID = DFHPF3                                     01690203
096736             IF SU006-BULK-CSPK-PKGNG-CDE                               00
096737                MOVE PC-UPC-KEY-QTY-PROGRAM                             01
096738                                        TO  PV-TRANSFER-PROGRAM         01
096739             ELSE                                                         
      * RLK 12/2013 BEG                                                         
      *        IF A COMBO AUD IS BEING DONE WE WANT TO XFER TO                  
      *        SUKRF710 TO PROCESS THE RFID PORTION OF AUDIT,                   
      *        OTHERWISE XFER TO SUKRF518.                                      
                     IF SU006-QC-AND-RFID-AUD                                   
096731                MOVE PC-UPC-RFID-KEY-PGM-NAME TO                        01
096731                                       PV-TRANSFER-PROGRAM              01
                     ELSE                                                       
096731                MOVE PC-UPC-SCAN-SCREEN TO  PV-TRANSFER-PROGRAM         01
                     END-IF                                                     
      * RLK 12/2013 END                                                         
096741             END-IF                                                       
096742             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                      00
096743                                                                  01691003
096744         WHEN EIBAID = DFHPF9                                     01690203
096745             MOVE PC-MDSE-ERR-NO-TAG-VILN-SEQ                       03700 
096746                               TO SUEXCP-VILN-GP-SEQ-NBR            03710 
096747             PERFORM 1501-CREATE-EXCEPTION                          03720 
096748             MOVE PM-NO-TAG-LOGGED-MSG        TO AMSGLNO                  
096749                                                                  01691003
096750         WHEN EIBAID = DFHPF1                                             
096751              PERFORM 1400-HELP-SCREEN                                    
096752                                                                          
096753         WHEN OTHER                                               01700000
096760             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         01710000
096770                                                                  01720000
096780     END-EVALUATE.                                                01730000
096790                                                                  01740000
096800     PERFORM 8100-SEND-DATA-ONLY.                                 01750000
096900     PERFORM 8200-RETURN-TRANID.                                  01760000
097000                                                                  01770000
097100     GOBACK.                                                      01780000
097200****************************************************************  01790000
097300* 1000-SETUP-SCREEN                                               01800000
097400*    INITIAL SETUP OF AUDIT NUMBER AND STATUS                     01810000
097500****************************************************************  01820000
097600 1000-SETUP-SCREEN.                                               01830000
097700                                                                  01840000
097800*    MOVE SYSTEM INFORMATION TO THE SCREEN                        01850000
097810     MOVE 'N'                   TO ASZESTPO                               
097820                                   CA-SIZE-STRIP-IND.                     
097900     MOVE CA-SYSTEM-RETAIL-X    TO ARETAILO                       01860004
098000                                   CA-SCRN-RETAIL-X.              01870004
098100     MOVE CA-SYSTEM-SIZE        TO ASIZEO                         01880004
098200                                   CA-SCRN-SIZE.                  01890004
098300     MOVE CA-SYSTEM-COLOR       TO ACOLORO                        01900005
098400                                   CA-SCRN-COLOR.                 01910004
098500                                                                  01930000
098600     MOVE SU006-SHIP-UNIT-NBR-X    TO AMSGLNO.                    01940000
098610     MOVE CA-SYSTEM-STYLE       TO ASTYLEO                                
098620                                   CA-SCRN-STYLE.                         
098700                                                                  01940104
104400*                                                                 01950000
104500*                                                                 01960000
104600 1200-RECEIVE-MAP.                                                01970000
104700     EXEC CICS                                                    01980000
104800         RECEIVE                                                  01990000
104900             MAP     ('SU522A')                                   02000000
105000             MAPSET  ('SUKM522')                                  02010000
105100             RESP    (PV-CICS-RESPONSE)                           02020000
105200     END-EXEC.                                                    02030000
105300                                                                  02040000
105400     EVALUATE TRUE                                                02050000
105500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02060000
105600              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  02070000
105700         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02080000
105800              CONTINUE                                            02090000
105900         WHEN OTHER                                               02100000
106000              MOVE '1200-RECEIVE-MAP'                             02110000
106100                                     TO DP013-PARAGRAPH           02120000
106200              MOVE 'UNABLE TO RECEIVE MAP'                        02130000
106300                                     TO DP013-MESSAGE-TEXT (1)    02140000
106400              SET DP013-LOGIC-ABEND  TO TRUE                      02150000
106500              SET DP013-NO-ROLLBACK  TO TRUE                      02160000
106600              PERFORM 9999-WRITE-CICS-LOG-MSG                     02170000
106700     END-EVALUATE.                                                02180000
106800*                                                                 02190000
106900 1210-RECEIVE-SCREEN-FIELDS.                                      02200000
106908*                                                                 02420000
106909     IF  ASZESTPL > ZERO                                          02420307
106910         MOVE ASZESTPI               TO CA-SIZE-STRIP-IND         02420409
106920     ELSE IF  ASZESTPF = DP015-ERASE-EOF                          02420607
106921         MOVE SPACES                 TO CA-SIZE-STRIP-IND         02420707
106922                                        ASZESTPO                  02421007
106923     END-IF.                                                      02430007
106924*                                                                 02490000
106925     IF  ARETAILL > ZERO                                          02420307
106926         MOVE ARETAILI               TO CA-SCRN-RETAIL-X          02420409
106927     ELSE IF  ARETAILF = DP015-ERASE-EOF                          02420607
106928         MOVE SPACES                 TO CA-SCRN-RETAIL-X          02420707
106929                                        ARETAILO                  02421007
106930     END-IF.                                                      02430007
106931*                                                                 02490000
106932     IF  ASIZEL > ZERO                                            02500000
106933         MOVE ASIZEI                 TO CA-SCRN-SIZE              02510000
106934     ELSE IF  ASIZEF = DP015-ERASE-EOF                            02520000
106935         MOVE SPACES                 TO CA-SCRN-SIZE              02530000
106936                                        ASIZEO                    02540000
106937     END-IF.                                                      02550000
106938*                                                                 02560000
106939     IF  ACOLORL > ZERO                                           02570000
106940         MOVE ACOLORI                TO CA-SCRN-COLOR             02580000
106941     ELSE IF  ACOLORF = DP015-ERASE-EOF                           02590000
106942         MOVE SPACES                 TO CA-SCRN-COLOR             02600000
106943                                        ACOLORO                   02610000
106944     END-IF.                                                      02620000
106945                                                                          
106946     IF  ASTYLEL > ZERO                                           02850001
106947         MOVE ASTYLEI                TO CA-SCRN-STYLE             02860001
106948         MOVE 0                      TO ASTYLEL                   02861015
106949     ELSE IF  ASTYLEF = DP015-ERASE-EOF                           02870001
106950         MOVE SPACES                 TO CA-SCRN-STYLE             02880001
106951                                        ASTYLEO                   02890001
106952     END-IF.                                                      02900001
106953*                                                                 02630000
106954**************************************************************    02640000
106955* EDIT ALL ENTERABLE FIELDS (UPC NUMBER)                     *    02650000
106956**************************************************************    02660000
106957 1300-EDIT-SELECTION.                                             02670000
106958                                                                  02680107
106959*    DETERMINE IF THERE IS A DECIMAL POINT OR NOT, AND VALIDATE   02680209
106960*    NUMERIC ACCORDINGLY                                          02680309
106961     MOVE +0                      TO PV-DECIMAL-COUNT.            02680409
106962     INSPECT CA-SCRN-RETAIL-X TALLYING PV-DECIMAL-COUNT           02680509
106963            FOR ALL '.'.                                          02680609
106970                                                                  02680709
107700*    CHECK TO MAKE SURE THE RETAIL IS NUMERIC                     02680809
107710     INITIALIZE DP010I-NUMERIC-EDIT-AREA.                         02680909
107800     MOVE CA-SCRN-RETAIL-X        TO DP010I-UNEDITED-FIELD.       02681009
107900                                                                  02681109
108000*    IF THERE IS A DECIMAL POINT, VALIDATE FOR 2 DECIMALS         02681209
108001     IF PV-DECIMAL-COUNT > 0                                      02681309
108002         MOVE 5                   TO DP010I-MAXIMUM-DIGITS        02681409
108003         MOVE 2                   TO DP010I-MAXIMUM-DECIMALS      02681509
108004     ELSE                                                         02681609
108005         MOVE 7                   TO DP010I-MAXIMUM-DIGITS        02681709
108006         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      02681809
108007     END-IF.                                                      02681909
108008                                                                  02682009
108100     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     02682109
108200                                                                  02682209
108300     CALL DP010I-NUMERIC-EDIT-ROUTINE                             02682309
108400                     USING DP010I-NUMERIC-EDIT-AREA.              02682409
108500                                                                  02682509
108600     IF  DP010I-ERROR-DETECTED                                    02682609
108700         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       02682709
108800                                  TO AMSGLNO                      02682809
108810         MOVE -1                  TO ARETAILL                     02682909
108900         PERFORM 8100-SEND-DATA-ONLY                              02683009
109000         PERFORM 8200-RETURN-TRANID                               02683109
109100     ELSE                                                         02683209
109200         IF PV-DECIMAL-COUNT > 0                                  02683309
109300             MOVE DP010I-NUMERIC-FIELD  TO CA-SCRN-RETAIL         02683409
109400         ELSE                                                     02683509
109500*            COMPUTE DECIMAL POSITION IF IT ISN'T ALREADY THERE   02683609
109600             COMPUTE CA-SCRN-RETAIL = DP010I-NUMERIC-FIELD / 100  02683709
109700         END-IF                                                   02683809
109701         MOVE CA-SCRN-RETAIL-X          TO ARETAILO               02683909
109702     END-IF.                                                      02684009
109703                                                                  02684109
109704 1400-HELP-SCREEN.                                                        
109705     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM              
109706     MOVE 'SUKRF522'                  TO PC192-PROGRAM-NAME               
109707     COPY PCPD188.                                                        
109708     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.              
109709     PERFORM 4200-XCTL-TO-HELP.                                           
354272                                                                  02684209
354273                                                                  02685009
354274***************************************************************** 03600000
354275*   1500-CHECK-EXCEPTIONS                                       * 03610000
354276* COMPARE THE SCREEN VALUES WITH THE SYSTEM VALUES TO DETERMINE * 03620000
354277* WHICH EXCEPTIONS TO CREATE                                    * 03630000
354278***************************************************************** 03640000
354279 1500-CHECK-EXCEPTIONS.                                           03650000
354280                                                                  03660000
354290       IF CA-SYSTEM-RETAIL = CA-SCRN-RETAIL                       03670000
354300           CONTINUE                                               03680000
354400       ELSE                                                       03690000
354500           MOVE PC-MDSE-ERR-RETAIL-VILN-SEQ                       03700002
354600                             TO SUEXCP-VILN-GP-SEQ-NBR            03710000
354700           MOVE CA-SCRN-RETAIL-X                                  03710107
354800                             TO SUEXCP-OVRRID-SYS-DAT-TXT         03711007
354900           PERFORM 1501-CREATE-EXCEPTION                          03720000
355000       END-IF.                                                    03730000
355100                                                                  03740000
355200       IF CA-SYSTEM-COLOR  = CA-SCRN-COLOR                        03750000
355300           CONTINUE                                               03760000
355400       ELSE                                                       03770000
355500           MOVE PC-MDSE-ERR-COLOR-VILN-SEQ                        03780002
355600                             TO SUEXCP-VILN-GP-SEQ-NBR            03790000
355700           MOVE CA-SCRN-COLOR                                     03791007
355800                             TO SUEXCP-OVRRID-SYS-DAT-TXT         03792007
355900           PERFORM 1501-CREATE-EXCEPTION                          03800000
356000       END-IF.                                                    03810000
356100                                                                  03820000
356200       IF CA-SYSTEM-SIZE   = CA-SCRN-SIZE                         03830000
356300           CONTINUE                                               03840000
356400       ELSE                                                       03850000
356500           MOVE PC-MDSE-ERR-SIZE-VILN-SEQ                         03860010
356600                             TO SUEXCP-VILN-GP-SEQ-NBR            03870000
356700           MOVE CA-SCRN-SIZE TO SUEXCP-OVRRID-SYS-DAT-TXT         03872007
356800           PERFORM 1501-CREATE-EXCEPTION                          03880000
356900       END-IF.                                                    03890000
357000*                                                                 04000000
357001       MOVE CA-SYSTEM-STYLE TO PV-SHORT-STYLE.                            
357002                                                                  04180001
357003       IF PV-SHORT-STYLE  = CA-SCRN-STYLE                               01
357004           CONTINUE                                               04120001
357005       ELSE                                                       04130001
357006           MOVE PC-MDSE-ERR-STYLE-VILN-SEQ                              01
357007                             TO SUEXCP-VILN-GP-SEQ-NBR            04150001
357008           MOVE CA-SCRN-STYLE TO SUEXCP-OVRRID-SYS-DAT-TXT              11
357009           PERFORM 1501-CREATE-EXCEPTION                          04160001
357010       END-IF.                                                    04170002
357011                                                                  04180001
357012*                                                                 04000000
357013       IF CA-SIZE-STRIP-IND = 'Y'                                         
357020          MOVE PC-MDSE-ERR-SIZE-STRIP-SEQ                                 
357030                             TO SUEXCP-VILN-GP-SEQ-NBR                    
357040          INITIALIZE            SUEXCP-OVRRID-SYS-DAT-TXT                 
357050          PERFORM 1501-CREATE-EXCEPTION                                   
357060       END-IF.                                                            
357100                                                                  04010000
357200***************************************************************** 04020000
357300*   1501-CREATE-EXCEPTION                                       * 04030000
357400* CREATE THE APPROPRIATE EXCEPTION..........                    * 04040000
357401***************************************************************** 04050000
357402 1501-CREATE-EXCEPTION.                                           04060000
357403     MOVE PC-CARTON-AUDIT-GROUP-CODE TO SUEXCP-VILN-GP-CDE,       04070000
357404     MOVE SU006-AUDIT-CNTL-NBR       TO SUEXCP-AUD-CNTL-NBR.      04080000
357405     MOVE SU006-SHIP-UNIT-NBR        TO SUEXCP-SHIPT-UNT-ID.      04090000
357406     MOVE SU006-SCN-TMST             TO SUEXCP-SCN-TMST.          04100000
357407     MOVE SU006-UPC                  TO SUEXCP-UPC-NBR.           04110000
357408                                                                  04130000
357409     EXEC SQL                                                     04140000
357410         INSERT  INTO  TSUEXCP                                    04150000
357420                (AUD_CNTL_NBR                                     04160000
357430               , SHIPT_UNT_ID                                     04170000
357440               , UPC_NBR                                          04180000
357450               , SCN_TMST                                         04190000
357460               , VILN_GP_CDE                                      04200000
357470               , VILN_GP_SEQ_NBR                                  04210000
357480               , OVRRID_SYS_DAT_TXT)                              04220000
357490         VALUES                                                   04230000
357500             (                                                    04240000
357600                :SUEXCP-AUD-CNTL-NBR                              04250000
357700              , :SUEXCP-SHIPT-UNT-ID                              04260000
357800              , :SUEXCP-UPC-NBR                                   04270000
357900              , :SUEXCP-SCN-TMST                                  04280000
358000              , :SUEXCP-VILN-GP-CDE                               04290000
358100              , :SUEXCP-VILN-GP-SEQ-NBR                           04300000
358200              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       04310000
358300     END-EXEC                                                     04320000
358400                                                                  04330000
358500     EVALUATE TRUE                                                04340000
358600         WHEN SQLCODE = ZERO                                      04350000
358700             CONTINUE                                             04360000
358800                                                                  04370000
358900         WHEN SQLWARN0 NOT = SPACES                               04380000
359000         WHEN SQLCODE < ZERO                                      04390000
359100         WHEN SQLCODE > ZERO                                      04400000
359200             MOVE '1501-CREATE-EXCEPTION'                         04410000
359300                 TO DP013-PARAGRAPH                               04420000
359400             MOVE 'INSERT TO TSUEXCP TABLE'                       04430000
359500                 TO DP013-MESSAGE-TEXT (1)                        04440000
359600             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 04450000
359700             MOVE SQLCA                  TO DP013-SQLCA           04460000
359800             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME(1) 04470000
359900             SET DP013-DB2-ABEND         TO TRUE                  04480000
360000             SET DP013-NO-ROLLBACK       TO TRUE                  04490000
360100             PERFORM 9999-WRITE-CICS-LOG-MSG                      04500000
360200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04510000
360300             PERFORM 8100-SEND-DATA-ONLY                          04520000
360400             PERFORM 8200-RETURN-TRANID                           04530000
360500     END-EVALUATE.                                                04540000
360600                                                                  04550000
360700*    IF THE CURRENT SHIPPING UNIT AUDIT RECORD DOES NOT HAVE ANY  04560000
360800*    EXCEPTIONS CREATED YET, SET THE INDICATOR TO SAY THAT IT     04570000
360900*    DOES NOW                                                     04580000
361000     IF SU006-NO-AUD-ERR                                          04590000
361100         PERFORM 1600-UPDATE-SHIP-UNIT                            04600000
361101     END-IF.                                                      04610000
361102                                                                  04620000
361103                                                                  04630000
361104***************************************************************** 04640000
361105*   1600-UPDATE-SHIP-UNIT                                       * 04650000
361106* UPDATE THE AUDIT ERROR INDICATOR TO SAY THERE ARE EXCEPTIONS  * 04660000
361107* FOR THIS SHIPPING UNIT AUDIT                                  * 04670000
361108***************************************************************** 04680000
361109 1600-UPDATE-SHIP-UNIT.                                           04690000
361110                                                                  04700000
361120     MOVE SU006-AUDIT-CNTL-NBR TO SUATRN-AUD-CNTL-NBR.            04710000
361130     MOVE SU006-SHIP-UNIT-NBR TO SUATRN-SHIPT-UNT-ID.             04720000
361140                                                                  04730000
361150     EXEC SQL                                                     04740000
361160         UPDATE TSUATRN                                           04750000
361170            SET UNT_AUD_ERR_IND = 'Y'                             04760000
361180         WHERE   AUD_CNTL_NBR = :SUATRN-AUD-CNTL-NBR              04770000
361190           AND   SHIPT_UNT_ID = :SUATRN-SHIPT-UNT-ID              04780000
361200     END-EXEC                                                     04790000
361300                                                                  04800000
361400     EVALUATE TRUE                                                04810000
361500         WHEN SQLCODE = ZERO                                      04820000
361600             SET SU006-AUD-ERR TO TRUE                            04830000
361700                                                                  04840000
361800         WHEN SQLWARN0 NOT = SPACES                               04850000
361900         WHEN SQLCODE < ZERO                                      04860000
362000         WHEN SQLCODE > ZERO                                      04870000
362100             MOVE '1600-UPDATE-SHIP-UNIT'                         04880000
362200                 TO DP013-PARAGRAPH                               04890000
362300             MOVE 'UPDATE THE AUDIT ERROR CODE'                   04900000
362400                 TO DP013-MESSAGE-TEXT (1)                        04910000
362500             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT(2) 04920000
362600             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 04930000
362700             MOVE SQLCA                  TO DP013-SQLCA           04940000
362800             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME(1) 04950000
362900             SET DP013-DB2-ABEND         TO TRUE                  04960000
363000             SET DP013-NO-ROLLBACK       TO TRUE                  04970000
363100             PERFORM 9999-WRITE-CICS-LOG-MSG                      04980000
363200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04990000
363300             PERFORM 8100-SEND-DATA-ONLY                          05000000
363400             PERFORM 8200-RETURN-TRANID                           05010000
363401     END-EVALUATE.                                                05020000
363402                                                                  05030000
363403                                                                  05040000
363404***************************************************************** 05050000
363405*                                                               * 05060000
363406***************************************************************** 05070000
363407 2100-XCTL-TO-SELECTED-PROGRAM.                                   05080000
363408     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      05090000
363409     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        05100000
363410                                                                  05110000
363420     EXEC CICS                                                    05120000
363430         XCTL                                                     05130000
363440             PROGRAM   (PV-TRANSFER-PROGRAM)                      05140000
363450             COMMAREA  (CA-COMMAREA)                              05150000
363460             LENGTH    (PV-COMMAREA-LENGTH)                       05160000
363470             RESP      (PV-CICS-RESPONSE)                         05170000
363480     END-EXEC.                                                    05180000
363490                                                                  05190000
363500     EVALUATE TRUE                                                05200000
363600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05210000
363700              CONTINUE                                            05220000
363800         WHEN OTHER                                               05230000
363900              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                05240000
364000                                     TO DP013-PARAGRAPH           05250000
364100              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       05260000
364200                                     TO DP013-MESSAGE-TEXT (1)    05270000
364300              MOVE PV-TRANSFER-PROGRAM                            05280000
364400                                     TO DP013-MESSAGE-TEXT (2)    05290000
364500              SET DP013-CICS-ABEND   TO TRUE                      05300000
364600              SET DP013-NO-ROLLBACK  TO TRUE                      05310000
364700              PERFORM 9999-WRITE-CICS-LOG-MSG                     05320000
364800              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     05330000
364900                                     TO AMSGLNO                   05340000
365000              SET SU006-PROCESS-SCREEN TO TRUE                    05350000
365100              PERFORM 8100-SEND-DATA-ONLY                         05360000
365200              PERFORM 8200-RETURN-TRANID                          05370000
365300     END-EVALUATE.                                                05380000
365400                                                                  05390000
365500                                                                  05400000
365510 4200-XCTL-TO-HELP.                                                       
365520                                                                          
365530     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.              
365540     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                            
365550     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.            
365560                                                                          
365570     EXEC CICS                                                            
365580         XCTL                                                             
365590             PROGRAM   (PV-TRANSFER-PROGRAM)                              
365591             COMMAREA  (PC192-COMMAREA)                                   
365592             LENGTH    (PV-COMMAREA-LENGTH)                               
365593             RESP      (PV-CICS-RESPONSE)                                 
365594     END-EXEC.                                                            
365595                                                                          
365596     EVALUATE TRUE                                                        
365597         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
365598              CONTINUE                                                    
365599         WHEN OTHER                                                       
365600             MOVE '4200-XCTL-TO-HELP '                                    
365601                 TO DP013-PARAGRAPH                                       
365602             MOVE 'SUKRF522 - UNABLE TO XCTL TO PROGRAM: '                
365603                 TO DP013-MESSAGE-TEXT (1)                                
365604             MOVE PV-TRANSFER-PROGRAM                                     
365605                 TO DP013-MESSAGE-TEXT (2)                                
365606             SET DP013-CICS-ABEND  TO TRUE                                
365607             SET DP013-ROLLBACK TO TRUE                                   
365608             PERFORM 9999-WRITE-CICS-LOG-MSG                              
365609             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO                     
365610             SET SU006-PROCESS-SCREEN TO TRUE                             
365611             PERFORM 8000-SEND-MAP                                        
365612             PERFORM 8200-RETURN-TRANID                                   
365613     END-EVALUATE.                                                        
365620                                                                  05410000
365700******************************************************************05420000
365800*  8000-SEND-MAP                                                 *05430000
365900*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *05440000
366000******************************************************************05450000
366100 8000-SEND-MAP.                                                   05460000
366200     EXEC CICS                                                    05470000
366300         SEND                                                     05480000
366400             MAP     ('SU522A')                                   05490000
366500             MAPSET  ('SUKM522')                                  05500000
366600             ERASE                                                05510000
366700             RESP    (PV-CICS-RESPONSE)                           05520000
366800     END-EXEC.                                                    05530000
366900                                                                  05540000
367000     EVALUATE TRUE                                                05550000
367100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05560000
367200             CONTINUE                                             05570000
367300         WHEN OTHER                                               05580000
367400             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            05590000
367500             MOVE 'UNABLE TO SEND MAP'                            05600000
367600                                    TO DP013-MESSAGE-TEXT (1)     05610000
367700             SET DP013-CICS-ABEND   TO TRUE                       05620000
367800             SET DP013-NO-ROLLBACK  TO TRUE                       05630000
367900             PERFORM 9999-WRITE-CICS-LOG-MSG                      05640000
368000     END-EVALUATE.                                                05650000
368100*                                                                 05660000
368200 8100-SEND-DATA-ONLY.                                             05670000
368300                                                                  05680000
368400     EXEC CICS                                                    05690000
368500         SEND                                                     05700000
368600             MAP       ('SU522A')                                 05710000
368700             MAPSET    ('SUKM522')                                05720000
368800             CURSOR                                               05730000
368900             DATAONLY                                             05740000
369000             RESP      (PV-CICS-RESPONSE)                         05750000
369100     END-EXEC.                                                    05760000
369200                                                                  05770000
369300     EVALUATE TRUE                                                05780000
369400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05790000
369500             CONTINUE                                             05800000
369600         WHEN OTHER                                               05810000
369700             MOVE '8100-SEND-DATA-ONLY'                           05820000
369800                                    TO DP013-PARAGRAPH            05830000
369900             MOVE 'UNABLE TO SEND DATA'                           05840000
370000                                    TO DP013-MESSAGE-TEXT (1)     05850000
370100             SET DP013-CICS-ABEND   TO TRUE                       05860000
370200             SET DP013-NO-ROLLBACK  TO TRUE                       05870000
370300             PERFORM 9999-WRITE-CICS-LOG-MSG                      05880000
370400     END-EVALUATE.                                                05890000
370500*                                                                 05900000
370600 8200-RETURN-TRANID.                                              05910000
370700     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          05920000
370800                                                                  05930000
370900     EXEC CICS                                                    05940000
371000         RETURN                                                   05950000
371100             TRANSID   (PC-CURRENT-TRANID)                        05960000
371200             COMMAREA  (CA-COMMAREA)                              05970000
371300             LENGTH    (PV-COMMAREA-LENGTH)                       05980000
371400             RESP      (PV-CICS-RESPONSE)                         05990000
371500     END-EXEC.                                                    06000000
371600                                                                  06010000
371700     EVALUATE TRUE                                                06020000
371800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06030000
371900             CONTINUE                                             06040000
372000         WHEN OTHER                                               06050000
372100             MOVE '8200-RETURN-TRANID'                            06060000
372200                                    TO DP013-PARAGRAPH            06070000
372300             MOVE 'UNABLE TO RETURN TO TRANID'                    06080000
372400                                    TO DP013-MESSAGE-TEXT (1)     06090000
372500             SET DP013-CICS-ABEND   TO TRUE                       06100000
372600             SET DP013-NO-ROLLBACK  TO TRUE                       06110000
372700             PERFORM 9999-WRITE-CICS-LOG-MSG                      06120000
372800     END-EVALUATE.                                                06130000
372900*                                                                 06140000
373000*                                                                 06150000
373100 9999-WRITE-CICS-LOG-MSG.                                         06160000
373200     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            06170000
373300     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           06180000
373400     INITIALIZE DP013-SRC-TASK-NUMBER                             06190000
373500                DP013-STACK.                                      06200000
373600     SET DP013-LINK-RETURN           TO TRUE.                     06210000
373700                                                                  06220000
373800     EXEC CICS                                                    06230000
373900         LINK                                                     06240000
374000             PROGRAM   (DP013-NAME)                               06250000
374100             COMMAREA  (DP013-PARAMETERS)                         06260000
374200             LENGTH    (DP013-LENGTH)                             06270000
374201     END-EXEC.                                                    06280000
374202                                                                  06290000
374203*----------------------------------------------------------------*06300000
374204*    ABEND PROCESSOR MODULE                                      *06310000
374205*----------------------------------------------------------------*06320000
374206                                                                  06330000
374207     COPY DPPD014.                                                06340000
374208                                                                  06350000
