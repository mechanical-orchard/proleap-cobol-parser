000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
00004  PROGRAM-ID.    RDKCS037.                                            CL**1
000500 AUTHOR.        GREGORY SHEFF.                                    00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  06-11-03.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001100*                                                                *00110000
001200*  THIS PROGRAM IS USED TO DISPLAY INFO FOR A MAIL CHECK REQUEST.*00120000
001100*  CRITERIA PASSED WILL BE CUSTOMER ID AND MAIL CHECK REFUND ID. *00110000
001100*                                                                *00110000
001100*  USING THE CUSTOMER ID PASSED, READ RDT_CUST AND FILL IN THE    00110000
001100*  CUSTOMER INFORMATION.  THEN, USING THE CUSTOMER ID AND MAIL    00110000
001100*  CHECK REFUND ID, READ THE RDT_MAL_CK_RFND TABLE AND FILL IN THE00110000
001100*  REQUEST INFORMATION.  USING THE STORE NUMBER, READ XST_LOC TO  00110000
001100*  GET THE STORE NAME FOR THE SCREEN.                             00110000
001100*                                                                 00110000
001100*  READ THE RDT_CMNT TABLE TO SEE IF THERE ARE COMMENTS FOR THIS  00110000
001100*  CUSTOMER.  IF THERE ARE, DISPLAY A MESSAGE AT THE BOTTOM OF THE00110000
001100*  SCREEN TO TELL THE USER THAT COMMENTS ARE AVAILABLE.           00110000
001100*                                                                *00110000
001100*  WHEN THE USER HITS PF15 (UPDATE) PASS THE CUSTOMER ID AND      00110000
001100*  MAIL CHECK REFUND ID TO RDURFND.  WHEN THE USER HITS PF17      00110000
001100*  PASS THE CUSTOMER ID TO RDLCMMT.                               00110000
001100*                                                                *00110000
001600*----------------------------------------------------------------*00160000
RECOMP*  05/20/2022 - JIM HUNTER   CHG0                                *00110000
RECOMP*               ADDED DCLGEN FOR SYSDUMMY TO GET CLEAN COMPILE   *00110000
RECOMP*               FOR UPCOMING COBOL 6 CONVERSION.                 *00110000
RECOMP*----------------------------------------------------------------*00160000
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  ******************************************************************        
002000 ENVIRONMENT DIVISION.                                            00200000
002400 DATA DIVISION.                                                   00240000
002700 WORKING-STORAGE SECTION.                                         00270000
003400*                                                                 00340000
       01  IV-INDICATOR-VARIABLES.                                              
           15  IV-PHN-NBR                     PIC S9(04)  COMP                  
                                                          VALUE 0.              
           15  IV-STAT-CHNG-DTE               PIC S9(04)  COMP                  
                                                          VALUE 0.              
           15  IV-RFND-CK-DTE                 PIC S9(04)  COMP                  
                                                          VALUE 0.              
           15  IV-RFND-CK-NBR                 PIC S9(04)  COMP                  
                                                          VALUE 0.              
           15  IV-ADJ-RFND-AMT                PIC S9(04)  COMP                  
                                                          VALUE 0.              
           15  IV-CORP-EJRNL-CKD-CDE          PIC S9(04)  COMP                  
                                                          VALUE 0.              
           15  IV-CK-SYS-CKD-CDE              PIC S9(04)  COMP                  
                                                          VALUE 0.              
           15  IV-GR-CKD-CDE                  PIC S9(04)  COMP                  
                                                          VALUE 0.              
           15  IV-KMRC-CRD-NBR                PIC S9(04)  COMP                  
                                                          VALUE 0.              
003500 01  PC-PROGRAM-CONSTANTS.                                        00350000
003600     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'RDKCS037'.  00360000
003700     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'RD037A  '.  00370000
003800     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'RDKM037 '.  00380000
003900     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00390000
004000                                              COMP.               00400000
004100     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00410000
004200                                              COMP.               00420000
004500     05  PC-INTER-APPL-CODES.                                     00450000
004600         10  PC-INTER-APPL-CRIT-SPEC                              00460000
004700                                  PIC  X(01)  VALUE ' '.          00470000
073700     05  PC-COMMENTS-AVAIL        PIC  X(22)  VALUE               07370000
004700                                  'COMMENTS ARE AVAILABLE'.       00470000
005000                                                                  00500000
005100     05  PC-TSYMSG-NUMBERS.                                       00510000
005700         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00570000
006100*                                                                 00610000
006200 01  PS-PROGRAM-SWITCHES.                                         00620000
006300     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00630000
006400         88  PS-ERROR                         VALUE  'Y'.         00640000
006500         88  PS-NO-ERROR                      VALUE  'N'.         00650000
006600*                                                                 00660000
006700 01  PV-PROGRAM-VARIABLES.                                        00670000
007000     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00700000
007100                                              COMP SYNC.          00710000
007000     05  PV-ONE                   PIC S9(04)  VALUE +0            00700000
007100                                              COMP SYNC.          00710000
007400                                                                  00740000
007500     EJECT                                                        00750000
007600**--------------------------------------------------------------**00760000
007700** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **00770000
007800** SELECTED ITEM TO BE PROCESSED BY THIS PROGRAM.                 00780000
007900**--------------------------------------------------------------**00790000
008000     COPY RDWS035.                                                00800000
008100 EJECT                                                            00810000
008200                                                                  00820000
008300*----------------------------------------------------------------*00830000
008400*    MAP LAYOUT                                                  *00840000
008500*----------------------------------------------------------------*00850000
008700     COPY RDKM037.                                                00870000
008800                                                                  00880000
      *----------------------------------------------------------------*        
      *    ATTRIBUTE SETTINGS COPYBOOK.                                *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS015.                                                        
                                                                                
      *--------------------------------------------------------------           
009500                                                                  00950000
009600*----------------------------------------------------------------*00960000
009700*    FUNCTION KEYS COPYBOOK                                      *00970000
009800*----------------------------------------------------------------*00980000
009900                                                                  00990000
010000     COPY DPWS016.                                                01000000
010100                                                                  01010000
010200 EJECT                                                            01020000
010900**--------------------------------------------------------------**01090000
011000** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*01100000
011100** APPLICATION PROGRAMMING INTERFACE MODULE.                    **01110000
011200**--------------------------------------------------------------**01120000
011300     COPY DPWS030.                                                01130000
CICS       COPY DPWS930.                                                01130000
011400 EJECT                                                            01140000
011500**--------------------------------------------------------------**01150000
011600*    STANDARD COMMAREA.                                           01160000
011700**--------------------------------------------------------------**01170000
011800                                                                  01180000
011900     COPY DPWS020.                                                01190000
012000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01200000
012100                                                                  01210000
012200***************************************************************** 01220000
012300*    INTER-APPLICATION COMMAREA.                                  01230000
012400***************************************************************** 01240000
012500                                                                  01250000
012600         10  INTER-APPL-COMM-AREA PIC X(200).                     01260000
012800     COPY RDWS034.                                                01280000
012900***************************************************************** 01290000
013000*    SPECIFIC COMMMAREA FOR RDKCS037.                             01300000
013100***************************************************************** 01310000
013200         10  ASC-SPECIFIC-COMMAREA.                               01320000
013300             15  ASC-INT-APPL-FORMAT-IND     PIC  X(01).          01330000
00123              15  ASC-LIST-KEYS.                                      CL**1
00124                  20  ASC-KEY-CUST-ID         PIC S9(10)  COMP-3.     CL**1
00124                  20  ASC-KEY-TERMINAL        PIC S9(04)  COMP.       CL**1
00124                  20  ASC-KEY-TRANSACTION     PIC S9(04)  COMP.       CL**1
00124                  20  ASC-KEY-SEQ-NBR         PIC S9(04)  COMP.       CL**1
00123              15  ASC-NON-KEYS.                                       CL**1
00134                  20  ASC-DRIVERS-LIC         PIC X(25).              CL*18
00134                  20  ASC-LAST-NAME           PIC X(30).              CL*18
00134                  20  ASC-FIRST-NAME          PIC X(30).              CL*18
00134                  20  ASC-ADDRESS1            PIC X(40).              CL*18
00134                  20  ASC-ADDRESS2            PIC X(40).              CL*18
00134                  20  ASC-CITY                PIC X(20).              CL*18
00134                  20  ASC-STATE               PIC X(02).              CL*18
00134                  20  ASC-ZIP                 PIC X(11).              CL*18
00134                  20  ASC-PHONE               PIC X(26).              CL*18
00134                  20  ASC-STORE-NBR           PIC S9(04)              CL*18
00134                                                         COMP.        CL*18
00134                  20  ASC-STORE-NAME          PIC X(30).              CL*18
00134                  20  ASC-RECEIPT-DTE         PIC X(10).              CL*18
00134                  20  ASC-TERMINAL            PIC S9(04)              CL*18
00134                                                         COMP.        CL*18
00134                  20  ASC-TRANSACTION         PIC S9(04)              CL*18
00134                                                         COMP.        CL*18
00134                  20  ASC-SEQ-NBR             PIC S9(04)              CL*18
00134                                                         COMP.        CL*18
00134                  20  ASC-RFND-AMT-ORIG       PIC S9(05)V99           CL*18
00134                                                         COMP-3.      CL*18
00134                  20  ASC-RFND-AMT-ADJ        PIC S9(05)V99           CL*18
00134                                                         COMP-3.      CL*18
00134                  20  ASC-CORP-EJ             PIC X(02).              CL*18
00134                  20  ASC-CK-SYS-CK           PIC X(02).              CL*18
00134                  20  ASC-GIFT-CK             PIC X(02).              CL*18
00134                  20  ASC-STATUS-CDE          PIC X(01).              CL*18
00134                  20  ASC-STATUS-DESC         PIC X(10).              CL*18
00134                  20  ASC-STATUS-DATE         PIC X(10).              CL*18
00134                  20  ASC-CHECK-DATE          PIC X(10).              CL*18
00134                  20  ASC-CHECK-NBR           PIC S9(07)V             CL*18
00134                                                         COMP-3.      CL*18
00134                  20  ASC-KMRC-NBR            PIC S9(12)V             CL*18
00134                                                         COMP-3.      CL*18
013800             15  ASC-USE-SELECTION-QUEUE-IND                      01380000
013900                                           PIC  X(01).            01390000
014000                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 01400000
014100             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            01410000
014200             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    01420000
014300             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01430000
014400                                           PIC S9(09)  COMP-3.    01440000
014500             15  ASC-SEL-SUB               PIC S9(04)  COMP.      01450000
014600             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      01460000
014700         10  FILLER                        PIC  X(2503).          01470000
014800     EJECT                                                        01480000
014900*----------------------------------------------------------------*01490000
015000*    ABEND PROCESSING COPYBOOK.                                  *01500000
015100*----------------------------------------------------------------*01510000
015200                                                                  01520000
015300     COPY DPWS013.                                                01530000
015400                                                                  01540000
015500 EJECT                                                            01550000
015600                                                                  01560000
      *-----------------------------------------------------------------        
      *    DB2 AREA FOR CUSTOMERS (RDT_CUST)                                    
      *-----------------------------------------------------------------        
      *                                                                         
           EXEC SQL                                                             
                INCLUDE RDT00000                                                
           END-EXEC.                                                            
00255                                                                      CL**1
      *-----------------------------------------------------------------        
      *    DB2 AREA FOR MAILED REFUND CHECKS (RDT_MAL_CK_RFND)                  
      *-----------------------------------------------------------------        
           EXEC SQL                                                             
                INCLUDE RDT00001                                                
           END-EXEC.                                                            
017000                                                                  01700000
      *-----------------------------------------------------------------        
      *    DB2 AREA FOR COMMENT TABLE (RDT_CMNT)                                
      *-----------------------------------------------------------------        
           EXEC SQL                                                             
                INCLUDE RDT00003                                                
           END-EXEC.                                                            
017000                                                                  01700000
      *-----------------------------------------------------------------        
      *    DB2 AREA FOR LOCATION TABLE (XST_LOC)                                
      *-----------------------------------------------------------------        
           EXEC SQL                                                             
                INCLUDE XST00001                                                
           END-EXEC.                                                            
017000                                                                  01700000
RECOMP*---------------------------------------------------------------*         
RECOMP*    DB2 AREA FOR SYSDUMMY1                                     *         
RECOMP*---------------------------------------------------------------*         
RECOMP     EXEC SQL                                                             
RECOMP          INCLUDE SYSDUMMY                                                
RECOMP     END-EXEC.                                                            
RECOMP                                                                          
00256 *---------------------------------------------------------------*    CL**1
016900*    DB2 AREA FOR COMMUNICATIONS                                  01690000
00256 *---------------------------------------------------------------*    CL**1
017100     EXEC SQL                                                     01710000
017200          INCLUDE SQLCA                                           01720000
017300     END-EXEC.                                                    01730000
                                                                                
      *---------------------------------------------------------------*         
017600 LINKAGE SECTION.                                                 01760000
017700                                                                  01770000
017800 01  DFHCOMMAREA.                                                 01780000
017900     05  FILLER                         OCCURS  1 TO 4072 TIMES   01790000
018000                                        DEPENDING ON EIBCALEN.    01800000
018100         10  FILLER                     PIC X.                    01810000
017500                                                                  01750000
      *---------------------------------------------------------------*         
018400 PROCEDURE DIVISION.                                              01840000
018500***************************************************************** 01850000
018600** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01860000
018700** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01870000
018800** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01880000
018900**                                                             ** 01890000
019000** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01900000
019100** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01910000
019200***************************************************************** 01920000
019300 0000-MAIN-MODULE.                                                01930000
019400     INITIALIZE DP030-CICS-API-FIELDS.                            01940000
019500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01950000
019600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01960000
019700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01970000
019800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01980000
019900     MOVE LENGTH OF RD037AI        TO DP030-MAP-LENGTH (1).       01990000
020000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02000000
020100     PERFORM 0001-CALL-CICS-ARCH-API.                             02010000
020200*                                                                 02020000
020300     PERFORM 1000-CONTROL-PROCESSING                              02030000
020400*                                                                 02040000
020500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02050000
020600     PERFORM 0001-CALL-CICS-ARCH-API.                             02060000
020700                                                                  02070000
020800 0001-CALL-CICS-ARCH-API.                                         02080000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
021000                                    DFHCOMMAREA                           
021100                                    DP030-CICS-API-FIELDS                 
021200                                    DP020-STANDARD-COMMAREA               
021300                                    RD037AI.                              
021400*                                                                 02140000
021500     IF  DP030-RC-CALL-SUCCESSFUL                                 02150000
021600         CONTINUE                                                 02160000
021700     ELSE                                                         02170000
021800         SET DP013-NO-ROLLBACK                                    02180000
021900             DP013-XCTL-DISPLAY-RESTART                           02190000
022000             DP013-CICS-ABEND      TO TRUE                        02200000
022100         MOVE '0000-MAIN-MODULE'                                  02210000
022200                                   TO DP013-PARAGRAPH             02220000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
022500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02250000
022600         PERFORM DP013-0000-PROCESS-ABEND                         02260000
022700     END-IF.                                                      02270000
022800 EJECT                                                            02280000
022900*----------------------------------------------------------------*02290000
023000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02300000
023100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02310000
023200*----------------------------------------------------------------*02320000
023300                                                                  02330000
023400 1000-CONTROL-PROCESSING.                                         02340000
023500                                                                  02350000
023600     EVALUATE TRUE                                                02360000
023700         WHEN DP020-NEXT-ACT-INITIAL                              02370000
023800              PERFORM 1100-FIND-OBJECT-KEYS                       02380000
                    PERFORM 4000-BUILD-INITIAL-PANEL                            
                    IF  SQLCODE = +100                                          
                        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                   
023200*                 -- DATA DOES NOT EXIST --                      *02320000
                        MOVE PC-TSYMSG-00148                                    
                                         TO DP020-MSG-NUMBER                    
                        SET DP020-MSG-INFORMATIONAL TO TRUE                     
                    END-IF                                                      
                                                                                
025100         WHEN DP020-NEXT-ACT-READ-MAP                             02510000
025200             PERFORM 2000-PROCESS-PANEL                           02520000
025300                                                                  02530000
025400         WHEN DP020-NEXT-ACT-RETURN                               02540000
                   PERFORM 7500-REINIT-ASC-FLDS                                 
024200             PERFORM 4000-BUILD-INITIAL-PANEL                     02420000
025700                                                                  02570000
025800         WHEN OTHER                                               02580000
025900             SET DP013-LOGIC-ABEND TO TRUE                        02590000
026000             SET DP013-NO-ROLLBACK TO TRUE                        02600000
026100             MOVE '1000-CONTROL-PROCESSING'                       02610000
026200                                   TO DP013-PARAGRAPH             02620000
026300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02630000
026400                                   TO DP013-MESSAGE-TEXT(1)       02640000
026500             MOVE DP020-NEXT-APPL-ACTIVITY                        02650000
026600                                   TO DP013-MESSAGE-TEXT(2)       02660000
026700             PERFORM DP013-0000-PROCESS-ABEND                     02670000
026800     END-EVALUATE.                                                02680000
026900******************************************************************02690000
027000** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **02700000
027100** INTER-APPLICATION FORMAT CODE.                               **02710000
027200******************************************************************02720000
027300 1100-FIND-OBJECT-KEYS.                                           02730000
027400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            02740000
027500     MOVE DP020-INT-APPL-FORMAT-IND                               02750000
027600                                   TO ASC-INT-APPL-FORMAT-IND.    02760000
00402      EVALUATE DP020-INT-APPL-FORMAT-IND                              CL**4
027800         WHEN PC-INTER-APPL-CRIT-SPEC                             02780000
00405                  MOVE RD034-CUST-ID                                  CL**4
00406                                TO ASC-KEY-CUST-ID                    CL**1
00405                  MOVE RD034-TERMINAL                                 CL**4
00406                                TO ASC-KEY-TERMINAL                   CL**1
00405                  MOVE RD034-TRANSACTION                              CL**4
00406                                TO ASC-KEY-TRANSACTION                CL**1
00405                  MOVE RD034-SEQ-NBR                                  CL**4
00406                                TO ASC-KEY-SEQ-NBR                    CL**1
00421          WHEN OTHER                                                  CL**4
00422              IF  DP020-NAV-KEY-DATA > SPACE                          CL**4
00423                  PERFORM 1110-EDIT-NAV-KEY                           CL**4
00424              ELSE                                                    CL**4
00425                  MOVE PC-TSYMSG-00148                                CL**4
00426                                TO DP020-MSG-NUMBER                   CL**4
00427                  SET DP020-MSG-FATAL TO TRUE                         CL**4
00428                  SET DP020-NEXT-ACT-APPL-ERROR TO TRUE               CL**4
00429              END-IF                                                  CL**4
00430      END-EVALUATE.                                                   CL**4
00402                                                                      CL**4
031100******************************************************************03110000
031200** EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE   **03120000
031300** COMMAND LINE.                                                  03130000
031500******************************************************************03150000
031600 1110-EDIT-NAV-KEY.                                               03160000
00440      MOVE DP020-NAV-KEY-DATA TO                                      CL**4
00406                                   ASC-KEY-CUST-ID                    CL**1
00406                                   ASC-KEY-TERMINAL                   CL**1
00406                                   ASC-KEY-TRANSACTION                CL**1
00406                                   ASC-KEY-SEQ-NBR.                   CL**1
00407                                                                      CL**1
034500*----------------------------------------------------------------*03450000
034600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *03460000
034700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *03470000
034800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *03480000
034900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *03490000
035000* FUNCTION KEYS CAN GET THIS FAR.                                *03500000
035100*----------------------------------------------------------------*03510000
035300 2000-PROCESS-PANEL.                                              03530000
035400                                                                  03540000
035500     EVALUATE TRUE                                                03550000
035600                                                                  03560000
035700         WHEN DP020-SRC-AID = DP016-CLEAR                         03570000
035800             PERFORM 4400-MOVE-CUST-COMM-TO-SCREEN                03580000
036000                                                                  03600000
036100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03610000
036200             SET DP030-DONT-ERASE                                 03620000
036300                 DP030-SEND-DATAONLY (PC-APPL-MAP)                03630000
036400                                   TO TRUE                        03640000
00405                  MOVE RD034-CUST-ID                                  CL**4
00406                                TO ASC-KEY-CUST-ID                    CL**1
00405                  MOVE RD034-TERMINAL                                 CL**4
00406                                TO ASC-KEY-TERMINAL                   CL**1
00405                  MOVE RD034-TRANSACTION                              CL**4
00406                                TO ASC-KEY-TRANSACTION                CL**1
00405                  MOVE RD034-SEQ-NBR                                  CL**4
00406                                TO ASC-KEY-SEQ-NBR                    CL**1
036500             PERFORM 4000-BUILD-INITIAL-PANEL                     03650000
036700                                                                  03670000
039400         WHEN OTHER                                               03940000
036200             SET DP030-DONT-ERASE                                 03620000
036300                 DP030-SEND-DATAONLY (PC-APPL-MAP)                03630000
036400                                   TO TRUE                        03640000
036500             PERFORM 4000-BUILD-INITIAL-PANEL                     03650000
039800             SET DP030-CONTINUE-GO                                03980000
039900                               TO TRUE                            03990000
040000             PERFORM 2100-CHECK-FUNCTION-KEY                      04000000
040500     END-EVALUATE.                                                04050000
040600*----------------------------------------------------------------*04060000
040700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04070000
040800* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04080000
040900* FROM THE CICS ARCHITECTURE API.                                *04090000
041000*----------------------------------------------------------------*04100000
041100                                                                  04110000
041200 2100-CHECK-FUNCTION-KEY.                                         04120000
041300     EVALUATE TRUE                                                04130000
041400         WHEN DP020-SRC-AID = DP016-ENTER                         04140000
041500             CONTINUE                                             04150000
041600                                                                  04160000
042000*            -- F15 UPDATE --                                     04200000
041700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04170000
042000*            -- F17 COMMENTS --                                   04200000
041700         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              04170000
041800             SET DP030-CONTINUE-GO TO TRUE                        04180000
042200             SET DP020-MSG-INFORMATIONAL                          04220000
042300                                   TO TRUE                        04230000
042400                                                                  04240000
042500         WHEN OTHER                                               04250000
042600             SET DP013-NO-ROLLBACK                                04260000
042700                 DP013-XCTL-DISPLAY-RESTART                       04270000
042800                 DP013-CICS-ABEND  TO TRUE                        04280000
042900             MOVE '2100-CHECK-FUNCTION-KEY'                       04290000
043000                                   TO DP013-PARAGRAPH             04300000
043100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04310000
043200                                   TO DP013-MESSAGE-TEXT (1)      04320000
043300             PERFORM DP013-0000-PROCESS-ABEND                     04330000
043400     END-EVALUATE.                                                04340000
043500                                                                  04350000
065800*----------------------------------------------------------------*06580000
065900*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY THE ENTRY.        *06590000
066100*----------------------------------------------------------------*06610000
066000                                                                  06620000
066300 4000-BUILD-INITIAL-PANEL.                                        06630000
066400     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        06640000
066500     MOVE -1                       TO ALASTNML.                   06650000
00407                                                                      CL**1
051800     PERFORM 4330-FETCH-RDT-CMMT.                                 05180000
067000     IF  SQLCODE = ZERO                                           06700000
073700         MOVE PC-COMMENTS-AVAIL       TO ACOMNTSO                 07370000
073700         MOVE DP015-YELLOW            TO ACOMNTSC                 07370000
067200     ELSE                                                         06720000
073700         MOVE SPACES                  TO ACOMNTSO                 07370000
067200     END-IF.                                                      06720000
059800*                                                                 05980000
051800     PERFORM 4320-SELECT-RDT-MAL-CK-RFND.                         05180000
                                                                                
           MOVE RDT00000-LAST-NM         TO ASC-LAST-NAME.                      
           MOVE RDT00000-FRST-NM         TO ASC-FIRST-NAME.                     
           MOVE RDT00000-M2A-LNE-1-ADDR  TO ASC-ADDRESS1.                       
           MOVE RDT00000-M2A-LNE-2-ADDR  TO ASC-ADDRESS2.                       
           MOVE RDT00000-M2A-CTY-NM      TO ASC-CITY.                           
           MOVE RDT00000-M2A-ST-CDE      TO ASC-STATE.                          
           MOVE RDT00000-M2A-PSTL-CDE    TO ASC-ZIP.                            
           MOVE RDT00000-DRV-LIC-NBR     TO ASC-DRIVERS-LIC.                    
                                                                                
           IF IV-PHN-NBR = 0                                                    
              MOVE RDT00000-PHN-NBR      TO ASC-PHONE                           
           ELSE                                                                 
              MOVE SPACES                TO ASC-PHONE                           
           END-IF.                                                              
                                                                                
           MOVE RDT00001-STR-NBR            TO ASC-STORE-NBR.                   
           MOVE ASC-STORE-NBR               TO XST00001-LOC-NBR.                
           PERFORM 4340-SELECT-XST-LOC.                                         
067300                                                                  06730000
           MOVE RDT00001-RFND-REQ-DTE       TO ASC-RECEIPT-DTE.                 
           MOVE RDT00001-STR-RGST-ID        TO ASC-TERMINAL.                    
           MOVE RDT00001-RGST-TRN-NBR       TO ASC-TRANSACTION.                 
           MOVE RDT00001-RFND-SEQ-NBR       TO ASC-SEQ-NBR.                     
           MOVE RDT00001-RFND-AMT           TO ASC-RFND-AMT-ORIG.               
                                                                                
           IF IV-ADJ-RFND-AMT = 0                                               
              MOVE RDT00001-ADJ-RFND-AMT    TO ASC-RFND-AMT-ADJ                 
           ELSE                                                                 
              MOVE ZEROES                   TO ASC-RFND-AMT-ADJ                 
           END-IF.                                                              
                                                                                
           IF IV-CORP-EJRNL-CKD-CDE = 0                                         
              MOVE RDT00001-CORP-EJRNL-CKD-CDE TO ASC-CORP-EJ                   
           ELSE                                                                 
              MOVE SPACES                      TO ASC-CORP-EJ                   
           END-IF.                                                              
                                                                                
           IF IV-CK-SYS-CKD-CDE = 0                                             
              MOVE RDT00001-CK-SYS-CKD-CDE  TO ASC-CK-SYS-CK                    
           ELSE                                                                 
              MOVE SPACES                   TO ASC-CK-SYS-CK                    
           END-IF.                                                              
                                                                                
           IF IV-GR-CKD-CDE = 0                                                 
              MOVE RDT00001-GR-CKD-CDE      TO ASC-GIFT-CK                      
           ELSE                                                                 
              MOVE SPACES                   TO ASC-GIFT-CK                      
           END-IF.                                                              
                                                                                
           MOVE RDT00001-RFND-STAT-CDE      TO ASC-STATUS-CDE.                  
                                                                                
           IF IV-STAT-CHNG-DTE = 0                                              
              MOVE RDT00001-STAT-CHNG-DTE   TO ASC-STATUS-DATE                  
           ELSE                                                                 
              MOVE SPACES                   TO ASC-STATUS-DATE                  
           END-IF.                                                              
                                                                                
           IF IV-RFND-CK-DTE = 0                                                
              MOVE RDT00001-RFND-CK-DTE     TO ASC-CHECK-DATE                   
           ELSE                                                                 
              MOVE SPACES                   TO ASC-CHECK-DATE                   
           END-IF.                                                              
                                                                                
                                                                                
           IF IV-RFND-CK-NBR = 0                                                
              MOVE RDT00001-RFND-CK-NBR     TO ASC-CHECK-NBR                    
           ELSE                                                                 
              MOVE ZEROES                   TO ASC-CHECK-NBR                    
           END-IF.                                                              
                                                                                
           IF IV-KMRC-CRD-NBR = 0                                               
              MOVE RDT00001-KMRC-CRD-NBR    TO ASC-KMRC-NBR                     
           ELSE                                                                 
              MOVE ZEROES                   TO ASC-KMRC-NBR                     
           END-IF.                                                              
067300                                                                  06730000
067000     IF  SQLCODE = ZERO                                           06700000
067100         PERFORM 4400-MOVE-CUST-COMM-TO-SCREEN                    06710000
067200     END-IF.                                                      06720000
059800*                                                                 05980000
058600*----------------------------------------------------------------*05860000
058700* SELECT A ROW FROM THE DB2 RDT-MAL-CK-RFND TABLE                *05870000
058700* AND A ROW FROM THE DB2 RDT-CUST TABLE.                         *05870000
058900*----------------------------------------------------------------*05890000
059900 4320-SELECT-RDT-MAL-CK-RFND.                                     05990000
060000     PERFORM                                                      06000000
060100         WITH TEST AFTER                                          06010000
060200         VARYING PV-RETRY-COUNTER                                 06020000
060300         FROM 1 BY 1                                              06030000
060400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06040000
060500                   OR (SQLCODE = ZERO)                            06050000
060600                   OR (SQLCODE = +100))                           06060000
060700*                                                                 06070000
060800         EXEC SQL                                                 06080000
060900             SELECT                                               06090000
                         C.LAST_NM                                              
                       , C.FRST_NM                                              
                       , C.M2A_LNE_1_ADDR                                       
                       , C.M2A_LNE_2_ADDR                                       
                       , C.M2A_CTY_NM                                           
                       , C.M2A_ST_CDE                                           
                       , C.M2A_PSTL_CDE                                         
                       , C.DRV_LIC_NBR                                          
                       , C.PHN_NBR                                              
                       , M.STR_NBR                                              
                       , M.RFND_REQ_DTE                                         
                       , M.STR_RGST_ID                                          
                       , M.RGST_TRN_NBR                                         
                       , M.RFND_SEQ_NBR                                         
                       , M.RFND_AMT                                             
                       , M.ADJ_RFND_AMT                                         
                       , M.CORP_EJRNL_CKD_CDE                                   
                       , M.CK_SYS_CKD_CDE                                       
                       , M.GR_CKD_CDE                                           
                       , M.RFND_STAT_CDE                                        
                       , M.STAT_CHNG_DTE                                        
                       , M.RFND_CK_DTE                                          
                       , M.RFND_CK_NBR                                          
                       , M.KMRC_CRD_NBR                                         
061100             INTO                                                 06110000
                      :RDT00000-LAST-NM                                         
                    , :RDT00000-FRST-NM                                         
                    , :RDT00000-M2A-LNE-1-ADDR                                  
                    , :RDT00000-M2A-LNE-2-ADDR                                  
                    , :RDT00000-M2A-CTY-NM                                      
                    , :RDT00000-M2A-ST-CDE                                      
                    , :RDT00000-M2A-PSTL-CDE                                    
                    , :RDT00000-DRV-LIC-NBR                                     
                    , :RDT00000-PHN-NBR:IV-PHN-NBR                              
                    , :RDT00001-STR-NBR                                         
                    , :RDT00001-RFND-REQ-DTE                                    
                    , :RDT00001-STR-RGST-ID                                     
                    , :RDT00001-RGST-TRN-NBR                                    
                    , :RDT00001-RFND-SEQ-NBR                                    
                    , :RDT00001-RFND-AMT                                        
                    , :RDT00001-ADJ-RFND-AMT:IV-ADJ-RFND-AMT                    
                    , :RDT00001-CORP-EJRNL-CKD-CDE:IV-CORP-EJRNL-CKD-CDE        
                    , :RDT00001-CK-SYS-CKD-CDE:IV-CK-SYS-CKD-CDE                
                    , :RDT00001-GR-CKD-CDE:IV-GR-CKD-CDE                        
                    , :RDT00001-RFND-STAT-CDE                                   
                    , :RDT00001-STAT-CHNG-DTE:IV-STAT-CHNG-DTE                  
                    , :RDT00001-RFND-CK-DTE:IV-RFND-CK-DTE                      
                    , :RDT00001-RFND-CK-NBR:IV-RFND-CK-NBR                      
                    , :RDT00001-KMRC-CRD-NBR:IV-KMRC-CRD-NBR                    
                   FROM                                                         
                          RDT_CUST        C                                     
                       ,  RDT_MAL_CK_RFND M                                     
                   WHERE                                                        
                         M.STR_RGST_ID  = :ASC-KEY-TERMINAL                     
                     AND M.RGST_TRN_NBR = :ASC-KEY-TRANSACTION                  
                     AND M.RFND_SEQ_NBR = :ASC-KEY-SEQ-NBR                      
                     AND C.CUST_ID      = :ASC-KEY-CUST-ID                      
                     AND C.CUST_ID      =   M.CUST_ID                           
061700         END-EXEC                                                 06170000
061800                                                                  06180000
061900         EVALUATE TRUE                                            06190000
062000             WHEN SQLCODE = ZERO                                  06200000
062100             WHEN SQLCODE = +100                                  06210000
062200             WHEN SQLCODE = -904                                  06220000
062300             WHEN SQLCODE = -913                                  06230000
062400                 CONTINUE                                         06240000
062500             WHEN SQLWARN0 NOT = SPACES                           06250000
062600             WHEN SQLCODE < ZERO                                  06260000
062700             WHEN SQLCODE > ZERO                                  06270000
062800                 MOVE '4320-SELECT-RDT-MAL-CK-RFND'               06280000
062900                                   TO DP013-PARAGRAPH             06290000
063000                 MOVE 'SELECT CHECK REFUND INFO'                  06300000
063100                                   TO DP013-MESSAGE-TEXT (1)      06310000
063200                 MOVE ASC-KEY-CUST-ID                             06320000
063300                                   TO DP013-MESSAGE-TEXT (2)      06330000
063400                 MOVE SQLCA        TO DP013-SQLCA                 06340000
063500                 MOVE 'RDT_CUST'   TO DP013-DB2-TABLE-NAME (1)    06350000
063500                 MOVE 'RDT_MAL_CK_RFND'                           06350000
063500                                   TO DP013-DB2-TABLE-NAME (2)    06350000
063600                 SET DP013-DB2-ABEND                              06360000
063700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06370000
063800                 PERFORM DP013-0000-PROCESS-ABEND                 06380000
063900         END-EVALUATE                                             06390000
064000     END-PERFORM.                                                 06400000
064100*                                                                 06410000
064200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06420000
064300         MOVE '4320-SELECT-RDT-MAL-CK-RFND'                       06430000
064400                                   TO DP013-PARAGRAPH             06440000
064500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06450000
064600                                   TO DP013-MESSAGE-TEXT (1)      06460000
064700         MOVE 'CUSTOMER ID: '                                     06470000
064800                                   TO DP013-MESSAGE-TEXT (2)      06480000
064900         MOVE ASC-KEY-CUST-ID      TO DP013-MESSAGE-TEXT (3)      06490000
065000         MOVE SQLCA                TO DP013-SQLCA                 06500000
065100         MOVE 'RDT_CUST'           TO DP013-DB2-TABLE-NAME (1)    06510000
063500         MOVE 'RDT_MAL_CK_RFND'    TO DP013-DB2-TABLE-NAME (2)    06350000
065200         SET DP013-DB2-ABEND                                      06520000
065300             DP013-XCTL-DISPLAY-RESTART                           06530000
065400                                   TO TRUE                        06540000
065500         PERFORM DP013-0000-PROCESS-ABEND                         06550000
065600     END-IF.                                                      06560000
065700 EJECT                                                            06570000
067300                                                                  06730000
058600*----------------------------------------------------------------*05860000
058700* CHECK IF COMMENTS EXIST (SVT_CRD_ACCT_CMMT TABLE)              *05870000
058900*----------------------------------------------------------------*05890000
059900 4330-FETCH-RDT-CMMT.                                             05990000
060000     PERFORM                                                      06000000
060100         WITH TEST AFTER                                          06010000
060200         VARYING PV-RETRY-COUNTER                                 06020000
060300         FROM 1 BY 1                                              06030000
060400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06040000
060500                   OR (SQLCODE = ZERO)                            06050000
060600                   OR (SQLCODE = +100))                           06060000
060700*                                                                 06070000
060800         EXEC SQL                                                 06080000
01753             SELECT 1                                              DPKCS036
01753               INTO :PV-ONE                                        DPKCS036
01753                FROM SYSIBM.SYSDUMMY1 X                            DPKCS036
01753             WHERE EXISTS (SELECT 1                                DPKCS036
                                  FROM    RDT_CMNT C                            
060800                            WHERE   CUST_ID   = :ASC-KEY-CUST-ID  06080000
060800                              AND   X.IBMREQD >'')                06080000
060800         END-EXEC                                                 06080000
061800                                                                  06180000
061900         EVALUATE TRUE                                            06190000
062000             WHEN SQLCODE = ZERO                                  06200000
062100             WHEN SQLCODE = +100                                  06210000
062200             WHEN SQLCODE = -904                                  06220000
062300             WHEN SQLCODE = -913                                  06230000
062400                 CONTINUE                                         06240000
062500             WHEN SQLWARN0 NOT = SPACES                           06250000
062600             WHEN SQLCODE < ZERO                                  06260000
062700             WHEN SQLCODE > ZERO                                  06270000
062800                 MOVE '4330-FETCH-RDT-CMMT'                       06280000
062900                                   TO DP013-PARAGRAPH             06290000
063000                 MOVE 'SELECT COMMENTS'                           06300000
063100                                   TO DP013-MESSAGE-TEXT (1)      06310000
063200                 MOVE ASC-KEY-CUST-ID                             06320000
063300                                   TO DP013-MESSAGE-TEXT (2)      06330000
063400                 MOVE SQLCA        TO DP013-SQLCA                 06340000
063500                 MOVE 'RDT_CMNT'   TO DP013-DB2-TABLE-NAME (1)    06350000
063600                 SET DP013-DB2-ABEND                              06360000
063700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06370000
063800                 PERFORM DP013-0000-PROCESS-ABEND                 06380000
063900         END-EVALUATE                                             06390000
064000     END-PERFORM.                                                 06400000
064100*                                                                 06410000
064200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06420000
064300         MOVE '4330-FETCH-RDT-CMMT'                               06430000
064400                                   TO DP013-PARAGRAPH             06440000
064500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06450000
064600                                   TO DP013-MESSAGE-TEXT (1)      06460000
064700         MOVE 'CUSTOMER ID: '                                     06470000
064800                                   TO DP013-MESSAGE-TEXT (2)      06480000
064900         MOVE ASC-KEY-CUST-ID      TO DP013-MESSAGE-TEXT (3)      06490000
065000         MOVE SQLCA                TO DP013-SQLCA                 06500000
065100         MOVE 'RDT_CMNT'           TO DP013-DB2-TABLE-NAME (1)    06510000
065200         SET DP013-DB2-ABEND                                      06520000
065300             DP013-XCTL-DISPLAY-RESTART                           06530000
065400                                   TO TRUE                        06540000
065500         PERFORM DP013-0000-PROCESS-ABEND                         06550000
065600     END-IF.                                                      06560000
065700 EJECT                                                            06570000
058600*----------------------------------------------------------------*05860000
058700* SELECT A ROW FROM THE DB2 XST-LOC TABLE.                       *05870000
058900*----------------------------------------------------------------*05890000
059900 4340-SELECT-XST-LOC.                                             05990000
060000     PERFORM                                                      06000000
060100         WITH TEST AFTER                                          06010000
060200         VARYING PV-RETRY-COUNTER                                 06020000
060300         FROM 1 BY 1                                              06030000
060400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06040000
060500                   OR (SQLCODE = ZERO)                            06050000
060600                   OR (SQLCODE = +100))                           06060000
060700*                                                                 06070000
060800         EXEC SQL                                                 06080000
060900             SELECT                                               06090000
                           LOC_NM                                               
061100             INTO                                                 06110000
                          :XST00001-LOC-NM                                      
061300             FROM    XST_LOC                                      06130000
061500             WHERE   LOC_NBR  = :XST00001-LOC-NBR                 06150000
061700         END-EXEC                                                 06170000
061800                                                                  06180000
061900         EVALUATE TRUE                                            06190000
062000             WHEN SQLCODE = ZERO                                  06200000
                       MOVE XST00001-LOC-NM TO ASC-STORE-NAME                   
062100             WHEN SQLCODE = +100                                  06210000
062200             WHEN SQLCODE = -904                                  06220000
062300             WHEN SQLCODE = -913                                  06230000
062400                 CONTINUE                                         06240000
062500             WHEN SQLWARN0 NOT = SPACES                           06250000
062600             WHEN SQLCODE < ZERO                                  06260000
062700             WHEN SQLCODE > ZERO                                  06270000
062800                 MOVE '4340-SELECT-XST-LOC'                       06280000
062900                                   TO DP013-PARAGRAPH             06290000
063000                 MOVE 'SELECT STORE DESC      '                   06300000
063100                                   TO DP013-MESSAGE-TEXT (1)      06310000
063200                 MOVE XST00001-LOC-NBR                            06320000
063300                                   TO DP013-MESSAGE-TEXT (2)      06330000
063400                 MOVE SQLCA        TO DP013-SQLCA                 06340000
063500                 MOVE 'RDT_CUST'   TO DP013-DB2-TABLE-NAME (1)    06350000
063600                 SET DP013-DB2-ABEND                              06360000
063700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06370000
063800                 PERFORM DP013-0000-PROCESS-ABEND                 06380000
063900         END-EVALUATE                                             06390000
064000     END-PERFORM.                                                 06400000
064100*                                                                 06410000
064200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06420000
064300         MOVE '4340-SELECT-XST-LOC'                               06430000
064400                                   TO DP013-PARAGRAPH             06440000
064500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06450000
064600                                   TO DP013-MESSAGE-TEXT (1)      06460000
064700         MOVE 'CUSTOMER ID: '                                     06470000
064800                                   TO DP013-MESSAGE-TEXT (2)      06480000
064900         MOVE ASC-KEY-CUST-ID      TO DP013-MESSAGE-TEXT (3)      06490000
065000         MOVE SQLCA                TO DP013-SQLCA                 06500000
065100         MOVE 'RDT_CUST'           TO DP013-DB2-TABLE-NAME (1)    06510000
065200         SET DP013-DB2-ABEND                                      06520000
065300             DP013-XCTL-DISPLAY-RESTART                           06530000
065400                                   TO TRUE                        06540000
065500         PERFORM DP013-0000-PROCESS-ABEND                         06550000
065600     END-IF.                                                      06560000
065700 EJECT                                                            06570000
073200*----------------------------------------------------------------*07320000
073300*    RESTORE THE CUSTOMER DATA ON THE SCREEN FROM THE COMM AREA.  07330000
073400*----------------------------------------------------------------*07340000
073500                                                                  07350000
073600 4400-MOVE-CUST-COMM-TO-SCREEN.                                   07360000
073700     MOVE ASC-LAST-NAME            TO ALASTNMO.                   07370000
073700     MOVE ASC-FIRST-NAME           TO AFRSTNMO.                   07370000
073700     MOVE ASC-DRIVERS-LIC          TO ADRVLICO.                   07370000
073700     MOVE ASC-ADDRESS1             TO AADDLN1O.                   07370000
073700     MOVE ASC-ADDRESS2             TO AADDLN2O.                   07370000
073700     MOVE ASC-CITY                 TO ACITYNMO.                   07370000
073700     MOVE ASC-STATE                TO ASTCODEO.                   07370000
073700     MOVE ASC-ZIP                  TO APSTLCDO.                   07370000
073700     MOVE ASC-PHONE                TO APHNNBRO.                   07370000
074100                                                                  07410000
073700     MOVE ASC-STORE-NBR            TO ALOCNBRO.                   07370000
073700     MOVE ASC-STORE-NAME           TO ALOCNAMO.                   07370000
073700     MOVE ASC-RECEIPT-DTE          TO AREQDTEO.                   07370000
073700     MOVE ASC-TERMINAL             TO ASTRRGTO.                   07370000
073700     MOVE ASC-TRANSACTION          TO ATRANNOO.                   07370000
073700     MOVE ASC-SEQ-NBR              TO ASEQNBRO.                   07370000
073700     MOVE ASC-RFND-AMT-ORIG        TO ARFDAMTO.                   07370000
073700     MOVE ASC-RFND-AMT-ADJ         TO AADJAMTO.                   07370000
073700     MOVE ASC-CORP-EJ              TO ACORPEJO.                   07370000
073700     MOVE ASC-CK-SYS-CK            TO ACHKSYSO.                   07370000
073700     MOVE ASC-GIFT-CK              TO AGIFTCKO.                   07370000
073700     MOVE ASC-STATUS-CDE           TO ASTATCDO.                   07370000
      *                                                                         
           EVALUATE ASC-STATUS-CDE                                              
                   WHEN 'A' MOVE 'APPROVED  ' TO ASC-STATUS-DESC                
                   WHEN 'D' MOVE 'DENIED    ' TO ASC-STATUS-DESC                
                   WHEN 'M' MOVE 'KMRC      ' TO ASC-STATUS-DESC                
                   WHEN 'P' MOVE 'PENDING   ' TO ASC-STATUS-DESC                
                   WHEN 'V' MOVE 'VOID      ' TO ASC-STATUS-DESC                
                   WHEN 'S' MOVE 'STORE HNDL' TO ASC-STATUS-DESC                
                   WHEN 'C' MOVE 'CASH PAID ' TO ASC-STATUS-DESC                
                   WHEN 'K' MOVE 'KOHLS CHRG' TO ASC-STATUS-DESC                
                   WHEN 'B' MOVE 'BANKCARD  ' TO ASC-STATUS-DESC                
                   WHEN 'E' MOVE 'MDSE XCHNG' TO ASC-STATUS-DESC                
                   WHEN 'O' MOVE 'ORIG MDSE ' TO ASC-STATUS-DESC                
                   WHEN OTHER                                                   
                            MOVE 'UNKNOWN   ' TO ASC-STATUS-DESC                
           END-EVALUATE                                                         
      *                                                                         
073700     MOVE ASC-STATUS-DESC          TO ACDEDESO.                   07370000
073700     MOVE ASC-STATUS-DATE          TO ACNGDTEO.                   07370000
073700     MOVE ASC-CHECK-DATE           TO ACKDATEO.                   07370000
073700     MOVE ASC-CHECK-NBR            TO ACHKNBRO.                   07370000
073700     MOVE ASC-KMRC-NBR             TO AKMRCNOO.                   07370000
                                                                                
074000                                                                  07400000
074100 EJECT                                                            07410000
086000*----------------------------------------------------------------*08600000
      *----------------------------------------------------------------*        
      *    RE-INITIALIZE ASC- FIELDS AFTER F3 RETURN                   *        
      *----------------------------------------------------------------*        
       7500-REINIT-ASC-FLDS.                                                    
                                                                                
           MOVE RD034-CUST-ID     TO ASC-KEY-CUST-ID.                           
           MOVE RD034-TERMINAL    TO ASC-KEY-TERMINAL.                          
           MOVE RD034-TRANSACTION TO ASC-KEY-TRANSACTION.                       
           MOVE RD034-SEQ-NBR     TO ASC-KEY-SEQ-NBR.                           
                                                                                
086000*----------------------------------------------------------------*08600000
086100*    ABEND PROCESSOR MODULE                                      *08610000
086200*----------------------------------------------------------------*08620000
086300                                                                  08630000
086400     COPY DPPD013.                                                08640000
