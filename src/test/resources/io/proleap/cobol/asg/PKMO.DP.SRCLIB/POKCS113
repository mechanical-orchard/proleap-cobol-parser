000100 IDENTIFICATION DIVISION.                                         00010046
000200 PROGRAM-ID.    POKCS113.                                         00020046
000300 AUTHOR.        SAUD AHMED.                                       00030046
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040046
000500 DATE-WRITTEN.  05/00.                                            00050046
000600 DATE-COMPILED.                                                   00060046
000700*-----------------------------------------------------------      00070046
000800*    W113 - QUOTA CATEGORY LIST PROGRAM                           00080046
000900*-----------------------------------------------------------      00090046
001000*                                                                 00100046
001100*    THIS PROGRAM DISPLAYS ALL QUOTA CATEGORY CODE BELONGING      00110046
001200*    CERTAIN COUNTRY. THIS COUNTRY IS COUNTRY OF PRODUCTION       00120046
001300*    KEYED IN IMPORT ORDER SCREEN.                                00130046
CICS  *---------------------------------------------------------------* 00140050
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00141051
CICS  *                                                               * 00142050
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00143050
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00144050
CICS  *---------------------------------------------------------------* 00145050
001400*                                                                 00146050
001500/                                                                 00150046
001600 ENVIRONMENT DIVISION.                                            00160046
001700                                                                  00170046
001800 DATA DIVISION.                                                   00180046
001900                                                                  00190046
002000 WORKING-STORAGE SECTION.                                         00200046
002100                                                                  00210046
002200 01  DK-DB2-KEYS.                                                 00220046
002300     05  DK-CNTRY-CDE              PIC X(03) VALUE SPACES.        00230046
002400                                                                  00240046
002500 01  PC-PROGRAM-CONSTANTS.                                        00250046
002600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00260046
002700                                                    'PO113A  '.   00270046
002800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00280046
002900                                                    'POKM113 '.   00290046
003000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00300046
003100                                                    'POKCS113'.   00310046
003200     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00320046
003300                                                    COMP.         00330046
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340046
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350046
003600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00360046
003700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00370046
003800                                                    COMP SYNC.    00380046
003900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00390046
004000                                                    COMP SYNC.    00400046
004100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00410046
004200                                                    +1000000      00420046
004300                                                    COMP-3.       00430046
004400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00440046
004500                                                    COMP SYNC.    00450046
004600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00460046
004700                                                    COMP-3.       00470046
004800     05  PC-MAX-RETRIES-2               PIC S9(03)  VALUE +2      00480046
004900                                                    COMP-3.       00490046
005000     05  PC-TSYMSG-NUMBERS.                                       00500046
005100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00510046
005200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00520046
005300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00530046
005400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00540046
005500         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00550046
005600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00560046
005700         10  PC-TSYMSG-00461            PIC  9(05)  VALUE 00461.  00570046
005700         10  PC-TSYMSG-01880            PIC  9(05)  VALUE 01880.  00571046
005700         10  PC-TSYMSG-02493            PIC  9(05)  VALUE 02493.  00572046
005800                                                                  00573046
005900 01  PS-PROGRAM-SWITCHES.                                         00574046
006000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00575046
006100         88  PS-NO-ERROR                            VALUE 'Y'.    00576046
006200         88  PS-ERROR                               VALUE 'N'.    00577046
006300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00578046
006400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00579046
006500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00580046
006600     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00590046
006700         88  PS-DONE                                VALUE 'Y'.    00600046
006800         88  PS-NOT-DONE                            VALUE 'N'.    00610046
006900                                                                  00620046
007000 01  PV-PROGRAM-VARIABLES.                                        00630046
007100     05  PV-SUB                         PIC S9(04)  VALUE +0      00640046
007200                                                    COMP SYNC.    00650046
007300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00660046
007400                                                    COMP SYNC.    00670046
007500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00680046
007600                                                    COMP-3.       00690046
007700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00700046
007800                                                    COMP-3.       00710046
007900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00720046
008000                                                    COMP-3.       00730046
008100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00740046
008200                                                    COMP-3.       00750046
008300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00760046
008400                                                    COMP SYNC.    00770046
008500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00780046
008600                                                    COMP SYNC.    00790046
008700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      00800046
008800                                                    COMP SYNC.    00810046
008900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      00820046
009000                                                    COMP SYNC.    00830046
009100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00840046
009200                                                    COMP SYNC.    00850046
           05  PV-QTA-CTG-CDE                 PIC X(05)   VALUE SPACES. 00851046
009300*---------------------------------------------------------------* 00852046
009400*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 00853046
009500*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 00854046
009600*   APPLICATION-SPECIFIC COMMAREA.                              * 00855046
009700*---------------------------------------------------------------* 00856046
009800 01  LQW-LIST-QUEUE-WORK-AREA.                                    00857046
009900     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           00858046
010000                                        INDEXED BY LQW-IDX.       00859046
010100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       00860046
010300         10  LQW-QTA-CTG-CDE            PIC  X(05).               00870046
010400         10  LQW-QTA-CTG-DESC           PIC  X(40).               00880046
010500/                                                                 00890046
010600*---------------------------------------------------------------* 00900046
010700*    MAP LAYOUT                                                 * 00910046
010800*---------------------------------------------------------------* 00920046
010900     COPY POKM113.                                                00930046
011000 01  MR-OCCURS-LAYOUT                   REDEFINES  PO113AO.       00940046
011100     05  FILLER                         PIC X(012).               00950048
011300     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          00970046
011900                                                                  00980046
012000         10  MR-QTA-CTG-CDEL                PIC S9(04) COMP.      00990046
012100         10  MR-QTA-CTG-CDEA                PIC X(01).            01000046
012200         10  MR-QTA-CTG-CDEC                PIC X(01).            01010046
012300         10  MR-QTA-CTG-CDEH                PIC X(01).            01020046
012400         10  MR-QTA-CTG-CDE                 PIC X(05).            01030046
012500                                                                  01040046
012600         10  MR-QTA-CTG-DESCL               PIC S9(04) COMP.      01050046
012700         10  MR-QTA-CTG-DESCA               PIC X(01).            01060046
012800         10  MR-QTA-CTG-DESCC               PIC X(01).            01070046
012900         10  MR-QTA-CTG-DESCH               PIC X(01).            01080046
013000         10  MR-QTA-CTG-DESC                PIC X(40).            01090046
013100                                                                  01100046
013200/                                                                 01110046
013300*---------------------------------------------------------------* 01120046
013400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01130046
013500*---------------------------------------------------------------* 01140046
013600     COPY DPWS015.                                                01150046
013700*---------------------------------------------------------------* 01160046
013800*    FUNCTION KEYS COPYBOOK.                                    * 01170046
013900*---------------------------------------------------------------* 01180046
014000     COPY DPWS016.                                                01190046
014100*---------------------------------------------------------------* 01200046
014200*    NUMERIC EDIT LAYOUT.                                       * 01210046
014300*---------------------------------------------------------------* 01220046
014400     COPY DPWS010I.                                               01230046
014500/                                                                 01240046
014600*---------------------------------------------------------------* 01250046
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01260050
014800*---------------------------------------------------------------* 01270046
014900     COPY DPWS030.                                                01280046
CICS       COPY DPWS930.                                                01281050
015000/                                                                 01290046
015100*---------------------------------------------------------------* 01300046
015200*    STANDARD COMMAREA.                                         * 01310046
015300*---------------------------------------------------------------* 01320046
015400     COPY DPWS020.                                                01330046
015500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01340046
015600*---------------------------------------------------------------* 01350046
015700* INTER-APPLICATION COMMAREA.                                   * 01360046
015800*---------------------------------------------------------------* 01370046
015900         10  INTER-APPL-COMM-AREA       PIC X(200).               01380046
016000     COPY POWS011.                                                01390046
                   15  PO-PROD-CNTRY-CDE      PIC X(03).                01400046
016100*---------------------------------------------------------------* 01410046
016200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 01420046
016300*---------------------------------------------------------------* 01430046
016400         10  ASC-SPECIFIC-COMMAREA.                               01440046
016800             15  ASC-CNTRY-CDE             PIC X(03).             01450046
                   15  ASC-CNTRY-NAME            PIC X(40).             01460046
016600             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           01470046
016700                 20  ASC-ITEM-ARRAY.                              01480046
016800                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        01490046
016900                         30  ASC-LIST-ITEM-NUMBER                 01500046
017000                                        PIC S9(09) COMP-3.        01510046
017200                         30  ASC-QTA-CTG-CDE    PIC X(05).        01520046
017300                         30  ASC-QTA-CTG-DESC   PIC X(40).        01530046
017400                                                                  01540046
017500                                                                  01550046
017600             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     01560046
017700             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     01570046
017800             15  ASC-NUMBER-OF-ITEMS-READ                         01580046
017900                                        PIC S9(09) COMP-3.        01590046
018000             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        01600046
018100             15  ASC-ITEM-AT-TOP-OF-PANEL                         01610046
018200                                        PIC S9(09) COMP-3.        01620046
018300             15  ASC-ITEM-AT-BOT-OF-PANEL                         01630046
018400                                        PIC S9(09) COMP-3.        01640046
018500             15  ASC-HIGHEST-BLOCK-WRITTEN                        01650046
018600                                        PIC S9(04) COMP SYNC.     01660046
018700             15  ASC-ITEMS-LEFT-INDICATOR                         01670046
018800                                        PIC X(01).                01680046
018900                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     01690046
019000                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     01700046
019100             15  ASC-LIST-QUEUE-NAME.                             01710046
019200                20  ASC-LIST-TERM-ID   PIC X(04).                 01720046
019300                20  ASC-LIST-TASK-NUMBER                          01730046
019400                                       PIC S9(05) COMP-3.         01740046
019500                20  ASC-LIST-SEQ       PIC 9(01).                 01750046
019600             15  ASC-CURSOR-SW          PIC X(01).                01760046
019700                 88  ASC-ITEM-CURSOR               VALUE 'I'.     01770046
019800                 88  ASC-APP-ITEM-CURSOR           VALUE 'A'.     01780046
019900             15  ASC-START-ITEM-REQUEST.                          01790046
020000                 20  ASC-START-ITEM-REQUEST-N                     01800046
020100                                        PIC 9(07).                01810046
020200/                                                                 01820046
020300*---------------------------------------------------------------* 01830046
020400*    ABEND PROCESSING COPYBOOK.                                 * 01840046
020500*---------------------------------------------------------------* 01850046
020600     COPY DPWS013.                                                01860046
020700/                                                                 01870046
022000*---------------------------------------------------------------* 01880046
022100*    DB2 AREA FOR COMMUNICATIONS                                * 01890046
022200*---------------------------------------------------------------* 01900046
022300     EXEC SQL                                                     01910046
022400          INCLUDE SQLCA                                           01920046
022500     END-EXEC.                                                    01930046
020800*---------------------------------------------------------------* 01940046
020900*    DB2 AREA FOR THE COUNTRY CODE TABLE                        * 01950046
021000*---------------------------------------------------------------* 01960046
021100     EXEC SQL                                                     01970046
021200          INCLUDE TCNTRY                                          01980046
021300     END-EXEC.                                                    01990046
021400/                                                                 02000046
020800*---------------------------------------------------------------* 02010046
020900*    DB2 AREA FOR THE QUOTA CATEGORY TABLE                      * 02020046
021000*---------------------------------------------------------------* 02030046
021100     EXEC SQL                                                     02040046
021200          INCLUDE TQTACTG                                         02050046
021300     END-EXEC.                                                    02060046
021400/                                                                 02070046
021500*---------------------------------------------------------------* 02071046
021600*  CURSOR TO SELECT LINE ITEMS WHEN PO IS NOT APPROVED          * 02072046
021700*---------------------------------------------------------------* 02073046
021800     EXEC SQL                                                     02074046
021900          DECLARE QTACTG-CSR CURSOR FOR                           02075046
022000          SELECT DISTINCT(QTA_CTG_CDE)                            02076046
022300            FROM TQTACTG                                          02077046
022400          WHERE STAT_CDE = 'A'                                    02078046
022600          ORDER BY                                                02079046
022700                QTA_CTG_CDE                                       02080046
                FOR FETCH ONLY                                          02090046
022800     END-EXEC.                                                    02100046
022900/                                                                 02110046
021500*---------------------------------------------------------------* 02120046
021600*  CURSOR TO SELECT LINE ITEMS WHEN PO IS NOT APPROVED          * 02130046
021700*---------------------------------------------------------------* 02140046
021800     EXEC SQL                                                     02150046
021900          DECLARE QTADSC-CSR CURSOR FOR                           02160046
022000          SELECT CNTRY_CDE                                        02170046
022000                ,QTA_CTG_DESC                                     02180046
022300            FROM TQTACTG                                          02190046
022400          WHERE QTA_CTG_CDE    = :PV-QTA-CTG-CDE                  02200046
022500            AND STAT_CDE = 'A'                                    02210046
                FOR FETCH ONLY                                          02211046
022800     END-EXEC.                                                    02212046
022900/                                                                 02213046
023000 LINKAGE SECTION.                                                 02214046
023100 01  DFHCOMMAREA.                                                 02215046
023200     05  FILLER                         OCCURS  1 TO 4072 TIMES   02216046
023300                                        DEPENDING ON EIBCALEN.    02217046
023400         10  FILLER                     PIC X.                    02218046
023500/                                                                 02219046
023600 PROCEDURE DIVISION.                                              02220046
023700*---------------------------------------------------------------* 02230046
023800*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 02240046
023900*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 02250046
024000*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 02260046
024100*---------------------------------------------------------------* 02270046
024200 0000-MAIN-MODULE.                                                02280046
024300     INITIALIZE DP030-CICS-API-FIELDS.                            02290046
024400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02300046
024500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02310046
024600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02320046
024700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02330046
024800     MOVE LENGTH OF PO113AI        TO DP030-MAP-LENGTH (1).       02340046
024900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02350046
025000     PERFORM 0001-CALL-CICS-ARCH-API.                             02360046
025100     PERFORM 1000-CONTROL-PROCESSING.                             02370046
025200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02380046
025300     PERFORM 0001-CALL-CICS-ARCH-API.                             02390046
025400                                                                  02400046
025500*---------------------------------------------------------------* 02410046
025600*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 02420046
025700*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 02430046
025800*---------------------------------------------------------------* 02440046
025900 0001-CALL-CICS-ARCH-API.                                         02450046
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02460050
026100                                    DFHCOMMAREA                   02470050
026200                                    DP030-CICS-API-FIELDS         02480050
026300                                    DP020-STANDARD-COMMAREA       02490050
026400                                    PO113AI.                      02500050
026500                                                                  02510046
026600     IF  DP030-RC-CALL-SUCCESSFUL                                 02520046
026700         CONTINUE                                                 02530046
026800     ELSE                                                         02540046
026900         SET DP013-NO-ROLLBACK                                    02550046
027000             DP013-XCTL-DISPLAY-RESTART                           02560046
027100             DP013-CICS-ABEND      TO TRUE                        02570046
027200         MOVE '0001-CALL-CICS-ARCH-API'                           02580046
027300                                   TO DP013-PARAGRAPH             02590046
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02600050
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02610050
027600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02620046
027700         PERFORM DP013-0000-PROCESS-ABEND                         02630046
027800     END-IF.                                                      02640046
027900                                                                  02650046
028000*----------------------------------------------------------------*02660046
028100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *02670046
028200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *02680046
028300*                                                                *02690046
028400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *02700046
028500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *02710046
028600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *02720046
028700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *02730046
028800*----------------------------------------------------------------*02740046
028900                                                                  02750046
029000 1000-CONTROL-PROCESSING.                                         02760046
029100                                                                  02770046
029200     EVALUATE TRUE                                                02780046
029300         WHEN DP020-NEXT-ACT-INITIAL                              02790046
029400             INITIALIZE ASC-SPECIFIC-COMMAREA                     02800046
029500             MOVE EIBTRMID              TO ASC-LIST-TERM-ID       02810046
029600             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   02820046
029700             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           02830046
029800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 02840046
029900             IF  PS-COMMAREA-NOT-VALID                            02850046
030000                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            02860046
030100             ELSE                                                 02870046
030200                 PERFORM 4000-BUILD-INITIAL-PANEL                 02880046
030300             END-IF                                               02890046
030400                                                                  02900046
030500         WHEN DP020-NEXT-ACT-READ-MAP                             02910046
030600             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         02920046
030700             PERFORM 2000-PROCESS-PANEL                           02930046
030800                                                                  02940046
030900         WHEN DP020-NEXT-ACT-RETURN                               02950046
031000             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         02960046
031100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    02970046
031200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02980046
031300                                                                  02990046
031400         WHEN OTHER                                               03000046
031500             SET DP013-LOGIC-ABEND TO TRUE                        03010046
031600             SET DP013-NO-ROLLBACK TO TRUE                        03020046
031700             MOVE '1000-CONTROL-PROCESSING'                       03030046
031800                                   TO DP013-PARAGRAPH             03040046
031900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03050046
032000                                   TO DP013-MESSAGE-TEXT(1)       03060046
032100             PERFORM DP013-0000-PROCESS-ABEND                     03070046
032200     END-EVALUATE.                                                03080046
032300                                                                  03090046
032400/                                                                 03100046
032500*----------------------------------------------------------------*03110046
032600* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *03120046
032700*----------------------------------------------------------------*03130046
032800                                                                  03140046
032900 1100-PROCESS-INTER-APPL-COMM.                                    03150046
033000                                                                  03160046
033100     SET PS-COMMAREA-VALID         TO TRUE.                       03170046
033200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     03180046
034200     MOVE PO-PROD-CNTRY-CDE        TO ASC-CNTRY-CDE               03190046
034300                                      DK-CNTRY-CDE.               03200046
033300                                                                  03220046
034600/                                                                 03340046
034700*----------------------------------------------------------------*03350046
034800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *03360046
034900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *03370046
035000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *03380046
035100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *03390046
035200* FUNCTION KEYS CAN GET THIS FAR.                                *03400046
035300*----------------------------------------------------------------*03410046
035500 2000-PROCESS-PANEL.                                              03420046
035600     EVALUATE TRUE                                                03430046
035700         WHEN DP020-SRC-AID = DP016-CLEAR                         03440046
035800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    03450046
035900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03460046
036000                                                                  03470046
036100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    03480046
036200             PERFORM 4000-BUILD-INITIAL-PANEL                     03490046
036300                                                                  03500046
036400         WHEN OTHER                                               03510046
036500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03520046
036600             IF  PS-NO-ERROR                                      03530046
036700                 SET DP030-CONTINUE-GO TO TRUE                    03540046
036800                 PERFORM 2100-CHECK-FUNCTION-KEY                  03550046
036900             ELSE                                                 03560046
037000                 SET DP030-OVERRIDE-GO TO TRUE                    03570046
037100             END-IF                                               03580046
037200     END-EVALUATE.                                                03590046
037300                                                                  03600046
037400*----------------------------------------------------------------*03610046
037500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*03620046
037600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *03630046
037700* CICS ARCHITECTURE API.                                         *03640046
037800*----------------------------------------------------------------*03650046
037900 2100-CHECK-FUNCTION-KEY.                                         03660046
038000                                                                  03670046
038100     EVALUATE TRUE                                                03680046
038200                                                                  03690046
038300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  03700046
038400             MOVE +1               TO PV-TOP-ITEM                 03710046
038500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03720046
038600                                                                  03730046
038700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   03740046
038800             PERFORM 2110-BROWSE-BACKWARD                         03750046
038900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03760046
039000                                                                  03770046
039100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   03780046
039200             PERFORM 2120-BROWSE-FORWARD                          03790046
039300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03800046
039400                                                                  03810046
039500         WHEN DP020-SRC-AID = DP016-ENTER                         03820046
039600                 CONTINUE                                         03830046
039700                                                                  03840046
039800         WHEN OTHER                                               03850046
039900             SET DP013-NO-ROLLBACK                                03860046
040000                 DP013-XCTL-DISPLAY-RESTART                       03870046
040100                 DP013-CICS-ABEND  TO TRUE                        03880046
040200             MOVE '2100-CHECK-FUNCTION-KEY'                       03890046
040300                                   TO DP013-PARAGRAPH             03900046
040400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03910046
040500                                   TO DP013-MESSAGE-TEXT (1)      03920046
040600             PERFORM DP013-0000-PROCESS-ABEND                     03930046
040700     END-EVALUATE.                                                03940046
040800                                                                  03950046
040900/                                                                 03960046
041000*----------------------------------------------------------------*03970046
041100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *03980046
041200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *03990046
041300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *04000046
041400*    MESSAGE.                                                    *04010046
041500*----------------------------------------------------------------*04020046
041600                                                                  04030046
041700 2110-BROWSE-BACKWARD.                                            04040046
041800                                                                  04050046
041900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    04060046
042000         GIVING PV-TOP-ITEM.                                      04070046
042100                                                                  04080046
042200     IF  ((PV-TOP-ITEM < +1)                                      04090046
042300       OR (PV-TOP-ITEM = +1))                                     04100046
042400        MOVE +1                    TO PV-TOP-ITEM                 04110046
042500*        -- TOP OF LIST --                                        04120046
042600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            04130046
042700         SET DP020-MSG-INFORMATIONAL TO TRUE                      04140046
042800     END-IF.                                                      04150046
042900                                                                  04160046
043000/                                                                 04170046
043100*----------------------------------------------------------------*04180046
043200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *04190046
043300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *04200046
043400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *04210046
043500*----------------------------------------------------------------*04220046
043600                                                                  04230046
043700 2120-BROWSE-FORWARD.                                             04240046
043800                                                                  04250046
043900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              04260046
044000         GIVING PV-TOP-ITEM.                                      04270046
044100                                                                  04280046
044200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   04290046
044300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            04300046
044400                                   TO PV-TOP-ITEM                 04310046
044500*        -- BOTTOM OF LIST --                                     04320046
044600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            04330046
044700         SET DP020-MSG-INFORMATIONAL                              04340046
044800                                   TO TRUE                        04350046
044900     ELSE                                                         04360046
045000         COMPUTE PV-BOTTOM-ITEM =                                 04370046
045100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 04380046
045200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            04390046
045300*            -- BOTTOM OF LIST --                                 04400046
045400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            04410046
045500             SET DP020-MSG-INFORMATIONAL                          04420046
045600                                   TO TRUE                        04430046
045700         END-IF                                                   04440046
045800     END-IF.                                                      04450046
045900                                                                  04460046
046000/                                                                 04470046
046100*----------------------------------------------------------------*04480046
046200*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *04490046
046300*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *04500046
046400*----------------------------------------------------------------*04510046
046500 2200-MOVE-SCREEN-TO-COMMAREA.                                    04520046
046600                                                                  04530046
046700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             04540046
046800     MOVE +1                       TO PV-SUB.                     04550046
046900                                                                  04560046
047000     PERFORM 3100-SET-SUBSCRIPTS.                                 04570046
047100                                                                  04580046
047900                                                                  04590046
048000*----------------------------------------------------------------*04600046
048100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *04610046
048200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*04620046
048300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *04630046
048400*                                                                *04640046
048500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *04650046
048600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *04660046
048700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *04670046
048800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *04680046
048900*----------------------------------------------------------------*04690046
049000                                                                  04700046
049100 3100-SET-SUBSCRIPTS.                                             04710046
049200                                                                  04720046
049300     COMPUTE ASC-ITEM-SUB =                                       04730046
049400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        04740046
049500                                                                  04750046
049600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         04760046
049700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            04770046
049800                                                                  04780046
049900         MOVE PC-MAX-BLOCKS-IN-ARRAY                              04790046
050000                                   TO ASC-BLK-SUB                 04800046
050100     ELSE                                                         04810046
050200         MOVE +1                   TO ASC-BLK-SUB                 04820046
050300     END-IF.                                                      04830046
050400                                                                  04840046
050500*----------------------------------------------------------------*04850046
050600*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *04860046
050700*----------------------------------------------------------------*04870046
050800                                                                  04880046
050900*----------------------------------------------------------------*04890046
051000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *04900046
051100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *04910046
051200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *04920046
051300*    DISPLAY THE PANEL TO USER.                                  *04930046
051400*----------------------------------------------------------------*04940046
051500                                                                  04950046
051600 4000-BUILD-INITIAL-PANEL.                                        04960046
051700                                                                  04970046
051800     INITIALIZE ASC-BLOCK-ENTRIES (1)                             04980046
051900                ASC-BLOCK-ENTRIES (2).                            04990046
052000     MOVE +1                       TO ASC-BLK-SUB.                05000046
052100     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       05010046
052200     MOVE +0                       TO ASC-ITEM-SUB                05020046
052300                                      ASC-NUMBER-OF-ITEMS-READ    05030046
052400                                      ASC-HIGHEST-BLOCK-WRITTEN   05040046
052500                                      ASC-ITEM-AT-TOP-OF-PANEL.   05050046
052600                                                                  05060046
052700     PERFORM 4010-OPEN-CURSOR.                                    05070046
052800                                                                  05080046
052900     PERFORM 4300-READ-ITEMS-FROM-DB.                             05090046
053000                                                                  05100046
053100     PERFORM 4020-CLOSE-CURSOR.                                   05110046
053200                                                                  05120046
053300     MOVE +1                       TO PV-TOP-ITEM.                05130046
053400                                                                  05140046
053500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          05150046
053600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    05160046
053700         SET DP020-MSG-FATAL       TO TRUE                        05170046
053800         MOVE PC-TSYMSG-02493      TO DP020-MSG-NUMBER            05180046
053900     ELSE                                                         05190046
054000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      05200046
054100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     05210046
054200     END-IF.                                                      05220046
054300                                                                  05230046
054400/                                                                 05240046
054500*----------------------------------------------------------------*05250046
054600* OPEN THE PO LINE ITEM CURSOR                                   *05260046
054700*----------------------------------------------------------------*05270046
054800                                                                  05280046
054900 4010-OPEN-CURSOR.                                                05290046
055000                                                                  05300046
055100     PERFORM                                                      05310046
055200         WITH TEST AFTER                                          05320046
055300         VARYING PV-RETRY-COUNTER                                 05330046
055400         FROM 1 BY 1                                              05340046
055500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05350046
055600            OR (SQLCODE = +0))                                    05360046
055700                                                                  05370046
055800                  EXEC SQL                                        05380046
055900                      OPEN QTACTG-CSR                             05390046
056000                  END-EXEC                                        05400046
056100                                                                  05410046
056200         EVALUATE TRUE                                            05420046
056300             WHEN SQLCODE = +0                                    05430046
056400                  CONTINUE                                        05440046
056500             WHEN SQLCODE = -904                                  05450046
056600             WHEN SQLCODE = -913                                  05460046
056700                  CONTINUE                                        05470046
056800             WHEN SQLWARN0 NOT = SPACE                            05480046
056900             WHEN SQLCODE  NOT = +0                               05490046
057000                  MOVE '4010-OPEN-CURSOR'                         05500046
057100                                   TO DP013-PARAGRAPH             05510046
057200                  MOVE 'OPEN APP/ITEM-CSR CURSOR'                 05520046
057300                                   TO DP013-MESSAGE-TEXT (1)      05530046
057400                  MOVE SQLCA       TO DP013-SQLCA                 05540046
057500                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)    05550046
057600                  SET DP013-DB2-ABEND                             05560046
057700                                   TO TRUE                        05570046
057800                  PERFORM DP013-0000-PROCESS-ABEND                05580046
057900         END-EVALUATE                                             05590046
058000     END-PERFORM.                                                 05600046
058100                                                                  05610046
058200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05620046
058300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             05630046
058400         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              05640046
058500                                   TO DP013-MESSAGE-TEXT (1)      05650046
058600         MOVE SQLCA                TO DP013-SQLCA                 05660046
058700         SET DP013-DB2-ABEND       TO TRUE                        05670046
058800         PERFORM DP013-0000-PROCESS-ABEND                         05680046
058900     END-IF.                                                      05690046
059000                                                                  05700046
059100/                                                                 05710046
054500*----------------------------------------------------------------*05720046
054600* OPEN THE QTA DESC CURSOR                                       *05730046
054700*----------------------------------------------------------------*05740046
054800                                                                  05750046
054900 4311-OPEN-DESC-CSR.                                              05760046
055000                                                                  05770046
055100     PERFORM                                                      05771046
055200         WITH TEST AFTER                                          05772046
055300         VARYING PV-RETRY-COUNTER                                 05773046
055400         FROM 1 BY 1                                              05774046
055500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05775046
055600            OR (SQLCODE = +0))                                    05776046
055700                                                                  05777046
055800                  EXEC SQL                                        05778046
055900                      OPEN QTADSC-CSR                             05779046
056000                  END-EXEC                                        05779146
056100                                                                  05779246
056200         EVALUATE TRUE                                            05779346
056300             WHEN SQLCODE = +0                                    05779446
056400                  CONTINUE                                        05779546
056500             WHEN SQLCODE = -904                                  05779646
056600             WHEN SQLCODE = -913                                  05779746
056700                  CONTINUE                                        05779846
056800             WHEN SQLWARN0 NOT = SPACE                            05779946
056900             WHEN SQLCODE  NOT = +0                               05780046
057000                  MOVE '4311-OPEN-DESC-CSR'                       05780146
057100                                   TO DP013-PARAGRAPH             05780246
057200                  MOVE 'OPEN QTADSC-CSR CURSOR'                   05780346
057300                                   TO DP013-MESSAGE-TEXT (1)      05780446
057400                  MOVE SQLCA       TO DP013-SQLCA                 05780546
057500                  MOVE 'TQTACTG'   TO DP013-DB2-TABLE-NAME (1)    05780646
057600                  SET DP013-DB2-ABEND                             05780746
057700                                   TO TRUE                        05780846
057800                  PERFORM DP013-0000-PROCESS-ABEND                05780946
057900         END-EVALUATE                                             05781046
058000     END-PERFORM.                                                 05781146
058100                                                                  05781246
058200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05781346
058300         MOVE '4311-OPEN-DESC-CSR' TO DP013-PARAGRAPH             05781446
058400         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              05781546
058500                                   TO DP013-MESSAGE-TEXT (1)      05781646
058600         MOVE SQLCA                TO DP013-SQLCA                 05781746
058700         SET DP013-DB2-ABEND       TO TRUE                        05781846
058800         PERFORM DP013-0000-PROCESS-ABEND                         05781946
058900     END-IF.                                                      05782046
059000                                                                  05782146
059100/                                                                 05782246
069000*----------------------------------------------------------------*05782346
069100*    FETCH A QOUATA DESCRIPTION.                                 *05782446
069200*----------------------------------------------------------------*05782546
069300 4312-FETCH-DESC-CSR.                                             05782646
                                                                        05782746
069400     EXEC SQL                                                     05782846
069500         FETCH QTADSC-CSR                                         05782946
069600              INTO :QTACTG-CNTRY-CDE,                             05783046
069600                   :QTACTG-QTA-CTG-DESC                           05784046
069900     END-EXEC.                                                    05784146
070000                                                                  05784246
070100                                                                  05784346
070200     EVALUATE TRUE                                                05784446
070300         WHEN SQLCODE = +0                                        05784546
070400              CONTINUE                                            05784646
070500         WHEN SQLCODE = +100                                      05784746
070700         WHEN SQLWARN0 NOT = SPACE                                05784846
070800         WHEN SQLCODE < +0                                        05784946
070900         WHEN SQLCODE > +0                                        05785046
071000              MOVE '4312-FETCH-DESC-CSR'                          05785146
071100                                   TO DP013-PARAGRAPH             05785246
071200              MOVE 'FETCH QTADSC CURSOR'                          05785346
071300                                   TO DP013-MESSAGE-TEXT (1)      05785446
071400              MOVE SQLCA           TO DP013-SQLCA                 05785546
071500              MOVE 'TQTACTG'       TO DP013-DB2-TABLE-NAME (1)    05785646
071600              SET DP013-DB2-ABEND  TO TRUE                        05785746
071700              PERFORM DP013-0000-PROCESS-ABEND                    05785846
071800     END-EVALUATE.                                                05785946
071900                                                                  05786046
072000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05786146
072100         MOVE '4312-FETCH-DESC-CSR' TO DP013-PARAGRAPH            05786246
072200         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             05786346
072300                                   TO DP013-MESSAGE-TEXT (1)      05786446
072400         MOVE SQLCA                TO DP013-SQLCA                 05786546
072500         SET DP013-DB2-ABEND                                      05786646
072600             DP013-XCTL-DISPLAY-RESTART                           05786746
072700                                   TO TRUE                        05786846
072800         PERFORM DP013-0000-PROCESS-ABEND                         05786946
072900     END-IF.                                                      05787046
073000/                                                                 05787146
059200*----------------------------------------------------------------*05787246
059300* CLOSE THE QTA DESC CURSOR                                      *05787346
059400*----------------------------------------------------------------*05787446
059500                                                                  05787546
059600 4313-CLOSE-DESC-CSR.                                             05787646
059900                                                                  05787746
060000              EXEC SQL                                            05787846
060100                  CLOSE QTADSC-CSR                                05787946
060200              END-EXEC                                            05788046
060300                                                                  05788146
060400                                                                  05788246
060500     EVALUATE TRUE                                                05788346
060600         WHEN SQLCODE = +0                                        05788446
060700              CONTINUE                                            05788546
060800                                                                  05788646
060900         WHEN SQLWARN0 NOT = SPACE                                05788746
061000         WHEN SQLCODE  NOT = +0                                   05788846
061100              MOVE '4313-CLOSE-DESC-CSR'                          05788946
061200                                   TO DP013-PARAGRAPH             05789046
061300              MOVE 'CLOSE QTADSC-CSR CURSOR'                      05789146
061400                                   TO DP013-MESSAGE-TEXT (1)      05789246
061500              MOVE SQLCA           TO DP013-SQLCA                 05789346
061600              MOVE 'TQTACTG'       TO DP013-DB2-TABLE-NAME (1)    05789446
061700              SET DP013-DB2-ABEND  TO TRUE                        05789546
061800              PERFORM DP013-0000-PROCESS-ABEND                    05789646
061900     END-EVALUATE.                                                05789746
062000                                                                  05789846
059200*----------------------------------------------------------------*05789946
059300* CLOSE THE PO QTA CTG CDE CURSOR                                *05790046
059400*----------------------------------------------------------------*05800046
059500                                                                  05810046
059600 4020-CLOSE-CURSOR.                                               05820046
059700                                                                  05830046
059900                                                                  05840046
060000              EXEC SQL                                            05850046
060100                  CLOSE QTACTG-CSR                                05860046
060200              END-EXEC                                            05870046
060300                                                                  05880046
060400                                                                  05890046
060500     EVALUATE TRUE                                                05900046
060600         WHEN SQLCODE = +0                                        05910046
060700              CONTINUE                                            05920046
060800                                                                  05930046
060900         WHEN SQLWARN0 NOT = SPACE                                05940046
061000         WHEN SQLCODE  NOT = +0                                   05950046
061100              MOVE '4020-CLOSE-CURSOR'                            05960046
061200                                   TO DP013-PARAGRAPH             05970046
061300              MOVE 'CLOSE APP/ITEM-CSR CURSOR'                    05980046
061400                                   TO DP013-MESSAGE-TEXT (1)      05990046
061500              MOVE SQLCA           TO DP013-SQLCA                 06000046
061600              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    06010046
061700              SET DP013-DB2-ABEND  TO TRUE                        06020046
061800              PERFORM DP013-0000-PROCESS-ABEND                    06030046
061900     END-EVALUATE.                                                06040046
062000                                                                  06050046
062100*----------------------------------------------------------------*06060046
062200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *06070046
062300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *06080046
062400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *06090046
062500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *06100046
062600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *06110046
062700*                                                                *06120046
062800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *06130046
062900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *06140046
063000*    UPON INITIALIZATION.                                        *06150046
063100*----------------------------------------------------------------*06160046
063200                                                                  06170046
063300 4300-READ-ITEMS-FROM-DB.                                         06180046
063400                                                                  06190046
063500     PERFORM                                                      06200046
063600         VARYING PV-READ-COUNT                                    06210046
063700         FROM 1 BY 1                                              06220046
063800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    06230046
063900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         06240046
064000                                                                  06250046
064100         PERFORM 4310-FETCH                                       06260046
064200                                                                  06270046
064300         IF  ASC-ITEMS-LEFT-ON-DB                                 06280046
064400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                06290046
064500                 ADD +1            TO ASC-ITEM-SUB                06300046
064600             ELSE                                                 06310046
064700                 ADD +1            TO ASC-BLK-SUB                 06320046
064800                 MOVE +1           TO ASC-ITEM-SUB                06330046
064900                                                                  06340046
065000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         06350046
065100                     MOVE +1       TO ASC-BLK-SUB                 06360046
065200                     PERFORM 5100-WRITE-TEMP-STORAGE              06370046
065300                     MOVE ASC-BLOCK-ENTRIES                       06380046
065400                               (PC-MAX-BLOCKS-IN-ARRAY)           06390046
065500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 06400046
065600                     ADD +1        TO ASC-BLK-SUB                 06410046
065700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   06420046
065800                 END-IF                                           06430046
065900             END-IF                                               06440046
066000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    06450046
066100             MOVE ASC-NUMBER-OF-ITEMS-READ                        06460046
066200                                   TO ASC-LIST-ITEM-NUMBER        06470046
066300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  06480046
066400             MOVE QTACTG-QTA-CTG-CDE                              06490046
066500                                   TO ASC-QTA-CTG-CDE             06500046
066600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  06510046
066900             MOVE QTACTG-QTA-CTG-DESC TO ASC-QTA-CTG-DESC         06520046
067000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  06530046
067100         END-IF                                                   06540046
067200     END-PERFORM.                                                 06550046
067300                                                                  06560046
067400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          06570046
067500         MOVE +1                   TO ASC-BLK-SUB                 06580046
067600         PERFORM 5100-WRITE-TEMP-STORAGE                          06590046
067700         ADD +1                    TO ASC-BLK-SUB                 06600046
067800         PERFORM 5100-WRITE-TEMP-STORAGE                          06610046
067900                                                                  06620046
068000         MOVE 1                    TO ASC-BLK-SUB                 06630046
068100                                      PV-BLOCK-NUMBER             06640046
068200         PERFORM 4410-READ-TEMP-STORAGE                           06650046
068300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             06660046
068400             MOVE 2                TO ASC-BLK-SUB                 06670046
068500                                      PV-BLOCK-NUMBER             06680046
068600             PERFORM 4410-READ-TEMP-STORAGE                       06690046
068700         END-IF                                                   06700046
068800     END-IF.                                                      06710046
068900/                                                                 06720046
069000*----------------------------------------------------------------*06730046
069100*    FETCH A LINE ITEM                                           *06740046
069200*----------------------------------------------------------------*06750046
069300 4310-FETCH.                                                      06760046
069400     EXEC SQL                                                     06770046
069500         FETCH QTACTG-CSR                                         06780046
069600              INTO :QTACTG-QTA-CTG-CDE                            06790046
069900     END-EXEC                                                     06800046
070000                                                                  06810046
070100                                                                  06820046
070200     EVALUATE TRUE                                                06830046
070300         WHEN SQLCODE = +0                                        06840046
070400              MOVE QTACTG-QTA-CTG-CDE     TO PV-QTA-CTG-CDE       06850046
                    PERFORM 4311-OPEN-DESC-CSR                          06860046
                    PERFORM 4312-FETCH-DESC-CSR                         06870046
                    PERFORM 4313-CLOSE-DESC-CSR                         06871046
070500         WHEN SQLCODE = +100                                      06872046
070600              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 06873046
070700         WHEN SQLWARN0 NOT = SPACE                                06874046
070800         WHEN SQLCODE < +0                                        06875046
070900         WHEN SQLCODE > +0                                        06876046
071000              MOVE '4310-FETCH-CURSOR'                            06877046
071100                                   TO DP013-PARAGRAPH             06878046
071200              MOVE 'FETCH QTACTG CURSOR'                          06879046
071300                                   TO DP013-MESSAGE-TEXT (1)      06880046
071400              MOVE SQLCA           TO DP013-SQLCA                 06890046
071500              MOVE 'TQTACTG'       TO DP013-DB2-TABLE-NAME (1)    06900046
071600              SET DP013-DB2-ABEND  TO TRUE                        06910046
071700              PERFORM DP013-0000-PROCESS-ABEND                    06920046
071800     END-EVALUATE.                                                06930046
071900                                                                  06940046
072000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06950046
072100         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             06960046
072200         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             06970046
072300                                   TO DP013-MESSAGE-TEXT (1)      06980046
072400         MOVE SQLCA                TO DP013-SQLCA                 06990046
072500         SET DP013-DB2-ABEND                                      07000046
072600             DP013-XCTL-DISPLAY-RESTART                           07010046
072700                                   TO TRUE                        07020046
072800         PERFORM DP013-0000-PROCESS-ABEND                         07030046
072900     END-IF.                                                      07040046
073000/                                                                 07050046
073100*----------------------------------------------------------------*07060046
073200*----------------------------------------------------------------*07070046
073300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *07080046
073400*----------------------------------------------------------------*07090046
073500 4400-MOVE-COMMAREA-TO-SCREEN.                                    07100046
073600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             07110046
073700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          07120046
073800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          07130046
073900             MOVE +1               TO ASC-BLK-SUB                 07140046
074000             PERFORM 5100-WRITE-TEMP-STORAGE                      07150046
074100             ADD +1                TO ASC-BLK-SUB                 07160046
074200             PERFORM 5100-WRITE-TEMP-STORAGE                      07170046
074300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             07180046
074400                 GIVING PV-BLOCK-NUMBER                           07190046
074500                 REMAINDER PV-REMAINDER                           07200046
074600             IF  PV-REMAINDER > ZERO                              07210046
074700                 ADD +1            TO PV-BLOCK-NUMBER             07220046
074800             END-IF                                               07230046
074900             MOVE +1               TO ASC-BLK-SUB                 07240046
075000             PERFORM 4410-READ-TEMP-STORAGE                       07250046
075100             ADD +1                TO ASC-BLK-SUB                 07260046
075200                                      PV-BLOCK-NUMBER             07270046
075300             PERFORM 4410-READ-TEMP-STORAGE                       07280046
075400     END-IF.                                                      07290046
075500     MOVE +1                       TO ASC-BLK-SUB.                07300046
075600     COMPUTE ASC-ITEM-SUB =                                       07310046
075700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              07320046
075800         + PC-ITEMS-PER-PANEL).                                   07330046
075900                                                                  07340046
076000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        07350046
076100         ADD +1                    TO ASC-BLK-SUB                 07360046
076200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            07370046
076300     END-IF.                                                      07380046
076400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           07390046
076500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                07400046
076600     PERFORM 4420-FORMAT-LIST-LINES                               07410046
076700         VARYING PV-SUB                                           07420046
076800         FROM PC-ITEMS-PER-PANEL BY -1                            07430046
076900         UNTIL PV-SUB < +1.                                       07440046
077000     COMPUTE ASC-ITEMS-DISPLAYED =                                07450046
077100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          07460046
077200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   07470046
077300     IF  DP020-MSG-NUMBER-X = SPACE                               07480046
077400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  07490046
077500*            --- MORE ITEMS TO DISPLAY ----                       07500046
077600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            07510046
077700             SET DP020-MSG-INFORMATIONAL TO TRUE                  07520046
077800         END-IF                                                   07530046
077900     END-IF.                                                      07540046
078000/                                                                 07550046
078100*----------------------------------------------------------------*07560046
078200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *07570046
078300*----------------------------------------------------------------*07580046
078400 4410-READ-TEMP-STORAGE.                                          07590046
078500     EXEC CICS                                                    07600046
078600         READQ TS                                                 07610046
078700             QUEUE (ASC-LIST-QUEUE-NAME)                          07620046
078800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               07630046
078900             ITEM  (PV-BLOCK-NUMBER)                              07640046
079000             RESP  (PV-CICS-RESP)                                 07650046
079100     END-EXEC.                                                    07660046
079200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       07670046
079300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     07680046
079400         CONTINUE                                                 07690046
079500     ELSE                                                         07700046
079600         SET DP013-CICS-ABEND      TO TRUE                        07710046
079700         SET DP013-NO-ROLLBACK     TO TRUE                        07720046
079800         MOVE '4410-READ-TEMP-STORAGE'                            07730046
079900                                   TO DP013-PARAGRAPH             07740046
080000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      07750046
080100                                   TO DP013-MESSAGE-TEXT(1)       07760046
080200         PERFORM DP013-0000-PROCESS-ABEND                         07770046
080300     END-IF.                                                      07780046
080600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         07790046
080700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               07800046
080800     END-IF.                                                      07810046
080900/                                                                 07820046
081000*----------------------------------------------------------------*07830046
081100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *07840046
081200*----------------------------------------------------------------*07850046
081300 4420-FORMAT-LIST-LINES.                                          07860046
081400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      07870046
081500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                07880046
083500         MOVE SPACES               TO                             07890046
083800                                      MR-QTA-CTG-CDE (PV-SUB)     07900046
083900                                      MR-QTA-CTG-DESC (PV-SUB)    07910046
081740                                                                  07920046
082800     ELSE                                                         07930046
082900         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           07940046
083200             MOVE ASC-QTA-CTG-CDE (ASC-BLK-SUB ASC-ITEM-SUB)      07950046
083300                                   TO MR-QTA-CTG-CDE (PV-SUB)     07960046
083600             MOVE ASC-QTA-CTG-DESC (ASC-BLK-SUB ASC-ITEM-SUB)     07970046
083700                                   TO MR-QTA-CTG-DESC (PV-SUB)    07980046
084800         END-IF                                                   07990046
084900     END-IF.                                                      08000046
085000                                                                  08010046
085100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               08020046
085200                                                                  08030046
085300     IF  ASC-ITEM-SUB < + 1                                       08040046
085400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                08050046
085500         MOVE +1                   TO ASC-BLK-SUB                 08060046
085600     END-IF.                                                      08070046
085700/                                                                 08080046
085800*----------------------------------------------------------------*08090046
085900*    SELECT THE COUNTRY NAME                                     *08100046
086100*----------------------------------------------------------------*08110046
       4800-SELECT-COUNTRY-NM.                                          08120046
233700     PERFORM                                                      08130046
233800         WITH TEST AFTER                                          08140046
233900         VARYING PV-RETRY-COUNTER                                 08150046
234000         FROM 1 BY 1                                              08160046
234100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08170046
234200                   OR (SQLCODE = ZERO))                           08180046
234300                                                                  08190046
234400         EXEC SQL                                                 08200046
234500             SELECT CNTRY_NM                                      08210046
234600             INTO   :CNTRY-CNTRY-NM                               08220046
234700             FROM   TCNTRY                                        08230046
234800             WHERE  CNTRY_CDE    = :ASC-CNTRY-CDE                 08240046
                     AND  STAT_CDE     = 'A'                            08250046
234900         END-EXEC                                                 08260046
235000                                                                  08270046
235100         EVALUATE TRUE                                            08280046
235200             WHEN SQLCODE = ZERO                                  08290046
235400             WHEN SQLCODE = -904                                  08300046
235500             WHEN SQLCODE = -913                                  08310046
235600                 CONTINUE                                         08320046
235700             WHEN SQLWARN0 NOT = SPACES                           08330046
235800             WHEN SQLCODE < ZERO                                  08340046
235900             WHEN SQLCODE > ZERO                                  08350046
236000                 MOVE '4800-SELECT-COUNTRY-NM'                    08360046
236100                                   TO DP013-PARAGRAPH             08370046
236200                 MOVE 'SELECT TCNTRY    '                         08380046
236300                                   TO DP013-MESSAGE-TEXT (1)      08390046
236400                 MOVE SQLCA        TO DP013-SQLCA                 08400046
236500                 MOVE 'TCNTRY'     TO DP013-DB2-TABLE-NAME (1)    08410046
236600                 SET DP013-DB2-ABEND                              08420046
236700                     DP013-XCTL-DISPLAY-RESTART                   08430046
236800                                   TO TRUE                        08440046
236900                 PERFORM DP013-0000-PROCESS-ABEND                 08450046
237000         END-EVALUATE                                             08460046
237100     END-PERFORM.                                                 08470046
237200*                                                                 08480046
237300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08490046
237400         MOVE '4800-SELECT-COUNTRY-NM'                            08500046
237500                                   TO DP013-PARAGRAPH             08510046
237600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     08520046
237700                                   TO DP013-MESSAGE-TEXT (1)      08530046
237800         MOVE 'TCNTRY '            TO DP013-MESSAGE-TEXT (2)      08540046
237900         MOVE SQLCA                TO DP013-SQLCA                 08550046
238000         MOVE 'TCNTRY '            TO DP013-DB2-TABLE-NAME (1)    08560046
238100         SET DP013-DB2-ABEND                                      08570046
238200             DP013-XCTL-DISPLAY-RESTART                           08571046
238300                                   TO TRUE                        08572046
238400         PERFORM DP013-0000-PROCESS-ABEND                         08573046
238500     END-IF.                                                      08574046
085800*----------------------------------------------------------------*08575046
085900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *08575146
086000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *08575246
086100*----------------------------------------------------------------*08575346
086200 5100-WRITE-TEMP-STORAGE.                                         08575446
086300                                                                  08575546
086400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     08575646
086500                                   TO PV-LIST-ITEM-NUMBER.        08575746
086600     COMPUTE PV-BLOCK-NUMBER =                                    08575846
086700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08575946
086800                                                                  08576046
086900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             08577046
087000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             08578046
               CONTINUE                                                 08579046
087400     ELSE                                                         08580046
087500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       08590046
087600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            08600046
087700         PERFORM 5110-WRITE-ASC-LISTQ                             08610046
087800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   08620046
087900     END-IF.                                                      08630046
088000                                                                  08640046
088200/                                                                 08650046
088300*----------------------------------------------------------------*08660046
088400*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *08670046
088500*  SPECIFIC COMMAREA.                                            *08680046
088600*----------------------------------------------------------------*08690046
088700 5105-REWRITE-ASC-LISTQ.                                          08700046
088800                                                                  08710046
088900     EXEC CICS                                                    08720046
089000         WRITEQ TS                                                08730046
089100             QUEUE (ASC-LIST-QUEUE-NAME)                          08740046
089200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               08750046
089300             ITEM  (PV-BLOCK-NUMBER)                              08760046
089400             REWRITE                                              08770046
089500             RESP  (PV-CICS-RESP)                                 08780046
089600     END-EXEC.                                                    08790046
089700                                                                  08800046
089800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           08810046
089900         CONTINUE                                                 08820046
090000     ELSE                                                         08830046
090100         SET DP013-CICS-ABEND      TO TRUE                        08840046
090200         SET DP013-NO-ROLLBACK     TO TRUE                        08850046
090300         MOVE '5105-REWRITE-ASC-LISTQ'                            08860046
090400                                   TO DP013-PARAGRAPH             08870046
090500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     08880046
090600                                   TO DP013-MESSAGE-TEXT(1)       08890046
090700         PERFORM DP013-0000-PROCESS-ABEND                         08900046
090800     END-IF.                                                      08910046
090900/                                                                 08920046
091000*----------------------------------------------------------------*08930046
091100*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *08940046
091200*  SPECIFIC COMMAREA.                                            *08950046
091300*----------------------------------------------------------------*08960046
091400 5110-WRITE-ASC-LISTQ.                                            08970046
091500                                                                  08980046
091600     EXEC CICS                                                    08990046
091700         WRITEQ TS                                                09000046
091800             QUEUE (ASC-LIST-QUEUE-NAME)                          09010046
091900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               09020046
092000             ITEM  (PV-BLOCK-NUMBER)                              09030046
092100             RESP  (PV-CICS-RESP)                                 09040046
092200     END-EXEC.                                                    09050046
092300                                                                  09060046
092400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      09070046
092500         SET DP013-CICS-ABEND      TO TRUE                        09080046
092600         SET DP013-NO-ROLLBACK     TO TRUE                        09090046
092700         MOVE '5110-WRITE-ASC-LISTQ'                              09100046
092800                                   TO DP013-PARAGRAPH             09110046
092900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           09120046
093000                                   TO DP013-MESSAGE-TEXT(1)       09130046
093100         PERFORM DP013-0000-PROCESS-ABEND                         09140046
093200     END-IF.                                                      09150046
093300/                                                                 09160046
093400*----------------------------------------------------------------*09170046
093500*    ABEND PROCESSOR MODULE                                      *09180046
093600*----------------------------------------------------------------*09190046
093700     COPY DPPD013.                                                09200046
