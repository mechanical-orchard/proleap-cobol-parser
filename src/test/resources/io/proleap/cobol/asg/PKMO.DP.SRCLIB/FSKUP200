       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.      FSKUP200.                                       00020000
       AUTHOR.          COGNIZANT.                                      00030000
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
       DATE-WRITTEN.    03/24/2011.                                     00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      *  FSKUP200 - FASHION SALES MESSAGES DRIVER MODULE                00090000
BKPFLC******************************************************************00100000
BKPFLC* 10/31/11 - ARUN R           -  INC # INC000001902638            00110000
BKPFLC*    - CORRECTED THE BACK UP FILE CREATION LOGIC IN 2500 PARA.    00120000
P3540B******************************************************************00130000
P3540B* 09/19/12 - JOHN SELWITSCHKA -  CRQ # CRQ000000030912            00140000
P3540B*    - FLEXIBLE STORE HOURS PROJECT. WRITE TRANSACTIONS DATED     00150000
P3540B*      THE NEXT DAY TO A RECYCLE FILE.                            00160000
      ******************************************************************00170000
OCFSFS* 08/27/13 - RACHEL GRAMANN      CHG # CHG0060713                 00180000
OCFSFS*    - OCF SHIP FROM STORE PROJECT TO FEED MERCHANDISE CHANGES TO 00190000
OCFSFS*      FASHION SALES                                              00200000
OCFSFS***************************************************************** 00210000
P48056***************************************************************** 00220000
P48056* 07/10/14 - COGNIZANT           CHG # CHG0086470                 00230000
P48056*    -  MODIFIED PV-QTY-CHECK FROM 99 TO 499 UPON REQUEST FROM    00240000
P48056*       SUE THOMA.                                                00250000
P48056***************************************************************** 00260000
WYFAIR* 07/15/14 - RONNA MCDONALD      CHG # CHG0XXXXXX                 00270007
WYFAIR*                                WAYFAIR - BLOCK DEPT 070         00280000
WYFAIR******************************************************************00290000
MIRAKL* 07/07/20 - COGNIZANT           CHG # CHG0246563                 00300000
MIRAKL*                                MIRAKL  - BLOCK DEPT 985         00310000
C55777******************************************************************00320000
C55777* 04/20/21 - COGNIZANT           CHG # CHG0255777                 00330000
C55777*       REMOVED JIM HUNTER AND ADDED IT-MERCHANDISE-FINANCIALS-   00340000
C55777*       DELIVERY AS ALERT EMAIL ID INCASE IF THE JOB IS FAILED    00350000
C55777******************************************************************00360000
C68071* 03/21/22 - COGNIZANT           CHG0268071                       00362007
C68071*       ADDED LOGIC TO HANDLE ERROR MESSAGES FROM THE SALES HUB   00363007
C68071*       TO KEEP THE PROCESS RUNNING INSTEAD OF ABENDING THE JOB.  00364007
C68071******************************************************************00365007
SEPHOR* 04/08/22 - RONNA MCDONALD      CHG # CHG0268931                 00367009
SEPHOR*                                SEPHORA GIFT CARD BLOCK DEPT 712 00368008
SEPHOR******************************************************************00369008
                                                                        00370000
       ENVIRONMENT DIVISION.                                            00380000
       CONFIGURATION SECTION.                                           00390000
       SOURCE-COMPUTER.        IBM-3090.                                00400000
       OBJECT-COMPUTER.        IBM-3090.                                00410000
                                                                        00420000
       INPUT-OUTPUT SECTION.                                            00430000
                                                                        00440000
       FILE-CONTROL.                                                    00450000
                                                                        00460000
           SELECT CONTROL-CARD-1                                        00470000
                  ASSIGN TO INP01.                                      00480000
           SELECT CONTROL-CARD-2                                        00490000
                  ASSIGN TO INP02.                                      00500000
           SELECT CONTROL-CARD-3                                        00510000
                  ASSIGN TO INP03.                                      00520000
C68071     SELECT CONTROL-CARD-4                                        00521007
C68071            ASSIGN TO INP04.                                      00522007
           SELECT MESSAGE-LOG                                           00530000
                  ASSIGN TO OUT01.                                      00540000
           SELECT EMAIL-MSG-FILE                                        00550000
                  ASSIGN TO OUT02.                                      00560000
P3540B     SELECT RECYCLE-MSG-FILE                                      00570000
P3540B            ASSIGN TO OUT03.                                      00580000
C68071     SELECT ERROR-MSG-FILE                                        00581007
C68071            ASSIGN TO OUT04.                                      00582007
                                                                        00590000
       DATA DIVISION.                                                   00600000
       FILE SECTION.                                                    00610000
                                                                        00620000
       FD  CONTROL-CARD-1                                               00630000
           RECORDING MODE F                                             00640000
           BLOCK CONTAINS 0 RECORDS                                     00650000
           LABEL RECORDS ARE STANDARD                                   00660000
           DATA RECORD IS CONTROL-CARD-1-RECORD.                        00670000
       01  CONTROL-CARD-1-RECORD           PIC X(80).                   00680000
                                                                        00690000
       FD  CONTROL-CARD-2                                               00700000
           RECORDING MODE F                                             00710000
           BLOCK CONTAINS 0 RECORDS                                     00720000
           LABEL RECORDS ARE STANDARD                                   00730000
           DATA RECORD IS CONTROL-CARD-2-RECORD.                        00740000
       01  CONTROL-CARD-2-RECORD           PIC X(80).                   00750000
                                                                        00760000
       FD  CONTROL-CARD-3                                               00770000
           RECORDING MODE F                                             00780000
           BLOCK CONTAINS 0 RECORDS                                     00790000
           LABEL RECORDS ARE STANDARD                                   00800000
           DATA RECORD IS CONTROL-CARD-3-RECORD.                        00810000
       01  CONTROL-CARD-3-RECORD           PIC X(80).                   00820000
                                                                        00830000
C68071 FD  CONTROL-CARD-4                                               00831007
C68071     RECORDING MODE F                                             00832007
C68071     BLOCK CONTAINS 0 RECORDS                                     00833007
C68071     LABEL RECORDS ARE STANDARD                                   00834007
C68071     DATA RECORD IS CONTROL-CARD-4-RECORD.                        00835007
C68071 01  CONTROL-CARD-4-RECORD           PIC X(80).                   00836007
C68071                                                                  00837007
       FD  MESSAGE-LOG                                                  00840000
           RECORDING MODE F                                             00850000
           BLOCK CONTAINS 0 RECORDS                                     00860000
           LABEL RECORDS ARE STANDARD                                   00870000
           DATA RECORD IS MESSAGE-LOG-RECORD.                           00880000
OCFSFS 01  MESSAGE-LOG-RECORD              PIC X(65).                   00890000
                                                                        00900000
       FD  EMAIL-MSG-FILE                                               00910000
           RECORDING MODE F                                             00920000
           BLOCK CONTAINS 0 RECORDS                                     00930000
           LABEL RECORDS ARE STANDARD                                   00940000
           DATA RECORD IS EMAIL-MSG-FILE-RECORD.                        00950000
       01  EMAIL-MSG-FILE-RECORD           PIC X(80).                   00960000
                                                                        00970000
P3540B FD  RECYCLE-MSG-FILE                                             00980000
P3540B     RECORDING MODE F                                             00990000
P3540B     BLOCK CONTAINS 0 RECORDS                                     01000000
P3540B     LABEL RECORDS ARE STANDARD                                   01010000
P3540B     DATA RECORD IS EMAIL-MSG-FILE-RECORD.                        01020000
OCFSFS 01  RECYCLE-MSG-RECORD              PIC X(65).                   01030000
P3540B                                                                  01040000
C68071 FD  ERROR-MSG-FILE                                               01041007
C68071     RECORDING MODE F                                             01042007
C68071     BLOCK CONTAINS 0 RECORDS                                     01043007
C68071     LABEL RECORDS ARE STANDARD                                   01044007
C68071     DATA RECORD IS ERROR-MSG-FILE-RECORD.                        01045007
C68071 01  ERROR-MSG-FILE-RECORD           PIC X(400).                  01046007
                                                                        01047000
       WORKING-STORAGE SECTION.                                         01050000
      ******************************************************************01060000
      * PS- PROGRAM SWITCHES                                            01070000
      ******************************************************************01080000
       01  PS-PROGRAM-SWITCHES.                                         01090000
           05  PS-END-OF-CSR-SW          PIC X(1)      VALUE SPACES.    01100000
               88  PS-END-OF-CSR                   VALUE 'Y'.           01110000
      *    05  PS-MQGET-SUCCESSFUL-SW    PIC X(01) VALUE 'N'.           01120000
      *        88  PS-MQGET-SUCCESSFUL             VALUE 'Y'.           01130000
           05  PS-MESSAGE-RECEIVED-SW    PIC X(01) VALUE 'N'.           01140000
               88  PS-MESSAGE-RECEIVED             VALUE 'Y'.           01150000
           05  PS-END-OF-TASK-MSG-IND     PIC X(01) VALUE 'N'.          01160000
               88  PS-END-OF-TASK                  VALUE 'Y'.           01170000
           05  PS-FIRST-TIME-SW          PIC X(01) VALUE 'Y'.           01180000
               88  PS-NOT-FIRST-TIME               VALUE 'N'.           01190000
           05  PS-TRN-STAT-SW        PIC X(1)      VALUE ' '.           01200000
               88  PS-TRN-BYPASS                   VALUE 'B'.           01210000
               88  PS-TRN-AUDIT                    VALUE 'A'.           01220000
               88  PS-TRN-ERROR                    VALUE 'E'.           01230000
P3540B         88  PS-TRN-RECYCLE                  VALUE 'R'.           01240000
                                                                        01250000
      ******************************************************************01260000
      * PROGRAM CONSTANTS                                               01270000
      ******************************************************************01280000
       01  PC-PROGRAM-CONSTANTS.                                        01290000
OCFSFS    05  PC-HEADER-LENGTH          PIC S9(9) COMP-3 VALUE 30.      01300000
          05  PC-DET-ITEM-LENGTH        PIC S9(9) COMP-3 VALUE 35.      01310000
          05  PC-MAX-DETAIL-ITEMS       PIC S9(9) COMP-3 VALUE 400.     01320000
OCFSFS    05  PC-MSGLENGTH              PIC S9(9) BINARY VALUE +14030.  01330000
          05  PC-CURRENT-PROGRAM-NAME   PIC X(08) VALUE 'FSKUP200'.     01340000
          05  PC-JOB-NAME               PIC X(08) VALUE 'FSSALES '.     01350000
          05  PC-END-PGM-MSG            PIC X(100)                      01360000
                                         VALUE 'END RUN OF PROGRAM '.   01370000
          05  PC-FORCEEND               PIC X(18) VALUE                 01380000
                                         'FORCE END FSKUP200'.          01390000
          05  PC-STOP-MSG               PIC X(13) VALUE                 01400000
                                         'STOP FSKUP200'.               01410000
          05  PC-ZERO                   PIC 9(01)     VALUE 0  COMP-3.  01420000
          05  PC-999                    PIC 9(03)     VALUE 999.        01430000
          05  PC-PLUS-ZERO              PIC S9(01)    VALUE +0 COMP-3.  01440000
          05  PC-NEGATIVE-ONE           PIC S9        VALUE -1.         01450000
          05  PC-1                      PIC S9(03)    VALUE +1.         01460000
          05  PC-STATUS-CLEARANCE       PIC X(02)     VALUE '30'.       01470000
          05  PC-RCP-STATUS-CDE-CLR     PIC X(02)     VALUE '30'.       01480000
          05  PC-RCP-STATUS-CDE-ACTIVE  PIC X(02)     VALUE '20'.       01490000
          05  PC-SALES-TYPE-REGULAR     PIC X(02)     VALUE '01'.       01500000
          05  PC-SALES-TYPE-PROMOTIONAL PIC X(02)     VALUE '02'.       01510000
          05  PC-SALES-TYPE-CLEARANCE   PIC X(02)     VALUE '03'.       01520000
          05  PC-AUDIT-TRN              PIC X(01)     VALUE 'A'.        01530000
          05  PC-BYPASS-TRN             PIC X(01)     VALUE 'B'.        01540000
          05  PC-ERROR-TRN              PIC X(01)     VALUE 'E'.        01550000
          05  PC-DEFAULT-DATE           PIC X(08) VALUE '99990909'.     01560000
          05  PC-DEFAULT-DATE-FMT       PIC X(10) VALUE '9999-09-09'.   01570000
          05  PC-DEFAULT-TIME           PIC X(08) VALUE '00:00:00'.     01580000
          05  PC-MAX-RETRIES            PIC S9(04)    VALUE +3          01590000
                                                      COMP SYNC.        01600000
C68071    05  PV-COUNTER                PIC 9(05)     VALUE ZEROS.      01601007
                                                                        01610000
      ******************************************************************01620000
      * PV- PROGRAM VARIABLES                                           01630000
      ******************************************************************01640000
       01  PV-PROGRAM-VARIABLES.                                        01650000
           05  PV-RECORD-LENGTH         PIC 9(04)  VALUE 0  COMP.       01660000
           05  PV-MESSAGE-FROM-QUEUE    PIC 9(09) VALUE ZEROS.          01670000
           05  PV-MSG-COUNT             PIC 9(09) VALUE ZEROS.          01680000
           05  PV-DET-ITEMS-COUNT       PIC S9(9) COMP-3 VALUE 0.       01690000
           05  PV-REMAINDER             PIC S9(9) COMP-3 VALUE 0.       01700000
           05  PV-COMMIT-TIMESTAMP      PIC X(26) VALUE SPACES.         01710000
           05  PV-CURRENT-TIMESTAMP     PIC X(26) VALUE SPACES.         01720000
           05  PV-STORENO               PIC 9(04).                      01730000
           05  PV-SKU                   PIC 9(08).                      01740000
           05  FILLER REDEFINES PV-SKU.                                 01750000
               10  FILLER               PIC X(05).                      01760000
               10  PV-SKU-LAST3         PIC 9(03).                      01770000
           05  PV-DEPT                  PIC 9(03).                      01780000
           05  PV-SCL-NBR               PIC 9(02).                      01790000
           05  PV-MCL-NBR               PIC S9(04)  COMP-3.             01800000
           05  PV-PREV-SKU              PIC 9(08).                      01810000
           05  PV-SALE-AMT              PIC S9(5)V99 COMP-3 VALUE 0.    01820000
           05  PV-SALE-TYPE             PIC 9(02).                      01830000
           05  PV-SALE-UNITS            PIC S9(5) COMP-3 VALUE 0.       01840000
           05  PV-SLS-CORR-CDE          PIC X(01).                      01850000
               88  PV-NORMAL-TRANS      VALUE ' '.                      01860000
               88  PV-SALES-AUDIT-CORR  VALUE 'S'.                      01870000
               88  PV-SYSTEM-LATE-CORR  VALUE 'L'.                      01880000
           05  PV-DATE                  PIC 9(06).                      01890000
           05  PV-HOLD-DATE             PIC 9(06)  VALUE ZEROES.        01900000
           05  PV-TIME                  PIC 9(04)   COMP-3.             01910000
           05  PV-REG-AMT               PIC S9(05)V99    COMP-3.        01920000
           05  PV-TERMINAL              PIC 9(04)   COMP-3.             01930000
           05  PV-TRANSNO               PIC 9(04)   COMP-3.             01940000
           05  PV-OPERATOR              PIC 9(06)   COMP-3.             01950000
P3540B     05  PV-NEXT-DAY-DATE         PIC X(08)  VALUE SPACES.        01960000
           05  PV-PROCESS-DATE          PIC X(08)  VALUE SPACES.        01970000
           05  PV-PROCESS-DATE-FMT      PIC X(10)  VALUE SPACES.        01980000
           05  PV-PROCESS-DATE-FMT-X.                                   01990000
               15 PV-PROCESS-YEAR-FMT   PIC X(04)  VALUE SPACES.        02000000
               15 FILLER                PIC X(01)  VALUE '-'.           02010000
               15 PV-PROCESS-MONTH-FMT  PIC X(02)  VALUE SPACES.        02020000
               15 FILLER                PIC X(01)  VALUE '-'.           02030000
               15 PV-PROCESS-DAY-FMT    PIC X(02)  VALUE SPACES.        02040000
           05  PV-PROCESS-TMST          PIC X(26)  VALUE SPACES.        02050000
           05  PV-PROCESS-TMST-X.                                       02060000
               15 PV-PROCESS-TMST-YEAR  PIC X(04)  VALUE SPACES.        02070000
               15 FILLER                PIC X(01) VALUE '-'.            02080000
               15 PV-PROCESS-TMST-MONTH PIC X(02)  VALUE SPACES.        02090000
               15 FILLER                PIC X(01)  VALUE '-'.           02100000
               15 PV-PROCESS-TMST-DAY   PIC X(02)  VALUE SPACES.        02110000
               15 FILLER                PIC X(16)                       02120000
                                               VALUE '-23.59.59.999999'.02130000
           05  PV-ACTG-BOW-DATE         PIC X(10)     VALUE SPACES.     02140000
           05  PV-ACTG-YEAR.                                            02150000
               15 PV-ACTG-CC            PIC 9(02)     VALUE ZEROS.      02160000
               15 PV-ACTG-YY            PIC 9(02)     VALUE ZEROS.      02170000
           05  PV-ACTG-YEAR-9           PIC 9(04)     VALUE ZEROS.      02180000
           05  PV-ACTG-YEAR-C3          PIC S9(04)V   VALUE +0 COMP-3.  02190000
           05  PV-ACTG-MONTH            PIC 9(02)     VALUE ZEROS.      02200000
           05  PV-ACTG-MONTH-9          PIC 9(02)     VALUE ZEROS.      02210000
           05  PV-ACTG-MONTH-C3         PIC S9(02)V   VALUE +0 COMP-3.  02220000
           05  PV-TRN-ERR-CODE          PIC X(03)     VALUE SPACES.     02230000
               88  PV-NO-ERRORS                    VALUE  '000'.        02240000
           05  PV-QTY-CHECK          PIC S9(05)    COMP-3               02250000
                                             VALUE ZEROS.               02260000
           05  PV-LOC-NBR           PIC S9(04)     VALUE +0 COMP.       02270000
           05  PV-RCP-UNT-RTL-AMT   PIC S9(7)V9(2) VALUE +0 COMP-3.     02280000
           05  PV-RCP-STATUS-CDE    PIC X(02)      VALUE SPACES.        02290000
               88  PV-RCP-STATUS-CLEAR             VALUE '30'.          02300000
           05  PV-RCP-UNT-RTL-AMT-9 PIC 9(9)V9(2)  VALUE ZEROS.         02310000
           05  PV-ABSOLUTE-AMT      PIC S9(05)V99  VALUE +0 COMP-3.     02320000
           05  PV-ABSOLUTE-UNITS    PIC S9(05)     VALUE +0 COMP-3.     02330000
           05  PV-EXT-CURR-PRICE    PIC S9(07)V99  VALUE +0 COMP-3.     02340000
           05  PV-ABSOLUTE-EXT-PRC  PIC S9(07)V99  VALUE +0 COMP-3.     02350000
           05  PV-SALES-TYPE        PIC X(02)      VALUE SPACES.        02360000
           05  PV-TRAN-TIME-9        PIC 9(06)     VALUE ZEROS.         02370000
           05  PV-TRAN-TIME.                                            02380000
               15  FILLER           PIC X(02)      VALUE ZEROS.         02390000
               15  PV-TRAN-TIME-HH  PIC X(02)      VALUE ZEROS.         02400000
               15  PV-TRAN-TIME-MM  PIC X(02)      VALUE ZEROS.         02410000
           05  PV-TRAN-TIME-FMT.                                        02420000
               15  PV-TRAN-TIME-HH-FMT  PIC X(02)      VALUE ZEROS.     02430000
               15  FILLER               PIC X(01)      VALUE ':'.       02440000
               15  PV-TRAN-TIME-MM-FMT  PIC X(02)      VALUE ZEROS.     02450000
               15  FILLER               PIC X(01)      VALUE ':'.       02460000
               15  PV-TRAN-TIME-SS-FMT  PIC X(02)      VALUE ZEROS.     02470000
           05  PV-MQ-ERROR-COUNT        PIC 9(04)  VALUE 0.             02480000
           05  PV-ARRAY-LENGTH          PIC S9(9) COMP-3 VALUE 0.       02490000
           05  PV-HOLD-TRAN.                                            02500000
               10  PV-HOLD-ITM-NBR      PIC S9(15)V   VALUE +0 COMP-3.  02510000
               10  PV-HOLD-DEPT         PIC S9(04)V   VALUE +0 COMP-3.  02520000
               10  PV-HOLD-CLASS        PIC S9(04)V   VALUE +0 COMP-3.  02530000
               10  PV-HOLD-SUBCLASS     PIC S9(04)V   VALUE +0 COMP-3.  02540000
               10  PV-HOLD-SKU-STAT-CDE PIC X(02)  VALUE SPACES.        02550000
               10  PV-HOLD-REGN-PRIC-IND PIC X(01)  VALUE SPACE.        02560000
               10  PV-HOLD-UNT-RTL-AMT  PIC  S9(7)V9(2) VALUE +0        02570000
                                                        COMP-3.         02580000
               10  PV-HOLD-ERR-CDE      PIC X(03)     VALUE SPACES.     02590000
                   88  PV-HOLD-NO-ERRORS           VALUE  '000'.        02600000
           05  PV-SALE-UNT-DIS           PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  02610000
           05  PV-SALE-AMT-DIS        PIC ZZZ,ZZZ,ZZ9.99 VALUE ZEROES.  02620000
           05  PV-ABSOL-EXT-PRC-DIS   PIC ZZZ,ZZZ,ZZ9.99 VALUE ZEROES.  02630000
           05  PV-INPUT-DATE.                                           02640000
               10  PV-INPUT-CENTURY   PIC  9(02)  VALUE ZEROS.          02650000
               10  PV-INPUT-DATE-YYMMDD.                                02660000
                   15  PV-INPUT-YEAR  PIC  9(02)  VALUE ZEROS.          02670000
                   15  PV-INPUT-MONTH PIC  9(02)  VALUE ZEROS.          02680000
                   15  PV-INPUT-DAY   PIC  9(02)  VALUE ZEROS.          02690000
           05  PV-INPUT-DATE-FMT.                                       02700000
               10 PV-INPUT-CC         PIC X(02)   VALUE SPACES.         02710000
               10 PV-INPUT-YY         PIC X(02)   VALUE SPACES.         02720000
               10 FILLER              PIC X(01)   VALUE '-'.            02730000
               10 PV-INPUT-MM         PIC X(02)   VALUE SPACES.         02740000
               10 FILLER              PIC X(01)   VALUE '-'.            02750000
               10 PV-INPUT-DD         PIC X(02)   VALUE SPACES.         02760000
           05  PV-HOLD-INPUT-DATE-FMT.                                  02770000
               10 PV-HOLD-INPUT-CC    PIC X(02)   VALUE SPACES.         02780000
               10 PV-HOLD-INPUT-YY    PIC X(02)   VALUE SPACES.         02790000
               10 FILLER              PIC X(01)   VALUE '-'.            02800000
               10 PV-HOLD-INPUT-MM    PIC X(02)   VALUE SPACES.         02810000
               10 FILLER              PIC X(01)   VALUE '-'.            02820000
               10 PV-HOLD-INPUT-DD         PIC X(02)   VALUE SPACES.    02830000
           05  PV-REFORMAT-DATE.                                        02840000
               10  PV-REFORMAT-MM   PIC  9(02)    VALUE ZEROS.          02850000
               10  PV-REFORMAT-DD   PIC  9(02)    VALUE ZEROS.          02860000
               10  PV-REFORMAT-YY   PIC  9(02)    VALUE ZEROS.          02870000
           05  PV-TOTAL-SALES-QTY        PIC S9(09)    VALUE +0 COMP-3. 02880000
           05  PV-TOTAL-SALES-AMT        PIC S9(09)V99 VALUE +0 COMP-3. 02890000
           05  PV-TRANS-SALES-QTY        PIC S9(09)    VALUE +0 COMP-3. 02900000
           05  PV-TRANS-SALES-AMT        PIC S9(09)V99 VALUE +0 COMP-3. 02910000
           05  PV-ERROR-SALES-QTY        PIC S9(09)    VALUE +0 COMP-3. 02920000
           05  PV-ERROR-SALES-AMT        PIC S9(09)V99 VALUE +0 COMP-3. 02930000
P3540B     05  PV-RECYCLE-SALES-QTY      PIC S9(09)    VALUE +0 COMP-3. 02940000
P3540B     05  PV-RECYCLE-SALES-AMT      PIC S9(09)V99 VALUE +0 COMP-3. 02950000
           05  PV-SALES-CORR-QTY         PIC S9(09)    VALUE +0 COMP-3. 02960000
           05  PV-SALES-CORR-AMT         PIC S9(09)V99 VALUE +0 COMP-3. 02970000
           05  PV-COMMITS-TAKEN          PIC S9(09)    VALUE +0 COMP-3. 02980000
           05  PV-SQL-SUB                PIC S9(4)     VALUE +0 COMP.   02990000
           05  PV-RETURN-CODE            PIC S9(4)     VALUE +0 COMP.   03000000
               88 PV-RETURN-4095-END-DAY-MSG           VALUE +4095.     03010000
               88 PV-RETURN-4094-STOP-MSG              VALUE +4094.     03020000
               88 PV-RETURN-4090-FORCE-END-MSG         VALUE +4090.     03030000
                                                                        03040000
      ******************************************************************03050000
      *    PROGRAM ACCUMULATORS                                         03060000
      ******************************************************************03070000
       01  PA-PROGRAM-ACCUMULATORS.                                     03080000
           05  PA-MQGET                  PIC 9(07)     VALUE 0.         03090000
           05  PA-Q-MESSAGES             PIC 9(07)     VALUE 0.         03100000
           05  PA-SALES                  PIC 9(09)     VALUE 0.         03110000
           05  PA-VOIDS                  PIC 9(07)     VALUE 0.         03120000
           05  PA-LINE-ITM-VOIDS         PIC 9(07)     VALUE 0.         03130000
           05  PV-SALES-INPUT-CNT        PIC S9(09)    VALUE +0 COMP-3. 03140000
           05  PV-NORMAL-SALES-CNT       PIC S9(09)    VALUE +0 COMP-3. 03150000
           05  PV-SALES-CORR-CNT         PIC S9(09)    VALUE +0 COMP-3. 03160000
           05  PV-LATE-CORR-CNT          PIC S9(09)    VALUE +0 COMP-3. 03170000
           05  PV-TSKXREF-SELECT-CNT     PIC S9(09)    VALUE +0 COMP-3. 03180000
           05  PV-TSKXREF-SEL-RENUM-CNT  PIC S9(09)    VALUE +0 COMP-3. 03190000
           05  PV-TSKXREF-ITM-NOT-FND-CNT                               03200000
                                         PIC S9(09)    VALUE +0 COMP-3. 03210000
           05  PV-TSKXREF-RENUM-NOT-FND-CNT                             03220000
                                         PIC S9(09)    VALUE +0 COMP-3. 03230000
           05  PV-TUPCPLS-SEL-CNT        PIC S9(09)    VALUE +0 COMP-3. 03240000
           05  PV-TRN-STAT-A-CNT         PIC S9(09)    VALUE +0 COMP-3. 03250000
           05  PV-TRN-STAT-B-CNT         PIC S9(09)    VALUE +0 COMP-3. 03260000
           05  PV-TRN-STAT-E-CNT         PIC S9(09)    VALUE +0 COMP-3. 03270000
P3540B     05  PV-TRN-STAT-R-CNT         PIC S9(09)    VALUE +0 COMP-3. 03280000
           05  PV-TRN-ERR-004-CNT        PIC S9(09)    VALUE +0 COMP-3. 03290000
           05  PV-TRN-ERR-005-CNT        PIC S9(09)    VALUE +0 COMP-3. 03300000
           05  PV-TRN-ERR-006-CNT        PIC S9(09)    VALUE +0 COMP-3. 03310000
           05  PV-TRN-ERR-020-CNT        PIC S9(09)    VALUE +0 COMP-3. 03320000
           05  PV-TRN-ERR-021-CNT        PIC S9(09)    VALUE +0 COMP-3. 03330000
           05  PV-TRN-ERR-022-CNT        PIC S9(09)    VALUE +0 COMP-3. 03340000
           05  PV-INSERT-CNT             PIC S9(09)    VALUE +0 COMP-3. 03350000
OCFSFS     05  PV-INSERT-ADJ-CNT         PIC S9(09)    VALUE +0 COMP-3. 03360000
           05  PV-RETRY-CNT              PIC S9(04)    VALUE ZERO.      03370000
                                                                        03380000
      *  NOTE: PV-000-SKU-CNT WILL CONTAIN A COUNT OF THOSE SKU'S     * 03390000
      *        FOUND TO END WITH '000' WHICH ARE DUMMY SKU'S.         * 03400000
           05  PV-000-SKU-CNT            PIC S9(9)     VALUE +0         03410000
                                                     COMP-3.            03420000
                                                                        03430000
      *  NOTE: PV-999-SKU-CNT WILL CONTAIN A COUNT OF THOSE SKU'S     * 03440000
      *        FOUND TO END WITH '999' WHICH ARE ALSO DUMMY SKU'S.    * 03450000
           05  PV-999-SKU-CNT            PIC S9(9)     VALUE +0         03460000
                                                     COMP-3.            03470000
      ***************************************************************** 03480000
      *     FORMATTED FIELDS FOR END OF JOB DISPLAY COUNTS.           * 03490000
      ***************************************************************** 03500000
       01  PV-DISPLAY-COUNTS.                                           03510000
           10  PV-SALES-INPUT-CNT-DISP                                  03520000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03530000
           10  PV-NORMAL-SALES-CNT-DISP                                 03540000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03550000
           10  PV-SALES-CORR-CNT-DISP                                   03560000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03570000
           10  PV-LATE-CORR-CNT-DISP                                    03580000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03590000
           10  PV-TOTAL-SALES-QTY-DISP                                  03600000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03610000
           10  PV-TOTAL-SALES-AMT-DISP                                  03620000
                                      PIC ZZZ,ZZZ,ZZ9.99 VALUE ZEROES.  03630000
           10  PV-TRANS-SALES-QTY-DISP                                  03640000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03650000
           10  PV-TRANS-SALES-AMT-DISP                                  03660000
                                      PIC ZZZ,ZZZ,ZZ9.99 VALUE ZEROES.  03670000
           10  PV-ERROR-SALES-QTY-DISP                                  03680000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03690000
           10  PV-ERROR-SALES-AMT-DISP                                  03700000
                                      PIC ZZZ,ZZZ,ZZ9.99 VALUE ZEROES.  03710000
P3540B     10  PV-RECYCLE-SALES-QTY-DISP                                03720000
P3540B                                   PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03730000
P3540B     10  PV-RECYCLE-SALES-AMT-DISP                                03740000
P3540B                                PIC ZZZ,ZZZ,ZZ9.99 VALUE ZEROES.  03750000
           10  PV-SALES-CORR-QTY-DISP                                   03760000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03770000
           10  PV-SALES-CORR-AMT-DISP                                   03780000
                                      PIC ZZZ,ZZZ,ZZ9.99 VALUE ZEROES.  03790000
           10  PV-TSKXREF-SELECT-CNT-DISP                               03800000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03810000
           10  PV-TSKXREF-ITM-NF-DISP    PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03820000
           10  PV-TSKXREF-SEL-RENUM-CNT-DISP                            03830000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03840000
           10  PV-TSKXREF-RENUM-NF-CNT-DISP                             03850000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03860000
           10  PV-TUPCPLS-SEL-CNT-DISP                                  03870000
                                         PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03880000
           10  PV-TRN-STAT-A-CNT-DISP    PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03890000
           10  PV-TRN-STAT-B-CNT-DISP    PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03900000
           10  PV-TRN-STAT-E-CNT-DISP    PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03910000
P3540B     10  PV-TRN-STAT-R-CNT-DISP    PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03920000
           10  PV-TRN-ERR-004-CNT-DISP   PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03930000
           10  PV-TRN-ERR-005-CNT-DISP   PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03940000
           10  PV-TRN-ERR-006-CNT-DISP   PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03950000
           10  PV-TRN-ERR-020-CNT-DISP   PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03960000
           10  PV-TRN-ERR-021-CNT-DISP   PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03970000
           10  PV-TRN-ERR-022-CNT-DISP   PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03980000
           10  PV-INSERT-CNT-DISP        PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  03990000
           10  PV-COMMITS-TAKEN-DISP     PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  04000000
           10  PV-999-SKU-CNT-DISP       PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  04010000
           10  PV-000-SKU-CNT-DISP       PIC ZZZ,ZZZ,ZZ9 VALUE ZEROES.  04020000
                                                                        04030000
      ******************************************************************04040000
      * ERROR HANDLING                                                  04050000
      ******************************************************************04060000
       01  PV-MISC-ABEND-FIELDS.                                        04070000
           05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      04080000
           05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      04090000
           05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      04100000
           05  PV-DB2-OPERATION-ATTEMPTED   PIC X(30) VALUE SPACE.      04110000
           05  PV-COMPLETION-CODE           PIC S9(09) COMP   VALUE +0. 04120000
           05  PV-REASON                    PIC S9(09) COMP   VALUE +0. 04130000
           05  PV-REASON-TEXT               PIC X(70) VALUE SPACES.     04140000
                                                                        04150000
       01  ABEND-CODE                       PIC S9(4) VALUE +0 COMP.    04160000
           88  ABEND-4001-CTRL-CARD-1-ERROR      VALUE +4001.           04170000
           88  ABEND-4002-CTRL-CARD-2-ERROR      VALUE +4002.           04180000
           88  ABEND-4003-CTRL-CARD-3-ERROR      VALUE +4003.           04190000
           88  ABEND-4004-CTRL-CARD-4-ERROR      VALUE +4004.           04200000
           88  ABEND-4020-MQ-ERROR               VALUE +4020.           04210000
                                                                        04220000
      ******************************************************************04230000
      * EM - EMAIL MESSAGE DATA LINES                                   04240000
      ******************************************************************04250000
       01  EM-EMAIL-MESSAGE-DATA-LINES.                                 04260000
           05  EM-DATA-LINE-1           PIC X(80)  VALUE                04270000
                 'HELO KOHLS@KOHLS.COM'.                                04280000
           05  EM-DATA-LINE-2           PIC X(80)  VALUE                04290000
                 'MAIL FROM: <KOHLSBATCHMAIL@KOHLS.COM>'.               04300000
           05  EM-DATA-LINE-3           PIC X(80)  VALUE                04310000
C55777       'RCPT TO: <IT-MERCHANDISE-FINANCIALS-DELIVERY@KOHLS.COM>'. 04320000
           05  EM-DATA-LINE-4           PIC X(80)  VALUE                04330000
                 'DATA'.                                                04340000
           05  EM-DATA-LINE-5           PIC X(80)  VALUE                04350000
C55777           'TO: IT-MERCHANDISE-FINANCIALS-DELIVERY'.              04360000
           05  EM-DATA-LINE-6.                                          04370000
               10  EM-DATA-LINE-6-TXT   PIC X(57)  VALUE                04380000
           'SUBJECT: FSKUP200 MQ MESSAGE HANDLER PROCESSING ISSUES IN'. 04390000
               10  FILLER               PIC X(01)  VALUE SPACES.        04400000
               10  EM-DATA-LINE-6-QM    PIC X(04)  VALUE SPACES.        04410000
               10  FILLER               PIC X(19)  VALUE SPACES.        04420000
           05  EM-DATA-LINE-7           PIC X(80)  VALUE                04430000
                 'REVIEW FSSALES SYSOUT FOR MESSAGE ERRORS'.            04440000
                                                                        04450000
      ******************************************************************04460000
      * MQ WORKING STORAGE                                              04470000
      ******************************************************************04480000
       01  MQV-WORKING-STORAGE.                                         04490000
           05  MQV-MQCONN               PIC  X(08) VALUE 'CSQBCONN'.    04500000
           05  MQV-MQOPEN               PIC  X(08) VALUE 'CSQBOPEN'.    04510000
           05  MQV-MQPUT                PIC  X(08) VALUE 'CSQBPUT '.    04520000
           05  MQV-MQGET                PIC  X(08) VALUE 'CSQBGET '.    04530000
           05  MQV-MQCMIT               PIC  X(08) VALUE 'CSQBCOMM'.    04540000
           05  MQV-MQBACK               PIC  X(08) VALUE 'CSQBBACK'.    04550000
           05  MQV-MQCLOSE              PIC  X(08) VALUE 'CSQBCLOS'.    04560000
           05  MQV-MQDISC               PIC  X(08) VALUE 'CSQBDISC'.    04570000
           05  MQV-MQCHECK              PIC  X(08) VALUE 'MQR2C'.       04580000
           05  MQV-HCONN                PIC S9(09) COMP   VALUE +0.     04590000
           05  MQV-COMPLETION-CODE      PIC S9(09) COMP   VALUE +0.     04600000
           05  MQV-REASON               PIC S9(09) COMP   VALUE +0.     04610000
           05  MQV-OPEN-OPTIONS         PIC S9(09) COMP   VALUE +0.     04620000
           05  MQV-GQ-HANDLE          PIC S9(09) COMP   VALUE +0.       04630000
           05  MQV-ERROR-HANDLE         PIC S9(09) COMP   VALUE +0.     04640000
           05  MQV-MSG-LENGTH           PIC S9(09) COMP   VALUE +0.     04650000
OCFSFS     05  MQV-MSGBUFFER            PIC X(14030) VALUE SPACES.      04660000
           05  MQV-DATA-LENGTH          PIC S9(09) COMP   VALUE +0.     04670000
           05  MQV-REASON-TEXT          PIC  X(30) VALUE SPACES.        04680000
                                                                        04690000
      ******************************************************************04700000
      * CONTROL CARD 1 RECORD LAYOUT - QUEUE MANAGER NAME               04710000
      ******************************************************************04720000
       01  CC-CONTROL-CARD-1-LAYOUT.                                    04730000
           05  CC-QUEUE-MANAGER-NAME    PIC X(48) VALUE SPACES.         04740000
           05  FILLER                   PIC X(32) VALUE SPACES.         04750000
                                                                        04760000
      ******************************************************************04770000
      * CONTROL CARD 2 RECORD LAYOUT - SALES QUEUE NAME                 04780000
      ******************************************************************04790000
       01  CC-CONTROL-CARD-2-LAYOUT.                                    04800000
           05  CC-SALES-QUEUE-NAME      PIC X(48) VALUE SPACES.         04810000
           05  FILLER                   PIC X(32) VALUE SPACES.         04820000
                                                                        04830000
      ******************************************************************04840000
      * CONTROL CARD 3 RECORD LAYOUT - PROCESS DATE                     04850000
      ******************************************************************04860000
       01  CC-CONTROL-CARD-3-LAYOUT.                                    04870000
           05  CC-PROCESS-DATE           PIC  X(10).                    04880000
           05  FILLER                    PIC  X(70) VALUE SPACES.       04890000
                                                                        04900000
C68071******************************************************************04901007
C68071* CONTROL CARD 4 RECORD LAYOUT - ERROR MESSAGE                    04902007
C68071******************************************************************04903007
C68071 01  CC-CONTROL-CARD-4-LAYOUT.                                    04904007
C68071     05  CC-LIMIT                  PIC  9(05) VALUE ZEROS.        04905007
C68071     05  FILLER                    PIC  X(01) VALUE SPACES.       04906007
C68071     05  CC-FILE-NAME              PIC  X(21).                    04906107
C68071     05  FILLER                    PIC  X(53) VALUE SPACES.       04906207
C68071                                                                  04907007
      ******************************************************************04910000
      * RECORD LAYOUT FOR BACKUP OF TRANSACTION                         04920000
      ******************************************************************04930000
           05  PV-SALES-RECORD.                                         04940000
              10  PV-SALES-HEADER          PIC X(30).                   04950000
              10  PV-DETAIL-ITEM-ENTRY     PIC X(35).                   04960000
      ******************************************************************04970000
      *  SALES TRANSACTION RECORD LAYOUT                                04980000
      ******************************************************************04990000
           COPY FSRD053.                                                05000000
                                                                        05010000
      ******************************************************************05020000
      * DATE ROUTINE COPY MEMBERS                                       05030000
      ******************************************************************05040000
           COPY DPWS500.                                                05050000
                                                                        05060000
      ******************************************************************05070000
      *  PARAMETER LIST FOR THE DYNAMIC ALLOCATION ROUTINE              05080000
      ******************************************************************05090000
           COPY DPWS023.                                                05100000
                                                                        05110000
      ******************************************************************05120000
      * VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         05130000
      ******************************************************************05140000
           COPY DPWS004.                                                05150000
                                                                        05160000
      ******************************************************************05170000
      * DB2 ABEND COPYBOOK                                              05180000
      ******************************************************************05190000
           COPY DPWS900.                                                05200000
                                                                        05210000
      ******************************************************************05220000
      * DB2 MESSAGE AREA                                                05230000
      ******************************************************************05240000
           COPY SQLCA2.                                                 05250000
                                                                        05260000
      ******************************************************************05270000
      * OBJECT-DESCRIPTOR - MQ SERIES                                   05280000
      ******************************************************************05290000
       01  MQM-OBJECT-DESCRIPTOR.                                       05300000
           COPY CMQODV.                                                 05310000
                                                                        05320000
      ******************************************************************05330000
      * MESSAGE-DESCRIPTOR - MQ SERIES                                  05340000
      ******************************************************************05350000
       01  MQM-MESSAGE-DESCRIPTOR.                                      05360000
           COPY CMQMDV.                                                 05370000
                                                                        05380000
      ******************************************************************05390000
      * GET-MESSAGE-OPTIONS - MQ SERIES                                 05400000
      ******************************************************************05410000
       01  MQM-GET-MESSAGE-OPTIONS.                                     05420000
           COPY CMQGMOV.                                                05430000
                                                                        05440000
      ******************************************************************05450000
      * PUT-MESSAGE-OPTIONS - MQ SERIES                                 05460000
      ******************************************************************05470000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     05480000
           COPY CMQPMOV.                                                05490000
                                                                        05500000
      ******************************************************************05510000
      * CONSTANTS - MQ SERIES                                           05520000
      ******************************************************************05530000
       01  MQM-CONSTANTS.                                               05540000
           COPY CMQV.                                                   05550000
                                                                        05560000
      ******************************************************************05570000
      * DB2 COMMUNICATIONS AREA                                         05580000
      ******************************************************************05590000
           EXEC SQL                                                     05600000
                INCLUDE SQLCA                                           05610000
           END-EXEC.                                                    05620000
                                                                        05630000
      ******************************************************************05640000
      *  DCLGEN MEMBER FOR TABLE XMT_LOC (LOCATION TABLE)               05650000
      *  THIS IS A MERCHANDISING DOMAIN REPLICATED TABLE.               05660000
      ******************************************************************05670000
           EXEC SQL                                                     05680000
               INCLUDE XMT00001                                         05690000
           END-EXEC.                                                    05700000
                                                                        05710000
      ******************************************************************05720000
      *  DCLGEN MEMBER FOR TABLE TSKXREF (CROSS REFERENCE TABLE)        05730000
      ******************************************************************05740000
           EXEC SQL                                                     05750000
               INCLUDE TSKXREF                                          05760000
           END-EXEC.                                                    05770000
                                                                        05780000
      ******************************************************************05790000
      *  DCLGEN MEMBER FOR TABLE TUPC                                   05800000
      ******************************************************************05810000
           EXEC SQL                                                     05820000
               INCLUDE TUPC                                             05830000
           END-EXEC.                                                    05840000
                                                                        05850000
      ******************************************************************05860000
      *  DCLGEN MEMBER FOR TABLE TUPCPLS                                05870000
      ******************************************************************05880000
           EXEC SQL                                                     05890000
               INCLUDE TUPCPLS                                          05900000
           END-EXEC.                                                    05910000
                                                                        05920000
      ******************************************************************05930000
      *  DCLGEN FOR CHECKPOINT RESTART CONTROL TABLE                    05940000
      ******************************************************************05950000
           EXEC SQL                                                     05960000
               INCLUDE TCKRSTCN                                         05970000
           END-EXEC.                                                    05980000
                                                                        05990000
      ******************************************************************06000000
      *  DCLGEN MEMBER FOR TABLE FSTT_OH_ADJ_AUD                        06010000
      *  (FASHION SALES ON-HAND ADJUSTMENT AUDIT WORK TABLE)            06020000
      ******************************************************************06030000
           EXEC SQL                                                     06040000
               INCLUDE FST00003                                         06050000
           END-EXEC.                                                    06060000
                                                                        06070000
      ******************************************************************06080000
      *  DCLGEN MEMBER FOR TABLE FSTT_OH_SLS_AUD                        06090000
      *  (FASHION SALES ON-HAND SALES AUDIT WORK TABLE)                 06100000
      ******************************************************************06110000
           EXEC SQL                                                     06120000
               INCLUDE FST00005                                         06130000
           END-EXEC.                                                    06140000
                                                                        06150000
      ***************************************************************** 06160000
      *     VALID LOCATION TABLE                                      * 06170000
      ***************************************************************** 06180000
       01  LOCATION-TABLE-INFO.                                         06190000
           10  TABLE-MAX.                                               06200000
               15  LOC-TABLE-MAX         PIC 9(5)       VALUE 5000.     06210000
                                                                        06220000
           10  LOCATION-TABLE.                                          06230000
               15  LOCATION-TBL-SIZE     PIC 9(5)       VALUE ZEROES.   06240000
               15  LOCATION-ENTRY        OCCURS 5000 TIMES              06250000
                                         INDEXED BY LOC-INDEX.          06260000
                   20  LOC-NBR           PIC S9(04) COMP.               06270000
                                                                        06280000
       01  FILLER                        PIC X(1)       VALUE SPACES.   06290000
                                                                        06300000
      ******************************************************************06310000
      *  DECLARE SQL STATEMENT FOR RETRIEVING STORES FROM THE           06320000
      *  LOCATION TABLE.                                                06330000
      ******************************************************************06340000
           EXEC SQL                                                     06350000
               DECLARE LOC_CSR CURSOR FOR                               06360000
                SELECT A.LOC_NBR                                        06370000
                  FROM XMT_LOC A                                        06380000
                 WHERE A.LOC_TYP_CDE IN ('DS', 'HQ')                    06390000
                ORDER BY A.LOC_NBR                                      06400000
                WITH UR                                                 06410000
           END-EXEC.                                                    06420000
      *                                                                 06430000
      ******************************************************************06440000
       PROCEDURE DIVISION.                                              06450000
      ******************************************************************06460000
       0000-MAINLINE.                                                   06470000
                                                                        06480000
           PERFORM 1000-INITIALIZATION.                                 06490000
                                                                        06500000
           PERFORM 2000-PROCESS-MQ-MESSAGES                             06510000
                 UNTIL PS-END-OF-TASK.                                  06520000
      *            OR (NOT PS-MQGET-SUCCESSFUL).                        06530000
                                                                        06540000
           PERFORM 9000-WRAPUP.                                         06550000
           GOBACK.                                                      06560000
                                                                        06570000
      ******************************************************************06580000
      * 1000-INITIALIZATION.                                            06590000
      *     INITIALIZATION AREA - GETS THE CURRENT DATE, INITIALIZES    06600000
      *     PROGRAM COUNTERS, READS CONTROL CARDS, CALCULATES THE       06610000
      *     CRITICAL DATE AND SETS UP QUEUES FOR PROCESSING.            06620000
      ******************************************************************06630000
       1000-INITIALIZATION.                                             06640000
                                                                        06650000
           INITIALIZE PA-PROGRAM-ACCUMULATORS                           06660000
                      DCLTCKRSTCNTL.                                    06670000
                                                                        06680000
           OPEN INPUT  CONTROL-CARD-1                                   06690000
                       CONTROL-CARD-2                                   06700000
                       CONTROL-CARD-3                                   06710000
C68071                 CONTROL-CARD-4                                   06711007
                OUTPUT MESSAGE-LOG                                      06720000
P3540B                 RECYCLE-MSG-FILE.                                06730004
                                                                        06740000
           PERFORM 1010-READ-CONTROL-CARD-1.                            06750000
           PERFORM 1020-READ-CONTROL-CARD-2.                            06760000
           PERFORM 1030-READ-CONTROL-CARD-3.                            06770000
C68071     PERFORM 1040-READ-CONTROL-CARD-4.                            06771007
           PERFORM 7000-INIT-CHECKPOINT-SELECT.                         06780000
           PERFORM 2540-COMMIT-DATA.                                    06790000
           PERFORM 7100-GET-COMMIT-TIMESTAMP.                           06800000
                                                                        06810000
           PERFORM 1100-CONNECT-TO-QMGR.                                06820000
           PERFORM 1200-OPEN-SALES-QUEUE.                               06830000
           PERFORM 1300-CALL-CALENDAR-ROUTINE.                          06840000
           PERFORM 1400-LOAD-LOCATION-TBL.                              06850000
                                                                        06860000
           DISPLAY ' '.                                                 06870000
           DISPLAY '*********************************************'.     06880000
           DISPLAY 'FSKUP200 PROCESSING MESSAGES'.                      06890000
           DISPLAY '*********************************************'.     06900000
                                                                        06910000
           PERFORM 6000-RETRIEVE-MESSAGE                                06920000
               WITH TEST AFTER                                          06930000
               UNTIL PS-MESSAGE-RECEIVED.                               06940000
                                                                        06950000
                                                                        06960000
      ******************************************************************06970000
      * 1100-CONNECT-TO-QMGR.                                           06980000
      *     CONNECT TO THE QUEUE MANAGER.                               06990000
      ******************************************************************07000000
       1100-CONNECT-TO-QMGR.                                            07010000
                                                                        07020000
      *    CONNECT TO THE QUEUE MANAGER                                 07030000
                                                                        07040000
           CALL MQV-MQCONN USING CC-QUEUE-MANAGER-NAME                  07050000
                                 MQV-HCONN                              07060000
                                 MQV-COMPLETION-CODE                    07070000
                                 MQV-REASON.                            07080000
                                                                        07090000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              07100000
      *    AND EXIT                                                     07110000
                                                                        07120000
           EVALUATE TRUE                                                07130000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        07140000
                   DISPLAY ' '                                          07150000
                   DISPLAY 'SUCCESSFULLY CONNECTED TO: '                07160000
                                                  CC-QUEUE-MANAGER-NAME 07170000
              WHEN OTHER                                                07180000
                   CALL MQV-MQCHECK USING MQV-REASON                    07190000
                                          MQV-REASON-TEXT               07200000
                   DISPLAY 'QUEUE CONNECTING TO ' CC-QUEUE-MANAGER-NAME 07210000
                   MOVE '1100-CONNECT-TO-QMGR' TO PV-PARAGRAPH-NAME     07220000
                   MOVE 'UNABLE TO CONNECT'  TO PV-OPERATION-MSG-1      07230000
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    07240000
                   MOVE MQV-REASON             TO PV-REASON             07250000
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        07260000
                   PERFORM 2900-SEND-ALERT                              07270000
                   PERFORM 9400-MQ-ABEND                                07280000
           END-EVALUATE.                                                07290000
                                                                        07300000
      ******************************************************************07310000
      * 1200-OPEN-SALES-QUEUE.                                          07320000
      *     OPEN THE SALES QUEUE.                                       07330000
      ******************************************************************07340000
       1200-OPEN-SALES-QUEUE.                                           07350000
                                                                        07360000
           MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            07370000
           MOVE CC-SALES-QUEUE-NAME      TO MQOD-OBJECTNAME             07380000
           MOVE CC-QUEUE-MANAGER-NAME    TO MQOD-OBJECTQMGRNAME.        07390000
                                                                        07400000
           COMPUTE MQV-OPEN-OPTIONS      = MQOO-INPUT-SHARED            07410000
                                         + MQOO-FAIL-IF-QUIESCING.      07420000
                                                                        07430000
           CALL MQV-MQOPEN USING MQV-HCONN                              07440000
                                 MQM-OBJECT-DESCRIPTOR                  07450000
                                 MQV-OPEN-OPTIONS                       07460000
                                 MQV-GQ-HANDLE                          07470000
                                 MQV-COMPLETION-CODE                    07480000
                                 MQV-REASON.                            07490000
                                                                        07500000
           EVALUATE TRUE                                                07510000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        07520000
                   DISPLAY 'SUCCESSFULLY OPENED QUEUE: '                07530000
                                                 CC-SALES-QUEUE-NAME    07540000
              WHEN OTHER                                                07550000
                   CALL MQV-MQCHECK USING MQV-REASON                    07560000
                                         MQV-REASON-TEXT                07570000
                   DISPLAY 'CANNOT OPEN QUEUE ' CC-SALES-QUEUE-NAME     07580000
                   MOVE '1200-OPEN-SALES-QUEUE' TO PV-PARAGRAPH-NAME    07590000
                   MOVE 'CANNOT OPEN QUEUE'  TO PV-OPERATION-MSG-1      07600000
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    07610000
                   MOVE MQV-REASON             TO PV-REASON             07620000
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        07630000
                   PERFORM 2900-SEND-ALERT                              07640000
                   PERFORM 9200-DISCONNECT-QMGR                         07650000
                   PERFORM 9400-MQ-ABEND                                07660000
           END-EVALUATE.                                                07670000
                                                                        07680000
      ******************************************************************07690000
      * 1300-CALL-CALENDAR-ROUTINE.                                     07700000
      *     CALL DP500-KOHLS-CALENDAR-ROUTINE TO GET ACTNG-VARIABLES    07710000
      ******************************************************************07720000
       1300-CALL-CALENDAR-ROUTINE.                                      07730000
                                                                        07740000
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56               07750000
           SET DPG51-FISCAL-JAN-DEC-F2                                  07760000
               DPG51-DO-NOT-INCR-DECR-DATE                              07770000
               DPG52-LK-DTE-ISO-FMT        TO TRUE                      07780000
           MOVE CC-PROCESS-DATE TO DPG52-LK-DATE-INPUT                  07790000
                                                                        07800000
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            07810000
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                07820000
                                                                        07830000
           IF DPG54-DATE-INVALID                                        07840000
               DISPLAY '** ABEND ** IN FSKUP200'                        07850000
               DISPLAY '** PARAGRAPH: 1300-CALL-CALENDAR-ROUTINE.'      07860000
               DISPLAY '** INVALID CURRENT DATE.'                       07870000
               DISPLAY '** CALENDAR ROUTINE ERROR MESSAGE = '           07880000
                           DPG54-ERROR-MESSAGE                          07890000
               DISPLAY '** DPG51 = ' DPG51                              07900000
               DISPLAY '** DPG52 = ' DPG52                              07910000
               DISPLAY '** DPG53 = ' DPG53                              07920000
               DISPLAY '** DPG54 = ' DPG54                              07930000
               DISPLAY '** DPG55 = ' DPG55                              07940000
               DISPLAY '** DPG56 = ' DPG56                              07950000
               MOVE +4003 TO ABEND-CODE                                 07960000
               CALL 'ILBOABN0' USING ABEND-CODE                         07970000
           ELSE                                                         07980000
               IF DPG54-SEVERE-ERROR                                    07990000
                   DISPLAY '** ABEND ** IN FSKUP200'                    08000000
                   DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE.'   08010000
                   DISPLAY '** CALLED BY 1300-CALL-CALENDAR-ROUTINE.'   08020000
                   DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE    08030000
                   DISPLAY '** DPG51 = ' DPG51                          08040000
                   DISPLAY '** DPG52 = ' DPG52                          08050000
                   DISPLAY '** DPG53 = ' DPG53                          08060000
                   DISPLAY '** DPG54 = ' DPG54                          08070000
                   DISPLAY '** DPG55 = ' DPG55                          08080000
                   DISPLAY '** DPG56 = ' DPG56                          08090000
                   MOVE +4003 TO ABEND-CODE                             08100000
                   CALL 'ILBOABN0' USING ABEND-CODE                     08110000
               ELSE                                                     08120000
                   IF DPG54-WARNING-ERROR                               08130000
                       DISPLAY                                          08140000
                             '** WARNING RETURNED BY CALENDAR ROUTINE.' 08150000
                       DISPLAY                                          08160000
                             '** CALLED BY 1300-CALL-CALENDAR-ROUTINE.' 08170000
                       DISPLAY                                          08180000
                             '** WARNING MESSAGE = ' DPG54-ERROR-MESSAGE08190000
                   END-IF                                               08200000
               END-IF                                                   08210000
           END-IF                                                       08220000
                                                                        08230000
           MOVE DPG55-DB2-ISO-DATE-FMT    TO  PV-PROCESS-DATE-FMT       08240000
           MOVE DPG55-DB2-ISO-DATE        TO  PV-PROCESS-DATE           08250000
           MOVE PV-PROCESS-DATE-FMT       TO  PV-PROCESS-DATE-FMT-X     08260000
           MOVE PV-PROCESS-YEAR-FMT       TO  PV-PROCESS-TMST-YEAR      08270000
           MOVE PV-PROCESS-MONTH-FMT      TO  PV-PROCESS-TMST-MONTH     08280000
           MOVE PV-PROCESS-DAY-FMT        TO  PV-PROCESS-TMST-DAY       08290000
           MOVE PV-PROCESS-TMST-X         TO  PV-PROCESS-TMST           08300000
           MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO  PV-ACTG-BOW-DATE          08310000
           MOVE DPG56-FISCAL-YEAR-NBR     TO  PV-ACTG-YY                08320000
           IF PV-ACTG-YY    > '80'                                      08330000
              MOVE 19 TO PV-ACTG-CC                                     08340000
           ELSE                                                         08350000
              MOVE 20 TO PV-ACTG-CC                                     08360000
           END-IF                                                       08370000
           MOVE PV-ACTG-YEAR              TO  PV-ACTG-YEAR-9            08380000
           MOVE PV-ACTG-YEAR-9            TO  PV-ACTG-YEAR-C3           08390000
                                                                        08400000
           MOVE DPG56-FISCAL-PERIOD-NBR   TO  PV-ACTG-MONTH             08410000
           MOVE PV-ACTG-MONTH             TO  PV-ACTG-MONTH-9           08420000
           MOVE PV-ACTG-MONTH-9           TO  PV-ACTG-MONTH-C3          08430000
                                                                        08440000
           DISPLAY '** FSKUP200 BOW DATE    : ' PV-ACTG-BOW-DATE        08450000
           DISPLAY '** FSKUP200 ACTG YEAR   : ' PV-ACTG-YEAR            08460000
           DISPLAY '** FSKUP200 ACTG MONTH  : ' PV-ACTG-MONTH.          08470000
                                                                        08480000
P3540B     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56               08490000
P3540B     SET DPG51-FISCAL-JAN-DEC-F2                                  08500000
P3540B         DPG51-INCREMENT-DATE                                     08510000
P3540B         DPG52-LK-DTE-ISO-FMT        TO TRUE                      08520000
P3540B     MOVE 1                          TO DPG51-INCR-DECR-DAYS-9    08530000
P3540B     MOVE CC-PROCESS-DATE TO DPG52-LK-DATE-INPUT                  08540000
P3540B                                                                  08550000
P3540B     CALL DP500-KOHLS-CALENDAR-ROUTINE                            08560000
P3540B         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                08570000
P3540B                                                                  08580000
P3540B     IF DPG54-DATE-INVALID                                        08590000
P3540B         DISPLAY '** ABEND ** IN FSKUP200'                        08600000
P3540B         DISPLAY '** PARAGRAPH: 1300-CALL-CALENDAR-ROUTINE.'      08610000
P3540B         DISPLAY '** INVALID CURRENT DATE, GETTING NEXT DAY DATE.'08620000
P3540B         DISPLAY '** CALENDAR ROUTINE ERROR MESSAGE = '           08630000
P3540B                     DPG54-ERROR-MESSAGE                          08640000
P3540B         DISPLAY '** DPG51 = ' DPG51                              08650000
P3540B         DISPLAY '** DPG52 = ' DPG52                              08660000
P3540B         DISPLAY '** DPG53 = ' DPG53                              08670000
P3540B         DISPLAY '** DPG54 = ' DPG54                              08680000
P3540B         DISPLAY '** DPG55 = ' DPG55                              08690000
P3540B         DISPLAY '** DPG56 = ' DPG56                              08700000
P3540B         MOVE +4003 TO ABEND-CODE                                 08710000
P3540B         CALL 'ILBOABN0' USING ABEND-CODE                         08720000
P3540B     ELSE                                                         08730000
P3540B         IF DPG54-SEVERE-ERROR                                    08740000
P3540B             DISPLAY '** ABEND ** IN FSKUP200'                    08750000
P3540B             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE,'   08760000
P3540B             DISPLAY '** GETTING NEXT DAY DATE.'                  08770000
P3540B             DISPLAY '** CALLED BY 1300-CALL-CALENDAR-ROUTINE.'   08780000
P3540B             DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE    08790000
P3540B             DISPLAY '** DPG51 = ' DPG51                          08800000
P3540B             DISPLAY '** DPG52 = ' DPG52                          08810000
P3540B             DISPLAY '** DPG53 = ' DPG53                          08820000
P3540B             DISPLAY '** DPG54 = ' DPG54                          08830000
P3540B             DISPLAY '** DPG55 = ' DPG55                          08840000
P3540B             DISPLAY '** DPG56 = ' DPG56                          08850000
P3540B             MOVE +4003 TO ABEND-CODE                             08860000
P3540B             CALL 'ILBOABN0' USING ABEND-CODE                     08870000
P3540B         ELSE                                                     08880000
P3540B             IF DPG54-WARNING-ERROR                               08890000
P3540B                 DISPLAY                                          08900000
P3540B                       '** WARNING RETURNED BY CALENDAR ROUTINE,' 08910000
P3540B                 DISPLAY                                          08920000
P3540B                       '** GETTING NEXT DAY DATE.'                08930000
P3540B                 DISPLAY                                          08940000
P3540B                       '** CALLED BY 1300-CALL-CALENDAR-ROUTINE.' 08950000
P3540B                 DISPLAY                                          08960000
P3540B                       '** WARNING MESSAGE = ' DPG54-ERROR-MESSAGE08970000
P3540B             END-IF                                               08980000
P3540B         END-IF                                                   08990000
P3540B     END-IF                                                       09000000
P3540B                                                                  09010000
P3540B     MOVE DPG55-DB2-ISO-DATE        TO  PV-NEXT-DAY-DATE.         09020000
P3540B                                                                  09030000
      ******************************************************************09040000
      *  LOAD WORKING-STORAGE LOCATION TABLE WITH VALID LOCATIONS.      09050000
      ******************************************************************09060000
       1400-LOAD-LOCATION-TBL.                                          09070000
                                                                        09080000
           MOVE '1400-LOAD-LOCATION-TBL' TO PV-PARAGRAPH-NAME.          09090000
           EXEC SQL                                                     09100000
               OPEN LOC_CSR                                             09110000
           END-EXEC.                                                    09120000
                                                                        09130000
           EVALUATE SQLCODE                                             09140000
              WHEN +0                                                   09150000
                CONTINUE                                                09160000
              WHEN OTHER                                                09170000
                MOVE 'OPEN LOCATION CURSOR' TO                          09180000
                    PV-DB2-OPERATION-ATTEMPTED                          09190000
                PERFORM 2800-ROLLBACK-DATA                              09200000
                PERFORM 2900-SEND-ALERT                                 09210000
                PERFORM 3100-BACK-OUT-MQV-CHANGES                       09220000
                PERFORM 9100-CLOSE-QUEUES                               09230000
                PERFORM 9200-DISCONNECT-QMGR                            09240000
                PERFORM 9999-SQL-ABEND                                  09250000
           END-EVALUATE.                                                09260000
                                                                        09270000
           MOVE ZERO TO LOCATION-TBL-SIZE.                              09280000
           MOVE 'N' TO PS-END-OF-CSR-SW.                                09290000
           PERFORM 1401-FETCH-LOC-CSR.                                  09300000
                                                                        09310000
           PERFORM VARYING LOC-INDEX FROM 1 BY 1                        09320000
                             UNTIL LOC-INDEX > LOC-TABLE-MAX            09330000
                                OR PS-END-OF-CSR                        09340000
             MOVE XMT00001-LOC-NBR      TO LOC-NBR(LOC-INDEX)           09350000
             ADD 1 TO LOCATION-TBL-SIZE                                 09360000
             PERFORM 1401-FETCH-LOC-CSR                                 09370000
           END-PERFORM.                                                 09380000
                                                                        09390000
           IF LOC-INDEX >  LOC-TABLE-MAX                                09400000
             DISPLAY '*********** ABEND ************************'       09410000
             DISPLAY ' TABLE OVERFLOW ON LOCATION-TABLE         '       09420000
             DISPLAY ' INCREASE LOC-TABLE-MAX LIMIT             '       09430000
             DISPLAY ' CURRENT LIMIT = ' LOC-TABLE-MAX                  09440000
             DISPLAY '******************************************'       09450000
             DISPLAY '  '                                               09460000
             MOVE +4004 TO ABEND-CODE                                   09470000
             CALL 'ILBOABN0' USING ABEND-CODE                           09480000
           END-IF.                                                      09490000
                                                                        09500000
           EXEC SQL                                                     09510000
               CLOSE LOC_CSR                                            09520000
           END-EXEC.                                                    09530000
                                                                        09540000
           EVALUATE SQLCODE                                             09550000
              WHEN +0                                                   09560000
                CONTINUE                                                09570000
              WHEN OTHER                                                09580000
                MOVE 'CLOSE LOCATION CURSOR' TO                         09590000
                    PV-DB2-OPERATION-ATTEMPTED                          09600000
                PERFORM 2800-ROLLBACK-DATA                              09610000
                PERFORM 2900-SEND-ALERT                                 09620000
                PERFORM 3100-BACK-OUT-MQV-CHANGES                       09630000
                PERFORM 9100-CLOSE-QUEUES                               09640000
                PERFORM 9200-DISCONNECT-QMGR                            09650000
                PERFORM 9999-SQL-ABEND                                  09660000
           END-EVALUATE.                                                09670000
                                                                        09680000
                                                                        09690000
      ******************************************************************09700000
      *  FETCH ALL LOCATIONS.                                           09710000
      ******************************************************************09720000
       1401-FETCH-LOC-CSR.                                              09730000
                                                                        09740000
           MOVE '1401-FETCH-LOC-CSR' TO PV-PARAGRAPH-NAME.              09750000
                                                                        09760000
           EXEC SQL                                                     09770000
               FETCH LOC_CSR                                            09780000
               INTO :XMT00001-LOC-NBR                                   09790000
           END-EXEC.                                                    09800000
                                                                        09810000
           EVALUATE SQLCODE                                             09820000
             WHEN +0                                                    09830000
                   CONTINUE                                             09840000
             WHEN +100                                                  09850000
                   SET PS-END-OF-CSR TO TRUE                            09860000
             WHEN OTHER                                                 09870000
                   MOVE 'FETCH LOCATION CURSOR' TO                      09880000
                        PV-DB2-OPERATION-ATTEMPTED                      09890000
                   PERFORM 2800-ROLLBACK-DATA                           09900000
                   PERFORM 2900-SEND-ALERT                              09910000
                   PERFORM 3100-BACK-OUT-MQV-CHANGES                    09920000
                   PERFORM 9100-CLOSE-QUEUES                            09930000
                   PERFORM 9200-DISCONNECT-QMGR                         09940000
                   PERFORM 9999-SQL-ABEND                               09950000
           END-EVALUATE.                                                09960000
                                                                        09970000
      ******************************************************************09980000
      * 1010-READ-CONTROL-CARD-1.                                       09990000
      *     READ CONTROL CARD 1.  THIS GETS THE QUEUE MANAGER NAME.     10000000
      ******************************************************************10010000
       1010-READ-CONTROL-CARD-1.                                        10020000
                                                                        10030000
           READ CONTROL-CARD-1 INTO CC-CONTROL-CARD-1-LAYOUT            10040000
               AT END                                                   10050000
                   MOVE '1010-READ-CONTROL-CARD-1' TO PV-PARAGRAPH-NAME 10060000
                   MOVE 'QUEUE MANANGER NAME CONTROL CARD EMPTY'        10070000
                                                   TO PV-OPERATION-MSG-110080000
                   SET ABEND-4001-CTRL-CARD-1-ERROR TO TRUE             10090000
                   PERFORM 2900-SEND-ALERT                              10100000
                   PERFORM 9300-ABEND                                   10110000
               NOT AT END                                               10120000
                   DISPLAY 'CONTROL CARD 1 (QUEUE MANANGER NAME): '     10130000
                           CC-QUEUE-MANAGER-NAME                        10140000
                   MOVE CC-QUEUE-MANAGER-NAME TO EM-DATA-LINE-6-QM      10150000
           END-READ.                                                    10160000
                                                                        10170000
      ******************************************************************10180000
      * 1020-READ-CONTROL-CARD-2.                                       10190000
      *     READ CONTROL CARD 2.  THIS GETS THE SALES QUEUE             10200000
      *     NAME.                                                       10210000
      ******************************************************************10220000
       1020-READ-CONTROL-CARD-2.                                        10230000
                                                                        10240000
           READ CONTROL-CARD-2 INTO CC-CONTROL-CARD-2-LAYOUT            10250000
               AT END                                                   10260000
                   MOVE '1020-READ-CONTROL-CARD-2' TO PV-PARAGRAPH-NAME 10270000
                   MOVE 'SALES QUEUE CONTROL CARD EMPTY'                10280000
                                                   TO PV-OPERATION-MSG-110290000
                   SET ABEND-4002-CTRL-CARD-2-ERROR TO TRUE             10300000
                   PERFORM 2900-SEND-ALERT                              10310000
                   PERFORM 9300-ABEND                                   10320000
               NOT AT END                                               10330000
                   DISPLAY 'CONTROL CARD 2 (SALES QUEUE NAME):'         10340000
                           ' ' CC-SALES-QUEUE-NAME                      10350000
           END-READ.                                                    10360000
                                                                        10370000
      ******************************************************************10380000
      * 1030-READ-CONTROL-CARD-3.                                       10390000
      *     READ CONTROL CARD 3.  THIS GETS THE PROCESS DATE.           10400000
      ******************************************************************10410000
       1030-READ-CONTROL-CARD-3.                                        10420000
                                                                        10430000
           READ CONTROL-CARD-3 INTO CC-CONTROL-CARD-3-LAYOUT            10440000
               AT END                                                   10450000
                   MOVE '1030-READ-CONTROL-CARD-3' TO PV-PARAGRAPH-NAME 10460000
                   MOVE 'PROCESS DATE CONTROL CARD EMPTY'               10470000
                                                   TO PV-OPERATION-MSG-110480000
                   SET ABEND-4003-CTRL-CARD-3-ERROR TO TRUE             10490000
                   PERFORM 2900-SEND-ALERT                              10500000
                   PERFORM 9300-ABEND                                   10510000
               NOT AT END                                               10520000
                   DISPLAY 'CONTROL CARD 3 (PROCESS DATE): '            10530000
                           CC-PROCESS-DATE                              10540000
           END-READ.                                                    10550000
                                                                        10560000
C68071******************************************************************10561007
C68071* 1040-READ-CONTROL-CARD-4.                                       10562007
C68071*     READ CONTROL CARD 4.  THIS GETS THE ERROR FILE DETAILS.     10563007
C68071******************************************************************10564007
C68071 1040-READ-CONTROL-CARD-4.                                        10565007
C68071                                                                  10566007
C68071     READ CONTROL-CARD-4 INTO CC-CONTROL-CARD-4-LAYOUT            10567007
C68071         AT END                                                   10568007
C68071             MOVE '1040-READ-CONTROL-CARD-4' TO PV-PARAGRAPH-NAME 10569007
C68071             MOVE 'ERROR FILE CONTROL CARD EMPTY'                 10569107
C68071                                             TO PV-OPERATION-MSG-110569207
C68071             SET ABEND-4003-CTRL-CARD-3-ERROR TO TRUE             10569307
C68071             PERFORM 2900-SEND-ALERT                              10569407
C68071             PERFORM 9300-ABEND                                   10569507
C68071     END-READ.                                                    10569907
C68071                                                                  10570007
      ******************************************************************10571000
      *  COMPUCE THE NUMBER OF SKU/STORE DETAIL ITEMS THAT EACH MESSAGE*10580000
      *  CONTAINS.  THE MAX CURRENTLY IS 200 ITEMS PER MQ MESSAGE.     *10590000
      *  IF A REMAINDER EXISTS, THE MQ MESSAGE HAS AN INVALID LENGTH - *10600000
      *  WE CANNOT BE SURE THE SALES DATA IS VALID - THE PROGRAM WILL  *10610000
      *  ABEND.                                                        *10620000
      ******************************************************************10630000
       2050-COMPUTE-DETAIL-LENGTH.                                      10640000
                                                                        10650000
           COMPUTE PV-ARRAY-LENGTH =                                    10660000
                      MQV-DATA-LENGTH - PC-HEADER-LENGTH.               10670000
           DIVIDE  PV-ARRAY-LENGTH  BY  PC-DET-ITEM-LENGTH              10680000
               GIVING  PV-DET-ITEMS-COUNT                               10690000
                  REMAINDER  PV-REMAINDER.                              10700000
                                                                        10710000
           IF PV-REMAINDER > ZERO                                       10720000
C68071        ADD 1 TO PV-COUNTER                                       10721007
C68071        PERFORM 2910-OPEN-ERROR-FILE                              10723007
C68071        WRITE ERROR-MSG-FILE-RECORD FROM F053-SALES-RECORD        10723107
C68071        IF PV-COUNTER > CC-LIMIT                                  10724007
                 MOVE '2050-COMPUTE-DETAIL-LENGTH' TO PV-PARAGRAPH-NAME 10730000
                 MOVE 'REMAINDER IN COMPUTED ARRAY LENGTH NOT ALLOWED'  10740000
                           TO PV-REASON-TEXT                            10750000
C68071           CLOSE ERROR-MSG-FILE                                   10761007
                 PERFORM 3100-BACK-OUT-MQV-CHANGES                      10770000
                 PERFORM 9100-CLOSE-QUEUES                              10780000
                 PERFORM 9200-DISCONNECT-QMGR                           10790000
                 PERFORM 9400-MQ-ABEND                                  10800000
C68071        ELSE                                                      10801007
C68071           GO TO 6000-RETRIEVE-MESSAGE                            10802007
C68071        END-IF                                                    10803007
           END-IF.                                                      10810000
                                                                        10820000
      ***************************************************************** 10830000
      *  PROCESS MQ MESSAGES.                                           10840000
      ***************************************************************** 10850000
       2000-PROCESS-MQ-MESSAGES.                                        10860000
                                                                        10870000
               PERFORM 2500-PROCESS-MQ-DETAIL                           10880000
                   VARYING F053-IDX                                     10890000
                FROM 1 BY 1                                             10900000
                   UNTIL (F053-IDX > PV-DET-ITEMS-COUNT)                10910000
                   OR (F053-IDX > PC-MAX-DETAIL-ITEMS).                 10920000
                                                                        10930000
               PERFORM 7200-SET-CURRENT-TIMESTAMP.                      10940000
                                                                        10950000
               IF  ((PV-CURRENT-TIMESTAMP > PV-COMMIT-TIMESTAMP)        10960000
                 OR (PV-MSG-COUNT         > TCKRSTCNTL-TRANS-QTY))      10970000
                                                                        10980000
                   PERFORM 2540-COMMIT-DATA                             10990000
                   PERFORM 3000-COMMIT-MQ                               11000000
                                                                        11010000
                   INITIALIZE PV-MSG-COUNT                              11020000
                   PERFORM 7100-GET-COMMIT-TIMESTAMP                    11030000
               END-IF.                                                  11040000
                                                                        11050000
               PERFORM 6000-RETRIEVE-MESSAGE                            11060000
                   WITH TEST AFTER                                      11070000
                   UNTIL PS-MESSAGE-RECEIVED.                           11080000
                                                                        11090000
OCFSFS******************************************************************11100000
OCFSFS*  EDIT THE ADJUSTMENT TRANSACTION AND FORMAT THE ROW TO BE       11110000
OCFSFS*  INSERTED TO TABLE FSTT_OH_ADJ_AUD.                             11120000
OCFSFS******************************************************************11130000
OCFSFS 2100-EDIT-AND-FORMAT-ADJ-TRAN.                                   11140000
OCFSFS                                                                  11150000
OCFSFS**** THE ERROR CODE WILL BE SET BY THE SALES PROCESSING.          11160000
OCFSFS     MOVE PV-TRN-ERR-CODE              TO FST00003-ERR-TYP-CDE.   11170000
OCFSFS     MOVE F053-SALE-UNITS(F053-IDX)    TO FST00003-ADJ-QTY.       11180000
OCFSFS     MOVE F053-STORENO                 TO FST00003-LOC-NBR.       11190000
OCFSFS     MOVE SKXREF-ITM-NBR               TO FST00003-ITM-NBR.       11200000
OCFSFS** ? MOVE F053-SKU (F053-IDX)          TO FST00003-ITM-NBR.       11210000
OCFSFS**   MOVE F053-OMNI-CHNL-FFLMT-TYP-CDE TO FST00003-ADJ-TYP-CDE.   11220000
OCFSFS     MOVE '126'                        TO FST00003-ADJ-TYP-CDE.   11230000
OCFSFS     MOVE '+'                          TO FST00003-ACTN-CDE.      11240000
OCFSFS     MOVE 'N'                          TO FST00003-UNT-BKG-CDE.   11250000
OCFSFS     MOVE 'A'                          TO FST00003-TRN-STAT-CDE   11260000
OCFSFS     MOVE PV-PROCESS-DATE-FMT          TO FST00003-PRCG-DTE.      11270000
OCFSFS     MOVE 'SFS '                       TO FST00003-BTCH-NBR.      11280000
OCFSFS     MOVE 'FSKUP200'                   TO FST00003-SRC-PGM-NM.    11290000
OCFSFS     MOVE 'N'                          TO FST00003-UNT-BKG-CDE.   11300000
OCFSFS     MOVE F053-DEPT-NBR(F053-IDX)      TO FST00003-DEPT-NBR.      11310000
OCFSFS     MOVE F053-MCL-NBR(F053-IDX)       TO FST00003-MAJ-CL-NBR.    11320000
OCFSFS     MOVE F053-SCL-NBR(F053-IDX)       TO FST00003-SUB-CL-NBR.    11330000
OCFSFS                                                                  11340000
OCFSFS     ADD  +1                           TO PV-TRN-STAT-A-CNT.      11350000
OCFSFS                                                                  11360000
      ***************************************************************** 11370000
      *  PROCESS DETAIL ITEMS OF EACH MQ MESSAGE.                       11380000
      ***************************************************************** 11390000
       2500-PROCESS-MQ-DETAIL.                                          11400000
                                                                        11410000
           ADD +1 TO PV-SALES-INPUT-CNT.                                11420000
                                                                        11430000
           MOVE F053-STORENO              TO PV-STORENO.                11440000
           MOVE F053-SALE-UNITS(F053-IDX) TO PV-SALE-UNITS.             11450000
           MOVE F053-SALE-AMT(F053-IDX)   TO PV-SALE-AMT.               11460000
           MOVE F053-SKU(F053-IDX)        TO PV-SKU.                    11470000
           MOVE F053-DEPT-NBR (F053-IDX)  TO PV-DEPT.                   11480000
           MOVE F053-SCL-NBR (F053-IDX)   TO PV-SCL-NBR.                11490000
           MOVE F053-SALE-TYPE            TO PV-SALE-TYPE.              11500000
           MOVE F053-SLS-CORR-CDE         TO PV-SLS-CORR-CDE.           11510000
           MOVE F053-DATE                 TO PV-DATE.                   11520000
           MOVE F053-TIME                 TO PV-TIME.                   11530000
           MOVE F053-REG-AMT(F053-IDX)    TO PV-REG-AMT.                11540000
           MOVE F053-TERMINAL             TO PV-TERMINAL.               11550000
           MOVE F053-TRANSNO              TO PV-TRANSNO.                11560000
           MOVE F053-OPERATOR             TO PV-OPERATOR.               11570000
           MOVE F053-MCL-NBR(F053-IDX)    TO PV-MCL-NBR.                11580000
           MOVE F053-SALES-HEADER         TO PV-SALES-HEADER.           11590000
BKPFLC     MOVE F053-DETAIL-ITEM-ENTRY(F053-IDX)                        11600000
BKPFLC                                    TO PV-DETAIL-ITEM-ENTRY.      11610000
                                                                        11620000
           IF PV-SKU-LAST3 = PC-ZERO                                    11630000
               MOVE PC-PLUS-ZERO       TO SKXREF-ITM-NBR                11640000
               ADD PC-1 TO PV-000-SKU-CNT                               11650000
      * PV-000-SKU-CNT/PV-999-SKU-CNT WILL CONTAIN A COUNT OF THOSE   * 11660000
      * SKU'S NOT FOUND ON THE TSKXREF DB2 TABLE. IF SKU CONTAINS ALL * 11670000
      * ZERO'S, THEN WE KNOW IT WOULD NOT BE FOUND ON THE TABLE SO WE * 11680000
      * DO NOT NEED TO EVEN LOOK FOR IT THERE.                        * 11690000
           ELSE                                                         11700000
               IF PV-SKU-LAST3 = PC-999                                 11710000
                   MOVE PC-PLUS-ZERO   TO SKXREF-ITM-NBR                11720000
                   ADD PC-1 TO PV-999-SKU-CNT                           11730000
               END-IF                                                   11740000
           END-IF.                                                      11750000
                                                                        11760000
           IF PV-SKU-LAST3 > PC-ZERO                                    11770000
              PERFORM 2510-EVALUATE-UNIT-AMT                            11780000
              PERFORM 2520-EDIT-AND-FORMAT-SLS-TRAN                     11790000
P3540B*       PERFORM 2530-INSERT-SLS-TRANS                             11800000
P3540B        IF NOT PS-TRN-RECYCLE                                     11810000
P3540B           PERFORM 2530-INSERT-SLS-TRANS                          11820000
OCFSFS           IF F053-OMNI-CHNL-FFLMT-TYP-CDE = 'SFS'                11830000
OCFSFS              PERFORM 2100-EDIT-AND-FORMAT-ADJ-TRAN               11840000
OCFSFS              PERFORM 7900-INSERT-ADJ-TRANS                       11850000
OCFSFS           END-IF                                                 11860000
P3540B        ELSE                                                      11870000
P3540B           PERFORM 2560-RECYCLE-TRANSACTION                       11880000
P3540B        END-IF                                                    11890000
           END-IF.                                                      11900000
                                                                        11910000
           PERFORM 2550-BACKUP-TRANSACTION.                             11920000
                                                                        11930000
      * MOVE THE REQUIRED VARIABLES TO WS- VARIABLES                    11940000
      ***************************************************************** 11950000
      *  VALIDATE THAT THE SIGNS ON THE UNITS AND AMOUNTS ARE CORRECT.  11960000
      ***************************************************************** 11970000
       2510-EVALUATE-UNIT-AMT.                                          11980000
                                                                        11990000
      *** CHECK OF SALES/RET CODE.                                      12000000
      *** THIS CHECK IS NEEDED BECAUSE THE INITIAL VALUE PASSED         12010000
      *** IN THE UNITS FIELD WILL ALWAYS BE POSITIVE.  IF THE           12020000
      *** RECORD WAS A RETURN OR A ADJUSTMENT RETURN THE UNITS SHOULD   12030000
      *** BE NEGATIVE.                                                  12040000
           IF F053-SALE-RET-R (F053-IDX) OR                             12050000
               F053-SALE-RET-ADJ-B (F053-IDX)                           12060000
              COMPUTE PV-SALE-UNITS = PV-SALE-UNITS * -1                12070000
           END-IF.                                                      12080000
                                                                        12090000
      *** CHECK OF THE LINE ITEM VOID INDICATOR.                        12100000
      *** THIS CHECK IS NEEDED FOR VOID PROCESSING.  JUST THE           12110000
      *** UNITS SHOULD BE CHANGED.                                      12120000
           IF F053-LINE-ITEM-VOID (F053-IDX)                            12130000
              COMPUTE PV-SALE-UNITS = PV-SALE-UNITS * -1                12140000
              ADD +1 TO PA-LINE-ITM-VOIDS                               12150000
           END-IF.                                                      12160000
                                                                        12170000
      *** CHECK FOR VOIDED TRANSACTIONS.                                12180000
      *** THIS CHECK IS NEEDED FOR VOID PROCESSING.  BOTH THE           12190000
      *** UNITS AND AMOUNT SHOULD BE CHANGED.                           12200000
           IF F053-VOID-AFTER                                           12210000
              COMPUTE PV-SALE-UNITS = PV-SALE-UNITS * -1                12220000
              COMPUTE PV-SALE-AMT   = PV-SALE-AMT   * -1                12230000
              ADD +1 TO PA-VOIDS                                        12240000
           END-IF.                                                      12250000
                                                                        12260000
      *** CHECK FOR NEGATIVE SALE AMOUNT.                               12270000
      *** THIS CHECK IS NEEDED DUE TO EDIT RULES IN FSKED001.           12280000
      *** FSKED001 WILL MULTIPLY UNITS BY -1 IF THE SALE AMOUNT         12290000
      *** IS NEGATIVE.  ALONG WITH THE ABOVE CHECKS, THIS CHECK         12300000
      *** WILL INSURE THAT UNITS WILL HAVE THE CORRECT SIGN             12310000
      *** FOR UPDATE PROCESSING.                                        12320000
           IF PV-SALE-AMT < 0                                           12330000
              COMPUTE PV-SALE-UNITS = PV-SALE-UNITS * -1                12340000
           END-IF.                                                      12350000
                                                                        12360000
      *** CHECK FOR ZERO SALE AMOUNT ON RETURNS.                        12370000
      *** THIS CHECK IS NEEDED DUE TO EDIT RULES IN FSKED001.           12380000
      *** FSKED001 WILL MULTIPLY UNITS BY -1 IF THE SALE AMOUNT         12390000
      *** IS ZERO AND THE SALE TYPE IS A RETURN.                        12400000
      *** ALONG WITH THE ABOVE CHECKS, THIS CHECK WILL                  12410000
      *** INSURE THAT UNITS WILL HAVE THE CORRECT SIGN                  12420000
      *** FOR UPDATE PROCESSING.                                        12430000
           IF (PV-SALE-AMT = 0) AND (PV-SALE-TYPE = 11 OR 12)           12440000
              COMPUTE PV-SALE-UNITS = PV-SALE-UNITS * -1                12450000
           END-IF.                                                      12460000
                                                                        12470000
                                                                        12480000
      ******************************************************************12490000
      *  EDIT THE SALES TRANSACTION AND FORMAT THE ROW TO BE            12500000
      *  INSERTED TO TABLE FSTT_OH_SLS_AUD.                             12510000
      ******************************************************************12520000
       2520-EDIT-AND-FORMAT-SLS-TRAN.                                   12530000
                                                                        12540000
      *** INITIALIZE THE DCLGEN FOR FSTT_OH_SLS_AUD                     12550000
           INITIALIZE DCLFST00005.                                      12560000
                                                                        12570000
      *** INITIALIZE SWITCH.                                            12580000
           MOVE ' ' TO PS-TRN-STAT-SW.                                  12590000
                                                                        12600000
      *** INITIALIZE HOLD VARIABLES.                                    12610000
      *** INITIALIZE THE ERROR CODE TO '000' (NO ERRORS).               12620000
      *** THIS CODE WILL BE OVERLAID IF AN ERROR IS FOUND.              12630000
           MOVE ZEROS  TO PV-LOC-NBR                                    12640000
                          PV-INPUT-DATE.                                12650000
           MOVE SPACES TO PV-INPUT-CC                                   12660000
                          PV-INPUT-YY                                   12670000
                          PV-INPUT-MM                                   12680000
                          PV-INPUT-DD                                   12690000
                          PV-SALES-TYPE.                                12700000
           MOVE '000'  TO FST00005-ERR-TYP-CDE                          12710000
                          PV-TRN-ERR-CODE.                              12720000
                                                                        12730000
      *** THE FOLLOWING IS A LIST OF DEPARTMENTS THAT WILL NOT          12740000
WYFAIR*** BE PROCESSED.  070-WAYFAIR, 099-MISCELLANEOUS,                12750000
WYFAIR*** 148-SALON SERVIES, 149-SALON PRODUCTS, 555-KOHLS COUPON,      12760000
WYFAIR*** 800-POS EXPENSE                                               12770000
      *** 850-WEB STORE SPECIAL SERVICE, 981-GIFT CERTIFICATE,          12780000
      *** 983-GIFT CARD                                                 12790000
MIRAKL*** 985-MIRAKL.                                                   12800000
SEPHOR*** 712-SEPHORA GIFT CARDS                                        12801008
WYFAIR     IF PV-DEPT  =  070                                           12810000
WYFAIR      OR PV-DEPT =  099                                           12820000
            OR PV-DEPT =  148                                           12830000
            OR PV-DEPT =  149                                           12840000
            OR PV-DEPT =  555                                           12850000
            OR PV-DEPT =  800                                           12860000
            OR PV-DEPT =  833                                           12870000
            OR PV-DEPT =  834                                           12880000
            OR PV-DEPT =  850                                           12890000
            OR PV-DEPT =  981                                           12900000
            OR PV-DEPT =  983                                           12910000
MIRAKL      OR PV-DEPT =  985                                           12920000
SEPHOR      OR PV-DEPT =  712                                           12921008
                SET PS-TRN-BYPASS TO TRUE                               12930000
           END-IF.                                                      12940000
                                                                        12950000
      *** BYPASS SKUS IN DEPT 818 SUBCLASS 10.                          12960000
      *** THESE SKUS WERE CREATED FOR HURICANE DISASTER RELIEF.         12970000
           IF PV-DEPT = 818                                             12980000
            AND PV-SCL-NBR = 10                                         12990000
                SET PS-TRN-BYPASS TO TRUE                               13000000
           END-IF.                                                      13010000
                                                                        13020000
      *** BYPASS SKU 88443720 - RING SIZING                             13030000
           IF  PV-SKU = 88443720                                        13040000
               SET PS-TRN-BYPASS TO TRUE                                13050000
           END-IF.                                                      13060000
                                                                        13070000
      **** PERFORM EDITS ON THE SALES DATA                              13080000
           IF PS-TRN-BYPASS                                             13090000
              CONTINUE                                                  13100000
           ELSE                                                         13110000
              PERFORM 4100-REFORMT-SALES-DATA                           13120000
              PERFORM 4200-EDIT-SALES-DATA                              13130000
           END-IF.                                                      13140000
                                                                        13150000
      **** CHECK RCP INDICATOR                                          13160000
           IF PS-TRN-BYPASS                                             13170000
P3540B     OR PS-TRN-RECYCLE                                            13180000
              CONTINUE                                                  13190000
           ELSE                                                         13200000
              IF PV-NO-ERRORS                                           13210000
                 MOVE SPACES TO PV-RCP-STATUS-CDE                       13220000
                 MOVE ZEROS  TO PV-RCP-UNT-RTL-AMT-9                    13230000
                 IF UPC-REGN-PRIC-IND = 'Y'                             13240000
                    PERFORM 8200-SELECT-RCP-AMT                         13250000
                 END-IF                                                 13260000
              END-IF                                                    13270000
           END-IF.                                                      13280000
                                                                        13290000
      **** FORMAT/ASSIGN FS SALES TYPE                                  13300000
           IF PS-TRN-BYPASS                                             13310000
P3540B     OR PS-TRN-RECYCLE                                            13320000
              CONTINUE                                                  13330000
           ELSE                                                         13340000
              IF PV-NO-ERRORS                                           13350000
                 PERFORM 4300-DETERMINE-FS-SALES-TYPE                   13360000
              END-IF                                                    13370000
           END-IF.                                                      13380000
                                                                        13390000
      **** FORMAT FIELDS FOR INSERT INTO THE SALES AUDIT TABLE          13400000
P3540B     IF NOT PS-TRN-RECYCLE                                        13410000
              IF PS-TRN-BYPASS                                          13420000
                 ADD  +1  TO PV-TRN-STAT-B-CNT                          13430000
                 INITIALIZE SKXREF-ITM-NBR                              13440000
                 IF PV-SKU-LAST3 < PC-999                               13450000
                    PERFORM 4400-GET-TSKXREF-ITM-NBR                    13460000
                 END-IF                                                 13470000
                 PERFORM 5000-FORMAT-BYPASS-TRANS                       13480000
              ELSE                                                      13490000
                 IF PV-NO-ERRORS                                        13500000
                    ADD  +1  TO PV-TRN-STAT-A-CNT                       13510000
                    PERFORM 5100-FORMAT-AUDIT-TRANS                     13520000
                 ELSE                                                   13530000
                    ADD  +1  TO PV-TRN-STAT-E-CNT                       13540000
                    PERFORM 5200-FORMAT-ERROR-TRANS                     13550000
                 END-IF                                                 13560000
              END-IF                                                    13570000
P3540B     END-IF.                                                      13580000
                                                                        13590000
      ******************************************************************13600000
      *   INSERT A ROW TO TABLE FSTT_OH_SLS_AUD                         13610000
      ******************************************************************13620000
       2530-INSERT-SLS-TRANS.                                           13630000
                                                                        13640000
           MOVE '2530-INSERT-SLS-TRANS' TO PV-PARAGRAPH-NAME.           13650000
                                                                        13660000
           EXEC SQL                                                     13670000
               INSERT INTO  FSTT_OH_SLS_AUD                             13680000
                          ( PRCG_DTE                                    13690000
                           ,ITM_NBR                                     13700000
                           ,LOC_NBR                                     13710000
                           ,SLS_DTE                                     13720000
                           ,SLS_STRT_TM                                 13730000
                           ,RGST_ID                                     13740000
                           ,TRN_NBR                                     13750000
                           ,ASSOC_ID                                    13760000
                           ,POS_TRN_TYP_CDE                             13770000
                           ,SLD_QTY                                     13780000
                           ,NET_CHRGD_AMT                               13790000
                           ,CUST_CHRGD_AMT                              13800000
                           ,DEPT_NBR                                    13810000
                           ,MAJ_CL_NBR                                  13820000
                           ,SUB_CL_NBR                                  13830000
                           ,FS_SLS_TYP_CDE                              13840000
                           ,ACCTG_PERD_YR                               13850000
                           ,ACCTG_PERD_MN                               13860000
                           ,ACCTG_BOW_DTE                               13870000
                           ,ERR_TYP_CDE                                 13880000
                           ,CRE_TMST                                    13890000
                           ,TRN_STAT_CDE                                13900000
                           ,LAST_UPD_TMST                               13910000
                           ,SKU_STAT_CDE)                               13920000
                   VALUES ( :FST00005-PRCG-DTE                          13930000
                           ,:FST00005-ITM-NBR                           13940000
                           ,:FST00005-LOC-NBR                           13950000
                           ,:FST00005-SLS-DTE                           13960000
                           ,:FST00005-SLS-STRT-TM                       13970000
                           ,:FST00005-RGST-ID                           13980000
                           ,:FST00005-TRN-NBR                           13990000
                           ,:FST00005-ASSOC-ID                          14000000
                           ,:FST00005-POS-TRN-TYP-CDE                   14010000
                           ,:FST00005-SLD-QTY                           14020000
                           ,:FST00005-NET-CHRGD-AMT                     14030000
                           ,:FST00005-CUST-CHRGD-AMT                    14040000
                           ,:FST00005-DEPT-NBR                          14050000
                           ,:FST00005-MAJ-CL-NBR                        14060000
                           ,:FST00005-SUB-CL-NBR                        14070000
                           ,:FST00005-FS-SLS-TYP-CDE                    14080000
                           ,:FST00005-ACCTG-PERD-YR                     14090000
                           ,:FST00005-ACCTG-PERD-MN                     14100000
                           ,:FST00005-ACCTG-BOW-DTE                     14110000
                           ,:FST00005-ERR-TYP-CDE                       14120000
                           , CURRENT TIMESTAMP                          14130000
                           ,:FST00005-TRN-STAT-CDE                      14140000
                           , CURRENT TIMESTAMP                          14150000
                           ,:FST00005-SKU-STAT-CDE)                     14160000
           END-EXEC.                                                    14170000
                                                                        14180000
           EVALUATE SQLCODE                                             14190000
             WHEN +0                                                    14200000
                   ADD +1 TO PV-INSERT-CNT                              14210000
             WHEN OTHER                                                 14220000
                   DISPLAY '*******************************'            14230000
                   DISPLAY 'ITEM NUMBER = ' FST00005-ITM-NBR            14240000
                   DISPLAY 'LOC  NUMBER = ' FST00005-LOC-NBR            14250000
                   DISPLAY '*******************************'            14260000
                   MOVE 'INSERT TO FSTT_OH_SLS_AUD' TO                  14270000
                         PV-DB2-OPERATION-ATTEMPTED                     14280000
                   PERFORM 2800-ROLLBACK-DATA                           14290000
                   PERFORM 2900-SEND-ALERT                              14300000
                   PERFORM 3100-BACK-OUT-MQV-CHANGES                    14310000
                   PERFORM 9100-CLOSE-QUEUES                            14320000
                   PERFORM 9200-DISCONNECT-QMGR                         14330000
                   PERFORM 9999-SQL-ABEND                               14340000
           END-EVALUATE.                                                14350000
                                                                        14360000
                                                                        14370000
      ***************************************************************   14380000
      * 2540-COMMIT-DATA.                                               14390000
      *     COMMIT DATA TO THE DATABASE.                                14400000
      ******************************************************************14410000
       2540-COMMIT-DATA.                                                14420000
                                                                        14430000
           PERFORM                                                      14440000
               WITH TEST AFTER                                          14450000
               VARYING PV-SQL-SUB                                       14460000
               FROM 1 BY 1                                              14470000
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14480000
                         OR  SQLCODE = 0)                               14490000
                                                                        14500000
               EXEC SQL                                                 14510000
                   COMMIT                                               14520000
               END-EXEC                                                 14530000
                                                                        14540000
               EVALUATE TRUE                                            14550000
                   WHEN SQLCODE = -904                                  14560000
                   WHEN SQLCODE = -911                                  14570000
                   WHEN SQLCODE = -913                                  14580000
                   WHEN SQLCODE = 0                                     14590000
                        CONTINUE                                        14600000
                   WHEN OTHER                                           14610000
                        DISPLAY 'UNABLE TO COMMIT DATA'                 14620000
                        PERFORM 2900-SEND-ALERT                         14630000
                        PERFORM 3100-BACK-OUT-MQV-CHANGES               14640000
                        PERFORM 9100-CLOSE-QUEUES                       14650000
                        PERFORM 9200-DISCONNECT-QMGR                    14660000
                        MOVE '2540-COMMIT-DATA' TO PV-PARAGRAPH-NAME    14670000
                        MOVE 'COMMIT DID NOT WORK' TO                   14680000
                                       PV-DB2-OPERATION-ATTEMPTED       14690000
                        PERFORM 9999-SQL-ABEND                          14700000
               END-EVALUATE                                             14710000
           END-PERFORM.                                                 14720000
                                                                        14730000
           IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        14740000
               PERFORM 2900-SEND-ALERT                                  14750000
               PERFORM 3100-BACK-OUT-MQV-CHANGES                        14760000
               PERFORM 9100-CLOSE-QUEUES                                14770000
               PERFORM 9200-DISCONNECT-QMGR                             14780000
               MOVE '2540-COMMIT-DATA'                                  14790000
                                     TO  PV-PARAGRAPH-NAME              14800000
               MOVE 'COMMIT RETRIES EXCEEDED'                           14810000
                                     TO  PV-DB2-OPERATION-ATTEMPTED     14820000
               PERFORM 9999-SQL-ABEND                                   14830000
           END-IF.                                                      14840000
                                                                        14850000
      ******************************************************************14860000
      * 2550-BACKUP-MESSAGE.                                            14870000
      *     WRITES THE MESSAGE TO A LOG IN CASE RECOVERY IS NEEDED.     14880000
      ******************************************************************14890000
       2550-BACKUP-TRANSACTION.                                         14900000
                                                                        14910000
           WRITE MESSAGE-LOG-RECORD FROM PV-SALES-RECORD.               14920000
                                                                        14930000
P3540B******************************************************************14940000
P3540B* 2560-RECYCLE-TRANSACTION.                                       14950000
P3540B*     WRITES THE MESSAGE TO A RECYCLE FILE.                       14960000
P3540B******************************************************************14970000
P3540B 2560-RECYCLE-TRANSACTION.                                        14980000
P3540B                                                                  14990000
P3540B     WRITE RECYCLE-MSG-RECORD FROM PV-SALES-RECORD.               15000000
P3540B                                                                  15010000
P3540B     ADD +1                  TO PV-TRN-STAT-R-CNT.                15020000
P3540B     ADD PV-SALE-UNITS       TO PV-RECYCLE-SALES-QTY.             15030000
P3540B     ADD PV-SALE-AMT         TO PV-RECYCLE-SALES-AMT.             15040000
P3540B                                                                  15050000
      ******************************************************************15060000
      *  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       *15070000
      ******************************************************************15080000
       3000-COMMIT-MQ.                                                  15090000
                                                                        15100000
           CALL MQV-MQCMIT USING MQV-HCONN                              15110000
                                 MQV-COMPLETION-CODE                    15120000
                                 MQV-REASON.                            15130000
                                                                        15140000
           EVALUATE TRUE                                                15150000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        15160000
                   ADD +1 TO PV-COMMITS-TAKEN                           15170000
              WHEN OTHER                                                15180000
                   CALL MQV-MQCHECK USING MQV-REASON                    15190000
                                          MQV-REASON-TEXT               15200000
                   MOVE '3000-COMMIT-MQ'  TO PV-PARAGRAPH-NAME          15210000
                   MOVE 'ERROR COMMITING QUEUE' TO PV-OPERATION-MSG-1   15220000
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    15230000
                   MOVE MQV-REASON             TO PV-REASON             15240000
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        15250000
                   PERFORM 3100-BACK-OUT-MQV-CHANGES                    15260000
                   PERFORM 9100-CLOSE-QUEUES                            15270000
                   PERFORM 9200-DISCONNECT-QMGR                         15280000
                   PERFORM 9999-SQL-ABEND                               15290000
           END-EVALUATE.                                                15300000
                                                                        15310000
      ******************************************************************15320000
      * 3100-BACK-OUT-MQV-CHANGES.                                      15330000
      *     ROLLBACK MQ CHANGES.                                        15340000
      ******************************************************************15350000
       3100-BACK-OUT-MQV-CHANGES.                                       15360000
                                                                        15370000
           CALL MQV-MQBACK USING MQV-HCONN                              15380000
                                 MQV-COMPLETION-CODE                    15390000
                                 MQV-REASON.                            15400000
                                                                        15410000
           EVALUATE TRUE                                                15420000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        15430000
                   CONTINUE                                             15440000
              WHEN OTHER                                                15450000
                   CALL MQV-MQCHECK USING MQV-REASON                    15460000
                                          MQV-REASON-TEXT               15470000
                   MOVE '3100-BACK-OUT-MQV-CHANGES' TO PV-PARAGRAPH-NAME15480000
                   MOVE 'MQBACK ERROR'  TO PV-OPERATION-MSG-1           15490000
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    15500000
                   MOVE MQV-REASON             TO PV-REASON             15510000
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        15520000
                   PERFORM 2900-SEND-ALERT                              15530000
                   PERFORM 9100-CLOSE-QUEUES                            15540000
                   PERFORM 9200-DISCONNECT-QMGR                         15550000
                   PERFORM 9400-MQ-ABEND                                15560000
           END-EVALUATE.                                                15570000
                                                                        15580000
      ******************************************************************15590000
      *  REFORMAT THE SALES DATA.                                       15600000
      *  EDIT THE SALES UNITS TO BE NEGATIVE IN THE FOLLOWING INSTANCES:15610000
      *   -SALES AMOUNT IS NEGATIVE AND THE SALES UNITS ARE POSITIVE    15620000
      *   -SALES AMOUNT EQUAL TO ZERO AND THE SALES TYPE IS AN 11 OR 12 15630000
      *    (A RETURN)                                                   15640000
      *  KEEP SALES QUANTITY AND AMOUNT TOTALS.                         15650000
      ******************************************************************15660000
       4100-REFORMT-SALES-DATA.                                         15670000
                                                                        15680000
           IF (PV-SALE-AMT NEGATIVE) AND                                15690000
              (PV-SALE-UNITS POSITIVE)                                  15700000
              COMPUTE PV-SALE-UNITS =                                   15710000
                 PV-SALE-UNITS * PC-NEGATIVE-ONE                        15720000
           END-IF.                                                      15730000
                                                                        15740000
           IF (PV-SALE-AMT = 0) AND                                     15750000
              (PV-SALE-TYPE = 11 OR 12)                                 15760000
              COMPUTE PV-SALE-UNITS =                                   15770000
                 PV-SALE-UNITS * PC-NEGATIVE-ONE                        15780000
           END-IF.                                                      15790000
                                                                        15800000
           ADD PV-SALE-UNITS   TO  PV-TOTAL-SALES-QTY.                  15810000
           ADD PV-SALE-AMT     TO  PV-TOTAL-SALES-AMT.                  15820000
                                                                        15830000
           IF PV-NORMAL-TRANS                                           15840000
              ADD +1 TO PV-NORMAL-SALES-CNT                             15850000
           ELSE                                                         15860000
               IF PV-SALES-AUDIT-CORR                                   15870000
                  ADD PV-SALE-UNITS   TO  PV-SALES-CORR-QTY             15880000
                  ADD PV-SALE-AMT     TO  PV-SALES-CORR-AMT             15890000
                  ADD +1 TO PV-SALES-CORR-CNT                           15900000
               ELSE                                                     15910000
                  ADD +1 TO PV-LATE-CORR-CNT                            15920000
               END-IF                                                   15930000
           END-IF.                                                      15940000
                                                                        15950000
                                                                        15960000
      ******************************************************************15970000
      *  PERFORM EDITS ON THE SALES DATA.                               15980000
      ******************************************************************15990000
       4200-EDIT-SALES-DATA.                                            16000000
                                                                        16010000
           IF PV-SKU = PV-PREV-SKU                                      16020000
              IF PV-HOLD-NO-ERRORS                                      16030000
                 MOVE PV-SKU                 TO SKXREF-SKU              16040000
                 MOVE PV-HOLD-ITM-NBR        TO SKXREF-ITM-NBR          16050000
                 MOVE PV-HOLD-DEPT           TO SKXREF-DEPT             16060000
                 MOVE PV-HOLD-CLASS          TO SKXREF-CLASS            16070000
                 MOVE PV-HOLD-SUBCLASS       TO SKXREF-SUBCLASS         16080000
                 MOVE PV-HOLD-SKU-STAT-CDE   TO UPCPLS-UPC-STAT-CDE     16090000
                 MOVE PV-HOLD-REGN-PRIC-IND  TO UPC-REGN-PRIC-IND       16100000
                 MOVE PV-HOLD-UNT-RTL-AMT    TO UPCPLS-UNT-RTL-AMT      16110000
              ELSE                                                      16120000
                 MOVE PV-HOLD-ERR-CDE        TO PV-TRN-ERR-CODE         16130000
                 IF PV-TRN-ERR-CODE = '004'                             16140000
                    ADD  +1    TO PV-TRN-ERR-004-CNT                    16150000
                    ADD  +1    TO PV-TSKXREF-ITM-NOT-FND-CNT            16160000
                 ELSE                                                   16170000
                    ADD  +1    TO PV-TRN-ERR-005-CNT                    16180000
                    ADD  +1    TO PV-TSKXREF-RENUM-NOT-FND-CNT          16190000
                 END-IF                                                 16200000
              END-IF                                                    16210000
           ELSE                                                         16220000
              IF PV-SKU-LAST3 = PC-999                                  16230000
                 INITIALIZE UPC-REGN-PRIC-IND                           16240000
                            UPCPLS-UPC-STAT-CDE                         16250000
                 MOVE '004' TO PV-TRN-ERR-CODE                          16260000
                 ADD  +1    TO PV-TRN-ERR-004-CNT                       16270000
                 ADD  +1    TO PV-TSKXREF-SELECT-CNT                    16280000
                 ADD  +1    TO PV-TSKXREF-ITM-NOT-FND-CNT               16290000
              ELSE                                                      16300000
                 PERFORM 8000-SELECT-ITEM                               16310000
              END-IF                                                    16320000
              IF PV-NO-ERRORS                                           16330000
                 MOVE SKXREF-SKU             TO  PV-PREV-SKU            16340000
                 MOVE SKXREF-ITM-NBR         TO  PV-HOLD-ITM-NBR        16350000
                 MOVE SKXREF-DEPT            TO  PV-HOLD-DEPT           16360000
                 MOVE SKXREF-CLASS           TO  PV-HOLD-CLASS          16370000
                 MOVE SKXREF-SUBCLASS        TO  PV-HOLD-SUBCLASS       16380000
                 MOVE UPCPLS-UPC-STAT-CDE    TO  PV-HOLD-SKU-STAT-CDE   16390000
                 MOVE UPC-REGN-PRIC-IND      TO  PV-HOLD-REGN-PRIC-IND  16400000
                 MOVE UPCPLS-UNT-RTL-AMT     TO  PV-HOLD-UNT-RTL-AMT    16410000
                 MOVE PV-TRN-ERR-CODE        TO  PV-HOLD-ERR-CDE        16420000
              ELSE                                                      16430000
                 MOVE PV-SKU                 TO  PV-PREV-SKU            16440000
                 MOVE PV-TRN-ERR-CODE        TO  PV-HOLD-ERR-CDE        16450000
              END-IF                                                    16460000
           END-IF.                                                      16470000
                                                                        16480000
           IF  PV-NO-ERRORS                                             16490000
               PERFORM 4120-VALIDATE-LOCATION                           16500000
           ELSE                                                         16510000
               MOVE PV-STORENO TO PV-LOC-NBR                            16520000
           END-IF.                                                      16530000
                                                                        16540000
           IF PV-NO-ERRORS                                              16550000
               PERFORM 4130-VALIDATE-SALES-UNITS                        16560000
           END-IF.                                                      16570000
                                                                        16580000
           PERFORM 4140-VALIDATE-TRANS-DATE.                            16590000
                                                                        16600000
           PERFORM 4145-REFORMAT-TRANS-TIME.                            16610000
                                                                        16620000
                                                                        16630000
      ******************************************************************16640000
      *  VALIDATE THAT THE LOCATION NUMBER EXISTS IN THE INTERNAL       16650000
      *  LOCATION TABLE.  VALID LOCATION TYPES ARE 'DS' (DEPT STORE)    16660000
      *  AND 'HQ' (CORPORATE LOCATIONS).                                16670000
      ******************************************************************16680000
       4120-VALIDATE-LOCATION.                                          16690000
                                                                        16700000
           SET LOC-INDEX TO 1.                                          16710000
           SEARCH LOCATION-ENTRY                                        16720000
             AT END                                                     16730000
               MOVE PV-STORENO TO PV-LOC-NBR                            16740000
               MOVE '006' TO PV-TRN-ERR-CODE                            16750000
               ADD  +1    TO PV-TRN-ERR-006-CNT                         16760000
             WHEN LOC-NBR(LOC-INDEX) = PV-STORENO                       16770000
               MOVE PV-STORENO TO PV-LOC-NBR                            16780000
             WHEN LOC-INDEX > LOCATION-TBL-SIZE                         16790000
               MOVE PV-STORENO TO PV-LOC-NBR                            16800000
               MOVE '006' TO PV-TRN-ERR-CODE                            16810000
               ADD  +1    TO PV-TRN-ERR-006-CNT                         16820000
           END-SEARCH.                                                  16830000
                                                                        16840000
                                                                        16850000
      ******************************************************************16860000
      *  VALIDATE THAT THE ABSOLUTE VALUE OF THE UNITS IS BETWEEN       16870000
      *  0 AND 99.                                                      16880000
      ******************************************************************16890000
       4130-VALIDATE-SALES-UNITS.                                       16900000
                                                                        16910000
           MOVE PV-SALE-UNITS  TO  PV-QTY-CHECK.                        16920000
           IF (PV-QTY-CHECK NEGATIVE)                                   16930000
               MULTIPLY PV-QTY-CHECK BY PC-NEGATIVE-ONE                 16940000
                   GIVING PV-QTY-CHECK                                  16950000
           END-IF.                                                      16960000
                                                                        16970000
           IF   PV-QTY-CHECK >= 0                                       16980000
P48056      AND PV-QTY-CHECK <= 499                                     16990000
               CONTINUE                                                 17000000
           ELSE                                                         17010000
               MOVE '020'         TO PV-TRN-ERR-CODE                    17020000
               ADD  +1            TO PV-TRN-ERR-020-CNT                 17030000
           END-IF.                                                      17040000
                                                                        17050000
                                                                        17060000
      ******************************************************************17070000
      *  VALIDATE THE TRANSACTION DATE.  EDIT TO CHECK IF THE           17080000
      *  TRANSACTION DATE IS LESS THAN OR EQUAL TO THE PROCESSING       17090000
      *  DATE.  NO FUTURE DATED SALES TRANSACTIONS CAN BE PROCESSED.    17100000
      ******************************************************************17110000
       4140-VALIDATE-TRANS-DATE.                                        17120000
                                                                        17130000
           IF (PS-FIRST-TIME-SW = 'Y') OR                               17140000
                                      (PV-DATE NOT EQUAL PV-HOLD-DATE)  17150000
              MOVE PV-DATE               TO PV-REFORMAT-DATE            17160000
              MOVE PV-REFORMAT-YY        TO PV-INPUT-YEAR               17170000
                                            PV-INPUT-YY                 17180000
              MOVE PV-REFORMAT-MM        TO PV-INPUT-MONTH              17190000
                                            PV-INPUT-MM                 17200000
              MOVE PV-REFORMAT-DD        TO PV-INPUT-DAY                17210000
                                            PV-INPUT-DD                 17220000
              IF PV-INPUT-YEAR > '80'                                   17230000
                 MOVE '19' TO PV-INPUT-CENTURY                          17240000
                              PV-INPUT-CC                               17250000
              ELSE                                                      17260000
                 MOVE '20' TO PV-INPUT-CENTURY                          17270000
                              PV-INPUT-CC                               17280000
              END-IF                                                    17290000
                                                                        17300000
              INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56            17310000
              SET DPG51-FISCAL-JAN-DEC-F2                               17320000
                  DPG51-DO-NOT-INCR-DECR-DATE                           17330000
                  DPG52-LK-DTE-ISO            TO TRUE                   17340000
              MOVE PV-INPUT-DATE TO DPG52-LK-DATE-INPUT                 17350000
                                                                        17360000
              CALL DP500-KOHLS-CALENDAR-ROUTINE                         17370000
                  USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56             17380000
                                                                        17390000
              IF DPG54-DATE-INVALID                                     17400000
                 IF PV-NO-ERRORS                                        17410000
                    MOVE '021'         TO PV-TRN-ERR-CODE               17420000
                    ADD  +1            TO PV-TRN-ERR-021-CNT            17430000
                 END-IF                                                 17440000
                 MOVE PC-DEFAULT-DATE-FMT TO PV-INPUT-DATE-FMT          17450000
              ELSE                                                      17460000
                  IF DPG54-SEVERE-ERROR                                 17470000
                      DISPLAY '** ABEND ** IN FSKUP200'                 17480000
                      DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE.'17490000
                      DISPLAY '** CALLED BY 4140-VALIDATE-TRANS-DATE.'  17500000
                      DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE 17510000
                      DISPLAY '** DPG51 = ' DPG51                       17520000
                      DISPLAY '** DPG52 = ' DPG52                       17530000
                      DISPLAY '** DPG53 = ' DPG53                       17540000
                      DISPLAY '** DPG54 = ' DPG54                       17550000
                      DISPLAY '** DPG55 = ' DPG55                       17560000
                      DISPLAY '** DPG56 = ' DPG56                       17570000
                      MOVE +4003 TO ABEND-CODE                          17580000
                      CALL 'ILBOABN0' USING ABEND-CODE                  17590000
                  ELSE                                                  17600000
                      IF DPG54-WARNING-ERROR                            17610000
                         MOVE PC-DEFAULT-DATE TO PV-INPUT-DATE          17620000
                         DISPLAY                                        17630000
                               '** WARNING RETURNED BY CALENDAR ROUTINE'17640000
                         DISPLAY                                        17650000
                               '** CALLED BY 4140-VALIDATE-TRANS-DATE.' 17660000
                         DISPLAY                                        17670000
                               '** WARNING MESSAGE = '                  17680000
                                             DPG54-ERROR-MESSAGE        17690000
                      END-IF                                            17700000
                  END-IF                                                17710000
              END-IF                                                    17720000
                                                                        17730000
              IF PV-NO-ERRORS                                           17740000
               AND (PV-INPUT-DATE NOT = PC-DEFAULT-DATE)                17750000
P3540B*          IF PV-INPUT-DATE <= PV-PROCESS-DATE                    17760000
P3540B           IF PV-INPUT-DATE <= PV-NEXT-DAY-DATE                   17770000
                     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-INPUT-DATE-FMT   17780000
                     MOVE 'N' TO PS-FIRST-TIME-SW                       17790000
P3540B               IF PV-INPUT-DATE = PV-NEXT-DAY-DATE                17800000
P3540B                  SET PS-TRN-RECYCLE TO TRUE                      17810000
P3540B               END-IF                                             17820000
                 ELSE                                                   17830000
                     MOVE '022'         TO PV-TRN-ERR-CODE              17840000
                     ADD  +1            TO PV-TRN-ERR-022-CNT           17850000
                     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-INPUT-DATE-FMT   17860000
      * THIS IS ENABLE THE PROGRAM TO CALL THE DP500 ROUTINE WHEN       17870000
      * 2 CONSECUTIVE RECORDS WITH PV-INPUT-DATE > PV-NEXT-DAY-DATE     17880000
      * ARE PROCESSED                                                   17890000
                     MOVE 'Y' TO PS-FIRST-TIME-SW                       17900000
                 END-IF                                                 17910000
              ELSE                                                      17920000
                 IF DPG54-DATE-INVALID                                  17930000
                    MOVE 'Y' TO PS-FIRST-TIME-SW                        17940000
                 ELSE                                                   17950000
                    MOVE DPG55-DB2-ISO-DATE-FMT TO PV-INPUT-DATE-FMT    17960000
                 END-IF                                                 17970000
              END-IF                                                    17980000
              MOVE PV-DATE TO PV-HOLD-DATE                              17990000
              MOVE PV-INPUT-DATE-FMT TO PV-HOLD-INPUT-DATE-FMT          18000000
           ELSE                                                         18010000
              MOVE PV-HOLD-INPUT-DATE-FMT TO PV-INPUT-DATE-FMT          18020000
P3540B        MOVE PV-DATE               TO PV-REFORMAT-DATE            18030000
P3540B        MOVE PV-REFORMAT-YY        TO PV-INPUT-YEAR               18040000
P3540B        MOVE PV-REFORMAT-MM        TO PV-INPUT-MONTH              18050000
P3540B        MOVE PV-REFORMAT-DD        TO PV-INPUT-DAY                18060000
P3540B        IF PV-INPUT-YEAR > '80'                                   18070000
P3540B           MOVE '19' TO PV-INPUT-CENTURY                          18080000
P3540B        ELSE                                                      18090000
P3540B           MOVE '20' TO PV-INPUT-CENTURY                          18100000
P3540B        END-IF                                                    18110000
P3540B        IF PV-INPUT-DATE = PV-NEXT-DAY-DATE                       18120000
P3540B           SET PS-TRN-RECYCLE TO TRUE                             18130000
P3540B        END-IF                                                    18140000
           END-IF.                                                      18150000
                                                                        18160000
                                                                        18170000
      ******************************************************************18180000
      *  REFORMAT THE TRANSACTION TIME FOR INSERT TO THE SALES AUDIT    18190000
      *  DB2 TABLE.                                                     18200000
      ******************************************************************18210000
       4145-REFORMAT-TRANS-TIME.                                        18220000
                                                                        18230000
           MOVE PV-TIME        TO  PV-TRAN-TIME-9.                      18240000
           MOVE PV-TRAN-TIME-9 TO  PV-TRAN-TIME.                        18250000
                                                                        18260000
           MOVE PV-TRAN-TIME-HH TO PV-TRAN-TIME-HH-FMT.                 18270000
           MOVE PV-TRAN-TIME-MM TO PV-TRAN-TIME-MM-FMT.                 18280000
           MOVE ZEROS           TO PV-TRAN-TIME-SS-FMT.                 18290000
                                                                        18300000
                                                                        18310000
      ******************************************************************18320000
      *  ASSIGNS THE CORRECT FS SALES TYPE.                             18330000
      *  PLEASE NOTE THAT THIS CODE IS SPECIFIC TO FASHION SALES.       18340000
      ******************************************************************18350000
       4300-DETERMINE-FS-SALES-TYPE.                                    18360000
                                                                        18370000
      *******************************                                   18380000
      **** FIRST SECTION OF THE PARAGRAPH WILL COMPUTE ABSOLUTE         18390000
      **** VALUES OF SALES AMOUNT AND SALES UNITS.  THIS IS NEEDED      18400000
      **** TO DETERMINE THE CORRECT FS SALES TYPE.                      18410000
      *******************************                                   18420000
           IF PV-SALE-AMT NEGATIVE                                      18430000
              COMPUTE PV-ABSOLUTE-AMT = PV-SALE-AMT * PC-NEGATIVE-ONE   18440000
           ELSE                                                         18450000
              MOVE PV-SALE-AMT TO PV-ABSOLUTE-AMT                       18460000
           END-IF.                                                      18470000
                                                                        18480000
           IF PV-RCP-STATUS-CLEAR                                       18490000
              COMPUTE PV-EXT-CURR-PRICE ROUNDED =                       18500000
                 PV-RCP-UNT-RTL-AMT-9 * PV-SALE-UNITS                   18510000
           ELSE                                                         18520000
              COMPUTE PV-EXT-CURR-PRICE ROUNDED =                       18530000
                 UPCPLS-UNT-RTL-AMT  * PV-SALE-UNITS                    18540000
           END-IF.                                                      18550000
                                                                        18560000
           IF PV-EXT-CURR-PRICE NEGATIVE                                18570000
              COMPUTE PV-ABSOLUTE-EXT-PRC =                             18580000
                 PV-EXT-CURR-PRICE * PC-NEGATIVE-ONE                    18590000
           ELSE                                                         18600000
               MOVE PV-EXT-CURR-PRICE TO PV-ABSOLUTE-EXT-PRC            18610000
           END-IF.                                                      18620000
      ********************************                                  18630000
                                                                        18640000
      ********************************                                  18650000
      **** LAST SECTION OF THE PARAGRAPH WILL DETERMINE THE             18660000
      **** FS SALE TYPE.  REGULAR - 01, PROMOTIONAL - 02 OR             18670000
      **** CLEARANCE - 03.                                              18680000
      ********************************                                  18690000
                                                                        18700000
      **** FS SALE TYPE - REGULAR - 01                                  18710000
           IF (PV-REG-AMT = ZEROS                                       18720000
            OR PV-REG-AMT = .01)                                        18730000
             AND PV-ABSOLUTE-AMT >= ZEROS                               18740000
             AND (UPCPLS-UPC-STAT-CDE NOT = PC-STATUS-CLEARANCE)        18750000
             AND (PV-RCP-STATUS-CDE   NOT = PC-RCP-STATUS-CDE-CLR)      18760000
             AND (PV-ABSOLUTE-EXT-PRC = PV-ABSOLUTE-AMT                 18770000
              OR PV-ABSOLUTE-EXT-PRC < PV-ABSOLUTE-AMT)                 18780000
              MOVE PC-SALES-TYPE-REGULAR TO PV-SALES-TYPE               18790000
           ELSE                                                         18800000
      ****    FS SALE TYPE - PROMOTIONAL - 02                           18810000
              IF PV-REG-AMT > ZEROS                                     18820000
               AND (UPCPLS-UPC-STAT-CDE NOT = PC-STATUS-CLEARANCE)      18830000
               AND (PV-RCP-STATUS-CDE   NOT = PC-RCP-STATUS-CDE-CLR)    18840000
               AND PV-ABSOLUTE-AMT > ZEROS                              18850000
                 MOVE PC-SALES-TYPE-PROMOTIONAL TO PV-SALES-TYPE        18860000
              ELSE                                                      18870000
      ****       FS SALE TYPE - CLEARANCE - 03                          18880000
                 IF (UPCPLS-UPC-STAT-CDE = PC-STATUS-CLEARANCE)         18890000
                  OR (PV-RCP-STATUS-CDE  = PC-RCP-STATUS-CDE-CLR)       18900000
                  OR PV-ABSOLUTE-AMT < PV-ABSOLUTE-EXT-PRC              18910000
                    MOVE PC-SALES-TYPE-CLEARANCE TO PV-SALES-TYPE       18920000
                 ELSE                                                   18930000
      ****          FS SALE TYPE - REGULAR - 01 (DEFAULT/CATCH ALL)     18940000
                    MOVE PC-SALES-TYPE-REGULAR TO PV-SALES-TYPE         18950000
                    DISPLAY 'FSKUP200-CANNOT CLASSIFY SALES TYPE'       18960000
                    DISPLAY 'DEFAULT CLASSIFY - REGULAR'                18970000
                    DISPLAY '    ITEM NUMBER = ' SKXREF-ITM-NBR         18980000
                    MOVE PV-SALE-AMT TO PV-SALE-AMT-DIS                 18990000
                    DISPLAY '    AMOUNT = ' PV-SALE-AMT-DIS             19000000
                    MOVE PV-SALE-UNITS TO PV-SALE-UNT-DIS               19010000
                    DISPLAY '    UNITS = ' PV-SALE-UNT-DIS              19020000
                    MOVE PV-ABSOLUTE-EXT-PRC TO PV-ABSOL-EXT-PRC-DIS    19030000
                    DISPLAY '    EXT PRC = ' PV-ABSOL-EXT-PRC-DIS       19040000
                    DISPLAY '    STATUS CODE = ' UPCPLS-UPC-STAT-CDE    19050000
                 END-IF                                                 19060000
              END-IF                                                    19070000
           END-IF.                                                      19080000
      ********************************                                  19090000
                                                                        19100000
      ******************************************************************19110000
      *  4400-GET-TSKXREF-ITM-NBR.                                      19120000
      *  RETRIEVES THE ITEM NUMBER FOR BYPASSED TRANSACATIONS.          19130000
      ******************************************************************19140000
       4400-GET-TSKXREF-ITM-NBR.                                        19150000
                                                                        19160000
           MOVE PV-SKU TO SKXREF-SKU.                                   19170000
                                                                        19180000
           MOVE ZERO TO PV-RETRY-CNT.                                   19190000
                                                                        19200000
           PERFORM WITH TEST AFTER                                      19210000
               VARYING PV-RETRY-CNT FROM 1 BY 1                         19220000
                 UNTIL PV-RETRY-CNT > PC-MAX-RETRIES                    19230000
                    OR SQLCODE = +0                                     19240000
                    OR SQLCODE = +100                                   19250000
              EXEC SQL                                                  19260000
                  SELECT ITM_NBR                                        19270000
                  INTO   :SKXREF-ITM-NBR                                19280000
                  FROM TSKXREF                                          19290000
                  WHERE SKU   = :SKXREF-SKU                             19300000
                  AND SKU_STAT_CDE > '00'                               19310000
                  WITH UR                                               19320000
              END-EXEC                                                  19330000
                                                                        19340000
              EVALUATE TRUE                                             19350000
                WHEN SQLCODE = ZEROS                                    19360000
                  CONTINUE                                              19370000
                WHEN SQLCODE  = 100                                     19380000
                  MOVE PC-PLUS-ZERO      TO SKXREF-ITM-NBR              19390000
                WHEN OTHER                                              19400000
                  MOVE '4400-GET-TSKXREF-ITM-NBR'                       19410000
                                          TO PV-PARAGRAPH-NAME          19420000
                  MOVE 'SELECT ITEM FROM TSKXREF'                       19430000
                                   TO PV-DB2-OPERATION-ATTEMPTED        19440000
                  DISPLAY '*******************************'             19450000
                  DISPLAY 'SKU NUMBER = ' SKXREF-SKU                    19460000
                  DISPLAY '*******************************'             19470000
                  PERFORM 2800-ROLLBACK-DATA                            19480000
                  PERFORM 2900-SEND-ALERT                               19490000
                  PERFORM 3100-BACK-OUT-MQV-CHANGES                     19500000
                  PERFORM 9100-CLOSE-QUEUES                             19510000
                  PERFORM 9200-DISCONNECT-QMGR                          19520000
                  PERFORM 9999-SQL-ABEND                                19530000
              END-EVALUATE                                              19540000
           END-PERFORM.                                                 19550000
                                                                        19560000
           IF  PV-RETRY-CNT > PC-MAX-RETRIES                            19570000
               MOVE '4400-GET-TSKXREF-ITM-NBR'                          19580000
                                TO PV-PARAGRAPH-NAME                    19590000
               MOVE 'SELECT ITEM FROM TSKXREF'                          19600000
                                TO PV-DB2-OPERATION-ATTEMPTED           19610000
               DISPLAY '*******************************'                19620000
               DISPLAY 'SKU NUMBER = ' SKXREF-SKU                       19630000
               DISPLAY '*******************************'                19640000
               PERFORM 2800-ROLLBACK-DATA                               19650000
               PERFORM 2900-SEND-ALERT                                  19660000
               PERFORM 3100-BACK-OUT-MQV-CHANGES                        19670000
               PERFORM 9100-CLOSE-QUEUES                                19680000
               PERFORM 9200-DISCONNECT-QMGR                             19690000
               PERFORM 9999-SQL-ABEND                                   19700000
           END-IF.                                                      19710000
                                                                        19720000
      ******************************************************************19730000
      * ROLLBACK ANY CHANGES TO DB2 DUE TO UNSUCCESSFUL MESSAGE         19740000
      ******************************************************************19750000
       2800-ROLLBACK-DATA.                                              19760000
                                                                        19770000
           MOVE '2800-ROLLBACK-DATA' TO PV-PARAGRAPH-NAME.              19780000
                                                                        19790000
           PERFORM                                                      19800000
               WITH TEST AFTER                                          19810000
               VARYING PV-SQL-SUB                                       19820000
               FROM 1 BY 1                                              19830000
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 19840000
                         OR  SQLCODE = 0)                               19850000
               EXEC SQL                                                 19860000
                    ROLLBACK                                            19870000
               END-EXEC                                                 19880000
                                                                        19890000
               EVALUATE TRUE                                            19900000
                   WHEN SQLCODE = -904                                  19910000
                   WHEN SQLCODE = -911                                  19920000
                   WHEN SQLCODE = -913                                  19930000
                   WHEN SQLCODE = 0                                     19940000
                        CONTINUE                                        19950000
                   WHEN OTHER                                           19960000
                        DISPLAY 'UNABLE TO ROLLBACK DATA'               19970000
               END-EVALUATE                                             19980000
           END-PERFORM.                                                 19990000
                                                                        20000000
           IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        20010000
               DISPLAY 'ROLLBACK RETRIES EXCEEDED'                      20020000
           END-IF.                                                      20030000
                                                                        20040000
      ******************************************************************20050000
      * 2900-SEND-ALERT.                                                20060000
      *     SEND AN E-MAIL TO SUPPORTTEAM                               20070000
      ******************************************************************20080000
       2900-SEND-ALERT.                                                 20090000
                                                                        20100000
           INITIALIZE DP023-DYNALC-PARMS.                               20110000
           MOVE 'OUT02' TO DP023-DDNAME.                                20120000
           SET DP023-DSNAME-SYSOUT TO TRUE.                             20130000
           SET DP023-FREE-CLOSE-YES TO TRUE.                            20140000
           SET DP023-RECFM-FIXED-BLOCK TO TRUE.                         20150000
           MOVE 80     TO DP023-RECSZ.                                  20160000
           MOVE 7      TO DP023-RECOUNT.                                20170000
           MOVE 'B'    TO DP023-PRINT-CLASS.                            20180000
           MOVE 'SMTP' TO DP023-PRINT-WRITER.                           20190000
           PERFORM DP023-0000-DYNALC.                                   20200000
                                                                        20210000
           OPEN OUTPUT EMAIL-MSG-FILE.                                  20220000
           WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-1.             20230000
           WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-2.             20240000
           WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-3.             20250000
           WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-4.             20260000
           WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-5.             20270000
           WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-6.             20280000
           WRITE EMAIL-MSG-FILE-RECORD FROM EM-DATA-LINE-7.             20290000
           CLOSE EMAIL-MSG-FILE.                                        20300000
                                                                        20310000
C68071******************************************************************20311007
C68071* 2910-OPEN-ERROR-FILE.                                           20312007
C68071******************************************************************20314007
C68071 2910-OPEN-ERROR-FILE.                                            20315007
C68071                                                                  20316007
C68071     IF PV-COUNTER = 1                                            20316107
C68071        INITIALIZE DP023-DYNALC-PARMS                             20317007
C68071        MOVE 'OUT04' TO DP023-DDNAME                              20318007
C68071        MOVE CC-FILE-NAME TO DP023-DSNAME                         20318107
C68071        SET DP023-FREE-CLOSE-YES TO TRUE                          20319107
C68071        SET DP023-RECFM-FIXED-BLOCK TO TRUE                       20319207
C68071        SET DP023-DISP-NEW          TO TRUE                       20319307
C68071        MOVE 400      TO DP023-RECSZ                              20319407
C68071        MOVE CC-LIMIT TO DP023-RECOUNT                            20319507
C68071        PERFORM DP023-0000-DYNALC                                 20319907
C68071                                                                  20320007
C68071        OPEN OUTPUT ERROR-MSG-FILE                                20320107
C68071                                                                  20320807
C68071     END-IF.                                                      20320907
C68071                                                                  20321007
      ******************************************************************20322000
      *  FORMATS FIELDS FOR INSERT INTO THE SALES AUDIT TABLE -         20330000
      *  BYPASS RECORDS WILL HAVE NO DATA VALIDATION PERFORMED.         20340000
      ******************************************************************20350000
       5000-FORMAT-BYPASS-TRANS.                                        20360000
                                                                        20370000
           MOVE PV-PROCESS-DATE-FMT   TO FST00005-PRCG-DTE.             20380000
           MOVE SKXREF-ITM-NBR        TO FST00005-ITM-NBR.              20390000
           MOVE PV-STORENO            TO FST00005-LOC-NBR.              20400000
           MOVE PC-DEFAULT-DATE-FMT   TO FST00005-SLS-DTE.              20410000
           MOVE PC-DEFAULT-TIME       TO FST00005-SLS-STRT-TM.          20420000
           MOVE PV-TERMINAL           TO FST00005-RGST-ID.              20430000
           MOVE PV-TRANSNO            TO FST00005-TRN-NBR.              20440000
           MOVE PV-OPERATOR           TO FST00005-ASSOC-ID.             20450000
           MOVE PV-SALE-TYPE          TO FST00005-POS-TRN-TYP-CDE.      20460000
           MOVE PV-SALE-UNITS         TO FST00005-SLD-QTY.              20470000
           MOVE PV-SALE-AMT           TO FST00005-NET-CHRGD-AMT.        20480000
           MOVE ZEROS                 TO FST00005-CUST-CHRGD-AMT.       20490000
           MOVE PV-DEPT               TO FST00005-DEPT-NBR.             20500000
           MOVE PV-MCL-NBR            TO FST00005-MAJ-CL-NBR.           20510000
           MOVE PV-SCL-NBR            TO FST00005-SUB-CL-NBR.           20520000
           MOVE SPACES                TO FST00005-FS-SLS-TYP-CDE.       20530000
           MOVE PV-ACTG-YEAR-C3       TO FST00005-ACCTG-PERD-YR.        20540000
           MOVE PV-ACTG-MONTH-C3      TO FST00005-ACCTG-PERD-MN.        20550000
           MOVE PV-ACTG-BOW-DATE      TO FST00005-ACCTG-BOW-DTE.        20560000
           MOVE PV-TRN-ERR-CODE       TO FST00005-ERR-TYP-CDE.          20570000
           MOVE PC-BYPASS-TRN         TO FST00005-TRN-STAT-CDE.         20580000
           MOVE SPACES                TO FST00005-SKU-STAT-CDE.         20590000
                                                                        20600000
                                                                        20610000
      ******************************************************************20620000
      *  FORMATS ADDTIONAL FIELDS NEED FOR THE INSERT INTO THE          20630000
      *  SALES AUDIT TABLE.                                             20640000
      ******************************************************************20650000
       5100-FORMAT-AUDIT-TRANS.                                         20660000
                                                                        20670000
           MOVE PV-PROCESS-DATE-FMT   TO FST00005-PRCG-DTE.             20680000
           MOVE SKXREF-ITM-NBR        TO FST00005-ITM-NBR.              20690000
           MOVE PV-LOC-NBR            TO FST00005-LOC-NBR.              20700000
           MOVE PV-INPUT-DATE-FMT     TO FST00005-SLS-DTE.              20710000
           MOVE PV-TRAN-TIME-FMT      TO FST00005-SLS-STRT-TM.          20720000
           MOVE PV-TERMINAL           TO FST00005-RGST-ID.              20730000
           MOVE PV-TRANSNO            TO FST00005-TRN-NBR.              20740000
           MOVE PV-OPERATOR           TO FST00005-ASSOC-ID.             20750000
           MOVE PV-SALE-TYPE          TO FST00005-POS-TRN-TYP-CDE.      20760000
           MOVE PV-SALE-UNITS         TO FST00005-SLD-QTY.              20770000
           MOVE PV-SALE-AMT           TO FST00005-NET-CHRGD-AMT.        20780000
      *** CUSTOMER CHARGED AMOUNT IS CURRENTLY NOT BEING PASSED.        20790000
      *** FUTURE ENHANCEMENT.                                           20800000
           MOVE ZEROS                 TO FST00005-CUST-CHRGD-AMT.       20810000
           MOVE SKXREF-DEPT           TO FST00005-DEPT-NBR.             20820000
           MOVE SKXREF-CLASS          TO FST00005-MAJ-CL-NBR.           20830000
           MOVE SKXREF-SUBCLASS       TO FST00005-SUB-CL-NBR.           20840000
           MOVE PV-SALES-TYPE         TO FST00005-FS-SLS-TYP-CDE.       20850000
           MOVE PV-ACTG-YEAR-C3       TO FST00005-ACCTG-PERD-YR.        20860000
           MOVE PV-ACTG-MONTH-C3      TO FST00005-ACCTG-PERD-MN.        20870000
           MOVE PV-ACTG-BOW-DATE      TO FST00005-ACCTG-BOW-DTE.        20880000
           MOVE PV-TRN-ERR-CODE       TO FST00005-ERR-TYP-CDE.          20890000
           MOVE PC-AUDIT-TRN          TO FST00005-TRN-STAT-CDE.         20900000
           IF UPC-REGN-PRIC-IND = 'Y'                                   20910000
              MOVE PV-RCP-STATUS-CDE     TO FST00005-SKU-STAT-CDE       20920000
           ELSE                                                         20930000
              MOVE UPCPLS-UPC-STAT-CDE   TO FST00005-SKU-STAT-CDE       20940000
           END-IF.                                                      20950000
                                                                        20960000
           ADD PV-SALE-UNITS       TO PV-TRANS-SALES-QTY.               20970000
           ADD PV-SALE-AMT         TO PV-TRANS-SALES-AMT.               20980000
                                                                        20990000
                                                                        21000000
      ******************************************************************21010000
      *  FORMATS FIELDS FOR INSERT INTO THE SALES AUDIT TABLE -         21020000
      *  ERROR RECORDS WILL BE POPULATED WITH INPUT RECORD FIELDS.      21030000
      ******************************************************************21040000
       5200-FORMAT-ERROR-TRANS.                                         21050000
                                                                        21060000
           MOVE PV-PROCESS-DATE-FMT   TO FST00005-PRCG-DTE.             21070000
           MOVE SKXREF-ITM-NBR        TO FST00005-ITM-NBR.              21080000
           MOVE PV-STORENO            TO FST00005-LOC-NBR.              21090000
           MOVE PV-INPUT-DATE-FMT     TO FST00005-SLS-DTE.              21100000
           MOVE PV-TRAN-TIME-FMT      TO FST00005-SLS-STRT-TM.          21110000
           MOVE PV-TERMINAL           TO FST00005-RGST-ID.              21120000
           MOVE PV-TRANSNO            TO FST00005-TRN-NBR.              21130000
           MOVE PV-OPERATOR           TO FST00005-ASSOC-ID.             21140000
           MOVE PV-SALE-TYPE          TO FST00005-POS-TRN-TYP-CDE.      21150000
           MOVE PV-SALE-UNITS         TO FST00005-SLD-QTY.              21160000
           MOVE PV-SALE-AMT           TO FST00005-NET-CHRGD-AMT.        21170000
           MOVE ZEROS                 TO FST00005-CUST-CHRGD-AMT.       21180000
           MOVE PV-DEPT               TO FST00005-DEPT-NBR.             21190000
           MOVE PV-MCL-NBR            TO FST00005-MAJ-CL-NBR.           21200000
           MOVE PV-SCL-NBR            TO FST00005-SUB-CL-NBR.           21210000
           MOVE SPACES                TO FST00005-FS-SLS-TYP-CDE.       21220000
           MOVE PV-ACTG-YEAR-C3       TO FST00005-ACCTG-PERD-YR.        21230000
           MOVE PV-ACTG-MONTH-C3      TO FST00005-ACCTG-PERD-MN.        21240000
           MOVE PV-ACTG-BOW-DATE      TO FST00005-ACCTG-BOW-DTE.        21250000
           MOVE PV-TRN-ERR-CODE       TO FST00005-ERR-TYP-CDE.          21260000
           MOVE PC-ERROR-TRN          TO FST00005-TRN-STAT-CDE.         21270000
           IF UPC-REGN-PRIC-IND = 'Y'                                   21280000
              MOVE PV-RCP-STATUS-CDE     TO FST00005-SKU-STAT-CDE       21290000
           ELSE                                                         21300000
              MOVE UPCPLS-UPC-STAT-CDE   TO FST00005-SKU-STAT-CDE       21310000
           END-IF.                                                      21320000
                                                                        21330000
           ADD PV-SALE-UNITS       TO PV-ERROR-SALES-QTY.               21340000
           ADD PV-SALE-AMT         TO PV-ERROR-SALES-AMT.               21350000
                                                                        21360000
                                                                        21370000
      ******************************************************************21380000
      * 6000-RETRIEVE-MESSAGE.                                          21390000
      *     RETRIEVES THE NEXT MESSAGE FROM THE SALES QUEUE.            21400000
      ******************************************************************21410000
       6000-RETRIEVE-MESSAGE.                                           21420000
                                                                        21430000
           INITIALIZE MQV-MSGBUFFER                                     21440000
                      MQV-COMPLETION-CODE.                              21450000
                                                                        21460000
           MOVE PC-MSGLENGTH         TO MQV-MSG-LENGTH.                 21470000
           MOVE MQMI-NONE            TO MQMD-MSGID.                     21480000
           MOVE MQCI-NONE            TO MQMD-CORRELID.                  21490000
           MOVE CC-SALES-QUEUE-NAME  TO MQOD-OBJECTNAME.                21500000
           MOVE TCKRSTCNTL-TRANS-PRCSD-QTY                              21510000
                                     TO MQGMO-WAITINTERVAL.             21520000
                                                                        21530000
           COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  21540000
                                     MQGMO-WAIT.                        21550000
                                                                        21560000
           CALL MQV-MQGET USING MQV-HCONN                               21570000
                                MQV-GQ-HANDLE                           21580000
                                MQM-MESSAGE-DESCRIPTOR                  21590000
                                MQM-GET-MESSAGE-OPTIONS                 21600000
                                MQV-MSG-LENGTH                          21610000
                                MQV-MSGBUFFER                           21620000
                                MQV-DATA-LENGTH                         21630000
                                MQV-COMPLETION-CODE                     21640000
                                MQV-REASON.                             21650000
                                                                        21660000
           IF  MQV-COMPLETION-CODE = MQCC-OK                            21670000
               SET PS-MESSAGE-RECEIVED TO TRUE                          21680000
               ADD +1             TO PV-MESSAGE-FROM-QUEUE              21690000
               ADD +1             TO PV-MSG-COUNT                       21700000
                                                                        21710000
               EVALUATE TRUE                                            21720000
                  WHEN MQV-MSGBUFFER(1:19) = PC-END-PGM-MSG             21730000
                     SET PS-END-OF-TASK TO TRUE                         21740000
                     SET PV-RETURN-4095-END-DAY-MSG TO TRUE             21750000
                  WHEN MQV-MSGBUFFER(1:13) = PC-STOP-MSG                21760000
                     SET PS-END-OF-TASK TO TRUE                         21770000
                     SET PV-RETURN-4094-STOP-MSG TO TRUE                21780000
                  WHEN MQV-MSGBUFFER(1:18) = PC-FORCEEND                21790000
                     SET PS-END-OF-TASK TO TRUE                         21800000
                     SET PV-RETURN-4090-FORCE-END-MSG TO TRUE           21810000
                  WHEN OTHER                                            21820000
                     MOVE MQV-MSGBUFFER TO F053-SALES-RECORD            21830000
                     PERFORM 2050-COMPUTE-DETAIL-LENGTH                 21840000
               END-EVALUATE                                             21850000
                                                                        21860000
           ELSE                                                         21870000
               MOVE 'N' TO PS-MESSAGE-RECEIVED-SW                       21880000
               EVALUATE TRUE                                            21890000
                  WHEN MQV-REASON = MQRC-Q-MGR-QUIESCING                21900000
                  WHEN MQV-REASON = MQRC-Q-MGR-STOPPING                 21910000
                       CONTINUE                                         21920000
                  WHEN MQV-REASON = MQRC-NO-MSG-AVAILABLE               21930000
      *                DISPLAY 'NO MORE MESSAGES AVAILABLE'             21940000
                       IF PV-MSG-COUNT > 0                              21950000
                           PERFORM 2540-COMMIT-DATA                     21960000
                           PERFORM 3000-COMMIT-MQ                       21970000
                           INITIALIZE PV-MSG-COUNT                      21980000
                       END-IF                                           21990000
                  WHEN OTHER                                            22000000
                       CALL MQV-MQCHECK USING MQV-REASON                22010000
                                              MQV-REASON-TEXT           22020000
                       MOVE '6000-RETRIEVE-MESSAGE' TO PV-PARAGRAPH-NAME22030000
                       MOVE 'ERROR RETRIEVING MESSAGE'                  22040000
                                             TO PV-OPERATION-MSG-1      22050000
                       MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE22060000
                       MOVE MQV-REASON             TO PV-REASON         22070000
                       MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT    22080000
                       PERFORM 2900-SEND-ALERT                          22090000
                       PERFORM 3100-BACK-OUT-MQV-CHANGES                22100000
                       PERFORM 9100-CLOSE-QUEUES                        22110000
                       PERFORM 9200-DISCONNECT-QMGR                     22120000
                       PERFORM 9400-MQ-ABEND                            22130000
               END-EVALUATE                                             22140000
           END-IF.                                                      22150000
                                                                        22160000
      ******************************************************************22170000
      *  SELECT FROM THE CHECKPOINT RESTART CONTROL TABLE TO SEE IF     22180000
      *  THE PROGRAM IS IN A RESTART CONDITION.                         22190000
      ******************************************************************22200000
       7000-INIT-CHECKPOINT-SELECT.                                     22210000
                                                                        22220000
           EXEC SQL                                                     22230000
             SELECT                                                     22240000
                  CKPT_FRQNCY_QTY                                       22250000
                 ,TRANS_QTY                                             22260000
                 ,TRANS_PRCSD_QTY                                       22270000
               INTO                                                     22280000
                 :TCKRSTCNTL-CKPT-FRQNCY-QTY                            22290000
                ,:TCKRSTCNTL-TRANS-QTY                                  22300000
                ,:TCKRSTCNTL-TRANS-PRCSD-QTY                            22310000
               FROM  TCKRSTCNTL                                         22320000
              WHERE  JOB_NAME  = :PC-JOB-NAME                           22330000
                AND  PLAN_NAME = :PC-CURRENT-PROGRAM-NAME               22340000
           END-EXEC.                                                    22350000
                                                                        22360000
           EVALUATE TRUE                                                22370000
               WHEN SQLCODE = ZERO                                      22380000
                   CONTINUE                                             22390000
               WHEN OTHER                                               22400000
                   MOVE '7000-INIT-CHECKPOINT-SELECT '                  22410000
                     TO  PV-PARAGRAPH-NAME                              22420000
                   MOVE 'ERROR ON SELECT OF TCKRSTCNTL '                22430000
                     TO  PV-DB2-OPERATION-ATTEMPTED                     22440000
                   PERFORM 9999-SQL-ABEND                               22450000
           END-EVALUATE.                                                22460000
                                                                        22470000
      ******************************************************************22480000
      *  GET THE COMMIT TIMESTAMP FROM THE CHECKPOINT CONTROL TABLE     22490000
      ******************************************************************22500000
       7100-GET-COMMIT-TIMESTAMP.                                       22510000
                                                                        22520000
           EXEC SQL                                                     22530000
             SET :PV-COMMIT-TIMESTAMP = CURRENT TIMESTAMP +             22540000
                 :TCKRSTCNTL-CKPT-FRQNCY-QTY SECONDS                    22550000
           END-EXEC.                                                    22560000
                                                                        22570000
           IF SQLCODE = 0                                               22580000
               CONTINUE                                                 22590000
           ELSE                                                         22600000
               MOVE '7100-GET-COMMIT-TIMESTAMP '                        22610000
                 TO  PV-PARAGRAPH-NAME                                  22620000
               MOVE 'ERROR ON SELECT OF TIMESTAMP '                     22630000
                 TO  PV-DB2-OPERATION-ATTEMPTED                         22640000
               PERFORM 9999-SQL-ABEND                                   22650000
           END-IF.                                                      22660000
                                                                        22670000
      ******************************************************************22680000
      *  GET THE CURRENT TIMESTAMP FROM DB2                             22690000
      ******************************************************************22700000
       7200-SET-CURRENT-TIMESTAMP.                                      22710000
                                                                        22720000
           EXEC SQL                                                     22730000
                SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           22740000
           END-EXEC.                                                    22750000
                                                                        22760000
           IF SQLCODE = 0                                               22770000
               CONTINUE                                                 22780000
           ELSE                                                         22790000
               MOVE '7200-SET-CURRENT-TIMESTAMP '                       22800000
                 TO  PV-PARAGRAPH-NAME                                  22810000
               MOVE 'ERROR ON SET OF TIMESTAMP '                        22820000
                 TO  PV-DB2-OPERATION-ATTEMPTED                         22830000
               PERFORM 9999-SQL-ABEND                                   22840000
           END-IF.                                                      22850000
                                                                        22860000
                                                                        22870000
OCFSFS******************************************************************22880000
OCFSFS*   INSERT A ROW TO TABLE FSTT_OH_ADJ_AUD                         22890000
OCFSFS******************************************************************22900000
OCFSFS 7900-INSERT-ADJ-TRANS.                                           22910000
OCFSFS                                                                  22920000
OCFSFS     MOVE '7900-INSERT-ADJ-TRANS' TO PV-PARAGRAPH-NAME.           22930000
OCFSFS                                                                  22940000
OCFSFS     EXEC SQL                                                     22950000
OCFSFS         INSERT INTO  FSTT_OH_ADJ_AUD                             22960000
OCFSFS                    ( PRCG_DTE                                    22970000
OCFSFS                     ,ITM_NBR                                     22980000
OCFSFS                     ,LOC_NBR                                     22990000
OCFSFS                     ,ADJ_TYP_CDE                                 23000000
OCFSFS                     ,ACTN_CDE                                    23010000
OCFSFS                     ,ADJ_QTY                                     23020000
OCFSFS                     ,BTCH_NBR                                    23030000
OCFSFS                     ,UNT_BKG_CDE                                 23040000
OCFSFS                     ,DEPT_NBR                                    23050000
OCFSFS                     ,MAJ_CL_NBR                                  23060000
OCFSFS                     ,SUB_CL_NBR                                  23070000
OCFSFS                     ,SRC_PGM_NM                                  23080000
OCFSFS                     ,ERR_TYP_CDE                                 23090000
OCFSFS                     ,CRE_TMST                                    23100000
OCFSFS                     ,TRN_STAT_CDE                                23110000
OCFSFS                     ,LAST_UPD_TMST)                              23120000
OCFSFS             VALUES ( :FST00003-PRCG-DTE                          23130000
OCFSFS                     ,:FST00003-ITM-NBR                           23140000
OCFSFS                     ,:FST00003-LOC-NBR                           23150000
OCFSFS                     ,:FST00003-ADJ-TYP-CDE                       23160000
OCFSFS                     ,:FST00003-ACTN-CDE                          23170000
OCFSFS                     ,:FST00003-ADJ-QTY                           23180000
OCFSFS                     ,:FST00003-BTCH-NBR                          23190000
OCFSFS                     ,:FST00003-UNT-BKG-CDE                       23200000
OCFSFS                     ,:FST00003-DEPT-NBR                          23210000
OCFSFS                     ,:FST00003-MAJ-CL-NBR                        23220000
OCFSFS                     ,:FST00003-SUB-CL-NBR                        23230000
OCFSFS                     ,:FST00003-SRC-PGM-NM                        23240000
OCFSFS                     ,:FST00003-ERR-TYP-CDE                       23250000
OCFSFS                     , CURRENT TIMESTAMP                          23260000
OCFSFS                     ,:FST00003-TRN-STAT-CDE                      23270000
OCFSFS                     , CURRENT TIMESTAMP)                         23280000
OCFSFS     END-EXEC.                                                    23290000
OCFSFS                                                                  23300000
OCFSFS     EVALUATE SQLCODE                                             23310000
OCFSFS       WHEN +0                                                    23320000
OCFSFS             ADD +1 TO PV-INSERT-ADJ-CNT                          23330000
OCFSFS       WHEN OTHER                                                 23340000
OCFSFS             MOVE 'INSERT TO FSTT_OH_ADJ_AUD' TO                  23350000
OCFSFS                   PV-DB2-OPERATION-ATTEMPTED                     23360000
OCFSFS             PERFORM 9999-SQL-ABEND                               23370000
OCFSFS     END-EVALUATE.                                                23380000
                                                                        23390000
      ******************************************************************23400000
      *   SELECT/VALIDATE ITEM INFORMATION.                             23410000
      ******************************************************************23420000
       8000-SELECT-ITEM.                                                23430000
                                                                        23440000
           INITIALIZE SKXREF-ITM-NBR                                    23450000
                      UPC-REGN-PRIC-IND                                 23460000
                      UPCPLS-UPC-STAT-CDE.                              23470000
                                                                        23480000
           MOVE PV-SKU TO SKXREF-SKU.                                   23490000
                                                                        23500000
           MOVE ZERO TO PV-RETRY-CNT.                                   23510000
                                                                        23520000
           PERFORM WITH TEST AFTER                                      23530000
               VARYING PV-RETRY-CNT FROM 1 BY 1                         23540000
                 UNTIL PV-RETRY-CNT > PC-MAX-RETRIES                    23550000
                    OR SQLCODE = +0                                     23560000
                    OR SQLCODE = +100                                   23570000
               EXEC SQL                                                 23580000
                 SELECT C.UPC_STAT_CDE                                  23590000
                      , A.DEPT                                          23600000
                      , A.CLASS                                         23610000
                      , A.SUBCLASS                                      23620000
                      , B.REGN_PRIC_IND                                 23630000
                      , C.UNT_RTL_AMT                                   23640000
                      , A.INTR_UPC_ID                                   23650000
                      , A.ITM_NBR                                       23660000
                   INTO :UPCPLS-UPC-STAT-CDE                            23670000
                      , :SKXREF-DEPT                                    23680000
                      , :SKXREF-CLASS                                   23690000
                      , :SKXREF-SUBCLASS                                23700000
                      , :UPC-REGN-PRIC-IND                              23710000
                      , :UPCPLS-UNT-RTL-AMT                             23720000
                      , :SKXREF-INTR-UPC-ID                             23730000
                      , :SKXREF-ITM-NBR                                 23740000
                   FROM TSKXREF A                                       23750000
                       ,TUPC B                                          23760000
                       ,TUPCPLS C                                       23770000
                  WHERE A.SKU = :SKXREF-SKU                             23780000
                    AND A.INTR_UPC_ID = B.UPC_ID                        23790000
                    AND A.INTR_UPC_ID = C.UPC_ID                        23800000
                    AND C.STR_NBR = 0                                   23810000
                    AND ((:PV-PROCESS-DATE-FMT >= B.EFF_BEG_DTE) AND    23820000
                         ((:PV-PROCESS-DATE-FMT <= B.EFF_END_DTE) OR    23830000
                          (B.EFF_END_DTE IS NULL)))                     23840000
                    AND ((:PV-PROCESS-TMST >= C.EFF_BEG_TMST) AND       23850000
                         ((:PV-PROCESS-TMST <= C.EFF_END_TMST) OR       23860000
                          (C.EFF_END_TMST IS NULL)))                    23870000
                  WITH UR                                               23880000
               END-EXEC                                                 23890000
                                                                        23900000
               EVALUATE SQLCODE                                         23910000
                   WHEN +0                                              23920000
                       ADD  +1              TO PV-TSKXREF-SELECT-CNT    23930000
                       IF  UPCPLS-UPC-STAT-CDE = '98'                   23940000
                           PERFORM 8100-SELECT-RENUM-ITEM               23950000
                       END-IF                                           23960000
                   WHEN +100                                            23970000
                       MOVE '004' TO PV-TRN-ERR-CODE                    23980000
                       ADD  +1    TO PV-TRN-ERR-004-CNT                 23990000
                       ADD  +1    TO PV-TSKXREF-SELECT-CNT              24000000
                       ADD  +1    TO PV-TSKXREF-ITM-NOT-FND-CNT         24010000
                   WHEN -904                                            24020000
                   WHEN -911                                            24030000
                   WHEN -913                                            24040000
                       CONTINUE                                         24050000
                   WHEN OTHER                                           24060000
                       MOVE '8000-SELECT-ITEM'                          24070000
                                        TO PV-PARAGRAPH-NAME            24080000
                       MOVE 'SELECT ITEM FROM TSKXREF'                  24090000
                                        TO PV-DB2-OPERATION-ATTEMPTED   24100000
                       DISPLAY '*******************************'        24110000
                       DISPLAY 'SKU NUMBER = ' SKXREF-SKU               24120000
                       DISPLAY '*******************************'        24130000
                       PERFORM 2800-ROLLBACK-DATA                       24140000
                       PERFORM 2900-SEND-ALERT                          24150000
                       PERFORM 3100-BACK-OUT-MQV-CHANGES                24160000
                       PERFORM 9100-CLOSE-QUEUES                        24170000
                       PERFORM 9200-DISCONNECT-QMGR                     24180000
                       PERFORM 9999-SQL-ABEND                           24190000
               END-EVALUATE                                             24200000
           END-PERFORM.                                                 24210000
                                                                        24220000
           IF  PV-RETRY-CNT > PC-MAX-RETRIES                            24230000
               MOVE '8000-SELECT-ITEM'                                  24240000
                                TO PV-PARAGRAPH-NAME                    24250000
               MOVE 'SELECT ITEM FROM TSKXREF'                          24260000
                                TO PV-DB2-OPERATION-ATTEMPTED           24270000
               DISPLAY '*******************************'                24280000
               DISPLAY 'SKU NUMBER = ' SKXREF-SKU                       24290000
               DISPLAY '*******************************'                24300000
               PERFORM 2800-ROLLBACK-DATA                               24310000
               PERFORM 2900-SEND-ALERT                                  24320000
               PERFORM 3100-BACK-OUT-MQV-CHANGES                        24330000
               PERFORM 9100-CLOSE-QUEUES                                24340000
               PERFORM 9200-DISCONNECT-QMGR                             24350000
               PERFORM 9999-SQL-ABEND                                   24360000
           END-IF.                                                      24370000
                                                                        24380000
      ******************************************************************24390000
      *  FOR ITEMS WITH A STATUS OF '98', SELECT THE RENUMBERED ITEM    24400000
      *  FROM TSKST.                                                    24410000
      ******************************************************************24420000
       8100-SELECT-RENUM-ITEM.                                          24430000
                                                                        24440000
           MOVE PV-SKU TO SKXREF-SKU.                                   24450000
                                                                        24460000
           MOVE ZERO TO PV-RETRY-CNT.                                   24470000
                                                                        24480000
           PERFORM WITH TEST AFTER                                      24490000
               VARYING PV-RETRY-CNT FROM 1 BY 1                         24500000
                 UNTIL PV-RETRY-CNT > PC-MAX-RETRIES                    24510000
                    OR SQLCODE = +0                                     24520000
                    OR SQLCODE = +100                                   24530000
               EXEC SQL                                                 24540000
                 SELECT B.ITM_NBR                                       24550000
                       ,D.UPC_STAT_CDE                                  24560000
                       ,B.DEPT                                          24570000
                       ,B.CLASS                                         24580000
                       ,B.SUBCLASS                                      24590000
                       ,C.REGN_PRIC_IND                                 24600000
                       ,D.UNT_RTL_AMT                                   24610000
                       ,A.INTR_UPC_ID                                   24620000
                   INTO :SKXREF-ITM-NBR                                 24630000
                       ,:UPCPLS-UPC-STAT-CDE                            24640000
                       ,:SKXREF-DEPT                                    24650000
                       ,:SKXREF-CLASS                                   24660000
                       ,:SKXREF-SUBCLASS                                24670000
                       ,:UPC-REGN-PRIC-IND                              24680000
                       ,:UPCPLS-UNT-RTL-AMT                             24690000
                       ,:SKXREF-INTR-UPC-ID                             24700000
                   FROM TSKXREF A                                       24710000
                       ,TSKXREF B                                       24720000
                       ,TUPC C                                          24730000
                       ,TUPCPLS D                                       24740000
                  WHERE A.SKU      = :SKXREF-SKU                        24750000
                    AND A.INTR_UPC_ID = B.INTR_UPC_ID                   24760000
                    AND B.SKU_STAT_CDE NOT IN ('98')                    24770000
                    AND B.INTR_UPC_ID = C.UPC_ID                        24780000
                    AND B.INTR_UPC_ID = D.UPC_ID                        24790000
                    AND D.STR_NBR = 0                                   24800000
                    AND ((:PV-PROCESS-DATE-FMT >= C.EFF_BEG_DTE) AND    24810000
                         ((:PV-PROCESS-DATE-FMT <= C.EFF_END_DTE) OR    24820000
                          (C.EFF_END_DTE IS NULL)))                     24830000
                    AND ((:PV-PROCESS-TMST >= D.EFF_BEG_TMST) AND       24840000
                         ((:PV-PROCESS-TMST <= D.EFF_END_TMST) OR       24850000
                          (D.EFF_END_TMST IS NULL)))                    24860000
                  WITH UR                                               24870000
               END-EXEC                                                 24880000
                                                                        24890000
               EVALUATE SQLCODE                                         24900000
                   WHEN +0                                              24910000
                       ADD  +1    TO PV-TSKXREF-SEL-RENUM-CNT           24920000
                   WHEN +100                                            24930000
                       MOVE '005' TO PV-TRN-ERR-CODE                    24940000
                       ADD  +1    TO PV-TRN-ERR-005-CNT                 24950000
                       ADD  +1    TO PV-TSKXREF-SEL-RENUM-CNT           24960000
                       ADD  +1    TO PV-TSKXREF-RENUM-NOT-FND-CNT       24970000
                   WHEN -904                                            24980000
                   WHEN -911                                            24990000
                   WHEN -913                                            25000000
                       CONTINUE                                         25010000
                   WHEN OTHER                                           25020000
                       MOVE '8100-SELECT-RENUM-ITEM'                    25030000
                                        TO PV-PARAGRAPH-NAME            25040000
                       MOVE 'SELECT RENUM ITEM FROM TSKXREF'            25050000
                                        TO PV-DB2-OPERATION-ATTEMPTED   25060000
                       DISPLAY '*******************************'        25070000
                       DISPLAY 'SKU NUMBER = ' SKXREF-SKU               25080000
                       DISPLAY '*******************************'        25090000
                       PERFORM 2800-ROLLBACK-DATA                       25100000
                       PERFORM 2900-SEND-ALERT                          25110000
                       PERFORM 3100-BACK-OUT-MQV-CHANGES                25120000
                       PERFORM 9100-CLOSE-QUEUES                        25130000
                       PERFORM 9200-DISCONNECT-QMGR                     25140000
                       PERFORM 9999-SQL-ABEND                           25150000
               END-EVALUATE                                             25160000
                                                                        25170000
           END-PERFORM.                                                 25180000
                                                                        25190000
           IF  PV-RETRY-CNT > PC-MAX-RETRIES                            25200000
               MOVE '8100-SELECT-RENUM-ITEM'                            25210000
                                TO PV-PARAGRAPH-NAME                    25220000
               MOVE 'SELECT RENUM ITEM FROM TSKXREF'                    25230000
                                TO PV-DB2-OPERATION-ATTEMPTED           25240000
               DISPLAY '*******************************'                25250000
               DISPLAY 'SKU NUMBER = ' SKXREF-SKU                       25260000
               DISPLAY '*******************************'                25270000
               PERFORM 2800-ROLLBACK-DATA                               25280000
               PERFORM 2900-SEND-ALERT                                  25290000
               PERFORM 3100-BACK-OUT-MQV-CHANGES                        25300000
               PERFORM 9100-CLOSE-QUEUES                                25310000
               PERFORM 9200-DISCONNECT-QMGR                             25320000
               PERFORM 9999-SQL-ABEND                                   25330000
           END-IF.                                                      25340000
                                                                        25350000
                                                                        25360000
                                                                        25370000
      ******************************************************************25380000
      *   GET RCP UNIT RETAIL AMOUNT ON THE SPECIFIC STORE THAT IS      25390000
      *   REGIONALLY CLEARANCE PRICED.                                  25400000
      ******************************************************************25410000
       8200-SELECT-RCP-AMT.                                             25420000
                                                                        25430000
           PERFORM WITH TEST AFTER                                      25440000
           VARYING PV-RETRY-CNT FROM 1 BY 1                             25450000
             UNTIL PV-RETRY-CNT > PC-MAX-RETRIES                        25460000
                OR SQLCODE = +0                                         25470000
                OR SQLCODE = +100                                       25480000
              EXEC  SQL                                                 25490000
                    SELECT UNT_RTL_AMT                                  25500000
                    INTO  :PV-RCP-UNT-RTL-AMT                           25510000
                    FROM   TUPCPLS                                      25520000
                    WHERE  UPC_ID        = :SKXREF-INTR-UPC-ID          25530000
                    AND    STR_NBR       = :PV-LOC-NBR                  25540000
                    AND  ((EFF_BEG_TMST <= :PV-PROCESS-TMST             25550000
                    AND    EFF_END_TMST >= :PV-PROCESS-TMST)            25560000
                    OR    (EFF_BEG_TMST <= :PV-PROCESS-TMST             25570000
                    AND    EFF_END_TMST IS NULL)) WITH UR               25580000
              END-EXEC                                                  25590000
                                                                        25600000
             EVALUATE TRUE                                              25610000
                 WHEN SQLCODE = ZERO                                    25620000
                    ADD  +1    TO PV-TUPCPLS-SEL-CNT                    25630000
                    MOVE PC-RCP-STATUS-CDE-CLR TO  PV-RCP-STATUS-CDE    25640000
                    MOVE PV-RCP-UNT-RTL-AMT    TO  PV-RCP-UNT-RTL-AMT-9 25650000
                 WHEN SQLCODE = +100                                    25660000
                    MOVE PC-RCP-STATUS-CDE-ACTIVE TO  PV-RCP-STATUS-CDE 25670000
                    ADD  +1    TO PV-TUPCPLS-SEL-CNT                    25680000
                 WHEN SQLWARN0 NOT = SPACES                             25690000
                 WHEN SQLCODE = -911                                    25700000
                 WHEN SQLCODE = -904                                    25710000
                     CONTINUE                                           25720000
                 WHEN OTHER                                             25730000
                   MOVE '8200-GET-RCP-AMT' TO PV-PARAGRAPH-NAME         25740000
                   MOVE 'SELECT UNIT RETAIL AMOUNT' TO                  25750000
                         PV-DB2-OPERATION-ATTEMPTED                     25760000
                   DISPLAY '*******************************'            25770000
                   DISPLAY 'ITEM NUMBER = ' SKXREF-ITM-NBR              25780000
                   DISPLAY 'STORE NUMBER = ' PV-LOC-NBR                 25790000
                   DISPLAY '*******************************'            25800000
                   PERFORM 2800-ROLLBACK-DATA                           25810000
                   PERFORM 2900-SEND-ALERT                              25820000
                   PERFORM 3100-BACK-OUT-MQV-CHANGES                    25830000
                   PERFORM 9100-CLOSE-QUEUES                            25840000
                   PERFORM 9200-DISCONNECT-QMGR                         25850000
                   PERFORM 9999-SQL-ABEND                               25860000
             END-EVALUATE                                               25870000
           END-PERFORM.                                                 25880000
      *                                                                 25890000
           IF (SQLCODE = 0                                              25900000
             OR SQLCODE = +100                                          25910000
             OR SQLWARN0 = SPACES)                                      25920000
                CONTINUE                                                25930000
           ELSE                                                         25940000
                MOVE '8200-GET-RCP-AMT' TO PV-PARAGRAPH-NAME            25950000
                MOVE 'SELECT UNIT RETAIL AMOUNT' TO                     25960000
                      PV-DB2-OPERATION-ATTEMPTED                        25970000
                DISPLAY '*******************************'               25980000
                DISPLAY 'ITEM NUMBER = ' SKXREF-ITM-NBR                 25990000
                DISPLAY 'STORE NUMBER = ' PV-LOC-NBR                    26000000
                DISPLAY '*******************************'               26010000
                PERFORM 2800-ROLLBACK-DATA                              26020000
                PERFORM 2900-SEND-ALERT                                 26030000
                PERFORM 3100-BACK-OUT-MQV-CHANGES                       26040000
                PERFORM 9100-CLOSE-QUEUES                               26050000
                PERFORM 9200-DISCONNECT-QMGR                            26060000
                PERFORM 9999-SQL-ABEND                                  26070000
           END-IF.                                                      26080000
                                                                        26090000
      ******************************************************************26100000
      * 9000-WRAPUP.                                                    26110000
      *     END OF PROGRAM ROUTINE.  CLOSES ALL QUEUES, DISCONNECTS     26120000
      *     FROM THE QUEUE MANAGER, CLOSES ALL FILES, AND               26130000
      *     DISPLAYS ALL DATA.                                          26140000
      ******************************************************************26150000
       9000-WRAPUP.                                                     26160000
                                                                        26170000
           PERFORM 2540-COMMIT-DATA.                                    26180000
           PERFORM 3000-COMMIT-MQ.                                      26190000
                                                                        26200000
           PERFORM 9100-CLOSE-QUEUES.                                   26210000
           PERFORM 9200-DISCONNECT-QMGR.                                26220000
                                                                        26230000
           CLOSE CONTROL-CARD-1                                         26240000
                 CONTROL-CARD-2                                         26250000
                 CONTROL-CARD-3                                         26260000
C68071           CONTROL-CARD-4                                         26261007
                 MESSAGE-LOG                                            26270000
P3540B           RECYCLE-MSG-FILE.                                      26280000
                                                                        26290000
C68071     IF PV-COUNTER > 0                                            26291007
C68071        CLOSE ERROR-MSG-FILE                                      26292007
C68071     END-IF.                                                      26293007
C68071                                                                  26294007
           PERFORM 9600-DISPLAY-STATS.                                  26300000
                                                                        26310000
           MOVE PV-RETURN-CODE TO RETURN-CODE.                          26320000
                                                                        26330000
      ******************************************************************26340000
      * 9100-CLOSE-QUEUES.                                              26350000
      *     CLOSE SALES QUEUE.                                          26360000
      ******************************************************************26370000
       9100-CLOSE-QUEUES.                                               26380000
                                                                        26390000
           CALL MQV-MQCLOSE USING MQV-HCONN                             26400000
                                  MQV-GQ-HANDLE                         26410000
                                  MQCO-NONE                             26420000
                                  MQV-COMPLETION-CODE                   26430000
                                  MQV-REASON.                           26440000
                                                                        26450000
           EVALUATE TRUE                                                26460000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        26470000
                   CONTINUE                                             26480000
              WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                26490000
                   CALL MQV-MQCHECK USING MQV-REASON                    26500000
                                          MQV-REASON-TEXT               26510000
                   MOVE '9100-CLOSE-QUEUES' TO PV-PARAGRAPH-NAME        26520000
                   MOVE 'CANNOT CLOSE SALES QUEUE'                      26530000
                                          TO PV-OPERATION-MSG-1         26540000
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    26550000
                   MOVE MQV-REASON             TO PV-REASON             26560000
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        26570000
                   PERFORM 2900-SEND-ALERT                              26580000
                   PERFORM 9400-MQ-ABEND                                26590000
           END-EVALUATE.                                                26600000
                                                                        26610000
      ******************************************************************26620000
      * 9200-DISCONNECT-QMGR.                                           26630000
      *     DISCONNECT FROM THE QUEUE MANAGER.                          26640000
      ******************************************************************26650000
       9200-DISCONNECT-QMGR.                                            26660000
                                                                        26670000
           CALL MQV-MQDISC USING MQV-HCONN                              26680000
                                 MQV-COMPLETION-CODE                    26690000
                                 MQV-REASON.                            26700000
                                                                        26710000
           EVALUATE TRUE                                                26720000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        26730000
                   CONTINUE                                             26740000
              WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                26750000
                   CALL MQV-MQCHECK USING MQV-REASON                    26760000
                                          MQV-REASON-TEXT               26770000
                   MOVE '9200-DISCONNECT-QMGR' TO PV-PARAGRAPH-NAME     26780000
                   MOVE 'MQDISC ERROR'         TO PV-OPERATION-MSG-1    26790000
                   MOVE MQV-COMPLETION-CODE    TO PV-COMPLETION-CODE    26800000
                   MOVE MQV-REASON             TO PV-REASON             26810000
                   MOVE MQV-REASON-TEXT        TO PV-REASON-TEXT        26820000
                   PERFORM 2900-SEND-ALERT                              26830000
                   PERFORM 9400-MQ-ABEND                                26840000
           END-EVALUATE.                                                26850000
                                                                        26860000
      ******************************************************************26870000
      * 9300-ABEND.                                                     26880000
      *     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  26890000
      ******************************************************************26900000
       9300-ABEND.                                                      26910000
                                                                        26920000
           DISPLAY '** ABEND           **'.                             26930000
           DISPLAY '** ABEND CODE      ** = ' ABEND-CODE.               26940000
           DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  26950000
           DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        26960000
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       26970000
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       26980000
           CALL 'ILBOABN0' USING ABEND-CODE.                            26990000
                                                                        27000000
      ******************************************************************27010000
      * 9400-MQ-ABEND.                                                  27020000
      *     MQ ABEND ROUTINE.                                           27030000
      ******************************************************************27040000
       9400-MQ-ABEND.                                                   27050000
                                                                        27060000
           PERFORM 9600-DISPLAY-STATS.                                  27070000
                                                                        27080000
           SET ABEND-4020-MQ-ERROR TO TRUE.                             27090000
           DISPLAY '**** ABEND *************************************'.  27100000
           DISPLAY '** MQSERIES ERROR **'.                              27110000
           DISPLAY '** PROGRAM:    ' PC-CURRENT-PROGRAM-NAME.           27120000
           DISPLAY '** ABEND CODE: ' ABEND-CODE.                        27130000
           DISPLAY '** PARAGRAPH:  ' PV-PARAGRAPH-NAME.                 27140000
           DISPLAY '** MESSAGE:    ' PV-OPERATION-MSG-1.                27150000
           DISPLAY '** COMP CODE:  ' PV-COMPLETION-CODE.                27160000
           DISPLAY '** RSN CODE:   ' PV-REASON.                         27170000
           DISPLAY '** RSN TEXT:   ' PV-REASON-TEXT.                    27180000
           DISPLAY '************************************************'.  27190000
           CALL 'ILBOABN0' USING ABEND-CODE.                            27200000
                                                                        27210000
      ******************************************************************27220000
      * 9600-DISPLAY-STATS.                                             27230000
      *     DISPLAY STATISTICS ON MESSAGES PROCESSED.                   27240000
      ******************************************************************27250000
       9600-DISPLAY-STATS.                                              27260000
           DISPLAY ' '.                                                 27270000
           DISPLAY '*********************************************'.     27280000
           DISPLAY 'STATS FROM PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME. 27290000
           DISPLAY '*********************************************'.     27300000
           DISPLAY 'NBR OF SUCCESSFUL MQGETS :' PV-MESSAGE-FROM-QUEUE.  27310000
           DISPLAY SPACES.                                              27320000
                                                                        27330000
           MOVE PV-SALES-INPUT-CNT       TO PV-SALES-INPUT-CNT-DISP.    27340000
           DISPLAY 'NBR OF SALES INPUT RECORDS READ     = '             27350000
                                            PV-SALES-INPUT-CNT-DISP.    27360000
                                                                        27370000
           MOVE PV-000-SKU-CNT           TO PV-000-SKU-CNT-DISP.        27380000
           DISPLAY 'NBR OF BYPASSED SKUS ENDING WITH 000 ='             27390000
                                            PV-000-SKU-CNT-DISP.        27400000
                                                                        27410000
           MOVE PV-999-SKU-CNT           TO PV-999-SKU-CNT-DISP.        27420000
           DISPLAY 'NBR OF SKUS ENDING WITH 999 ='                      27430000
                                            PV-999-SKU-CNT-DISP.        27440000
                                                                        27450000
           DISPLAY SPACES.                                              27460000
           MOVE PV-TRN-STAT-A-CNT TO PV-TRN-STAT-A-CNT-DISP.            27470000
           DISPLAY 'NBR OF AUDIT TRANSACTIONS    = '                    27480000
                                     PV-TRN-STAT-A-CNT-DISP.            27490000
                                                                        27500000
           MOVE PV-TRN-STAT-E-CNT TO PV-TRN-STAT-E-CNT-DISP.            27510000
           DISPLAY 'NBR OF ERROR TRANSACTIONS    = '                    27520000
                                     PV-TRN-STAT-E-CNT-DISP.            27530000
                                                                        27540000
           MOVE PV-TRN-STAT-B-CNT TO PV-TRN-STAT-B-CNT-DISP.            27550000
           DISPLAY 'NBR OF BYPASSED TRANSACTIONS = '                    27560000
                                     PV-TRN-STAT-B-CNT-DISP.            27570000
                                                                        27580000
P3540B     MOVE PV-TRN-STAT-R-CNT TO PV-TRN-STAT-R-CNT-DISP.            27590000
P3540B     DISPLAY 'NBR OF RECYCLED TRANSACTIONS = '                    27600000
P3540B                               PV-TRN-STAT-R-CNT-DISP.            27610000
P3540B                                                                  27620000
           DISPLAY 'NBR OF VOID AFTER RECORDS: ', PA-VOIDS.             27630000
           DISPLAY 'NBR OF LINE ITEM VOIDED RECORDS: ',                 27640000
                                         PA-LINE-ITM-VOIDS.             27650000
           DISPLAY SPACES.                                              27660000
           MOVE PV-TOTAL-SALES-QTY       TO PV-TOTAL-SALES-QTY-DISP.    27670000
           DISPLAY 'TOTAL SALES QUANTITY = '                            27680000
                                            PV-TOTAL-SALES-QTY-DISP.    27690000
                                                                        27700000
           MOVE PV-TOTAL-SALES-AMT       TO PV-TOTAL-SALES-AMT-DISP.    27710000
           DISPLAY 'TOTAL SALES AMOUNT   = '                            27720000
                                            PV-TOTAL-SALES-AMT-DISP.    27730000
                                                                        27740000
           MOVE PV-TRANS-SALES-QTY       TO PV-TRANS-SALES-QTY-DISP.    27750000
           DISPLAY 'TOTAL TRANS SALES QUANTITY = '                      27760000
                                            PV-TRANS-SALES-QTY-DISP.    27770000
                                                                        27780000
           MOVE PV-TRANS-SALES-AMT       TO PV-TRANS-SALES-AMT-DISP.    27790000
           DISPLAY 'TOTAL TRANS SALES AMOUNT   = '                      27800000
                                            PV-TRANS-SALES-AMT-DISP.    27810000
                                                                        27820000
           MOVE PV-ERROR-SALES-QTY       TO PV-ERROR-SALES-QTY-DISP.    27830000
           DISPLAY 'TOTAL ERROR SALES QUANTITY = '                      27840000
                                            PV-ERROR-SALES-QTY-DISP.    27850000
                                                                        27860000
           MOVE PV-ERROR-SALES-AMT       TO PV-ERROR-SALES-AMT-DISP.    27870000
           DISPLAY 'TOTAL ERROR SALES AMOUNT   = '                      27880000
                                            PV-ERROR-SALES-AMT-DISP.    27890000
                                                                        27900000
P3540B     MOVE PV-RECYCLE-SALES-QTY     TO PV-RECYCLE-SALES-QTY-DISP.  27910000
P3540B     DISPLAY 'TOTAL RECYCLE SALES QUANTITY = '                    27920000
P3540B                                      PV-RECYCLE-SALES-QTY-DISP.  27930000
P3540B                                                                  27940000
P3540B     MOVE PV-RECYCLE-SALES-AMT     TO PV-RECYCLE-SALES-AMT-DISP.  27950000
P3540B     DISPLAY 'TOTAL RECYCLE SALES AMOUNT   = '                    27960000
P3540B                                      PV-RECYCLE-SALES-AMT-DISP.  27970000
P3540B                                                                  27980000
           DISPLAY SPACES.                                              27990000
           MOVE PV-NORMAL-SALES-CNT      TO PV-NORMAL-SALES-CNT-DISP.   28000000
           DISPLAY 'NBR OF NORMAL SALES INPUT RECS READ = '             28010000
                                            PV-NORMAL-SALES-CNT-DISP.   28020000
                                                                        28030000
           MOVE PV-SALES-CORR-CNT        TO PV-SALES-CORR-CNT-DISP.     28040000
           DISPLAY 'NBR OF SALES CORR INPUT RECORDS READ= '             28050000
                                            PV-SALES-CORR-CNT-DISP.     28060000
                                                                        28070000
           MOVE PV-SALES-CORR-QTY        TO PV-SALES-CORR-QTY-DISP.     28080000
           DISPLAY 'TOTAL SALES CORRECTS QTY   = '                      28090000
                                            PV-SALES-CORR-QTY-DISP.     28100000
                                                                        28110000
           MOVE PV-SALES-CORR-AMT        TO PV-SALES-CORR-AMT-DISP.     28120000
           DISPLAY 'TOTAL SALES CORRECTS AMT   = '                      28130000
                                            PV-SALES-CORR-AMT-DISP.     28140000
                                                                        28150000
           MOVE PV-LATE-CORR-CNT         TO PV-LATE-CORR-CNT-DISP.      28160000
           DISPLAY 'NBR OF LATE CORR INPUT RECORDS READ= '              28170000
                                            PV-LATE-CORR-CNT-DISP.      28180000
                                                                        28190000
           MOVE PV-TSKXREF-SELECT-CNT    TO PV-TSKXREF-SELECT-CNT-DISP. 28200000
           DISPLAY 'NBR OF INITIAL SELECTS ON TSKXREF   = '             28210000
                                            PV-TSKXREF-SELECT-CNT-DISP. 28220000
                                                                        28230000
           MOVE PV-TSKXREF-ITM-NOT-FND-CNT                              28240000
                                         TO PV-TSKXREF-ITM-NF-DISP.     28250000
           DISPLAY 'NBR OF ITEMS NOT FOUND              = '             28260000
                                            PV-TSKXREF-ITM-NF-DISP.     28270000
                                                                        28280000
           MOVE PV-TSKXREF-SEL-RENUM-CNT TO                             28290000
                                         PV-TSKXREF-SEL-RENUM-CNT-DISP. 28300000
           DISPLAY 'NBR OF SELECTS ON TSKXREF FOR RENUM = '             28310000
                                         PV-TSKXREF-SEL-RENUM-CNT-DISP. 28320000
                                                                        28330000
           MOVE PV-TSKXREF-RENUM-NOT-FND-CNT TO                         28340000
                                         PV-TSKXREF-RENUM-NF-CNT-DISP.  28350000
           DISPLAY 'NBR OF RENUMBERED ITEMS NOT FOUND   = '             28360000
                                         PV-TSKXREF-RENUM-NF-CNT-DISP.  28370000
                                                                        28380000
           MOVE PV-TUPCPLS-SEL-CNT TO                                   28390000
                                         PV-TUPCPLS-SEL-CNT-DISP.       28400000
           DISPLAY 'NBR OF SELECTS ON TUPCPLS = '                       28410000
                                         PV-TUPCPLS-SEL-CNT-DISP.       28420000
                                                                        28430000
           DISPLAY SPACES.                                              28440000
           MOVE PV-INSERT-CNT     TO PV-INSERT-CNT-DISP.                28450000
           DISPLAY 'NBR OF ROWS INSERTED TO FSTT_OH_SLS_AUD = '         28460000
                                     PV-INSERT-CNT-DISP.                28470000
                                                                        28480000
OCFSFS     DISPLAY SPACES.                                              28490000
OCFSFS     MOVE PV-INSERT-ADJ-CNT TO PV-INSERT-CNT-DISP.                28500000
OCFSFS     DISPLAY 'NBR OF SFS ROWS INSERTED TO FSTT_OH_ADJ_AUD = '     28510000
OCFSFS                               PV-INSERT-CNT-DISP.                28520000
OCFSFS                                                                  28530000
           DISPLAY SPACES.                                              28540000
           MOVE PV-COMMITS-TAKEN  TO PV-COMMITS-TAKEN-DISP.             28550000
           DISPLAY 'NBR OF COMMITS TAKEN = '                            28560000
                                     PV-COMMITS-TAKEN-DISP.             28570000
                                                                        28580000
           DISPLAY SPACES.                                              28590000
           IF  PV-TRN-ERR-004-CNT > 0                                   28600000
               MOVE PV-TRN-ERR-004-CNT TO PV-TRN-ERR-004-CNT-DISP       28610000
               DISPLAY 'ERROR CODE 004 - NBR OF ERRORS = '              28620000
                                          PV-TRN-ERR-004-CNT-DISP       28630000
           END-IF.                                                      28640000
           IF  PV-TRN-ERR-005-CNT > 0                                   28650000
               MOVE PV-TRN-ERR-005-CNT TO PV-TRN-ERR-005-CNT-DISP       28660000
               DISPLAY 'ERROR CODE 005 - NBR OF ERRORS = '              28670000
                                          PV-TRN-ERR-005-CNT-DISP       28680000
           END-IF.                                                      28690000
           IF  PV-TRN-ERR-006-CNT > 0                                   28700000
               MOVE PV-TRN-ERR-006-CNT TO PV-TRN-ERR-006-CNT-DISP       28710000
               DISPLAY 'ERROR CODE 006 - NBR OF ERRORS = '              28720000
                                          PV-TRN-ERR-006-CNT-DISP       28730000
           END-IF.                                                      28740000
           IF  PV-TRN-ERR-020-CNT > 0                                   28750000
               MOVE PV-TRN-ERR-020-CNT TO PV-TRN-ERR-020-CNT-DISP       28760000
               DISPLAY 'ERROR CODE 020 - NBR OF ERRORS = '              28770000
                                          PV-TRN-ERR-020-CNT-DISP       28780000
           END-IF.                                                      28790000
           IF  PV-TRN-ERR-021-CNT > 0                                   28800000
               MOVE PV-TRN-ERR-021-CNT TO PV-TRN-ERR-021-CNT-DISP       28810000
               DISPLAY 'ERROR CODE 021 - NBR OF ERRORS = '              28820000
                                          PV-TRN-ERR-021-CNT-DISP       28830000
           END-IF.                                                      28840000
           IF  PV-TRN-ERR-022-CNT > 0                                   28850000
               MOVE PV-TRN-ERR-022-CNT TO PV-TRN-ERR-022-CNT-DISP       28860000
               DISPLAY 'ERROR CODE 022 - NBR OF ERRORS = '              28870000
                                          PV-TRN-ERR-022-CNT-DISP       28880000
           END-IF.                                                      28890000
           DISPLAY SPACES.                                              28900000
                                                                        28910000
      ******************************************************************28920000
      * 9999-SQL-ABEND.                                                 28930000
      *     SQL ABEND ROUTINE.                                          28940000
      ******************************************************************28950000
       9999-SQL-ABEND.                                                  28960000
                                                                        28970000
           PERFORM 9600-DISPLAY-STATS.                                  28980000
                                                                        28990000
           DISPLAY '** ABEND     **'.                                   29000000
           DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        29010000
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              29020000
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     29030000
                                                                        29040000
           COPY DPPD004.                                                29050000
           MOVE +4013 TO ABEND-CODE.                                    29060000
           CALL 'ILBOABN0' USING ABEND-CODE.                            29070000
                                                                        29080000
      ******************************************************************29090000
      *  DYNAMIC ALLOCATION ROUTINE                                     29100000
      ******************************************************************29110000
           COPY DPPD023.                                                29120000
