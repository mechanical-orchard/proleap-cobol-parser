000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000600******************************************************************00060004
000700 PROGRAM-ID.    CNKUT815.                                         00070099
000800 AUTHOR.        TKMA497.                                          00080007
000900 INSTALLATION.  KOHLS.                                            00090004
001000 DATE-WRITTEN   JANUARY, 2012.                                    00100099
001100 DATE-COMPILED.                                                   00110004
001200******************************************************************00120004
001300*  NEW DC - WST_ATTR_ELEM EXTRACT                                 00130099
001310*  THIS PROGRAM PROCESSES A CURSOR THROUGH TKRPRPM AND BASED      00131099
001400*  ON DATA IN FUNCT_TXT PROCESS ANOTHER CURSOR THROUGH            00140099
001410*  WST_ATTR_ELEM LOOKING FOR ROWS THAT HOLD THE DC OR EFC NUMBER  00141099
001500*  AND REPLACE IT WITH A NEW DC OR EFC NUMBER FROM THE CONTROL    00150099
001700*  CARD BEFORE WRITING THE OUTPUT FILE.                           00170099
006600******************************************************************00660004
007000 ENVIRONMENT DIVISION.                                            00700004
007100******************************************************************00710004
007200 CONFIGURATION SECTION.                                           00720004
007300*                                                                 00730004
007400 SOURCE-COMPUTER.        IBM-3090.                                00740004
007500 OBJECT-COMPUTER.        IBM-3090.                                00750004
007600*                                                                 00760004
007700 INPUT-OUTPUT SECTION.                                            00770004
007800*                                                                 00780004
007900 FILE-CONTROL.                                                    00790004
008000*                                                                 00800099
008400     SELECT WS-ATTR-ELEM-FILE-OUT                                 00840099
008500         ASSIGN TO OUT01.                                         00850004
008700*                                                                 00870004
008800******************************************************************00880004
008900 DATA DIVISION.                                                   00890004
009000******************************************************************00900004
009100 FILE SECTION.                                                    00910004
009200*                                                                 00920004
010000*                                                                 01000004
010100 FD  WS-ATTR-ELEM-FILE-OUT                                        01010099
010200     RECORDING MODE IS F                                          01020004
010300     BLOCK CONTAINS 0 RECORDS                                     01030004
010400     LABEL RECORDS ARE STANDARD.                                  01040004
010500*                                                                 01050004
010600 01  WS-ATTR-ELEM-RECORD-OUT       PIC  X(108).                   01060099
010800*                                                                 01080004
010900 WORKING-STORAGE SECTION.                                         01090004
010910 01  WS-WST00010.                                                 01091099
010920     10 WS-INTGRTN-TYP-CDE         PIC X(10).                     01092099
010930     10 WS-ATTR-DEFN-SEQ-NBR       PIC S9(4) COMP.                01093099
010940     10 WS-ATTR-ELEM-SEQ-NBR       PIC S9(9) COMP.                01094099
010950     10 WS-ATTR-ELEM-TXT           PIC X(52).                     01095099
010951*    10 WS-ATTR-ELEM-TXT.                                         01095199
010952*        49 WS-ATTR-ELEM-TXT-LEN   PIC S9(4) COMP.                01095299
010953*        49 WS-ATTR-ELEM-TXT-TEXT  PIC X(50).                     01095399
010954     10 WS-ATTR-ELEM-TXT-NULL      PIC S9(4) COMP.                01095499
010955     10 WS-ATTR-ELEM-TMST          PIC X(26).                     01095599
010956     10 WS-ATTR-ELEM-TMST-NULL     PIC S9(4) COMP.                01095699
010957     10 WS-ATTR-ELEM-NBR           PIC S9(10)V9(5) COMP-3.        01095799
010958     10 WS-ATTR-ELEM-NBR-NULL      PIC S9(4) COMP.                01095899
011000*                                                                 01100004
011100 01  PC-PROGRAM-CONSTANTS.                                        01110004
011200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)    VALUE            01120019
011300         'CNKUT815'.                                              01130099
011400                                                                  01140004
011500 01  DK-DB2-KEYS.                                                 01150099
011600     05  DK-ATTR-ELEM-SEQ-NBR       PIC S9(09)  VALUE ZERO        01160099
011700                                                   COMP.          01170099
011800     05  DK-INTGRTN-TYP-CDE         PIC  X(10)  VALUE SPACES.     01180099
012600*                                                                 01260004
012700 01  CC-CONTROL-CARD.                                             01270004
012800     05  CC-RUN-TYPE                PIC  XX.                      01280099
012801         88  CC-DC-RUN                   VALUE 'DC'.              01280199
012802         88  CC-EFC-RUN                  VALUE 'EC'.              01280299
012803     05  FILLER                     PIC  X.                       01280399
012804     05  CC-CURR-LOC                PIC  9(05).                   01280499
012810     05  CC-CURR-LOC-X REDEFINES CC-CURR-LOC                      01281099
012820                                    PIC  X(05).                   01282099
012900     05  FILLER                     PIC  X.                       01290011
013000     05  CC-NEW-LOC                 PIC  9(05).                   01300099
013010     05  CC-NEW-LOC-X REDEFINES CC-NEW-LOC                        01301099
013020                                    PIC  X(05).                   01302099
014300     05  FILLER                     PIC  X(66).                   01430099
014500*                                                                 01450004
014600*                                                                 01460004
014700 01  PS-PROGRAM-SWITCHES.                                         01470004
015000     05  PS-CONTROL-CARD-VALID-SW    PIC  X(01)    VALUE SPACE.   01500004
015100         88  PS-CONTROL-CARD-INVALID               VALUE 'N'.     01510004
015200         88  PS-CONTROL-CARD-VALID                 VALUE 'Y'.     01520004
015201     05  PS-END-OF-PARM-CSR-SW       PIC  X(01)    VALUE 'N'.     01520123
015210         88 PS-END-OF-PARM-CSR-NO                  VALUE 'N'.     01521023
015220         88 PS-END-OF-PARM-CSR-YES                 VALUE 'Y'.     01522042
015230     05  PS-END-OF-EXTRACT-CSR-SW    PIC  X(01)    VALUE 'N'.     01523099
015240         88 PS-END-OF-EXTRACT-CSR-NO               VALUE 'N'.     01524099
015250         88 PS-END-OF-EXTRACT-CSR-YES              VALUE 'Y'.     01525099
015400*                                                                 01540004
015500 01  PV-PROGRAM-VARIABLES.                                        01550004
015600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01560004
015700                                                   COMP.          01570004
015800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01580004
015821     05  PV-PRC-FUNC-CDE             PIC X(06).                   01582199
015822     05  PV-FUNC-TXT                 PIC X(25).                   01582299
015823     05  FILLER REDEFINES PV-FUNC-TXT.                            01582399
015824         10  PV-WS-INT-TYP           PIC X(10).                   01582499
015825         10  FILLER                  PIC X.                       01582599
015860         10  PV-WS-COPY-SEQ          PIC X(04).                   01586099
015861         10  PV-WS-COPY-SEQ-N REDEFINES PV-WS-COPY-SEQ            01586199
015862                                     PIC 9(04).                   01586299
015870         10  FILLER                  PIC X.                       01587099
015880         10  PV-WS-SEQ-W-DC          PIC X(04).                   01588099
015881         10  PV-WS-SEQ-W-DC-N REDEFINES PV-WS-SEQ-W-DC            01588199
015882                                     PIC 9(04).                   01588299
015890         10  FILLER                  PIC X.                       01589099
015891         10  PV-WS-NEW-SEQ           PIC X(04).                   01589199
015892         10  PV-WS-NEW-SEQ-N REDEFINES PV-WS-NEW-SEQ              01589299
015893                                     PIC 9(04).                   01589399
015900     05  PV-TKRPRPM-CNT              PIC S9(07)    VALUE ZERO     01590099
016000                                                   COMP-3.        01600004
016100     05  PV-EXTRACT-CNT              PIC S9(07)    VALUE ZERO     01610099
016200                                                   COMP-3.        01620004
016210     05  PV-TOT-EXTRACT-CNT          PIC S9(07)    VALUE ZERO     01621099
016220                                                   COMP-3.        01622099
016300     05  PV-OUTPUT-CNT               PIC S9(07)    VALUE ZERO     01630099
016400                                                   COMP-3.        01640004
016410     05  PV-DISPLAY-CNT              PIC ZZZZZZ9.                 01641099
016420     05  PV-DISPLAY-ATTR-DEFN        PIC ZZZ9.                    01642099
016430     05  PV-DISPLAY-ATTR-ELEM        PIC ZZZZZZZZ9.               01643099
016500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01650004
017200*                                                                 01720004
017300*                                                                 01730004
017400 01  PE-PROGRAM-ERROR-MESSAGES.                                   01740004
017500     05  PE-MSG-01                   PIC  X(30)    VALUE          01750004
017600         'OPEN OF PARM_CSR_DC           '.                        01760099
017700     05  PE-MSG-02                   PIC  X(30)    VALUE          01770004
017800         'FETCH OF PARM_CSR_DC          '.                        01780099
020100     05  PE-MSG-03                   PIC  X(30)    VALUE          02010022
020200         'CLOSE OF PARM_CSR_DC          '.                        02020099
020300*                                                                 02030004
021300******************************************************************02130004
021400*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02140004
021500******************************************************************02150004
021600     COPY DPWS004.                                                02160004
021700*                                                                 02170004
021800*                                                                 02180004
021900******************************************************************02190004
022000*  COMMUNICATIONS AREA FOR DB2                                    02200004
022100******************************************************************02210004
022200     EXEC SQL                                                     02220004
022300          INCLUDE SQLCA                                           02230004
022400     END-EXEC.                                                    02240004
022500*                                                                 02250004
022501*----------------------------------------------------------------*02250199
022502*    WST_ATTR_ELEM: WAREHOUSE SYSTEMS - ATTRIBUTE ELEMENTS        02250299
022503*----------------------------------------------------------------*02250399
022504     EXEC SQL                                                     02250499
022505          INCLUDE WST00010                                        02250599
022506     END-EXEC.                                                    02250699
022510*----------------------------------------------------------------*02251035
022520*    DB2 TABLE FOR PARAMETERS                                     02252035
022530*----------------------------------------------------------------*02253035
022540     EXEC SQL                                                     02254035
022550          INCLUDE TKRPRPM                                         02255035
022560     END-EXEC.                                                    02256099
024900*                                                                 02490004
025100******************************************************************02510004
025200**  CURSOR USED TO RETRIEVE TKRPRPM DATA FOR DC                   02520099
025400******************************************************************02540004
025500     EXEC SQL                                                     02550004
025600          DECLARE PARM_CSR_DC CURSOR FOR                          02560099
025700          SELECT A.SYS_PRC_FUNC_CDE                               02570099
025710               , A.FUNC_TXT                                       02571099
025722            FROM TKRPRPM A                                        02572299
025723          WHERE A.LOC_ID                  =  90                   02572399
025724             AND A.INTFC_SYS_CDE          = 'KHL'                 02572499
025725             AND A.SYS_PRC_FUNC_CDE    LIKE 'WSDC%'               02572599
025727             AND A.FUNC_PRC_STAT_CDE      = 'AC'                  02572799
025728             AND A.FUNC_BEG_TMST         <=  CURRENT TIMESTAMP    02572899
025729             AND A.FUNC_END_TMST         >=  CURRENT TIMESTAMP    02572999
025730             AND A.FUNC_TXT              >  ' '                   02573099
025740          WITH UR                                                 02574099
027000     END-EXEC                                                     02700036
027100******************************************************************02710099
027200**  CURSOR USED TO RETRIEVE TKRPRPM DATA FOR EFC                  02720099
027300******************************************************************02730099
027400     EXEC SQL                                                     02740099
027500          DECLARE PARM_CSR_EFC CURSOR FOR                         02750099
027600          SELECT A.SYS_PRC_FUNC_CDE                               02760099
027700               , A.FUNC_TXT                                       02770099
027800            FROM TKRPRPM A                                        02780099
027900          WHERE A.LOC_ID                  =  90                   02790099
028000             AND A.INTFC_SYS_CDE          = 'KHL'                 02800099
028100             AND A.SYS_PRC_FUNC_CDE    LIKE 'WSEF%'               02810099
028200             AND A.FUNC_PRC_STAT_CDE      = 'AC'                  02820099
028400             AND A.FUNC_BEG_TMST         <=  CURRENT TIMESTAMP    02840099
028500             AND A.FUNC_END_TMST         >=  CURRENT TIMESTAMP    02850099
028600             AND A.FUNC_TXT              >  ' '                   02860099
028700          WITH UR                                                 02870099
028800     END-EXEC                                                     02880099
029500*                                                                 02950004
029510     EXEC SQL                                                     02951099
029520          DECLARE EXTRACT_CSR CURSOR FOR                          02952099
029600          SELECT INTGRTN_TYP_CDE                                  02960099
029700               , ATTR_DEFN_SEQ_NBR                                02970099
029800               , ATTR_ELEM_SEQ_NBR                                02980099
029900               , ATTR_ELEM_TXT                                    02990099
030000               , ATTR_ELEM_TMST                                   03000099
030100               , ATTR_ELEM_NBR                                    03010099
030200          FROM  WST_ATTR_ELEM                                     03020099
031100          WHERE INTGRTN_TYP_CDE    = :DK-INTGRTN-TYP-CDE          03110099
031200            AND ATTR_ELEM_SEQ_NBR  = :DK-ATTR-ELEM-SEQ-NBR        03120099
031300          ORDER BY 1,3,2                                          03130099
031400          WITH UR                                                 03140099
031500     END-EXEC                                                     03150099
046000*                                                                 04600004
046100******************************************************************04610004
046200 PROCEDURE DIVISION.                                              04620004
046300******************************************************************04630004
046400                                                                  04640004
046500******************************************************************04650004
046600*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   04660004
046700******************************************************************04670004
046800 0000-PROGRAM-MAINLINE.                                           04680004
046900     PERFORM 1000-INITIALIZE.                                     04690004
046910     IF  PS-CONTROL-CARD-INVALID                                  04691099
046920         PERFORM 0100-END-JOB                                     04692099
047000     ELSE                                                         04700099
047027         PERFORM 6000-OPEN-PARM-CSR                               04702799
047028         PERFORM 6010-FETCH-PARM-CSR                              04702899
047029         IF PS-END-OF-PARM-CSR-NO                                 04702999
047034             PERFORM 2000-PROCESS-TKRPRPM                         04703499
047035                 UNTIL PS-END-OF-PARM-CSR-YES                     04703599
047036         ELSE                                                     04703699
047037            DISPLAY '** CC RUN TYPE NOT FOUND ==> '               04703799
047038                     CC-RUN-TYPE                                  04703899
047039          END-IF                                                  04703999
047040          PERFORM 6020-CLOSE-PARM-CSR                             04704099
047091     END-IF.                                                      04709125
047092*                                                                 04709292
047540     PERFORM 9000-DISPLAY-COUNTS                                  04754043
047541     PERFORM 0100-END-JOB.                                        04754199
047542*                                                                 04754204
047543 0100-END-JOB.                                                    04754399
047544     DISPLAY '***              END OF JOB              ***'.      04754499
047550     CLOSE WS-ATTR-ELEM-FILE-OUT.                                 04755099
047600     STOP RUN.                                                    04760004
047700*                                                                 04770004
048400******************************************************************04840004
048500 1000-INITIALIZE.                                                 04850004
048600     DISPLAY '**'.                                                04860099
048601     DISPLAY '** PROGRAM:  CNKUT815'.                             04860199
048602     DISPLAY '**'.                                                04860299
048610     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           04861013
048611     DISPLAY '** CONTROL CARD: '                                  04861199
048612             CC-CONTROL-CARD.                                     04861299
048613     DISPLAY '**'.                                                04861399
048614                                                                  04861499
048620     IF  CC-DC-RUN   OR                                           04862099
048621         CC-EFC-RUN                                               04862199
048622         CONTINUE                                                 04862299
048623     ELSE                                                         04862399
048624         DISPLAY '** INVALID CONTROL CARD RUN TYPE'               04862499
048625         SET PS-CONTROL-CARD-INVALID TO TRUE                      04862599
048626     END-IF                                                       04862699
048627                                                                  04862799
048628*                                                                 04862899
048629* NOTE:  IF CURR-LOC  =  NEW-LOD THIS IS VALID                    04862999
048630*        THAT IS WHAT WILL BE USED TO LOAD THE FILE TO PROD       04863099
048631*                                                                 04863199
048632     IF  CC-CURR-LOC NUMERIC  AND                                 04863299
048633         CC-NEW-LOC  NUMERIC  AND                                 04863399
048634         CC-CURR-LOC > '0000' AND                                 04863499
048635         CC-NEW-LOC  > '0000'                                     04863599
048636         CONTINUE                                                 04863699
048637     ELSE                                                         04863799
048638         DISPLAY '** INVALID CONTROL CARD LOCATION'               04863899
048639         SET PS-CONTROL-CARD-INVALID TO TRUE                      04863999
048640     END-IF                                                       04864099
048650*                                                                 04865013
048700     OPEN OUTPUT WS-ATTR-ELEM-FILE-OUT.                           04870099
048800*                                                                 04880004
049600******************************************************************04960004
049700 2000-PROCESS-TKRPRPM.                                            04970027
058600*                                                                 05860004
058700     MOVE  PV-WS-INT-TYP    TO DK-INTGRTN-TYP-CDE                 05870099
058800     MOVE  PV-WS-COPY-SEQ-N TO DK-ATTR-ELEM-SEQ-NBR               05880099
058810                                                                  05881099
058900     PERFORM 7000-OPEN-EXTRACT-CSR.                               05890099
059000     PERFORM 7010-FETCH-EXTRACT-CSR.                              05900099
059010     IF PS-END-OF-EXTRACT-CSR-NO                                  05901099
059030          PERFORM 3000-EXTRACT-WS-ATTR-ELEMENTS                   05903099
059100             UNTIL PS-END-OF-EXTRACT-CSR-YES                      05910099
059120     END-IF.                                                      05912099
059130                                                                  05913099
059200     PERFORM 7020-CLOSE-EXTRACT-CSR.                              05920099
059300     SET PS-END-OF-EXTRACT-CSR-NO TO TRUE.                        05930099
062000*                                                                 06200004
062100     PERFORM 6010-FETCH-PARM-CSR.                                 06210099
062200*                                                                 06220004
062350 3000-EXTRACT-WS-ATTR-ELEMENTS.                                   06235099
062351                                                                  06235199
062352     MOVE PV-WS-NEW-SEQ-N TO WS-ATTR-ELEM-SEQ-NBR                 06235299
062353     IF  WS-ATTR-DEFN-SEQ-NBR = PV-WS-SEQ-W-DC-N                  06235399
062354         MOVE CC-NEW-LOC  TO WS-ATTR-ELEM-NBR                     06235499
062355     END-IF                                                       06235599
062356                                                                  06235699
062357     WRITE WS-ATTR-ELEM-RECORD-OUT FROM WS-WST00010.              06235799
062358     ADD +1 TO PV-OUTPUT-CNT                                      06235899
062359                                                                  06235999
062360     PERFORM 7010-FETCH-EXTRACT-CSR.                              06236099
062370                                                                  06237099
112000******************************************************************11200004
112100*  OPEN THE PARM_CSR_DC                                           11210099
112200******************************************************************11220004
112300 6000-OPEN-PARM-CSR.                                              11230099
112310     IF  CC-DC-RUN                                                11231099
112400         EXEC SQL                                                 11240099
112500              OPEN PARM_CSR_DC                                    11250099
112600         END-EXEC                                                 11260099
112601     ELSE                                                         11260199
112602         EXEC SQL                                                 11260299
112603              OPEN PARM_CSR_EFC                                   11260399
112604         END-EXEC                                                 11260499
112610     END-IF.                                                      11261099
112700*                                                                 11270004
112800     EVALUATE TRUE                                                11280004
112900         WHEN SQLCODE = ZERO                                      11290004
113000              CONTINUE                                            11300004
113100         WHEN OTHER                                               11310004
113200              MOVE '6000-OPEN-PARM-CSR'                           11320099
113300                                 TO PV-ABEND-PARAGRAPH            11330022
113400              MOVE PE-MSG-01     TO PV-DB2-OPERATION-ATTEMPTED    11340004
113500              PERFORM 9200-SQL-ABEND                              11350004
113600     END-EVALUATE.                                                11360004
113700*                                                                 11370004
113800*                                                                 11380004
113900******************************************************************11390004
114000*  FETCH THE NEXT TKRPRPM                                         11400023
114100******************************************************************11410004
114200 6010-FETCH-PARM-CSR.                                             11420099
114201     IF  CC-DC-RUN                                                11420199
114206         EXEC SQL                                                 11420699
114207              FETCH PARM_CSR_DC                                   11420799
114208                INTO :PV-PRC-FUNC-CDE                             11420899
114209                   , :PV-FUNC-TXT                                 11420999
114217         END-EXEC                                                 11421799
114218     ELSE                                                         11421899
114219         EXEC SQL                                                 11421999
114220              FETCH PARM_CSR_EFC                                  11422099
114221                INTO :PV-PRC-FUNC-CDE                             11422199
114222                   , :PV-FUNC-TXT                                 11422299
114223         END-EXEC                                                 11422399
114224     END-IF.                                                      11422499
114225                                                                  11422599
114226     EVALUATE TRUE                                                11422699
114227         WHEN SQLCODE = ZERO                                      11422799
114228              IF  PV-WS-COPY-SEQ NOT NUMERIC  OR                  11422899
114229                  PV-WS-SEQ-W-DC NOT NUMERIC  OR                  11422999
114230                  PV-WS-NEW-SEQ  NOT NUMERIC                      11423099
114231                  DISPLAY '** TKRPRPM PARM NOT NUMERIC DATA '     11423199
114232                           PV-PRC-FUNC-CDE ' ' PV-FUNC-TXT        11423299
114233                                                                  11423399
114234                  PERFORM 9000-DISPLAY-COUNTS                     11423499
114235                                                                  11423599
114236                  DISPLAY '*** LAST GOOD FETCH: '                 11423699
114237                                PV-PRC-FUNC-CDE ' '               11423799
114238                                PV-FUNC-TXT                       11423899
114239                  MOVE '6010-FETCH-PARM-CSR'                      11423999
114240                                 TO PV-ABEND-PARAGRAPH            11424099
114241                  MOVE PE-MSG-02 TO PV-DB2-OPERATION-ATTEMPTED    11424199
114242                  PERFORM 9200-SQL-ABEND                          11424299
114243              ELSE                                                11424399
114244                  ADD +1 TO PV-TKRPRPM-CNT                        11424499
114245                  DISPLAY '** INTEGRATION TYPE ' PV-WS-INT-TYP    11424599
114246                          '**'  PV-FUNC-TXT                       11424699
114247              END-IF                                              11424799
114248         WHEN SQLCODE = +100                                      11424899
114249              SET PS-END-OF-PARM-CSR-YES                          11424999
114250                                TO TRUE                           11425099
114251         WHEN OTHER                                               11425199
114252              PERFORM 9000-DISPLAY-COUNTS                         11425299
114253              DISPLAY '*** LAST GOOD FETCH: '                     11425399
114254                            PV-PRC-FUNC-CDE ' '                   11425499
114255                            PV-FUNC-TXT                           11425599
114256              MOVE '6010-FETCH-PARM-CSR'                          11425699
114257                                 TO PV-ABEND-PARAGRAPH            11425799
114258              MOVE PE-MSG-02     TO PV-DB2-OPERATION-ATTEMPTED    11425899
114259              PERFORM 9200-SQL-ABEND                              11425999
114260     END-EVALUATE.                                                11426099
114270*                                                                 11427099
116700*                                                                 11670004
141700******************************************************************14170004
141800*  CLOSE THE PARM_CSR_DC                                          14180099
141900******************************************************************14190004
142000 6020-CLOSE-PARM-CSR.                                             14200099
142010     IF  CC-DC-RUN                                                14201099
142100         EXEC SQL                                                 14210099
142200              CLOSE PARM_CSR_DC                                   14220099
142300         END-EXEC                                                 14230099
142310     ELSE                                                         14231099
142311         EXEC SQL                                                 14231199
142312              CLOSE PARM_CSR_EFC                                  14231299
142313         END-EXEC                                                 14231399
142320     END-IF.                                                      14232099
142400*                                                                 14240004
142500     EVALUATE TRUE                                                14250004
142600         WHEN SQLCODE = ZERO                                      14260004
142700              CONTINUE                                            14270004
142800         WHEN OTHER                                               14280004
142900              MOVE '6020-CLOSE-PARM-CSR'                          14290099
143000                                 TO PV-ABEND-PARAGRAPH            14300004
143100              MOVE PE-MSG-03     TO PV-DB2-OPERATION-ATTEMPTED    14310024
143200              PERFORM 9200-SQL-ABEND                              14320004
143300     END-EVALUATE.                                                14330004
143400*                                                                 14340004
143500******************************************************************14350099
143600*  OPEN THE EXTRACT_CSR                                           14360099
143700******************************************************************14370099
143800 7000-OPEN-EXTRACT-CSR.                                           14380099
143900     EXEC SQL                                                     14390099
144000          OPEN EXTRACT_CSR                                        14400099
144100     END-EXEC.                                                    14410099
144200*                                                                 14420099
144300     EVALUATE TRUE                                                14430099
144400         WHEN SQLCODE = ZERO                                      14440099
144500              CONTINUE                                            14450099
144600         WHEN OTHER                                               14460099
144610              MOVE '7000-OPEN-EXTRACT-CSR'                        14461099
144620                                 TO PV-ABEND-PARAGRAPH            14462099
144630              MOVE PE-MSG-01     TO PV-DB2-OPERATION-ATTEMPTED    14463099
144640              PERFORM 9200-SQL-ABEND                              14464099
144650     END-EVALUATE.                                                14465099
144660*                                                                 14466099
144661 7010-FETCH-EXTRACT-CSR.                                          14466199
144662     EXEC SQL                                                     14466299
144663          FETCH EXTRACT_CSR                                       14466399
144665          INTO  :WS-INTGRTN-TYP-CDE                               14466599
144666               ,:WS-ATTR-DEFN-SEQ-NBR                             14466699
144667               ,:WS-ATTR-ELEM-SEQ-NBR                             14466799
144668               ,:WS-ATTR-ELEM-TXT                                 14466899
144669                    :WS-ATTR-ELEM-TXT-NULL                        14466999
144670*                   ,:WST00010-ATTR-ELEM-TXT-LEN                  14467099
144671*                   ,:WST00010-ATTR-ELEM-TXT-TEXT                 14467199
144672                ,:WS-ATTR-ELEM-TMST                               14467299
144673                     :WS-ATTR-ELEM-TMST-NULL                      14467399
144674                ,:WS-ATTR-ELEM-NBR                                14467499
144675                     :WS-ATTR-ELEM-NBR-NULL                       14467599
144676     END-EXEC                                                     14467699
144677*                                                                 14467799
144678     EVALUATE TRUE                                                14467899
144679         WHEN SQLCODE = ZERO                                      14467999
144680              ADD +1 TO PV-EXTRACT-CNT                            14468099
144681         WHEN SQLCODE = +100                                      14468199
144682              SET PS-END-OF-EXTRACT-CSR-YES                       14468299
144683                                  TO TRUE                         14468399
144684              MOVE PV-EXTRACT-CNT TO PV-DISPLAY-CNT               14468499
144685              DISPLAY '***     EXTRACT COUNT ' PV-DISPLAY-CNT     14468599
144686              ADD PV-EXTRACT-CNT TO PV-TOT-EXTRACT-CNT            14468699
144687              MOVE ZERO          TO PV-EXTRACT-CNT                14468799
144688         WHEN OTHER                                               14468899
144689              PERFORM 9000-DISPLAY-COUNTS                         14468999
144690              MOVE WS-ATTR-DEFN-SEQ-NBR                           14469099
144691                                 TO PV-DISPLAY-ATTR-DEFN          14469199
144692              MOVE WS-ATTR-ELEM-SEQ-NBR                           14469299
144693                                 TO PV-DISPLAY-ATTR-ELEM          14469399
144694              DISPLAY '*** LAST GOOD FETCH: '                     14469499
144695                            WS-INTGRTN-TYP-CDE ' '                14469599
144696                            PV-DISPLAY-ATTR-DEFN ' '              14469699
144697                            PV-DISPLAY-ATTR-ELEM                  14469799
144698              MOVE '7010-FETCH-EXTRACT-CSR'                       14469899
144699                                 TO PV-ABEND-PARAGRAPH            14469999
144700              MOVE PE-MSG-02     TO PV-DB2-OPERATION-ATTEMPTED    14470099
144701              PERFORM 9200-SQL-ABEND                              14470199
144702     END-EVALUATE.                                                14470299
144703*                                                                 14470399
144704******************************************************************14470499
144705*  CLOSE THE EXTRACT_CSR                                          14470599
144706******************************************************************14470699
144707 7020-CLOSE-EXTRACT-CSR.                                          14470799
144708     EXEC SQL                                                     14470899
144709          CLOSE EXTRACT_CSR                                       14470999
144710     END-EXEC.                                                    14471099
144711*                                                                 14471199
144712     EVALUATE TRUE                                                14471299
144713         WHEN SQLCODE = ZERO                                      14471399
144714              CONTINUE                                            14471499
144715         WHEN OTHER                                               14471599
144716              MOVE '7020-CLOSE-EXTRACT-CSR'                       14471699
144717                                 TO PV-ABEND-PARAGRAPH            14471799
144718              MOVE PE-MSG-03     TO PV-DB2-OPERATION-ATTEMPTED    14471899
144719              PERFORM 9200-SQL-ABEND                              14471999
144720     END-EVALUATE.                                                14472099
144721*                                                                 14472199
144730******************************************************************14473099
144800 9000-DISPLAY-COUNTS.                                             14480033
145100                                                                  14510004
145200     DISPLAY '********************************************'       14520033
145201     DISPLAY '**                                        **'       14520199
145202     DISPLAY '** WST_ATTR_ELEM                          **'       14520299
145203     DISPLAY '**                                        **'       14520399
145210     MOVE PV-TKRPRPM-CNT     TO PV-DISPLAY-CNT                    14521034
145300     DISPLAY 'TKRPRM FETCHED -------: ' PV-DISPLAY-CNT.           14530099
145301     DISPLAY '**                                        **'       14530199
145310     MOVE PV-TOT-EXTRACT-CNT TO PV-DISPLAY-CNT                    14531099
145400     DISPLAY 'WST_ATTR_ELEM FETCHED-: ' PV-DISPLAY-CNT.           14540099
145410     MOVE PV-OUTPUT-CNT      TO PV-DISPLAY-CNT                    14541099
145501     DISPLAY 'OUTPUT RECORDS WRITTEN: ' PV-DISPLAY-CNT.           14550199
145502     DISPLAY '**                                        **'       14550299
145510     DISPLAY '********************************************'.      14551037
146600*                                                                 14660004
146700*                                                                 14670004
146800******************************************************************14680004
146900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    14690004
147000*  ERROR OR WARNING CODE OCCURS.                                  14700004
147100******************************************************************14710004
147200 9200-SQL-ABEND.                                                  14720004
147300     DISPLAY '9200-SQL-ABEND'.                                    14730004
147400     DISPLAY '** ABEND     **'.                                   14740004
147500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        14750004
147600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             14760004
147700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     14770004
147800*                                                                 14780004
147900*                                                                 14790004
148000******************************************************************14800004
148100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    14810004
148200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         14820004
148300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     14830004
148400* FORMAT.                                                         14840004
148500******************************************************************14850004
148600     COPY DPPD004.                                                14860004
148700                                                                  14870004
148800     IF  SQLCODE NOT = -911                                       14880004
148900         EXEC SQL                                                 14890004
149000              COMMIT                                              14900004
149100         END-EXEC                                                 14910004
149200     END-IF.                                                      14920004
149300                                                                  14930004
149400     MOVE +4013                  TO PV-ABEND-CODE.                14940004
149500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14950004
