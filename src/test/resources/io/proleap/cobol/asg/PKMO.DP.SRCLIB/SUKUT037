000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.   SUKUT037.                                          00040001
000500 AUTHOR.       JOE LAROSA.                                        00050001
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060001
000700 DATE-WRITTEN  JULY, 2000.                                        00070001
000800 DATE-COMPILED.                                                   00080001
000900*----------------------------------------------------------------*00090001
001000* THIS PROGRAM CREATES AN EXTRACT FILE THAT WILL BE USED IN      *00100001
001100* GENERATING THE 'UCC-128 UNUSED LABELS' REPORT.                 *00110001
001200*                                                                *00120001
001300* ASSOCIATED REPORT PROGRAM IS SUKRP023.                         *00130001
001400*----------------------------------------------------------------*00140001
001200* 03/01 - DEANNA BRANTNER - CHANGED PROGRAM TO CARRY A PRE-PACK  *00141016
001200*         INDICATOR AND CARRY THE PREPK-ID # INSTEAD OF LINE #.  *00142016
001500******************************************************************00150001
001600 ENVIRONMENT DIVISION.                                            00160001
001700******************************************************************00170001
001800 CONFIGURATION SECTION.                                           00180001
001900                                                                  00190001
002000 SOURCE-COMPUTER.        IBM-3090.                                00200001
002100 OBJECT-COMPUTER.        IBM-3090.                                00210001
002200                                                                  00220001
002300 INPUT-OUTPUT SECTION.                                            00230001
002400                                                                  00240001
002500 FILE-CONTROL.                                                    00250001
002600                                                                  00260001
002700      SELECT INPUT-FILE             ASSIGN TO INP01.              00270001
002800      SELECT OUTPUT-FILE            ASSIGN TO OUT01.              00280001
002900                                                                  00290001
003000******************************************************************00300001
003100 DATA DIVISION.                                                   00310001
003200******************************************************************00320001
003300 FILE SECTION.                                                    00330001
003400 FD  INPUT-FILE                                                   00340001
003500     LABEL RECORDS ARE STANDARD                                   00350001
003600     BLOCK CONTAINS 0 RECORDS                                     00360001
003700     RECORDING MODE IS F                                          00370001
003800     RECORD CONTAINS 200 CHARACTERS                               00380001
003900     DATA RECORD IS INPUT-RECORD.                                 00390001
004000                                                                  00400001
004100 01  INPUT-RECORD                    PIC X(200).                  00410001
004200                                                                  00420001
004300 FD  OUTPUT-FILE                                                  00430001
004400     LABEL RECORDS ARE STANDARD                                   00440001
004500     BLOCK CONTAINS 0 RECORDS                                     00450001
004600     RECORDING MODE IS F                                          00460001
004700     RECORD CONTAINS 200 CHARACTERS                               00470001
004800     DATA RECORD IS OUTPUT-RECORD.                                00480001
004900                                                                  00490001
005000 01  OUTPUT-RECORD                   PIC X(200).                  00500001
005100******************************************************************00510001
005200 WORKING-STORAGE SECTION.                                         00520001
005300******************************************************************00530001
005400 01 PS-PROGRAM-SWITCHES.                                          00540001
005500    05  PS-END-OF-FILE-SW            PIC X(01) VALUE 'N'.         00550002
005600        88 PS-EOF-NO                           VALUE 'N'.         00560002
005700        88 PS-EOF-YES                          VALUE 'Y'.         00570002
005800    05  PS-LBVRDA-N-CSR-SW           PIC X(01) VALUE 'N'.         00580002
005900        88 PS-LBVRDA-N-DONE-NO                 VALUE 'N'.         00590002
006000        88 PS-LBVRDA-N-DONE-YES                VALUE 'Y'.         00600002
006100    05  PS-LBVRDA-Y-CSR-SW           PIC X(01) VALUE 'N'.         00610002
006200        88 PS-LBVRDA-Y-DONE-NO                 VALUE 'N'.         00620002
006300        88 PS-LBVRDA-Y-DONE-YES                VALUE 'Y'.         00630002
006400                                                                  00640001
006500 01 PC-PROGRAM-CONSTANTS.                                         00650001
006600    05  PC-PROGRAM-NAME              PIC X(08) VALUE 'SUKUT037'.  00660001
006700                                                                  00670001
006800 01 DK-DB-KEYS.                                                   00680001
006900    05  DK-PO-NBR                    PIC S9(9) COMP VALUE +0.     00690002
007000    05  DK-RCVR-SEQ-NBR              PIC S9(9) COMP VALUE +0.     00700002
007100    05  DK-PO-LNE-NBR                PIC S9(9) COMP VALUE +0.     00710005
007200                                                                  00720001
007300 01 PV-PROGRAM-VARIABLES.                                         00730001
007400    05  PV-PO-NBR-DISP               PIC 9(09).                   00740005
007500    05  PV-RCVR-SEQ-NBR-DISP         PIC 9(03).                   00750005
007600    05  PV-PREV-PO-NBR               PIC S9(9) COMP VALUE +0.     00760002
007700    05  PV-PREV-RCVR-SEQ-NBR         PIC S9(9) COMP VALUE +0.     00770002
007800    05  PV-LABEL-TOTAL               PIC S9(9) COMP-3 VALUE +0.   00780002
007900    05  PV-RECS-READ                 PIC S9(9) VALUE +0.          00790002
008000    05  PV-RECS-WRITE                PIC S9(9) VALUE +0.          00800002
008100    05  PV-RECS-DISPLAY              PIC ZZZ,ZZZ,ZZ9-.            00810002
008200                                                                  00820002
008300    05 PV-ABEND-CODE                 PIC 9(04) VALUE ZEROES.      00830002
008400    05 PV-ABEND-PARAGRAPH            PIC X(30) VALUE SPACES.      00840002
008500    05 PV-DB2-OPERATION-ATTEMPTED    PIC X(40) VALUE SPACES.      00850002
008600    05 PV-DB2-TABLE-NAME             PIC X(12) VALUE SPACES.      00860002
008700    05 PV-SQLCODE                    PIC Z(8)9-.                  00870001
008800                                                                  00880001
008900******************************************************************00890009
009000* FORMAT OF THE CONTROL CARD INFORMATION PASSED INTO THE PROGRAM *00900009
009100******************************************************************00910009
009200 01  CC-CONTROL-CARD.                                             00920009
009300     05  CC-PRINTER-ID               PIC X(08).                   00930009
009400     05  CC-PRTR-CNTL-IND            PIC X(01).                   00940009
009500     05  CC-TRACK-NBR                PIC 9(01).                   00950009
009600     05  FILLER                      PIC X(01).                   00960009
009700     05  CC-CUT-REPORT               PIC X(01).                   00970009
009800         88 CC-CUT-REPORT-AT-END               VALUE 'C'.         00980009
009900     05  CC-REQUESTOR-ID             PIC X(08).                   00990009
010000     05  CC-PRINT-SUKRP002-IND       PIC X(01).                   01000009
010100         88 CC-PRINT-SUKRP002                  VALUE 'Y'.         01010009
010200     05  CC-PRINT-SUKRP003-IND       PIC X(01).                   01020009
010300         88 CC-PRINT-SUKRP003                  VALUE 'Y'.         01030009
010400     05  CC-PRINT-SUKRP004-IND       PIC X(01).                   01040009
010500         88 CC-PRINT-SUKRP004                  VALUE 'Y'.         01050009
010600     05  CC-PRINT-SUKRP005-IND       PIC X(01).                   01060009
010700         88 CC-PRINT-SUKRP005                  VALUE 'Y'.         01070009
010800     05  CC-PRINT-SUKRP006-IND       PIC X(01).                   01080009
010900         88 CC-PRINT-SUKRP006                  VALUE 'Y'.         01090009
011000     05  CC-PRINT-SUKRP007-IND       PIC X(01).                   01100009
011100         88 CC-PRINT-SUKRP007                  VALUE 'Y'.         01110009
011200     05  CC-PRINT-SUKRP008-IND       PIC X(01).                   01120009
011300         88 CC-PRINT-SUKRP008                  VALUE 'Y'.         01130009
011400     05  CC-PRINT-SUKRP023-IND       PIC X(01).                   01140009
011500         88 CC-PRINT-SUKRP023                  VALUE 'Y'.         01150009
011600                                                                  01160009
011700******************************************************************01170001
011800*** INPUT FILE RECORD LAYOUT ****                                 01180001
011900******************************************************************01190001
012000     COPY SURD001.                                                01200017
012100                                                                  01210001
012200******************************************************************01220001
012300*** OUTPUT FILE RECORD LAYOUT ****                                01230001
012400******************************************************************01240001
012500     COPY SURD010.                                                01250017
012600                                                                  01260001
012700******************************************************************01270001
012800*** DB2 MESSAGE AREA ****                                         01280001
012900******************************************************************01290001
013000     COPY DPWS004.                                                01300017
013100                                                                  01310001
013200******************************************************************01320001
013300*** DB2 COMMUNICATION AREA ****                                   01330001
013400******************************************************************01340001
013500     EXEC SQL                                                     01350001
013600          INCLUDE SQLCA                                           01360001
013700     END-EXEC.                                                    01370001
013800                                                                  01380001
013900******************************************************************01390001
014000*** SU - VIRTUAL LABEL DATA TABLE ****                            01400001
014100******************************************************************01410001
014200     EXEC SQL                                                     01420001
014300          INCLUDE TLBVRDA                                         01430001
014400     END-EXEC.                                                    01440001
014500                                                                  01450001
014600******************************************************************01460002
014700* SHIPPING UNITS UNCONSUMED (N) LABELS CURSOR                     01470002
014800******************************************************************01480002
014900     EXEC SQL                                                     01490002
015000         DECLARE LBVRDA-N-CSR CURSOR FOR                          01500002
015100         SELECT  A.PO_NBR                                         01510002
015200              ,  A.RCVR_SEQ_NBR                                   01520002
015300              ,  A.PO_LNE_NBR                                     01530002
015400              ,  A.CART_LBL_TYP_CDE                               01540002
015400              ,  A.PREPK_ID                                       01541014
015500              ,  COUNT(*)                                         01550002
015600           FROM  TLBVRDA A                                        01560002
015700          WHERE  A.PO_NBR           = :DK-PO-NBR                  01570002
015800            AND  A.RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR            01580002
015900            AND  A.LBL_ASG_IND      = 'N'                         01590002
016000       GROUP BY  A.PO_NBR                                         01600002
016100              ,  A.RCVR_SEQ_NBR                                   01610002
016200              ,  A.PO_LNE_NBR                                     01620002
016300              ,  A.CART_LBL_TYP_CDE                               01630002
015400              ,  A.PREPK_ID                                       01631015
016400       ORDER BY  A.PO_NBR                                         01640002
016500              ,  A.RCVR_SEQ_NBR                                   01650002
016600              ,  A.PO_LNE_NBR                                     01660002
016700              ,  A.CART_LBL_TYP_CDE                               01670002
016800     END-EXEC.                                                    01680002
016900                                                                  01690002
017000******************************************************************01700002
017100* SHIPPING UNITS CONSUMED (Y) LABELS CURSOR                       01710002
017200******************************************************************01720002
017300     EXEC SQL                                                     01730002
017400         DECLARE LBVRDA-Y-CSR CURSOR FOR                          01740002
017500         SELECT  A.PO_NBR                                         01750002
017600              ,  A.RCVR_SEQ_NBR                                   01760002
017700              ,  A.PO_LNE_NBR                                     01770002
017800              ,  A.CART_LBL_TYP_CDE                               01780002
015400              ,  A.PREPK_ID                                       01781014
017900              ,  COUNT(*)                                         01790002
018000           FROM  TLBVRDA A                                        01800002
018100          WHERE  A.PO_NBR           = :DK-PO-NBR                  01810002
018200            AND  A.RCVR_SEQ_NBR     = :DK-RCVR-SEQ-NBR            01820002
018300            AND  A.PO_LNE_NBR       = :DK-PO-LNE-NBR              01830005
018400            AND  A.LBL_ASG_IND      = 'Y'                         01840002
018500       GROUP BY  A.PO_NBR                                         01850002
018600              ,  A.RCVR_SEQ_NBR                                   01860002
018700              ,  A.PO_LNE_NBR                                     01870002
018800              ,  A.CART_LBL_TYP_CDE                               01880002
015400              ,  A.PREPK_ID                                       01881015
018900       ORDER BY  A.PO_NBR                                         01890002
019000              ,  A.RCVR_SEQ_NBR                                   01900002
019100              ,  A.PO_LNE_NBR                                     01910002
019200              ,  A.CART_LBL_TYP_CDE                               01920002
019300     END-EXEC.                                                    01930002
019400                                                                  01940002
019500/*****************************************************************01950002
019600 PROCEDURE DIVISION.                                              01960001
019700******************************************************************01970001
019800 0000-MAIN.                                                       01980001
019900                                                                  01990002
020000     DISPLAY '**** START OF SUKUT037 ****'.                       02000002
020100     DISPLAY ' '.                                                 02010002
020200                                                                  02020009
020300     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           02030009
020400     DISPLAY 'CONTROL CARD = ' CC-CONTROL-CARD.                   02040009
020500                                                                  02050002
020600     IF CC-PRINT-SUKRP023                                         02060009
020700         PERFORM 1000-INITIALIZATION                              02070009
020800         IF PS-EOF-YES                                            02080009
020900             CONTINUE                                             02090010
021000         ELSE                                                     02100009
021100*PROCESS ERROR RECORDS                                            02110009
021200         IF SU001-RECORD-TYPE-IND = 'A'                           02120009
021300             INITIALIZE SU010-EXTRACT-RECORD                      02130009
021400             MOVE SU001-PO-NUMBER   TO SU010-PO-NUMBER            02140009
021500             MOVE SU001-REC-SEQ-NBR TO SU010-REC-SEQ-NBR          02150009
021600             MOVE 'A'               TO SU010-RECORD-TYPE-IND      02160009
021610             MOVE SU001-MANIFEST-NBR   TO SU010-MANIFEST-NBR      02161010
021700             PERFORM 8100-WRITE-OUTPUT-RECORD                     02170009
021800             DISPLAY '  ** SU001 ERROR RECORD FOUND **'           02180009
021900             DISPLAY '  ** PROGRAM TERMINATING IMMEDIATELY **'    02190009
022000         ELSE                                                     02200009
022100             PERFORM 2000-PROCESS-INPUT                           02210009
022200               UNTIL PS-EOF-YES                                   02220009
022300         END-IF                                                   02230009
022400         END-IF                                                   02240009
022500                                                                  02250009
022600         MOVE PV-RECS-READ  TO PV-RECS-DISPLAY                    02260009
022700         DISPLAY 'NUMBER OF RECORDS READ:    ' PV-RECS-DISPLAY    02270009
022800         MOVE PV-RECS-WRITE TO PV-RECS-DISPLAY                    02280009
022900         DISPLAY 'NUMBER OF RECORDS WRITTEN: ' PV-RECS-DISPLAY    02290009
023000                                                                  02300009
023100         CLOSE INPUT-FILE                                         02310009
023200               OUTPUT-FILE                                        02320009
023300     END-IF.                                                      02330009
023400                                                                  02340009
023500     DISPLAY ' '.                                                 02350009
023600     DISPLAY '****  END OF SUKUT037  ****'.                       02360009
023700                                                                  02370001
023800     GOBACK.                                                      02380009
023900                                                                  02390002
024000******************************************************************02400002
024100 1000-INITIALIZATION.                                             02410001
024200******************************************************************02420002
024300                                                                  02430002
024400     OPEN INPUT  INPUT-FILE                                       02440002
024500          OUTPUT OUTPUT-FILE.                                     02450002
024600                                                                  02460001
024700*READ FIRST INPUT RECORD.                                         02470001
024800     PERFORM 8000-READ-INPUT-FILE.                                02480002
024900                                                                  02490002
024901     IF PS-EOF-YES                                                02490110
024902         DISPLAY '  ** NO INPUT RECORDS FOUND **'                 02490210
024903     ELSE                                                         02490310
024905         MOVE SU001-MANIFEST-NBR  TO SU010-MANIFEST-NBR           02490510
024906         MOVE ZERO                TO SU010-PO-NUMBER              02490610
024907         MOVE ZERO                TO SU010-REC-SEQ-NBR            02490710
024908         MOVE ZERO                TO SU010-LINE-NBR               02490810
024909         MOVE SPACES              TO SU010-CART-LBL-TYPE          02490910
024910                                     SU010-LABEL-IND              02491010
024911         MOVE ZERO                TO SU010-LABEL-TOTAL            02491110
024912         MOVE 'B'                 TO SU010-RECORD-TYPE-IND        02491211
024920         PERFORM 8100-WRITE-OUTPUT-RECORD                         02492010
024930         PERFORM 8000-READ-INPUT-FILE                             02493010
024940     END-IF.                                                      02494010
025000******************************************************************02500002
025100 2000-PROCESS-INPUT.                                              02510002
025200******************************************************************02520002
025300                                                                  02530002
025400*COMPARE/SAVE PREVIOUS PO/RCVR.                                   02540002
025500     IF (SU001-PO-NUMBER     NOT = PV-PREV-PO-NBR)                02550002
025600       OR (SU001-REC-SEQ-NBR NOT = PV-PREV-RCVR-SEQ-NBR)          02560002
025700         MOVE SU001-PO-NUMBER   TO PV-PO-NBR-DISP                 02570005
025800         MOVE SU001-REC-SEQ-NBR TO PV-RCVR-SEQ-NBR-DISP           02580005
025900*JPL     DISPLAY '  PO / RCVR = ' PV-PO-NBR-DISP                  02590006
026000*JPL                        ' / ' PV-RCVR-SEQ-NBR-DISP            02600006
026100         PERFORM 2100-CHECK-LBVRDA-TABLE                          02610005
026200         MOVE SU001-PO-NUMBER   TO PV-PREV-PO-NBR                 02620002
026300         MOVE SU001-REC-SEQ-NBR TO PV-PREV-RCVR-SEQ-NBR           02630002
026400     END-IF.                                                      02640002
026500                                                                  02650001
026600*READ NEXT INPUT RECORD.                                          02660001
026700     PERFORM 8000-READ-INPUT-FILE.                                02670002
026800                                                                  02680002
026900******************************************************************02690002
027000 2100-CHECK-LBVRDA-TABLE.                                         02700002
027100******************************************************************02710002
027200                                                                  02720002
027300*SET DATABASE KEYS FOR CURSORS.                                   02730002
027400     MOVE SU001-PO-NUMBER   TO DK-PO-NBR.                         02740002
027500     MOVE SU001-REC-SEQ-NBR TO DK-RCVR-SEQ-NBR.                   02750002
027600                                                                  02760002
027700*PROCESS 'UNCONSUMED' LABELS.                                     02770002
027800     PERFORM 2110-OPEN-LBVRDA-N-CSR.                              02780002
027900                                                                  02790002
028000     SET PS-LBVRDA-N-DONE-NO TO TRUE.                             02800005
028100     PERFORM 2120-PROCESS-LBVRDA-N-CSR                            02810002
028200       UNTIL PS-LBVRDA-N-DONE-YES.                                02820002
028300                                                                  02830002
028400     PERFORM 2130-CLOSE-LBVRDA-N-CSR.                             02840002
028500                                                                  02850002
028600******************************************************************02860002
028700 2110-OPEN-LBVRDA-N-CSR.                                          02870002
028800******************************************************************02880002
028900                                                                  02890002
029000     EXEC SQL                                                     02900002
029100         OPEN LBVRDA-N-CSR                                        02910002
029200     END-EXEC.                                                    02920002
029300                                                                  02930002
029400     EVALUATE TRUE                                                02940002
029500       WHEN SQLCODE = ZERO                                        02950002
029600           CONTINUE                                               02960002
029700                                                                  02970002
029800       WHEN SQLWARN0 NOT = SPACES                                 02980002
029900       WHEN SQLCODE < ZERO                                        02990002
030000       WHEN SQLCODE > ZERO                                        03000002
030100           MOVE '2110-OPEN-LBVRDA-N-CSR' TO PV-ABEND-PARAGRAPH    03010002
030200           MOVE 'OPEN LBVRDA N CURSOR'                            03020002
030300                                 TO PV-DB2-OPERATION-ATTEMPTED    03030002
030400           MOVE 'TLBVRDA '       TO PV-DB2-TABLE-NAME             03040002
030500           PERFORM 9100-SQL-ABEND                                 03050002
030600     END-EVALUATE.                                                03060002
030700                                                                  03070002
030800******************************************************************03080002
030900 2120-PROCESS-LBVRDA-N-CSR.                                       03090002
031000******************************************************************03100002
031200     PERFORM 2125-FETCH-LBVRDA-N-CSR.                             03120002
031300                                                                  03130002
031400*WRITE OUTPUT RECORD.                                             03140002
031500     IF PS-LBVRDA-N-DONE-NO                                       03150002
031600         INITIALIZE SU010-EXTRACT-RECORD                          03160002
031700         MOVE LBVRDA-PO-NBR           TO SU010-PO-NUMBER          03170002
031800         MOVE LBVRDA-RCVR-SEQ-NBR     TO SU010-REC-SEQ-NBR        03180002
031900*        MOVE LBVRDA-PO-LNE-NBR       TO SU010-LINE-NBR           03190014
               IF LBVRDA-PO-LNE-NBR = 0                                 03191014
                   IF LBVRDA-PREPK-ID > 0                               03192014
                       MOVE LBVRDA-PREPK-ID  TO SU010-LINE-NBR          03193014
                       MOVE 'P'              TO SU010-PREPK-IND         03194014
                   ELSE                                                 03195014
                       MOVE LBVRDA-PO-LNE-NBR TO SU010-LINE-NBR         03196014
                   END-IF                                               03197014
               ELSE                                                     03198014
                   MOVE LBVRDA-PO-LNE-NBR TO SU010-LINE-NBR             03199014
               END-IF                                                   03199114
032000         MOVE LBVRDA-CART-LBL-TYP-CDE TO SU010-CART-LBL-TYPE      03200002
032100         MOVE 'N'                     TO SU010-LABEL-IND          03210002
032200         MOVE PV-LABEL-TOTAL          TO SU010-LABEL-TOTAL        03220002
032300         MOVE 'B'                     TO SU010-RECORD-TYPE-IND    03230002
032400         MOVE SU001-MANIFEST-NBR      TO SU010-MANIFEST-NBR       03240004
032500*JPL     DISPLAY '  N-REC = ' SU010-EXTRACT-RECORD                03250006
032600         PERFORM 8100-WRITE-OUTPUT-RECORD                         03260005
032700     END-IF.                                                      03270005
032800                                                                  03280005
032900*PROCESS 'CONSUMED' LABELS (IF 'UNCONSUMED' WERE FOUND).          03290005
033000     IF PS-LBVRDA-N-DONE-NO                                       03300005
033100         IF LBVRDA-PO-LNE-NBR NOT = DK-PO-LNE-NBR                 03310006
033200             MOVE LBVRDA-PO-LNE-NBR TO DK-PO-LNE-NBR              03320006
033300             SET PS-LBVRDA-Y-DONE-NO TO TRUE                      03330006
033400             PERFORM 2140-OPEN-LBVRDA-Y-CSR                       03340006
033500             PERFORM 2150-PROCESS-LBVRDA-Y-CSR                    03350006
033600               UNTIL PS-LBVRDA-Y-DONE-YES                         03360006
033700             PERFORM 2160-CLOSE-LBVRDA-Y-CSR                      03370006
033800         END-IF                                                   03380006
033900     END-IF.                                                      03390006
034000                                                                  03400002
034100******************************************************************03410002
034200 2125-FETCH-LBVRDA-N-CSR.                                         03420002
034300******************************************************************03430002
034400                                                                  03440002
034500     INITIALIZE DCLTLBVRDA.                                       03450002
034600     MOVE +0 TO PV-LABEL-TOTAL.                                   03460002
034700                                                                  03470002
034800     EXEC SQL                                                     03480002
034900         FETCH  LBVRDA-N-CSR                                      03490002
035000          INTO  :LBVRDA-PO-NBR                                    03500002
035100             ,  :LBVRDA-RCVR-SEQ-NBR                              03510002
035200             ,  :LBVRDA-PO-LNE-NBR                                03520002
035300             ,  :LBVRDA-CART-LBL-TYP-CDE                          03530002
035300             ,  :LBVRDA-PREPK-ID                                  03531014
035400             ,  :PV-LABEL-TOTAL                                   03540002
035500     END-EXEC.                                                    03550002
035600                                                                  03560002
035700     EVALUATE TRUE                                                03570002
035800       WHEN SQLCODE = ZERO                                        03580002
035900           SET PS-LBVRDA-Y-DONE-NO  TO TRUE                       03590002
036000                                                                  03600002
036100       WHEN SQLCODE = +100                                        03610002
036200           SET PS-LBVRDA-N-DONE-YES TO TRUE                       03620002
036300                                                                  03630002
036400       WHEN SQLWARN0 NOT = SPACE                                  03640002
036500       WHEN SQLCODE < ZERO                                        03650002
036600       WHEN SQLCODE > ZERO                                        03660002
036700           MOVE '2125-FETCH-LBVRDA-N-CSR' TO PV-ABEND-PARAGRAPH   03670002
036800           MOVE 'FETCH FROM LBVRDA TABLE'                         03680002
036900                                  TO PV-DB2-OPERATION-ATTEMPTED   03690002
037000           MOVE 'TLBVRDA '       TO PV-DB2-TABLE-NAME             03700002
037100           PERFORM 9100-SQL-ABEND                                 03710002
037200     END-EVALUATE.                                                03720002
037300                                                                  03730002
037400******************************************************************03740002
037500 2130-CLOSE-LBVRDA-N-CSR.                                         03750002
037600******************************************************************03760002
037700                                                                  03770002
037800     EXEC SQL                                                     03780002
037900         CLOSE LBVRDA-N-CSR                                       03790002
038000     END-EXEC.                                                    03800002
038100                                                                  03810002
038200     EVALUATE TRUE                                                03820002
038300       WHEN SQLCODE = ZERO                                        03830002
038400           CONTINUE                                               03840002
038500                                                                  03850002
038600       WHEN SQLWARN0 NOT = SPACES                                 03860002
038700       WHEN SQLCODE < ZERO                                        03870002
038800       WHEN SQLCODE > ZERO                                        03880002
038900           MOVE '2130-CLOSE-LBVRDA-N-CSR' TO PV-ABEND-PARAGRAPH   03890002
039000           MOVE 'CLOSE LBVRDA N CURSOR'                           03900002
039100                                  TO PV-DB2-OPERATION-ATTEMPTED   03910002
039200           MOVE 'TLBVRDA '       TO PV-DB2-TABLE-NAME             03920002
039300           PERFORM 9100-SQL-ABEND                                 03930002
039400     END-EVALUATE.                                                03940002
039500                                                                  03950002
039600******************************************************************03960002
039700 2140-OPEN-LBVRDA-Y-CSR.                                          03970002
039800******************************************************************03980002
039900                                                                  03990002
040000     EXEC SQL                                                     04000002
040100         OPEN LBVRDA-Y-CSR                                        04010002
040200     END-EXEC.                                                    04020002
040300                                                                  04030002
040400     EVALUATE TRUE                                                04040002
040500       WHEN SQLCODE = ZERO                                        04050002
040600           CONTINUE                                               04060002
040700                                                                  04070002
040800       WHEN SQLWARN0 NOT = SPACES                                 04080002
040900       WHEN SQLCODE < ZERO                                        04090002
041000       WHEN SQLCODE > ZERO                                        04100002
041100           MOVE '2140-OPEN-LBVRDA-Y-CSR' TO PV-ABEND-PARAGRAPH    04110002
041200           MOVE 'OPEN LBVRDA Y CURSOR'                            04120002
041300                                 TO PV-DB2-OPERATION-ATTEMPTED    04130002
041400           MOVE 'TLBVRDA '       TO PV-DB2-TABLE-NAME             04140002
041500           PERFORM 9100-SQL-ABEND                                 04150002
041600     END-EVALUATE.                                                04160002
041700                                                                  04170002
041800******************************************************************04180002
041900 2150-PROCESS-LBVRDA-Y-CSR.                                       04190002
042000******************************************************************04200002
042100                                                                  04210002
042200     PERFORM 2155-FETCH-LBVRDA-Y-CSR.                             04220002
042300                                                                  04230002
042400*WRITE OUTPUT RECORD.                                             04240002
042500     IF PS-LBVRDA-Y-DONE-NO                                       04250002
042600         INITIALIZE SU010-EXTRACT-RECORD                          04260002
042700         MOVE LBVRDA-PO-NBR           TO SU010-PO-NUMBER          04270002
042800         MOVE LBVRDA-RCVR-SEQ-NBR     TO SU010-REC-SEQ-NBR        04280002
042900*        MOVE LBVRDA-PO-LNE-NBR       TO SU010-LINE-NBR           04290014
               IF LBVRDA-PO-LNE-NBR = 0                                 04291014
                   IF LBVRDA-PREPK-ID > 0                               04292014
                       MOVE LBVRDA-PREPK-ID   TO SU010-LINE-NBR         04293014
                       MOVE 'P'               TO SU010-PREPK-IND        04294014
                   ELSE                                                 04295014
                       MOVE LBVRDA-PO-LNE-NBR TO SU010-LINE-NBR         04296014
                   END-IF                                               04297014
               ELSE                                                     04298014
                   MOVE LBVRDA-PO-LNE-NBR     TO SU010-LINE-NBR         04299014
               END-IF                                                   04299114
043000         MOVE LBVRDA-CART-LBL-TYP-CDE TO SU010-CART-LBL-TYPE      04300002
043100         MOVE 'Y'                     TO SU010-LABEL-IND          04310002
043200         MOVE PV-LABEL-TOTAL          TO SU010-LABEL-TOTAL        04320002
043300         MOVE 'B'                     TO SU010-RECORD-TYPE-IND    04330002
043400         MOVE SU001-MANIFEST-NBR      TO SU010-MANIFEST-NBR       04340004
043500*JPL     DISPLAY '  Y-REC = ' SU010-EXTRACT-RECORD                04350006
043600         PERFORM 8100-WRITE-OUTPUT-RECORD.                        04360002
043700                                                                  04370002
043800******************************************************************04380002
043900 2155-FETCH-LBVRDA-Y-CSR.                                         04390002
044000******************************************************************04400002
044100                                                                  04410002
044200     INITIALIZE DCLTLBVRDA.                                       04420002
044300     MOVE +0 TO PV-LABEL-TOTAL.                                   04430002
044400                                                                  04440002
044500     EXEC SQL                                                     04450002
044600         FETCH  LBVRDA-Y-CSR                                      04460003
044700          INTO  :LBVRDA-PO-NBR                                    04470002
044800             ,  :LBVRDA-RCVR-SEQ-NBR                              04480002
044900             ,  :LBVRDA-PO-LNE-NBR                                04490002
045000             ,  :LBVRDA-CART-LBL-TYP-CDE                          04500002
045000             ,  :LBVRDA-PREPK-ID                                  04501014
045100             ,  :PV-LABEL-TOTAL                                   04510002
045200     END-EXEC.                                                    04520002
045300                                                                  04530002
045400     EVALUATE TRUE                                                04540002
045500       WHEN SQLCODE = ZERO                                        04550002
045600           CONTINUE                                               04560002
045700                                                                  04570002
045800       WHEN SQLCODE = +100                                        04580002
045900           SET PS-LBVRDA-Y-DONE-YES TO TRUE                       04590002
046000                                                                  04600002
046100       WHEN SQLWARN0 NOT = SPACE                                  04610002
046200       WHEN SQLCODE < ZERO                                        04620002
046300       WHEN SQLCODE > ZERO                                        04630002
046400           MOVE '2155-FETCH-LBVRDA-Y-CSR' TO PV-ABEND-PARAGRAPH   04640002
046500           MOVE 'FETCH FROM LBVRDA TABLE'                         04650002
046600                                  TO PV-DB2-OPERATION-ATTEMPTED   04660002
046700           MOVE 'TLBVRDA '       TO PV-DB2-TABLE-NAME             04670002
046800           PERFORM 9100-SQL-ABEND                                 04680002
046900     END-EVALUATE.                                                04690002
047000                                                                  04700002
047100******************************************************************04710002
047200 2160-CLOSE-LBVRDA-Y-CSR.                                         04720002
047300******************************************************************04730002
047400                                                                  04740002
047500     EXEC SQL                                                     04750002
047600         CLOSE LBVRDA-Y-CSR                                       04760002
047700     END-EXEC.                                                    04770002
047800                                                                  04780002
047900     EVALUATE TRUE                                                04790002
048000       WHEN SQLCODE = ZERO                                        04800002
048100           CONTINUE                                               04810002
048200                                                                  04820002
048300       WHEN SQLWARN0 NOT = SPACES                                 04830002
048400       WHEN SQLCODE < ZERO                                        04840002
048500       WHEN SQLCODE > ZERO                                        04850002
048600           MOVE '2160-CLOSE-LBVRDA-Y-CSR' TO PV-ABEND-PARAGRAPH   04860002
048700           MOVE 'CLOSE LBVRDA Y CURSOR'                           04870002
048800                                  TO PV-DB2-OPERATION-ATTEMPTED   04880002
048900           MOVE 'TLBVRDA '       TO PV-DB2-TABLE-NAME             04890002
049000           PERFORM 9100-SQL-ABEND                                 04900002
049100     END-EVALUATE.                                                04910002
049200                                                                  04920002
049300******************************************************************04930002
049400 8000-READ-INPUT-FILE.                                            04940001
049500******************************************************************04950002
049600                                                                  04960002
049700      INITIALIZE SU001-EXTRACT-RECORD.                            04970002
049800                                                                  04980002
049900      READ INPUT-FILE INTO SU001-EXTRACT-RECORD                   04990002
050000        AT END                                                    05000002
050100            SET PS-EOF-YES TO TRUE                                05010002
050200        NOT AT END                                                05020002
050300            ADD +1         TO PV-RECS-READ                        05030002
050400      END-READ.                                                   05040001
050500                                                                  05050002
050600******************************************************************05060002
050700 8100-WRITE-OUTPUT-RECORD.                                        05070002
050800******************************************************************05080002
050900                                                                  05090002
051000      WRITE OUTPUT-RECORD FROM SU010-EXTRACT-RECORD.              05100002
051100                                                                  05110002
051200      ADD +1 TO PV-RECS-WRITE.                                    05120002
051300                                                                  05130002
051400******************************************************************05140002
051500 9100-SQL-ABEND.                                                  05150002
051600******************************************************************05160002
051700     MOVE SQLCODE     TO PV-SQLCODE.                              05170001
051800     DISPLAY '** ABEND          ** = SQLABEND'.                   05180002
051900     DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           05190002
052000     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        05200002
052100     DISPLAY '** TABLE AFFECTED ** = ' PV-DB2-TABLE-NAME.         05210002
052200     DISPLAY '** OPERATION      ** = ' PV-DB2-OPERATION-ATTEMPTED.05220002
052300     DISPLAY '** SQLCODE        ** = ' PV-SQLCODE.                05230002
052400     COPY DPPD004.                                                05240017
052500     MOVE +4013                  TO PV-ABEND-CODE.                05250001
052600     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       05260001
052700******************************************************************05270002
052800******************************************************************05280002
