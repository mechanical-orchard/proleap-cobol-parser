000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.     APKUT129.                                        00020001
000300 AUTHOR.         NANCY EILBES.                                    00030001
000400 DATE-WRITTEN.   MAY 2004.                                        00040001
000500 DATE-COMPILED.                                                   00050001
000600*---------------------------------------------------------------* 00060001
000700* COBOL 2 WITH SQL                                              * 00070001
000800*                                                               * 00080001
000900*  EXTRACT GL ENTRY ACTIVITY FOR VENDOR ALLOWANCE AGREEMENTS    * 00090001
001000*---------------------------------------------------------------* 00100001
001100* THE PURPOSE OF THIS PROGRAM IS TO EXTRACT THE GL ACTIVITY FOR * 00110001
001200* BROADCAST AND BRIDAL AGREEMENTS FOR A SPECIFIC PERIOD OF TIME.* 00120001
001800*                                                               * 00180001
001900* THIS PROGRAM USES A CURSOR TO FIND ALL ACTIVE BROADCAST AND   * 00190013
002000* BRIDAL AGREEMENTS BY VENDOR/DEPT.  FOR EACH ROW FETCHED FROM  * 00200013
002100* THE CURSOR, AN OUTPUT RECORD WILL BE CREATED.  IF GL ACTIVITY * 00210013
002200* FOR THE VENDOR AND/OR MDS ACTIVITY FOR THE VENDOR/DEPT ARE    * 00220013
002300* FOUND ON THE ADJUSTMENT DATABASE, THESE WILL BE INCLUDED IN   * 00230013
002400* THE OUTPUT RECORD.  THESE RECORDS WILL BE MERGED WITH THE     * 00240013
002500* EXTRACTS FROM APKUT118 WHEN REPORTING ON BROADCAST OR BRIDAL  * 00250013
002510* ACTIVITY FOR THE CURRENT PERIOD, QUARTER-TO-DATE OR           * 00251013
002520* YEAR-TO-DATE.                                                 * 00252013
002550*                                                               * 00255013
002600* A CONTROL CARD WILL INDICATE FREQUENCY OF THE RUN:            * 00260006
002700* MONTHLY OR QUARTERLY, AND CALCULATE THE START AND END DATES   * 00270001
002800* TO BE USED IN THE SQL ACCORDINGLY.                            * 00280001
002900*---------------------------------------------------------------* 00290001
003000*                                                               * 00300001
003100* DB2/PS TABLES:                              DCLGENS:          * 00310001
003300*  1. ADJUSTMENT JOURNAL HEADER TABLE         TADJRNL           * 00330001
003400*  2. VENDOR AGREEMENT TABLE                  TVNDAGR           * 00340001
003500*  3. VENDOR DEPARTMENT TABLE                 TVNDDPT           * 00350001
003600*  4. EXTERNAL ENTITY TABLE                   TEXTENT           * 00360001
003700*  5. ENTITY NAME TABLE                       TENTNME           * 00370001
003800*  6. MERCHANDISE AREA TABLE                  TMDSEAR           * 00380001
003900*  7. AP CONTROL TABLE                        TAPCNTL           * 00390001
004000*  8. DATE ATTRIBUTE TABLE                    TDTATTR           * 00400001
004300*                                                               * 00430001
004400* OUTPUT:                                                       * 00440001
004500*                                                               * 00450001
004600*  1. AGREEMENT ACTIVITY EXTRACT FILE         APRD081           * 00460001
004800*                                                               * 00480001
004900*---------------------------------------------------------------* 00490001
005000* CHANGE LOG:                                                   * 00500001
005100*   DATE  05/06/2004                                            * 00510001
005200*       CHANGE MADE: INITIAL VERSION.                           * 00520001
005300*       MADE BY: NANCY EILBES            WR/IR #: WR26677       * 00530001
005400*                                                               * 00540001
005500*   DATE  10/21/2004                                            * 00550021
005600*       CHANGE MADE: MODIFIED HANDLING OF TRANCODES '56' AND    * 00560019
005610*       '57' SO THEY WOULD END UP AFFECTING THE CORRECT REPORT  * 00561019
005620*       COLUMNS. CHANGED WHERE CONDITION IN THE AGREEMENT       * 00562019
005630*       CURSOR SO THAT AGREEMENTS WOULD BE INCLUDED IF THEY     * 00563019
005640*       WERE ACTIVE AT ANY TIME DURING THE TIME PERIOD BEING    * 00564019
005650*       EXTRACTED.                                              * 00565019
005700*       MADE BY: NANCY EILBES            WR/IR #: WR26677       * 00570019
005800*                                                               * 00580019
005900*   DATE  08/01/2005                                            * 00590024
006000*       CHANGE MADE: PV-BR-VND-REPAY-AMT NOT BEING INTIALIZED   * 00600024
006100*       BETWEEN VENDORS, SO THE EXTRACT WAS ACCUMULATING THE    * 00610024
006200*       REPAY AMOUNT FOR ALL VENDORS.                           * 00620024
006600*       MADE BY: NANCY EILBES            WR/IR #: P00785069     * 00660024
006700*                                                               * 00670024
006800* DATE  03/17/2006                                              * 00680034
006900*     CHANGE MADE: ADDED UNION TO AGREEMENT CURSOR FOR THE      * 00690026
007000*     INCLUSION OF BROADCAST OFF-INVOICE AGREEMENTS. CHANGE     * 00700026
007001*     MERCHANDISE AND ACCOUNTING CURSORS TO INCLUDE TRANCODE    * 00700126
007002*     5A. ADD LOGIC TO PROCESS 5A'S IN THE SAME WAY AS 88'S FOR * 00700226
007003*     MERCHANDISE AND 50'S FOR ACTUAL DOLLARS                   * 00700326
007004*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR29954         * 00700426
007005*                                                               * 00700535
007006*   DATE  07/13/2009                                            * 00700635
007007*       CHANGE MADE: REMOVED MULT_PSTG_PER_IND CRITERIA FROM    * 00700735
007008*       THE SQL ACCESSING TAPCNTL IN PARAGRAPHS S700 AND S900.  * 00700835
007009*       THIS PROGRAM WOULD HAVE FAILED IN NEW JOB APK890 IF     * 00700935
007010*       THIS CRITERIA WERE LEFT IN, AND THE SQL STILL WORKS     * 00701035
007011*       CORRECTLY WITHOUT IT.                                   * 00701135
007012*       MADE BY: NANCY EILBES            WR/IR #: WR36542       * 00701235
007020*                                                               * 00702026
007100*---------------------------------------------------------------* 00710001
007200                                                                  00720001
007300 ENVIRONMENT DIVISION.                                            00730001
007400 CONFIGURATION SECTION.                                           00740001
007500 SOURCE-COMPUTER.    IBM-3090.                                    00750001
007600 OBJECT-COMPUTER.    IBM-3090.                                    00760001
007700                                                                  00770001
007800 INPUT-OUTPUT SECTION.                                            00780001
007900 FILE-CONTROL.                                                    00790001
008000                                                                  00800001
008100     SELECT EXTRACT-FILE           ASSIGN TO OUT01.               00810001
008300                                                                  00830001
008400 DATA DIVISION.                                                   00840001
008500 FILE SECTION.                                                    00850001
008600                                                                  00860001
008700 FD  EXTRACT-FILE                                                 00870001
008800     RECORDING MODE IS F                                          00880001
008900     LABEL RECORDS ARE STANDARD                                   00890001
009000     BLOCK CONTAINS 0 RECORDS                                     00900001
009100     DATA RECORD IS EXTRACT-RECORD.                               00910001
009200 01  EXTRACT-RECORD                PIC X(250).                    00920001
009300                                                                  00930001
010100 EJECT                                                            01010001
010200                                                                  01020001
010300 WORKING-STORAGE SECTION.                                         01030001
010400                                                                  01040001
010500 01  PROGRAM-CONSTANTS.                                           01050001
010600     05  PC-PROGRAM-NAME           PIC  X(08)  VALUE 'APKUT129'.  01060001
010700     05  PC-INVALID-CC-MSG         PIC  X(29)  VALUE              01070001
010800        'INVALID CONTROL CARD SUPPLIED'.                          01080001
010900     05  PC-NO-RQST-DATES-MSG      PIC  X(42)  VALUE              01090001
011000        'NO DATES SUPPLIED FOR SPECIAL REQUEST RUN.'.             01100001
011100     05  PC-INVALID-FYR-MSG        PIC X(55)   VALUE              01110001
011200        'RQST BEGIN DATE & RQST END DATE NOT IN SAME FISCAL YEAR'.01120001
011300     05  PC-INVALID-ENDDTE-MSG     PIC X(55)   VALUE              01130001
011400        'RQST END DATE IS NOT A VALID FSCL_MN_END_DTE ON TDTATTR'.01140001
011500     05  PC-INVALID-BEGDTE-MSG     PIC X(55)   VALUE              01150001
011600        'RQST BEG DATE IS NOT A VALID FSCL_MN_BEG_DTE ON TDTATTR'.01160001
011810     05  PC-MOEND-RPT-MSG          PIC X(48)   VALUE              01181001
011820        'ONLY QTR, SA AND ANL ARE VALID FOR MONTH END RUN'.       01182001
011830     05  PC-CAL-RPT-MSG            PIC X(47)   VALUE              01183001
011840        'ONLY QTR, SA AND ANL ARE VALID FOR CALENDAR RUN'.        01184001
011850                                                                  01185001
011860 01  PV-PROCESS-COUNTERS.                                         01186001
011890     05  PV-ACCTG-CSR-COUNT        PIC  9(08)  VALUE ZEROS.       01189001
011891     05  PV-MDSE-CSR-COUNT         PIC  9(08)  VALUE ZEROS.       01189112
011900     05  PV-AGR-CSR-COUNT          PIC  9(08)  VALUE ZEROS.       01190001
012000     05  PV-EXTRACT-COUNT          PIC  9(08)  VALUE ZEROS.       01200001
012100                                                                  01210001
012200 01  PROGRAM-SWITCHES.                                            01220001
012600     05  PS-END-OF-AGR-CSR-SW      PIC X   VALUE 'N'.             01260001
012700         88  NOT-END-OF-AGR-CSR            VALUE 'N'.             01270001
012800         88  END-OF-AGR-CSR                VALUE 'Y'.             01280001
013200     05  PS-END-OF-ACCTG-CSR-SW    PIC X   VALUE 'N'.             01320001
013300         88  NOT-END-OF-ACCTG-CSR          VALUE 'N'.             01330001
013400         88  END-OF-ACCTG-CSR              VALUE 'Y'.             01340001
013410     05  PS-END-OF-MDSE-CSR-SW     PIC X   VALUE 'N'.             01341011
013420         88  NOT-END-OF-MDSE-CSR           VALUE 'N'.             01342011
013430         88  END-OF-MDSE-CSR               VALUE 'Y'.             01343011
013500     05  PS-ADJ-FOUND-SW           PIC X   VALUE 'N'.             01350001
013600         88  NO-ADJUSTMENT-FOUND           VALUE 'N'.             01360001
013700         88  ADJUSTMENT-FOUND              VALUE 'Y'.             01370001
013830     05  PS-AGR-FOUND-SW           PIC X   VALUE 'N'.             01383001
013840         88  NO-AGREEMENTS-FOUND           VALUE 'N'.             01384001
013850         88  AGREEMENTS-FOUND              VALUE 'Y'.             01385001
013860                                                                  01386001
013870 01  PROGRAM-VARIABLES.                                           01387001
013880     05  HOLD-ENT-ID               PIC S9(9) COMP VALUE ZEROES.   01388001
013890     05  DISPLAY-ENT-ID            PIC 9(9).                      01389001
013900     05  HOLD-DEPT-NBR             PIC X(3)       VALUE SPACES.   01390001
014000     05  HOLD-VND-NBR              PIC X(9)       VALUE SPACES.   01400001
014100     05  PV-MIN-MOEND-DTE          PIC X(10).                     01410001
014200     05  PV-MAX-MOEND-DTE          PIC X(10).                     01420001
014300     05  PV-MIN-PSTG-FMN-NBR       PIC XX.                        01430001
014400     05  PV-MAX-PSTG-FMN-NBR       PIC XX.                        01440001
014500     05  PV-MIN-CAL-MN-NBR         PIC XX.                        01450001
014600     05  PV-MAX-CAL-MN-NBR         PIC XX.                        01460001
014610     05  PV-PREVYR-FMN-NBR         PIC XX.                        01461001
014620     05  PV-MIN-FSCL-QTR-NBR       PIC X.                         01462001
014630     05  PV-MAX-FSCL-QTR-NBR       PIC X.                         01463001
014640     05  PV-MIN-CAL-QTR-NBR        PIC X.                         01464001
014650     05  PV-MAX-CAL-QTR-NBR        PIC X.                         01465001
014660     05  PV-CURR-PSTG-FYR-NBR      PIC X(4).                      01466001
014670     05  PV-PREV-PSTG-FYR-NBR      PIC X(4).                      01467001
014680     05  PV-CAL-QTR-NBR            PIC X.                         01468001
014690     05  PV-CAL-YR-NBR             PIC X(4).                      01469001
014691     05  PV-PSTG-FYR-NBR           PIC X(4).                      01469101
014692     05  PV-FYR-NBR-NUM            PIC 9(4).                      01469201
014693     05  PV-END-FSCL-YR-NBR        PIC X(4).                      01469301
014694     05  PV-FSCL-MN-NBR            PIC X(2).                      01469401
014695     05  PV-FSCL-YR-NBR            PIC X(4).                      01469501
014696     05  PV-FSCL-QTR-NBR           PIC X(1).                      01469601
014697     05  PV-CAL-MN-NBR             PIC X(2).                      01469701
014698     05  PV-FSCL-MN-BEG-DTE        PIC X(10).                     01469801
014699     05  PV-FSCL-MN-END-DTE        PIC X(10).                     01469901
014700     05  PV-ACTIVITY-TYP-CDE       PIC X.                         01470001
014800     05  PV-ADJUSTMENT-CDE         PIC XX.                        01480001
014900     05  PV-ADJUSTMENT-AMT         PIC S9(11)V99   COMP-3.        01490001
015000     05  PV-ACTIVITY-AMT           PIC S9(11)V99   COMP-3.        01500001
015100     05  PV-MOS-ACTVTY-AMT         PIC S9(11)V99   COMP-3.        01510001
015200* BROADCAST OPTIMIZATION(BO) WORK FIELDS                          01520001
015300     05  PV-BO-EARNED-AMT          PIC S9(09)V99   COMP-3 VALUE 0.01530001
015400     05  PV-BO-REVERSED-AMT        PIC S9(09)V99   COMP-3 VALUE 0.01540001
015500     05  PV-BO-VND-DED-AMT         PIC S9(09)V99   COMP-3 VALUE 0.01550001
015600     05  PV-BO-VND-REPAY-AMT       PIC S9(09)V99   COMP-3 VALUE 0.01560001
015700     05  PV-BO-BUYER-CR-AMT        PIC S9(09)V99   COMP-3 VALUE 0.01570001
015710     05  PV-MDS-VND-DED-AMT        PIC S9(09)V99   COMP-3 VALUE 0.01571011
015720     05  PV-MDS-VND-REPAY-AMT      PIC S9(09)V99   COMP-3 VALUE 0.01572011
015730     05  PV-MDS-BUYER-CR-AMT       PIC S9(09)V99   COMP-3 VALUE 0.01573011
015800* BRIDAL REGISTRY(BR) WORK FIELDS                                 01580001
015900     05  PV-BR-EARNED-AMT          PIC S9(09)V99   COMP-3 VALUE 0.01590001
016000     05  PV-BR-REVERSED-AMT        PIC S9(09)V99   COMP-3 VALUE 0.01600001
016100     05  PV-BR-VND-DED-AMT         PIC S9(09)V99   COMP-3 VALUE 0.01610001
016200     05  PV-BR-VND-REPAY-AMT       PIC S9(09)V99   COMP-3 VALUE 0.01620001
016300     05  PV-BR-EXP-CR-AMT          PIC S9(09)V99   COMP-3 VALUE 0.01630001
016310     05  EXTRACT-BEGIN-DTE         PIC X(10).                     01631001
016330     05  EXTRACT-END-DTE           PIC X(10).                     01633001
016400                                                                  01640001
016500 EJECT                                                            01650001
016600                                                                  01660001
016700 01  CONTROL-CARD.                                                01670001
016800     05  CC-RUN-FRQ-CDE            PIC XX.                        01680001
017000         88  CC-MOEND-RUN              VALUE 'ME'.                01700001
017100         88  CC-CALENDAR-RUN           VALUE 'CA'.                01710001
017200         88  CC-SPECIAL-REQUEST        VALUE 'SP'.                01720001
017300         88  CC-RUN-FRQ-VALID          VALUE 'SP', 'ME', 'CA'.    01730001
017500     05  FILLER                    PIC X.                         01750001
017600     05  CC-REPORT-TYP-CDE         PIC X(3).                      01760001
017700         88  CC-MONTH-TO-DATE          VALUE 'MTD'.               01770001
017800         88  CC-QUARTERLY              VALUE 'QTR'.               01780001
017900         88  CC-SEMI-ANNUAL            VALUE 'SA '.               01790001
018000         88  CC-YEAR-TO-DATE           VALUE 'YTD'.               01800001
018100         88  CC-REQUESTED-DATES        VALUE 'REQ'.               01810001
018200         88  CC-RPT-TYP-VALID          VALUE 'REQ', 'MTD', 'QTR', 01820001
018300                                             'SA ', 'YTD'.        01830001
018400         88  CC-VALID-MOEND-RPT        VALUE 'MTD', 'QTR', 'SA ', 01840001
018500                                             'YTD'.               01850001
018600         88  CC-VALID-CAL-RPT          VALUE 'QTR', 'SA ', 'YTD'. 01860001
018700         88  CC-VALID-WKLY-RPT         VALUE 'MTD', 'QTR'.        01870001
018800                                                                  01880001
018900     05  FILLER                    PIC X.                         01890001
019000     05  CC-RQST-BEGIN-DTE         PIC X(10).                     01900001
019100     05  FILLER                    PIC X.                         01910001
019200     05  CC-RQST-END-DTE           PIC X(10).                     01920001
019300     05  FILLER                    PIC X(52).                     01930001
019400                                                                  01940001
020100 EJECT                                                            02010001
020400*----------------------------------------------------------------*02040001
020500*  OUTPUT RECORD AREA                                             02050001
020600*----------------------------------------------------------------*02060001
020700                                                                  02070001
020800     COPY APRD081.                                                02080001
020900                                                                  02090001
021000*----------------------------------------------------------------*02100001
021100*    SQL COMMUNICATIONS AREA DCLGEN                               02110001
021200*----------------------------------------------------------------*02120001
021300     EXEC SQL                                                     02130001
021400         INCLUDE SQLCA                                            02140001
021500     END-EXEC.                                                    02150001
021600                                                                  02160001
022400*----------------------------------------------------------------*02240001
022500* ADJUSTMENT JOURNAL HEADER TABLE                                 02250001
022600*----------------------------------------------------------------*02260001
022700     EXEC SQL                                                     02270001
022800         INCLUDE TADJRNL                                          02280001
022900     END-EXEC.                                                    02290001
023000                                                                  02300001
023100*----------------------------------------------------------------*02310001
023200* VENDOR AGREEMENT TABLE                                          02320001
023300*----------------------------------------------------------------*02330001
023400     EXEC SQL                                                     02340001
023500         INCLUDE TVNDAGR                                          02350001
023600     END-EXEC.                                                    02360001
023700                                                                  02370001
023800*----------------------------------------------------------------*02380001
023900* VENDOR DEPARTMENT TABLE                                         02390001
024000*----------------------------------------------------------------*02400001
024100     EXEC SQL                                                     02410001
024200         INCLUDE TVNDDPT                                          02420001
024300     END-EXEC.                                                    02430001
024400                                                                  02440001
024500*----------------------------------------------------------------*02450001
024600* EXTERNAL ENTITY TABLE                                           02460001
024700*----------------------------------------------------------------*02470001
024800     EXEC SQL                                                     02480001
024900         INCLUDE TEXTENT                                          02490001
025000     END-EXEC.                                                    02500001
025100                                                                  02510001
025200*----------------------------------------------------------------*02520001
025300* ENTITY NAME TABLE                                               02530001
025400*----------------------------------------------------------------*02540001
025500     EXEC SQL                                                     02550001
025600         INCLUDE TENTNME                                          02560001
025700     END-EXEC.                                                    02570001
025800                                                                  02580001
025900*----------------------------------------------------------------*02590001
026000* MERCHANDISE AREA TABLE                                          02600001
026100*----------------------------------------------------------------*02610001
026200     EXEC SQL                                                     02620001
026300         INCLUDE TMDSEAR                                          02630001
026400     END-EXEC.                                                    02640001
026500                                                                  02650001
026600*----------------------------------------------------------------*02660001
026700* AP CONTROL TABLE                                                02670001
026800*----------------------------------------------------------------*02680001
026900     EXEC SQL                                                     02690001
027000         INCLUDE TAPCNTL                                          02700001
027100     END-EXEC.                                                    02710001
027200                                                                  02720001
027300*----------------------------------------------------------------*02730001
027400* DATE ATTRIBUTE TABLE                                            02740001
027500*----------------------------------------------------------------*02750001
027600     EXEC SQL                                                     02760001
027700         INCLUDE TDTATTR                                          02770001
027800     END-EXEC.                                                    02780001
027900                                                                  02790001
028000*----------------------------------------------------------------*02800001
028100*  AGREEMENT CURSOR RETRIEVES THE VENDOR ALLOWANCE AGREEMENTS    *02810001
028200*  FROM THE VENDOR AGREEMENT DATABASE FOR ALL VENDOR/DEPTS THAT  *02820001
028300*  ARE CURRENTLY ACTIVE.  ONLY BROADCAST AND BRIDAL AGREEMENTS   *02830001
028400*  WILL BE PROCESSED AT THIS TIME.  THIS IS THE DRIVING CURSOR   *02840001
028410*  FOR THE PROGRAM.                                              *02841001
028500*----------------------------------------------------------------*02850001
028600     EXEC SQL                                                     02860001
028700        DECLARE AGREEMENT_CSR CURSOR FOR                          02870001
028800         SELECT AG.ENT_ID                                         02880001
028801              , EX.DUN_NBR                                        02880102
028802              , EN.ENT_NAME_DESC                                  02880202
028803              , AG.DEPT_NBR                                       02880301
028810              , AG.AP_TRN_CDE                                     02881001
028900              , COALESCE(AG.DISCOUNT_PCT,0)                       02890001
029000              , AG.PSTG_FRQ_CDE                                   02900001
029100              , AG.DED_DISC_IND                                   02910001
029200              , AG.DED_RTV_IND                                    02920001
029300           FROM TVNDAGR AG                                        02930001
029400              , TVNDDPT VD                                        02940001
029410              , TEXTENT EX                                        02941002
029420              , TENTNME EN                                        02942002
029500          WHERE AG.AGRMT_TYP_ID      = '6'                        02950001
029600            AND AG.TYP_CDE           = 6                          02960001
029800            AND AG.AP_TRN_CDE       IN ('88','89')                02980001
029900            AND AG.ENT_ID            = VD.ENT_ID                  02990001
029910            AND AG.ENT_ID            = EX.ENT_ID                  02991002
029920            AND AG.ENT_ID            = EN.ENT_ID                  02992002
030000            AND AG.DEPT_NBR          = VD.DEPT_NBR                03000001
030100            AND VD.VND_DEPT_STAT_CD  = 'A'                        03010001
030110            AND EN.TYPE_CDE = '01'                                03011002
030200            AND (:EXTRACT-BEGIN-DTE   BETWEEN AG.EFFECTIVE_DATE   03020018
030300                                         AND AG.EXPIRATION_DATE   03030001
030400             OR :EXTRACT-END-DTE     BETWEEN AG.EFFECTIVE_DATE    03040018
030500                                         AND AG.EXPIRATION_DATE)  03050018
030600      UNION ALL                                                   03060030
030610         SELECT AG.ENT_ID                                         03061030
030620              , EX.DUN_NBR                                        03062029
030630              , EN.ENT_NAME_DESC                                  03063029
030640              , AG.DEPT_NBR                                       03064029
030700              , '5A'                                              03070029
030800              , COALESCE(AG.DISCOUNT_PCT,0)                       03080028
030900              , 'IV'                                              03090028
031000              , 'N'                                               03100028
031100              , 'N'                                               03110028
031110           FROM TVNDAGR AG                                        03111029
031120              , TVNDDPT VD                                        03112029
031130              , TEXTENT EX                                        03113029
031140              , TENTNME EN                                        03114029
031400          WHERE AG.AGRMT_TYP_ID      = '5'                        03140028
031500            AND AG.TYP_CDE           = 9                          03150028
031510            AND AG.ENT_ID            = VD.ENT_ID                  03151029
031520            AND AG.ENT_ID            = EX.ENT_ID                  03152029
031530            AND AG.ENT_ID            = EN.ENT_ID                  03153029
031540            AND AG.DEPT_NBR          = VD.DEPT_NBR                03154029
031550            AND VD.VND_DEPT_STAT_CD  = 'A'                        03155029
031560            AND EN.TYPE_CDE = '01'                                03156029
032100            AND :APCNTL-BTCH-PRC-DTE BETWEEN AG.EFFECTIVE_DATE    03210028
032200                                         AND AG.EXPIRATION_DATE   03220028
032500          WITH UR                                                 03250001
032600     END-EXEC.                                                    03260001
032700                                                                  03270001
038200*----------------------------------------------------------------*03820001
038300*  ACCTG_ENTRY CURSOR RETRIEVES THE RETURNS AND INVOICE DISCOUNTS 03830001
038400*  FROM THE ADJUSTMENT JOURNAL DATABASE FOR THE VENDOR/DEPT       03840001
038500*  BEING PROCESSED.  IT WILL BE OPENED AND CLOSED BASED ON THE    03850001
038600*  ROWS FETCHED FROM THE ACTIVITY CURSOR.                         03860001
038700*----------------------------------------------------------------*03870001
038710     EXEC SQL                                                     03871001
038720        DECLARE ACCTG_ENTRY_CSR CURSOR FOR                        03872001
038730         SELECT AP_TRN_CDE                                        03873001
038740              , SUM(NET_COST_AMT)                                 03874001
038750            FROM TADJRNL                                          03875001
038760           WHERE AP_TRN_CDE   IN ('50','51','56','57','5A',       03876027
038770                  '88','89','91','92','93','94','95','96','97')   03877001
038780             AND VND_NBR                = :HOLD-VND-NBR           03878001
038790             AND ((PSTG_FMN_NBR   BETWEEN :PV-MIN-PSTG-FMN-NBR    03879001
038800                                      AND :PV-MAX-PSTG-FMN-NBR    03880001
038810                   AND PSTG_FYR_NBR     = :PV-CURR-PSTG-FYR-NBR)  03881001
038811               OR (PSTG_FMN_NBR         = :PV-PREVYR-FMN-NBR      03881101
038812                   AND PSTG_FYR_NBR     = :PV-PREV-PSTG-FYR-NBR)) 03881201
038813          GROUP BY AP_TRN_CDE                                     03881301
038814          WITH UR                                                 03881401
038815     END-EXEC.                                                    03881501
038816                                                                  03881601
038817*----------------------------------------------------------------*03881711
038818*  MERCHANDISE CURSOR RETRIEVES THE BUYER CREDITS AND REPAYMENTS  03881811
038819*  FROM THE ADJUSTMENT JOURNAL DATABASE FOR THE VENDOR/DEPT       03881911
038820*  BEING PROCESSED.                                               03882011
038840*----------------------------------------------------------------*03884011
038850     EXEC SQL                                                     03885011
038860        DECLARE MERCHANDISE_CSR CURSOR FOR                        03886011
038870         SELECT AP_TRN_CDE                                        03887011
038880              , SUM(NET_COST_AMT)                                 03888011
038890            FROM TADJRNL                                          03889011
038900           WHERE AP_TRN_CDE   IN ('50','51','56','57','5A')       03890027
039100             AND VND_NBR                = :HOLD-VND-NBR           03910011
039110             AND DEPT_NBR               = :HOLD-DEPT-NBR          03911011
039200             AND ((PSTG_FMN_NBR   BETWEEN :PV-MIN-PSTG-FMN-NBR    03920011
039300                                      AND :PV-MAX-PSTG-FMN-NBR    03930011
039400                   AND PSTG_FYR_NBR     = :PV-CURR-PSTG-FYR-NBR)  03940011
039500               OR (PSTG_FMN_NBR         = :PV-PREVYR-FMN-NBR      03950011
039600                   AND PSTG_FYR_NBR     = :PV-PREV-PSTG-FYR-NBR)) 03960011
039700          GROUP BY AP_TRN_CDE                                     03970011
039800          WITH UR                                                 03980011
039900     END-EXEC.                                                    03990011
040000                                                                  04000011
040800*----------------------------------------------------------------*04080001
040900*    ABEND DATA AREAS                                             04090001
041000*----------------------------------------------------------------*04100001
041100 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      04110001
041200                                   COMP         SYNC.             04120001
041300                                                                  04130001
041400     88  AC-ANY-ERROR                           VALUE  +4001      04140001
041500                                                THRU   +4019.     04150001
041600     88  AC-OPEN-ERROR                          VALUE  +4005.     04160001
041700     88  AC-CLOSE-ERROR                         VALUE  +4006.     04170001
041800     88  AC-INVALID-CONTROL-CARD                VALUE  +4007.     04180001
041900     88  AC-INVALID-DATA                        VALUE  +4008.     04190001
042000     88  AC-DB2-ERROR                           VALUE  +4013.     04200001
042100                                                                  04210001
042200 01  ABEND-AREAS.                                                 04220001
042300     05  AA-ABEND-LIT              PIC  X(40)   VALUE             04230001
042400             '*****       ABEND'.                                 04240001
042500     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             04250001
042600             '*****   PROGRAM: APKUT129'.                         04260001
042700     05  AA-PARAGRAPH-LIT.                                        04270001
042800         10  FILLER                PIC  X(17)   VALUE             04280001
042900             '***** PARAGRAPH: '.                                 04290001
043000         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     04300001
043100     05  AA-MESSAGE-LINE-1.                                       04310001
043200         10  FILLER                PIC  X(06)   VALUE '*****'.    04320001
043300         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     04330001
043400     05  AA-MESSAGE-LINE-2.                                       04340001
043500         10  FILLER                PIC  X(06)   VALUE '*****'.    04350001
043600         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     04360001
043700     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             04370001
043800             '*****    DB2 ERROR'.                                04380001
043900     05  AA-DB2-OPERATION-LIT.                                    04390001
044000         10  FILLER                PIC  X(17)   VALUE             04400001
044100             '***** OPERATION: '.                                 04410001
044200         10  AA-DB2-OPERATION.                                    04420001
044300             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     04430001
044400             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     04440001
044500     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     04450001
044600     05  AA-DB2-TABLE-2            PIC  X(08)   VALUE SPACES.     04460001
044700     05  AA-DB2-TABLE-3            PIC  X(08)   VALUE SPACES.     04470001
044800     05  AA-DB2-TABLE-4            PIC  X(08)   VALUE SPACES.     04480001
044900     05  AA-DB2-TABLE-5            PIC  X(08)   VALUE SPACES.     04490001
045000     05  AA-DB2-TABLE-6            PIC  X(08)   VALUE SPACES.     04500001
045100                                                                  04510001
045200*----------------------------------------------------------------*04520001
045300*    SQLCA FORMATTED MESSAGE AREA                                 04530001
045400*----------------------------------------------------------------*04540001
045500     COPY DPWS004.                                                04550001
045600                                                                  04560001
045700 01  FILLER                        PIC  X(25)   VALUE             04570001
045800     '** END OF APKUT129 W/S **'.                                 04580001
045900                                                                  04590001
046000*-------------------*                                             04600001
046100 PROCEDURE DIVISION.                                              04610001
046200*-------------------*                                             04620001
046300 A100-MAINLINE.                                                   04630001
046400                                                                  04640001
046500     PERFORM B100-INITIALIZE.                                     04650001
046600                                                                  04660001
046700     PERFORM B200-CREATE-EXTRACT                                  04670001
046800         UNTIL END-OF-AGR-CSR.                                    04680001
046900                                                                  04690001
047000     PERFORM B300-END-OF-PROGRAM.                                 04700001
047100                                                                  04710001
047200     GOBACK.                                                      04720001
047300                                                                  04730001
047400                                                                  04740001
047500*----------------------------------------------------------------*04750001
047600*    INITIALIZATION PROCESSING                                   *04760001
047700*                                                                *04770001
047800*    - OPEN FILE.                                                *04780001
047900*    - INTIALIZE LAYOUTS.                                        *04790001
048100*    - OPEN THE AGREEMENTS CURSOR AND FETCH FIRST ROW.           *04810001
048200*----------------------------------------------------------------*04820001
048300 B100-INITIALIZE.                                                 04830001
048400                                                                  04840001
048500     DISPLAY '**------ BEGINNING PROGRAM APKUT129 ------**'.      04850001
048600                                                                  04860001
048700     OPEN OUTPUT EXTRACT-FILE.                                    04870001
048900                                                                  04890001
049000     INITIALIZE  DCLTEXTENT                                       04900001
049200                 DCLTENTNME                                       04920001
049300                 DCLTVNDAGR                                       04930001
049310                 DCLTVNDDPT                                       04931001
049400                 DCLTAPCNTL                                       04940001
049500                 DCLTDTATTR                                       04950001
049600                 DCLTADJRNL                                       04960001
049700                 DCLTMDSEAR                                       04970001
049800                 AP081-VNDAGR-EXTRACT.                            04980001
049900                                                                  04990001
050000     ACCEPT CONTROL-CARD.                                         05000001
050100     DISPLAY '*** CONTROL CARD FOR THIS RUN ***'                  05010001
050200     DISPLAY CONTROL-CARD.                                        05020001
050300     DISPLAY '*** END OF CONTROL CARD ***'                        05030001
050400                                                                  05040001
050500     PERFORM D100-VALIDATE-CONTROL-CARD.                          05050001
050501                                                                  05050109
050510     MOVE PV-MAX-MOEND-DTE TO EXTRACT-END-DTE.                    05051009
050520                                                                  05052009
050600     DISPLAY '*** DATE CONTROLS SELECTED FOR THIS RUN ***'        05060001
050700     DISPLAY 'BATCH PROCESS DATE   = ' APCNTL-BTCH-PRC-DTE.       05070008
050800     DISPLAY 'PV-MIN-MOEND-DTE     = ' PV-MIN-MOEND-DTE.          05080008
050900     DISPLAY 'PV-MAX-MOEND-DTE     = ' PV-MAX-MOEND-DTE.          05090008
051000     DISPLAY 'PV-MIN-PSTG-FMN-NBR  = ' PV-MIN-PSTG-FMN-NBR.       05100008
051100     DISPLAY 'PV-MAX-PSTG-FMN-NBR  = ' PV-MAX-PSTG-FMN-NBR.       05110008
051200     DISPLAY 'PV-MIN-CAL-MN-NBR    = ' PV-MIN-CAL-MN-NBR.         05120008
051300     DISPLAY 'PV-MAX-CAL-MN-NBR    = ' PV-MAX-CAL-MN-NBR.         05130008
051400     DISPLAY 'PV-CAL-QTR-NBR       = ' PV-CAL-QTR-NBR.            05140008
051500     DISPLAY 'PV-MIN-FSCL-QTR-NBR  = ' PV-MIN-FSCL-QTR-NBR.       05150008
051600     DISPLAY 'PV-MAX-FSCL-QTR-NBR  = ' PV-MAX-FSCL-QTR-NBR.       05160008
051700     DISPLAY 'PV-CURR-PSTG-FYR-NBR = ' PV-CURR-PSTG-FYR-NBR.      05170001
051800     DISPLAY 'PV-PREV-PSTG-FYR-NBR = ' PV-PREV-PSTG-FYR-NBR.      05180001
051900     DISPLAY 'PV-PREVYR-FMN-NBR    = ' PV-PREVYR-FMN-NBR.         05190008
051910     DISPLAY 'EXTRACT-BEGIN-DTE    = ' EXTRACT-BEGIN-DTE.         05191008
051920     DISPLAY 'EXTRACT-END-DTE      = ' EXTRACT-END-DTE.           05192008
052000     DISPLAY '****** END OF DATE CONTROLS DISPLAY *******'.       05200001
052100                                                                  05210001
052410     PERFORM X100-OPEN-AGREEMENT-CSR.                             05241001
052420                                                                  05242001
052430     PERFORM S100-FETCH-AGREEMENT-CSR.                            05243001
052440                                                                  05244001
052900     IF  END-OF-AGR-CSR                                           05290001
053000         DISPLAY 'NO ROWS RETURNED FOR AGREEMENT CURSOR!!!'       05300001
053100     ELSE                                                         05310001
053200         PERFORM S400-SELECT-TMDSEAR                              05320011
053300         MOVE VNDAGR-ENT-ID   TO HOLD-ENT-ID                      05330001
053400                                 DISPLAY-ENT-ID                   05340001
053500         MOVE VNDAGR-DEPT-NBR TO HOLD-DEPT-NBR                    05350001
053600         MOVE EXTENT-DUN-NBR  TO HOLD-VND-NBR                     05360001
053610         PERFORM C100-GET-ACCOUNTING-ENTRIES                      05361011
053620         PERFORM C200-GET-MERCHANDISE-ENTRIES                     05362011
053700     END-IF.                                                      05370001
053800                                                                  05380001
053900                                                                  05390001
054000*----------------------------------------------------------------*05400001
054100*    PROCESS AGREEMENT CURSOR                                    *05410001
054200*                                                                *05420001
054500*    WHEN NEW VENDOR/DEPT FETCHED, OPEN AND PROCESS ADJUSTMENT   *05450020
054600*    ACCOUNTING ENTRY AND AGREEMENT CURSORS.                     *05460001
055500*----------------------------------------------------------------*05550001
055600 B200-CREATE-EXTRACT.                                             05560001
055700                                                                  05570001
055800     IF  VNDAGR-ENT-ID = HOLD-ENT-ID                              05580001
055810         IF  VNDAGR-DEPT-NBR = HOLD-DEPT-NBR                      05581002
055811             CONTINUE                                             05581102
055812         ELSE                                                     05581202
055820             PERFORM S400-SELECT-TMDSEAR                          05582011
055821             MOVE VNDAGR-DEPT-NBR TO HOLD-DEPT-NBR                05582102
055822             INITIALIZE PV-MDS-VND-DED-AMT                        05582211
055823                        PV-MDS-VND-REPAY-AMT                      05582311
055824                        PV-MDS-BUYER-CR-AMT                       05582411
055825             PERFORM C200-GET-MERCHANDISE-ENTRIES                 05582511
055830         END-IF                                                   05583002
056000     ELSE                                                         05600002
057500         INITIALIZE AP081-VNDAGR-EXTRACT                          05750001
057600                    PV-BO-EARNED-AMT                              05760001
057700                    PV-BO-REVERSED-AMT                            05770001
057800                    PV-BO-VND-DED-AMT                             05780001
057900                    PV-BO-VND-REPAY-AMT                           05790001
058000                    PV-BO-BUYER-CR-AMT                            05800001
058010                    PV-MDS-VND-DED-AMT                            05801011
058020                    PV-MDS-VND-REPAY-AMT                          05802011
058030                    PV-MDS-BUYER-CR-AMT                           05803011
058100                    PV-BR-EARNED-AMT                              05810001
058200                    PV-BR-REVERSED-AMT                            05820001
058210                    PV-BR-VND-REPAY-AMT                           05821024
058300                    PV-BR-VND-DED-AMT                             05830001
058400                    PV-BR-EXP-CR-AMT                              05840001
058500                                                                  05850001
058600         PERFORM S400-SELECT-TMDSEAR                              05860014
059000         MOVE VNDAGR-ENT-ID   TO HOLD-ENT-ID                      05900005
059100                                 DISPLAY-ENT-ID                   05910005
059200         MOVE VNDAGR-DEPT-NBR TO HOLD-DEPT-NBR                    05920001
059300         MOVE EXTENT-DUN-NBR  TO HOLD-VND-NBR                     05930005
059310         PERFORM C100-GET-ACCOUNTING-ENTRIES                      05931011
059320         PERFORM C200-GET-MERCHANDISE-ENTRIES                     05932011
059400     END-IF.                                                      05940001
059500                                                                  05950001
059600     MOVE MDSEAR-DMA-NBR             TO AP081-DMA-NBR.            05960001
059610     MOVE MDSEAR-GMA-NBR             TO AP081-GMA-NBR.            05961015
059700     MOVE EXTENT-DUN-NBR             TO AP081-VENDOR-NBR.         05970001
059800     MOVE ENTNME-ENT-NAME-DESC       TO AP081-VENDOR-NAME.        05980001
059900     MOVE VNDAGR-ENT-ID              TO AP081-ENT-ID.             05990001
060000     MOVE VNDAGR-DEPT-NBR            TO AP081-DEPT-NBR.           06000001
060010     MOVE VNDAGR-AP-TRN-CDE          TO AP081-AGR-AP-TRN-CDE.     06001002
060020     MOVE VNDAGR-DISCOUNT-PCT        TO AP081-AGR-DISC-PCT.       06002002
060030     MOVE VNDAGR-DED-DISC-IND        TO AP081-AGR-RTV-IND.        06003002
060040     MOVE VNDAGR-DED-RTV-IND         TO AP081-AGR-DSC-IND.        06004002
060050     MOVE VNDAGR-PSTG-FRQ-CDE        TO AP081-AGR-PSTG-FRQ-CDE.   06005002
060100     MOVE PV-FSCL-MN-NBR             TO AP081-FSCL-MN-NBR.        06010001
060200     MOVE PV-FSCL-YR-NBR             TO AP081-FSCL-YR-NBR.        06020001
060300     MOVE PV-FSCL-QTR-NBR            TO AP081-FSCL-QTR-NBR.       06030001
060400     MOVE PV-CAL-MN-NBR              TO AP081-CAL-MN-NBR.         06040001
060500     MOVE PV-CAL-YR-NBR              TO AP081-CAL-YR-NBR.         06050001
060600     MOVE PV-CAL-QTR-NBR             TO AP081-CAL-QTR-NBR.        06060001
060700     MOVE PV-FSCL-MN-BEG-DTE         TO AP081-FSCL-MN-BEG-DTE.    06070001
060800     MOVE PV-FSCL-MN-END-DTE         TO AP081-FSCL-MN-END-DTE.    06080001
060810     MOVE ZERO                       TO AP081-GROSS-PURCHS-AMT    06081002
060820                                        AP081-OTHER-ACTVTY-AMT    06082002
060821                                        AP081-RETURNS-AMT         06082102
060830                                        AP081-DISCOUNT-AMT        06083002
060840                                        AP081-PRCH-NET-RTV-AMT    06084002
060850                                        AP081-PRCH-NET-DSC-AMT    06085002
060860                                        AP081-PRCH-NET-ALL-AMT    06086002
060870                                        AP081-EST-EARNED-AMT.     06087002
060900                                                                  06090001
061000     EVALUATE TRUE                                                06100005
061100        WHEN VNDAGR-AP-TRN-CDE = '88'                             06110005
061200           MOVE PV-BO-EARNED-AMT     TO AP081-EARNED-ALLW-AMT     06120016
061300           MOVE PV-BO-REVERSED-AMT   TO AP081-RVRS-EARNED-AMT     06130016
061401           MOVE PV-BO-VND-DED-AMT    TO AP081-VND-DED-AMT         06140116
061502           MOVE PV-MDS-VND-REPAY-AMT TO AP081-VND-REPAY-AMT       06150216
061510           MOVE PV-MDS-BUYER-CR-AMT  TO AP081-DEPT-EXP-CR-AMT     06151016
061520        WHEN VNDAGR-AP-TRN-CDE = '89'                             06152005
061530           MOVE PV-BR-EARNED-AMT    TO AP081-EARNED-ALLW-AMT      06153005
061540           MOVE PV-BR-REVERSED-AMT  TO AP081-RVRS-EARNED-AMT      06154005
061550           MOVE PV-BR-VND-DED-AMT   TO AP081-VND-DED-AMT          06155005
061560           MOVE PV-BR-VND-REPAY-AMT TO AP081-VND-REPAY-AMT        06156005
061570           MOVE PV-BR-EXP-CR-AMT    TO AP081-DEPT-EXP-CR-AMT      06157005
061571        WHEN VNDAGR-AP-TRN-CDE = '5A'                             06157126
061572           MOVE PV-BO-EARNED-AMT     TO AP081-EARNED-ALLW-AMT     06157226
061573           MOVE PV-BO-REVERSED-AMT   TO AP081-RVRS-EARNED-AMT     06157326
061574           MOVE PV-MDS-VND-DED-AMT   TO AP081-VND-DED-AMT         06157432
061575           MOVE PV-MDS-VND-REPAY-AMT TO AP081-VND-REPAY-AMT       06157526
061576           MOVE PV-MDS-BUYER-CR-AMT  TO AP081-DEPT-EXP-CR-AMT     06157626
061580     END-EVALUATE.                                                06158005
061581                                                                  06158105
061590     PERFORM W100-WRITE-EXTRACT-RECORD.                           06159005
061591                                                                  06159105
061600     PERFORM S100-FETCH-AGREEMENT-CSR.                            06160001
061700                                                                  06170001
061800                                                                  06180001
061900*----------------------------------------------------------------*06190001
062000*    END OF PROGRAM                                              *06200001
062100*    - PROCESS THE LAST ENTRY FETCHED FROM THE CURSOR.           *06210001
062200*    - CLOSE THE CURSOR AND FILE                                 *06220001
062300*    - DISPLAY PROGRAM COUNTS.                                   *06230001
062400*----------------------------------------------------------------*06240001
062500 B300-END-OF-PROGRAM.                                             06250001
062600                                                                  06260001
064900     CLOSE EXTRACT-FILE.                                          06490002
065000     PERFORM X200-CLOSE-AGREEMENT-CSR.                            06500007
065100                                                                  06510001
065200     DISPLAY '*************************************************'. 06520001
065500     DISPLAY '** TOTAL AGREEMENT ROWS = ' PV-AGR-CSR-COUNT.       06550001
065600     DISPLAY '** TOTAL ACCTG ENTRY ROWS = ' PV-ACCTG-CSR-COUNT.   06560001
065610     DISPLAY '** TOTAL MERCHANDISE ROWS = ' PV-MDSE-CSR-COUNT.    06561012
065700     DISPLAY '** TOTAL EXTRACT RECORDS = ' PV-EXTRACT-COUNT.      06570001
065800     DISPLAY '*************************************************'. 06580001
065900     DISPLAY '**         END OF APKUT129 PROCESSING          **'. 06590001
066000     DISPLAY '*************************************************'. 06600001
066100                                                                  06610001
071788 EJECT                                                            07178801
071789*----------------------------------------------------------------*07178901
071790*    OPENS THE ACCOUNTING ENTRY CURSOR AND PROCESSES UNTIL END,   07179011
071791*    ACCUMULATING THE AMOUNTS INTO THE CORRESPONDING WORK FIELD   07179101
071792*    BASED ON THE TRANCODE.  THESE WORK FIELDS ARE MOVED TO THE   07179201
071793*    OUTPUT RECORD IN THE AGREEMENTS PROCESSING AREA ACCORDING    07179301
071794*    TO WHICH AGREEMENT IS BEING WRITTEN.                         07179401
071795*----------------------------------------------------------------*07179501
071796 C100-GET-ACCOUNTING-ENTRIES.                                     07179611
071797                                                                  07179701
071802     SET NOT-END-OF-ACCTG-CSR TO TRUE.                            07180211
071804                                                                  07180401
071805     PERFORM X300-OPEN-ACCTG-ENTRY-CSR.                           07180505
071806     PERFORM S200-FETCH-ACCTG-ENTRY-CSR.                          07180601
071807                                                                  07180701
071808     PERFORM UNTIL END-OF-ACCTG-CSR                               07180801
071821         EVALUATE TRUE                                            07182102
071822            WHEN ADJRNL-AP-TRN-CDE = '56'                         07182216
071823               ADD ADJRNL-NET-COST-AMT TO PV-BO-VND-DED-AMT       07182322
071824            WHEN ADJRNL-AP-TRN-CDE = '57'                         07182422
071825               ADD ADJRNL-NET-COST-AMT TO PV-BO-VND-DED-AMT       07182522
071831            WHEN ADJRNL-AP-TRN-CDE = '88'                         07183101
071832               ADD ADJRNL-NET-COST-AMT TO PV-BO-EARNED-AMT        07183201
071833            WHEN ADJRNL-AP-TRN-CDE = '89'                         07183301
071834               ADD ADJRNL-NET-COST-AMT TO PV-BR-EARNED-AMT        07183401
071837            WHEN ADJRNL-AP-TRN-CDE = '91'                         07183716
071838               ADD ADJRNL-NET-COST-AMT TO PV-BO-VND-DED-AMT       07183816
071839            WHEN ADJRNL-AP-TRN-CDE = '92'                         07183916
071840               ADD ADJRNL-NET-COST-AMT TO PV-BO-REVERSED-AMT      07184016
071841            WHEN ADJRNL-AP-TRN-CDE = '93'                         07184116
071842               ADD ADJRNL-NET-COST-AMT TO PV-BR-REVERSED-AMT      07184216
071843            WHEN ADJRNL-AP-TRN-CDE = '94'                         07184316
071844               ADD ADJRNL-NET-COST-AMT TO PV-BR-EXP-CR-AMT        07184416
071845            WHEN ADJRNL-AP-TRN-CDE = '95'                         07184516
071846               ADD ADJRNL-NET-COST-AMT TO PV-BR-VND-REPAY-AMT     07184616
071847               ADD ADJRNL-NET-COST-AMT TO PV-BR-EXP-CR-AMT        07184716
071848            WHEN ADJRNL-AP-TRN-CDE = '96'                         07184816
071849               ADD ADJRNL-NET-COST-AMT TO PV-BR-VND-DED-AMT       07184916
071850            WHEN ADJRNL-AP-TRN-CDE = '97'                         07185016
071851               ADD ADJRNL-NET-COST-AMT TO PV-BR-VND-DED-AMT       07185116
071852               ADD ADJRNL-NET-COST-AMT TO PV-BR-EXP-CR-AMT        07185216
071853            END-EVALUATE                                          07185316
071854         PERFORM S200-FETCH-ACCTG-ENTRY-CSR                       07185416
071855     END-PERFORM.                                                 07185516
071856                                                                  07185616
071859     PERFORM X400-CLOSE-ACCTG-ENTRY-CSR.                          07185905
071860     INITIALIZE DCLTADJRNL.                                       07186011
071861                                                                  07186111
071862 EJECT                                                            07186211
071863*----------------------------------------------------------------*07186311
071864*    OPENS THE MERCHANDISE CURSOR AND PROCESSES UNTIL END,        07186411
071865*    ACCUMULATING THE AMOUNTS INTO THE CORRESPONDING WORK FIELD   07186511
071866*    BASED ON THE TRANCODE.  THESE WORK FIELDS ARE MOVED TO THE   07186611
071867*    OUTPUT RECORD IN THE AGREEMENTS PROCESSING AREA ACCORDING    07186711
071868*    TO WHICH AGREEMENT IS BEING WRITTEN.                         07186811
071869*----------------------------------------------------------------*07186911
071870 C200-GET-MERCHANDISE-ENTRIES.                                    07187011
071871                                                                  07187111
071872     SET NOT-END-OF-MDSE-CSR TO TRUE.                             07187211
071873                                                                  07187311
071874     PERFORM X500-OPEN-MERCHANDISE-CSR.                           07187411
071875     PERFORM S300-FETCH-MERCHANDISE-CSR.                          07187511
071876                                                                  07187611
071877     PERFORM UNTIL END-OF-MDSE-CSR                                07187711
071878         EVALUATE TRUE                                            07187811
071879            WHEN ADJRNL-AP-TRN-CDE = '5A'                         07187927
071880               ADD ADJRNL-NET-COST-AMT TO PV-MDS-BUYER-CR-AMT     07188011
071881                                          PV-MDS-VND-DED-AMT      07188134
071882            WHEN ADJRNL-AP-TRN-CDE = '50'                         07188227
071883               ADD ADJRNL-NET-COST-AMT TO PV-MDS-BUYER-CR-AMT     07188327
071884            WHEN ADJRNL-AP-TRN-CDE = '51'                         07188427
071885               ADD ADJRNL-NET-COST-AMT TO PV-MDS-BUYER-CR-AMT     07188527
071886            WHEN ADJRNL-AP-TRN-CDE = '56'                         07188627
071887               ADD ADJRNL-NET-COST-AMT TO PV-MDS-BUYER-CR-AMT     07188727
071888            WHEN ADJRNL-AP-TRN-CDE = '57'                         07188827
071890               ADD ADJRNL-NET-COST-AMT TO PV-MDS-VND-REPAY-AMT    07189011
071891                                          PV-MDS-BUYER-CR-AMT     07189120
071898         END-EVALUATE                                             07189820
071899         PERFORM S300-FETCH-MERCHANDISE-CSR                       07189911
071900     END-PERFORM.                                                 07190011
071901                                                                  07190111
071906     PERFORM X600-CLOSE-MERCHANDISE-CSR.                          07190611
071907     INITIALIZE DCLTADJRNL.                                       07190711
071908 EJECT                                                            07190811
071909*----------------------------------------------------------------*07190911
071910*    VALIDATE THE FIELDS ON THE CONTROL CARD AND SET UP THE       07191011
071911*    VARIABLES TO SELECT THE CONTROL DATES FROM THE AP CONTROL    07191111
071912*    TABLE AND THE DATE ATTRIBUTE TABLE.                          07191211
071913*----------------------------------------------------------------*07191311
071914 D100-VALIDATE-CONTROL-CARD.                                      07191411
071915                                                                  07191511
071916     MOVE 'D100-VALIDATE-CONTROL-CARD' TO AA-PARAGRAPH-NAME.      07191611
071917                                                                  07191711
071918     IF  CC-RPT-TYP-VALID                                         07191811
071919         IF  CC-SPECIAL-REQUEST                                   07191911
071920             IF  CC-RQST-BEGIN-DTE = SPACES                       07192011
071930             OR  CC-RQST-END-DTE = SPACES                         07193011
072000                 SET AC-INVALID-CONTROL-CARD TO TRUE              07200001
072100                 MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1           07210001
072200                 MOVE PC-NO-RQST-DATES-MSG TO AA-MESSAGE-2        07220001
072300                 PERFORM Z998-GENERAL-ABEND                       07230001
072400             ELSE                                                 07240001
072500                 PERFORM S800-GET-REQUESTED-CONTROLS              07250001
072600             END-IF                                               07260001
072700         ELSE                                                     07270001
073800             IF  CC-MOEND-RUN                                     07380006
073900                 IF  CC-VALID-MOEND-RPT                           07390006
074000                     PERFORM S700-GET-MONTH-END-CONTROLS          07400006
074100                 ELSE                                             07410006
074200                     SET AC-INVALID-CONTROL-CARD TO TRUE          07420006
074300                     MOVE PC-MOEND-RPT-MSG TO AA-MESSAGE-1        07430006
074400                     MOVE SPACES            TO AA-MESSAGE-2       07440006
074500                     PERFORM Z998-GENERAL-ABEND                   07450006
074600                 END-IF                                           07460006
074700             ELSE                                                 07470006
074800                 IF  CC-CALENDAR-RUN                              07480006
074900                     IF  CC-VALID-CAL-RPT                         07490006
075000                        PERFORM S900-GET-CALENDAR-CONTROLS        07500006
075100                     ELSE                                         07510006
075200                        SET AC-INVALID-CONTROL-CARD TO TRUE       07520006
075300                        MOVE PC-CAL-RPT-MSG TO AA-MESSAGE-1       07530006
075400                        MOVE SPACES         TO AA-MESSAGE-2       07540006
075500                        PERFORM Z998-GENERAL-ABEND                07550006
075600                     END-IF                                       07560006
075700                 ELSE                                             07570006
075800                     SET AC-INVALID-CONTROL-CARD TO TRUE          07580006
075900                     MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1       07590006
076000                     MOVE SPACES            TO AA-MESSAGE-2       07600006
076100                     DISPLAY 'INVALID RUN FREQUENCY CODE = '      07610006
076200                     CC-RUN-FRQ-CDE                               07620006
076300                     PERFORM Z998-GENERAL-ABEND                   07630006
076400                 END-IF                                           07640006
076500             END-IF                                               07650006
076700         END-IF                                                   07670001
076800     ELSE                                                         07680001
076900         SET AC-INVALID-CONTROL-CARD TO TRUE                      07690001
077000         MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1                   07700001
077100         MOVE SPACES            TO AA-MESSAGE-2                   07710001
077200         DISPLAY 'INVALID REPORT TYPE CODE = ' CC-REPORT-TYP-CDE  07720001
077300         PERFORM Z998-GENERAL-ABEND                               07730001
077400     END-IF.                                                      07740001
077500                                                                  07750001
077600 EJECT                                                            07760001
077700*---------------------------------------------------------------- 07770001
077800*    FETCH FROM THE AGREEMENT_CSR CURSOR.                         07780001
077900*---------------------------------------------------------------- 07790001
078000 S100-FETCH-AGREEMENT-CSR.                                        07800001
078100                                                                  07810001
078200     EXEC SQL                                                     07820001
078300         FETCH  AGREEMENT_CSR                                     07830001
078400          INTO :VNDAGR-ENT-ID                                     07840002
078410             , :EXTENT-DUN-NBR                                    07841002
078420             , :ENTNME-ENT-NAME-DESC                              07842002
078500             , :VNDAGR-DEPT-NBR                                   07850002
078600             , :VNDAGR-AP-TRN-CDE                                 07860002
078700             , :VNDAGR-DISCOUNT-PCT                               07870002
078800             , :VNDAGR-PSTG-FRQ-CDE                               07880002
078900             , :VNDAGR-DED-DISC-IND                               07890002
079000             , :VNDAGR-DED-RTV-IND                                07900002
079100     END-EXEC.                                                    07910001
079200                                                                  07920001
079300     EVALUATE TRUE                                                07930001
079400         WHEN SQLCODE = ZERO                                      07940001
079500             ADD 1 TO PV-AGR-CSR-COUNT                            07950001
079600         WHEN SQLCODE = +100                                      07960001
079700             SET END-OF-AGR-CSR TO TRUE                           07970001
079800                                                                  07980001
079900         WHEN SQLWARN0 NOT = SPACES                               07990001
080000         WHEN SQLCODE  NOT = ZERO                                 08000001
080100             MOVE 'S100-FETCH-AGREEMENT-CSR'                      08010001
080200                                 TO AA-PARAGRAPH-NAME             08020001
080300             MOVE 'UNSUCCESSFUL FETCH FROM AGREEMENT_CSR'         08030001
080400                                 TO AA-DB2-OPERATION              08040001
080500             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                08050001
080600             MOVE 'TVNDDPT'      TO AA-DB2-TABLE-2                08060001
080700             MOVE '       '      TO AA-DB2-TABLE-3                08070001
080800             MOVE '       '      TO AA-DB2-TABLE-4                08080001
080900             MOVE '       '      TO AA-DB2-TABLE-5                08090001
081000             PERFORM Z999-DB2-ABEND                               08100001
081100     END-EVALUATE.                                                08110001
081200                                                                  08120001
084600                                                                  08460001
084700*---------------------------------------------------------------- 08470001
084800*    FETCH FROM THE ACCTG_ENTRY_CSR CURSOR.                       08480001
084900*---------------------------------------------------------------- 08490001
085000 S200-FETCH-ACCTG-ENTRY-CSR.                                      08500001
085100                                                                  08510001
085200     EXEC SQL                                                     08520001
085300         FETCH  ACCTG_ENTRY_CSR                                   08530001
085400          INTO  :ADJRNL-AP-TRN-CDE                                08540001
085500              , :ADJRNL-NET-COST-AMT                              08550001
085600     END-EXEC.                                                    08560001
085700                                                                  08570001
085710     EVALUATE TRUE                                                08571001
085720         WHEN SQLCODE = ZERO                                      08572001
085730             ADD 1 TO PV-ACCTG-CSR-COUNT                          08573001
085750         WHEN SQLCODE = +100                                      08575001
085760             SET END-OF-ACCTG-CSR TO TRUE                         08576001
085770                                                                  08577001
085780         WHEN SQLWARN0 NOT = SPACES                               08578001
085790         WHEN SQLCODE  NOT = ZERO                                 08579001
085800             MOVE 'S200-FETCH-ACCTG-ENTRY-CSR'                    08580001
085801                                 TO AA-PARAGRAPH-NAME             08580101
085802             MOVE 'UNSUCCESSFUL FETCH FROM ACCTG_ENTRY_CSR'       08580201
085803                                 TO AA-DB2-OPERATION              08580301
085804             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                08580401
085805             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                08580501
085806             MOVE '       '      TO AA-DB2-TABLE-2                08580601
085807             MOVE '       '      TO AA-DB2-TABLE-3                08580701
085808             MOVE '       '      TO AA-DB2-TABLE-4                08580801
085809             MOVE '       '      TO AA-DB2-TABLE-5                08580901
085810             PERFORM Z999-DB2-ABEND                               08581001
085811     END-EVALUATE.                                                08581101
085812                                                                  08581201
085813*---------------------------------------------------------------- 08581311
085814*    FETCH FROM THE MERCHANDISE_CSR CURSOR.                       08581411
085815*---------------------------------------------------------------- 08581511
085816 S300-FETCH-MERCHANDISE-CSR.                                      08581611
085817                                                                  08581711
085818     EXEC SQL                                                     08581811
085819         FETCH  MERCHANDISE_CSR                                   08581911
085820          INTO  :ADJRNL-AP-TRN-CDE                                08582011
085830              , :ADJRNL-NET-COST-AMT                              08583011
085840     END-EXEC.                                                    08584011
085850                                                                  08585011
085860     EVALUATE TRUE                                                08586011
085870         WHEN SQLCODE = ZERO                                      08587011
085880             ADD 1 TO PV-MDSE-CSR-COUNT                           08588011
085900         WHEN SQLCODE = +100                                      08590011
086000             SET END-OF-MDSE-CSR TO TRUE                          08600011
086100                                                                  08610011
086200         WHEN SQLWARN0 NOT = SPACES                               08620011
086300         WHEN SQLCODE  NOT = ZERO                                 08630011
086400             MOVE 'S300-FETCH-MERCHANDISE-CSR'                    08640011
086500                                 TO AA-PARAGRAPH-NAME             08650011
086600             MOVE 'UNSUCCESSFUL FETCH FROM MERCHANDISE_CSR'       08660011
086700                                 TO AA-DB2-OPERATION              08670011
086800             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                08680011
086810             DISPLAY 'HOLD DEPT = ' HOLD-DEPT-NBR                 08681011
086900             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                08690011
087000             MOVE '       '      TO AA-DB2-TABLE-2                08700011
087100             MOVE '       '      TO AA-DB2-TABLE-3                08710011
087200             MOVE '       '      TO AA-DB2-TABLE-4                08720011
087300             MOVE '       '      TO AA-DB2-TABLE-5                08730011
087400             PERFORM Z999-DB2-ABEND                               08740011
087500     END-EVALUATE.                                                08750011
087600                                                                  08760011
093700                                                                  09370001
093800*---------------------------------------------------------------- 09380001
093900*    SELECT DMM NUMBER FROM TMDSEAR FOR DEPT BEING PROCESSED.     09390001
094000*---------------------------------------------------------------- 09400001
094100 S400-SELECT-TMDSEAR.                                             09410011
094200                                                                  09420001
094300     EXEC SQL                                                     09430001
094400         SELECT DMA_NBR                                           09440001
094410              , GMA_NBR                                           09441015
094500           INTO :MDSEAR-DMA-NBR                                   09450001
094510              , :MDSEAR-GMA-NBR                                   09451015
094600           FROM TMDSEAR                                           09460001
094700          WHERE MDSELV_CDE = 'DPT'                                09470001
094800            AND DEPT_NBR   = :VNDAGR-DEPT-NBR                     09480001
094900            AND CURRENT DATE BETWEEN STRT_DTE AND END_DTE         09490001
095000     END-EXEC.                                                    09500001
095100                                                                  09510001
095200     EVALUATE TRUE                                                09520001
095300         WHEN SQLCODE = ZERO                                      09530001
095400             CONTINUE                                             09540001
095500         WHEN SQLCODE = +100                                      09550001
095600             MOVE ZERO TO MDSEAR-DMA-NBR                          09560001
095700                          MDSEAR-GMA-NBR                          09570015
095800         WHEN SQLWARN0 NOT = SPACES                               09580001
095900         WHEN SQLCODE  NOT = ZERO                                 09590001
096000             DISPLAY 'VNDAGR-DEPT-NBR = ' VNDAGR-DEPT-NBR         09600001
096100             MOVE 'S400-SELECT-TMDSEAR   '                        09610011
096200                                 TO AA-PARAGRAPH-NAME             09620001
096300             MOVE 'UNSUCCESSFUL SELECT FROM TMDSEAR   '           09630001
096400                                 TO AA-DB2-OPERATION              09640001
096500             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-1                09650001
096600             MOVE '       '      TO AA-DB2-TABLE-2                09660001
096700             MOVE '       '      TO AA-DB2-TABLE-3                09670001
096800             MOVE '       '      TO AA-DB2-TABLE-4                09680001
096900             MOVE '       '      TO AA-DB2-TABLE-5                09690001
097000             PERFORM Z999-DB2-ABEND                               09700001
097100     END-EVALUATE.                                                09710001
097200                                                                  09720001
105800 EJECT                                                            10580001
105900*----------------------------------------------------------------*10590001
106000*    GET DATE INFORMATION FOR THE DRIVING CURSORS USING THE       10600001
106100*    AP CONTROL TABLE AND DATE ATTRIBUTE TABLE FOR MONTH-END      10610001
106200*    EXTRACTS.                                                    10620001
106300*----------------------------------------------------------------*10630001
106400 S700-GET-MONTH-END-CONTROLS.                                     10640001
106500                                                                  10650001
106600     EXEC SQL                                                     10660001
106700         SELECT A.BTCH_PRC_DTE                                    10670001
106800              , A.PREV_WK_END_DTE                                 10680001
106900              , B.FSCL_YR_NBR                                     10690001
107000              , B.FSCL_QTR_NBR                                    10700001
107100              , B.FSCL_MN_NBR                                     10710001
107200              , B.FSCL_MN_END_DTE                                 10720001
107300              , B.FSCL_MN_BEG_DTE                                 10730001
107400              , B.CAL_MN_NBR                                      10740001
107500              , (CASE B.CAL_MN_NBR                                10750001
107600                 WHEN '01' THEN '1'                               10760001
107700                 WHEN '02' THEN '1'                               10770001
107800                 WHEN '03' THEN '1'                               10780001
107900                 WHEN '04' THEN '2'                               10790001
108000                 WHEN '05' THEN '2'                               10800001
108100                 WHEN '06' THEN '2'                               10810001
108200                 WHEN '07' THEN '3'                               10820001
108300                 WHEN '08' THEN '3'                               10830001
108400                 WHEN '09' THEN '3'                               10840001
108500                 WHEN '10' THEN '4'                               10850001
108600                 WHEN '11' THEN '4'                               10860001
108700                 WHEN '12' THEN '4'                               10870001
108710                 END)                                             10871001
108720              , (CASE B.CAL_MN_NBR                                10872001
108730                 WHEN '01' THEN CHAR(INTEGER(B.FSCL_YR_NBR)+ 1)   10873001
108740                 ELSE B.FSCL_YR_NBR                               10874001
108750                 END)                                             10875001
108760           INTO :APCNTL-BTCH-PRC-DTE                              10876001
108770              , :APCNTL-PREV-WK-END-DTE                           10877001
108780              , :DTATTR-FSCL-YR-NBR                               10878001
108790              , :DTATTR-FSCL-QTR-NBR                              10879001
108800              , :DTATTR-FSCL-MN-NBR                               10880001
108900              , :DTATTR-FSCL-MN-END-DTE                           10890001
109000              , :EXTRACT-BEGIN-DTE                                10900001
109100              , :DTATTR-CAL-MN-NBR                                10910001
109200              , :PV-CAL-QTR-NBR                                   10920001
109300              , :PV-CAL-YR-NBR                                    10930001
109410           FROM TAPCNTL  A                                        10941023
109500              , TDTATTR  B                                        10950001
109600          WHERE A.PREV_WK_END_DTE   = B.KY_DTE                    10960001
109700*******     AND A.MULT_PSTG_PER_IND = 'Y'                         10970035
109800     END-EXEC.                                                    10980001
109900                                                                  10990001
110000     EVALUATE TRUE                                                11000001
110100         WHEN SQLCODE = ZERO                                      11010001
110200             MOVE DTATTR-FSCL-MN-END-DTE TO PV-MIN-MOEND-DTE      11020001
110300                                            PV-MAX-MOEND-DTE      11030001
110400                                            PV-FSCL-MN-END-DTE    11040001
110410             MOVE DTATTR-FSCL-MN-NBR     TO PV-MIN-PSTG-FMN-NBR   11041001
110420                                            PV-MAX-PSTG-FMN-NBR   11042001
110430                                            PV-PREVYR-FMN-NBR     11043001
110440                                            PV-FSCL-MN-NBR        11044001
110450             MOVE DTATTR-FSCL-YR-NBR     TO PV-PSTG-FYR-NBR       11045001
110460                                            PV-PREV-PSTG-FYR-NBR  11046001
110470                                            PV-CURR-PSTG-FYR-NBR  11047001
110480                                            PV-FSCL-YR-NBR        11048001
110490             MOVE DTATTR-FSCL-QTR-NBR    TO PV-FSCL-QTR-NBR       11049001
110500             MOVE DTATTR-CAL-MN-NBR      TO PV-CAL-MN-NBR         11050001
110600             MOVE EXTRACT-BEGIN-DTE      TO PV-FSCL-MN-BEG-DTE    11060001
110700                                                                  11070001
110800         WHEN SQLWARN0 NOT = SPACES                               11080001
110900         WHEN SQLCODE  NOT = ZERO                                 11090001
111000             MOVE 'S700-GET-MONTH-END-CONTROLS'                   11100001
111100                                 TO AA-PARAGRAPH-NAME             11110001
111200             MOVE 'UNSUCCESSFUL SELECT '                          11120001
111300                                 TO AA-DB2-OPERATION              11130001
111400             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                11140001
111500             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-2                11150001
111600             MOVE '       '      TO AA-DB2-TABLE-3                11160001
111700             MOVE '       '      TO AA-DB2-TABLE-4                11170001
111800             MOVE '       '      TO AA-DB2-TABLE-5                11180001
111900             PERFORM Z999-DB2-ABEND                               11190001
112000     END-EVALUATE.                                                11200001
112100                                                                  11210001
112200     IF  CC-QUARTERLY                                             11220001
112300         MOVE DTATTR-FSCL-QTR-NBR TO PV-MIN-FSCL-QTR-NBR          11230001
112400                                     PV-MAX-FSCL-QTR-NBR          11240001
112500     ELSE                                                         11250001
112600         IF CC-SEMI-ANNUAL                                        11260001
112700            IF DTATTR-FSCL-QTR-NBR = 1 OR 2                       11270001
112800               MOVE 1 TO PV-MIN-FSCL-QTR-NBR                      11280001
112900               MOVE 2 TO PV-MAX-FSCL-QTR-NBR                      11290001
113000            ELSE                                                  11300001
113100               MOVE 3 TO PV-MIN-FSCL-QTR-NBR                      11310001
113200               MOVE 4 TO PV-MAX-FSCL-QTR-NBR                      11320001
113300            END-IF                                                11330001
113400         ELSE                                                     11340001
113500            MOVE 1 TO PV-MIN-FSCL-QTR-NBR                         11350001
113600            MOVE DTATTR-FSCL-QTR-NBR TO PV-MAX-FSCL-QTR-NBR       11360001
113700         END-IF                                                   11370001
113800     END-IF.                                                      11380001
113900                                                                  11390001
114000     IF  CC-QUARTERLY                                             11400001
114100     OR  CC-SEMI-ANNUAL                                           11410001
114200     OR  CC-YEAR-TO-DATE                                          11420001
114300         EXEC SQL                                                 11430001
114400             SELECT MIN(C.FSCL_MN_NBR)                            11440001
114500                  , MAX(C.FSCL_MN_NBR)                            11450001
114600                  , MIN(C.FSCL_MN_END_DTE)                        11460001
114700                  , MAX(C.FSCL_MN_END_DTE)                        11470001
114800                  , MIN(C.FSCL_MN_BEG_DTE)                        11480001
114900               INTO :PV-MIN-PSTG-FMN-NBR                          11490001
115000                  , :PV-MAX-PSTG-FMN-NBR                          11500001
115100                  , :PV-MIN-MOEND-DTE                             11510001
115200                  , :PV-MAX-MOEND-DTE                             11520001
115300                  , :EXTRACT-BEGIN-DTE                            11530001
115400               FROM TDTATTR  C                                    11540001
115500              WHERE C.FSCL_QTR_NBR    BETWEEN :PV-MIN-FSCL-QTR-NBR11550001
115600                                          AND :PV-MAX-FSCL-QTR-NBR11560001
115700                AND C.FSCL_YR_NBR     = :DTATTR-FSCL-YR-NBR       11570001
115800                AND C.FSCL_MN_END_DTE <= :APCNTL-PREV-WK-END-DTE  11580001
115900         END-EXEC                                                 11590001
116000         EVALUATE TRUE                                            11600001
116100             WHEN SQLCODE = ZERO                                  11610001
116200                  CONTINUE                                        11620001
116300             WHEN SQLWARN0 NOT = SPACES                           11630001
116400             WHEN SQLCODE  NOT = ZERO                             11640001
116500                 MOVE 'S700-GET-MONTH-END-CONTROLS'               11650001
116600                                     TO AA-PARAGRAPH-NAME         11660001
116700                 MOVE 'UNSUCCESSFUL SELECT NUMBER TWO'            11670001
116800                                     TO AA-DB2-OPERATION          11680001
116900                 MOVE 'TDTATTR'      TO AA-DB2-TABLE-1            11690001
117000                 MOVE '       '      TO AA-DB2-TABLE-2            11700001
117100                 MOVE '       '      TO AA-DB2-TABLE-3            11710001
117200                 MOVE '       '      TO AA-DB2-TABLE-4            11720001
117300                 MOVE '       '      TO AA-DB2-TABLE-5            11730001
117400                 PERFORM Z999-DB2-ABEND                           11740001
117500         END-EVALUATE                                             11750001
117600     END-IF.                                                      11760001
117700*----------------------------------------------------------------*11770001
117800*    GET DATE INFORMATION FOR THE DRIVING CURSORS USING THE AP    11780001
117900*    CONTROL TABLE AND DATE ATTRIBUTE TABLE FOR REQUESTED DATES.  11790001
118000*----------------------------------------------------------------*11800001
118100 S800-GET-REQUESTED-CONTROLS.                                     11810001
118200                                                                  11820001
118300** GET CURRENT BATCH PROCESS DATE                                 11830001
118400                                                                  11840001
118500     EXEC SQL                                                     11850001
118600         SELECT A.BTCH_PRC_DTE                                    11860001
118700           INTO :APCNTL-BTCH-PRC-DTE                              11870001
118810           FROM TAPCNTL  A                                        11881023
118900     END-EXEC.                                                    11890001
119000                                                                  11900001
119100     EVALUATE TRUE                                                11910001
119200         WHEN SQLCODE = ZERO                                      11920001
119300              CONTINUE                                            11930001
119400         WHEN SQLWARN0 NOT = SPACES                               11940001
119500         WHEN SQLCODE  NOT = ZERO                                 11950001
119600             MOVE 'S800-GET-REQUESTED-CONTROLS'                   11960017
119700                                 TO AA-PARAGRAPH-NAME             11970001
119800             MOVE 'UNSUCCESSFUL SELECT '                          11980001
119900                                 TO AA-DB2-OPERATION              11990001
120000             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                12000001
120100             MOVE '       '      TO AA-DB2-TABLE-2                12010001
120200             MOVE '       '      TO AA-DB2-TABLE-3                12020001
120300             MOVE '       '      TO AA-DB2-TABLE-4                12030001
120400             MOVE '       '      TO AA-DB2-TABLE-5                12040001
120500             PERFORM Z999-DB2-ABEND                               12050001
120600     END-EVALUATE.                                                12060001
120700                                                                  12070001
120800** VALIDATE REQUESTED BEGIN DATE                                  12080001
120900                                                                  12090001
121000     EXEC SQL                                                     12100001
121100         SELECT FSCL_MN_NBR                                       12110001
121200              , FSCL_YR_NBR                                       12120001
121300              , FSCL_MN_END_DTE                                   12130001
121400           INTO :DTATTR-FSCL-MN-NBR                               12140001
121500              , :DTATTR-FSCL-YR-NBR                               12150001
121600              , :DTATTR-FSCL-MN-END-DTE                           12160001
121700           FROM TDTATTR                                           12170001
121800          WHERE KY_DTE          = :CC-RQST-BEGIN-DTE              12180001
121900            AND FSCL_MN_BEG_DTE = :CC-RQST-BEGIN-DTE              12190001
122000     END-EXEC.                                                    12200001
122100                                                                  12210001
122200     EVALUATE TRUE                                                12220001
122300         WHEN SQLCODE = ZERO                                      12230001
122400              MOVE DTATTR-FSCL-MN-NBR     TO PV-MIN-PSTG-FMN-NBR  12240001
122500                                             PV-PREVYR-FMN-NBR    12250001
122600              MOVE DTATTR-FSCL-YR-NBR     TO PV-PSTG-FYR-NBR      12260001
122700                                             PV-PREV-PSTG-FYR-NBR 12270001
122800              MOVE DTATTR-FSCL-MN-END-DTE TO PV-MIN-MOEND-DTE     12280001
122900              MOVE CC-RQST-BEGIN-DTE      TO EXTRACT-BEGIN-DTE    12290001
123000         WHEN SQLCODE = +100                                      12300001
123100             MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1               12310001
123200             MOVE PC-INVALID-BEGDTE-MSG TO AA-MESSAGE-2           12320001
123300             DISPLAY 'REQUEST BEGIN DATE = ' CC-RQST-BEGIN-DTE    12330001
123400             PERFORM Z998-GENERAL-ABEND                           12340001
123500         WHEN SQLWARN0 NOT = SPACES                               12350001
123600         WHEN SQLCODE  NOT = ZERO                                 12360001
123700             MOVE 'S800-GET-REQUESTED-CONTROLS'                   12370001
123800                                 TO AA-PARAGRAPH-NAME             12380001
123900             MOVE 'UNSUCCESSFUL SELECT '                          12390001
124000                                 TO AA-DB2-OPERATION              12400001
124100             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                12410001
124200             MOVE '       '      TO AA-DB2-TABLE-2                12420001
124300             MOVE '       '      TO AA-DB2-TABLE-3                12430001
124400             MOVE '       '      TO AA-DB2-TABLE-4                12440001
124500             MOVE '       '      TO AA-DB2-TABLE-5                12450001
124600             PERFORM Z999-DB2-ABEND                               12460001
124700     END-EVALUATE.                                                12470001
124800                                                                  12480001
124900** VALIDATE REQUESTED END DATE                                    12490001
125000                                                                  12500001
125100     EXEC SQL                                                     12510001
125200         SELECT FSCL_MN_NBR                                       12520001
125300              , FSCL_YR_NBR                                       12530001
125400              , FSCL_QTR_NBR                                      12540001
125500              , FSCL_MN_BEG_DTE                                   12550001
125600              , FSCL_MN_END_DTE                                   12560001
125700              , CAL_MN_NBR                                        12570001
125800              , (CASE CAL_MN_NBR                                  12580001
125810                 WHEN '01' THEN '1'                               12581001
125820                 WHEN '02' THEN '1'                               12582001
125830                 WHEN '03' THEN '1'                               12583001
125840                 WHEN '04' THEN '2'                               12584001
125850                 WHEN '05' THEN '2'                               12585001
125860                 WHEN '06' THEN '2'                               12586001
125870                 WHEN '07' THEN '3'                               12587001
125880                 WHEN '08' THEN '3'                               12588001
125890                 WHEN '09' THEN '3'                               12589001
125891                 WHEN '10' THEN '4'                               12589101
125892                 WHEN '11' THEN '4'                               12589201
125893                 WHEN '12' THEN '4'                               12589301
125894                 END)                                             12589401
125895              , (CASE CAL_MN_NBR                                  12589501
125896                 WHEN '01' THEN CHAR(INTEGER(FSCL_YR_NBR)+ 1)     12589601
125897                 ELSE FSCL_YR_NBR                                 12589701
125898                 END)                                             12589801
125899           INTO :DTATTR-FSCL-MN-NBR                               12589901
125900              , :DTATTR-FSCL-YR-NBR                               12590001
126000              , :PV-FSCL-QTR-NBR                                  12600001
126100              , :PV-FSCL-MN-BEG-DTE                               12610001
126110              , :DTATTR-FSCL-MN-END-DTE                           12611001
126120              , :PV-CAL-MN-NBR                                    12612001
126130              , :PV-CAL-QTR-NBR                                   12613001
126140              , :PV-CAL-YR-NBR                                    12614001
126150           FROM TDTATTR                                           12615001
126160          WHERE KY_DTE          = :CC-RQST-END-DTE                12616001
126170            AND FSCL_MN_END_DTE = :CC-RQST-END-DTE                12617001
126180     END-EXEC.                                                    12618001
126190                                                                  12619001
126200     EVALUATE TRUE                                                12620001
126300         WHEN SQLCODE = ZERO                                      12630001
126400           MOVE DTATTR-FSCL-MN-NBR     TO PV-MAX-PSTG-FMN-NBR     12640001
126500                                          PV-FSCL-MN-NBR          12650001
126600           MOVE DTATTR-FSCL-YR-NBR     TO PV-END-FSCL-YR-NBR      12660001
126700                                          PV-CURR-PSTG-FYR-NBR    12670001
126800                                          PV-FSCL-YR-NBR          12680001
126900           MOVE DTATTR-FSCL-MN-END-DTE TO PV-MAX-MOEND-DTE        12690001
127000                                          PV-FSCL-MN-END-DTE      12700001
127100           IF PV-END-FSCL-YR-NBR = PV-PSTG-FYR-NBR                12710001
127200              CONTINUE                                            12720001
127300           ELSE                                                   12730001
127400              MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1              12740001
127500              MOVE PC-INVALID-FYR-MSG TO AA-MESSAGE-2             12750001
127600              DISPLAY 'REQUEST BEGIN DATE = ' CC-RQST-BEGIN-DTE   12760001
127700                      'FISCAL YEAR = ' PV-PSTG-FYR-NBR            12770001
127800              DISPLAY 'REQUEST END DATE = ' CC-RQST-END-DTE       12780001
127900                      'FISCAL YEAR = ' PV-END-FSCL-YR-NBR         12790001
128000              PERFORM Z998-GENERAL-ABEND                          12800001
128100           END-IF                                                 12810001
128200         WHEN SQLCODE = +100                                      12820001
128300             MOVE PC-INVALID-CC-MSG TO AA-MESSAGE-1               12830001
128400             MOVE PC-INVALID-ENDDTE-MSG TO AA-MESSAGE-2           12840001
128500             DISPLAY 'REQUEST END DATE = ' CC-RQST-END-DTE        12850001
128600             PERFORM Z998-GENERAL-ABEND                           12860001
128700         WHEN SQLWARN0 NOT = SPACES                               12870001
128800         WHEN SQLCODE  NOT = ZERO                                 12880001
128900             MOVE 'S800-GET-REQUESTED-CONTROLS'                   12890001
129000                                 TO AA-PARAGRAPH-NAME             12900001
129100             MOVE 'UNSUCCESSFUL SECOND SELECT '                   12910001
129200                                 TO AA-DB2-OPERATION              12920001
129300             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                12930001
129310             MOVE '       '      TO AA-DB2-TABLE-2                12931001
129320             MOVE '       '      TO AA-DB2-TABLE-3                12932001
129330             MOVE '       '      TO AA-DB2-TABLE-4                12933001
129340             MOVE '       '      TO AA-DB2-TABLE-5                12934001
129350             PERFORM Z999-DB2-ABEND                               12935001
129360     END-EVALUATE.                                                12936001
129370 EJECT                                                            12937001
129380*----------------------------------------------------------------*12938001
129381*    GET DATE INFORMATION FOR THE DRIVING CURSORS USING THE       12938101
129382*    AP CONTROL TABLE AND DATE ATTRIBUTE TABLE FOR CALENDAR       12938201
129383*    EXTRACTS.                                                    12938301
129384*----------------------------------------------------------------*12938401
129385 S900-GET-CALENDAR-CONTROLS.                                      12938501
129386                                                                  12938601
129387     EXEC SQL                                                     12938701
129388         SELECT A.BTCH_PRC_DTE                                    12938801
129389              , A.PREV_WK_END_DTE                                 12938901
129390              , B.FSCL_YR_NBR                                     12939001
129391              , B.FSCL_QTR_NBR                                    12939101
129392              , B.CAL_MN_NBR                                      12939201
129393              , B.FSCL_MN_NBR                                     12939301
129394              , B.FSCL_MN_END_DTE                                 12939401
129395              , B.FSCL_MN_BEG_DTE                                 12939501
129396              , (CASE B.CAL_MN_NBR                                12939601
129397                 WHEN '01' THEN '1'                               12939701
129398                 WHEN '02' THEN '1'                               12939801
129399                 WHEN '03' THEN '1'                               12939901
129400                 WHEN '04' THEN '2'                               12940001
129401                 WHEN '05' THEN '2'                               12940101
129402                 WHEN '06' THEN '2'                               12940201
129403                 WHEN '07' THEN '3'                               12940301
129404                 WHEN '08' THEN '3'                               12940401
129405                 WHEN '09' THEN '3'                               12940501
129406                 WHEN '10' THEN '4'                               12940601
129407                 WHEN '11' THEN '4'                               12940701
129408                 WHEN '12' THEN '4'                               12940801
129409                 END)                                             12940901
129410              , (CASE B.CAL_MN_NBR                                12941001
129411                 WHEN '01' THEN CHAR(INTEGER(B.FSCL_YR_NBR)+ 1)   12941101
129412                 ELSE B.FSCL_YR_NBR                               12941201
129413                 END)                                             12941301
129414           INTO :APCNTL-BTCH-PRC-DTE                              12941401
129415              , :APCNTL-PREV-WK-END-DTE                           12941501
129416              , :DTATTR-FSCL-YR-NBR                               12941601
129417              , :DTATTR-FSCL-QTR-NBR                              12941701
129418              , :DTATTR-CAL-MN-NBR                                12941801
129419              , :DTATTR-FSCL-MN-NBR                               12941901
129420              , :DTATTR-FSCL-MN-END-DTE                           12942001
129421              , :EXTRACT-BEGIN-DTE                                12942101
129422              , :PV-CAL-QTR-NBR                                   12942201
129423              , :PV-CAL-YR-NBR                                    12942301
129425           FROM TAPCNTL  A                                        12942523
129426              , TDTATTR  B                                        12942617
129427          WHERE A.PREV_WK_END_DTE   = B.KY_DTE                    12942717
129428********    AND A.MULT_PSTG_PER_IND = 'Y'                         12942835
129429     END-EXEC.                                                    12942917
129430                                                                  12943017
129431     EVALUATE TRUE                                                12943117
129432         WHEN SQLCODE = ZERO                                      12943217
129433             MOVE DTATTR-FSCL-MN-END-DTE TO PV-MIN-MOEND-DTE      12943317
129434                                            PV-MAX-MOEND-DTE      12943417
129435                                            PV-FSCL-MN-END-DTE    12943517
129436             MOVE DTATTR-FSCL-MN-NBR     TO PV-MIN-PSTG-FMN-NBR   12943617
129437                                            PV-MAX-PSTG-FMN-NBR   12943717
129438                                            PV-FSCL-MN-NBR        12943817
129439             MOVE DTATTR-FSCL-YR-NBR     TO PV-PSTG-FYR-NBR       12943917
129440                                            PV-FYR-NBR-NUM        12944017
129441                                            PV-FSCL-YR-NBR        12944117
129442             COMPUTE PV-FYR-NBR-NUM      =  PV-FYR-NBR-NUM - 1    12944217
129443             MOVE DTATTR-FSCL-QTR-NBR    TO PV-FSCL-QTR-NBR       12944317
129444             MOVE DTATTR-CAL-MN-NBR      TO PV-CAL-MN-NBR         12944417
129445             MOVE EXTRACT-BEGIN-DTE      TO PV-FSCL-MN-BEG-DTE    12944517
129446                                                                  12944617
129447         WHEN SQLWARN0 NOT = SPACES                               12944717
129448         WHEN SQLCODE  NOT = ZERO                                 12944817
129449             MOVE 'S900-GET-CALENDAR-CONTROLS '                   12944917
129450                                 TO AA-PARAGRAPH-NAME             12945017
129451             MOVE 'UNSUCCESSFUL SELECT '                          12945117
129452                                 TO AA-DB2-OPERATION              12945217
129453             MOVE 'TDTATTR'      TO AA-DB2-TABLE-1                12945317
129454             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-2                12945417
129455             MOVE '       '      TO AA-DB2-TABLE-3                12945517
129456             MOVE '       '      TO AA-DB2-TABLE-4                12945617
129457             MOVE '       '      TO AA-DB2-TABLE-5                12945717
129458             PERFORM Z999-DB2-ABEND                               12945817
129459     END-EVALUATE.                                                12945917
129460                                                                  12946017
129461     IF  CC-QUARTERLY                                             12946117
129462         EVALUATE TRUE                                            12946217
129463         WHEN PV-CAL-QTR-NBR = '1'                                12946317
129464             MOVE '01'                TO PV-MIN-CAL-MN-NBR        12946417
129465             MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR        12946517
129466             MOVE '12'                TO PV-PREVYR-FMN-NBR        12946617
129467             MOVE DTATTR-FSCL-YR-NBR  TO PV-CURR-PSTG-FYR-NBR     12946717
129468             MOVE PV-FYR-NBR-NUM      TO PV-PREV-PSTG-FYR-NBR     12946817
129469         WHEN PV-CAL-QTR-NBR = '2'                                12946917
129470             MOVE '04'                TO PV-MIN-CAL-MN-NBR        12947017
129471             MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR        12947117
129480             MOVE DTATTR-FSCL-MN-NBR  TO PV-PREVYR-FMN-NBR        12948001
129490             MOVE DTATTR-FSCL-YR-NBR  TO PV-PREV-PSTG-FYR-NBR     12949001
129500                                         PV-CURR-PSTG-FYR-NBR     12950001
129501         WHEN PV-CAL-QTR-NBR = '3'                                12950101
129502             MOVE '07'                TO PV-MIN-CAL-MN-NBR        12950201
129503             MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR        12950301
129504             MOVE DTATTR-FSCL-MN-NBR  TO PV-PREVYR-FMN-NBR        12950401
129505             MOVE DTATTR-FSCL-YR-NBR  TO PV-PREV-PSTG-FYR-NBR     12950501
129506                                         PV-CURR-PSTG-FYR-NBR     12950601
129507         WHEN PV-CAL-QTR-NBR = '4'                                12950701
129508             MOVE '10'                TO PV-MIN-CAL-MN-NBR        12950801
129509             MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR        12950901
129510             MOVE DTATTR-FSCL-MN-NBR  TO PV-PREVYR-FMN-NBR        12951001
129511             MOVE DTATTR-FSCL-YR-NBR  TO PV-PREV-PSTG-FYR-NBR     12951101
129512                                         PV-CURR-PSTG-FYR-NBR     12951201
129513         END-EVALUATE                                             12951301
129514     ELSE                                                         12951401
129515         IF CC-SEMI-ANNUAL                                        12951501
129516             EVALUATE TRUE                                        12951601
129517             WHEN PV-CAL-QTR-NBR = '1'                            12951701
129518               OR PV-CAL-QTR-NBR = '2'                            12951801
129519                 MOVE '01'                TO PV-MIN-CAL-MN-NBR    12951901
129520                 MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR    12952001
129521                 MOVE '12'                TO PV-PREVYR-FMN-NBR    12952101
129522                 MOVE DTATTR-FSCL-YR-NBR  TO PV-CURR-PSTG-FYR-NBR 12952201
129523                 MOVE PV-FYR-NBR-NUM      TO PV-PREV-PSTG-FYR-NBR 12952301
129524             WHEN PV-CAL-QTR-NBR = '3'                            12952401
129525               OR PV-CAL-QTR-NBR = '4'                            12952501
129526                 MOVE '07'                TO PV-MIN-CAL-MN-NBR    12952601
129527                 MOVE DTATTR-CAL-MN-NBR   TO PV-MAX-CAL-MN-NBR    12952701
129528                 MOVE DTATTR-FSCL-MN-NBR  TO PV-PREVYR-FMN-NBR    12952801
129529                 MOVE DTATTR-FSCL-YR-NBR  TO PV-PREV-PSTG-FYR-NBR 12952901
129530                                             PV-CURR-PSTG-FYR-NBR 12953001
129531             END-EVALUATE                                         12953101
129532         ELSE                                                     12953201
129533             MOVE '01'                    TO PV-MIN-CAL-MN-NBR    12953301
129534             MOVE DTATTR-CAL-MN-NBR       TO PV-MAX-CAL-MN-NBR    12953401
129535             MOVE '12'                    TO PV-PREVYR-FMN-NBR    12953501
129536             MOVE DTATTR-FSCL-YR-NBR      TO PV-CURR-PSTG-FYR-NBR 12953601
129537             MOVE PV-FYR-NBR-NUM          TO PV-PREV-PSTG-FYR-NBR 12953701
129538         END-IF                                                   12953801
129539     END-IF.                                                      12953901
129540                                                                  12954001
129541     IF  DTATTR-CAL-MN-NBR = '01'                                 12954101
129542         CONTINUE                                                 12954201
129543     ELSE                                                         12954301
129544         EXEC SQL                                                 12954401
129545             SELECT MIN(C.FSCL_MN_NBR)                            12954501
129546                  , MIN(C.FSCL_MN_END_DTE)                        12954601
129547                  , MAX(C.FSCL_MN_END_DTE)                        12954701
129548                  , MIN(C.FSCL_MN_BEG_DTE)                        12954801
129549               INTO :PV-MIN-PSTG-FMN-NBR                          12954901
129550                  , :PV-MIN-MOEND-DTE                             12955001
129551                  , :PV-MAX-MOEND-DTE                             12955101
129552                  , :EXTRACT-BEGIN-DTE                            12955201
129553               FROM TDTATTR  C                                    12955301
129554              WHERE C.CAL_MN_NBR      BETWEEN :PV-MIN-CAL-MN-NBR  12955401
129555                                          AND :PV-MAX-CAL-MN-NBR  12955501
129556                AND CHAR(YEAR(KY_DTE)) = :DTATTR-FSCL-YR-NBR      12955601
129557                AND C.FSCL_MN_END_DTE <= :APCNTL-PREV-WK-END-DTE  12955701
129558         END-EXEC                                                 12955801
129559         EVALUATE TRUE                                            12955901
129560             WHEN SQLCODE = ZERO                                  12956001
129561                  CONTINUE                                        12956101
129562             WHEN SQLWARN0 NOT = SPACES                           12956201
129563             WHEN SQLCODE  NOT = ZERO                             12956301
129564                 MOVE 'S900-GET-CALENDAR-CONTROLS '               12956401
129565                                     TO AA-PARAGRAPH-NAME         12956501
129566                 MOVE 'UNSUCCESSFUL SELECT NUMBER TWO'            12956601
129567                                     TO AA-DB2-OPERATION          12956701
129568                 MOVE 'TDTATTR'      TO AA-DB2-TABLE-1            12956801
129569                 MOVE '       '      TO AA-DB2-TABLE-2            12956901
129570                 MOVE '       '      TO AA-DB2-TABLE-3            12957001
129571                 MOVE '       '      TO AA-DB2-TABLE-4            12957101
129572                 MOVE '       '      TO AA-DB2-TABLE-5            12957201
129573                 PERFORM Z999-DB2-ABEND                           12957301
129574         END-EVALUATE                                             12957401
129575     END-IF.                                                      12957501
129576                                                                  12957601
129577                                                                  12957701
129578*----------------------------------------------------------------*12957801
129579*    WRITES RECORDS TO THE EXTRACT FILE.                         *12957901
129580*----------------------------------------------------------------*12958001
129590 W100-WRITE-EXTRACT-RECORD.                                       12959001
129600                                                                  12960001
129700     WRITE EXTRACT-RECORD FROM AP081-VNDAGR-EXTRACT.              12970001
129800     ADD 1 TO PV-EXTRACT-COUNT.                                   12980001
129900                                                                  12990001
130000                                                                  13000001
141900                                                                  14190001
142000*---------------------------------------------------------------- 14200001
142100*    OPEN AGREEMENT_CSR CURSOR                                    14210001
142200*---------------------------------------------------------------- 14220001
142300 X100-OPEN-AGREEMENT-CSR.                                         14230001
142400                                                                  14240001
142500     EXEC SQL                                                     14250001
142600         OPEN AGREEMENT_CSR                                       14260001
142700     END-EXEC.                                                    14270001
142800                                                                  14280001
142900     EVALUATE TRUE                                                14290001
143000         WHEN SQLCODE = ZERO                                      14300001
143100             CONTINUE                                             14310001
143200         WHEN SQLWARN0 NOT = SPACES                               14320001
143300         WHEN SQLCODE  NOT = ZERO                                 14330001
143400             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                14340001
143500                     ' HOLD DEPT = '  HOLD-DEPT-NBR               14350001
143600             MOVE 'X100-OPEN-AGREEMENT-CSR'                       14360001
143700                                 TO AA-PARAGRAPH-NAME             14370001
143800             MOVE 'UNSUCCESSFUL OPEN ON AGREEMENT_CSR'            14380001
143900                                 TO AA-DB2-OPERATION              14390001
144000             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                14400001
144100             MOVE '       '      TO AA-DB2-TABLE-2                14410001
144200             MOVE '       '      TO AA-DB2-TABLE-3                14420001
144300             MOVE '       '      TO AA-DB2-TABLE-4                14430001
144400             MOVE '       '      TO AA-DB2-TABLE-5                14440001
144500             PERFORM Z999-DB2-ABEND                               14450001
144600     END-EVALUATE.                                                14460001
144700                                                                  14470001
144800                                                                  14480001
144900*---------------------------------------------------------------- 14490001
145000*    CLOSE THE AGREEMENT_CSR CURSOR                               14500001
145100*---------------------------------------------------------------- 14510001
145200 X200-CLOSE-AGREEMENT-CSR.                                        14520005
145300                                                                  14530001
145400     EXEC SQL                                                     14540001
145500         CLOSE AGREEMENT_CSR                                      14550001
145600     END-EXEC.                                                    14560001
145700                                                                  14570001
145800     EVALUATE TRUE                                                14580001
145900         WHEN SQLCODE = ZERO                                      14590001
146000             CONTINUE                                             14600001
146100                                                                  14610001
146200         WHEN SQLWARN0 NOT = SPACES                               14620001
146300         WHEN SQLCODE  NOT = ZERO                                 14630001
146400             MOVE 'X200-CLOSE-AGREEMENT-CSR'                      14640005
146500                                 TO AA-PARAGRAPH-NAME             14650001
146600             MOVE 'UNSUCCESSFUL CLOSE ON AGREEMENT_CSR'           14660001
146700                                 TO AA-DB2-OPERATION              14670001
146800             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                14680001
146900             MOVE '       '      TO AA-DB2-TABLE-2                14690001
147000             MOVE '       '      TO AA-DB2-TABLE-3                14700001
147100             MOVE '       '      TO AA-DB2-TABLE-4                14710001
147200             MOVE '       '      TO AA-DB2-TABLE-5                14720001
147300             PERFORM Z999-DB2-ABEND                               14730001
147400       END-EVALUATE.                                              14740001
147500                                                                  14750001
147600*---------------------------------------------------------------- 14760001
147700*    OPEN ACCTG_ENTRY_CSR CURSOR                                  14770001
147710*---------------------------------------------------------------- 14771001
147720 X300-OPEN-ACCTG-ENTRY-CSR.                                       14772005
147730                                                                  14773001
147740     EXEC SQL                                                     14774001
147750         OPEN ACCTG_ENTRY_CSR                                     14775001
147760     END-EXEC.                                                    14776001
147770                                                                  14777001
147780     EVALUATE TRUE                                                14778001
147790         WHEN SQLCODE = ZERO                                      14779001
147791             CONTINUE                                             14779101
147792         WHEN SQLWARN0 NOT = SPACES                               14779201
147793         WHEN SQLCODE  NOT = ZERO                                 14779301
147794             MOVE 'X300-OPEN-ACCTG-ENTRY-CSR'                     14779401
147795                                 TO AA-PARAGRAPH-NAME             14779501
147796             MOVE 'UNSUCCESSFUL OPEN ON ACCTG_ENTRY_CSR'          14779601
147797                                 TO AA-DB2-OPERATION              14779701
147798             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                14779801
147799                     ' HOLD DEPT = '  HOLD-DEPT-NBR               14779901
147800             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                14780001
147801             MOVE '       '      TO AA-DB2-TABLE-2                14780101
147802             MOVE '       '      TO AA-DB2-TABLE-3                14780201
147803             MOVE '       '      TO AA-DB2-TABLE-4                14780301
147804             MOVE '       '      TO AA-DB2-TABLE-5                14780401
147805             PERFORM Z999-DB2-ABEND                               14780501
147806     END-EVALUATE.                                                14780601
147807                                                                  14780701
147808                                                                  14780801
147809*---------------------------------------------------------------- 14780901
147810*    CLOSE THE ACCTG_ENTRY_CSR CURSOR                             14781001
147811*---------------------------------------------------------------- 14781101
147812 X400-CLOSE-ACCTG-ENTRY-CSR.                                      14781205
147813                                                                  14781301
147814     EXEC SQL                                                     14781401
147815         CLOSE ACCTG_ENTRY_CSR                                    14781501
147816     END-EXEC.                                                    14781601
147817                                                                  14781701
147818     EVALUATE TRUE                                                14781801
147819         WHEN SQLCODE = ZERO                                      14781901
147820             CONTINUE                                             14782001
147821                                                                  14782101
147822         WHEN SQLWARN0 NOT = SPACES                               14782201
147823         WHEN SQLCODE  NOT = ZERO                                 14782301
147824             MOVE 'X400-CLOSE-ACCTG-ENTRY-CSR'                    14782401
147825                                 TO AA-PARAGRAPH-NAME             14782501
147826             MOVE 'UNSUCCESSFUL CLOSE ON ACCTG_ENTRY_CSR'         14782601
147827                                 TO AA-DB2-OPERATION              14782701
147828             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                14782801
147829             MOVE '       '      TO AA-DB2-TABLE-2                14782901
147830             MOVE '       '      TO AA-DB2-TABLE-3                14783001
147831             MOVE '       '      TO AA-DB2-TABLE-4                14783101
147832             MOVE '       '      TO AA-DB2-TABLE-5                14783201
147833             PERFORM Z999-DB2-ABEND                               14783301
147834       END-EVALUATE.                                              14783401
147835                                                                  14783501
147836*---------------------------------------------------------------- 14783611
147837*    OPEN MERCHANDISE_CSR CURSOR                                  14783711
147838*---------------------------------------------------------------- 14783811
147839 X500-OPEN-MERCHANDISE-CSR.                                       14783911
147840                                                                  14784011
147841     EXEC SQL                                                     14784111
147842         OPEN MERCHANDISE_CSR                                     14784211
147843     END-EXEC.                                                    14784311
147844                                                                  14784411
147845     EVALUATE TRUE                                                14784511
147846         WHEN SQLCODE = ZERO                                      14784611
147847             CONTINUE                                             14784711
147848         WHEN SQLWARN0 NOT = SPACES                               14784811
147849         WHEN SQLCODE  NOT = ZERO                                 14784911
147850             MOVE 'X500-OPEN-MERCHANDISE-CSR'                     14785011
147851                                 TO AA-PARAGRAPH-NAME             14785111
147852             MOVE 'UNSUCCESSFUL OPEN ON MERCHANDISE_CSR'          14785211
147853                                 TO AA-DB2-OPERATION              14785311
147854             DISPLAY 'HOLD VENDOR = ' HOLD-VND-NBR                14785411
147855                     ' HOLD DEPT = '  HOLD-DEPT-NBR               14785511
147856             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                14785611
147857             MOVE '       '      TO AA-DB2-TABLE-2                14785711
147858             MOVE '       '      TO AA-DB2-TABLE-3                14785811
147859             MOVE '       '      TO AA-DB2-TABLE-4                14785911
147860             MOVE '       '      TO AA-DB2-TABLE-5                14786011
147861             PERFORM Z999-DB2-ABEND                               14786111
147862     END-EVALUATE.                                                14786211
147863                                                                  14786311
147864                                                                  14786411
147865*---------------------------------------------------------------- 14786511
147866*    CLOSE THE MERCHANDISE_CSR CURSOR                             14786611
147867*---------------------------------------------------------------- 14786711
147868 X600-CLOSE-MERCHANDISE-CSR.                                      14786811
147869                                                                  14786911
147870     EXEC SQL                                                     14787011
147871         CLOSE MERCHANDISE_CSR                                    14787111
147872     END-EXEC.                                                    14787211
147873                                                                  14787311
147874     EVALUATE TRUE                                                14787411
147875         WHEN SQLCODE = ZERO                                      14787511
147876             CONTINUE                                             14787611
147877                                                                  14787711
147878         WHEN SQLWARN0 NOT = SPACES                               14787811
147879         WHEN SQLCODE  NOT = ZERO                                 14787911
147880             MOVE 'X600-CLOSE-MERCHANDISE-CSR'                    14788011
147881                                 TO AA-PARAGRAPH-NAME             14788111
147882             MOVE 'UNSUCCESSFUL CLOSE ON MERCHANDISE_CSR'         14788211
147883                                 TO AA-DB2-OPERATION              14788311
147884             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                14788411
147885             MOVE '       '      TO AA-DB2-TABLE-2                14788511
147886             MOVE '       '      TO AA-DB2-TABLE-3                14788611
147887             MOVE '       '      TO AA-DB2-TABLE-4                14788711
147888             MOVE '       '      TO AA-DB2-TABLE-5                14788811
147889             PERFORM Z999-DB2-ABEND                               14788911
147890       END-EVALUATE.                                              14789011
147891                                                                  14789111
147892 Z998-GENERAL-ABEND.                                              14789211
147893*----------------------------------------------------------------*14789311
147894*    ABEND ROUTINE                                               *14789411
147895*----------------------------------------------------------------*14789511
147896                                                                  14789611
147897     CLOSE EXTRACT-FILE.                                          14789711
147898                                                                  14789811
147899     DISPLAY AA-ABEND-LIT.                                        14789911
147900     DISPLAY AA-PROGRAM-LIT.                                      14790011
147901     DISPLAY AA-PARAGRAPH-LIT.                                    14790111
147910     DISPLAY AA-MESSAGE-LINE-1.                                   14791011
148000     DISPLAY AA-MESSAGE-LINE-2.                                   14800001
148100     CALL 'ILBOABN0' USING ABEND-CODE.                            14810001
148200                                                                  14820001
148300*----------------------------------------------------------------*14830001
148400*    DB2 ABEND ROUTINE                                           *14840001
148500*----------------------------------------------------------------*14850001
148600 Z999-DB2-ABEND.                                                  14860001
148700                                                                  14870001
148800     CLOSE EXTRACT-FILE.                                          14880001
148900                                                                  14890001
149000     DISPLAY AA-ABEND-LIT.                                        14900001
149100     DISPLAY AA-MESSAGE-LINE-1.                                   14910001
149200     DISPLAY AA-MESSAGE-LINE-2.                                   14920001
149300     DISPLAY AA-DB2-ERROR-LIT.                                    14930001
149400     DISPLAY AA-PROGRAM-LIT.                                      14940001
149500     DISPLAY AA-PARAGRAPH-LIT.                                    14950001
149600     DISPLAY AA-DB2-OPERATION-LIT.                                14960001
149700     DISPLAY AA-DB2-TABLE-1.                                      14970001
149800     DISPLAY AA-DB2-TABLE-2.                                      14980001
149900     DISPLAY AA-DB2-TABLE-3.                                      14990001
150000     DISPLAY AA-DB2-TABLE-4.                                      15000001
150100     DISPLAY AA-DB2-TABLE-5.                                      15010001
150200*    DISPLAY AA-DB2-TABLE-6.                                      15020001
150300     SET AC-DB2-ERROR TO TRUE.                                    15030001
150400                                                                  15040001
150500     COPY DPPD004.                                                15050001
150600                                                                  15060001
150700     CALL 'ILBOABN0' USING ABEND-CODE.                            15070001
