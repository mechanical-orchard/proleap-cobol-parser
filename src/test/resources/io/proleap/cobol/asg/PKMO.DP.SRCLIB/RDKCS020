000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RDKCS020.                                         00020000
000300 AUTHOR.        TODD MICHALEK.                                    00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  MARCH 1996.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800******************************************************************00080000
000900*    U020 - KOHL'S MERCHANDISE CARD REQUEST                      *00090000
001000*                                                                *00100000
001100*    THIS PROGRAM WILL BE USED BY LOSS PREVENTION TO REQUEST     *00110000
001200*    KOHL'S MERCHANDISE CARD CREATION, BOTH GIFT AND MERCHANDISE *00120000
001300*    RETURN CARDS.                                               *00130000
001400*                                                                *00140000
001500*    ON INITIAL ENTRY THE PROGRAM RETRIEVES THE NEXT CONTROL     *00150000
001600*    NUMBER AVAILABLE FOR CREATION FROM THE KOHL'S MERCHANDISE   *00160000
001700*    CARD CONTROL TABLE (SVT_CRD_PROD) AND DISPLAYS IT IN THE    *00170000
001800*    'FROM' CONTROL NUMBER FIELD.                                *00180000
001900*    ON ENTRY OR ADD, EDITS ARE PERFORMED.  IF AN ERROR IS       *00190000
002000*    FOUND A MESSAGE IS DISPLAYED.  IF NO ERRORS ARE             *00200000
002100*    FOUND, THE PROGRAM RETURNS THE CALCULATED 'TO' CONTROL      *00210000
002200*    NUMBER FEILD ('FROM' CONTROL NUMBER + NUMBER OF CARDS       *00220000
002300*    REQUESTED).  WHEN ADD IS REQUESTED AND THE EDITS ARE        *00230000
002400*    SUCCESSFULLY PASSED, A CONFIRM MESSAGE IS DISPLAYED.        *00240000
002500*    ON CONFIRMATION THE SVT_CRD_PROD TABLE IS ACCESSED ONCE     *00250000
002600*    AGAIN TO OBTAIN THE NEXT AVAILABLE CONTROL NUMBER, IF THIS  *00260000
002700*    CONTROL NUMBER = REQUESTED CONTROL NUMBER THEN WE KNOW THAT *00270000
002800*    IT'S OKAY TO INSERT A ROW INTO THE REQUEST TABLE.  (THIS    *00280000
002900*    LOGIC WILL ENSURE THAT 2 PEOPLE DO NOT REQUEST THE SAME     *00290000
003000*    RANGE OF CARDS AT THE SAME TIME.)  ONCE A SUCCESSFUL        *00300000
003100*    REQUEST IS INSERTED INTO THE CONTROL TABLE (SVT_CRD_PROD),  *00310000
003200*    THE SCREEN WILL BE REFRESHED WITH THE NEXT AVAILABLE CONTROL*00320000
003300*    NUMBER.                                                     *00330000
003400******************************************************************00340000
003500*  08/20/96 - LIH  - RANDOM CARD GENERATION                      *00350000
003600*     REMOVED LOGIC THAT INSERTED CARD NUMBERS INTO THE TKMCTBL. *00360000
003700*     CHANGED PROGRAM TO INSERT A REQUEST INTO THE NEW KOHL'S    *00370000
003800*     MERCHANDISE CARD REQUEST TABLE (TKMCREQ). SEE ADDITIONAL   *00380000
003900*     DESCRIPTION ABOVE.                                         *00390000
004000******************************************************************00400000
004100*  06/24/97 - AJR  - WR 5220 GIFT CARD                           *00410000
004200*   - INCREASED CONTROL NUMBER TO 12 DIGITS.                     *00420000
004300*   - CHANGED CARD TYPE TO BE ENTERABLE.  VALIDATED TO EITHER BE *00430000
004400*     KMRC OR GIFT CARD TYPES.                                   *00440000
004500*   - ADDED AN ENTERABLE PRE-DENOMINATED AMT FOR GIFT CARDS ONLY.*00450000
004600*   - ADDED AN ENTERABLE CARD STOCK TYPE AND DESCRIPTION. IF     *00460000
004700*     NOTHING ENTERED IN THE FIELDS,THEY WILL DEFAULT TO EITHER  *00470000
004800*     KMRC OR GIFT CARD, DEPENDING ON THE CARD TYPE ENTERED.     *00480000
004900*   - CONTROL NUMBERS WILL NOT BE UNIQUE BY CARD TYPE, SO WHEN   *00490000
005000*     REQUESTED, THE SHIPMENT REQUEST NUMBER WILL BE INCREMENTED *00500000
005100*     BY ONE FOR EITHER CARD TYPE REQUESTED.                     *00510000
005200*     TABLE CHANGES WERE MADE TO TKCCNTL:                        *00520000
005300*        - INCREASE THE SHIPT-REQ-NBR FROM 2 TO 4 DIGITS         *00530000
005400*        - INCLUDE A PRE-DENOMINATED AMOUNT FIELD                *00540000
005500*        - INCLUDE A CARD TYPE FIELD                             *00550000
005600*        - INCLUDE A STOCK TYPE ID AND DESCRIPTION               *00560000
005700******************************************************************00570000
005800*  09/19/01 - ARCHIVE PROJECT - GREG SHEFF                       *00580000
005900*   ALSO CHECK HISTORY TABLE TKMCHTB TO DETERMINE THE NEXT       *00590000
006000*   AVAILABLE CONTROL NUMBER                                     *00600000
006100******************************************************************00610000
006200*  10/18/01 - BARB ERTL                                          *00620000
006300*   CHECK TKCCNTL END_CNTL_NBR TO DETERMINE THE NEXT AVAILABLE   *00630000
006400*   CONTROL NUMBER INSTEAD OF LOOKING AT TKMCTBL AND TKMCHTB.    *00640000
006500******************************************************************00650000
006600*  03/31/02 - BARB ERTL                             WR22603      *00660000
006700*   MULTI-CHANNEL GIFT CARD PROJECT.                             *00670000
006800*   USE NEW STORED VALUE TABLES.                                 *00680000
006900******************************************************************00690000
P5211 *  05/31/13 - COGNIZANT                     PROJECT ID 5211      *00692000
P5211 *   MODIFIED CODE TO ADD A NEW PRINTER 'V - VIRTUAL CORP' FOR    *00693000
P5211 *   NEW B2B VIRTUAL GIFT CARD. ADDED LOGIC TO ALLOW CICS TO      *00694000
P5211 *   ATTACH B2B VIRTUAL GIFT CARD WITH NEW PRINTER 'V - VIRTUAL   *00694100
P5211 *   CORP' ONLY ELSE THROW ERROR MESSAGE.                         *00694200
006900******************************************************************00695000
P5266 *  07/29/13 - COGNIZANT                     PROJECT ID 5266      *00697000
P5266 *   NEW VENDOR ADDED BY REPLACING THE EXISTING VENDOR            *00698000
P5266 *   I.E, REPLACED 'AB TEUTEBERG' TO 'HARVARD'                    *00699000
P5266 ******************************************************************00699400
JPGFX1* 12/09/2014 JOE GARDETTO                                         00699500
JPGFX1*    -ADDED LOGIC TO THE PROGRAM TO LIMIT REQUESTS FOR CARDS      00699600
JPGFX1*     PRODUCED AT KOHLS TO 495000.           CHG0100360           00699700
JPGFX1******************************************************************00699900
8661H * 12/08/2015 MONICA MAHADIK                                       00700000
8661H *    -MODIFIED THE PROGRAM AND COPYBOOKS(RDKCS020,SVWS004) TO     00700100
8661H *     REPLACE PCS WITH BLACKHAWK AND IPS WITH INCOMM ON GIFT CARD 00700200
8661H *     PRINTER SCREEN.                        CHG0132098           00700300
8661H ******************************************************************00700400
WR7057* 10/04/2017 BARB SCHULTZ                                         00700500
WR7057*    -MODIFIED THE PROGRAM AND COPYBOOK (RDKCS020,SVWS004) TO     00700600
WR7057*     ADD VALID SINCE SAFEWAY IS NO LONGER IN THIS PROGRAM AND    00700700
WR7057*     REPLACE CPI WITH ABCORP ON THE GIFTCARD PRINTER SCREEN.     00700800
WR7057*     WR1834727057                           CHG0180846           00701000
WR7057******************************************************************00701100
090821* 09/08/2021 DAN PAYNTER                     CHG0260917           00701200
090821*    -MODIFIED THE PROGRAM TO INSERT A ROW INTO SVT_LAST_ISUD_VGC 00701300
090821*     FOR NEW VIRTUAL KMC CARDS (KMCVIR IN CRD_STK_TYP_ID ON      00701400
090821*     SVT_CRD_PROD TABLE.                                         00701500
090821******************************************************************00701700
092122* 09/14/2022 DAN PAYNTER                                          00701800
092122*    -MODIFIED THE PROGRAM AND COPYBOOK (RDKCS020,SVWS004) TO     00701900
092122*     ADD OPTIMUM AS A VALID ENDPOINT ON THE GIFTCARD PRINTER     00702000
092122*     SCREEN.                                                     00702100
092122*                                            CHG0274717           00702200
092122******************************************************************00702300
CICS  * CHANGED 11/01/2022    BY JIM HUNTER      WR: CHG0277565         00703000
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00703100
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00703200
CICS  ******************************************************************00703300
111023* CHANGED 11/10/2023    BY DAN PAYNTER                            00703404
111023*    -REPLACE HARVARD STORED VALUE CARD PRINT VENDOR WITH         00703503
111023*     PLI CARD INC STORED VALUE CARD PRINT VENDOR                 00703603
111023*                                            CHG0297091           00703803
111023******************************************************************00703903
007000 ENVIRONMENT DIVISION.                                            00704000
007100 DATA DIVISION.                                                   00710000
007200 WORKING-STORAGE SECTION.                                         00720000
007300                                                                  00730000
007400 01  DK-DB2-KEYS.                                                 00740000
007500     05  DK-CRD-TYP-CDE          PIC S9(1)V COMP-3                00750000
007600                                             VALUE ZERO.          00760000
007700     05  DK-CRD-STK-TYP-ID       PIC  X(08)  VALUE SPACE.         00770000
007800     05  DK-PRE-DNNTD-CRD-AMT    PIC S9(07)V99  COMP-3            00780000
007900                                             VALUE ZERO.          00790000
008000 01  PC-PROGRAM-CONSTANTS.                                        00800000
008100     05  PC-CURRENT-PROGRAM-NAME PIC  X(08)  VALUE 'RDKCS020'.    00810000
008200     05  PC-CURRENT-MAP-NAME     PIC  X(08)  VALUE 'RD020A  '.    00820000
008300     05  PC-CURRENT-MAPSET-NAME  PIC  X(08)  VALUE 'RDKM020 '.    00830000
008400     05  PC-INQ                  PIC  X(01)  VALUE 'I'.           00840000
008500     05  PC-PDR-KOHLS            PIC  X(01)  VALUE 'K'.           00850000
008600     05  PC-PDR-VNDR             PIC  X(01)  VALUE 'V'.           00860000
008700     05  PC-APPL-MAP             PIC  S9(04) COMP VALUE +1.       00870000
008800     05  PC-MAX-RETRIES          PIC  S9(04) COMP VALUE +3.       00880000
008900     05  PC-TSYMSG-NUMBERS.                                       00890000
009000         10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.       00900000
009100         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00910000
009200         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00920000
009300         10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.       00930000
009400         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00940000
009500         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00950000
009600         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00960000
009700         10  PC-TSYMSG-00482      PIC  9(05)  VALUE  00482.       00970000
009800         10  PC-TSYMSG-00999      PIC  9(05)  VALUE  00999.       00980000
009900         10  PC-TSYMSG-01356      PIC  9(05)  VALUE  01356.       00990000
010000         10  PC-TSYMSG-03268      PIC  9(05)  VALUE  03268.       01000000
010000         10  PC-TSYMSG-03759      PIC  9(05)  VALUE  03759.       01001000
010100                                                                  01010000
010200 01  PS-PROGRAM-SWITCHES.                                         01020000
010300     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01030000
010400         88  PS-ERROR                         VALUE  'Y'.         01040000
010500         88  PS-NO-ERROR                      VALUE  'N'.         01050000
010600     05  PS-LIST-END-SW           PIC  X(01)  VALUE  'N'.         01060000
010700         88  PS-LIST-END                      VALUE  'Y'.         01070000
010800         88  PS-NO-LIST-END                   VALUE  'N'.         01080000
010900     05  PS-DB2-ERROR-SW          PIC  X(01)  VALUE  'N'.         01090000
011000         88  PS-DB2-ERROR                     VALUE  'Y'.         01100000
011100         88  PS-NO-DB2-ERROR                  VALUE  'N'.         01110000
011200                                                                  01120000
011300 01  PV-PROGRAM-VARIABLES.                                        01130000
011400     05  PV-CNTL-NBR-X.                                           01140000
011500         10  PV-CNTL-YR          PIC  9(04).                      01150000
011600         10  PV-CNTL-REQ-NBR     PIC  9(04).                      01160000
011700         10  PV-CNTL-SEQ         PIC  9(06).                      01170000
011800     05  PV-CNTL-NBR REDEFINES PV-CNTL-NBR-X PIC 9(14).           01180000
011900     05  PV-CNTL-NBR-INS.                                         01190000
012000         10  PV-CNTL-YR-INS      PIC  9(04).                      01200000
012100         10  PV-CNTL-REQ-NBR-INS PIC  9(04).                      01210000
012200         10  PV-CNTL-SEQ-INS     PIC  9(06).                      01220000
012300     05  PV-CNTL-YEAR            PIC S9(04) COMP.                 01230000
012400     05  PV-CICS-RESPONSE        PIC S9(04) VALUE +0              01240000
012500                                            COMP SYNC.            01250000
012600     05  PV-RETRY-COUNTER        PIC S9(04) VALUE +0              01260000
012700                                            COMP SYNC.            01270000
012800     05  PV-CRD-PROD-YR-D        PIC  S9(4) COMP.                 01280000
012900     05  PV-SHIPT-REQ-NBR-D      PIC  S9(4) COMP.                 01290000
013000     05  PV-STRT-CNTL-NBR-D      PIC  S9(9) COMP.                 01300000
013100**--------------------------------------------------------------**01310000
013200** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **01320000
013300** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **01330000
013400**--------------------------------------------------------------**01340000
013500     COPY SVWS009.                                                01350000
013600*----------------------------------------------------------------*01360000
013700*    MAP LAYOUT                                                  *01370000
013800*----------------------------------------------------------------*01380000
013900     COPY RDKM020.                                                01390000
014000*----------------------------------------------------------------*01400000
014100*    ATTRIBUTE SETTINGS COPYBOOK.                                *01410000
014200*----------------------------------------------------------------*01420000
014300     COPY DPWS015.                                                01430000
014400*----------------------------------------------------------------*01440000
014500*    FUNCTION KEYS COPYBOOK                                      *01450000
014600*----------------------------------------------------------------*01460000
014700     COPY DPWS016.                                                01470000
014800**--------------------------------------------------------------**01480000
014900** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01490000
015000** SUB-ROUTINE (DPKUT100).                                      **01500000
015100**--------------------------------------------------------------**01510000
015200     COPY DPWS010I.                                               01520000
015300**--------------------------------------------------------------**01530000
015400** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*01540000
015500** APPLICATION PROGRAMMING INTERFACE MODULE.                    **01550000
015600**--------------------------------------------------------------**01560000
015700     COPY DPWS030.                                                01570000
CICS       COPY DPWS930.                                                01571000
015800*----------------------------------------------------------------*01580000
015900*    CURRENT DATE AND TIME COPYBOOK                              *01590000
016000*----------------------------------------------------------------*01600000
016100     COPY DPWS017.                                                01610000
016200*----------------------------------------------------------------*01620000
016300* STORED VALUE CARD CONSTANTS                                    *01630000
016400*----------------------------------------------------------------*01640000
016500     COPY SVWS004.                                                01650000
016600**--------------------------------------------------------------**01660000
016700*    STANDARD COMMAREA.                                           01670000
016800**--------------------------------------------------------------**01680000
016900     COPY DPWS020.                                                01690000
017000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01700000
017100***************************************************************** 01710000
017200* INTER-APPLICATION COMMAREA.                                   * 01720000
017300***************************************************************** 01730000
017400         10  INTER-APPL-COMM-AREA PIC X(200).                     01740000
017500     COPY SVWS008.                                                01750000
017600***************************************************************** 01760000
017700*    SPECIFIC COMMMAREA FOR RDKCS020.                             01770000
017800***************************************************************** 01780000
017900         10  ASC-SPECIFIC-COMMAREA.                               01790000
018000             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            01800000
018100             15  ASC-DATA-AREA.                                   01810000
018200                 20  ASC-CNTL-FROM         PIC  X(14).            01820000
018300                 20  ASC-CNTL-FROM-9 REDEFINES ASC-CNTL-FROM      01830000
018400                                           PIC  9(14).            01840000
018500                 20  ASC-CNTL-TO           PIC  X(14).            01850000
018600                 20  ASC-CNTL-TO-9 REDEFINES ASC-CNTL-TO          01860000
018700                                           PIC  9(14).            01870000
018800                 20  ASC-NUMBER-REQUESTED  PIC  X(06).            01880000
018900                 20  ASC-NUMBER-REQUESTED-9 REDEFINES             01890000
019000                     ASC-NUMBER-REQUESTED  PIC  9(06).            01900000
019100                 20  ASC-NUMBER-REQUESTED-Z REDEFINES             01910000
019200                     ASC-NUMBER-REQUESTED  PIC  Z(06).            01920000
019300                 20  ASC-PRODUCER          PIC  X(01).            01930000
019400                 20  ASC-CARD-TYPE         PIC  X(01).            01940000
019500                 20  ASC-CARD-TYPE-9 REDEFINES ASC-CARD-TYPE      01950000
019600                                           PIC  9(01).            01960000
019700                 20  ASC-CARD-TYPE-DESCRIPTION PIC  X(30).        01970000
019800                 20  ASC-ADD-SW            PIC  X(01).            01980000
019900                     88  ASC-ADD                 VALUE  'Y'.      01990000
020000                     88  ASC-NO-ADD              VALUE  ' '.      02000000
020100                 20  ASC-PRE-DENOM-AMT     PIC  X(08).            02010000
020200                 20  ASC-PRE-DENOM-AMT-9   PIC  9(05)V99.         02020000
020300                 20  ASC-STOCK-TYPE-ID     PIC  X(08).            02030000
020400                 20  ASC-STOCK-TYPE-DESC   PIC  X(25).            02040000
020500             15  ASC-USE-SELECTION-QUEUE-IND                      02050000
020600                                           PIC  X(01).            02060000
020700                 88  ASC-USE-SELECTION-QUEUE          VALUE 'Y'.  02070000
020800             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            02080000
020900             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    02090000
021000             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02100000
021100                                           PIC S9(09)  COMP-3.    02110000
021200             15  ASC-SEL-SUB               PIC S9(04)  COMP.      02120000
021300             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      02130000
021400             15  ASC-ERROR-SW              PIC  X(01).            02140000
021500                 88  ASC-ERROR                        VALUE 'Y'.  02150000
021600                 88  ASC-NO-ERROR                     VALUE 'N'.  02160000
021700         10  FILLER                        PIC  X(2727).          02170000
021800*----------------------------------------------------------------*02180000
021900*    ABEND PROCESSING COPYBOOK.                                  *02190000
022000*----------------------------------------------------------------*02200000
022100     COPY DPWS013.                                                02210000
022200                                                                  02220000
022300*----------------------------------------------------------------*02230000
022400*    DB2 AREA FOR SVT_CRD_PROD                                    02240000
022500*----------------------------------------------------------------*02250000
022600                                                                  02260000
022700     EXEC SQL                                                     02270000
022800          INCLUDE SVT00000                                        02280000
022900     END-EXEC.                                                    02290000
023000                                                                  02300000
023100*----------------------------------------------------------------*02310000
023200*    DB2 AREA FOR SVT_CRD_STK_DNMNTN                             *02320000
023300*----------------------------------------------------------------*02330000
023400                                                                  02340000
023500     EXEC SQL                                                     02350000
023600        INCLUDE SVT00008                                          02360000
023700     END-EXEC.                                                    02370000
023800                                                                  02380000
023900*----------------------------------------------------------------*02390000
024000*    DB2 AREA FOR SVT_LAST_ISUD_VGC                              *02400000
024100*----------------------------------------------------------------*02410000
024200                                                                  02420000
024300     EXEC SQL                                                     02430000
024400        INCLUDE SVT00017                                          02440000
024500     END-EXEC.                                                    02450000
024600                                                                  02460000
024700*----------------------------------------------------------------*02470000
024800*    DB2 AREA FOR COMMUNICATIONS                                  02480000
024900*----------------------------------------------------------------*02490000
025000     EXEC SQL                                                     02500000
025100          INCLUDE SQLCA                                           02510000
025200     END-EXEC.                                                    02520000
025300 EJECT                                                            02530000
025400 LINKAGE SECTION.                                                 02540000
025500 01  DFHCOMMAREA.                                                 02550000
025600     05  FILLER                         OCCURS  1 TO 4072 TIMES   02560000
025700                                        DEPENDING ON EIBCALEN.    02570000
025800         10  FILLER                     PIC X.                    02580000
025900 PROCEDURE DIVISION.                                              02590000
026000***************************************************************** 02600000
026100** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02610000
026200** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02620000
026300** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02630000
026400**                                                             ** 02640000
026500** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02650000
026600** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02660000
026700***************************************************************** 02670000
026800 0000-MAIN-MODULE.                                                02680000
026900     INITIALIZE DP030-CICS-API-FIELDS.                            02690000
027000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02700000
027100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02710000
027200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02720000
027300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02730000
027400     MOVE LENGTH OF RD020AI        TO DP030-MAP-LENGTH (1).       02740000
027500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02750000
027600     PERFORM 0001-CALL-CICS-ARCH-API.                             02760000
027700*                                                                 02770000
027800     PERFORM 1000-CONTROL-PROCESSING                              02780000
027900*                                                                 02790000
028000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02800000
028100     PERFORM 0001-CALL-CICS-ARCH-API.                             02810000
028200                                                                  02820000
028300 0001-CALL-CICS-ARCH-API.                                         02830000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02840000
028500                                    DFHCOMMAREA                   02850000
028600                                    DP030-CICS-API-FIELDS         02860000
028700                                    DP020-STANDARD-COMMAREA       02870000
028800                                    RD020AI.                      02880000
028900                                                                  02890000
029000     IF  DP030-RC-CALL-SUCCESSFUL                                 02900000
029100         CONTINUE                                                 02910000
029200     ELSE                                                         02920000
029300         SET DP013-NO-ROLLBACK                                    02930000
029400             DP013-XCTL-DISPLAY-RESTART                           02940000
029500             DP013-CICS-ABEND      TO TRUE                        02950000
029600         MOVE 'BEFORE 0000-MAIN-MODULE'                           02960000
029700                                   TO DP013-PARAGRAPH             02970000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02971000
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02972000
030000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03000000
030100         PERFORM DP013-0000-PROCESS-ABEND                         03010000
030200     END-IF.                                                      03020000
030300*----------------------------------------------------------------*03030000
030400*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03040000
030500*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03050000
030600*----------------------------------------------------------------*03060000
030700 1000-CONTROL-PROCESSING.                                         03070000
030800                                                                  03080000
030900     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       03090000
031000                                                                  03100000
031100     EVALUATE TRUE                                                03110000
031200         WHEN DP020-NEXT-ACT-INITIAL                              03120000
031300             INITIALIZE ASC-SPECIFIC-COMMAREA                     03130000
031400             PERFORM 1100-PREPARE-INTER-APPL-COMM                 03140000
031500             PERFORM 4000-BUILD-INITIAL-PANEL                     03150000
031600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03160000
031700                                                                  03170000
031800         WHEN DP020-NEXT-ACT-READ-MAP                             03180000
031900             PERFORM 2000-PROCESS-PANEL                           03190000
032000                                                                  03200000
032100         WHEN DP020-NEXT-ACT-RETURN                               03210000
032200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03220000
032300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03230000
032400                                                                  03240000
032500         WHEN OTHER                                               03250000
032600             SET DP013-LOGIC-ABEND TO TRUE                        03260000
032700             SET DP013-NO-ROLLBACK TO TRUE                        03270000
032800             MOVE '1000-CONTROL-PROCESSING'                       03280000
032900                                   TO DP013-PARAGRAPH             03290000
033000             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03300000
033100                                   TO DP013-MESSAGE-TEXT(1)       03310000
033200             MOVE DP020-NEXT-APPL-ACTIVITY                        03320000
033300                                   TO DP013-MESSAGE-TEXT(2)       03330000
033400             PERFORM DP013-0000-PROCESS-ABEND                     03340000
033500     END-EVALUATE.                                                03350000
033600*-----------------------------------------------------------------03360000
033700*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    -03370000
033800*  INTER-APPLICATION FORMAT CODE.                                -03380000
033900*-----------------------------------------------------------------03390000
034000 1100-PREPARE-INTER-APPL-COMM.                                    03400000
034100                                                                  03410000
034200      SET ASC-USE-SELECTION-QUEUE TO TRUE.                        03420000
034300      MOVE SV008-NUMBER-OF-SELECTED-ITEMS                         03430000
034400                                TO ASC-NUMBER-OF-SELECTED-ITEMS.  03440000
034500      MOVE SV008-NUMBER-OF-TS-ITEMS                               03450000
034600                                TO ASC-NUMBER-OF-TS-ITEMS.        03460000
034700      MOVE SV008-SEL-QUEUE-NAME                                   03470000
034800                                TO ASC-SEL-QUEUE-NAME.            03480000
034900      PERFORM 1120-PREPARE-LIST-ENTRY.                            03490000
035000                                                                  03500000
035100*----------------------------------------------------------------*03510000
035200* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *03520000
035300* STORAGE QUEUE PASSED FROM THE LIST.                            *03530000
035400*----------------------------------------------------------------*03540000
035500 1120-PREPARE-LIST-ENTRY.                                         03550000
035600                                                                  03560000
035700     MOVE SV009-MAX-ITEMS  TO  ASC-SEL-SUB.                       03570000
035800     MOVE ZERO             TO  ASC-SEL-ITEM.                      03580000
035900     PERFORM 2140-GET-NEXT-SELECTION.                             03590000
036000                                                                  03600000
036100*----------------------------------------------------------------*03610000
036200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *03620000
036300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *03630000
036400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *03640000
036500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *03650000
036600* FUNCTION KEYS CAN GET THIS FAR.                                *03660000
036700*----------------------------------------------------------------*03670000
036800 2000-PROCESS-PANEL.                                              03680000
036900                                                                  03690000
037000     EVALUATE TRUE                                                03700000
037100                                                                  03710000
037200         WHEN DP020-SRC-AID = DP016-CLEAR                         03720000
037300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03730000
037400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03740000
037500                                                                  03750000
037600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03760000
037700             SET DP030-DONT-ERASE                                 03770000
037800                 DP030-SEND-DATAONLY (PC-APPL-MAP)                03780000
037900                                     TO TRUE                      03790000
038000             PERFORM 4000-BUILD-INITIAL-PANEL                     03800000
038100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03810000
038200                                                                  03820000
038300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             03830000
038400             PERFORM 3200-RESET-ATTRIBUTES                        03840000
038500             PERFORM 2140-GET-NEXT-SELECTION                      03850000
038600             IF PS-LIST-END                                       03860000
038700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03870000
038800                 SET PS-NO-LIST-END  TO TRUE                      03880000
038900             ELSE                                                 03890000
039000                 PERFORM 4000-BUILD-INITIAL-PANEL                 03900000
039100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03910000
039200             END-IF                                               03920000
039300                                                                  03930000
039400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             03940000
039500             PERFORM 3200-RESET-ATTRIBUTES                        03950000
039600             PERFORM 2120-GET-PREV-ITEM                           03960000
039700             IF PS-LIST-END                                       03970000
039800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03980000
039900                 SET PS-NO-LIST-END  TO TRUE                      03990000
040000             ELSE                                                 04000000
040100                 PERFORM 4000-BUILD-INITIAL-PANEL                 04010000
040200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04020000
040300             END-IF                                               04030000
040400                                                                  04040000
040500         WHEN OTHER                                               04050000
040600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04060000
040700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04070000
040800             IF PS-NO-ERROR                                       04080000
040900                 SET DP030-CONTINUE-GO                            04090000
041000                                   TO TRUE                        04100000
041100                 PERFORM 2100-CHECK-FUNCTION-KEY                  04110000
041200             ELSE                                                 04120000
041300                 SET DP030-OVERRIDE-GO                            04130000
041400                                   TO TRUE                        04140000
041500             END-IF                                               04150000
041600     END-EVALUATE.                                                04160000
041700*----------------------------------------------------------------*04170000
041800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04180000
041900* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04190000
042000* FROM THE CICS ARCHITECTURE API.                                *04200000
042100*----------------------------------------------------------------*04210000
042200 2100-CHECK-FUNCTION-KEY.                                         04220000
042300     EVALUATE TRUE                                                04230000
042400         WHEN DP020-SRC-AID = DP016-ENTER                         04240000
042500*----------------------------------------------------------------*04250000
042600* NEED TO RESET THE ASC-ADD-SW IF THE PREVIOUS STEPS CAUSED THE  *04260000
042700* ENTERABLE FIELDS TO BE PROTECTED (ONE CAN PF13(ADD)-ENTERABLE  *04270000
042800* FIELDS ARE NOW PROTECTED/ENTER(TO BE ABLE TO RE-ENTER A        *04280000
042900* PROTECTED FIELD/PF13(ADD)/PF2(CONFIRM)                         *04290000
043000*----------------------------------------------------------------*04300000
043100             IF ASC-ADD                                           04310000
043200                 SET ASC-NO-ADD  TO TRUE                          04320000
043300             END-IF                                               04330000
043400*----------------------------------------------------------------*04340000
043500* NEED TO MOVE DISPLAY ONLY FIELDS TO THE SCREEN                 *04350000
043600*----------------------------------------------------------------*04360000
043700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04370000
043800                                                                  04380000
043900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04390000
044000*----------------------------------------------------------------*04400000
044100* NEED TO PROTECT ALL ENTERABLE FIELDS ONCE AN ADD IS SELECTED   *04410000
044200* SO THE RANGE OF RECORDS TO BE INSERTED CANNOT BE ACCIDENTLY    *04420000
044300* CHANGED.  IF THE PRE-DENOMINATED AMOUNT IS NOT ONE OF THE      *04430000
044400* STANDARD VALUES, A WARNING WILL BE DISPLAYED SO THEY COULD     *04440000
044500* CHANGE THE VALUE AT THIS TIME.                                 *04450000
044600*----------------------------------------------------------------*04460000
044700             IF ASC-NO-ERROR                                      04470000
044800                 MOVE DP015-ASK-NOR-OFF                           04480000
044900                                     TO ANBRREQA                  04490000
045000                                        APRDRA                    04500000
045100                                        ACRDTYPA                  04510000
045200                                        ASTKIDA                   04520000
045300                                        ASTKDESA                  04530000
045400                 MOVE DP015-BLUE     TO ANBRREQC                  04540000
045500                                        APRDRC                    04550000
045600                                        ACRDTYPC                  04560000
045700                                        ASTKIDC                   04570000
045800                                        ASTKDESC                  04580000
045900                 MOVE DP015-HL-OFF   TO ANBRREQH                  04590000
046000                                        APRDRH                    04600000
046100                                        ACRDTYPH                  04610000
046200                                        ASTKIDH                   04620000
046300                                        ASTKDESH                  04630000
046400*----------------------------------------------------------------*04640000
046500* NEED TO MOVE DISPLAY ONLY FIELD TO THE SCREEN FROM A PREVIOUS  *04650000
046600* ADD, IF THE "CNTL TO" FIELD HAS NOT YET BEEN DISPLAYED         *04660000
046700*----------------------------------------------------------------*04670000
046800                 IF ADCNTOO = LOW-VALUES                          04680000
046900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         04690000
047000                 END-IF                                           04700000
047100                                                                  04710000
047200*----PC-TSYMSG-00004 - PRESS F2 TO CONFIRM REQUEST                04720000
047300                 MOVE PC-TSYMSG-00004   TO DP020-MSG-NUMBER       04730000
047400                 SET DP020-MSG-INFORMATIONAL                      04740000
047500                         ASC-ADD        TO TRUE                   04750000
047600             END-IF                                               04760000
047700         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    04770000
047800             IF ASC-ADD                                           04780000
047900                 SET DP030-CONTINUE-GO                            04790000
048000                                 TO TRUE                          04800000
048100                 MOVE ASC-CNTL-FROM-9                             04810000
048200                                 TO PV-CNTL-NBR-INS               04820000
048300* MAKE SURE THAT THE REQUEST NUMBER HAS NOT BEEN STOLEN BY        04830000
048400* SOMEONE ELSE WHILE MAKING THIS REQUEST.                         04840000
048500                 PERFORM 5100-CHECK-REQ-NBR                       04850000
048600                 IF PV-CNTL-REQ-NBR = PV-CNTL-REQ-NBR-INS         04860000
048700                     PERFORM 5200-INSERT-SVT-CRD-PROD             04870000
048800                     IF PS-NO-DB2-ERROR                           04880000
048900*            --- ADD SUCCESSFUL ---                               04890000
090821                         IF ASC-STOCK-TYPE-ID = 'VIRTUAL' OR      04901000
090821                            ASC-STOCK-TYPE-ID = 'KMCVIR'          04902000
049100                             PERFORM 2110-ADD-LAST-ISSUE          04910000
049200                         END-IF                                   04920000
049300                         MOVE PC-TSYMSG-00034                     04930000
049400                                   TO DP020-MSG-NUMBER            04940000
049500                         SET DP020-MSG-INFORMATIONAL              04950000
049600                                   TO TRUE                        04960000
049700* ERASE UNPROTECTED/PROTECTED FIELDS AFTER A SUCCESSFUL ADD       04970000
049800                         SET DP030-ERASE-UNPROT                   04980000
049900                                   TO TRUE                        04990000
050000                         MOVE LOW-VALUES                          05000000
050100                                   TO ANBRREQO                    05010000
050200                         MOVE ZEROS                               05020000
050300                                   TO APREAMTO                    05030000
050400                         MOVE SPACES                              05040000
050500                                   TO ADCNTOO                     05050000
050600                                      ASTKIDO                     05060000
050700                                      ASTKDESO                    05070000
050800                                      APRDRO                      05080000
050900* SAVE NEXT CARD NUMBER, BEFORE ASC- FIELDS ARE CLEARED           05090000
051000                         MOVE ASC-CNTL-TO-9                       05100000
051100                                 TO PV-CNTL-NBR                   05110000
051200* CLEAR OUT ASC- FIELDS AFTER A SUCCESSFUL ADD.                   05120000
051300                         INITIALIZE ASC-DATA-AREA                 05130000
051400                         ADD 1 TO PV-CNTL-REQ-NBR                 05140000
051500                         MOVE 1 TO PV-CNTL-SEQ                    05150000
051600                         MOVE PV-CNTL-NBR                         05160000
051700                                 TO ASC-CNTL-FROM-9               05170000
051800* PROTECT THE ENTERABLE FIELDS AFTER SUCCESSFUL ADD               05180000
051900                         MOVE DP015-PRO-NOR-OFF TO ANBRREQA       05190000
052000                                                   APRDRA         05200000
052100                         MOVE DP015-BLUE        TO ANBRREQC       05210000
052200                                                   APRDRC         05220000
052300                         MOVE DP015-HL-OFF      TO ANBRREQH       05230000
052400                                                   APRDRH         05240000
052500* NEED TO MOVE INITIAL DEFAULT FIELDS TO THE SCREEN               05250000
052600                         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     05260000
052700                     END-IF                                       05270000
052800                 ELSE                                             05280000
052900                     SET ASC-NO-ADD  TO TRUE                      05290000
053000                     MOVE DP015-ASK-NOR-OFF                       05300000
053100                                         TO ANBRREQA              05310000
053200                                            ACRDTYPA              05320000
053300                                            APREAMTA              05330000
053400                     MOVE DP015-BLUE     TO ANBRREQC              05340000
053500                                            ACRDTYPC              05350000
053600                                            APREAMTC              05360000
053700                     MOVE DP015-HL-OFF   TO ANBRREQH              05370000
053800                                            ACRDTYPH              05380000
053900                                            APREAMTH              05390000
054000*----PC-TSYMSG-01356 - CONTROL NUMBER RANGE ALREADY REQUESTED     05400000
054100                     MOVE PC-TSYMSG-01356                         05410000
054200                                       TO DP020-MSG-NUMBER        05420000
054300                     SET DP020-MSG-FATAL                          05430000
054400                                       TO TRUE                    05440000
054500                 END-IF                                           05450000
054600             ELSE                                                 05460000
054700*----PC-TSYMSG-00999 - ADD MUST BE REQUESTED BEFORE CONFIRM       05470000
054800                 MOVE PC-TSYMSG-00999                             05480000
054900                                   TO DP020-MSG-NUMBER            05490000
055000                 SET DP020-MSG-INFORMATIONAL                      05500000
055100                                   TO TRUE                        05510000
055200             END-IF                                               05520000
055300                                                                  05530000
055400         WHEN OTHER                                               05540000
055500             SET DP013-NO-ROLLBACK                                05550000
055600                 DP013-XCTL-DISPLAY-RESTART                       05560000
055700                 DP013-CICS-ABEND  TO TRUE                        05570000
055800             MOVE '2000-PROCESS-PANEL'                            05580000
055900                                   TO DP013-PARAGRAPH             05590000
056000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05600000
056100                                   TO DP013-MESSAGE-TEXT (1)      05610000
056200             PERFORM DP013-0000-PROCESS-ABEND                     05620000
056300     END-EVALUATE.                                                05630000
056400*----------------------------------------------------------------*05640000
056500*  ADD A ROW TO THE SVT_LAST_ISUD_VGC TABLE                      *05650000
056600*----------------------------------------------------------------*05660000
056700 2110-ADD-LAST-ISSUE.                                             05670000
056800                                                                  05680000
056900     MOVE  PV-CNTL-YR-INS      TO PV-CRD-PROD-YR-D.               05690000
057000     MOVE  PV-CNTL-REQ-NBR-INS TO PV-SHIPT-REQ-NBR-D.             05700000
057100     MOVE  +0                  TO PV-STRT-CNTL-NBR-D.             05710000
057200                                                                  05720000
057300     EXEC SQL                                                     05730000
057400         INSERT INTO SVT_LAST_ISUD_VGC                            05740000
057500            (CRD_PROD_YR                                          05750000
057600            ,SHIPT_REQ_NBR                                        05760000
057700            ,LAST_ISUD_CNTL_NBR)                                  05770000
057800         VALUES(:PV-CRD-PROD-YR-D                                 05780000
057900               ,:PV-SHIPT-REQ-NBR-D                               05790000
058000               ,:PV-STRT-CNTL-NBR-D)                              05800000
058100     END-EXEC.                                                    05810000
058200                                                                  05820000
058300     EVALUATE TRUE                                                05830000
058400        WHEN SQLCODE = 0                                          05840000
058500            CONTINUE                                              05850000
058600        WHEN OTHER                                                05860000
058700             MOVE '2110-ADD-LAST-ISSUE'                           05870000
058800                                   TO DP013-PARAGRAPH             05880000
058900             MOVE 'INSERT ROW INTO THE SVT_LAST_ISUD_VGC'         05890000
059000                                   TO DP013-MESSAGE-TEXT(1)       05900000
059100             MOVE SQLCA            TO DP013-SQLCA                 05910000
059200             MOVE 'SVT_LAST_ISUD_VGC'                             05920000
059300                                 TO DP013-DB2-TABLE-NAME (1)      05930000
059400             SET DP013-DB2-ABEND                                  05940000
059500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           05950000
059600             PERFORM DP013-0000-PROCESS-ABEND                     05960000
059700      END-EVALUATE.                                               05970000
059800                                                                  05980000
059900*----------------------------------------------------------------*05990000
060000*  GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED         *06000000
060100*  OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.           *06010000
060200*----------------------------------------------------------------*06020000
060300 2120-GET-PREV-ITEM.                                              06030000
060400     SUBTRACT +1 FROM ASC-SEL-SUB.                                06040000
060500     IF  ASC-SEL-SUB < +1                                         06050000
060600         SUBTRACT +1 FROM ASC-SEL-ITEM                            06060000
060700         MOVE SV009-MAX-ITEMS      TO ASC-SEL-SUB                 06070000
060800     END-IF.                                                      06080000
060900*                                                                 06090000
061000     IF  ASC-SEL-ITEM > ZERO                                      06100000
061100         PERFORM 9100-READ-SEL-QUEUE                              06110000
061200         MOVE SV009-CRD-TYPE-CDE (ASC-SEL-SUB)                    06120000
061300                                 TO ASC-CARD-TYPE-9               06130000
061400                                    DK-CRD-TYP-CDE                06140000
061500         MOVE SV009-STK-TYP-ID (ASC-SEL-SUB)                      06150000
061600                                 TO ASC-STOCK-TYPE-ID             06160000
061700                                    DK-CRD-STK-TYP-ID             06170000
061800         MOVE SV009-PRE-DNNTD-AMT-9 (ASC-SEL-SUB)                 06180000
061900                                 TO ASC-PRE-DENOM-AMT-9           06190000
062000                                    DK-PRE-DNNTD-CRD-AMT          06200000
062100     ELSE                                                         06210000
062200         MOVE +1                   TO ASC-SEL-ITEM                06220000
062300                                      ASC-SEL-SUB                 06230000
062400*        --- TOP OF LIST ---                                      06240000
062500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06250000
062600         SET DP020-MSG-INFORMATIONAL                              06260000
062700                                   TO TRUE                        06270000
062800     END-IF.                                                      06280000
062900 EJECT                                                            06290000
063000*----------------------------------------------------------------*06300000
063100*  GETS ITEMS FROM THE SELECT QUEUE AND MOVES THEM TO THE ASC.   *06310000
063200*----------------------------------------------------------------*06320000
063300 2140-GET-NEXT-SELECTION.                                         06330000
063400                                                                  06340000
063500     ADD +1                       TO ASC-SEL-SUB.                 06350000
063600     IF  ASC-SEL-SUB > SV009-MAX-ITEMS                            06360000
063700         ADD +1                   TO ASC-SEL-ITEM                 06370000
063800         MOVE +1                  TO ASC-SEL-SUB                  06380000
063900     END-IF.                                                      06390000
064000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06400000
064100         PERFORM 9100-READ-SEL-QUEUE                              06410000
064200         IF  SV009-ITEM (ASC-SEL-SUB) > ZERO                      06420000
064300             MOVE SV009-CRD-TYPE-CDE (ASC-SEL-SUB)                06430000
064400                                     TO ASC-CARD-TYPE-9           06440000
064500                                        DK-CRD-TYP-CDE            06450000
064600             MOVE SV009-STK-TYP-ID (ASC-SEL-SUB)                  06460000
064700                                     TO ASC-STOCK-TYPE-ID         06470000
064800                                        DK-CRD-STK-TYP-ID         06480000
064900             MOVE SV009-PRE-DNNTD-AMT-9 (ASC-SEL-SUB)             06490000
065000                                     TO ASC-PRE-DENOM-AMT-9       06500000
065100                                        DK-PRE-DNNTD-CRD-AMT      06510000
065200             MOVE PC-INQ TO SV009-ACTION-SW (ASC-SEL-SUB)         06520000
065300             PERFORM 9200-REWRITE-SEL-QUEUE                       06530000
065400         ELSE                                                     06540000
065500             SUBTRACT +1 FROM ASC-SEL-SUB                         06550000
065600*            --- BOTTOM OF LIST ---                               06560000
065700             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             06570000
065800             SET DP020-MSG-INFORMATIONAL TO TRUE                  06580000
065900             SET PS-LIST-END             TO TRUE                  06590000
066000         END-IF                                                   06600000
066100     ELSE                                                         06610000
066200         SUBTRACT +1 FROM ASC-SEL-ITEM                            06620000
066300         MOVE SV009-MAX-ITEMS     TO ASC-SEL-SUB                  06630000
066400*        --- BOTTOM OF LIST ---                                   06640000
066500         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             06650000
066600         SET DP020-MSG-INFORMATIONAL TO TRUE                      06660000
066700         SET PS-LIST-END             TO TRUE                      06670000
066800     END-IF.                                                      06680000
066900                                                                  06690000
067000*----------------------------------------------------------------*06700000
067100* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *06710000
067200* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *06720000
067300* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *06730000
067400*----------------------------------------------------------------*06740000
067500 2200-MOVE-SCREEN-TO-COMMAREA.                                    06750000
067600     IF ANBRREQL > ZERO                                           06760000
067700         MOVE ANBRREQI           TO ASC-NUMBER-REQUESTED          06770000
067800     ELSE                                                         06780000
067900         IF ANBRREQF = DP015-ERASE-EOF                            06790000
068000             MOVE SPACE          TO ASC-NUMBER-REQUESTED          06800000
068100         END-IF                                                   06810000
068200     END-IF.                                                      06820000
068300     IF APRDRL > ZERO                                             06830000
068400         MOVE APRDRI             TO ASC-PRODUCER                  06840000
068500     ELSE                                                         06850000
068600         IF APRDRF = DP015-ERASE-EOF                              06860000
068700             MOVE SPACE          TO ASC-PRODUCER                  06870000
068800         END-IF                                                   06880000
068900     END-IF.                                                      06890000
069000     IF ACRDTYPL > ZERO                                           06900000
069100         MOVE ACRDTYPI           TO ASC-CARD-TYPE                 06910000
069200     ELSE                                                         06920000
069300         IF ACRDTYPF = DP015-ERASE-EOF                            06930000
069400             MOVE SPACE          TO ASC-CARD-TYPE                 06940000
069500         END-IF                                                   06950000
069600     END-IF.                                                      06960000
069700     IF APREAMTL > ZERO                                           06970000
069800         MOVE APREAMTI           TO ASC-PRE-DENOM-AMT             06980000
069900     ELSE                                                         06990000
070000         IF APREAMTF = DP015-ERASE-EOF                            07000000
070100             MOVE SPACE          TO ASC-PRE-DENOM-AMT             07010000
070200         END-IF                                                   07020000
070300     END-IF.                                                      07030000
070400     IF ASTKIDL > ZERO                                            07040000
070500         MOVE ASTKIDI            TO ASC-STOCK-TYPE-ID             07050000
070600     ELSE                                                         07060000
070700         IF ASTKIDF = DP015-ERASE-EOF                             07070000
070800             MOVE SPACE          TO ASC-STOCK-TYPE-ID             07080000
070900         END-IF                                                   07090000
071000     END-IF.                                                      07100000
071100     IF ASTKDESL > ZERO                                           07110000
071200         MOVE ASTKDESI           TO ASC-STOCK-TYPE-DESC           07120000
071300     ELSE                                                         07130000
071400         IF ASTKDESF = DP015-ERASE-EOF                            07140000
071500             MOVE SPACE          TO ASC-STOCK-TYPE-DESC           07150000
071600         END-IF                                                   07160000
071700     END-IF.                                                      07170000
071800*----------------------------------------------------------------*07180000
071900* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *07190000
072000* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *07200000
072100* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *07210000
072200*----------------------------------------------------------------*07220000
072300 3000-EDIT-DATA-IN-COMMAREA.                                      07230000
072400     PERFORM 3200-RESET-ATTRIBUTES.                               07240000
072500                                                                  07250000
072600     IF ASC-NUMBER-REQUESTED > SPACES                             07260000
072700         MOVE ASC-NUMBER-REQUESTED                                07270000
072800                                 TO DP010I-UNEDITED-FIELD         07280000
072900         MOVE LENGTH OF ASC-NUMBER-REQUESTED                      07290000
073000                                 TO DP010I-MAXIMUM-DIGITS         07300000
073100         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       07310000
073200         SET DP010I-NEGATIVE-NOT-ALLOWED                          07320000
073300                                 TO TRUE                          07330000
073400         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07340000
073500                                 USING DP010I-NUMERIC-EDIT-AREA   07350000
073600         IF DP010I-ERROR-DETECTED                                 07360000
073700             SET PS-ERROR        TO TRUE                          07370000
073800             SET DP020-MSG-FATAL TO TRUE                          07380000
073900*----PC-TSYMSG-00008 - MUST BE NUMERIC                            07390000
074000             MOVE PC-TSYMSG-00008                                 07400000
074100                                 TO DP020-MSG-NUMBER              07410000
074200             MOVE DP015-UNP-ALP-BRT-OFF                           07420000
074300                                 TO ANBRREQA                      07430000
074400             MOVE DP015-RED      TO ANBRREQC                      07440000
074500             MOVE DP015-REVERSE  TO ANBRREQH                      07450000
074600             MOVE -1             TO ANBRREQL                      07460000
074700             SET DP030-SET-CURSOR-APPL-1                          07470000
074800                                 TO TRUE                          07480000
074900         ELSE                                                     07490000
075000             IF DP010I-NUMERIC-FIELD = ZEROS                      07500000
075100                 SET PS-ERROR    TO TRUE                          07510000
075200                 SET DP020-MSG-FATAL                              07520000
075300                                 TO TRUE                          07530000
075400*----PC-TSYMSG-00010 - CANNOT BE ZERO                             07540000
075500                 MOVE PC-TSYMSG-00010                             07550000
075600                                 TO DP020-MSG-NUMBER              07560000
075700                 MOVE DP015-UNP-ALP-BRT-OFF                       07570000
075800                                 TO ANBRREQA                      07580000
075900                 MOVE DP015-RED  TO ANBRREQC                      07590000
076000                 MOVE DP015-REVERSE                               07600000
076100                                 TO ANBRREQH                      07610000
076200                 MOVE -1         TO ANBRREQL                      07620000
076300                 SET DP030-SET-CURSOR-APPL-1                      07630000
076400                                 TO TRUE                          07640000
076500             ELSE                                                 07650000
076600                 MOVE DP010I-NUMERIC-FIELD                        07660000
076700                                 TO ASC-NUMBER-REQUESTED-9        07670000
076800                                    ASC-NUMBER-REQUESTED-Z        07680000
076900                 MOVE ASC-NUMBER-REQUESTED-Z                      07690000
077000                                 TO ANBRREQO                      07700000
077100                 MOVE ASC-CNTL-FROM-9                             07710000
077200                                 TO PV-CNTL-NBR                   07720000
077300                 IF ASC-NUMBER-REQUESTED-9 = 999999               07730000
077400                     MOVE 999999 TO PV-CNTL-SEQ                   07740000
077500                 ELSE                                             07750000
077600                     ADD ASC-NUMBER-REQUESTED-9                   07760000
077700                                     TO PV-CNTL-SEQ               07770000
077800                     SUBTRACT 1 FROM PV-CNTL-SEQ                  07780000
077900                 END-IF                                           07790000
078000                 MOVE PV-CNTL-NBR TO ASC-CNTL-TO-9                07800000
078100             END-IF                                               07810000
078200         END-IF                                                   07820000
078300     ELSE                                                         07830000
078400         SET PS-ERROR            TO TRUE                          07840000
078500         SET DP020-MSG-FATAL     TO TRUE                          07850000
078600*----PC-TSYMSG-00007 - REQUIRED ENTRY                             07860000
078700         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              07870000
078800         MOVE DP015-UNP-ALP-BRT-OFF                               07880000
078900                                 TO ANBRREQA                      07890000
079000         MOVE DP015-RED          TO ANBRREQC                      07900000
079100         MOVE DP015-REVERSE      TO ANBRREQH                      07910000
079200         MOVE -1                 TO ANBRREQL                      07920000
079300         SET DP030-SET-CURSOR-APPL-1                              07930000
079400                                 TO TRUE                          07940000
079500     END-IF.                                                      07950000
079600                                                                  07960000
079700     SET SV004-CARD-PRDR-IDX TO 1.                                07970000
079800                                                                  07980000
079900     SEARCH SV004-CARD-PRDR                                       07990000
080000         AT END                                                   08000000
080100             SET ASC-ERROR                                        08010000
080200                 DP020-MSG-FATAL  TO TRUE                         08020000
080300*----- INVALID PRODUCER CODE --------------                       08030000
080400             MOVE PC-TSYMSG-03268  TO DP020-MSG-NUMBER            08040000
080500             MOVE DP015-UNP-ALP-BRT-OFF  TO APRDRA                08050000
080600             MOVE DP015-RED              TO APRDRC                08060000
080700             MOVE DP015-REVERSE          TO APRDRH                08070000
080800             MOVE -1                     TO APRDRL                08080000
080900             SET DP020-MSG-FATAL         TO TRUE                  08090000
081000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08100000
081100         WHEN ASC-PRODUCER =                                      08110000
081200                       SV004-CARD-PRDR-CDE (SV004-CARD-PRDR-IDX)  08120000
081300             MOVE ASC-PRODUCER  TO APRDRO                         08130000
081400             SET ASC-NO-ERROR TO TRUE                             08140000
081500     END-SEARCH.                                                  08150000
081600                                                                  08160000
081700     IF ASC-CARD-TYPE-9 = SV004-KMRC-CRD-TYP                      08170000
081800         IF ASC-PRODUCER = SV004-CARD-PRODUCER-KOHLS  OR          08180000
8661H             ASC-PRODUCER = SV004-CARD-PRODUCER-INCOMM OR          08190000
111023            ASC-PRODUCER = SV004-CARD-PRDR-PLICRD     OR          08201003
8661H             ASC-PRODUCER = SV004-CARD-PRDR-BLACKHAWK  OR          08210000
WR7057            ASC-PRODUCER = SV004-CARD-PRDR-VALID      OR          08211000
092122            ASC-PRODUCER = SV004-CARD-PRDR-OPTMUM     OR          08220000
082300            ASC-PRODUCER = SV004-CARD-PRDR-JET-LITHO  OR          08230000
082300            ASC-PRODUCER = SV004-CARD-PRDR-MTL                    08231000
082400             CONTINUE                                             08240000
082500         ELSE                                                     08250000
082600             SET ASC-ERROR                                        08260000
082700                 DP020-MSG-FATAL  TO TRUE                         08270000
082800*----- INVALID PRODUCER CODE --------------                       08280000
082900             MOVE PC-TSYMSG-03268  TO DP020-MSG-NUMBER            08290000
083000             MOVE DP015-UNP-ALP-BRT-OFF  TO APRDRA                08300000
083100             MOVE DP015-RED              TO APRDRC                08310000
083200             MOVE DP015-REVERSE          TO APRDRH                08320000
083300             MOVE -1                     TO APRDRL                08330000
083400             SET DP020-MSG-FATAL         TO TRUE                  08340000
083500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08350000
083600         END-IF                                                   08360000
P5211      ELSE                                                         08361000
P5211          IF (ASC-PRODUCER = SV004-CARD-PRDR-VIRTUAL AND           08361100
P5211              ASC-STOCK-TYPE-ID(1:3) = 'VGC') OR                   08361200
P5211             (ASC-PRODUCER NOT = SV004-CARD-PRDR-VIRTUAL AND       08361300
P5211              ASC-STOCK-TYPE-ID(1:3) NOT = 'VGC')                  08361400
P5211              CONTINUE                                             08361500
P5211          ELSE                                                     08361600
P5211                SET ASC-ERROR                                      08361700
P5211                    DP020-MSG-FATAL  TO TRUE                       08361800
P5211 *----- INVALID PRODUCER CODE --------------                       08361900
P5211                MOVE PC-TSYMSG-03268  TO DP020-MSG-NUMBER          08362000
P5211                MOVE DP015-UNP-ALP-BRT-OFF  TO APRDRA              08362100
P5211                MOVE DP015-RED              TO APRDRC              08362200
P5211                MOVE DP015-REVERSE          TO APRDRH              08362300
P5211                MOVE -1                     TO APRDRL              08362400
P5211                SET DP020-MSG-FATAL         TO TRUE                08362500
P5211                SET DP030-SET-CURSOR-APPL-1 TO TRUE                08362600
P5211          END-IF                                                   08362700
083700     END-IF.                                                      08370000
                                                                        08371000
JPGFX1*----- THIS RESTRICTION IS FOR GIFT CARDS PRODUCED AT KOHLS.      08372000
JPGFX1*----- CURRENTLY JOB SVK055 SEGMENTS THE CARDS PRODUCED AT        08372100
JPGFX1*----- KOHLS BY 5000 WITH A MAXIMUM LIMIT OF PDS MEMBERS BEING    08372200
JPGFX1*----- 99. 99 X 5000 = 495000.                                    08372300
JPGFX1     IF ASC-PRODUCER = SV004-CARD-PRODUCER-KOHLS AND              08372400
JPGFX1         ASC-NUMBER-REQUESTED-9 > 495000                          08372500
JPGFX1             SET PS-ERROR    TO TRUE                              08372600
JPGFX1             SET DP020-MSG-FATAL                                  08372700
JPGFX1                             TO TRUE                              08372800
JPGFX1*----- NUMBER REQUESTED CANNOT EXCEED 495,000                     08372900
JPGFX1*----- FOR CARDS PRODUCED AT KOHLS                                08373000
JPGFX1             MOVE PC-TSYMSG-03759                                 08373100
JPGFX1                             TO DP020-MSG-NUMBER                  08373200
JPGFX1             MOVE DP015-UNP-ALP-BRT-OFF                           08373300
JPGFX1                             TO ANBRREQA                          08373400
JPGFX1             MOVE DP015-RED  TO ANBRREQC                          08373500
JPGFX1             MOVE DP015-REVERSE                                   08373600
JPGFX1                             TO ANBRREQH                          08373700
JPGFX1             MOVE -1         TO ANBRREQL                          08373800
JPGFX1             SET DP030-SET-CURSOR-APPL-1                          08373900
JPGFX1                             TO TRUE                              08374000
JPGFX1     END-IF.                                                      08375000
                                                                        08377000
083800*----------------------------------------------------------------*08380000
083900* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *08390000
084000* MAP.                                                           *08400000
084100*----------------------------------------------------------------*08410000
084200 3200-RESET-ATTRIBUTES.                                           08420000
084300     MOVE DP015-UNP-ALP-NOR-OFF  TO ANBRREQA                      08430000
084400                                    APRDRA.                       08440000
084500     MOVE DP015-GREEN            TO ANBRREQC                      08450000
084600                                    APRDRC.                       08460000
084700     MOVE DP015-UNDERLINE        TO ANBRREQH                      08470000
084800                                    APRDRH.                       08480000
084900*----------------------------------------------------------------*08490000
085000*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *08500000
085100*    ENTRY.                                                      *08510000
085200*----------------------------------------------------------------*08520000
085300 4000-BUILD-INITIAL-PANEL.                                        08530000
085400     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        08540000
085500     MOVE -1                       TO ANBRREQL.                   08550000
085600     MOVE DP017-CURRENT-YMD-YYYY TO PV-CNTL-YR.                   08560000
085700     MOVE PV-CNTL-YR             TO PV-CNTL-YEAR.                 08570000
085800     MOVE PC-PDR-KOHLS           TO ASC-PRODUCER.                 08580000
085900     PERFORM 4100-SELECT-MAX-REQ-NBR.                             08590000
086000     IF PS-NO-DB2-ERROR                                           08600000
086100         MOVE SVT00000-SHIPT-REQ-NBR TO PV-CNTL-REQ-NBR           08610000
086200         IF PV-CNTL-REQ-NBR > 0                                   08620000
086300             CONTINUE                                             08630000
086400         ELSE                                                     08640000
086500             MOVE DP017-CURRENT-YMD-YYYY TO PV-CNTL-YR            08650000
086600             ADD 1 TO PV-CNTL-REQ-NBR                             08660000
086700         END-IF                                                   08670000
086800         MOVE 1 TO PV-CNTL-SEQ                                    08680000
086900         MOVE PV-CNTL-NBR TO ASC-CNTL-FROM-9                      08690000
087000     END-IF.                                                      08700000
087100                                                                  08710000
087200     PERFORM 4200-SELECT-DESC.                                    08720000
087300     IF PS-NO-DB2-ERROR                                           08730000
087400         MOVE SVT00008-CRD-STK-TYP-DESC TO ASC-STOCK-TYPE-DESC    08740000
087500     END-IF.                                                      08750000
087600*----------------------------------------------------------------*08760000
087700* SELECT THE MAXIMUM REQUEST NUMBER FROM THE STORED VALUE CARD   *08770000
087800*     CONTROL TABLE                                              *08780000
087900*----------------------------------------------------------------*08790000
088000 4100-SELECT-MAX-REQ-NBR.                                         08800000
088100     EXEC SQL                                                     08810000
088200         SELECT  MAX(SHIPT_REQ_NBR) + 1                           08820000
088300           INTO  :SVT00000-SHIPT-REQ-NBR                          08830000
088400           FROM  SVT_CRD_PROD                                     08840000
088500          WHERE  CRD_PROD_YR = :PV-CNTL-YEAR                      08850000
088600     END-EXEC.                                                    08860000
088700                                                                  08870000
088800     EVALUATE TRUE                                                08880000
088900         WHEN SQLCODE = 0                                         08890000
089000             CONTINUE                                             08900000
089100         WHEN SQLCODE = -305                                      08910000
089200             MOVE ZERO TO SVT00000-SHIPT-REQ-NBR                  08920000
089300         WHEN SQLCODE = -911                                      08930000
089400         WHEN SQLCODE = -913                                      08940000
089500             MOVE '4100-SELECT-MAX-REQ-NBR   '                    08950000
089600                                 TO DP013-PARAGRAPH               08960000
089700             MOVE 'SELECT MAX REQUEST NBR'                        08970000
089800                                 TO DP013-MESSAGE-TEXT (1)        08980000
089900             MOVE 'SVT_CRD_PROD' TO DP013-DB2-TABLE-NAME (1)      08990000
090000             MOVE SQLCA          TO DP013-SQLCA                   09000000
090100             SET DP013-LINK-RETURN                                09010000
090200                 DP013-DB2-ABEND                                  09020000
090300                 DP013-ROLLBACK  TO TRUE                          09030000
090400             PERFORM DP013-0000-PROCESS-ABEND                     09040000
090500             MOVE 'SVT_CRD_PROD' TO DP020-MSG-TEXT                09050000
090600*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           09060000
090700*----                  TRANSACTION FOR DATABASE &VAR              09070000
090800             MOVE PC-TSYMSG-00482                                 09080000
090900                                 TO DP020-MSG-NUMBER              09090000
091000             SET PS-DB2-ERROR    TO TRUE                          09100000
091100             SET DP020-MSG-FATAL TO TRUE                          09110000
091200             SET DP020-NEXT-ACT-APPL-ERROR                        09120000
091300                                 TO TRUE                          09130000
091400         WHEN OTHER                                               09140000
091500             MOVE '4100-SELECT-MAX-REQ-NBR   '                    09150000
091600                                 TO DP013-PARAGRAPH               09160000
091700             MOVE 'SELECT MAX REQUEST NBR'                        09170000
091800                                 TO DP013-MESSAGE-TEXT (1)        09180000
091900             MOVE SQLCA          TO DP013-SQLCA                   09190000
092000             MOVE 'SVT_CRD_PROD' TO DP013-DB2-TABLE-NAME (1)      09200000
092100             SET DP013-DB2-ABEND                                  09210000
092200                 DP013-XCTL-DISPLAY-RESTART                       09220000
092300                                   TO TRUE                        09230000
092400             PERFORM DP013-0000-PROCESS-ABEND                     09240000
092500     END-EVALUATE.                                                09250000
092600*----------------------------------------------------------------*09260000
092700* SELECT CARD STOCK DESCRIPTION.                                 *09270000
092800*----------------------------------------------------------------*09280000
092900 4200-SELECT-DESC.                                                09290000
093000     PERFORM                                                      09300000
093100         WITH TEST AFTER                                          09310000
093200         VARYING PV-RETRY-COUNTER                                 09320000
093300         FROM 1 BY 1                                              09330000
093400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09340000
093500                   OR (SQLCODE = ZERO)                            09350000
093600                   OR (SQLCODE = +100))                           09360000
093700*                                                                 09370000
093800         EXEC SQL                                                 09380000
093900             SELECT CRD_STK_TYP_DESC                              09390000
094000             INTO   :SVT00008-CRD-STK-TYP-DESC                    09400000
094100             FROM   SVT_CRD_STK_DNMNTN                            09410000
094200             WHERE  CRD_TYP_CDE       = :DK-CRD-TYP-CDE           09420000
094300               AND  CRD_STK_TYP_ID    = :DK-CRD-STK-TYP-ID        09430000
094400               AND  PRE_DNNTD_CRD_AMT = :DK-PRE-DNNTD-CRD-AMT     09440000
094500         END-EXEC                                                 09450000
094600                                                                  09460000
094700         EVALUATE TRUE                                            09470000
094800             WHEN SQLCODE = ZERO                                  09480000
094900             WHEN SQLCODE = +100                                  09490000
095000             WHEN SQLCODE = -904                                  09500000
095100             WHEN SQLCODE = -913                                  09510000
095200                 CONTINUE                                         09520000
095300             WHEN SQLWARN0 NOT = SPACES                           09530000
095400             WHEN SQLCODE < ZERO                                  09540000
095500             WHEN SQLCODE > ZERO                                  09550000
095600                 MOVE '4200-SELECT-DESC'                          09560000
095700                                   TO DP013-PARAGRAPH             09570000
095800                 MOVE 'SELECT CRD STK DESC'                       09580000
095900                                   TO DP013-MESSAGE-TEXT (1)      09590000
096000                 MOVE SQLCA        TO DP013-SQLCA                 09600000
096100                 MOVE 'SVT_CRD_STK_DNMNTN'                        09610000
096200                                   TO DP013-DB2-TABLE-NAME (1)    09620000
096300                 SET DP013-DB2-ABEND                              09630000
096400                     DP013-XCTL-DISPLAY-RESTART                   09640000
096500                                   TO TRUE                        09650000
096600                 PERFORM DP013-0000-PROCESS-ABEND                 09660000
096700         END-EVALUATE                                             09670000
096800     END-PERFORM.                                                 09680000
096900*                                                                 09690000
097000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09700000
097100         MOVE '4200-SELECT-DESC'   TO DP013-PARAGRAPH             09710000
097200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     09720000
097300                                   TO DP013-MESSAGE-TEXT (1)      09730000
097400         MOVE 'CRD STK DESC'       TO DP013-MESSAGE-TEXT (2)      09740000
097500         MOVE SQLCA                TO DP013-SQLCA                 09750000
097600         MOVE 'SVT_CRD_STK_DNMNTN' TO DP013-DB2-TABLE-NAME (1)    09760000
097700         SET DP013-DB2-ABEND                                      09770000
097800             DP013-XCTL-DISPLAY-RESTART                           09780000
097900                                   TO TRUE                        09790000
098000         PERFORM DP013-0000-PROCESS-ABEND                         09800000
098100     END-IF.                                                      09810000
098200*----------------------------------------------------------------*09820000
098300*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *09830000
098400*----------------------------------------------------------------*09840000
098500 4400-MOVE-COMMAREA-TO-SCREEN.                                    09850000
098600     MOVE ASC-CNTL-FROM          TO ADCNFRO.                      09860000
098700     MOVE ASC-CNTL-TO            TO ADCNTOO.                      09870000
098800     MOVE ASC-PRODUCER           TO APRDRO.                       09880000
098900     MOVE ASC-NUMBER-REQUESTED   TO ANBRREQO.                     09890000
099000     MOVE ASC-CARD-TYPE          TO ACRDTYPO.                     09900000
099100     MOVE ASC-CARD-TYPE-DESCRIPTION                               09910000
099200                                 TO ACRDDESO.                     09920000
099300     MOVE ASC-PRE-DENOM-AMT-9    TO APREAMTO.                     09930000
099400     MOVE ASC-STOCK-TYPE-ID      TO ASTKIDO.                      09940000
099500     MOVE ASC-STOCK-TYPE-DESC    TO ASTKDESO.                     09950000
099600*----------------------------------------------------------------*09960000
099700* OBTAIN THE NEXT AVAILABLE REQUEST NUMBER TO CHECK AGAINST      *09970000
099800* REQUEST NUMBER BEING INSERTED.                                 *09980000
099900*----------------------------------------------------------------*09990000
100000 5100-CHECK-REQ-NBR.                                              10000000
100100     MOVE DP017-CURRENT-YMD-YYYY TO PV-CNTL-YR.                   10010000
100200     MOVE PV-CNTL-YR             TO PV-CNTL-YEAR.                 10020000
100300     PERFORM 4100-SELECT-MAX-REQ-NBR.                             10030000
100400     IF PS-NO-DB2-ERROR                                           10040000
100500         MOVE SVT00000-SHIPT-REQ-NBR TO PV-CNTL-REQ-NBR           10050000
100600         IF PV-CNTL-REQ-NBR > 0                                   10060000
100700             CONTINUE                                             10070000
100800         ELSE                                                     10080000
100900             MOVE DP017-CURRENT-YMD-YYYY TO PV-CNTL-YR            10090000
101000             ADD 1 TO PV-CNTL-REQ-NBR                             10100000
101100         END-IF                                                   10110000
101200     END-IF.                                                      10120000
101300*----------------------------------------------------------------*10130000
101400* PREPARE FIELDS FOR STORED VALUE CARD CONTROL TABLE             *10140000
101500*----------------------------------------------------------------*10150000
101600 5200-INSERT-SVT-CRD-PROD.                                        10160000
101700                                                                  10170000
101800     MOVE PV-CNTL-YR-INS         TO SVT00000-CRD-PROD-YR.         10180000
101900     MOVE PV-CNTL-REQ-NBR-INS    TO SVT00000-SHIPT-REQ-NBR.       10190000
102000     MOVE PV-CNTL-SEQ-INS        TO SVT00000-STRT-CNTL-NBR.       10200000
102100     MOVE ASC-NUMBER-REQUESTED-9 TO SVT00000-CRD-REQ-QTY          10210000
102200                                    SVT00000-END-CNTL-NBR.        10220000
102300     MOVE ASC-CARD-TYPE-9        TO SVT00000-CRD-TYP-CDE.         10230000
102400     MOVE ASC-PRODUCER           TO SVT00000-CRD-PRDR-CDE.        10240000
102500     MOVE ASC-PRE-DENOM-AMT-9    TO SVT00000-PRE-DNNTD-CRD-AMT.   10250000
102600     MOVE ASC-STOCK-TYPE-ID      TO SVT00000-CRD-STK-TYP-ID.      10260000
102700     MOVE 'PN'                   TO SVT00000-CRD-PROD-STAT-CDE.   10270000
102800     MOVE DP020-USERID           TO SVT00000-RQSTR-USR-ID.        10280000
102900     MOVE SV004-DEFAULT-DATE     TO SVT00000-CRD-EXPRN-DTE.       10290000
103000     PERFORM 5250-APPLY-INSERT-TO-TABLE.                          10300000
103100*----------------------------------------------------------------*10310000
103200* INSERT INTO THE KOHLS MERCHANDISE CARD REQUEST TABLE           *10320000
103300*----------------------------------------------------------------*10330000
103400 5250-APPLY-INSERT-TO-TABLE.                                      10340000
103500     EXEC SQL                                                     10350000
103600         INSERT INTO SVT_CRD_PROD                                 10360000
103700                (CRD_PROD_YR                                      10370000
103800                ,SHIPT_REQ_NBR                                    10380000
103900                ,STRT_CNTL_NBR                                    10390000
104000                ,END_CNTL_NBR                                     10400000
104100                ,CRD_TYP_CDE                                      10410000
104200                ,PRE_DNNTD_CRD_AMT                                10420000
104300                ,CRD_STK_TYP_ID                                   10430000
104400                ,CRD_REQ_QTY                                      10440000
104500                ,CRD_REQD_DTE                                     10450000
104600                ,CRD_REQD_TM                                      10460000
104700                ,CRD_PROD_STAT_CDE                                10470000
104800                ,RQSTR_USR_ID                                     10480000
104900                ,CRD_EXPRN_DTE                                    10490000
105000                ,CRD_PRDR_CDE)                                    10500000
105100            VALUES                                                10510000
105200                (:SVT00000-CRD-PROD-YR                            10520000
105300                ,:SVT00000-SHIPT-REQ-NBR                          10530000
105400                ,:SVT00000-STRT-CNTL-NBR                          10540000
105500                ,:SVT00000-END-CNTL-NBR                           10550000
105600                ,:SVT00000-CRD-TYP-CDE                            10560000
105700                ,:SVT00000-PRE-DNNTD-CRD-AMT                      10570000
105800                ,:SVT00000-CRD-STK-TYP-ID                         10580000
105900                ,:SVT00000-CRD-REQ-QTY                            10590000
106000                ,CURRENT DATE                                     10600000
106100                ,CURRENT TIME                                     10610000
106200                ,:SVT00000-CRD-PROD-STAT-CDE                      10620000
106300                ,:SVT00000-RQSTR-USR-ID                           10630000
106400                ,:SVT00000-CRD-EXPRN-DTE                          10640000
106500                ,:SVT00000-CRD-PRDR-CDE)                          10650000
106600     END-EXEC.                                                    10660000
106700                                                                  10670000
106800     EVALUATE TRUE                                                10680000
106900         WHEN SQLCODE = ZERO                                      10690000
107000             CONTINUE                                             10700000
107100         WHEN SQLCODE = -911                                      10710000
107200         WHEN SQLCODE = -913                                      10720000
107300             MOVE '5250-APPLY-INSERT-TO-TABLE'                    10730000
107400                                 TO DP013-PARAGRAPH               10740000
107500             MOVE 'INSERT A ROW INTO THE SV CONTROL TABLE'        10750000
107600                                 TO DP013-MESSAGE-TEXT (1)        10760000
107700             MOVE 'SVT_CRD_PROD' TO DP013-DB2-TABLE-NAME (1)      10770000
107800             MOVE SQLCA          TO DP013-SQLCA                   10780000
107900             SET DP013-LINK-RETURN                                10790000
108000                 DP013-DB2-ABEND                                  10800000
108100                 DP013-ROLLBACK  TO TRUE                          10810000
108200             PERFORM DP013-0000-PROCESS-ABEND                     10820000
108300             MOVE 'SVT_CRD_PROD' TO DP020-MSG-TEXT                10830000
108400*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           10840000
108500*----                  TRANSACTION FOR DATABASE &VAR              10850000
108600             MOVE PC-TSYMSG-00482                                 10860000
108700                                 TO DP020-MSG-NUMBER              10870000
108800             SET PS-DB2-ERROR    TO TRUE                          10880000
108900             SET DP020-MSG-WARNING                                10890000
109000                                 TO TRUE                          10900000
109100         WHEN OTHER                                               10910000
109200             MOVE '5250-APPLY-INSERT-TO-TABLE'                    10920000
109300                                   TO DP013-PARAGRAPH             10930000
109400             MOVE 'INSERT A ROW INTO THE SV CONTROL TABLE'        10940000
109500                                   TO DP013-MESSAGE-TEXT(1)       10950000
109600             MOVE SQLCA            TO DP013-SQLCA                 10960000
109700             MOVE 'SVT_CRD_PROD'   TO DP013-DB2-TABLE-NAME (1)    10970000
109800             SET DP013-DB2-ABEND                                  10980000
109900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10990000
110000             PERFORM DP013-0000-PROCESS-ABEND                     11000000
110100     END-EVALUATE.                                                11010000
110200 SKIP1                                                            11020000
110300*----------------------------------------------------------------*11030000
110400* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *11040000
110500*----------------------------------------------------------------*11050000
110600 9100-READ-SEL-QUEUE.                                             11060000
110700     EXEC CICS                                                    11070000
110800         READQ TS                                                 11080000
110900             QUEUE (ASC-SEL-QUEUE-NAME)                           11090000
111000             INTO  (SV009-SEL-REC)                                11100000
111100             ITEM  (ASC-SEL-ITEM)                                 11110000
111200             RESP  (PV-CICS-RESPONSE)                             11120000
111300     END-EXEC.                                                    11130000
111400                                                                  11140000
111500     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   11150000
111600         CONTINUE                                                 11160000
111700     ELSE                                                         11170000
111800         SET DP013-LOGIC-ABEND                                    11180000
111900             DP013-NO-ROLLBACK     TO TRUE                        11190000
112000         MOVE '9100-READ-SEL-QUEUE'                               11200000
112100                                   TO DP013-PARAGRAPH             11210000
112200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   11220000
112300                                   TO DP013-MESSAGE-TEXT (1)      11230000
112400         PERFORM DP013-0000-PROCESS-ABEND                         11240000
112500     END-IF.                                                      11250000
112600*----------------------------------------------------------------*11260000
112700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *11270000
112800*----------------------------------------------------------------*11280000
112900 9200-REWRITE-SEL-QUEUE.                                          11290000
113000     EXEC CICS                                                    11300000
113100          WRITEQ TS                                               11310000
113200              QUEUE  (ASC-SEL-QUEUE-NAME)                         11320000
113300              FROM   (SV009-SEL-REC)                              11330000
113400              ITEM   (ASC-SEL-ITEM)                               11340000
113500              RESP   (PV-CICS-RESPONSE)                           11350000
113600              REWRITE                                             11360000
113700     END-EXEC.                                                    11370000
113800                                                                  11380000
113900     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               11390000
114000         SET DP013-CICS-ABEND                                     11400000
114100             DP013-NO-ROLLBACK     TO TRUE                        11410000
114200         MOVE '9200-REWRITE-SEL-QUEUE'                            11420000
114300                                   TO DP013-PARAGRAPH             11430000
114400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   11440000
114500                                   TO DP013-MESSAGE-TEXT (1)      11450000
114600         PERFORM DP013-0000-PROCESS-ABEND                         11460000
114700     END-IF.                                                      11470000
114800                                                                  11480000
114900 EJECT                                                            11490000
115000*----------------------------------------------------------------*11500000
115100*    ABEND PROCESSOR MODULE                                      *11510000
115200*----------------------------------------------------------------*11520000
115300     COPY DPPD013.                                                11530000
115400*----------------------------------------------------------------*11540000
115500*    UPDATE DATE AND TIME                                        *11550000
115600*----------------------------------------------------------------*11560000
115700     COPY DPPD017.                                                11570000
