      ******************************************************************00000115
       IDENTIFICATION DIVISION.                                         00000215
       PROGRAM-ID.      PMKUT001.                                       00000315
       AUTHOR.          PAUL KEBER.                                     00000415
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00000515
       DATE-WRITTEN.    03/20/2009.                                     00000615
       DATE-COMPILED.                                                   00000715
      ******************************************************************00000815
      **          XS DOMAIN PRICE DETERMINATION - LPS BATCH             00000915
      ******************************************************************00001015
      ******************************************************************00002015
      * NOTE: THIS IS A COPY OF XSKUT049 WITH CHANGES TO THE            00003015
      *       2110-GET-INTR-UPC-ID ROUTINE TO USE A WORKING TABLE.      00004015
      * NOTE: THERE ARE MANY VERSIONS OF THIS PROGRAM THAT MUST BE      00004115
      *       KEPT SYNCHRONIZED.                                        00004215
      ******************************************************************00004315
      * XSKUT035 - REAL-TIME, ONE-AT-A-TIME PDE                         00004415
      *       = INITIAL PROGRAM USED BY MANY AREAS                      00004515
      * XSKUT049 - LARGE FILE BATCH PDE (BY JCL)                        00004615
      *       = COPIED FROM 035, WITH SEVERAL CHANGES. AN INPUT AND     00004715
      *         OUTPUT FILE REPLACE LINKAGE. BASIC LOGIC REMAINS THE    00004815
      *         SAME EXCEPT ALL SKUS ARE PROCESSED INTO TEMP TABLE AND  00004915
      *         THEN PROMO SQL CALLS ARE MADE.                          00005015
      * XSKUT060 - REAL-TIME PERM PDE (BY STORED PROCEDURE)             00006015
      *       = COPIED FROM 035, WITH HEAVY DELETIONS. ALL PROMO CODING 00007015
      *         HAS BEEN REMOVED. PROGRAM BASICLY RETURNS PERM INFO.    00008015
      * XSKUT061 - REAL-TIME MQSERIES/CICS PDE                          00009015
      *       = EXACT COPY OF 035, EXCEPT DFHEIBLK & XS045-COMMAREA     00010015
      *         HAVE BEEN ADDED TO THE CALL OF THE BUSINESS RULE PGM    00020015
      *         TO MAKE IT COMPATIBLE RUNNING AS A CICS PROGRAM.        00030015
      * XSKUT062 - REAL-TIME PDE (BY STORED PROCEDURE)                  00040015
      *       = COPIED FROM 035, MAIN CHANGE IS HOW IT'S COMPILED.      00050015
      ******************************************************************00060015
      ******************************************************************00061015
      * NOTE: SOME SECOND PHASE CODE IS IN THIS PROGRAM BUT COMMENTED   00062015
      *       OUT. THOSE LINES ARE IDENTIFIED W/ (P2).                  00063015
      ******************************************************************00064015
      * 06/11/03 - KARI HAAK - WR21770                                 *00065015
      * - MODIFIED THE STRUCTURE OF THE PROGRAM                        *00066015
      * - ADDED LOGIC TO HANDLE GOLDSTAR BY TICKET TYPE.               *00067015
      ******************************************************************00068015
      * 06/20/03 - KARI HAAK - WR21770                                 *00069015
      * - MODIFIED THE PROGRAM TO CHECK FOR EXCLUSIONS AFTER PRICING   *00070015
      *   IS SELECTED.  THE PROMO INTFC SUB ID IS NEEDED.              *00070115
      ******************************************************************00070215
      * 06/20/03 - KARI HAAK - WR21770                                 *00070315
      * - ADDED PROMO INTFC SUB ID TO THE EXCLUSION SELECT STATEMENTS  *00070415
      *   WHERE CLAUSES.                                               *00070515
      ******************************************************************00070615
      * 06/27/03 - KARI HAAK - WR21770                                 *00070715
      * - INITIALIZED PV-DISC-GP-QTY AND PV-DISC-PRCG-AMT AFTER        *00070815
      *   WRITING THE OUTPUT RECORD.                                   *00070915
      ******************************************************************00071015
      * 07/25/03 - KARI HAAK - WR21770                                 *00071115
      * - ADDED PARAGRAPH 2800-CLEAR-TEMP-TABLE. THE TEMP TABLE NEEDS  *00071215
      *   TO BE DELETED BEFORE PROCESSING THE NEXT BATCH OF HEADER/    *00071315
      *   DETAIL RECORDS.  OTHERWISE, SKUS FROM THE PREVIOUS HEADER/   *00071415
      *   DETAIL RECORDS WILL BE PROCESSED AGAIN.                      *00071515
      ******************************************************************00071615
      * 07/30/03 - KARI HAAK - WR21770                                 *00071715
      * - MODIFIED THE SELECT STATEMENT IN 2130-GET-UPC.  IT WILL NO   *00071815
      *   LONGER SELECT LOGICALLY DELETED ROWS (LAST_ACTN_CDE = 'D')   *00071915
      *   NOR RENUMBERED ROWS (UPC_TYP_CDE = 'R').  THE RENUMBERED     *00072015
      *   EXCLUSION IS AN EDIT CHECK OF THE UPC NUMBER BEING PASSED    *00072115
      *   INTO THIS PROGRAM.                                           *00072215
      * - ADDED FETCH FIRST ROW ONLY TO EXCLUSION MDSE QUERIES TO AID  *00072315
      *   IN PERFORMANCE TUNING.                                       *00072415
      ******************************************************************00072515
      * 08/15/03 - KARI HAAK - WR21770                                 *00072615
      * - MODIFIED 8000-POPULATE-TEMP-FILE TO MOVE XST00010-SKU-NBR    *00072715
      *   INSTEAD OF PV-SKU-NBR.  PV-SKU-NBR IS NOT ALWAYS POPULATED,  *00072815
      *   SO WE WEREN'T PICKING UP ALL THE SKU LEVEL PRICING.          *00072915
      ******************************************************************00073015
      * 08/22/03 - KARI HAAK - P000578679                              *00073115
      * - MODIFIED THE PARTIAL DAY TIME COMPARISON.  THE TIME HAD A    *00073215
      *   COLON BETWEEN THE HOUR AND MINUTES AND IT SHOULD HAVE BEEN   *00073315
      *   A PERIOD.                                                    *00073415
      ******************************************************************00073515
      * 08/26/03 - KARI HAAK - WR21770                                 *00073615
      * - MODIFIED THE PROGRAM TO INCLUDE THE MERCHANDISE LINE ID IN   *00073715
      *   THE OUTPUT FILE.  IT WILL ALLOW REPORTS TO GET A DETAILED    *00073815
      *   DESCRIPTION OF THE PROMOTION.                                *00073915
      * - ALSO ADDED FIELD XS042-BWP-PROMO-INTFC-ID, ALTHOUGH IT WILL  *00074015
      *   NOT CONTAIN A VALUE OTHER THAN ZEROES UNTIL PHASE TWO.       *00074115
      ******************************************************************00074215
      * 09/13/03 - KARI HAAK - WR21770                                 *00074315
      * - MODIFIED THE PROGRAM TO HANDLE GBL PRICING TYPE CODES, WHICH *00074415
      *   ARE BOGO (BUY ONE GET ONE FREE).                             *00074515
      * - ADDED CODE TO POPULATE DATE, TIME, AND PROMO ID ON XSRD042.  *00074615
      ******************************************************************00074715
      * 11/11/03 - KARI HAAK - P000604904                              *00074815
      * - MODIFIED THE NOID CURSORS TO SUBTRACT AND ADD 3 DAYS TO/FROM *00074915
      *   THE PROMO DEFAULT START AND END TIMESTAMP INSTEAD OF 7 DAYS. *00075015
      *   THIS WILL LIMIT THE NUMBER OF ROWS BEING RETURNED FROM THE   *00076015
      *   CURSOR AND HELP PERFORMANCE.                                 *00076115
      ******************************************************************00076215
      * 12/31/03 - KARI HAAK - WR25854                                 *00076315
      * - ADDED PRICING TYPE CODE OF GBD, GROUP BOGO DOLLAR, AND GBP,  *00076415
      *   GROUP BOGO PERCENT.                                          *00076515
      * - ALSO ADDED DISPLAYS TO TELL WHICH CURSOR IS BEING PROCESSED. *00076615
      *   OTHER TEAMS HAVE REQUESTED THE DISPLAYS.                     *00076715
      * - ADDED LOGIC TO ALLOW AN EMPTY FILE TO PROCESS WITHOUT        *00076815
      *   ABENDING.                                                    *00076915
      ******************************************************************00077015
      * 07/13/04 - SCOTT BARTELT - WR27032                             *00077115
      * - ADDED LOGIC TO INCORPORATE XST_CLR_PRCHG(FUTURE RED TICKET   *00077215
      *   TABLE).                                                      *00077315
      ******************************************************************00077415
      *  01/12/2005     JIM ARENDT    WR27018                          *00077515
      *  -  CHANGED PROGRAM FOR CONVERSION TO NEW PERM.  REPLACED DB2  *00077615
      *     TABLE XST_CHG_EVNT AND XST_CHG_EVNT_DTL WITH XST_PRCHG,    *00077715
      *     XST_STR_GP_PRCHG AND XST_PRCHG_MDSE.                       *00077815
      ******************************************************************00077915
      *  03/29/2005     JIM ARENDT    WR27018                          *00078015
      *  -  CHANGED FUT-PERM-EVNTS-CSR TO ONLY RETURN MERCHANDISE AT A *00078115
      *    'SKU' LEVEL FOR THE FIRST PART OF THE UNION.                *00078215
      ******************************************************************00078315
      * 04/11/05 - JIM ARENDT    - WR27018                             *00078415
      * CHANGED PROGRAM TO HANDLE PERM CONTINUED CLEARANCE MERCHANDISE.*00078515
      ******************************************************************00078615
      * 05/26/05 - KARI HAAK     - P000759636                          *00078715
      * - REMOVED THE CONTINUED CLEARANCE PIECE OF THE FUT-PERM-EVNTS- *00078815
      *   CSR.  THERE ARE NOW FIVE SEPARATE CURSORS, ONE FOR EACH      *00078915
      *   LEVEL OF THE MDSE HIERARCHY, TO HANDLE CONTINUED CLEARANCE.  *00079015
      *   THE CURSORS WERE BROKEN UP TO IMPROVE PERFORMANCE.           *00079115
      * - MODIFIED THE LOGIC THAT HANDLES PERM EVENTS.                 *00079215
      ******************************************************************00079315
      * 05/27/05 - KARI HAAK     - P000759636                          *00079415
      * - MODIFIED THE LOGIC SO THE PROGRAM ONLY CHECKS FOR CONTINUED  *00079515
      *   CLEARANCE IF THE ITEM CURRENTLY HAS A YELLOW OR RED TICKET   *00079615
      *   OR IF THE ITEM JUST HAD A YELLOW TICKET APPLIED.             *00079715
      ******************************************************************00079815
      * 05/27/05 - KARI HAAK     - P000759636                          *00079915
      * - MADE THE FUT-PERM-EVNTS-CSR A SELECT STATEMENT AND REMOVED   *00080015
      *   THE ORDER BY ON THE PRICE CHANGE EFFECTIVE DATE.             *00080115
      ******************************************************************00080215
      * 07/06/05 - KARI HAAK     - P000759636                          *00080315
      * - REMOVED XST_VND_STYL FROM THE PROMO STYLE CURSORS, AS THE    *00080415
      *   STYLE'S HIERARCHY NO LONGER NEEDS TO BE CHECKED.             *00080515
      * - ADDED THE PV-HOST-VAR-DTE PREDICATE TO THE FUT-CNTCLR-SKU-CSR*00080615
      ******************************************************************00080715
      * 09/04/05 - KARI HAAK     - P000797593                          *00080815
      * - PROGRAM WAS ABENDING WHEN CONTINUED CLEARANCE ITEMS HAD A    *00080915
      *   UNIT RETAIL THAT DID NOT FALL WITHIN THE PRICING GRID.  NOW  *00081015
      *   SETTING A SWITCH THAT MARKS THE EVENT INVALID FOR THESE SKUS *00081115
      ******************************************************************00081215
      * 09/22/05 - MINDY LUCAS   - P000804145                          *00081315
      * - CHANGED ALL QUERIES THAT ARE QUERYING FOR PRICE CHANGES >=   *00081415
      *   CURRENT DATE, BECAUSE THEY COULD RETURN MULTIPLE ROWS.       *00081515
      ******************************************************************00081615
      * 09/23/05 - KARI HAAK     - WR28048                             *00081715
      * - CHANGES FOR SAS YELLOW TO YELLOW TICKET                      *00081815
      ******************************************************************00081915
W36026* 02/03/09 - PAUL KEBER    - WR36026                             *00082015
W36026* - ADDED JIM ARENDT'S 2620- ROUTINE SQL CHANGE THAT IS IN PROD  *00082115
W36026*   AND REMOVED HIS DISPLAYS. ADDED TIMESTAMP DISPLAYS. CHANGE   *00082215
W36026*   TO USE A DECLARED GLOBAL TEMPORARY TABLE (GTT_PRIC_DTRMN)    *00082315
W36026*   WITH TWO INDICES INSTEAD OF XSTT_PRIC_DTRMN. COMMENTED OUT   *00082415
W36026*   OBSOLETE 2900-CHECK-FOR-FUT-CNTCLR ROUTINE CALL AND ALL ITS  *00082515
W36026*   CALLS. REMOVED XST_STR_GP_MBSHP COLUMN > 0 CHECKS FROM THE   *00082615
W36026*   STD-STORE-GRP-CSR CURSOR IN ORDER TO IMPROVE PERFORMANCE.    *00082715
      ******************************************************************00082815
W36026* 03/20/09 - PAUL KEBER    - WR36026                              00082915
W36026* - THIS IS A NEW PROGRAM COPY FROM XSKUT049.  REPLACED THE       00083015
W36026*   2110-GET-INTR-UPC-ID CALL WITH A SELECT OF WORKING TABLE      00083115
W36026*   PMTW_CORP_SKU.  REPLACED THE 2620-SELECT-FUT-PERM-EVNT CALL   00083215
W36026*   WITH A SELECT OF WORKING TABLE PMTW_PERM_SKU AND ADDED LOGIC  00083315
W36026*   TO HANDLE A -811 SQL CODE.                                    00083415
      ******************************************************************00083515
218082* 02/18/19 - JIM ARENDT    - CHG0218082                           00083617
218082* - AS PART OF THE DELOITTE REFACTOR PROJECT, COMMENTED OUT CODE  00083717
218082*   IN 2850-CREATE-TEMP-TABLE THAT DEFINES THE SIZE OF THE INDEX. 00083817
      ******************************************************************00084316
228316***************************************************************** 00084420
243397* DATE:   APRIL 28 2020                                           00084520
243397* CHANGE: CHG0243397                                              00084620
243397* PROGRAMMER: GERMAN BANDA                                        00084720
243397* DESCRIPTION: IN 2850-CREATE-TEMP-TABLE                          00084820
243397*    ADDED NOT LOGGED ON ROLLBACK DELETE ROWS TO REDUCE THE       00084920
243397*    NUMBER OF LOG RECORDS TO DB2                                 00085020
243397***************************************************************** 00085120
       ENVIRONMENT DIVISION.                                            00085215
       CONFIGURATION SECTION.                                           00085315
       SOURCE-COMPUTER. IBM-3090.                                       00085415
       OBJECT-COMPUTER. IBM-3090.                                       00085515
                                                                        00085615
       INPUT-OUTPUT SECTION.                                            00085715
       FILE-CONTROL.                                                    00085815
                                                                        00085915
           SELECT PD-INPUT-FILE                                         00086015
               ASSIGN               TO INP01.                           00086115
                                                                        00086215
           SELECT PD-OUTPUT-FILE                                        00086315
               ASSIGN               TO OUT01.                           00086415
                                                                        00086515
       DATA DIVISION.                                                   00086615
       FILE SECTION.                                                    00086715
                                                                        00086815
       FD  PD-INPUT-FILE                                                00086915
           RECORDING MODE V                                             00087015
           BLOCK CONTAINS 0 RECORDS                                     00087115
           LABEL RECORDS ARE STANDARD                                   00087215
           RECORD CONTAINS 38 TO 44 CHARACTERS.                         00087315
       01  PD-INPUT-HEADER-REC             PIC  X(38).                  00087415
       01  PD-INPUT-DETAIL-REC             PIC  X(44).                  00087515
                                                                        00087615
       FD  PD-OUTPUT-FILE                                               00087715
           RECORDING MODE V                                             00087815
           BLOCK CONTAINS 0 RECORDS                                     00087915
           LABEL RECORDS ARE STANDARD                                   00088015
           RECORD CONTAINS 66 TO 361 CHARACTERS.                        00088115
       01  PD-OUTPUT-HEADER-REC            PIC  X(66).                  00088215
       01  PD-OUTPUT-DETAIL-REC            PIC  X(361).                 00088315
                                                                        00088415
                                                                        00088515
       WORKING-STORAGE SECTION.                                         00088615
      ******************************************************************00088715
      * PROGRAM SWITCHES                                                00088815
      ******************************************************************00088915
       01  PS-PROGRAM-SWITCHES.                                         00089015
      * USED TO DETERMINE IF MDSE IS FOUND OR NOT                       00089115
           05  PS-MDSE-FOUND-SW            PIC  X(01)  VALUE 'Y'.       00089215
               88  PS-MDSE-FOUND                       VALUE 'Y'.       00089315
               88  PS-MDSE-NOT-FOUND                   VALUE 'N'.       00089415
      * USED TO DETERMINE IF REGIONAL CLEARANCE IS FOUND OR NOT         00089515
           05  PS-REG-CLEAR-FOUND-SW       PIC  X(01)  VALUE 'Y'.       00089615
               88  PS-REG-CLEAR-FOUND                  VALUE 'Y'.       00089715
               88  PS-REG-CLEAR-NOT-FOUND              VALUE 'N'.       00089815
      * USED TO DETERMINE IF SIMPLE PRICE WAS FOUND                     00089915
           05  PS-SIMPLE-PRICE-SW          PIC  X(01)  VALUE 'Y'.       00090015
               88  PS-SIMPLE-PRICE-FOUND               VALUE 'Y'.       00090115
               88  PS-SIMPLE-PRICE-NOT-FOUND           VALUE 'N'.       00090215
      * USED TO DETERMINE IF GROUP PRICE WAS FOUND                      00090315
           05  PS-GROUP-PRICE-SW           PIC  X(01)  VALUE 'Y'.       00090415
               88  PS-GROUP-PRICE-FOUND                VALUE 'Y'.       00090515
               88  PS-GROUP-PRICE-NOT-FOUND            VALUE 'N'.       00090615
      * USED TO DETERMINE IF FETCHING NEXT BASE RECORD IS NEEDED        00090715
           05  PS-FETCH-NEXT-SW            PIC  X(01)  VALUE 'Y'.       00090815
               88  PS-FETCH-NEXT                       VALUE 'Y'.       00090915
               88  PS-DONT-FETCH-NEXT                  VALUE 'N'.       00091015
      * USED TO DETERMINE IF AN EXCLUSION IS FOUND                      00091115
           05  PS-EXCL-FOUND-SW            PIC  X(01)  VALUE 'Y'.       00091215
               88  PS-EXCL-FOUND                       VALUE 'Y'.       00091315
               88  PS-NO-EXCL-FOUND                    VALUE 'N'.       00091415
      * USED TO DETERMINE IF AN EXCLUSION EXISTS                        00091515
           05  PS-EXCL-EXIST-SW            PIC  X(01)  VALUE 'Y'.       00091615
               88  PS-EXCL-EXISTS                      VALUE 'Y'.       00091715
               88  PS-NO-EXCL-EXISTS                   VALUE 'N'.       00092015
      * USED TO DETERMINE IF A STORE IS FOUND                           00093015
           05  PS-STORE-FOUND-SW           PIC  X(01)  VALUE 'Y'.       00094015
               88  PS-STORE-FOUND                      VALUE 'Y'.       00095015
               88  PS-NO-STORE-FOUND                   VALUE 'N'.       00096015
      * PROMO HIERARCY CODES...                                         00097015
           05  PS-MDSE-HIER-CDE            PIC  X(03)  VALUE '   '.     00098015
               88  PS-HIER-DPT-CDE                     VALUE 'DPT'.     00099015
               88  PS-HIER-MCL-CDE                     VALUE 'MCL'.     00100015
               88  PS-HIER-SCL-CDE                     VALUE 'SCL'.     00110015
               88  PS-HIER-STY-CDE                     VALUE 'STY'.     00120015
               88  PS-HIER-SKU-CDE                     VALUE 'SKU'.     00130015
           05  PS-END-OF-CURSOR-SW         PIC  X(01)  VALUE 'Y'.       00140015
               88  PS-END-OF-CSR                       VALUE 'N'.       00150015
               88  PS-NOT-EOF-CSR                      VALUE 'Y'.       00160015
           05  PS-END-OF-CONCLR-CSR-SW     PIC  X(01)  VALUE 'Y'.       00170015
               88  PS-END-OF-CONCLR-CSR                VALUE 'N'.       00180015
               88  PS-NOT-END-OF-CONCLR-CSR            VALUE 'Y'.       00190015
W36026***  05  PS-FUT-RED-EVNT-FOUND-SW    PIC  X(01)  VALUE 'N'.       00200015
W36026***      88  PS-FUT-RED-EVNT-FOUND               VALUE 'Y'.       00210015
W36026***      88  PS-FUT-RED-EVNT-NOT-FOUND           VALUE 'N'.       00220015
           05  PS-FUT-PERM-EVNT-FOUND-SW   PIC  X(01)  VALUE 'N'.       00230015
               88  PS-FUT-PERM-EVNT-FOUND              VALUE 'Y'.       00240015
               88  PS-FUT-PERM-EVNT-NOT-FOUND          VALUE 'N'.       00250015
           05  PS-END-OF-TIER-CSR-SW       PIC  X(01)  VALUE 'Y'.       00250115
               88  PS-NOT-END-OF-TIER-CSR              VALUE 'Y'.       00250215
               88  PS-END-OF-TIER-CSR                  VALUE 'N'.       00250315
           05  PS-END-OF-FILE-SW           PIC  X(01)  VALUE 'N'.       00250415
               88  PS-END-OF-FILE                      VALUE 'Y'.       00250515
               88  PS-NOT-END-OF-FILE                  VALUE 'N'.       00250615
           05  PS-FIRST-TIER-ROW-SW        PIC  X(01)  VALUE 'Y'.       00250715
               88  PS-FIRST-TIER-ROW                   VALUE 'Y'.       00250815
               88  PS-NOT-FIRST-TIER-ROW               VALUE 'N'.       00250915
      * USED TO DETERMINE THE TICKET COLOR OF AN ITEM BEFORE LOOKING    00251015
      * FOR FUTURE PRICE OR STATUS CHANGES                              00252015
           05  PS-ITEM-TKT-CLOR-CDE-SW     PIC  X(01)  VALUE ' '.       00253015
               88  PS-WHITE-TKT-ITEM                   VALUE 'W'.       00254015
               88  PS-YELLOW-TKT-ITEM                  VALUE 'Y'.       00255015
               88  PS-RED-TKT-ITEM                     VALUE 'R'.       00256015
      * USED TO DETERMINE IF A FUTURE PRICE CHANGE HAS BEEN APPLIED     00257015
           05  PS-ITEM-TKT-CLOR-CDE-SW     PIC  X(01)  VALUE ' '.       00258015
               88  PS-NO-PRICE-CHG-APPLIED             VALUE ' '.       00259015
               88  PS-WHITE-TKT-APPLIED                VALUE 'W'.       00260015
               88  PS-YELLOW-TKT-APPLIED               VALUE 'Y'.       00270015
               88  PS-RED-TKT-APPLIED                  VALUE 'R'.       00271015
      * USED TO DETERMINE IF THE FUTURE PERM CHANGE SHOULD BE APPLIED   00272015
           05  PS-VALID-FUT-TKT-EVNT-SW    PIC  X(01)  VALUE SPACES.    00273015
               88  PS-VALID-FUT-TKT-EVNT               VALUE 'Y'.       00274015
               88  PS-INVALID-FUT-TKT-EVNT             VALUE 'N'.       00275015
                                                                        00276015
      ******************************************************************00277015
      * HOLD AREAS FOR THE HEADER RECORD                                00278015
      ******************************************************************00279015
       01  PV-PREV-HEADER-RECORD           PIC  X(38)  VALUE SPACES.    00280015
       01  PV-NEXT-HEADER-RECORD           PIC  X(38)  VALUE SPACES.    00290015
                                                                        00300015
      ******************************************************************00310015
      * COMPARE AREAS FOR THE HEADER AND DETAIL RECORDS.                00320015
      ******************************************************************00330015
       01  PV-COMPARE-HEADER.                                           00340015
           05  PV-CH-STORE                 PIC S9(04)  COMP             00350015
                                                       VALUE ZEROES.    00360015
           05  PV-CH-DATE                  PIC  X(10)  VALUE SPACES.    00370015
           05  PV-CH-TIME                  PIC  X(08)  VALUE SPACES.    00380015
           05  PV-CH-PROMO-ID              PIC S9(10)V COMP-3           00390015
                                                       VALUE ZEROES.    00400015
                                                                        00410015
       01  PV-COMPARE-DETAIL.                                           00420015
           05  PV-CD-STORE                 PIC S9(04)  COMP             00430015
                                                       VALUE ZEROES.    00440015
           05  PV-CD-DATE                  PIC  X(10)  VALUE SPACES.    00450015
           05  PV-CD-TIME                  PIC  X(08)  VALUE SPACES.    00460015
           05  PV-CD-PROMO-ID              PIC S9(10)V COMP-3           00470015
                                                       VALUE ZEROES.    00480015
                                                                        00490015
      ******************************************************************00500015
      * TIMESTAMP VARIABLES                                             00501015
      ******************************************************************00502015
       01  TS-TIMESTAMP                    PIC  X(26)  VALUE SPACES.    00503015
       01  FILLER REDEFINES TS-TIMESTAMP.                               00504015
           05  TS-DATE                     PIC  X(10).                  00505015
           05  FILLER                      PIC  X(01).                  00506015
           05  TS-HOUR                     PIC  X(02).                  00507015
           05  FILLER                      PIC  X(01).                  00508015
           05  TS-MINUTE                   PIC  X(02).                  00509015
           05  FILLER                      PIC  X(01).                  00510015
           05  TS-SECOND                   PIC  X(02).                  00520015
           05  FILLER                      PIC  X(01).                  00530015
           05  TS-MICROSEC                 PIC  X(06).                  00540015
                                                                        00550015
      ******************************************************************00560015
      * PROGRAM CONSTANTS                                               00570015
      ******************************************************************00580015
       01  PC-PROGRAM-CONSTANTS.                                        00590015
           05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)  VALUE 'PMKUT001'.00590115
           05  PC-ALL-TICKET               PIC  X(01)  VALUE 'A'.       00590215
           05  PC-YELLOW-TICKET            PIC  X(01)  VALUE 'F'.       00590315
           05  PC-RED-TICKET               PIC  X(01)  VALUE 'C'.       00590415
           05  PC-ZERO-TIME                PIC  X(08)  VALUE '00.00.00'.00590515
                                                                        00590615
      ******************************************************************00590715
      * PROGRAM VARIBLES                                                00590815
      ******************************************************************00590915
       01  PV-PROGRAM-VARIBLES.                                         00591015
           05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00591115
W36026     05  PV-CURRENT-TIMESTAMP        PIC  X(26)  VALUE SPACES.    00591215
           05  PV-OPERATION-MSG-1          PIC  X(40)  VALUE SPACES.    00591315
           05  PV-OPERATION-MSG-2          PIC  X(40)  VALUE SPACES.    00591415
           05  PV-ADV-CDE-NULL-IND         PIC S9(04)  VALUE +0         00591515
                                                       COMP SYNC.       00591615
           05  PV-GP-RTL-QTY-NULL-IND      PIC S9(04)  VALUE +0         00591715
                                                       COMP SYNC.       00591815
           05  PV-GP-RTL-AMT-NULL-IND      PIC S9(04)  VALUE +0         00591915
                                                       COMP SYNC.       00592015
           05  PV-UNT-RTL-AMT-NULL-IND     PIC S9(04)  VALUE +0         00593015
                                                       COMP SYNC.       00594015
           05  PV-STR                      PIC S9(04)  COMP VALUE 0.    00595015
           05  PV-DT                       PIC  X(10)  VALUE SPACES.    00596015
           05  PV-DATE REDEFINES PV-DT.                                 00597015
               10  PV-DATE-CC              PIC  X(02).                  00598015
               10  PV-DATE-YY              PIC  X(02).                  00599015
               10  PV-DATE-HY1             PIC  X(01).                  00600015
               10  PV-DATE-MM              PIC  X(02).                  00610015
               10  PV-DATE-HY2             PIC  X(01).                  00620015
               10  PV-DATE-DD              PIC  X(02).                  00630015
           05  PV-TM                       PIC  X(08).                  00640015
           05  PV-TIME REDEFINES PV-TM.                                 00650015
               10  PV-TIME-HH              PIC  X(02).                  00660015
               10  PV-TIME-CO1             PIC  X(01).                  00670015
               10  PV-TIME-MM              PIC  X(02).                  00680015
               10  PV-TIME-CO2             PIC  X(01).                  00690015
               10  PV-TIME-SS              PIC  X(02).                  00700015
                                                                        00710015
      ******************************************************************00720015
      *    PV-HOST-VAR-DTE CREATED ON RECOMMENDATION OF DBA TO OBTAIN   00730015
      *    AN ACCEPTABLE ACCESS PATH                                    00740015
           05  PV-HOST-VAR-DTE             PIC  X(10)  VALUE            00750015
               '0001-01-01'.                                            00760015
      ******************************************************************00770015
                                                                        00780015
           05  PV-PROMO-ID                 PIC S9(10)V COMP-3 VALUE 0.  00790015
           05  PV-PROMO-INTFC-SUB-ID       PIC S9(10)V COMP-3 VALUE 0.  00800015
           05  PV-INTR-UPC-ID              PIC S9(09)  COMP   VALUE 0.  00801015
           05  PV-SKU                      PIC S9(08)  COMP-3 VALUE 0.  00802015
           05  PV-UPC                      PIC S9(15)  COMP-3 VALUE 0.  00803015
           05  PV-UPC-16                   PIC S9(16)  COMP-3 VALUE 0.  00804015
           05  PV-DISC-GP-QTY              PIC S9(04)  COMP   VALUE 0.  00805015
           05  PV-DISC-PRCG-AMT            PIC S9(07)V9(03)   COMP-3    00806015
                                                              VALUE 0.  00807015
           05  PV-EXCL-EXISTS              PIC S9(04)  COMP SYNC        00808015
                                                       VALUE ZEROES.    00809015
           05  PV-FUT-PERM-STATUS-CDE      PIC  X(02)  VALUE SPACES.    00810015
                                                                        00820015
           05  PV-PROMO-STRT-TMST          PIC  X(26)  VALUE SPACES.    00830015
           05  PV-STRT-TMST REDEFINES PV-PROMO-STRT-TMST.               00840015
               10  PV-STRT-DT              PIC  X(10).                  00850015
               10  FILLER                  PIC  X(01).                  00851015
               10  PV-STRT-TM.                                          00851115
                   15  PV-STRT-TM-HM       PIC  X(05).                  00851215
                   15  FILLER              PIC  X(01).                  00851315
                   15  PV-STRT-TM-SC       PIC  X(02).                  00851415
               10  FILLER                  PIC  X(01).                  00851515
               10  PV-STRT-SS              PIC  X(06).                  00851615
                                                                        00851715
           05  PV-PROMO-END-TMST           PIC  X(26)  VALUE SPACES.    00851815
           05  PV-END-TMST REDEFINES PV-PROMO-END-TMST.                 00851915
               10  PV-END-DT               PIC  X(10).                  00852015
               10  FILLER                  PIC  X(01).                  00852115
               10  PV-END-TM.                                           00852215
                   15  PV-END-TM-HM        PIC  X(05).                  00852315
                   15  FILLER              PIC  X(01).                  00852415
                   15  PV-END-TM-SC        PIC  X(02).                  00852515
               10  FILLER                  PIC  X(01).                  00852615
               10  PV-END-SS               PIC  X(06).                  00852715
                                                                        00852815
           05  PV-FULL-TMST                PIC  X(26)  VALUE SPACES.    00852915
           05  PV-TMST  REDEFINES PV-FULL-TMST.                         00853015
               10  PV-TMST-DATE            PIC  X(10).                  00854015
               10  PV-TMST-HYPHEN1         PIC  X(01).                  00855015
               10  PV-TMST-TIME            PIC  X(08).                  00856015
               10  PV-TMST-DOT1            PIC  X(01).                  00857015
               10  PV-TMST-SUBS            PIC  X(06).                  00858015
           05  PV-CONTCLR-PRCHG-EFF-DTE    PIC  X(10)  VALUE SPACES.    00859015
                                                                        00860015
       01  PV-INPUT-RECORD.                                             00870015
           05  PV-INPUT-RECORD-TYPE        PIC  X(01)  VALUE SPACES.    00871015
           05  FILLER                      PIC  X(45)  VALUE SPACES.    00872015
                                                                        00873015
       01  HV-PGM-HOLD-VARIBLES.                                        00874015
           05  HV-UNT-RTL-AMT              PIC S9(07)V9(02) COMP-3      00875015
                                                       VALUE ZEROES.    00876015
           05  HV-GP-RTL-QTY               PIC 9(05)   VALUE ZEROES.    00877015
           05  HV-GP-RTL-AMT               PIC 9(07)V9(02) VALUE ZEROES.00878015
           05  HV-LOC-SKU-STAT-CDE         PIC X(02)   VALUE SPACES.    00879015
           05  HV-UNT-RTL-CHG-DTE          PIC X(10)   VALUE SPACES.    00880015
           05  HV-UPC-STAT-CHG-DTE         PIC X(10)   VALUE SPACES.    00890015
                                                                        00900015
      ******************************************************************00910015
      * PA PROGRAM ACCUMULATORS                                        *00920015
      ******************************************************************00921015
       01  PA-PROGRAM-ACCUMULATORS.                                     00922015
           05  PA-HEADER-RECS-READ         PIC S9(11)  COMP-3           00923015
                                                       VALUE ZEROES.    00924015
           05  PA-DETAIL-RECS-READ         PIC S9(11)  COMP-3           00925015
                                                       VALUE ZEROES.    00926015
           05  PA-HEADER-RECS-WRITTEN      PIC S9(11)  COMP-3           00927015
                                                       VALUE ZEROES.    00928015
           05  PA-DETAIL-RECS-WRITTEN      PIC S9(11)  COMP-3           00929015
                                                       VALUE ZEROES.    00930015
           05  PA-TEMP-ROWS-INSERTED       PIC S9(11)  COMP-3           00940015
                                                       VALUE ZEROES.    00950015
W36026**   05  PA-FUT-CNTCLR-CSR-CALLS     PIC S9(11)  COMP-3           00960015
W36026**                                               VALUE ZEROES.    00970015
W36026     05  PA-FUT-PERM-FOUND           PIC S9(11)  COMP-3           00971015
W36026                                                 VALUE ZEROES.    00972015
                                                                        00973015
      ******************************************************************00974015
      * ABEND CODE VALUES                                              *00975015
      ******************************************************************00976015
       01  ABEND-CODE                      PIC S9(04)  COMP VALUE +0.   00977015
           88  ABEND-4001-WRITE-ERROR                  VALUE +4001.     00978015
           88  ABEND-4002-READ-ERROR                   VALUE +4002.     00979015
           88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.     00980015
           88  ABEND-4004-TABLE-ERROR                  VALUE +4004.     00990015
           88  ABEND-4005-OPEN-ERROR                   VALUE +4005.     00991015
           88  ABEND-4006-CLOSE-ERROR                  VALUE +4006.     00992015
           88  ABEND-4007-SEQUENCE-ERROR               VALUE +4007.     00993015
           88  ABEND-4008-DATA-ERROR                   VALUE +4008.     00994015
           88  ABEND-4009-KEY-DATA-ERROR               VALUE +4009.     00995015
           88  ABEND-4013-DB2-ERROR                    VALUE +4013.     00996015
           88  ABEND-4019-DATE-ROUTINE-ERROR           VALUE +4019.     00997015
           88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     00998015
                                                                        00999015
      ******************************************************************01000015
      * COPYBOOKS                                                       01010015
      ******************************************************************01020015
                                                                        01030015
      ***PD BATCH OUTPUT - HEADER COPYBOOK                              01040015
           COPY XSRD043.                                                01050015
                                                                        01060015
      ***PD BATCH OUTPUT - DETAIL COPYBOOK                              01070015
           COPY XSRD042.                                                01080015
                                                                        01081015
      ***PD BATCH INPUT - HEADER COPYBOOK                               01082015
           COPY XSRD050.                                                01083015
                                                                        01084015
      ***PD BATCH INPUT - DETAIL COPYBOOK                               01085015
           COPY XSRD051.                                                01086015
                                                                        01087015
      ***VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        01088015
           COPY DPWS004.                                                01089015
                                                                        01090015
      ***DB2 MESSAGE AREA                                               01100015
           COPY SQLCA2.                                                 01110015
                                                                        01120015
      ******************************************************************01130015
      * TABLE INCLUSIONS                                                01140015
      ******************************************************************01150015
           EXEC SQL INCLUDE SQLCA    END-EXEC.                          01160015
                                                                        01170015
      *  XST_MDSE_LNE_SELN TABLE                                        01180015
           EXEC SQL INCLUDE XST00028 END-EXEC.                          01181015
                                                                        01182015
      *  XST_PROMO TABLE                                                01183015
           EXEC SQL INCLUDE XST00026 END-EXEC.                          01184015
                                                                        01185015
      *  XST_SKU TABLE                                                  01186015
           EXEC SQL INCLUDE XST00010 END-EXEC.                          01187015
                                                                        01188015
      *  XST_SKU_LOC TABLE                                              01189015
           EXEC SQL INCLUDE XST00008 END-EXEC.                          01190015
                                                                        01200015
      *  XST_UPC TABLE                                                  01210015
           EXEC SQL INCLUDE XST00012 END-EXEC.                          01220015
                                                                        01230015
      *  XST_VND_STYL TABLE                                             01240015
           EXEC SQL INCLUDE XST00013 END-EXEC.                          01250015
                                                                        01251015
      *  XST_TIER_PRICG TABLE                                           01252015
           EXEC SQL INCLUDE XST00035 END-EXEC.                          01253015
                                                                        01254015
      *  XST_SMP_PRICG TABLE                                            01255015
           EXEC SQL INCLUDE XST00030 END-EXEC.                          01256015
                                                                        01257015
      *  XST_EXCL_MDSE TABLE                                            01258015
           EXEC SQL INCLUDE XST00034 END-EXEC.                          01259015
                                                                        01260015
      *  XST_PROMO_ADHC_RLT TABLE                                       01270015
           EXEC SQL INCLUDE XST00031 END-EXEC.                          01280015
                                                                        01290015
      *  XST_ADHC_STR_GP TABLE                                          01300015
           EXEC SQL INCLUDE XST00036 END-EXEC.                          01310015
                                                                        01320015
      *  XST_PROMO_ADHC_STR TABLE                                       01330015
           EXEC SQL INCLUDE XST00033 END-EXEC.                          01340015
                                                                        01341015
      * XST_PRCHG TABLE                                                 01342015
           EXEC SQL INCLUDE XST00063 END-EXEC.                          01343015
                                                                        01344015
      * XST_STR_GP_PRCHG TABLE                                          01345015
           EXEC SQL INCLUDE XST00064 END-EXEC.                          01346015
                                                                        01347015
      * XST_PRICG_GRID_DTL TABLE                                        01348015
           EXEC SQL INCLUDE XST00085 END-EXEC.                          01349015
                                                                        01350015
      * XST_PRCHG_MDSE TABLE                                            01360015
           EXEC SQL INCLUDE XST00065 END-EXEC.                          01370015
                                                                        01380015
      * XST_STR_GP_MBSHP TABLE                                          01390015
           EXEC SQL INCLUDE XST00023 END-EXEC.                          01400015
                                                                        01410015
      * XST_PROMO_STR_GP TABLE                                          01420015
           EXEC SQL INCLUDE XST00029 END-EXEC.                          01430015
                                                                        01440015
W36026******************************************************************01450015
W36026* COBOL DECLARATION FOR TABLE GTT_PRIC_DTRMN                      01460015
W36026******************************************************************01461015
W36026 01  GTTPRICD.                                                    01462015
W36026     10 GTTPRICD-SKU-NBR              PIC  S9(8)V COMP-3.         01463015
W36026     10 GTTPRICD-STYL-ID              PIC  S9(8)V COMP-3.         01464015
W36026     10 GTTPRICD-INTR-UPC-ID          PIC  S9(9) COMP.            01465015
W36026     10 GTTPRICD-UNT-RTL-AMT          PIC  S9(7)V9(2) COMP-3.     01466015
W36026     10 GTTPRICD-GP-RTL-QTY           PIC  S9(4) COMP.            01467015
W36026     10 GTTPRICD-GP-RTL-AMT           PIC  S9(7)V9(2) COMP-3.     01468015
W36026     10 GTTPRICD-LOC-SKU-STAT-CDE     PIC   X(2).                 01469015
W36026     10 GTTPRICD-UPC-NBR              PIC  S9(15)V COMP-3.        01469115
W36026     10 GTTPRICD-UPC-STAT-CHG-DTE     PIC   X(10).                01469215
W36026     10 GTTPRICD-UNT-RTL-CHG-DTE      PIC   X(10).                01469315
                                                                        01469415
W36026******************************************************************01469515
W36026* DCLGEN TABLE(PMTW_CORP_SKU)                                    *01469615
W36026******************************************************************01469715
W36026     EXEC SQL DECLARE PMTW_CORP_SKU TABLE                         01469815
W36026     ( INTR_UPC_ID        INTEGER         NOT NULL                01469915
W36026      ,BEG_TMST           TIMESTAMP       NOT NULL                01470015
W36026      ,END_TMST           TIMESTAMP                               01480015
W36026      ,UNT_RTL_AMT        DECIMAL(009, 2) NOT NULL                01490015
W36026      ,LOC_SKU_STAT_CDE   CHAR(0002)      NOT NULL                01500015
W36026      ,GP_RTL_QTY         SMALLINT                                01510015
W36026      ,GP_RTL_AMT         DECIMAL(009, 2)                         01520015
W36026      ,UNT_RTL_CHG_DTE    DATE            NOT NULL                01530015
W36026      ,UPC_STAT_CHG_DTE   DATE            NOT NULL                01540015
W36026      ,SKU_NBR            DECIMAL(008, 0) NOT NULL                01541015
W36026      ,STYL_ID            DECIMAL(008, 0) NOT NULL                01542015
W36026      ,REGN_PRIC_IND      CHAR(0001)      NOT NULL                01543015
W36026      ,DEPT_NBR           DECIMAL(004, 0) NOT NULL                01544015
W36026      ,MAJ_CL_NBR         DECIMAL(004, 0) NOT NULL                01545015
W36026      ,SUB_CL_NBR         DECIMAL(004, 0) NOT NULL                01546015
W36026     ) END-EXEC.                                                  01547015
                                                                        01548015
W36026******************************************************************01549015
W36026* DCLGEN TABLE(PMTW_PERM_SKU)                                    *01549115
W36026******************************************************************01549215
W36026     EXEC SQL DECLARE PMTW_PERM_SKU TABLE                         01549315
W36026     ( SKU_NBR            DECIMAL(008, 0) NOT NULL                01549415
W36026      ,STR_NBR            SMALLINT        NOT NULL                01549515
W36026      ,PRCHG_EFF_DTE      DATE            NOT NULL                01549615
W36026      ,EFF_BEG_DTE        DATE            NOT NULL                01549715
W36026      ,EFF_END_DTE        DATE                                    01549815
W36026      ,PRCHG_TYP_CDE      CHAR(3)         NOT NULL                01549915
W36026      ,UNT_RTL_AMT        DECIMAL(9,2)                            01550015
W36026      ,GP_RTL_QTY         SMALLINT                                01550115
W36026      ,GP_RTL_AMT         DECIMAL(9,2)                            01550215
W36026      ,EVNT_CTG_CDE       CHAR(3)         NOT NULL                01550315
W36026     ) END-EXEC.                                                  01550415
                                                                        01550515
      ******************************************************************01550615
      * GET CLEARANCE PRICE - PRICED AT SKU LEVEL W/NO PROMO ID         01550715
      * GOLDSTAR                                                        01550815
      ******************************************************************01550915
           EXEC SQL                                                     01551015
                DECLARE SKU-CLR-NOID-CSR CURSOR FOR                     01552015
                 SELECT L.PROMO_INTFC_ID                                01553015
                      , L.MDSE_LNE_ID                                   01554015
                      , L.PRICG_TYP_CDE                                 01555015
                      , L.ADV_CDE                                       01556015
                      , L.PROMO_ID                                      01557015
                      , L.TKT_CLOR_CDE                                  01558015
                      , X.SKU_NBR                                       01559015
                      , X.INTR_UPC_ID                                   01560015
                      , X.UNT_RTL_AMT                                   01570015
                      , X.GP_RTL_QTY                                    01580015
                      , X.GP_RTL_AMT                                    01590015
                      , X.UPC_NBR                                       01600015
                      , X.UNT_RTL_CHG_DTE                               01610015
                      , X.UPC_STAT_CHG_DTE                              01620015
                   FROM XST_PROMO P                                     01630015
                      , XST_MDSE_LNE_SELN L                             01640015
                      , SESSION.GTT_PRIC_DTRMN X                        01650015
                  WHERE P.PROMO_TYP_CDE      = 'C'                      01660015
                    AND P.STAT_CDE           = 'S'                      01670015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    01680015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    01690015
                    AND L.PROMO_ID           = P.PROMO_ID               01700015
                    AND L.STAT_CDE           = P.STAT_CDE               01710015
                    AND L.SKU_NBR            = X.SKU_NBR                01720015
                    AND L.MDSE_HIER_CDE      = 'SKU'                    01730015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     01740015
                   WITH UR                                              01750015
           END-EXEC.                                                    01760015
                                                                        01770015
      ******************************************************************01780015
      * GET CLEARANCE PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID       01790015
      * GOLDSTAR                                                        01800015
      ******************************************************************01810015
           EXEC SQL                                                     01820015
                DECLARE STY-CLR-NOID-CSR CURSOR FOR                     01830015
                 SELECT L.PROMO_INTFC_ID                                01840015
                      , L.MDSE_LNE_ID                                   01850015
                      , L.PRICG_TYP_CDE                                 01860015
                      , L.ADV_CDE                                       01870015
                      , L.PROMO_ID                                      01880015
                      , L.TKT_CLOR_CDE                                  01890015
                      , X.SKU_NBR                                       01900015
                      , X.INTR_UPC_ID                                   01910015
                      , X.UNT_RTL_AMT                                   01920015
                      , X.GP_RTL_QTY                                    01930015
                      , X.GP_RTL_AMT                                    01940015
                      , X.UPC_NBR                                       01950015
                      , X.UNT_RTL_CHG_DTE                               01960015
                      , X.UPC_STAT_CHG_DTE                              01970015
                   FROM XST_PROMO P                                     01980015
                      , XST_MDSE_LNE_SELN L                             01990015
                      , SESSION.GTT_PRIC_DTRMN X                        02000015
                  WHERE P.PROMO_TYP_CDE      = 'C'                      02010015
                    AND P.STAT_CDE           = 'S'                      02020015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    02030015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    02040015
                    AND L.PROMO_ID           = P.PROMO_ID               02050015
                    AND L.STAT_CDE           = P.STAT_CDE               02060015
                    AND L.STYL_ID            = X.STYL_ID                02070015
                    AND L.MDSE_HIER_CDE      = 'STY'                    02080015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     02090015
                 WITH UR                                                02100015
           END-EXEC.                                                    02110015
                                                                        02120015
      ******************************************************************02130015
      * GET CLEARANCE PRICE - PRICED AT SCL LEVEL W/NO PROMO ID         02140015
      * GOLDSTAR                                                        02150015
      ******************************************************************02160015
           EXEC SQL                                                     02170015
                DECLARE SCL-CLR-NOID-CSR CURSOR FOR                     02180015
                 SELECT L.PROMO_INTFC_ID                                02190015
                      , L.MDSE_LNE_ID                                   02200015
                      , L.PRICG_TYP_CDE                                 02210015
                      , L.ADV_CDE                                       02220015
                      , L.PROMO_ID                                      02230015
                      , L.TKT_CLOR_CDE                                  02240015
                      , Y.MAJ_CL_NBR                                    02250015
                      , Y.SUB_CL_NBR                                    02260015
                      , X.SKU_NBR                                       02270015
                      , X.INTR_UPC_ID                                   02280015
                      , X.UNT_RTL_AMT                                   02290015
                      , X.GP_RTL_QTY                                    02300015
                      , X.GP_RTL_AMT                                    02310015
                      , X.UPC_NBR                                       02320015
                      , X.UNT_RTL_CHG_DTE                               02330015
                      , X.UPC_STAT_CHG_DTE                              02340015
                   FROM XST_PROMO P                                     02350015
                      , XST_MDSE_LNE_SELN L                             02360015
                      , XST_VND_STYL Y                                  02370015
                      , SESSION.GTT_PRIC_DTRMN X                        02380015
                  WHERE P.PROMO_TYP_CDE      = 'C'                      02390015
                    AND P.STAT_CDE           = 'S'                      02400015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    02410015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    02420015
                    AND L.PROMO_ID           = P.PROMO_ID               02430015
                    AND L.STAT_CDE           = P.STAT_CDE               02440015
                    AND L.DEPT_NBR           = Y.DEPT_NBR               02450015
                    AND L.MAJ_CL_NBR         = Y.MAJ_CL_NBR             02460015
                    AND L.SUB_CL_NBR         = Y.SUB_CL_NBR             02470015
                    AND L.MDSE_HIER_CDE      = 'SCL'                    02480015
                    AND Y.STYL_ID            = X.STYL_ID                02490015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     02500015
                   WITH UR                                              02510015
           END-EXEC.                                                    02520015
                                                                        02530015
      ******************************************************************02540015
      * GET CLEARANCE PRICE - PRICED AT MCL LEVEL W/NO PROMO ID         02550015
      * GOLDSTAR                                                        02560015
      ******************************************************************02570015
           EXEC SQL                                                     02580015
                DECLARE MCL-CLR-NOID-CSR CURSOR FOR                     02590015
                 SELECT L.PROMO_INTFC_ID                                02600015
                      , L.MDSE_LNE_ID                                   02610015
                      , L.PRICG_TYP_CDE                                 02620015
                      , L.ADV_CDE                                       02630015
                      , L.PROMO_ID                                      02640015
                      , L.TKT_CLOR_CDE                                  02650015
                      , Y.MAJ_CL_NBR                                    02660015
                      , Y.SUB_CL_NBR                                    02670015
                      , X.SKU_NBR                                       02680015
                      , X.INTR_UPC_ID                                   02690015
                      , X.UNT_RTL_AMT                                   02700015
                      , X.GP_RTL_QTY                                    02710015
                      , X.GP_RTL_AMT                                    02720015
                      , X.UPC_NBR                                       02730015
                      , X.UNT_RTL_CHG_DTE                               02740015
                      , X.UPC_STAT_CHG_DTE                              02750015
                   FROM XST_PROMO P                                     02760015
                      , XST_MDSE_LNE_SELN L                             02770015
                      , XST_VND_STYL Y                                  02780015
                      , SESSION.GTT_PRIC_DTRMN X                        02790015
                  WHERE P.PROMO_TYP_CDE      = 'C'                      02800015
                    AND P.STAT_CDE           = 'S'                      02810015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    02820015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    02830015
                    AND L.PROMO_ID           = P.PROMO_ID               02840015
                    AND L.STAT_CDE           = P.STAT_CDE               02850015
                    AND L.DEPT_NBR           = Y.DEPT_NBR               02860015
                    AND L.MAJ_CL_NBR         = Y.MAJ_CL_NBR             02870015
                    AND L.MDSE_HIER_CDE      = 'MCL'                    02880015
                    AND Y.STYL_ID            = X.STYL_ID                02890015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     02900015
                   WITH UR                                              02910015
           END-EXEC.                                                    02920015
                                                                        02930015
      ******************************************************************02940015
      * GET CLEARANCE PRICE - PRICED AT DPT LEVEL W/NO PROMO ID         02950015
      * GOLDSTAR                                                        02960015
      ******************************************************************02970015
           EXEC SQL                                                     02980015
                DECLARE DPT-CLR-NOID-CSR CURSOR FOR                     02990015
                 SELECT L.PROMO_INTFC_ID                                03000015
                      , L.MDSE_LNE_ID                                   03010015
                      , L.PRICG_TYP_CDE                                 03020015
                      , L.ADV_CDE                                       03030015
                      , L.PROMO_ID                                      03040015
                      , L.TKT_CLOR_CDE                                  03050015
                      , Y.MAJ_CL_NBR                                    03060015
                      , Y.SUB_CL_NBR                                    03070015
                      , X.SKU_NBR                                       03080015
                      , X.INTR_UPC_ID                                   03090015
                      , X.UNT_RTL_AMT                                   03100015
                      , X.GP_RTL_QTY                                    03110015
                      , X.GP_RTL_AMT                                    03120015
                      , X.UPC_NBR                                       03130015
                      , X.UNT_RTL_CHG_DTE                               03140015
                      , X.UPC_STAT_CHG_DTE                              03150015
                   FROM XST_PROMO P                                     03160015
                      , XST_MDSE_LNE_SELN L                             03170015
                      , XST_VND_STYL Y                                  03180015
                      , SESSION.GTT_PRIC_DTRMN X                        03190015
                  WHERE P.PROMO_TYP_CDE      = 'C'                      03200015
                    AND P.STAT_CDE           = 'S'                      03210015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    03220015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    03230015
                    AND L.PROMO_ID           = P.PROMO_ID               03240015
                    AND L.STAT_CDE           = P.STAT_CDE               03250015
                    AND L.DEPT_NBR           = Y.DEPT_NBR               03260015
                    AND L.MDSE_HIER_CDE      = 'DPT'                    03270015
                    AND Y.STYL_ID            = X.STYL_ID                03280015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     03290015
                 WITH UR                                                03300015
           END-EXEC.                                                    03310015
                                                                        03320015
      ******************************************************************03330015
      * GET CLEARANCE PRICE - PRICED AT SKU LEVEL W/ PROMO ID           03340015
      * GOLDSTAR                                                        03350015
      ******************************************************************03360015
           EXEC SQL                                                     03370015
                DECLARE SKU-CLR-WID-CSR CURSOR FOR                      03380015
                 SELECT L.PROMO_INTFC_ID                                03390015
                      , L.MDSE_LNE_ID                                   03400015
                      , L.PRICG_TYP_CDE                                 03410015
                      , L.ADV_CDE                                       03420015
                      , L.PROMO_ID                                      03430015
                      , L.TKT_CLOR_CDE                                  03440015
                      , X.SKU_NBR                                       03450015
                      , X.INTR_UPC_ID                                   03460015
                      , X.UNT_RTL_AMT                                   03470015
                      , X.GP_RTL_QTY                                    03480015
                      , X.GP_RTL_AMT                                    03490015
                      , X.UPC_NBR                                       03500015
                      , X.UNT_RTL_CHG_DTE                               03510015
                      , X.UPC_STAT_CHG_DTE                              03520015
                   FROM XST_PROMO P                                     03530015
                      , XST_MDSE_LNE_SELN L                             03540015
                      , SESSION.GTT_PRIC_DTRMN X                        03550015
                  WHERE P.PROMO_TYP_CDE = 'C'                           03560015
                    AND P.STAT_CDE      = 'S'                           03570015
                    AND P.AD_EVNT_ID   IS NULL                          03580015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  03590015
                    AND L.PROMO_ID      = P.PROMO_ID                    03600015
                    AND L.STAT_CDE      = P.STAT_CDE                    03610015
                    AND L.SKU_NBR       = X.SKU_NBR                     03620015
                    AND L.MDSE_HIER_CDE = 'SKU'                         03630015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     03640015
                   WITH UR                                              03650015
           END-EXEC.                                                    03660015
                                                                        03670015
      ******************************************************************03680015
      * GET CLEARANCE PRICE - PRICED AT STYLE LEVEL W/ PROMO ID         03690015
      * GOLDSTAR                                                        03700015
      ******************************************************************03710015
           EXEC SQL                                                     03720015
                DECLARE STY-CLR-WID-CSR CURSOR FOR                      03730015
                 SELECT L.PROMO_INTFC_ID                                03740015
                      , L.MDSE_LNE_ID                                   03750015
                      , L.PRICG_TYP_CDE                                 03760015
                      , L.ADV_CDE                                       03770015
                      , L.PROMO_ID                                      03780015
                      , L.TKT_CLOR_CDE                                  03790015
                      , X.SKU_NBR                                       03800015
                      , X.INTR_UPC_ID                                   03810015
                      , X.UNT_RTL_AMT                                   03820015
                      , X.GP_RTL_QTY                                    03830015
                      , X.GP_RTL_AMT                                    03840015
                      , X.UPC_NBR                                       03850015
                      , X.UNT_RTL_CHG_DTE                               03860015
                      , X.UPC_STAT_CHG_DTE                              03870015
                   FROM XST_PROMO P                                     03880015
                      , XST_MDSE_LNE_SELN L                             03890015
                      , SESSION.GTT_PRIC_DTRMN X                        03900015
                  WHERE P.PROMO_TYP_CDE = 'C'                           03910015
                    AND P.STAT_CDE      = 'S'                           03920015
                    AND P.AD_EVNT_ID   IS NULL                          03930015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  03940015
                    AND L.PROMO_ID      = P.PROMO_ID                    03950015
                    AND L.STAT_CDE      = P.STAT_CDE                    03960015
                    AND L.STYL_ID       = X.STYL_ID                     03970015
                    AND L.MDSE_HIER_CDE = 'STY'                         03980015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     03990015
                 WITH UR                                                04000015
           END-EXEC.                                                    04010015
                                                                        04020015
      ******************************************************************04030015
      * GET CLEARANCE PRICE - PRICED AT SCL LEVEL W/ PROMO ID           04040015
      * GOLDSTAR                                                        04050015
      ******************************************************************04060015
           EXEC SQL                                                     04070015
                DECLARE SCL-CLR-WID-CSR CURSOR FOR                      04071015
                 SELECT L.PROMO_INTFC_ID                                04072015
                      , L.MDSE_LNE_ID                                   04073015
                      , L.PRICG_TYP_CDE                                 04074015
                      , L.ADV_CDE                                       04075015
                      , L.PROMO_ID                                      04076015
                      , L.TKT_CLOR_CDE                                  04077015
                      , Y.MAJ_CL_NBR                                    04078015
                      , Y.SUB_CL_NBR                                    04079015
                      , X.SKU_NBR                                       04080015
                      , X.INTR_UPC_ID                                   04090015
                      , X.UNT_RTL_AMT                                   04100015
                      , X.GP_RTL_QTY                                    04110015
                      , X.GP_RTL_AMT                                    04120015
                      , X.UPC_NBR                                       04130015
                      , X.UNT_RTL_CHG_DTE                               04140015
                      , X.UPC_STAT_CHG_DTE                              04150015
                   FROM XST_PROMO P                                     04160015
                      , XST_MDSE_LNE_SELN L                             04170015
                      , XST_VND_STYL Y                                  04180015
                      , SESSION.GTT_PRIC_DTRMN X                        04190015
                  WHERE P.PROMO_TYP_CDE = 'C'                           04200015
                    AND P.STAT_CDE      = 'S'                           04210015
                    AND P.AD_EVNT_ID   IS NULL                          04220015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  04230015
                    AND L.PROMO_ID      = P.PROMO_ID                    04240015
                    AND L.STAT_CDE      = P.STAT_CDE                    04250015
                    AND L.DEPT_NBR      = Y.DEPT_NBR                    04260015
                    AND L.MAJ_CL_NBR    = Y.MAJ_CL_NBR                  04270015
                    AND L.SUB_CL_NBR    = Y.SUB_CL_NBR                  04280015
                    AND L.MDSE_HIER_CDE = 'SCL'                         04290015
                    AND Y.STYL_ID       = X.STYL_ID                     04300015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     04310015
                 WITH UR                                                04320015
           END-EXEC.                                                    04330015
                                                                        04340015
      ******************************************************************04350015
      * GET CLEARANCE PRICE - PRICED AT MCL LEVEL W/ PROMO ID           04360015
      * GOLDSTAR                                                        04361015
      ******************************************************************04362015
           EXEC SQL                                                     04363015
                DECLARE MCL-CLR-WID-CSR CURSOR FOR                      04364015
                 SELECT L.PROMO_INTFC_ID                                04365015
                      , L.MDSE_LNE_ID                                   04366015
                      , L.PRICG_TYP_CDE                                 04367015
                      , Y.MAJ_CL_NBR                                    04368015
                      , Y.SUB_CL_NBR                                    04369015
                      , L.ADV_CDE                                       04370015
                      , L.PROMO_ID                                      04380015
                      , L.TKT_CLOR_CDE                                  04390015
                      , X.SKU_NBR                                       04400015
                      , X.INTR_UPC_ID                                   04410015
                      , X.UNT_RTL_AMT                                   04420015
                      , X.GP_RTL_QTY                                    04430015
                      , X.GP_RTL_AMT                                    04440015
                      , X.UPC_NBR                                       04450015
                      , X.UNT_RTL_CHG_DTE                               04460015
                      , X.UPC_STAT_CHG_DTE                              04470015
                   FROM XST_PROMO P                                     04480015
                      , XST_MDSE_LNE_SELN L                             04490015
                      , XST_VND_STYL Y                                  04500015
                      , SESSION.GTT_PRIC_DTRMN X                        04510015
                  WHERE P.PROMO_TYP_CDE = 'C'                           04520015
                    AND P.STAT_CDE      = 'S'                           04530015
                    AND P.AD_EVNT_ID   IS NULL                          04540015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  04550015
                    AND L.PROMO_ID      = P.PROMO_ID                    04551015
                    AND L.STAT_CDE      = P.STAT_CDE                    04552015
                    AND L.DEPT_NBR      = Y.DEPT_NBR                    04553015
                    AND L.MAJ_CL_NBR    = Y.MAJ_CL_NBR                  04554015
                    AND L.MDSE_HIER_CDE = 'MCL'                         04555015
                    AND Y.STYL_ID       = X.STYL_ID                     04556015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     04557015
                   WITH UR                                              04558015
           END-EXEC.                                                    04559015
                                                                        04560015
      ******************************************************************04570015
      * GET CLEARANCE PRICE - PRICED AT DPT LEVEL W/ PROMO ID           04580015
      * GOLDSTAR                                                        04590015
      ******************************************************************04600015
           EXEC SQL                                                     04610015
                DECLARE DPT-CLR-WID-CSR CURSOR FOR                      04620015
                 SELECT L.PROMO_INTFC_ID                                04630015
                      , L.MDSE_LNE_ID                                   04640015
                      , L.PRICG_TYP_CDE                                 04650015
                      , L.ADV_CDE                                       04660015
                      , L.PROMO_ID                                      04670015
                      , L.TKT_CLOR_CDE                                  04680015
                      , Y.MAJ_CL_NBR                                    04690015
                      , Y.SUB_CL_NBR                                    04700015
                      , X.SKU_NBR                                       04710015
                      , X.INTR_UPC_ID                                   04720015
                      , X.UNT_RTL_AMT                                   04730015
                      , X.GP_RTL_QTY                                    04740015
                      , X.GP_RTL_AMT                                    04750015
                      , X.UPC_NBR                                       04760015
                      , X.UNT_RTL_CHG_DTE                               04770015
                      , X.UPC_STAT_CHG_DTE                              04780015
                   FROM XST_PROMO P                                     04790015
                      , XST_MDSE_LNE_SELN L                             04800015
                      , XST_VND_STYL Y                                  04810015
                      , SESSION.GTT_PRIC_DTRMN X                        04820015
                  WHERE P.PROMO_TYP_CDE = 'C'                           04830015
                    AND P.STAT_CDE      = 'S'                           04840015
                    AND P.AD_EVNT_ID   IS NULL                          04850015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  04860015
                    AND L.PROMO_ID      = P.PROMO_ID                    04861015
                    AND L.STAT_CDE      = P.STAT_CDE                    04862015
                    AND L.DEPT_NBR      = Y.DEPT_NBR                    04863015
                    AND L.MDSE_HIER_CDE = 'DPT'                         04864015
                    AND Y.STYL_ID       = X.STYL_ID                     04865015
                    AND X.LOC_SKU_STAT_CDE   = '30'                     04866015
                   WITH UR                                              04867015
           END-EXEC.                                                    04868015
                                                                        04869015
      ******************************************************************04870015
      * GET PROMO PRICE - PRICED AT SKU LEVEL W/NO PROMO ID             04880015
      ******************************************************************04890015
           EXEC SQL                                                     04891015
                DECLARE SKU-PROMO-NOID-CSR CURSOR FOR                   04892015
                 SELECT L.PROMO_INTFC_ID                                04893015
                      , L.MDSE_LNE_ID                                   04894015
                      , L.PRICG_TYP_CDE                                 04895015
                      , L.ADV_CDE                                       04896015
                      , L.PROMO_ID                                      04897015
                      , P.REG_PROMO_TYP_CDE                             04898015
                      , X.SKU_NBR                                       04899015
                      , X.INTR_UPC_ID                                   04900015
                      , X.UNT_RTL_AMT                                   04910015
                      , X.GP_RTL_QTY                                    04920015
                      , X.GP_RTL_AMT                                    04930015
                      , X.UPC_NBR                                       04940015
                   FROM XST_PROMO P                                     04950015
                      , XST_MDSE_LNE_SELN L                             04960015
                      , SESSION.GTT_PRIC_DTRMN X                        04970015
                  WHERE P.PROMO_TYP_CDE      = 'R'                      04980015
                    AND P.STAT_CDE           = 'S'                      04990015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    05000015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    05010015
                    AND L.PROMO_ID           = P.PROMO_ID               05020015
                    AND L.STAT_CDE           = P.STAT_CDE               05030015
                    AND L.SKU_NBR            = X.SKU_NBR                05040015
                    AND L.MDSE_HIER_CDE      = 'SKU'                    05050015
                    AND X.LOC_SKU_STAT_CDE IN                           05060015
                                             ('10','20','25','40','90') 05070015
                   WITH UR                                              05071015
           END-EXEC.                                                    05072015
                                                                        05073015
      ******************************************************************05074015
      * GET PROMO PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID           05075015
      ******************************************************************05076015
           EXEC SQL                                                     05077015
                DECLARE STY-PROMO-NOID-CSR CURSOR FOR                   05078015
                 SELECT L.PROMO_INTFC_ID                                05079015
                      , L.MDSE_LNE_ID                                   05080015
                      , L.PRICG_TYP_CDE                                 05090015
                      , L.ADV_CDE                                       05100015
                      , L.PROMO_ID                                      05110015
                      , P.REG_PROMO_TYP_CDE                             05120015
                      , X.SKU_NBR                                       05130015
                      , X.INTR_UPC_ID                                   05140015
                      , X.UNT_RTL_AMT                                   05150015
                      , X.GP_RTL_QTY                                    05160015
                      , X.GP_RTL_AMT                                    05170015
                      , X.UPC_NBR                                       05180015
                   FROM XST_PROMO P                                     05190015
                      , XST_MDSE_LNE_SELN L                             05200015
                      , SESSION.GTT_PRIC_DTRMN X                        05210015
                  WHERE P.PROMO_TYP_CDE      = 'R'                      05220015
                    AND P.STAT_CDE           = 'S'                      05230015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    05240015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    05250015
                    AND L.PROMO_ID           = P.PROMO_ID               05260015
                    AND L.STAT_CDE           = P.STAT_CDE               05270015
                    AND L.STYL_ID            = X.STYL_ID                05280015
                    AND L.MDSE_HIER_CDE      = 'STY'                    05290015
                    AND X.LOC_SKU_STAT_CDE IN                           05300015
                                             ('10','20','25','40','90') 05310015
                   WITH UR                                              05320015
           END-EXEC.                                                    05330015
                                                                        05340015
      ******************************************************************05350015
      * GET PROMO PRICE - PRICED AT SCL LEVEL W/NO PROMO ID             05351015
      ******************************************************************05352015
           EXEC SQL                                                     05353015
                DECLARE SCL-PROMO-NOID-CSR CURSOR FOR                   05354015
                 SELECT L.PROMO_INTFC_ID                                05355015
                      , L.MDSE_LNE_ID                                   05356015
                      , L.PRICG_TYP_CDE                                 05357015
                      , L.ADV_CDE                                       05358015
                      , L.PROMO_ID                                      05359015
                      , P.REG_PROMO_TYP_CDE                             05360015
                      , Y.MAJ_CL_NBR                                    05370015
                      , Y.SUB_CL_NBR                                    05380015
                      , X.SKU_NBR                                       05390015
                      , X.INTR_UPC_ID                                   05400015
                      , X.UNT_RTL_AMT                                   05410015
                      , X.GP_RTL_QTY                                    05420015
                      , X.GP_RTL_AMT                                    05430015
                      , X.UPC_NBR                                       05440015
                   FROM XST_PROMO P                                     05450015
                      , XST_MDSE_LNE_SELN L                             05460015
                      , XST_VND_STYL Y                                  05470015
                      , SESSION.GTT_PRIC_DTRMN X                        05480015
                  WHERE P.PROMO_TYP_CDE      = 'R'                      05490015
                    AND P.STAT_CDE           = 'S'                      05500015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    05510015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    05520015
                    AND L.PROMO_ID           = P.PROMO_ID               05530015
                    AND L.STAT_CDE           = P.STAT_CDE               05540015
                    AND L.DEPT_NBR           = Y.DEPT_NBR               05550015
                    AND L.MAJ_CL_NBR         = Y.MAJ_CL_NBR             05560015
                    AND L.SUB_CL_NBR         = Y.SUB_CL_NBR             05570015
                    AND L.MDSE_HIER_CDE      = 'SCL'                    05580015
                    AND Y.STYL_ID            = X.STYL_ID                05590015
                    AND X.LOC_SKU_STAT_CDE IN                           05600015
                                             ('10','20','25','40','90') 05610015
                 WITH UR                                                05620015
           END-EXEC.                                                    05630015
                                                                        05640015
      ******************************************************************05650015
      * GET PROMO PRICE - PRICED AT MCL LEVEL W/NO PROMO ID             05660015
      ******************************************************************05670015
           EXEC SQL                                                     05680015
                DECLARE MCL-PROMO-NOID-CSR CURSOR FOR                   05690015
                 SELECT L.PROMO_INTFC_ID                                05700015
                      , L.MDSE_LNE_ID                                   05710015
                      , L.PRICG_TYP_CDE                                 05720015
                      , L.ADV_CDE                                       05730015
                      , L.PROMO_ID                                      05740015
                      , Y.MAJ_CL_NBR                                    05750015
                      , Y.SUB_CL_NBR                                    05760015
                      , P.REG_PROMO_TYP_CDE                             05770015
                      , X.SKU_NBR                                       05780015
                      , X.INTR_UPC_ID                                   05790015
                      , X.UNT_RTL_AMT                                   05791015
                      , X.GP_RTL_QTY                                    05792015
                      , X.GP_RTL_AMT                                    05793015
                      , X.UPC_NBR                                       05794015
                   FROM XST_PROMO P                                     05795015
                      , XST_MDSE_LNE_SELN L                             05796015
                      , XST_VND_STYL Y                                  05797015
                      , SESSION.GTT_PRIC_DTRMN X                        05798015
                  WHERE P.PROMO_TYP_CDE      = 'R'                      05799015
                    AND P.STAT_CDE           = 'S'                      05800015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    05810015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    05820015
                    AND L.PROMO_ID           = P.PROMO_ID               05830015
                    AND L.STAT_CDE           = P.STAT_CDE               05840015
                    AND L.DEPT_NBR           = Y.DEPT_NBR               05850015
                    AND L.MAJ_CL_NBR         = Y.MAJ_CL_NBR             05860015
                    AND L.MDSE_HIER_CDE      = 'MCL'                    05870015
                    AND Y.STYL_ID            = X.STYL_ID                05871015
                    AND X.LOC_SKU_STAT_CDE IN                           05872015
                                             ('10','20','25','40','90') 05872115
                   WITH UR                                              05872215
           END-EXEC.                                                    05872315
                                                                        05872415
      ******************************************************************05872515
      * GET PROMO PRICE - PRICED AT DPT LEVEL W/NO PROMO ID             05872615
      ******************************************************************05872715
           EXEC SQL                                                     05872815
                DECLARE DPT-PROMO-NOID-CSR CURSOR FOR                   05872915
                 SELECT L.PROMO_INTFC_ID                                05873015
                      , L.MDSE_LNE_ID                                   05874015
                      , L.PRICG_TYP_CDE                                 05875015
                      , L.ADV_CDE                                       05876015
                      , L.PROMO_ID                                      05877015
                      , Y.MAJ_CL_NBR                                    05878015
                      , Y.SUB_CL_NBR                                    05879015
                      , P.REG_PROMO_TYP_CDE                             05880015
                      , X.SKU_NBR                                       05890015
                      , X.INTR_UPC_ID                                   05900015
                      , X.UNT_RTL_AMT                                   05910015
                      , X.GP_RTL_QTY                                    05920015
                      , X.GP_RTL_AMT                                    05930015
                      , X.UPC_NBR                                       05940015
                   FROM XST_PROMO P                                     05950015
                      , XST_MDSE_LNE_SELN L                             05960015
                      , XST_VND_STYL Y                                  05970015
                      , SESSION.GTT_PRIC_DTRMN X                        05980015
                  WHERE P.PROMO_TYP_CDE      = 'R'                      05990015
                    AND P.STAT_CDE           = 'S'                      06000015
                    AND (P.DFLT_STRT_TMST - 3 DAYS) <= :PV-FULL-TMST    06010015
                    AND (P.DFLT_END_TMST + 3 DAYS)  >= :PV-FULL-TMST    06020015
                    AND L.PROMO_ID           = P.PROMO_ID               06030015
                    AND L.STAT_CDE           = P.STAT_CDE               06040015
                    AND L.DEPT_NBR           = Y.DEPT_NBR               06050015
                    AND L.MDSE_HIER_CDE      = 'DPT'                    06060015
                    AND Y.STYL_ID            = X.STYL_ID                06070015
                    AND X.LOC_SKU_STAT_CDE IN                           06080015
                                             ('10','20','25','40','90') 06090015
                   WITH UR                                              06100015
           END-EXEC.                                                    06110015
                                                                        06111015
      ******************************************************************06112015
      * GET PROMO PRICE - PRICED AT SKU LEVEL W/ PROMO ID               06113015
      ******************************************************************06114015
           EXEC SQL                                                     06115015
                DECLARE SKU-PROMO-WID-CSR CURSOR FOR                    06116015
                 SELECT L.PROMO_INTFC_ID                                06117015
                      , L.MDSE_LNE_ID                                   06118015
                      , L.PRICG_TYP_CDE                                 06119015
                      , L.ADV_CDE                                       06120015
                      , L.PROMO_ID                                      06130015
                      , P.REG_PROMO_TYP_CDE                             06140015
                      , X.SKU_NBR                                       06150015
                      , X.INTR_UPC_ID                                   06160015
                      , X.UNT_RTL_AMT                                   06170015
                      , X.GP_RTL_QTY                                    06180015
                      , X.GP_RTL_AMT                                    06190015
                      , X.UPC_NBR                                       06200015
                   FROM XST_PROMO P                                     06210015
                      , XST_MDSE_LNE_SELN L                             06220015
                      , SESSION.GTT_PRIC_DTRMN X                        06230015
                  WHERE P.PROMO_TYP_CDE = 'R'                           06240015
                    AND P.STAT_CDE      = 'S'                           06250015
                    AND P.AD_EVNT_ID    > 0                             06260015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  06270015
                    AND L.PROMO_ID      = P.PROMO_ID                    06280015
                    AND L.STAT_CDE      = P.STAT_CDE                    06290015
                    AND L.SKU_NBR       = X.SKU_NBR                     06300015
                    AND L.MDSE_HIER_CDE = 'SKU'                         06310015
                    AND X.LOC_SKU_STAT_CDE IN                           06320015
                                             ('10','20','25','40','90') 06330015
                   WITH UR                                              06340015
           END-EXEC.                                                    06350015
                                                                        06360015
      ******************************************************************06370015
      * GET PROMO PRICE - PRICED AT STYLE LEVEL W/ PROMO ID             06380015
      ******************************************************************06390015
           EXEC SQL                                                     06400015
                DECLARE STY-PROMO-WID-CSR CURSOR FOR                    06410015
                 SELECT L.PROMO_INTFC_ID                                06420015
                      , L.MDSE_LNE_ID                                   06430015
                      , L.PRICG_TYP_CDE                                 06440015
                      , L.ADV_CDE                                       06450015
                      , L.PROMO_ID                                      06460015
                      , P.REG_PROMO_TYP_CDE                             06470015
                      , X.SKU_NBR                                       06480015
                      , X.INTR_UPC_ID                                   06490015
                      , X.UNT_RTL_AMT                                   06500015
                      , X.GP_RTL_QTY                                    06510015
                      , X.GP_RTL_AMT                                    06520015
                      , X.UPC_NBR                                       06530015
                   FROM XST_PROMO P                                     06540015
                      , XST_MDSE_LNE_SELN L                             06550015
                      , SESSION.GTT_PRIC_DTRMN X                        06560015
                  WHERE P.PROMO_TYP_CDE = 'R'                           06570015
                    AND P.STAT_CDE      = 'S'                           06571015
                    AND P.AD_EVNT_ID    > 0                             06572015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  06573015
                    AND L.PROMO_ID      = P.PROMO_ID                    06574015
                    AND L.STAT_CDE      = P.STAT_CDE                    06575015
                    AND L.STYL_ID       = X.STYL_ID                     06576015
                    AND L.MDSE_HIER_CDE = 'STY'                         06577015
                    AND X.LOC_SKU_STAT_CDE IN                           06578015
                                             ('10','20','25','40','90') 06579015
                   WITH UR                                              06580015
           END-EXEC.                                                    06590015
                                                                        06600015
      ******************************************************************06610015
      * GET PROMO PRICE - PRICED AT SCL LEVEL W/ PROMO ID               06620015
      ******************************************************************06630015
           EXEC SQL                                                     06631015
                DECLARE SCL-PROMO-WID-CSR CURSOR FOR                    06632015
                 SELECT L.PROMO_INTFC_ID                                06632115
                      , L.MDSE_LNE_ID                                   06632215
                      , L.PRICG_TYP_CDE                                 06632315
                      , L.ADV_CDE                                       06632415
                      , L.PROMO_ID                                      06632515
                      , P.REG_PROMO_TYP_CDE                             06632615
                      , Y.MAJ_CL_NBR                                    06632715
                      , Y.SUB_CL_NBR                                    06632815
                      , X.SKU_NBR                                       06632915
                      , X.INTR_UPC_ID                                   06633015
                      , X.UNT_RTL_AMT                                   06634015
                      , X.GP_RTL_QTY                                    06635015
                      , X.GP_RTL_AMT                                    06636015
                      , X.UPC_NBR                                       06637015
                   FROM XST_PROMO P                                     06638015
                      , XST_MDSE_LNE_SELN L                             06639015
                      , XST_VND_STYL Y                                  06640015
                      , SESSION.GTT_PRIC_DTRMN X                        06650015
                  WHERE P.PROMO_TYP_CDE = 'R'                           06660015
                    AND P.STAT_CDE      = 'S'                           06670015
                    AND P.AD_EVNT_ID    > 0                             06680015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  06690015
                    AND L.PROMO_ID      = P.PROMO_ID                    06700015
                    AND L.STAT_CDE      = P.STAT_CDE                    06710015
                    AND L.DEPT_NBR      = Y.DEPT_NBR                    06720015
                    AND L.MAJ_CL_NBR    = Y.MAJ_CL_NBR                  06730015
                    AND L.SUB_CL_NBR    = Y.SUB_CL_NBR                  06740015
                    AND L.MDSE_HIER_CDE = 'SCL'                         06750015
                    AND Y.STYL_ID       = X.STYL_ID                     06760015
                    AND X.LOC_SKU_STAT_CDE IN                           06770015
                                             ('10','20','25','40','90') 06780015
                   WITH UR                                              06790015
           END-EXEC.                                                    06800015
                                                                        06810015
      ******************************************************************06820015
      * GET PROMO PRICE - PRICED AT MCL LEVEL W/ PROMO ID               06830015
      ******************************************************************06840015
           EXEC SQL                                                     06850015
                DECLARE MCL-PROMO-WID-CSR CURSOR FOR                    06860015
                 SELECT L.PROMO_INTFC_ID                                06870015
                      , L.MDSE_LNE_ID                                   06880015
                      , L.PRICG_TYP_CDE                                 06890015
                      , L.ADV_CDE                                       06900015
                      , L.PROMO_ID                                      06910015
                      , Y.MAJ_CL_NBR                                    06920015
                      , Y.SUB_CL_NBR                                    06930015
                      , P.REG_PROMO_TYP_CDE                             06940015
                      , X.SKU_NBR                                       06950015
                      , X.INTR_UPC_ID                                   06960015
                      , X.UNT_RTL_AMT                                   06970015
                      , X.GP_RTL_QTY                                    06980015
                      , X.GP_RTL_AMT                                    06990015
                      , X.UPC_NBR                                       07000015
                   FROM XST_PROMO P                                     07010015
                      , XST_MDSE_LNE_SELN L                             07020015
                      , XST_VND_STYL Y                                  07030015
                      , SESSION.GTT_PRIC_DTRMN X                        07040015
                  WHERE P.PROMO_TYP_CDE = 'R'                           07050015
                    AND P.STAT_CDE      = 'S'                           07060015
                    AND P.AD_EVNT_ID    > 0                             07070015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  07080015
                    AND L.PROMO_ID      = P.PROMO_ID                    07090015
                    AND L.STAT_CDE      = P.STAT_CDE                    07100015
                    AND L.DEPT_NBR      = Y.DEPT_NBR                    07110015
                    AND L.MAJ_CL_NBR    = Y.MAJ_CL_NBR                  07120015
                    AND L.MDSE_HIER_CDE = 'MCL'                         07130015
                    AND Y.STYL_ID       = X.STYL_ID                     07140015
                    AND X.LOC_SKU_STAT_CDE IN                           07150015
                                             ('10','20','25','40','90') 07160015
                   WITH UR                                              07170015
           END-EXEC.                                                    07180015
                                                                        07190015
      ******************************************************************07200015
      * GET PROMO PRICE - PRICED AT DPT LEVEL W/ PROMO ID               07210015
      ******************************************************************07220015
           EXEC SQL                                                     07230015
                DECLARE DPT-PROMO-WID-CSR CURSOR FOR                    07240015
                 SELECT L.PROMO_INTFC_ID                                07241015
                      , L.MDSE_LNE_ID                                   07242015
                      , L.PRICG_TYP_CDE                                 07243015
                      , L.ADV_CDE                                       07244015
                      , L.PROMO_ID                                      07245015
                      , Y.MAJ_CL_NBR                                    07246015
                      , Y.SUB_CL_NBR                                    07247015
                      , P.REG_PROMO_TYP_CDE                             07248015
                      , X.SKU_NBR                                       07249015
                      , X.INTR_UPC_ID                                   07250015
                      , X.UNT_RTL_AMT                                   07260015
                      , X.GP_RTL_QTY                                    07270015
                      , X.GP_RTL_AMT                                    07280015
                      , X.UPC_NBR                                       07290015
                   FROM XST_PROMO P                                     07300015
                      , XST_MDSE_LNE_SELN L                             07310015
                      , XST_VND_STYL Y                                  07311015
                      , SESSION.GTT_PRIC_DTRMN X                        07312015
                  WHERE P.PROMO_TYP_CDE = 'R'                           07313015
                    AND P.STAT_CDE      = 'S'                           07314015
                    AND P.AD_EVNT_ID    > 0                             07315015
                    AND P.PROMO_ID      = :PV-PROMO-ID                  07316015
                    AND L.PROMO_ID      = P.PROMO_ID                    07317015
                    AND L.STAT_CDE      = P.STAT_CDE                    07318015
                    AND L.DEPT_NBR      = Y.DEPT_NBR                    07319015
                    AND L.MDSE_HIER_CDE = 'DPT'                         07320015
                    AND Y.STYL_ID       = X.STYL_ID                     07330015
                    AND X.LOC_SKU_STAT_CDE IN                           07340015
                                             ('10','20','25','40','90') 07350015
                   WITH UR                                              07360015
           END-EXEC.                                                    07370015
                                                                        07380015
      ******************************************************************07390015
      * GET STANDARD STORE GROUP CURSOR                                 07391015
      * NOTE: ADDED M.STR_GP_TYP_CDE > 0, M.STR_GP_ID > 0, AND          07392015
      *       M.STR_NBR > 0 FOR PERFORMANCE TUNING.                     07392115
      ******************************************************************07392215
           EXEC SQL                                                     07392315
                DECLARE STD-STORE-GRP-CSR CURSOR FOR                    07392415
                 SELECT G.PROMO_STRT_TMST                               07392515
                      , G.PROMO_END_TMST                                07392615
                      , G.STR_SELN_HIER_CDE                             07392715
                   FROM XST_PROMO_STR_GP G                              07392815
                      , XST_STR_GP_MBSHP M                              07392915
                  WHERE G.PROMO_INTFC_ID   = :XST00028-PROMO-INTFC-ID   07393015
                    AND G.MDSE_LNE_ID      = :XST00028-MDSE-LNE-ID      07394015
                    AND G.STAT_CDE         = 'S'                        07395015
                    AND G.PROMO_STRT_TMST <= :PV-FULL-TMST              07396015
                    AND G.PROMO_END_TMST  >= :PV-FULL-TMST              07397015
                    AND M.STR_GP_TYP_CDE   = G.STR_GP_TYP_CDE           07398015
                    AND M.STR_GP_ID        = G.STR_GP_ID                07399015
                    AND M.STR_NBR          = :PV-STR                    07400015
                    AND M.EFF_BEG_DTE     <= :PV-DT                     07410015
                    AND (M.EFF_END_DTE    >= :PV-DT                     07420015
                     OR M.EFF_END_DTE     IS NULL)                      07430015
                  ORDER BY G.STR_SELN_HIER_CDE DESC                     07440015
                   WITH UR                                              07450015
            END-EXEC.                                                   07460015
                                                                        07470015
      ******************************************************************07480015
      * GET AD-HOC STORE GROUP CURSOR                                   07490015
      ******************************************************************07500015
           EXEC SQL                                                     07510015
                DECLARE AD-HOC-STR-GRP-CSR CURSOR FOR                   07520015
                 SELECT A.PROMO_STRT_TMST                               07530015
                      , A.PROMO_END_TMST                                07540015
                      , A.STR_SELN_HIER_CDE                             07550015
                   FROM XST_PROMO_ADHC_RLT A                            07560015
                      , XST_ADHC_STR_GP G                               07570015
                      , XST_PROMO_ADHC_STR S                            07580015
                  WHERE A.PROMO_INTFC_ID   = :XST00028-PROMO-INTFC-ID   07590015
                    AND A.MDSE_LNE_ID      = :XST00028-MDSE-LNE-ID      07600015
                    AND A.STAT_CDE         = 'S'                        07610015
                    AND G.STAT_CDE         = A.STAT_CDE                 07620015
                    AND S.STAT_CDE         = G.STAT_CDE                 07630015
                    AND A.PROMO_STRT_TMST <= :PV-FULL-TMST              07640015
                    AND A.PROMO_END_TMST  >= :PV-FULL-TMST              07650015
                    AND G.ADHC_STR_GP_ID   = A.ADHC_STR_GP_ID           07660015
                    AND S.ADHC_STR_GP_ID   = G.ADHC_STR_GP_ID           07670015
                    AND S.STR_NBR          = :PV-STR                    07680015
                    AND S.EFF_STRT_TMST   <= :PV-FULL-TMST              07690015
                    AND (S.EFF_END_TMST   >= :PV-FULL-TMST              07700015
                     OR S.EFF_END_TMST    IS NULL)                      07710015
                  ORDER BY A.STR_SELN_HIER_CDE DESC                     07720015
                   WITH UR                                              07730015
           END-EXEC.                                                    07740015
                                                                        07750015
      ******************************************************************07760015
      * GET TIER (TAP) PRICING CURSOR                                   07770015
      ******************************************************************07780015
           EXEC SQL                                                     07790015
                DECLARE TAP-TIER-CSR CURSOR FOR                         07800015
                 SELECT PROMO_INTFC_SUB_ID                              07810015
                      , THRS_AMT                                        07820015
                      , DISC_PCT                                        07821015
                   FROM XST_TIER_PRICG                                  07822015
                  WHERE PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID       07823015
                    AND MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID          07824015
                    AND STAT_CDE       = 'S'                            07825015
                  ORDER BY THRS_AMT                                     07826015
                   WITH UR                                              07827015
           END-EXEC.                                                    07828015
                                                                        07829015
      ******************************************************************07830015
      * GET TIER (TQP) PRICING CURSOR                                   07840015
      ******************************************************************07850015
           EXEC SQL                                                     07860015
                DECLARE TQP-TIER-CSR CURSOR FOR                         07870015
                 SELECT PROMO_INTFC_SUB_ID                              07880015
                      , THRS_QTY                                        07890015
                      , DISC_PCT                                        07900015
                   FROM XST_TIER_PRICG                                  07910015
                  WHERE PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID       07920015
                    AND MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID          07930015
                    AND STAT_CDE       = 'S'                            07940015
                  ORDER BY THRS_QTY                                     07950015
                   WITH UR                                              07951015
           END-EXEC.                                                    07952015
                                                                        07953015
      ******************************************************************07954015
      * GET FUTURE RED TICKET PERM EVENTS SET UP AT THE DEPT LEVEL      07955015
      * (CONTINUED CLEARANCE)                                           07956015
      ******************************************************************07957015
           EXEC SQL                                                     07958015
             DECLARE FUT-CNTCLR-DPT-CSR CURSOR FOR                      07959015
              SELECT STRGP.PRCHG_EFF_DTE                                07959115
                   , MDSE.CLR_TYP_CDE                                   07959215
                   , MDSE.PRICG_GRID_ID                                 07959315
                                                                        07959415
              FROM XST_STR_GP_PRCHG  STRGP                              07959515
                 , XST_STR_GP_MBSHP  MBSHP                              07959615
                 , XST_PRCHG_MDSE    MDSE                               07959715
                 , XST_PRCHG         PRCHG                              07959815
                                                                        07959915
              WHERE STRGP.PRCHG_EFF_DTE   <= :PV-DT                     07960015
                AND STRGP.PRCHG_EFF_DTE    > CURRENT DATE               07960115
                                                                        07960215
                AND MBSHP.STR_NBR          = :PV-STR                    07960315
                AND MBSHP.EFF_BEG_DTE     <= :PV-DT                     07960415
                AND (MBSHP.EFF_END_DTE    >= :PV-DT                     07960515
                     OR MBSHP.EFF_END_DTE IS NULL)                      07960615
                                                                        07960715
                AND MBSHP.STR_GP_TYP_CDE   = STRGP.STR_GP_TYP_CDE       07960815
                AND MBSHP.STR_GP_ID        = STRGP.STR_GP_ID            07960915
                                                                        07961015
                AND MDSE.STR_GP_TYP_CDE    = MBSHP.STR_GP_TYP_CDE       07962015
                AND MDSE.STR_GP_ID         = MBSHP.STR_GP_ID            07962115
                                                                        07962215
                AND STRGP.PRCHG_ID         = MDSE.PRCHG_ID              07962315
                AND PRCHG.PRCHG_ID         = STRGP.PRCHG_ID             07962415
                                                                        07962515
                AND MDSE.MDSE_HIER_CDE     = 'DPT'                      07962615
                AND MDSE.DEPT_NBR          = :XST00013-DEPT-NBR         07962715
                AND MDSE.MAJ_CL_NBR       IS NULL                       07962815
                AND MDSE.SUB_CL_NBR       IS NULL                       07962915
                                                                        07963015
                AND PRCHG.EVNT_CTG_CDE     = 'CON'                      07963115
                AND PRCHG.PRCHG_TYP_CDE    = 'CON'                      07963215
                AND PRCHG.PRCHG_ST_CDE     = 'APR'                      07963315
                AND PRCHG.LAST_ACTN_CDE   <> 'D'                        07963415
                AND STRGP.LAST_ACTN_CDE   <> 'D'                        07963515
                AND MDSE.LAST_ACTN_CDE    <> 'D'                        07963615
                                                                        07963715
              ORDER BY STRGP.PRCHG_EFF_DTE DESC                         07963815
              WITH UR                                                   07963915
           END-EXEC.                                                    07964015
                                                                        07964115
      ******************************************************************07964215
      * GET FUTURE RED TICKET PERM EVENTS SET UP AT THE MAJOR CLASS LVL 07964315
      * (CONTINUED CLEARANCE)                                           07964415
      ******************************************************************07964515
           EXEC SQL                                                     07964615
             DECLARE FUT-CNTCLR-MCL-CSR CURSOR FOR                      07964715
              SELECT STRGP.PRCHG_EFF_DTE                                07964815
                   , MDSE.CLR_TYP_CDE                                   07964915
                   , MDSE.PRICG_GRID_ID                                 07965015
                                                                        07966015
              FROM XST_STR_GP_PRCHG  STRGP                              07967015
                 , XST_STR_GP_MBSHP  MBSHP                              07968015
                 , XST_PRCHG_MDSE    MDSE                               07969015
                 , XST_PRCHG         PRCHG                              07970015
                                                                        07971015
              WHERE STRGP.PRCHG_EFF_DTE   <= :PV-DT                     07972015
                AND STRGP.PRCHG_EFF_DTE    > CURRENT DATE               07973015
                                                                        07974015
                AND MBSHP.STR_NBR          = :PV-STR                    07975015
                AND MBSHP.EFF_BEG_DTE     <= :PV-DT                     07976015
                AND (MBSHP.EFF_END_DTE    >= :PV-DT                     07977015
                     OR MBSHP.EFF_END_DTE IS NULL)                      07978015
                                                                        07979015
                AND MBSHP.STR_GP_TYP_CDE   = STRGP.STR_GP_TYP_CDE       07979115
                AND MBSHP.STR_GP_ID        = STRGP.STR_GP_ID            07979215
                                                                        07979315
                AND MDSE.STR_GP_TYP_CDE    = MBSHP.STR_GP_TYP_CDE       07979415
                AND MDSE.STR_GP_ID         = MBSHP.STR_GP_ID            07979515
                                                                        07979615
                AND STRGP.PRCHG_ID         = MDSE.PRCHG_ID              07979715
                AND PRCHG.PRCHG_ID         = STRGP.PRCHG_ID             07979815
                                                                        07979915
                AND MDSE.MDSE_HIER_CDE     = 'MCL'                      07980015
                AND MDSE.DEPT_NBR          = :XST00013-DEPT-NBR         07980115
                AND MDSE.MAJ_CL_NBR        = :XST00013-MAJ-CL-NBR       07980215
                AND MDSE.SUB_CL_NBR       IS NULL                       07980315
                                                                        07980415
                AND PRCHG.EVNT_CTG_CDE     = 'CON'                      07980515
                AND PRCHG.PRCHG_TYP_CDE    = 'CON'                      07980615
                AND PRCHG.PRCHG_ST_CDE     = 'APR'                      07980715
                AND PRCHG.LAST_ACTN_CDE   <> 'D'                        07980815
                AND STRGP.LAST_ACTN_CDE   <> 'D'                        07980915
                AND MDSE.LAST_ACTN_CDE    <> 'D'                        07981015
                                                                        07981115
              ORDER BY STRGP.PRCHG_EFF_DTE DESC                         07981215
              WITH UR                                                   07981315
           END-EXEC.                                                    07981415
                                                                        07981515
      ******************************************************************07981615
      * GET FUTURE RED TICKET PERM EVENTS SET UP AT THE SUB CLASS LEVEL 07981715
      * (CONTINUED CLEARANCE)                                           07981815
      ******************************************************************07981915
           EXEC SQL                                                     07982015
             DECLARE FUT-CNTCLR-SCL-CSR CURSOR FOR                      07983015
              SELECT STRGP.PRCHG_EFF_DTE                                07983115
                   , MDSE.CLR_TYP_CDE                                   07983215
                   , MDSE.PRICG_GRID_ID                                 07983315
                                                                        07983415
              FROM XST_STR_GP_PRCHG  STRGP                              07983515
                 , XST_STR_GP_MBSHP  MBSHP                              07983615
                 , XST_PRCHG_MDSE    MDSE                               07983715
                 , XST_PRCHG         PRCHG                              07983815
                                                                        07983915
              WHERE STRGP.PRCHG_EFF_DTE   <= :PV-DT                     07984015
                AND STRGP.PRCHG_EFF_DTE    > CURRENT DATE               07985015
                                                                        07985115
                AND MBSHP.STR_NBR          = :PV-STR                    07985215
                AND MBSHP.EFF_BEG_DTE     <= :PV-DT                     07985315
                AND (MBSHP.EFF_END_DTE    >= :PV-DT                     07985415
                     OR MBSHP.EFF_END_DTE IS NULL)                      07985515
                                                                        07985615
                AND MBSHP.STR_GP_TYP_CDE   = STRGP.STR_GP_TYP_CDE       07985715
                AND MBSHP.STR_GP_ID        = STRGP.STR_GP_ID            07985815
                                                                        07985915
                AND MDSE.STR_GP_TYP_CDE    = MBSHP.STR_GP_TYP_CDE       07986015
                AND MDSE.STR_GP_ID         = MBSHP.STR_GP_ID            07986115
                                                                        07986215
                AND STRGP.PRCHG_ID         = MDSE.PRCHG_ID              07986315
                AND PRCHG.PRCHG_ID         = STRGP.PRCHG_ID             07986415
                                                                        07986515
                AND MDSE.MDSE_HIER_CDE     = 'SCL'                      07986615
                AND MDSE.DEPT_NBR          = :XST00013-DEPT-NBR         07986715
                AND MDSE.MAJ_CL_NBR        = :XST00013-MAJ-CL-NBR       07986815
                AND MDSE.SUB_CL_NBR        = :XST00013-SUB-CL-NBR       07986915
                                                                        07987015
                AND PRCHG.EVNT_CTG_CDE     = 'CON'                      07987115
                AND PRCHG.PRCHG_TYP_CDE    = 'CON'                      07987215
                AND PRCHG.PRCHG_ST_CDE     = 'APR'                      07987315
                AND PRCHG.LAST_ACTN_CDE   <> 'D'                        07987415
                AND STRGP.LAST_ACTN_CDE   <> 'D'                        07987515
                AND MDSE.LAST_ACTN_CDE    <> 'D'                        07987615
                                                                        07987715
              ORDER BY STRGP.PRCHG_EFF_DTE DESC                         07987815
              WITH UR                                                   07987915
           END-EXEC.                                                    07988015
                                                                        07988115
      ******************************************************************07988215
      * GET FUTURE RED TICKET PERM EVENTS SET UP AT THE STYLE LEVEL     07988315
      * (CONTINUED CLEARANCE)                                           07988415
      ******************************************************************07988515
           EXEC SQL                                                     07988615
             DECLARE FUT-CNTCLR-STY-CSR CURSOR FOR                      07988715
              SELECT STRGP.PRCHG_EFF_DTE                                07988815
                   , MDSE.CLR_TYP_CDE                                   07988915
                   , MDSE.PRICG_GRID_ID                                 07989015
                                                                        07990015
              FROM XST_STR_GP_PRCHG  STRGP                              07991015
                 , XST_STR_GP_MBSHP  MBSHP                              07991115
                 , XST_PRCHG_MDSE    MDSE                               07991215
                 , XST_PRCHG         PRCHG                              07991315
                                                                        07991415
              WHERE STRGP.PRCHG_EFF_DTE   <= :PV-DT                     07991515
                AND STRGP.PRCHG_EFF_DTE    > CURRENT DATE               07991615
                                                                        07991715
                AND MBSHP.STR_NBR          = :PV-STR                    07991815
                AND MBSHP.EFF_BEG_DTE     <= :PV-DT                     07991915
                AND (MBSHP.EFF_END_DTE    >= :PV-DT                     07992015
                     OR MBSHP.EFF_END_DTE IS NULL)                      07992115
                                                                        07992215
                AND MBSHP.STR_GP_TYP_CDE   = STRGP.STR_GP_TYP_CDE       07992315
                AND MBSHP.STR_GP_ID        = STRGP.STR_GP_ID            07992415
                                                                        07992515
                AND MDSE.STR_GP_TYP_CDE    = MBSHP.STR_GP_TYP_CDE       07992615
                AND MDSE.STR_GP_ID         = MBSHP.STR_GP_ID            07992715
                                                                        07992815
                AND STRGP.PRCHG_ID         = MDSE.PRCHG_ID              07992915
                AND PRCHG.PRCHG_ID         = STRGP.PRCHG_ID             07993015
                                                                        07993115
                AND MDSE.MDSE_HIER_CDE     = 'STY'                      07993215
                AND MDSE.STYL_ID           = :XST00010-STYL-ID          07993315
                                                                        07993415
                AND PRCHG.EVNT_CTG_CDE     = 'CON'                      07993515
                AND PRCHG.PRCHG_TYP_CDE    = 'CON'                      07993615
                AND PRCHG.PRCHG_ST_CDE     = 'APR'                      07993715
                AND PRCHG.LAST_ACTN_CDE   <> 'D'                        07993815
                AND STRGP.LAST_ACTN_CDE   <> 'D'                        07993915
                AND MDSE.LAST_ACTN_CDE    <> 'D'                        07994015
                                                                        07994115
              ORDER BY STRGP.PRCHG_EFF_DTE DESC                         07994215
              WITH UR                                                   07994315
           END-EXEC.                                                    07994415
                                                                        07994515
      ******************************************************************07994615
      * GET FUTURE RED TICKET PERM EVENTS SET UP AT THE SKU LEVEL       07994715
      * (CONTINUED CLEARANCE)                                           07994815
      * NOTE:  ADDED PV-HOST-VAR-DTE FOR PERFORMANCE TUNING             07994915
      ******************************************************************07995015
           EXEC SQL                                                     07995115
             DECLARE FUT-CNTCLR-SKU-CSR CURSOR FOR                      07995215
              SELECT STRGP.PRCHG_EFF_DTE                                07995315
                   , MDSE.CLR_TYP_CDE                                   07995415
                   , MDSE.PRICG_GRID_ID                                 07995515
                                                                        07995615
              FROM XST_STR_GP_PRCHG  STRGP                              07995715
                 , XST_STR_GP_MBSHP  MBSHP                              07995815
                 , XST_PRCHG_MDSE    MDSE                               07995915
                 , XST_PRCHG         PRCHG                              07996015
                                                                        07997015
              WHERE STRGP.PRCHG_EFF_DTE   <= :PV-DT                     07997115
                AND STRGP.PRCHG_EFF_DTE    > CURRENT DATE               07997215
                                                                        07997315
                AND MBSHP.STR_NBR          = :PV-STR                    07997415
                AND MBSHP.EFF_BEG_DTE     <= :PV-DT                     07997515
                AND MBSHP.EFF_BEG_DTE      > :PV-HOST-VAR-DTE           07997615
                AND (MBSHP.EFF_END_DTE    >= :PV-DT                     07997715
                     OR MBSHP.EFF_END_DTE IS NULL)                      07997815
                                                                        07997915
                AND MBSHP.STR_GP_TYP_CDE   = STRGP.STR_GP_TYP_CDE       07998015
                AND MBSHP.STR_GP_ID        = STRGP.STR_GP_ID            07998115
                                                                        07998215
                AND MDSE.STR_GP_TYP_CDE    = MBSHP.STR_GP_TYP_CDE       07998315
                AND MDSE.STR_GP_ID         = MBSHP.STR_GP_ID            07998415
                                                                        07998515
                AND STRGP.PRCHG_ID         = MDSE.PRCHG_ID              07998615
                AND PRCHG.PRCHG_ID         = STRGP.PRCHG_ID             07998715
                                                                        07998815
                AND MDSE.MDSE_HIER_CDE     = 'SKU'                      07998915
                AND MDSE.SKU_NBR           = :XST00010-SKU-NBR          07999015
                                                                        08000015
                AND PRCHG.EVNT_CTG_CDE     = 'CON'                      08000115
                AND PRCHG.PRCHG_TYP_CDE    = 'CON'                      08000215
                AND PRCHG.PRCHG_ST_CDE     = 'APR'                      08000315
                AND PRCHG.LAST_ACTN_CDE   <> 'D'                        08000415
                AND STRGP.LAST_ACTN_CDE   <> 'D'                        08000515
                AND MDSE.LAST_ACTN_CDE    <> 'D'                        08000615
                                                                        08000715
              ORDER BY STRGP.PRCHG_EFF_DTE DESC                         08000815
              WITH UR                                                   08000915
           END-EXEC.                                                    08001015
                                                                        08001115
      ******************************************************************08001215
      * GET THE RED TICKET GRID DETAIL RECORD                           08001315
      ******************************************************************08001415
                                                                        08001515
           EXEC SQL                                                     08001615
             DECLARE RED-TKT-GRID-CSR CURSOR FOR                        08001715
              SELECT NEW_UNT_RTL_AMT                                    08001815
                FROM XST_PRICG_GRID_DTL                                 08001915
               WHERE PRICG_GRID_ID    = :XST00065-PRICG-GRID-ID         08002015
                 AND LAST_ACTN_CDE   <> 'D'                             08003015
                 AND MIN_UNT_RTL_AMT <= :HV-UNT-RTL-AMT                 08003115
                 AND MAX_UNT_RTL_AMT >= :HV-UNT-RTL-AMT                 08003215
              WITH UR                                                   08003315
           END-EXEC.                                                    08003415
                                                                        08003515
      ******************************************************************08003615
       PROCEDURE DIVISION.                                              08003715
      ******************************************************************08003815
                                                                        08003915
       0000-MAINLINE.                                                   08004015
W36026     DISPLAY 'PMKUT001 - 0000-MAINLINE'.                          08004115
                                                                        08004215
           PERFORM 1000-INITIALIZATION.                                 08004315
                                                                        08004415
           PERFORM 2000-PROCESS-FILE                                    08004515
               UNTIL PS-END-OF-FILE.                                    08004615
                                                                        08004715
           IF PA-HEADER-RECS-READ > 0                                   08004815
               PERFORM 2400-PROCESS-HEADER                              08004915
           END-IF.                                                      08005015
                                                                        08005115
           PERFORM 1900-FINALIZATION.                                   08005215
           GOBACK.                                                      08005315
                                                                        08005415
      ******************************************************************08005515
      **INITIALIZATION AREA - SETUP QUEUES FOR PROCESSING               08005615
      ******************************************************************08005715
       1000-INITIALIZATION.                                             08005815
                                                                        08005915
           OPEN INPUT  PD-INPUT-FILE                                    08006015
                OUTPUT PD-OUTPUT-FILE.                                  08006115
                                                                        08006215
           MOVE ZEROES              TO PV-PROMO-ID                      08006315
                                       PV-DISC-GP-QTY                   08006415
                                       PV-DISC-PRCG-AMT.                08006515
                                                                        08006615
           PERFORM 1001-READ-IN-VALUES.                                 08006715
                                                                        08006815
           IF PS-END-OF-FILE                                            08006915
               DISPLAY ' '                                              08007015
               DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME    08008015
               DISPLAY '** INPUT FILE IS EMPTY'                         08008115
               DISPLAY ' '                                              08008215
           ELSE                                                         08008315
               PERFORM 1020-PROCESS-FIRST-RECORDS                       08008415
           END-IF.                                                      08008515
                                                                        08008615
      ******************************************************************08008715
      * READS IN VALUES FROM FILE                                       08008815
      ******************************************************************08008915
       1001-READ-IN-VALUES.                                             08009015
                                                                        08009115
           READ PD-INPUT-FILE                                           08009215
               INTO PV-INPUT-RECORD                                     08009315
                   AT END                                               08009415
                       SET PS-END-OF-FILE  TO TRUE.                     08009515
                                                                        08009615
           IF PS-NOT-END-OF-FILE                                        08009715
               EVALUATE PV-INPUT-RECORD-TYPE                            08009815
                   WHEN 0                                               08009915
                       MOVE PD-INPUT-HEADER-REC                         08010015
                                               TO XS050-PD-HEADER-RECORD08010115
                       ADD +1                  TO PA-HEADER-RECS-READ   08010215
                   WHEN 1                                               08010315
                       MOVE PD-INPUT-DETAIL-REC                         08010415
                                               TO XS051-PD-DETAIL-RECORD08010515
                       ADD +1                  TO PA-DETAIL-RECS-READ   08010615
                   WHEN OTHER                                           08010715
                       SET ABEND-4444-FORCED-ABEND TO TRUE              08010815
                       MOVE '1001-READ-IN-VALUES    '                   08010915
                                               TO PV-PARAGRAPH-NAME     08011015
                       MOVE 'READING INPUT RECORDS'                     08011115
                                               TO PV-OPERATION-MSG-1    08011215
                       MOVE 'NOT A VALID RECORD TYPE'                   08011315
                                               TO PV-OPERATION-MSG-2    08011415
                       DISPLAY 'RECORD TYPE IS: ' PV-INPUT-RECORD-TYPE  08011515
                       PERFORM Z800-ABEND                               08011615
               END-EVALUATE                                             08011715
           END-IF.                                                      08011815
                                                                        08011915
      ******************************************************************08012015
       1020-PROCESS-FIRST-RECORDS.                                      08012115
                                                                        08012215
           IF PV-INPUT-RECORD-TYPE = 0                                  08012315
                PERFORM 1200-CHECK-FOR-ERRORS                           08012415
                MOVE XS050-PD-HEADER-RECORD TO PV-PREV-HEADER-RECORD    08012515
           ELSE                                                         08012615
               SET ABEND-4444-FORCED-ABEND TO TRUE                      08012715
               MOVE '1001-READ-IN-VALUES    ' TO PV-PARAGRAPH-NAME      08012815
               MOVE 'DETAIL RECORD READ   '   TO PV-OPERATION-MSG-1     08012915
               MOVE 'FIRST -- LOGIC ERROR '   TO PV-OPERATION-MSG-2     08013015
               DISPLAY 'RECORD TYPE IS: '     PV-INPUT-RECORD-TYPE      08014015
               PERFORM Z800-ABEND                                       08015015
           END-IF.                                                      08016015
                                                                        08017015
           PERFORM 1001-READ-IN-VALUES.                                 08018015
           IF PV-INPUT-RECORD-TYPE = 1                                  08019015
W36026         PERFORM 2850-CREATE-TEMP-TABLE                           08020015
           ELSE                                                         08030015
               SET ABEND-4444-FORCED-ABEND TO TRUE                      08040015
               MOVE '1001-READ-IN-VALUES    ' TO PV-PARAGRAPH-NAME      08050015
               MOVE 'HEADER RECORD READ   '   TO PV-OPERATION-MSG-1     08060015
               MOVE 'SECOND - LOGIC ERROR '   TO PV-OPERATION-MSG-2     08070015
               DISPLAY 'RECORD TYPE IS: '     PV-INPUT-RECORD-TYPE      08080015
               PERFORM Z800-ABEND                                       08090015
           END-IF.                                                      08100015
                                                                        08110015
      ******************************************************************08120015
      * MOVE VALUES FROM INPUT FILE VALUES TO PROGRAM VARIBLES.         08130015
      ******************************************************************08140015
       1100-SET-PV-VALUES.                                              08141015
                                                                        08142015
           MOVE XS051-PROMO-ID      TO PV-PROMO-ID                      08143015
                                       PV-CD-PROMO-ID.                  08144015
           MOVE XS051-STORE         TO PV-CD-STORE.                     08145015
           MOVE XS051-DATE          TO PV-CD-DATE.                      08146015
           MOVE XS051-TIME          TO PV-CD-TIME.                      08147015
                                                                        08148015
           MOVE XS051-SKU           TO PV-SKU.                          08149015
           MOVE XS051-INTR-UPC-ID   TO PV-INTR-UPC-ID.                  08150015
           MOVE XS051-UPC           TO PV-UPC.                          08160015
                                                                        08170015
           IF PV-COMPARE-HEADER = PV-COMPARE-DETAIL                     08180015
               CONTINUE                                                 08190015
           ELSE                                                         08191015
               DISPLAY 'STORE - HEADER:  ' PV-CH-STORE                  08192015
               DISPLAY '      - DETAIL:  ' PV-CD-STORE                  08193015
               DISPLAY ' '                                              08194015
               DISPLAY 'DATE - HEADER:   ' PV-CH-DATE                   08195015
               DISPLAY '     - DETAIL:   ' PV-CD-DATE                   08196015
               DISPLAY ' '                                              08197015
               DISPLAY 'TIME - HEADER:   ' PV-CH-TIME                   08198015
               DISPLAY '     - DETAIL:   ' PV-CD-TIME                   08199015
               DISPLAY ' '                                              08199115
               DISPLAY 'PROMO ID - HEADER:  ' PV-CH-PROMO-ID            08199215
               DISPLAY '         - DETAIL:  ' PV-CD-PROMO-ID            08199315
               DISPLAY ' '                                              08199415
               SET ABEND-4008-DATA-ERROR   TO TRUE                      08199515
               MOVE '1100-SET-PV-VALUES     ' TO PV-PARAGRAPH-NAME      08199615
               MOVE 'HEADER NOT = DETAIL   '  TO PV-OPERATION-MSG-1     08199715
               PERFORM Z800-ABEND                                       08199815
           END-IF.                                                      08199915
                                                                        08200015
      ******************************************************************08200115
      * CHECK IF INPUTS ARE POPULATED                                   08200215
      ******************************************************************08200315
       1200-CHECK-FOR-ERRORS.                                           08200415
                                                                        08200515
           EVALUATE XS050-MERCHANDISE-ID-CDE                            08200615
               WHEN 'S'                                                 08200715
               WHEN 'I'                                                 08200815
               WHEN 'U'                                                 08200915
                   CONTINUE                                             08201015
               WHEN OTHER                                               08201115
                   MOVE '1200-CHECK-FOR-ERRORS   '                      08201215
                                             TO PV-PARAGRAPH-NAME       08201315
                   MOVE 'MERCH ID IS INVALID     '                      08201415
                                             TO PV-OPERATION-MSG-1      08201515
                   SET ABEND-4008-DATA-ERROR TO TRUE                    08201615
                   PERFORM Z800-ABEND                                   08201715
           END-EVALUATE.                                                08201815
                                                                        08201915
           IF XS050-STORE = ZEROES                                      08202015
               MOVE '1200-CHECK-FOR-ERRORS   '                          08202115
                                             TO PV-PARAGRAPH-NAME       08202215
               MOVE 'STORE MISSING FROM INPUT'                          08202315
                                             TO PV-OPERATION-MSG-1      08202415
               SET ABEND-4008-DATA-ERROR     TO TRUE                    08202515
               PERFORM Z800-ABEND                                       08202615
           ELSE                                                         08202715
               MOVE XS050-STORE              TO PV-STR                  08202815
           END-IF.                                                      08202915
                                                                        08203015
           PERFORM 1210-CHECK-DATE.                                     08203115
                                                                        08203215
           PERFORM 1220-CHECK-TIME.                                     08203315
                                                                        08203415
           MOVE PV-DT                        TO PV-TMST-DATE.           08203515
           MOVE '-'                          TO PV-TMST-HYPHEN1.        08203615
           MOVE PV-TM                        TO PV-TMST-TIME.           08203715
           MOVE '.'                          TO PV-TMST-DOT1.           08203815
           MOVE '000000'                     TO PV-TMST-SUBS.           08203915
                                                                        08204015
           PERFORM 1230-CHECK-INCLD-SWITCHES.                           08205015
                                                                        08206015
           MOVE XS050-STORE                  TO PV-CH-STORE.            08207015
           MOVE XS050-DATE                   TO PV-CH-DATE.             08208015
           MOVE XS050-TIME                   TO PV-CH-TIME.             08209015
           MOVE XS050-PROMO-ID               TO PV-CH-PROMO-ID.         08210015
                                                                        08210115
      ******************************************************************08210215
       1210-CHECK-DATE.                                                 08210315
      ******************************************************************08210415
                                                                        08210515
           MOVE XS050-DATE TO PV-DT.                                    08210615
                                                                        08210715
           IF PV-DT = SPACES                                            08210815
               MOVE '1210-CHECK-DATE         '                          08210915
                                      TO PV-PARAGRAPH-NAME              08211015
               MOVE 'DATE WAS MISSING FROM INPUT'                       08211115
                                      TO PV-OPERATION-MSG-1             08211215
               SET ABEND-4008-DATA-ERROR TO TRUE                        08211315
               PERFORM Z800-ABEND                                       08211415
           ELSE                                                         08211515
               IF (PV-DATE-HY1 NOT = '-'  OR                            08211615
                   PV-DATE-MM      < '00' OR                            08211715
                   PV-DATE-MM      > '12' OR                            08211815
                   PV-DATE-HY2 NOT = '-'  OR                            08211915
                   PV-DATE-DD      < '00' OR                            08212015
                   PV-DATE-DD      > '31')                              08213015
                   MOVE '1210-CHECK-DATE         '                      08214015
                                      TO PV-PARAGRAPH-NAME              08215015
                   MOVE 'DATE NOT IN CORRECT FORMAT'                    08216015
                                      TO PV-OPERATION-MSG-1             08217015
                   SET ABEND-4008-DATA-ERROR TO TRUE                    08218015
                   PERFORM Z800-ABEND                                   08219015
               END-IF                                                   08220015
           END-IF.                                                      08230015
                                                                        08240015
      ******************************************************************08250015
       1220-CHECK-TIME.                                                 08260015
      ******************************************************************08270015
                                                                        08280015
           MOVE XS050-TIME TO PV-TM.                                    08290015
                                                                        08300015
           IF PV-TM = SPACES OR ZEROES                                  08310015
               MOVE PC-ZERO-TIME TO PV-TM                               08320015
           ELSE                                                         08330015
               IF (PV-TIME-HH      < '00' OR                            08340015
                   PV-TIME-HH      > '23' OR                            08350015
                   PV-TIME-MM      < '00' OR                            08360015
                   PV-TIME-MM      > '59' OR                            08370015
                   PV-TIME-SS      < '00' OR                            08380015
                   PV-TIME-SS      > '59')                              08390015
                   MOVE '1220-CHECK-TIME         '                      08400015
                                        TO PV-PARAGRAPH-NAME            08410015
                   MOVE 'TIME NOT IN CORRECT FORMAT'                    08420015
                                        TO PV-OPERATION-MSG-1           08430015
                   SET ABEND-4008-DATA-ERROR TO TRUE                    08440015
                   PERFORM Z800-ABEND                                   08450015
               ELSE                                                     08460015
                   IF PV-TIME-CO1 = '.' OR ':' AND                      08470015
                      PV-TIME-CO2 = '.' OR ':'                          08480015
                       MOVE '.'         TO PV-TIME-CO1                  08490015
                                           PV-TIME-CO2                  08500015
                   ELSE                                                 08510015
                       MOVE '1220-CHECK-TIME         '                  08520015
                                        TO PV-PARAGRAPH-NAME            08530015
                       MOVE 'TIME NOT IN CORRECT FORMAT'                08540015
                                        TO PV-OPERATION-MSG-1           08550015
                       SET ABEND-4008-DATA-ERROR TO TRUE                08560015
                       PERFORM Z800-ABEND                               08570015
                   END-IF                                               08580015
               END-IF                                                   08590015
           END-IF.                                                      08600015
                                                                        08610015
      ******************************************************************08620015
       1230-CHECK-INCLD-SWITCHES.                                       08630015
      ******************************************************************08640015
                                                                        08650015
           IF XS050-INCL-UNAD-SW = 'N' OR 'Y'                           08660015
               CONTINUE                                                 08670015
           ELSE                                                         08680015
               MOVE '1200-CHECK-FOR-ERRORS   '                          08690015
                                    TO PV-PARAGRAPH-NAME                08700015
               MOVE 'INCL-UNAD SWITCH NOT SET'                          08710015
                                    TO PV-OPERATION-MSG-1               08720015
               SET ABEND-4008-DATA-ERROR TO TRUE                        08730015
               PERFORM Z800-ABEND                                       08740015
           END-IF.                                                      08750015
                                                                        08760015
           IF XS050-INCL-PART-DAY-SW = 'N' OR 'Y'                       08770015
               CONTINUE                                                 08780015
           ELSE                                                         08790015
               MOVE '1200-CHECK-FOR-ERRORS   '                          08800015
                                    TO PV-PARAGRAPH-NAME                08810015
               MOVE 'INCL-PARTIAL-DAY SWITCH NOT SET'                   08820015
                                    TO PV-OPERATION-MSG-1               08830015
               SET ABEND-4008-DATA-ERROR TO TRUE                        08840015
               PERFORM Z800-ABEND                                       08850015
           END-IF.                                                      08860015
                                                                        08870015
           IF XS050-INCL-GOLD-STR-SW = 'N' OR 'Y'                       08880015
               CONTINUE                                                 08890015
           ELSE                                                         08900015
               MOVE '1200-CHECK-FOR-ERRORS   '                          08910015
                                    TO PV-PARAGRAPH-NAME                08920015
               MOVE 'INCL-GOLD-STR SWITCH NOT SET'                      08930015
                                    TO PV-OPERATION-MSG-1               08940015
               SET ABEND-4008-DATA-ERROR TO TRUE                        08950015
               PERFORM Z800-ABEND                                       08960015
           END-IF.                                                      08970015
                                                                        08980015
           IF XS050-INCL-LWST-SIX-WK-SW = 'N' OR 'Y'                    08990015
               CONTINUE                                                 09000015
           ELSE                                                         09010015
               MOVE '1200-CHECK-FOR-ERRORS   '                          09020015
                                    TO PV-PARAGRAPH-NAME                09030015
               MOVE 'INCL-LST-SIX-WK SWITCH NOT SET'                    09040015
                                    TO PV-OPERATION-MSG-1               09050015
               SET ABEND-4008-DATA-ERROR TO TRUE                        09060015
               PERFORM Z800-ABEND                                       09070015
           END-IF.                                                      09080015
                                                                        09090015
           IF XS050-INCL-GP-PRC-SW = 'N' OR 'Y'                         09100015
               CONTINUE                                                 09110015
           ELSE                                                         09120015
               MOVE '1200-CHECK-FOR-ERRORS   '                          09130015
                                    TO PV-PARAGRAPH-NAME                09140015
               MOVE 'INCL-LST-SIX-WK SWITCH NOT SET'                    09150015
                                    TO PV-OPERATION-MSG-1               09160015
               SET ABEND-4008-DATA-ERROR TO TRUE                        09161015
               PERFORM Z800-ABEND                                       09162015
           END-IF.                                                      09162115
                                                                        09162215
           IF XS050-INCL-BWP-PROMO-SW = 'N' OR 'Y'                      09162315
               CONTINUE                                                 09162415
           ELSE                                                         09162515
               MOVE '1200-CHECK-FOR-ERRORS   '                          09162615
                                    TO PV-PARAGRAPH-NAME                09162715
               MOVE 'INCL-GWP-PWP-PROMO SWITCH NOT SET'                 09162815
                                    TO PV-OPERATION-MSG-1               09162915
               SET ABEND-4008-DATA-ERROR TO TRUE                        09163015
               PERFORM Z800-ABEND                                       09163115
           END-IF.                                                      09163215
                                                                        09163315
           IF XS050-INCL-TIERED-PROMO-SW = 'N' OR 'Y'                   09163415
               CONTINUE                                                 09163515
           ELSE                                                         09163615
               MOVE '1200-CHECK-FOR-ERRORS   '                          09163715
                                    TO PV-PARAGRAPH-NAME                09163815
               MOVE 'INCL-TIERED-PROMO SWITCH NOT SET'                  09163915
                                    TO PV-OPERATION-MSG-1               09164015
               SET ABEND-4008-DATA-ERROR TO TRUE                        09164115
               PERFORM Z800-ABEND                                       09164215
           END-IF.                                                      09164315
                                                                        09164415
           IF XS050-INCL-ADD-PCT-AMT-SW = 'N' OR 'Y'                    09164515
               CONTINUE                                                 09164615
           ELSE                                                         09164715
               MOVE '1200-CHECK-FOR-ERRORS   '                          09164815
                                    TO PV-PARAGRAPH-NAME                09164915
               MOVE 'INCL-ADD-PCT-AMT SWITCH NOT SET'                   09165015
                                    TO PV-OPERATION-MSG-1               09165115
               SET ABEND-4008-DATA-ERROR TO TRUE                        09165215
               PERFORM Z800-ABEND                                       09165315
           END-IF.                                                      09165415
                                                                        09165515
      ******************************************************************09165615
      * PROCESS MERCH VALUES PASSED INTO THIS PROGRAM                   09165715
      ******************************************************************09165815
       1900-FINALIZATION.                                               09165915
                                                                        09166015
           CLOSE       PD-INPUT-FILE                                    09166115
                       PD-OUTPUT-FILE.                                  09166215
                                                                        09166315
      ******************************************************************09166415
      * PROCESS MERCH VALUES PASSED INTO THIS PROGRAM                   09166515
      ******************************************************************09166615
       2000-PROCESS-FILE.                                               09166715
                                                                        09166815
           EVALUATE PV-INPUT-RECORD-TYPE                                09166915
               WHEN 0                                                   09167015
      *            THE RECORD READ IS THE NEXT HEADER RECORD, WE STILL  09167115
      *            NEED TO PROCESS THE DETAIL SKUS UNDERNEATH THE       09167215
      *            PREVIOUS HEADER RECORD                               09167315
                                                                        09167415
                   MOVE XS050-PD-HEADER-RECORD TO PV-NEXT-HEADER-RECORD 09167515
                   MOVE PV-PREV-HEADER-RECORD  TO XS050-PD-HEADER-RECORD09167615
                                                                        09167715
                   PERFORM 2400-PROCESS-HEADER                          09167815
                                                                        09167915
                   MOVE PV-NEXT-HEADER-RECORD  TO XS050-PD-HEADER-RECORD09168015
                                                  PV-PREV-HEADER-RECORD 09168115
                   PERFORM 1200-CHECK-FOR-ERRORS                        09168215
                   PERFORM 2800-CLEAR-TEMP-TABLE                        09168315
               WHEN 1                                                   09168415
                   PERFORM 1100-SET-PV-VALUES                           09168515
                   PERFORM 2100-GET-MDSE-INFO                           09168615
                   IF PS-MDSE-FOUND                                     09168715
                       PERFORM 2300-PROCESS-MERCH                       09168815
                       PERFORM 8000-POPULATE-TEMP-FILE                  09168915
                       PERFORM 8010-INSERT-TEMP-FILE                    09169015
                       PERFORM 8100-POPULATE-HEADER                     09169115
                       PERFORM 8200-WRITE-PD-HEADER-RECORD              09169215
                   END-IF                                               09169315
           END-EVALUATE.                                                09169415
                                                                        09169515
           PERFORM 1001-READ-IN-VALUES.                                 09169615
                                                                        09169715
      ******************************************************************09169815
      * FIND THE RETAIL PRICE AND MDSE HIERARCHY INFORMATION            09169915
      ******************************************************************09170015
       2100-GET-MDSE-INFO.                                              09170115
                                                                        09170215
           SET PS-MDSE-FOUND TO TRUE.                                   09170315
                                                                        09170415
           EVALUATE XS050-MERCHANDISE-ID-CDE                            09170515
               WHEN 'I'                                                 09170615
                   PERFORM 2110-GET-INTR-UPC-ID                         09170715
               WHEN 'S'                                                 09170815
                   PERFORM 2120-GET-SKU                                 09170915
               WHEN 'U'                                                 09171015
                   PERFORM 2130-GET-UPC                                 09171115
           END-EVALUATE.                                                09171215
                                                                        09171315
      ******************************************************************09171415
      * GET RETAIL PRICE WHEN INTR_UPC_ID IS POPULATED                  09171515
      ******************************************************************09171615
       2110-GET-INTR-UPC-ID.                                            09171715
                                                                        09171815
           EXEC SQL                                                     09171915
                SELECT UNT_RTL_AMT                                      09172015
                     , LOC_SKU_STAT_CDE                                 09173015
                     , INTR_UPC_ID                                      09174015
                     , GP_RTL_QTY                                       09175015
                     , GP_RTL_AMT                                       09176015
                     , UNT_RTL_CHG_DTE                                  09177015
                     , UPC_STAT_CHG_DTE                                 09178015
                     , SKU_NBR                                          09179015
                     , STYL_ID                                          09180015
                     , REGN_PRIC_IND                                    09190015
                     , DEPT_NBR                                         09191015
                     , MAJ_CL_NBR                                       09192015
                     , SUB_CL_NBR                                       09193015
                  INTO :XST00008-UNT-RTL-AMT                            09194015
                     , :XST00008-LOC-SKU-STAT-CDE                       09195015
                     , :XST00008-INTR-UPC-ID                            09196015
                     , :XST00008-GP-RTL-QTY                             09196115
                       :PV-GP-RTL-QTY-NULL-IND                          09196215
                     , :XST00008-GP-RTL-AMT                             09196315
                       :PV-GP-RTL-AMT-NULL-IND                          09196415
                     , :XST00008-UNT-RTL-CHG-DTE                        09196515
                     , :XST00008-UPC-STAT-CHG-DTE                       09196615
                     , :XST00010-SKU-NBR                                09196715
                     , :XST00010-STYL-ID                                09196815
                     , :XST00010-REGN-PRIC-IND                          09196915
                     , :XST00013-DEPT-NBR                               09197015
                     , :XST00013-MAJ-CL-NBR                             09198015
                     , :XST00013-SUB-CL-NBR                             09198115
W36026            FROM PMTW_CORP_SKU                                    09198215
W36026           WHERE INTR_UPC_ID = :PV-INTR-UPC-ID                    09198315
W36026             AND BEG_TMST   <= :PV-FULL-TMST                      09198415
W36026             AND (END_TMST  >= :PV-FULL-TMST                      09198515
W36026                  OR END_TMST IS NULL)                            09198615
                  WITH UR                                               09198715
           END-EXEC.                                                    09198815
                                                                        09198915
           EVALUATE TRUE                                                09199015
               WHEN SQLCODE = ZERO                                      09200015
                   IF (PV-GP-RTL-QTY-NULL-IND < 0 OR                    09210015
                       PV-GP-RTL-AMT-NULL-IND < 0)                      09220015
                       MOVE ZEROES       TO XST00008-GP-RTL-QTY         09230015
                       MOVE ZEROES       TO XST00008-GP-RTL-AMT         09240015
                   END-IF                                               09250015
                                                                        09260015
               WHEN SQLCODE = +100                                      09261015
                   SET PS-MDSE-NOT-FOUND TO TRUE                        09262015
                                                                        09263015
               WHEN OTHER                                               09264015
                   DISPLAY 'INTR UPC ID:  ' PV-INTR-UPC-ID              09265015
                   DISPLAY 'FULL TMST:    ' PV-FULL-TMST                09266015
                   MOVE '2110-GET-INTR-UPC-ID      '                    09267015
                                         TO PV-PARAGRAPH-NAME           09268015
                   PERFORM Z900-SQL-ABEND                               09269015
           END-EVALUATE.                                                09270015
                                                                        09271015
      ******************************************************************09271115
      * GET RETAIL PRICE WHEN SKU IS POPULATED                          09271215
      ******************************************************************09271315
       2120-GET-SKU.                                                    09271415
                                                                        09271515
           EXEC SQL                                                     09271615
               SELECT L.UNT_RTL_AMT                                     09271715
                    , L.LOC_SKU_STAT_CDE                                09271815
                    , L.INTR_UPC_ID                                     09271915
                    , L.GP_RTL_QTY                                      09272015
                    , L.GP_RTL_AMT                                      09272115
                    , L.UNT_RTL_CHG_DTE                                 09272215
                    , L.UPC_STAT_CHG_DTE                                09272315
                    , S.SKU_NBR                                         09272415
                    , S.STYL_ID                                         09272515
                    , S.REGN_PRIC_IND                                   09272615
                    , V.DEPT_NBR                                        09272715
                    , V.MAJ_CL_NBR                                      09272815
                    , V.SUB_CL_NBR                                      09272915
                 INTO :XST00008-UNT-RTL-AMT                             09273015
                    , :XST00008-LOC-SKU-STAT-CDE                        09273115
                    , :XST00008-INTR-UPC-ID                             09273215
                    , :XST00008-GP-RTL-QTY                              09273315
                      :PV-GP-RTL-QTY-NULL-IND                           09273415
                    , :XST00008-GP-RTL-AMT                              09273515
                      :PV-GP-RTL-AMT-NULL-IND                           09273615
                    , :XST00008-UNT-RTL-CHG-DTE                         09273715
                    , :XST00008-UPC-STAT-CHG-DTE                        09273815
                    , :XST00010-SKU-NBR                                 09273915
                    , :XST00010-STYL-ID                                 09274015
                    , :XST00010-REGN-PRIC-IND                           09274115
                    , :XST00013-DEPT-NBR                                09274215
                    , :XST00013-MAJ-CL-NBR                              09274315
                    , :XST00013-SUB-CL-NBR                              09274415
                 FROM XST_SKU      S                                    09274515
                    , XST_SKU_LOC  L                                    09274615
                    , XST_VND_STYL V                                    09274715
                WHERE S.SKU_NBR     = :PV-SKU                           09274815
                  AND L.LOC_NBR     = SMALLINT(0)                       09274915
                  AND L.INTR_UPC_ID = S.INTR_UPC_ID                     09275015
                  AND S.STYL_ID     = V.STYL_ID                         09275115
                  AND L.BEG_TMST   <= :PV-FULL-TMST                     09275215
                  AND (L.END_TMST  >= :PV-FULL-TMST                     09275315
                   OR L.END_TMST   IS NULL)                             09275415
                 WITH UR                                                09275515
           END-EXEC.                                                    09275615
                                                                        09275715
           EVALUATE TRUE                                                09275815
               WHEN SQLCODE = ZERO                                      09275915
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        09276015
                       MOVE ZEROES       TO XST00008-GP-RTL-QTY         09276115
                   END-IF                                               09276215
                   IF PV-GP-RTL-AMT-NULL-IND < 0                        09276315
                       MOVE ZEROES       TO XST00008-GP-RTL-AMT         09276415
                   END-IF                                               09276515
                                                                        09276615
               WHEN SQLCODE = +100                                      09276715
                   SET PS-MDSE-NOT-FOUND TO TRUE                        09276815
                                                                        09276915
               WHEN OTHER                                               09277015
                   DISPLAY 'SKU:        ' PV-SKU                        09277115
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  09277215
                   MOVE '2120-GET-SKU              '                    09277315
                                         TO PV-PARAGRAPH-NAME           09277415
                   PERFORM Z900-SQL-ABEND                               09277515
           END-EVALUATE.                                                09277615
                                                                        09277715
      ******************************************************************09277815
      * OPEN RETAIL PRICE WHEN UPC IS POPULATED                         09277915
      ******************************************************************09278015
       2130-GET-UPC.                                                    09278115
                                                                        09278215
           EXEC SQL                                                     09278315
                SELECT L.UNT_RTL_AMT                                    09278415
                     , L.LOC_SKU_STAT_CDE                               09278515
                     , L.INTR_UPC_ID                                    09278615
                     , L.GP_RTL_QTY                                     09278715
                     , L.GP_RTL_AMT                                     09278815
                     , L.UNT_RTL_CHG_DTE                                09278915
                     , L.UPC_STAT_CHG_DTE                               09279015
                     , S.SKU_NBR                                        09279115
                     , S.STYL_ID                                        09279215
                     , S.REGN_PRIC_IND                                  09279315
                     , V.DEPT_NBR                                       09279415
                     , V.MAJ_CL_NBR                                     09279515
                     , V.SUB_CL_NBR                                     09279615
                  INTO :XST00008-UNT-RTL-AMT                            09279715
                     , :XST00008-LOC-SKU-STAT-CDE                       09279815
                     , :XST00008-INTR-UPC-ID                            09279915
                     , :XST00008-GP-RTL-QTY                             09280015
                       :PV-GP-RTL-QTY-NULL-IND                          09280115
                     , :XST00008-GP-RTL-AMT                             09280215
                       :PV-GP-RTL-AMT-NULL-IND                          09280315
                     , :XST00008-UNT-RTL-CHG-DTE                        09280415
                     , :XST00008-UPC-STAT-CHG-DTE                       09280515
                     , :XST00010-SKU-NBR                                09280615
                     , :XST00010-STYL-ID                                09280715
                     , :XST00010-REGN-PRIC-IND                          09280815
                     , :XST00013-DEPT-NBR                               09280915
                     , :XST00013-MAJ-CL-NBR                             09281015
                     , :XST00013-SUB-CL-NBR                             09281115
                  FROM XST_UPC U                                        09281215
                     , XST_SKU_LOC L                                    09281315
                     , XST_SKU S                                        09281415
                     , XST_VND_STYL V                                   09281515
                 WHERE U.UPC_NBR        = :PV-UPC                       09281615
                   AND U.UPC_TYP_CDE   <> 'R'                           09281715
                   AND U.LAST_ACTN_CDE <> 'D'                           09281815
                   AND L.LOC_NBR        = SMALLINT(0)                   09281915
                   AND L.INTR_UPC_ID    = U.INTR_UPC_ID                 09282015
                   AND S.INTR_UPC_ID    = L.INTR_UPC_ID                 09282115
                   AND S.STYL_ID        = V.STYL_ID                     09282215
                   AND L.BEG_TMST      <= :PV-FULL-TMST                 09282315
                   AND (L.END_TMST     >= :PV-FULL-TMST                 09282415
                    OR L.END_TMST      IS NULL)                         09282515
                  WITH UR                                               09282615
           END-EXEC.                                                    09282715
                                                                        09282815
           EVALUATE TRUE                                                09282915
               WHEN SQLCODE = ZERO                                      09283015
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        09283115
                       MOVE ZEROES       TO XST00008-GP-RTL-QTY         09283215
                   END-IF                                               09283315
                   IF PV-GP-RTL-AMT-NULL-IND < 0                        09283415
                       MOVE ZEROES       TO XST00008-GP-RTL-AMT         09283515
                   END-IF                                               09283615
                                                                        09283715
               WHEN SQLCODE = +100                                      09283815
                   SET PS-MDSE-NOT-FOUND TO TRUE                        09283915
                                                                        09284015
               WHEN OTHER                                               09285015
                   DISPLAY 'UPC:        ' PV-UPC                        09285115
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  09285215
                   MOVE '2130-GET-UPC              '                    09285315
                                         TO PV-PARAGRAPH-NAME           09285415
                   PERFORM Z900-SQL-ABEND                               09285515
           END-EVALUATE.                                                09285615
                                                                        09285715
      ******************************************************************09285815
      * MAIN PROCESS OF PROGRAM                                         09285915
      ******************************************************************09286015
       2300-PROCESS-MERCH.                                              09286115
                                                                        09286215
           MOVE XST00008-UNT-RTL-AMT      TO HV-UNT-RTL-AMT.            09286315
           MOVE XST00008-GP-RTL-QTY       TO HV-GP-RTL-QTY.             09286415
           MOVE XST00008-GP-RTL-AMT       TO HV-GP-RTL-AMT.             09286515
           MOVE XST00008-LOC-SKU-STAT-CDE TO HV-LOC-SKU-STAT-CDE.       09286615
           MOVE XST00008-UNT-RTL-CHG-DTE  TO HV-UNT-RTL-CHG-DTE.        09286715
           MOVE XST00008-UPC-STAT-CHG-DTE TO HV-UPC-STAT-CHG-DTE.       09286815
                                                                        09286915
           IF XST00010-REGN-PRIC-IND = 'Y'                              09287015
               PERFORM 2700-CHECK-FOR-REG-CLEAR                         09287115
               IF PS-REG-CLEAR-FOUND                                    09287215
                   MOVE XST00008-UNT-RTL-AMT      TO HV-UNT-RTL-AMT     09287315
                   MOVE XST00008-GP-RTL-QTY       TO HV-GP-RTL-QTY      09287415
                   MOVE XST00008-GP-RTL-AMT       TO HV-GP-RTL-AMT      09287515
                   MOVE XST00008-LOC-SKU-STAT-CDE TO HV-LOC-SKU-STAT-CDE09287615
                   MOVE XST00008-UNT-RTL-CHG-DTE  TO HV-UNT-RTL-CHG-DTE 09287715
                   MOVE XST00008-UPC-STAT-CHG-DTE TO HV-UPC-STAT-CHG-DTE09287815
               END-IF                                                   09287915
           END-IF.                                                      09288015
                                                                        09288115
           PERFORM 2600-CHECK-FOR-FUT-PERM-CHGS.                        09288215
                                                                        09288315
      ******************************************************************09288415
      * PROCESS THE DETAIL RECORDS THAT BELONG TO THE HEADER            09288515
      ******************************************************************09288615
       2400-PROCESS-HEADER.                                             09288715
                                                                        09288815
           DISPLAY 'PROCESSING HEADER:    ' XS050-PD-HEADER-RECORD.     09288915
           DISPLAY 'HEADER RECORDS READ:  ' PA-HEADER-RECS-READ.        09289015
           DISPLAY 'DETAIL RECORDS READ:  ' PA-DETAIL-RECS-READ.        09289115
W36026***  DISPLAY 'FUTURE CNTCLR CSR CALLS:  ' PA-FUT-CNTCLR-CSR-CALLS.09289215
W36026     DISPLAY 'FUTURE PERM CALLS FOUND:  ' PA-FUT-PERM-FOUND.      09289315
W36026     PERFORM 7500-SET-CURRENT-TIMESTAMP.                          09289415
           DISPLAY 'ROWS INSERTED INTO GLOBAL TEMP TABLE: '             09289515
                                          PA-TEMP-ROWS-INSERTED         09289615
W36026             '  TIMESTAMP: ' PV-CURRENT-TIMESTAMP.                09289715
                                                                        09289815
           IF XS050-INCL-GOLD-STR-SW = 'Y'                              09289915
               PERFORM 3000-CHECK-CLEARANCE                             09290015
           END-IF.                                                      09290115
                                                                        09290215
           PERFORM 4000-GET-PROMO-PRICING.                              09290315
                                                                        09290415
           DISPLAY 'HEADER RECORDS WRITTEN:  ' PA-HEADER-RECS-WRITTEN.  09290515
           DISPLAY 'DETAIL RECORDS WRITTEN:  ' PA-DETAIL-RECS-WRITTEN.  09290615
                                                                        09290715
           MOVE ZEROES                      TO PA-DETAIL-RECS-READ      09290815
                                               PA-TEMP-ROWS-INSERTED    09290915
W36026***                                      PA-FUT-CNTCLR-CSR-CALLS  09291015
W36026                                         PA-FUT-PERM-FOUND        09292015
                                               PA-HEADER-RECS-WRITTEN   09293015
                                               PA-DETAIL-RECS-WRITTEN.  09294015
                                                                        09295015
      ******************************************************************09296015
      * CHECK FOR FUTURE RETAIL, GRP PRICE, AND STATUS CHANGES          09297015
      ******************************************************************09297115
       2600-CHECK-FOR-FUT-PERM-CHGS.                                    09297215
                                                                        09297315
           SET PS-NO-PRICE-CHG-APPLIED           TO TRUE.               09297415
                                                                        09297515
      *    DETERMINE TICKET COLOR BEFORE CHECKING FUTURE PRICE CHANGE   09297615
           PERFORM 2640-DET-ITEM-TKT-COLOR.                             09297715
                                                                        09297815
           PERFORM 2620-SELECT-FUT-PERM-EVNT.                           09297915
                                                                        09298015
           IF PS-FUT-PERM-EVNT-FOUND                                    09299015
               EVALUATE XST00063-EVNT-CTG-CDE                           09300015
                   WHEN 'ACT'                                           09301015
                       EVALUATE XST00063-PRCHG-TYP-CDE                  09302015
                           WHEN 'MUA'                                   09303015
                           WHEN 'MDA'                                   09304015
                               IF PS-WHITE-TKT-ITEM                     09305015
                                   MOVE '20' TO PV-FUT-PERM-STATUS-CDE  09305115
                                   PERFORM 2660-DET-FUT-PERM-EVNT-CHGS  09305215
                               END-IF                                   09305315
                           WHEN 'CTA'                                   09305415
                               IF PS-YELLOW-TKT-ITEM OR                 09305515
                                  PS-RED-TKT-ITEM                       09305615
                                   MOVE '20' TO PV-FUT-PERM-STATUS-CDE  09305715
                                   PERFORM 2660-DET-FUT-PERM-EVNT-CHGS  09305815
                               END-IF                                   09305915
                       END-EVALUATE                                     09306015
                   WHEN 'CLR'                                           09307015
                       EVALUATE XST00063-PRCHG-TYP-CDE                  09308015
                           WHEN 'CLR'                                   09309015
                           WHEN 'RCP'                                   09310015
                           WHEN 'MK2'                                   09310115
                           WHEN 'FNL'                                   09310215
                               PERFORM 3200-PROCESS-CLR-PRICE-CHANGE    09310315
                       END-EVALUATE                                     09310415
               END-EVALUATE                                             09310515
W36026***  ELSE                                                         09310615
W36026***      IF PS-YELLOW-TKT-ITEM OR PS-RED-TKT-ITEM                 09310715
W36026***          SET PS-FUT-RED-EVNT-NOT-FOUND TO TRUE                09310815
W36026***          PERFORM 2900-CHECK-FOR-FUT-CNTCLR                    09310915
W36026***          IF PS-FUT-RED-EVNT-FOUND                             09311015
W36026***              PERFORM 2650-CONTCLR-EDITS                       09312015
W36026***              IF PS-VALID-FUT-TKT-EVNT                         09313015
W36026***                  PERFORM 2670-LOOK-FOR-RED-TKT-GRID           09314015
W36026***                  IF PS-VALID-FUT-TKT-EVNT                     09315015
W36026***                      PERFORM 2665-DET-CNTCLR-EVNT-CHGS        09316015
W36026***                  END-IF                                       09317015
W36026***              END-IF                                           09318015
W36026***          END-IF                                               09319015
W36026***      END-IF                                                   09320015
           END-IF.                                                      09330015
                                                                        09340015
      ******************************************************************09350015
      * GET FUTURE WHITE AND YELLOW TICKET PERM EVENTS                  09360015
      * THESE EVENTS ARE INTERFACED TO THE SUBSCRIBING SYSTEMS AT A     09370015
      * SKU LEVEL.  IF THE INTERFACE EVER CHANGES, THIS PROGRAM WILL    09380015
      * NEED TO CHANGE.                                                 09381015
      * NOTE:  PV-HOST-VAR-DTE ADDED FOR PERFORMANCE TUNING.            09382015
      ******************************************************************09383015
       2620-SELECT-FUT-PERM-EVNT.                                       09384015
                                                                        09385015
           EXEC SQL                                                     09386015
W36026         SELECT DISTINCT PRCHG_TYP_CDE                            09387015
                    , PRCHG_EFF_DTE                                     09388015
                    , UNT_RTL_AMT                                       09389015
                    , GP_RTL_QTY                                        09390015
                    , GP_RTL_AMT                                        09400015
                    , EVNT_CTG_CDE                                      09410015
                                                                        09420015
                INTO :XST00063-PRCHG-TYP-CDE                            09430015
                   , :XST00064-PRCHG-EFF-DTE                            09440015
                   , :XST00065-UNT-RTL-AMT                              09450015
                     :PV-UNT-RTL-AMT-NULL-IND                           09460015
                   , :XST00065-GP-RTL-QTY                               09461015
                     :PV-GP-RTL-QTY-NULL-IND                            09462015
                   , :XST00065-GP-RTL-AMT                               09462115
                     :PV-GP-RTL-AMT-NULL-IND                            09462215
                   , :XST00063-EVNT-CTG-CDE                             09462315
                                                                        09462415
W36026         FROM PMTW_PERM_SKU                                       09462515
                                                                        09462615
               WHERE PRCHG_EFF_DTE   <= :PV-DT                          09462715
                 AND STR_NBR          = :PV-STR                         09462815
                 AND EFF_BEG_DTE     <= :PV-DT                          09462915
                 AND EFF_BEG_DTE      > :PV-HOST-VAR-DTE                09463015
                 AND (EFF_END_DTE    >= :PV-DT                          09464015
                      OR EFF_END_DTE IS NULL)                           09465015
                 AND SKU_NBR          = :XST00010-SKU-NBR               09466015
              WITH UR                                                   09466115
           END-EXEC.                                                    09466215
                                                                        09466315
           EVALUATE TRUE                                                09466415
               WHEN SQLCODE = ZERO                                      09466515
                   SET PS-FUT-PERM-EVNT-FOUND TO TRUE                   09466615
W36026             ADD +1 TO PA-FUT-PERM-FOUND                          09466715
                   IF PV-UNT-RTL-AMT-NULL-IND < 0                       09466815
                       MOVE ZEROES  TO XST00065-UNT-RTL-AMT             09466915
                   END-IF                                               09467015
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        09468015
                       MOVE ZEROES  TO XST00065-GP-RTL-QTY              09469015
                   END-IF                                               09470015
                   IF PV-GP-RTL-AMT-NULL-IND < 0                        09480015
                       MOVE ZEROES  TO XST00065-GP-RTL-AMT              09490015
                   END-IF                                               09500015
                                                                        09510015
W36026         WHEN SQLCODE = -811                                      09520015
W36026             SET PS-FUT-PERM-EVNT-FOUND TO TRUE                   09530015
W36026             IF PV-UNT-RTL-AMT-NULL-IND < 0                       09540015
W36026                 MOVE ZEROES  TO XST00065-UNT-RTL-AMT             09550015
W36026             END-IF                                               09560015
W36026             IF PV-GP-RTL-QTY-NULL-IND < 0                        09570015
W36026                 MOVE ZEROES  TO XST00065-GP-RTL-QTY              09580015
W36026             END-IF                                               09590015
W36026             IF PV-GP-RTL-AMT-NULL-IND < 0                        09600015
W36026                 MOVE ZEROES  TO XST00065-GP-RTL-AMT              09610015
W36026             END-IF                                               09620015
W36026             DISPLAY 'MULTIPLE FUTURE PERM EVENT STORE: ' PV-STR  09630015
W36026                     '  SKU: ' XST00010-SKU-NBR                   09640015
                                                                        09650015
               WHEN SQLCODE = +100                                      09660015
                   SET PS-FUT-PERM-EVNT-NOT-FOUND TO TRUE               09670015
                                                                        09680015
               WHEN OTHER                                               09690015
                   DISPLAY 'STORE:  ' PV-STR                            09700015
                   DISPLAY 'DATE:   ' PV-DT                             09710015
                   DISPLAY 'SKU:    ' XST00010-SKU-NBR                  09720015
                   MOVE '2620-SELECT-FUT-PERM-EVNT  '                   09730015
                                            TO PV-PARAGRAPH-NAME        09740015
                   PERFORM Z900-SQL-ABEND                               09750015
           END-EVALUATE.                                                09760015
                                                                        09770015
      ******************************************************************09780015
      * DETERMINE WHAT TICKET COLOR THE ITEM IS BEFORE CHECKING FOR     09790015
      * FUTURE PRICE / STATUS CHANGES.                                  09800015
      ******************************************************************09810015
       2640-DET-ITEM-TKT-COLOR.                                         09811015
                                                                        09812015
           IF HV-LOC-SKU-STAT-CDE = '30'                                09812115
               IF HV-UNT-RTL-CHG-DTE <= HV-UPC-STAT-CHG-DTE             09812215
                   SET PS-YELLOW-TKT-ITEM TO TRUE                       09812315
               END-IF                                                   09812415
               IF HV-UNT-RTL-CHG-DTE > HV-UPC-STAT-CHG-DTE              09812515
                   SET PS-RED-TKT-ITEM    TO TRUE                       09812615
               END-IF                                                   09812715
           ELSE                                                         09812815
               SET PS-WHITE-TKT-ITEM      TO TRUE                       09812915
           END-IF.                                                      09813015
                                                                        09814015
W36026******************************************************************09815015
W36026* DETERMINE IF THE ITEM QUALIFIES FOR THE CONTINUED CLEARANCE     09816015
W36026* EVENT                                                           09817015
W36026******************************************************************09818015
W36026*2650-CONTCLR-EDITS.                                              09819015
W36026*                                                                 09820015
W36026*    SET PS-VALID-FUT-TKT-EVNT TO TRUE.                           09821015
W36026*                                                                 09822015
W36026*** ONLY SKU'S WHICH ARE RED TICKET ON THE EVENT EFFECTIVE        09823015
W36026*** DATE QUALIFY FOR THIS RED TICKET EVENT.                       09824015
W36026*    IF (PS-YELLOW-TKT-ITEM OR PS-YELLOW-TKT-APPLIED)             09825015
W36026*    AND XST00065-CLR-TYP-CDE = 'C'                               09826015
W36026*        SET PS-INVALID-FUT-TKT-EVNT TO TRUE                      09827015
W36026*    END-IF.                                                      09828015
W36026*                                                                 09829015
W36026*** ONLY SKU'S WHICH ARE YELLOW TICKET ON THE EVENT EFFECTIVE     09829115
W36026*** DATE QUALIFY FOR THIS RED TICKET EVENT.                       09829215
W36026*    IF  PS-RED-TKT-ITEM                                          09829315
W36026*    AND XST00065-CLR-TYP-CDE = 'F'                               09829415
W36026*      SET PS-INVALID-FUT-TKT-EVNT TO TRUE                        09829515
W36026*    END-IF.                                                      09829615
                                                                        09829715
      ******************************************************************09829815
      * DETERMINE WHAT FUTURE PERM CHANGES WILL BE MADE.                09829915
      ******************************************************************09830015
       2660-DET-FUT-PERM-EVNT-CHGS.                                     09831015
                                                                        09832015
      * THE FOLLOWING DATES NEED TO BE SET TO CORRECTLY                 09833015
      * IDENTIFY GOLDSTAR BY TICKET COLOR                               09834015
                                                                        09835015
           IF XST00065-UNT-RTL-AMT = HV-UNT-RTL-AMT                     09836015
             CONTINUE                                                   09837015
           ELSE                                                         09838015
      * THE FUTURE CHANGE IS RELATED TO UNIT RETAIL AMOUNT              09839015
             MOVE XST00064-PRCHG-EFF-DTE TO HV-UNT-RTL-CHG-DTE          09839115
             MOVE XST00065-UNT-RTL-AMT   TO HV-UNT-RTL-AMT              09839215
           END-IF.                                                      09839315
                                                                        09839415
           IF XST00065-GP-RTL-QTY = HV-GP-RTL-QTY                       09839515
             CONTINUE                                                   09839615
           ELSE                                                         09839715
      * THE FUTURE CHANGE IS RELATED TO GROUP RETAIL QTY                09839815
             MOVE XST00064-PRCHG-EFF-DTE TO HV-UNT-RTL-CHG-DTE          09839915
             MOVE XST00065-GP-RTL-QTY    TO HV-GP-RTL-QTY               09840015
           END-IF.                                                      09840115
                                                                        09840215
           IF XST00065-GP-RTL-AMT = HV-GP-RTL-AMT                       09840315
             CONTINUE                                                   09840415
           ELSE                                                         09840515
      * THE FUTURE CHANGE IS RELATED TO GROUP RETAIL AMT                09840615
             MOVE XST00064-PRCHG-EFF-DTE TO HV-UNT-RTL-CHG-DTE          09840715
             MOVE XST00065-GP-RTL-AMT    TO HV-GP-RTL-AMT               09840815
           END-IF.                                                      09840915
                                                                        09841015
           IF PV-FUT-PERM-STATUS-CDE = HV-LOC-SKU-STAT-CDE              09842015
             EVALUATE XST00063-PRCHG-TYP-CDE                            09843015
                 WHEN 'MK2'                                             09843115
                 WHEN 'FNL'                                             09843215
      * THE STATUS CHANGE DATE NEEDS TO BE UPDATED IN ORDER TO HAVE     09843315
      * THE TICKET COLOR TO STILL APPEAR YELLOW (YELLOW TO YELLOW)      09843415
                   MOVE XST00064-PRCHG-EFF-DTE TO HV-UPC-STAT-CHG-DTE   09843515
             END-EVALUATE                                               09843615
           ELSE                                                         09843715
      * THE FUTURE CHANGE IS RELATED TO STATUS                          09843815
             MOVE XST00064-PRCHG-EFF-DTE TO HV-UPC-STAT-CHG-DTE         09843915
             MOVE PV-FUT-PERM-STATUS-CDE TO HV-LOC-SKU-STAT-CDE         09844015
           END-IF.                                                      09844115
                                                                        09844215
W36026******************************************************************09844315
W36026* DETERMINE WHAT FUTURE CONTINUE CLEARANCE CHANGES WILL BE MADE   09844415
W36026******************************************************************09844515
W36026*2665-DET-CNTCLR-EVNT-CHGS.                                       09844615
W36026*                                                                 09844715
W36026* THE FOLLOWING DATES NEED TO BE SET TO CORRECTLY                 09844815
W36026* IDENTIFY GOLDSTAR BY TICKET COLOR                               09844915
W36026*                                                                 09845015
W36026*    IF XST00085-NEW-UNT-RTL-AMT = HV-UNT-RTL-AMT                 09845115
W36026*        CONTINUE                                                 09845215
W36026*    ELSE                                                         09845315
W36026* THE FUTURE CHANGE IS RELATED TO UNIT RETAIL AMOUNT              09845415
W36026*        MOVE PV-CONTCLR-PRCHG-EFF-DTE                            09845515
W36026*                                    TO HV-UNT-RTL-CHG-DTE        09845615
W36026*        MOVE XST00085-NEW-UNT-RTL-AMT                            09845715
W36026*                                    TO HV-UNT-RTL-AMT            09845815
W36026*    END-IF.                                                      09845915
                                                                        09846015
W36026******************************************************************09846115
W36026* GET THE RED TICKET PRICE                                        09846215
W36026******************************************************************09846315
W36026*2670-LOOK-FOR-RED-TKT-GRID.                                      09846415
W36026*                                                                 09846515
W36026*    PERFORM 2671-OPN-RED-TKT-GRID-CSR.                           09846615
W36026*                                                                 09846715
W36026*    PERFORM 2672-FETCH-RED-TKT-GRID-CSR.                         09846815
W36026*                                                                 09846915
W36026*    PERFORM 2673-CLS-RED-TKT-GRID-CSR.                           09847015
W36026*                                                                 09847115
W36026******************************************************************09847215
W36026* OPEN RED TICKET GRID TABLE CURSOR.                              09847315
W36026******************************************************************09847415
W36026*2671-OPN-RED-TKT-GRID-CSR.                                       09847515
W36026*                                                                 09847615
W36026*    EXEC SQL                                                     09847715
W36026*      OPEN RED-TKT-GRID-CSR                                      09847815
W36026*    END-EXEC.                                                    09847915
W36026*                                                                 09848015
W36026*    EVALUATE TRUE                                                09848115
W36026*      WHEN SQLCODE = +0                                          09848215
W36026*        CONTINUE                                                 09848315
W36026*                                                                 09848415
W36026*      WHEN OTHER                                                 09848515
W36026*        DISPLAY 'STORE:  ' PV-STR                                09848615
W36026*        DISPLAY 'DATE:   ' PV-DT                                 09848715
W36026*        DISPLAY 'PRICING-GRID-ID:  ' XST00065-PRICG-GRID-ID      09848815
W36026*        MOVE '2671-OPN-RED-TKT-GRID-CSR'                         09848915
W36026*                         TO PV-PARAGRAPH-NAME                    09849015
W36026*        PERFORM Z900-SQL-ABEND                                   09849115
W36026*    END-EVALUATE.                                                09849215
W36026*                                                                 09849315
W36026******************************************************************09849415
W36026* GET RED TICKET GRID TABLE RECORDS.                              09849515
W36026******************************************************************09849615
W36026*2672-FETCH-RED-TKT-GRID-CSR.                                     09849715
W36026*                                                                 09849815
W36026*    EXEC SQL                                                     09849915
W36026*         FETCH RED-TKT-GRID-CSR                                  09850015
W36026*          INTO :XST00085-NEW-UNT-RTL-AMT                         09850115
W36026*    END-EXEC.                                                    09850215
W36026*                                                                 09850315
W36026*    EVALUATE TRUE                                                09850415
W36026*        WHEN SQLCODE = +0                                        09850515
W36026*          SET PS-VALID-FUT-TKT-EVNT     TO TRUE                  09850615
W36026*                                                                 09850715
W36026*        WHEN SQLCODE = +100                                      09850815
W36026*          SET PS-INVALID-FUT-TKT-EVNT   TO TRUE                  09850915
W36026*                                                                 09851015
W36026*        WHEN OTHER                                               09852015
W36026*          DISPLAY 'STORE:  ' PV-STR                              09852115
W36026*          DISPLAY 'DATE:   ' PV-DT                               09852215
W36026*          DISPLAY 'PRICING-GRID-ID:  ' XST00065-PRICG-GRID-ID    09852315
W36026*          DISPLAY 'SKU:              ' XST00010-SKU-NBR          09852415
W36026*          DISPLAY 'UNIT RTL AMT:     ' HV-UNT-RTL-AMT            09852515
W36026*          MOVE '2672-FETCH-RED-TKT-GRID-CSR'                     09852615
W36026*                         TO PV-PARAGRAPH-NAME                    09852715
W36026*          PERFORM Z900-SQL-ABEND                                 09852815
W36026*    END-EVALUATE.                                                09852915
W36026*                                                                 09853015
W36026******************************************************************09854015
W36026* CLOSE RED TICKET GRID TABLE CURSOR.                             09854115
W36026******************************************************************09854215
W36026*2673-CLS-RED-TKT-GRID-CSR.                                       09854315
W36026*                                                                 09854415
W36026*    EXEC SQL                                                     09854515
W36026*         CLOSE RED-TKT-GRID-CSR                                  09854615
W36026*    END-EXEC.                                                    09854715
W36026*                                                                 09854815
W36026*    EVALUATE TRUE                                                09854915
W36026*      WHEN SQLCODE = +0                                          09855015
W36026*          CONTINUE                                               09855115
W36026*                                                                 09855215
W36026*      WHEN OTHER                                                 09855315
W36026*          DISPLAY 'STORE:  ' PV-STR                              09855415
W36026*          DISPLAY 'DATE:   ' PV-DT                               09855515
W36026*          DISPLAY 'PRICING-GRID-ID:  ' XST00065-PRICG-GRID-ID    09855615
W36026*          MOVE '2673-CLS-RED-TKT-GRID-CSR'                       09855715
W36026*                         TO PV-PARAGRAPH-NAME                    09855815
W36026*          PERFORM Z900-SQL-ABEND                                 09855915
W36026*    END-EVALUATE.                                                09856015
                                                                        09856115
      ******************************************************************09856215
      * DELETE THE ROWS ON THE GLOBAL TEMPORARY TABLE FROM THE LAST     09856315
      * STORE.  OTHERWISE, THE SKUS FOR THE NEW STORE JUST GET ADDED    09856415
      * TO THE TABLE AND BOTH SETS OF SKUS GET PROCESSED FOR THE NEW    09856515
      * STORE.  THE COMMIT CAUSES THE ROWS TO BE DELETED.               09856615
      ******************************************************************09856715
       2800-CLEAR-TEMP-TABLE.                                           09856815
                                                                        09856915
           EXEC SQL                                                     09857015
                COMMIT                                                  09857115
           END-EXEC.                                                    09857215
                                                                        09857315
           EVALUATE TRUE                                                09857415
               WHEN SQLCODE = +0                                        09857515
                   CONTINUE                                             09857615
                                                                        09857715
               WHEN SQLCODE = +100                                      09857815
                   CONTINUE                                             09857915
                                                                        09858015
               WHEN OTHER                                               09858115
                   MOVE '2800-CLEAR-TEMP-TABLE  '                       09858215
                                              TO PV-PARAGRAPH-NAME      09858315
                   PERFORM Z900-SQL-ABEND                               09858415
           END-EVALUATE.                                                09858515
                                                                        09858615
W36026******************************************************************09858715
W36026* 1) DEFINE THE DECLARED GLOBAL TEMPORARY TABLE.                  09858815
W36026* 2) CREATE AN INDEX ON SKU_NBR ON THE DECLARED GLOBAL TEMP TABLE.09858915
W36026* 3) CREATE AN INDEX ON STYL_ID ON THE DECLARED GLOBAL TEMP TABLE.09859015
W36026******************************************************************09859115
W36026 2850-CREATE-TEMP-TABLE.                                          09859215
W36026                                                                  09859315
W36026     EXEC SQL                                                     09859415
W36026      DECLARE GLOBAL TEMPORARY TABLE SESSION.GTT_PRIC_DTRMN       09859515
W36026        ( SKU_NBR            DECIMAL(008, 0) NOT NULL             09859615
W36026         ,STYL_ID            DECIMAL(008, 0) NOT NULL             09859715
W36026         ,INTR_UPC_ID        INTEGER         NOT NULL             09859815
W36026         ,UNT_RTL_AMT        DECIMAL(009, 2) NOT NULL             09859915
W36026         ,GP_RTL_QTY         SMALLINT                             09860015
W36026         ,GP_RTL_AMT         DECIMAL(009, 2)                      09860115
W36026         ,LOC_SKU_STAT_CDE   CHAR(0002)      NOT NULL             09860215
W36026         ,UPC_NBR            DECIMAL(015, 0)                      09860315
W36026         ,UPC_STAT_CHG_DTE   DATE            NOT NULL             09860415
W36026         ,UNT_RTL_CHG_DTE    DATE            NOT NULL)            09860515
W36026          ON COMMIT DELETE ROWS                                   09860615
243397          NOT LOGGED ON ROLLBACK DELETE ROWS                      09860720
W36026     END-EXEC.                                                    09860818
W36026                                                                  09860918
W36026     EVALUATE TRUE                                                09861018
W36026         WHEN SQLCODE = +0                                        09861118
W36026             CONTINUE                                             09861318
W36026         WHEN OTHER                                               09861418
W36026             MOVE '2850-CREATE-TEMP-TABLE            '            09861518
W36026                               TO PV-PARAGRAPH-NAME               09861618
W36026             MOVE 'DECLARE GLOBAL TEMPORARY TABLE '               09861718
W36026                               TO PV-OPERATION-MSG-1              09861818
W36026             PERFORM Z900-SQL-ABEND                               09861918
W36026     END-EVALUATE.                                                09862018
W36026                                                                  09862118
W36026     EXEC SQL                                                     09862218
W36026      CREATE INDEX SESSION.GTI_PRIC_DTRMN_1                       09863015
W36026            ON SESSION.GTT_PRIC_DTRMN                             09864015
W36026          ( SKU_NBR           ASC  )                              09864115
218082***         USING STOGROUP STGM000                                09864217
218082***         PRIQTY 7200  SECQTY 1440                              09864317
218082***         BUFFERPOOL BP2                                        09864417
W36026     END-EXEC.                                                    09864515
W36026                                                                  09864615
W36026     EVALUATE TRUE                                                09864715
W36026         WHEN SQLCODE = +0                                        09864815
W36026             CONTINUE                                             09864915
W36026         WHEN OTHER                                               09865015
W36026             MOVE '2850-CREATE-TEMP-TABLE            '            09866015
W36026                               TO PV-PARAGRAPH-NAME               09866115
W36026             MOVE 'CREATE INDEX 1'                                09866215
W36026                               TO PV-OPERATION-MSG-1              09866315
W36026             PERFORM Z900-SQL-ABEND                               09866415
W36026     END-EVALUATE.                                                09866515
W36026                                                                  09866615
W36026     EXEC SQL                                                     09866715
W36026      CREATE INDEX SESSION.GTI_PRIC_DTRMN_2                       09866815
W36026            ON SESSION.GTT_PRIC_DTRMN                             09866915
W36026          ( STYL_ID           ASC  )                              09867015
218082***         USING STOGROUP STGM000                                09867117
218082***         PRIQTY 7200  SECQTY 1440                              09867217
218082***         BUFFERPOOL BP2                                        09867317
W36026     END-EXEC.                                                    09867415
W36026                                                                  09867515
W36026     EVALUATE TRUE                                                09867615
W36026         WHEN SQLCODE = +0                                        09867715
W36026             CONTINUE                                             09867815
W36026         WHEN OTHER                                               09867915
W36026             MOVE '2850-CREATE-TEMP-TABLE            '            09868015
W36026                               TO PV-PARAGRAPH-NAME               09869015
W36026             MOVE 'CREATE INDEX 2'                                09869115
W36026                               TO PV-OPERATION-MSG-1              09869215
W36026             PERFORM Z900-SQL-ABEND                               09869315
W36026     END-EVALUATE.                                                09869415
W36026                                                                  09869515
W36026     PERFORM 2800-CLEAR-TEMP-TABLE.                               09869615
                                                                        09869715
      ******************************************************************09869815
      * CHECK FOR FUTURE CONTINUED CLEARANCE.                           09869915
      ******************************************************************09870015
W36026*2900-CHECK-FOR-FUT-CNTCLR.                                       09870115
W36026*                                                                 09870215
W36026*    THE PERM SYSTEM DOES NOT ALLOW A SKU TO BE SET UP IN         09870315
W36026*    MORE THAN ONE LEVEL OF THE MERCHANDISE HIERARCHY IN A        09870415
W36026*    CONTINUED CLEARANCE EVENT. --SPRING 2005                     09870515
W36026*                                                                 09870615
W36026*    SET PS-FUT-RED-EVNT-NOT-FOUND         TO TRUE.               09870715
W36026*    SET PS-NOT-END-OF-CONCLR-CSR          TO TRUE.               09870815
W36026*    PERFORM 2901-OPN-FUT-CNTCLR-DPT-CSR.                         09870915
W36026*    PERFORM 2902-FET-FUT-CNTCLR-DPT-CSR.                         09871015
W36026*    PERFORM 2903-CLS-FUT-CNTCLR-DPT-CSR.                         09871115
W36026*    ADD +1 TO PA-FUT-CNTCLR-CSR-CALLS.                           09871215
W36026*                                                                 09871315
W36026*    IF PS-FUT-RED-EVNT-NOT-FOUND                                 09871415
W36026*        SET PS-NOT-END-OF-CONCLR-CSR      TO TRUE                09871515
W36026*        PERFORM 2910-OPN-FUT-CNTCLR-MCL-CSR                      09871615
W36026*        PERFORM 2911-FET-FUT-CNTCLR-MCL-CSR                      09871715
W36026*        PERFORM 2912-CLS-FUT-CNTCLR-MCL-CSR                      09871815
W36026*        ADD +1 TO PA-FUT-CNTCLR-CSR-CALLS                        09871915
W36026*    END-IF.                                                      09872015
W36026*                                                                 09872115
W36026*    IF PS-FUT-RED-EVNT-NOT-FOUND                                 09872215
W36026*        SET PS-NOT-END-OF-CONCLR-CSR      TO TRUE                09872315
W36026*        PERFORM 2920-OPN-FUT-CNTCLR-SCL-CSR                      09872415
W36026*        PERFORM 2921-FET-FUT-CNTCLR-SCL-CSR                      09872515
W36026*        PERFORM 2922-CLS-FUT-CNTCLR-SCL-CSR                      09872615
W36026*        ADD +1 TO PA-FUT-CNTCLR-CSR-CALLS                        09872715
W36026*    END-IF.                                                      09872815
W36026*                                                                 09872915
W36026*    IF PS-FUT-RED-EVNT-NOT-FOUND                                 09873015
W36026*        SET PS-NOT-END-OF-CONCLR-CSR      TO TRUE                09873115
W36026*        PERFORM 2930-OPN-FUT-CNTCLR-STY-CSR                      09873215
W36026*        PERFORM 2931-FET-FUT-CNTCLR-STY-CSR                      09873315
W36026*        PERFORM 2932-CLS-FUT-CNTCLR-STY-CSR                      09873415
W36026*        ADD +1 TO PA-FUT-CNTCLR-CSR-CALLS                        09873515
W36026*    END-IF.                                                      09873615
W36026*                                                                 09873715
W36026*    IF PS-FUT-RED-EVNT-NOT-FOUND                                 09873815
W36026*        SET PS-NOT-END-OF-CONCLR-CSR      TO TRUE                09873915
W36026*        PERFORM 2940-OPN-FUT-CNTCLR-SKU-CSR                      09874015
W36026*        PERFORM 2941-FET-FUT-CNTCLR-SKU-CSR                      09874115
W36026*        PERFORM 2942-CLS-FUT-CNTCLR-SKU-CSR                      09874215
W36026*        ADD +1 TO PA-FUT-CNTCLR-CSR-CALLS                        09874315
W36026*    END-IF.                                                      09874415
W36026*                                                                 09874515
W36026******************************************************************09874615
W36026* OPEN FUTURE CONTINUED CLEARANCE AT THE DEPT LEVEL CURSOR        09874715
W36026******************************************************************09874815
W36026*2901-OPN-FUT-CNTCLR-DPT-CSR.                                     09874915
W36026*                                                                 09875015
W36026*    EXEC SQL                                                     09875115
W36026*         OPEN FUT-CNTCLR-DPT-CSR                                 09875215
W36026*    END-EXEC.                                                    09875315
W36026*                                                                 09875415
W36026*    EVALUATE TRUE                                                09875515
W36026*        WHEN SQLCODE = ZERO                                      09875615
W36026*            CONTINUE                                             09875715
W36026*                                                                 09875815
W36026*        WHEN OTHER                                               09875915
W36026*            DISPLAY 'STORE:  ' PV-STR                            09876015
W36026*            DISPLAY 'DATE:   ' PV-DT                             09876115
W36026*            DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                 09876215
W36026*            MOVE '2901-OPN-FUT-CNTCLR-DPT-CSR'                   09876315
W36026*                                     TO PV-PARAGRAPH-NAME        09876415
W36026*            PERFORM Z900-SQL-ABEND                               09876515
W36026*    END-EVALUATE.                                                09876615
W36026*                                                                 09876715
W36026******************************************************************09876815
W36026* GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       09876915
W36026* AT THE DEPARTMENT LEVEL.                                        09877015
W36026******************************************************************09877115
W36026*2902-FET-FUT-CNTCLR-DPT-CSR.                                     09877215
W36026*                                                                 09877315
W36026*    EXEC SQL                                                     09877415
W36026*         FETCH FUT-CNTCLR-DPT-CSR                                09877515
W36026*          INTO :PV-CONTCLR-PRCHG-EFF-DTE                         09877615
W36026*             , :XST00065-CLR-TYP-CDE                             09877715
W36026*             , :XST00065-PRICG-GRID-ID                           09877815
W36026*    END-EXEC.                                                    09877915
W36026*                                                                 09878015
W36026*    EVALUATE TRUE                                                09878115
W36026*        WHEN SQLCODE = ZERO                                      09878215
W36026*            SET PS-FUT-RED-EVNT-FOUND TO TRUE                    09878315
W36026*                                                                 09878415
W36026*        WHEN SQLCODE = +100                                      09878515
W36026*            SET PS-END-OF-CONCLR-CSR  TO TRUE                    09878615
W36026*                                                                 09878715
W36026*        WHEN OTHER                                               09878815
W36026*            DISPLAY 'STORE:  ' PV-STR                            09878915
W36026*            DISPLAY 'DATE:   ' PV-DT                             09879015
W36026*            DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                 09879115
W36026*            MOVE '2902-FET-FUT-CNTCLR-DPT-CSR'                   09879215
W36026*                                     TO PV-PARAGRAPH-NAME        09879315
W36026*            PERFORM Z900-SQL-ABEND                               09879415
W36026*    END-EVALUATE.                                                09879515
W36026*                                                                 09879615
W36026******************************************************************09879715
W36026* CLOSE FUTURE CONTINUED CLEARANCE AT THE DEPT LEVEL CURSOR       09879815
W36026******************************************************************09879915
W36026*2903-CLS-FUT-CNTCLR-DPT-CSR.                                     09880015
W36026*                                                                 09880115
W36026*    EXEC SQL                                                     09880215
W36026*         CLOSE FUT-CNTCLR-DPT-CSR                                09880315
W36026*    END-EXEC.                                                    09880415
W36026*                                                                 09880515
W36026*    EVALUATE TRUE                                                09880615
W36026*      WHEN SQLCODE = +0                                          09880715
W36026*          CONTINUE                                               09880815
W36026*                                                                 09880915
W36026*      WHEN OTHER                                                 09881015
W36026*          DISPLAY 'STORE:  ' PV-STR                              09881115
W36026*          DISPLAY 'DATE:   ' PV-DT                               09881215
W36026*          DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                   09881315
W36026*          MOVE '2903-CLS-FUT-CNTCLR-DPT-CSR'                     09881415
W36026*                         TO PV-PARAGRAPH-NAME                    09881515
W36026*          PERFORM Z900-SQL-ABEND                                 09881615
W36026*    END-EVALUATE.                                                09881715
W36026*                                                                 09881815
W36026******************************************************************09881915
W36026* OPEN FUTURE CONTINUED CLEARANCE AT THE MAJOR CLASS LEVEL CSR    09882015
W36026******************************************************************09882115
W36026*2910-OPN-FUT-CNTCLR-MCL-CSR.                                     09882215
W36026*                                                                 09882315
W36026*    EXEC SQL                                                     09882415
W36026*         OPEN FUT-CNTCLR-MCL-CSR                                 09882515
W36026*    END-EXEC.                                                    09882615
W36026*                                                                 09882715
W36026*    EVALUATE TRUE                                                09882815
W36026*        WHEN SQLCODE = ZERO                                      09882915
W36026*            CONTINUE                                             09883015
W36026*                                                                 09883115
W36026*        WHEN OTHER                                               09883215
W36026*            DISPLAY 'STORE:  ' PV-STR                            09883315
W36026*            DISPLAY 'DATE:   ' PV-DT                             09883415
W36026*            DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                 09883515
W36026*            DISPLAY 'MCL:    ' XST00013-MAJ-CL-NBR               09883615
W36026*            MOVE '2910-OPN-FUT-CNTCLR-MCL-CSR'                   09883715
W36026*                                     TO PV-PARAGRAPH-NAME        09883815
W36026*            PERFORM Z900-SQL-ABEND                               09883915
W36026*    END-EVALUATE.                                                09884015
W36026*                                                                 09884115
W36026******************************************************************09884215
W36026* GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       09884315
W36026* AT THE MAJOR CLASS LEVEL.                                       09884415
W36026******************************************************************09884515
W36026*2911-FET-FUT-CNTCLR-MCL-CSR.                                     09884615
W36026*                                                                 09884715
W36026*    EXEC SQL                                                     09884815
W36026*         FETCH FUT-CNTCLR-MCL-CSR                                09884915
W36026*          INTO :PV-CONTCLR-PRCHG-EFF-DTE                         09885015
W36026*             , :XST00065-CLR-TYP-CDE                             09885115
W36026*             , :XST00065-PRICG-GRID-ID                           09885215
W36026*    END-EXEC.                                                    09885315
W36026*                                                                 09885415
W36026*    EVALUATE TRUE                                                09885515
W36026*        WHEN SQLCODE = ZERO                                      09885615
W36026*            SET PS-FUT-RED-EVNT-FOUND TO TRUE                    09885715
W36026*                                                                 09885815
W36026*        WHEN SQLCODE = +100                                      09885915
W36026*            SET PS-END-OF-CONCLR-CSR  TO TRUE                    09886015
W36026*                                                                 09886115
W36026*        WHEN OTHER                                               09886215
W36026*            DISPLAY 'STORE:  ' PV-STR                            09886315
W36026*            DISPLAY 'DATE:   ' PV-DT                             09886415
W36026*            DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                 09886515
W36026*            DISPLAY 'MCL:    ' XST00013-MAJ-CL-NBR               09886615
W36026*            MOVE '2911-FET-FUT-CNTCLR-MCL-CSR'                   09886715
W36026*                                     TO PV-PARAGRAPH-NAME        09886815
W36026*            PERFORM Z900-SQL-ABEND                               09886915
W36026*    END-EVALUATE.                                                09887015
W36026*                                                                 09887115
W36026******************************************************************09887215
W36026* CLOSE FUTURE CONTINUED CLEARANCE AT THE MAJOR CLASS LEVEL CSR   09887315
W36026******************************************************************09887415
W36026*2912-CLS-FUT-CNTCLR-MCL-CSR.                                     09887515
W36026*                                                                 09887615
W36026*    EXEC SQL                                                     09887715
W36026*         CLOSE FUT-CNTCLR-MCL-CSR                                09887815
W36026*    END-EXEC.                                                    09887915
W36026*                                                                 09888015
W36026*    EVALUATE TRUE                                                09888115
W36026*      WHEN SQLCODE = +0                                          09888215
W36026*          CONTINUE                                               09888315
W36026*                                                                 09888415
W36026*      WHEN OTHER                                                 09888515
W36026*          DISPLAY 'STORE:  ' PV-STR                              09888615
W36026*          DISPLAY 'DATE:   ' PV-DT                               09888715
W36026*          DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                   09888815
W36026*          DISPLAY 'MCL:    ' XST00013-MAJ-CL-NBR                 09888915
W36026*          MOVE '2912-CLS-FUT-CNTCLR-MCL-CSR'                     09889015
W36026*                         TO PV-PARAGRAPH-NAME                    09889115
W36026*          PERFORM Z900-SQL-ABEND                                 09889215
W36026*    END-EVALUATE.                                                09889315
W36026*                                                                 09889415
W36026******************************************************************09889515
W36026* OPEN FUTURE CONTINUED CLEARANCE AT THE SUB CLASS LEVEL CSR      09889615
W36026******************************************************************09889715
W36026*2920-OPN-FUT-CNTCLR-SCL-CSR.                                     09889815
W36026*                                                                 09889915
W36026*    EXEC SQL                                                     09890015
W36026*         OPEN FUT-CNTCLR-SCL-CSR                                 09890115
W36026*    END-EXEC.                                                    09890215
W36026*                                                                 09890315
W36026*    EVALUATE TRUE                                                09890415
W36026*        WHEN SQLCODE = ZERO                                      09890515
W36026*            CONTINUE                                             09890615
W36026*                                                                 09890715
W36026*        WHEN OTHER                                               09890815
W36026*            DISPLAY 'STORE:  ' PV-STR                            09890915
W36026*            DISPLAY 'DATE:   ' PV-DT                             09891015
W36026*            DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                 09891115
W36026*            DISPLAY 'MCL:    ' XST00013-MAJ-CL-NBR               09891215
W36026*            DISPLAY 'SCL:    ' XST00013-SUB-CL-NBR               09891315
W36026*            MOVE '2920-OPN-FUT-CNTCLR-SCL-CSR'                   09891415
W36026*                                     TO PV-PARAGRAPH-NAME        09891515
W36026*            PERFORM Z900-SQL-ABEND                               09891615
W36026*    END-EVALUATE.                                                09891715
W36026*                                                                 09891815
W36026******************************************************************09891915
W36026* GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       09892015
W36026* AT THE SUB CLASS LEVEL.                                         09892115
W36026******************************************************************09892215
W36026*2921-FET-FUT-CNTCLR-SCL-CSR.                                     09892315
W36026*                                                                 09892415
W36026*    EXEC SQL                                                     09892515
W36026*         FETCH FUT-CNTCLR-SCL-CSR                                09892615
W36026*          INTO :PV-CONTCLR-PRCHG-EFF-DTE                         09892715
W36026*             , :XST00065-CLR-TYP-CDE                             09892815
W36026*             , :XST00065-PRICG-GRID-ID                           09892915
W36026*    END-EXEC.                                                    09893015
W36026*                                                                 09893115
W36026*    EVALUATE TRUE                                                09893215
W36026*        WHEN SQLCODE = ZERO                                      09893315
W36026*            SET PS-FUT-RED-EVNT-FOUND TO TRUE                    09893415
W36026*                                                                 09893515
W36026*        WHEN SQLCODE = +100                                      09893615
W36026*            SET PS-END-OF-CONCLR-CSR  TO TRUE                    09893715
W36026*                                                                 09893815
W36026*        WHEN OTHER                                               09893915
W36026*            DISPLAY 'STORE:  ' PV-STR                            09894015
W36026*            DISPLAY 'DATE:   ' PV-DT                             09894115
W36026*            DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                 09894215
W36026*            DISPLAY 'MCL:    ' XST00013-MAJ-CL-NBR               09894315
W36026*            DISPLAY 'SCL:    ' XST00013-SUB-CL-NBR               09894415
W36026*            MOVE '2921-FET-FUT-CNTCLR-SCL-CSR'                   09894515
W36026*                                     TO PV-PARAGRAPH-NAME        09894615
W36026*            PERFORM Z900-SQL-ABEND                               09894715
W36026*    END-EVALUATE.                                                09894815
W36026*                                                                 09894915
W36026******************************************************************09895015
W36026* CLOSE FUTURE CONTINUED CLEARANCE AT THE SUB CLASS LEVEL CSR     09895115
W36026******************************************************************09895215
W36026*2922-CLS-FUT-CNTCLR-SCL-CSR.                                     09895315
W36026*                                                                 09895415
W36026*    EXEC SQL                                                     09895515
W36026*         CLOSE FUT-CNTCLR-SCL-CSR                                09895615
W36026*    END-EXEC.                                                    09895715
W36026*                                                                 09895815
W36026*    EVALUATE TRUE                                                09895915
W36026*      WHEN SQLCODE = +0                                          09896015
W36026*          CONTINUE                                               09896115
W36026*                                                                 09896215
W36026*      WHEN OTHER                                                 09896315
W36026*          DISPLAY 'STORE:  ' PV-STR                              09896415
W36026*          DISPLAY 'DATE:   ' PV-DT                               09896515
W36026*          DISPLAY 'DEPT:   ' XST00013-DEPT-NBR                   09896615
W36026*          DISPLAY 'MCL:    ' XST00013-MAJ-CL-NBR                 09896715
W36026*          DISPLAY 'SCL:    ' XST00013-SUB-CL-NBR                 09896815
W36026*          MOVE '2922-CLS-FUT-CNTCLR-SCL-CSR'                     09896915
W36026*                         TO PV-PARAGRAPH-NAME                    09897015
W36026*          PERFORM Z900-SQL-ABEND                                 09897115
W36026*    END-EVALUATE.                                                09897215
W36026*                                                                 09897315
W36026******************************************************************09897415
W36026* OPEN FUTURE CONTINUED CLEARANCE AT THE STYLE LEVEL CSR          09897515
W36026******************************************************************09897615
W36026*2930-OPN-FUT-CNTCLR-STY-CSR.                                     09897715
W36026*                                                                 09897815
W36026*    EXEC SQL                                                     09897915
W36026*         OPEN FUT-CNTCLR-STY-CSR                                 09898015
W36026*    END-EXEC.                                                    09898115
W36026*                                                                 09898215
W36026*    EVALUATE TRUE                                                09898315
W36026*        WHEN SQLCODE = ZERO                                      09898415
W36026*            CONTINUE                                             09898515
W36026*                                                                 09898615
W36026*        WHEN OTHER                                               09898715
W36026*            DISPLAY 'STORE:  ' PV-STR                            09898815
W36026*            DISPLAY 'DATE:   ' PV-DT                             09898915
W36026*            DISPLAY 'STYL:   ' XST00010-STYL-ID                  09899015
W36026*            MOVE '2930-OPN-FUT-CNTCLR-STY-CSR'                   09899115
W36026*                                     TO PV-PARAGRAPH-NAME        09899215
W36026*            PERFORM Z900-SQL-ABEND                               09899315
W36026*    END-EVALUATE.                                                09899415
W36026*                                                                 09899515
W36026******************************************************************09899615
W36026* GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       09899715
W36026* AT THE STYLE LEVEL.                                             09899815
W36026******************************************************************09899915
W36026*2931-FET-FUT-CNTCLR-STY-CSR.                                     09900015
W36026*                                                                 09900115
W36026*    EXEC SQL                                                     09900215
W36026*         FETCH FUT-CNTCLR-STY-CSR                                09900315
W36026*          INTO :PV-CONTCLR-PRCHG-EFF-DTE                         09900415
W36026*             , :XST00065-CLR-TYP-CDE                             09900515
W36026*             , :XST00065-PRICG-GRID-ID                           09900615
W36026*    END-EXEC.                                                    09900715
W36026*                                                                 09900815
W36026*    EVALUATE TRUE                                                09900915
W36026*        WHEN SQLCODE = ZERO                                      09901015
W36026*            SET PS-FUT-RED-EVNT-FOUND TO TRUE                    09901115
W36026*                                                                 09901215
W36026*        WHEN SQLCODE = +100                                      09901315
W36026*            SET PS-END-OF-CONCLR-CSR  TO TRUE                    09901415
W36026*                                                                 09901515
W36026*        WHEN OTHER                                               09901615
W36026*            DISPLAY 'STORE:  ' PV-STR                            09901715
W36026*            DISPLAY 'DATE:   ' PV-DT                             09901815
W36026*            DISPLAY 'STYL:   ' XST00010-STYL-ID                  09901915
W36026*            MOVE '2931-FET-FUT-CNTCLR-STY-CSR'                   09902015
W36026*                                     TO PV-PARAGRAPH-NAME        09902115
W36026*            PERFORM Z900-SQL-ABEND                               09902215
W36026*    END-EVALUATE.                                                09902315
W36026*                                                                 09902415
W36026******************************************************************09902515
W36026* CLOSE FUTURE CONTINUED CLEARANCE AT THE STYLE LEVEL CSR         09902615
W36026******************************************************************09902715
W36026*2932-CLS-FUT-CNTCLR-STY-CSR.                                     09902815
W36026*                                                                 09902915
W36026*    EXEC SQL                                                     09903015
W36026*         CLOSE FUT-CNTCLR-STY-CSR                                09903115
W36026*    END-EXEC.                                                    09903215
W36026*                                                                 09903315
W36026*    EVALUATE TRUE                                                09903415
W36026*        WHEN SQLCODE = +0                                        09903515
W36026*            CONTINUE                                             09903615
W36026*                                                                 09903715
W36026*        WHEN OTHER                                               09903815
W36026*            DISPLAY 'STORE:  ' PV-STR                            09903915
W36026*            DISPLAY 'DATE:   ' PV-DT                             09904015
W36026*            DISPLAY 'STYL:   ' XST00010-STYL-ID                  09904115
W36026*            MOVE '2932-CLS-FUT-CNTCLR-STY-CSR'                   09904215
W36026*                           TO PV-PARAGRAPH-NAME                  09904315
W36026*            PERFORM Z900-SQL-ABEND                               09904415
W36026*    END-EVALUATE.                                                09904515
W36026*                                                                 09904615
W36026******************************************************************09904715
W36026* OPEN FUTURE CONTINUED CLEARANCE AT THE SKU LEVEL CSR            09904815
W36026******************************************************************09904915
W36026*2940-OPN-FUT-CNTCLR-SKU-CSR.                                     09905015
W36026*                                                                 09905115
W36026*    EXEC SQL                                                     09905215
W36026*         OPEN FUT-CNTCLR-SKU-CSR                                 09905315
W36026*    END-EXEC.                                                    09905415
W36026*                                                                 09905515
W36026*    EVALUATE TRUE                                                09905615
W36026*        WHEN SQLCODE = ZERO                                      09905715
W36026*            CONTINUE                                             09905815
W36026*                                                                 09905915
W36026*        WHEN OTHER                                               09906015
W36026*            DISPLAY 'STORE:  ' PV-STR                            09906115
W36026*            DISPLAY 'DATE:   ' PV-DT                             09906215
W36026*            DISPLAY 'SKU:    ' XST00010-SKU-NBR                  09906315
W36026*            MOVE '2940-OPN-FUT-CNTCLR-SKU-CSR'                   09906415
W36026*                                     TO PV-PARAGRAPH-NAME        09906515
W36026*            PERFORM Z900-SQL-ABEND                               09906615
W36026*    END-EVALUATE.                                                09906715
W36026*                                                                 09906815
W36026******************************************************************09906915
W36026* GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       09907015
W36026* AT THE SKU LEVEL.                                               09907115
W36026******************************************************************09907215
W36026*2941-FET-FUT-CNTCLR-SKU-CSR.                                     09907315
W36026*                                                                 09907415
W36026*    EXEC SQL                                                     09907515
W36026*         FETCH FUT-CNTCLR-SKU-CSR                                09907615
W36026*          INTO :PV-CONTCLR-PRCHG-EFF-DTE                         09907715
W36026*             , :XST00065-CLR-TYP-CDE                             09907815
W36026*             , :XST00065-PRICG-GRID-ID                           09907915
W36026*    END-EXEC.                                                    09908015
W36026*                                                                 09908115
W36026*    EVALUATE TRUE                                                09908215
W36026*        WHEN SQLCODE = ZERO                                      09908315
W36026*            SET PS-FUT-RED-EVNT-FOUND TO TRUE                    09908415
W36026*                                                                 09908515
W36026*        WHEN SQLCODE = +100                                      09908615
W36026*            SET PS-END-OF-CONCLR-CSR  TO TRUE                    09908715
W36026*                                                                 09908815
W36026*        WHEN OTHER                                               09908915
W36026*            DISPLAY 'STORE:  ' PV-STR                            09909015
W36026*            DISPLAY 'DATE:   ' PV-DT                             09909115
W36026*            DISPLAY 'SKU:    ' XST00010-SKU-NBR                  09909215
W36026*            MOVE '2941-FET-FUT-CNTCLR-SKU-CSR'                   09909315
W36026*                                     TO PV-PARAGRAPH-NAME        09909415
W36026*            PERFORM Z900-SQL-ABEND                               09909515
W36026*    END-EVALUATE.                                                09909615
W36026*                                                                 09909715
W36026******************************************************************09909815
W36026* CLOSE FUTURE CONTINUED CLEARANCE AT THE SKU LEVEL CSR           09909915
W36026******************************************************************09910015
W36026*2942-CLS-FUT-CNTCLR-SKU-CSR.                                     09910115
W36026*                                                                 09910215
W36026*    EXEC SQL                                                     09910315
W36026*         CLOSE FUT-CNTCLR-SKU-CSR                                09910415
W36026*    END-EXEC.                                                    09910515
W36026*                                                                 09910615
W36026*    EVALUATE TRUE                                                09910715
W36026*        WHEN SQLCODE = +0                                        09910815
W36026*            CONTINUE                                             09910915
W36026*                                                                 09911015
W36026*        WHEN OTHER                                               09911115
W36026*            DISPLAY 'STORE:  ' PV-STR                            09911215
W36026*            DISPLAY 'DATE:   ' PV-DT                             09911315
W36026*            DISPLAY 'SKU:    ' XST00010-SKU-NBR                  09911415
W36026*            MOVE '2942-CLS-FUT-CNTCLR-SKU-CSR'                   09911515
W36026*                           TO PV-PARAGRAPH-NAME                  09911615
W36026*            PERFORM Z900-SQL-ABEND                               09911715
W36026*    END-EVALUATE.                                                09911815
                                                                        09911915
      ******************************************************************09912015
      * NEED TO CHECK REGIONAL CLEARANCE                                09912115
      ******************************************************************09912215
       2700-CHECK-FOR-REG-CLEAR.                                        09912315
                                                                        09912415
           EXEC SQL                                                     09912515
                SELECT L.UNT_RTL_AMT                                    09912615
                     , L.LOC_SKU_STAT_CDE                               09912715
                     , L.GP_RTL_QTY                                     09912815
                     , L.GP_RTL_AMT                                     09912915
                     , L.UNT_RTL_CHG_DTE                                09913015
                     , L.UPC_STAT_CHG_DTE                               09913115
                  INTO :XST00008-UNT-RTL-AMT                            09913215
                     , :XST00008-LOC-SKU-STAT-CDE                       09913315
                     , :XST00008-GP-RTL-QTY                             09913415
                       :PV-GP-RTL-QTY-NULL-IND                          09913515
                     , :XST00008-GP-RTL-AMT                             09913615
                       :PV-GP-RTL-AMT-NULL-IND                          09913715
                     , :XST00008-UNT-RTL-CHG-DTE                        09913815
                     , :XST00008-UPC-STAT-CHG-DTE                       09913915
                  FROM XST_SKU_LOC L                                    09914015
                 WHERE L.LOC_NBR      = :PV-STR                         09914115
                   AND L.INTR_UPC_ID  = :XST00008-INTR-UPC-ID           09914215
                   AND L.BEG_TMST    <= :PV-FULL-TMST                   09914315
                   AND (L.END_TMST   >= :PV-FULL-TMST                   09914415
                       OR L.END_TMST IS NULL)                           09914515
                  WITH UR                                               09914615
           END-EXEC.                                                    09914715
                                                                        09914815
           EVALUATE TRUE                                                09914915
               WHEN SQLCODE = +0                                        09915015
                   SET PS-REG-CLEAR-FOUND TO TRUE                       09915115
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        09915215
                       MOVE ZEROES            TO XST00008-GP-RTL-QTY    09915315
                   END-IF                                               09915415
                   IF PV-GP-RTL-AMT-NULL-IND < 0                        09915515
                       MOVE ZEROES            TO XST00008-GP-RTL-AMT    09915615
                   END-IF                                               09915715
                                                                        09915815
               WHEN SQLCODE = +100                                      09915915
                   SET PS-REG-CLEAR-NOT-FOUND TO TRUE                   09916015
                                                                        09916115
               WHEN OTHER                                               09916215
                   DISPLAY 'LOC NBR:      ' PV-STR                      09916315
                   DISPLAY 'INTR UPC ID:  ' XST00008-INTR-UPC-ID        09916415
                   DISPLAY 'FULL TMST:    ' PV-FULL-TMST                09916515
                   MOVE '2700-CHECK-FOR-REG-CLEAR '                     09916615
                                              TO PV-PARAGRAPH-NAME      09916715
                   PERFORM Z900-SQL-ABEND                               09916815
           END-EVALUATE.                                                09916915
                                                                        09917015
      ******************************************************************09917115
      * NEED TO CHECK CLEARANCE CURSORS                                 09917215
      ******************************************************************09917315
       3000-CHECK-CLEARANCE.                                            09917415
                                                                        09917515
           IF XS051-PROMO-ID = 0                                        09917615
               DISPLAY 'PROCESSING SKU CLEARANCE NO ID CSR - 1 OF 5'    09917715
               SET PS-HIER-SKU-CDE    TO TRUE                           09917815
               PERFORM 3010-GET-SKU-CLR-NOID                            09917915
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       09918015
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    09918115
                                                                        09918215
               DISPLAY 'PROCESSING STY CLEARANCE NO ID CSR - 2 OF 5'    09918315
               SET PS-HIER-STY-CDE    TO TRUE                           09918415
               PERFORM 3020-GET-STY-CLR-NOID                            09918515
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       09918615
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    09918715
                                                                        09918815
               DISPLAY 'PROCESSING SCL CLEARANCE NO ID CSR - 3 OF 5'    09918915
               SET PS-HIER-SCL-CDE    TO TRUE                           09919015
               PERFORM 3030-GET-SCL-CLR-NOID                            09919115
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       09919215
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    09919315
                                                                        09919415
               DISPLAY 'PROCESSING MCL CLEARANCE NO ID CSR - 4 OF 5'    09919515
               SET PS-HIER-MCL-CDE    TO TRUE                           09919615
               PERFORM 3040-GET-MCL-CLR-NOID                            09919715
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       09919815
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    09919915
                                                                        09920015
               DISPLAY 'PROCESSING DPT CLEARANCE NO ID CSR - 5 OF 5'    09930015
               SET PS-HIER-DPT-CDE    TO TRUE                           09940015
               PERFORM 3050-GET-DPT-CLR-NOID                            09950015
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       09960015
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    09970015
           ELSE                                                         09980015
               DISPLAY 'PROCESSING SKU CLEARANCE W/ ID CSR - 1 OF 5'    09990015
               SET PS-HIER-SKU-CDE    TO TRUE                           10000015
               PERFORM 3060-GET-SKU-CLR-WID                             10001015
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       10002015
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    10003015
                                                                        10004015
               DISPLAY 'PROCESSING STY CLEARANCE W/ ID CSR - 2 OF 5'    10005015
               SET PS-HIER-STY-CDE    TO TRUE                           10006015
               PERFORM 3070-GET-STY-CLR-WID                             10007015
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       10008015
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    10009015
                                                                        10010015
               DISPLAY 'PROCESSING SCL CLEARANCE W/ ID CSR - 3 OF 5'    10020015
               SET PS-HIER-SCL-CDE    TO TRUE                           10030015
               PERFORM 3080-GET-SCL-CLR-WID                             10040015
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       10050015
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    10060015
                                                                        10070015
               DISPLAY 'PROCESSING MCL CLEARANCE W/ ID CSR - 4 OF 5'    10080015
               SET PS-HIER-MCL-CDE    TO TRUE                           10090015
               PERFORM 3090-GET-MCL-CLR-WID                             10100015
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       10110015
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    10120015
                                                                        10130015
               DISPLAY 'PROCESSING DPT CLEARANCE W/ ID CSR - 5 OF 5'    10140015
               SET PS-HIER-DPT-CDE    TO TRUE                           10150015
               PERFORM 3100-GET-DPT-CLR-WID                             10160015
W36026         PERFORM 7500-SET-CURRENT-TIMESTAMP                       10170015
W36026         DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP    10180015
           END-IF.                                                      10190015
                                                                        10200015
      ******************************************************************10201015
      * CHECK SKU LEVEL CLEARANCE W/NO PROMO-ID                         10202015
      ******************************************************************10203015
       3010-GET-SKU-CLR-NOID.                                           10204015
                                                                        10205015
           SET PS-NOT-EOF-CSR       TO TRUE.                            10206015
           PERFORM 3011-OPN-SKU-CLR-NOID-CSR.                           10207015
           PERFORM 3012-FET-SKU-CLR-NOID-CSR.                           10208015
           PERFORM 3013-PROCESS-SKU-CLR-NOID-CSR UNTIL PS-END-OF-CSR.   10209015
           PERFORM 3014-CLS-SKU-CLR-NOID-CSR.                           10210015
                                                                        10220015
      ******************************************************************10230015
      * OPEN CLEARANCE PRICE - PRICED AT SKU LEVEL W/NO PROMO ID        10240015
      ******************************************************************10250015
       3011-OPN-SKU-CLR-NOID-CSR.                                       10260015
                                                                        10270015
           EXEC SQL                                                     10280015
                OPEN SKU-CLR-NOID-CSR                                   10290015
           END-EXEC.                                                    10300015
                                                                        10310015
           EVALUATE TRUE                                                10320015
               WHEN SQLCODE = ZERO                                      10330015
                   CONTINUE                                             10340015
                                                                        10350015
               WHEN OTHER                                               10360015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  10370015
                   MOVE '3011-OPN-SKU-CLR-NOID-CSR'                     10380015
                                    TO PV-PARAGRAPH-NAME                10390015
                   PERFORM Z900-SQL-ABEND                               10400015
           END-EVALUATE.                                                10410015
                                                                        10420015
      ******************************************************************10430015
      * GET CLEARANCE PRICE - PRICED AT SKU LEVEL W/NO PROMO ID         10440015
      ******************************************************************10450015
       3012-FET-SKU-CLR-NOID-CSR.                                       10460015
                                                                        10470015
           EXEC SQL                                                     10480015
                FETCH SKU-CLR-NOID-CSR                                  10490015
                 INTO :XST00028-PROMO-INTFC-ID                          10500015
                    , :XST00028-MDSE-LNE-ID                             10510015
                    , :XST00028-PRICG-TYP-CDE                           10520015
                    , :XST00028-ADV-CDE                                 10530015
                      :PV-ADV-CDE-NULL-IND                              10540015
                    , :XST00028-PROMO-ID                                10550015
                    , :XST00028-TKT-CLOR-CDE                            10560015
                    , :GTTPRICD-SKU-NBR                                 10570015
                    , :GTTPRICD-INTR-UPC-ID                             10580015
                    , :GTTPRICD-UNT-RTL-AMT                             10590015
                    , :GTTPRICD-GP-RTL-QTY                              10600015
                    , :GTTPRICD-GP-RTL-AMT                              10610015
                    , :GTTPRICD-UPC-NBR                                 10620015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         10630015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        10640015
           END-EXEC.                                                    10650015
                                                                        10660015
           EVALUATE TRUE                                                10670015
               WHEN SQLCODE = ZERO                                      10680015
                   IF PV-ADV-CDE-NULL-IND < 0                           10690015
                       MOVE SPACES              TO XST00028-ADV-CDE     10700015
                   END-IF                                               10710015
                                                                        10720015
               WHEN SQLCODE = +100                                      10730015
                   SET PS-END-OF-CSR            TO TRUE                 10740015
                                                                        10750015
               WHEN OTHER                                               10760015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  10770015
                   MOVE '3012-FET-SKU-CLR-NOID-CSR'                     10780015
                                                TO PV-PARAGRAPH-NAME    10790015
                   PERFORM Z900-SQL-ABEND                               10800015
           END-EVALUATE.                                                10810015
                                                                        10820015
      ******************************************************************10830015
      * PROCESS SKU LEVEL CLEARENCE PRICE W/NO PROMO-ID                 10840015
      ******************************************************************10850015
       3013-PROCESS-SKU-CLR-NOID-CSR.                                   10860015
                                                                        10870015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        10880015
           PERFORM 3012-FET-SKU-CLR-NOID-CSR.                           10890015
                                                                        10900015
      ******************************************************************10910015
      * CLOSE CLEARANCE PRICE - PRICED AT SKU LEVEL W/NO PROMO ID       10920015
      ******************************************************************10930015
       3014-CLS-SKU-CLR-NOID-CSR.                                       10940015
                                                                        10950015
           EXEC SQL                                                     10960015
                CLOSE SKU-CLR-NOID-CSR                                  10970015
           END-EXEC.                                                    10980015
                                                                        10990015
           EVALUATE TRUE                                                11000015
               WHEN SQLCODE = ZERO                                      11010015
                   CONTINUE                                             11020015
                                                                        11030015
               WHEN OTHER                                               11040015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  11050015
                   MOVE '3014-CLS-SKU-CLR-NOID-CSR'                     11060015
                                    TO PV-PARAGRAPH-NAME                11070015
                   PERFORM Z900-SQL-ABEND                               11080015
           END-EVALUATE.                                                11090015
                                                                        11100015
      ******************************************************************11110015
      * CHECK STYLE LEVEL CLEARANCE W/NO PROMO-ID                       11120015
      ******************************************************************11130015
       3020-GET-STY-CLR-NOID.                                           11140015
                                                                        11150015
           SET PS-NOT-EOF-CSR       TO TRUE.                            11160015
           PERFORM 3021-OPN-STY-CLR-NOID-CSR.                           11170015
           PERFORM 3022-FET-STY-CLR-NOID-CSR.                           11180015
           PERFORM 3023-PROCESS-STY-CLR-NOID-CSR UNTIL PS-END-OF-CSR.   11190015
           PERFORM 3024-CLS-STY-CLR-NOID-CSR.                           11200015
                                                                        11210015
      ******************************************************************11220015
      * OPEN CLEARANCE PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID      11230015
      ******************************************************************11240015
       3021-OPN-STY-CLR-NOID-CSR.                                       11250015
                                                                        11260015
           EXEC SQL                                                     11270015
                OPEN STY-CLR-NOID-CSR                                   11280015
           END-EXEC.                                                    11290015
                                                                        11300015
           EVALUATE TRUE                                                11310015
               WHEN SQLCODE = ZERO                                      11320015
                   CONTINUE                                             11330015
                                                                        11340015
               WHEN OTHER                                               11350015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  11360015
                   MOVE '3021-OPN-STY-CLR-NO-ID-CSR'                    11370015
                                    TO PV-PARAGRAPH-NAME                11380015
                   PERFORM Z900-SQL-ABEND                               11390015
           END-EVALUATE.                                                11400015
                                                                        11410015
      ******************************************************************11420015
      * GET CLEARANCE PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID       11430015
      ******************************************************************11440015
       3022-FET-STY-CLR-NOID-CSR.                                       11450015
                                                                        11460015
           EXEC SQL                                                     11470015
                FETCH STY-CLR-NOID-CSR                                  11480015
                 INTO :XST00028-PROMO-INTFC-ID                          11490015
                    , :XST00028-MDSE-LNE-ID                             11500015
                    , :XST00028-PRICG-TYP-CDE                           11510015
                    , :XST00028-ADV-CDE                                 11520015
                      :PV-ADV-CDE-NULL-IND                              11530015
                    , :XST00028-PROMO-ID                                11540015
                    , :XST00028-TKT-CLOR-CDE                            11550015
                    , :GTTPRICD-SKU-NBR                                 11560015
                    , :GTTPRICD-INTR-UPC-ID                             11570015
                    , :GTTPRICD-UNT-RTL-AMT                             11580015
                    , :GTTPRICD-GP-RTL-QTY                              11590015
                    , :GTTPRICD-GP-RTL-AMT                              11600015
                    , :GTTPRICD-UPC-NBR                                 11610015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         11620015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        11630015
           END-EXEC.                                                    11640015
                                                                        11650015
           EVALUATE TRUE                                                11660015
               WHEN SQLCODE = ZERO                                      11670015
                   IF PV-ADV-CDE-NULL-IND < 0                           11680015
                       MOVE SPACES              TO XST00028-ADV-CDE     11690015
                   END-IF                                               11700015
                                                                        11710015
               WHEN SQLCODE = +100                                      11720015
                   SET PS-END-OF-CSR            TO TRUE                 11730015
                                                                        11740015
               WHEN OTHER                                               11750015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  11760015
                   MOVE '3022-FET-STY-CLR-NOID-CSR'                     11770015
                                                TO PV-PARAGRAPH-NAME    11780015
                   PERFORM Z900-SQL-ABEND                               11790015
           END-EVALUATE.                                                11800015
                                                                        11810015
      ******************************************************************11820015
      * PROCESS STYLE LEVEL CLEARENCE PRICE W/NO PROMO-ID               11830015
      ******************************************************************11840015
       3023-PROCESS-STY-CLR-NOID-CSR.                                   11850015
                                                                        11860015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        11870015
           PERFORM 3022-FET-STY-CLR-NOID-CSR.                           11880015
                                                                        11890015
      ******************************************************************11900015
      * CLOSE CLEARANCE PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID     11910015
      ******************************************************************11920015
       3024-CLS-STY-CLR-NOID-CSR.                                       11930015
                                                                        11940015
           EXEC SQL                                                     11950015
                CLOSE STY-CLR-NOID-CSR                                  11960015
           END-EXEC.                                                    11970015
                                                                        11980015
           EVALUATE TRUE                                                11990015
               WHEN SQLCODE = ZERO                                      12000015
                   CONTINUE                                             12010015
                                                                        12020015
               WHEN OTHER                                               12030015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  12040015
                   MOVE '3024-CLS-STY-CLR-NOID-CSR'                     12050015
                                    TO PV-PARAGRAPH-NAME                12060015
                   PERFORM Z900-SQL-ABEND                               12070015
           END-EVALUATE.                                                12080015
                                                                        12090015
      ******************************************************************12100015
      * CHECK SUB CLASS LEVEL CLEARANCE W/NO PROMO-ID                   12110015
      ******************************************************************12120015
       3030-GET-SCL-CLR-NOID.                                           12130015
                                                                        12140015
           SET PS-NOT-EOF-CSR       TO TRUE.                            12150015
           PERFORM 3031-OPN-SCL-CLR-NOID-CSR.                           12160015
           PERFORM 3032-FET-SCL-CLR-NOID-CSR.                           12170015
           PERFORM 3033-PROCESS-SCL-CLR-NOID-CSR UNTIL PS-END-OF-CSR.   12180015
           PERFORM 3034-CLS-SCL-CLR-NOID-CSR.                           12190015
                                                                        12200015
      ******************************************************************12210015
      * OPEN CLEARANCE PRICE - PRICED AT SCL LEVEL W/NO PROMO ID        12220015
      ******************************************************************12230015
       3031-OPN-SCL-CLR-NOID-CSR.                                       12240015
                                                                        12250015
           EXEC SQL                                                     12260015
                OPEN SCL-CLR-NOID-CSR                                   12270015
           END-EXEC.                                                    12280015
                                                                        12290015
           EVALUATE TRUE                                                12300015
               WHEN SQLCODE = ZERO                                      12310015
                   CONTINUE                                             12320015
                                                                        12330015
               WHEN OTHER                                               12340015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  12350015
                   MOVE '3031-OPN-SCL-CLR-NOID-CSR'                     12360015
                                    TO PV-PARAGRAPH-NAME                12370015
                   PERFORM Z900-SQL-ABEND                               12380015
           END-EVALUATE.                                                12390015
                                                                        12400015
      ******************************************************************12410015
      * GET CLEARANCE PRICE - PRICED AT SCL LEVEL W/NO PROMO ID         12420015
      ******************************************************************12430015
       3032-FET-SCL-CLR-NOID-CSR.                                       12440015
                                                                        12450015
           EXEC SQL                                                     12460015
                FETCH SCL-CLR-NOID-CSR                                  12470015
                 INTO :XST00028-PROMO-INTFC-ID                          12480015
                    , :XST00028-MDSE-LNE-ID                             12490015
                    , :XST00028-PRICG-TYP-CDE                           12500015
                    , :XST00028-ADV-CDE                                 12510015
                      :PV-ADV-CDE-NULL-IND                              12520015
                    , :XST00028-PROMO-ID                                12530015
                    , :XST00013-MAJ-CL-NBR                              12540015
                    , :XST00013-SUB-CL-NBR                              12550015
                    , :GTTPRICD-SKU-NBR                                 12560015
                    , :GTTPRICD-INTR-UPC-ID                             12570015
                    , :GTTPRICD-UNT-RTL-AMT                             12580015
                    , :GTTPRICD-GP-RTL-QTY                              12590015
                    , :GTTPRICD-GP-RTL-AMT                              12600015
                    , :GTTPRICD-UPC-NBR                                 12610015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         12620015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        12630015
           END-EXEC.                                                    12640015
                                                                        12650015
           EVALUATE TRUE                                                12660015
               WHEN SQLCODE = ZERO                                      12670015
                   IF PV-ADV-CDE-NULL-IND < 0                           12680015
                       MOVE SPACES              TO XST00028-ADV-CDE     12690015
                   END-IF                                               12700015
                                                                        12710015
               WHEN SQLCODE = +100                                      12720015
                   SET PS-END-OF-CSR            TO TRUE                 12730015
                                                                        12740015
               WHEN OTHER                                               12750015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  12760015
                   MOVE '3032-FET-SCL-CLR-NOID-CSR'                     12770015
                                                TO PV-PARAGRAPH-NAME    12780015
                   PERFORM Z900-SQL-ABEND                               12790015
           END-EVALUATE.                                                12800015
                                                                        12810015
      ******************************************************************12820015
      * PROCESS SCL LEVEL CLEARENCE PRICE W/NO PROMO-ID                 12830015
      ******************************************************************12840015
       3033-PROCESS-SCL-CLR-NOID-CSR.                                   12850015
                                                                        12860015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        12870015
           PERFORM 3032-FET-SCL-CLR-NOID-CSR.                           12880015
                                                                        12890015
      ******************************************************************12900015
      * CLOSE CLEARANCE PRICE - PRICED AT SCL LEVEL W/NO PROMO ID       12910015
      ******************************************************************12920015
       3034-CLS-SCL-CLR-NOID-CSR.                                       12930015
                                                                        12940015
           EXEC SQL                                                     12950015
                CLOSE SCL-CLR-NOID-CSR                                  12960015
           END-EXEC.                                                    12970015
                                                                        12980015
           EVALUATE TRUE                                                12990015
               WHEN SQLCODE = ZERO                                      13000015
                   CONTINUE                                             13010015
                                                                        13020015
               WHEN OTHER                                               13030015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  13040015
                   MOVE '3034-CLS-SCL-CLR-NOID-CSR'                     13050015
                                    TO PV-PARAGRAPH-NAME                13060015
                   PERFORM Z900-SQL-ABEND                               13070015
           END-EVALUATE.                                                13080015
                                                                        13081015
      ******************************************************************13082015
      * CHECK MAJ CLASS LEVEL CLEARANCE W/NO PROMO-ID                   13083015
      ******************************************************************13084015
       3040-GET-MCL-CLR-NOID.                                           13085015
                                                                        13086015
           SET PS-NOT-EOF-CSR       TO TRUE.                            13087015
           PERFORM 3041-OPN-MCL-CLR-NOID-CSR.                           13088015
           PERFORM 3042-FET-MCL-CLR-NOID-CSR.                           13089015
           PERFORM 3043-PROCESS-MCL-CLR-NOID-CSR UNTIL PS-END-OF-CSR.   13090015
           PERFORM 3044-CLS-MCL-CLR-NOID-CSR.                           13100015
                                                                        13110015
      ******************************************************************13120015
      * OPEN CLEARANCE PRICE - PRICED AT MCL LEVEL W/NO PROMO ID        13130015
      ******************************************************************13140015
       3041-OPN-MCL-CLR-NOID-CSR.                                       13150015
                                                                        13160015
           EXEC SQL                                                     13170015
                OPEN MCL-CLR-NOID-CSR                                   13180015
           END-EXEC.                                                    13190015
                                                                        13200015
           EVALUATE TRUE                                                13210015
               WHEN SQLCODE = ZERO                                      13220015
                   CONTINUE                                             13230015
                                                                        13240015
               WHEN OTHER                                               13250015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  13260015
                   MOVE '3041-OPN-MCL-CLR-NOID-CSR'                     13270015
                                    TO PV-PARAGRAPH-NAME                13280015
                   PERFORM Z900-SQL-ABEND                               13290015
           END-EVALUATE.                                                13300015
                                                                        13310015
      ******************************************************************13320015
      * GET CLEARANCE PRICE - PRICED AT MCL LEVEL W/NO PROMO ID         13330015
      ******************************************************************13340015
       3042-FET-MCL-CLR-NOID-CSR.                                       13350015
                                                                        13360015
           EXEC SQL                                                     13370015
                FETCH MCL-CLR-NOID-CSR                                  13380015
                 INTO :XST00028-PROMO-INTFC-ID                          13390015
                    , :XST00028-MDSE-LNE-ID                             13400015
                    , :XST00028-PRICG-TYP-CDE                           13410015
                    , :XST00028-ADV-CDE                                 13420015
                      :PV-ADV-CDE-NULL-IND                              13430015
                    , :XST00028-PROMO-ID                                13440015
                    , :XST00028-TKT-CLOR-CDE                            13450015
                    , :XST00013-MAJ-CL-NBR                              13460015
                    , :XST00013-SUB-CL-NBR                              13470015
                    , :GTTPRICD-SKU-NBR                                 13480015
                    , :GTTPRICD-INTR-UPC-ID                             13490015
                    , :GTTPRICD-UNT-RTL-AMT                             13500015
                    , :GTTPRICD-GP-RTL-QTY                              13510015
                    , :GTTPRICD-GP-RTL-AMT                              13520015
                    , :GTTPRICD-UPC-NBR                                 13530015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         13540015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        13550015
           END-EXEC.                                                    13560015
                                                                        13570015
           EVALUATE TRUE                                                13580015
               WHEN SQLCODE = ZERO                                      13590015
                   IF PV-ADV-CDE-NULL-IND < 0                           13600015
                       MOVE SPACES              TO XST00028-ADV-CDE     13610015
                   END-IF                                               13620015
                                                                        13630015
               WHEN SQLCODE = +100                                      13640015
                   SET PS-END-OF-CSR            TO TRUE                 13650015
                                                                        13660015
               WHEN OTHER                                               13670015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  13680015
                   MOVE '3042-FET-MCL-CLR-NOID-CSR'                     13690015
                                                TO PV-PARAGRAPH-NAME    13700015
                   PERFORM Z900-SQL-ABEND                               13710015
           END-EVALUATE.                                                13720015
                                                                        13730015
      ******************************************************************13740015
      * PROCESS MCL LEVEL CLEARENCE PRICE W/NO PROMO-ID                 13750015
      ******************************************************************13760015
       3043-PROCESS-MCL-CLR-NOID-CSR.                                   13770015
                                                                        13780015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        13790015
           PERFORM 3042-FET-MCL-CLR-NOID-CSR.                           13800015
                                                                        13810015
      ******************************************************************13820015
      * CLOSE CLEARANCE PRICE - PRICED AT MCL LEVEL W/NO PROMO ID       13830015
      ******************************************************************13840015
       3044-CLS-MCL-CLR-NOID-CSR.                                       13850015
                                                                        13860015
           EXEC SQL                                                     13870015
                CLOSE MCL-CLR-NOID-CSR                                  13880015
           END-EXEC.                                                    13890015
                                                                        13900015
           EVALUATE TRUE                                                13910015
               WHEN SQLCODE = ZERO                                      13920015
                   CONTINUE                                             13930015
                                                                        13940015
               WHEN OTHER                                               13950015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  13960015
                   MOVE '3044-CLS-MCL-CLR-NOID-CSR'                     13970015
                                    TO PV-PARAGRAPH-NAME                13980015
                   PERFORM Z900-SQL-ABEND                               13990015
           END-EVALUATE.                                                14000015
                                                                        14010015
      ******************************************************************14020015
      * CHECK DEPT LEVEL CLEARANCE W/NO PROMO-ID                        14030015
      ******************************************************************14040015
       3050-GET-DPT-CLR-NOID.                                           14050015
                                                                        14060015
           SET PS-NOT-EOF-CSR       TO TRUE.                            14070015
           PERFORM 3051-OPN-DPT-CLR-NOID-CSR.                           14080015
           PERFORM 3052-FET-DPT-CLR-NOID-CSR.                           14090015
           PERFORM 3053-PROCESS-DPT-CLR-NOID-CSR UNTIL PS-END-OF-CSR.   14100015
           PERFORM 3054-CLS-DPT-CLR-NOID-CSR.                           14110015
                                                                        14120015
      ******************************************************************14130015
      * OPEN CLEARANCE PRICE - PRICED AT DPT LEVEL W/NO PROMO ID        14140015
      ******************************************************************14150015
       3051-OPN-DPT-CLR-NOID-CSR.                                       14160015
                                                                        14170015
           EXEC SQL                                                     14180015
                OPEN DPT-CLR-NOID-CSR                                   14190015
           END-EXEC.                                                    14200015
                                                                        14210015
           EVALUATE TRUE                                                14220015
               WHEN SQLCODE = ZERO                                      14230015
                   CONTINUE                                             14240015
                                                                        14250015
               WHEN OTHER                                               14260015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  14270015
                   MOVE '3051-OPN-DPT-CLR-NOID-CSR'                     14280015
                                    TO PV-PARAGRAPH-NAME                14290015
                   PERFORM Z900-SQL-ABEND                               14300015
           END-EVALUATE.                                                14310015
                                                                        14320015
      ******************************************************************14330015
      * GET CLEARANCE PRICE - PRICED AT DPT LEVEL W/NO PROMO ID         14340015
      ******************************************************************14350015
       3052-FET-DPT-CLR-NOID-CSR.                                       14360015
                                                                        14370015
           EXEC SQL                                                     14380015
                FETCH DPT-CLR-NOID-CSR                                  14390015
                 INTO :XST00028-PROMO-INTFC-ID                          14400015
                    , :XST00028-MDSE-LNE-ID                             14410015
                    , :XST00028-PRICG-TYP-CDE                           14420015
                    , :XST00028-ADV-CDE                                 14430015
                      :PV-ADV-CDE-NULL-IND                              14440015
                    , :XST00028-PROMO-ID                                14450015
                    , :XST00028-TKT-CLOR-CDE                            14460015
                    , :XST00013-MAJ-CL-NBR                              14470015
                    , :XST00013-SUB-CL-NBR                              14480015
                    , :GTTPRICD-SKU-NBR                                 14490015
                    , :GTTPRICD-INTR-UPC-ID                             14500015
                    , :GTTPRICD-UNT-RTL-AMT                             14510015
                    , :GTTPRICD-GP-RTL-QTY                              14520015
                    , :GTTPRICD-GP-RTL-AMT                              14530015
                    , :GTTPRICD-UPC-NBR                                 14540015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         14550015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        14560015
           END-EXEC.                                                    14570015
                                                                        14580015
           EVALUATE TRUE                                                14590015
               WHEN SQLCODE = ZERO                                      14600015
                   IF PV-ADV-CDE-NULL-IND < 0                           14610015
                       MOVE SPACES              TO XST00028-ADV-CDE     14620015
                   END-IF                                               14630015
                                                                        14640015
               WHEN SQLCODE = +100                                      14650015
                   SET PS-END-OF-CSR            TO TRUE                 14660015
                                                                        14670015
               WHEN OTHER                                               14680015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  14690015
                   MOVE '3052-FET-DPT-CLR-NOID-CSR'                     14700015
                                                TO PV-PARAGRAPH-NAME    14710015
                   PERFORM Z900-SQL-ABEND                               14720015
           END-EVALUATE.                                                14730015
                                                                        14740015
      ******************************************************************14750015
      * PROCESS DPT LEVEL CLEARENCE PRICE W/NO PROMO-ID                 14760015
      ******************************************************************14770015
       3053-PROCESS-DPT-CLR-NOID-CSR.                                   14780015
                                                                        14790015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        14800015
           PERFORM 3052-FET-DPT-CLR-NOID-CSR.                           14810015
                                                                        14820015
      ******************************************************************14830015
      * CLOSE CLEARANCE PRICE - PRICED AT DPT LEVEL W/NO PROMO ID       14840015
      ******************************************************************14850015
       3054-CLS-DPT-CLR-NOID-CSR.                                       14860015
                                                                        14870015
           EXEC SQL                                                     14880015
                CLOSE DPT-CLR-NOID-CSR                                  14890015
           END-EXEC.                                                    14900015
                                                                        14910015
           EVALUATE TRUE                                                14920015
               WHEN SQLCODE = ZERO                                      14930015
                   CONTINUE                                             14940015
                                                                        14950015
               WHEN OTHER                                               14960015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  14970015
                   MOVE '3054-CLS-DPT-CLR-NOID-CSR'                     14980015
                                    TO PV-PARAGRAPH-NAME                14990015
                   PERFORM Z900-SQL-ABEND                               15000015
           END-EVALUATE.                                                15001015
                                                                        15002015
      ******************************************************************15003015
      * CHECK SKU LEVEL CLEARANCE W/ PROMO-ID                           15004015
      ******************************************************************15005015
       3060-GET-SKU-CLR-WID.                                            15006015
                                                                        15007015
           SET PS-NOT-EOF-CSR       TO TRUE.                            15008015
           PERFORM 3061-OPN-SKU-CLR-WID-CSR.                            15009015
           PERFORM 3062-FET-SKU-CLR-WID-CSR.                            15010015
           PERFORM 3063-PROCESS-SKU-CLR-WID-CSR UNTIL PS-END-OF-CSR.    15020015
           PERFORM 3064-CLS-SKU-CLR-WID-CSR.                            15030015
                                                                        15040015
      ******************************************************************15050015
      * OPEN CLEARANCE PRICE - PRICED AT SKU LEVEL W/ PROMO ID          15060015
      ******************************************************************15070015
       3061-OPN-SKU-CLR-WID-CSR.                                        15080015
                                                                        15090015
           EXEC SQL                                                     15100015
                OPEN SKU-CLR-WID-CSR                                    15110015
           END-EXEC.                                                    15120015
                                                                        15130015
           EVALUATE TRUE                                                15140015
               WHEN SQLCODE = ZERO                                      15150015
                   CONTINUE                                             15160015
                                                                        15170015
               WHEN OTHER                                               15180015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    15190015
                   MOVE '3061-OPN-SKU-CLR-WID-CSR'                      15200015
                                    TO PV-PARAGRAPH-NAME                15210015
                   PERFORM Z900-SQL-ABEND                               15220015
           END-EVALUATE.                                                15230015
                                                                        15240015
      ******************************************************************15250015
      * GET CLEARANCE PRICE - PRICED AT SKU LEVEL W/ PROMO ID           15260015
      ******************************************************************15270015
       3062-FET-SKU-CLR-WID-CSR.                                        15280015
                                                                        15290015
           EXEC SQL                                                     15300015
                FETCH SKU-CLR-WID-CSR                                   15310015
                 INTO :XST00028-PROMO-INTFC-ID                          15320015
                    , :XST00028-MDSE-LNE-ID                             15330015
                    , :XST00028-PRICG-TYP-CDE                           15340015
                    , :XST00028-ADV-CDE                                 15350015
                      :PV-ADV-CDE-NULL-IND                              15360015
                    , :XST00028-PROMO-ID                                15370015
                    , :XST00028-TKT-CLOR-CDE                            15380015
                    , :GTTPRICD-SKU-NBR                                 15390015
                    , :GTTPRICD-INTR-UPC-ID                             15400015
                    , :GTTPRICD-UNT-RTL-AMT                             15410015
                    , :GTTPRICD-GP-RTL-QTY                              15420015
                    , :GTTPRICD-GP-RTL-AMT                              15430015
                    , :GTTPRICD-UPC-NBR                                 15440015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         15450015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        15460015
           END-EXEC.                                                    15470015
                                                                        15480015
           EVALUATE TRUE                                                15490015
               WHEN SQLCODE = ZERO                                      15500015
                   IF PV-ADV-CDE-NULL-IND < 0                           15510015
                       MOVE SPACES              TO XST00028-ADV-CDE     15520015
                   END-IF                                               15530015
                                                                        15540015
               WHEN SQLCODE = +100                                      15550015
                   SET PS-END-OF-CSR            TO TRUE                 15560015
                                                                        15570015
               WHEN OTHER                                               15580015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    15590015
                   MOVE '3062-FET-SKU-CLR-WID-CSR'                      15600015
                                                TO PV-PARAGRAPH-NAME    15610015
                   PERFORM Z900-SQL-ABEND                               15620015
           END-EVALUATE.                                                15630015
                                                                        15640015
      ******************************************************************15650015
      * PROCESS SKU LEVEL CLEARENCE PRICE W/ PROMO-ID                   15660015
      ******************************************************************15670015
       3063-PROCESS-SKU-CLR-WID-CSR.                                    15680015
                                                                        15690015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        15700015
           PERFORM 3062-FET-SKU-CLR-WID-CSR.                            15710015
                                                                        15720015
      ******************************************************************15730015
      * CLOSE CLEARANCE PRICE - PRICED AT SKU LEVEL W/ PROMO ID         15740015
      ******************************************************************15750015
       3064-CLS-SKU-CLR-WID-CSR.                                        15760015
                                                                        15770015
           EXEC SQL                                                     15780015
                CLOSE SKU-CLR-WID-CSR                                   15790015
           END-EXEC.                                                    15800015
                                                                        15810015
           EVALUATE TRUE                                                15820015
               WHEN SQLCODE = ZERO                                      15830015
                   CONTINUE                                             15840015
                                                                        15850015
               WHEN OTHER                                               15860015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    15870015
                   MOVE '3064-CLS-SKU-CLR-WID-CSR'                      15880015
                                    TO PV-PARAGRAPH-NAME                15890015
                   PERFORM Z900-SQL-ABEND                               15900015
           END-EVALUATE.                                                15910015
                                                                        15920015
      ******************************************************************15930015
      * CHECK STYLE LEVEL CLEARANCE W/ PROMO-ID                         15940015
      ******************************************************************15950015
       3070-GET-STY-CLR-WID.                                            15960015
                                                                        15970015
           SET PS-NOT-EOF-CSR       TO TRUE.                            15980015
           PERFORM 3071-OPN-STY-CLR-WID-CSR.                            15990015
           PERFORM 3072-FET-STY-CLR-WID-CSR.                            16000015
           PERFORM 3073-PROCESS-STY-CLR-WID-CSR UNTIL PS-END-OF-CSR.    16010015
           PERFORM 3074-CLS-STY-CLR-WID-CSR.                            16020015
                                                                        16030015
      ******************************************************************16040015
      * OPEN CLEARANCE PRICE - PRICED AT STYLE LEVEL W/ PROMO ID        16050015
      ******************************************************************16060015
       3071-OPN-STY-CLR-WID-CSR.                                        16070015
                                                                        16080015
           EXEC SQL                                                     16090015
                OPEN STY-CLR-WID-CSR                                    16100015
           END-EXEC.                                                    16110015
                                                                        16120015
           EVALUATE TRUE                                                16130015
               WHEN SQLCODE = ZERO                                      16140015
                   CONTINUE                                             16150015
                                                                        16160015
               WHEN OTHER                                               16170015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    16180015
                   MOVE '3071-OPN-STY-CLR-WID-CSR'                      16190015
                                    TO PV-PARAGRAPH-NAME                16200015
                   PERFORM Z900-SQL-ABEND                               16210015
           END-EVALUATE.                                                16220015
                                                                        16230015
      ******************************************************************16240015
      * GET CLEARANCE PRICE - PRICED AT STYLE LEVEL W/ PROMO ID         16250015
      ******************************************************************16260015
       3072-FET-STY-CLR-WID-CSR.                                        16270015
                                                                        16280015
           EXEC SQL                                                     16290015
                FETCH STY-CLR-WID-CSR                                   16300015
                 INTO :XST00028-PROMO-INTFC-ID                          16310015
                    , :XST00028-MDSE-LNE-ID                             16320015
                    , :XST00028-PRICG-TYP-CDE                           16330015
                    , :XST00028-ADV-CDE                                 16340015
                      :PV-ADV-CDE-NULL-IND                              16350015
                    , :XST00028-PROMO-ID                                16360015
                    , :XST00028-TKT-CLOR-CDE                            16370015
                    , :GTTPRICD-SKU-NBR                                 16380015
                    , :GTTPRICD-INTR-UPC-ID                             16390015
                    , :GTTPRICD-UNT-RTL-AMT                             16400015
                    , :GTTPRICD-GP-RTL-QTY                              16410015
                    , :GTTPRICD-GP-RTL-AMT                              16420015
                    , :GTTPRICD-UPC-NBR                                 16430015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         16440015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        16450015
           END-EXEC.                                                    16460015
                                                                        16470015
           EVALUATE TRUE                                                16480015
               WHEN SQLCODE = ZERO                                      16490015
                   IF PV-ADV-CDE-NULL-IND < 0                           16500015
                       MOVE SPACES              TO XST00028-ADV-CDE     16510015
                   END-IF                                               16520015
                                                                        16530015
               WHEN SQLCODE = +100                                      16540015
                   SET PS-END-OF-CSR            TO TRUE                 16550015
                                                                        16560015
               WHEN OTHER                                               16570015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    16580015
                   MOVE '3072-FET-STY-CLR-WID-CSR'                      16590015
                                                TO PV-PARAGRAPH-NAME    16600015
                   PERFORM Z900-SQL-ABEND                               16610015
           END-EVALUATE.                                                16620015
                                                                        16630015
      ******************************************************************16640015
      * PROCESS STY LEVEL CLEARENCE PRICE W/ PROMO-ID                   16650015
      ******************************************************************16660015
       3073-PROCESS-STY-CLR-WID-CSR.                                    16670015
                                                                        16680015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        16690015
           PERFORM 3072-FET-STY-CLR-WID-CSR.                            16700015
                                                                        16710015
      ******************************************************************16720015
      * CLOSE CLEARANCE PRICE - PRICED AT STYLE LEVEL W/ PROMO ID       16730015
      ******************************************************************16740015
       3074-CLS-STY-CLR-WID-CSR.                                        16750015
                                                                        16760015
           EXEC SQL                                                     16770015
                CLOSE STY-CLR-WID-CSR                                   16780015
           END-EXEC.                                                    16790015
                                                                        16800015
           EVALUATE TRUE                                                16810015
               WHEN SQLCODE = ZERO                                      16820015
                   CONTINUE                                             16830015
                                                                        16840015
               WHEN OTHER                                               16850015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    16860015
                   MOVE '3074-CLS-STY-CLR-WID-CSR'                      16870015
                                    TO PV-PARAGRAPH-NAME                16880015
                   PERFORM Z900-SQL-ABEND                               16881015
           END-EVALUATE.                                                16882015
                                                                        16883015
      ******************************************************************16884015
      * CHECK SUB CLASS LEVEL CLEARANCE W/ PROMO-ID                     16885015
      ******************************************************************16886015
       3080-GET-SCL-CLR-WID.                                            16887015
                                                                        16888015
           SET PS-NOT-EOF-CSR       TO TRUE.                            16889015
           PERFORM 3081-OPN-SCL-CLR-WID-CSR.                            16890015
           PERFORM 3082-FET-SCL-CLR-WID-CSR.                            16900015
           PERFORM 3083-PROCESS-SCL-CLR-WID-CSR UNTIL PS-END-OF-CSR.    16910015
           PERFORM 3084-CLS-SCL-CLR-WID-CSR.                            16920015
                                                                        16930015
      ******************************************************************16940015
      * OPEN CLEARANCE PRICE - PRICED AT SCL LEVEL W/ PROMO ID          16950015
      ******************************************************************16960015
       3081-OPN-SCL-CLR-WID-CSR.                                        16970015
                                                                        16980015
           EXEC SQL                                                     16990015
                OPEN SCL-CLR-WID-CSR                                    17000015
           END-EXEC.                                                    17010015
                                                                        17020015
           EVALUATE TRUE                                                17030015
               WHEN SQLCODE = ZERO                                      17040015
                   CONTINUE                                             17050015
                                                                        17060015
               WHEN OTHER                                               17070015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    17080015
                   MOVE '3081-OPN-SCL-CLR-WID-CSR'                      17090015
                                    TO PV-PARAGRAPH-NAME                17100015
                   PERFORM Z900-SQL-ABEND                               17110015
           END-EVALUATE.                                                17120015
                                                                        17130015
      ******************************************************************17140015
      * GET CLEARANCE PRICE - PRICED AT SCL LEVEL W/ PROMO ID           17150015
      ******************************************************************17160015
       3082-FET-SCL-CLR-WID-CSR.                                        17170015
                                                                        17180015
           EXEC SQL                                                     17190015
                FETCH SCL-CLR-WID-CSR                                   17200015
                 INTO :XST00028-PROMO-INTFC-ID                          17210015
                    , :XST00028-MDSE-LNE-ID                             17220015
                    , :XST00028-PRICG-TYP-CDE                           17230015
                    , :XST00028-ADV-CDE                                 17240015
                      :PV-ADV-CDE-NULL-IND                              17250015
                    , :XST00028-PROMO-ID                                17260015
                    , :XST00028-TKT-CLOR-CDE                            17270015
                    , :XST00013-MAJ-CL-NBR                              17280015
                    , :XST00013-SUB-CL-NBR                              17290015
                    , :GTTPRICD-SKU-NBR                                 17300015
                    , :GTTPRICD-INTR-UPC-ID                             17310015
                    , :GTTPRICD-UNT-RTL-AMT                             17320015
                    , :GTTPRICD-GP-RTL-QTY                              17330015
                    , :GTTPRICD-GP-RTL-AMT                              17340015
                    , :GTTPRICD-UPC-NBR                                 17350015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         17360015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        17370015
           END-EXEC.                                                    17380015
                                                                        17390015
           EVALUATE TRUE                                                17400015
               WHEN SQLCODE = ZERO                                      17410015
                   IF PV-ADV-CDE-NULL-IND < 0                           17420015
                       MOVE SPACES              TO XST00028-ADV-CDE     17430015
                   END-IF                                               17440015
                                                                        17450015
               WHEN SQLCODE = +100                                      17460015
                   SET PS-END-OF-CSR            TO TRUE                 17470015
                                                                        17480015
               WHEN OTHER                                               17490015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    17500015
                   MOVE '3082-FET-SCL-CLR-WID-CSR'                      17510015
                                                TO PV-PARAGRAPH-NAME    17520015
                   PERFORM Z900-SQL-ABEND                               17530015
           END-EVALUATE.                                                17540015
                                                                        17550015
      ******************************************************************17560015
      * PROCESS SCL LEVEL CLEARENCE PRICE W/ PROMO-ID                   17570015
      ******************************************************************17580015
       3083-PROCESS-SCL-CLR-WID-CSR.                                    17590015
                                                                        17600015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        17610015
           PERFORM 3082-FET-SCL-CLR-WID-CSR.                            17620015
                                                                        17630015
      ******************************************************************17640015
      * CLOSE CLEARANCE PRICE - PRICED AT SCL LEVEL W/ PROMO ID         17650015
      ******************************************************************17660015
       3084-CLS-SCL-CLR-WID-CSR.                                        17670015
                                                                        17680015
           EXEC SQL                                                     17690015
                CLOSE SCL-CLR-WID-CSR                                   17700015
           END-EXEC.                                                    17710015
                                                                        17720015
           EVALUATE TRUE                                                17730015
               WHEN SQLCODE = ZERO                                      17740015
                   CONTINUE                                             17750015
                                                                        17760015
               WHEN OTHER                                               17770015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    17780015
                   MOVE '3084-CLS-SCL-CLR-WID-CSR'                      17790015
                                    TO PV-PARAGRAPH-NAME                17800015
                   PERFORM Z900-SQL-ABEND                               17810015
           END-EVALUATE.                                                17820015
                                                                        17830015
      ******************************************************************17840015
      * CHECK MAJ CLASS LEVEL CLEARANCE W/ PROMO-ID                     17841015
      ******************************************************************17842015
       3090-GET-MCL-CLR-WID.                                            17843015
                                                                        17844015
           SET PS-NOT-EOF-CSR       TO TRUE.                            17845015
           PERFORM 3091-OPN-MCL-CLR-WID-CSR.                            17846015
           PERFORM 3092-FET-MCL-CLR-WID-CSR.                            17847015
           PERFORM 3093-PROCESS-MCL-CLR-WID-CSR UNTIL PS-END-OF-CSR.    17848015
           PERFORM 3094-CLS-MCL-CLR-WID-CSR.                            17849015
                                                                        17850015
      ******************************************************************17860015
      * OPEN CLEARANCE PRICE - PRICED AT MCL LEVEL W/ PROMO ID          17870015
      ******************************************************************17880015
       3091-OPN-MCL-CLR-WID-CSR.                                        17890015
                                                                        17900015
           EXEC SQL                                                     17910015
                OPEN MCL-CLR-WID-CSR                                    17920015
           END-EXEC.                                                    17930015
                                                                        17940015
           EVALUATE TRUE                                                17950015
               WHEN SQLCODE = ZERO                                      17960015
                   CONTINUE                                             17970015
                                                                        17980015
               WHEN OTHER                                               17990015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    18000015
                   MOVE '3091-OPN-MCL-CLR-WID-CSR'                      18010015
                                    TO PV-PARAGRAPH-NAME                18020015
                   PERFORM Z900-SQL-ABEND                               18030015
           END-EVALUATE.                                                18040015
                                                                        18050015
      ******************************************************************18060015
      * GET CLEARANCE PRICE - PRICED AT MCL LEVEL W/ PROMO ID           18070015
      ******************************************************************18080015
       3092-FET-MCL-CLR-WID-CSR.                                        18090015
                                                                        18100015
           EXEC SQL                                                     18110015
                FETCH MCL-CLR-WID-CSR                                   18120015
                 INTO :XST00028-PROMO-INTFC-ID                          18130015
                    , :XST00028-MDSE-LNE-ID                             18140015
                    , :XST00028-PRICG-TYP-CDE                           18150015
                    , :XST00013-MAJ-CL-NBR                              18160015
                    , :XST00013-SUB-CL-NBR                              18170015
                    , :XST00028-ADV-CDE                                 18180015
                      :PV-ADV-CDE-NULL-IND                              18190015
                    , :XST00028-PROMO-ID                                18200015
                    , :XST00028-TKT-CLOR-CDE                            18210015
                    , :GTTPRICD-SKU-NBR                                 18220015
                    , :GTTPRICD-INTR-UPC-ID                             18230015
                    , :GTTPRICD-UNT-RTL-AMT                             18240015
                    , :GTTPRICD-GP-RTL-QTY                              18250015
                    , :GTTPRICD-GP-RTL-AMT                              18260015
                    , :GTTPRICD-UPC-NBR                                 18270015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         18280015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        18290015
           END-EXEC.                                                    18300015
                                                                        18310015
           EVALUATE TRUE                                                18320015
               WHEN SQLCODE = ZERO                                      18330015
                   IF PV-ADV-CDE-NULL-IND < 0                           18340015
                       MOVE SPACES              TO XST00028-ADV-CDE     18350015
                   END-IF                                               18360015
                                                                        18370015
               WHEN SQLCODE = +100                                      18380015
                   SET PS-END-OF-CSR            TO TRUE                 18390015
                                                                        18400015
               WHEN OTHER                                               18410015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    18420015
                   MOVE '3092-FET-MCL-CLR-WID-CSR'                      18430015
                                                TO PV-PARAGRAPH-NAME    18440015
                   PERFORM Z900-SQL-ABEND                               18450015
           END-EVALUATE.                                                18460015
                                                                        18470015
      ******************************************************************18480015
      * PROCESS MCL LEVEL CLEARENCE PRICE W/ PROMO-ID                   18490015
      ******************************************************************18500015
       3093-PROCESS-MCL-CLR-WID-CSR.                                    18510015
                                                                        18520015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        18530015
           PERFORM 3092-FET-MCL-CLR-WID-CSR.                            18540015
                                                                        18550015
      ******************************************************************18560015
      * CLOSE CLEARANCE PRICE - PRICED AT MCL LEVEL W/ PROMO ID         18570015
      ******************************************************************18580015
       3094-CLS-MCL-CLR-WID-CSR.                                        18590015
                                                                        18600015
           EXEC SQL                                                     18610015
                CLOSE MCL-CLR-WID-CSR                                   18620015
           END-EXEC.                                                    18630015
                                                                        18640015
           EVALUATE TRUE                                                18650015
               WHEN SQLCODE = ZERO                                      18660015
                   CONTINUE                                             18670015
                                                                        18680015
               WHEN OTHER                                               18690015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    18700015
                   MOVE '3094-CLS-MCL-CLR-WID-CSR'                      18710015
                                    TO PV-PARAGRAPH-NAME                18720015
                   PERFORM Z900-SQL-ABEND                               18730015
           END-EVALUATE.                                                18740015
                                                                        18750015
      ******************************************************************18760015
      * CHECK DPT LEVEL CLEARANCE W/ PROMO-ID                           18770015
      ******************************************************************18780015
       3100-GET-DPT-CLR-WID.                                            18790015
                                                                        18800015
           SET PS-NOT-EOF-CSR       TO TRUE.                            18810015
           PERFORM 3101-OPN-DPT-CLR-WID-CSR.                            18820015
           PERFORM 3102-FET-DPT-CLR-WID-CSR.                            18830015
           PERFORM 3103-PROCESS-DPT-CLR-WID-CSR UNTIL PS-END-OF-CSR.    18840015
           PERFORM 3104-CLS-DPT-CLR-WID-CSR.                            18850015
                                                                        18860015
      ******************************************************************18870015
      * OPEN CLEARANCE PRICE - PRICED AT DPT LEVEL W/ PROMO ID          18880015
      ******************************************************************18890015
       3101-OPN-DPT-CLR-WID-CSR.                                        18900015
                                                                        18910015
           EXEC SQL                                                     18920015
                OPEN DPT-CLR-WID-CSR                                    18930015
           END-EXEC.                                                    18940015
                                                                        18950015
           EVALUATE TRUE                                                18960015
               WHEN SQLCODE = ZERO                                      18970015
                   CONTINUE                                             18980015
                                                                        18990015
               WHEN OTHER                                               19000015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    19010015
                   MOVE '3101-OPN-DPT-CLR-WID-CSR'                      19020015
                                    TO PV-PARAGRAPH-NAME                19030015
                   PERFORM Z900-SQL-ABEND                               19040015
           END-EVALUATE.                                                19050015
                                                                        19060015
      ******************************************************************19070015
      * GET CLEARANCE PRICE - PRICED AT DPT LEVEL W/ PROMO ID           19080015
      ******************************************************************19090015
       3102-FET-DPT-CLR-WID-CSR.                                        19100015
                                                                        19110015
           EXEC SQL                                                     19120015
                FETCH DPT-CLR-WID-CSR                                   19130015
                 INTO :XST00028-PROMO-INTFC-ID                          19140015
                    , :XST00028-MDSE-LNE-ID                             19150015
                    , :XST00028-PRICG-TYP-CDE                           19160015
                    , :XST00028-ADV-CDE                                 19170015
                      :PV-ADV-CDE-NULL-IND                              19180015
                    , :XST00028-PROMO-ID                                19190015
                    , :XST00028-TKT-CLOR-CDE                            19200015
                    , :XST00013-MAJ-CL-NBR                              19210015
                    , :XST00013-SUB-CL-NBR                              19220015
                    , :GTTPRICD-SKU-NBR                                 19230015
                    , :GTTPRICD-INTR-UPC-ID                             19240015
                    , :GTTPRICD-UNT-RTL-AMT                             19250015
                    , :GTTPRICD-GP-RTL-QTY                              19260015
                    , :GTTPRICD-GP-RTL-AMT                              19270015
                    , :GTTPRICD-UPC-NBR                                 19280015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         19290015
                    , :GTTPRICD-UPC-STAT-CHG-DTE                        19300015
           END-EXEC.                                                    19310015
                                                                        19320015
           EVALUATE TRUE                                                19330015
               WHEN SQLCODE = ZERO                                      19340015
                   IF PV-ADV-CDE-NULL-IND < 0                           19350015
                       MOVE SPACES              TO XST00028-ADV-CDE     19360015
                   END-IF                                               19370015
                                                                        19380015
               WHEN SQLCODE = +100                                      19390015
                   SET PS-END-OF-CSR            TO TRUE                 19400015
                                                                        19410015
               WHEN OTHER                                               19420015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    19430015
                   MOVE '3102-FET-DPT-CLR-WID-CSR'                      19440015
                                                TO PV-PARAGRAPH-NAME    19450015
                   PERFORM Z900-SQL-ABEND                               19460015
           END-EVALUATE.                                                19470015
                                                                        19480015
      ******************************************************************19490015
      * PROCESS DPT LEVEL CLEARENCE PRICE W/ PROMO-ID                   19500015
      ******************************************************************19510015
       3103-PROCESS-DPT-CLR-WID-CSR.                                    19520015
                                                                        19530015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        19540015
           PERFORM 3102-FET-DPT-CLR-WID-CSR.                            19550015
                                                                        19560015
      ******************************************************************19570015
      * CLOSE CLEARANCE PRICE - PRICED AT DPT LEVEL W/ PROMO ID         19580015
      ******************************************************************19590015
       3104-CLS-DPT-CLR-WID-CSR.                                        19600015
                                                                        19610015
           EXEC SQL                                                     19620015
                CLOSE DPT-CLR-WID-CSR                                   19630015
           END-EXEC.                                                    19640015
                                                                        19650015
           EVALUATE TRUE                                                19660015
               WHEN SQLCODE = ZERO                                      19670015
                   CONTINUE                                             19680015
                                                                        19690015
               WHEN OTHER                                               19700015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    19710015
                   MOVE '3104-CLS-DPT-CLR-WID-CSR'                      19720015
                                    TO PV-PARAGRAPH-NAME                19730015
                   PERFORM Z900-SQL-ABEND                               19740015
           END-EVALUATE.                                                19750015
                                                                        19760015
      ******************************************************************19761015
      * APPLY YELLOW TICKET AND APPLY RED TICKET PRICE CHANGE IF        19762015
      * APPLICABLE.                                                     19763015
      ******************************************************************19764015
       3200-PROCESS-CLR-PRICE-CHANGE.                                   19765015
                                                                        19766015
           IF PS-WHITE-TKT-ITEM                                         19767015
               MOVE '30'                 TO PV-FUT-PERM-STATUS-CDE      19768015
               PERFORM 2660-DET-FUT-PERM-EVNT-CHGS                      19769015
               SET PS-YELLOW-TKT-APPLIED TO TRUE                        19770015
                                                                        19780015
W36026***      PERFORM 2900-CHECK-FOR-FUT-CNTCLR                        19790015
W36026***                                                               19800015
W36026***      IF PS-FUT-RED-EVNT-FOUND                                 19810015
      *            IF THE CONTINUED CLEARANCE EFFECTIVE DATE IS         19820015
      *            GREATER THAN THE YELLOW TICKET EFFECTIVE DATE        19830015
      *            APPLY THE RED TICKET (CONTINUED CLEARANCE) EVENT     19840015
      *                                                                 19850015
      *            WE DON'T WANT TO APPLY THE RED TICKET EVENT IF THE   19860015
      *            DATES ARE EQUAL (POS AND RF DO NOT DISPLAY THIS      19870015
      *            INFORMATION IN THE FUTURE).                          19880015
                                                                        19890015
W36026***          IF PV-CONTCLR-PRCHG-EFF-DTE > XST00064-PRCHG-EFF-DTE 19900015
W36026***              PERFORM 2650-CONTCLR-EDITS                       19910015
W36026***              IF PS-VALID-FUT-TKT-EVNT                         19920015
W36026***                  PERFORM 2670-LOOK-FOR-RED-TKT-GRID           19930015
W36026***                  PERFORM 2665-DET-CNTCLR-EVNT-CHGS            19940015
W36026***              END-IF                                           19950015
W36026***          END-IF                                               19960015
W36026***      END-IF                                                   19970015
                                                                        19980015
           ELSE                                                         19990015
      *        ITEM IS ALREADY YELLOW TICKET, TAKING YELLOW TO YELLOW   20000015
      *                                                                 20010015
      *        CONTINUED CLEARANCE (RED TICKETS) ARE NOT GOING TO       20020015
      *        BE TAKEN ON MK2 AND FNL PRICE CHANGES.  IF THIS EVER     20030015
      *        CHANGES, THE CODE BELOW COULD BE DELETED.  WE WOULD      20040015
      *        JUST EXECUTE THE CODE ABOVE THE ELSE FOR WHITE AND       20050015
      *        YELLOW TICKET MERCHANDISE.                               20050115
                                                                        20050215
               MOVE '30'                 TO PV-FUT-PERM-STATUS-CDE      20050315
               PERFORM 2660-DET-FUT-PERM-EVNT-CHGS                      20050415
               SET PS-YELLOW-TKT-APPLIED TO TRUE                        20050515
                                                                        20050615
           END-IF.                                                      20050715
                                                                        20050815
      ******************************************************************20050915
      * NEED TO CHECK PROMO PRICING                                     20051015
      ******************************************************************20052015
       4000-GET-PROMO-PRICING.                                          20053015
                                                                        20054015
           IF XS051-PROMO-ID = 0                                        20055015
             DISPLAY 'PROCESSING SKU PROMO NO ID CSR - 1 OF 5'          20055115
             SET PS-HIER-SKU-CDE    TO TRUE                             20055215
             PERFORM 4010-GET-SKU-PROMO-NOID                            20055315
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20055415
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20055515
                                                                        20055615
             DISPLAY 'PROCESSING STY PROMO NO ID CSR - 2 OF 5'          20055715
             SET PS-HIER-STY-CDE    TO TRUE                             20055815
             PERFORM 4020-GET-STY-PROMO-NOID                            20055915
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20056015
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20057015
                                                                        20057115
             DISPLAY 'PROCESSING SCL PROMO NO ID CSR - 3 OF 5'          20057215
             SET PS-HIER-SCL-CDE    TO TRUE                             20057315
             PERFORM 4030-GET-SCL-PROMO-NOID                            20057415
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20057515
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20057615
                                                                        20057715
             DISPLAY 'PROCESSING MCL PROMO NO ID CSR - 4 OF 5'          20057815
             SET PS-HIER-MCL-CDE    TO TRUE                             20057915
             PERFORM 4040-GET-MCL-PROMO-NOID                            20058015
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20059015
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20059115
                                                                        20059215
             DISPLAY 'PROCESSING DPT PROMO NO ID CSR - 5 OF 5'          20059315
             SET PS-HIER-DPT-CDE    TO TRUE                             20059415
             PERFORM 4050-GET-DPT-PROMO-NOID                            20059515
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20059615
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20059715
           ELSE                                                         20059815
             DISPLAY 'PROCESSING SKU PROMO W/ ID CSR - 1 OF 5'          20059915
             SET PS-HIER-SKU-CDE    TO TRUE                             20060015
             PERFORM 4060-GET-SKU-PROMO-WID                             20060115
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20060215
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20060315
                                                                        20060415
             DISPLAY 'PROCESSING STY PROMO W/ ID CSR - 2 OF 5'          20060515
             SET PS-HIER-STY-CDE    TO TRUE                             20060615
             PERFORM 4070-GET-STY-PROMO-WID                             20060715
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20060815
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20060915
                                                                        20061015
             DISPLAY 'PROCESSING SCL PROMO W/ ID CSR - 3 OF 5'          20062015
             SET PS-HIER-SCL-CDE    TO TRUE                             20063015
             PERFORM 4080-GET-SCL-PROMO-WID                             20064015
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20065015
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20066015
                                                                        20067015
             DISPLAY 'PROCESSING MCL PROMO W/ ID CSR - 4 OF 5'          20068015
             SET PS-HIER-MCL-CDE    TO TRUE                             20069015
             PERFORM 4090-GET-MCL-PROMO-WID                             20070015
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20080015
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20090015
                                                                        20100015
             DISPLAY 'PROCESSING DPT PROMO W/ ID CSR - 5 OF 5'          20110015
             SET PS-HIER-DPT-CDE    TO TRUE                             20120015
             PERFORM 4100-GET-DPT-PROMO-WID                             20130015
W36026       PERFORM 7500-SET-CURRENT-TIMESTAMP                         20140015
W36026       DISPLAY 'COMPLETION TIMESTAMP: ' PV-CURRENT-TIMESTAMP      20150015
           END-IF.                                                      20160015
                                                                        20170015
      ******************************************************************20180015
      * CHECK SKU LEVEL PROMO PRICE W/NO PROMO-ID                       20190015
      ******************************************************************20200015
       4010-GET-SKU-PROMO-NOID.                                         20210015
                                                                        20220015
           SET PS-NOT-EOF-CSR       TO TRUE.                            20230015
           PERFORM 4011-OPN-SKU-PROMO-NOID-CSR.                         20240015
           PERFORM 4012-FET-SKU-PROMO-NOID-CSR.                         20250015
           PERFORM 4013-PROCESS-SKU-PROMO-NOID UNTIL PS-END-OF-CSR.     20260015
           PERFORM 4014-CLS-SKU-PROMO-NOID-CSR.                         20270015
                                                                        20280015
      ******************************************************************20290015
      * OPEN PROMO PRICE - PRICED AT SKU LEVEL W/NO PROMO ID            20291015
      ******************************************************************20292015
       4011-OPN-SKU-PROMO-NOID-CSR.                                     20293015
                                                                        20294015
           EXEC SQL                                                     20295015
                OPEN SKU-PROMO-NOID-CSR                                 20296015
           END-EXEC.                                                    20297015
                                                                        20298015
           EVALUATE TRUE                                                20299015
               WHEN SQLCODE = ZERO                                      20300015
                   CONTINUE                                             20310015
                                                                        20320015
               WHEN OTHER                                               20330015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  20340015
                   MOVE '4011-OPN-SKU-PROMO-NOID-CSR'                   20350015
                                    TO PV-PARAGRAPH-NAME                20360015
                   PERFORM Z900-SQL-ABEND                               20370015
           END-EVALUATE.                                                20380015
                                                                        20390015
      ******************************************************************20400015
      * GET PROMO PRICE - PRICED AT SKU LEVEL W/NO PROMO ID             20401015
      ******************************************************************20402015
       4012-FET-SKU-PROMO-NOID-CSR.                                     20403015
                                                                        20404015
           EXEC SQL                                                     20405015
                FETCH SKU-PROMO-NOID-CSR                                20406015
                 INTO :XST00028-PROMO-INTFC-ID                          20407015
                    , :XST00028-MDSE-LNE-ID                             20408015
                    , :XST00028-PRICG-TYP-CDE                           20409015
                    , :XST00028-ADV-CDE                                 20410015
                      :PV-ADV-CDE-NULL-IND                              20420015
                    , :XST00028-PROMO-ID                                20430015
                    , :XST00026-REG-PROMO-TYP-CDE                       20440015
                    , :GTTPRICD-SKU-NBR                                 20450015
                    , :GTTPRICD-INTR-UPC-ID                             20460015
                    , :GTTPRICD-UNT-RTL-AMT                             20470015
                    , :GTTPRICD-GP-RTL-QTY                              20480015
                    , :GTTPRICD-GP-RTL-AMT                              20490015
                    , :GTTPRICD-UPC-NBR                                 20500015
           END-EXEC.                                                    20510015
                                                                        20520015
           EVALUATE TRUE                                                20530015
               WHEN SQLCODE = ZERO                                      20540015
                   IF PV-ADV-CDE-NULL-IND < 0                           20550015
                       MOVE SPACES              TO XST00028-ADV-CDE     20560015
                   END-IF                                               20570015
                                                                        20580015
               WHEN SQLCODE = +100                                      20590015
                   SET PS-END-OF-CSR            TO TRUE                 20600015
                                                                        20610015
               WHEN OTHER                                               20620015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  20630015
                   MOVE '4012-FET-SKU-PROMO-NOID-CSR'                   20640015
                                                TO PV-PARAGRAPH-NAME    20650015
                   PERFORM Z900-SQL-ABEND                               20660015
           END-EVALUATE.                                                20670015
                                                                        20680015
      ******************************************************************20690015
      * PROCESS SKU LEVEL PROMO PRICE W/NO PROMO-ID                     20700015
      ******************************************************************20710015
       4013-PROCESS-SKU-PROMO-NOID.                                     20720015
                                                                        20730015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        20740015
           PERFORM 4012-FET-SKU-PROMO-NOID-CSR.                         20750015
                                                                        20760015
      ******************************************************************20770015
      * CLOSE PROMO PRICE - PRICED AT SKU LEVEL W/NO PROMO ID           20780015
      ******************************************************************20790015
       4014-CLS-SKU-PROMO-NOID-CSR.                                     20800015
                                                                        20810015
           EXEC SQL                                                     20820015
                CLOSE SKU-PROMO-NOID-CSR                                20830015
           END-EXEC.                                                    20840015
                                                                        20850015
           EVALUATE TRUE                                                20860015
               WHEN SQLCODE = ZERO                                      20870015
                   CONTINUE                                             20880015
                                                                        20890015
               WHEN OTHER                                               20900015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  20910015
                   MOVE '4014-CLS-SKU-PROMO-NOID-CSR'                   20920015
                                    TO PV-PARAGRAPH-NAME                20930015
                   PERFORM Z900-SQL-ABEND                               20940015
           END-EVALUATE.                                                20950015
                                                                        20960015
      ******************************************************************20970015
      * CHECK STYLE LEVEL PROMO PRICE W/NO PROMO-ID                     20980015
      ******************************************************************20990015
       4020-GET-STY-PROMO-NOID.                                         21000015
                                                                        21010015
           SET PS-NOT-EOF-CSR       TO TRUE.                            21020015
           PERFORM 4021-OPN-STY-PROMO-NOID-CSR.                         21030015
           PERFORM 4022-FET-STY-PROMO-NOID-CSR.                         21040015
           PERFORM 4023-PROCESS-STY-PROMO-NOID UNTIL PS-END-OF-CSR.     21050015
           PERFORM 4024-CLS-STY-PROMO-NOID-CSR.                         21060015
                                                                        21070015
      ******************************************************************21080015
      * OPEN PROMO PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID          21090015
      ******************************************************************21100015
       4021-OPN-STY-PROMO-NOID-CSR.                                     21110015
                                                                        21120015
           EXEC SQL                                                     21130015
                OPEN STY-PROMO-NOID-CSR                                 21140015
           END-EXEC.                                                    21150015
                                                                        21160015
           EVALUATE TRUE                                                21170015
               WHEN SQLCODE = ZERO                                      21180015
                   CONTINUE                                             21190015
                                                                        21200015
               WHEN OTHER                                               21210015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  21220015
                   MOVE '4021-OPN-STY-PROMO-NOID-CSR'                   21230015
                                    TO PV-PARAGRAPH-NAME                21240015
                   PERFORM Z900-SQL-ABEND                               21250015
           END-EVALUATE.                                                21260015
                                                                        21270015
      ******************************************************************21280015
      * GET PROMO PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID           21290015
      ******************************************************************21300015
       4022-FET-STY-PROMO-NOID-CSR.                                     21310015
                                                                        21320015
           EXEC SQL                                                     21330015
                FETCH STY-PROMO-NOID-CSR                                21340015
                 INTO :XST00028-PROMO-INTFC-ID                          21350015
                    , :XST00028-MDSE-LNE-ID                             21360015
                    , :XST00028-PRICG-TYP-CDE                           21370015
                    , :XST00028-ADV-CDE                                 21380015
                      :PV-ADV-CDE-NULL-IND                              21390015
                    , :XST00028-PROMO-ID                                21400015
                    , :XST00026-REG-PROMO-TYP-CDE                       21410015
                    , :GTTPRICD-SKU-NBR                                 21420015
                    , :GTTPRICD-INTR-UPC-ID                             21430015
                    , :GTTPRICD-UNT-RTL-AMT                             21440015
                    , :GTTPRICD-GP-RTL-QTY                              21450015
                    , :GTTPRICD-GP-RTL-AMT                              21460015
                    , :GTTPRICD-UPC-NBR                                 21470015
           END-EXEC.                                                    21480015
                                                                        21490015
           EVALUATE TRUE                                                21500015
               WHEN SQLCODE = ZERO                                      21510015
                   IF PV-ADV-CDE-NULL-IND < 0                           21520015
                       MOVE SPACES              TO XST00028-ADV-CDE     21530015
                   END-IF                                               21540015
                                                                        21550015
               WHEN SQLCODE = +100                                      21560015
                   SET PS-END-OF-CSR            TO TRUE                 21570015
                                                                        21580015
               WHEN OTHER                                               21590015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  21600015
                   MOVE '4022-FET-STY-PROMO-NOID-CSR'                   21610015
                                                TO PV-PARAGRAPH-NAME    21620015
                   PERFORM Z900-SQL-ABEND                               21630015
           END-EVALUATE.                                                21640015
                                                                        21650015
      ******************************************************************21660015
      * PROCESS STY LEVEL PROMO PRICE W/NO PROMO-ID                     21670015
      ******************************************************************21680015
       4023-PROCESS-STY-PROMO-NOID.                                     21690015
                                                                        21700015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        21710015
           PERFORM 4022-FET-STY-PROMO-NOID-CSR.                         21720015
                                                                        21730015
      ******************************************************************21740015
      * CLOSE PROMO PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID         21750015
      ******************************************************************21760015
       4024-CLS-STY-PROMO-NOID-CSR.                                     21770015
                                                                        21780015
           EXEC SQL                                                     21790015
                CLOSE STY-PROMO-NOID-CSR                                21800015
           END-EXEC.                                                    21810015
                                                                        21820015
           EVALUATE TRUE                                                21830015
               WHEN SQLCODE = ZERO                                      21840015
                   CONTINUE                                             21850015
                                                                        21860015
               WHEN OTHER                                               21870015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  21880015
                   MOVE '4024-CLS-STY-PROMO-NOID-CSR'                   21890015
                                    TO PV-PARAGRAPH-NAME                21900015
                   PERFORM Z900-SQL-ABEND                               21910015
           END-EVALUATE.                                                21920015
                                                                        21930015
      ******************************************************************21940015
      * CHECK SUB CLASS LEVEL PROMO PRICE W/NO PROMO-ID                 21950015
      ******************************************************************21960015
       4030-GET-SCL-PROMO-NOID.                                         21970015
                                                                        21980015
           SET PS-NOT-EOF-CSR       TO TRUE.                            21990015
           PERFORM 4031-OPN-SCL-PROMO-NOID-CSR.                         22000015
           PERFORM 4032-FET-SCL-PROMO-NOID-CSR.                         22010015
           PERFORM 4033-PROCESS-SCL-PROMO-NOID UNTIL PS-END-OF-CSR.     22020015
           PERFORM 4034-CLS-SCL-PROMO-NOID-CSR.                         22030015
                                                                        22040015
      ******************************************************************22050015
      * OPEN PROMO PRICE - PRICED AT SCL LEVEL W/NO PROMO ID            22060015
      ******************************************************************22070015
       4031-OPN-SCL-PROMO-NOID-CSR.                                     22080015
                                                                        22090015
           EXEC SQL                                                     22100015
                OPEN SCL-PROMO-NOID-CSR                                 22110015
           END-EXEC.                                                    22120015
                                                                        22130015
           EVALUATE TRUE                                                22140015
               WHEN SQLCODE = ZERO                                      22150015
                   CONTINUE                                             22160015
                                                                        22161015
               WHEN OTHER                                               22162015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  22163015
                   MOVE '4031-OPN-SCL-PROMO-NOID-CSR'                   22164015
                                    TO PV-PARAGRAPH-NAME                22165015
                   PERFORM Z900-SQL-ABEND                               22166015
           END-EVALUATE.                                                22167015
                                                                        22168015
      ******************************************************************22169015
      * GET PROMO PRICE - PRICED AT SCL LEVEL W/NO PROMO ID             22170015
      ******************************************************************22180015
       4032-FET-SCL-PROMO-NOID-CSR.                                     22190015
                                                                        22200015
           EXEC SQL                                                     22210015
                FETCH SCL-PROMO-NOID-CSR                                22220015
                 INTO :XST00028-PROMO-INTFC-ID                          22230015
                    , :XST00028-MDSE-LNE-ID                             22240015
                    , :XST00028-PRICG-TYP-CDE                           22250015
                    , :XST00028-ADV-CDE                                 22260015
                      :PV-ADV-CDE-NULL-IND                              22270015
                    , :XST00028-PROMO-ID                                22280015
                    , :XST00026-REG-PROMO-TYP-CDE                       22290015
                    , :XST00013-MAJ-CL-NBR                              22300015
                    , :XST00013-SUB-CL-NBR                              22310015
                    , :GTTPRICD-SKU-NBR                                 22320015
                    , :GTTPRICD-INTR-UPC-ID                             22330015
                    , :GTTPRICD-UNT-RTL-AMT                             22340015
                    , :GTTPRICD-GP-RTL-QTY                              22350015
                    , :GTTPRICD-GP-RTL-AMT                              22360015
                    , :GTTPRICD-UPC-NBR                                 22370015
           END-EXEC.                                                    22380015
                                                                        22390015
           EVALUATE TRUE                                                22400015
               WHEN SQLCODE = ZERO                                      22410015
                   IF PV-ADV-CDE-NULL-IND < 0                           22420015
                       MOVE SPACES              TO XST00028-ADV-CDE     22430015
                   END-IF                                               22440015
                                                                        22450015
               WHEN SQLCODE = +100                                      22460015
                   SET PS-END-OF-CSR            TO TRUE                 22470015
                                                                        22480015
               WHEN OTHER                                               22490015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  22500015
                   MOVE '4032-FET-SCL-PROMO-NOID-CSR'                   22510015
                                                TO PV-PARAGRAPH-NAME    22520015
                   PERFORM Z900-SQL-ABEND                               22530015
           END-EVALUATE.                                                22540015
                                                                        22550015
      ******************************************************************22560015
      * PROCESS SCL LEVEL PROMO PRICE W/NO PROMO-ID                     22570015
      ******************************************************************22580015
       4033-PROCESS-SCL-PROMO-NOID.                                     22590015
                                                                        22600015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        22610015
           PERFORM 4032-FET-SCL-PROMO-NOID-CSR.                         22620015
                                                                        22630015
      ******************************************************************22640015
      * CLOSE PROMO PRICE - PRICED AT SCL LEVEL W/NO PROMO ID           22650015
      ******************************************************************22660015
       4034-CLS-SCL-PROMO-NOID-CSR.                                     22670015
                                                                        22680015
           EXEC SQL                                                     22690015
                CLOSE SCL-PROMO-NOID-CSR                                22700015
           END-EXEC.                                                    22710015
                                                                        22720015
           EVALUATE TRUE                                                22730015
               WHEN SQLCODE = ZERO                                      22740015
                   CONTINUE                                             22750015
                                                                        22760015
               WHEN OTHER                                               22770015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  22780015
                   MOVE '4034-CLS-SCL-PROMO-NOID-CSR'                   22790015
                                    TO PV-PARAGRAPH-NAME                22800015
                   PERFORM Z900-SQL-ABEND                               22810015
           END-EVALUATE.                                                22820015
                                                                        22830015
      ******************************************************************22840015
      * CHECK MAJ CLASS LEVEL PROMO PRICE W/NO PROMO-ID                 22850015
      ******************************************************************22860015
       4040-GET-MCL-PROMO-NOID.                                         22870015
                                                                        22880015
           SET PS-NOT-EOF-CSR       TO TRUE.                            22890015
           PERFORM 4041-OPN-MCL-PROMO-NOID-CSR.                         22900015
           PERFORM 4042-FET-MCL-PROMO-NOID-CSR.                         22910015
           PERFORM 4043-PROCESS-MCL-PROMO-NOID UNTIL PS-END-OF-CSR.     22920015
           PERFORM 4044-CLS-MCL-PROMO-NOID-CSR.                         22930015
                                                                        22940015
      ******************************************************************22950015
      * OPEN PROMO PRICE - PRICED AT MCL LEVEL W/NO PROMO ID            22960015
      ******************************************************************22970015
       4041-OPN-MCL-PROMO-NOID-CSR.                                     22980015
                                                                        22990015
           EXEC SQL                                                     23000015
                OPEN MCL-PROMO-NOID-CSR                                 23010015
           END-EXEC.                                                    23020015
                                                                        23030015
           EVALUATE TRUE                                                23040015
               WHEN SQLCODE = ZERO                                      23050015
                   CONTINUE                                             23060015
                                                                        23070015
               WHEN OTHER                                               23080015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  23090015
                   MOVE '4041-OPN-MCL-PROMO-NOID-CSR'                   23100015
                                    TO PV-PARAGRAPH-NAME                23110015
                   PERFORM Z900-SQL-ABEND                               23120015
           END-EVALUATE.                                                23130015
                                                                        23140015
      ******************************************************************23150015
      * GET PROMO PRICE - PRICED AT MCL LEVEL W/NO PROMO ID             23160015
      ******************************************************************23170015
       4042-FET-MCL-PROMO-NOID-CSR.                                     23180015
                                                                        23190015
           EXEC SQL                                                     23200015
                FETCH MCL-PROMO-NOID-CSR                                23210015
                 INTO :XST00028-PROMO-INTFC-ID                          23220015
                    , :XST00028-MDSE-LNE-ID                             23230015
                    , :XST00028-PRICG-TYP-CDE                           23240015
                    , :XST00028-ADV-CDE                                 23250015
                      :PV-ADV-CDE-NULL-IND                              23260015
                    , :XST00028-PROMO-ID                                23270015
                    , :XST00013-MAJ-CL-NBR                              23280015
                    , :XST00013-SUB-CL-NBR                              23290015
                    , :XST00026-REG-PROMO-TYP-CDE                       23300015
                    , :GTTPRICD-SKU-NBR                                 23310015
                    , :GTTPRICD-INTR-UPC-ID                             23320015
                    , :GTTPRICD-UNT-RTL-AMT                             23330015
                    , :GTTPRICD-GP-RTL-QTY                              23340015
                    , :GTTPRICD-GP-RTL-AMT                              23350015
                    , :GTTPRICD-UPC-NBR                                 23360015
           END-EXEC.                                                    23370015
                                                                        23380015
           EVALUATE TRUE                                                23390015
               WHEN SQLCODE = ZERO                                      23400015
                   IF PV-ADV-CDE-NULL-IND < 0                           23410015
                       MOVE SPACES              TO XST00028-ADV-CDE     23420015
                   END-IF                                               23430015
                                                                        23440015
               WHEN SQLCODE = +100                                      23450015
                   SET PS-END-OF-CSR            TO TRUE                 23460015
                                                                        23470015
               WHEN OTHER                                               23480015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  23490015
                   MOVE '4042-FET-MCL-PROMO-NOID-CSR'                   23500015
                                                TO PV-PARAGRAPH-NAME    23510015
                   PERFORM Z900-SQL-ABEND                               23520015
           END-EVALUATE.                                                23530015
                                                                        23540015
      ******************************************************************23550015
      * PROCESS MCL LEVEL PROMO PRICE W/NO PROMO-ID                     23560015
      ******************************************************************23570015
       4043-PROCESS-MCL-PROMO-NOID.                                     23580015
                                                                        23590015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        23600015
           PERFORM 4042-FET-MCL-PROMO-NOID-CSR.                         23610015
                                                                        23620015
      ******************************************************************23630015
      * CLOSE PROMO PRICE - PRICED AT MCL LEVEL W/NO PROMO ID           23640015
      ******************************************************************23650015
       4044-CLS-MCL-PROMO-NOID-CSR.                                     23660015
                                                                        23670015
           EXEC SQL                                                     23680015
                CLOSE MCL-PROMO-NOID-CSR                                23690015
           END-EXEC.                                                    23700015
                                                                        23710015
           EVALUATE TRUE                                                23720015
               WHEN SQLCODE = ZERO                                      23730015
                   CONTINUE                                             23740015
                                                                        23750015
               WHEN OTHER                                               23760015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  23770015
                   MOVE '4044-CLS-MCL-PROMO-NOID-CSR'                   23780015
                                    TO PV-PARAGRAPH-NAME                23790015
                   PERFORM Z900-SQL-ABEND                               23800015
           END-EVALUATE.                                                23801015
                                                                        23802015
      ******************************************************************23803015
      * CHECK DEPT LEVEL PROMO PRICE W/NO PROMO-ID                      23804015
      ******************************************************************23805015
       4050-GET-DPT-PROMO-NOID.                                         23806015
                                                                        23807015
           SET PS-NOT-EOF-CSR       TO TRUE.                            23808015
           PERFORM 4051-OPN-DPT-PROMO-NOID-CSR.                         23809015
           PERFORM 4052-FET-DPT-PROMO-NOID-CSR.                         23810015
           PERFORM 4053-PROCESS-DPT-PROMO-NOID UNTIL PS-END-OF-CSR.     23820015
           PERFORM 4054-CLS-DPT-PROMO-NOID-CSR.                         23830015
                                                                        23840015
      ******************************************************************23850015
      * OPEN PROMO PRICE - PRICED AT DPT LEVEL W/NO PROMO ID            23860015
      ******************************************************************23870015
       4051-OPN-DPT-PROMO-NOID-CSR.                                     23880015
                                                                        23881015
           EXEC SQL                                                     23882015
                OPEN DPT-PROMO-NOID-CSR                                 23883015
           END-EXEC.                                                    23884015
                                                                        23885015
           EVALUATE TRUE                                                23886015
               WHEN SQLCODE = ZERO                                      23887015
                   CONTINUE                                             23888015
                                                                        23889015
               WHEN OTHER                                               23890015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  23900015
                   MOVE '4051-OPN-DPT-PROMO-NOID-CSR'                   23910015
                                    TO PV-PARAGRAPH-NAME                23920015
                   PERFORM Z900-SQL-ABEND                               23930015
           END-EVALUATE.                                                23940015
                                                                        23950015
      ******************************************************************23960015
      * GET PROMO PRICE - PRICED AT DPT LEVEL W/NO PROMO ID             23970015
      ******************************************************************23980015
       4052-FET-DPT-PROMO-NOID-CSR.                                     23990015
                                                                        24000015
           EXEC SQL                                                     24010015
                FETCH DPT-PROMO-NOID-CSR                                24020015
                 INTO :XST00028-PROMO-INTFC-ID                          24030015
                    , :XST00028-MDSE-LNE-ID                             24040015
                    , :XST00028-PRICG-TYP-CDE                           24050015
                    , :XST00028-ADV-CDE                                 24060015
                      :PV-ADV-CDE-NULL-IND                              24070015
                    , :XST00028-PROMO-ID                                24080015
                    , :XST00013-MAJ-CL-NBR                              24090015
                    , :XST00013-SUB-CL-NBR                              24100015
                    , :XST00026-REG-PROMO-TYP-CDE                       24110015
                    , :GTTPRICD-SKU-NBR                                 24120015
                    , :GTTPRICD-INTR-UPC-ID                             24130015
                    , :GTTPRICD-UNT-RTL-AMT                             24140015
                    , :GTTPRICD-GP-RTL-QTY                              24150015
                    , :GTTPRICD-GP-RTL-AMT                              24160015
                    , :GTTPRICD-UPC-NBR                                 24170015
           END-EXEC.                                                    24180015
                                                                        24190015
           EVALUATE TRUE                                                24200015
               WHEN SQLCODE = ZERO                                      24210015
                   IF PV-ADV-CDE-NULL-IND < 0                           24220015
                       MOVE SPACES              TO XST00028-ADV-CDE     24230015
                   END-IF                                               24240015
                                                                        24250015
               WHEN SQLCODE = +100                                      24260015
                   SET PS-END-OF-CSR            TO TRUE                 24270015
                                                                        24280015
               WHEN OTHER                                               24290015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  24300015
                   MOVE '4052-FET-DPT-PROMO-NOID-CSR'                   24310015
                                                TO PV-PARAGRAPH-NAME    24320015
                   PERFORM Z900-SQL-ABEND                               24330015
           END-EVALUATE.                                                24340015
                                                                        24350015
      ******************************************************************24360015
      * PROCESS DPT LEVEL PROMO PRICE W/NO PROMO-ID                     24370015
      ******************************************************************24380015
       4053-PROCESS-DPT-PROMO-NOID.                                     24390015
                                                                        24400015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        24410015
           PERFORM 4052-FET-DPT-PROMO-NOID-CSR.                         24420015
                                                                        24430015
      ******************************************************************24440015
      * CLOSE PROMO PRICE - PRICED AT DPT LEVEL W/NO PROMO ID           24450015
      ******************************************************************24460015
       4054-CLS-DPT-PROMO-NOID-CSR.                                     24470015
                                                                        24480015
           EXEC SQL                                                     24490015
                CLOSE DPT-PROMO-NOID-CSR                                24500015
           END-EXEC.                                                    24510015
                                                                        24520015
           EVALUATE TRUE                                                24530015
               WHEN SQLCODE = ZERO                                      24540015
                   CONTINUE                                             24550015
                                                                        24560015
               WHEN OTHER                                               24570015
                   DISPLAY 'FULL TMST:  ' PV-FULL-TMST                  24580015
                   MOVE '4054-CLS-DPT-PROMO-NOID-CSR'                   24590015
                                    TO PV-PARAGRAPH-NAME                24591015
                   PERFORM Z900-SQL-ABEND                               24592015
           END-EVALUATE.                                                24593015
                                                                        24594015
      ******************************************************************24595015
      * CHECK SKU LEVEL PROMO PRICE W/ PROMO-ID                         24596015
      ******************************************************************24597015
       4060-GET-SKU-PROMO-WID.                                          24598015
                                                                        24599015
           SET PS-NOT-EOF-CSR       TO TRUE.                            24600015
           PERFORM 4061-OPN-SKU-PROMO-WID-CSR.                          24610015
           PERFORM 4062-FET-SKU-PROMO-WID-CSR.                          24620015
           PERFORM 4063-PROCESS-SKU-PROMO-WID UNTIL PS-END-OF-CSR.      24630015
           PERFORM 4064-CLS-SKU-PROMO-WID-CSR.                          24640015
                                                                        24650015
      ******************************************************************24660015
      * OPEN PROMO PRICE - PRICED AT SKU LEVEL W/ PROMO ID              24670015
      ******************************************************************24680015
       4061-OPN-SKU-PROMO-WID-CSR.                                      24690015
                                                                        24700015
           EXEC SQL                                                     24710015
                OPEN SKU-PROMO-WID-CSR                                  24720015
           END-EXEC.                                                    24730015
                                                                        24740015
           EVALUATE TRUE                                                24750015
               WHEN SQLCODE = ZERO                                      24760015
                   CONTINUE                                             24770015
                                                                        24780015
               WHEN OTHER                                               24790015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    24800015
                   MOVE '4061-OPN-SKU-PROMO-WID-CSR'                    24810015
                                    TO PV-PARAGRAPH-NAME                24820015
                   PERFORM Z900-SQL-ABEND                               24830015
           END-EVALUATE.                                                24840015
                                                                        24850015
      ******************************************************************24860015
      * GET PROMO PRICE - PRICED AT SKU LEVEL W/ PROMO ID               24870015
      ******************************************************************24880015
       4062-FET-SKU-PROMO-WID-CSR.                                      24890015
                                                                        24900015
           EXEC SQL                                                     24910015
                FETCH SKU-PROMO-WID-CSR                                 24920015
                 INTO :XST00028-PROMO-INTFC-ID                          24930015
                    , :XST00028-MDSE-LNE-ID                             24940015
                    , :XST00028-PRICG-TYP-CDE                           24950015
                    , :XST00028-ADV-CDE                                 24960015
                      :PV-ADV-CDE-NULL-IND                              24970015
                    , :XST00028-PROMO-ID                                24980015
                    , :XST00026-REG-PROMO-TYP-CDE                       24990015
                    , :GTTPRICD-SKU-NBR                                 25000015
                    , :GTTPRICD-INTR-UPC-ID                             25010015
                    , :GTTPRICD-UNT-RTL-AMT                             25020015
                    , :GTTPRICD-GP-RTL-QTY                              25030015
                    , :GTTPRICD-GP-RTL-AMT                              25040015
                    , :GTTPRICD-UPC-NBR                                 25050015
           END-EXEC.                                                    25060015
                                                                        25070015
           EVALUATE TRUE                                                25080015
               WHEN SQLCODE = ZERO                                      25090015
                   IF PV-ADV-CDE-NULL-IND < 0                           25100015
                       MOVE SPACES              TO XST00028-ADV-CDE     25110015
                   END-IF                                               25120015
                                                                        25130015
               WHEN SQLCODE = +100                                      25140015
                   SET PS-END-OF-CSR            TO TRUE                 25150015
                                                                        25160015
               WHEN OTHER                                               25170015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    25180015
                   MOVE '4062-FET-SKU-PROMO-WID-CSR'                    25190015
                                                TO PV-PARAGRAPH-NAME    25200015
                   PERFORM Z900-SQL-ABEND                               25210015
           END-EVALUATE.                                                25220015
                                                                        25230015
      ******************************************************************25240015
      * PROCESS SKU LEVEL PROMO PRICE W/NO PROMO-ID                     25250015
      ******************************************************************25260015
       4063-PROCESS-SKU-PROMO-WID.                                      25270015
                                                                        25280015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        25290015
           PERFORM 4062-FET-SKU-PROMO-WID-CSR.                          25300015
                                                                        25310015
      ******************************************************************25320015
      * CLOSE PROMO PRICE - PRICED AT SKU LEVEL W/ PROMO ID             25330015
      ******************************************************************25340015
       4064-CLS-SKU-PROMO-WID-CSR.                                      25350015
                                                                        25360015
           EXEC SQL                                                     25370015
                CLOSE SKU-PROMO-WID-CSR                                 25380015
           END-EXEC.                                                    25390015
                                                                        25400015
           EVALUATE TRUE                                                25410015
               WHEN SQLCODE = ZERO                                      25420015
                   CONTINUE                                             25430015
                                                                        25440015
               WHEN OTHER                                               25450015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    25451015
                   MOVE '4064-CLS-SKU-PROMO-WID-CSR'                    25452015
                                    TO PV-PARAGRAPH-NAME                25453015
                   PERFORM Z900-SQL-ABEND                               25454015
           END-EVALUATE.                                                25455015
                                                                        25456015
      ******************************************************************25457015
      * CHECK STYLE LEVEL PROMO PRICE W/ PROMO-ID                       25458015
      ******************************************************************25459015
       4070-GET-STY-PROMO-WID.                                          25460015
                                                                        25470015
           SET PS-NOT-EOF-CSR       TO TRUE.                            25480015
           PERFORM 4071-OPN-STY-PROMO-WID-CSR.                          25490015
           PERFORM 4072-FET-STY-PROMO-WID-CSR.                          25500015
           PERFORM 4073-PROCESS-STY-PROMO-WID UNTIL PS-END-OF-CSR.      25510015
           PERFORM 4074-CLS-STY-PROMO-WID-CSR.                          25520015
                                                                        25530015
      ******************************************************************25540015
      * OPEN PROMO PRICE - PRICED AT STYLE LEVEL W/ PROMO ID            25550015
      ******************************************************************25560015
       4071-OPN-STY-PROMO-WID-CSR.                                      25570015
                                                                        25580015
           EXEC SQL                                                     25590015
                OPEN STY-PROMO-WID-CSR                                  25600015
           END-EXEC.                                                    25610015
                                                                        25620015
           EVALUATE TRUE                                                25621015
               WHEN SQLCODE = ZERO                                      25622015
                   CONTINUE                                             25623015
                                                                        25624015
               WHEN OTHER                                               25625015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    25626015
                   MOVE '4071-OPN-STY-PROMO-WID-CSR'                    25627015
                                    TO PV-PARAGRAPH-NAME                25628015
                   PERFORM Z900-SQL-ABEND                               25629015
           END-EVALUATE.                                                25630015
                                                                        25640015
      ******************************************************************25650015
      * GET PROMO PRICE - PRICED AT STYLE LEVEL W/ PROMO ID             25660015
      ******************************************************************25670015
       4072-FET-STY-PROMO-WID-CSR.                                      25680015
                                                                        25690015
           EXEC SQL                                                     25700015
                FETCH STY-PROMO-WID-CSR                                 25710015
                 INTO :XST00028-PROMO-INTFC-ID                          25720015
                    , :XST00028-MDSE-LNE-ID                             25730015
                    , :XST00028-PRICG-TYP-CDE                           25740015
                    , :XST00028-ADV-CDE                                 25750015
                      :PV-ADV-CDE-NULL-IND                              25760015
                    , :XST00028-PROMO-ID                                25770015
                    , :XST00026-REG-PROMO-TYP-CDE                       25780015
                    , :GTTPRICD-SKU-NBR                                 25790015
                    , :GTTPRICD-INTR-UPC-ID                             25800015
                    , :GTTPRICD-UNT-RTL-AMT                             25810015
                    , :GTTPRICD-GP-RTL-QTY                              25820015
                    , :GTTPRICD-GP-RTL-AMT                              25830015
                    , :GTTPRICD-UPC-NBR                                 25840015
           END-EXEC.                                                    25850015
                                                                        25860015
           EVALUATE TRUE                                                25870015
               WHEN SQLCODE = ZERO                                      25880015
                   IF PV-ADV-CDE-NULL-IND < 0                           25890015
                       MOVE SPACES              TO XST00028-ADV-CDE     25900015
                   END-IF                                               25910015
                                                                        25920015
               WHEN SQLCODE = +100                                      25930015
                   SET PS-END-OF-CSR            TO TRUE                 25940015
                                                                        25950015
               WHEN OTHER                                               25960015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    25970015
                   MOVE '4072-FET-STY-PROMO-WID-CSR'                    25980015
                                                TO PV-PARAGRAPH-NAME    25990015
                   PERFORM Z900-SQL-ABEND                               26000015
           END-EVALUATE.                                                26010015
                                                                        26020015
      ******************************************************************26030015
      * PROCESS STY LEVEL PROMO PRICE W/NO PROMO-ID                     26040015
      ******************************************************************26050015
       4073-PROCESS-STY-PROMO-WID.                                      26060015
                                                                        26070015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        26080015
           PERFORM 4072-FET-STY-PROMO-WID-CSR.                          26090015
                                                                        26100015
      ******************************************************************26110015
      * CLOSE PROMO PRICE - PRICED AT STYLE LEVEL W/ PROMO ID           26120015
      ******************************************************************26130015
       4074-CLS-STY-PROMO-WID-CSR.                                      26140015
                                                                        26150015
           EXEC SQL                                                     26160015
                CLOSE STY-PROMO-WID-CSR                                 26170015
           END-EXEC.                                                    26180015
                                                                        26190015
           EVALUATE TRUE                                                26200015
               WHEN SQLCODE = ZERO                                      26210015
                   CONTINUE                                             26220015
                                                                        26230015
               WHEN OTHER                                               26240015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    26250015
                   MOVE '4074-CLS-STY-PROMO-WID-CSR'                    26260015
                                    TO PV-PARAGRAPH-NAME                26270015
                   PERFORM Z900-SQL-ABEND                               26280015
           END-EVALUATE.                                                26290015
                                                                        26300015
      ******************************************************************26310015
      * CHECK SUB CLASS LEVEL PROMO PRICE W/ PROMO-ID                   26320015
      ******************************************************************26330015
       4080-GET-SCL-PROMO-WID.                                          26340015
                                                                        26350015
           SET PS-NOT-EOF-CSR       TO TRUE.                            26360015
           PERFORM 4081-OPN-SCL-PROMO-WID-CSR.                          26370015
           PERFORM 4082-FET-SCL-PROMO-WID-CSR.                          26380015
           PERFORM 4083-PROCESS-SCL-PROMO-WID UNTIL PS-END-OF-CSR.      26390015
           PERFORM 4084-CLS-SCL-PROMO-WID-CSR.                          26400015
                                                                        26410015
      ******************************************************************26420015
      * OPEN PROMO PRICE - PRICED AT SCL LEVEL W/ PROMO ID              26430015
      ******************************************************************26440015
       4081-OPN-SCL-PROMO-WID-CSR.                                      26450015
                                                                        26460015
           EXEC SQL                                                     26470015
                OPEN SCL-PROMO-WID-CSR                                  26480015
           END-EXEC.                                                    26481015
                                                                        26482015
           EVALUATE TRUE                                                26483015
               WHEN SQLCODE = ZERO                                      26484015
                   CONTINUE                                             26485015
                                                                        26486015
               WHEN OTHER                                               26487015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    26488015
                   MOVE '4081-OPN-SCL-PROMO-WID-CSR'                    26489015
                                    TO PV-PARAGRAPH-NAME                26490015
                   PERFORM Z900-SQL-ABEND                               26500015
           END-EVALUATE.                                                26510015
                                                                        26520015
      ******************************************************************26530015
      * GET PROMO PRICE - PRICED AT SCL LEVEL W/ PROMO ID               26540015
      ******************************************************************26550015
       4082-FET-SCL-PROMO-WID-CSR.                                      26560015
                                                                        26570015
           EXEC SQL                                                     26580015
                FETCH SCL-PROMO-WID-CSR                                 26590015
                 INTO :XST00028-PROMO-INTFC-ID                          26600015
                    , :XST00028-MDSE-LNE-ID                             26610015
                    , :XST00028-PRICG-TYP-CDE                           26620015
                    , :XST00028-ADV-CDE                                 26630015
                      :PV-ADV-CDE-NULL-IND                              26640015
                    , :XST00028-PROMO-ID                                26650015
                    , :XST00026-REG-PROMO-TYP-CDE                       26660015
                    , :XST00013-MAJ-CL-NBR                              26670015
                    , :XST00013-SUB-CL-NBR                              26680015
                    , :GTTPRICD-SKU-NBR                                 26690015
                    , :GTTPRICD-INTR-UPC-ID                             26700015
                    , :GTTPRICD-UNT-RTL-AMT                             26710015
                    , :GTTPRICD-GP-RTL-QTY                              26720015
                    , :GTTPRICD-GP-RTL-AMT                              26730015
                    , :GTTPRICD-UPC-NBR                                 26740015
           END-EXEC.                                                    26750015
                                                                        26760015
           EVALUATE TRUE                                                26770015
               WHEN SQLCODE = ZERO                                      26780015
                   IF PV-ADV-CDE-NULL-IND < 0                           26790015
                       MOVE SPACES              TO XST00028-ADV-CDE     26800015
                   END-IF                                               26810015
                                                                        26820015
               WHEN SQLCODE = +100                                      26830015
                   SET PS-END-OF-CSR            TO TRUE                 26840015
                                                                        26850015
               WHEN OTHER                                               26860015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    26870015
                   MOVE '4082-FET-SCL-PROMO-WID-CSR'                    26880015
                                                TO PV-PARAGRAPH-NAME    26890015
                   PERFORM Z900-SQL-ABEND                               26900015
           END-EVALUATE.                                                26910015
                                                                        26920015
      ******************************************************************26930015
      * PROCESS SCL LEVEL PROMO PRICE W/NO PROMO-ID                     26940015
      ******************************************************************26950015
       4083-PROCESS-SCL-PROMO-WID.                                      26960015
                                                                        26970015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        26980015
           PERFORM 4082-FET-SCL-PROMO-WID-CSR.                          26990015
                                                                        27000015
      ******************************************************************27010015
      * CLOSE PROMO PRICE - PRICED AT SCL LEVEL W/ PROMO ID             27020015
      ******************************************************************27030015
       4084-CLS-SCL-PROMO-WID-CSR.                                      27040015
                                                                        27050015
           EXEC SQL                                                     27060015
                CLOSE SCL-PROMO-WID-CSR                                 27070015
           END-EXEC.                                                    27080015
                                                                        27090015
           EVALUATE TRUE                                                27100015
               WHEN SQLCODE = ZERO                                      27110015
                   CONTINUE                                             27120015
                                                                        27130015
               WHEN OTHER                                               27140015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    27150015
                   MOVE '4084-CLS-SCL-PROMO-WID-CSR'                    27160015
                                    TO PV-PARAGRAPH-NAME                27170015
                   PERFORM Z900-SQL-ABEND                               27180015
           END-EVALUATE.                                                27190015
                                                                        27200015
      ******************************************************************27210015
      * CHECK MAJ CLASS LEVEL PROMO PRICE W/ PROMO-ID                   27220015
      ******************************************************************27230015
       4090-GET-MCL-PROMO-WID.                                          27240015
                                                                        27250015
           SET PS-NOT-EOF-CSR       TO TRUE.                            27260015
           PERFORM 4091-OPN-MCL-PROMO-WID-CSR.                          27270015
           PERFORM 4092-FET-MCL-PROMO-WID-CSR.                          27280015
           PERFORM 4093-PROCESS-MCL-PROMO-WID UNTIL PS-END-OF-CSR.      27290015
           PERFORM 4094-CLS-MCL-PROMO-WID-CSR.                          27300015
                                                                        27310015
      ******************************************************************27320015
      * OPEN PROMO PRICE - PRICED AT MCL LEVEL W/ PROMO ID              27330015
      ******************************************************************27340015
       4091-OPN-MCL-PROMO-WID-CSR.                                      27350015
                                                                        27360015
           EXEC SQL                                                     27370015
                OPEN MCL-PROMO-WID-CSR                                  27380015
           END-EXEC.                                                    27390015
                                                                        27400015
           EVALUATE TRUE                                                27410015
               WHEN SQLCODE = ZERO                                      27420015
                   CONTINUE                                             27430015
                                                                        27440015
               WHEN OTHER                                               27441015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    27442015
                   MOVE '4091-OPN-MCL-PROMO-WID-CSR'                    27443015
                                    TO PV-PARAGRAPH-NAME                27444015
                   PERFORM Z900-SQL-ABEND                               27445015
           END-EVALUATE.                                                27446015
                                                                        27447015
      ******************************************************************27448015
      * GET PROMO PRICE - PRICED AT MCL LEVEL W/ PROMO ID               27449015
      ******************************************************************27450015
       4092-FET-MCL-PROMO-WID-CSR.                                      27460015
                                                                        27470015
           EXEC SQL                                                     27480015
                FETCH MCL-PROMO-WID-CSR                                 27490015
                 INTO :XST00028-PROMO-INTFC-ID                          27500015
                    , :XST00028-MDSE-LNE-ID                             27510015
                    , :XST00028-PRICG-TYP-CDE                           27520015
                    , :XST00028-ADV-CDE                                 27530015
                      :PV-ADV-CDE-NULL-IND                              27540015
                    , :XST00028-PROMO-ID                                27550015
                    , :XST00013-MAJ-CL-NBR                              27560015
                    , :XST00013-SUB-CL-NBR                              27570015
                    , :XST00026-REG-PROMO-TYP-CDE                       27580015
                    , :GTTPRICD-SKU-NBR                                 27590015
                    , :GTTPRICD-INTR-UPC-ID                             27600015
                    , :GTTPRICD-UNT-RTL-AMT                             27610015
                    , :GTTPRICD-GP-RTL-QTY                              27620015
                    , :GTTPRICD-GP-RTL-AMT                              27630015
                    , :GTTPRICD-UPC-NBR                                 27640015
           END-EXEC.                                                    27650015
                                                                        27660015
           EVALUATE TRUE                                                27670015
               WHEN SQLCODE = ZERO                                      27680015
                   IF PV-ADV-CDE-NULL-IND < 0                           27690015
                       MOVE SPACES              TO XST00028-ADV-CDE     27700015
                   END-IF                                               27710015
                                                                        27720015
               WHEN SQLCODE = +100                                      27730015
                   SET PS-END-OF-CSR            TO TRUE                 27740015
                                                                        27750015
               WHEN OTHER                                               27760015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    27770015
                   MOVE '4092-FET-MCL-PROMO-WID-CSR'                    27780015
                                                TO PV-PARAGRAPH-NAME    27790015
                   PERFORM Z900-SQL-ABEND                               27800015
           END-EVALUATE.                                                27810015
                                                                        27820015
      ******************************************************************27830015
      * PROCESS MCL LEVEL PROMO PRICE W/NO PROMO-ID                     27840015
      ******************************************************************27850015
       4093-PROCESS-MCL-PROMO-WID.                                      27860015
                                                                        27870015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        27880015
           PERFORM 4092-FET-MCL-PROMO-WID-CSR.                          27890015
                                                                        27900015
      ******************************************************************27910015
      * CLOSE PROMO PRICE - PRICED AT MCL LEVEL W/ PROMO ID             27920015
      ******************************************************************27930015
       4094-CLS-MCL-PROMO-WID-CSR.                                      27940015
                                                                        27950015
           EXEC SQL                                                     27960015
                CLOSE MCL-PROMO-WID-CSR                                 27970015
           END-EXEC.                                                    27980015
                                                                        27990015
           EVALUATE TRUE                                                28000015
               WHEN SQLCODE = ZERO                                      28010015
                   CONTINUE                                             28020015
                                                                        28030015
               WHEN OTHER                                               28040015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    28050015
                   MOVE '4094-CLS-MCL-PROMO-WID-CSR'                    28060015
                                    TO PV-PARAGRAPH-NAME                28070015
                   PERFORM Z900-SQL-ABEND                               28071015
           END-EVALUATE.                                                28072015
                                                                        28073015
      ******************************************************************28074015
      * CHECK DEPT LEVEL PROMO PRICE W/ PROMO-ID                        28075015
      ******************************************************************28076015
       4100-GET-DPT-PROMO-WID.                                          28077015
                                                                        28078015
           SET PS-NOT-EOF-CSR       TO TRUE.                            28079015
           PERFORM 4101-OPN-DPT-PROMO-WID-CSR.                          28080015
           PERFORM 4102-FET-DPT-PROMO-WID-CSR.                          28090015
           PERFORM 4103-PROCESS-DPT-PROMO-WID UNTIL PS-END-OF-CSR.      28100015
           PERFORM 4104-CLS-DPT-PROMO-WID-CSR.                          28110015
                                                                        28120015
      ******************************************************************28130015
      * OPEN PROMO PRICE - PRICED AT DPT LEVEL W/ PROMO ID              28140015
      ******************************************************************28150015
       4101-OPN-DPT-PROMO-WID-CSR.                                      28160015
                                                                        28170015
           EXEC SQL                                                     28180015
                OPEN DPT-PROMO-WID-CSR                                  28190015
           END-EXEC.                                                    28200015
                                                                        28210015
           EVALUATE TRUE                                                28220015
               WHEN SQLCODE = ZERO                                      28230015
                   CONTINUE                                             28240015
                                                                        28250015
               WHEN OTHER                                               28260015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    28270015
                   MOVE '4101-OPN-DPT-PROMO-WID-CSR'                    28280015
                                    TO PV-PARAGRAPH-NAME                28290015
                   PERFORM Z900-SQL-ABEND                               28300015
           END-EVALUATE.                                                28310015
                                                                        28320015
      ******************************************************************28330015
      * GET PROMO PRICE - PRICED AT DPT LEVEL W/ PROMO ID               28340015
      ******************************************************************28350015
       4102-FET-DPT-PROMO-WID-CSR.                                      28360015
                                                                        28370015
           EXEC SQL                                                     28380015
                FETCH DPT-PROMO-WID-CSR                                 28390015
                 INTO :XST00028-PROMO-INTFC-ID                          28400015
                    , :XST00028-MDSE-LNE-ID                             28410015
                    , :XST00028-PRICG-TYP-CDE                           28420015
                    , :XST00028-ADV-CDE                                 28430015
                      :PV-ADV-CDE-NULL-IND                              28440015
                    , :XST00028-PROMO-ID                                28450015
                    , :XST00013-MAJ-CL-NBR                              28460015
                    , :XST00013-SUB-CL-NBR                              28470015
                    , :XST00026-REG-PROMO-TYP-CDE                       28480015
                    , :GTTPRICD-SKU-NBR                                 28490015
                    , :GTTPRICD-INTR-UPC-ID                             28500015
                    , :GTTPRICD-UNT-RTL-AMT                             28510015
                    , :GTTPRICD-GP-RTL-QTY                              28520015
                    , :GTTPRICD-GP-RTL-AMT                              28530015
                    , :GTTPRICD-UPC-NBR                                 28540015
           END-EXEC.                                                    28550015
                                                                        28560015
           EVALUATE TRUE                                                28570015
               WHEN SQLCODE = ZERO                                      28580015
                   IF PV-ADV-CDE-NULL-IND < 0                           28590015
                       MOVE SPACES              TO XST00028-ADV-CDE     28600015
                   END-IF                                               28610015
                                                                        28620015
               WHEN SQLCODE = +100                                      28630015
                   SET PS-END-OF-CSR            TO TRUE                 28640015
                                                                        28650015
               WHEN OTHER                                               28660015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    28670015
                   MOVE '4102-FET-DPT-PROMO-WID-CSR'                    28680015
                                                TO PV-PARAGRAPH-NAME    28690015
                   PERFORM Z900-SQL-ABEND                               28700015
           END-EVALUATE.                                                28710015
                                                                        28720015
      ******************************************************************28730015
      * PROCESS DPT LEVEL PROMO PRICE W/NO PROMO-ID                     28740015
      ******************************************************************28750015
       4103-PROCESS-DPT-PROMO-WID.                                      28760015
                                                                        28770015
           PERFORM 5000-VALIDATE-FETCHED-RECORD.                        28780015
           PERFORM 4102-FET-DPT-PROMO-WID-CSR.                          28790015
                                                                        28800015
      ******************************************************************28810015
      * CLOSE PROMO PRICE - PRICED AT DPT LEVEL W/ PROMO ID             28820015
      ******************************************************************28830015
       4104-CLS-DPT-PROMO-WID-CSR.                                      28840015
                                                                        28850015
           EXEC SQL                                                     28860015
                CLOSE DPT-PROMO-WID-CSR                                 28870015
           END-EXEC.                                                    28880015
                                                                        28890015
           EVALUATE TRUE                                                28900015
               WHEN SQLCODE = ZERO                                      28910015
                   CONTINUE                                             28920015
                                                                        28930015
               WHEN OTHER                                               28940015
                   DISPLAY 'PROMO ID:  ' PV-PROMO-ID                    28950015
                   MOVE '4104-CLS-DPT-PROMO-WID-CSR'                    28951015
                                    TO PV-PARAGRAPH-NAME                28952015
                   PERFORM Z900-SQL-ABEND                               28953015
           END-EVALUATE.                                                28954015
                                                                        28955015
      ******************************************************************28956015
      * VALIDATE THE FETCHED RECORD                                     28957015
      ******************************************************************28958015
       5000-VALIDATE-FETCHED-RECORD.                                    28959015
                                                                        28960015
           SET PS-DONT-FETCH-NEXT   TO TRUE.                            28970015
                                                                        28980015
           IF XS050-INCL-UNAD-SW = 'Y'                                  28990015
               PERFORM 5100-VALIDATE-STORE                              29000015
               IF PS-NO-STORE-FOUND                                     29010015
                   SET PS-FETCH-NEXT    TO TRUE                         29020015
               END-IF                                                   29030015
           ELSE                                                         29040015
      *        UNADVERTISED SHOULD NOT BE INCLUDED                      29050015
      *        REG PROMO TYP CDE = A WHICH MEANS ADVERTISED             29060015
               IF XST00026-REG-PROMO-TYP-CDE = 'A'                      29070015
                   IF XST00028-ADV-CDE = 'Y'                            29080015
                       PERFORM 5100-VALIDATE-STORE                      29090015
                       IF PS-NO-STORE-FOUND                             29091015
                           SET PS-FETCH-NEXT     TO TRUE                29092015
                       END-IF                                           29093015
                   ELSE                                                 29094015
      *                THE PROMO ITEM IS UNAD TIED TO A PROMOTION       29095015
      *                WHICH SHOULD NOT BE INCLUDED                     29096015
                       SET PS-FETCH-NEXT       TO TRUE                  29097015
                   END-IF                                               29098015
               ELSE                                                     29099015
      *            REG PROMO TYP CDE = U WHICH MEANS UNADVERTISED       29100015
                   SET PS-FETCH-NEXT         TO TRUE                    29110015
               END-IF                                                   29120015
           END-IF.                                                      29130015
                                                                        29140015
           IF PS-DONT-FETCH-NEXT                                        29150015
               IF XS050-INCL-PART-DAY-SW = 'Y'                          29160015
                   CONTINUE                                             29170015
               ELSE                                                     29180015
      *            PARTIAL DAY PROMOTIONS SHOULD NOT BE INCLUDED        29190015
                   IF (PV-STRT-TM-HM = '00.00' AND                      29200015
                       PV-END-TM-HM  = '23.59')                         29210015
                       CONTINUE                                         29220015
                   ELSE                                                 29230015
      *                THE PROMOTION IS A PARTIAL DAY                   29240015
                       SET PS-FETCH-NEXT TO TRUE                        29250015
                   END-IF                                               29260015
               END-IF                                                   29270015
           END-IF.                                                      29280015
                                                                        29290015
      ****************************************************************  29300015
      * PRICING TYPE CODE VALUES                                        29310015
      ****************************************************************  29320015
      *****                                                             29330015
      *****  SIMPLE PRICE                                               29340015
      *****                                                             29350015
      *                  SPO = SIMPLE PERCENT OFF                       29360015
      *                  SRP = SIMPLE REGULAR PRICE                     29370015
      *                  SPP = SIMPLE PRICE POINT                       29380015
      *                  MPP = COMPETITIVE PRICING (CONSIDERED SIMPLE)  29390015
      *                  SAO = SIMPLE AMOUNT OFF                        29400015
      *****                                                             29410015
      *****  CLEARANCE SIMPLE PRICE ** GOLDSTAR **********************  29411015
      *****                                                             29412015
      *                  CPO = CLEARANCE PERCENT OFF                    29413015
      *                  CPP = CLEARANCE PRICE POINT                    29414015
      *                  CAO = CLEARANCE AMOUNT OFF                     29415015
      *****                                                             29416015
      *****  TIER PRICE                                                 29417015
      *****                                                             29418015
      *                  TAP = TIER THRESHOLD AMOUNT, PERCENT OFF       29419015
      *                  TQP = TIER THRESHOLD QUANTITY, PERCENT OFF     29420015
      *     (PHASE 2)    TAA = TIER THRESHOLD AMOUNT, AMOUNT OFF        29430015
      *     (PHASE 2)    TQA = TIER THRESHOLD QUANTITY, AMOUNT OFF      29440015
      *****                                                             29450015
      *****  ADDITIONAL PRICE OFF (PHASE 2)                             29460015
      *****                                                             29470015
      *                  APO = ADDITIONAL PERCENT OFF                   29480015
      *                  AAO = ADDITIONAL AMOUNT OFF                    29490015
      *****                                                             29500015
      ***** GROUP PRICING                                               29510015
      *****                                                             29520015
      *                  GAO = GROUP AMOUNT OFF                         29530015
      *                  GBL = GROUP BOGO (BUY ONE GET ONE FREE)        29540015
      *                  GBD = GROUP BOGO DOLLAR                        29550015
      *                  GBP = GROUP BOGO PERCENT                       29560015
      *      (PHASE 2)   GPO = PERCENT OFF REGULAR GROUP PRICING        29570015
      ****************************************************************  29580015
           IF PS-DONT-FETCH-NEXT                                        29590015
               EVALUATE XST00028-PRICG-TYP-CDE                          29591015
                   WHEN 'SPO'                                           29592015
                   WHEN 'SRP'                                           29593015
                   WHEN 'SPP'                                           29594015
                   WHEN 'MPP'                                           29595015
                   WHEN 'SAO'                                           29596015
                       PERFORM 7000-PROCESS-SIMPLE-PRICE                29597015
                   WHEN 'CPO'                                           29598015
                   WHEN 'CPP'                                           29599015
                   WHEN 'CAO'                                           29600015
                       PERFORM 5300-CHECK-TICKET-COLOR                  29610015
                   WHEN 'TAP'                                           29620015
                   WHEN 'TQP'                                           29630015
      *P2          WHEN 'TAA'                                           29640015
      *P2          WHEN 'TQA'                                           29650015
                       IF XS050-INCL-TIERED-PROMO-SW = 'Y'              29660015
                           PERFORM 7200-SELECT-TIER-PRICE               29670015
                       ELSE                                             29680015
                           SET PS-FETCH-NEXT      TO TRUE               29690015
                       END-IF                                           29691015
      *P2          WHEN 'APO'                                           29692015
      *P2          WHEN 'AAO'                                           29693015
      *P2              IF XS050-INCL-ADD-PCT-AMT-SW = 'Y'               29694015
      *P2                  PERFORM 7300-SELECT-ADDL-PRICE-OFF           29695015
      *P2              ELSE                                             29696015
      *P2                  SET PS-FETCH-NEXT      TO TRUE               29697015
      *P2              END-IF                                           29698015
                   WHEN 'GAO'                                           29699015
                   WHEN 'GBL'                                           29700015
                   WHEN 'GBD'                                           29700115
                   WHEN 'GBP'                                           29700215
      *P2          WHEN 'GPO'                                           29700315
                       IF XS050-INCL-GP-PRC-SW = 'Y'                    29700415
                           PERFORM 7400-SELECT-GRP-PRICE                29700515
                       ELSE                                             29700615
                           SET PS-FETCH-NEXT      TO TRUE               29700715
                       END-IF                                           29700815
      ****************************************************************  29700915
      ***** GIFT W/ PURCHASE ************** GIFT W/ PURCHASE *****      29701015
      ****************************************************************  29701115
      *P2          WHEN 'GBQ'                                           29701215
      *P2          WHEN 'GBA'                                           29701315
      *P2          WHEN 'PBQ'                                           29701415
      *P2          WHEN 'PBA'                                           29701515
      *P2          WHEN 'GWP'                                           29701615
      *P2          WHEN 'PGO'                                           29701715
      *P2          WHEN 'PGA'                                           29701815
      *P2          WHEN 'PGP'                                           29701915
      *P2              IF XS050-INCL-BWP-PROMO-SW = 'Y'                 29702015
      *P2                  PERFORM 7400-SELECT-GIFT-W-PURCHASE          29703015
      *P2              ELSE                                             29704015
      *P2                  SET PS-FETCH-NEXT      TO TRUE               29705015
      *P2              END-IF                                           29706015
      ****************************************************************  29707015
      ******* PRICING TYPE CODE VALUE NOT FOUND               ********  29708015
      ****************************************************************  29709015
                   WHEN OTHER                                           29710015
                       DISPLAY 'PRICG TYP CDE:  '                       29720015
                                                  XST00028-PRICG-TYP-CDE29730015
                       SET ABEND-4008-DATA-ERROR   TO TRUE              29740015
                       MOVE '5000-VALIDATE-FETCHED-R'                   29750015
                                                   TO PV-PARAGRAPH-NAME 29760015
                       MOVE 'INVALID PRICG TYP CDE '                    29770015
                                                   TO PV-OPERATION-MSG-129780015
                       PERFORM Z800-ABEND                               29790015
               END-EVALUATE                                             29800015
           END-IF.                                                      29810015
                                                                        29820015
      ******************************************************************29830015
      * VALIDATE STORE GROUPS                                           29840015
      ******************************************************************29850015
       5100-VALIDATE-STORE.                                             29860015
                                                                        29870015
           PERFORM 5110-OPN-STANDARD-STR-GRP.                           29880015
           PERFORM 5120-FET-STANDARD-STR-GRP.                           29890015
           PERFORM 5140-CLS-STANDARD-STR-GRP.                           29900015
                                                                        29910015
           IF PS-NO-STORE-FOUND                                         29920015
               PERFORM 5210-OPN-AD-HOC-STR-GRP                          29930015
               PERFORM 5220-FET-AD-HOC-STR-GRP                          29940015
               PERFORM 5240-CLS-AD-HOC-STR-GRP                          29950015
           END-IF.                                                      29960015
                                                                        29970015
      ******************************************************************29980015
      * OPENS STANDARD STORE GROUP CURSOR                               29990015
      ******************************************************************30000015
       5110-OPN-STANDARD-STR-GRP.                                       30010015
                                                                        30020015
           EXEC SQL                                                     30030015
                OPEN STD-STORE-GRP-CSR                                  30040015
           END-EXEC.                                                    30050015
                                                                        30060015
           EVALUATE TRUE                                                30070015
               WHEN SQLCODE = ZERO                                      30080015
                   CONTINUE                                             30090015
                                                                        30100015
               WHEN OTHER                                               30110015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  30120015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     30130015
                   DISPLAY 'FULL TMST:       ' PV-FULL-TMST             30140015
                   DISPLAY 'STORE:           ' PV-STR                   30150015
                   DISPLAY 'DATE:            ' PV-DT                    30160015
                   MOVE '5110-OPN-STANDARD-STR-GRP '                    30170015
                                    TO PV-PARAGRAPH-NAME                30180015
                   PERFORM Z900-SQL-ABEND                               30190015
           END-EVALUATE.                                                30200015
                                                                        30210015
      ******************************************************************30220015
      * FETCH STANDARD STORE GROUP CURSOR                               30230015
      ******************************************************************30240015
       5120-FET-STANDARD-STR-GRP.                                       30250015
                                                                        30260015
           EXEC SQL                                                     30270015
                FETCH STD-STORE-GRP-CSR                                 30280015
                 INTO :PV-PROMO-STRT-TMST                               30290015
                    , :PV-PROMO-END-TMST                                30300015
                    , :XST00029-STR-SELN-HIER-CDE                       30310015
           END-EXEC.                                                    30320015
                                                                        30330015
           EVALUATE TRUE                                                30340015
               WHEN SQLCODE = +0                                        30350015
                   SET PS-STORE-FOUND    TO TRUE                        30360015
                                                                        30370015
               WHEN SQLCODE = +100                                      30380015
                   SET PS-NO-STORE-FOUND TO TRUE                        30390015
                                                                        30400015
               WHEN OTHER                                               30410015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  30420015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     30430015
                   DISPLAY 'FULL TMST:       ' PV-FULL-TMST             30440015
                   DISPLAY 'STORE:           ' PV-STR                   30450015
                   DISPLAY 'DATE:            ' PV-DT                    30460015
                   MOVE '5120-FET-STANDARD-STR-GRP'                     30470015
                                         TO PV-PARAGRAPH-NAME           30480015
                   PERFORM Z900-SQL-ABEND                               30490015
           END-EVALUATE.                                                30500015
                                                                        30510015
      ******************************************************************30520015
      * CLOSE STANDARD STORE GROUP CURSOR                               30530015
      ******************************************************************30540015
       5140-CLS-STANDARD-STR-GRP.                                       30550015
                                                                        30560015
           EXEC SQL                                                     30570015
                CLOSE STD-STORE-GRP-CSR                                 30580015
           END-EXEC.                                                    30590015
                                                                        30600015
           EVALUATE TRUE                                                30610015
               WHEN SQLCODE = ZERO                                      30620015
                   CONTINUE                                             30630015
                                                                        30640015
               WHEN OTHER                                               30650015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  30660015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     30670015
                   DISPLAY 'FULL TMST:       ' PV-FULL-TMST             30680015
                   DISPLAY 'STORE:           ' PV-STR                   30690015
                   DISPLAY 'DATE:            ' PV-DT                    30700015
                   MOVE '5140-CLS-STANDARD-STR-GRP '                    30710015
                                    TO PV-PARAGRAPH-NAME                30720015
                   PERFORM Z900-SQL-ABEND                               30730015
           END-EVALUATE.                                                30740015
                                                                        30750015
      ******************************************************************30760015
      * OPEN AD-HOC STORE GROUPS CURSOR                                 30770015
      ******************************************************************30780015
       5210-OPN-AD-HOC-STR-GRP.                                         30790015
                                                                        30800015
           EXEC SQL                                                     30810015
                OPEN AD-HOC-STR-GRP-CSR                                 30820015
           END-EXEC.                                                    30830015
                                                                        30840015
           EVALUATE TRUE                                                30850015
               WHEN SQLCODE = ZERO                                      30860015
                   CONTINUE                                             30861015
                                                                        30862015
               WHEN OTHER                                               30863015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  30864015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     30865015
                   DISPLAY 'FULL TMST:       ' PV-FULL-TMST             30866015
                   DISPLAY 'STORE:           ' PV-STR                   30867015
                   MOVE '5210-OPN-AD-HOC-STR-GRP '                      30868015
                                    TO PV-PARAGRAPH-NAME                30869015
                   PERFORM Z900-SQL-ABEND                               30870015
           END-EVALUATE.                                                30880015
                                                                        30890015
      ******************************************************************30900015
      * FETCH AD-HOC STORE GROUPS CURSOR                                30910015
      ******************************************************************30920015
       5220-FET-AD-HOC-STR-GRP.                                         30930015
                                                                        30940015
           EXEC SQL                                                     30950015
                FETCH AD-HOC-STR-GRP-CSR                                30960015
                 INTO :PV-PROMO-STRT-TMST                               30970015
                    , :PV-PROMO-END-TMST                                30980015
                    , :XST00031-STR-SELN-HIER-CDE                       30990015
           END-EXEC.                                                    31000015
                                                                        31010015
           EVALUATE TRUE                                                31020015
               WHEN SQLCODE = +0                                        31030015
                   SET PS-STORE-FOUND    TO TRUE                        31040015
                                                                        31050015
               WHEN SQLCODE = +100                                      31060015
                   SET PS-NO-STORE-FOUND TO TRUE                        31070015
                                                                        31080015
               WHEN OTHER                                               31090015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  31100015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     31110015
                   DISPLAY 'FULL TMST:       ' PV-FULL-TMST             31120015
                   DISPLAY 'STORE:           ' PV-STR                   31130015
                   MOVE '5220-FET-AD-HOC-STR-GRP'                       31140015
                                         TO PV-PARAGRAPH-NAME           31150015
                   PERFORM Z900-SQL-ABEND                               31160015
           END-EVALUATE.                                                31170015
                                                                        31180015
      ******************************************************************31190015
      * CLOSE AD-HOC STORE GROUPS CURSOR                                31200015
      ******************************************************************31210015
       5240-CLS-AD-HOC-STR-GRP.                                         31220015
                                                                        31230015
           EXEC SQL                                                     31240015
                CLOSE AD-HOC-STR-GRP-CSR                                31240115
           END-EXEC.                                                    31240215
                                                                        31240315
           EVALUATE TRUE                                                31240415
               WHEN SQLCODE = ZERO                                      31240515
                   CONTINUE                                             31240615
                                                                        31240715
               WHEN OTHER                                               31240815
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  31240915
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     31241015
                   DISPLAY 'FULL TMST:       ' PV-FULL-TMST             31242015
                   DISPLAY 'STORE:           ' PV-STR                   31243015
                   MOVE '5240-CLS-AD-HOC-STR-GRP '                      31243115
                                    TO PV-PARAGRAPH-NAME                31243215
                   PERFORM Z900-SQL-ABEND                               31243315
           END-EVALUATE.                                                31243415
                                                                        31243515
      ******************************************************************31243615
      * GOLDSTARS CAN BE SET UP TO APPLY TO ALL CLEARANCE, ONLY         31243715
      * CONTINUOUS CLEARANCE, OR TO ONLY FIRST-HIT CLEARANCE.           31243815
      ******************************************************************31243915
       5300-CHECK-TICKET-COLOR.                                         31244015
                                                                        31244115
           EVALUATE XST00028-TKT-CLOR-CDE                               31244215
      ****************************************************************  31244315
      *****  ALL TYPES OF CLEARANCE RECEIVE THIS GOLDSTAR          ***  31244415
      ****************************************************************  31244515
               WHEN PC-ALL-TICKET                                       31244615
                   PERFORM 7000-PROCESS-SIMPLE-PRICE                    31244715
                                                                        31244815
      ****************************************************************  31244915
      *****  ONLY RED TICKET (CONTINUOUS) CLEARANCE ITEMS RECEIVE  ***  31245015
      *****  THIS GOLDSTAR                                         ***  31245115
      ****************************************************************  31245215
               WHEN PC-RED-TICKET                                       31245315
                   IF GTTPRICD-UNT-RTL-CHG-DTE >                        31245415
                      GTTPRICD-UPC-STAT-CHG-DTE                         31245515
                       PERFORM 7000-PROCESS-SIMPLE-PRICE                31245615
                   ELSE                                                 31245715
                       SET PS-SIMPLE-PRICE-NOT-FOUND TO TRUE            31245815
                   END-IF                                               31245915
                                                                        31246015
      ****************************************************************  31246115
      *****  ONLY YELLOW TICKET (FIRST-HIT) CLEARANCE ITEMS        ***  31246215
      *****  RECEIVE THIS GOLDSTAR                                 ***  31246315
      ****************************************************************  31246415
               WHEN PC-YELLOW-TICKET                                    31246515
                   IF GTTPRICD-UNT-RTL-CHG-DTE <=                       31246615
                      GTTPRICD-UPC-STAT-CHG-DTE                         31246715
                       PERFORM 7000-PROCESS-SIMPLE-PRICE                31246815
                   ELSE                                                 31246915
                       SET PS-SIMPLE-PRICE-NOT-FOUND TO TRUE            31247015
                   END-IF                                               31248015
                                                                        31249015
      ****************************************************************  31250015
      *****  A VALUE OTHER THAN ALL, RED, OR YELLOW TICKET WAS     ***  31260015
      *****  PLACED IN THE XST_MDSE_LNE_SELN TABLE FOR THIS        ***  31270015
      *****  GOLDSTAR                                                   31280015
      ****************************************************************  31290015
               WHEN OTHER                                               31300015
                   DISPLAY 'TICKET COLOR CODE:  ' XST00028-TKT-CLOR-CDE 31310015
                   SET ABEND-4008-DATA-ERROR   TO TRUE                  31320015
                   MOVE '5300-CHECK-TICKET-COLOR' TO PV-PARAGRAPH-NAME  31330015
                   MOVE 'INVALID TKT CLOR CDE  '  TO PV-OPERATION-MSG-1 31331015
                   PERFORM Z800-ABEND                                   31332015
                                                                        31333015
           END-EVALUATE.                                                31334015
                                                                        31335015
      ******************************************************************31336015
      * CHECK IF EXCLUSIONS EXIST                                       31337015
      ******************************************************************31338015
       6000-CHECK-FOR-EXCLUSIONS.                                       31339015
                                                                        31339115
           SET PS-NO-EXCL-FOUND     TO TRUE.                            31339215
           PERFORM 6100-DO-EXCLUSIONS-EXIST.                            31339315
                                                                        31339415
           IF PS-EXCL-EXISTS                                            31339515
             EVALUATE TRUE                                              31339615
                 WHEN PS-HIER-DPT-CDE                                   31339715
                     PERFORM 6200-MAJOR-CLASS-EXCLUSION                 31339815
                     IF PS-NO-EXCL-FOUND                                31339915
                       PERFORM 6300-SUB-CLASS-EXCLUSION                 31340015
                     END-IF                                             31340115
                     IF PS-NO-EXCL-FOUND                                31340215
                       PERFORM 6400-STYLE-EXCLUSION                     31340315
                     END-IF                                             31340415
                     IF PS-NO-EXCL-FOUND                                31340515
                       PERFORM 6500-SKU-EXCLUSION                       31340615
                     END-IF                                             31340715
                                                                        31340815
                 WHEN PS-HIER-MCL-CDE                                   31340915
                     PERFORM 6300-SUB-CLASS-EXCLUSION                   31341015
                     IF PS-NO-EXCL-FOUND                                31341115
                       PERFORM 6400-STYLE-EXCLUSION                     31341215
                     END-IF                                             31341315
                     IF PS-NO-EXCL-FOUND                                31341415
                       PERFORM 6500-SKU-EXCLUSION                       31341515
                     END-IF                                             31341615
                                                                        31341715
                 WHEN PS-HIER-SCL-CDE                                   31341815
                     PERFORM 6400-STYLE-EXCLUSION                       31341915
                     IF PS-NO-EXCL-FOUND                                31342015
                       PERFORM 6500-SKU-EXCLUSION                       31342115
                     END-IF                                             31342215
                                                                        31342315
                 WHEN PS-HIER-STY-CDE                                   31342415
                     PERFORM 6500-SKU-EXCLUSION                         31342515
                                                                        31342615
                 WHEN PS-HIER-SKU-CDE                                   31342715
                     CONTINUE                                           31342815
             END-EVALUATE                                               31342915
           END-IF.                                                      31343015
                                                                        31344015
      ******************************************************************31345015
      * CHECK IF EXCLUSIONS EXIST OR NOT                                31346015
      ******************************************************************31347015
       6100-DO-EXCLUSIONS-EXIST.                                        31348015
                                                                        31349015
           EXEC SQL                                                     31350015
                SELECT 1                                                31360015
                  INTO :PV-EXCL-EXISTS                                  31370015
                  FROM XST_EXCL_MDSE E                                  31380015
                 WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  31390015
                   AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     31400015
                   AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    31410015
                   AND E.STAT_CDE           = 'S'                       31420015
                FETCH FIRST ROW ONLY                                    31430015
                WITH UR                                                 31440015
           END-EXEC.                                                    31450015
                                                                        31460015
           EVALUATE TRUE                                                31470015
               WHEN SQLCODE = +0                                        31480015
                   SET PS-EXCL-EXISTS    TO TRUE                        31490015
                                                                        31500015
               WHEN SQLCODE = +100                                      31510015
                   SET PS-NO-EXCL-EXISTS TO TRUE                        31520015
                                                                        31530015
               WHEN OTHER                                               31540015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  31550015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     31560015
                   DISPLAY 'INTFC SUB ID:    ' PV-PROMO-INTFC-SUB-ID    31570015
                   MOVE '6100-DO-EXCLUSIONS-EXIST      '                31580015
                                         TO PV-PARAGRAPH-NAME           31590015
                   PERFORM Z900-SQL-ABEND                               31600015
           END-EVALUATE.                                                31610015
                                                                        31620015
      ******************************************************************31630015
      * CHECK IF EXCLUSIONS AT MAJOR CLASS                              31640015
      ******************************************************************31650015
       6200-MAJOR-CLASS-EXCLUSION.                                      31660015
                                                                        31670015
           EXEC SQL                                                     31680015
                SELECT 1                                                31690015
                  INTO :PV-EXCL-EXISTS                                  31700015
                  FROM XST_EXCL_MDSE E                                  31710015
                 WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  31720015
                   AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     31730015
                   AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    31740015
                   AND E.STAT_CDE           = 'S'                       31750015
                   AND E.MAJ_CL_NBR         = :XST00013-MAJ-CL-NBR      31760015
                   AND E.MDSE_HIER_CDE      = 'MCL'                     31770015
                FETCH FIRST ROW ONLY                                    31780015
                  WITH UR                                               31790015
           END-EXEC.                                                    31800015
                                                                        31810015
           EVALUATE TRUE                                                31820015
               WHEN SQLCODE = +0                                        31830015
                   SET PS-EXCL-FOUND TO TRUE                            31840015
                                                                        31850015
               WHEN SQLCODE = +100                                      31860015
                   CONTINUE                                             31870015
                                                                        31880015
               WHEN OTHER                                               31890015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  31900015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     31910015
                   DISPLAY 'INTFC SUB ID:    ' PV-PROMO-INTFC-SUB-ID    31920015
                   DISPLAY 'MAJOR CL NBR:    ' XST00013-MAJ-CL-NBR      31930015
                   MOVE '6200-MAJOR-CLASS-EXCLUSION    '                31940015
                                     TO PV-PARAGRAPH-NAME               31950015
                   PERFORM Z900-SQL-ABEND                               31960015
           END-EVALUATE.                                                31970015
                                                                        31980015
      ******************************************************************31990015
      * CHECK IF EXCLUSIONS AT SUB CLASS                                32000015
      ******************************************************************32010015
       6300-SUB-CLASS-EXCLUSION.                                        32020015
                                                                        32030015
           EXEC SQL                                                     32040015
                SELECT 1                                                32050015
                  INTO :PV-EXCL-EXISTS                                  32060015
                  FROM XST_EXCL_MDSE E                                  32070015
                 WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  32080015
                   AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     32090015
                   AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    32100015
                   AND E.STAT_CDE           = 'S'                       32110015
                   AND E.MAJ_CL_NBR         = :XST00013-MAJ-CL-NBR      32120015
                   AND E.SUB_CL_NBR         = :XST00013-SUB-CL-NBR      32130015
                   AND E.MDSE_HIER_CDE      = 'SCL'                     32140015
                FETCH FIRST ROW ONLY                                    32150015
                  WITH UR                                               32160015
           END-EXEC.                                                    32170015
                                                                        32180015
           EVALUATE TRUE                                                32190015
               WHEN SQLCODE = +0                                        32200015
                   SET PS-EXCL-FOUND TO TRUE                            32210015
                                                                        32220015
               WHEN SQLCODE = +100                                      32230015
                   CONTINUE                                             32240015
                                                                        32250015
               WHEN OTHER                                               32260015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  32270015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     32280015
                   DISPLAY 'INTFC SUB ID:    ' PV-PROMO-INTFC-SUB-ID    32290015
                   DISPLAY 'MAJOR CL NBR:    ' XST00013-MAJ-CL-NBR      32300015
                   DISPLAY 'SUB CL NBR:      ' XST00013-SUB-CL-NBR      32310015
                   MOVE '6300-SUB-CLASS-EXCLUSION      '                32320015
                                     TO PV-PARAGRAPH-NAME               32330015
                   PERFORM Z900-SQL-ABEND                               32340015
           END-EVALUATE.                                                32350015
                                                                        32360015
      ******************************************************************32370015
      * CHECK IF EXCLUSIONS AT STYLE                                    32380015
      ******************************************************************32390015
       6400-STYLE-EXCLUSION.                                            32400015
                                                                        32410015
           EXEC SQL                                                     32420015
                SELECT 1                                                32430015
                  INTO :PV-EXCL-EXISTS                                  32440015
                  FROM XST_EXCL_MDSE E                                  32450015
                 WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  32460015
                   AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     32470015
                   AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    32480015
                   AND E.STAT_CDE           = 'S'                       32490015
                   AND E.MAJ_CL_NBR         = :XST00013-MAJ-CL-NBR      32500015
                   AND E.SUB_CL_NBR         = :XST00013-SUB-CL-NBR      32510015
                   AND E.STYL_ID            = :XST00010-STYL-ID         32520015
                   AND E.MDSE_HIER_CDE      = 'STY'                     32530015
                FETCH FIRST ROW ONLY                                    32531015
                  WITH UR                                               32532015
           END-EXEC.                                                    32533015
                                                                        32534015
           EVALUATE TRUE                                                32535015
               WHEN SQLCODE = +0                                        32536015
                   SET PS-EXCL-FOUND TO TRUE                            32537015
                                                                        32538015
               WHEN SQLCODE = +100                                      32539015
                   CONTINUE                                             32540015
                                                                        32550015
               WHEN OTHER                                               32560015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  32570015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     32580015
                   DISPLAY 'INTFC SUB ID:    ' PV-PROMO-INTFC-SUB-ID    32590015
                   DISPLAY 'MAJOR CL NBR:    ' XST00013-MAJ-CL-NBR      32600015
                   DISPLAY 'SUB CL NBR:      ' XST00013-SUB-CL-NBR      32610015
                   DISPLAY 'STYLE ID:        ' XST00010-STYL-ID         32620015
                   MOVE '6400-STYLE-EXCLUSION          '                32630015
                                     TO PV-PARAGRAPH-NAME               32640015
                   PERFORM Z900-SQL-ABEND                               32650015
           END-EVALUATE.                                                32660015
                                                                        32670015
      ******************************************************************32680015
      * CHECK IF EXCLUSIONS AT SKU                                      32690015
      ******************************************************************32700015
       6500-SKU-EXCLUSION.                                              32710015
                                                                        32720015
           EXEC SQL                                                     32730015
                SELECT 1                                                32740015
                  INTO :PV-EXCL-EXISTS                                  32750015
                  FROM XST_EXCL_MDSE E                                  32760015
                 WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  32770015
                   AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     32780015
                   AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    32790015
                   AND E.STAT_CDE           = 'S'                       32800015
                   AND E.SKU_NBR            = :GTTPRICD-SKU-NBR         32810015
                   AND E.MDSE_HIER_CDE      = 'SKU'                     32820015
                FETCH FIRST ROW ONLY                                    32830015
                  WITH UR                                               32831015
           END-EXEC.                                                    32832015
                                                                        32833015
           EVALUATE TRUE                                                32834015
               WHEN SQLCODE = +0                                        32835015
                   SET PS-EXCL-FOUND TO TRUE                            32836015
                                                                        32837015
               WHEN SQLCODE = +100                                      32838015
                   CONTINUE                                             32839015
                                                                        32840015
               WHEN OTHER                                               32850015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  32860015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     32870015
                   DISPLAY 'INTFC SUB ID:    ' PV-PROMO-INTFC-SUB-ID    32880015
                   DISPLAY 'SKU:             ' GTTPRICD-SKU-NBR         32890015
                   MOVE '6500-SKU-EXCLUSION            '                32900015
                                     TO PV-PARAGRAPH-NAME               32910015
                   PERFORM Z900-SQL-ABEND                               32920015
           END-EVALUATE.                                                32930015
                                                                        32940015
      ******************************************************************32950015
      * PROCESS SIMPLE PRICE                                            32960015
      ******************************************************************32970015
       7000-PROCESS-SIMPLE-PRICE.                                       32980015
                                                                        32990015
           PERFORM 7100-SELECT-SIMPLE-PRICE.                            33000015
                                                                        33010015
           IF PS-SIMPLE-PRICE-FOUND                                     33020015
               MOVE ZEROES                TO PV-PROMO-INTFC-SUB-ID      33030015
               PERFORM 6000-CHECK-FOR-EXCLUSIONS                        33040015
               IF PS-EXCL-FOUND                                         33050015
                   SET PS-FETCH-NEXT          TO TRUE                   33060015
               ELSE                                                     33070015
                   PERFORM 8300-POPULATE-DETAIL                         33080015
                   PERFORM 8400-WRITE-PD-DETAIL-RECORD                  33090015
               END-IF                                                   33100015
           END-IF.                                                      33110015
                                                                        33120015
      ******************************************************************33130015
      * SELECT SIMPLE PRICE                                             33140015
      ******************************************************************33141015
       7100-SELECT-SIMPLE-PRICE.                                        33142015
                                                                        33143015
           EXEC SQL                                                     33144015
                SELECT DISC_PRCG_AMT                                    33145015
                  INTO :XST00030-DISC-PRCG-AMT                          33146015
                  FROM XST_SMP_PRICG                                    33147015
                 WHERE PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID        33148015
                   AND MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID           33149015
                   AND STAT_CDE       = 'S'                             33150015
                  WITH UR                                               33160015
           END-EXEC.                                                    33170015
                                                                        33180015
           EVALUATE TRUE                                                33190015
               WHEN SQLCODE = +0                                        33200015
                   MOVE XST00030-DISC-PRCG-AMT TO PV-DISC-PRCG-AMT      33210015
                   SET PS-SIMPLE-PRICE-FOUND   TO TRUE                  33220015
                                                                        33230015
               WHEN SQLCODE = +100                                      33240015
                   DISPLAY 'SIMPLE PRICE NOT FOUND:  '                  33250015
                           'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  33260015
                           ', MDSE LNE ID:     ' XST00028-MDSE-LNE-ID   33270015
                   SET PS-SIMPLE-PRICE-NOT-FOUND TO TRUE                33280015
                                                                        33290015
               WHEN OTHER                                               33300015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  33310015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     33320015
                   MOVE '7100-SELECT-SIMPLE-PRICE      '                33320115
                                               TO PV-PARAGRAPH-NAME     33320215
                   PERFORM Z900-SQL-ABEND                               33320315
           END-EVALUATE.                                                33320415
                                                                        33320515
      ******************************************************************33320615
      * SELECT TIER PRICING                                             33320715
      ******************************************************************33320815
       7200-SELECT-TIER-PRICE.                                          33320915
                                                                        33321015
           SET PS-NOT-END-OF-TIER-CSR TO TRUE.                          33322015
           SET PS-FIRST-TIER-ROW      TO TRUE.                          33322115
                                                                        33322215
           EVALUATE XST00028-PRICG-TYP-CDE                              33322315
               WHEN 'TAP'                                               33322415
                   PERFORM 7210-SELECT-TAP-PRICE                        33322515
               WHEN 'TQP'                                               33322615
                   PERFORM 7220-SELECT-TQP-PRICE                        33322715
      *P2      WHEN 'TAA'                                               33322815
      *P2          PERFORM 7230-SELECT-TAA-PRICE                        33322915
      *P2      WHEN 'TQA'                                               33323015
      *P2          PERFORM 7240-SELECT-TQA-PRICE                        33324015
           END-EVALUATE.                                                33325015
                                                                        33326015
      ******************************************************************33327015
      * SELECT (TAP) TIER PRICING                                       33328015
      ******************************************************************33329015
       7210-SELECT-TAP-PRICE.                                           33330015
                                                                        33340015
           PERFORM 7211-OPN-TAP-PRICE-CSR.                              33350015
           PERFORM 7212-FET-TAP-PRICE-CSR.                              33360015
           PERFORM 7213-PROCESS-TAP-PRICE                               33370015
               UNTIL PS-END-OF-TIER-CSR                                 33380015
                  OR PS-FETCH-NEXT.                                     33390015
           PERFORM 7214-CLS-TAP-PRICE-CSR.                              33400015
           IF PS-NOT-FIRST-TIER-ROW                                     33410015
               PERFORM 8400-WRITE-PD-DETAIL-RECORD                      33420015
           END-IF.                                                      33430015
                                                                        33440015
      ******************************************************************33450015
      * OPEN (TAP) TIER PRICING                                         33460015
      ******************************************************************33470015
       7211-OPN-TAP-PRICE-CSR.                                          33480015
                                                                        33490015
           EXEC SQL                                                     33500015
                OPEN TAP-TIER-CSR                                       33510015
           END-EXEC.                                                    33520015
                                                                        33530015
           EVALUATE TRUE                                                33540015
               WHEN SQLCODE = ZERO                                      33550015
                   CONTINUE                                             33560015
                                                                        33570015
               WHEN OTHER                                               33580015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  33590015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     33600015
                   MOVE '7211-OPN-TAP-TIER-CSR  '                       33610015
                                    TO PV-PARAGRAPH-NAME                33620015
                   PERFORM Z900-SQL-ABEND                               33630015
           END-EVALUATE.                                                33631015
                                                                        33632015
      ******************************************************************33633015
      * FETCH (TAP) TIER PRICING                                        33634015
      ******************************************************************33635015
       7212-FET-TAP-PRICE-CSR.                                          33636015
                                                                        33637015
           EXEC SQL                                                     33638015
                FETCH TAP-TIER-CSR                                      33639015
                 INTO :XST00035-PROMO-INTFC-SUB-ID                      33640015
                    , :XST00035-THRS-AMT                                33650015
                    , :XST00035-DISC-PCT                                33660015
           END-EXEC.                                                    33670015
                                                                        33680015
           EVALUATE TRUE                                                33690015
               WHEN SQLCODE = +0                                        33700015
                   CONTINUE                                             33710015
                                                                        33720015
               WHEN SQLCODE = +100                                      33730015
                   SET PS-END-OF-TIER-CSR  TO TRUE                      33740015
                                                                        33750015
               WHEN OTHER                                               33760015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  33770015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     33780015
                   MOVE '7212-FET-TAP-PRICE-CSR   '                     33790015
                                           TO PV-PARAGRAPH-NAME         33800015
                   PERFORM Z900-SQL-ABEND                               33810015
           END-EVALUATE.                                                33820015
                                                                        33830015
      ******************************************************************33840015
      * PROCESS (TAP) TIER PRICING                                      33850015
      ******************************************************************33860015
       7213-PROCESS-TAP-PRICE.                                          33870015
                                                                        33880015
           PERFORM 7299-TIER-PROCESS.                                   33890015
                                                                        33900015
           IF PS-DONT-FETCH-NEXT                                        33910015
               PERFORM 7212-FET-TAP-PRICE-CSR                           33920015
           END-IF.                                                      33930015
                                                                        33940015
      ******************************************************************33950015
      * CLOSE (TAP) TIER PRICING                                        33960015
      ******************************************************************33970015
       7214-CLS-TAP-PRICE-CSR.                                          33980015
                                                                        33990015
           EXEC SQL                                                     34000015
                CLOSE TAP-TIER-CSR                                      34010015
           END-EXEC.                                                    34020015
                                                                        34030015
           EVALUATE TRUE                                                34040015
               WHEN SQLCODE = ZERO                                      34050015
                   CONTINUE                                             34060015
                                                                        34070015
               WHEN OTHER                                               34080015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  34090015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     34100015
                   MOVE '7214-CLS-TAP-TIER-CSR  '                       34110015
                                    TO PV-PARAGRAPH-NAME                34120015
                   PERFORM Z900-SQL-ABEND                               34130015
           END-EVALUATE.                                                34140015
                                                                        34150015
      ******************************************************************34160015
      * SELECT (TQP) TIER PRICING                                       34170015
      ******************************************************************34180015
       7220-SELECT-TQP-PRICE.                                           34190015
                                                                        34200015
           PERFORM 7221-OPN-TQP-PRICE-CSR.                              34201015
           PERFORM 7222-FET-TQP-PRICE-CSR.                              34202015
           PERFORM 7223-PROCESS-TQP-PRICE                               34203015
               UNTIL PS-END-OF-TIER-CSR                                 34204015
                  OR PS-FETCH-NEXT.                                     34205015
           PERFORM 7224-CLS-TQP-PRICE-CSR.                              34206015
           IF PS-NOT-FIRST-TIER-ROW                                     34207015
               PERFORM 8400-WRITE-PD-DETAIL-RECORD                      34208015
           END-IF.                                                      34208115
                                                                        34208215
      ******************************************************************34208315
      * OPEN (TQP) TIER PRICING                                         34208415
      ******************************************************************34208515
       7221-OPN-TQP-PRICE-CSR.                                          34208615
                                                                        34208715
           EXEC SQL                                                     34208815
                OPEN TQP-TIER-CSR                                       34208915
           END-EXEC.                                                    34209015
                                                                        34210015
           EVALUATE TRUE                                                34210115
               WHEN SQLCODE = ZERO                                      34210215
                   CONTINUE                                             34210315
                                                                        34210415
               WHEN OTHER                                               34210515
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  34210615
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     34210715
                   MOVE '7221-OPN-TQP-TIER-CSR  '                       34210815
                                    TO PV-PARAGRAPH-NAME                34210915
                   PERFORM Z900-SQL-ABEND                               34211015
           END-EVALUATE.                                                34211115
                                                                        34211215
      ******************************************************************34211315
      * FETCH (TQP) TIER PRICING                                        34211415
      ******************************************************************34211515
       7222-FET-TQP-PRICE-CSR.                                          34211615
                                                                        34211715
           EXEC SQL                                                     34211815
                FETCH TQP-TIER-CSR                                      34211915
                 INTO :XST00035-PROMO-INTFC-SUB-ID                      34212015
                    , :XST00035-THRS-QTY                                34212115
                    , :XST00035-DISC-PCT                                34212215
           END-EXEC.                                                    34212315
                                                                        34212415
           EVALUATE TRUE                                                34212515
               WHEN SQLCODE = +0                                        34212615
                   CONTINUE                                             34212715
                                                                        34212815
               WHEN SQLCODE = +100                                      34212915
                   SET PS-END-OF-TIER-CSR  TO TRUE                      34213015
                                                                        34213115
               WHEN OTHER                                               34213215
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  34213315
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     34213415
                   MOVE '7222-FET-TQP-PRICE-CSR   '                     34213515
                                           TO PV-PARAGRAPH-NAME         34213615
                   PERFORM Z900-SQL-ABEND                               34213715
           END-EVALUATE.                                                34213815
                                                                        34213915
      ******************************************************************34214015
      * PROCESS (TQP) TIER PRICING                                      34215015
      ******************************************************************34216015
       7223-PROCESS-TQP-PRICE.                                          34217015
                                                                        34218015
           PERFORM 7299-TIER-PROCESS.                                   34219015
                                                                        34220015
           IF PS-DONT-FETCH-NEXT                                        34221015
               PERFORM 7222-FET-TQP-PRICE-CSR                           34222015
           END-IF.                                                      34223015
                                                                        34224015
      ******************************************************************34225015
      * CLOSE (TQP) TIER PRICING                                        34226015
      ******************************************************************34227015
       7224-CLS-TQP-PRICE-CSR.                                          34228015
                                                                        34229015
           EXEC SQL                                                     34229115
                CLOSE TQP-TIER-CSR                                      34229215
           END-EXEC.                                                    34229315
                                                                        34229415
           EVALUATE TRUE                                                34229515
               WHEN SQLCODE = ZERO                                      34229615
                   CONTINUE                                             34229715
                                                                        34229815
               WHEN OTHER                                               34229915
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  34230015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     34230115
                   MOVE '7224-CLS-TQP-TIER-CSR  '                       34230215
                                    TO PV-PARAGRAPH-NAME                34230315
                   PERFORM Z900-SQL-ABEND                               34230415
           END-EVALUATE.                                                34230515
                                                                        34230615
      ******************************************************************34230715
      *                                                                 34230815
      ******************************************************************34230915
       7299-TIER-PROCESS.                                               34231015
                                                                        34232015
           IF PS-FIRST-TIER-ROW                                         34233015
               MOVE XST00035-PROMO-INTFC-SUB-ID                         34234015
                                              TO PV-PROMO-INTFC-SUB-ID  34235015
               PERFORM 6000-CHECK-FOR-EXCLUSIONS                        34235115
               IF PS-EXCL-FOUND                                         34235215
                   SET PS-FETCH-NEXT          TO TRUE                   34235315
               ELSE                                                     34235415
                   PERFORM 8300-POPULATE-DETAIL                         34235515
                   SET PS-NOT-FIRST-TIER-ROW TO TRUE                    34235615
                   SET XS042-TIER-INDEX TO 1                            34235715
               END-IF                                                   34235815
           ELSE                                                         34235915
               SET XS042-TIER-INDEX UP BY 1                             34236015
           END-IF.                                                      34237015
                                                                        34237115
           IF PS-DONT-FETCH-NEXT                                        34237215
               PERFORM 8210-POPULATE-DETAIL-TIER                        34237315
           END-IF.                                                      34237415
                                                                        34237515
      ******************************************************************34237615
      * SELECT GROUP PRICING                                            34237715
      ******************************************************************34237815
       7400-SELECT-GRP-PRICE.                                           34237915
                                                                        34238015
           PERFORM 7410-SELECT-PRICE.                                   34238115
           IF PS-GROUP-PRICE-FOUND                                      34238215
               MOVE ZEROES                    TO PV-PROMO-INTFC-SUB-ID  34238315
               PERFORM 6000-CHECK-FOR-EXCLUSIONS                        34238415
               IF PS-EXCL-FOUND                                         34238515
                   SET PS-FETCH-NEXT          TO TRUE                   34238615
               ELSE                                                     34238715
                   PERFORM 8300-POPULATE-DETAIL                         34238815
                   PERFORM 8400-WRITE-PD-DETAIL-RECORD                  34238915
               END-IF                                                   34239015
           END-IF.                                                      34239115
                                                                        34239215
      ******************************************************************34239315
      * SELECT GAO, GBL, GBD, & GBP PRICE                               34239415
      ******************************************************************34239515
       7410-SELECT-PRICE.                                               34239615
                                                                        34239715
           EXEC SQL                                                     34239815
                SELECT DISC_GP_QTY                                      34239915
                     , DISC_PRCG_AMT                                    34240015
                  INTO :XST00030-DISC-GP-QTY                            34250015
                     , :XST00030-DISC-PRCG-AMT                          34260015
                  FROM XST_SMP_PRICG                                    34270015
                 WHERE PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID        34280015
                   AND MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID           34290015
                   AND STAT_CDE       = 'S'                             34291015
                  WITH UR                                               34292015
           END-EXEC.                                                    34293015
                                                                        34294015
           EVALUATE TRUE                                                34295015
               WHEN SQLCODE = +0                                        34296015
                   MOVE XST00030-DISC-GP-QTY   TO PV-DISC-GP-QTY        34297015
                   MOVE XST00030-DISC-PRCG-AMT TO PV-DISC-PRCG-AMT      34298015
                   SET PS-GROUP-PRICE-FOUND    TO TRUE                  34299015
                                                                        34300015
               WHEN SQLCODE = +100                                      34301015
                   SET PS-GROUP-PRICE-NOT-FOUND TO TRUE                 34302015
                                                                        34303015
               WHEN OTHER                                               34304015
                   DISPLAY 'PROMO INTFC ID:  ' XST00028-PROMO-INTFC-ID  34305015
                   DISPLAY 'MDSE LNE ID:     ' XST00028-MDSE-LNE-ID     34306015
                   MOVE '7410-SELECT-PRICE             '                34307015
                                               TO PV-PARAGRAPH-NAME     34308015
                   PERFORM Z900-SQL-ABEND                               34309015
           END-EVALUATE.                                                34310015
                                                                        34320015
W36026******************************************************************34330015
W36026* GET THE CURRENT TIMESTAMP FROM DB2                              34340015
W36026******************************************************************34350015
W36026 7500-SET-CURRENT-TIMESTAMP.                                      34360015
W36026                                                                  34370015
W36026     EXEC SQL                                                     34380015
W36026          SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           34390015
W36026     END-EXEC.                                                    34400015
W36026                                                                  34410015
W36026     EVALUATE TRUE                                                34420015
W36026         WHEN SQLCODE = ZERO                                      34430015
W36026             CONTINUE                                             34440015
W36026         WHEN OTHER                                               34450015
W36026             MOVE '7500-SET-CURRENT-TIMESTAMP    '                34451015
W36026                              TO PV-PARAGRAPH-NAME                34452015
W36026             MOVE 'ERROR ON SET OF TIMESTAMP '                    34453015
W36026                              TO PV-OPERATION-MSG-1               34454015
W36026             PERFORM Z900-SQL-ABEND                               34455015
W36026     END-EVALUATE.                                                34456015
                                                                        34457015
      ******************************************************************34458015
      * SELECT GIFT W/ PURCHASE PRICE                                   34459015
      ******************************************************************34460015
      *7400-SELECT-GIFT-W-PURCHASE.                                     34460115
      *P2                                                               34460215
      *P2  EVALUATE XST00028-PRICG-TYP-CDE                              34460315
      *P2      WHEN 'GBQ'                                               34460415
      *P2          PERFORM 7410-SELECT-GBQ-PRICE                        34460515
      *P2      WHEN 'GBA'                                               34460615
      *P2          PERFORM 7420-SELECT-GBA-PRICE                        34460715
      *P2      WHEN 'PBQ'                                               34460815
      *P2          PERFORM 7430-SELECT-PBQ-PRICE                        34460915
      *P2      WHEN 'PBA'                                               34461015
      *P2          PERFORM 7440-SELECT-PBA-PRICE                        34462015
      *P2      WHEN 'GWP'                                               34463015
      *P2          PERFORM 7450-SELECT-GWP-PRICE                        34464015
      *P2      WHEN 'PGO'                                               34465015
      *P2          PERFORM 7460-SELECT-PGO-PRICE                        34466015
      *P2      WHEN 'PGA'                                               34467015
      *P2          PERFORM 7470-SELECT-PGA-PRICE                        34468015
      *P2      WHEN 'PGP'                                               34469015
      *P2          PERFORM 7480-SELECT-PGP-PRICE                        34470015
      *P2  END-EVALUATE.                                                34480015
      *P2                                                               34490015
      ******************************************************************34500015
      * MOVE VALUES TO PRICE DETERMINATION BATCH TEMP FILE              34510015
      ******************************************************************34520015
       8000-POPULATE-TEMP-FILE.                                         34530015
                                                                        34540015
           MOVE XST00010-SKU-NBR          TO GTTPRICD-SKU-NBR.          34550015
           MOVE XST00010-STYL-ID          TO GTTPRICD-STYL-ID.          34560015
           MOVE XST00008-INTR-UPC-ID      TO GTTPRICD-INTR-UPC-ID.      34570015
           MOVE HV-UNT-RTL-AMT            TO GTTPRICD-UNT-RTL-AMT.      34580015
           MOVE HV-GP-RTL-QTY             TO GTTPRICD-GP-RTL-QTY.       34590015
           MOVE HV-GP-RTL-AMT             TO GTTPRICD-GP-RTL-AMT.       34600015
           MOVE HV-LOC-SKU-STAT-CDE       TO GTTPRICD-LOC-SKU-STAT-CDE. 34610015
           MOVE PV-UPC                    TO GTTPRICD-UPC-NBR.          34620015
           MOVE HV-UNT-RTL-CHG-DTE        TO GTTPRICD-UNT-RTL-CHG-DTE.  34630015
           MOVE HV-UPC-STAT-CHG-DTE       TO GTTPRICD-UPC-STAT-CHG-DTE. 34640015
                                                                        34650015
      ******************************************************************34660015
      * WRITES VALUES TO TEMP FILE                                      34670015
      ******************************************************************34680015
       8010-INSERT-TEMP-FILE.                                           34690015
                                                                        34700015
           EXEC SQL                                                     34710015
                INSERT INTO SESSION.GTT_PRIC_DTRMN                      34720015
                   (  SKU_NBR                                           34730015
                    , STYL_ID                                           34740015
                    , INTR_UPC_ID                                       34750015
                    , UNT_RTL_AMT                                       34760015
                    , GP_RTL_QTY                                        34770015
                    , GP_RTL_AMT                                        34780015
                    , LOC_SKU_STAT_CDE                                  34790015
                    , UPC_NBR                                           34800015
                    , UNT_RTL_CHG_DTE                                   34810015
                    , UPC_STAT_CHG_DTE)                                 34820015
                VALUES                                                  34830015
                   (  :GTTPRICD-SKU-NBR                                 34840015
                    , :GTTPRICD-STYL-ID                                 34850015
                    , :GTTPRICD-INTR-UPC-ID                             34860015
                    , :GTTPRICD-UNT-RTL-AMT                             34870015
                    , :GTTPRICD-GP-RTL-QTY                              34880015
                    , :GTTPRICD-GP-RTL-AMT                              34890015
                    , :GTTPRICD-LOC-SKU-STAT-CDE                        34900015
                    , :GTTPRICD-UPC-NBR                                 34910015
                    , :GTTPRICD-UNT-RTL-CHG-DTE                         34920015
                    , :GTTPRICD-UPC-STAT-CHG-DTE)                       34930015
           END-EXEC.                                                    34940015
                                                                        34950015
           EVALUATE TRUE                                                34960015
                                                                        34970015
               WHEN SQLCODE = +0                                        34980015
                   ADD +1 TO PA-TEMP-ROWS-INSERTED                      34990015
                                                                        35000015
               WHEN OTHER                                               35010015
                   DISPLAY 'SKU NBR:      ' GTTPRICD-SKU-NBR            35020015
                   DISPLAY 'INTR UPC ID:  ' GTTPRICD-INTR-UPC-ID        35030015
                   DISPLAY 'UPC NBR:      ' GTTPRICD-UPC-NBR            35040015
                   MOVE '8010-INSERT-TEMP-FILE'                         35050015
                                    TO PV-PARAGRAPH-NAME                35060015
                   MOVE 'INSERT ERROR ON TSIPRSM     '                  35070015
                                    TO PV-OPERATION-MSG-1               35080015
                   PERFORM Z900-SQL-ABEND                               35090015
           END-EVALUATE.                                                35100015
                                                                        35110015
      ******************************************************************35120015
      * MOVE VALUES TO PRICE DETERMINATION BATCH HEADER                 35130015
      ******************************************************************35140015
       8100-POPULATE-HEADER.                                            35150015
                                                                        35160015
           MOVE '0'                      TO XS043-RECORD-TYPE.          35170015
           MOVE XS050-STORE              TO XS043-STORE.                35180015
           MOVE XS050-DATE               TO XS043-DATE.                 35190015
           MOVE XS050-TIME               TO XS043-TIME.                 35200015
           MOVE XS050-PROMO-ID           TO XS043-PROMO-ID.             35210015
           MOVE GTTPRICD-INTR-UPC-ID     TO XS043-INTR-UPC-ID.          35220015
           MOVE GTTPRICD-SKU-NBR         TO XS043-SKU.                  35230015
           MOVE GTTPRICD-UPC-NBR         TO XS043-UPC-CDE.              35240015
                                                                        35250015
           MOVE XS050-INCL-UNAD-SW       TO XS043-INCL-UNAD-SW.         35260015
           MOVE XS050-INCL-PART-DAY-SW   TO XS043-INCL-PART-DAY-SW.     35270015
           MOVE XS050-INCL-GOLD-STR-SW   TO XS043-INCL-GOLD-STR-SW.     35280015
           MOVE XS050-INCL-LWST-SIX-WK-SW                               35290015
                                         TO XS043-INCL-LWST-SIX-WK-SW.  35300015
           MOVE XS050-INCL-GP-PRC-SW     TO XS043-INCL-GP-PRC-SW.       35310015
           MOVE XS050-INCL-BWP-PROMO-SW  TO XS043-INCL-BWP-PROMO-SW.    35320015
           MOVE XS050-INCL-TIERED-PROMO-SW                              35330015
                                         TO XS043-INCL-TIERED-PROMO-SW. 35340015
           MOVE XS050-INCL-ADD-PCT-AMT-SW                               35350015
                                         TO XS043-INCL-ADDL-PCT-AMT-SW. 35360015
           MOVE XS050-CALLING-APPLICATION-ID                            35370015
                                         TO XS043-CALLING-APPL-IDENT.   35380015
                                                                        35390015
           MOVE GTTPRICD-UNT-RTL-AMT     TO XS043-RGLR-PRICE.           35400015
           MOVE GTTPRICD-GP-RTL-QTY      TO XS043-REG-GP-QTY.           35401015
           MOVE GTTPRICD-GP-RTL-AMT      TO XS043-REG-GP-DLR.           35402015
                                                                        35403015
      ******************************************************************35404015
      *  WRITE HEADER RECORD.                                           35405015
      ******************************************************************35406015
       8200-WRITE-PD-HEADER-RECORD.                                     35407015
                                                                        35408015
           WRITE PD-OUTPUT-HEADER-REC FROM XS043-PD-HEADER-RECORD.      35409015
                                                                        35410015
           ADD +1 TO PA-HEADER-RECS-WRITTEN.                            35420015
                                                                        35430015
      ******************************************************************35440015
      * MOVE VALUES TO PRICE DETERMINATION BATCH DETAIL                 35450015
      ******************************************************************35460015
       8300-POPULATE-DETAIL.                                            35470015
                                                                        35480015
           MOVE '1'                     TO XS042-RECORD-TYPE.           35490015
           MOVE GTTPRICD-INTR-UPC-ID    TO XS042-INTR-UPC-ID.           35500015
           MOVE XS050-STORE             TO XS042-STORE.                 35510015
           MOVE XS050-DATE              TO XS042-DATE.                  35520015
           MOVE XS050-TIME              TO XS042-TIME.                  35530015
           MOVE XS050-PROMO-ID          TO XS042-PROMO-ID.              35540015
                                                                        35550015
           MOVE XST00028-PROMO-ID       TO XS042-ELIG-PROMO-ID.         35560015
           MOVE XST00028-PROMO-INTFC-ID TO XS042-ELIG-PROMO-INTFC-ID.   35570015
           MOVE XST00028-MDSE-LNE-ID    TO XS042-ELIG-MDSE-LNE-ID.      35580015
                                                                        35590015
      * NOTE:  WHEN BENEFIT WITH PURCHASE IS ADDED, REMEMBER TO         35600015
      *        POPULATE BWP-PROMO-INTFC-SUB-ID WHEN APPROPRIATE.        35610015
           MOVE ZEROES                  TO XS042-BWP-PROMO-INTFC-SUB-ID.35620015
                                                                        35630015
           MOVE PV-PROMO-STRT-TMST      TO XS042-PROMO-STRT-DTE.        35640015
           MOVE PV-PROMO-END-TMST       TO XS042-PROMO-END-DTE.         35650015
           MOVE XST00028-PRICG-TYP-CDE  TO XS042-PRICG-TYP-CDE.         35660015
                                                                        35670015
           MOVE PS-MDSE-HIER-CDE        TO XS042-MRCH-HEIR-CDE.         35680015
           MOVE PV-DISC-GP-QTY          TO XS042-DISC-GP-QTY.           35690015
           MOVE PV-DISC-PRCG-AMT        TO XS042-DISC-GP-AMT.           35700015
                                                                        35710015
           PERFORM 8210-INITIALIZE-TIER                                 35720015
               VARYING XS042-TIER-INDEX                                 35730015
               FROM 1 BY 1                                              35731015
               UNTIL XS042-TIER-INDEX > 10.                             35732015
                                                                        35733015
      ******************************************************************35734015
      * INITIALIZE THE TIERED ARRAY.                                    35735015
      ******************************************************************35736015
       8210-INITIALIZE-TIER.                                            35736115
                                                                        35736215
           MOVE ZEROES               TO XS042-BUY-QTY(XS042-TIER-INDEX).35736315
           MOVE ZEROES               TO XS042-BUY-DLR(XS042-TIER-INDEX).35736415
           MOVE ZEROES               TO XS042-GET-PCT(XS042-TIER-INDEX).35736515
           MOVE ZEROES               TO XS042-GET-DLR(XS042-TIER-INDEX).35736615
           MOVE ZEROES               TO                                 35736715
                                   XS042-INTFC-SUB-ID(XS042-TIER-INDEX).35736815
                                                                        35736915
      ******************************************************************35737015
      * POPULATE TIERED ARRAY.                                          35738015
      ******************************************************************35739015
       8210-POPULATE-DETAIL-TIER.                                       35739115
                                                                        35739215
           MOVE XST00035-PROMO-INTFC-SUB-ID                             35739315
                                     TO                                 35739415
                                   XS042-INTFC-SUB-ID(XS042-TIER-INDEX).35739515
                                                                        35739615
           EVALUATE XST00028-PRICG-TYP-CDE                              35739715
               WHEN 'TAP'                                               35739815
                   MOVE ZEROES                                          35739915
                                     TO XS042-BUY-QTY(XS042-TIER-INDEX) 35740015
                   MOVE XST00035-THRS-AMT                               35740115
                                     TO XS042-BUY-DLR(XS042-TIER-INDEX) 35740215
                   MOVE XST00035-DISC-PCT                               35740315
                                     TO XS042-GET-PCT(XS042-TIER-INDEX) 35740415
                   MOVE ZEROES                                          35740515
                                     TO XS042-GET-DLR(XS042-TIER-INDEX) 35740615
               WHEN 'TQP'                                               35740715
                   MOVE XST00035-THRS-QTY                               35740815
                                     TO XS042-BUY-QTY(XS042-TIER-INDEX) 35740915
                   MOVE ZEROES                                          35741015
                                     TO XS042-BUY-DLR(XS042-TIER-INDEX) 35742015
                   MOVE XST00035-DISC-PCT                               35742115
                                     TO XS042-GET-PCT(XS042-TIER-INDEX) 35742215
                   MOVE ZEROES                                          35742315
                                     TO XS042-GET-DLR(XS042-TIER-INDEX) 35742415
      *P2      WHEN 'TAA'                                               35742515
      *P2          MOVE ZEROES                                          35742615
      *P2                            TO XS042-BUY-QTY(XS042-TIER-INDEX) 35742715
      *P2          MOVE XST00035-THRS-AMT                               35742815
      *P2                            TO XS042-BUY-DLR(XS042-TIER-INDEX) 35742915
      *P2          MOVE ZEROES                                          35743015
      *P2                            TO XS042-GET-PCT(XS042-TIER-INDEX) 35744015
      *P2          MOVE XST00035-DISC-AMT                               35745015
      *P2                            TO XS042-GET-DLR(XS042-TIER-INDEX) 35746015
      *P2      WHEN 'TQA'                                               35747015
      *P2          MOVE XST00035-THRS-QTY                               35748015
      *P2                            TO XS042-BUY-QTY(XS042-TIER-INDEX) 35749015
      *P2          MOVE ZEROES                                          35749115
      *P2                            TO XS042-BUY-DLR(XS042-TIER-INDEX) 35749215
      *P2          MOVE ZEROES                                          35749315
      *P2                            TO XS042-GET-PCT(XS042-TIER-INDEX) 35749415
      *P2          MOVE XST00035-DISC-AMT                               35749515
      *P2                            TO XS042-GET-DLR(XS042-TIER-INDEX) 35749615
           END-EVALUATE.                                                35749715
                                                                        35749815
      ******************************************************************35749915
      *  WRITE DETAIL RECORD.                                           35750015
      ******************************************************************35750115
       8400-WRITE-PD-DETAIL-RECORD.                                     35750215
                                                                        35750315
           WRITE PD-OUTPUT-DETAIL-REC FROM XS042-PD-DETAIL-RECORD.      35750415
                                                                        35750515
           ADD +1 TO PA-DETAIL-RECS-WRITTEN.                            35750615
           MOVE ZEROES              TO PV-DISC-GP-QTY                   35750715
                                       PV-DISC-PRCG-AMT.                35750815
                                                                        35750915
                                                                        35751015
      ******************************************************************35751115
       Z800-ABEND.                                                      35751215
      ******************************************************************35751315
                                                                        35751415
           DISPLAY 'Z800-ABEND'.                                        35751515
           DISPLAY '**  ABEND     **'.                                  35751615
           DISPLAY '**  PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME.      35751715
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            35751815
           DISPLAY '**  OPERATION **  = ' PV-OPERATION-MSG-1.           35751915
                                                                        35752015
           CALL 'ILBOABN0' USING ABEND-CODE.                            35752115
                                                                        35752215
      ******************************************************************35752315
       Z900-SQL-ABEND.                                                  35752415
      ******************************************************************35752515
                                                                        35752615
           DISPLAY 'Z900-SQL-ABEND'.                                    35752715
           DISPLAY '**  ABEND     **'.                                  35752815
           DISPLAY '**  PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME.      35752915
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            35753015
           DISPLAY '**  OPERATION **  = ' PV-OPERATION-MSG-1.           35753115
           DISPLAY '**            **  = ' PV-OPERATION-MSG-2.           35753215
                                                                        35753315
      ******************************************************************35753415
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    35753515
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         35753615
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     35753715
      * FORMAT.                                                         35753815
      ******************************************************************35753915
           COPY DPPD004.                                                35754015
                                                                        35755015
           SET ABEND-4013-DB2-ERROR TO TRUE.                            35756015
           CALL 'ILBOABN0' USING ABEND-CODE.                            35757015
                                                                        35758015
