000100                                                                  00010065
000200*-----------------------*                                         00020065
000300 IDENTIFICATION DIVISION.                                         00030065
000400*-----------------------*                                         00040065
000500                                                                  00050065
000600 PROGRAM-ID.     APKUT214.                                        00060065
000700                                                                  00070065
000800 AUTHOR.         WILLIAM EHMKE  KOHL'S.                           00080078
000900                                                                  00090065
001000 DATE-WRITTEN.   MARCH 1999.                                      00100065
001100                                                                  00110065
001200 DATE-COMPILED.                                                   00120065
001300                                                                  00130065
001400*---------------------------------------------------------------* 00140065
001500*    IMPORT PO AGING CALCULATION PROGRAM                        * 00150065
001600*                                                               * 00160065
001700*    COBOL 2 WITH SQL                                           * 00170065
001800*                                                               * 00180065
001900* THIS PROGRAM WILL READ THE IMPORT COST VARIANCE FILE AND      * 00190065
002000* DETERMINE THE NUMBER OF PURCHASE ORDERS THAT FALL INTO EACH   * 00200065
002100* AGING CATEGORY FOR EACH VENDOR.  THE PO'S WILL BE CLASSIFIED  * 00210065
002200* INTO AGING BUCKETS BASED OFF OF TWO DIFFERENT DATE CRITERIA:  * 00220065
002300* THE 'LAST VERIFIED RECEIPT DATE' AND THE 'CURRENT OPEN TO BUY * 00230065
002400* PERIOD'.  THE FILE CREATED FROM THIS PROGRAM WILL BE USED TO  * 00240065
002500* PRODUCE A REPORT.                                             * 00250065
002600*                                                               * 00260065
002700*---------------------------------------------------------------* 00270000
002800*                                                               * 00280065
002900* INPUT:                                                        * 00290065
003000*                                                               * 00300065
003100*  1. IMPORT PO COST VARIANCE FILE         (APRD036)            * 00310065
003200*     VENDOR SEQUENCE HEADER RECORDS ONLY                       * 00320065
003300*                                                               * 00330065
003400*  2. AP-PAYMENT CONTROL TABLE             (TAPCNTL)            * 00340065
003500*                                                               * 00350065
003600* OUTPUT:                                                       * 00360065
003700*                                                               * 00370065
003800*  1. IMPORT PO AGING FILE                 (APRD037)            * 00380065
003900*                                                               * 00390065
004000*---------------------------------------------------------------* 00400065
004100*                                                               * 00410065
004200* CHANGE LOG:                                                   * 00420065
004300*                                                               * 00430065
004400* 06/12/00   INITIAL VERSION.                       WR 20876 #2 * 00440065
004500*                                                               * 00450065
004600* 02/05/01 -                                                    * 00460066
004700*            CORRECT OTB PERIOD CALCULATIONS.                   * 00470066
004800*        BY: L SCHALLHORN                           WR 20704    * 00480066
004900*                                                               * 00490065
005000* 08/08/2002 COLBY HANGER EXPENSE PROCESSING.  RECOMPILE FROM   * 00500077
005100*            PRODUCTION TO INCORPORATE COPYBOOK CHANGES.        * 00510074
005200*        BY: KEVIN CATLIN                   WR#: 23254          * 00520076
005300*                                                               * 00530078
005400* 01/24/2005 CHANGED 'COLBY' TO 'LI & FUNG' IN THE DISPLAYS IN  * 00540078
005500*            B300-END-OF-PROGRAM.  LI & FUNG IS THE PARENT      * 00550078
005600*            COMPANY OF COLBY.  CHANGED ALL VARIABLE 'COLBY'    * 00560079
005700*            REFRENCES TO 'LIFUNG'.                             * 00570079
005800*        BY: MIKE BESKE                     WR#: 28114          * 00580078
005810*                                                               * 00581082
005820* 03/16/2009                                                    * 00582084
005830*        CHANGE MADE: RECOMPILE FOR ADDITION OF DMA-NBR TO      * 00583083
005831*        APRD036.                                               * 00583183
005840*        MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR31546      * 00584082
005900*---------------------------------------------------------------* 00590065
006000                                                                  00600065
006100     EJECT                                                        00610065
006200                                                                  00620065
006300 ENVIRONMENT DIVISION.                                            00630065
006400                                                                  00640065
006500 CONFIGURATION SECTION.                                           00650065
006600                                                                  00660065
006700 SOURCE-COMPUTER.    IBM-3090.                                    00670065
006800 OBJECT-COMPUTER.    IBM-3090.                                    00680065
006900                                                                  00690065
007000 INPUT-OUTPUT SECTION.                                            00700065
007100                                                                  00710065
007200 FILE-CONTROL.                                                    00720065
007300                                                                  00730065
007400     SELECT PO-COST-VARIANCE-FILE ASSIGN TO UT-S-INP01.           00740065
007500                                                                  00750065
007600     SELECT PO-AGING-FILE         ASSIGN TO UT-S-OUT01.           00760065
007700                                                                  00770065
007800     EJECT                                                        00780065
007900                                                                  00790065
008000 DATA DIVISION.                                                   00800065
008100                                                                  00810065
008200 FILE SECTION.                                                    00820065
008300                                                                  00830065
008400 FD  PO-COST-VARIANCE-FILE                                        00840065
008500     RECORDING MODE IS F                                          00850065
008600     LABEL RECORDS ARE STANDARD                                   00860065
008700     RECORD CONTAINS 170 CHARACTERS                               00870065
008800     DATA RECORD IS PO-COST-VARIANCE-RECORD.                      00880065
008900                                                                  00890000
009000 01  PO-COST-VARIANCE-RECORD     PIC  X(170).                     00900065
009100                                                                  00910065
009200                                                                  00920065
009300 FD  PO-AGING-FILE                                                00930065
009400     RECORDING MODE IS F                                          00940065
009500     LABEL RECORDS ARE STANDARD                                   00950065
009600     RECORD CONTAINS 100 CHARACTERS                               00960065
009700     DATA RECORD IS PO-AGING-RECORD.                              00970065
009800                                                                  00980065
009900 01  PO-AGING-RECORD             PIC  X(100).                     00990065
010000                                                                  01000065
010100                                                                  01010065
010200     EJECT                                                        01020065
010300                                                                  01030065
010400 WORKING-STORAGE SECTION.                                         01040065
010500                                                                  01050065
010600 01  PROGRAM-CONSTANTS.                                           01060065
010700     05  PC-PROGRAM-NAME         PIC  X(08)     VALUE 'APKUT214'. 01070065
010800                                                                  01080065
010900 01  PV-PROCESS-COUNTERS.                                         01090065
011000                                                                  01100065
011100     05  PV-READ-CNT             PIC  9(08)     VALUE ZEROES.     01110065
011200     05  PV-READ-LIFUNG-CNT      PIC  9(08)     VALUE ZEROES.     01120079
011300     05  PV-READ-NON-LIFUNG-CNT  PIC  9(08)     VALUE ZEROES.     01130079
011400                                                                  01140065
011500     05  PV-RECORDS-WRITTEN-BASIS                                 01150065
011600                                 PIC  9(08)     VALUE ZEROES.     01160065
011700     05  PV-RECORDS-WRITTEN-LIFUNG                                01170079
011800                                 PIC  9(08)     VALUE ZEROES.     01180065
011900     05  PV-RECORDS-WRITTEN-NON-LIFUNG                            01190079
012000                                 PIC  9(08)     VALUE ZEROES.     01200065
012100     05  PV-RECORDS-WRITTEN-ALL                                   01210065
012200                                 PIC  9(08)     VALUE ZEROES.     01220065
012300     05  PV-RETRY-COUNTER        PIC S9(4) COMP VALUE ZERO.       01230065
012400     05  PV-AP036-LAST-VERFYD-DTE-ERR                             01240065
012500                                 PIC  9(07)     VALUE ZEROES.     01250065
012600     05  PV-AP036-OTB-PER-NBR-ERR                                 01260065
012700                                 PIC  9(07)     VALUE ZEROES.     01270065
012800     05  PV-AP036-LAST-DTE-ERR-TOTAL                              01280065
012900                                 PIC  9(07)     VALUE ZEROES.     01290000
013000     05  PV-AP036-OTB-PER-NBR-ERR-TOTAL                           01300065
013100                                 PIC  9(07)     VALUE ZEROES.     01310000
013200                                                                  01320065
013300 01  PROGRAM-SWITCHES.                                            01330065
013400                                                                  01340065
013500     05  PS-PO-VARIANCE-EOF-SWT  PIC  X         VALUE ' '.        01350065
013600         88  PS-PO-VARIANCE-EOF-YES             VALUE 'Y'.        01360065
013700         88  PS-PO-VARIANCE-EOF-NO              VALUE 'N'.        01370065
013800                                                                  01380065
013900     EJECT                                                        01390065
014000                                                                  01400065
014100 01  PROGRAM-VARIABLES.                                           01410065
014200                                                                  01420065
014300     05  PV-CURRENT-DATE.                                         01430065
014400         10  PV-CURRENT-CENTURY  PIC  9(02)     VALUE ZEROS.      01440065
014500         10  PV-CURRENT-YEAR     PIC  9(02)     VALUE ZEROS.      01450065
014600         10  PV-CURRENT-MONTH    PIC  9(02)     VALUE ZEROS.      01460065
014700         10  PV-CURRENT-DAY      PIC  9(02)     VALUE ZEROS.      01470065
014800                                                                  01480065
014900     05  PV-CURRENT-TIME.                                         01490065
015000                                                                  01500065
015100         10  PV-CURRENT-HOUR     PIC  9(02)     VALUE ZEROES.     01510065
015200         10  PV-CURRENT-MINUTE   PIC  9(02)     VALUE ZEROES.     01520065
015300         10  PV-CURRENT-SECOND   PIC  9(02)     VALUE ZEROES.     01530065
015400                                                                  01540065
015500     05  PV-HOLD-VND-NAME        PIC  X(30)     VALUE SPACES.     01550065
015600     05  PV-HOLD-VND-NBR         PIC  X(09)     VALUE SPACES.     01560065
015700                                                                  01570065
015800     05  PV-OTB-YR-PD.                                            01580065
015900         10  PV-OTB-YR-NUMERIC   PIC S9(04)     VALUE  0.         01590070
016000         10  PV-OTB-PD-NUMERIC   PIC S9(02)     VALUE  0.         01600070
016100                                                                  01610065
016200     05  PV-HOLD-OTB-YR-PD.                                       01620065
016300         10  PV-HOLD-OTB-YR-NUMERIC                               01630065
016400                                 PIC S9(04)     VALUE  0.         01640070
016500         10  PV-HOLD-OTB-PD-NUMERIC                               01650065
016600                                 PIC S9(02)     VALUE  0.         01660070
016700     05  PV-OTB.                                                  01670071
016800         10  PV-OTB-YY           PIC 9(04)      VALUE  ZEROES.    01680071
016900         10  PV-OTB-PP           PIC 9(02)      VALUE  ZEROES.    01690073
017000                                                                  01700065
017100     EJECT                                                        01710000
017200                                                                  01720000
017300 01  PV-OTB-VERFYD-BUCKETS.                                       01730065
017400                                                                  01740000
017500     05  PV-VERFYD-BASIS-DATE    PIC  X(10)     VALUE SPACES.     01750065
017600     05  PV-VERFYD-BASIS-MINUS15 PIC  X(10)     VALUE SPACES.     01760065
017700     05  PV-VERFYD-BASIS-MINUS30 PIC  X(10)     VALUE SPACES.     01770065
017800     05  PV-VERFYD-BASIS-MINUS60 PIC  X(10)     VALUE SPACES.     01780065
017900     05  PV-VERFYD-BASIS-MINUS90 PIC  X(10)     VALUE SPACES.     01790065
018000     05  PV-VERFYD-BASIS-MINUS120                                 01800065
018100                                 PIC  X(10)     VALUE SPACES.     01810065
018200                                                                  01820065
018300     05  PV-OTB-PERIOD-BASIS     PIC  X(06)     VALUE SPACES.     01830065
018400     05  PV-OTB-PERIOD-MINUS1    PIC  X(06)     VALUE SPACES.     01840065
018500     05  PV-OTB-PERIOD-MINUS2    PIC  X(06)     VALUE SPACES.     01850065
018600     05  PV-OTB-PERIOD-MINUS3    PIC  X(06)     VALUE SPACES.     01860065
018700     05  PV-OTB-PERIOD-MINUS4    PIC  X(06)     VALUE SPACES.     01870065
018800                                                                  01880065
018900     05  PV-OTB-YEAR-NUMERIC     PIC   9(04)    VALUE ZEROES.     01890065
019000     05  PV-OTB-PERIOD-NUMERIC   PIC   9(02)    VALUE ZEROES.     01900065
019100                                                                  01910065
019200     EJECT                                                        01920065
019300                                                                  01930065
019400*----------------------------------------------------------------*01940065
019500*  INPUT RECORD LAYOUT                                            01950065
019600*----------------------------------------------------------------*01960065
019700                                                                  01970065
019800     COPY APRD036.                                                01980065
019900                                                                  01990065
020000     EJECT                                                        02000065
020100                                                                  02010065
020200*----------------------------------------------------------------*02020065
020300*  OUTPUT RECORD LAYOUT                                           02030065
020400*----------------------------------------------------------------*02040065
020500                                                                  02050065
020600     COPY APRD037.                                                02060065
020700                                                                  02070065
020800     EJECT                                                        02080065
020900                                                                  02090065
021000*----------------------------------------------------------------*02100065
021100* WORKING STORAGE FOR DATE ROUTINE                                02110065
021200*----------------------------------------------------------------*02120065
021300                                                                  02130065
021400     COPY DPWS500.                                                02140065
021500                                                                  02150065
021600     EJECT                                                        02160065
021700                                                                  02170065
021800                                                                  02180065
021900*----------------------------------------------------------------*02190065
022000*    SQL COMMUNICATIONS AREA DCLGEN                               02200065
022100*----------------------------------------------------------------*02210065
022200                                                                  02220065
022300     EXEC SQL                                                     02230065
022400         INCLUDE SQLCA                                            02240065
022500     END-EXEC.                                                    02250065
022600                                                                  02260065
022700     EJECT                                                        02270065
022800                                                                  02280065
022900*----------------------------------------------------------------*02290065
023000*    AP PAYMENT CONTROL TABLE                                     02300065
023100*----------------------------------------------------------------*02310065
023200                                                                  02320065
023300     EXEC SQL                                                     02330065
023400         INCLUDE TAPCNTL                                          02340065
023500     END-EXEC.                                                    02350065
023600                                                                  02360065
023700     EJECT                                                        02370065
023800                                                                  02380065
023900*----------------------------------------------------------------*02390065
024000*  ABEND DATA AREAS                                               02400065
024100*----------------------------------------------------------------*02410065
024200                                                                  02420065
024300 01  ABEND-CODE                  PIC S9(4)      VALUE ZEROES      02430065
024400                                 COMP           SYNC.             02440065
024500                                                                  02450065
024600     88  AC-ANY-ERROR                           VALUE +4001       02460065
024700                                                THRU  +4019.      02470065
024800                                                                  02480065
024900     88  AC-INVALID-KEY-WRITE                   VALUE +4001.      02490065
025000     88  AC-INVALID-KEY-READ                    VALUE +4002.      02500065
025100     88  AC-INVALID-CONTROL-CARD                VALUE +4003.      02510065
025200     88  AC-TABLE-OVERFLOW                      VALUE +4004.      02520065
025300     88  AC-OPEN-FILE-ERROR                     VALUE +4005.      02530065
025400     88  AC-CLOSE-FILE-ERROR                    VALUE +4006.      02540065
025500     88  AC-SEQUENCE-ERROR                      VALUE +4007.      02550065
025600     88  AC-INVALID-DATA                        VALUE +4008.      02560065
025700     88  AC-INVALID-KEYPUNCH                    VALUE +4009.      02570065
025800     88  AC-INTERNAL-SORT-ERROR                 VALUE +4012.      02580065
025900     88  AC-DB2-ERROR                           VALUE +4013.      02590065
026000     88  AC-DATE-ERROR                          VALUE +4019.      02600065
026100                                                                  02610065
026200                                                                  02620065
026300                                                                  02630065
026400 01  ABEND-AREAS.                                                 02640065
026500     05  AA-ABEND-LIT            PIC  X(40)     VALUE             02650065
026600             '*****       ABEND'.                                 02660065
026700     05  AA-PROGRAM-LIT          PIC  X(40)     VALUE             02670065
026800             '*****   PROGRAM: APKUT214'.                         02680065
026900     05  AA-PARAGRAPH-LIT.                                        02690065
027000         10  FILLER              PIC  X(17)     VALUE             02700065
027100             '***** PARAGRAPH: '.                                 02710065
027200         10  AA-PARAGRAPH-NAME   PIC  X(35)     VALUE SPACES.     02720065
027300     05  AA-MESSAGE-LINE-1.                                       02730065
027400         10  FILLER              PIC  X(06)     VALUE '*****'.    02740065
027500         10  AA-MESSAGE-1        PIC  X(80)     VALUE SPACES.     02750065
027600     05  AA-MESSAGE-LINE-2.                                       02760065
027700         10  FILLER              PIC  X(06)     VALUE '*****'.    02770065
027800         10  AA-MESSAGE-2        PIC  X(80)     VALUE SPACES.     02780065
027900     05  AA-DB2-ERROR-LIT        PIC  X(40)     VALUE             02790065
028000             '*****    DB2 ERROR'.                                02800065
028100     05  AA-DB2-OPERATION-LIT.                                    02810065
028200         10  FILLER              PIC  X(17)     VALUE             02820065
028300             '***** OPERATION: '.                                 02830065
028400         10  AA-DB2-OPERATION.                                    02840065
028500             15  AA-DB2-OP-1     PIC  X(25)     VALUE SPACES.     02850065
028600             15  AA-DB2-OP-2     PIC  X(25)     VALUE SPACES.     02860065
028700     05  AA-DB2-TABLE-1          PIC  X(08)     VALUE SPACES.     02870065
028800     05  AA-DB2-TABLE-2          PIC  X(08)     VALUE SPACES.     02880065
028900     05  AA-DB2-TABLE-3          PIC  X(08)     VALUE SPACES.     02890065
029000                                                                  02900065
029100     EJECT                                                        02910065
029200                                                                  02920065
029300*----------------------------------------------------------------*02930065
029400*  SQLCA FORMATTED MESSAGE AREA                                   02940065
029500*----------------------------------------------------------------*02950065
029600                                                                  02960065
029700     COPY DPWS004.                                                02970065
029800                                                                  02980065
029900 01  FILLER                      PIC  X(25)     VALUE             02990065
030000     '** END OF APKUT214 W/S **'.                                 03000065
030100                                                                  03010065
030200     EJECT                                                        03020065
030300                                                                  03030065
030400 PROCEDURE DIVISION.                                              03040065
030500                                                                  03050065
030600 A100-MAIN.                                                       03060065
030700                                                                  03070065
030800     PERFORM B100-INITIALIZE.                                     03080065
030900                                                                  03090065
031000     PERFORM B200-PROCESS-PO-VARIANCE-FILE                        03100065
031100         UNTIL PS-PO-VARIANCE-EOF-YES.                            03110065
031200                                                                  03120065
031300     PERFORM D100-VENDOR-BREAK.                                   03130065
031400                                                                  03140065
031500     PERFORM B300-END-OF-PROGRAM.                                 03150065
031600                                                                  03160065
031700     GOBACK.                                                      03170065
031800                                                                  03180065
031900     EJECT                                                        03190065
032000                                                                  03200065
032100 B100-INITIALIZE.                                                 03210065
032200                                                                  03220065
032300*----------------------------------------------------------------*03230065
032400*    INITIALIZATION PROCESSING                                   *03240065
032500*                                                                *03250065
032600*    - INTIALIZE LAYOUTS.                                        *03260065
032700*    - OPEN FILES.                                               *03270065
032800*    - FORMAT AND WRITE HEADING CONTROL CARD TYPE 1.             *03280065
032900*    - INITIAL READ INPUT FILE.                                   03290065
033000*----------------------------------------------------------------*03300065
033100                                                                  03310065
033200     DISPLAY '**  APKUT214  ( START RUN     )  **'.               03320065
033300                                                                  03330065
033400     OPEN INPUT  PO-COST-VARIANCE-FILE                            03340065
033500          OUTPUT PO-AGING-FILE.                                   03350065
033600                                                                  03360065
033700     INITIALIZE AP036-IMPORT-REPORT-RECORD                        03370065
033800                AP037-IMPORT-AGE-FILE                             03380065
033900                PV-OTB-VERFYD-BUCKETS.                            03390065
034000                                                                  03400065
034100*    READ THE AP CONTROL TABLE AND GET THE BATCH PROCESSING DATE  03410065
034200                                                                  03420065
034300     PERFORM F100-FORMAT-PROCESS-DATES.                           03430065
034400                                                                  03440065
034500     PERFORM F200-FORMAT-OTB-PERIOD-BASIS.                        03450065
034600                                                                  03460065
034700     PERFORM F300-GEN-OTB-PERIOD-BASIS.                           03470065
034800                                                                  03480065
034900     SET AP037-BASIS-INFO-RECORD TO TRUE.                         03490065
035000                                                                  03500065
035100     MOVE PV-VERFYD-BASIS-DATE TO AP037-VERFYD-REC-BASIS.         03510065
035200                                                                  03520065
035300     MOVE PV-OTB-PERIOD-BASIS  TO AP037-OTB-PERIOD-BASIS.         03530065
035400                                                                  03540065
035500     MOVE PV-OTB-PERIOD-MINUS1 TO AP037-OTB-MINUS1-PERIOD.        03550065
035600     MOVE PV-OTB-PERIOD-MINUS2 TO AP037-OTB-MINUS2-PERIOD.        03560065
035700     MOVE PV-OTB-PERIOD-MINUS3 TO AP037-OTB-MINUS3-PERIOD.        03570065
035800     MOVE PV-OTB-PERIOD-MINUS4 TO AP037-OTB-MINUS4-PERIOD.        03580065
035900                                                                  03590065
036000     WRITE PO-AGING-RECORD FROM AP037-IMPORT-AGE-FILE.            03600065
036100                                                                  03610065
036200     INITIALIZE AP037-IMPORT-AGE-FILE                             03620065
036300                AP037-AGING-RECORD.                               03630065
036400                                                                  03640065
036500     ADD 1 TO PV-RECORDS-WRITTEN-BASIS.                           03650065
036600                                                                  03660065
036700*    PERFORM INITILIAL READ OF THE INPUT FILE.                    03670065
036800                                                                  03680065
036900     SET PS-PO-VARIANCE-EOF-NO  TO TRUE.                          03690065
037000                                                                  03700065
037100     PERFORM R100-READ-INPUT.                                     03710065
037200                                                                  03720065
037300     IF PS-PO-VARIANCE-EOF-YES                                    03730065
037400         DISPLAY '******************************************'     03740065
037500         DISPLAY ' NO RECORDS TO PROCESS. EMPTY INPUT DATASET'    03750065
037600         DISPLAY '******************************************'     03760065
037700     ELSE                                                         03770065
037800         MOVE AP036-VENDOR-NAME      TO PV-HOLD-VND-NAME          03780065
037900         MOVE AP036-VENDOR-NBR       TO PV-HOLD-VND-NBR           03790065
038000     END-IF.                                                      03800065
038100                                                                  03810065
038200     EJECT                                                        03820065
038300                                                                  03830065
038400*----------------------------------------------------------------*03840065
038500*    PROCESS THE PO-COST-VARIANCE FILR.                           03850065
038600*                                                                *03860065
038700*    - CHECK FOR CONTROL BREAKS.                                 *03870065
038800*    - PROCESS AND ACCUMULATE DETAIL DATA.                       *03880065
038900*    - READ THE PO COST VARIANCE FILE.                            03890065
039000*----------------------------------------------------------------*03900065
039100                                                                  03910065
039200 B200-PROCESS-PO-VARIANCE-FILE.                                   03920065
039300                                                                  03930065
039400     IF AP036-VENDOR-NBR NOT = PV-HOLD-VND-NBR                    03940065
039500         PERFORM D100-VENDOR-BREAK                                03950065
039600     END-IF.                                                      03960065
039700                                                                  03970065
039800*    PROCESS THE DETAIL RECORD                                    03980065
039900                                                                  03990065
040000     ADD 1 TO AP037-TOTAL-PO-COUNT.                               04000065
040100                                                                  04010065
040200*    EVALUATE FOR VERIFIED DATE                                   04020065
040300                                                                  04030065
040400     EVALUATE TRUE                                                04040065
040500                                                                  04050065
040600         WHEN AP036-LAST-VERFYD-DTE < PV-VERFYD-BASIS-MINUS120    04060065
040700             ADD  +1 TO AP037-OVER-120-QTY                        04070065
040800                                                                  04080065
040900         WHEN AP036-LAST-VERFYD-DTE < PV-VERFYD-BASIS-MINUS90     04090065
041000             ADD  +1 TO AP037-UNDER-120-QTY                       04100065
041100                                                                  04110065
041200         WHEN AP036-LAST-VERFYD-DTE < PV-VERFYD-BASIS-MINUS60     04120065
041300             ADD  +1 TO AP037-UNDER-90-QTY                        04130065
041400                                                                  04140065
041500         WHEN AP036-LAST-VERFYD-DTE < PV-VERFYD-BASIS-MINUS30     04150065
041600             ADD  +1 TO AP037-UNDER-60-QTY                        04160065
041700                                                                  04170065
041800         WHEN AP036-LAST-VERFYD-DTE <= PV-VERFYD-BASIS-MINUS15    04180065
041900             ADD  +1 TO AP037-UNDER-30-QTY                        04190065
042000                                                                  04200065
042100         WHEN AP036-LAST-VERFYD-DTE >  PV-VERFYD-BASIS-MINUS15    04210065
042200             ADD  +1 TO AP037-UNDER-15-QTY                        04220065
042300                                                                  04230065
042400         WHEN OTHER                                               04240065
042500             ADD  +1 TO PV-AP036-LAST-VERFYD-DTE-ERR              04250065
042600                                                                  04260065
042700     END-EVALUATE.                                                04270065
042800                                                                  04280065
042900*    EVALUATE FOR OTB VALUES                                      04290065
043000                                                                  04300065
043100     EVALUATE TRUE                                                04310065
043200                                                                  04320065
043300         WHEN AP036-OTB-PER-NBR <= PV-OTB-PERIOD-MINUS4           04330065
043400             ADD +1 TO AP037-OTB-OVER3-QTY                        04340065
043500                                                                  04350065
043600         WHEN AP036-OTB-PER-NBR <= PV-OTB-PERIOD-MINUS3           04360065
043700             ADD +1 TO AP037-OTB-3MONTH-QTY                       04370065
043800                                                                  04380065
043900         WHEN AP036-OTB-PER-NBR <= PV-OTB-PERIOD-MINUS2           04390065
044000             ADD +1 TO AP037-OTB-2MONTH-QTY                       04400065
044100                                                                  04410065
044200         WHEN AP036-OTB-PER-NBR <= PV-OTB-PERIOD-MINUS1           04420065
044300             ADD +1 TO AP037-OTB-1MONTH-QTY                       04430065
044400                                                                  04440065
044500         WHEN AP036-OTB-PER-NBR = PV-OTB-PERIOD-BASIS             04450065
044600             ADD +1 TO AP037-OTB-CURRENT-QTY                      04460065
044700                                                                  04470065
044800         WHEN AP036-OTB-PER-NBR > PV-OTB-PERIOD-BASIS             04480065
044900             ADD +1 TO AP037-OTB-FUTURE-QTY                       04490065
045000                                                                  04500065
045100         WHEN OTHER                                               04510065
045200             ADD  +1 TO PV-AP036-OTB-PER-NBR-ERR                  04520065
045300                                                                  04530065
045400     END-EVALUATE.                                                04540065
045500                                                                  04550065
045600                                                                  04560065
045700*    READ THE PO-COST-VARIANCE-FILE                               04570065
045800                                                                  04580065
045900     PERFORM R100-READ-INPUT.                                     04590065
046000                                                                  04600065
046100                                                                  04610065
046200     EJECT                                                        04620065
046300                                                                  04630065
046400                                                                  04640065
046500 B300-END-OF-PROGRAM.                                             04650065
046600                                                                  04660065
046700*----------------------------------------------------------------*04670065
046800*    END OF PROGRAM                                              *04680065
046900*                                                                *04690065
047000*    - DISPLAY END OF PROGRAM MESSAGES                           *04700065
047100*    - CLOSE THE FILES.                                          *04710065
047200*----------------------------------------------------------------*04720065
047300                                                                  04730065
047400*    WRITE REPORT-REC FROM END-OF-REPORT AFTER 2.                 04740065
047500                                                                  04750065
047600     COMPUTE PV-RECORDS-WRITTEN-ALL =                             04760065
047700             PV-RECORDS-WRITTEN-BASIS      +                      04770065
047800             PV-RECORDS-WRITTEN-LIFUNG     +                      04780079
047900             PV-RECORDS-WRITTEN-NON-LIFUNG                        04790079
048000     END-COMPUTE.                                                 04800065
048100                                                                  04810065
048200     DISPLAY '**************************************** ' .        04820065
048300     DISPLAY '** END OF APKUT214 RUN        **'.                  04830065
048400     DISPLAY '** TOTAL RECORDS READ             = ' PV-READ-CNT.  04840078
048500     DISPLAY '** TOTAL LI & FUNG RECORDS READ   = '               04850078
048600                                   PV-READ-LIFUNG-CNT.            04860079
048700     DISPLAY '** TOT NON-LI & FUNG RECORDS READ = '               04870078
048800                                   PV-READ-NON-LIFUNG-CNT.        04880079
048900     DISPLAY '** BASIS RECORDS WRITTEN          = '               04890078
049000                                   PV-RECORDS-WRITTEN-BASIS.      04900065
049100     DISPLAY '** LI & FUNG RECORDS WRITTEN      = '               04910078
049200                                   PV-RECORDS-WRITTEN-LIFUNG.     04920079
049300     DISPLAY '** NONE LI & FUNG RECORDS WRITTEN = '               04930078
049400                                   PV-RECORDS-WRITTEN-NON-LIFUNG. 04940079
049500     DISPLAY '** TOTAL RECORDS WRITTEN          = '               04950078
049600                                   PV-RECORDS-WRITTEN-ALL.        04960078
049700     DISPLAY '* AP036-LAST-DTE-ERR-TOTAL        = '               04970078
049800                                   PV-AP036-LAST-DTE-ERR-TOTAL.   04980078
049900     DISPLAY '* PV-AP036-OTB-PER-NBR-ERR-TOTAL  = '               04990078
050000                                 PV-AP036-OTB-PER-NBR-ERR-TOTAL.  05000078
050100     DISPLAY '**************************************** ' .        05010078
050200                                                                  05020078
050300     CLOSE PO-COST-VARIANCE-FILE                                  05030078
050400           PO-AGING-FILE.                                         05040078
050500                                                                  05050078
050600     EJECT                                                        05060078
050700                                                                  05070078
050800                                                                  05080078
050900*----------------------------------------------------------------*05090078
051000*    WRITE THE OUT PUT DETAIL RECORD APRD037 ON CHANGE OF VENDOR *05100078
051100*          ONE RECORD PER VENDOR                                 *05110078
051200*----------------------------------------------------------------*05120078
051300                                                                  05130078
051400 D100-VENDOR-BREAK.                                               05140078
051500                                                                  05150078
051600     MOVE PV-HOLD-VND-NAME       TO AP037-VENDOR-NAME.            05160078
051700     MOVE PV-HOLD-VND-NBR        TO AP037-VENDOR-NBR.             05170078
051800                                                                  05180078
051900     IF PV-HOLD-VND-NBR = '009206194'                             05190078
052000         SET AP037-LIFUNG-AGING-RECORD TO TRUE                    05200079
052100         ADD 1 TO PV-RECORDS-WRITTEN-LIFUNG                       05210079
052200     ELSE                                                         05220078
052300         SET AP037-AGING-INFO-RECORD  TO TRUE                     05230078
052400         ADD 1 TO PV-RECORDS-WRITTEN-NON-LIFUNG                   05240079
052500     END-IF.                                                      05250078
052600                                                                  05260078
052700     WRITE PO-AGING-RECORD FROM AP037-IMPORT-AGE-FILE.            05270078
052800                                                                  05280078
052900     MOVE AP036-VENDOR-NAME TO PV-HOLD-VND-NAME.                  05290078
053000                                                                  05300078
053100     MOVE AP036-VENDOR-NBR  TO PV-HOLD-VND-NBR.                   05310078
053200                                                                  05320078
053300     ADD PV-AP036-LAST-VERFYD-DTE-ERR TO                          05330078
053400                            PV-AP036-LAST-DTE-ERR-TOTAL.          05340078
053500                                                                  05350078
053600     ADD PV-AP036-OTB-PER-NBR-ERR TO                              05360078
053700                            PV-AP036-OTB-PER-NBR-ERR-TOTAL.       05370078
053800                                                                  05380078
053900     INITIALIZE AP037-IMPORT-AGE-FILE                             05390078
054000                AP037-AGING-RECORD                                05400078
054100                PV-AP036-LAST-VERFYD-DTE-ERR                      05410078
054200                PV-AP036-OTB-PER-NBR-ERR.                         05420078
054300                                                                  05430078
054400     EJECT                                                        05440078
054500                                                                  05450078
054600                                                                  05460078
054700*----------------------------------------------------------------*05470078
054800* -  PROCESS THE AP CONTROL DATA BASE FOR THE  BATCH PROCESS DATE*05480078
054900* -  DECREMENT THE CNTL PROCESS DATE BY 15, 30, 60, 90 & 120     *05490078
055000*----------------------------------------------------------------*05500078
055100                                                                  05510078
055200 F100-FORMAT-PROCESS-DATES.                                       05520078
055300                                                                  05530078
055400*    GET AP BATCH PROCESS DATE.                                   05540078
055500                                                                  05550078
055600     PERFORM S100-GET-BATCH-PROCESS-DATE.                         05560078
055700                                                                  05570078
055800     DISPLAY '***********************************'.               05580078
055900     DISPLAY 'APCNTL-BTCH-PRC-DTE = ' APCNTL-BTCH-PRC-DTE.        05590078
056000     DISPLAY '***********************************'.               05600078
056100                                                                  05610078
056200                                                                  05620078
056300     MOVE APCNTL-BTCH-PRC-DTE    TO PV-VERFYD-BASIS-DATE.         05630078
056400                                                                  05640078
056500*    GET BATCH DATE DECR. 15 DAYS.                                05650078
056600                                                                  05660078
056700     INITIALIZE DPG51                                             05670078
056800                DPG52                                             05680078
056900                DPG53                                             05690078
057000                DPG54                                             05700078
057100                DPG55                                             05710078
057200                DPG56.                                            05720078
057300                                                                  05730078
057400     SET DPG52-LK-DTE-ISO-FMT                                     05740078
057500         DPG51-ACTUAL-CALENDAR-ONLY                               05750078
057600         DPG51-DECREMENT-DATE    TO TRUE.                         05760078
057700     MOVE 15                     TO DPG51-INCR-DECR-DAYS-9.       05770078
057800                                                                  05780078
057900     MOVE PV-VERFYD-BASIS-DATE   TO DPG52-LK-DATE-INPUT.          05790078
058000                                                                  05800078
058100     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          05810078
058200                                                                  05820078
058300     DISPLAY '***********************************'.               05830078
058400     DISPLAY '*  15 DAY DECREMENT               *'.               05840078
058500     DISPLAY '*'.                                                 05850078
058600     DISPLAY 'DPG55-DB2-ISO-DATE-FMT = ' DPG55-DB2-ISO-DATE-FMT.  05860078
058700     DISPLAY '***********************************'.               05870078
058800                                                                  05880078
058900     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-VERFYD-BASIS-MINUS15.      05890078
059000                                                                  05900078
059100*    GET BATCH DATE DECR. 30 DAYS.                                05910078
059200                                                                  05920078
059300     INITIALIZE DPG51                                             05930078
059400                DPG52                                             05940078
059500                DPG53                                             05950078
059600                DPG54                                             05960078
059700                DPG55                                             05970078
059800                DPG56.                                            05980078
059900                                                                  05990078
060000     SET DPG52-LK-DTE-ISO-FMT                                     06000078
060100         DPG51-ACTUAL-CALENDAR-ONLY                               06010078
060200         DPG51-DECREMENT-DATE    TO TRUE.                         06020078
060300                                                                  06030078
060400     MOVE PV-VERFYD-BASIS-DATE   TO DPG52-LK-DATE-INPUT.          06040078
060500     MOVE 30                     TO DPG51-INCR-DECR-DAYS-9.       06050078
060600                                                                  06060078
060700     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          06070078
060800                                                                  06080078
060900     DISPLAY '***********************************'.               06090078
061000     DISPLAY '*  30 DAY DECREMENT               *'.               06100078
061100     DISPLAY '*'.                                                 06110078
061200     DISPLAY 'DPG55-DB2-ISO-DATE-FMT = ' DPG55-DB2-ISO-DATE-FMT.  06120078
061300     DISPLAY '***********************************'.               06130078
061400                                                                  06140078
061500     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-VERFYD-BASIS-MINUS30.      06150078
061600                                                                  06160078
061700*    GET BATCH DATE DECR. 60 DAYS.                                06170078
061800                                                                  06180078
061900     INITIALIZE DPG51                                             06190078
062000                DPG52                                             06200078
062100                DPG53                                             06210078
062200                DPG54                                             06220078
062300                DPG55                                             06230078
062400                DPG56.                                            06240078
062500                                                                  06250078
062600     SET DPG52-LK-DTE-ISO-FMT                                     06260078
062700         DPG51-ACTUAL-CALENDAR-ONLY                               06270078
062800         DPG51-DECREMENT-DATE    TO TRUE.                         06280078
062900                                                                  06290078
063000     MOVE PV-VERFYD-BASIS-DATE   TO DPG52-LK-DATE-INPUT.          06300078
063100     MOVE 60                     TO DPG51-INCR-DECR-DAYS-9        06310078
063200                                                                  06320078
063300     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          06330078
063400                                                                  06340078
063500     DISPLAY '***********************************'.               06350078
063600     DISPLAY '*  60 DAY DECREMENT               *'.               06360078
063700     DISPLAY '*'.                                                 06370078
063800     DISPLAY 'DPG55-DB2-ISO-DATE-FMT = ' DPG55-DB2-ISO-DATE-FMT.  06380078
063900     DISPLAY '***********************************'.               06390078
064000                                                                  06400078
064100     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-VERFYD-BASIS-MINUS60.      06410078
064200                                                                  06420078
064300*    GET BATCH DATE DECR. 90 DAYS.                                06430078
064400                                                                  06440078
064500     INITIALIZE DPG51                                             06450078
064600                DPG52                                             06460078
064700                DPG53                                             06470078
064800                DPG54                                             06480078
064900                DPG55                                             06490078
065000                DPG56.                                            06500078
065100                                                                  06510078
065200     SET DPG52-LK-DTE-ISO-FMT                                     06520078
065300         DPG51-ACTUAL-CALENDAR-ONLY                               06530078
065400         DPG51-DECREMENT-DATE    TO TRUE.                         06540078
065500                                                                  06550078
065600     MOVE PV-VERFYD-BASIS-DATE   TO DPG52-LK-DATE-INPUT.          06560078
065700     MOVE  90                    TO DPG51-INCR-DECR-DAYS-9        06570078
065800                                                                  06580078
065900     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          06590078
066000                                                                  06600078
066100     DISPLAY '***********************************'.               06610078
066200     DISPLAY '*  90 DAY DECRIMENT               *'.               06620078
066300     DISPLAY '*'.                                                 06630078
066400     DISPLAY 'DPG55-DB2-ISO-DATE-FMT = ' DPG55-DB2-ISO-DATE-FMT.  06640078
066500     DISPLAY '***********************************'.               06650078
066600                                                                  06660078
066700     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-VERFYD-BASIS-MINUS90.      06670078
066800                                                                  06680078
066900                                                                  06690078
067000*    GET BATCH DATE DECR. 120 DAYS.                               06700078
067100                                                                  06710078
067200     INITIALIZE DPG51                                             06720078
067300                DPG52                                             06730078
067400                DPG53                                             06740078
067500                DPG54                                             06750078
067600                DPG55                                             06760078
067700                DPG56.                                            06770078
067800                                                                  06780078
067900     SET DPG52-LK-DTE-ISO-FMT                                     06790078
068000         DPG51-ACTUAL-CALENDAR-ONLY                               06800078
068100         DPG51-DECREMENT-DATE    TO TRUE.                         06810078
068200                                                                  06820078
068300     MOVE PV-VERFYD-BASIS-DATE   TO DPG52-LK-DATE-INPUT.          06830078
068400     MOVE  120                   TO DPG51-INCR-DECR-DAYS-9        06840078
068500                                                                  06850078
068600     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          06860078
068700                                                                  06870078
068800     DISPLAY '***********************************'.               06880078
068900     DISPLAY '* 120 DAY DECRIMENT               *'.               06890078
069000     DISPLAY '*'.                                                 06900078
069100     DISPLAY 'DPG55-DB2-ISO-DATE-FMT = ' DPG55-DB2-ISO-DATE-FMT.  06910078
069200     DISPLAY '***********************************'.               06920078
069300                                                                  06930078
069400     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-VERFYD-BASIS-MINUS120.     06940078
069500                                                                  06950078
069600                                                                  06960078
069700     EJECT                                                        06970078
069800                                                                  06980078
069900                                                                  06990078
070000*----------------------------------------------------------------*07000078
070100* -  PROCESS, ADJUST THE BATCH PROCESS DATE AND CALCULATE THE     07010078
070200*    PREVIOUS OTB PERIODS BY DATE FOR   15, 30, 60, 90 & 120     *07020078
070300*----------------------------------------------------------------*07030078
070400                                                                  07040078
070500 F200-FORMAT-OTB-PERIOD-BASIS.                                    07050078
070600                                                                  07060078
070700* PROCESS THE BATCH CNTL DATE FOR YEAR AND FISICAL PERIOD         07070078
070800                                                                  07080078
070900     INITIALIZE DPG51                                             07090078
071000                DPG52                                             07100078
071100                DPG53                                             07110078
071200                DPG54                                             07120078
071300                DPG55                                             07130078
071400                DPG56.                                            07140078
071500                                                                  07150078
071600     SET DPG52-LK-DTE-ISO-FMT                                     07160078
071700         DPG51-FISCAL-454-CALENDAR                                07170078
071800         DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                    07180078
071900                                                                  07190078
072000     MOVE APCNTL-BTCH-PRC-DTE    TO DPG52-LK-DATE-INPUT.          07200078
072100                                                                  07210078
072200     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          07220078
072300                                                                  07230078
072400     MOVE DPG56-FISCAL-PERIOD-NBR TO PV-OTB-PERIOD-NUMERIC.       07240078
072500     MOVE DPG56-FISCAL-YEAR-CCYY  TO PV-OTB-YEAR-NUMERIC.         07250078
072600                                                                  07260078
072700     DISPLAY '****************************************'.          07270078
072800     DISPLAY '* APCNTL-BTCH-PRC-DTE  FISACL          *'.          07280078
072900     DISPLAY '*        YEAR AND PERIOD               *'.          07290078
073000     DISPLAY '* PV-OTB-YEAR-NUMERIC = ' PV-OTB-YEAR-NUMERIC.      07300078
073100     DISPLAY '* PV-OTB-PERIOD-NUMERIC ' PV-OTB-PERIOD-NUMERIC.    07310078
073200     DISPLAY '****************************************'.          07320078
073300                                                                  07330078
073400     EJECT                                                        07340078
073500                                                                  07350078
073600                                                                  07360078
073700*----------------------------------------------------------------*07370078
073800* -  PROCESS, PROCESS THE CURRENT ADJUSTED PERIOD FOR THE CURRENT 07380078
073900*    AND PREVIOUS 30, 60, 90 & 120 PERIODS                        07390078
074000*----------------------------------------------------------------*07400078
074100                                                                  07410078
074200 F300-GEN-OTB-PERIOD-BASIS.                                       07420078
074300                                                                  07430078
074400* ADJUST THE BASE PERIOD FROM FISICAL TO CALENDAR                 07440078
074500* ONCE ADJUSTED THIS BECOMES THE DATE FOR FUTURE SUBTRACTION.     07450078
074600* ALL 4 ARE SUBTRACTED FROM THIS DATE                             07460078
074700                                                                  07470078
074800     ADD +1 TO PV-OTB-PERIOD-NUMERIC GIVING                       07480078
074900                PV-OTB-PD-NUMERIC.                                07490078
075000                                                                  07500078
075100     IF PV-OTB-PD-NUMERIC = 13                                    07510078
075200         MOVE +01 TO PV-OTB-PD-NUMERIC                            07520078
075300                   PV-OTB-PP                                      07530078
075400         ADD +1 TO PV-OTB-YEAR-NUMERIC  GIVING                    07540078
075500                   PV-OTB-YR-NUMERIC                              07550078
075600         MOVE PV-OTB-YR-NUMERIC TO PV-OTB-YY                      07560078
075700     ELSE                                                         07570078
075800         MOVE PV-OTB-PD-NUMERIC TO PV-OTB-PP                      07580078
075900         MOVE PV-OTB-YEAR-NUMERIC TO PV-OTB-YY                    07590078
076000                                     PV-OTB-YR-NUMERIC            07600078
076100     END-IF.                                                      07610078
076200                                                                  07620078
076300     MOVE PV-OTB-PD-NUMERIC TO PV-HOLD-OTB-PD-NUMERIC.            07630078
076400     MOVE PV-OTB-YR-NUMERIC TO PV-HOLD-OTB-YR-NUMERIC.            07640078
076500     MOVE PV-OTB       TO PV-OTB-PERIOD-BASIS.                    07650078
076600     DISPLAY 'OTB PERIOD BASIS: ' PV-OTB-PERIOD-BASIS.            07660078
076700                                                                  07670078
076800                                                                  07680078
076900*    OTB PERIOD MINUS-1                                           07690078
077000                                                                  07700078
077100                                                                  07710078
077200     SUBTRACT +1 FROM PV-HOLD-OTB-PD-NUMERIC GIVING               07720078
077300                PV-OTB-PD-NUMERIC.                                07730078
077400                                                                  07740078
077500     IF PV-OTB-PD-NUMERIC <= ZERO                                 07750078
077600         ADD +12 TO PV-OTB-PD-NUMERIC                             07760078
077700         MOVE PV-OTB-PD-NUMERIC TO PV-OTB-PP                      07770078
077800         SUBTRACT +1 FROM PV-HOLD-OTB-YR-NUMERIC GIVING           07780078
077900                          PV-OTB-YR-NUMERIC                       07790078
078000         MOVE PV-OTB-YR-NUMERIC TO PV-OTB-YY                      07800078
078100     ELSE                                                         07810078
078200         MOVE PV-OTB-PD-NUMERIC      TO PV-OTB-PP                 07820078
078300         MOVE PV-HOLD-OTB-YR-NUMERIC TO PV-OTB-YY                 07830078
078400     END-IF.                                                      07840078
078500                                                                  07850078
078600     MOVE PV-OTB       TO PV-OTB-PERIOD-MINUS1.                   07860078
078700     DISPLAY 'OTB PERIOD MINUS1: ' PV-OTB-PERIOD-MINUS1.          07870078
078800                                                                  07880078
078900*    OTB PERIOD MINUS-2                                           07890078
079000                                                                  07900078
079100     SUBTRACT +2 FROM PV-HOLD-OTB-PD-NUMERIC GIVING               07910078
079200                PV-OTB-PD-NUMERIC.                                07920078
079300                                                                  07930078
079400     IF PV-OTB-PD-NUMERIC <= ZERO                                 07940078
079500         ADD +12 TO PV-OTB-PD-NUMERIC                             07950078
079600         MOVE PV-OTB-PD-NUMERIC TO PV-OTB-PP                      07960078
079700         SUBTRACT +1 FROM PV-HOLD-OTB-YR-NUMERIC GIVING           07970078
079800                          PV-OTB-YR-NUMERIC                       07980078
079900         MOVE PV-OTB-YR-NUMERIC TO PV-OTB-YY                      07990078
080000     ELSE                                                         08000078
080100         MOVE PV-OTB-PD-NUMERIC      TO PV-OTB-PP                 08010078
080200         MOVE PV-HOLD-OTB-YR-NUMERIC TO PV-OTB-YY                 08020078
080300     END-IF.                                                      08030078
080400                                                                  08040078
080500     MOVE PV-OTB       TO PV-OTB-PERIOD-MINUS2.                   08050078
080600     DISPLAY 'OTB PERIOD MINUS2: ' PV-OTB-PERIOD-MINUS2.          08060078
080700                                                                  08070078
080800*    OTB PERIOD MINUS-3                                           08080078
080900                                                                  08090078
081000     SUBTRACT +3 FROM PV-HOLD-OTB-PD-NUMERIC GIVING               08100078
081100                PV-OTB-PD-NUMERIC.                                08110078
081200                                                                  08120078
081300     IF PV-OTB-PD-NUMERIC <= ZERO                                 08130078
081400         ADD +12 TO PV-OTB-PD-NUMERIC                             08140078
081500         MOVE PV-OTB-PD-NUMERIC TO PV-OTB-PP                      08150078
081600         SUBTRACT +1 FROM PV-HOLD-OTB-YR-NUMERIC GIVING           08160078
081700                          PV-OTB-YR-NUMERIC                       08170078
081800         MOVE PV-OTB-YR-NUMERIC TO PV-OTB-YY                      08180078
081900     ELSE                                                         08190078
082000         MOVE PV-OTB-PD-NUMERIC TO PV-OTB-PP                      08200078
082100         MOVE PV-HOLD-OTB-YR-NUMERIC TO PV-OTB-YY                 08210078
082200     END-IF.                                                      08220078
082300                                                                  08230078
082400     MOVE PV-OTB       TO PV-OTB-PERIOD-MINUS3.                   08240078
082500     DISPLAY 'OTB PERIOD MINUS3: ' PV-OTB-PERIOD-MINUS3.          08250078
082600                                                                  08260078
082700*    OTB PERIOD MINUS-4                                           08270078
082800                                                                  08280078
082900     SUBTRACT +4 FROM PV-HOLD-OTB-PD-NUMERIC GIVING               08290078
083000                PV-OTB-PD-NUMERIC.                                08300078
083100                                                                  08310078
083200     IF PV-OTB-PD-NUMERIC <= ZERO                                 08320078
083300         ADD +12 TO PV-OTB-PD-NUMERIC                             08330078
083400         MOVE PV-OTB-PD-NUMERIC TO PV-OTB-PP                      08340078
083500         SUBTRACT +1 FROM PV-HOLD-OTB-YR-NUMERIC GIVING           08350078
083600                          PV-OTB-YR-NUMERIC                       08360078
083700         MOVE PV-OTB-YR-NUMERIC TO PV-OTB-YY                      08370078
083800     ELSE                                                         08380078
083900         MOVE PV-OTB-PD-NUMERIC TO PV-OTB-PP                      08390078
084000         MOVE PV-HOLD-OTB-YR-NUMERIC TO PV-OTB-YY                 08400078
084100     END-IF.                                                      08410078
084200                                                                  08420078
084300     MOVE PV-OTB       TO PV-OTB-PERIOD-MINUS4.                   08430078
084400     DISPLAY 'OTB PERIOD MINUS4: ' PV-OTB-PERIOD-MINUS4.          08440078
084500                                                                  08450078
084600     EJECT                                                        08460078
084700                                                                  08470078
084800 R100-READ-INPUT.                                                 08480078
084900                                                                  08490078
085000*----------------------------------------------------------------*08500078
085100*    READ OPEN TO PAY EXTRACT FILE.                              *08510078
085200*----------------------------------------------------------------*08520078
085300                                                                  08530078
085400     READ PO-COST-VARIANCE-FILE INTO                              08540078
085500              AP036-IMPORT-REPORT-RECORD                          08550078
085600                  AT END                                          08560078
085700                      SET PS-PO-VARIANCE-EOF-YES TO TRUE          08570078
085800     END-READ.                                                    08580078
085900                                                                  08590078
086000     IF PS-PO-VARIANCE-EOF-NO                                     08600078
086100         ADD 1                   TO PV-READ-CNT                   08610078
086200         IF AP036-VENDOR-NBR = 009206194                          08620078
086300             ADD 1                   TO PV-READ-LIFUNG-CNT        08630079
086400         ELSE                                                     08640078
086500             ADD 1                   TO PV-READ-NON-LIFUNG-CNT    08650079
086600         END-IF                                                   08660078
086700     END-IF.                                                      08670078
086800                                                                  08680078
086900     EJECT                                                        08690078
087000                                                                  08700078
087100 S100-GET-BATCH-PROCESS-DATE.                                     08710078
087200                                                                  08720078
087300*----------------------------------------------------------------*08730078
087400*    GET THE BATCH PROCSSING DATE FROM THE AP CONTROL TABLE      *08740078
087500*----------------------------------------------------------------*08750078
087600                                                                  08760078
087700     PERFORM WITH TEST AFTER                                      08770078
087800             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 08780078
087900             UNTIL   PV-RETRY-COUNTER > 3  OR                     08790078
088000                     SQLCODE = ZERO OR                            08800078
088100                     SQLCODE = +100                               08810078
088200                                                                  08820078
088300         EXEC SQL                                                 08830078
088400             SELECT  BTCH_PRC_DTE                                 08840078
088500               INTO :APCNTL-BTCH-PRC-DTE                          08850078
088600               FROM  TAPCNTL                                      08860078
088700         END-EXEC                                                 08870078
088800                                                                  08880078
088900         EVALUATE TRUE                                            08890078
089000           WHEN SQLCODE = ZERO                                    08900078
089100             CONTINUE                                             08910078
089200           WHEN SQLWARN0 NOT = SPACES                             08920078
089300           WHEN SQLCODE NOT  = ZERO                               08930078
089400             MOVE 'S100-GET-BATCH-PROCESS-DATE'                   08940078
089500                                 TO AA-PARAGRAPH-NAME             08950078
089600             MOVE 'UNSUCCESSFUL SELECT'                           08960078
089700                                 TO AA-DB2-OPERATION              08970078
089800             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                08980078
089900             MOVE SPACES         TO AA-DB2-TABLE-2                08990078
090000                                    AA-DB2-TABLE-3                09000078
090100             PERFORM Z999-DB2-ABEND                               09010078
090200         END-EVALUATE                                             09020078
090300     END-PERFORM.                                                 09030078
090400                                                                  09040078
090500     IF PV-RETRY-COUNTER > 3                                      09050078
090600         MOVE 'S100-GET-BATCH-PROCESS-DATE'                       09060078
090700                                 TO AA-PARAGRAPH-NAME             09070078
090800         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    09080078
090900                                 TO AA-DB2-OPERATION              09090078
091000         MOVE 'TAPCNTL'          TO AA-DB2-TABLE-1                09100078
091100         MOVE SPACES             TO AA-DB2-TABLE-2                09110078
091200                                    AA-DB2-TABLE-3                09120078
091300         PERFORM Z999-DB2-ABEND                                   09130078
091400     END-IF.                                                      09140078
091500                                                                  09150078
091600     EJECT                                                        09160078
091700                                                                  09170078
091800 Z900-CALL-CALENDAR-ROUTINE.                                      09180078
091900                                                                  09190078
092000     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   09200078
092100                                                                  09210078
092200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    09220078
092300                                             DPG54 DPG55 DPG56.   09230078
092400                                                                  09240078
092500     IF DPG54-SEVERE-ERROR OR DPG54-WARNING-ERROR                 09250078
092600         MOVE 'Z900-CALL-CALENDAR-ROUTINE'                        09260078
092700                                       TO AA-PARAGRAPH-NAME       09270078
092800         MOVE DPG54-ERROR-MESSAGE      TO AA-MESSAGE-1            09280078
092900         MOVE DPG52-DB2-ISO-DATE-FMT   TO AA-MESSAGE-2            09290078
093000         SET AC-DATE-ERROR             TO TRUE                    09300078
093100         PERFORM Z998-ABEND                                       09310078
093200     END-IF.                                                      09320078
093300                                                                  09330078
093400     EJECT                                                        09340078
093500                                                                  09350078
093600 Z998-ABEND.                                                      09360078
093700                                                                  09370078
093800*----------------------------------------------------------------*09380078
093900*    ABEND ROUTINE                                               *09390078
094000*----------------------------------------------------------------*09400078
094100                                                                  09410078
094200     DISPLAY AA-ABEND-LIT.                                        09420078
094300     DISPLAY AA-PROGRAM-LIT.                                      09430078
094400     DISPLAY AA-PARAGRAPH-LIT.                                    09440078
094500     DISPLAY AA-MESSAGE-LINE-1.                                   09450078
094600     DISPLAY AA-MESSAGE-LINE-2.                                   09460078
094700                                                                  09470078
094800     CALL 'ILBOABN0' USING ABEND-CODE.                            09480078
094900                                                                  09490078
095000     EJECT                                                        09500078
095100                                                                  09510078
095200 Z999-DB2-ABEND.                                                  09520078
095300                                                                  09530078
095400*----------------------------------------------------------------*09540078
095500*    DB2 ABEND ROUTINE                                           *09550078
095600*----------------------------------------------------------------*09560078
095700                                                                  09570078
095800     DISPLAY AA-ABEND-LIT.                                        09580078
095900     DISPLAY AA-MESSAGE-LINE-1.                                   09590078
096000     DISPLAY AA-MESSAGE-LINE-2.                                   09600078
096100     DISPLAY AA-DB2-ERROR-LIT.                                    09610078
096200     DISPLAY AA-PROGRAM-LIT.                                      09620078
096300     DISPLAY AA-PARAGRAPH-LIT.                                    09630078
096400     DISPLAY AA-DB2-OPERATION-LIT.                                09640078
096500     DISPLAY AA-DB2-TABLE-1.                                      09650078
096600     DISPLAY AA-DB2-TABLE-2.                                      09660078
096700     DISPLAY AA-DB2-TABLE-3.                                      09670078
096800     SET AC-DB2-ERROR TO TRUE.                                    09680078
096900                                                                  09690078
097000     COPY DPPD004.                                                09700078
097100                                                                  09710078
097200     CALL 'ILBOABN0' USING ABEND-CODE.                            09720078
097300                                                                  09730078
097400*                                                                 09740078
097500******************************************************************09750078
