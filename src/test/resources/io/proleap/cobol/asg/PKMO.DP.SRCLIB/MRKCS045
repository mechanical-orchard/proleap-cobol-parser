000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    MRKCS045.                                         00040000
000500 AUTHOR.        KOHLS DEPARTMENT STORES.                          00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  11-15-93.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Y045 - MR-PTAG LIST BY SKU                                 * 00110002
001200*                                                               * 00120000
001300*    THIS PROGRAM IS THE LIST SCREEN FOR DISPLAYING PTAGS       * 00130002
001400*    BY SKU. IT ALSO EDITS THE DATA ENTERED ON THE MRKCS044     * 00140002
001500*    CRIT SPEC SCREEN.                                          * 00150039
001900*                                                               * 00160000
002000*---------------------------------------------------------------* 00170000
002010******************************************************************00180044
002020* 08/08/01 - THERESE RAMSEYER - COMPUWARE   WR #21601            *00190044
002030*    - UPDATED PROGRAM FOR CHANGEOVER TO NI-SKU.                 *00200044
002040*    - INCREASED LENGTH OF DEPT, CLASS, AND SKU. ADDED SUBCLASS. *00210044
002050*    - CHANGED PROGRAM TO VALIDATE SUBCLASS.                     *00220044
002060*    - ADDED TSKXREF TABLE TO SQL STATEMENTS WHEN NECCESSARY     *00230044
002061*    - ELIMINATED WORKING STORAGE VARIABLES AND PARAGRAPHS FROM  *00240044
002062*      THE TEMPLATE THAT WERE NEVER REFERENCED.                  *00250044
002063*    - ELIMINATED SOME DOCUMENTATION THAT REFERRED TO THE        *00260044
002064*      SYSTEM MESSAGE SCREEN TEMPLATE, NOT THE CURRENT PROGRAM.  *00270044
002065*    - ADDED STANDARD RETRY LOGIC TO FETCH 4310- & VALIDATE 1300-*00280073
002070******************************************************************00290044
002080* 12/26/01 - NICK MOULTON                   WR #21601            *00300083
002081*    - CHANGED ERROR MESSAGE TO BETTER CLARIFY THE ERROR TO USER *00310083
002082******************************************************************00320083
262436* CHANGED 10/12/2021    BY JIM HUNTER      WR: CHG0262436         00320185
262436* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00320285
262436* MAKING THE CALL DYNAMIC VS STATIC.                              00320385
262436******************************************************************00321085
CICS  * CHANGED 10/28/2022    BY JIM HUNTER      WR: CHG0277420         00322087
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00323087
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00324087
CICS  ******************************************************************00325087
002100 EJECT                                                            00330000
002200 ENVIRONMENT DIVISION.                                            00340000
002300                                                                  00350000
002400 DATA DIVISION.                                                   00360000
002500                                                                  00370000
002600 WORKING-STORAGE SECTION.                                         00380000
002700                                                                  00390000
004500 01  PC-PROGRAM-CONSTANTS.                                        00400000
004600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00410000
004700                                                    'MR045A  '.   00420000
004800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00430000
004900                                                    'MRKM045 '.   00440000
005000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00450000
005100                                                    'MRKCS045'.   00460000
005200     05  PC-DATE-MODULE                 PIC  X(08)  VALUE         00470000
005300                                                    'DPKUT500'.   00480000
005400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00490000
005500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00500000
005600     05  PC-BY-SKU-REQUEST              PIC  X(01)  VALUE '1'.    00510000
005700     05  PC-BY-STORE-REQUEST            PIC  X(01)  VALUE '2'.    00520000
005800     05  PC-BY-PTAG-REQUEST             PIC  X(01)  VALUE '3'.    00530000
005900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00540000
006000     05  PC-INTER-APPL-LIST             PIC  X(01)  VALUE '2'.    00550000
006100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00560000
006200                                                    COMP SYNC.    00570000
006300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00580000
006400                                                    COMP SYNC.    00590000
006500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00600000
006600                                                    +1000000      00610000
006700                                                    COMP-3.       00620000
006800     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00630000
006900                                                    COMP SYNC.    00640000
007000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00650000
007100                                                    COMP-3.       00660000
007200     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00670000
007300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00680000
007400     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00690000
007500     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00700000
007600     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00710000
007700*                                                                 00720000
007800     05  PC-TSYMSG-NUMBERS.                                       00730000
007900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00740000
008000         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00750000
008100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00760000
008200         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00770000
008300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00780000
008400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00790000
008500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00800000
008600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00810000
008700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00820000
008800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00830000
008900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00840000
009000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00850000
009100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00860000
009200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00870000
009300         10  PC-TSYMSG-00110            PIC  9(05)  VALUE 00110.  00880000
009400         10  PC-TSYMSG-00114            PIC  9(05)  VALUE 00114.  00890000
009500         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00900000
009600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00910000
009700         10  PC-TSYMSG-00690            PIC  9(05)  VALUE 00690.  00920000
009800         10  PC-TSYMSG-00691            PIC  9(05)  VALUE 00691.  00930000
009900         10  PC-TSYMSG-00692            PIC  9(05)  VALUE 00692.  00940000
010000         10  PC-TSYMSG-00693            PIC  9(05)  VALUE 00693.  00950000
010000         10  PC-TSYMSG-00694            PIC  9(05)  VALUE 00694.  00951084
010100         10  PC-TSYMSG-02801            PIC  9(05)  VALUE 02801.  00960082
010200         10  PC-TSYMSG-02803            PIC  9(05)  VALUE 02803.  00970081
010300*                                                                 00980000
010400 01  PS-PROGRAM-SWITCHES.                                         00990000
010500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01000000
010600         88  PS-NO-ERROR                            VALUE 'Y'.    01010000
010700         88  PS-ERROR                               VALUE 'N'.    01020000
010800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01030000
010900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01040000
011000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01050000
011400     05  PS-USE-WILDCARD-SW             PIC  X(01)  VALUE 'N'.    01060000
011500         88  PS-USE-WILDCARD                        VALUE 'Y'.    01070000
011600     05  PS-NO-DEPT-REC-SW              PIC  X(01)  VALUE 'N'.    01080000
011700         88  PS-NO-DEPT-REC                         VALUE 'Y'.    01090000
011800*                                                                 01100000
011900 01  PV-PROGRAM-VARIABLES.                                        01110000
011910     05  PV-SQL-SUB                     PIC  S9(04) VALUE +0.     01120071
012000     05  PV-TYPE                        PIC  X(03).               01130000
012100     05  PV-PROCESS-DATE.                                         01140000
012200         10  PV-PROCESS-DATE-CENT       PIC  X(02).               01150000
012300         10  PV-PROCESS-DATE-YY         PIC  X(02).               01160000
012400         10  FILLER                     PIC  X(01) VALUE '-'.     01170000
012500         10  PV-PROCESS-DATE-MM         PIC  X(02).               01180000
012600         10  FILLER                     PIC  X(01) VALUE '-'.     01190000
012700         10  PV-PROCESS-DATE-DD         PIC  X(02).               01200000
012800     05  PV-PROCESS-DATE-R REDEFINES PV-PROCESS-DATE              01210000
012900                                        PIC  X(10).               01220000
012910     05  PV-DEPT-NUMBER-S               PIC  S9(04)V COMP-3.      01230008
013000     05  PV-DEPT-NUMBER                 PIC  9(04).               01240002
013010     05  PV-DEPT-X         REDEFINES                              01250005
013020         PV-DEPT-NUMBER                 PIC  X(04).               01260005
013021     05  PV-DEPT-93                     PIC  9(03).               01270012
013022     05  PV-DEPT-X3                     PIC  X(03).               01280012
013030     05  PV-CLASS-NUMBER-S              PIC  S9(04)V COMP-3.      01290008
013100     05  PV-CLASS-NUMBER                PIC  9(04).               01300002
013110     05  PV-CLASS-X        REDEFINES                              01310005
013120         PV-CLASS-NUMBER                PIC  X(04).               01320005
013130     05  PV-SUBCLASS-NUMBER-S           PIC  S9(04)V COMP-3.      01330008
013200     05  PV-SUBCLASS-NUMBER             PIC  9(04).               01340002
013300     05  PV-SUBCLASS-X     REDEFINES                              01350005
013400         PV-SUBCLASS-NUMBER             PIC  X(04).               01360005
013410     05  PV-SUBCLASS-X3                 PIC  X(03).               01370012
013500     05  PV-SKU-NUMBER-S                PIC  S9(08)V COMP-3.      01380008
014200     05  PV-SKU-NUMBER                  PIC  9(08).               01390005
014300     05  PV-PTAG                        PIC  X(07).               01400002
015100     05  PV-CLASS-X2                    PIC  X(02).               01410000
015200     05  FILLER REDEFINES PV-CLASS-X2.                            01420000
015300         10  PV-CLASS-92                PIC  9(02).               01430000
015400     05  PV-CLASS-X3                    PIC  X(03).               01440000
015500     05  FILLER REDEFINES PV-CLASS-X3.                            01450000
015600         10  PV-CLASS-93                PIC  9(03).               01460000
015700     05  PV-SUB                         PIC S9(04)  VALUE +0      01470000
015800                                                    COMP SYNC.    01480000
015900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01490000
016000                                                    COMP SYNC.    01500000
016100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01510000
016200                                                    COMP-3.       01520000
016300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01530000
016400                                                    COMP-3.       01540000
016500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01550000
016600                                                    COMP-3.       01560000
016700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01570000
016800                                                    COMP-3.       01580000
016900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01590000
017000                                                    COMP-3.       01600000
017100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01610000
017200                                                    COMP-3.       01620000
017300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01630000
017400                                                    COMP-3.       01640000
017500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01650000
017600                                                    COMP SYNC.    01660000
017700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01670000
017800                                                    COMP SYNC.    01680000
017900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01690000
018000                                                    COMP SYNC.    01700000
018100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01710000
018200                                                    COMP SYNC.    01720000
018300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01730000
018400                                                    COMP SYNC.    01740000
018500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01750000
018600                                                    COMP SYNC.    01760000
018700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01770000
018800                                                    COMP SYNC.    01780000
018900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01790000
019000                                                    COMP SYNC.    01800000
019100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01810000
019200                                                    COMP SYNC.    01820000
019300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01830000
019400                                                    COMP SYNC.    01840000
019500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01850000
019600                                                    COMP SYNC.    01860000
019700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01870000
019800                                                    COMP SYNC.    01880000
019900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01890000
020000                                                    COMP SYNC.    01900000
020100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01910000
020200                                                    COMP SYNC.    01920000
020500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01930000
020600                                                    COMP SYNC.    01940000
020700******************************************************************01950000
020800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01960000
020900**  THIS MUST BE THE EXACT SAME FORMAT AS A BLOCK IN THE        **01970061
021000**  APPLICATION-SPECIFIC COMMAREA.                              **01980000
021100******************************************************************01990000
021200 01  LQW-LIST-QUEUE-WORK-AREA.                                    02000000
021300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02010000
021400     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           02020000
021500                                        INDEXED BY LQW-IDX.       02030000
021600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)   COMP-3.      02040000
021700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02050000
021800         10  LQW-SELECTED-SW            PIC  X(01).               02060000
021900             88  LQW-SELECT                         VALUE 'S'.    02070000
022000             88  LQW-DESELECT                       VALUE ' '.    02080000
022100         10  LQW-ACTION                 PIC  X(03).               02090000
022200         10  LQW-PTAG                   PIC  X(07).               02100000
022300         10  LQW-DEPT                   PIC  9(03).               02110002
022310         10  LQW-CLASS                  PIC  9(02).               02120006
022320         10  LQW-SCLASS                 PIC  9(02).               02130002
022330         10  LQW-SKU                    PIC  9(08).               02140002
022400         10  LQW-DESCRIPTION            PIC  X(23).               02150051
022500         10  LQW-SIZE                   PIC  X(05).               02160000
022600         10  LQW-COLOR                  PIC  X(04).               02170000
022700                                                                  02180000
022800                                                                  02190000
022900                                                                  02200000
023000 01  ST-SYSTEM-TIME-AREA.                                         02210000
023100     05  ST-ABSTIME                PIC S9(16)  COMP.              02220000
023200     05  ST-TIME-EDIT.                                            02230000
023300         10  ST-TIME-HHMM          PIC X(05).                     02240000
023400         10  FILLER                PIC X(03).                     02250000
023500     05  ST-DATE                   PIC X(08).                     02260000
023600     05  FILLER  REDEFINES  ST-DATE.                              02270000
023700         10  ST-MM                 PIC XX.                        02280000
023800         10  FILLER                PIC X.                         02290000
023900         10  ST-DD                 PIC XX.                        02300000
024000         10  FILLER                PIC X.                         02310000
024100         10  ST-YY                 PIC XX.                        02320000
024200                                                                  02330000
024300     EJECT                                                        02340000
024400*---------------------------------------------------------------* 02350000
024500*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 02360070
024600*---------------------------------------------------------------* 02370000
024700                                                                  02380000
024800     COPY MRWS115.                                                02390000
024900                                                                  02400000
025000     EJECT                                                        02410000
025100*---------------------------------------------------------------* 02420000
025200*    MAP LAYOUT                                                 * 02430000
025300*---------------------------------------------------------------* 02440000
025400                                                                  02450000
025500     COPY MRKM045.                                                02460000
025600*                                                                 02470000
025700 01  MR-OCCURS-LAYOUT                   REDEFINES  MR045AO.       02480000
025800     05  FILLER                         PIC X(44).                02490000
025900     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          02500000
026000         10  MR-SELECTL                 PIC S9(04) COMP.          02510000
026100         10  MR-SELECTA                 PIC  X(01).               02520000
026200         10  MR-SELECTC                 PIC  X(01).               02530000
026300         10  MR-SELECTH                 PIC  X(01).               02540000
026400         10  MR-SELECTI                 PIC  X(01).               02550000
026500                                                                  02560000
026600         10  MR-ACTIONL                 PIC S9(04) COMP.          02570000
026700         10  MR-ACTIONA                 PIC  X(01).               02580000
026800         10  MR-ACTIONC                 PIC  X(01).               02590000
026900         10  MR-ACTIONH                 PIC  X(01).               02600000
027000         10  MR-ACTION                  PIC  X(03).               02610000
027100                                                                  02620000
027200         10  MR-PTAGL                   PIC S9(04) COMP.          02630000
027300         10  MR-PTAGA                   PIC  X(01).               02640000
027400         10  MR-PTAGC                   PIC  X(01).               02650000
027500         10  MR-PTAGH                   PIC  X(01).               02660000
027600         10  MR-PTAG                    PIC X(07).                02670000
027700                                                                  02680000
027800         10  MR-DEPTL                   PIC S9(04) COMP.          02690002
027900         10  MR-DEPTA                   PIC  X(01).               02700002
028000         10  MR-DEPTC                   PIC  X(01).               02710002
028100         10  MR-DEPTH                   PIC  X(01).               02720002
028200         10  MR-DEPT                    PIC  X(03).               02730013
028300                                                                  02740000
028301         10  MR-CLASSL                  PIC S9(04) COMP.          02750006
028302         10  MR-CLASSA                  PIC  X(01).               02760006
028303         10  MR-CLASSC                  PIC  X(01).               02770006
028304         10  MR-CLASSH                  PIC  X(01).               02780006
028305         10  MR-CLASS                   PIC  X(02).               02790013
028306                                                                  02800002
028307         10  MR-SCLASSL                 PIC S9(04) COMP.          02810002
028308         10  MR-SCLASSA                 PIC  X(01).               02820002
028309         10  MR-SCLASSC                 PIC  X(01).               02830002
028310         10  MR-SCLASSH                 PIC  X(01).               02840002
028311         10  MR-SCLASS                  PIC  X(02).               02850013
028312                                                                  02860002
028313         10  MR-SKUL                    PIC S9(04) COMP.          02870002
028320         10  MR-SKUA                    PIC  X(01).               02880002
028330         10  MR-SKUC                    PIC  X(01).               02890002
028340         10  MR-SKUH                    PIC  X(01).               02900002
028350         10  MR-SKU                     PIC  X(08).               02910013
028360                                                                  02920002
028400         10  MR-DESCRIPTIONL            PIC S9(04) COMP.          02930000
028500         10  MR-DESCRIPTIONA            PIC  X(01).               02940000
028600         10  MR-DESCRIPTIONC            PIC  X(01).               02950000
028700         10  MR-DESCRIPTIONH            PIC  X(01).               02960000
028800         10  MR-DESCRIPTION             PIC  X(23).               02970051
028900                                                                  02980000
029000         10  MR-SIZEL                   PIC S9(04) COMP.          02990000
029100         10  MR-SIZEA                   PIC  X(01).               03000000
029200         10  MR-SIZEC                   PIC  X(01).               03010000
029300         10  MR-SIZEH                   PIC  X(01).               03020000
029400         10  MR-SIZE                    PIC  X(05).               03030000
029500                                                                  03040000
029600         10  MR-COLORL                  PIC S9(04) COMP.          03050000
029700         10  MR-COLORA                  PIC  X(01).               03060000
029800         10  MR-COLORC                  PIC  X(01).               03070000
029900         10  MR-COLORH                  PIC  X(01).               03080000
030000         10  MR-COLOR                   PIC  X(04).               03090000
030100     EJECT                                                        03100000
030200*---------------------------------------------------------------* 03110000
030300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03120000
030400*---------------------------------------------------------------* 03130000
030500                                                                  03140000
030600     COPY DPWS015.                                                03150000
030700                                                                  03160000
030800*---------------------------------------------------------------* 03170000
030900*    FUNCTION KEYS COPYBOOK.                                    * 03180000
031000*---------------------------------------------------------------* 03190000
031100                                                                  03200000
031200     COPY DPWS016.                                                03210000
031300                                                                  03220000
031400 EJECT                                                            03230000
031500******************************************************************03240000
031600** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **03250000
031700** SUB-ROUTINE (DPKUT100).                                      **03260000
031800******************************************************************03270000
031900     COPY DPWS010I.                                               03280000
032000 EJECT                                                            03290000
032100*---------------------------------------------------------------* 03300000
032200*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03310087
032300*---------------------------------------------------------------* 03320000
032400                                                                  03330000
032500     COPY DPWS030.                                                03340000
CICS       COPY DPWS930.                                                03341087
032600 EJECT                                                            03350000
032700*---------------------------------------------------------------* 03360000
032800*    STANDARD COMMAREA.                                         * 03370000
032900*---------------------------------------------------------------* 03380000
033000                                                                  03390000
033100     COPY DPWS020.                                                03400000
033200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03410000
033300                                                                  03420000
033400*---------------------------------------------------------------* 03430000
033500* INTER-APPLICATION COMMAREA.                                   * 03440000
033600*   MRWS114 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03450000
033700*             SPEC SCREEN.                                      * 03460000
033800*   MRWS102 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03470000
033900*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03480000
034000*---------------------------------------------------------------* 03490000
034100                                                                  03500000
034200         10  INTER-APPL-COMM-AREA       PIC X(200).               03510000
034300     COPY MRWS114.                                                03520000
034400     COPY MRWS102.                                                03530000
034500*---------------------------------------------------------------* 03540000
034600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03550000
034700*---------------------------------------------------------------* 03560000
034800         10  ASC-SPECIFIC-COMMAREA.                               03570000
034900             15  ASC-LIST-KEYS.                                   03580000
035000                 20  ASC-KEY-DEPT-N                  PIC  9(04).  03590010
035010                 20  ASC-KEY-DEPT          REDEFINES              03600010
035020                     ASC-KEY-DEPT-N                  PIC  X(04).  03610010
035100                 20  ASC-KEY-CLASS-N                 PIC  9(04).  03620010
035101                 20  ASC-KEY-CLASS         REDEFINES              03630011
035102                     ASC-KEY-CLASS-N                 PIC  X(04).  03640010
035110                 20  ASC-KEY-SUBCLASS-N              PIC  9(04).  03650038
035120                 20  ASC-KEY-SUBCLASS      REDEFINES              03660038
035130                     ASC-KEY-SUBCLASS-N              PIC  X(04).  03670038
035200                 20  ASC-KEY-SKU-N                   PIC  9(08).  03680010
035210                 20  ASC-KEY-SKU           REDEFINES              03690011
035220                     ASC-KEY-SKU-N                   PIC  X(08).  03700010
035300                 20  ASC-KEY-PTAG                    PIC  X(07).  03710000
035400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03720000
035500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03730000
035600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03740000
035700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03750000
035800                                                                  03760000
035900                 20  ASC-ITEM-ARRAY.                              03770000
036000                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        03780000
036100                         30  ASC-LIST-ITEM-NUMBER                 03790000
036200                                                     PIC S9(09)   03800000
036300                                                     COMP-3.      03810000
036400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03820000
036500                             88  ASC-VALID-SELECT    VALUE ' '    03830000
036600                                                           'S'    03840000
036700                                                           'B'    03850000
036800                                                           'E'.   03860000
036900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03870000
037000                             88  ASC-TEMP-SELECT     VALUE 'S'.   03880000
037100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03890000
037200                             88  ASC-TEMP-END        VALUE 'E'.   03900000
037300                         30  ASC-SELECTED-SW         PIC  X(01).  03910000
037400                             88  ASC-NO-SELECT       VALUE ' '.   03920000
037500                             88  ASC-SELECT          VALUE 'S'.   03930000
037600                             88  ASC-BEGIN           VALUE 'B'.   03940000
037700                             88  ASC-END             VALUE 'E'.   03950000
037800                         30  ASC-ACTION              PIC  X(03).  03960000
037900                         30  ASC-PTAG                PIC  X(07).  03970000
038010                         30  ASC-DEPT                PIC  9(03).  03980002
038020                         30  ASC-CLASS               PIC  9(02).  03990006
038030                         30  ASC-SUBCLASS            PIC  9(02).  04000006
038040                         30  ASC-SKU                 PIC  9(08).  04010002
038100                         30  ASC-DESCRIPTION         PIC  X(23).  04020051
038200                         30  ASC-SIZE                PIC  X(05).  04030000
038300                         30  ASC-COLOR               PIC  X(04).  04040000
038400                                                                  04050000
038500             15  ASC-BLK-SUB                         PIC S9(04)   04060000
038600                                                          COMP    04070000
038700                                                          SYNC.   04080000
038800             15  ASC-ITEM-SUB                        PIC S9(04)   04090000
038900                                                          COMP    04100000
039000                                                          SYNC.   04110000
039100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04120000
039200                                                          COMP-3. 04130000
039300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   04140000
039400                                                          COMP-3. 04150000
039500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04160000
039600                                                          COMP-3. 04170000
039700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04180000
039800                                                          COMP-3. 04190000
039900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04200000
040000                                                          COMP-3. 04210000
040100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04220000
040200                                                          COMP-3. 04230000
040300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04240000
040400                                                          COMP    04250000
040500                                                          SYNC.   04260000
040600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04270000
040700                                                          COMP-3. 04280000
040800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04290000
040900                                                          COMP-3. 04300000
041000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04310000
041100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04320000
041200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04330000
041300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04340000
041400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04350000
041500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04360000
041600             15  ASC-LIST-QUEUE-NAME.                             04370000
041700                 20  ASC-LIST-TERM-ID                PIC  X(04).  04380000
041800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04390000
041900                                                          COMP-3. 04400000
042000                 20  ASC-LIST-SEQ                    PIC  9(01).  04410000
042100             15  ASC-SEL-QUEUE-NAME.                              04420000
042200                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04430000
042300                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04440000
042400                                                          COMP-3. 04450000
042500                 20  ASC-SEL-SEQ                     PIC  9(01).  04460000
042600                                                                  04470000
042700             15  ASC-SEL-SUB                         PIC S9(04)   04480000
042800                                                          COMP.   04490000
042900             15  ASC-SEL-ITEM                        PIC S9(04)   04500000
043000                                                          COMP.   04510000
043600             15  ASC-START-ITEM-REQUEST.                          04520000
043700                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04530000
043710             15  FILLER                              PIC  X(10).  04540077
043720                                                                  04550076
043800     EJECT                                                        04560000
043900*---------------------------------------------------------------* 04570000
044000*    ABEND PROCESSING COPYBOOK.                                 * 04580000
044100*---------------------------------------------------------------* 04590000
044200                                                                  04600000
044300     COPY DPWS013.                                                04610000
044400                                                                  04620000
044500 EJECT                                                            04630000
044600*---------------------------------------------------------------* 04640000
044700*    DB2 AREA FOR TSK                                           * 04650000
044800*---------------------------------------------------------------* 04660000
044900     EXEC SQL                                                     04670000
045000          INCLUDE TSK                                             04680000
045100     END-EXEC.                                                    04690000
045200*---------------------------------------------------------------* 04700000
045300*    DB2 AREA FOR TMRITST                                       * 04710000
045400*---------------------------------------------------------------* 04720000
045500     EXEC SQL                                                     04730000
045600          INCLUDE TMRITST                                         04740000
045700     END-EXEC.                                                    04750000
045800*---------------------------------------------------------------* 04760000
045900*    DB2 AREA FOR TMDSEAR                                       * 04770000
046000*---------------------------------------------------------------* 04780000
046100     EXEC SQL                                                     04790000
046200         INCLUDE TMDSEAR                                          04800000
046300     END-EXEC.                                                    04810000
046400                                                                  04820000
046401******************************************************************04830044
046402* MRNIS-RFC      PREVIOUS   NOT INCLUDED                          04840044
046403* MRNIS-RFC      CURRENT    DCLGEN FOR TSKXREF                    04850044
046404* MRNIS-RFC      FUTURE     REMOVE WHEN TSKXREF NO LONGER NEEDED  04860044
046405******************************************************************04870044
046410*---------------------------------------------------------------* 04880007
046420*    DB2 AREA FOR TSKXREF                                       * 04890007
046430*---------------------------------------------------------------* 04900007
046440     EXEC SQL                                                     04910007
046450         INCLUDE TSKXREF                                          04920007
046460     END-EXEC.                                                    04930007
046470                                                                  04940007
046500*---------------------------------------------------------------* 04950000
046600*    DB2 AREA FOR COMMUNICATIONS                                * 04960000
046700*---------------------------------------------------------------* 04970000
046800     EXEC SQL                                                     04980000
046900          INCLUDE SQLCA                                           04990000
047000     END-EXEC.                                                    05000000
047100                                                                  05010000
047410******************************************************************05020044
047420* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       05030053
047430* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  05040044
047440* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 05050044
047450******************************************************************05060044
047460*---------------------------------------------------------------* 05070044
047470*    PTAG-BY-SKU CURSOR (GOING TO SUBCLASS LEVEL)               * 05080053
047480*---------------------------------------------------------------* 05090044
047500                                                                  05100000
047600     EXEC SQL                                                     05110000
047700          DECLARE PTAG-BY-SKU1 CURSOR                             05120000
047800          FOR SELECT DISTINCT                                     05130000
047900                A.PTAG_ID                                         05140000
047910              , X.DEPT                                            05150003
047920              , X.CLASS                                           05160003
047930              , X.SUBCLASS                                        05170003
047940              , X.SKU                                             05180003
048300              , B.SKU_DESC                                        05190000
048400              , B.SIZE_DESC                                       05200000
048500              , B.COLOR_DESC                                      05210000
048600              , A.ITEM_NBR                                        05220000
048700          FROM                                                    05230000
048800                TMRITST  A                                        05240000
048900              , TSK      B                                        05250000
048910              , TSKXREF  X                                        05260003
049000          WHERE                                                   05270000
049100                A.ITEM_NBR            = B.ITEM_NMBR               05280000
049110           AND  B.ITEM_NMBR           = X.ITM_NBR                 05290003
049120           AND  X.DEPT                = :PV-DEPT-NUMBER-S         05300022
049130           AND  X.CLASS               = :PV-CLASS-NUMBER-S        05310022
049140           AND  X.SUBCLASS            = :PV-SUBCLASS-NUMBER-S     05320022
049400          ORDER BY                                                05330000
049500                X.DEPT                                            05340003
049600              , X.CLASS                                           05350003
049700              , X.SUBCLASS                                        05360003
049710              , X.SKU                                             05370003
049800              , A.PTAG_ID                                         05380000
049900     END-EXEC.                                                    05390000
050000                                                                  05400000
050100*---------------------------------------------------------------* 05410000
050200*    PTAG-BY-SKU CURSOR (GOING TO MAJOR CLASS LEVEL)            * 05420053
050300*---------------------------------------------------------------* 05430000
050310******************************************************************05440044
050321* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       05450053
050330* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  05460044
050340* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 05470044
050350******************************************************************05480044
050400                                                                  05490000
050500     EXEC SQL                                                     05500000
050600          DECLARE PTAG-BY-SKU2 CURSOR                             05510000
050700          FOR SELECT DISTINCT                                     05520000
050800                A.PTAG_ID                                         05530000
050900              , X.DEPT                                            05540003
051000              , X.CLASS                                           05550003
051100              , X.SUBCLASS                                        05560003
051110              , X.SKU                                             05570003
051200              , B.SKU_DESC                                        05580000
051300              , B.SIZE_DESC                                       05590000
051400              , B.COLOR_DESC                                      05600000
051500              , A.ITEM_NBR                                        05610000
051600          FROM                                                    05620000
051700                TMRITST  A                                        05630000
051800              , TSK      B                                        05640000
051810              , TSKXREF  X                                        05650003
051900          WHERE                                                   05660000
052000                A.ITEM_NBR            = B.ITEM_NMBR               05670000
052010           AND  B.ITEM_NMBR           = X.ITM_NBR                 05680003
052100           AND  X.DEPT                = :PV-DEPT-NUMBER-S         05690022
052200           AND  X.CLASS               = :PV-CLASS-NUMBER-S        05700022
052400          ORDER BY                                                05710000
052500                X.DEPT                                            05720003
052600              , X.CLASS                                           05730003
052700              , X.SUBCLASS                                        05740003
052710              , X.SKU                                             05750003
052800              , A.PTAG_ID                                         05760000
052900     END-EXEC.                                                    05770000
053000                                                                  05780000
053100                                                                  05790000
053200                                                                  05800000
053300 EJECT                                                            05810000
053400 LINKAGE SECTION.                                                 05820000
053500                                                                  05830000
053600 01  DFHCOMMAREA.                                                 05840000
053700     05  FILLER                         OCCURS  1 TO 4072 TIMES   05850000
053800                                        DEPENDING ON EIBCALEN.    05860000
053900         10  FILLER                     PIC X.                    05870000
054000                                                                  05880000
054100 EJECT                                                            05890000
054200 PROCEDURE DIVISION.                                              05900000
054300******************************************************************05910000
054400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05920000
054500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05930000
054600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05940000
054700******************************************************************05950000
054800 0000-MAIN-MODULE.                                                05960000
054900     INITIALIZE DP030-CICS-API-FIELDS.                            05970000
055000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05980000
055100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05990000
055200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06000000
055300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06010000
055400     MOVE LENGTH OF MR045AI        TO DP030-MAP-LENGTH (1).       06020000
055500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06030000
055600     PERFORM 0001-CALL-CICS-ARCH-API.                             06040000
055700     PERFORM 0500-PREPARE-DATE-MODULE.                            06050000
055800*                                                                 06060000
055900     PERFORM 1000-CONTROL-PROCESSING                              06070000
056000*                                                                 06080000
056100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06090000
056200     PERFORM 0001-CALL-CICS-ARCH-API.                             06100000
056300                                                                  06110000
056400******************************************************************06120000
056500**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06130000
056600**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06140000
056700******************************************************************06150000
056800 0001-CALL-CICS-ARCH-API.                                         06160000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06170087
057000                                    DFHCOMMAREA                   06180087
057100                                    DP030-CICS-API-FIELDS         06190087
057200                                    DP020-STANDARD-COMMAREA       06200087
057300                                    MR045AI.                      06210087
057400*                                                                 06220000
057500     IF  DP030-RC-CALL-SUCCESSFUL                                 06230000
057600         CONTINUE                                                 06240000
057700     ELSE                                                         06250000
057800         SET DP013-NO-ROLLBACK                                    06260000
057900             DP013-XCTL-DISPLAY-RESTART                           06270000
058000             DP013-CICS-ABEND      TO TRUE                        06280000
058100         MOVE '0001-CALL-CICS-ARCH-API'                           06290000
058200                                   TO DP013-PARAGRAPH             06300000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06301087
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06302087
058500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06330000
058600         PERFORM DP013-0000-PROCESS-ABEND                         06340000
058700     END-IF.                                                      06350000
058800                                                                  06360000
058900 0500-PREPARE-DATE-MODULE.                                        06370000
059000*----------------------------------------------------------------*06380000
059100*                                                                *06390000
059200*     LOAD THE CURRENT DATE TO A WORK AREA.                      *06400000
059300*                                                                *06410000
059400*----------------------------------------------------------------*06420000
059500                                                                  06430000
059600     EXEC CICS ASKTIME                                            06440000
059700               ABSTIME(ST-ABSTIME)                                06450000
059800     END-EXEC.                                                    06460000
059900                                                                  06470000
060000     EXEC CICS FORMATTIME                                         06480000
060100               ABSTIME (ST-ABSTIME)                               06490000
060200               MMDDYY  (ST-DATE)                                  06500000
060300               DATESEP                                            06510000
060400               TIME    (ST-TIME-EDIT)                             06520000
060500               TIMESEP                                            06530000
060600     END-EXEC.                                                    06540000
060700                                                                  06550000
060800     MOVE ST-MM                    TO  PV-PROCESS-DATE-MM.        06560000
060900     MOVE ST-DD                    TO  PV-PROCESS-DATE-DD.        06570000
061000     MOVE ST-YY                    TO  PV-PROCESS-DATE-YY.        06580000
061100                                                                  06590000
061200     IF ST-YY > 90                                                06600000
061300         MOVE 19                 TO PV-PROCESS-DATE-CENT          06610000
061400     ELSE                                                         06620000
061500         MOVE 20                 TO PV-PROCESS-DATE-CENT          06630000
061600     END-IF.                                                      06640000
061700                                                                  06650000
061800                                                                  06660000
061900*----------------------------------------------------------------*06670000
062000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06680000
062100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06690000
062200*                                                                *06700000
062300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06710000
062400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06720000
062500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06730000
062600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06740000
062700*----------------------------------------------------------------*06750000
062800                                                                  06760000
062900 1000-CONTROL-PROCESSING.                                         06770000
063000                                                                  06780000
063100     EVALUATE TRUE                                                06790000
063200         WHEN DP020-NEXT-ACT-INITIAL                              06800000
063300             INITIALIZE ASC-SPECIFIC-COMMAREA                     06810059
063400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06820000
063500                                      ASC-SEL-TERM-ID             06830000
063600             MOVE DP020-SRC-TASK-NUMBER                           06840000
063700                                   TO ASC-LIST-TASK-NUMBER        06850000
063800                                      ASC-SEL-TASK-NUMBER         06860000
063900             MOVE PC-LIST-QUEUE-SEQ                               06870000
064000                                   TO ASC-LIST-SEQ                06880000
064100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06890000
064200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06900000
064300***-----$TEMPLATE NOTE$-------------------------------------------06910000
064400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06920000
064500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06930000
064600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06940000
064700***---------------------------------------------------------------06950000
064800             IF  PS-COMMAREA-NOT-VALID                            06960000
064900                 SET DP020-MSG-FATAL                              06970000
065000                                   TO TRUE                        06980000
065100                 SET DP020-NEXT-ACT-APPL-ERROR                    06990000
065200                                   TO TRUE                        07000000
065300             ELSE                                                 07010000
065400                 PERFORM 4000-BUILD-INITIAL-PANEL                 07020000
065500             END-IF                                               07030000
065600                                                                  07040000
065700         WHEN DP020-NEXT-ACT-READ-MAP                             07050000
065800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07060000
065900                                   TO PV-TOP-ITEM                 07070000
066000             PERFORM 2000-PROCESS-PANEL                           07080000
066100                                                                  07090000
066200         WHEN DP020-NEXT-ACT-RETURN                               07100000
066300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07110000
066400                                   TO PV-TOP-ITEM                 07120000
066500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07130000
066600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07140000
066700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07150000
066800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07160000
066900                                                                  07170000
067000         WHEN OTHER                                               07180000
067100             SET DP013-LOGIC-ABEND TO TRUE                        07190000
067200             SET DP013-NO-ROLLBACK TO TRUE                        07200000
067300             MOVE '1000-CONTROL-PROCESSING'                       07210000
067400                                   TO DP013-PARAGRAPH             07220000
067500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07230000
067600                                   TO DP013-MESSAGE-TEXT(1)       07240000
067700             PERFORM DP013-0000-PROCESS-ABEND                     07250000
067800     END-EVALUATE.                                                07260000
067900                                                                  07270000
068000 EJECT                                                            07280000
068100*----------------------------------------------------------------*07290000
068200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07300000
068300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07310000
068400*----------------------------------------------------------------*07320000
068500                                                                  07330000
068600 1100-PROCESS-INTER-APPL-COMM.                                    07340000
068700                                                                  07350000
068800     SET PS-COMMAREA-VALID         TO TRUE.                       07360000
068900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07370000
069000     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07380000
069100         PERFORM 1200-EDIT-COMMAREA                               07390000
069110* WHEN COMING FROM CRIT SPEC, THE MR114- FIELDS HAVE BEEN PUSHED  07400067
069111* THROUGH THE DATE ROUTINE, AND HAVE SUBSEQUENTLY BEEN FORMATTED  07410067
069112* WITH THE PRECEDING ZEROES AND RIGHT JUSTIFED. (THESE ARE PIC X  07420067
069113* FIELDS THAT LOOK LIKE NUMERICS).                                07430067
069130* (EX) THE CONTENTS OF MR114-DEPT  PIC X(04) CONTAINS 0024 FOR    07440067
069140* DEPT 24.                                                        07450068
069200         IF PS-COMMAREA-VALID                                     07460000
069300             MOVE MR114-DEPT           TO ASC-KEY-DEPT-N          07470066
069400             MOVE MR114-CLASS          TO ASC-KEY-CLASS-N         07480066
069410             MOVE MR114-SUBCLASS       TO ASC-KEY-SUBCLASS-N      07490066
069420             MOVE MR114-SKU            TO ASC-KEY-SKU-N           07500024
069500         END-IF                                                   07510000
069600     ELSE                                                         07520000
069700         IF  DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST       07530000
069800             MOVE MR102-NUMBER-OF-SELECTED-ITEMS                  07540000
069900                                   TO ASC-NUMBER-OF-SELECTED-ITEMS07550000
070000             MOVE MR102-NUMBER-OF-TS-ITEMS                        07560000
070100                                   TO ASC-NUMBER-OF-TS-ITEMS      07570000
070200             MOVE MR102-SEL-QUEUE-NAME                            07580000
070300                                   TO ASC-SEL-QUEUE-NAME          07590000
070400             PERFORM 1120-PREPARE-LIST-ENTRY                      07600000
070401* THESE MR114- FIELDS ARE COMING FROM THE LIST SCREENS, SO THEY   07610068
070402* HAVE NOT BEEN FORMATTED ALREADY. THEY ARE LEFT JUSTIFIED ALPHA  07620068
070403* FIELDS, THAT IS WHY IT IS NECESSARY TO USE THE REFERENCE        07630068
070404* MODIFICATION BELOW TO ADD PRECEDING ZEROES AND RIGHT JUSTIFY    07640068
070405* THEM IN THE ASC-KEY- FIELDS WHICH ARE PIC 9(04).                07650068
070500             MOVE MR114-DEPT           TO ASC-KEY-DEPT-N (2:3)    07660064
070600             MOVE MR114-CLASS          TO ASC-KEY-CLASS-N (3:2)   07670065
070610             MOVE MR114-SUBCLASS       TO ASC-KEY-SUBCLASS-N (3:2)07680065
070700             MOVE MR114-SKU            TO ASC-KEY-SKU-N           07690063
070800         ELSE                                                     07700000
070900             MOVE PC-TSYMSG-00148                                 07710000
071000                               TO DP020-MSG-NUMBER                07720000
071100             SET DP020-MSG-FATAL                                  07730000
071200                 DP020-NEXT-ACT-APPL-ERROR                        07740000
071300                               TO TRUE.                           07750000
071400                                                                  07760000
071500*----------------------------------------------------------------*07770000
071600* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *07780000
071700* STORAGE QUEUE PASSED FROM THE LIST.                            *07790000
071800*----------------------------------------------------------------*07800000
071900 1120-PREPARE-LIST-ENTRY.                                         07810000
072000     MOVE MR115-MAX-ITEMS          TO ASC-SEL-SUB.                07820000
072100     MOVE ZERO                     TO ASC-SEL-ITEM                07830000
072200                                      PV-SEL-QUEUE-ITEM.          07840000
072300     PERFORM 1130-GET-NEXT-MESSAGE.                               07850000
072400                                                                  07860000
072500 1130-GET-NEXT-MESSAGE.                                           07870000
072600     ADD +1                        TO ASC-SEL-SUB.                07880000
072700     IF  ASC-SEL-SUB > MR115-MAX-ITEMS                            07890000
072800         ADD +1                    TO PV-SEL-QUEUE-ITEM           07900000
072900         MOVE +1                   TO ASC-SEL-SUB                 07910000
073000     END-IF.                                                      07920000
073100     IF  PV-SEL-QUEUE-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS           07930000
073200         PERFORM 6105-READ-SEL-QUEUE                              07940000
073300         SET MR115-IDX TO ASC-SEL-SUB                             07950000
073400         IF  MR115-ITEM (MR115-IDX) > ZERO                        07960000
073500             MOVE MR115-SKU (MR115-IDX)      TO MR114-SKU         07970080
073620             MOVE MR115-DEPT (MR115-IDX)     TO MR114-DEPT        07980080
073630             MOVE MR115-CLASS (MR115-IDX)    TO MR114-CLASS       07990080
073640             MOVE MR115-SUBCLASS (MR115-IDX) TO MR114-SUBCLASS    08000056
074000             MOVE MR115-PTAG (MR115-IDX)     TO MR114-PTAG        08010080
074200             PERFORM 9200-REWRITE-LIST-QUEUE                      08020000
074300         ELSE                                                     08030000
074400             SUBTRACT +1 FROM ASC-SEL-SUB                         08040000
074500*            --- BOTTOM OF LIST ---                               08050000
074600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08060000
074700             SET DP020-MSG-INFORMATIONAL                          08070000
074800                                   TO TRUE                        08080000
074900         END-IF                                                   08090000
075000     ELSE                                                         08100000
075100         SUBTRACT +1 FROM PV-SEL-QUEUE-ITEM                       08110000
075200         MOVE MR115-MAX-ITEMS      TO ASC-SEL-SUB                 08120000
075300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08130000
075400         SET DP020-MSG-INFORMATIONAL                              08140000
075500                                   TO TRUE                        08150000
075600     END-IF.                                                      08160000
075700 EJECT                                                            08170000
075800 1200-EDIT-COMMAREA.                                              08180000
075801                                                                  08190036
075810     IF MR114-SUBCLASS > SPACE                                    08200005
075820        MOVE MR114-SUBCLASS            TO DP010I-UNEDITED-FIELD   08210005
075830        MOVE LENGTH OF MR114-SUBCLASS  TO DP010I-MAXIMUM-DIGITS   08220005
075840        MOVE ZERO                      TO DP010I-MAXIMUM-DECIMALS 08230005
075850        SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                   08240005
262436        CALL DP010I-NUMERIC-EDIT-ROUTINE                          08251085
262436             USING DP010I-NUMERIC-EDIT-AREA                       08252085
075861        IF  DP010I-ERROR-DETECTED                                 08260005
075863         SET PS-COMMAREA-NOT-VALID      TO TRUE                   08270049
075867* SUBCLASS MUST BE NUMERIC IF IT WAS ENTERED                      08280005
075868            MOVE PC-TSYMSG-02803        TO DP020-MSG-NUMBER       08290081
075875        ELSE                                                      08300005
075876* IF THE USER ENTERED A NUMERIC SCL, THEN THE VALIDATE CALL       08310036
075877* WILL GO DOWN TO THE SCL LEVEL                                   08320036
075878            MOVE DP010I-NUMERIC-FIELD   TO PV-SUBCLASS-NUMBER     08330005
075879            MOVE PV-SUBCLASS-X (2:3)    TO PV-SUBCLASS-X3         08340030
075880            MOVE PV-SUBCLASS-X          TO MR114-SUBCLASS         08350032
075881            MOVE 'SCL'                  TO PV-TYPE                08360030
075882            MOVE MR114-SUBCLASS (2:3)   TO PV-SUBCLASS-X3         08370045
075883        END-IF                                                    08380005
075884     ELSE                                                         08390005
075885* USER DID NOT ENTER A NUMERIC SCL, SO USE %%% IN SCL DB2 FIELD SO08400036
075886* THE VALIDATE CALL REALLY IS ONLY GOING TO THE MCL LEVEL         08410036
075887        MOVE 'MCL'    TO PV-TYPE                                  08420005
075888        MOVE '%%%'    TO PV-SUBCLASS-X3                           08430005
075890     END-IF.                                                      08440005
075892                                                                  08450005
075900     IF  MR114-CLASS     > SPACE                                  08460000
076300         MOVE MR114-CLASS          TO DP010I-UNEDITED-FIELD       08470000
076400         MOVE LENGTH OF MR114-CLASS TO DP010I-MAXIMUM-DIGITS      08480000
076500         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08490000
076600         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08500000
262436         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08511085
262436              USING DP010I-NUMERIC-EDIT-AREA                      08512085
076800         IF  DP010I-ERROR-DETECTED                                08520000
076900             SET PS-COMMAREA-NOT-VALID   TO TRUE                  08530049
077000* MAJOR CLASS MUST BE NUMERIC                                     08540005
077100             MOVE PC-TSYMSG-00692        TO DP020-MSG-NUMBER      08550048
077210        ELSE                                                      08560005
077220            MOVE DP010I-NUMERIC-FIELD   TO PV-CLASS-NUMBER        08570005
077230            MOVE PV-CLASS-X             TO MR114-CLASS            08580028
077240        END-IF                                                    08590005
077250     ELSE                                                         08600005
077252        SET PS-COMMAREA-NOT-VALID   TO TRUE                       08610049
077257* MAJOR CLASS IS REQUIRED                                         08620005
075810        IF MR114-SUBCLASS > SPACE                                 08621084
077258           MOVE PC-TSYMSG-02801 TO DP020-MSG-NUMBER               08630084
              ELSE                                                      08630184
077258           MOVE PC-TSYMSG-00694 TO DP020-MSG-NUMBER               08631084
              END-IF                                                    08632084
077400     END-IF.                                                      08640005
077500                                                                  08650005
079500     IF  MR114-DEPT      > SPACE                                  08660000
079600         MOVE MR114-DEPT           TO DP010I-UNEDITED-FIELD       08670000
079700         MOVE LENGTH OF MR114-DEPT TO DP010I-MAXIMUM-DIGITS       08680000
079800         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08690000
079900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08700000
262436         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08711085
262436              USING DP010I-NUMERIC-EDIT-AREA                      08712085
080100         IF  DP010I-ERROR-DETECTED                                08720000
080210             SET PS-COMMAREA-NOT-VALID  TO TRUE                   08730049
080300*  DEPT MUST BE NUMERIC                                           08740000
080400             MOVE PC-TSYMSG-00690       TO DP020-MSG-NUMBER       08750048
080600         ELSE                                                     08760000
080700             MOVE DP010I-NUMERIC-FIELD TO PV-DEPT-93              08770005
080900             MOVE PV-DEPT-93           TO MR114-DEPT (2:3)        08780030
080910         END-IF                                                   08790005
081000     ELSE                                                         08800000
081010         SET PS-COMMAREA-NOT-VALID     TO TRUE                    08810049
081200*  DEPT AND MAJOR CLASS ARE REQUIRED                              08820005
081300         MOVE PC-TSYMSG-00691  TO DP020-MSG-NUMBER                08830005
081310     END-IF.                                                      08840005
081400                                                                  08850000
081500     IF PS-COMMAREA-VALID                                         08860005
081700         MOVE MR114-DEPT (2:3)        TO PV-DEPT-X3               08870036
081800         MOVE MR114-CLASS (3:2)       TO PV-CLASS-X2              08880036
082100         PERFORM 1300-VALIDATE-DEPT-CLASS                         08890000
082200         IF PS-NO-DEPT-REC                                        08900000
082210            SET PS-COMMAREA-NOT-VALID  TO TRUE                    08910049
082400*  DEPT/CLASS DOES NOT EXIST                                      08920075
082500                MOVE PC-TSYMSG-00110       TO DP020-MSG-NUMBER    08930075
082600         END-IF                                                   08940048
082601     END-IF.                                                      08950048
082602                                                                  08960048
082610******************************************************************08970044
082620* MRNIS-RFC      PREVIOUS   DEPT,CLASS,SKU FROM TSK OF FS         08980044
082630* MRNIS-RFC      CURRENT    DEPT FROM TSKXREF                     08990044
082640* MRNIS-RFC      FUTURE     REMOVE ACCESS TO TSKXREF              09000044
082650******************************************************************09010044
082700 1300-VALIDATE-DEPT-CLASS.                                        09020000
082800                                                                  09030000
082801     PERFORM                                                      09040072
082802         WITH TEST AFTER                                          09050072
082803         VARYING PV-SQL-SUB                                       09060072
082804         FROM 1 BY 1                                              09070072
082805         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        09080072
082806           OR (SQLCODE EQUAL ZERO OR +100)                        09090072
082810                                                                  09100072
082900         EXEC SQL                                                 09110072
083000             SELECT MDSEAR_DKEY                                   09120072
083100               INTO :MDSEAR-DKEY                                  09130072
083200               FROM TMDSEAR                                       09140072
083300               WHERE DEPT_NBR          = :PV-DEPT-X3              09150072
083400                 AND MAJ_CL_NBR        = :PV-CLASS-X2             09160072
083410                 AND SUB_CL_NBR     LIKE :PV-SUBCLASS-X3          09170072
083500                 AND MDSELV_CDE        = :PV-TYPE                 09180072
083600                 AND :PV-PROCESS-DATE-R BETWEEN                   09190072
083700                      STRT_DTE AND END_DTE                        09200072
083800         END-EXEC                                                 09210072
084000                                                                  09220072
084100         EVALUATE TRUE                                            09230072
084200             WHEN SQLCODE = 0                                     09240072
084300             MOVE 'N'                TO PS-NO-DEPT-REC-SW         09250072
084400             WHEN SQLCODE = +100                                  09260072
084500             MOVE 'Y'                TO PS-NO-DEPT-REC-SW         09270072
084600             WHEN SQLCODE = -904                                  09280072
084700             WHEN SQLCODE = -913                                  09290072
084800                  CONTINUE                                        09300072
084900             WHEN SQLWARN0 NOT EQUAL SPACES                       09310072
085000             WHEN SQLCODE NOT EQUAL ZERO                          09320072
085100             MOVE 'Y'                TO PS-NO-DEPT-REC-SW         09330072
085200         END-EVALUATE                                             09340072
085201     END-PERFORM.                                                 09350072
085210                                                                  09360072
085220     IF  PV-SQL-SUB > PC-MAX-RETRIES                              09370072
085230         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    09380072
085240                                 TO DP013-MESSAGE-TEXT (1)        09390072
085250         MOVE SQLCA              TO DP013-SQLCA                   09400072
085260         MOVE 'TSKXREF'          TO DP013-DB2-TABLE-NAME (1)      09410072
085270         SET DP013-DB2-ABEND                                      09420072
085280             DP013-XCTL-DISPLAY-RESTART TO TRUE                   09430072
085290         PERFORM DP013-0000-PROCESS-ABEND                         09440072
085291     END-IF.                                                      09450072
085300                                                                  09460000
085400*----------------------------------------------------------------*09470000
085500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *09480000
085600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *09490000
085700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *09500000
085800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *09510000
085900* FUNCTION KEYS CAN GET THIS FAR.                                *09520000
086000*----------------------------------------------------------------*09530000
086100                                                                  09540000
086200 2000-PROCESS-PANEL.                                              09550000
086300     EVALUATE TRUE                                                09560000
086400         WHEN DP020-SRC-AID = DP016-CLEAR                         09570000
086500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09580000
086600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09590000
086700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09600000
086800                                                                  09610000
086900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    09620000
087000             PERFORM 2050-DELETE-LIST-QUEUE                       09630000
087100             PERFORM 4000-BUILD-INITIAL-PANEL                     09640000
087200                                                                  09650000
087300         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    09660000
087400             PERFORM 2140-DESELECT-ALL-ITEMS                      09670000
087500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09680000
087600                                                                  09690000
087700         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  09700000
087800             PERFORM 2150-SELECT-ALL-ITEMS                        09710000
087900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09720000
088000                                                                  09730000
088100         WHEN OTHER                                               09740000
088200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09750000
088300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09760000
088400             IF  PS-NO-ERROR                                      09770000
088500                 SET DP030-CONTINUE-GO                            09780000
088600                                 TO TRUE                          09790000
088700                 PERFORM 2100-CHECK-FUNCTION-KEY                  09800000
088800             ELSE                                                 09810000
088900                 SET DP030-OVERRIDE-GO                            09820000
089000                                 TO TRUE                          09830000
089100             END-IF                                               09840000
089200     END-EVALUATE.                                                09850000
089300 EJECT                                                            09860000
089400*----------------------------------------------------------------*09870000
089500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09880000
089600*----------------------------------------------------------------*09890000
089700 2050-DELETE-LIST-QUEUE.                                          09900000
089800                                                                  09910000
089900     EXEC CICS                                                    09920000
090000         DELETEQ TS                                               09930000
090100             QUEUE (ASC-LIST-QUEUE-NAME)                          09940000
090200             RESP  (PV-CICS-RESP)                                 09950000
090300     END-EXEC.                                                    09960000
090400                                                                  09970000
090500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09980000
090600        (PV-CICS-RESP = DFHRESP(QIDERR))                          09990000
090700         CONTINUE                                                 10000000
090800     ELSE                                                         10010000
090900         SET DP013-CICS-ABEND      TO TRUE                        10020000
091000         SET DP013-NO-ROLLBACK     TO TRUE                        10030000
091100                                                                  10040000
091200         MOVE '2050-DELETE-LIST-QUEUE'                            10050000
091300                                   TO DP013-PARAGRAPH             10060000
091400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    10070000
091500                                   TO DP013-MESSAGE-TEXT (1)      10080000
091600         PERFORM DP013-0000-PROCESS-ABEND                         10090000
091700     END-IF.                                                      10100000
091800                                                                  10110000
091900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  10120000
092000 EJECT                                                            10130000
092100*----------------------------------------------------------------*10140000
092200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*10150000
092300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *10160000
092400* CICS ARCHITECTURE API.                                         *10170000
092500*----------------------------------------------------------------*10180000
092600 2100-CHECK-FUNCTION-KEY.                                         10190000
092700     EVALUATE TRUE                                                10200000
092800         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  10210000
092900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              10220000
093000                 INITIALIZE MR102-INTER-APPL-COMMAREA             10230000
093100                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                10240000
093200                                TO MR102-NUMBER-OF-SELECTED-ITEMS 10250000
093300                 PERFORM 5000-PREPARE-SEL-QUEUE                   10260000
093400             ELSE                                                 10270000
093500                 SET DP030-OVERRIDE-GO                            10280000
093600                                   TO TRUE                        10290000
093700                 MOVE PC-TSYMSG-00057                             10300000
093800                                   TO DP020-MSG-NUMBER            10310000
093900                 SET DP020-MSG-WARNING                            10320000
094000                                   TO TRUE                        10330000
094100             END-IF                                               10340000
094200                                                                  10350000
094300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10360000
094400             MOVE +1               TO PV-TOP-ITEM                 10370000
094500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10380000
094600                                                                  10390000
094700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10400000
094800             PERFORM 2110-BROWSE-BACKWARD                         10410000
094900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10420000
095000                                                                  10430000
095100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10440000
095200             PERFORM 2120-BROWSE-FORWARD                          10450000
095300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10460000
095400                                                                  10470000
095500         WHEN DP020-SRC-AID = DP016-ENTER                         10480000
095600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10490000
095700             IF  PS-ERROR                                         10500000
095800                 CONTINUE                                         10510000
095900             ELSE                                                 10520000
096000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10530000
096100             END-IF                                               10540000
096200                                                                  10550000
096300         WHEN OTHER                                               10560000
096400             SET DP013-NO-ROLLBACK                                10570000
096500                 DP013-XCTL-DISPLAY-RESTART                       10580000
096600                 DP013-CICS-ABEND  TO TRUE                        10590000
096700             MOVE '2100-CHECK-FUNCTION-KEY'                       10600000
096800                                   TO DP013-PARAGRAPH             10610000
096900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10620000
097000                                   TO DP013-MESSAGE-TEXT (1)      10630000
097100             PERFORM DP013-0000-PROCESS-ABEND                     10640000
097200     END-EVALUATE.                                                10650000
097300*                                                                 10660000
097400*----------------------------------------------------------------*10670000
097500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10680000
097600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10690000
097700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10700000
097800*    MESSAGE.                                                    *10710000
097900*----------------------------------------------------------------*10720000
098000                                                                  10730000
098100 2110-BROWSE-BACKWARD.                                            10740000
098200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10750000
098300         GIVING PV-TOP-ITEM.                                      10760000
098400*                                                                 10770000
098500     IF  ((PV-TOP-ITEM < +1)                                      10780000
098600       OR (PV-TOP-ITEM = +1))                                     10790000
098700         MOVE +1                   TO PV-TOP-ITEM                 10800000
098800*        -- TOP OF LIST --                                        10810000
098900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10820000
099000         SET DP020-MSG-INFORMATIONAL TO TRUE                      10830000
099100     END-IF.                                                      10840000
099200                                                                  10850000
099300 EJECT                                                            10860000
099400*----------------------------------------------------------------*10870000
099500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10880000
099600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10890000
099700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10900000
099800*----------------------------------------------------------------*10910000
099900                                                                  10920000
100000 2120-BROWSE-FORWARD.                                             10930000
100100                                                                  10940000
100200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10950000
100300         GIVING PV-TOP-ITEM.                                      10960000
100400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10970000
100500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10980000
100600                                   TO PV-TOP-ITEM                 10990000
100700*        -- BOTTOM OF LIST --                                     11000000
100800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11010000
100900         SET DP020-MSG-INFORMATIONAL                              11020000
101000                                   TO TRUE                        11030000
101100     ELSE                                                         11040000
101200         COMPUTE PV-BOTTOM-ITEM =                                 11050000
101300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11060000
101400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            11070000
101500*            -- BOTTOM OF LIST --                                 11080000
101600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11090000
101700             SET DP020-MSG-INFORMATIONAL                          11100000
101800                                   TO TRUE                        11110000
101900         END-IF                                                   11120000
102000     END-IF.                                                      11130000
102100 EJECT                                                            11140000
102200*----------------------------------------------------------------*11150000
102300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11160000
102400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11170000
102500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11180000
102600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11190000
102700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11200000
102800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11210000
102900*----------------------------------------------------------------*11220000
103000                                                                  11230000
103100 2130-CHECK-FOR-JUMP-BROWSE.                                      11240000
103200     SET PS-NO-ERROR               TO TRUE.                       11250000
103300     IF (ASC-START-ITEM-REQUEST = SPACE)                          11260000
103400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11270000
103500                                   TO PV-TOP-ITEM                 11280000
103600     ELSE                                                         11290000
103700         MOVE ASC-START-ITEM-REQUEST                              11300000
103800                                   TO DP010I-UNEDITED-FIELD       11310000
103900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11320000
104000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11330000
104100         SET DP010I-NEGATIVE-NOT-ALLOWED                          11340000
104200                                   TO TRUE                        11350000
262436         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11361085
262436              USING DP010I-NUMERIC-EDIT-AREA                      11362085
104400                                                                  11370000
104500         IF  NOT DP010I-ERROR-DETECTED                            11380000
104600             MOVE DP010I-NUMERIC-FIELD                            11390000
104700                                   TO  ASC-START-ITEM-REQUEST-N   11400000
104800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11410000
104900                 IF  ASC-START-ITEM-REQUEST-N >                   11420000
105000                                          ASC-NUMBER-OF-ITEMS-READ11430000
105100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11440000
105200                     COMPUTE PV-TOP-ITEM =                        11450000
105300                             ASC-NUMBER-OF-ITEMS-READ             11460000
105400                             - PC-ITEMS-PER-PANEL + 1             11470000
105500                     IF  PV-TOP-ITEM < +1                         11480000
105600                         MOVE +1   TO PV-TOP-ITEM                 11490000
105700                         MOVE PC-TSYMSG-00070                     11500000
105800                                   TO DP020-MSG-NUMBER            11510000
105900                         SET DP020-MSG-INFORMATIONAL              11520000
106000                                   TO TRUE                        11530000
106100                     END-IF                                       11540000
106200                 ELSE                                             11550000
106300                     MOVE ASC-START-ITEM-REQUEST-N                11560000
106400                                   TO PV-TOP-ITEM                 11570000
106500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11580000
106600                     COMPUTE PV-BOTTOM-ITEM =                     11590000
106700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11600000
106800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11610000
106900*                        -- BOTTOM OF LIST --                     11620000
107000                         MOVE PC-TSYMSG-00070                     11630000
107100                                   TO DP020-MSG-NUMBER            11640000
107200                         SET DP020-MSG-INFORMATIONAL              11650000
107300                                   TO TRUE                        11660000
107400                     END-IF                                       11670000
107500                 END-IF                                           11680000
107600             ELSE                                                 11690000
107700*                --- VALUE OUT OF RANGE ----                      11700000
107800                 MOVE PC-TSYMSG-00101                             11710000
107900                                   TO DP020-MSG-NUMBER            11720000
108000                 MOVE -1           TO ASTRTITL                    11730000
108100                 SET DP030-SET-CURSOR-APPL-1                      11740000
108200                                   TO TRUE                        11750000
108300                 MOVE DP015-REVERSE                               11760000
108400                                   TO ASTRTITH                    11770000
108500                 MOVE DP015-RED    TO ASTRTITC                    11780000
108600                 MOVE DP015-UNP-NUM-BRT-MDT                       11790000
108700                                   TO ASTRTITA                    11800000
108800                 SET DP020-MSG-FATAL                              11810000
108900                                   TO TRUE                        11820000
109000                 SET PS-ERROR      TO TRUE                        11830000
109100             END-IF                                               11840000
109200                                                                  11850000
109300         ELSE                                                     11860000
109400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11870000
109500             MOVE -1               TO ASTRTITL                    11880000
109600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11890000
109700             MOVE DP015-REVERSE    TO ASTRTITH                    11900000
109800             MOVE DP015-RED        TO ASTRTITC                    11910000
109900             MOVE DP015-UNP-NUM-BRT-MDT                           11920000
110000                                   TO ASTRTITA                    11930000
110100             SET DP020-MSG-FATAL   TO TRUE                        11940000
110200             SET PS-ERROR          TO TRUE                        11950000
110300         END-IF                                                   11960000
110400     END-IF.                                                      11970000
110500 EJECT                                                            11980000
110600*----------------------------------------------------------------*11990000
110700*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *12000000
110800*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *12010000
110900*----------------------------------------------------------------*12020000
111000 2140-DESELECT-ALL-ITEMS.                                         12030000
111100     MOVE +1                       TO ASC-BLK-SUB.                12040000
111200                                                                  12050000
111300     PERFORM 2141-CLEAR-SELECTED-INDS                             12060000
111400         VARYING ASC-ITEM-SUB                                     12070000
111500         FROM 1 BY 1                                              12080000
111600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12090000
111700                                                                  12100000
111800     ADD +1                        TO ASC-BLK-SUB.                12110000
111900                                                                  12120000
112000     PERFORM 2141-CLEAR-SELECTED-INDS                             12130000
112100         VARYING ASC-ITEM-SUB                                     12140000
112200         FROM 1 BY 1                                              12150000
112300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12160000
112400                                                                  12170000
112500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12180000
112600                                   TO PV-LIST-ITEM-NUMBER.        12190000
112700                                                                  12200000
112800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12210000
112900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12220000
113000                                                                  12230000
113100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12240000
113200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      12250000
113300         MOVE +1                   TO ASC-BLK-SUB                 12260000
113400                                                                  12270000
113500         PERFORM 5100-WRITE-TEMP-STORAGE                          12280000
113600                                                                  12290000
113700         MOVE +1                   TO PV-BLOCK-NUMBER             12300000
113800                                                                  12310000
113900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12320000
114000             PV-FIRST-BLOCK-IN-ARRAY - 1                          12330000
114100                                                                  12340000
114200         PERFORM                                                  12350000
114300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12360000
114400                                                                  12370000
114500             PERFORM 4410-READ-TEMP-STORAGE                       12380000
114600                                                                  12390000
114700             PERFORM 2141-CLEAR-SELECTED-INDS                     12400000
114800                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12410000
114900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12420000
115000                                                                  12430000
115100             PERFORM 5100-WRITE-TEMP-STORAGE                      12440000
115200                                                                  12450000
115300             ADD +1                TO PV-BLOCK-NUMBER             12460000
115400                                                                  12470000
115500         END-PERFORM                                              12480000
115600                                                                  12490000
115700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12500000
115800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12510000
115900                                                                  12520000
116000         PERFORM                                                  12530000
116100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12540000
116200                   ASC-HIGHEST-BLOCK-WRITTEN                      12550000
116300                                                                  12560000
116400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12570000
116500                                   TO PV-BLOCK-NUMBER             12580000
116600                                                                  12590000
116700             PERFORM 4410-READ-TEMP-STORAGE                       12600000
116800                                                                  12610000
116900             PERFORM 2141-CLEAR-SELECTED-INDS                     12620000
117000                 VARYING ASC-ITEM-SUB                             12630000
117100                 FROM 1 BY 1                                      12640000
117200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12650000
117300                                                                  12660000
117400             PERFORM 5100-WRITE-TEMP-STORAGE                      12670000
117500                                                                  12680000
117600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12690000
117700                                                                  12700000
117800         END-PERFORM                                              12710000
117900                                                                  12720000
118000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12730000
118100                                   TO PV-BLOCK-NUMBER             12740000
118200                                                                  12750000
118300         PERFORM 4410-READ-TEMP-STORAGE                           12760000
118400     END-IF.                                                      12770000
118500                                                                  12780000
118600                                                                  12790000
118700     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 12800000
118800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.12810000
118900     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  12820000
119000                                                                  12830000
119100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12840000
119200                                                                  12850000
119300 EJECT                                                            12860000
119400*----------------------------------------------------------------*12870000
119500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12880000
119600*----------------------------------------------------------------*12890000
119700                                                                  12900000
119800 2141-CLEAR-SELECTED-INDS.                                        12910000
119900                                                                  12920000
120000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12930000
120100             NOT EQUAL ZERO                                       12940000
120200         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12950000
120300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12960000
120400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12970000
120500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12980000
120600                                   TO TRUE                        12990000
120700         END-IF                                                   13000000
120800     END-IF.                                                      13010000
120900                                                                  13020000
121000 EJECT                                                            13030000
121100*----------------------------------------------------------------*13040000
121200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *13050000
121300*  FOR ALL ITEMS.                                                *13060000
121400*----------------------------------------------------------------*13070000
121500                                                                  13080000
121600 2150-SELECT-ALL-ITEMS.                                           13090000
121700                                                                  13100000
121800     MOVE +1                       TO ASC-BLK-SUB.                13110000
121900                                                                  13120000
122000     PERFORM 2151-SET-SELECTED-INDS                               13130000
122100         VARYING ASC-ITEM-SUB                                     13140000
122200         FROM 1 BY 1                                              13150000
122300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13160000
122400                                                                  13170000
122500     ADD +1                        TO ASC-BLK-SUB.                13180000
122600                                                                  13190000
122700     PERFORM 2151-SET-SELECTED-INDS                               13200000
122800         VARYING ASC-ITEM-SUB                                     13210000
122900         FROM 1 BY 1                                              13220000
123000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13230000
123100                                                                  13240000
123200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13250000
123300                                   TO PV-LIST-ITEM-NUMBER.        13260000
123400                                                                  13270000
123500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13280000
123600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13290000
123700                                                                  13300000
123800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13310000
123900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13320000
124000         MOVE +1                   TO ASC-BLK-SUB                 13330000
124100                                                                  13340000
124200         PERFORM 5100-WRITE-TEMP-STORAGE                          13350000
124300                                                                  13360000
124400         MOVE +1                   TO PV-BLOCK-NUMBER             13370000
124500                                                                  13380000
124600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13390000
124700             PV-FIRST-BLOCK-IN-ARRAY - 1                          13400000
124800                                                                  13410000
124900         PERFORM                                                  13420000
125000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13430000
125100                                                                  13440000
125200             PERFORM 4410-READ-TEMP-STORAGE                       13450000
125300                                                                  13460000
125400             PERFORM 2151-SET-SELECTED-INDS                       13470000
125500                 VARYING ASC-ITEM-SUB                             13480000
125600                 FROM 1 BY 1                                      13490000
125700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13500000
125800                                                                  13510000
125900             PERFORM 5100-WRITE-TEMP-STORAGE                      13520000
126000                                                                  13530000
126100             ADD +1                TO PV-BLOCK-NUMBER             13540000
126200                                                                  13550000
126300         END-PERFORM                                              13560000
126400                                                                  13570000
126500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13580000
126600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13590000
126700                                                                  13600000
126800         PERFORM                                                  13610000
126900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13620000
127000                   ASC-HIGHEST-BLOCK-WRITTEN                      13630000
127100                                                                  13640000
127200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13650000
127300                                   TO PV-BLOCK-NUMBER             13660000
127400                                                                  13670000
127500             PERFORM 4410-READ-TEMP-STORAGE                       13680000
127600                                                                  13690000
127700             PERFORM 2151-SET-SELECTED-INDS                       13700000
127800                 VARYING ASC-ITEM-SUB                             13710000
127900                 FROM 1 BY 1                                      13720000
128000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13730000
128100                                                                  13740000
128200             PERFORM 5100-WRITE-TEMP-STORAGE                      13750000
128300                                                                  13760000
128400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13770000
128500                                                                  13780000
128600         END-PERFORM                                              13790000
128700                                                                  13800000
128800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13810000
128900                                   TO PV-BLOCK-NUMBER             13820000
129000                                                                  13830000
129100         PERFORM 4410-READ-TEMP-STORAGE                           13840000
129200     END-IF.                                                      13850000
129300                                                                  13860000
129400                                                                  13870000
129500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13880000
129600                       ASC-NUMBER-OF-SELECTED-ITEMS.              13890000
129700                                                                  13900000
129800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13910000
129900                                                                  13920000
130000 EJECT                                                            13930000
130100*----------------------------------------------------------------*13940000
130200*    MARK EACH ITEM AS BEING SELECTED.                           *13950000
130300*----------------------------------------------------------------*13960000
130400                                                                  13970000
130500 2151-SET-SELECTED-INDS.                                          13980000
130600                                                                  13990000
130700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           14000000
130800             NOT EQUAL ZERO                                       14010000
130900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14020000
131000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14030000
131100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        14040000
131200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  14050000
131300                               TO  TRUE                           14060000
131400         END-IF                                                   14070000
131500     END-IF.                                                      14080000
136300******************************************************************14090000
136400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **14100000
136500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **14110000
136600******************************************************************14120000
136700 2200-MOVE-SCREEN-TO-COMMAREA.                                    14130000
136800                                                                  14140000
136900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             14150000
137000     MOVE +1                       TO PV-SUB.                     14160000
137100*                                                                 14170000
137200     PERFORM 3100-SET-SUBSCRIPTS.                                 14180000
137300     IF  ASTRTITL > ZERO                                          14190000
137400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          14200000
137500     ELSE                                                         14210000
137600         IF  ASTRTITF = DP015-ERASE-EOF                           14220000
137700             INITIALIZE ASC-START-ITEM-REQUEST                    14230000
137800         END-IF                                                   14240000
137900     END-IF.                                                      14250000
138000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14260000
138100         VARYING PV-SUB                                           14270000
138200         FROM 1 BY 1                                              14280000
138300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14290000
138400******************************************************************14300000
138500** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**14310000
138600******************************************************************14320000
138700 2210-MOVE-LINES-TO-COMMAREA.                                     14330000
138800     IF  MR-SELECTL (PV-SUB) > ZERO                               14340000
138900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14350000
139000         MOVE MR-SELECTI (PV-SUB)                                 14360000
139100                                   TO ASC-TEMP-SELECTED-SW        14370000
139200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14380000
139300     ELSE                                                         14390000
139400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14400000
139500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14410000
139600                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        14420000
139700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14430000
139800         END-IF                                                   14440000
139900     END-IF.                                                      14450000
140000     ADD +1                        TO ASC-ITEM-SUB.               14460000
140100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14470000
140200         ADD +1                    TO ASC-BLK-SUB                 14480000
140300         MOVE +1                   TO ASC-ITEM-SUB                14490000
140400     END-IF.                                                      14500000
140500******************************************************************14510000
140600** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **14520000
140700** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **14530000
140800******************************************************************14540000
140900 3000-EDIT-DATA-IN-COMMAREA.                                      14550000
141000     SET PS-NO-ERROR               TO TRUE.                       14560000
141100     PERFORM 3200-RESET-ATTRIBUTES.                               14570000
141200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14580000
141300**                                                                14590000
141400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14600000
141500* EDITTING IS DONE FROM THE BOTTOM UP.                            14610000
141600**                                                                14620000
141700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14630000
141800         ASC-ITEMS-DISPLAYED - 1.                                 14640000
141900     PERFORM 3100-SET-SUBSCRIPTS.                                 14650000
142000     PERFORM 3300-EDIT-SELECTIONS                                 14660000
142100         VARYING PV-SUB                                           14670000
142200         FROM PV-SUB BY -1                                        14680000
142300         UNTIL PV-SUB < +1                                        14690000
142400*                                                                 14700000
142500     IF  PS-NO-ERROR                                              14710000
142600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14720000
142700     END-IF.                                                      14730000
142800*                                                                 14740000
142900     IF  ((PS-NO-ERROR)                                           14750000
143000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14760000
143100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14770000
143200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14780000
143300     END-IF.                                                      14790000
143400 EJECT                                                            14800000
143500*----------------------------------------------------------------*14810000
143600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14820000
143700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14830000
143800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14840000
143900*                                                                *14850000
144000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14860000
144100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14870000
144200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14880000
144300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14890000
144400*----------------------------------------------------------------*14900000
144500                                                                  14910000
144600 3100-SET-SUBSCRIPTS.                                             14920000
144700                                                                  14930000
144800     COMPUTE ASC-ITEM-SUB =                                       14940000
144900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14950000
145000                                                                  14960000
145100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14970000
145200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14980000
145300                                                                  14990000
145400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15000000
145500     ELSE                                                         15010000
145600         MOVE +1                     TO ASC-BLK-SUB               15020000
145700     END-IF.                                                      15030000
145800******************************************************************15040000
145900** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **15050000
146000******************************************************************15060000
146100                                                                  15070000
146200 3200-RESET-ATTRIBUTES.                                           15080000
146300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   15090000
146400     MOVE DP015-GREEN              TO ASTRTITC.                   15100000
146500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15110000
146600*                                                                 15120000
146700     PERFORM                                                      15130000
146800         VARYING PV-SUB                                           15140000
146900         FROM 1 BY 1                                              15150000
147000         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15160000
147100         MOVE DP015-UNP-ALP-NOR-OFF                               15170000
147200                                   TO MR-SELECTA (PV-SUB)         15180000
147300         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         15190000
147400         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         15200000
147500     END-PERFORM.                                                 15210000
147600******************************************************************15220000
147700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **15230000
147800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **15240000
147900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **15250000
148000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **15260000
148100******************************************************************15270000
148200 3300-EDIT-SELECTIONS.                                            15280000
148300     EVALUATE TRUE                                                15290000
148400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15300000
148500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15310000
148600                 CONTINUE                                         15320000
148700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15330000
148800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15340000
148900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   15350000
149000                 MOVE ASC-TEMP-SELECTED-SW                        15360000
149100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15370000
149200                                TO ASC-SELECTED-SW                15380000
149300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15390000
149400             END-IF                                               15400000
149500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15410000
149600                 = SPACE                                          15420000
149700             EVALUATE TRUE                                        15430000
149800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15440000
149900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15450000
150000                     MOVE SPACE TO ASC-SELECTED-SW                15460000
150100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15470000
150200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15480000
150300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15490000
150400                     MOVE SPACE TO ASC-SELECTED-SW                15500000
150500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15510000
150600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15520000
150700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15530000
150800                     MOVE SPACE TO ASC-SELECTED-SW                15540000
150900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15550000
151000             END-EVALUATE                                         15560000
151100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15570000
151200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15580000
151300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15590000
151400             END-IF                                               15600000
151500             PERFORM 3310-EDIT-RANGE                              15610000
151600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15620000
151700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15630000
151800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15640000
151900             END-IF                                               15650000
152000             PERFORM 3310-EDIT-RANGE                              15660000
152100         WHEN OTHER                                               15670000
152200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15680000
152300             SET DP020-MSG-FATAL    TO TRUE                       15690000
152400             MOVE -1                TO MR-SELECTL (PV-SUB)        15700000
152500             SET DP030-SET-CURSOR-APPL-1                          15710000
152600                                    TO TRUE                       15720000
152700             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15730000
152800             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15740000
152900             SET PS-ERROR TO TRUE                                 15750000
153000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15760000
153100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15770000
153200                 MOVE SPACE         TO ASC-SELECTED-SW            15780000
153300                                        (ASC-BLK-SUB ASC-ITEM-SUB)15790000
153400             END-IF                                               15800000
153500     END-EVALUATE.                                                15810000
153600                                                                  15820000
153700     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15830000
153800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15840000
153900     IF  ASC-ITEM-SUB < 1                                         15850000
154000         SUBTRACT +1 FROM ASC-BLK-SUB                             15860000
154100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15870000
154200     END-IF.                                                      15880000
154300******************************************************************15890000
154400** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **15900000
154500** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **15910000
154600** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**15920000
154700** THE ENDING.                                                  **15930000
154800******************************************************************15940000
154900 3310-EDIT-RANGE.                                                 15950000
155000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15960000
155100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15970000
155200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15980000
155300                                   TO ASC-SELECTED-SW             15990000
155400                                        (ASC-BLK-SUB ASC-ITEM-SUB)16000000
155500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16010000
155600         ELSE                                                     16020000
155700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16030000
155800                 CONTINUE                                         16040000
155900             ELSE                                                 16050000
156000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16060000
156100                 MOVE PC-TSYMSG-00054                             16070000
156200                                   TO DP020-MSG-NUMBER            16080000
156300                 SET DP020-MSG-FATAL                              16090000
156400                                   TO TRUE                        16100000
156500                 MOVE -1           TO MR-SELECTL (PV-SUB)         16110000
156600                 SET DP030-SET-CURSOR-APPL-1                      16120000
156700                                   TO TRUE                        16130000
156800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         16140000
156900                 MOVE DP015-UNDERLINE                             16150000
157000                                   TO MR-SELECTH (PV-SUB)         16160000
157100                 SET PS-ERROR      TO TRUE                        16170000
157200             END-IF                                               16180000
157300         END-IF                                                   16190000
157400     ELSE                                                         16200000
157500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16210000
157600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16220000
157700                                   TO ASC-SELECTED-SW             16230000
157800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16240000
157900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16250000
158000         ELSE                                                     16260000
158100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16270000
158200                 CONTINUE                                         16280000
158300             ELSE                                                 16290000
158400*                -- ONLY ONE END-OF-RANGE ALLOWED --              16300000
158500                 MOVE PC-TSYMSG-00055                             16310000
158600                                   TO DP020-MSG-NUMBER            16320000
158700                 SET DP020-MSG-FATAL                              16330000
158800                                   TO TRUE                        16340000
158900                 MOVE -1           TO MR-SELECTL (PV-SUB)         16350000
159000                 SET DP030-SET-CURSOR-APPL-1                      16360000
159100                                   TO TRUE                        16370000
159200                 SET PS-ERROR      TO TRUE                        16380000
159300             END-IF                                               16390000
159400         END-IF                                                   16400000
159500     END-IF.                                                      16410000
159600*                                                                 16420000
159700******************************************************************16430000
159800** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **16440000
159900** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **16450000
160000******************************************************************16460000
160100 3400-CHECK-RANGE-SEQUENCE.                                       16470000
160200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16480000
160300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16490000
160400       AND  ASC-START-OF-SELECTED-RANGE >                         16500000
160500                                         ASC-END-OF-SELECTED-RANGE16510000
160600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16520000
160700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16530000
160800         SET DP020-MSG-FATAL TO TRUE                              16540000
160900         SET PS-ERROR TO TRUE                                     16550000
161000         PERFORM 3410-POSITION-AT-ERROR                           16560000
161100     END-IF.                                                      16570000
161200******************************************************************16580000
161300** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **16590000
161400** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **16600000
161500** SHOULD BE POSITIONED ON A RANGE ERROR.                       **16610000
161600******************************************************************16620000
161700 3410-POSITION-AT-ERROR.                                          16630000
161800     SET DP030-SET-CURSOR-APPL-1                                  16640000
161900                                   TO TRUE.                       16650000
162000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16660000
162100                    - PV-TOP-ITEM + 1.                            16670000
162200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16680000
162300         CONTINUE                                                 16690000
162400     ELSE                                                         16700000
162500         MOVE -1                   TO MR-SELECTL (PV-SUB)         16710000
162600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16720000
162700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16730000
162800     END-IF.                                                      16740000
162900*                                                                 16750000
163000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16760000
163100                    - PV-TOP-ITEM + 1.                            16770000
163200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16780000
163300         CONTINUE                                                 16790000
163400     ELSE                                                         16800000
163500         MOVE -1                   TO MR-SELECTL (PV-SUB)         16810000
163600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16820000
163700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16830000
163800     END-IF.                                                      16840000
163900 EJECT                                                            16850000
164000*----------------------------------------------------------------*16860000
164100*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16870000
164200*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16880000
164300*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16890000
164400*----------------------------------------------------------------*16900000
164500                                                                  16910000
164600 3500-MARK-RANGE-AS-SELECTED.                                     16920000
164700     MOVE +1                       TO  ASC-BLK-SUB.               16930000
164800     PERFORM 3510-MARK-SELECTED-INDS                              16940000
164900         VARYING ASC-ITEM-SUB                                     16950000
165000         FROM 1 BY 1                                              16960000
165100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16970000
165200                                                                  16980000
165300     ADD +1                        TO ASC-BLK-SUB.                16990000
165400     PERFORM 3510-MARK-SELECTED-INDS                              17000000
165500         VARYING ASC-ITEM-SUB                                     17010000
165600         FROM 1 BY 1                                              17020000
165700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17030000
165800                                                                  17040000
165900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17050000
166000                                   TO  PV-LIST-ITEM-NUMBER.       17060000
166100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17070000
166200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17080000
166300               PC-ITEMS-PER-PANEL).                               17090000
166400                                                                  17100000
166500     MOVE ASC-START-OF-SELECTED-RANGE                             17110000
166600                                   TO PV-START-OF-SELECTED-RANGE. 17120000
166700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17130000
166800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17140000
166900               PC-ITEMS-PER-PANEL).                               17150000
167000                                                                  17160000
167100     MOVE ASC-END-OF-SELECTED-RANGE                               17170000
167200                                   TO  PV-END-OF-SELECTED-RANGE.  17180000
167300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17190000
167400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17200000
167500               PC-ITEMS-PER-PANEL).                               17210000
167600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17220000
167700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17230000
167800                                                                  17240000
167900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17250000
168000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17260000
168100         MOVE +1                   TO ASC-BLK-SUB                 17270000
168200         PERFORM 5100-WRITE-TEMP-STORAGE                          17280000
168300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17290000
168400             PV-FIRST-BLOCK-IN-ARRAY - 1                          17300000
168500                                                                  17310000
168600         PERFORM                                                  17320000
168700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17330000
168800                   PV-PREV-BLOCK-IN-ARRAY                         17340000
168900             MOVE PV-FIRST-BLOCK-IN-RANGE                         17350000
169000                                   TO PV-BLOCK-NUMBER             17360000
169100             PERFORM 4410-READ-TEMP-STORAGE                       17370000
169200             PERFORM 3510-MARK-SELECTED-INDS                      17380000
169300                 VARYING ASC-ITEM-SUB                             17390000
169400                 FROM 1 BY 1                                      17400000
169500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17410000
169600             PERFORM 5100-WRITE-TEMP-STORAGE                      17420000
169700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17430000
169800         END-PERFORM                                              17440000
169900                                                                  17450000
170000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17460000
170100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17470000
170200         PERFORM                                                  17480000
170300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17490000
170400                   PV-LAST-BLOCK-IN-RANGE                         17500000
170500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17510000
170600                                   TO PV-BLOCK-NUMBER             17520000
170700             PERFORM 4410-READ-TEMP-STORAGE                       17530000
170800             PERFORM 3510-MARK-SELECTED-INDS                      17540000
170900                 VARYING ASC-ITEM-SUB                             17550000
171000                 FROM 1 BY 1                                      17560000
171100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17570000
171200             PERFORM 5100-WRITE-TEMP-STORAGE                      17580000
171300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17590000
171400         END-PERFORM                                              17600000
171500                                                                  17610000
171600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17620000
171700                                   TO PV-BLOCK-NUMBER             17630000
171800         PERFORM 4410-READ-TEMP-STORAGE                           17640000
171900     END-IF.                                                      17650000
172000                                                                  17660000
172100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17670000
172200                                      ASC-END-OF-SELECTED-RANGE.  17680000
172300                                                                  17690000
172400 EJECT                                                            17700000
172500*----------------------------------------------------------------*17710000
172600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17720000
172700*----------------------------------------------------------------*17730000
172800                                                                  17740000
172900 3510-MARK-SELECTED-INDS.                                         17750000
173000                                                                  17760000
173100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17770000
173200                                ASC-ITEM-SUB) >                   17780000
173300         ASC-START-OF-SELECTED-RANGE)                             17790000
173400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17800000
173500                                ASC-ITEM-SUB) =                   17810000
173600         ASC-START-OF-SELECTED-RANGE)                             17820000
173700                                                                  17830000
173800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17840000
173900                                    ASC-ITEM-SUB) <               17850000
174000             ASC-END-OF-SELECTED-RANGE)                           17860000
174100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17870000
174200                                    ASC-ITEM-SUB) =               17880000
174300             ASC-END-OF-SELECTED-RANGE)                           17890000
174400                                                                  17900000
174500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17910000
174600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17920000
174700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17930000
174800                               TO TRUE                            17940000
174900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17950000
175000                               TO TRUE                            17960000
175100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17970000
175200             END-IF                                               17980000
175300         END-IF                                                   17990000
175400     END-IF.                                                      18000000
175500                                                                  18010000
175600 EJECT                                                            18020000
175700*----------------------------------------------------------------*18030000
175800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18040000
175900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18050000
176000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18060000
176100*    DISPLAY THE PANEL TO USER.                                  *18070000
176200*----------------------------------------------------------------*18080000
176300                                                                  18090000
176400 4000-BUILD-INITIAL-PANEL.                                        18100000
176500                                                                  18110000
176600     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            18120000
176700                                 ASC-BLOCK-ENTRIES (2).           18130000
176800     MOVE +1                 TO ASC-BLK-SUB.                      18140000
176900     SET ASC-ITEMS-LEFT-ON-DB                                     18150000
177000                             TO TRUE.                             18160000
177100                                                                  18170000
177200     MOVE +0                 TO ASC-ITEM-SUB                      18180000
177300                                ASC-NUMBER-OF-ITEMS-READ          18190000
177400                                ASC-NUMBER-OF-SELECTED-ITEMS      18200000
177500                                ASC-HIGHEST-BLOCK-WRITTEN         18210000
177600                                ASC-START-OF-SELECTED-RANGE       18220000
177700                                ASC-END-OF-SELECTED-RANGE         18230000
177800                                ASC-ITEM-AT-TOP-OF-PANEL.         18240000
177900     PERFORM 4100-PREPARE-CURSOR                                  18250000
178000                                                                  18260000
178100     PERFORM 4010-OPEN-CURSOR.                                    18270000
178200                                                                  18280000
178300     PERFORM 4300-READ-ITEMS-FROM-DB.                             18290000
178400                                                                  18300000
178500     PERFORM 4020-CLOSE-CURSOR.                                   18310000
178600                                                                  18320000
178700     MOVE +1                   TO  PV-TOP-ITEM.                   18330000
178800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18340000
178900         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    18350000
179000         SET DP020-MSG-FATAL   TO  TRUE                           18360000
179100         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               18370060
179200     ELSE                                                         18380000
179300         MOVE -1               TO MR-SELECTL (1)                  18390000
179400         SET DP030-SET-CURSOR-APPL-1                              18400000
179500                               TO TRUE                            18410000
179600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18420000
179700     END-IF.                                                      18430000
179800 EJECT                                                            18440000
179900*----------------------------------------------------------------*18450000
180100*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *18460040
180200*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *18470000
180300*   USER.                                                        *18480000
180400*----------------------------------------------------------------*18490000
180500                                                                  18500000
180600 4010-OPEN-CURSOR.                                                18510000
180700     PERFORM                                                      18520000
180800         WITH TEST AFTER                                          18530000
180900         VARYING PV-RETRY-COUNTER                                 18540000
181000         FROM 1 BY 1                                              18550000
181100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18560000
181200                   OR (SQLCODE = ZERO))                           18570000
181300         IF PS-USE-WILDCARD                                       18580000
181400             EXEC SQL                                             18590000
181500                  OPEN PTAG-BY-SKU2                               18600000
181600             END-EXEC                                             18610000
181700         ELSE                                                     18620000
181800             EXEC SQL                                             18630000
181900                  OPEN PTAG-BY-SKU1                               18640000
182000             END-EXEC                                             18650000
182100         END-IF                                                   18660000
182200                                                                  18670000
182300         EVALUATE TRUE                                            18680000
182400             WHEN SQLCODE = ZERO                                  18690000
182500             WHEN SQLCODE = -904                                  18700000
182600             WHEN SQLCODE = -913                                  18710000
182700                 CONTINUE                                         18720000
182800             WHEN SQLWARN0 NOT = SPACES                           18730000
182900             WHEN SQLCODE < ZERO                                  18740000
183000             WHEN SQLCODE > ZERO                                  18750000
183100                 MOVE '4010-OPEN-CURSOR'                          18760000
183200                                   TO DP013-PARAGRAPH             18770000
183300                 MOVE 'OPEN PTAG BY SKU CURSOR    - '             18780070
183400                                   TO DP013-MESSAGE-TEXT (1)      18790000
183500                 MOVE SQLCA        TO DP013-SQLCA                 18800000
183600                 MOVE 'TSKXREF '   TO DP013-DB2-TABLE-NAME (1)    18810072
183700                 SET DP013-DB2-ABEND                              18820000
183800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18830000
183900                 PERFORM DP013-0000-PROCESS-ABEND                 18840000
184000         END-EVALUATE                                             18850000
184100     END-PERFORM.                                                 18860000
184200*                                                                 18870000
184300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18880000
184400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             18890000
184500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   18900000
184600                                   TO DP013-MESSAGE-TEXT (1)      18910000
184700         MOVE SQLCA                TO DP013-SQLCA                 18920000
184800         MOVE 'TSKXREF '           TO DP013-DB2-TABLE-NAME (1)    18930072
184900         SET DP013-DB2-ABEND                                      18940000
185000             DP013-XCTL-DISPLAY-RESTART                           18950000
185100                                   TO TRUE                        18960000
185200         PERFORM DP013-0000-PROCESS-ABEND                         18970000
185300     END-IF.                                                      18980000
185400                                                                  18990000
185500 EJECT                                                            19000000
185600*----------------------------------------------------------------*19010000
185800*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *19020040
185900*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *19030000
186000*   USER.                                                        *19040000
186100*----------------------------------------------------------------*19050000
186200                                                                  19060000
186300 4020-CLOSE-CURSOR.                                               19070000
186400                                                                  19080000
186500     IF PS-USE-WILDCARD                                           19090000
186600         EXEC SQL                                                 19100000
186700              CLOSE PTAG-BY-SKU2                                  19110000
186800         END-EXEC                                                 19120000
186900     ELSE                                                         19130000
187000         EXEC SQL                                                 19140000
187100              CLOSE PTAG-BY-SKU1                                  19150000
187200         END-EXEC                                                 19160000
187300     END-IF.                                                      19170000
187400*                                                                 19180000
187500     EVALUATE TRUE                                                19190000
187600         WHEN SQLCODE = ZERO                                      19200000
187700             CONTINUE                                             19210000
187800         WHEN SQLWARN0 NOT = SPACES                               19220000
187900         WHEN SQLCODE < ZERO                                      19230000
188000         WHEN SQLCODE > ZERO                                      19240000
188100             MOVE '4020-CLOSE-CURSOR'                             19250000
188200                               TO DP013-PARAGRAPH                 19260000
188300             MOVE 'CLOSE PTAG BY SKU CURSOR    '                  19270070
188400                               TO DP013-MESSAGE-TEXT (1)          19280000
188500             MOVE SQLCA        TO DP013-SQLCA                     19290000
188600             MOVE 'TSKXREF '   TO DP013-DB2-TABLE-NAME (1)        19300072
188700             SET DP013-DB2-ABEND                                  19310000
188800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19320000
188900             PERFORM DP013-0000-PROCESS-ABEND                     19330000
189000     END-EVALUATE.                                                19340000
189100                                                                  19350000
189200 EJECT                                                            19360000
189300*----------------------------------------------------------------*19370000
189400*    SET UP THE HOST VARIABLES.                                  *19380000
189500*----------------------------------------------------------------*19390000
189600                                                                  19400000
189700 4100-PREPARE-CURSOR.                                             19410000
189800                                                                  19420000
189900     MOVE ASC-KEY-DEPT-N              TO PV-DEPT-NUMBER-S.        19430080
190100     MOVE ASC-KEY-CLASS-N             TO PV-CLASS-NUMBER-S.       19440080
190800     MOVE ASC-KEY-SUBCLASS-N          TO PV-SUBCLASS-NUMBER-S.    19450080
190810     MOVE ASC-KEY-SKU-N               TO PV-SKU-NUMBER-S.         19460080
190900     MOVE ASC-KEY-PTAG                TO PV-PTAG.                 19470000
190910                                                                  19480006
190920     IF ASC-KEY-SUBCLASS > 0                                      19490043
190921        CONTINUE                                                  19500042
190922     ELSE                                                         19510042
190923* THIS INDICATES THAT THE CURSOR SHOULD MATCH ONLY ON MAJOR CLASS 19520050
190930        SET PS-USE-WILDCARD  TO TRUE                              19530006
190940     END-IF.                                                      19540006
191000                                                                  19550000
191100 EJECT                                                            19560000
191200*----------------------------------------------------------------*19570000
191300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19580000
191400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19590000
191500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19600000
191600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19610000
191700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19620000
191800*                                                                *19630000
191900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19640000
192000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19650000
192100*    UPON INITIALIZATION.                                        *19660000
192200*----------------------------------------------------------------*19670000
192400 4300-READ-ITEMS-FROM-DB.                                         19680000
192500                                                                  19690000
192600     PERFORM                                                      19700000
192700         VARYING PV-READ-COUNT                                    19710000
192800         FROM 1 BY 1                                              19720000
192900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19730000
193000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19740000
193100                                                                  19750000
193200         PERFORM 4310-FETCH                                       19760000
193300                                                                  19770000
193400         IF  ASC-ITEMS-LEFT-ON-DB                                 19780000
193500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19790000
193600                 ADD +1            TO ASC-ITEM-SUB                19800000
193700             ELSE                                                 19810000
193800                 ADD +1            TO ASC-BLK-SUB                 19820000
193900                 MOVE +1           TO ASC-ITEM-SUB                19830000
194000                                                                  19840000
194100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19850000
194200                     MOVE +1       TO ASC-BLK-SUB                 19860000
194300                     SET ASC-BLOCK-MODIFIED (1)                   19870000
194400                                   TO TRUE                        19880000
194500                     PERFORM 5100-WRITE-TEMP-STORAGE              19890000
194600                     MOVE ASC-BLOCK-ENTRIES                       19900000
194700                               (PC-MAX-BLOCKS-IN-ARRAY)           19910000
194800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19920000
194900                     ADD +1        TO ASC-BLK-SUB                 19930000
195000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19940000
195100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19950000
195200                                   TO TRUE                        19960000
195300                 END-IF                                           19970000
195400             END-IF                                               19980000
195500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    19990000
195600             MOVE ASC-NUMBER-OF-ITEMS-READ                        20000000
195700                                   TO ASC-LIST-ITEM-NUMBER        20010000
195800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20020000
195900             MOVE MRITST-PTAG-ID   TO  ASC-PTAG                   20030000
196000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20040000
196100             MOVE SKXREF-DEPT      TO  ASC-DEPT                   20050034
196110                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20060035
196200             MOVE SKXREF-CLASS     TO  ASC-CLASS                  20070034
196210                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20080035
196300             MOVE SKXREF-SUBCLASS  TO  ASC-SUBCLASS               20090034
196310                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20100035
196400             MOVE SKXREF-SKU       TO  ASC-SKU                    20110034
196500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20120000
196600             MOVE TSK-SKU-DESC     TO  ASC-DESCRIPTION            20130000
196700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20140000
196800             MOVE TSK-SIZE-DESC    TO  ASC-SIZE                   20150000
196900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20160000
197000             MOVE TSK-COLOR-DESC   TO  ASC-COLOR                  20170000
197100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20180000
197200         END-IF                                                   20190000
197300     END-PERFORM.                                                 20200000
197400                                                                  20210000
197500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20220000
197600         MOVE +1               TO ASC-BLK-SUB                     20230000
197700         PERFORM 5100-WRITE-TEMP-STORAGE                          20240000
197800         ADD +1                TO ASC-BLK-SUB                     20250000
197900         PERFORM 5100-WRITE-TEMP-STORAGE                          20260000
198000                                                                  20270000
198100         MOVE 1                TO ASC-BLK-SUB                     20280000
198200                                  PV-BLOCK-NUMBER                 20290000
198300         PERFORM 4410-READ-TEMP-STORAGE                           20300000
198400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20310000
198500             MOVE 2            TO ASC-BLK-SUB                     20320000
198600                                  PV-BLOCK-NUMBER                 20330000
198700             PERFORM 4410-READ-TEMP-STORAGE                       20340000
198800         END-IF                                                   20350000
198900     END-IF.                                                      20360000
199000 EJECT                                                            20370000
199310******************************************************************20380044
199320* MRNIS-RFC   PREVIOUS   DEPT, CLASS, SKU FROM TSK OF FS          20390044
199330* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  20400044
199340* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 20410044
199350******************************************************************20420044
199400                                                                  20430000
199500 4310-FETCH.                                                      20440000
199600                                                                  20450000
199601     PERFORM                                                      20460071
199602         WITH TEST AFTER                                          20470071
199603         VARYING PV-SQL-SUB                                       20480071
199604         FROM 1 BY 1                                              20490071
199605         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        20500071
199606           OR (SQLCODE EQUAL ZERO OR +100)                        20510071
199610                                                                  20520071
199620                                                                  20530071
199700         IF PS-USE-WILDCARD                                       20540071
199800            EXEC SQL                                              20550071
199900              FETCH PTAG-BY-SKU2                                  20560000
200000              INTO                                                20570000
200100                    :MRITST-PTAG-ID                               20580000
200200                  , :SKXREF-DEPT                                  20590003
200300                  , :SKXREF-CLASS                                 20600003
200400                  , :SKXREF-SUBCLASS                              20610003
200410                  , :SKXREF-SKU                                   20620003
200500                  , :TSK-SKU-DESC                                 20630000
200600                  , :TSK-SIZE-DESC                                20640000
200700                  , :TSK-COLOR-DESC                               20650000
200800                  , :MRITST-ITEM-NBR                              20660000
200900            END-EXEC                                              20670071
201000         ELSE                                                     20680071
201100            EXEC SQL                                              20690071
201200              FETCH PTAG-BY-SKU1                                  20700000
201300              INTO                                                20710000
201400                    :MRITST-PTAG-ID                               20720000
201500                  , :SKXREF-DEPT                                  20730003
201600                  , :SKXREF-CLASS                                 20740003
201700                  , :SKXREF-SUBCLASS                              20750003
201710                  , :SKXREF-SKU                                   20760003
201800                  , :TSK-SKU-DESC                                 20770000
201900                  , :TSK-SIZE-DESC                                20780000
202000                  , :TSK-COLOR-DESC                               20790000
202100                  , :MRITST-ITEM-NBR                              20800000
202200            END-EXEC                                              20810071
202300         END-IF                                                   20820071
202400                                                                  20830000
202500         EVALUATE TRUE                                            20840071
202600             WHEN SQLCODE = ZERO                                  20850071
202700             WHEN SQLCODE = +100                                  20860071
202800                  CONTINUE                                        20870071
202900             WHEN SQLWARN0 NOT = SPACE                            20880071
203000             WHEN SQLCODE NOT = ZERO                              20890071
203100                  MOVE '4310-FETCH-CURSOR'                        20900071
203200                                   TO DP013-PARAGRAPH             20910071
203300                  MOVE 'FETCH PTAG BY SKU CURSOR'                 20920071
203400                                   TO DP013-MESSAGE-TEXT (1)      20930071
203500                  MOVE SQLCA       TO DP013-SQLCA                 20940071
203600                  SET DP013-DB2-ABEND                             20950071
203700                                   TO TRUE                        20960071
203800                  PERFORM DP013-0000-PROCESS-ABEND                20970071
203900         END-EVALUATE                                             20980071
203910     END-PERFORM.                                                 20990071
204000                                                                  21000000
204001     IF  PV-SQL-SUB > PC-MAX-RETRIES                              21010071
204002         MOVE 'MAX RETRIES EXCEEDED ON FETCH'                     21020071
204003                                TO DP013-MESSAGE-TEXT (1)         21030071
204004         MOVE SQLCA             TO DP013-SQLCA                    21040071
204005         MOVE 'TSKXREF '        TO DP013-DB2-TABLE-NAME (1)       21050072
204006         SET DP013-DB2-ABEND                                      21060071
204007             DP013-XCTL-DISPLAY-RESTART TO TRUE                   21070071
204008         PERFORM DP013-0000-PROCESS-ABEND                         21080071
204009     END-IF.                                                      21090071
204020                                                                  21100071
204100     IF  SQLCODE EQUAL +100                                       21110000
204200         SET ASC-NO-ITEMS-LEFT-ON-DB                              21120000
204300                                   TO TRUE                        21130000
204400     END-IF.                                                      21140000
204500                                                                  21150000
204600 EJECT                                                            21160000
204700*----------------------------------------------------------------*21170000
204800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21180000
204900*----------------------------------------------------------------*21190000
205000                                                                  21200000
205100 4400-MOVE-COMMAREA-TO-SCREEN.                                    21210000
205200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21220000
205300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21230000
205400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21240000
205500             MOVE +1    TO ASC-BLK-SUB                            21250000
205600             PERFORM 5100-WRITE-TEMP-STORAGE                      21260000
205700             ADD +1     TO ASC-BLK-SUB                            21270000
205800             PERFORM 5100-WRITE-TEMP-STORAGE                      21280000
205900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21290000
206000                 GIVING PV-BLOCK-NUMBER                           21300000
206100                 REMAINDER PV-REMAINDER                           21310000
206200             IF  PV-REMAINDER > ZERO                              21320000
206300                 ADD +1 TO PV-BLOCK-NUMBER                        21330000
206400             END-IF                                               21340000
206500             MOVE +1    TO ASC-BLK-SUB                            21350000
206600             PERFORM 4410-READ-TEMP-STORAGE                       21360000
206700             ADD +1     TO ASC-BLK-SUB                            21370000
206800                           PV-BLOCK-NUMBER                        21380000
206900             PERFORM 4410-READ-TEMP-STORAGE                       21390000
207000     END-IF.                                                      21400000
207100     MOVE +1            TO ASC-BLK-SUB.                           21410000
207200     COMPUTE ASC-ITEM-SUB =                                       21420000
207300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21430000
207400         + PC-ITEMS-PER-PANEL).                                   21440000
207500*                                                                 21450000
207600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21460000
207700         ADD +1         TO ASC-BLK-SUB                            21470000
207800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21480000
207900     END-IF.                                                      21490000
208000*                                                                 21500000
208100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           21510000
208200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                21520000
208300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        21530000
208400     PERFORM 4420-FORMAT-LIST-LINES                               21540000
208500         VARYING PV-SUB                                           21550000
208600         FROM PC-ITEMS-PER-PANEL BY -1                            21560000
208700         UNTIL PV-SUB < +1.                                       21570000
208800*                                                                 21580000
208900     COMPUTE ASC-ITEMS-DISPLAYED =                                21590000
209000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21600000
209100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    21610000
209200                                      ASTRTITO.                   21620000
209300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21630000
209400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21640000
209500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21650000
209600                                   TO ASELITO.                    21660000
209700*                                                                 21670000
209800     IF  DP020-MSG-NUMBER-X = SPACE                               21680000
209900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21690000
210000*            --- MORE ITEMS TO DISPLAY ----                       21700000
210100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21710000
210200             SET DP020-MSG-INFORMATIONAL TO TRUE                  21720000
210300         END-IF                                                   21730000
210400     END-IF.                                                      21740000
210500*----------------------------------------------------------------*21750000
210600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *21760000
210700*----------------------------------------------------------------*21770000
210800                                                                  21780000
210900 4410-READ-TEMP-STORAGE.                                          21790000
211000                                                                  21800000
211100     EXEC CICS                                                    21810000
211200         READQ TS                                                 21820000
211300             QUEUE (ASC-LIST-QUEUE-NAME)                          21830000
211400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21840000
211500             ITEM  (PV-BLOCK-NUMBER)                              21850000
211600             RESP  (PV-CICS-RESP)                                 21860000
211700     END-EXEC.                                                    21870000
211800                                                                  21880000
211900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21890000
212000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21900000
212100         CONTINUE                                                 21910000
212200     ELSE                                                         21920000
212300         SET DP013-CICS-ABEND     TO TRUE                         21930000
212400         SET DP013-NO-ROLLBACK    TO TRUE                         21940000
212500         MOVE '4410-READ-TEMP-STORAGE'                            21950000
212600                                  TO DP013-PARAGRAPH              21960000
212700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      21970000
212800                                  TO DP013-MESSAGE-TEXT(1)        21980000
212900         PERFORM DP013-0000-PROCESS-ABEND                         21990000
213000     END-IF.                                                      22000000
213100                                                                  22010000
213200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22020000
213300*                                                                 22030000
213400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22040000
213500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22050000
213600     END-IF.                                                      22060000
213700 EJECT                                                            22070000
213800*----------------------------------------------------------------*22080000
213900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22090000
214000*----------------------------------------------------------------*22100000
214200 4420-FORMAT-LIST-LINES.                                          22110000
214300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22120000
214400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22130000
214500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           22140000
214600         MOVE SPACE              TO MR-SELECTI (PV-SUB)           22150000
214700                                    MR-ACTION (PV-SUB)            22160000
214800                                    MR-PTAG (PV-SUB)              22170000
214900                                    MR-DEPT (PV-SUB)              22180006
214910                                    MR-CLASS (PV-SUB)             22190006
214920                                    MR-SCLASS (PV-SUB)            22200012
214930                                    MR-SKU (PV-SUB)               22210006
215000                                    MR-DESCRIPTION (PV-SUB)       22220000
215100                                    MR-SIZE (PV-SUB)              22230000
215200                                    MR-COLOR (PV-SUB)             22240000
215300     ELSE                                                         22250000
215400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22260000
215500                                                   > SPACE        22270000
215600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22280000
215700                                 TO MR-SELECTI (PV-SUB)           22290000
215800         ELSE                                                     22300000
215900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22310000
216000                                 TO MR-SELECTI (PV-SUB)           22320000
216100         END-IF                                                   22330000
216200*                                                                 22340000
216300         IF  DP030-SET-CURSOR-TRAILER                             22350000
216400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22360000
216500                 > SPACE)                                         22370000
216600               OR (PV-SUB = 1))                                   22380000
216700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22390000
216800                MOVE -1          TO MR-SELECTL (PV-SUB)           22400000
216900             END-IF                                               22410000
217000         END-IF                                                   22420000
217100*                                                                 22430000
217200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           22440000
217300             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           22450000
217400                                 TO MR-ACTION (PV-SUB)            22460000
217500             MOVE ASC-PTAG (ASC-BLK-SUB ASC-ITEM-SUB)             22470000
217600                                 TO MR-PTAG (PV-SUB)              22480000
217700             MOVE ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)             22490006
217800                                 TO MR-DEPT (PV-SUB)              22500006
217801             MOVE ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)            22510006
217802                                 TO MR-CLASS (PV-SUB)             22520006
217803             MOVE ASC-SUBCLASS (ASC-BLK-SUB ASC-ITEM-SUB)         22530006
217804                                 TO MR-SCLASS (PV-SUB)            22540006
217810             MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)              22550006
217820                                 TO MR-SKU (PV-SUB)               22560006
217900             MOVE ASC-DESCRIPTION (ASC-BLK-SUB ASC-ITEM-SUB)      22570000
218000                                 TO MR-DESCRIPTION (PV-SUB)       22580000
218100             MOVE ASC-SIZE (ASC-BLK-SUB ASC-ITEM-SUB)             22590000
218200                                 TO MR-SIZE (PV-SUB)              22600000
218300             MOVE ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)            22610000
218400                                 TO MR-COLOR (PV-SUB)             22620000
218500         END-IF                                                   22630000
218600     END-IF.                                                      22640000
218700     SUBTRACT +1 FROM ASC-ITEM-SUB                                22650000
218800     IF  ASC-ITEM-SUB < + 1                                       22660000
218900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22670000
219000         MOVE +1                 TO ASC-BLK-SUB                   22680000
219100     END-IF.                                                      22690000
219200******************************************************************22700000
219300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **22710000
219400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **22720000
219500** ISSUE A WARNING.                                             **22730000
219600******************************************************************22740000
219700 4430-CHECK-FOR-BEGIN-AND-END.                                    22750000
219800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       22760000
219900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22770000
220000*            -- NO END-OF-RANGE SPECFIED ---                      22780000
220100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            22790000
220200             SET DP020-MSG-WARNING TO TRUE                        22800000
220300             PERFORM 4431-POSITION-AT-WARNING                     22810000
220400         END-IF                                                   22820000
220500     ELSE                                                         22830000
220600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     22840000
220700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                22850000
220800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            22860000
220900             SET DP020-MSG-WARNING TO TRUE                        22870000
221000             PERFORM 4431-POSITION-AT-WARNING                     22880000
221100         END-IF                                                   22890000
221200     END-IF.                                                      22900000
221300******************************************************************22910000
221400** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **22920000
221500** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **22930000
221600** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **22940000
221700** POSITION THE CURSOR THERE.                                   **22950000
221800******************************************************************22960000
221900 4431-POSITION-AT-WARNING.                                        22970000
222000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 22980000
222100                    - PV-TOP-ITEM + 1.                            22990000
222200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23000000
222300         CONTINUE                                                 23010000
222400     ELSE                                                         23020000
222500         SET DP030-SET-CURSOR-APPL-1                              23030000
222600                                   TO TRUE                        23040000
222700         MOVE -1                   TO MR-SELECTL (PV-SUB)         23050000
222800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23060000
222900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23070000
223000     END-IF.                                                      23080000
223100*                                                                 23090000
223200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23100000
223300                    - PV-TOP-ITEM + 1.                            23110000
223400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23120000
223500         CONTINUE                                                 23130000
223600     ELSE                                                         23140000
223700         SET DP030-SET-CURSOR-APPL-1                              23150000
223800                                   TO TRUE                        23160000
223900         MOVE -1                   TO MR-SELECTL (PV-SUB)         23170000
224000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23180000
224100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23190000
224200     END-IF.                                                      23200000
224300 EJECT                                                            23210000
224400*----------------------------------------------------------------*23220000
224500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23230000
224600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23240000
224700* FOR THE SELECTED ITEMS QUEUE.                                  *23250000
224800*                                                                *23260000
224900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23270000
225000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23280000
225100* THE ARRAY IS FULL.                                             *23290000
225200*----------------------------------------------------------------*23300000
225300                                                                  23310000
225400 5000-PREPARE-SEL-QUEUE.                                          23320000
225500                                                                  23330000
225600     MOVE +1                   TO  ASC-BLK-SUB.                   23340000
225700     PERFORM 5100-WRITE-TEMP-STORAGE.                             23350000
225800     ADD +1                    TO  ASC-BLK-SUB.                   23360000
225900     PERFORM 5100-WRITE-TEMP-STORAGE.                             23370000
226000                                                                  23380000
226100     MOVE ASC-SEL-QUEUE-NAME   TO  MR102-SEL-QUEUE-NAME.          23390000
226200     PERFORM 6010-DELETE-SEL-QUEUE.                               23400000
226300                                                                  23410000
226400     SET ASC-UPDATE-TSQ        TO  TRUE.                          23420000
226500                                                                  23430000
226600     SET MR115-IDX             TO  1.                             23440000
226700     MOVE ZERO                 TO MR102-NUMBER-OF-TS-ITEMS.       23450000
226800     INITIALIZE MR115-SELECTED-ITEM-ARRAY.                        23460000
226900                                                                  23470000
227000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23480000
227100             VARYING PV-ITEM                                      23490000
227200             FROM 1 BY 1                                          23500000
227300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23510000
227400                                                                  23520000
227500     IF  MR115-IDX > 1                                            23530000
227600         PERFORM 5205-WRITE-SEL-QUEUE                             23540000
227700         ADD +1                TO MR102-NUMBER-OF-TS-ITEMS        23550000
227800     END-IF.                                                      23560000
227900 EJECT                                                            23570000
228000*----------------------------------------------------------------*23580000
228100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23590000
228200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23600000
228300*----------------------------------------------------------------*23610000
228400                                                                  23620000
228500 5100-WRITE-TEMP-STORAGE.                                         23630000
228600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23640000
228700                                   TO PV-LIST-ITEM-NUMBER.        23650000
228800     COMPUTE PV-BLOCK-NUMBER =                                    23660000
228900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23670000
229000                                                                  23680000
229100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23690000
229200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23700000
229300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23710000
229400             PERFORM 5105-REWRITE-ASC-LISTQ                       23720000
229500         END-IF                                                   23730000
229600     ELSE                                                         23740000
229700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23750000
229800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23760000
229900         PERFORM 5110-WRITE-ASC-LISTQ                             23770000
230000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23780000
230100     END-IF.                                                      23790000
230200                                                                  23800000
230300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23810000
230400******************************************************************23820000
230500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **23830000
230600** SPECIFIC COMMAREA.                                           **23840000
230700******************************************************************23850000
230800 5105-REWRITE-ASC-LISTQ.                                          23860000
230900     EXEC CICS                                                    23870000
231000         WRITEQ TS                                                23880000
231100             QUEUE (ASC-LIST-QUEUE-NAME)                          23890000
231200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23900000
231300             ITEM  (PV-BLOCK-NUMBER)                              23910000
231400             REWRITE                                              23920000
231500             RESP  (PV-CICS-RESP)                                 23930000
231600     END-EXEC.                                                    23940000
231700                                                                  23950000
231800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23960000
231900         CONTINUE                                                 23970000
232000     ELSE                                                         23980000
232100         SET DP013-CICS-ABEND            TO TRUE                  23990000
232200         SET DP013-NO-ROLLBACK           TO TRUE                  24000000
232300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       24010000
232400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24020000
232500                                         TO DP013-MESSAGE-TEXT(1) 24030000
232600         PERFORM DP013-0000-PROCESS-ABEND                         24040000
232700     END-IF.                                                      24050000
232800                                                                  24060000
232900******************************************************************24070000
233000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **24080000
233100** SPECIFIC COMMAREA.                                           **24090000
233200******************************************************************24100000
233300 5110-WRITE-ASC-LISTQ.                                            24110000
233400     EXEC CICS                                                    24120000
233500         WRITEQ TS                                                24130000
233600             QUEUE (ASC-LIST-QUEUE-NAME)                          24140000
233700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24150000
233800             ITEM  (PV-BLOCK-NUMBER)                              24160000
233900             RESP  (PV-CICS-RESP)                                 24170000
234000     END-EXEC.                                                    24180000
234100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24190000
234200         SET DP013-CICS-ABEND      TO TRUE                        24200000
234300         SET DP013-NO-ROLLBACK     TO TRUE                        24210000
234400         MOVE '5110-WRITE-ASC-LISTQ'                              24220000
234500                                   TO DP013-PARAGRAPH             24230000
234600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24240000
234700                                   TO DP013-MESSAGE-TEXT(1)       24250000
234800         PERFORM DP013-0000-PROCESS-ABEND                         24260000
234900     END-IF.                                                      24270000
235000 EJECT                                                            24280000
235100*----------------------------------------------------------------*24290000
235200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *24300000
235300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *24310000
235400*----------------------------------------------------------------*24320000
235500                                                                  24330000
235600 5200-FILL-SEL-QUEUE-RECORD.                                      24340000
235700                                                                  24350000
235800     PERFORM 6112-READ-LIST-QUEUE.                                24360000
235900                                                                  24370000
236000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24380000
236100         PERFORM                                                  24390000
236200         VARYING LQW-IDX                                          24400000
236300         FROM 1 BY 1                                              24410000
236400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24420000
236500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24430000
236600                                                                  24440000
236700             IF  LQW-SELECT (LQW-IDX)                             24450000
236800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24460000
236900                                   TO MR115-ITEM (MR115-IDX)      24470000
237000                 MOVE LQW-SKU (LQW-IDX)                           24480000
237100                                   TO MR115-SKU (MR115-IDX)       24490000
237201                                      ASC-KEY-SKU                 24500079
237210                 MOVE LQW-DEPT (LQW-IDX)                          24510062
237211                                   TO MR115-DEPT (MR115-IDX)      24520062
237212                                      ASC-KEY-DEPT                24530062
237220                 MOVE LQW-CLASS (LQW-IDX)                         24540062
237221                                   TO MR115-CLASS (MR115-IDX)     24550062
237222                                      ASC-KEY-CLASS               24560062
237230                 MOVE LQW-SCLASS (LQW-IDX)                        24570062
237240                                   TO MR115-SUBCLASS (MR115-IDX)  24580062
237250                                      ASC-KEY-SUBCLASS            24590062
237600                 MOVE LQW-PTAG (LQW-IDX)                          24600000
237700                                   TO MR115-PTAG (MR115-IDX)      24610000
237800                                      ASC-KEY-PTAG                24620000
237900                 MOVE LQW-DESCRIPTION (LQW-IDX)                   24630000
238000                                 TO MR115-DESCRIPTION (MR115-IDX) 24640000
238100                 MOVE LQW-SIZE (LQW-IDX)                          24650000
238200                                   TO MR115-SIZE (MR115-IDX)      24660000
238300                 MOVE LQW-COLOR (LQW-IDX)                         24670000
238400                                   TO MR115-COLOR (MR115-IDX)     24680000
238500                 SET MR115-IDX UP BY 1                            24690000
238600                 IF  MR115-IDX > MR115-MAX-ITEMS                  24700000
238700                     PERFORM 5205-WRITE-SEL-QUEUE                 24710000
238800                     ADD +1        TO MR102-NUMBER-OF-TS-ITEMS    24720000
238900                     INITIALIZE MR115-SELECTED-ITEM-ARRAY         24730000
239000                     SET MR115-IDX TO  1                          24740000
239100                 END-IF                                           24750000
239200             END-IF                                               24760000
239300         END-PERFORM                                              24770000
239400     END-IF.                                                      24780000
239500                                                                  24790000
239600*----------------------------------------------------------------*24800000
239700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24810000
239800*----------------------------------------------------------------*24820000
239900                                                                  24830000
240000 5205-WRITE-SEL-QUEUE.                                            24840000
240100                                                                  24850000
240200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24860000
240300                                   TO MR115-SELECTED-ITEMS.       24870000
240400                                                                  24880000
240500     EXEC CICS                                                    24890000
240600          WRITEQ TS                                               24900000
240700              QUEUE (ASC-SEL-QUEUE-NAME)                          24910000
240800              FROM  (MR115-MESSAGE-SEL-REC)                       24920000
240900              ITEM  (PV-SEL-QUEUE-ITEM)                           24930000
241000              RESP  (PV-CICS-RESP)                                24940000
241100     END-EXEC.                                                    24950000
241200                                                                  24960000
241300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24970000
241400         CONTINUE                                                 24980000
241500     ELSE                                                         24990000
241600         SET DP013-CICS-ABEND      TO TRUE                        25000000
241700         SET DP013-NO-ROLLBACK     TO TRUE                        25010000
241800         MOVE '5205-WRITE-SEL-QUEUE'                              25020000
241900                                   TO DP013-PARAGRAPH             25030000
242000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25040000
242100                                   TO DP013-MESSAGE-TEXT(1)       25050000
242200         PERFORM DP013-0000-PROCESS-ABEND                         25060000
242300     END-IF.                                                      25070000
242400 EJECT                                                            25080000
242500******************************************************************25090000
242600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **25100000
242700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **25110000
242800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **25120000
242900** THE USER.                                                    **25130000
243000******************************************************************25140000
243100 6000-REFRESH-PANEL-FROM-TEMP.                                    25150000
243200     IF  ASC-UPDATE-TSQ                                           25160000
243300         SET ASC-NO-TSQ-UPDATE TO TRUE                            25170000
243400         MOVE ZERO                 TO PV-SAVE-ITEM                25180000
243500                                      PV-SEL-QUEUE-ITEM           25190000
243600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25200000
243700                                   TO PV-HOLD-SELECTED-ITEMS      25210000
243800         PERFORM 6100-UPDATE-TSQ                                  25220000
243900             UNTIL PV-ITEMS-PROCESSED >                           25230000
244000                                     ASC-NUMBER-OF-SELECTED-ITEMS 25240000
244100         PERFORM 6010-DELETE-SEL-QUEUE                            25250000
244200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25260000
244300                    ASC-BLOCK-ENTRIES (2)                         25270000
244400     END-IF.                                                      25280000
244500                                                                  25290000
244600*----------------------------------------------------------------*25300000
244700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25310000
244800*----------------------------------------------------------------*25320000
244900 6010-DELETE-SEL-QUEUE.                                           25330000
245000                                                                  25340000
245100     EXEC CICS                                                    25350000
245200         DELETEQ TS                                               25360000
245300             QUEUE (ASC-SEL-QUEUE-NAME)                           25370000
245400             RESP  (PV-CICS-RESP)                                 25380000
245500     END-EXEC.                                                    25390000
245600*                                                                 25400000
245700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25410000
245800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25420000
245900         CONTINUE                                                 25430000
246000     ELSE                                                         25440000
246100         SET DP013-CICS-ABEND TO TRUE                             25450000
246200         SET DP013-NO-ROLLBACK TO TRUE                            25460000
246300         MOVE '6010-DELETE-SEL-QUEUE'                             25470000
246400                        TO DP013-PARAGRAPH                        25480000
246500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25490000
246600                        TO DP013-MESSAGE-TEXT (1)                 25500000
246700         PERFORM DP013-0000-PROCESS-ABEND                         25510000
246800     END-IF.                                                      25520000
246900                                                                  25530000
247000*----------------------------------------------------------------*25540000
247100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25550000
247200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25560000
247300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25570000
247400*    THE TEMP QUEUE.                                             *25580000
247500*----------------------------------------------------------------*25590000
247600                                                                  25600000
247700 6100-UPDATE-TSQ.                                                 25610000
247800                                                                  25620000
247900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25630000
248000     PERFORM 6105-READ-SEL-QUEUE.                                 25640000
248100     PERFORM                                                      25650000
248200         VARYING MR115-IDX                                        25660000
248300         FROM 1 BY 1                                              25670000
248400         UNTIL ((PV-ITEMS-PROCESSED >                             25680000
248500                              PV-HOLD-SELECTED-ITEMS)             25690000
248600         OR (MR115-IDX GREATER THAN MR115-MAX-ITEMS))             25700000
248700         IF  MR115-ACTION-SW (MR115-IDX) > SPACE                  25710000
248800             PERFORM 6110-PROCESS-ITEMS                           25720000
248900         END-IF                                                   25730000
249000         ADD +1                TO PV-ITEMS-PROCESSED              25740000
249100     END-PERFORM.                                                 25750000
249200     PERFORM 6111-WRITE-LIST-QUEUE.                               25760000
249300*----------------------------------------------------------------*25770000
249400*    READ THE LIST QUEUE RECORD.                                 *25780000
249500*----------------------------------------------------------------*25790000
249600                                                                  25800000
249700 6105-READ-SEL-QUEUE.                                             25810000
249800                                                                  25820000
249900     EXEC CICS                                                    25830000
250000          READQ TS                                                25840000
250100              QUEUE (ASC-SEL-QUEUE-NAME)                          25850000
250200              INTO  (MR115-MESSAGE-SEL-REC)                       25860000
250300              ITEM  (PV-SEL-QUEUE-ITEM)                           25870000
250400              RESP  (PV-CICS-RESP)                                25880000
250500     END-EXEC.                                                    25890000
250600*                                                                 25900000
250700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25910000
250800         CONTINUE                                                 25920000
250900     ELSE                                                         25930000
251000         SET DP013-CICS-ABEND      TO  TRUE                       25940000
251100         SET DP013-NO-ROLLBACK     TO  TRUE                       25950000
251200         MOVE '6105-READ-SEL-QUEUE'                               25960000
251300                                   TO  DP013-PARAGRAPH            25970000
251400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           25980000
251500                                   TO  DP013-MESSAGE-TEXT(1)      25990000
251600         PERFORM DP013-0000-PROCESS-ABEND                         26000000
251700     END-IF.                                                      26010000
251800 EJECT                                                            26020000
251900*----------------------------------------------------------------*26030000
252000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*26040000
252100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*26050000
252200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *26060000
252300*----------------------------------------------------------------*26070000
252400                                                                  26080000
252500 6110-PROCESS-ITEMS.                                              26090000
252600                                                                  26100000
252700     COMPUTE PV-ITEM = 1 + ((MR115-ITEM (MR115-IDX) - 1)          26110000
252800                     / PC-ITEMS-PER-PANEL).                       26120000
252900                                                                  26130000
253000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26140000
253100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26150000
253200             PERFORM 6111-WRITE-LIST-QUEUE                        26160000
253300         END-IF                                                   26170000
253400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    26180000
253500                                                                  26190000
253600         PERFORM 6112-READ-LIST-QUEUE                             26200000
253700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26210000
253800             CONTINUE                                             26220000
253900         END-IF                                                   26230000
254000     END-IF.                                                      26240000
254100                                                                  26250000
254200     COMPUTE PV-SUB = (MR115-ITEM (MR115-IDX)                     26260000
254300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26270000
254400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         26280000
254500     MOVE LQW-SELECTED-SW (PV-SUB)                                26290000
254600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  26300000
254700     EVALUATE TRUE                                                26310000
254800         WHEN MR115-INQ (MR115-IDX)                               26320000
254900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             26330000
255000                                                                  26340000
255100         WHEN MR115-UPD (MR115-IDX)                               26350000
255200              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             26360000
255300                                                                  26370000
255400         WHEN MR115-DEL (MR115-IDX)                               26380000
255500              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             26390000
255600                                                                  26400000
255700         WHEN MR115-ERR (MR115-IDX)                               26410000
255800              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             26420000
255900     END-EVALUATE.                                                26430000
256000                                                                  26440000
256100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26450000
256200                                                                  26460000
256300*----------------------------------------------------------------*26470000
256400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *26480000
256500*----------------------------------------------------------------*26490000
256600                                                                  26500000
256700 6111-WRITE-LIST-QUEUE.                                           26510000
256800                                                                  26520000
256900     EXEC CICS                                                    26530000
257000         WRITEQ TS                                                26540000
257100             QUEUE (ASC-LIST-QUEUE-NAME)                          26550000
257200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26560000
257300             ITEM  (PV-SAVE-ITEM)                                 26570000
257400             REWRITE                                              26580000
257500             RESP  (PV-CICS-RESP)                                 26590000
257600     END-EXEC.                                                    26600000
257700*                                                                 26610000
257800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26620000
257900         CONTINUE                                                 26630000
258000     ELSE                                                         26640000
258100         SET DP013-CICS-ABEND  TO  TRUE                           26650000
258200         SET DP013-NO-ROLLBACK TO  TRUE                           26660000
258300         MOVE '6111-WRITE-LIST-QUEUE'                             26670000
258400                               TO  DP013-PARAGRAPH                26680000
258500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26690000
258600                               TO  DP013-MESSAGE-TEXT(1)          26700000
258700         PERFORM DP013-0000-PROCESS-ABEND                         26710000
258800     END-IF.                                                      26720000
258900                                                                  26730000
259000 EJECT                                                            26740000
259100*----------------------------------------------------------------*26750000
259200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26760000
259300*----------------------------------------------------------------*26770000
259400                                                                  26780000
259500 6112-READ-LIST-QUEUE.                                            26790000
259600                                                                  26800000
259700     EXEC CICS                                                    26810000
259800         READQ TS                                                 26820000
259900             QUEUE (ASC-LIST-QUEUE-NAME)                          26830000
260000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26840000
260100             ITEM  (PV-ITEM)                                      26850000
260200             RESP  (PV-CICS-RESP)                                 26860000
260300     END-EXEC.                                                    26870000
260400*                                                                 26880000
260500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26890000
260600         CONTINUE                                                 26900000
260700     ELSE                                                         26910000
260800         SET DP013-CICS-ABEND        TO TRUE                      26920000
260900         SET DP013-NO-ROLLBACK       TO TRUE                      26930000
261000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           26940000
261100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26950000
261200                                     TO DP013-MESSAGE-TEXT(1)     26960000
261300         PERFORM DP013-0000-PROCESS-ABEND                         26970000
261400     END-IF.                                                      26980000
261500                                                                  26990000
261600*----------------------------------------------------------------*27000000
261700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *27010000
261800*----------------------------------------------------------------*27020000
261900 9200-REWRITE-LIST-QUEUE.                                         27030000
262000     EXEC CICS                                                    27040000
262100          WRITEQ TS                                               27050000
262200              QUEUE  (ASC-SEL-QUEUE-NAME)                         27060000
262300              FROM   (MR115-MESSAGE-SEL-REC)                      27070000
262400              ITEM   (PV-SEL-QUEUE-ITEM)                          27080000
262500              RESP   (PV-CICS-RESP)                               27090000
262600              REWRITE                                             27100000
262700     END-EXEC.                                                    27110000
262800                                                                  27120000
262900     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   27130000
263000         SET DP013-CICS-ABEND                                     27140000
263100             DP013-NO-ROLLBACK     TO TRUE                        27150000
263200         MOVE '9200-REWRITE-LIST-QUEUE'                           27160000
263300                                   TO DP013-PARAGRAPH             27170000
263400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   27180000
263500                                   TO DP013-MESSAGE-TEXT (1)      27190000
263600         PERFORM DP013-0000-PROCESS-ABEND                         27200000
263700     END-IF.                                                      27210000
263800                                                                  27220000
263900 EJECT                                                            27230000
264000*----------------------------------------------------------------*27240000
264100*    ABEND PROCESSOR MODULE                                      *27250000
264200*----------------------------------------------------------------*27260000
264300                                                                  27270000
264400     COPY DPPD013.                                                27280000
