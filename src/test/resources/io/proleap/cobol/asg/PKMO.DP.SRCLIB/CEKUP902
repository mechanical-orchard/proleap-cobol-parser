000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.   CEKUP902.                                          00040000
000500 AUTHOR.       DENISE HAHN.                                       00050000
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060000
000700 DATE-WRITTEN. MARCH 2023.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000* CENTRAL STOCK DATA FIX - EFC5 & EFC6 ISSUE SHIPPED PARCEL DATA  00100000
001100*                                                                 00110000
001200* INPUT FILE:  SORTED ERROR FILE.  BY STORE/SHIPT_UNT_ID          00120000
001300*                                                                 00130000
001301* READ THE FILE.                                                  00130100
001310* COUNT THE NUMBER OF RECORDS FOR EACH STORE.                     00131000
001400* STORE BREAK:                                                    00140000
001500*                                                                 00150000
001510*                                                                 00151000
001520*                                                                 00152000
001530*                                                                 00153000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000******************************************************************00200000
002100 CONFIGURATION SECTION.                                           00210000
002200 SOURCE-COMPUTER.        IBM-3090.                                00220000
002300 OBJECT-COMPUTER.        IBM-3090.                                00230000
002400                                                                  00240000
002500 INPUT-OUTPUT SECTION.                                            00250000
002600 FILE-CONTROL.                                                    00260000
002700     SELECT CE-ERROR-DATA-FILE                                    00270000
002800         ASSIGN TO INP01.                                         00280000
002900                                                                  00290000
002910     SELECT CE-ERROR-DATA-FILE-OUTPUT                             00291000
002920         ASSIGN TO OUT01.                                         00292000
002930                                                                  00293000
003000******************************************************************00300000
003100 DATA DIVISION.                                                   00310000
003200******************************************************************00320000
003300 FILE SECTION.                                                    00330000
003400                                                                  00340000
003500 FD  CE-ERROR-DATA-FILE                                           00350000
003600     RECORDING MODE IS F                                          00360000
003700     LABEL RECORDS ARE STANDARD                                   00370000
003800     RECORD CONTAINS 100 CHARACTERS                               00380000
003900     BLOCK CONTAINS 0 RECORDS.                                    00390000
004000                                                                  00400000
004100 01  CE-ERROR-DATA-FILE-REC.                                      00410000
004110     05  FILLER                        PIC X(100).                00411000
004193                                                                  00419300
004194                                                                  00419400
004195 FD  CE-ERROR-DATA-FILE-OUTPUT                                    00419500
004196     RECORDING MODE IS F                                          00419600
004197     LABEL RECORDS ARE STANDARD                                   00419700
004198     RECORD CONTAINS 80 CHARACTERS                                00419800
004199     BLOCK CONTAINS 0 RECORDS.                                    00419900
004200                                                                  00420000
004201 01  CE-ERROR-DATA-FILE-REC-OUT.                                  00420100
004202     05  FILLER                        PIC X(80).                 00420200
004203                                                                  00420300
004204******************************************************************00420400
004205 WORKING-STORAGE SECTION.                                         00420500
004206******************************************************************00420600
004207 01  PC-PROGRAM-CONSTANTS.                                        00420700
004208     05  PC-CURRENT-PROGRAM-NAME       PIC X(08) VALUE 'CEKUP902'.00420800
004209                                                                  00420900
004210 01  PS-PROGRAM-SWITCHES.                                         00421000
004300     05  PS-END-OF-FILE-SW             PIC X(01) VALUE 'N'.       00430000
004400         88  PS-END-OF-FILE-YES                  VALUE 'Y'.       00440000
004500         88  PS-END-OF-FILE-NO                   VALUE 'N'.       00450000
004501     05  PS-EOF-DCSTMF-CSR-SW          PIC X(01) VALUE 'N'.       00450100
004502         88  PS-EOF-DCSTMF-CSR                   VALUE 'Y'.       00450200
004503         88  PS-NOT-DCSTMF-CSR                   VALUE 'N'.       00450300
004504                                                                  00450400
004505 01  PV-PROGRAM-VARIABLES.                                        00450500
004511     05  PV-PREV-STORE                 PIC  9(04) VALUE ZEROES.   00451100
004512     05  PV-PREV-EFC-STORE             PIC  9(04) VALUE ZEROES.   00451200
004513     05  PV-PREV-EFC                   PIC  9(04) VALUE ZEROES.   00451307
004514     05  PV-STORE-CARTON-CNT           PIC  9(09) VALUE ZEROES.   00451407
004515     05  PV-INPUT-COUNT                PIC  9(09) VALUE ZEROES.   00451507
004516     05  PV-DISTINCT-STORE-COUNT       PIC  9(09) VALUE ZEROES.   00451622
004517     05  PV-OUTPUT-COUNT               PIC  9(09) VALUE ZEROES.   00451722
004518     05  PV-TDCSTMF-UPDATED            PIC  9(09) VALUE ZEROES.   00451822
004520     05  PV-DISP-COUNT                 PIC  ZZZ,ZZZ,ZZ9.          00452024
004523     05  PV-DISP-BEFORE-MFST-NBR       PIC  ZZZZZZZZ9.            00452324
004524     05  PV-DISP-AFTER-MFST-NBR        PIC  ZZZZZZZZ9.            00452424
004525     05  PV-START-MFST-NBR             PIC  9(09) VALUE ZERO.     00452524
004526     05  PV-END-MFST-NBR               PIC  9(09) VALUE ZERO.     00452624
004527     05  PV-MFST-NBR                   PIC S9(09) VALUE ZERO      00452724
004528                                                   COMP SYNC.     00452824
004529     05  PV-BEFORE-MFST-NBR            PIC S9(09) VALUE ZERO      00452924
004530                                                   COMP SYNC.     00453024
004540                                                                  00454024
005600 01  PV-ABEND-FIELDS.                                             00560000
005700     05  PV-SQLCODE                    PIC  9999-.                00570000
005800     05  PV-ABEND-CODE                 PIC S9(4) VALUE +0         00580000
005900                                                        COMP SYNC.00590000
006000     05  PV-ABEND-PROGRAM              PIC X(08) VALUE 'CEKUP902'.00600000
006100     05  PV-ABEND-PARAGRAPH            PIC X(25) VALUE SPACES.    00610000
006200     05  PV-ABEND-OPERATION            PIC X(20) VALUE SPACES.    00620000
006300     05  PV-ABEND-STRUCTURE-1          PIC X(08) VALUE SPACES.    00630000
006400     05  PV-ABEND-STRUCTURE-2          PIC X(08) VALUE SPACES.    00640000
006500     05  PV-ABEND-STATUS               PIC XX    VALUE SPACES.    00650000
006600     05  PV-DB2-OPERATION-MESSAGE-1    PIC X(79) VALUE SPACES.    00660000
006700     05  PV-DB2-OPERATION-MESSAGE-2    PIC X(79) VALUE SPACES.    00670000
006800     05  PV-DB2-TABLE-NAME             PIC X(08) VALUE SPACES.    00680000
006900                                                                  00690000
007000 01  IR-CONTROL-RECORD.                                           00700000
007100     05  IR-STORE-NBR                   PIC 9(04).                00710000
007200     05  FILLER                         PIC X(01).                00720000
007300     05  IR-START-SML-NBR.                                        00730000
007400         10  IR-START-SML-1-5           PIC 9(05).                00740000
007500         10  IR-START-SML-STORE         PIC 9(04).                00750000
007600         10  IR-START-SML-DC            PIC 9(03).                00760000
007700         10  IR-START-SML-13-20         PIC 9(08).                00770000
007800     05  FILLER                         PIC X(75) VALUE SPACE.    00780000
007900                                                                  00790000
008900                                                                  00890000
009100***********************************************************       00910000
009200*  INPUT FILE LAYOUT                                      *       00920006
009300***********************************************************       00930000
009400     COPY CERD048.                                                00940006
009500                                                                  00950000
009520                                                                  00952006
009530***********************************************************       00953006
009540*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00954006
009550***********************************************************       00955006
009560     COPY DPWS004.                                                00956006
009570                                                                  00957006
009600***********************************************************       00960000
009700*  DB2 SQL COMMUNICATION AREA                             *       00970000
009800***********************************************************       00980000
009900     EXEC SQL                                                     00990000
010000         INCLUDE SQLCA                                            01000000
010100     END-EXEC.                                                    01010000
010200                                                                  01020000
010300***********************************************************       01030000
010400*  OUTBOUND CARTON MANIFEST NUMBER                                01040000
010500***********************************************************       01050000
010600     EXEC SQL                                                     01060000
010700         INCLUDE TDCSTMF                                          01070000
010800     END-EXEC.                                                    01080000
010900                                                                  01090000
010910***********************************************************       01091000
010920*  XLT_LOC                                                        01092000
010930***********************************************************       01093000
010940     EXEC SQL                                                     01094000
010950         INCLUDE XLT00010                                         01095000
010960     END-EXEC.                                                    01096000
010970                                                                  01097000
010980***********************************************************       01098000
010990*  XLT_DC_LOC_ASGMT                                               01099000
010991***********************************************************       01099100
010992     EXEC SQL                                                     01099200
010993         INCLUDE XLT00014                                         01099300
010994     END-EXEC.                                                    01099400
010995                                                                  01099500
011000******************************************************************01100000
011100*    DECLARATION FOR CURSOR SELECTING MANIFEST NBR FROM TDCSTMF   01110000
011200******************************************************************01120000
011300                                                                  01130000
011400     EXEC SQL                                                     01140000
011500         DECLARE  DCSTMF_CSR CURSOR FOR                           01150000
011600          SELECT  MFST_NBR                                        01160000
011610            FROM  TDCSTMF                                         01161000
011620        WHERE STR_NBR = :DCSTMF-STR-NBR                           01162000
011630        FOR UPDATE OF MFST_NBR                                    01163026
011640     END-EXEC.                                                    01164000
011650                                                                  01165000
011660                                                                  01166000
011700***********************************************************       01170000
011710*                                                                 01171000
011800***********************************************************       01180000
011900 PROCEDURE DIVISION.                                              01190000
011910                                                                  01191000
012000     DISPLAY '*** START OF CEKUP902 ***'.                         01200000
012100     DISPLAY ' '.                                                 01210000
012200                                                                  01220000
012400     PERFORM 0100-INITIALIZATION.                                 01240000
012500                                                                  01250000
012700     IF PS-END-OF-FILE-YES                                        01270000
012800         DISPLAY '**** NO INPUT FILE FOUND FOR CEKUP902 ****'     01280000
012900     ELSE                                                         01290000
013000         PERFORM 1000-PROCESS-INPUT                               01300000
013100           UNTIL PS-END-OF-FILE-YES                               01310000
013200     END-IF.                                                      01320000
013300                                                                  01330000
013301     IF  PV-STORE-CARTON-CNT  > 0                                 01330100
013310         PERFORM 2000-STORE-NBR-BREAK                             01331000
013320     END-IF.                                                      01332000
013360                                                                  01336000
013400*DISPLAY RECORD COUNTS.                                           01340000
013500     DISPLAY ' '.                                                 01350000
013600     DISPLAY '****************************************'.          01360000
013700     MOVE PV-INPUT-COUNT           TO PV-DISP-COUNT.              01370022
013800     DISPLAY '*** RECORDS READ     ==> ' PV-DISP-COUNT.           01380004
013810     DISPLAY '***'                                                01381000
013820     MOVE PV-DISTINCT-STORE-COUNT  TO PV-DISP-COUNT.              01382022
013830     DISPLAY '*** DISTINCT STORES  ==> ' PV-DISP-COUNT.           01383022
013840     DISPLAY '***'                                                01384022
013900     MOVE PV-TDCSTMF-UPDATED       TO PV-DISP-COUNT.              01390022
014000     DISPLAY '*** TDCSTMF UPDATED  ==> ' PV-DISP-COUNT.           01400009
014010     DISPLAY '***'                                                01401000
014020     MOVE PV-OUTPUT-COUNT          TO PV-DISP-COUNT.              01402022
014030     DISPLAY '*** OUTPUT COUNT     ==> ' PV-DISP-COUNT.           01403009
014040     DISPLAY '***'                                                01404009
014500     DISPLAY '****************************************'.          01450000
014600     DISPLAY ' '.                                                 01460000
014700                                                                  01470000
014800*CLOSE FILES.                                                     01480000
014900     CLOSE CE-ERROR-DATA-FILE                                     01490006
014910           CE-ERROR-DATA-FILE-OUTPUT.                             01491006
015000                                                                  01500000
015100     DISPLAY '***  END OF CEKUP902  ***'.                         01510000
015200     GOBACK.                                                      01520000
015300                                                                  01530000
015400******************************************************************01540000
015500 0100-INITIALIZATION.                                             01550000
015600                                                                  01560013
015700     MOVE '0100-INITIALIZATION        ' TO PV-ABEND-PARAGRAPH.    01570000
015800                                                                  01580000
015900     OPEN INPUT  CE-ERROR-DATA-FILE                               01590006
015910          OUTPUT CE-ERROR-DATA-FILE-OUTPUT.                       01591006
016000                                                                  01600000
016100     PERFORM 7000-READ-INPUT.                                     01610000
016200                                                                  01620000
016700     MOVE  CE048-STORE-NUMBER  TO  PV-PREV-STORE.                 01670000
016800     MOVE  CE048-DC-NUMBER     TO  PV-PREV-EFC-STORE.             01680000
016900                                                                  01690000
016910                                                                  01691000
017000******************************************************************01700000
017100 1000-PROCESS-INPUT.                                              01710000
017200                                                                  01720013
017300     MOVE '1000-PROCESS-INPUT         ' TO PV-ABEND-PARAGRAPH.    01730000
017400                                                                  01740000
017401     IF  CE048-STORE-NUMBER   =  PV-PREV-STORE                    01740100
017410         ADD  1  TO  PV-STORE-CARTON-CNT                          01741000
017420     ELSE                                                         01742000
017430         PERFORM 2000-STORE-NBR-BREAK                             01743000
017431         MOVE CE048-STORE-NUMBER  TO  PV-PREV-STORE               01743100
017432         MOVE CE048-DC-NUMBER     TO  PV-PREV-EFC-STORE           01743200
017433         ADD  1  TO  PV-STORE-CARTON-CNT                          01743300
017440     END-IF                                                       01744000
018400                                                                  01840000
018410     PERFORM 7000-READ-INPUT.                                     01841000
019300                                                                  01930000
019310                                                                  01931000
019400******************************************************************01940000
019410 2000-STORE-NBR-BREAK.                                            01941006
019421                                                                  01942113
019440     SET  PS-NOT-DCSTMF-CSR  TO  TRUE.                            01944000
019441     ADD  1  TO  PV-DISTINCT-STORE-COUNT.                         01944122
019442                                                                  01944222
019443     PERFORM 2500-GET-EFC-NBR.                                    01944322
019444                                                                  01944422
019445     MOVE PV-PREV-STORE         TO  DCSTMF-STR-NBR.               01944522
019446                                                                  01944622
019447     PERFORM 3310-OPEN-DCSTMF-CURSOR                              01944722
019448     PERFORM 3320-FETCH-DCSTMF-CURSOR                             01944822
019449                                                                  01944922
019450     IF DCSTMF-MFST-NBR > 90000000                                01945022
019451        INITIALIZE DCSTMF-MFST-NBR                                01945122
019452        MOVE +1 TO DCSTMF-MFST-NBR                                01945222
019453     END-IF.                                                      01945322
019454                                                                  01945422
019455     COMPUTE PV-MFST-NBR =                                        01945522
019456             DCSTMF-MFST-NBR + 1.                                 01945622
019457                                                                  01945722
019458     ADD  PV-STORE-CARTON-CNT TO DCSTMF-MFST-NBR.                 01945822
019459     MOVE DCSTMF-MFST-NBR     TO PV-END-MFST-NBR.                 01945922
019460     MOVE PV-MFST-NBR         TO PV-START-MFST-NBR.               01946022
019461                                                                  01946122
019462     PERFORM 3330-UPDATE-TDCSTMF                                  01946222
019463     PERFORM 3340-CLOSE-DCSTMF-CURSOR.                            01946322
019464     PERFORM 3500-COMMIT.                                         01946426
019465                                                                  01946522
019466     SET  PS-EOF-DCSTMF-CSR           TO  TRUE.                   01946622
019467     MOVE  0  TO  PV-STORE-CARTON-CNT.                            01946722
019468                                                                  01946822
019469                                                                  01946922
019470******************************************************************01947022
019471*                                                                 01947122
019472******************************************************************01947222
019473 2500-GET-EFC-NBR.                                                01947322
019474                                                                  01947422
019477     MOVE PV-PREV-EFC-STORE  TO  XLT00010-LOC-NBR.                01947715
019478                                                                  01947815
019479     EXEC SQL                                                     01947915
019480         SELECT A.DC_NBR                                          01948015
019481           INTO :XLT00014-DC-NBR                                  01948115
019482           FROM XLT_DC_LOC_ASGMT A                                01948215
019483              , XLT_LOC          B                                01948315
019484          WHERE A.LOC_NBR  =  :XLT00010-LOC-NBR                   01948415
019485            AND A.DC_NBR   =  B.LOC_NBR                           01948515
019486            AND B.LOC_TYP_CDE  =  'DC'                            01948615
019487            AND B.E_BUS_IND    =  'Y'                             01948715
019488            AND A.EFF_BEG_DTE IN                                  01948816
019489               (SELECT MAX(AA.EFF_BEG_DTE)                        01948916
019490                  FROM XLT_DC_LOC_ASGMT AA                        01949016
019491                 WHERE A.LOC_NBR  =  AA.LOC_NBR                   01949116
019492                   AND A.EFF_BEG_DTE <= CURRENT DATE)             01949216
019493     END-EXEC.                                                    01949315
019494                                                                  01949415
019495     EVALUATE TRUE                                                01949515
019496         WHEN SQLCODE = ZERO                                      01949615
019497              MOVE  XLT00014-DC-NBR   TO  PV-PREV-EFC             01949715
019498                                                                  01949815
019499         WHEN OTHER                                               01949915
019500           MOVE '2500-GET-EFC-NBR        ' TO PV-ABEND-PARAGRAPH  01950018
019501           MOVE 'XLT00014' TO PV-DB2-TABLE-NAME                   01950115
019502           MOVE 'FETCH CURSOR          '                          01950215
019503                          TO PV-DB2-OPERATION-MESSAGE-1           01950315
019504           STRING 'STORE:' PV-PREV-STORE                          01950415
019505                  '  E-STORE:' PV-PREV-EFC-STORE                  01950515
019506             DELIMITED BY SIZE                                    01950615
019507             INTO PV-DB2-OPERATION-MESSAGE-2                      01950715
019508           PERFORM 9900-DB2-ABEND                                 01950815
019509     END-EVALUATE.                                                01950915
019510                                                                  01951015
019511                                                                  01951115
019512                                                                  01951215
019513                                                                  01951315
019514******************************************************************01951415
019515*  3310-OPEN-DCSTMF-CURSOR.                                       01951515
019516******************************************************************01951615
019517 3310-OPEN-DCSTMF-CURSOR.                                         01951715
019518                                                                  01951815
019521     EXEC SQL                                                     01952115
019522         OPEN DCSTMF_CSR                                          01952215
019523     END-EXEC.                                                    01952315
019524                                                                  01952415
019525     EVALUATE TRUE                                                01952515
019526         WHEN SQLCODE = ZERO                                      01952615
019527              CONTINUE                                            01952715
019528                                                                  01952815
019529         WHEN OTHER                                               01952915
019530           MOVE '3310-OPEN-DCSTMF-CURSOR ' TO PV-ABEND-PARAGRAPH  01953018
019531           MOVE 'TDCSTMF' TO PV-DB2-TABLE-NAME                    01953115
019532           MOVE 'OPEN CURSOR           '                          01953215
019533                          TO PV-DB2-OPERATION-MESSAGE-1           01953315
019534           STRING 'STORE:  ' PV-PREV-STORE                        01953415
019535             DELIMITED BY SIZE                                    01953515
019536             INTO PV-DB2-OPERATION-MESSAGE-2                      01953615
019537           PERFORM 9900-DB2-ABEND                                 01953715
019538     END-EVALUATE.                                                01953815
019539                                                                  01953915
019540                                                                  01954015
019541******************************************************************01954115
019542*  3320-FETCH-DCSTMF-CURSOR.                                      01954215
019543******************************************************************01954315
019544 3320-FETCH-DCSTMF-CURSOR.                                        01954415
019545                                                                  01954515
019548     EXEC SQL                                                     01954815
019549         FETCH DCSTMF_CSR                                         01954915
019550          INTO :DCSTMF-MFST-NBR                                   01955015
019551     END-EXEC.                                                    01955115
019552                                                                  01955215
019553     EVALUATE TRUE                                                01955315
019554         WHEN SQLCODE = ZERO                                      01955415
019555              MOVE DCSTMF-MFST-NBR  TO  PV-BEFORE-MFST-NBR        01955525
019581                                                                  01958100
019582         WHEN OTHER                                               01958200
019583           MOVE '3320-FETCH-DCSTMF-CURSOR' TO PV-ABEND-PARAGRAPH  01958318
019584           MOVE 'TDCSTMF' TO PV-DB2-TABLE-NAME                    01958400
019585           MOVE 'FETCH CURSOR          '                          01958500
019586                          TO PV-DB2-OPERATION-MESSAGE-1           01958600
019587           STRING 'STORE:  ' PV-PREV-STORE                        01958700
019588             DELIMITED BY SIZE                                    01958800
019589             INTO PV-DB2-OPERATION-MESSAGE-2                      01958900
019590           PERFORM 9900-DB2-ABEND                                 01959000
019591     END-EVALUATE.                                                01959100
019592                                                                  01959200
019593                                                                  01959300
019594******************************************************************01959400
019595*  3330-UPDATE-TDCSTMF.                                           01959500
019596******************************************************************01959600
019597 3330-UPDATE-TDCSTMF.                                             01959700
019598                                                                  01959813
019599     MOVE PV-BEFORE-MFST-NBR TO PV-DISP-BEFORE-MFST-NBR.          01959924
019600     MOVE DCSTMF-MFST-NBR    TO PV-DISP-AFTER-MFST-NBR.           01960024
019601                                                                  01960124
019602     EXEC SQL                                                     01960226
019603          UPDATE TDCSTMF                                          01960326
019604             SET MFST_NBR   = :DCSTMF-MFST-NBR                    01960426
019605           WHERE CURRENT OF DCSTMF_CSR                            01960526
019606     END-EXEC.                                                    01960626
019607                                                                  01960726
019608     EVALUATE TRUE                                                01960826
019609         WHEN SQLCODE = ZERO                                      01960926
019610             ADD +1 TO PV-TDCSTMF-UPDATED                         01961008
019611             DISPLAY 'STORE: '  PV-PREV-STORE                     01961100
019612                     ' EFC: '   PV-PREV-EFC-STORE                 01961200
019613                     '/'        PV-PREV-EFC                       01961323
019614                     ' COUNT: ' PV-STORE-CARTON-CNT               01961407
019615                     ' START: ' PV-START-MFST-NBR                 01961507
019616                     ' END: '   PV-END-MFST-NBR                   01961620
019617                     ' BEF: '   PV-DISP-BEFORE-MFST-NBR           01961724
019618                     ' AFT: '   PV-DISP-AFTER-MFST-NBR            01961824
019619                                                                  01961924
019620             PERFORM 8000-WRITE-OUTPUT                            01962026
019621                                                                  01962124
019622         WHEN OTHER                                               01962226
019623           MOVE '3330-UPDATE-DCSTMF      ' TO PV-ABEND-PARAGRAPH  01962326
019624           MOVE 'TDCSTMF' TO PV-DB2-TABLE-NAME                    01962426
019625           MOVE 'FETCH CURSOR          '                          01962526
019626                          TO PV-DB2-OPERATION-MESSAGE-1           01962626
019627           STRING 'STORE:  ' PV-PREV-STORE                        01962726
019628             DELIMITED BY SIZE                                    01962826
019629             INTO PV-DB2-OPERATION-MESSAGE-2                      01962926
019630           PERFORM 9900-DB2-ABEND                                 01963026
019631     END-EVALUATE.                                                01963126
019640                                                                  01964024
019664                                                                  01966400
019665******************************************************************01966500
019666*  3340-CLOSE-DCSTMF-CURSOR.                                      01966600
019667******************************************************************01966700
019668 3340-CLOSE-DCSTMF-CURSOR.                                        01966800
019669                                                                  01966913
019672     EXEC SQL                                                     01967200
019673         CLOSE DCSTMF_CSR                                         01967300
019674     END-EXEC.                                                    01967400
019675                                                                  01967500
019676     EVALUATE TRUE                                                01967600
019677         WHEN SQLCODE = ZERO                                      01967700
019678              CONTINUE                                            01967800
019679                                                                  01967900
019680         WHEN OTHER                                               01968000
019681           MOVE '3340-CLOSE-DCSTMF-CURSOR' TO PV-ABEND-PARAGRAPH  01968118
019682           MOVE 'TDCSTMF' TO PV-DB2-TABLE-NAME                    01968200
019683           MOVE 'CLOSE CURSOR          '                          01968300
019684                          TO PV-DB2-OPERATION-MESSAGE-1           01968400
019685           STRING 'STORE:  ' PV-PREV-STORE                        01968500
019686             DELIMITED BY SIZE                                    01968600
019687             INTO PV-DB2-OPERATION-MESSAGE-2                      01968700
019688           PERFORM 9900-DB2-ABEND                                 01968800
019689     END-EVALUATE.                                                01968900
019690                                                                  01969000
019691                                                                  01969100
019692******************************************************************01969200
019693*    COMMIT                                                       01969310
019694******************************************************************01969400
019695 3500-COMMIT.                                                     01969526
019696                                                                  01969626
019697     EXEC SQL                                                     01969726
019698         COMMIT                                                   01969826
019699     END-EXEC.                                                    01969926
019700                                                                  01970000
019701                                                                  01970110
019702******************************************************************01970210
019703*                                                                *01970310
019704******************************************************************01970410
019705 7000-READ-INPUT.                                                 01970510
019706                                                                  01970613
019709     READ CE-ERROR-DATA-FILE                                      01970910
019710          INTO CE048-PULL-BRCD-EXTRACT-REC                        01971010
019711            AT END                                                01971110
019712               SET PS-END-OF-FILE-YES TO TRUE.                    01971200
019720                                                                  01972000
019730     IF PS-END-OF-FILE-NO                                         01973000
019740        ADD +1 TO PV-INPUT-COUNT                                  01974000
019750     END-IF.                                                      01975000
019800                                                                  01980000
019900                                                                  01990000
020000******************************************************************02000000
020100*                                                                *02010000
020200******************************************************************02020000
020300 8000-WRITE-OUTPUT.                                               02030000
020301                                                                  02030113
020304     MOVE SPACES  TO  IR-CONTROL-RECORD.                          02030400
020305                                                                  02030500
020320     MOVE PV-PREV-STORE           TO  IR-STORE-NBR                02032000
020350     MOVE '00410'                 TO  IR-START-SML-1-5            02035011
020360     MOVE PV-PREV-STORE           TO  IR-START-SML-STORE          02036000
020370     MOVE PV-PREV-EFC             TO  IR-START-SML-DC             02037011
020380     MOVE PV-START-MFST-NBR       TO  IR-START-SML-13-20          02038011
020391                                                                  02039100
020400                                                                  02040000
020500     WRITE CE-ERROR-DATA-FILE-REC-OUT                             02050000
020600          FROM IR-CONTROL-RECORD.                                 02060000
020900                                                                  02090000
021100        ADD +1 TO PV-OUTPUT-COUNT.                                02110000
021300                                                                  02130000
021400                                                                  02140000
027200******************************************************************02720000
027300 9900-DB2-ABEND.                                                  02730000
027400******************************************************************02740000
027600                                                                  02760000
027700     MOVE SQLCODE TO PV-SQLCODE.                                  02770000
027800     DISPLAY '*** DB2 ERROR '.                                    02780000
027900     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02790000
028000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02800000
028100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02810000
028200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02820000
028300     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02830000
028400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02840000
028500     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME.                02850000
028600                                                                  02860000
028700     COPY DPPD004.                                                02870000
028800                                                                  02880000
028900     MOVE +4013 TO PV-ABEND-CODE.                                 02890000
029000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02900000
029100                                                                  02910000
029200******************************************************************02920000
029300******************************************************************02930000
