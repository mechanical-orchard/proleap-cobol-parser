000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             RCKUT167.                                00030000
000400 AUTHOR.                 DENISE HAHN.                             00040000
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN.           APRIL, 2017.                             00060000
000700 DATE-COMPILED.                                                   00070000
000800***************************************************************** 00080000
000900*  THIS PROGRAM CHECK THE INPUT FILE CREATED BY MPK060, THAT    * 00090000
001000*  CONTAINS ONLY CR RECEIVERS.  FOR EACH RECEIVER IT WILL LOOK  * 00100000
001100*  AT TRECEIV AND BYPASS ANY RECORDS WITH A CRE_UID = PTL-FSA   * 00110000
001200*  THE CR RECEIVERS THAT HAVE A CRE_UID ARE NOW ON A SEPARATE   * 00120000
001300*  REPORT (RCK011-RCKRP088 & RCKRP089)                          * 00130000
001600***************************************************************** 00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800 CONFIGURATION SECTION.                                           00180000
001900                                                                  00190000
002000 SOURCE-COMPUTER.        IBM-3090.                                00200000
002100 OBJECT-COMPUTER.        IBM-3090.                                00210000
002200                                                                  00220000
002300***************************************************************** 00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT STORE-EXTRACT-FILE                                    00280000
002900         ASSIGN TO INP01.                                         00290000
003000                                                                  00300000
003010     SELECT OUT-FILE                                              00301000
003020         ASSIGN TO OUT01.                                         00302000
003030                                                                  00303000
003100***************************************************************** 00310000
003200 DATA DIVISION.                                                   00320000
003300***************************************************************** 00330000
003400 FILE SECTION.                                                    00340000
003410                                                                  00341000
003420 FD  STORE-EXTRACT-FILE                                           00342000
003430     RECORDING MODE IS F                                          00343000
003440     LABEL RECORDS ARE STANDARD                                   00344000
003450     BLOCK CONTAINS 0 RECORDS                                     00345000
003460     RECORD CONTAINS 300 CHARACTERS                               00346000
003470     DATA RECORD IS STORE-EXTRACT-RECORD.                         00347000
003480                                                                  00348000
003490 01  STORE-EXTRACT-RECORD        PIC X(300).                      00349000
003491                                                                  00349100
003500                                                                  00350000
003600 FD  OUT-FILE                                                     00360000
003700     RECORDING MODE IS F                                          00370000
003800     BLOCK CONTAINS 0  RECORDS.                                   00380000
003900 01  OUT-FILE-RECORD                 PIC X(300).                  00390006
004000                                                                  00400000
004100***************************************************************** 00410000
004200 WORKING-STORAGE SECTION.                                         00420000
004300*                                                                 00430000
004400 01  PROGRAM-SWITCHES.                                            00440000
004500     05  PS-EOF-INPUT-SW              PIC X(01) VALUE 'N'.        00450002
004600         88  PS-EOF-INPUT                       VALUE 'Y'.        00460000
004700         88  PS-NOT-EOF-INPUT                   VALUE 'N'.        00470000
004800*    05  PS-VALID-PO-SW               PIC X(01) VALUE 'N'.        00480000
004900*        88  PS-VALID-PO                        VALUE 'Y'.        00490000
005000*        88  PS-NOT-VALID-PO                    VALUE 'N'.        00500000
005100*    05  PS-VALID-PO-LINE-SW          PIC X(01) VALUE 'N'.        00510000
005200*        88  PS-VALID-PO-LINE                   VALUE 'Y'.        00520000
005300*        88  PS-NOT-VALID-PO-LINE               VALUE 'N'.        00530000
005400                                                                  00540000
005500 01  PC-PROGRAM-CONSTANTS.                                        00550000
005600     05  PC-RCKUT167                 PIC X(08) VALUE              00560000
005700                                               'RCKUT167'.        00570000
005710     05  PC-PTL-FSA                  PIC X(07) VALUE              00571000
005720                                               'PTL-FSA'.         00572000
006300*                                                                 00630000
006400 01  PV-PROGRAM-VARIABLES.                                        00640000
006500                                                                  00650000
006600     05  PV-READ-COUNT               PIC 9(09)  VALUE ZERO.       00660000
006800     05  PV-WRITE-COUNT              PIC 9(09)  VALUE ZERO.       00680000
006810     05  PV-BYPASS-COUNT             PIC 9(09)  VALUE ZERO.       00681000
008100*                                                                 00810000
008200     05  PV-DISP-SQLCODE             PIC -999.                    00820003
008210     05  PV-DISP-OPER                PIC 9(04).                   00821004
008211     05  PV-DISP-PO                  PIC 9(09).                   00821104
008220     05  PV-DISP-RCVR                PIC 9(04).                   00822003
008230     05  PV-DISP-READ-CNT            PIC ZZZ,ZZZ,ZZ9.             00823003
008300     05  PV-DISP-WRITE-CNT           PIC ZZZ,ZZZ,ZZ9.             00830002
008310     05  PV-DISP-BYPASS-CNT          PIC ZZZ,ZZZ,ZZ9.             00831002
008400                                                                  00840000
008500 01  PV-ABEND-FIELDS.                                             00850000
008600     05  PV-ABEND-CODE               PIC S9(4) VALUE +0           00860000
008700                                               COMP SYNC.         00870000
008800     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'RCKUT167'.  00880000
008900     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      00890000
009000     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.      00900000
009100     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      00910000
009200     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      00920000
009300     05  PV-DB2-OPERATION-MESSAGE-2  PIC X(79) VALUE SPACES.      00930000
009400     05  PV-DB2-OPERATION-MESSAGE-3  PIC X(79) VALUE SPACES.      00940000
009500     05  PV-DB2-OPERATION-MESSAGE-4  PIC X(79) VALUE SPACES.      00950000
009600     05  PV-DB2-TABLE-NAME-1         PIC X(08) VALUE SPACES.      00960000
009700     05  PV-DB2-TABLE-NAME-2         PIC X(08) VALUE SPACES.      00970000
009800                                                                  00980000
010400*----------------------------------------------------------------*01040000
010500* INPUT & OUTPUT RECORD LAYOUT                                    01050000
010600*----------------------------------------------------------------*01060000
010700     COPY STOREEXT.                                               01070000
010800                                                                  01080000
010900*----------------------------------------------------------------*01090000
011000*  USED FOR DB2 ERROR MESSAGE BUILDING                            01100000
011100*----------------------------------------------------------------*01110000
011200     COPY DPWS004.                                                01120000
011300                                                                  01130000
016300*---------------------------------------------------------------* 01630000
016400*  TRECEIV                                                        01640000
016500*---------------------------------------------------------------* 01650000
016600     EXEC SQL                                                     01660000
016700         INCLUDE TRECEIV                                          01670000
016800     END-EXEC.                                                    01680000
016900                                                                  01690000
024262*----------------------------------------------------------------*02426200
024263*   DB2 SQL COMMUNICATION AREA                                    02426300
024264*----------------------------------------------------------------*02426400
024265     EXEC SQL                                                     02426500
024266          INCLUDE SQLCA                                           02426600
024267     END-EXEC.                                                    02426700
024268                                                                  02426800
024269******************************************************************02426900
024270                                                                  02427000
024280 PROCEDURE DIVISION.                                              02428000
024290     DISPLAY '**** START OF RCKUT167 ****'.                       02429000
024300                                                                  02430000
024400*OPEN FILES.                                                      02440000
024500     OPEN INPUT  STORE-EXTRACT-FILE                               02450001
024510          OUTPUT OUT-FILE.                                        02451001
024600                                                                  02460000
024700     SET   PS-NOT-EOF-INPUT       TO  TRUE.                       02470001
024800                                                                  02480000
024900     PERFORM 1000-INITIALIZATION.                                 02490000
025000                                                                  02500000
025100     PERFORM 2000-PROCESS-INPUT                                   02510000
025200       UNTIL PS-EOF-INPUT.                                        02520001
025300                                                                  02530000
025400     MOVE PV-READ-COUNT    TO  PV-DISP-READ-CNT                   02540002
025410     MOVE PV-WRITE-COUNT   TO  PV-DISP-WRITE-CNT                  02541002
025420     MOVE PV-BYPASS-COUNT  TO  PV-DISP-BYPASS-CNT                 02542002
025430                                                                  02543002
025500     DISPLAY '***'                                                02550000
025600     DISPLAY '*** INPUT COUNT      :  ' PV-DISP-READ-CNT          02560002
025700     DISPLAY '*** '                                               02570000
025800     DISPLAY '*** OUTPUT FILE COUNT:  ' PV-DISP-WRITE-CNT         02580002
026000     DISPLAY '*** '                                               02600000
026200     DISPLAY '*** BYPASS COUNT     :  ' PV-DISP-BYPASS-CNT        02620002
026400     DISPLAY '*** '                                               02640000
027100                                                                  02710000
027400*CLOSE FILES.                                                     02740000
027500     CLOSE STORE-EXTRACT-FILE                                     02750001
027510           OUT-FILE.                                              02751001
027600                                                                  02760000
027700     GOBACK.                                                      02770000
027800                                                                  02780000
027900******************************************************************02790000
028000*  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               *02800000
028100******************************************************************02810000
028200 1000-INITIALIZATION.                                             02820000
028300     DISPLAY '1000-INITIALIZE '.                                  02830000
028400                                                                  02840000
028500     PERFORM 7100-READ-EXTRACT-FILE.                              02850002
028700                                                                  02870000
028800                                                                  02880002
028900******************************************************************02890000
029000**                                                                02900002
029100**                                                                02910002
029300******************************************************************02930000
029400 2000-PROCESS-INPUT.                                              02940002
029500                                                                  02950002
034800     PERFORM 4000-CHECK-CREATE-USERID.                            03480002
034900                                                                  03490002
035100     IF  RECEIV-CRE-UID  =  PC-PTL-FSA                            03510002
035101         ADD  1  TO  PV-BYPASS-COUNT                              03510102
035102             MOVE  SE-OPER-UNT-ID  TO  PV-DISP-OPER               03510204
035103             MOVE  SE-PO           TO  PV-DISP-PO                 03510304
035104             MOVE  SE-REC-SEQ-NBR  TO  PV-DISP-RCVR               03510404
035105             DISPLAY 'BYPASS - P2L-FSA: '                         03510504
035106                     '  '              PV-DISP-OPER               03510604
035107                     '-'               PV-DISP-PO                 03510704
035108                     '-'               PV-DISP-RCVR               03510804
035109     ELSE                                                         03510904
035110         PERFORM 8000-WRITE-OUTPUT                                03511004
035111     END-IF                                                       03511104
035112                                                                  03511204
035120     PERFORM 7100-READ-EXTRACT-FILE.                              03512002
036800                                                                  03680002
036900                                                                  03690002
037000 4000-CHECK-CREATE-USERID.                                        03700003
037100                                                                  03710002
037200     MOVE '4000-CHECK-CREATE-USERID'                              03720002
037300         TO PV-ABEND-PARAGRAPH.                                   03730002
037400     MOVE 'SELECT TRECEIV'                                        03740002
037500         TO PV-ABEND-OPERATION.                                   03750002
037600                                                                  03760002
037610     MOVE SE-PO                     TO  RECEIV-ORD-NBR.           03761002
037611     MOVE SE-REC-SEQ-NBR            TO  RECEIV-REC-SEQ-NBR.       03761102
037620                                                                  03762002
037700     EXEC SQL                                                     03770002
037800          SELECT  CRE_UID                                         03780002
037900            INTO :RECEIV-CRE-UID                                  03790002
038000            FROM  TRECEIV                                         03800002
038100           WHERE  ORD_NBR           = :RECEIV-ORD-NBR             03810002
038200             AND  REC_SEQ_NBR       = :RECEIV-REC-SEQ-NBR         03820002
038300            WITH UR                                               03830002
038400     END-EXEC.                                                    03840002
038500                                                                  03850002
038600     EVALUATE TRUE                                                03860002
038700         WHEN SQLCODE = ZERO                                      03870002
038710              CONTINUE                                            03871002
038800         WHEN SQLCODE = +100                                      03880002
038900              MOVE SPACES  TO  RECEIV-CRE-UID                     03890002
039700         WHEN SQLWARN0 NOT = SPACE                                03970002
039800         WHEN SQLCODE < ZERO                                      03980002
039900         WHEN SQLCODE > ZERO                                      03990002
040000             MOVE  SQLCODE         TO  PV-DISP-SQLCODE            04000002
040010             MOVE  SE-OPER-UNT-ID  TO  PV-DISP-OPER               04001004
040011             MOVE  SE-PO           TO  PV-DISP-PO                 04001104
040020             MOVE  SE-REC-SEQ-NBR  TO  PV-DISP-RCVR               04002002
040100             DISPLAY 'ABEND INFO - KEY DATA'                      04010002
040200                     'PO:'             PV-DISP-OPER               04020004
040201                     '-'               PV-DISP-PO                 04020105
040210                     '-'               PV-DISP-RCVR               04021002
040300             DISPLAY 'SQL CODE IS: '  PV-DISP-SQLCODE             04030002
040400             PERFORM 9900-DB2-ABEND                               04040002
040500     END-EVALUATE.                                                04050002
040600                                                                  04060002
040610                                                                  04061002
048605******************************************************************04860502
048606* 7100-READ-EXTRACT-FILE.                                         04860602
048607******************************************************************04860702
048608 7100-READ-EXTRACT-FILE.                                          04860802
048609                                                                  04860902
048610     READ STORE-EXTRACT-FILE                                      04861002
048611         INTO STORE-EXTRACT-LINE                                  04861102
048612         AT END                                                   04861202
048613             SET PS-EOF-INPUT  TO  TRUE                           04861302
048614         NOT AT END                                               04861402
048615             ADD  1            TO  PV-READ-COUNT                  04861502
048616     END-READ.                                                    04861602
048617                                                                  04861702
048618                                                                  04861802
048619******************************************************************04861900
048620*                                                                *04862000
048621******************************************************************04862100
048622 8000-WRITE-OUTPUT.                                               04862202
048623                                                                  04862302
048624     WRITE OUT-FILE-RECORD                                        04862402
048625      FROM STORE-EXTRACT-LINE                                     04862502
048630     ADD +1 TO PV-WRITE-COUNT.                                    04863002
048640                                                                  04864002
048650******************************************************************04865000
048660*  ABEND ROUTINE                                                 *04866000
048670******************************************************************04867000
048680 9900-DB2-ABEND.                                                  04868002
048690                                                                  04869002
048700     MOVE SQLCODE TO PV-DISP-SQLCODE.                             04870002
048800     DISPLAY '*** DB2 ERROR '.                                    04880002
048900     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  04890002
049000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04900002
049100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04910002
049200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               04920002
049300     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       04930002
049400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       04940002
049500     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME-1.              04950002
049600     DISPLAY '*** TABLE 2   = ' PV-DB2-TABLE-NAME-2.              04960002
049700                                                                  04970002
049800     COPY DPPD004.                                                04980002
049900                                                                  04990002
050000     MOVE +4013 TO PV-ABEND-CODE.                                 05000002
050100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05010002
050200                                                                  05020002
050300*9999-ABEND.                                                      05030002
050400*                                                                 05040002
050500*    DISPLAY '***************'.                                   05050002
050600*    DISPLAY '** ABEND     **'.                                   05060002
050700*    DISPLAY '** PROGRAM   ** = ' PV-ABEND-PROGRAM.               05070002
050800*    DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05080002
050900*    DISPLAY '***************'.                                   05090002
051000*                                                                 05100002
051100*    MOVE +4008                  TO PV-ABEND-CODE.                05110002
051200*    CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05120002
051300*                                                                 05130002
051400******************************************************************05140000
051500*                 E N D   O F   P R O G R A M                    *05150000
051600******************************************************************05160000
