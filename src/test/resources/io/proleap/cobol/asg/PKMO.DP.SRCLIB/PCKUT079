000500 IDENTIFICATION DIVISION.                                         00010001
000600 PROGRAM-ID.    PCKUT079.                                         00020001
000700 AUTHOR.        DENISE HAHN                                       00030001
000800 INSTALLATION.  KOHLS.                                            00040001
000900 DATE-WRITTEN   FEBRUARY, 2008.                                   00050001
001000 DATE-COMPILED.                                                   00060001
001100******************************************************************00070001
001200* THIS PROGRAM WILL TAKE IN THE PCRD038 (OUT1) OUTPUT FILE FROM   00080001
001300* PCKUT079, (STORE EXPECTED DATA THAT NEEDS TO BE CLEANED UP      00090002
001400* DUE TO PHYSICAL INVENTORY REVERSALS),                           00100001
001500* ACCESS SOME DATA ON A DATABASE AND THEN GENERATE STORE          00110001
001600* CLEAN TRANSACTIONS TO CLEAR UP STORE EXPECTED INFORMATION THAT  00120001
001700* WAS REVERSED FROM THE PHYSICAL INVENTORY ADJUSTMENTS BY THE     00130001
001800* INVENTORY TEAM.  THE FIRST OUTPUT FILE FROM THIS PROGRAM WOULD  00140001
001900* USE COPYBOOK PCRD041.                                           00150001
002000******************************************************************00160001
002100 ENVIRONMENT DIVISION.                                            00170001
002200 CONFIGURATION SECTION.                                           00180001
002300                                                                  00190001
002400 SOURCE-COMPUTER.        IBM-3090.                                00200001
002500 OBJECT-COMPUTER.        IBM-3090.                                00210001
002600                                                                  00220001
002700 INPUT-OUTPUT SECTION.                                            00230001
002800 FILE-CONTROL.                                                    00240001
002900                                                                  00250001
003000     SELECT STORE-EXPECTED-REVERSALS-IN                           00260001
003100         ASSIGN TO INP01.                                         00270001
003200                                                                  00280001
003300     SELECT STORE-CLEAN-UP-TRANSACTIONS                           00290001
003400         ASSIGN TO OUT01.                                         00300001
003500                                                                  00310001
003600     SELECT STORE-EXPECTED-CLEAN-UP                               00320001
003700         ASSIGN TO OUT02.                                         00330001
003800                                                                  00340001
003900                                                                  00350001
004000******************************************************************00360001
004100 DATA DIVISION.                                                   00370001
004200 FILE SECTION.                                                    00380001
004300                                                                  00390001
004400 FD  STORE-EXPECTED-REVERSALS-IN                                  00400001
004500     RECORDING MODE IS F                                          00410001
004600     LABEL RECORDS ARE STANDARD                                   00420001
004700     BLOCK CONTAINS 0 RECORDS.                                    00430001
004800                                                                  00440001
004900 01  STORE-EXPECT-REVERSAL-RECORD     PIC  X(150).                00450002
005000                                                                  00460002
005001                                                                  00470002
005010                                                                  00480002
005100 FD  STORE-CLEAN-UP-TRANSACTIONS                                  00490001
005200     RECORDING MODE IS F                                          00500001
005300     LABEL RECORDS ARE STANDARD                                   00510001
005400     BLOCK CONTAINS 0 RECORDS.                                    00520001
005500                                                                  00530001
005600 01  SE-CLEAN-UP-TRANS-RECORD   PIC  X(35).                       00540002
005610                                                                  00550002
005611                                                                  00560002
005612                                                                  00570002
005620 FD  STORE-EXPECTED-CLEAN-UP                                      00580002
005630     RECORDING MODE IS F                                          00590002
005640     LABEL RECORDS ARE STANDARD                                   00600002
005650     BLOCK CONTAINS 0 RECORDS.                                    00610002
005660                                                                  00620002
005670 01  SE-CLEAN-UP-RECORD         PIC  X(150).                      00630002
005700*                                                                 00640001
005800******************************************************************00650001
005900 WORKING-STORAGE SECTION.                                         00660001
006000                                                                  00670001
006100*  STORE-EXPECTED-REVERSALS-IN LAYOUT    AND                      00680001
006200*  STORE-EXPECTED-CLEAN-UP     LAYOUT                             00690001
006300******************************************************************00700001
006400     COPY PCRD038.                                                00710001
006500*                                                                 00720001
006600******************************************************************00730001
006700*  STORE-CLEAN-UP-TRANSACTIONS LAYOUT                             00740001
006800******************************************************************00750001
006900     COPY PCRD041.                                                00760001
007000*                                                                 00770001
007100******************************************************************00780001
007200*  COMMUNICATIONS AREA FOR DB2                                    00790001
007300******************************************************************00800001
007400     EXEC SQL                                                     00810001
007500          INCLUDE SQLCA                                           00820001
007600     END-EXEC.                                                    00830001
007700                                                                  00840001
007800     COPY SQLCA2.                                                 00850001
007900     COPY DPWS004.                                                00860001
008000                                                                  00870001
008100*   XLT_SKU TABLE                                                 00880001
008200******************************************************************00890001
008300     EXEC SQL                                                     00900001
008400          INCLUDE XLT00003                                        00910001
008500     END-EXEC.                                                    00920001
008600                                                                  00930001
008700*  PCT_TRAN_CLSN_DTL  (INTRANSIT DETAIL)                          00940001
008800******************************************************************00950001
008900     EXEC SQL                                                     00960001
009000          INCLUDE PCT00015                                        00970001
009100     END-EXEC.                                                    00980001
009200                                                                  00990001
013500******************************************************************01000001
013600 01  PS-PROGRAM-SWITCHES.                                         01010001
013700     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     01020001
013800         88  PS-END-OF-FILE                        VALUE 'Y'.     01030001
013900         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     01040001
013910     05  PS-CLEAN-UP-NEEDED-SW       PIC  X(01)    VALUE 'N'.     01050001
013920         88  PS-CLEAN-UP-NEEDED                    VALUE 'Y'.     01060001
013930         88  PS-NO-CLEAN-UP-NEEDED                 VALUE 'N'.     01070001
013940     05  PS-CLEAN-UP-QTY-SW          PIC  X(01)    VALUE 'N'.     01080003
013950         88  PS-USE-SE-QTY-FOR-CLEANUP             VALUE 'Y'.     01090003
013960         88  PS-USE-CALC-QTY-FOR-CLEANUP           VALUE 'N'.     01100003
014000                                                                  01110001
016000                                                                  01120001
016100 01  PV-PROGRAM-VARIABLES.                                        01130001
016200     05  PV-CURRENT-DATE             PIC  X(10)      VALUE SPACE. 01140001
016300     05  PV-READ-COUNTER             PIC  9(05) COMP VALUE ZEROS. 01150001
016400     05  PV-READ-COUNTER-2           PIC  9(05) COMP VALUE ZEROS. 01160001
016500     05  PV-SE-SUM-QTY               PIC S9(09) COMP VALUE ZEROS. 01170002
016600     05  PV-SE-SUM-QTY-REV           PIC S9(09) COMP VALUE ZEROS. 01180002
016700     05  PV-SE-INTR-UPC-ID           PIC S9(09) COMP VALUE ZEROS. 01190002
016800     05  PV-IT-SUM-QTY               PIC S9(09) COMP VALUE ZEROS. 01200002
016900     05  PV-IT-SUM-QTY-REV           PIC S9(09) COMP VALUE ZEROS. 01210003
017000     05  PV-IT-INTR-UPC-ID           PIC S9(09) COMP VALUE ZEROS. 01220002
017100     05  PV-CU-SUM-QTY               PIC S9(09) COMP VALUE ZEROS. 01230002
017200     05  PV-CU-SUM-QTY-REV           PIC S9(09) COMP VALUE ZEROS. 01240002
017400     05  PV-UNIT-RTL-VALUE           PIC S9(13)V9(2) VALUE ZEROES 01250002
017500                                                COMP-3.           01260002
017600     05  PV-INTRNST-TMST             PIC  X(26)      VALUE SPACES.01270018
017700     05  PV-INTRNST-TMST-R REDEFINES PV-INTRNST-TMST.             01280018
017800         10  PV-INTRNST-DATE             PIC  X(10).              01290018
017900         10  FILLER                      PIC  X(16).              01300018
017978                                                                  01310001
017979     05  PV-DISP-LOC-NBR             PIC  9(04)      VALUE ZEROS. 01320001
017980     05  PV-DISP-PO-NBR              PIC  9(09)      VALUE ZEROS. 01330001
017981     05  PV-DISP-RCVR-SEQ            PIC  9(09)      VALUE ZEROS. 01340003
017982     05  PV-DISP-SKU                 PIC  9(08)      VALUE ZEROS. 01350001
017983     05  PV-DISP-SQLCODE             PIC  +999.                   01360001
017984                                                                  01370001
017985     05  PV-NULL-IND                 PIC S9(04)      VALUE ZEROS  01380001
017986                                                     COMP SYNC.   01390001
017987     05  PV-NULL-IND-2               PIC S9(04)      VALUE ZEROS  01400001
017988                                                     COMP SYNC.   01410001
017989                                                                  01420001
017990     05  PV-DISPLAY-COUNT            PIC  ZZZ,ZZZ,ZZ9.            01430002
017991                                                                  01440009
017992     05  PV-DISP-SE-QTY              PIC  ZZZ,ZZZ,ZZ9-.           01450009
017993     05  PV-DISP-IT-QTY              PIC  ZZZ,ZZZ,ZZ9-.           01460009
017994     05  PV-DISP-CU-QTY              PIC  ZZZ,ZZZ,ZZ9-.           01470009
017995                                                                  01480009
017996     05  PV-ABEND-PARAGRAPH          PIC  X(35) VALUE SPACES.     01490009
017997     05  PV-PARAGRAPH-NAME           PIC  X(30) VALUE SPACES.     01500009
017998     05  PV-ABEND-CODE               PIC S9(04) VALUE ZERO        01510009
017999                                                COMP SYNC.        01520009
018000                                                                  01530009
018001                                                                  01540009
018002     05  PV-CLEAN-UP-RECORDS         PIC  9(09) VALUE ZEROES.     01550009
018003     05  PV-CLEAN-UP-TRANS           PIC  9(09) VALUE ZEROES.     01560009
018004     05  PV-NO-SE-FOUND-COUNT        PIC  9(09) VALUE ZEROES.     01570009
018005     05  PV-SE-QTY-0-COUNT           PIC  9(09) VALUE ZEROES.     01580009
018006     05  PV-IT-GREATER-SE-COUNT      PIC  9(09) VALUE ZEROES.     01590009
018007     05  PV-IT-EQUAL-SE-COUNT        PIC  9(09) VALUE ZEROES.     01600010
018008                                                                  01610010
018009                                                                  01620010
023700                                                                  01630002
023800******************************************************************01640001
023900 PROCEDURE DIVISION.                                              01650001
024000******************************************************************01660001
024100* CONTROLS THE MAIN PROCESSING OF THE  PROGRAM.                   01670001
024200******************************************************************01680001
024300 0000-PROGRAM-MAINLINE.                                           01690001
024400                                                                  01700001
024500     DISPLAY '***** PCKUT079 STARTED *****'.                      01710001
024600                                                                  01720001
024700     PERFORM 1000-INITIALIZE.                                     01730001
024800     PERFORM 2000-PROCESS-STORE-EXPT-FILE                         01740001
024900         UNTIL PS-END-OF-FILE.                                    01750001
025000     PERFORM 9500-EOJ-ROUTINE.                                    01760001
025100                                                                  01770001
025200     STOP RUN.                                                    01780001
025300                                                                  01790001
025400******************************************************************01800001
025500*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01810001
025600*    -- OPEN INPUT FILE                                           01820001
025700*    -- OPEN OUTPUT FILES                                         01830001
025800*    -- READ INPUT FILE                                           01840001
025900******************************************************************01850001
026000 1000-INITIALIZE.                                                 01860001
026100                                                                  01870001
026200     PERFORM 1015-SET-CURRENT-DATE.                               01880001
026300                                                                  01890001
026400     OPEN INPUT  STORE-EXPECTED-REVERSALS-IN.                     01900001
026500     OPEN OUTPUT STORE-CLEAN-UP-TRANSACTIONS                      01910001
026600                 STORE-EXPECTED-CLEAN-UP.                         01920001
026700                                                                  01930001
026800     PERFORM 9000-READ-FILE.                                      01940001
027000                                                                  01950001
027010                                                                  01960003
027100******************************************************************01970001
027200* SET THE CURRENT DATE.                                           01980001
027300******************************************************************01990001
027400 1015-SET-CURRENT-DATE.                                           02000001
027500                                                                  02010001
027600     EXEC SQL                                                     02020001
027700         SET :PV-CURRENT-DATE = CURRENT DATE                      02030001
027800     END-EXEC                                                     02040001
027900                                                                  02050001
028000     EVALUATE TRUE                                                02060001
028100        WHEN SQLCODE = ZERO                                       02070001
028110             DISPLAY 'CURRENT DATE:' PV-CURRENT-DATE              02080002
028300                                                                  02090001
028400        WHEN SQLWARN0 NOT = SPACES                                02100001
028500        WHEN SQLCODE  NOT = ZERO                                  02110001
028600            DISPLAY '**************************************'      02120001
028700            DISPLAY '** ABEND                            **'      02130001
028800            DISPLAY '** PROGRAM = PCKUT079               **'      02140001
028900            DISPLAY '** PARAGRAPH = 1015-SET-CURRENT-DATE**'      02150001
029000            DISPLAY '** SET CURRENT DATE                 **'      02160001
029100            DISPLAY '** SQLCODE = ' SQLCODE                       02170001
029200            DISPLAY '**************************************'      02180001
029300            PERFORM 9900-SQL-ERROR                                02190002
029400     END-EVALUATE.                                                02200001
029410                                                                  02210002
029500******************************************************************02220001
029600*  PROCESS INPUT UNTIL END OF FILE.                               02230001
029700******************************************************************02240014
029800 2000-PROCESS-STORE-EXPT-FILE.                                    02250001
029900                                                                  02260001
029910     SET  PS-NO-CLEAN-UP-NEEDED  TO  TRUE.                        02270002
029911                                                                  02280016
029912     MOVE  ZEROS         TO PV-SE-SUM-QTY                         02290016
029913     MOVE  ZEROS         TO PV-SE-SUM-QTY-REV                     02300016
029914     MOVE  ZEROS         TO PV-SE-INTR-UPC-ID                     02310016
029915     MOVE  ZEROS         TO PV-IT-SUM-QTY                         02320016
029916     MOVE  ZEROS         TO PV-IT-SUM-QTY-REV                     02330016
029917     MOVE  ZEROS         TO PV-IT-INTR-UPC-ID                     02340016
029918     MOVE  ZEROS         TO PV-CU-SUM-QTY                         02350016
029919     MOVE  ZEROS         TO PV-CU-SUM-QTY-REV                     02360016
029920     MOVE  ZEROS         TO PV-UNIT-RTL-VALUE                     02370016
029930                                                                  02380001
030000     PERFORM 3000-CHECK-UNBALANCED-QTY.                           02390002
030100                                                                  02400001
030110     IF  PS-CLEAN-UP-NEEDED                                       02410002
030200         PERFORM 3010-CHECK-UNBALANCED-INTRNST                    02420002
030210     END-IF.                                                      02430002
030220                                                                  02440001
030221     PERFORM 4015-GET-INTRNST-DATE.                               02450024
030222                                                                  02460024
030230     IF  PS-CLEAN-UP-NEEDED  AND                                  02470016
030231         PC038-POST-INV-REVERSE                                   02480016
030240         PERFORM 4000-BUILD-CLEAN-UP-TRANS                        02490002
030241         PERFORM 9100-WRITE-OUTPUT-PCRD041                        02500016
030242     END-IF.                                                      02510016
030243                                                                  02520016
030244     PERFORM 4010-BUILD-CLEAN-UP-RECORD                           02530016
030251     PERFORM 9110-WRITE-OUTPUT-PCRD038                            02540016
033300                                                                  02550001
033400     PERFORM 9000-READ-FILE.                                      02560001
033500                                                                  02570001
033600******************************************************************02580001
033700*  USING THE SKU, STORE, PO AND RCVR CHECK TO SEE IF THERE IS     02590001
033800*  STILL UNBALANCED STORE EXPECTED QUANTIES FOR THIS              02600001
033900*  SKU/STORE/PO/RECEIVER                                          02610001
034000******************************************************************02620001
034100 3000-CHECK-UNBALANCED-QTY.                                       02630001
034200                                                                  02640001
034300     MOVE '3000-CHECK-UNBALANCED-QTY'  TO  PV-ABEND-PARAGRAPH.    02650002
034400                                                                  02660001
034510     SET  PS-NO-CLEAN-UP-NEEDED  TO  TRUE.                        02670001
034520     MOVE  PC038-LOC-NBR  TO  PCT00015-LOC-NBR.                   02680006
034600                                                                  02690001
034700     EXEC SQL                                                     02700001
034800         SELECT SUM(B.TRN_CLSN_PRCG_QTY)                          02710001
034900               ,SUM(B.TRN_CLSN_PRCG_QTY) * -1                     02720001
035000               ,A.INTR_UPC_ID                                     02730001
035100           INTO :PV-SE-SUM-QTY         :PV-NULL-IND               02740005
035200              , :PV-SE-SUM-QTY-REV     :PV-NULL-IND-2             02750005
035300              , :PV-SE-INTR-UPC-ID                                02760002
035400           FROM XLT_SKU  A                                        02770001
035500              , PCT_TRN_CLSN_DTL B                                02780001
035600          WHERE A.SKU_NBR         =  :PC038-SKU-9                 02790038
035700            AND B.INTR_UPC_ID     =   A.INTR_UPC_ID               02800038
035800            AND B.LOC_NBR         =  :PCT00015-LOC-NBR            02810038
035900            AND B.PO_NBR          =  :PC038-PO-NBR                02820038
036000            AND B.RCVR_SEQ_NBR    =  :PC038-RCVR-SEQ-NBR          02830038
036100            AND B.TRN_CLSN_CDE    =  'SE'                         02840038
164325            AND B.TRN_TYP_CDE NOT IN ('UM', 'NS', 'MM',           02850044
164325                                      'AM', 'SM')                 02860044
036110          GROUP BY A.INTR_UPC_ID                                  02870007
036200     END-EXEC.                                                    02880001
036300                                                                  02890001
036400     EVALUATE TRUE                                                02900001
036500         WHEN SQLCODE = ZERO                                      02910033
036510              IF  PV-NULL-IND    =  -1                            02920013
036520                  MOVE ZEROES  TO  PV-SE-SUM-QTY                  02930013
036530              END-IF                                              02940013
036531                                                                  02950001
036540              IF  PV-NULL-IND-2  =  -1                            02960013
036550                  MOVE ZEROES  TO  PV-SE-SUM-QTY-REV              02970013
036560              END-IF                                              02980013
036570                                                                  02990001
036580              IF  PV-SE-SUM-QTY  =  ZERO                          03000002
036590                  SET  PS-NO-CLEAN-UP-NEEDED  TO  TRUE            03010003
036591                  ADD  1  TO  PV-SE-QTY-0-COUNT                   03020003
036592                                                                  03030009
036593***               MOVE PC038-LOC-NBR      TO PV-DISP-LOC-NBR      03040033
036594***               MOVE PC038-PO-NBR       TO PV-DISP-PO-NBR       03050033
036595***               MOVE PC038-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ     03060033
036596***               MOVE PC038-SKU-9        TO PV-DISP-SKU          03070033
036597***               MOVE PV-SE-SUM-QTY      TO PV-DISP-SE-QTY       03080033
036598***                                                               03090033
036599***               DISPLAY 'STORE EXPECTED = 0      - '            03100033
036600***                       'SKU:'     PV-DISP-SKU     '  '         03110033
036601***                       'STORE:'   PV-DISP-LOC-NBR  '  '        03120033
036602***                       'PO-RCVR:' PV-DISP-PO-NBR               03130033
036603***                       '-'        PV-DISP-RCVR-SEQ             03140033
036604***                       ' SE:'     PV-DISP-SE-QTY               03150033
036605***                                                               03160033
036606              ELSE                                                03170009
036610                  SET  PS-CLEAN-UP-NEEDED     TO  TRUE            03180003
036700              END-IF                                              03190001
038600                                                                  03200001
038700         WHEN SQLCODE = +100                                      03210001
038800              MOVE PC038-LOC-NBR       TO PV-DISP-LOC-NBR         03220001
038900              MOVE PC038-PO-NBR        TO PV-DISP-PO-NBR          03230001
039000              MOVE PC038-RCVR-SEQ-NBR  TO PV-DISP-RCVR-SEQ        03240001
039100              MOVE PC038-SKU-9         TO PV-DISP-SKU             03250001
039200                                                                  03260001
039300              DISPLAY 'NO STORE EXPECTED FOUND - '                03270001
039400                       'SKU:'     PV-DISP-SKU     '  '            03280001
039500                       'STORE:'   PV-DISP-LOC-NBR  '  '           03290001
039600                       'PO-RCVR:' PV-DISP-PO-NBR                  03300003
039700                       '-'        PV-DISP-RCVR-SEQ                03310001
039800                                                                  03320001
039810              ADD  1  TO  PV-NO-SE-FOUND-COUNT                    03330003
039811              SET  PS-NO-CLEAN-UP-NEEDED  TO  TRUE                03340003
039820                                                                  03350003
039900         WHEN SQLWARN0 NOT = SPACES                               03360001
040000         WHEN SQLCODE < ZERO                                      03370001
040100         WHEN SQLCODE > ZERO                                      03380001
040101                                                                  03390001
040110              MOVE PC038-LOC-NBR       TO PV-DISP-LOC-NBR         03400001
040120              MOVE PC038-PO-NBR        TO PV-DISP-PO-NBR          03410001
040130              MOVE PC038-RCVR-SEQ-NBR  TO PV-DISP-RCVR-SEQ        03420001
040140              MOVE PC038-SKU-9         TO PV-DISP-SKU             03430001
040141              MOVE SQLCODE             TO PV-DISP-SQLCODE         03440001
040150                                                                  03450001
040160              DISPLAY  'SQL ERROR:'  PV-DISP-SQLCODE              03460001
040161                       ' -- '                                     03470001
040170                       'SKU:'     PV-DISP-SKU      '  '           03480001
040180                       'STORE:'   PV-DISP-LOC-NBR  '  '           03490001
040190                       'PO-RCVR:' PV-DISP-PO-NBR                  03500003
040191                       '-'        PV-DISP-RCVR-SEQ '  '           03510001
040192                       'PARA:'    PV-ABEND-PARAGRAPH              03520001
040193                                                                  03530001
041500             PERFORM 9900-SQL-ERROR                               03540001
041600     END-EVALUATE.                                                03550001
041700                                                                  03560001
041710                                                                  03570001
041711******************************************************************03580001
041712*  CHECK IF THERE IS ANY UNBALANCED IN-TRANSIT QUANTITIES FOR     03590001
041713*  THIS STORE/SKU/PO/RCVR                                         03600001
041715******************************************************************03610001
041720 3010-CHECK-UNBALANCED-INTRNST.                                   03620001
041730                                                                  03630001
041740     MOVE '3010-CHECK-UNBALANCED-INTRNST'  TO  PV-ABEND-PARAGRAPH.03640002
041750                                                                  03650001
041760     SET  PS-USE-CALC-QTY-FOR-CLEANUP  TO  TRUE.                  03660003
041761     MOVE  PC038-LOC-NBR  TO  PCT00015-LOC-NBR.                   03670006
041770                                                                  03680003
041780     EXEC SQL                                                     03690001
041790         SELECT SUM(B.TRN_CLSN_PRCG_QTY)                          03700001
041800               ,SUM(B.TRN_CLSN_PRCG_QTY) * -1                     03710001
041900               ,A.INTR_UPC_ID                                     03720001
042000           INTO :PV-IT-SUM-QTY          :PV-NULL-IND              03730005
042100              , :PV-IT-SUM-QTY-REV      :PV-NULL-IND-2            03740005
042200              , :PV-IT-INTR-UPC-ID                                03750002
042300           FROM XLT_SKU  A                                        03760001
042400              , PCT_TRN_CLSN_DTL B                                03770001
042500          WHERE A.SKU_NBR      =  :PC038-SKU-9                    03780001
042600            AND B.INTR_UPC_ID  =   A.INTR_UPC_ID                  03790001
042700            AND B.LOC_NBR      =  :PCT00015-LOC-NBR               03800006
042800            AND B.PO_NBR       =  :PC038-PO-NBR                   03810001
042900            AND B.RCVR_SEQ_NBR =  :PC038-RCVR-SEQ-NBR             03820001
043000            AND B.TRN_CLSN_CDE =  'IT'                            03830001
043010          GROUP BY A.INTR_UPC_ID                                  03840007
043100     END-EXEC.                                                    03850001
043200                                                                  03860001
043300     EVALUATE TRUE                                                03870001
043400         WHEN SQLCODE = ZERO                                      03880001
043500              IF  PV-NULL-IND    =  -1                            03890013
043600                  MOVE ZEROES  TO  PV-IT-SUM-QTY                  03900013
043700              END-IF                                              03910013
043800                                                                  03920001
043900              IF  PV-NULL-IND-2  =  -1                            03930013
044000                  MOVE ZEROES  TO  PV-IT-SUM-QTY-REV              03940013
044100              END-IF                                              03950013
044200                                                                  03960001
044300              IF  PV-IT-SUM-QTY   =  ZERO                         03970002
044400                  SET  PS-USE-SE-QTY-FOR-CLEANUP  TO  TRUE        03980003
044410                                                                  03990009
044420***               MOVE PC038-LOC-NBR      TO PV-DISP-LOC-NBR      04000011
044430***               MOVE PC038-PO-NBR       TO PV-DISP-PO-NBR       04010011
044440***               MOVE PC038-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ     04020011
044450***               MOVE PC038-SKU-9        TO PV-DISP-SKU          04030011
044460***               MOVE PV-SE-SUM-QTY      TO PV-DISP-SE-QTY       04040011
044461***               MOVE PV-IT-SUM-QTY      TO PV-DISP-IT-QTY       04050011
044470***                                                               04060011
044480***               DISPLAY 'IN TRANSIT QTY = 0      - '            04070011
044490***                       'SKU:'     PV-DISP-SKU     '  '         04080011
044491***                       'STORE:'   PV-DISP-LOC-NBR  '  '        04090011
044492***                       'PO-RCVR:' PV-DISP-PO-NBR               04100011
044493***                       '-'        PV-DISP-RCVR-SEQ             04110011
044494***                       ' SE:'     PV-DISP-SE-QTY               04120011
044495***                       ' IT:'     PV-DISP-IT-QTY               04130011
044496                                                                  04140009
044500              ELSE                                                04150001
044510                                                                  04160003
044600                  IF  PV-IT-SUM-QTY  >   PV-SE-SUM-QTY            04170010
044610                      SET  PS-NO-CLEAN-UP-NEEDED  TO  TRUE        04180003
044611                      ADD  1  TO  PV-IT-GREATER-SE-COUNT          04190003
044612                                                                  04200009
044613***               MOVE PC038-LOC-NBR      TO PV-DISP-LOC-NBR      04210011
044614***               MOVE PC038-PO-NBR       TO PV-DISP-PO-NBR       04220011
044615***               MOVE PC038-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ     04230011
044616***               MOVE PC038-SKU-9        TO PV-DISP-SKU          04240011
044617***               MOVE PV-SE-SUM-QTY      TO PV-DISP-SE-QTY       04250011
044618***               MOVE PV-IT-SUM-QTY      TO PV-DISP-IT-QTY       04260011
044619***                                                               04270011
044620***               DISPLAY 'IN TRANSIT >  STR EXP   - '            04280011
044621***                       'SKU:'     PV-DISP-SKU     '  '         04290011
044622***                       'STORE:'   PV-DISP-LOC-NBR  '  '        04300011
044623***                       'PO-RCVR:' PV-DISP-PO-NBR               04310011
044624***                       '-'        PV-DISP-RCVR-SEQ             04320011
044625***                       ' SE:'     PV-DISP-SE-QTY               04330011
044626***                       ' IT:'     PV-DISP-IT-QTY               04340011
044627                                                                  04350009
044628                  ELSE                                            04360002
044629                  IF  PV-IT-SUM-QTY  =   PV-SE-SUM-QTY            04370010
044630                      SET  PS-NO-CLEAN-UP-NEEDED  TO  TRUE        04380010
044631                      ADD  1  TO  PV-IT-EQUAL-SE-COUNT            04390010
044632                                                                  04400010
044633***               MOVE PC038-LOC-NBR      TO PV-DISP-LOC-NBR      04410011
044634***               MOVE PC038-PO-NBR       TO PV-DISP-PO-NBR       04420011
044635***               MOVE PC038-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ     04430011
044636***               MOVE PC038-SKU-9        TO PV-DISP-SKU          04440011
044637***               MOVE PV-SE-SUM-QTY      TO PV-DISP-SE-QTY       04450011
044638***               MOVE PV-IT-SUM-QTY      TO PV-DISP-IT-QTY       04460011
044639***                                                               04470011
044640***               DISPLAY 'IN TRANSIT =  STR EXP   - '            04480011
044641***                       'SKU:'     PV-DISP-SKU     '  '         04490011
044642***                       'STORE:'   PV-DISP-LOC-NBR  '  '        04500011
044643***                       'PO-RCVR:' PV-DISP-PO-NBR               04510011
044644***                       '-'        PV-DISP-RCVR-SEQ             04520011
044645***                       ' SE:'     PV-DISP-SE-QTY               04530011
044646***                       ' IT:'     PV-DISP-IT-QTY               04540011
044647                                                                  04550010
044648                  ELSE                                            04560010
044649                      SUBTRACT  PV-IT-SUM-QTY                     04570002
044650                          FROM  PV-SE-SUM-QTY                     04580002
044651                        GIVING  PV-CU-SUM-QTY                     04590002
044660                       MULTIPLY PV-CU-SUM-QTY  BY -1              04600002
044670                         GIVING PV-CU-SUM-QTY-REV                 04610002
044680                                                                  04620009
044690***               MOVE PC038-LOC-NBR      TO PV-DISP-LOC-NBR      04630011
044691***               MOVE PC038-PO-NBR       TO PV-DISP-PO-NBR       04640011
044692***               MOVE PC038-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ     04650011
044693***               MOVE PC038-SKU-9        TO PV-DISP-SKU          04660011
044694***               MOVE PV-SE-SUM-QTY      TO PV-DISP-SE-QTY       04670011
044695***               MOVE PV-IT-SUM-QTY      TO PV-DISP-IT-QTY       04680011
044696***               MOVE PV-CU-SUM-QTY      TO PV-DISP-CU-QTY       04690011
044697***                                                               04700011
044698***               DISPLAY 'IN TRANSIT < STR EXPTED - '            04710011
044699***                       'SKU:'     PV-DISP-SKU     '  '         04720011
044700***                       'STORE:'   PV-DISP-LOC-NBR  '  '        04730011
044701***                       'PO-RCVR:' PV-DISP-PO-NBR               04740011
044702***                       '-'        PV-DISP-RCVR-SEQ             04750011
044703***                       ' SE:'     PV-DISP-SE-QTY               04760011
044704***                       ' IT:'     PV-DISP-IT-QTY               04770011
044705***                       ' CU:'     PV-DISP-IT-QTY               04780011
044706                                                                  04790009
044707                  END-IF                                          04800009
044708                  END-IF                                          04810010
044710              END-IF                                              04820002
044800                                                                  04830001
044900         WHEN SQLCODE = +100                                      04840001
044901                                                                  04850002
044910              SET  PS-USE-SE-QTY-FOR-CLEANUP  TO  TRUE            04860003
044911                                                                  04870009
044920***               MOVE PC038-PO-NBR       TO PV-DISP-PO-NBR       04880011
044930***               MOVE PC038-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ     04890011
044940***               MOVE PC038-SKU-9        TO PV-DISP-SKU          04900011
044950***               MOVE PV-SE-SUM-QTY      TO PV-DISP-SE-QTY       04910011
044970***                                                               04920011
044980***               DISPLAY 'NO INTRANSIT - USE SE   - '            04930011
044990***                       'SKU:'     PV-DISP-SKU     '  '         04940011
045000***                       'STORE:'   PV-DISP-LOC-NBR  '  '        04950011
045100***                       'PO-RCVR:' PV-DISP-PO-NBR               04960011
045200***                       '-'        PV-DISP-RCVR-SEQ             04970011
045300***                       ' SE:'     PV-DISP-SE-QTY               04980011
045500                                                                  04990009
046000                                                                  05000001
046100         WHEN SQLWARN0 NOT = SPACES                               05010001
046200         WHEN SQLCODE < ZERO                                      05020001
046300         WHEN SQLCODE > ZERO                                      05030001
046400                                                                  05040001
046500              MOVE PC038-LOC-NBR       TO PV-DISP-LOC-NBR         05050001
046600              MOVE PC038-PO-NBR        TO PV-DISP-PO-NBR          05060001
046700              MOVE PC038-RCVR-SEQ-NBR  TO PV-DISP-RCVR-SEQ        05070001
046710              MOVE PC038-SKU-9         TO PV-DISP-SKU             05080001
046720              MOVE SQLCODE             TO PV-DISP-SQLCODE         05090001
046730                                                                  05100001
046740              DISPLAY  'SQL ERROR:'  PV-DISP-SQLCODE              05110001
046750                       ' -- '                                     05120001
046760                       'SKU:'     PV-DISP-SKU      '  '           05130001
046770                       'STORE:'   PV-DISP-LOC-NBR  '  '           05140001
046780                       'PO-RCVR:' PV-DISP-PO-NBR                  05150003
046790                       '-'        PV-DISP-RCVR-SEQ '  '           05160001
046791                       'PARA:'    PV-ABEND-PARAGRAPH              05170001
046792                                                                  05180001
046793             PERFORM 9900-SQL-ERROR                               05190001
046794     END-EVALUATE.                                                05200001
046795                                                                  05210001
046796                                                                  05220001
103200                                                                  05230001
103300******************************************************************05240001
103400*  BUILD  STORE-CLEAN-UP-TRANSACTIONS                             05250002
103500******************************************************************05260001
103600 4000-BUILD-CLEAN-UP-TRANS.                                       05270003
103610                                                                  05280002
103700     INITIALIZE PC041-UNBAL-SUMMARY-REC.                          05290002
103800     MOVE PC038-PO-NBR           TO  PC041-PO-NBR.                05300002
103900     MOVE PC038-RCVR-SEQ-NBR     TO  PC041-RCVR-SEQ-NBR.          05310002
104000     MOVE PV-SE-INTR-UPC-ID      TO  PC041-INTR-UPC-ID.           05320002
104100     MOVE PC038-LOC-NBR          TO  PC041-LOC-NBR.               05330002
104110     IF  PS-USE-SE-QTY-FOR-CLEANUP                                05340002
104200         MOVE PV-SE-SUM-QTY-REV  TO  PC041-TRN-CLSN-QTY           05350013
104210     ELSE                                                         05360002
104220         MOVE PV-CU-SUM-QTY-REV  TO  PC041-TRN-CLSN-QTY           05370002
104230     END-IF.                                                      05380002
104310*    MOVE PV-CURRENT-DATE        TO  PC041-INTRNST-TRN-DTE.       05390024
104320     MOVE PV-INTRNST-DATE        TO  PC041-INTRNST-TRN-DTE.       05400024
104400     SET  PC041-PHY-INV-REVERSE  TO  TRUE.                        05410002
106200                                                                  05420001
106210                                                                  05430002
106220******************************************************************05440002
106230*  BUILD  STORE-CLEAN-UP FILE                                     05450002
106240******************************************************************05460002
106250 4010-BUILD-CLEAN-UP-RECORD.                                      05470002
106260                                                                  05480002
106270     MOVE  ZEROS  TO  PV-UNIT-RTL-VALUE.                          05490002
106271                                                                  05500002
106272     IF  PC038-EXTD-RTL-AMT        >  0   AND                     05510002
106273         PC038-STR-EXPECTED-UNITS  >  0                           05520002
106280         DIVIDE  PC038-EXTD-RTL-AMT                               05530002
106290             BY  PC038-STR-EXPECTED-UNITS                         05540002
106291         GIVING  PV-UNIT-RTL-VALUE.                               05550002
106292                                                                  05560002
106293* RK THE FOLLOWING WAS COMMENTED OUT SINCE WE NEED TO HAVE THE    05570022
106294*    ORIGINAL STORE EXPECTED UNITS PASSED ALONG TO THE OUTPUT     05580022
106295*    FILE.                                                        05590022
106296*                                                                 05600022
106297*    IF  PS-USE-SE-QTY-FOR-CLEANUP                                05610022
106298*        MOVE PV-SE-SUM-QTY-REV  TO  PC038-STR-EXPECTED-UNITS     05620022
106299*    ELSE                                                         05630022
106300*        MOVE PV-CU-SUM-QTY-REV  TO  PC038-STR-EXPECTED-UNITS     05640022
106301*    END-IF.                                                      05650022
106302                                                                  05660002
106303     MULTIPLY PC038-STR-EXPECTED-UNITS                            05670002
106304           BY PV-UNIT-RTL-VALUE                                   05680002
106305       GIVING PC038-EXTD-RTL-AMT.                                 05690002
106306                                                                  05700002
106307     MOVE  'PHY INV REVERSE '    TO  PC038-CLEAN-REASON.          05710002
106308                                                                  05720002
106313     MOVE  PV-SE-SUM-QTY      TO  PC038-AFT-REV-STR-EXP-UNITS.    05730016
106315     MOVE  PV-IT-SUM-QTY      TO  PC038-AFT-REV-IN-TRNS-UNITS.    05740016
106316                                                                  05750017
106317     IF  PS-USE-SE-QTY-FOR-CLEANUP                                05760017
106318         MOVE PV-SE-SUM-QTY-REV  TO  PC038-AFT-REV-CLEAN-UNITS    05770017
106319     ELSE                                                         05780017
106320         MOVE PV-CU-SUM-QTY-REV  TO  PC038-AFT-REV-CLEAN-UNITS    05790017
106321     END-IF.                                                      05800017
106322                                                                  05810016
106323     IF  PS-CLEAN-UP-NEEDED  AND                                  05820018
106324         PC038-POST-INV-REVERSE                                   05830018
106325         SET  PC038-AFT-REV-CLEAN-CREATED     TO  TRUE            05840018
106326     ELSE                                                         05850018
106327         SET  PC038-AFT-REV-CLEAN-CREATED-NO  TO  TRUE            05860018
106328     END-IF.                                                      05870018
106329                                                                  05880018
106330* RK MOVING THIS SO THAT THIS DATE IS RETRIEVD BEFORE THE         05890024
106331*    PCRD041 RECORD IS WRITTEN SO THIS DATE IS AVAILABLE          05900024
106332*    FOR BOTH THE PCRD041 AND PCRD038 OUTPUT FILES.               05910024
106333*                                                                 05920024
106334*    PERFORM 4015-GET-INTRNST-DATE.                               05930024
106335     MOVE  PV-INTRNST-DATE  TO  PC038-INTRNST-TRN-DTE.            05940018
106336                                                                  05950002
106337                                                                  05960018
106338******************************************************************05970018
106339*  GET INTRANSIT DATE                                             05980018
106340******************************************************************05990018
106341 4015-GET-INTRNST-DATE.                                           06000018
106342                                                                  06010018
106343     MOVE '4015-GET-INTRNST-DATE'      TO  PV-ABEND-PARAGRAPH.    06020018
106344                                                                  06030018
106345     MOVE  SPACES             TO  PV-INTRNST-TMST.                06040019
106346     MOVE  PV-SE-INTR-UPC-ID  TO  PCT00015-INTR-UPC-ID.           06050019
106349     EXEC SQL                                                     06060019
106350         SELECT MAX(B.IN_TRNST_TRN_TMST)                          06070019
106351           INTO :PV-INTRNST-TMST                                  06080018
106352           FROM PCT_TRN_CLSN_DTL B                                06090019
106353          WHERE INTR_UPC_ID  =  :PCT00015-INTR-UPC-ID             06100019
106354            AND LOC_NBR      =  :PCT00015-LOC-NBR                 06110019
106355            AND PO_NBR       =  :PC038-PO-NBR                     06120019
106356            AND RCVR_SEQ_NBR =  :PC038-RCVR-SEQ-NBR               06130019
106357            AND TRN_CLSN_CDE =  'SE'                              06140019
106359     END-EXEC.                                                    06150018
106360                                                                  06160018
106361     EVALUATE TRUE                                                06170018
106362         WHEN SQLCODE = ZERO                                      06180018
106363         WHEN SQLCODE = +100                                      06190018
106366              CONTINUE                                            06200036
106391                                                                  06210018
106406                                                                  06220018
106407         WHEN SQLWARN0 NOT = SPACES                               06230018
106408         WHEN SQLCODE < ZERO                                      06240018
106409         WHEN SQLCODE > ZERO                                      06250018
106410                                                                  06260018
106411              MOVE PC038-LOC-NBR       TO PV-DISP-LOC-NBR         06270018
106412              MOVE PC038-PO-NBR        TO PV-DISP-PO-NBR          06280018
106413              MOVE PC038-RCVR-SEQ-NBR  TO PV-DISP-RCVR-SEQ        06290018
106414              MOVE PC038-SKU-9         TO PV-DISP-SKU             06300018
106415              MOVE SQLCODE             TO PV-DISP-SQLCODE         06310018
106416                                                                  06320018
106417              DISPLAY  'SQL ERROR:'  PV-DISP-SQLCODE              06330018
106418                       ' -- '                                     06340018
106419                       'SKU:'     PV-DISP-SKU      '  '           06350018
106420                       'STORE:'   PV-DISP-LOC-NBR  '  '           06360018
106421                       'PO-RCVR:' PV-DISP-PO-NBR                  06370018
106423                       '-'        PV-DISP-RCVR-SEQ '  '           06380018
106424                       'PARA:'    PV-ABEND-PARAGRAPH              06390018
106425                                                                  06400018
106426             PERFORM 9900-SQL-ERROR                               06410018
106427     END-EVALUATE.                                                06420018
106429                                                                  06430018
106430                                                                  06440018
106431******************************************************************06450001
106440*  READ INPUT FILE.                                               06460001
106500******************************************************************06470001
106600 9000-READ-FILE.                                                  06480001
106700      INITIALIZE PC038-SE-UNBALANCED-RPT-REC.                     06490001
106800                                                                  06500001
106900      READ STORE-EXPECTED-REVERSALS-IN  INTO                      06510001
107000          PC038-SE-UNBALANCED-RPT-REC                             06520001
107100            AT END SET PS-END-OF-FILE TO TRUE.                    06530001
107200                                                                  06540001
107300      IF PS-END-OF-FILE                                           06550001
107400         CONTINUE                                                 06560001
107500      ELSE                                                        06570001
107600         ADD +1 TO PV-READ-COUNTER                                06580001
107700                   PV-READ-COUNTER-2                              06590001
107800         IF  PV-READ-COUNTER-2  >= 5000                           06600020
107900             MOVE PV-READ-COUNTER           TO  PV-DISPLAY-COUNT  06610001
108000             DISPLAY 'RECORDS PROCESSED....: '  PV-DISPLAY-COUNT  06620001
108100             MOVE  ZEROES  TO  PV-READ-COUNTER-2                  06630001
108200         END-IF                                                   06640001
108300      END-IF.                                                     06650001
108400                                                                  06660001
108500******************************************************************06670001
108600*  WRITE OUTPUT FILE.                                             06680001
108700******************************************************************06690001
108800 9100-WRITE-OUTPUT-PCRD041.                                       06700016
108900                                                                  06710001
109000     WRITE SE-CLEAN-UP-TRANS-RECORD                               06720002
109100      FROM PC041-UNBAL-SUMMARY-REC.                               06730002
109200                                                                  06740001
109300     ADD +1 TO PV-CLEAN-UP-TRANS.                                 06750002
109400                                                                  06760001
109410                                                                  06770002
109411******************************************************************06780016
109412*  WRITE OUTPUT FILE.                                             06790016
109413******************************************************************06800016
109414 9110-WRITE-OUTPUT-PCRD038.                                       06810016
109415                                                                  06820016
109422     WRITE SE-CLEAN-UP-RECORD                                     06830003
109430      FROM PC038-SE-UNBALANCED-RPT-REC.                           06840002
109440                                                                  06850002
109450     ADD +1 TO PV-CLEAN-UP-RECORDS.                               06860002
109460                                                                  06870002
111500******************************************************************06880001
111600*  CLOSE INPUT FILE.  DISPLAY COUNTERS.                           06890001
111700******************************************************************06900001
111800 9500-EOJ-ROUTINE.                                                06910001
111801                                                                  06920002
111810     CLOSE STORE-EXPECTED-REVERSALS-IN                            06930002
111820           STORE-CLEAN-UP-TRANSACTIONS                            06940002
111830           STORE-EXPECTED-CLEAN-UP.                               06950002
112300                                                                  06960001
112700                                                                  06970001
112800     DISPLAY '      '.                                            06980001
112900                                                                  06990001
113000     MOVE PV-READ-COUNTER               TO  PV-DISPLAY-COUNT.     07000001
113100     DISPLAY 'TOTAL STORE EXPECTED REVERSALS READ..: '            07010003
113110              PV-DISPLAY-COUNT.                                   07020003
113200                                                                  07030001
113210     DISPLAY '                                       '            07040003
113220                                                                  07050003
113300     MOVE PV-CLEAN-UP-TRANS             TO  PV-DISPLAY-COUNT.     07060003
113400     DISPLAY 'TOTAL STORE EXPECTED CLEAN-UP TRANS..: '            07070003
113410              PV-DISPLAY-COUNT.                                   07080003
113500                                                                  07090001
113700                                                                  07100001
113800     MOVE PV-CLEAN-UP-RECORDS           TO  PV-DISPLAY-COUNT.     07110003
113900     DISPLAY 'TOTAL RECORDS PASSED TO REPORT FILE..: '            07120023
113910              PV-DISPLAY-COUNT.                                   07130003
114000                                                                  07140001
114010     DISPLAY '                                       '            07150003
114020                                                                  07160003
114600     DISPLAY 'BYPASSED RECORD COUNTS                  '.          07170003
114601                                                                  07180003
114610     DISPLAY '                                       '            07190003
114700                                                                  07200001
114800     MOVE PV-NO-SE-FOUND-COUNT          TO  PV-DISPLAY-COUNT.     07210003
114900     DISPLAY 'NO STORE EXPECTED FOUND .............: '            07220003
114910              PV-DISPLAY-COUNT.                                   07230003
115000                                                                  07240001
115100     MOVE PV-SE-QTY-0-COUNT             TO  PV-DISPLAY-COUNT.     07250003
115200     DISPLAY 'STORE EXPECTED QTY = ZERO ...........: '            07260003
115210              PV-DISPLAY-COUNT.                                   07270003
115300                                                                  07280001
115400     MOVE PV-IT-GREATER-SE-COUNT        TO  PV-DISPLAY-COUNT.     07290003
115500     DISPLAY 'INTRANSIT  >  STORE EXPECTED ........: '            07300003
115510              PV-DISPLAY-COUNT.                                   07310003
115600                                                                  07320001
115700     MOVE PV-IT-EQUAL-SE-COUNT          TO  PV-DISPLAY-COUNT.     07330010
115800     DISPLAY 'INTRANSIT  =  STORE EXPECTED ........: '            07340010
115900              PV-DISPLAY-COUNT.                                   07350010
116000                                                                  07360010
118500                                                                  07370010
118600     DISPLAY '      '.                                            07380001
118700                                                                  07390001
118800     DISPLAY '*****  PCKUT079 ENDED  *****'.                      07400001
118900                                                                  07410001
119000 9900-SQL-ERROR.                                                  07420001
119100                                                                  07430001
119200     MOVE SQLCODE               TO SQLCODE2.                      07440001
119300     MOVE SQLERRD(3)            TO SQLERRD3.                      07450001
119400     DISPLAY '** ABEND **       ** = SQLERROR'.                   07460001
119500     DISPLAY '** PROGRAM        ** = PCKUT079'.                   07470001
119600     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        07480001
119700                                                                  07490001
119800     COPY DPPD004.                                                07500001
119900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07510001
