000100******************************************************************00010011
000200 IDENTIFICATION DIVISION.                                         00020011
000300******************************************************************00030011
000400                                                                  00040011
000500 PROGRAM-ID.    TRKUT504.                                         00050034
000600 AUTHOR.        TKMA497                                           00060034
000700 INSTALLATION.  KOHLS.                                            00070011
000800 DATE-WRITTEN   AUGUST 2012.                                      00080034
000900 DATE-COMPILED.                                                   00090011
001000                                                                  00100011
001100******************************************************************00110011
001200* THIS PROGRAM TAKES IN THE EXTRACT OF THE WHOLE TRT_VND_TRANS_RT 00120011
001300* TABLE WHICH IS SORTED. IF THERE IS UOM CODE OF 'DOL',           00130035
001310* VND_TRANS_RT_ID WILL BE WRITTEN TO AN OUTPUT FILE FOR USE IN    00140037
001310* TRKUP505.                                                       00150035
001340******************************************************************00170011
001350 ENVIRONMENT DIVISION.                                            00180011
001360******************************************************************00190011
001370 CONFIGURATION SECTION.                                           00200011
001380 SOURCE-COMPUTER.        IBM-3090.                                00210011
001390 OBJECT-COMPUTER.        IBM-3090.                                00220011
001400                                                                  00230011
001500 INPUT-OUTPUT SECTION.                                            00240011
001600 FILE-CONTROL.                                                    00250011
001700                                                                  00260011
001800     SELECT INPUT-FILE                                            00270011
001900         ASSIGN TO INP01.                                         00280011
002000                                                                  00290011
002100     SELECT OUTPUT-FILE1                                          00300011
002200         ASSIGN TO OUT01.                                         00310011
002300                                                                  00320011
002700******************************************************************00360011
002800 DATA DIVISION.                                                   00370011
002900******************************************************************00380011
003000                                                                  00390011
003100 FILE SECTION.                                                    00400011
003200                                                                  00410011
003300 FD  INPUT-FILE                                                   00420011
003400     RECORDING MODE IS F                                          00430011
003500     LABEL RECORDS ARE STANDARD                                   00440011
003600     RECORD CONTAINS 184                                          00450013
003700     BLOCK CONTAINS 0 RECORDS                                     00460011
003800     DATA RECORD IS INPUT-RECORD.                                 00470011
003900                                                                  00480011
004000 01  INPUT-RECORD              PIC  X(184).                       00490013
004100                                                                  00500011
004200 FD  OUTPUT-FILE1                                                 00510011
004300     RECORDING MODE IS F                                          00520011
004400     LABEL RECORDS ARE STANDARD                                   00530011
004500     RECORD CONTAINS 184                                          00540013
004510     BLOCK CONTAINS 0 RECORDS                                     00550011
004520     DATA RECORD IS OUTPUT-RECORD1.                               00560011
004530                                                                  00570011
004531 01  OUTPUT-RECORD1            PIC  X(184).                       00580013
004532                                                                  00590011
004560******************************************************************00690011
004570 WORKING-STORAGE SECTION.                                         00700011
004580******************************************************************00710011
004590 01  PS-PROGRAM-SWITCHES.                                         00720011
004600     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00730011
004700         88  PS-EOF-INPUT                        VALUE 'Y'.       00740011
004800         88  PS-NOT-EOF-INPUT                    VALUE 'N'.       00750011
004900     05  PS-FIRST-RECORD-SW           PIC X(01)  VALUE 'Y'.       00760011
005000         88  PS-FIRST-RECORD                     VALUE 'Y'.       00770011
005100         88  PS-FIRST-RECORD-NO                  VALUE 'N'.       00780011
005401                                                                  00890011
005402 01  PC-PROGRAM-CONSTANTS.                                        00900011
005403     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'TRKUT504'. 00910034
005404     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       00920011
005419                                                                  01070011
005420 01  PV-PROGRAM-VARIABLES.                                        01080011
005421     05  PV-RECORDS-READ              PIC 9(09)  VALUE ZERO.      01090011
005422     05  PM-DOL-UOM-WRITTEN           PIC 9(09)  VALUE ZERO.      01100040
005423     05  PV-RETRY-COUNTER             PIC S9(04) VALUE 0 COMP.    01110011
005424     05  PV-SAVE-DC                   PIC 9(04) VALUE ZEROS.      01120011
005804                                                                  02120011
005805 01  PV-ABEND-FIELDS.                                             02133011
005806     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         02140011
005807                                                 COMP SYNC.       02150011
005809     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    02170011
005810     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    02180011
005811     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    02190011
005812     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    02200011
005843                                                                  02530011
005844******************************************************************02531028
005845*  VENDOR TRANSPORTATION RATES RECORD LAYOUT                      02532033
005846******************************************************************02533028
005847     COPY TRRD272.                                                02534028
005843                                                                  02535028
005844******************************************************************02540011
005845*  DB2 FORMATTED MESSAGE AREA                                     02550011
005846******************************************************************02560011
005847     COPY DPWS004.                                                02570011
005848*                                                                 02580011
008520******************************************************************04700011
008530 PROCEDURE DIVISION.                                              04710011
008540******************************************************************04720011
008550 0000-PROGRAM-MAINLINE.                                           04730011
008560                                                                  04740011
008570     OPEN INPUT  INPUT-FILE                                       04750011
008580          OUTPUT OUTPUT-FILE1.                                    04760025
008600                                                                  04780011
008900     PERFORM 7000-READ-INPUT-FILE.                                04810023
009000                                                                  04820011
009100     PERFORM 2000-PROCESS-INPUT-FILE                              04830011
009200         UNTIL PS-EOF-INPUT.                                      04840011
009300                                                                  04850011
009400     PERFORM 9000-EOJ.                                            04860011
009500                                                                  04870011
009600     STOP RUN.                                                    04880011
009700                                                                  04890011
011400******************************************************************05060011
011500* PROCESS INPUT RECORDS                                          *05070011
011600******************************************************************05080011
011700 2000-PROCESS-INPUT-FILE.                                         05090011
011800     MOVE '2000-PROCESS-INPUT-FILE.'   TO PV-ABEND-PARAGRAPH.     05100011
011900                                                                  05110011
           IF TR272-UOM-CDE = 'DOL'                                     05209540
               PERFORM 8000-WRITE-OUTPUT-RECORD                         05209640
           END-IF                                                       05209740
016500                                                                  05809811
016600     PERFORM 7000-READ-INPUT-FILE.                                05809923
016700                                                                  05810011
009800******************************************************************05820023
009900* READS RECORD FROM THE INPUT FILE                                05830023
010000******************************************************************05840023
010100 7000-READ-INPUT-FILE.                                            05850023
010200     MOVE '7000-READ-INPUT-FILE.'      TO  PV-ABEND-PARAGRAPH.    05860023
010300                                                                  05870023
010400     READ INPUT-FILE                                              05880023
010500          INTO TR272-VENDOR-TRANS-RATE-REC                        05890031
010600            AT END                                                05900023
010700               SET PS-EOF-INPUT     TO TRUE                       05910023
010800                                                                  05920023
010900            NOT AT END                                            05930023
011000               SET PS-NOT-EOF-INPUT TO TRUE                       05940023
011100               ADD +1 TO PV-RECORDS-READ                          05950023
011200     END-READ.                                                    05960023
011300                                                                  05970023
050903******************************************************************28070011
050904* WRITES THE APPROPRIATE OUTPUT RECORDS                          *28080011
050905******************************************************************28090011
050906 8000-WRITE-OUTPUT-RECORD.                                        28100022
050908     MOVE '8000-WRITE-OUTPUT-RECORD.'  TO PV-ABEND-PARAGRAPH.     28120022
050910                                                                  28140011
050912     WRITE OUTPUT-RECORD1 FROM TR272-VENDOR-TRANS-RATE-REC.       28160042
050918                                                                  28260011
050919     ADD  1  TO  PM-DOL-UOM-WRITTEN.                              28270040
050920                                                                  28280011
050921 9000-EOJ.                                                        28290011
050923                                                                  28310011
050924     CLOSE INPUT-FILE                                             28320011
050925           OUTPUT-FILE1.                                          28330025
050927                                                                  28350011
050928     DISPLAY ' RECORDS READ    = ' PV-RECORDS-READ                28360040
050929     DISPLAY ' DOL UOM RECORDS = ' PM-DOL-UOM-WRITTEN.            28370040
                                                                        28370127
           IF PM-DOL-UOM-WRITTEN = ZERO                                 28371040
               MOVE 1 TO RETURN-CODE.                                   28372045
050930                                                                  28380011
050931******************************************************************28390011
050932* ABEND PROCEDURE                                                *28400011
050933******************************************************************28410011
050934*9999-SQL-ABEND.                                                  28420026
050936*    DISPLAY '** PROGRAM ABEND   ** = ' PC-PROGRAM-NAME.          28440026
050937*    DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARAGRAPH.       28450026
050944*    CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       28520026
050945                                                                  28530011
