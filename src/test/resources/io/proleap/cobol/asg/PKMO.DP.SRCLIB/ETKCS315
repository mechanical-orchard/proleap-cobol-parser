000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    ETKCS315.                                         00020001
000300 AUTHOR.        MARC BLAZICH.                                     00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  02-28-94.                                         00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800*---------------------------------------------------------------* 00080001
000900*    E315 - TRADING PARTNER TRANSACTION SET LIST                * 00090001
001000*                                                               * 00100001
001100*    THIS PROGRAM WILL GENERATE A LIST OF TRANSACTION SETS FOR  * 00110001
001200*    A GIVEN DKEY.                                              * 00120001
001300*                                                               * 00130001
001400*    CHANGES:                                                   * 00140001
001500*     03/20/97 TOM MEDREK - FIXED APPLICATION SPECIFIC SECTION. * 00150001
001600*       ADDED NRF INDICATOR WHICH WAS ADDED TO ETWS300 &        * 00160001
001700*       ETWS301 EARLIER.                                        * 00170001
001800*---------------------------------------------------------------* 00180001
001810* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00181003
001820*            - CHANGE CALL OF DPKUT100 TO                       * 00182003
001830*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00183003
001840*              MAKING THE CALL DYNAMIC VS STATIC                * 00184003
001850*                                                               * 00185003
001860*---------------------------------------------------------------* 00186003
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210        00187005
CICS  *                                                                 00188004
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00189004
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00189104
001860*---------------------------------------------------------------* 00189304
001900/                                                                 00190001
002000 ENVIRONMENT DIVISION.                                            00200001
002100                                                                  00210001
002200 DATA DIVISION.                                                   00220001
002300                                                                  00230001
002400 WORKING-STORAGE SECTION.                                         00240001
002500                                                                  00250001
002600 01  DK-DB2-KEYS.                                                 00260001
002700     05  DK-TP-DKEY                   PIC S9(09) VALUE +0         00270001
002800                                                 COMP.            00280001
002900     05  DK-DIR-IND-LOW               PIC  X(01).                 00290001
003000     05  DK-DIR-IND-HIGH              PIC  X(01).                 00300001
003100     05  DK-FUNC-CDE-LOW              PIC  X(02).                 00310001
003200     05  DK-FUNC-CDE-HIGH             PIC  X(02).                 00320001
003300                                                                  00330001
003400 01  PC-PROGRAM-CONSTANTS.                                        00340001
003500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00350001
003600                                                    'ET315A  '.   00360001
003700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00370001
003800                                                    'ETKM315 '.   00380001
003900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00390001
004000                                                    'ETKCS315'.   00400001
004100     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00410001
004200                                                    COMP.         00420001
004300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00430001
004400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00440001
004500     05  PC-WORK-ORDER-DIST-SHEET       PIC  9(03)  VALUE 001.    00450001
004600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00460001
004700                                                    COMP SYNC.    00470001
004800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00480001
004900                                                    COMP SYNC.    00490001
005000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00500001
005100                                                    +1000000      00510001
005200                                                    COMP-3.       00520001
005300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00530001
005400                                                    COMP SYNC.    00540001
005500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00550001
005600                                                    COMP-3.       00560001
005700     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00570001
005800     05  PC-N                           PIC  X(01)  VALUE 'N'.    00580001
005900     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00590001
006000     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00600001
006100     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00610001
006200     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00620001
006300     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00630001
006400                                                                  00640001
006500     05  PC-TSYMSG-NUMBERS.                                       00650001
006600         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00660001
006700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00670001
006800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00680001
006900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00690001
007000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00700001
007100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00710001
007200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00720001
007300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00730001
007400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00740001
007500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00750001
007600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00760001
007700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00770001
007800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00780001
007900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00790001
008000         10  PC-TSYMSG-00736            PIC  9(05)  VALUE 00736.  00800001
008100         10  PC-TSYMSG-00737            PIC  9(05)  VALUE 00737.  00810001
008200         10  PC-TSYMSG-00738            PIC  9(05)  VALUE 00738.  00820001
008300         10  PC-TSYMSG-00739            PIC  9(05)  VALUE 00739.  00830001
008400         10  PC-TSYMSG-00740            PIC  9(05)  VALUE 00740.  00840001
008500                                                                  00850001
008600 01  PS-PROGRAM-SWITCHES.                                         00860001
008700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00870001
008800         88  PS-NO-ERROR                            VALUE 'Y'.    00880001
008900         88  PS-ERROR                               VALUE 'N'.    00890001
009000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00900001
009100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00910001
009200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00920001
009300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00930001
009400         88  PS-DONE                                VALUE 'Y'.    00940001
009500         88  PS-NOT-DONE                            VALUE 'N'.    00950001
009600     05  PS-START-ITEM-ERROR-SW       PIC  X        VALUE 'Y'.    00960001
009700         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    00970001
009800         88  PS-START-ITEM-ERROR                    VALUE 'N'.    00980001
009900                                                                  00990001
010000 01  PV-PROGRAM-VARIABLES.                                        01000001
010100     05  PV-SUB                         PIC S9(04)  VALUE +0      01010001
010200                                                    COMP SYNC.    01020001
010300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01030001
010400                                                    COMP SYNC.    01040001
010500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01050001
010600                                                    COMP-3.       01060001
010700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01070001
010800                                                    COMP-3.       01080001
010900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01090001
011000                                                    COMP-3.       01100001
011100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01110001
011200                                                    COMP-3.       01120001
011300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01130001
011400                                                    COMP-3.       01140001
011500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01150001
011600                                                    COMP-3.       01160001
011700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01170001
011800                                                    COMP-3.       01180001
011900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01190001
012000                                                    COMP SYNC.    01200001
012100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01210001
012200                                                    COMP SYNC.    01220001
012300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01230001
012400                                                    COMP SYNC.    01240001
012500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01250001
012600                                                    COMP SYNC.    01260001
012700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01270001
012800                                                    COMP SYNC.    01280001
012900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01290001
013000                                                    COMP SYNC.    01300001
013100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01310001
013200                                                    COMP SYNC.    01320001
013300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01330001
013400                                                    COMP SYNC.    01340001
013500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01350001
013600                                                    COMP SYNC.    01360001
013700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01370001
013800                                                    COMP SYNC.    01380001
013900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01390001
014000                                                    COMP SYNC.    01400001
014100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01410001
014200                                                    COMP SYNC.    01420001
014300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01430001
014400                                                    COMP SYNC.    01440001
014500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01450001
014600                                                    COMP SYNC.    01460001
014700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01470001
014800                                                    COMP SYNC.    01480001
014900     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01490001
015000                                                    COMP-3.       01500001
015100     05  PV-WO-NBR                      PIC S9(04)  VALUE +0      01510001
015200                                                    COMP SYNC.    01520001
015300     05  PV-RECVR-STATUS-CDE            PIC  X(02)  VALUE SPACES. 01530001
015400                                                                  01540001
015500*---------------------------------------------------------------* 01550001
015600*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01560001
015700*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01570001
015800*   APPLICATION-SPECIFIC COMMAREA.                              * 01580001
015900*---------------------------------------------------------------* 01590001
016000 01  LQW-LIST-QUEUE-WORK-AREA.                                    01600001
016100     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  01610001
016200     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01620001
016300                                        INDEXED BY LQW-IDX.       01630001
016400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01640001
016500         10  LQW-TEMP-SELECTED-SW       PIC X(01).                01650001
016600         10  LQW-SELECTED-SW            PIC X(01).                01660001
016700             88  LQW-SELECT                         VALUE 'S'.    01670001
016800             88  LQW-DESELECT                       VALUE ' '.    01680001
016900         10  LQW-ACTION                 PIC X(03).                01690001
017000         10  LQW-TRAN-SET-CDE           PIC X(03).                01700001
017100         10  LQW-PROD-TEST-IND          PIC X(01).                01710001
017200         10  LQW-DIR-IND                PIC X(01).                01720001
017300/                                                                 01730001
017400*---------------------------------------------------------------* 01740001
017500*  RECORD LAYOUT FOR THE TEMP STORAGE QUEUE'S                   * 01750001
017600*---------------------------------------------------------------* 01760001
017700                                                                  01770001
017800     COPY ETWS301.                                                01780001
017900                                                                  01790001
018000/                                                                 01800001
018100*---------------------------------------------------------------* 01810001
018200*    MAP LAYOUT                                                 * 01820001
018300*---------------------------------------------------------------* 01830001
018400                                                                  01840001
018500     COPY ETKM315.                                                01850001
018600                                                                  01860001
018700 01  MR-OCCURS-LAYOUT                   REDEFINES  ET315AO.       01870001
018800     05  FILLER                         PIC X(042).               01880001
018900                                                                  01890001
019000     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01900001
019100         10  MR-SELECTL                 PIC S9(04) COMP.          01910001
019200         10  MR-SELECTA                 PIC X(01).                01920001
019300         10  MR-SELECTC                 PIC X(01).                01930001
019400         10  MR-SELECTH                 PIC X(01).                01940001
019500         10  MR-SELECT                  PIC X(01).                01950001
019600                                                                  01960001
019700         10  FILLER                     PIC X(05).                01970001
019800         10  MR-ACTION                  PIC X(03).                01980001
019900                                                                  01990001
020000         10  FILLER                     PIC X(05).                02000001
020100         10  MR-VENDOR-NAME             PIC X(25).                02010001
020200                                                                  02020001
020300         10  FILLER                     PIC X(05).                02030001
020400         10  MR-VEND-INCHG-QUAL         PIC X(02).                02040001
020500                                                                  02050001
020600         10  FILLER                     PIC X(05).                02060001
020700         10  MR-VEND-INCHG-ID           PIC X(15).                02070001
020800                                                                  02080001
020900         10  FILLER                     PIC X(05).                02090001
021000         10  MR-NETWK-NAME              PIC X(10).                02100001
021100                                                                  02110001
021200         10  FILLER                     PIC X(05).                02120001
021300         10  MR-TRAN-SET-CDE            PIC X(03).                02130001
021400                                                                  02140001
021500         10  FILLER                     PIC X(05).                02150001
021600         10  MR-PROD-TEST-IND           PIC X(01).                02160001
021700                                                                  02170001
021800         10  FILLER                     PIC X(05).                02180001
021900         10  MR-DIR-IND                 PIC X(01).                02190001
022000                                                                  02200001
022100/                                                                 02210001
022200*---------------------------------------------------------------* 02220001
022300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02230001
022400*---------------------------------------------------------------* 02240001
022500                                                                  02250001
022600     COPY DPWS015.                                                02260001
022700                                                                  02270001
022800*---------------------------------------------------------------* 02280001
022900*    FUNCTION KEYS COPYBOOK.                                    * 02290001
023000*---------------------------------------------------------------* 02300001
023100                                                                  02310001
023200     COPY DPWS016.                                                02320001
023300                                                                  02330001
023400*---------------------------------------------------------------* 02340001
023500*    NUMERIC EDIT LAYOUT.                                       * 02350001
023600*---------------------------------------------------------------* 02360001
023700                                                                  02370001
023800     COPY DPWS010I.                                               02380001
023900                                                                  02390001
024000/                                                                 02400001
024100*---------------------------------------------------------------* 02410001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02420004
024300*---------------------------------------------------------------* 02430001
024400                                                                  02440001
024500     COPY DPWS030.                                                02450001
CICS       COPY DPWS930.                                                02451004
024600                                                                  02460001
024700/                                                                 02470001
024800*---------------------------------------------------------------* 02480001
024900*    STANDARD COMMAREA.                                         * 02490001
025000*---------------------------------------------------------------* 02500001
025100                                                                  02510001
025200     COPY DPWS020.                                                02520001
025300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02530001
025400                                                                  02540001
025500*---------------------------------------------------------------* 02550001
025600* INTER-APPLICATION COMMAREA.                                   * 02560001
025700*---------------------------------------------------------------* 02570001
025800                                                                  02580001
025900         10  INTER-APPL-COMM-AREA       PIC X(200).               02590001
026000     COPY ETWS300.                                                02600001
026100*---------------------------------------------------------------* 02610001
026200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02620001
026300*---------------------------------------------------------------* 02630001
026400         10  ASC-SPECIFIC-COMMAREA.                               02640001
026500             15  ASC-LIST-KEYS.                                   02650001
026600                 20  ASC-KEY-TP-DKEY           PIC S9(9) COMP.    02660001
026700                 20  ASC-KEY-DIR-IND           PIC  X(1).         02670001
026800             15  ASC-ENT-ID                    PIC S9(9) COMP.    02680001
026900             15  ASC-VENDOR-NAME               PIC  X(30).        02690001
027000             15  ASC-VEND-INCHG-QUAL           PIC  X(02).        02700001
027100             15  ASC-VEND-INCHG-ID             PIC  X(15).        02710001
027200             15  ASC-NETWK-ID                  PIC  X(01).        02720001
027300             15  ASC-NRFC-ID                   PIC  X(01).        02730001
027400             15  ASC-NETWK-NAME                PIC  X(15).        02740001
027500             15  ASC-FUNC-CDE                  PIC  X(02).        02750001
027600             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           02760001
027700                 20  ASC-BLOCK-MODIFIED-SW                        02770001
027800                                        PIC X(01).                02780001
027900                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     02790001
028000                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     02800001
028100                                                                  02810001
028200                 20  ASC-ITEM-ARRAY.                              02820001
028300                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        02830001
028400                         30  ASC-LIST-ITEM-NUMBER                 02840001
028500                                        PIC S9(09) COMP-3.        02850001
028600                         30  ASC-TEMP-SELECTED-SW                 02860001
028700                                        PIC X(01).                02870001
028800                             88  ASC-VALID-SELECT  VALUE ' '      02880001
028900                                                         'S'      02890001
029000                                                         'B'      02900001
029100                                                         'E'.     02910001
029200                             88  ASC-TEMP-NO-SELECT               02920001
029300                                                   VALUE ' '.     02930001
029400                             88  ASC-TEMP-SELECT   VALUE 'S'.     02940001
029500                             88  ASC-TEMP-BEGIN    VALUE 'B'.     02950001
029600                             88  ASC-TEMP-END      VALUE 'E'.     02960001
029700                         30  ASC-SELECTED-SW                      02970001
029800                                        PIC X(01).                02980001
029900                             88  ASC-NO-SELECT     VALUE ' '.     02990001
030000                             88  ASC-SELECT        VALUE 'S'.     03000001
030100                             88  ASC-BEGIN         VALUE 'B'.     03010001
030200                             88  ASC-END           VALUE 'E'.     03020001
030300                         30  ASC-ACTION         PIC X(03).        03030001
030400                         30  ASC-TRAN-SET-CDE   PIC X(03).        03040001
030500                         30  ASC-PROD-TEST-IND  PIC X(01).        03050001
030600                         30  ASC-DIR-IND        PIC X(01).        03060001
030700                                                                  03070001
030800             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03080001
030900             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03090001
031000             15  ASC-SEL-SUB            PIC S9(04) COMP.          03100001
031100             15  ASC-SEL-ITEM           PIC S9(04) COMP.          03110001
031200             15  ASC-NUMBER-OF-ITEMS-READ                         03120001
031300                                        PIC S9(09) COMP-3.        03130001
031400             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03140001
031500                                        PIC S9(09) COMP-3.        03150001
031600             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        03160001
031700             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03170001
031800             15  ASC-ITEM-AT-TOP-OF-PANEL                         03180001
031900                                        PIC S9(09) COMP-3.        03190001
032000             15  ASC-ITEM-AT-BOT-OF-PANEL                         03200001
032100                                        PIC S9(09) COMP-3.        03210001
032200             15  ASC-HIGHEST-BLOCK-WRITTEN                        03220001
032300                                        PIC S9(04) COMP SYNC.     03230001
032400             15  ASC-START-OF-SELECTED-RANGE                      03240001
032500                                        PIC S9(09) COMP-3.        03250001
032600             15  ASC-END-OF-SELECTED-RANGE                        03260001
032700                                        PIC S9(09) COMP-3.        03270001
032800             15  ASC-ITEMS-LEFT-INDICATOR                         03280001
032900                                        PIC X(01).                03290001
033000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03300001
033100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03310001
033200             15  ASC-TEMP-QUEUE-UPDATE-SW                         03320001
033300                                        PIC X(01).                03330001
033400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03340001
033500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03350001
033600             15  ASC-LIST-QUEUE-NAME.                             03360001
033700                 20  ASC-LIST-TERM-ID   PIC X(04).                03370001
033800                 20  ASC-LIST-TASK-NUMBER                         03380001
033900                                        PIC S9(05) COMP-3.        03390001
034000                 20  ASC-LIST-SEQ       PIC 9(01).                03400001
034100             15  ASC-SEL-QUEUE-NAME-IN   PIC X(08).               03410001
034200             15  ASC-SEL-QUEUE-NAME-OUT.                          03420001
034300                 20  ASC-SEL-TERM-ID-OUT PIC X(04).               03430001
034400                 20  ASC-SEL-TASK-NUMBER-OUT                      03440001
034500                                         PIC S9(05) COMP-3.       03450001
034600                 20  ASC-SEL-SEQ-OUT     PIC 9(01).               03460001
034700                                                                  03470001
034800             15  ASC-START-ITEM-REQUEST.                          03480001
034900                 20  ASC-START-ITEM-REQUEST-N  PIC 9(07).         03490001
035000             15  ASC-USE-SELECTION-QUEUE-IND   PIC X(01).         03500001
035100                 88  ASC-USE-SELECTION-QUEUE   VALUE 'Y'.         03510001
035200             15  ASC-INT-APPL-FORMAT-IND       PIC X(01).         03520001
035300                 88  ASC-INT-APPL-FORMAT-LIST  VALUE '1' '3'.     03530001
035400                 88  ASC-INT-APPL-FORMAT-TP    VALUE '1' '2'.     03540001
035500                 88  ASC-INT-APPL-FORMAT-FG    VALUE '3' '4'.     03550001
035600/                                                                 03560001
035700*---------------------------------------------------------------* 03570001
035800*    ABEND PROCESSING COPYBOOK.                                 * 03580001
035900*---------------------------------------------------------------* 03590001
036000                                                                  03600001
036100     COPY DPWS013.                                                03610001
036200                                                                  03620001
036300/                                                                 03630001
036400*---------------------------------------------------------------* 03640001
036500*    DB2 AREA FOR THE TRADING PARTNER TRANSACTION SET TABLE     * 03650001
036600*---------------------------------------------------------------* 03660001
036700     EXEC SQL                                                     03670001
036800          INCLUDE TTRDTRN                                         03680001
036900     END-EXEC.                                                    03690001
037000                                                                  03700001
037100/                                                                 03710001
037200*---------------------------------------------------------------* 03720001
037300*    DB2 AREA FOR THE EDI NETWORK                               * 03730001
037400*---------------------------------------------------------------* 03740001
037500     EXEC SQL                                                     03750001
037600          INCLUDE TNETWRK                                         03760001
037700     END-EXEC.                                                    03770001
037800                                                                  03780001
037900*---------------------------------------------------------------* 03790001
038000*    DB2 AREA FOR COMMUNICATIONS                                * 03800001
038100*---------------------------------------------------------------* 03810001
038200     EXEC SQL                                                     03820001
038300          INCLUDE SQLCA                                           03830001
038400     END-EXEC.                                                    03840001
038500                                                                  03850001
038600/                                                                 03860001
038700*---------------------------------------------------------------* 03870001
038800*  CURSOR TO FUNCTIONAL GROUPS                                  * 03880001
038900*---------------------------------------------------------------* 03890001
039000                                                                  03900001
039100     EXEC SQL                                                     03910001
039200          DECLARE TTRDTRN_CSR CURSOR FOR                          03920001
039300           SELECT TRAN_SET_CDE                                    03930001
039400                 ,PROD_TEST_IND                                   03940001
039500                 ,DIR_IND                                         03950001
039600           FROM   TTRDTRN                                         03960001
039700           WHERE  TP_DKEY        = :DK-TP-DKEY                    03970001
039800             AND  DIR_IND  BETWEEN :DK-DIR-IND-LOW                03980001
039900                               AND :DK-DIR-IND-HIGH               03990001
040000             AND  FUNC_CDE BETWEEN :DK-FUNC-CDE-LOW               04000001
040100                               AND :DK-FUNC-CDE-HIGH              04010001
040200         ORDER BY TRAN_SET_CDE                                    04020001
040300     END-EXEC.                                                    04030001
040400                                                                  04040001
040500/                                                                 04050001
040600 LINKAGE SECTION.                                                 04060001
040700                                                                  04070001
040800 01  DFHCOMMAREA.                                                 04080001
040900     05  FILLER                         OCCURS  1 TO 4072 TIMES   04090001
041000                                        DEPENDING ON EIBCALEN.    04100001
041100         10  FILLER                     PIC X.                    04110001
041200                                                                  04120001
041300/                                                                 04130001
041400 PROCEDURE DIVISION.                                              04140001
041500*---------------------------------------------------------------* 04150001
041600*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04160001
041700*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04170001
041800*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04180001
041900*---------------------------------------------------------------* 04190001
042000 0000-MAIN-MODULE.                                                04200001
042100                                                                  04210001
042200     INITIALIZE DP030-CICS-API-FIELDS.                            04220001
042300                                                                  04230001
042400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04240001
042500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04250001
042600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04260001
042700                                                                  04270001
042800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04280001
042900                                                                  04290001
043000     MOVE LENGTH OF ET315AI        TO DP030-MAP-LENGTH (1).       04300001
043100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04310001
043200                                                                  04320001
043300     PERFORM 0001-CALL-CICS-ARCH-API.                             04330001
043400     PERFORM 1000-CONTROL-PROCESSING                              04340001
043500                                                                  04350001
043600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04360001
043700     PERFORM 0001-CALL-CICS-ARCH-API.                             04370001
043800                                                                  04380001
043900*---------------------------------------------------------------* 04390001
044000*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 04400001
044100*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 04410001
044200*---------------------------------------------------------------* 04420001
044300 0001-CALL-CICS-ARCH-API.                                         04430001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04440004
044500                                    DFHCOMMAREA                   04450004
044600                                    DP030-CICS-API-FIELDS         04460004
044700                                    DP020-STANDARD-COMMAREA       04470004
044800                                    ET315AI.                      04480004
044900                                                                  04490001
045000     IF  DP030-RC-CALL-SUCCESSFUL                                 04500001
045100         CONTINUE                                                 04510001
045200     ELSE                                                         04520001
045300         SET DP013-NO-ROLLBACK                                    04530001
045400             DP013-XCTL-DISPLAY-RESTART                           04540001
045500             DP013-CICS-ABEND      TO TRUE                        04550001
045600         MOVE '0001-CALL-CICS-ARCH-API'                           04560001
045700                                   TO DP013-PARAGRAPH             04570001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04580004
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04590004
046000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04600001
046100         PERFORM DP013-0000-PROCESS-ABEND                         04610001
046200     END-IF.                                                      04620001
046300                                                                  04630001
046400*----------------------------------------------------------------*04640001
046500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04650001
046600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04660001
046700*                                                                *04670001
046800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04680001
046900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04690001
047000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04700001
047100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04710001
047200*----------------------------------------------------------------*04720001
047300                                                                  04730001
047400 1000-CONTROL-PROCESSING.                                         04740001
047500                                                                  04750001
047600     EVALUATE TRUE                                                04760001
047700         WHEN DP020-NEXT-ACT-INITIAL                              04770001
047800             INITIALIZE ASC-SPECIFIC-COMMAREA                     04780001
047900             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04790001
048000                                      ASC-SEL-TERM-ID-OUT         04800001
048100             MOVE DP020-SRC-TASK-NUMBER                           04810001
048200                                   TO ASC-LIST-TASK-NUMBER        04820001
048300                                      ASC-SEL-TASK-NUMBER-OUT     04830001
048400             MOVE PC-LIST-QUEUE-SEQ                               04840001
048500                                   TO ASC-LIST-SEQ                04850001
048600             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             04860001
048700             MOVE DP020-INT-APPL-FORMAT-IND                       04870001
048800                                   TO ASC-INT-APPL-FORMAT-IND     04880001
048900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04890001
049000             IF  PS-COMMAREA-NOT-VALID                            04900001
049100                 SET DP020-MSG-FATAL                              04910001
049200                     DP020-NEXT-ACT-APPL-ERROR                    04920001
049300                                   TO TRUE                        04930001
049400             ELSE                                                 04940001
049500                 PERFORM 4000-BUILD-INITIAL-PANEL                 04950001
049600             END-IF                                               04960001
049700                                                                  04970001
049800         WHEN DP020-NEXT-ACT-READ-MAP                             04980001
049900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04990001
050000                                   TO PV-TOP-ITEM                 05000001
050100             PERFORM 2000-PROCESS-PANEL                           05010001
050200                                                                  05020001
050300         WHEN DP020-NEXT-ACT-RETURN                               05030001
050400              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       05040001
050500                                   TO PV-TOP-ITEM                 05050001
050600              MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    05060001
050700              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                05070001
050800              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05080001
050900              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05090001
051000                                                                  05100001
051100                                                                  05110001
051200         WHEN OTHER                                               05120001
051300             SET DP013-LOGIC-ABEND TO TRUE                        05130001
051400             SET DP013-NO-ROLLBACK TO TRUE                        05140001
051500             MOVE '1000-CONTROL-PROCESSING'                       05150001
051600                                   TO DP013-PARAGRAPH             05160001
051700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05170001
051800                                   TO DP013-MESSAGE-TEXT(1)       05180001
051900             PERFORM DP013-0000-PROCESS-ABEND                     05190001
052000     END-EVALUATE.                                                05200001
052100                                                                  05210001
052200/                                                                 05220001
052300*----------------------------------------------------------------*05230001
052400* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *05240001
052500*----------------------------------------------------------------*05250001
052600                                                                  05260001
052700 1100-PROCESS-INTER-APPL-COMM.                                    05270001
052800                                                                  05280001
052900     SET PS-COMMAREA-VALID         TO TRUE.                       05290001
053000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05300001
053100                                                                  05310001
053200     IF ASC-INT-APPL-FORMAT-LIST                                  05320001
053300         SET ASC-USE-SELECTION-QUEUE                              05330001
053400                              TO TRUE                             05340001
053500         MOVE ET300-NBR-SELECTED-ITEMS                            05350001
053600                              TO ASC-NUMBER-OF-SELECTED-ITEMS     05360001
053700         MOVE ET300-NUMBER-OF-TS-ITEMS                            05370001
053800                              TO ASC-NUMBER-OF-TS-ITEMS           05380001
053900         MOVE ET300-SEL-QUEUE-NAME                                05390001
054000                              TO ASC-SEL-QUEUE-NAME-IN            05400001
054100         PERFORM 1120-PREPARE-LIST-ENTRY                          05410001
054200     ELSE                                                         05420001
054300**       THIS PROGRAM ASSUMES THAT INTER-APPL FIELDS ARE          05430001
054400**       PROPERLY INITIALIZED...                                  05440001
054500         MOVE ET300-TP-DKEY           TO                          05450001
054600              ASC-KEY-TP-DKEY                                     05460001
054700         MOVE ET300-ENT-ID            TO                          05470001
054800              ASC-ENT-ID                                          05480001
054900         MOVE ET300-VENDOR-NAME       TO                          05490001
055000              ASC-VENDOR-NAME                                     05500001
055100         MOVE ET300-VENDOR-NAME       TO                          05510001
055200              ASC-VENDOR-NAME                                     05520001
055300         MOVE ET300-VEND-INCHG-QUAL   TO                          05530001
055400              ASC-VEND-INCHG-QUAL                                 05540001
055500         MOVE ET300-VEND-INCHG-ID     TO                          05550001
055600              ASC-VEND-INCHG-ID                                   05560001
055700         MOVE ET300-NETWK-ID          TO                          05570001
055800              ASC-NETWK-ID                                        05580001
055900         MOVE ET300-NETWORK-NAME      TO                          05590001
056000              ASC-NETWK-NAME                                      05600001
056100         MOVE ET300-FUNC-CDE          TO                          05610001
056200              ASC-FUNC-CDE                                        05620001
056300         MOVE ET300-DIR-IND           TO                          05630001
056400              ASC-KEY-DIR-IND                                     05640001
056500     END-IF.                                                      05650001
056600                                                                  05660001
056700*----------------------------------------------------------------*05670001
056800*  ENTRY IS FROM A LIST. GET THE KEYS FROM THE TEMP STORAGE      *05680001
056900*  QUEUE PASSED FROM THE LIST.                                   *05690001
057000*----------------------------------------------------------------*05700001
057100                                                                  05710001
057200 1120-PREPARE-LIST-ENTRY.                                         05720001
057300      MOVE ET301-MAX-ITEMS         TO ASC-SEL-SUB.                05730001
057400      MOVE ZERO                    TO ASC-SEL-ITEM.               05740001
057500      PERFORM 2300-GET-NEXT-RECORD.                               05750001
057600                                                                  05760001
057700/                                                                 05770001
057800*----------------------------------------------------------------*05780001
057900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05790001
058000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05800001
058100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05810001
058200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05820001
058300* FUNCTION KEYS CAN GET THIS FAR.                                *05830001
058400*----------------------------------------------------------------*05840001
058500                                                                  05850001
058600 2000-PROCESS-PANEL.                                              05860001
058700     EVALUATE TRUE                                                05870001
058800         WHEN DP020-SRC-AID = DP016-CLEAR                         05880001
058900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05890001
059000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05900001
059100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05910001
059200                                                                  05920001
059300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05930001
059400             PERFORM 2050-DELETE-LIST-QUEUE                       05940001
059500             PERFORM 4000-BUILD-INITIAL-PANEL                     05950001
059600                                                                  05960001
059700         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   05970001
059800             PERFORM 2140-DESELECT-ALL-ITEMS                      05980001
059900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05990001
060000                                                                  06000001
060100         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 06010001
060200              PERFORM 2150-SELECT-ALL-ITEMS                       06020001
060300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                06030001
060400                                                                  06040001
060500         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06050001
060600             IF ASC-USE-SELECTION-QUEUE                           06060001
060700                 PERFORM 6200-DEL-LIST-QUEUE                      06070001
060800                 PERFORM 2300-GET-NEXT-RECORD                     06080001
060900                 PERFORM 3200-RESET-ATTRIBUTES                    06090001
061000                 PERFORM 4000-BUILD-INITIAL-PANEL                 06100001
061100             ELSE                                                 06110001
061200*                --- BOTTOM OF LIST ---                           06120001
061300                 MOVE PC-TSYMSG-00070                             06130001
061400                                   TO DP020-MSG-NUMBER            06140001
061500                 SET DP020-MSG-INFORMATIONAL                      06150001
061600                                   TO TRUE                        06160001
061700             END-IF                                               06170001
061800                                                                  06180001
061900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06190001
062000             IF ASC-USE-SELECTION-QUEUE                           06200001
062100                 PERFORM 6200-DEL-LIST-QUEUE                      06210001
062200                 PERFORM 2315-GET-PREV-RECORD                     06220001
062300                 PERFORM 3200-RESET-ATTRIBUTES                    06230001
062400                 PERFORM 4000-BUILD-INITIAL-PANEL                 06240001
062500             ELSE                                                 06250001
062600*                --- TOP OF LIST ---                              06260001
062700                 MOVE PC-TSYMSG-00069                             06270001
062800                                   TO DP020-MSG-NUMBER            06280001
062900                 SET DP020-MSG-INFORMATIONAL                      06290001
063000                                   TO TRUE                        06300001
063100             END-IF                                               06310001
063200         WHEN OTHER                                               06320001
063300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06330001
063400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06340001
063500             IF  PS-NO-ERROR                                      06350001
063600                 SET DP030-CONTINUE-GO TO TRUE                    06360001
063700                 PERFORM 2100-CHECK-FUNCTION-KEY                  06370001
063800             ELSE                                                 06380001
063900                 SET DP030-OVERRIDE-GO TO TRUE                    06390001
064000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06400001
064100             END-IF                                               06410001
064200     END-EVALUATE.                                                06420001
064300                                                                  06430001
064400/                                                                 06440001
064500*----------------------------------------------------------------*06450001
064600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06460001
064700*----------------------------------------------------------------*06470001
064800 2050-DELETE-LIST-QUEUE.                                          06480001
064900                                                                  06490001
065000     EXEC CICS                                                    06500001
065100         DELETEQ TS                                               06510001
065200           QUEUE (ASC-LIST-QUEUE-NAME)                            06520001
065300            RESP (PV-CICS-RESP)                                   06530001
065400     END-EXEC.                                                    06540001
065500                                                                  06550001
065600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06560001
065700        (PV-CICS-RESP = DFHRESP(QIDERR))                          06570001
065800         CONTINUE                                                 06580001
065900     ELSE                                                         06590001
066000         SET DP013-CICS-ABEND      TO TRUE                        06600001
066100         SET DP013-NO-ROLLBACK     TO TRUE                        06610001
066200                                                                  06620001
066300         MOVE '2050-DELETE-LIST-QUEUE'                            06630001
066400                                   TO DP013-PARAGRAPH             06640001
066500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06650001
066600                                   TO DP013-MESSAGE-TEXT (1)      06660001
066700         PERFORM DP013-0000-PROCESS-ABEND                         06670001
066800     END-IF.                                                      06680001
066900                                                                  06690001
067000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06700001
067100                                                                  06710001
067200/                                                                 06720001
067300*----------------------------------------------------------------*06730001
067400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06740001
067500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06750001
067600* CICS ARCHITECTURE API.                                         *06760001
067700*----------------------------------------------------------------*06770001
067800 2100-CHECK-FUNCTION-KEY.                                         06780001
067900                                                                  06790001
068000     EVALUATE TRUE                                                06800001
068100         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 06810001
068200             IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0                 06820001
068300                 SET DP030-OVERRIDE-GO                            06830001
068400                                   TO TRUE                        06840001
068500                 MOVE PC-TSYMSG-00057                             06850001
068600                                   TO DP020-MSG-NUMBER            06860001
068700                 SET DP020-MSG-WARNING                            06870001
068800                                   TO TRUE                        06880001
068900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06890001
069000             ELSE                                                 06900001
069100                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO             06910001
069200                      ET300-NBR-SELECTED-ITEMS                    06920001
069300                 PERFORM 5000-PREPARE-SEL-QUEUE                   06930001
069400                                                                  06940001
069500                 PERFORM 7000-FORMAT-COMMAREA                     06950001
069600             END-IF                                               06960001
069700                                                                  06970001
069800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06980001
069900             MOVE +1               TO PV-TOP-ITEM                 06990001
070000             PERFORM 3200-RESET-ATTRIBUTES                        07000001
070100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07010001
070200                                                                  07020001
070300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07030001
070400             PERFORM 2110-BROWSE-BACKWARD                         07040001
070500             PERFORM 3200-RESET-ATTRIBUTES                        07050001
070600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07060001
070700                                                                  07070001
070800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07080001
070900             PERFORM 2120-BROWSE-FORWARD                          07090001
071000             PERFORM 3200-RESET-ATTRIBUTES                        07100001
071100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07110001
071200                                                                  07120001
071300         WHEN DP020-SRC-AID = DP016-ENTER                         07130001
071400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07140001
071500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07150001
071600                                                                  07160001
071700         WHEN OTHER                                               07170001
071800             SET DP013-NO-ROLLBACK                                07180001
071900                 DP013-XCTL-DISPLAY-RESTART                       07190001
072000                 DP013-CICS-ABEND  TO TRUE                        07200001
072100             MOVE '2100-CHECK-FUNCTION-KEY'                       07210001
072200                                   TO DP013-PARAGRAPH             07220001
072300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07230001
072400                                   TO DP013-MESSAGE-TEXT (1)      07240001
072500             PERFORM DP013-0000-PROCESS-ABEND                     07250001
072600     END-EVALUATE.                                                07260001
072700                                                                  07270001
072800/                                                                 07280001
072900*----------------------------------------------------------------*07290001
073000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07300001
073100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07310001
073200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07320001
073300*    MESSAGE.                                                    *07330001
073400*----------------------------------------------------------------*07340001
073500                                                                  07350001
073600 2110-BROWSE-BACKWARD.                                            07360001
073700                                                                  07370001
073800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07380001
073900         GIVING PV-TOP-ITEM.                                      07390001
074000                                                                  07400001
074100     IF  ((PV-TOP-ITEM < +1)                                      07410001
074200       OR (PV-TOP-ITEM = +1))                                     07420001
074300         MOVE +1                   TO PV-TOP-ITEM                 07430001
074400*        -- TOP OF LIST --                                        07440001
074500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07450001
074600         SET DP020-MSG-INFORMATIONAL                              07460001
074700                                   TO TRUE                        07470001
074800     END-IF.                                                      07480001
074900                                                                  07490001
075000/                                                                 07500001
075100*----------------------------------------------------------------*07510001
075200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07520001
075300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07530001
075400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07540001
075500*----------------------------------------------------------------*07550001
075600                                                                  07560001
075700 2120-BROWSE-FORWARD.                                             07570001
075800                                                                  07580001
075900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07590001
076000         GIVING PV-TOP-ITEM.                                      07600001
076100                                                                  07610001
076200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07620001
076300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07630001
076400                                   TO PV-TOP-ITEM                 07640001
076500*        -- BOTTOM OF LIST --                                     07650001
076600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07660001
076700         SET DP020-MSG-INFORMATIONAL                              07670001
076800                                   TO TRUE                        07680001
076900     ELSE                                                         07690001
077000         COMPUTE PV-BOTTOM-ITEM =                                 07700001
077100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07710001
077200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07720001
077300*            -- BOTTOM OF LIST --                                 07730001
077400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07740001
077500             SET DP020-MSG-INFORMATIONAL                          07750001
077600                                   TO TRUE                        07760001
077700         END-IF                                                   07770001
077800     END-IF.                                                      07780001
077900                                                                  07790001
078000/                                                                 07800001
078100*----------------------------------------------------------------*07810001
078200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07820001
078300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07830001
078400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07840001
078500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07850001
078600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07860001
078700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07870001
078800*----------------------------------------------------------------*07880001
078900                                                                  07890001
079000 2130-CHECK-FOR-JUMP-BROWSE.                                      07900001
079100                                                                  07910001
079200     IF (ASC-START-ITEM-REQUEST = SPACE)                          07920001
079300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07930001
079400                                   TO PV-TOP-ITEM                 07940001
079500     ELSE                                                         07950001
079600         MOVE ASC-START-ITEM-REQUEST                              07960001
079700                                   TO DP010I-UNEDITED-FIELD       07970001
079800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07980001
079900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07990001
080000         SET DP010I-NEGATIVE-NOT-ALLOWED                          08000001
080100                                   TO TRUE                        08010001
080210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08021002
080220                         USING DP010I-NUMERIC-EDIT-AREA           08022002
080300                                                                  08030001
080400         IF  NOT DP010I-ERROR-DETECTED                            08040001
080500             MOVE DP010I-NUMERIC-FIELD                            08050001
080600                                   TO ASC-START-ITEM-REQUEST-N    08060001
080700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08070001
080800                 IF  ASC-START-ITEM-REQUEST-N >                   08080001
080900                                          ASC-NUMBER-OF-ITEMS-READ08090001
081000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08100001
081100                     COMPUTE PV-TOP-ITEM =                        08110001
081200                             ASC-NUMBER-OF-ITEMS-READ             08120001
081300                             - PC-ITEMS-PER-PANEL + 1             08130001
081400                     IF  PV-TOP-ITEM < +1                         08140001
081500                         MOVE +1   TO PV-TOP-ITEM                 08150001
081600                         MOVE PC-TSYMSG-00070                     08160001
081700                                   TO DP020-MSG-NUMBER            08170001
081800                         SET DP020-MSG-INFORMATIONAL              08180001
081900                                   TO TRUE                        08190001
082000                     END-IF                                       08200001
082100                 ELSE                                             08210001
082200                     MOVE ASC-START-ITEM-REQUEST-N                08220001
082300                                   TO PV-TOP-ITEM                 08230001
082400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08240001
082500                     COMPUTE PV-BOTTOM-ITEM =                     08250001
082600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08260001
082700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08270001
082800*                        -- BOTTOM OF LIST --                     08280001
082900                         MOVE PC-TSYMSG-00070                     08290001
083000                                   TO DP020-MSG-NUMBER            08300001
083100                         SET DP020-MSG-INFORMATIONAL              08310001
083200                                   TO TRUE                        08320001
083300                     END-IF                                       08330001
083400                 END-IF                                           08340001
083500             ELSE                                                 08350001
083600*                --- VALUE OUT OF RANGE ----                      08360001
083700                 MOVE PC-TSYMSG-00101                             08370001
083800                                   TO DP020-MSG-NUMBER            08380001
083900                 MOVE -1           TO ASTRTITL                    08390001
084000                 SET DP030-SET-CURSOR-APPL-1                      08400001
084100                                   TO TRUE                        08410001
084200                 MOVE DP015-REVERSE                               08420001
084300                                   TO ASTRTITH                    08430001
084400                 MOVE DP015-RED    TO ASTRTITC                    08440001
084500                 MOVE DP015-UNP-NUM-BRT-OFF                       08450001
084600                                   TO ASTRTITA                    08460001
084700                 SET DP020-MSG-FATAL                              08470001
084800                     PS-START-ITEM-ERROR                          08480001
084900                                   TO TRUE                        08490001
085000             END-IF                                               08500001
085100                                                                  08510001
085200         ELSE                                                     08520001
085300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08530001
085400             MOVE -1               TO ASTRTITL                    08540001
085500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08550001
085600             MOVE DP015-REVERSE    TO ASTRTITH                    08560001
085700             MOVE DP015-RED        TO ASTRTITC                    08570001
085800             MOVE DP015-UNP-NUM-BRT-OFF                           08580001
085900                                   TO ASTRTITA                    08590001
086000             SET DP020-MSG-FATAL                                  08600001
086100                 PS-START-ITEM-ERROR                              08610001
086200                                   TO TRUE                        08620001
086300         END-IF                                                   08630001
086400     END-IF.                                                      08640001
086500                                                                  08650001
086600/                                                                 08660001
086700*----------------------------------------------------------------*08670001
086800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08680001
086900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08690001
087000*----------------------------------------------------------------*08700001
087100 2140-DESELECT-ALL-ITEMS.                                         08710001
087200                                                                  08720001
087300     MOVE +1                       TO ASC-BLK-SUB.                08730001
087400                                                                  08740001
087500     PERFORM 2141-CLEAR-SELECTED-INDS                             08750001
087600         VARYING ASC-ITEM-SUB                                     08760001
087700         FROM 1 BY 1                                              08770001
087800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08780001
087900                                                                  08790001
088000     ADD +1                        TO ASC-BLK-SUB.                08800001
088100                                                                  08810001
088200     PERFORM 2141-CLEAR-SELECTED-INDS                             08820001
088300         VARYING ASC-ITEM-SUB                                     08830001
088400         FROM 1 BY 1                                              08840001
088500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08850001
088600                                                                  08860001
088700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08870001
088800                                   TO PV-LIST-ITEM-NUMBER.        08880001
088900                                                                  08890001
089000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08900001
089100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08910001
089200                                                                  08920001
089300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08930001
089400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08940001
089500         MOVE +1                   TO ASC-BLK-SUB                 08950001
089600                                                                  08960001
089700         PERFORM 5100-WRITE-TEMP-STORAGE                          08970001
089800                                                                  08980001
089900         MOVE +1                   TO PV-BLOCK-NUMBER             08990001
090000                                                                  09000001
090100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09010001
090200             PV-FIRST-BLOCK-IN-ARRAY - 1                          09020001
090300                                                                  09030001
090400         PERFORM                                                  09040001
090500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09050001
090600                                                                  09060001
090700             PERFORM 4410-READ-TEMP-STORAGE                       09070001
090800                                                                  09080001
090900             PERFORM 2141-CLEAR-SELECTED-INDS                     09090001
091000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09100001
091100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09110001
091200                                                                  09120001
091300             PERFORM 5100-WRITE-TEMP-STORAGE                      09130001
091400                                                                  09140001
091500             ADD +1                TO PV-BLOCK-NUMBER             09150001
091600                                                                  09160001
091700         END-PERFORM                                              09170001
091800                                                                  09180001
091900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09190001
092000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09200001
092100                                                                  09210001
092200         PERFORM                                                  09220001
092300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09230001
092400                   ASC-HIGHEST-BLOCK-WRITTEN                      09240001
092500                                                                  09250001
092600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09260001
092700                                   TO PV-BLOCK-NUMBER             09270001
092800                                                                  09280001
092900             PERFORM 4410-READ-TEMP-STORAGE                       09290001
093000                                                                  09300001
093100             PERFORM 2141-CLEAR-SELECTED-INDS                     09310001
093200                 VARYING ASC-ITEM-SUB                             09320001
093300                 FROM 1 BY 1                                      09330001
093400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09340001
093500                                                                  09350001
093600             PERFORM 5100-WRITE-TEMP-STORAGE                      09360001
093700                                                                  09370001
093800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09380001
093900                                                                  09390001
094000         END-PERFORM                                              09400001
094100                                                                  09410001
094200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09420001
094300                                   TO PV-BLOCK-NUMBER             09430001
094400                                                                  09440001
094500         PERFORM 4410-READ-TEMP-STORAGE                           09450001
094600     END-IF.                                                      09460001
094700                                                                  09470001
094800                                                                  09480001
094900     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS09490001
095000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09500001
095100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09510001
095200                                                                  09520001
095300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09530001
095400                                                                  09540001
095500/                                                                 09550001
095600*----------------------------------------------------------------*09560001
095700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09570001
095800*----------------------------------------------------------------*09580001
095900                                                                  09590001
096000 2141-CLEAR-SELECTED-INDS.                                        09600001
096100                                                                  09610001
096200     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          09620001
096300             NOT EQUAL ZERO                                       09630001
096400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09640001
096500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09650001
096600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09660001
096700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09670001
096800                                   TO TRUE                        09680001
096900         END-IF                                                   09690001
097000     END-IF.                                                      09700001
097100                                                                  09710001
097200/                                                                 09720001
097300*----------------------------------------------------------------*09730001
097400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09740001
097500*  FOR ALL ITEMS.                                                *09750001
097600*----------------------------------------------------------------*09760001
097700                                                                  09770001
097800 2150-SELECT-ALL-ITEMS.                                           09780001
097900                                                                  09790001
098000     MOVE +1                       TO ASC-BLK-SUB.                09800001
098100                                                                  09810001
098200     PERFORM 2151-SET-SELECTED-INDS                               09820001
098300         VARYING ASC-ITEM-SUB                                     09830001
098400         FROM 1 BY 1                                              09840001
098500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09850001
098600                                                                  09860001
098700     ADD +1                        TO ASC-BLK-SUB.                09870001
098800                                                                  09880001
098900     PERFORM 2151-SET-SELECTED-INDS                               09890001
099000         VARYING ASC-ITEM-SUB                                     09900001
099100         FROM 1 BY 1                                              09910001
099200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09920001
099300                                                                  09930001
099400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09940001
099500                                   TO PV-LIST-ITEM-NUMBER.        09950001
099600                                                                  09960001
099700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09970001
099800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09980001
099900                                                                  09990001
100000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10000001
100100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10010001
100200         MOVE +1                   TO ASC-BLK-SUB                 10020001
100300                                                                  10030001
100400         PERFORM 5100-WRITE-TEMP-STORAGE                          10040001
100500                                                                  10050001
100600         MOVE +1                   TO PV-BLOCK-NUMBER             10060001
100700                                                                  10070001
100800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10080001
100900             PV-FIRST-BLOCK-IN-ARRAY - 1                          10090001
101000                                                                  10100001
101100         PERFORM                                                  10110001
101200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10120001
101300                                                                  10130001
101400             PERFORM 4410-READ-TEMP-STORAGE                       10140001
101500                                                                  10150001
101600             PERFORM 2151-SET-SELECTED-INDS                       10160001
101700                 VARYING ASC-ITEM-SUB                             10170001
101800                 FROM 1 BY 1                                      10180001
101900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10190001
102000                                                                  10200001
102100             PERFORM 5100-WRITE-TEMP-STORAGE                      10210001
102200                                                                  10220001
102300             ADD +1                TO PV-BLOCK-NUMBER             10230001
102400         END-PERFORM                                              10240001
102500                                                                  10250001
102600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10260001
102700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10270001
102800                                                                  10280001
102900         PERFORM                                                  10290001
103000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10300001
103100                   ASC-HIGHEST-BLOCK-WRITTEN                      10310001
103200                                                                  10320001
103300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10330001
103400                                   TO PV-BLOCK-NUMBER             10340001
103500                                                                  10350001
103600             PERFORM 4410-READ-TEMP-STORAGE                       10360001
103700                                                                  10370001
103800             PERFORM 2151-SET-SELECTED-INDS                       10380001
103900                 VARYING ASC-ITEM-SUB                             10390001
104000                 FROM 1 BY 1                                      10400001
104100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10410001
104200                                                                  10420001
104300             PERFORM 5100-WRITE-TEMP-STORAGE                      10430001
104400                                                                  10440001
104500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10450001
104600         END-PERFORM                                              10460001
104700                                                                  10470001
104800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10480001
104900                                   TO PV-BLOCK-NUMBER             10490001
105000                                                                  10500001
105100         PERFORM 4410-READ-TEMP-STORAGE                           10510001
105200     END-IF.                                                      10520001
105300                                                                  10530001
105400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10540001
105500          ASC-NUMBER-OF-SELECTED-ITEMS.                           10550001
105600                                                                  10560001
105700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10570001
105800                                                                  10580001
105900/                                                                 10590001
106000*----------------------------------------------------------------*10600001
106100*    MARK EACH ITEM AS BEING SELECTED.                           *10610001
106200*----------------------------------------------------------------*10620001
106300                                                                  10630001
106400 2151-SET-SELECTED-INDS.                                          10640001
106500                                                                  10650001
106600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10660001
106700             NOT EQUAL ZERO                                       10670001
106800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10680001
106900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10690001
107000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10700001
107100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10710001
107200                                   TO TRUE                        10720001
107300         END-IF                                                   10730001
107400     END-IF.                                                      10740001
107500                                                                  10750001
107600/                                                                 10760001
107700*----------------------------------------------------------------*10770001
107800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *10780001
107900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *10790001
108000*----------------------------------------------------------------*10800001
108100 2200-MOVE-SCREEN-TO-COMMAREA.                                    10810001
108200                                                                  10820001
108300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10830001
108400     MOVE +1                       TO PV-SUB.                     10840001
108500                                                                  10850001
108600     PERFORM 3150-SET-SUBSCRIPTS.                                 10860001
108700                                                                  10870001
108800     IF  ASTRTITL > ZERO                                          10880001
108900         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      10890001
109000     ELSE                                                         10900001
109100         IF  ASTRTITF = DP015-ERASE-EOF                           10910001
109200             INITIALIZE ASC-START-ITEM-REQUEST                    10920001
109300         END-IF                                                   10930001
109400     END-IF.                                                      10940001
109500                                                                  10950001
109600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10960001
109700         VARYING PV-SUB                                           10970001
109800         FROM 1 BY 1                                              10980001
109900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10990001
110000                                                                  11000001
110100/                                                                 11010001
110200*----------------------------------------------------------------*11020001
110300*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *11030001
110400*----------------------------------------------------------------*11040001
110500 2210-MOVE-LINES-TO-COMMAREA.                                     11050001
110600                                                                  11060001
110700     IF  MR-SELECTL (PV-SUB) > ZERO                               11070001
110800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     11080001
110900                                   TO TRUE                        11090001
111000         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        11100001
111100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11110001
111200     ELSE                                                         11120001
111300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11130001
111400             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         11140001
111500             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        11150001
111600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11160001
111700         END-IF                                                   11170001
111800     END-IF.                                                      11180001
111900                                                                  11190001
112000     ADD +1                        TO ASC-ITEM-SUB.               11200001
112100                                                                  11210001
112200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11220001
112300         ADD +1                    TO ASC-BLK-SUB                 11230001
112400         MOVE +1                   TO ASC-ITEM-SUB                11240001
112500     END-IF.                                                      11250001
112600                                                                  11260001
112700/                                                                 11270001
112800******************************************************************11280001
112900* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *11290001
113000* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *11300001
113100******************************************************************11310001
113200 2300-GET-NEXT-RECORD.                                            11320001
113300                                                                  11330001
113400     ADD +1                        TO ASC-SEL-SUB.                11340001
113500     IF ASC-SEL-SUB > ET301-MAX-ITEMS                             11350001
113600         ADD +1                    TO ASC-SEL-ITEM                11360001
113700         MOVE +1                   TO ASC-SEL-SUB                 11370001
113800     END-IF.                                                      11380001
113900     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 11390001
114000         PERFORM 9100-READ-SEL-QUEUE                              11400001
114100         IF ET301-ITEM (ASC-SEL-SUB) > ZERO                       11410001
114200             INITIALIZE ASC-LIST-KEYS                             11420001
114300             MOVE ET301-TP-DKEY            (ASC-SEL-SUB) TO       11430001
114400                  ASC-KEY-TP-DKEY                                 11440001
114500             MOVE ET301-ENT-ID             (ASC-SEL-SUB) TO       11450001
114600                  ASC-ENT-ID                                      11460001
114700             MOVE ET301-VENDOR-NAME        (ASC-SEL-SUB) TO       11470001
114800                  ASC-VENDOR-NAME                                 11480001
114900             MOVE ET301-VEND-INCHG-QUAL    (ASC-SEL-SUB) TO       11490001
115000                  ASC-VEND-INCHG-QUAL                             11500001
115100             MOVE ET301-VEND-INCHG-ID      (ASC-SEL-SUB) TO       11510001
115200                  ASC-VEND-INCHG-ID                               11520001
115300             MOVE ET301-NETWK-ID           (ASC-SEL-SUB) TO       11530001
115400                  ASC-NETWK-ID                                    11540001
115500             MOVE ET301-NETWK-NAME         (ASC-SEL-SUB) TO       11550001
115600                  ASC-NETWK-NAME                                  11560001
115700             MOVE ET301-FUNC-CDE           (ASC-SEL-SUB) TO       11570001
115800                  ASC-FUNC-CDE                                    11580001
115900             MOVE ET301-DIR-IND            (ASC-SEL-SUB) TO       11590001
116000                  ASC-KEY-DIR-IND                                 11600001
116100             SET ET301-INQ (ASC-SEL-SUB)           TO TRUE        11610001
116200             PERFORM 9200-REWRITE-LIST-QUEUE                      11620001
116300         ELSE                                                     11630001
116400             SUBTRACT +1 FROM ASC-SEL-SUB                         11640001
116500*            --- BOTTOM OF LIST ---                               11650001
116600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11660001
116700             SET DP020-MSG-INFORMATIONAL                          11670001
116800                                   TO TRUE                        11680001
116900         END-IF                                                   11690001
117000     ELSE                                                         11700001
117100         SUBTRACT +1 FROM ASC-SEL-ITEM                            11710001
117200         MOVE ET301-MAX-ITEMS      TO ASC-SEL-SUB                 11720001
117300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11730001
117400         SET DP020-MSG-INFORMATIONAL                              11740001
117500                                   TO TRUE                        11750001
117600     END-IF.                                                      11760001
117700                                                                  11770001
117800/                                                                 11780001
117900******************************************************************11790001
118000* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *11800001
118100* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *11810001
118200******************************************************************11820001
118300 2315-GET-PREV-RECORD.                                            11830001
118400                                                                  11840001
118500     SUBTRACT +1 FROM ASC-SEL-SUB.                                11850001
118600     IF ASC-SEL-SUB < +1                                          11860001
118700         SUBTRACT +1 FROM ASC-SEL-ITEM                            11870001
118800         MOVE ET301-MAX-ITEMS      TO ASC-SEL-SUB                 11880001
118900     END-IF.                                                      11890001
119000                                                                  11900001
119100     IF ASC-SEL-ITEM > ZERO                                       11910001
119200         PERFORM 9100-READ-SEL-QUEUE                              11920001
119300         INITIALIZE ASC-LIST-KEYS                                 11930001
119400         MOVE ET301-TP-DKEY            (ASC-SEL-SUB) TO           11940001
119500              ASC-KEY-TP-DKEY                                     11950001
119600         MOVE ET301-ENT-ID             (ASC-SEL-SUB) TO           11960001
119700              ASC-ENT-ID                                          11970001
119800         MOVE ET301-VENDOR-NAME        (ASC-SEL-SUB) TO           11980001
119900              ASC-VENDOR-NAME                                     11990001
120000         MOVE ET301-VEND-INCHG-QUAL    (ASC-SEL-SUB) TO           12000001
120100              ASC-VEND-INCHG-QUAL                                 12010001
120200         MOVE ET301-VEND-INCHG-ID      (ASC-SEL-SUB) TO           12020001
120300              ASC-VEND-INCHG-ID                                   12030001
120400         MOVE ET301-NETWK-ID           (ASC-SEL-SUB) TO           12040001
120500              ASC-NETWK-ID                                        12050001
120600         MOVE ET301-NETWK-NAME         (ASC-SEL-SUB) TO           12060001
120700              ASC-NETWK-NAME                                      12070001
120800         MOVE ET301-FUNC-CDE           (ASC-SEL-SUB) TO           12080001
120900              ASC-FUNC-CDE                                        12090001
121000         MOVE ET301-DIR-IND            (ASC-SEL-SUB) TO           12100001
121100              ASC-KEY-DIR-IND                                     12110001
121200     ELSE                                                         12120001
121300         MOVE +1                   TO ASC-SEL-ITEM                12130001
121400                                      ASC-SEL-SUB                 12140001
121500*        --- TOP OF LIST ---                                      12150001
121600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            12160001
121700         SET DP020-MSG-INFORMATIONAL                              12170001
121800                                   TO TRUE                        12180001
121900     END-IF.                                                      12190001
122000                                                                  12200001
122100/                                                                 12210001
122200*----------------------------------------------------------------*12220001
122300*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12230001
122400*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12240001
122500*----------------------------------------------------------------*12250001
122600 3000-EDIT-DATA-IN-COMMAREA.                                      12260001
122700                                                                  12270001
122800     SET PS-NO-ERROR               TO TRUE.                       12280001
122900                                                                  12290001
123000     PERFORM 3200-RESET-ATTRIBUTES.                               12300001
123100                                                                  12310001
123200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12320001
123300**                                                                12330001
123400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12340001
123500* EDITTING IS DONE FROM THE BOTTOM UP.                            12350001
123600**                                                                12360001
123700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12370001
123800         ASC-ITEMS-DISPLAYED - 1.                                 12380001
123900                                                                  12390001
124000     PERFORM 3150-SET-SUBSCRIPTS.                                 12400001
124100     PERFORM 3300-EDIT-SELECTIONS                                 12410001
124200         VARYING PV-SUB                                           12420001
124300         FROM PV-SUB BY -1                                        12430001
124400         UNTIL PV-SUB < +1                                        12440001
124500                                                                  12450001
124600     IF  PS-NO-ERROR                                              12460001
124700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12470001
124800     END-IF.                                                      12480001
124900                                                                  12490001
125000     IF  ((PS-NO-ERROR)                                           12500001
125100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12510001
125200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12520001
125300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12530001
125400     END-IF.                                                      12540001
125500                                                                  12550001
125600/                                                                 12560001
125700*----------------------------------------------------------------*12570001
125800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12580001
125900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12590001
126000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12600001
126100*                                                                *12610001
126200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12620001
126300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12630001
126400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12640001
126500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12650001
126600*----------------------------------------------------------------*12660001
126700                                                                  12670001
126800 3150-SET-SUBSCRIPTS.                                             12680001
126900                                                                  12690001
127000     COMPUTE ASC-ITEM-SUB =                                       12700001
127100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12710001
127200                                                                  12720001
127300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12730001
127400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12740001
127500                                                                  12750001
127600         MOVE PC-MAX-BLOCKS-IN-ARRAY                              12760001
127700                                   TO ASC-BLK-SUB                 12770001
127800     ELSE                                                         12780001
127900         MOVE +1                   TO ASC-BLK-SUB                 12790001
128000     END-IF.                                                      12800001
128100                                                                  12810001
128200*----------------------------------------------------------------*12820001
128300*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *12830001
128400*----------------------------------------------------------------*12840001
128500                                                                  12850001
128600 3200-RESET-ATTRIBUTES.                                           12860001
128700                                                                  12870001
128800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12880001
128900     MOVE DP015-GREEN              TO ASTRTITC.                   12890001
129000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12900001
129100                                                                  12910001
129200     PERFORM                                                      12920001
129300         VARYING PV-SUB                                           12930001
129400         FROM 1 BY 1                                              12940001
129500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12950001
129600         MOVE DP015-UNP-ALP-NOR-OFF                               12960001
129700                                   TO MR-SELECTA (PV-SUB)         12970001
129800         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         12980001
129900         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         12990001
130000     END-PERFORM.                                                 13000001
130100                                                                  13010001
130200/                                                                 13020001
130300*----------------------------------------------------------------*13030001
130400*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *13040001
130500*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *13050001
130600*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *13060001
130700*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *13070001
130800*----------------------------------------------------------------*13080001
130900 3300-EDIT-SELECTIONS.                                            13090001
131000                                                                  13100001
131100     EVALUATE TRUE                                                13110001
131200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13120001
131300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13130001
131400                 CONTINUE                                         13140001
131500                                                                  13150001
131600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13160001
131700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13170001
131800                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS13180001
131900                 MOVE ASC-TEMP-SELECTED-SW                        13190001
132000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13200001
132100                                   TO ASC-SELECTED-SW             13210001
132200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13220001
132300             END-IF                                               13230001
132400                                                                  13240001
132500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13250001
132600                 = SPACE                                          13260001
132700             EVALUATE TRUE                                        13270001
132800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13280001
132900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13290001
133000                     MOVE SPACE    TO ASC-SELECTED-SW             13300001
133100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13310001
133200                                                                  13320001
133300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13330001
133400                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 13340001
133500                     MOVE SPACE    TO ASC-SELECTED-SW             13350001
133600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13360001
133700                                                                  13370001
133800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13380001
133900                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   13390001
134000                     MOVE SPACE    TO ASC-SELECTED-SW             13400001
134100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13410001
134200             END-EVALUATE                                         13420001
134300                                                                  13430001
134400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13440001
134500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13450001
134600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13460001
134700             END-IF                                               13470001
134800             PERFORM 3315-EDIT-RANGE                              13480001
134900                                                                  13490001
135000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13500001
135100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13510001
135200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13520001
135300             END-IF                                               13530001
135400             PERFORM 3315-EDIT-RANGE                              13540001
135500                                                                  13550001
135600         WHEN OTHER                                               13560001
135700             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            13570001
135800             SET DP020-MSG-FATAL   TO TRUE                        13580001
135900             MOVE -1               TO MR-SELECTL (PV-SUB)         13590001
136000             SET DP030-SET-CURSOR-APPL-1                          13600001
136100                                   TO TRUE                        13610001
136200             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         13620001
136300             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         13630001
136400             SET PS-ERROR          TO TRUE                        13640001
136500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13650001
136600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13660001
136700                 MOVE SPACE        TO ASC-SELECTED-SW             13670001
136800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13680001
136900             END-IF                                               13690001
137000     END-EVALUATE.                                                13700001
137100                                                                  13710001
137200     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             13720001
137300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13730001
137400                                                                  13740001
137500     IF  ASC-ITEM-SUB < 1                                         13750001
137600         SUBTRACT +1 FROM ASC-BLK-SUB                             13760001
137700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13770001
137800     END-IF.                                                      13780001
137900                                                                  13790001
138000*----------------------------------------------------------------*13800001
138100*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *13810001
138200*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *13820001
138300*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *13830001
138400*  THE ENDING.                                                   *13840001
138500*----------------------------------------------------------------*13850001
138600 3315-EDIT-RANGE.                                                 13860001
138700                                                                  13870001
138800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13880001
138900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13890001
139000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13900001
139100                                   TO ASC-SELECTED-SW             13910001
139200                                        (ASC-BLK-SUB ASC-ITEM-SUB)13920001
139300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13930001
139400         ELSE                                                     13940001
139500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13950001
139600                 CONTINUE                                         13960001
139700             ELSE                                                 13970001
139800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13980001
139900                 MOVE PC-TSYMSG-00054                             13990001
140000                                   TO DP020-MSG-NUMBER            14000001
140100                 SET DP020-MSG-FATAL                              14010001
140200                                   TO TRUE                        14020001
140300                 MOVE -1           TO MR-SELECTL (PV-SUB)         14030001
140400                 SET DP030-SET-CURSOR-APPL-1                      14040001
140500                                   TO TRUE                        14050001
140600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14060001
140700                 MOVE DP015-UNDERLINE                             14070001
140800                                   TO MR-SELECTH (PV-SUB)         14080001
140900                 SET PS-ERROR      TO TRUE                        14090001
141000             END-IF                                               14100001
141100         END-IF                                                   14110001
141200     ELSE                                                         14120001
141300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14130001
141400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14140001
141500                                   TO ASC-SELECTED-SW             14150001
141600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14160001
141700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14170001
141800         ELSE                                                     14180001
141900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14190001
142000                 CONTINUE                                         14200001
142100             ELSE                                                 14210001
142200*                -- ONLY ONE END-OF-RANGE ALLOWED --              14220001
142300                 MOVE PC-TSYMSG-00055                             14230001
142400                                   TO DP020-MSG-NUMBER            14240001
142500                 SET DP020-MSG-FATAL                              14250001
142600                                   TO TRUE                        14260001
142700                 MOVE -1           TO MR-SELECTL (PV-SUB)         14270001
142800                 SET DP030-SET-CURSOR-APPL-1                      14280001
142900                                   TO TRUE                        14290001
143000                 SET PS-ERROR      TO TRUE                        14300001
143100             END-IF                                               14310001
143200         END-IF                                                   14320001
143300     END-IF.                                                      14330001
143400                                                                  14340001
143500*----------------------------------------------------------------*14350001
143600*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *14360001
143700*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *14370001
143800*----------------------------------------------------------------*14380001
143900 3400-CHECK-RANGE-SEQUENCE.                                       14390001
144000                                                                  14400001
144100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14410001
144200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14420001
144300       AND  ASC-START-OF-SELECTED-RANGE >                         14430001
144400                                         ASC-END-OF-SELECTED-RANGE14440001
144500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14450001
144600         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            14460001
144700         SET DP020-MSG-FATAL       TO TRUE                        14470001
144800         SET PS-ERROR              TO TRUE                        14480001
144900         PERFORM 3410-POSITION-AT-ERROR                           14490001
145000     END-IF.                                                      14500001
145100                                                                  14510001
145200*----------------------------------------------------------------*14520001
145300*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *14530001
145400*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *14540001
145500*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *14550001
145600*----------------------------------------------------------------*14560001
145700 3410-POSITION-AT-ERROR.                                          14570001
145800                                                                  14580001
145900     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14590001
146000                                                                  14600001
146100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14610001
146200                    - PV-TOP-ITEM + 1.                            14620001
146300                                                                  14630001
146400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14640001
146500         CONTINUE                                                 14650001
146600     ELSE                                                         14660001
146700         MOVE -1                   TO MR-SELECTL (PV-SUB)         14670001
146800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14680001
146900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14690001
147000     END-IF.                                                      14700001
147100                                                                  14710001
147200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14720001
147300                    - PV-TOP-ITEM + 1.                            14730001
147400                                                                  14740001
147500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14750001
147600         CONTINUE                                                 14760001
147700     ELSE                                                         14770001
147800         MOVE -1                   TO MR-SELECTL (PV-SUB)         14780001
147900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14790001
148000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14800001
148100     END-IF.                                                      14810001
148200                                                                  14820001
148300/                                                                 14830001
148400*----------------------------------------------------------------*14840001
148500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14850001
148600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14860001
148700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14870001
148800*----------------------------------------------------------------*14880001
148900                                                                  14890001
149000 3500-MARK-RANGE-AS-SELECTED.                                     14900001
149100                                                                  14910001
149200     MOVE +1                       TO ASC-BLK-SUB.                14920001
149300                                                                  14930001
149400     PERFORM 3510-MARK-SELECTED-INDS                              14940001
149500         VARYING ASC-ITEM-SUB                                     14950001
149600         FROM 1 BY 1                                              14960001
149700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14970001
149800                                                                  14980001
149900     ADD +1                        TO ASC-BLK-SUB.                14990001
150000                                                                  15000001
150100     PERFORM 3510-MARK-SELECTED-INDS                              15010001
150200         VARYING ASC-ITEM-SUB                                     15020001
150300         FROM 1 BY 1                                              15030001
150400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15040001
150500                                                                  15050001
150600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15060001
150700                                   TO PV-LIST-ITEM-NUMBER.        15070001
150800                                                                  15080001
150900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15090001
151000         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15100001
151100               PC-ITEMS-PER-PANEL).                               15110001
151200                                                                  15120001
151300     MOVE ASC-START-OF-SELECTED-RANGE                             15130001
151400                                   TO PV-START-OF-SELECTED-RANGE. 15140001
151500                                                                  15150001
151600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15160001
151700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15170001
151800               PC-ITEMS-PER-PANEL).                               15180001
151900                                                                  15190001
152000     MOVE ASC-END-OF-SELECTED-RANGE                               15200001
152100                                   TO PV-END-OF-SELECTED-RANGE.   15210001
152200                                                                  15220001
152300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15230001
152400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15240001
152500               PC-ITEMS-PER-PANEL).                               15250001
152600                                                                  15260001
152700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15270001
152800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15280001
152900                                                                  15290001
153000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15300001
153100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15310001
153200         MOVE +1                   TO ASC-BLK-SUB                 15320001
153300         PERFORM 5100-WRITE-TEMP-STORAGE                          15330001
153400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15340001
153500             PV-FIRST-BLOCK-IN-ARRAY - 1                          15350001
153600                                                                  15360001
153700         PERFORM                                                  15370001
153800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15380001
153900                   PV-PREV-BLOCK-IN-ARRAY                         15390001
154000             MOVE PV-FIRST-BLOCK-IN-RANGE                         15400001
154100                                   TO PV-BLOCK-NUMBER             15410001
154200             PERFORM 4410-READ-TEMP-STORAGE                       15420001
154300             PERFORM 3510-MARK-SELECTED-INDS                      15430001
154400                 VARYING ASC-ITEM-SUB                             15440001
154500                 FROM 1 BY 1                                      15450001
154600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15460001
154700             PERFORM 5100-WRITE-TEMP-STORAGE                      15470001
154800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15480001
154900         END-PERFORM                                              15490001
155000                                                                  15500001
155100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15510001
155200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15520001
155300         PERFORM                                                  15530001
155400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15540001
155500                   PV-LAST-BLOCK-IN-RANGE                         15550001
155600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15560001
155700                                   TO PV-BLOCK-NUMBER             15570001
155800             PERFORM 4410-READ-TEMP-STORAGE                       15580001
155900             PERFORM 3510-MARK-SELECTED-INDS                      15590001
156000                 VARYING ASC-ITEM-SUB                             15600001
156100                 FROM 1 BY 1                                      15610001
156200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15620001
156300             PERFORM 5100-WRITE-TEMP-STORAGE                      15630001
156400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15640001
156500         END-PERFORM                                              15650001
156600                                                                  15660001
156700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15670001
156800                                   TO PV-BLOCK-NUMBER             15680001
156900         PERFORM 4410-READ-TEMP-STORAGE                           15690001
157000     END-IF.                                                      15700001
157100                                                                  15710001
157200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15720001
157300                                      ASC-END-OF-SELECTED-RANGE.  15730001
157400                                                                  15740001
157500/                                                                 15750001
157600*----------------------------------------------------------------*15760001
157700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15770001
157800*----------------------------------------------------------------*15780001
157900                                                                  15790001
158000 3510-MARK-SELECTED-INDS.                                         15800001
158100                                                                  15810001
158200     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         15820001
158300         ASC-START-OF-SELECTED-RANGE)                             15830001
158400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         15840001
158500         ASC-START-OF-SELECTED-RANGE)                             15850001
158600                                                                  15860001
158700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     15870001
158800             ASC-END-OF-SELECTED-RANGE)                           15880001
158900         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     15890001
159000             ASC-END-OF-SELECTED-RANGE)                           15900001
159100                                                                  15910001
159200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15920001
159300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15930001
159400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15940001
159500                                   TO TRUE                        15950001
159600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15960001
159700                                   TO TRUE                        15970001
159800                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS15980001
159900             END-IF                                               15990001
160000         END-IF                                                   16000001
160100     END-IF.                                                      16010001
160200                                                                  16020001
160300/                                                                 16030001
160400*----------------------------------------------------------------*16040001
160500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16050001
160600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16060001
160700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16070001
160800*    DISPLAY THE PANEL TO USER.                                  *16080001
160900*----------------------------------------------------------------*16090001
161000                                                                  16100001
161100 4000-BUILD-INITIAL-PANEL.                                        16110001
161200                                                                  16120001
161300     INITIALIZE ASC-BLOCK-ENTRIES (1)                             16130001
161400                ASC-BLOCK-ENTRIES (2).                            16140001
161500                                                                  16150001
161600     MOVE +1                       TO ASC-BLK-SUB.                16160001
161700                                                                  16170001
161800     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       16180001
161900                                                                  16190001
162000     MOVE +0                       TO ASC-ITEM-SUB                16200001
162100                                      ASC-NUMBER-OF-ITEMS-READ    16210001
162200                                      ASC-NUMBER-OF-SELECTED-ITEMS16220001
162300                                      ASC-HIGHEST-BLOCK-WRITTEN   16230001
162400                                      ASC-START-OF-SELECTED-RANGE 16240001
162500                                      ASC-END-OF-SELECTED-RANGE   16250001
162600                                      ASC-ITEM-AT-TOP-OF-PANEL.   16260001
162700                                                                  16270001
162800     PERFORM 4100-PREPARE-CURSOR.                                 16280001
162900                                                                  16290001
163000     PERFORM 4010-OPEN-CURSOR.                                    16300001
163100                                                                  16310001
163200     PERFORM 4300-READ-ITEMS-FROM-DB.                             16320001
163300                                                                  16330001
163400     PERFORM 4020-CLOSE-CURSOR.                                   16340001
163500                                                                  16350001
163600     MOVE +1                       TO PV-TOP-ITEM.                16360001
163700                                                                  16370001
163800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16380001
163900         SET DP020-NEXT-ACT-APPL-ERROR                            16390001
164000                                   TO TRUE                        16400001
164100         SET DP020-MSG-FATAL       TO TRUE                        16410001
164200         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            16420001
164300     ELSE                                                         16430001
164400         MOVE -1                   TO MR-SELECTL (1)              16440001
164500         SET DP030-SET-CURSOR-APPL-1                              16450001
164600                                   TO TRUE                        16460001
164700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16470001
164800     END-IF.                                                      16480001
164900                                                                  16490001
165000/                                                                 16500001
165100*----------------------------------------------------------------*16510001
165200* OPEN THE SHIPMENT CURSOR                                       *16520001
165300*----------------------------------------------------------------*16530001
165400                                                                  16540001
165500 4010-OPEN-CURSOR.                                                16550001
165600                                                                  16560001
165700     PERFORM                                                      16570001
165800         WITH TEST AFTER                                          16580001
165900         VARYING PV-RETRY-COUNTER                                 16590001
166000         FROM 1 BY 1                                              16600001
166100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16610001
166200            OR (SQLCODE = +0))                                    16620001
166300                                                                  16630001
166400         EXEC SQL                                                 16640001
166500             OPEN TTRDTRN_CSR                                     16650001
166600         END-EXEC                                                 16660001
166700                                                                  16670001
166800                                                                  16680001
166900         EVALUATE TRUE                                            16690001
167000             WHEN SQLCODE = +0                                    16700001
167100                  CONTINUE                                        16710001
167200             WHEN SQLCODE = -904                                  16720001
167300             WHEN SQLCODE = -913                                  16730001
167400                  CONTINUE                                        16740001
167500             WHEN SQLWARN0 NOT = SPACE                            16750001
167600             WHEN SQLCODE  NOT = +0                               16760001
167700                  MOVE '4010-OPEN-CURSOR'                         16770001
167800                                   TO DP013-PARAGRAPH             16780001
167900                  MOVE 'OPEN CURSOR'                              16790001
168000                                   TO DP013-MESSAGE-TEXT (1)      16800001
168100                  MOVE SQLCA       TO DP013-SQLCA                 16810001
168200                  MOVE 'TTRDTRN'   TO DP013-DB2-TABLE-NAME (1)    16820001
168300                  SET DP013-DB2-ABEND                             16830001
168400                                   TO TRUE                        16840001
168500                  PERFORM DP013-0000-PROCESS-ABEND                16850001
168600         END-EVALUATE                                             16860001
168700     END-PERFORM.                                                 16870001
168800                                                                  16880001
168900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16890001
169000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             16900001
169100         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              16910001
169200                                   TO DP013-MESSAGE-TEXT (1)      16920001
169300         MOVE SQLCA                TO DP013-SQLCA                 16930001
169400         SET DP013-DB2-ABEND       TO TRUE                        16940001
169500         PERFORM DP013-0000-PROCESS-ABEND                         16950001
169600     END-IF.                                                      16960001
169700                                                                  16970001
169800/                                                                 16980001
169900*----------------------------------------------------------------*16990001
170000* CLOSE THE SHIPMENT CURSOR                                      *17000001
170100*----------------------------------------------------------------*17010001
170200                                                                  17020001
170300 4020-CLOSE-CURSOR.                                               17030001
170400                                                                  17040001
170500     EXEC SQL                                                     17050001
170600         CLOSE TTRDTRN_CSR                                        17060001
170700     END-EXEC.                                                    17070001
170800                                                                  17080001
170900     EVALUATE TRUE                                                17090001
171000         WHEN SQLCODE = +0                                        17100001
171100              CONTINUE                                            17110001
171200         WHEN SQLWARN0 NOT = SPACE                                17120001
171300         WHEN SQLCODE  NOT = +0                                   17130001
171400              MOVE '4020-CLOSE-CURSOR'                            17140001
171500                                   TO DP013-PARAGRAPH             17150001
171600              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      17160001
171700              MOVE SQLCA           TO DP013-SQLCA                 17170001
171800              MOVE 'TTRDTRN'       TO DP013-DB2-TABLE-NAME (1)    17180001
171900              SET DP013-DB2-ABEND  TO TRUE                        17190001
172000              PERFORM DP013-0000-PROCESS-ABEND                    17200001
172100     END-EVALUATE.                                                17210001
172200                                                                  17220001
172300/                                                                 17230001
172400*----------------------------------------------------------------*17240001
172500*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *17250001
172600*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *17260001
172700*----------------------------------------------------------------*17270001
172800                                                                  17280001
172900 4100-PREPARE-CURSOR.                                             17290001
173000                                                                  17300001
173100     MOVE ASC-KEY-TP-DKEY      TO DK-TP-DKEY.                     17310001
173200                                                                  17320001
173300     IF   ASC-KEY-DIR-IND > SPACES                                17330001
173400         MOVE ASC-KEY-DIR-IND  TO DK-DIR-IND-LOW                  17340001
173500                                  DK-DIR-IND-HIGH                 17350001
173600     ELSE                                                         17360001
173700         MOVE LOW-VALUES       TO DK-DIR-IND-LOW                  17370001
173800         MOVE HIGH-VALUES      TO DK-DIR-IND-HIGH                 17380001
173900     END-IF.                                                      17390001
174000                                                                  17400001
174100*    *------------------------------------------------------------17410001
174200*    * IF COMING FROM A FUNCTIONAL GROUP SCREEN, LIST ONLY THE    17420001
174300*    * TRANSACTION SETS FOR THE FUNCTIONAL GROUP. IF COMING FROM  17430001
174400*    * A TRADING PARTNER SCREEN, LIST THE TRANSACTION SETS FOR ALL17440001
174500*    * FUNCTIONAL GROUPS.                                         17450001
174600*    *------------------------------------------------------------17460001
174700     IF ASC-INT-APPL-FORMAT-FG                                    17470001
174800         MOVE ASC-FUNC-CDE     TO DK-FUNC-CDE-LOW                 17480001
174900                                  DK-FUNC-CDE-HIGH                17490001
175000     ELSE                                                         17500001
175100         MOVE LOW-VALUES       TO DK-FUNC-CDE-LOW                 17510001
175200         MOVE HIGH-VALUES      TO DK-FUNC-CDE-HIGH                17520001
175300     END-IF.                                                      17530001
175400/                                                                 17540001
175500*----------------------------------------------------------------*17550001
175600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17560001
175700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17570001
175800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17580001
175900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17590001
176000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17600001
176100*                                                                *17610001
176200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17620001
176300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17630001
176400*    UPON INITIALIZATION.                                        *17640001
176500*----------------------------------------------------------------*17650001
176600                                                                  17660001
176700 4300-READ-ITEMS-FROM-DB.                                         17670001
176800                                                                  17680001
176900     PERFORM                                                      17690001
177000         VARYING PV-READ-COUNT                                    17700001
177100         FROM 1 BY 1                                              17710001
177200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17720001
177300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17730001
177400                                                                  17740001
177500         PERFORM 4315-FETCH                                       17750001
177600                                                                  17760001
177700         IF  ASC-ITEMS-LEFT-ON-DB                                 17770001
177800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17780001
177900                 ADD +1            TO ASC-ITEM-SUB                17790001
178000             ELSE                                                 17800001
178100                 ADD +1            TO ASC-BLK-SUB                 17810001
178200                 MOVE +1           TO ASC-ITEM-SUB                17820001
178300                                                                  17830001
178400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17840001
178500                     MOVE +1       TO ASC-BLK-SUB                 17850001
178600                     SET ASC-BLOCK-MODIFIED (1)                   17860001
178700                                   TO TRUE                        17870001
178800                     PERFORM 5100-WRITE-TEMP-STORAGE              17880001
178900                     MOVE ASC-BLOCK-ENTRIES                       17890001
179000                               (PC-MAX-BLOCKS-IN-ARRAY)           17900001
179100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 17910001
179200                     ADD +1        TO ASC-BLK-SUB                 17920001
179300                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17930001
179400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17940001
179500                                   TO TRUE                        17950001
179600                 END-IF                                           17960001
179700             END-IF                                               17970001
179800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17980001
179900             MOVE ASC-NUMBER-OF-ITEMS-READ                        17990001
180000                                   TO ASC-LIST-ITEM-NUMBER        18000001
180100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18010001
180200             MOVE TRDTRN-TRAN-SET-CDE      TO                     18020001
180300                  ASC-TRAN-SET-CDE    (ASC-BLK-SUB ASC-ITEM-SUB)  18030001
180400             MOVE TRDTRN-PROD-TEST-IND     TO                     18040001
180500                  ASC-PROD-TEST-IND   (ASC-BLK-SUB ASC-ITEM-SUB)  18050001
180600             MOVE TRDTRN-DIR-IND           TO                     18060001
180700                  ASC-DIR-IND         (ASC-BLK-SUB ASC-ITEM-SUB)  18070001
180800         END-IF                                                   18080001
180900     END-PERFORM.                                                 18090001
181000                                                                  18100001
181100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18110001
181200         MOVE +1                   TO ASC-BLK-SUB                 18120001
181300         PERFORM 5100-WRITE-TEMP-STORAGE                          18130001
181400         ADD +1                    TO ASC-BLK-SUB                 18140001
181500         PERFORM 5100-WRITE-TEMP-STORAGE                          18150001
181600                                                                  18160001
181700         MOVE 1                    TO ASC-BLK-SUB                 18170001
181800                                      PV-BLOCK-NUMBER             18180001
181900         PERFORM 4410-READ-TEMP-STORAGE                           18190001
182000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             18200001
182100             MOVE 2                TO ASC-BLK-SUB                 18210001
182200                                      PV-BLOCK-NUMBER             18220001
182300             PERFORM 4410-READ-TEMP-STORAGE                       18230001
182400         END-IF                                                   18240001
182500     END-IF.                                                      18250001
182600                                                                  18260001
182700/                                                                 18270001
182800*----------------------------------------------------------------*18280001
182900*    FETCH A TTRDTRN ROW                                         *18290001
183000*----------------------------------------------------------------*18300001
183100                                                                  18310001
183200 4315-FETCH.                                                      18320001
183300                                                                  18330001
183400     EXEC SQL                                                     18340001
183500         FETCH TTRDTRN_CSR                                        18350001
183600            INTO :TRDTRN-TRAN-SET-CDE                             18360001
183700                ,:TRDTRN-PROD-TEST-IND                            18370001
183800                ,:TRDTRN-DIR-IND                                  18380001
183900     END-EXEC.                                                    18390001
184000                                                                  18400001
184100     EVALUATE TRUE                                                18410001
184200         WHEN SQLCODE = +0                                        18420001
184300              CONTINUE                                            18430001
184400                                                                  18440001
184500         WHEN SQLCODE = +100                                      18450001
184600              SET ASC-NO-ITEMS-LEFT-ON-DB                         18460001
184700                                   TO TRUE                        18470001
184800                                                                  18480001
184900         WHEN SQLWARN0 NOT = SPACE                                18490001
185000         WHEN SQLCODE < +0                                        18500001
185100         WHEN SQLCODE > +0                                        18510001
185200              MOVE '4315-FETCH-CURSOR'                            18520001
185300                                   TO DP013-PARAGRAPH             18530001
185400              MOVE 'FETCH TTRDTRN CURSOR'                         18540001
185500                                   TO DP013-MESSAGE-TEXT (1)      18550001
185600              MOVE SQLCA           TO DP013-SQLCA                 18560001
185700              MOVE 'TTRDTRN'       TO DP013-DB2-TABLE-NAME (1)    18570001
185800              SET DP013-DB2-ABEND  TO TRUE                        18580001
185900              PERFORM DP013-0000-PROCESS-ABEND                    18590001
186000     END-EVALUATE.                                                18600001
186100                                                                  18610001
186200/                                                                 18620001
186300*----------------------------------------------------------------*18630001
186400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18640001
186500*----------------------------------------------------------------*18650001
186600                                                                  18660001
186700 4400-MOVE-COMMAREA-TO-SCREEN.                                    18670001
186800                                                                  18680001
186900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18690001
187000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18700001
187100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18710001
187200             MOVE +1               TO ASC-BLK-SUB                 18720001
187300             PERFORM 5100-WRITE-TEMP-STORAGE                      18730001
187400             ADD +1                TO ASC-BLK-SUB                 18740001
187500             PERFORM 5100-WRITE-TEMP-STORAGE                      18750001
187600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18760001
187700                 GIVING PV-BLOCK-NUMBER                           18770001
187800                 REMAINDER PV-REMAINDER                           18780001
187900             IF  PV-REMAINDER > ZERO                              18790001
188000                 ADD +1            TO PV-BLOCK-NUMBER             18800001
188100             END-IF                                               18810001
188200             MOVE +1               TO ASC-BLK-SUB                 18820001
188300             PERFORM 4410-READ-TEMP-STORAGE                       18830001
188400             ADD +1                TO ASC-BLK-SUB                 18840001
188500                                      PV-BLOCK-NUMBER             18850001
188600             PERFORM 4410-READ-TEMP-STORAGE                       18860001
188700     END-IF.                                                      18870001
188800                                                                  18880001
188900     MOVE +1                       TO ASC-BLK-SUB.                18890001
189000                                                                  18900001
189100     COMPUTE ASC-ITEM-SUB =                                       18910001
189200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18920001
189300         + PC-ITEMS-PER-PANEL).                                   18930001
189400                                                                  18940001
189500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18950001
189600         ADD +1                    TO ASC-BLK-SUB                 18960001
189700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18970001
189800     END-IF.                                                      18980001
189900                                                                  18990001
190000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19000001
190100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19010001
190200                                                                  19020001
190300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19030001
190400     PERFORM 4420-FORMAT-LIST-LINES                               19040001
190500         VARYING PV-SUB                                           19050001
190600         FROM PC-ITEMS-PER-PANEL BY -1                            19060001
190700         UNTIL PV-SUB < +1.                                       19070001
190800                                                                  19080001
190900     COMPUTE ASC-ITEMS-DISPLAYED =                                19090001
191000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19100001
191100                                                                  19110001
191200     IF PS-NO-START-ITEM-ERROR                                    19120001
191300         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL19130001
191400                                          ASTRTITO                19140001
191500         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  19150001
191600     ELSE                                                         19160001
191700         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                19170001
191800     END-IF.                                                      19180001
191900                                                                  19190001
192000                                                                  19200001
192100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19210001
192200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19220001
192300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19230001
192400                                   TO ASELITO.                    19240001
192500                                                                  19250001
192600     IF  DP020-MSG-NUMBER-X = SPACE                               19260001
192700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19270001
192800*            --- MORE ITEMS TO DISPLAY ----                       19280001
192900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19290001
193000             SET DP020-MSG-INFORMATIONAL                          19300001
193100                                   TO TRUE                        19310001
193200         END-IF                                                   19320001
193300     END-IF.                                                      19330001
193400                                                                  19340001
193500*----------------------------------------------------------------*19350001
193600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19360001
193700*----------------------------------------------------------------*19370001
193800                                                                  19380001
193900 4410-READ-TEMP-STORAGE.                                          19390001
194000                                                                  19400001
194100     EXEC CICS                                                    19410001
194200         READQ TS                                                 19420001
194300             QUEUE (ASC-LIST-QUEUE-NAME)                          19430001
194400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19440001
194500             ITEM  (PV-BLOCK-NUMBER)                              19450001
194600             RESP  (PV-CICS-RESP)                                 19460001
194700     END-EXEC.                                                    19470001
194800                                                                  19480001
194900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19490001
195000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19500001
195100         CONTINUE                                                 19510001
195200     ELSE                                                         19520001
195300         SET DP013-CICS-ABEND      TO TRUE                        19530001
195400         SET DP013-NO-ROLLBACK     TO TRUE                        19540001
195500         MOVE '4410-READ-TEMP-STORAGE'                            19550001
195600                                   TO DP013-PARAGRAPH             19560001
195700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19570001
195800                                   TO DP013-MESSAGE-TEXT(1)       19580001
195900         PERFORM DP013-0000-PROCESS-ABEND                         19590001
196000     END-IF.                                                      19600001
196100                                                                  19610001
196200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      19620001
196300                                   TO TRUE.                       19630001
196400                                                                  19640001
196500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19650001
196600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19660001
196700     END-IF.                                                      19670001
196800                                                                  19680001
196900/                                                                 19690001
197000*----------------------------------------------------------------*19700001
197100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19710001
197200*----------------------------------------------------------------*19720001
197300                                                                  19730001
197400 4420-FORMAT-LIST-LINES.                                          19740001
197500                                                                  19750001
197600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19760001
197700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19770001
197800         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19780001
197900         MOVE SPACES             TO MR-SELECT  (PV-SUB)           19790001
198000                                    MR-ACTION  (PV-SUB)           19800001
198100                                    MR-VENDOR-NAME(PV-SUB)        19810001
198200                                    MR-VEND-INCHG-QUAL(PV-SUB)    19820001
198300                                    MR-VEND-INCHG-ID(PV-SUB)      19830001
198400                                    MR-NETWK-NAME(PV-SUB)         19840001
198500                                    MR-TRAN-SET-CDE(PV-SUB)       19850001
198600                                    MR-PROD-TEST-IND(PV-SUB)      19860001
198700                                    MR-DIR-IND (PV-SUB)           19870001
198800     ELSE                                                         19880001
198900         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19890001
199000                                                   > SPACE        19900001
199100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19910001
199200                                   TO MR-SELECT (PV-SUB)          19920001
199300         ELSE                                                     19930001
199400             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19940001
199500                                   TO MR-SELECT (PV-SUB)          19950001
199600         END-IF                                                   19960001
199700                                                                  19970001
199800         IF  DP030-SET-CURSOR-TRAILER                             19980001
199900             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19990001
200000                 > SPACE)                                         20000001
200100               OR (PV-SUB = 1))                                   20010001
200200                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20020001
200300                MOVE -1            TO MR-SELECTL (PV-SUB)         20030001
200400             END-IF                                               20040001
200500         END-IF                                                   20050001
200600                                                                  20060001
200700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20070001
200800             MOVE ASC-ACTION          (ASC-BLK-SUB ASC-ITEM-SUB)  20080001
200900               TO MR-ACTION           (PV-SUB)                    20090001
201000             MOVE ASC-VENDOR-NAME                                 20100001
201100               TO MR-VENDOR-NAME      (PV-SUB)                    20110001
201200             MOVE ASC-VEND-INCHG-QUAL                             20120001
201300               TO MR-VEND-INCHG-QUAL  (PV-SUB)                    20130001
201400             MOVE ASC-VEND-INCHG-ID                               20140001
201500               TO MR-VEND-INCHG-ID    (PV-SUB)                    20150001
201600             MOVE ASC-NETWK-NAME                                  20160001
201700               TO MR-NETWK-NAME       (PV-SUB)                    20170001
201800             MOVE ASC-TRAN-SET-CDE    (ASC-BLK-SUB ASC-ITEM-SUB)  20180001
201900               TO MR-TRAN-SET-CDE     (PV-SUB)                    20190001
202000             MOVE ASC-PROD-TEST-IND   (ASC-BLK-SUB ASC-ITEM-SUB)  20200001
202100               TO MR-PROD-TEST-IND    (PV-SUB)                    20210001
202200             MOVE ASC-DIR-IND         (ASC-BLK-SUB ASC-ITEM-SUB)  20220001
202300               TO MR-DIR-IND          (PV-SUB)                    20230001
202400         END-IF                                                   20240001
202500     END-IF.                                                      20250001
202600                                                                  20260001
202700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               20270001
202800                                                                  20280001
202900     IF  ASC-ITEM-SUB < + 1                                       20290001
203000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                20300001
203100         MOVE +1                   TO ASC-BLK-SUB                 20310001
203200     END-IF.                                                      20320001
203300                                                                  20330001
203400*----------------------------------------------------------------*20340001
203500*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *20350001
203600*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *20360001
203700*  ISSUE A WARNING.                                              *20370001
203800*----------------------------------------------------------------*20380001
203900 4430-CHECK-FOR-BEGIN-AND-END.                                    20390001
204000                                                                  20400001
204100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20410001
204200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20420001
204300*            -- NO END-OF-RANGE SPECFIED ---                      20430001
204400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            20440001
204500             SET DP020-MSG-WARNING TO TRUE                        20450001
204600             PERFORM 4431-POSITION-AT-WARNING                     20460001
204700         END-IF                                                   20470001
204800     ELSE                                                         20480001
204900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     20490001
205000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                20500001
205100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            20510001
205200             SET DP020-MSG-WARNING TO TRUE                        20520001
205300             PERFORM 4431-POSITION-AT-WARNING                     20530001
205400         END-IF                                                   20540001
205500     END-IF.                                                      20550001
205600                                                                  20560001
205700*----------------------------------------------------------------*20570001
205800*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *20580001
205900*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *20590001
206000*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *20600001
206100*  POSITION THE CURSOR THERE.                                    *20610001
206200*----------------------------------------------------------------*20620001
206300 4431-POSITION-AT-WARNING.                                        20630001
206400                                                                  20640001
206500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20650001
206600                    - PV-TOP-ITEM + 1.                            20660001
206700                                                                  20670001
206800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20680001
206900         CONTINUE                                                 20690001
207000     ELSE                                                         20700001
207100         SET DP030-SET-CURSOR-APPL-1                              20710001
207200                                   TO TRUE                        20720001
207300         MOVE -1                   TO MR-SELECTL (PV-SUB)         20730001
207400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20740001
207500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20750001
207600     END-IF.                                                      20760001
207700                                                                  20770001
207800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20780001
207900                    - PV-TOP-ITEM + 1.                            20790001
208000                                                                  20800001
208100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20810001
208200         CONTINUE                                                 20820001
208300     ELSE                                                         20830001
208400         SET DP030-SET-CURSOR-APPL-1                              20840001
208500                                   TO TRUE                        20850001
208600         MOVE -1                   TO MR-SELECTL (PV-SUB)         20860001
208700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20870001
208800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20880001
208900     END-IF.                                                      20890001
209000                                                                  20900001
209100/                                                                 20910001
209200*----------------------------------------------------------------*20920001
209300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20930001
209400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20940001
209500* FOR THE SELECTED ITEMS QUEUE.                                  *20950001
209600*                                                                *20960001
209700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20970001
209800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20980001
209900* THE ARRAY IS FULL.                                             *20990001
210000*----------------------------------------------------------------*21000001
210100                                                                  21010001
210200 5000-PREPARE-SEL-QUEUE.                                          21020001
210300                                                                  21030001
210400     MOVE +1                       TO ASC-BLK-SUB.                21040001
210500     PERFORM 5100-WRITE-TEMP-STORAGE.                             21050001
210600     ADD +1                        TO ASC-BLK-SUB.                21060001
210700     PERFORM 5100-WRITE-TEMP-STORAGE.                             21070001
210800                                                                  21080001
210900     MOVE ASC-SEL-QUEUE-NAME-OUT   TO ET300-SEL-QUEUE-NAME.       21090001
211000     PERFORM 6010-DELETE-SEL-QUEUE.                               21100001
211100                                                                  21110001
211200     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      21120001
211300         SET ASC-UPDATE-TSQ        TO TRUE                        21130001
211400     END-IF.                                                      21140001
211500                                                                  21150001
211600     SET ET301-IDX                 TO 1.                          21160001
211700     MOVE ZERO                     TO ET300-NUMBER-OF-TS-ITEMS.   21170001
211800     INITIALIZE ET301-SELECTED-ITEM-ARRAY.                        21180001
211900                                                                  21190001
212000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21200001
212100             VARYING PV-ITEM                                      21210001
212200             FROM 1 BY 1                                          21220001
212300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     21230001
212400                                                                  21240001
212500     IF  ET301-IDX > 1                                            21250001
212600         PERFORM 5205-WRITE-SEL-QUEUE                             21260001
212700         ADD +1                    TO ET300-NUMBER-OF-TS-ITEMS    21270001
212800     END-IF.                                                      21280001
212900                                                                  21290001
213000/                                                                 21300001
213100*----------------------------------------------------------------*21310001
213200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *21320001
213300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *21330001
213400*----------------------------------------------------------------*21340001
213500                                                                  21350001
213600 5100-WRITE-TEMP-STORAGE.                                         21360001
213700                                                                  21370001
213800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     21380001
213900                                   TO PV-LIST-ITEM-NUMBER.        21390001
214000     COMPUTE PV-BLOCK-NUMBER =                                    21400001
214100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21410001
214200                                                                  21420001
214300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             21430001
214400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             21440001
214500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      21450001
214600             PERFORM 5105-REWRITE-ASC-LISTQ                       21460001
214700         END-IF                                                   21470001
214800     ELSE                                                         21480001
214900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       21490001
215000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            21500001
215100         PERFORM 5110-WRITE-ASC-LISTQ                             21510001
215200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   21520001
215300     END-IF.                                                      21530001
215400                                                                  21540001
215500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      21550001
215600                                   TO TRUE.                       21560001
215700                                                                  21570001
215800/                                                                 21580001
215900*----------------------------------------------------------------*21590001
216000*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *21600001
216100*  SPECIFIC COMMAREA.                                            *21610001
216200*----------------------------------------------------------------*21620001
216300 5105-REWRITE-ASC-LISTQ.                                          21630001
216400                                                                  21640001
216500     EXEC CICS                                                    21650001
216600         WRITEQ TS                                                21660001
216700             QUEUE (ASC-LIST-QUEUE-NAME)                          21670001
216800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21680001
216900             ITEM  (PV-BLOCK-NUMBER)                              21690001
217000             REWRITE                                              21700001
217100             RESP  (PV-CICS-RESP)                                 21710001
217200     END-EXEC.                                                    21720001
217300                                                                  21730001
217400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           21740001
217500         CONTINUE                                                 21750001
217600     ELSE                                                         21760001
217700         SET DP013-CICS-ABEND      TO TRUE                        21770001
217800         SET DP013-NO-ROLLBACK     TO TRUE                        21780001
217900         MOVE '5105-REWRITE-ASC-LISTQ'                            21790001
218000                                   TO DP013-PARAGRAPH             21800001
218100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     21810001
218200                                   TO DP013-MESSAGE-TEXT(1)       21820001
218300         PERFORM DP013-0000-PROCESS-ABEND                         21830001
218400     END-IF.                                                      21840001
218500                                                                  21850001
218600/                                                                 21860001
218700*----------------------------------------------------------------*21870001
218800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *21880001
218900*  SPECIFIC COMMAREA.                                            *21890001
219000*----------------------------------------------------------------*21900001
219100 5110-WRITE-ASC-LISTQ.                                            21910001
219200                                                                  21920001
219300     EXEC CICS                                                    21930001
219400         WRITEQ TS                                                21940001
219500             QUEUE (ASC-LIST-QUEUE-NAME)                          21950001
219600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21960001
219700             ITEM  (PV-BLOCK-NUMBER)                              21970001
219800             RESP  (PV-CICS-RESP)                                 21980001
219900     END-EXEC.                                                    21990001
220000                                                                  22000001
220100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22010001
220200         SET DP013-CICS-ABEND      TO TRUE                        22020001
220300         SET DP013-NO-ROLLBACK     TO TRUE                        22030001
220400         MOVE '5110-WRITE-ASC-LISTQ'                              22040001
220500                                   TO DP013-PARAGRAPH             22050001
220600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22060001
220700                                   TO DP013-MESSAGE-TEXT(1)       22070001
220800         PERFORM DP013-0000-PROCESS-ABEND                         22080001
220900     END-IF.                                                      22090001
221000                                                                  22100001
221100/                                                                 22110001
221200*----------------------------------------------------------------*22120001
221300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22130001
221400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22140001
221500*----------------------------------------------------------------*22150001
221600                                                                  22160001
221700 5200-FILL-SEL-QUEUE-RECORD.                                      22170001
221800                                                                  22180001
221900     PERFORM 6112-READ-LIST-QUEUE.                                22190001
222000                                                                  22200001
222100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22210001
222200         PERFORM                                                  22220001
222300         VARYING LQW-IDX                                          22230001
222400         FROM 1 BY 1                                              22240001
222500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            22250001
222600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          22260001
222700                                                                  22270001
222800*-->         *** DON'T ALLOW DELETED ITEMS TO BE SENT TO THE  *** 22280001
222900*-->         *** DETAIL SCREEN                                *** 22290001
223000             IF  LQW-SELECT (LQW-IDX) AND                         22300001
223100                (LQW-ACTION (LQW-IDX) = PC-DEL OR PC-ERR)         22310001
223200                 SET LQW-DESELECT (LQW-IDX) TO TRUE               22320001
223300             END-IF                                               22330001
223400             IF  LQW-SELECT (LQW-IDX)                             22340001
223500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              22350001
223600                                      TO ET301-ITEM    (ET301-IDX)22360001
223700                 MOVE SPACE           TO ET301-ACTION-SW          22370001
223800                                                       (ET301-IDX)22380001
223900                 MOVE ASC-KEY-TP-DKEY TO ET301-TP-DKEY (ET301-IDX)22390001
224000                 MOVE ASC-ENT-ID      TO ET301-ENT-ID  (ET301-IDX)22400001
224100                 MOVE ASC-VENDOR-NAME TO ET301-VENDOR-NAME        22410001
224200                                                       (ET301-IDX)22420001
224300                 MOVE ASC-VEND-INCHG-QUAL                         22430001
224400                                      TO ET301-VEND-INCHG-QUAL    22440001
224500                                                       (ET301-IDX)22450001
224600                 MOVE ASC-VEND-INCHG-ID                           22460001
224700                                      TO ET301-VEND-INCHG-ID      22470001
224800                                                       (ET301-IDX)22480001
224900                 MOVE ASC-NETWK-ID    TO ET301-NETWK-ID(ET301-IDX)22490001
225000                 MOVE ASC-NETWK-NAME  TO ET301-NETWK-NAME         22500001
225100                                                       (ET301-IDX)22510001
225200                 MOVE ASC-FUNC-CDE    TO ET301-FUNC-CDE(ET301-IDX)22520001
225300                 MOVE LQW-TRAN-SET-CDE(LQW-IDX)                   22530001
225400                                      TO ET301-TRAN-SET-CDE       22540001
225500                                                       (ET301-IDX)22550001
225600                 MOVE LQW-PROD-TEST-IND(LQW-IDX)                  22560001
225700                                      TO ET301-PROD-TEST-IND      22570001
225800                                                       (ET301-IDX)22580001
225900                 MOVE LQW-DIR-IND  (LQW-IDX)                      22590001
226000                                      TO ET301-DIR-IND (ET301-IDX)22600001
226100                 SET ET301-IDX UP BY 1                            22610001
226200                 IF  ET301-IDX > ET301-MAX-ITEMS                  22620001
226300                     PERFORM 5205-WRITE-SEL-QUEUE                 22630001
226400                     ADD +1        TO ET300-NUMBER-OF-TS-ITEMS    22640001
226500                     INITIALIZE ET301-SELECTED-ITEM-ARRAY         22650001
226600                     SET ET301-IDX TO 1                           22660001
226700                 END-IF                                           22670001
226800             END-IF                                               22680001
226900         END-PERFORM                                              22690001
227000     END-IF.                                                      22700001
227100                                                                  22710001
227200/                                                                 22720001
227300*----------------------------------------------------------------*22730001
227400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *22740001
227500*----------------------------------------------------------------*22750001
227600                                                                  22760001
227700 5205-WRITE-SEL-QUEUE.                                            22770001
227800                                                                  22780001
227900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22790001
228000                                   TO ET301-SELECTED-ITEMS.       22800001
228100                                                                  22810001
228200     EXEC CICS                                                    22820001
228300          WRITEQ TS                                               22830001
228400              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      22840001
228500              FROM  (ET301-SELECTED-VNDRS)                        22850001
228600              ITEM  (PV-SEL-QUEUE-ITEM)                           22860001
228700              RESP  (PV-CICS-RESP)                                22870001
228800     END-EXEC.                                                    22880001
228900                                                                  22890001
229000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22900001
229100         CONTINUE                                                 22910001
229200     ELSE                                                         22920001
229300         SET DP013-CICS-ABEND      TO TRUE                        22930001
229400         SET DP013-NO-ROLLBACK     TO TRUE                        22940001
229500         MOVE '5205-WRITE-SEL-QUEUE'                              22950001
229600                                   TO DP013-PARAGRAPH             22960001
229700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          22970001
229800                                   TO DP013-MESSAGE-TEXT(1)       22980001
229900         PERFORM DP013-0000-PROCESS-ABEND                         22990001
230000     END-IF.                                                      23000001
230100                                                                  23010001
230200/                                                                 23020001
230300*----------------------------------------------------------------*23030001
230400*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *23040001
230500*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *23050001
230600*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *23060001
230700*  THE USER.                                                     *23070001
230800*----------------------------------------------------------------*23080001
230900 6000-REFRESH-PANEL-FROM-TEMP.                                    23090001
231000                                                                  23100001
231100     IF  ASC-UPDATE-TSQ                                           23110001
231200         SET ASC-NO-TSQ-UPDATE     TO TRUE                        23120001
231300         MOVE ZERO                 TO PV-SAVE-ITEM                23130001
231400                                      PV-SEL-QUEUE-ITEM           23140001
231500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23150001
231600                                   TO PV-HOLD-SELECTED-ITEMS      23160001
231700         PERFORM 6100-UPDATE-TSQ                                  23170001
231800             UNTIL PV-ITEMS-PROCESSED >                           23180001
231900                                     ASC-NUMBER-OF-SELECTED-ITEMS 23190001
232000         PERFORM 6010-DELETE-SEL-QUEUE                            23200001
232100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23210001
232200                    ASC-BLOCK-ENTRIES (2)                         23220001
232300     END-IF.                                                      23230001
232400                                                                  23240001
232500/                                                                 23250001
232600*----------------------------------------------------------------*23260001
232700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23270001
232800*----------------------------------------------------------------*23280001
232900 6010-DELETE-SEL-QUEUE.                                           23290001
233000                                                                  23300001
233100     EXEC CICS                                                    23310001
233200         DELETEQ TS                                               23320001
233300             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       23330001
233400             RESP  (PV-CICS-RESP)                                 23340001
233500     END-EXEC.                                                    23350001
233600                                                                  23360001
233700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23370001
233800         (PV-CICS-RESP = DFHRESP(QIDERR)))                        23380001
233900         CONTINUE                                                 23390001
234000     ELSE                                                         23400001
234100         SET DP013-CICS-ABEND      TO TRUE                        23410001
234200         SET DP013-NO-ROLLBACK     TO TRUE                        23420001
234300         MOVE '6010-DELETE-SEL-QUEUE'                             23430001
234400                                   TO DP013-PARAGRAPH             23440001
234500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         23450001
234600                                   TO DP013-MESSAGE-TEXT (1)      23460001
234700         PERFORM DP013-0000-PROCESS-ABEND                         23470001
234800     END-IF.                                                      23480001
234900                                                                  23490001
235000/                                                                 23500001
235100*----------------------------------------------------------------*23510001
235200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *23520001
235300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *23530001
235400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *23540001
235500*    THE TEMP QUEUE.                                             *23550001
235600*----------------------------------------------------------------*23560001
235700                                                                  23570001
235800 6100-UPDATE-TSQ.                                                 23580001
235900                                                                  23590001
236000     ADD 1                         TO PV-SEL-QUEUE-ITEM.          23600001
236100     PERFORM 6105-READ-SEL-QUEUE.                                 23610001
236200                                                                  23620001
236300     PERFORM                                                      23630001
236400         VARYING ET301-IDX                                        23640001
236500         FROM 1 BY 1                                              23650001
236600         UNTIL ((PV-ITEMS-PROCESSED >                             23660001
236700                              PV-HOLD-SELECTED-ITEMS)             23670001
236800         OR (ET301-IDX GREATER THAN ET301-MAX-ITEMS))             23680001
236900         IF  ET301-ACTION-SW (ET301-IDX) > SPACE                  23690001
237000             PERFORM 6110-PROCESS-ITEMS                           23700001
237100         END-IF                                                   23710001
237200         ADD +1                    TO PV-ITEMS-PROCESSED          23720001
237300     END-PERFORM.                                                 23730001
237400                                                                  23740001
237500     PERFORM 6111-WRITE-LIST-QUEUE.                               23750001
237600                                                                  23760001
237700/                                                                 23770001
237800*----------------------------------------------------------------*23780001
237900*    READ THE LIST QUEUE RECORD.                                 *23790001
238000*----------------------------------------------------------------*23800001
238100                                                                  23810001
238200 6105-READ-SEL-QUEUE.                                             23820001
238300                                                                  23830001
238400     EXEC CICS                                                    23840001
238500          READQ TS                                                23850001
238600              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      23860001
238700              INTO  (ET301-SELECTED-VNDRS)                        23870001
238800              ITEM  (PV-SEL-QUEUE-ITEM)                           23880001
238900              RESP  (PV-CICS-RESP)                                23890001
239000     END-EXEC.                                                    23900001
239100                                                                  23910001
239200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23920001
239300         CONTINUE                                                 23930001
239400     ELSE                                                         23940001
239500         SET DP013-CICS-ABEND      TO TRUE                        23950001
239600         SET DP013-NO-ROLLBACK     TO TRUE                        23960001
239700         MOVE '6105-READ-SEL-QUEUE'                               23970001
239800                                   TO DP013-PARAGRAPH             23980001
239900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           23990001
240000                                   TO DP013-MESSAGE-TEXT(1)       24000001
240100         PERFORM DP013-0000-PROCESS-ABEND                         24010001
240200     END-IF.                                                      24020001
240300                                                                  24030001
240400/                                                                 24040001
240500*----------------------------------------------------------------*24050001
240600*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24060001
240700*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24070001
240800*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24080001
240900*----------------------------------------------------------------*24090001
241000                                                                  24100001
241100 6110-PROCESS-ITEMS.                                              24110001
241200                                                                  24120001
241300     COMPUTE PV-ITEM = 1 + ((ET301-ITEM (ET301-IDX) - 1)          24130001
241400                     / PC-ITEMS-PER-PANEL).                       24140001
241500                                                                  24150001
241600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24160001
241700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24170001
241800             PERFORM 6111-WRITE-LIST-QUEUE                        24180001
241900         END-IF                                                   24190001
242000         MOVE PV-ITEM              TO PV-SAVE-ITEM                24200001
242100                                                                  24210001
242200         PERFORM 6112-READ-LIST-QUEUE                             24220001
242300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24230001
242400             CONTINUE                                             24240001
242500         END-IF                                                   24250001
242600     END-IF.                                                      24260001
242700                                                                  24270001
242800     COMPUTE PV-SUB = (ET301-ITEM (ET301-IDX)                     24280001
242900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24290001
243000                                                                  24300001
243100     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       24310001
243200     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        24320001
243300                                     (PV-SUB).                    24330001
243400                                                                  24340001
243500     EVALUATE TRUE                                                24350001
243600         WHEN ET301-INQ (ET301-IDX)                               24360001
243700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24370001
243800                                                                  24380001
243900         WHEN ET301-UPD (ET301-IDX)                               24390001
244000              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             24400001
244100                                                                  24410001
244200         WHEN ET301-DEL (ET301-IDX)                               24420001
244300              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             24430001
244400                                                                  24440001
244500         WHEN ET301-ERR (ET301-IDX)                               24450001
244600              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             24460001
244700     END-EVALUATE.                                                24470001
244800                                                                  24480001
244900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                24490001
245000                                                                  24500001
245100/                                                                 24510001
245200*----------------------------------------------------------------*24520001
245300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *24530001
245400*----------------------------------------------------------------*24540001
245500                                                                  24550001
245600 6111-WRITE-LIST-QUEUE.                                           24560001
245700                                                                  24570001
245800     EXEC CICS                                                    24580001
245900         WRITEQ TS                                                24590001
246000             QUEUE (ASC-LIST-QUEUE-NAME)                          24600001
246100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     24610001
246200             ITEM  (PV-SAVE-ITEM)                                 24620001
246300             REWRITE                                              24630001
246400             RESP  (PV-CICS-RESP)                                 24640001
246500     END-EXEC.                                                    24650001
246600                                                                  24660001
246700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24670001
246800         CONTINUE                                                 24680001
246900     ELSE                                                         24690001
247000         SET DP013-CICS-ABEND      TO TRUE                        24700001
247100         SET DP013-NO-ROLLBACK     TO TRUE                        24710001
247200         MOVE '6111-WRITE-LIST-QUEUE'                             24720001
247300                                   TO DP013-PARAGRAPH             24730001
247400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  24740001
247500                                   TO DP013-MESSAGE-TEXT(1)       24750001
247600         PERFORM DP013-0000-PROCESS-ABEND                         24760001
247700     END-IF.                                                      24770001
247800                                                                  24780001
247900/                                                                 24790001
248000*----------------------------------------------------------------*24800001
248100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24810001
248200*----------------------------------------------------------------*24820001
248300                                                                  24830001
248400 6112-READ-LIST-QUEUE.                                            24840001
248500                                                                  24850001
248600     EXEC CICS                                                    24860001
248700         READQ TS                                                 24870001
248800             QUEUE (ASC-LIST-QUEUE-NAME)                          24880001
248900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24890001
249000             ITEM  (PV-ITEM)                                      24900001
249100             RESP  (PV-CICS-RESP)                                 24910001
249200     END-EXEC.                                                    24920001
249300                                                                  24930001
249400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24940001
249500         CONTINUE                                                 24950001
249600     ELSE                                                         24960001
249700         SET DP013-CICS-ABEND      TO TRUE                        24970001
249800         SET DP013-NO-ROLLBACK     TO TRUE                        24980001
249900         MOVE '6112-READ-LIST-QUEUE'                              24990001
250000                                   TO DP013-PARAGRAPH             25000001
250100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25010001
250200                                   TO DP013-MESSAGE-TEXT(1)       25020001
250300         PERFORM DP013-0000-PROCESS-ABEND                         25030001
250400     END-IF.                                                      25040001
250500                                                                  25050001
250600/                                                                 25060001
250700******************************************************************25070001
250800* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *25080001
250900******************************************************************25090001
251000 6200-DEL-LIST-QUEUE.                                             25100001
251100                                                                  25110001
251200     EXEC CICS                                                    25120001
251300         DELETEQ TS                                               25130001
251400             QUEUE (ASC-LIST-QUEUE-NAME)                          25140001
251500             RESP  (PV-CICS-RESP)                                 25150001
251600     END-EXEC.                                                    25160001
251700                                                                  25170001
251800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25180001
251900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25190001
252000         CONTINUE                                                 25200001
252100     ELSE                                                         25210001
252200        SET DP013-CICS-ABEND       TO TRUE                        25220001
252300        SET DP013-NO-ROLLBACK      TO TRUE                        25230001
252400        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             25240001
252500        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               25250001
252600                                   TO DP013-MESSAGE-TEXT (1)      25260001
252700        PERFORM DP013-0000-PROCESS-ABEND                          25270001
252800     END-IF.                                                      25280001
252900                                                                  25290001
253000/                                                                 25300001
253100 7000-FORMAT-COMMAREA.                                            25310001
253200                                                                  25320001
253300     IF ASC-BLOCK-MODIFIED-SW(1) = 'Y'                            25330001
253400        MOVE 1                   TO PV-BLOCK-NUMBER               25340001
253500     ELSE                                                         25350001
253600        MOVE 2                   TO PV-BLOCK-NUMBER               25360001
253700     END-IF.                                                      25370001
253800                                                                  25380001
253900     MOVE ASC-KEY-TP-DKEY     TO ET300-TP-DKEY                    25390001
254000     MOVE ASC-ENT-ID          TO ET300-ENT-ID                     25400001
254100     MOVE ASC-VENDOR-NAME     TO ET300-VENDOR-NAME                25410001
254200     MOVE ASC-VEND-INCHG-ID   TO ET300-VEND-INCHG-ID              25420001
254300     MOVE ASC-VEND-INCHG-QUAL TO ET300-VEND-INCHG-QUAL            25430001
254400     MOVE ASC-NETWK-ID        TO ET300-NETWK-ID                   25440001
254500     MOVE ASC-NETWK-NAME      TO ET300-NETWORK-NAME.              25450001
254600                                                                  25460001
254700/                                                                 25470001
254800******************************************************************25480001
254900* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *25490001
255000******************************************************************25500001
255100 9100-READ-SEL-QUEUE.                                             25510001
255200     EXEC CICS                                                    25520001
255300         READQ TS                                                 25530001
255400             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        25540001
255500             INTO  (ET301-SELECTED-VNDRS)                         25550001
255600             ITEM  (ASC-SEL-ITEM)                                 25560001
255700             RESP  (PV-CICS-RESP)                                 25570001
255800     END-EXEC.                                                    25580001
255900                                                                  25590001
256000     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        25600001
256100         CONTINUE                                                 25610001
256200     ELSE                                                         25620001
256300         SET DP013-LOGIC-ABEND                                    25630001
256400             DP013-NO-ROLLBACK     TO TRUE                        25640001
256500         MOVE '9100-READ-SEL-QUEUE'                               25650001
256600                                   TO DP013-PARAGRAPH             25660001
256700         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    25670001
256800                                   TO DP013-MESSAGE-TEXT (1)      25680001
256900         PERFORM DP013-0000-PROCESS-ABEND                         25690001
257000     END-IF.                                                      25700001
257100                                                                  25710001
257200/                                                                 25720001
257300******************************************************************25730001
257400* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *25740001
257500******************************************************************25750001
257600 9200-REWRITE-LIST-QUEUE.                                         25760001
257700     EXEC CICS                                                    25770001
257800          WRITEQ TS                                               25780001
257900              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     25790001
258000              FROM    (ET301-SELECTED-VNDRS)                      25800001
258100              ITEM    (ASC-SEL-ITEM)                              25810001
258200              RESP    (PV-CICS-RESP)                              25820001
258300              REWRITE                                             25830001
258400     END-EXEC.                                                    25840001
258500                                                                  25850001
258600     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    25860001
258700         SET DP013-CICS-ABEND                                     25870001
258800             DP013-NO-ROLLBACK     TO TRUE                        25880001
258900         MOVE '9200-REWRITE-LIST-QUEUE'                           25890001
259000                                   TO DP013-PARAGRAPH             25900001
259100         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   25910001
259200                                   TO DP013-MESSAGE-TEXT (1)      25920001
259300         PERFORM DP013-0000-PROCESS-ABEND                         25930001
259400     END-IF.                                                      25940001
259500                                                                  25950001
259600/                                                                 25960001
259700*----------------------------------------------------------------*25970001
259800*    ABEND PROCESSOR MODULE                                      *25980001
259900*----------------------------------------------------------------*25990001
260000                                                                  26000001
260100     COPY DPPD013.                                                26010001
