000100 IDENTIFICATION DIVISION.                                         00010002
000200*=======================*                                         00020002
000300 PROGRAM-ID.              MLKUP060.                               00030002
000400 AUTHOR.                  COGNIZANT.                              00040002
000500 INSTALLATION.            KOHLS DEPARTMENT STORES.                00050002
000600 DATE-WRITTEN.            09/13/2010.                             00060002
000700 DATE-COMPILED.                                                   00070002
000800                                                                  00080002
000900******************************************************************00090002
001000* Remarks                                                        *00100002
001100* -------                                                        *00110002
001200*                                                                *00120002
001300* Title        - Brand Vendor Delete program                     *00130002
001400*                                                                *00140002
001500* Description  - This program delete the records from Brand      *00150002
001600* Vendor Audit tables that are more than an year old.            *00160002
001700*                                                                *00170002
001800* The following are the tables from which the entries will be    *00180002
001900* deleted.                                                       *00190002
002000*                                                                *00200002
002100*     - MLT_INV_ADJ_TRN_DTL                                      *00210002
002200*     - MLT_PRCHG_TRN_DTL                                        *00220002
002300*     - MLT_PADJ_TRN_DTL                                         *00230002
002400*     - MLT_SLS_TRN_DTL                                          *00240002
002500*                                                                *00250002
002600*  Change history                                                *00260002
002700*                                                                *00270002
002800******************************************************************00280002
002900* WR Number   Programmer       Date                              *00290002
003000* ---------------------------------------------------------------*00300002
003100* wr37965     COGNIZANT        13-Sep-2010                       *00310003
003200* Original Version                                               *00320002
003300******************************************************************00330002
003400                                                                  00340002
003500 ENVIRONMENT DIVISION.                                            00350002
003600*=====================*                                           00360002
003700                                                                  00370002
003800 CONFIGURATION SECTION.                                           00380002
003900*=====================*                                           00390002
004000                                                                  00400002
004100 SOURCE-COMPUTER. IBM-3090.                                       00410002
004200 OBJECT-COMPUTER. IBM-3090.                                       00420002
004300                                                                  00430002
004400 INPUT-OUTPUT SECTION.                                            00440002
004500*=====================*                                           00450002
004600                                                                  00460002
004700 FILE-CONTROL.                                                    00470002
004800*=============*                                                   00480002
004900                                                                  00490002
005000***************************************************************** 00500002
005100* Selects files used in the program                             * 00510002
005200***************************************************************** 00520002
005300                                                                  00530002
005400     SELECT CONTROL-CARD-FILE     ASSIGN       TO INP01           00540002
005500                                  FILE STATUS  IS FS-INP01-STATUS.00550002
005600                                                                  00560002
005700 DATA DIVISION.                                                   00570002
005800*=============*                                                   00580002
005900                                                                  00590002
006000 FILE SECTION.                                                    00600002
006100*=============*                                                   00610002
006200                                                                  00620002
006300 FD  CONTROL-CARD-FILE                                            00630002
006400     RECORDING MODE IS F                                          00640002
006500     LABEL RECORDS ARE STANDARD                                   00650002
006600     BLOCK CONTAINS 0 RECORDS                                     00660002
006700     RECORD CONTAINS 80 CHARACTERS                                00670002
006800     DATA RECORD IS CONTROL-CARD-RECORD.                          00680002
006900                                                                  00690002
007000 01  CONTROL-CARD-RECORD              PIC X(80).                  00700002
007100                                                                  00710002
007200                                                                  00720002
007300 EJECT                                                            00730002
007400                                                                  00740002
007500 WORKING-STORAGE SECTION.                                         00750002
007600*========================*                                        00760002
007700                                                                  00770002
007800***************************************************************** 00780002
007900* Copybook for SQL communication area                           * 00790002
008000***************************************************************** 00800002
008100                                                                  00810002
008200     EXEC SQL                                                     00820002
008300          INCLUDE SQLCA                                           00830002
008400     END-EXEC.                                                    00840002
008500                                                                  00850002
008600****************************************************************  00860002
008700* TDTATTR - DATE ATTRIBUTE TABLE                                  00870002
008800****************************************************************  00880002
009200                                                                  00890002
008900     EXEC SQL                                                     00900002
009000         INCLUDE TDTATTR                                          00910002
009100     END-EXEC.                                                    00920002
009200                                                                  00930002
009300****************************************************************  00940002
009400* MLT_BRND_VND_DTE_CNTL - BRAND VENDOR DATE CONTROL TABLE         00950002
009500****************************************************************  00960002
009200                                                                  00970002
009600     EXEC SQL                                                     00980002
009700         INCLUDE MLT00021                                         00990002
009800     END-EXEC.                                                    01000002
009900                                                                  01010002
010000****************************************************************  01020002
010100* MLT_INV_ADJ_TRN_DTL - INVENTORY ADJUSTMENT AUDIT TABLE          01030002
010200****************************************************************  01040002
010300                                                                  01050002
010400     EXEC SQL                                                     01060002
010500         INCLUDE MLT00037                                         01070002
010600     END-EXEC.                                                    01080002
010700                                                                  01090002
010000****************************************************************  01100002
010100* MLT_PRCHG_TRN_DTL - PRICE CHANGE AUDIT TABLE                    01110002
010200****************************************************************  01120002
010300                                                                  01130002
010400     EXEC SQL                                                     01140002
010500         INCLUDE MLT00038                                         01150002
010600     END-EXEC.                                                    01160002
010700                                                                  01170002
010000****************************************************************  01180002
010100* MLT_PADJ_TRN_DTL - PURCHASE ADJUSTMENT AUDIT TABLE              01190002
010200****************************************************************  01200002
010300                                                                  01210002
010400     EXEC SQL                                                     01220002
010500         INCLUDE MLT00039                                         01230002
010600     END-EXEC.                                                    01240002
010700                                                                  01250002
010000****************************************************************  01260002
010100* MLT_SLS_TRN_DTL - SALES AUDIT TABLE                             01270002
010200****************************************************************  01280002
010300                                                                  01290002
010400     EXEC SQL                                                     01300002
010500         INCLUDE MLT00040                                         01310002
010600     END-EXEC.                                                    01320002
010700                                                                  01330002
010800***************************************************************** 01340002
010900*  Copybook of working storage for SQL abend routine            * 01350002
011000***************************************************************** 01360002
011100                                                                  01370002
011200     COPY DPWS004.                                                01380002
011300                                                                  01390002
011400     COPY SQLCA2.                                                 01400002
011500                                                                  01410002
011600****************************************************************  01420002
011700*  File status variables                                       *  01430002
011800****************************************************************  01440002
011900 01  FS-FILE-STATUS.                                              01450002
012000     03  FS-INP01-STATUS           PIC  X(02)  VALUE SPACES.      01460002
012100                                                                  01470002
012200***************************************************************   01480002
012300*  PC-program constants                                       *   01490002
012400***************************************************************   01500002
012500 01  PC-PROGRAM-CONSTANTS.                                        01510002
012600     05  PC-MAXIMUM-RETRY-COUNT    PIC  S9(04) VALUE +2           01520002
012700                                               COMP SYNC.         01530002
012800                                                                  01540002
012900***************************************************************   01550002
013000*  Switches                                                   *   01560002
013100***************************************************************   01570002
013200 01  PS-PROGRAM-SWITCHES.                                         01580002
013300     05  PS-INPUT-IND                 PIC X(01)   VALUE 'N'.      01590002
013400         88  END-OF-INPUT                         VALUE 'Y'.      01600002
013500     05  PS-SQL-ERROR-SW              PIC X(01)   VALUE 'N'.      01610002
013600         88  PS-SQL-ERROR                         VALUE 'Y'.      01620002
013700         88  PS-NO-SQL-ERROR                      VALUE 'N'.      01630002
013800     05  PS-END-OF-CONTROL-CARDS-SW   PIC X(01)   VALUE 'N'.      01640002
013900         88  PS-END-OF-CONTROL-CARDS              VALUE 'Y'.      01650002
014000                                                                  01660002
014100**************************************************************    01670002
014200*  General workarea                                          *    01680002
014300**************************************************************    01690002
014400                                                                  01700002
014500 01  PV-PROGRAM-VARIABLES.                                        01710002
014600                                                                  01720002
014700     05  PV-PARAGRAPH-NAME         PIC  X(30).                    01730002
014800     05  PV-DB2-OPER-ATTEMPTED     PIC  X(30).                    01740002
014900     05  PV-ABEND-CODE             PIC S9(04) COMP VALUE ZERO.    01750002
015000     05  PV-COMMIT-CNT             PIC S9(11) COMP VALUE 0.       01760002
015000     05  PV-INV-ADJ-DEL-CNT        PIC S9(11) COMP VALUE 0.       01770002
015100     05  PV-PRCHG-DEL-CNT          PIC S9(11) COMP VALUE 0.       01780002
015200     05  PV-PADJ-DEL-CNT           PIC S9(11) COMP VALUE 0.       01790002
015300     05  PV-SLS-DEL-CNT            PIC S9(11) COMP VALUE 0.       01800002
015400     05  PV-EXTRACT-START-DATE     PIC  X(10).                    01810002
015500     05  PV-EXTRACT-END-DATE       PIC  X(10).                    01820002
015600                                                                  01830002
015700****************************************************************  01840002
015800* RECORD LAYOUT FOR CONTROL CARD FILE.                            01850002
015900****************************************************************  01860002
016000                                                                  01870002
016100 01  CC-CONTROL-CARD.                                             01880002
016300     05  FILLER                    PIC X(01).                     01890002
016200     05  CC-EXTRACT-START-DATE     PIC X(10).                     01900002
016300     05  FILLER                    PIC X(01).                     01910002
016400     05  CC-EXTRACT-END-DATE       PIC X(10).                     01920002
016500     05  FILLER                    PIC X(58).                     01930002
016600                                                                  01940002
016700**************************************************************    01950002
016800*  General workarea sql abend                                *    01960002
016900**************************************************************    01970002
017000 01  ABEND-CODE                    PIC S9(04) VALUE +0 COMP SYNC. 01980002
017100     88  ABEND-4013                           VALUE +4013.        01990002
017200                                                                  02000002
017300******************************************************************02010002
017400*  CURSOR ON MLT_INV_ADJ_TRN_DTL TABLE.                           02020002
017500******************************************************************02030002
017600                                                                  02040002
017700     EXEC SQL                                                     02050002
017800        DECLARE INV-ADJ-CSR CURSOR WITH HOLD FOR                  02060002
017900            SELECT                                                02070002
018000                FSCL_WK_END_DTE                                   02080002
018000               ,DEPT_NBR                                          02090002
018000               ,MAJ_CL_NBR                                        02100002
018000               ,SUB_CL_NBR                                        02110002
018000               ,LOC_NBR                                           02120002
018100            FROM                                                  02130002
018200                MLT_INV_ADJ_TRN_DTL                               02140002
018300            WHERE FSCL_WK_END_DTE BETWEEN :PV-EXTRACT-START-DATE  02150002
018400              AND                         :PV-EXTRACT-END-DATE    02160002
018500     END-EXEC.                                                    02170002
018600*                                                                 02180002
017300******************************************************************02190002
017400*  CURSOR ON MLT_PRCHG_TRN_DTL TABLE.                             02200002
017500******************************************************************02210002
017600                                                                  02220002
017700     EXEC SQL                                                     02230002
017800        DECLARE PRCHG-CSR CURSOR WITH HOLD FOR                    02240002
017900            SELECT                                                02250002
018000                FSCL_WK_END_DTE                                   02260002
018000               ,DEPT_NBR                                          02270002
018000               ,MAJ_CL_NBR                                        02280002
018000               ,SUB_CL_NBR                                        02290002
018000               ,LOC_NBR                                           02300002
018100            FROM                                                  02310002
018200                MLT_PRCHG_TRN_DTL                                 02320002
018300            WHERE FSCL_WK_END_DTE BETWEEN :PV-EXTRACT-START-DATE  02330002
018400              AND                         :PV-EXTRACT-END-DATE    02340002
018500     END-EXEC.                                                    02350002
018600*                                                                 02360002
017300******************************************************************02370002
017400*  CURSOR ON MLT_PADJ_TRN_DTL TABLE.                              02380002
017500******************************************************************02390002
017600                                                                  02400002
017700     EXEC SQL                                                     02410002
017800        DECLARE PADJ-CSR CURSOR WITH HOLD FOR                     02420002
017900            SELECT                                                02430002
018000                FSCL_WK_END_DTE                                   02440002
018000               ,DEPT_NBR                                          02450002
018000               ,MAJ_CL_NBR                                        02460002
018000               ,SUB_CL_NBR                                        02470002
018000               ,LOC_NBR                                           02480002
018100            FROM                                                  02490002
018200                MLT_PADJ_TRN_DTL                                  02500002
018300            WHERE FSCL_WK_END_DTE BETWEEN :PV-EXTRACT-START-DATE  02510002
018400              AND                         :PV-EXTRACT-END-DATE    02520002
018500     END-EXEC.                                                    02530002
018600*                                                                 02540002
017300******************************************************************02550002
017400*  CURSOR ON MLT_SLS_TRN_DTL TABLE.                               02560002
017500******************************************************************02570002
017600                                                                  02580002
017700     EXEC SQL                                                     02590002
017800        DECLARE SLS-CSR CURSOR WITH HOLD FOR                      02600002
017900            SELECT                                                02610002
018000                FSCL_WK_END_DTE                                   02620002
018000               ,DEPT_NBR                                          02630002
018000               ,MAJ_CL_NBR                                        02640002
018000               ,SUB_CL_NBR                                        02650002
018000               ,LOC_NBR                                           02660002
018100            FROM                                                  02670002
018200                MLT_SLS_TRN_DTL                                   02680002
018300            WHERE FSCL_WK_END_DTE BETWEEN :PV-EXTRACT-START-DATE  02690002
018400              AND                         :PV-EXTRACT-END-DATE    02700002
018500     END-EXEC.                                                    02710002
018600*                                                                 02720002
018700 PROCEDURE DIVISION.                                              02730002
018800****************************************************************  02740002
018900*  MAIN LINE OF THE PROGRAM PERFORMS THE                       *  02750002
019000*  INITIALIZATION ROUTINE AND CONTROLS THE PROCESSING OF PGM.  *  02760002
019100****************************************************************  02770002
019200 0000-MAIN-CONTROL.                                               02780002
019300                                                                  02790002
019400     PERFORM 1000-HOUSEKEEPING.                                   02800002
019500                                                                  02810002
019600     PERFORM 2000-PROCESS-DATA.                                   02820002
019700                                                                  02830002
019800     PERFORM 9000-EOJ.                                            02840002
019900                                                                  02850002
020000     STOP RUN.                                                    02860002
020100                                                                  02870002
020200****************************************************************  02880002
020300*  OPEN FILES AND PERFORM FIRST READ FROM INPUT FILE           *  02890002
020400****************************************************************  02900002
020500 1000-HOUSEKEEPING.                                               02910002
020600     DISPLAY '*1000-HOUSEKEEPING  *'                              02920002
020700                                                                  02930002
020800     MOVE "*1000-HOUSEKEEPING  *"        TO PV-PARAGRAPH-NAME     02940002
020900                                                                  02950002
021000     OPEN INPUT CONTROL-CARD-FILE.                                02960002
021100     DISPLAY 'INPUT FILE OPENED. FILE STATUS: '  FS-INP01-STATUS  02970002
021200                                                                  02980002
021300     PERFORM 1100-SET-EXTRACT-DATES.                              02990002
021400                                                                  03000002
021500******************************************************************03010002
021600* IF THERE ARE DATES ON THE CONTROL CARD, WE WILL USE THEM IN OUR 03020002
021700* PROCESSING (OVERRIDE).  IF NOT, WE WILL EXTRACT THE PROCESSING  03030002
021800* DATES FROM THE MERCHANDISE LEDGER CONTROL TABLE                 03040002
021900******************************************************************03050002
022000 1100-SET-EXTRACT-DATES.                                          03060002
022100                                                                  03070002
022200     PERFORM 7000-READ-CONTROL-CARD-FILE.                         03080002
022300                                                                  03090002
022400     IF CC-EXTRACT-START-DATE = SPACE                             03100002
022500         PERFORM 1110-USE-BV-CNTL-DATES                           03110002
022600         DISPLAY '***********************************************'03120002
022700         DISPLAY '** MLT_BRND_VND_DTE_CNTL DATE USED.   '         03130002
022800         DISPLAY '** START DATE USED : ' PV-EXTRACT-START-DATE    03140002
022900         DISPLAY '** END DATE USED   : ' PV-EXTRACT-END-DATE      03150002
023000         DISPLAY '***********************************************'03160002
023100     ELSE                                                         03170002
023200         PERFORM 1120-USE-OVERRIDE-DATE                           03180002
023300         DISPLAY '***********************************************'03190002
023400         DISPLAY '** OVERRIDE DATE USED.   '                      03200002
023500         DISPLAY '** START DATE USED : ' PV-EXTRACT-START-DATE    03210002
023600         DISPLAY '** END DATE USED   : ' PV-EXTRACT-END-DATE      03220002
023700         DISPLAY '***********************************************'03230002
023800     END-IF.                                                      03240002
023900                                                                  03250002
024000******************************************************************03260002
024100* GET THE OPEN FISCAL WEEK DATE AND THE MAX POSTING FISCAL WEEK   03270002
024200* DATE FROM THE MERCHANDISE LEDGER CONTROL TABLE FOR PROCESSING   03280002
024300******************************************************************03290002
024400 1110-USE-BV-CNTL-DATES.                                          03300002
024500                                                                  03310002
024600     EXEC SQL                                                     03320002
024700          SELECT                                                  03330002
024800              CLO_DTE                                             03340002
024900          INTO                                                    03350002
025000              :MLT00021-CLO-DTE                                   03360002
025100          FROM                                                    03370002
025200              MLT_BRND_VND_DTE_CNTL                               03380002
025300          WITH UR                                                 03390002
025400     END-EXEC.                                                    03400002
025500                                                                  03410002
025600     EVALUATE TRUE                                                03420002
025700         WHEN SQLCODE = ZERO                                      03430002
025800             CONTINUE                                             03440002
025900         WHEN OTHER                                               03450002
026000             MOVE '1110-USE-BV-CNTL-DATES'                        03460002
026100                                         TO PV-PARAGRAPH-NAME     03470002
026200             MOVE 'SELECT ROW FROM MLT_BRND_VND_DTE_CNTL'         03480002
026300                                         TO PV-DB2-OPER-ATTEMPTED 03490002
026400             PERFORM 9999-ABEND                                   03500002
026500     END-EVALUATE.                                                03510002
026600                                                                  03520002
026700     EXEC SQL                                                     03530002
026800          SELECT                                                  03540002
026900              LY_THIS_DAY_KY_DTE                                  03550002
027000          INTO                                                    03560002
027100              :DTATTR-LY-THIS-DAY-KY-DTE                          03570002
027200          FROM                                                    03580002
027300              TDTATTR                                             03590002
027400          WHERE                                                   03600002
027500              KY_DTE  = :MLT00021-CLO-DTE                         03610002
027600          WITH UR                                                 03620002
027700     END-EXEC.                                                    03630002
027800                                                                  03640002
027900     EVALUATE TRUE                                                03650002
028000         WHEN SQLCODE = ZERO                                      03660002
028100             MOVE '0001-01-01'           TO PV-EXTRACT-START-DATE 03670002
028200             MOVE DTATTR-LY-THIS-DAY-KY-DTE                       03680002
028300                                         TO PV-EXTRACT-END-DATE   03690002
028400         WHEN OTHER                                               03700002
028500             MOVE '1110-USE-BV-CNTL-DATES'                        03710002
028600                                         TO PV-PARAGRAPH-NAME     03720002
028700             MOVE 'SELECT ROW FROM TDTATTR'                       03730002
028800                                         TO PV-DB2-OPER-ATTEMPTED 03740002
028900             PERFORM 9999-ABEND                                   03750002
029000     END-EVALUATE.                                                03760002
029100                                                                  03770002
029200******************************************************************03780002
029300* USE THE OVERRIDE DATES FROM THE CONTROL CARD                    03790002
029400******************************************************************03800002
029500 1120-USE-OVERRIDE-DATE.                                          03810002
029100                                                                  03820002
026700     EXEC SQL                                                     03830002
026800          SELECT                                                  03840002
026900              LY_THIS_DAY_KY_DTE                                  03850002
027000          INTO                                                    03860002
027100              :DTATTR-LY-THIS-DAY-KY-DTE                          03870002
027200          FROM                                                    03880002
027300              TDTATTR                                             03890002
027400          WHERE                                                   03900002
027500              KY_DTE  = :CC-EXTRACT-START-DATE                    03910002
027600          WITH UR                                                 03920002
027700     END-EXEC.                                                    03930002
027800                                                                  03940002
027900     EVALUATE TRUE                                                03950002
028000         WHEN SQLCODE = ZERO                                      03960002
028100             CONTINUE                                             03970002
028400         WHEN OTHER                                               03980002
028500             MOVE '1120-USE-OVERRIDE-DATE'                        03990002
028600                                         TO PV-PARAGRAPH-NAME     04000002
028700             DISPLAY 'INPUT DATE:' CC-EXTRACT-START-DATE          04010002
028700             MOVE 'INVALID START DATE'   TO PV-DB2-OPER-ATTEMPTED 04020002
028900             PERFORM 9999-ABEND                                   04030002
029000     END-EVALUATE.                                                04040002
029800                                                                  04050002
026700     EXEC SQL                                                     04060002
026800          SELECT                                                  04070002
026900              LY_THIS_DAY_KY_DTE                                  04080002
027000          INTO                                                    04090002
027100              :DTATTR-LY-THIS-DAY-KY-DTE                          04100002
027200          FROM                                                    04110002
027300              TDTATTR                                             04120002
027400          WHERE                                                   04130002
027500              KY_DTE  = :CC-EXTRACT-END-DATE                      04140002
027600          WITH UR                                                 04150002
027700     END-EXEC.                                                    04160002
027800                                                                  04170002
027900     EVALUATE TRUE                                                04180002
028000         WHEN SQLCODE = ZERO                                      04190002
028100             CONTINUE                                             04200002
028400         WHEN OTHER                                               04210002
028500             MOVE '1120-USE-OVERRIDE-DATE'                        04220002
028600                                         TO PV-PARAGRAPH-NAME     04230002
028700             DISPLAY 'INPUT DATE:' CC-EXTRACT-END-DATE            04240002
028700             MOVE 'INVALID END DATE'     TO PV-DB2-OPER-ATTEMPTED 04250002
028900             PERFORM 9999-ABEND                                   04260002
029000     END-EVALUATE.                                                04270002
029800                                                                  04280002
029600     MOVE CC-EXTRACT-START-DATE          TO PV-EXTRACT-START-DATE.04290002
029700     MOVE CC-EXTRACT-END-DATE            TO PV-EXTRACT-END-DATE.  04300002
029800                                                                  04310002
029900****************************************************************  04320002
030000*  PROCESS THE AUDIT TABLES AND DELETE THE RECORDS THAT MATCH  *  04330002
030100*  THE SELECTION CRITERIA.                                     *  04340002
030200****************************************************************  04350002
030300 2000-PROCESS-DATA.                                               04360002
030400                                                                  04370002
030500     MOVE "*2000-PROCESS-DATA*"          TO PV-PARAGRAPH-NAME     04380002
031100                                                                  04390002
031200     PERFORM 2100-PROCESS-INV-ADJ.                                04400002
031200     PERFORM 2200-PROCESS-PRCHG.                                  04410002
031200     PERFORM 2300-PROCESS-PADJ.                                   04420002
031200     PERFORM 2400-PROCESS-SLS.                                    04430002
031700                                                                  04440002
029900****************************************************************  04450002
030000*  PROCESS THE INV-ADJ-DATA                                    *  04460002
030200****************************************************************  04470002
030300 2100-PROCESS-INV-ADJ.                                            04480002
030400                                                                  04490002
030500     MOVE "*2100-PROCESS-INV-ADJ*"       TO PV-PARAGRAPH-NAME     04500002
030600     MOVE 'N'                            TO PS-INPUT-IND          04510002
030700                                                                  04520002
030800     EXEC SQL                                                     04530002
030900         OPEN INV-ADJ-CSR                                         04540002
031000     END-EXEC.                                                    04550002
031100                                                                  04560002
031200     PERFORM 2110-FETCH-INV-ADJ  UNTIL END-OF-INPUT.              04570002
031300                                                                  04580002
031400     EXEC SQL                                                     04590002
031500        CLOSE INV-ADJ-CSR                                         04600002
031600     END-EXEC.                                                    04610002
031700                                                                  04620002
031800***************************************************************** 04630002
031900* Description     : Fetch the current record from cursor        * 04640002
032000***************************************************************** 04650002
032100 2110-FETCH-INV-ADJ.                                              04660002
032200                                                                  04670002
032300     MOVE "*2110-FETCH-INV-ADJ*"        TO PV-PARAGRAPH-NAME      04680002
032400                                                                  04690002
032500     EXEC SQL                                                     04700002
032600          FETCH  INV-ADJ-CSR                                      04710002
032700           INTO :MLT00037-FSCL-WK-END-DTE                         04720002
032700              , :MLT00037-DEPT-NBR                                04730002
032700              , :MLT00037-MAJ-CL-NBR                              04740002
032700              , :MLT00037-SUB-CL-NBR                              04750002
032700              , :MLT00037-LOC-NBR                                 04760002
032800     END-EXEC.                                                    04770002
032900                                                                  04780002
033000     EVALUATE SQLCODE                                             04790002
033100         WHEN +0                                                  04800002
033200*            CONTINUE                                             04810002
033300             PERFORM 2111-DELETE-INV-ADJ                          04820002
033400         WHEN +100                                                04830002
033500             SET END-OF-INPUT TO TRUE                             04840002
033600         WHEN OTHER                                               04850002
033700             MOVE "FETCH INV ADJ "      TO PV-DB2-OPER-ATTEMPTED  04860002
033800             DISPLAY SPACES                                       04870002
033900             DISPLAY SPACES                                       04880002
034000             DISPLAY "FSCL-WK-END-DTE:" MLT00037-FSCL-WK-END-DTE  04890002
034000             DISPLAY "DEPT-NBR       :" MLT00037-DEPT-NBR         04900002
034000             DISPLAY "MAJ-CL-NBR     :" MLT00037-MAJ-CL-NBR       04910002
034000             DISPLAY "SUB-CL-NBR     :" MLT00037-SUB-CL-NBR       04920002
034000             DISPLAY "LOC-NBR        :" MLT00037-LOC-NBR          04930002
034100             PERFORM 9999-ABEND                                   04940002
034200     END-EVALUATE.                                                04950002
034300                                                                  04960002
034400***************************************************************** 04970002
034500* Description     : Delete the current record from cursor       * 04980002
034600***************************************************************** 04990002
034700 2111-DELETE-INV-ADJ.                                             05000002
034800                                                                  05010002
034900     MOVE "*2111-DELETE-INV-ADJ*"       TO PV-PARAGRAPH-NAME      05020002
035000                                                                  05030002
035100     EXEC SQL                                                     05040002
035200          DELETE FROM MLT_INV_ADJ_TRN_DTL                         05050002
035300          WHERE CURRENT OF INV-ADJ-CSR                            05060002
035400     END-EXEC.                                                    05070002
035500                                                                  05080002
035600     EVALUATE SQLCODE                                             05090002
035700         WHEN +0                                                  05100002
035800             ADD 1                      TO PV-INV-ADJ-DEL-CNT     05110002
035800             ADD 1                      TO PV-COMMIT-CNT          05120002
035900             IF  PV-COMMIT-CNT          >= 10000                  05130002
036000                 PERFORM 6000-COMMIT                              05140002
036100                 INITIALIZE PV-COMMIT-CNT                         05150002
036200             END-IF                                               05160002
036300         WHEN +100                                                05170002
036400             CONTINUE                                             05180002
036500         WHEN OTHER                                               05190002
036600             MOVE "DELETE INV ADJ "     TO PV-DB2-OPER-ATTEMPTED  05200002
036700             DISPLAY SPACES                                       05210002
036800             DISPLAY SPACES                                       05220002
034000             DISPLAY "FSCL-WK-END-DTE:" MLT00037-FSCL-WK-END-DTE  05230002
034000             DISPLAY "DEPT-NBR       :" MLT00037-DEPT-NBR         05240002
034000             DISPLAY "MAJ-CL-NBR     :" MLT00037-MAJ-CL-NBR       05250002
034000             DISPLAY "SUB-CL-NBR     :" MLT00037-SUB-CL-NBR       05260002
034000             DISPLAY "LOC-NBR        :" MLT00037-LOC-NBR          05270002
037000             PERFORM 9999-ABEND                                   05280002
037100     END-EVALUATE.                                                05290002
037200                                                                  05300002
029900****************************************************************  05310002
030000*  PROCESS THE PRCHG-DATA                                      *  05320002
030200****************************************************************  05330002
030300 2200-PROCESS-PRCHG.                                              05340002
030400                                                                  05350002
030500     MOVE "*2200-PROCESS-PRCHG*"         TO PV-PARAGRAPH-NAME     05360002
030600     MOVE 'N'                            TO PS-INPUT-IND          05370002
030700                                                                  05380002
030800     EXEC SQL                                                     05390002
030900         OPEN PRCHG-CSR                                           05400002
031000     END-EXEC.                                                    05410002
031100                                                                  05420002
031200     PERFORM 2210-FETCH-PRCHG UNTIL END-OF-INPUT.                 05430002
031300                                                                  05440002
031400     EXEC SQL                                                     05450002
031500        CLOSE PRCHG-CSR                                           05460002
031600     END-EXEC.                                                    05470002
031700                                                                  05480002
031800***************************************************************** 05490002
031900* Description     : Fetch the current record from cursor        * 05500002
032000***************************************************************** 05510002
032100 2210-FETCH-PRCHG.                                                05520002
032200                                                                  05530002
032300     MOVE "*2210-FETCH-PRCHG*"          TO PV-PARAGRAPH-NAME      05540002
032400                                                                  05550002
032500     EXEC SQL                                                     05560002
032600          FETCH  PRCHG-CSR                                        05570002
032700           INTO :MLT00037-FSCL-WK-END-DTE                         05580002
032700              , :MLT00037-DEPT-NBR                                05590002
032700              , :MLT00037-MAJ-CL-NBR                              05600002
032700              , :MLT00037-SUB-CL-NBR                              05610002
032700              , :MLT00037-LOC-NBR                                 05620002
032800     END-EXEC.                                                    05630002
032900                                                                  05640002
033000     EVALUATE SQLCODE                                             05650002
033100         WHEN +0                                                  05660002
033200*            CONTINUE                                             05670002
033300             PERFORM 2211-DELETE-PRCHG                            05680002
033400         WHEN +100                                                05690002
033500             SET END-OF-INPUT TO TRUE                             05700002
033600         WHEN OTHER                                               05710002
033700             MOVE "FETCH PRCHG "        TO PV-DB2-OPER-ATTEMPTED  05720002
033800             DISPLAY SPACES                                       05730002
033900             DISPLAY SPACES                                       05740002
034000             DISPLAY "FSCL-WK-END-DTE:" MLT00038-FSCL-WK-END-DTE  05750002
034000             DISPLAY "DEPT-NBR       :" MLT00038-DEPT-NBR         05760002
034000             DISPLAY "MAJ-CL-NBR     :" MLT00038-MAJ-CL-NBR       05770002
034000             DISPLAY "SUB-CL-NBR     :" MLT00038-SUB-CL-NBR       05780002
034000             DISPLAY "LOC-NBR        :" MLT00038-LOC-NBR          05790002
034100             PERFORM 9999-ABEND                                   05800002
034200     END-EVALUATE.                                                05810002
034300                                                                  05820002
034400***************************************************************** 05830002
034500* Description     : Delete the current record from cursor       * 05840002
034600***************************************************************** 05850002
034700 2211-DELETE-PRCHG.                                               05860002
034800                                                                  05870002
034900     MOVE "*2211-DELETE-PRCHG*"         TO PV-PARAGRAPH-NAME      05880002
035000                                                                  05890002
035100     EXEC SQL                                                     05900002
035200          DELETE FROM MLT_PRCHG_TRN_DTL                           05910002
035300          WHERE CURRENT OF PRCHG-CSR                              05920002
035400     END-EXEC.                                                    05930002
035500                                                                  05940002
035600     EVALUATE SQLCODE                                             05950002
035700         WHEN +0                                                  05960002
035800             ADD 1                      TO PV-PRCHG-DEL-CNT       05970002
035800             ADD 1                      TO PV-COMMIT-CNT          05980002
035900             IF  PV-COMMIT-CNT          >= 10000                  05990002
036000                 PERFORM 6000-COMMIT                              06000002
036100                 INITIALIZE PV-COMMIT-CNT                         06010002
036200             END-IF                                               06020002
036300         WHEN +100                                                06030002
036400             CONTINUE                                             06040002
036500         WHEN OTHER                                               06050002
036600             MOVE "DELETE PRCHG "       TO PV-DB2-OPER-ATTEMPTED  06060002
036700             DISPLAY SPACES                                       06070002
036800             DISPLAY SPACES                                       06080002
034000             DISPLAY "FSCL-WK-END-DTE:" MLT00038-FSCL-WK-END-DTE  06090002
034000             DISPLAY "DEPT-NBR       :" MLT00038-DEPT-NBR         06100002
034000             DISPLAY "MAJ-CL-NBR     :" MLT00038-MAJ-CL-NBR       06110002
034000             DISPLAY "SUB-CL-NBR     :" MLT00038-SUB-CL-NBR       06120002
034000             DISPLAY "LOC-NBR        :" MLT00038-LOC-NBR          06130002
037000             PERFORM 9999-ABEND                                   06140002
037100     END-EVALUATE.                                                06150002
037200                                                                  06160002
029900****************************************************************  06170002
030000*  PROCESS THE PADJ-DATA                                       *  06180002
030200****************************************************************  06190002
030300 2300-PROCESS-PADJ.                                               06200002
030400                                                                  06210002
030500     MOVE "*2300-PROCESS-PADJ*"          TO PV-PARAGRAPH-NAME     06220002
030600     MOVE 'N'                            TO PS-INPUT-IND          06230002
030700                                                                  06240002
030800     EXEC SQL                                                     06250002
030900         OPEN PADJ-CSR                                            06260002
031000     END-EXEC.                                                    06270002
031100                                                                  06280002
031200     PERFORM 2310-FETCH-PADJ UNTIL END-OF-INPUT.                  06290002
031300                                                                  06300002
031400     EXEC SQL                                                     06310002
031500        CLOSE PADJ-CSR                                            06320002
031600     END-EXEC.                                                    06330002
031700                                                                  06340002
031800***************************************************************** 06350002
031900* Description     : Fetch the current record from cursor        * 06360002
032000***************************************************************** 06370002
032100 2310-FETCH-PADJ.                                                 06380002
032200                                                                  06390002
032300     MOVE "*2310-FETCH-PADJ*"           TO PV-PARAGRAPH-NAME      06400002
032400                                                                  06410002
032500     EXEC SQL                                                     06420002
032600          FETCH  PADJ-CSR                                         06430002
032700           INTO :MLT00037-FSCL-WK-END-DTE                         06440002
032700              , :MLT00037-DEPT-NBR                                06450002
032700              , :MLT00037-MAJ-CL-NBR                              06460002
032700              , :MLT00037-SUB-CL-NBR                              06470002
032700              , :MLT00037-LOC-NBR                                 06480002
032800     END-EXEC.                                                    06490002
032900                                                                  06500002
033000     EVALUATE SQLCODE                                             06510002
033100         WHEN +0                                                  06520002
033200*            CONTINUE                                             06530002
033300             PERFORM 2311-DELETE-PADJ                             06540002
033400         WHEN +100                                                06550002
033500             SET END-OF-INPUT TO TRUE                             06560002
033600         WHEN OTHER                                               06570002
033700             MOVE "FETCH PADJ "         TO PV-DB2-OPER-ATTEMPTED  06580002
033800             DISPLAY SPACES                                       06590002
033900             DISPLAY SPACES                                       06600002
034000             DISPLAY "FSCL-WK-END-DTE:" MLT00039-FSCL-WK-END-DTE  06610002
034000             DISPLAY "DEPT-NBR       :" MLT00039-DEPT-NBR         06620002
034000             DISPLAY "MAJ-CL-NBR     :" MLT00039-MAJ-CL-NBR       06630002
034000             DISPLAY "SUB-CL-NBR     :" MLT00039-SUB-CL-NBR       06640002
034000             DISPLAY "LOC-NBR        :" MLT00039-LOC-NBR          06650002
034100             PERFORM 9999-ABEND                                   06660002
034200     END-EVALUATE.                                                06670002
034300                                                                  06680002
034400***************************************************************** 06690002
034500* Description     : Delete the current record from cursor       * 06700002
034600***************************************************************** 06710002
034700 2311-DELETE-PADJ.                                                06720002
034800                                                                  06730002
034900     MOVE "*2311-DELETE-PADJ*"          TO PV-PARAGRAPH-NAME      06740002
035000                                                                  06750002
035100     EXEC SQL                                                     06760002
035200          DELETE FROM MLT_PADJ_TRN_DTL                            06770002
035300          WHERE CURRENT OF PADJ-CSR                               06780002
035400     END-EXEC.                                                    06790002
035500                                                                  06800002
035600     EVALUATE SQLCODE                                             06810002
035700         WHEN +0                                                  06820002
035800             ADD 1                      TO PV-PADJ-DEL-CNT        06830002
035800             ADD 1                      TO PV-COMMIT-CNT          06840002
035900             IF  PV-COMMIT-CNT          >= 10000                  06850002
036000                 PERFORM 6000-COMMIT                              06860002
036100                 INITIALIZE PV-COMMIT-CNT                         06870002
036200             END-IF                                               06880002
036300         WHEN +100                                                06890002
036400             CONTINUE                                             06900002
036500         WHEN OTHER                                               06910002
036600             MOVE "DELETE PADJ "        TO PV-DB2-OPER-ATTEMPTED  06920002
036700             DISPLAY SPACES                                       06930002
036800             DISPLAY SPACES                                       06940002
034000             DISPLAY "FSCL-WK-END-DTE:" MLT00039-FSCL-WK-END-DTE  06950002
034000             DISPLAY "DEPT-NBR       :" MLT00039-DEPT-NBR         06960002
034000             DISPLAY "MAJ-CL-NBR     :" MLT00039-MAJ-CL-NBR       06970002
034000             DISPLAY "SUB-CL-NBR     :" MLT00039-SUB-CL-NBR       06980002
034000             DISPLAY "LOC-NBR        :" MLT00039-LOC-NBR          06990002
037000             PERFORM 9999-ABEND                                   07000002
037100     END-EVALUATE.                                                07010002
037200                                                                  07020002
029900****************************************************************  07030002
030000*  PROCESS THE SLS-DATA                                        *  07040002
030200****************************************************************  07050002
030300 2400-PROCESS-SLS.                                                07060002
030400                                                                  07070002
030500     MOVE "*2400-PROCESS-SLS*"           TO PV-PARAGRAPH-NAME     07080002
030600     MOVE 'N'                            TO PS-INPUT-IND          07090002
030700                                                                  07100002
030800     EXEC SQL                                                     07110002
030900         OPEN SLS-CSR                                             07120002
031000     END-EXEC.                                                    07130002
031100                                                                  07140002
031200     PERFORM 2410-FETCH-SLS UNTIL END-OF-INPUT.                   07150002
031300                                                                  07160002
031400     EXEC SQL                                                     07170002
031500        CLOSE SLS-CSR                                             07180002
031600     END-EXEC.                                                    07190002
031700                                                                  07200002
031800***************************************************************** 07210002
031900* Description     : Fetch the current record from cursor        * 07220002
032000***************************************************************** 07230002
032100 2410-FETCH-SLS.                                                  07240002
032200                                                                  07250002
032300     MOVE "*2410-FETCH-SLS*"            TO PV-PARAGRAPH-NAME      07260002
032400                                                                  07270002
032500     EXEC SQL                                                     07280002
032600          FETCH  SLS-CSR                                          07290002
032700           INTO :MLT00037-FSCL-WK-END-DTE                         07300002
032700              , :MLT00037-DEPT-NBR                                07310002
032700              , :MLT00037-MAJ-CL-NBR                              07320002
032700              , :MLT00037-SUB-CL-NBR                              07330002
032700              , :MLT00037-LOC-NBR                                 07340002
032800     END-EXEC.                                                    07350002
032900                                                                  07360002
033000     EVALUATE SQLCODE                                             07370002
033100         WHEN +0                                                  07380002
033200*            CONTINUE                                             07390002
033300             PERFORM 2411-DELETE-SLS                              07400002
033400         WHEN +100                                                07410002
033500             SET END-OF-INPUT TO TRUE                             07420002
033600         WHEN OTHER                                               07430002
033700             MOVE "FETCH SLS "          TO PV-DB2-OPER-ATTEMPTED  07440002
033800             DISPLAY SPACES                                       07450002
033900             DISPLAY SPACES                                       07460002
034000             DISPLAY "FSCL-WK-END-DTE:" MLT00040-FSCL-WK-END-DTE  07470002
034000             DISPLAY "DEPT-NBR       :" MLT00040-DEPT-NBR         07480002
034000             DISPLAY "MAJ-CL-NBR     :" MLT00040-MAJ-CL-NBR       07490002
034000             DISPLAY "SUB-CL-NBR     :" MLT00040-SUB-CL-NBR       07500002
034000             DISPLAY "LOC-NBR        :" MLT00040-LOC-NBR          07510002
034100             PERFORM 9999-ABEND                                   07520002
034200     END-EVALUATE.                                                07530002
034300                                                                  07540002
034400***************************************************************** 07550002
034500* Description     : Delete the current record from cursor       * 07560002
034600***************************************************************** 07570002
034700 2411-DELETE-SLS.                                                 07580002
034800                                                                  07590002
034900     MOVE "*2411-DELETE-SLS*"           TO PV-PARAGRAPH-NAME      07600002
035000                                                                  07610002
035100     EXEC SQL                                                     07620002
035200          DELETE FROM MLT_SLS_TRN_DTL                             07630002
035300          WHERE CURRENT OF SLS-CSR                                07640002
035400     END-EXEC.                                                    07650002
035500                                                                  07660002
035600     EVALUATE SQLCODE                                             07670002
035700         WHEN +0                                                  07680002
035800             ADD 1                      TO PV-SLS-DEL-CNT         07690002
035800             ADD 1                      TO PV-COMMIT-CNT          07700002
035900             IF  PV-COMMIT-CNT          >= 10000                  07710002
036000                 PERFORM 6000-COMMIT                              07720002
036100                 INITIALIZE PV-COMMIT-CNT                         07730002
036200             END-IF                                               07740002
036300         WHEN +100                                                07750002
036400             CONTINUE                                             07760002
036500         WHEN OTHER                                               07770002
036600             MOVE "DELETE SLS "         TO PV-DB2-OPER-ATTEMPTED  07780002
036700             DISPLAY SPACES                                       07790002
036800             DISPLAY SPACES                                       07800002
034000             DISPLAY "FSCL-WK-END-DTE:" MLT00040-FSCL-WK-END-DTE  07810002
034000             DISPLAY "DEPT-NBR       :" MLT00040-DEPT-NBR         07820002
034000             DISPLAY "MAJ-CL-NBR     :" MLT00040-MAJ-CL-NBR       07830002
034000             DISPLAY "SUB-CL-NBR     :" MLT00040-SUB-CL-NBR       07840002
034000             DISPLAY "LOC-NBR        :" MLT00040-LOC-NBR          07850002
037000             PERFORM 9999-ABEND                                   07860002
037100     END-EVALUATE.                                                07870002
037200                                                                  07880002
037300****************************************************************  07890002
037400* COMMIT AFTER EVERY 10000 UPDATE.                             *  07900002
037500****************************************************************  07910002
037600 6000-COMMIT.                                                     07920002
037700                                                                  07930002
037800     MOVE "*6000-COMMIT"                 TO PV-PARAGRAPH-NAME     07940002
037900                                                                  07950002
038000     EXEC SQL                                                     07960002
038100          COMMIT                                                  07970002
038200     END-EXEC.                                                    07980002
038300                                                                  07990002
038400******************************************************************08000002
038500*  READS THE CONTROL CARD TO DETERMINE IF THEIR ARE ANY OVERRIDE  08010002
038600*                   DATES TO USE FOR PROCESSING                   08020002
038700******************************************************************08030002
038800 7000-READ-CONTROL-CARD-FILE.                                     08040002
038900                                                                  08050002
039000     READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD                  08060002
039100         AT END SET PS-END-OF-CONTROL-CARDS TO TRUE.              08070002
039200                                                                  08080002
039300***************************************************************   08090002
039400* 9000-EOJ-ROUTINE - CLOSES THE FILES ASSOCIATED WITH THE JOB.*   08100002
039500***************************************************************   08110002
039600 9000-EOJ.                                                        08120002
039700                                                                  08130002
039800     DISPLAY ' '.                                                 08140002
039900     DISPLAY '============================================='.     08150002
040000     DISPLAY ' '.                                                 08160002
040100     DISPLAY ' ******  MLKUP060 PROCESSING SUMMARY  ****** '.     08170002
040200     PERFORM 9100-DISPLAY-PROCESSING-INFO.                        08180002
040300     DISPLAY '============================================='.     08190002
040400                                                                  08200002
040500     CLOSE CONTROL-CARD-FILE.                                     08210002
040600                                                                  08220002
040700***************************************************************   08230002
040800* DISPLAY PROCESSED RECORDS COUNTS                            *   08240002
040900***************************************************************   08250002
041000 9100-DISPLAY-PROCESSING-INFO.                                    08260002
041100                                                                  08270002
041200      DISPLAY ' '.                                                08280002
041300      DISPLAY ' INV-ADJ RECORDS DELETED  = ' PV-INV-ADJ-DEL-CNT   08290002
041300      DISPLAY ' PRCHG   RECORDS DELETED  = ' PV-PRCHG-DEL-CNT     08300002
041300      DISPLAY ' PADJ    RECORDS DELETED  = ' PV-PADJ-DEL-CNT      08310002
041300      DISPLAY ' SLS     RECORDS DELETED  = ' PV-SLS-DEL-CNT       08320002
041400      DISPLAY ' '.                                                08330002
041500                                                                  08340002
041700****************************************************************  08350002
041800* SQL abend routine                                            *  08360002
041900****************************************************************  08370002
041600 9999-ABEND.                                                      08380002
042000                                                                  08390002
042100     SET ABEND-4013                     TO TRUE.                  08400002
042200                                                                  08410002
042300     DISPLAY '**  ABEND     **'.                                  08420002
042400                                                                  08430002
042500     DISPLAY '**  PROGRAM   **  =  MLKUP060'.                     08440002
042600     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            08450002
042700     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        08460002
042800*                                                                 08470002
042900* The following copybook utilizes the DB2 abend module            08480002
043000* DSNTIAR to convert SQLCA into understandable verbage.           08490002
043100*                                                                 08500002
043200     COPY DPPD004.                                                08510002
043300*                                                                 08520002
043400     EXEC SQL                                                     08530002
043500          COMMIT                                                  08540002
043600     END-EXEC.                                                    08550002
043700                                                                  08560002
043800     CALL 'ILBOABN0'  USING ABEND-CODE.                           08570002
043900                                                                  08580002
