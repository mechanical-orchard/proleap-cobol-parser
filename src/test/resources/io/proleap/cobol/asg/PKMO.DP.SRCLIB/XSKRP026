000100*----------------------------------------------------------       00010031
000200 IDENTIFICATION DIVISION.                                         00020031
000300*----------------------------------------------------------       00030031
000400 PROGRAM-ID.    XSKRP026.                                         00040031
000500 AUTHOR.        JOSEPH MENYAH.                                    00050031
000600 DATE-WRITTEN.  OCTOBER , 2002.                                   00060031
000700                                                                  00070031
000800*----------------------------------------------------------       00080031
000900*            ADHOC STORE GROUP   INTEGRITY CHECK                  00090031
001000*----------------------------------------------------------       00100031
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00110031
001020* INTEGRITY CHECK FOR THE ADHOC STORE GROUP BUSINESS EVENT.       00120031
001124*                                                                 00130031
001125*----------------------------------------------------------       00140031
001126* HISTORY LOG:                                                    00150031
P11215*  DATE:11/22/2010 CHANGED BY: COGNIZANT     PBI11215             00160031
P11215*  ADHC-STR-GP-ID WILL NOT BE WRITTEN TO REPORT                   00170031
P11215*  WHEN XS DOES NOT HAVE ADHC-STR-GP-ID AND PROMO HAS             00180031
P11215*  ADHC-STR-GP-ID WITH PM704-RUSBL-IND IS SET TO 'N'.             00190031
P11215*----------------------------------------------------------       00200031
P11215* DATE: 01/23/2011                                                00210031
P11215* WR/IR#: INC000001567610                                         00220031
P11215* PROGRAMMER: COGNIZANT                                           00230031
P11215* DESCRIPTION: PROGRAM WENT INTO INFINITE LOOP.                   00240031
P11215*              CHANGED THE LOGIC TO CORRECT IT.                   00250031
P11215*----------------------------------------------------------       00260031
001129* DATE:                                                           00270031
001130* WR/IR#:                                                         00280031
001131* PROGRAMMER:                                                     00290031
001140* DESCRIPTION:                                                    00300031
001150*                                                                 00310031
001160*--------------------------------------------------------------   00320031
C59272* DATE: 01/10/2017                                                00321031
C59272* WR/IR#: CHG0159272                                              00322031
C59272* PROGRAMMER: COGNIZANT                                           00323031
C59272* DESCRIPTION: THIS CHANGE IS REQUIRED TO AVOID THE MISMATCH      00324031
C59272* BETWEEN THE XS AND LPM IN THE START AND END TIMESTAMP BY        00325031
C59272* USING REFERENCE MODIFICATION OPTION.                            00325131
001160*-------------------------------------------------------------    00326031
001170 ENVIRONMENT DIVISION.                                            00330031
001180*-------------------------------------------------------------    00340031
001190 CONFIGURATION SECTION.                                           00350031
001200 SOURCE-COMPUTER. IBM-3090.                                       00360031
001300 OBJECT-COMPUTER. IBM-3090.                                       00370031
001400                                                                  00380031
001500 INPUT-OUTPUT SECTION.                                            00390031
001600                                                                  00400031
001700 FILE-CONTROL.                                                    00410031
004900     SELECT CONTROL-CARD                                          00420031
005000         ASSIGN TO INP00.                                         00430031
                                                                        00440031
004900     SELECT PROMO-EXTRACT-FILE                                    00450031
005000         ASSIGN TO INP01.                                         00460031
                                                                        00470031
004900     SELECT DOMAIN-EXTRACT-FILE                                   00480031
005000         ASSIGN TO INP02.                                         00490031
                                                                        00500031
                                                                        00510031
004900     SELECT ERROR-FILE                                            00520031
005000         ASSIGN TO OUT01.                                         00530031
                                                                        00540031
004900     SELECT REPORT-FILE                                           00550031
005000         ASSIGN TO RPT01.                                         00560031
                                                                        00570031
001900*----------------------------------------------------------       00580031
002000 DATA DIVISION.                                                   00590031
002100*----------------------------------------------------------       00600031
002200 FILE SECTION.                                                    00610031
002300                                                                  00620031
008000 FD  PROMO-EXTRACT-FILE                                           00630031
008100     RECORDING MODE IS F                                          00640031
008200     LABEL RECORDS ARE OMITTED                                    00650031
008300     RECORD CONTAINS 150 CHARACTERS                               00660031
008400     DATA RECORD IS PROMO-EVNT-RECORD.                            00670031
008500 01  PROMO-EVNT-REC              PIC X(150).                      00680031
008600                                                                  00690031
008000 FD  DOMAIN-EXTRACT-FILE                                          00700031
008100     RECORDING MODE IS F                                          00710031
008200     LABEL RECORDS ARE OMITTED                                    00720031
008300     RECORD CONTAINS 150 CHARACTERS                               00730031
008400     DATA RECORD IS DOMAIN-EVNT-RECORD.                           00740031
008500 01  DOMAIN-EVNT-REC              PIC X(150).                     00750031
006500                                                                  00760031
       FD  CONTROL-CARD                                                 00770031
           RECORDING MODE F                                             00780031
           BLOCK CONTAINS 0 RECORDS                                     00790031
           LABEL RECORDS ARE OMITTED                                    00800031
           DATA RECORD IS CONTROL-CARD-RECORD.                          00810031
       01  CONTROL-CARD-RECORD             PIC X(080).                  00820031
                                                                        00830031
       FD  REPORT-FILE                                                  00840031
           RECORDING MODE F                                             00850031
           BLOCK CONTAINS 0 RECORDS                                     00860031
           LABEL RECORDS ARE OMITTED                                    00870031
009600     RECORD CONTAINS 132 CHARACTERS                               00880031
           DATA RECORD IS REPORT-RECORD.                                00890031
       01  REPORT-RECORD                   PIC X(132).                  00900031
                                                                        00910031
       FD  ERROR-FILE                                                   00920031
           RECORDING MODE F                                             00930031
           BLOCK CONTAINS 0 RECORDS                                     00940031
           LABEL RECORDS ARE OMITTED                                    00950031
           DATA RECORD IS DIFFERENCES-RECORD.                           00960031
       01  DIFFERENCES-RECORD              PIC X(150).                  00970031
                                                                        00980031
002500*---------------------------------------------------------        00990031
002600                                                                  01000031
002700 WORKING-STORAGE SECTION.                                         01010031
002800*---------------------------------------------------------        01020031
003500* PC- PROGRAM CONSTANTS                                           01030031
003600*----------------------------------------------------------       01040031
003700 01  PC-PROGRAM-CONSTANTS.                                        01050031
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKRP026'. 01060031
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   01070031
004000                                                                  01080031
097700 01  CD-CPU-DATE.                                                 01090031
097800     03  CD-CPU-YEAR             PIC 99.                          01100031
097900     03  CD-CPU-MONTH            PIC 99.                          01110031
098000     03  CD-CPU-DAY              PIC 99.                          01120031
098100                                                                  01130031
098200 01  CD-CPU-DATE-CC.                                              01140031
098300     03  CD-CPU-CENT             PIC 99.                          01150031
098400     03  CD-CPU-YYMMDD           PIC 9(6).                        01160031
                                                                        01170031
084800 01  PC-REPORT-NO                PIC  9(5)          VALUE 00001.  01180031
                                                                        01190031
011200 01  CT-CPU-TIME.                                                 01200031
011300     03  CT-HOUR                 PIC 99.                          01210031
011400     03  CT-MINUTE               PIC 99.                          01220031
011500     03  FILLER                  PIC 9(4).                        01230031
      *----------------------------------------------------------       01240031
      **PROGRAM                                                         01250031
      *----------------------------------------------------------       01260031
       01  PC-PROGRAM-COUNTER.                                          01270031
           05  PC-RECORD-COUNT                 PIC S9(09) VALUE ZEROS   01280031
                                                          COMP-3.       01290031
           05  PC-PROMO-EXTRACT-RECS-READ      PIC 9(09) VALUE ZEROS.   01300031
           05  PC-DOMAIN-EXTRACT-RECS-READ     PIC 9(09) VALUE ZEROS.   01310031
           05  PC-ERROR-RECORD-WRITTEN         PIC 9(09) VALUE ZEROS.   01320031
           05  PC-ERROR-REPORT-WRITTEN         PIC 9(09) VALUE ZEROS.   01330031
           05  PC-PAGE-CNT                     PIC 9(09) VALUE ZEROS.   01340031
004100*----------------------------------------------------------       01350031
004200* PS- PROGRAM SWITCHES                                            01360031
004300*----------------------------------------------------------       01370031
004400 01  PS-PROGRAM-SWITCHES.                                         01380031
004500     05  PS-EOF-PROMO-EXTRACT-SW          PIC X(01)  VALUE SPACE. 01390031
004600         88  PS-EOF-PROMO                        VALUE 'Y'.       01400031
004600         88  PS-NOT-EOF-PROMO                    VALUE 'N'.       01410031
004800                                                                  01420031
004500     05  PS-EOF-DOMAIN-EXTRACT-SW         PIC X(01)  VALUE SPACE. 01430031
004600         88  PS-EOF-DOMAIN                       VALUE 'Y'.       01440031
004600         88  PS-NOT-EOF-DOMAIN                   VALUE 'N'.       01450031
004800                                                                  01460031
004500     05  PS-NEW-RECORD-SW                 PIC X(01)  VALUE SPACE. 01470031
004600         88  PS-NEW-RECORD                       VALUE 'Y'.       01480031
004600         88  PS-NOT-NEW-RECORD                   VALUE 'N'.       01490031
004800                                                                  01500031
004900*----------------------------------------------------------       01510031
      *    CONTROL-CARD-LAYOUT.                                         01520031
004900*----------------------------------------------------------       01530031
       01  CONTROL-CARD-LAYOUT.                                         01540031
           05  CC-START-POINT                  PIC 9(05) VALUE ZEROS.   01550031
           05  FILLER                          PIC X(01) VALUE SPACES.  01560031
           05  CC-READ-FREQUENCY               PIC 9(05) VALUE ZEROS.   01570031
           05  FILLER                          PIC X(69) VALUE SPACES.  01580031
004900*----------------------------------------------------------       01590031
005000* PV- PROGRAM VARIABLES                                           01600031
005100*----------------------------------------------------------       01610031
005200 01 PV-PROGRAM-VARIABLES.                                         01620031
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 01630031
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   01640031
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         01650031
005710    05  PV-ADHC-STR-GP-ID-HLD         PIC 9(10) VALUE 0.          01660031
005800    05  PV-ACTION-CODE                PIC X(01).                  01670031
005810        88  PV-INSERT-DATA                       VALUE 'I'.       01680031
005820        88  PV-UPDATE-DATA                       VALUE 'U'.       01690031
                                                                        01700031
006000    05  PV-RECORD-COUNT               PIC 9(05) VALUE ZEROS.      01710031
006000    05  PV-LD-STATUS-CDE              PIC X(02).                  01720031
006100        88  PV-NO-ERROR                          VALUE '00'.      01730031
006200        88  PV-CRITICAL-ERROR                    VALUE '01'.      01740031
006300        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      01750031
007000                                                                  01760031
           05  PS-ERROR-FOUND-SW               PIC X(01) VALUE 'N'.     01770031
               88  PS-ERROR-FOUND                        VALUE 'Y'.     01780031
               88  PS-ERROR-NOT-FOUND                    VALUE 'N'.     01790031
                                                                        01800031
007100    05  PV-STRT-PARM.                                             01810031
007200        10  PV-STRT-DTE-CC            PIC X(02).                  01820031
007200        10  PV-STRT-DTE-YY            PIC X(02).                  01830031
007400        10  PV-STRT-DTE-MM            PIC X(02).                  01840031
007600        10  PV-STRT-DTE-DD            PIC X(02).                  01850031
007400        10  FILLER                    PIC X.                      01860031
007400        10  PV-DECREMENT              PIC X(02).                  01870031
007400        10  FILLER                    PIC X(69).                  01880031
007700                                                                  01890031
007100    05  PV-PROMO-STRT-DTE           PIC X(10).                    01900031
007100    05  PV-PROMO-END-DTE            PIC X(10).                    01910031
                                                                        01920031
008600    05  PV-AD-EVNT-END-DTE-TM.                                    01930031
008700        10  PV-AD-EVNT-END-DTE.                                   01940031
008800            15  PV-AD-EVNT-DTE-TM2-CCYY   PIC X(04).              01950031
008900            15  FILLER                    PIC X(01).              01960031
009000            15  PV-AD-EVNT-DTE-TM2-MM     PIC X(02).              01970031
009100            15  FILLER                    PIC X(01).              01980031
009200            15  PV-AD-EVNT-DTE-TM2-DD     PIC X(02).              01990031
009300        10  PV-AD-EVNT-END-TM             PIC X(16).              02000031
                                                                        02010031
008600    05  PV-PROMO-KEY.                                             02020031
008700        10  PV-PM-ADHC-STR-GP-ID          PIC 9(10).              02030031
008700        10  FILLER                        PIC 9(18).              02040031
                                                                        02050031
008600    05  PV-DOMAIN-KEY.                                            02060031
008700        10  PV-XS-ADHC-STR-GP-ID          PIC 9(10).              02070031
008700        10  FILLER                        PIC 9(18).              02080031
009400                                                                  02090031
008600    05  PV-PROMO-SOURCE              PIC X(40) VALUE              02100031
              'DATA SOURCE IS THE PROMO DATABASE'.                      02110031
                                                                        02120031
008600    05  PV-PROMO-NF                  PIC X(40) VALUE              02130031
              'RECORD NOT FOUND IN XS DOMAIN'.                          02140031
                                                                        02150031
008600    05  PV-DOMAIN-SOURCE             PIC X(40) VALUE              02160031
              'DATA SOURCE IS THE XS DOMAIN DATABASE'.                  02170031
                                                                        02180031
008600    05  PV-DOMAIN-NF                  PIC X(40) VALUE             02190031
              'RECORD NOT FOUND IN PROMO TABLES'.                       02200031
                                                                        02210031
       01  PV-PM-TOTAL-RECORD.                                          02220031
           05 PV-PM-BUSINESS-EVNT-ID           PIC 9(03) VALUE ZERO.    02230031
           05 PV-PM-ACTION-CDE                 PIC X(01) VALUE 'T'.     02240031
           05 PV-PM-TOTAL-NBR-OF-RECS          PIC 9(11) VALUE ZERO.    02250031
                                                                        02260031
       01  PV-XS-TOTAL-RECORD.                                          02270031
           05 PV-XS-BUSINESS-EVNT-ID           PIC 9(03) VALUE ZERO.    02280031
           05 PV-XS-ACTION-CDE                 PIC X(01) VALUE 'T'.     02290031
           05 PV-XS-TOTAL-NBR-OF-RECS          PIC 9(11) VALUE ZERO.    02300031
                                                                        02310031
000700 01  ERROR-RECORD                    PIC X(150) VALUE SPACES.     02320031
                                                                        02330031
042800     COPY DPWS132O.                                               02340031
042900                                                                  02350031
                                                                        02360031
043100 01  DR-HEAD2.                                                    02370031
043200     05  FILLER                 PIC X(41)    VALUE SPACES.        02380031
043300     05  DR-TITLE               PIC X(55)    VALUE                02390031
043400      'INTEGRITY CHECK PROGRAM  - ADHOC STORE GROUP'.             02400031
                                                                        02410031
043500                                                                  02420031
043100 01  DR-HEAD3.                                                    02430031
043200     05  FILLER                 PIC X(03)    VALUE                02440031
            'KEY'.                                                      02450031
043200     05  FILLER                 PIC X(15)    VALUE SPACES.        02460031
043200     05  FILLER                 PIC X(10)    VALUE                02470031
            'FIELD NAME'.                                               02480031
043200     05  FILLER                 PIC X(14)    VALUE SPACES.        02490031
043200     05  FILLER                 PIC X(05)    VALUE                02500031
            'VALUE'.                                                    02510031
043200     05  FILLER                 PIC X(31)    VALUE SPACES.        02520031
043200     05  FILLER                 PIC X(16)    VALUE                02530031
            'SOURCE / MESSAGE'.                                         02540031
043200     05  FILLER                 PIC X(35)    VALUE SPACES.        02550031
043500                                                                  02560031
043100 01  DR-HEAD5.                                                    02570031
043200     05  FILLER                 PIC X(132)   VALUE ALL '='.       02580031
000700 01  REPORT-DETAIL.                                               02590031
000800   05 PROMO-RPT-INFO.                                             02600031
000800      10 PROMO-EVNT-KEY              PIC X(30).                   02610031
 00800      10 FILLER                      PIC X(2).                    02620031
 00800      10 PROMO-RPT-DATA-NAME         PIC X(30).                   02630031
 00800      10 FILLER                      PIC X(2).                    02640031
 00800      10 PROMO-RPT-DATA-VALUE        PIC X(26).                   02650031
 00800      10 FILLER                      PIC X(2).                    02660031
000800   05 REPORT-NOTES                   PIC X(40).                   02670031
010900*----------------------------------------------------------       02680031
011000* DOMAIN ADHOC STOR GROUP VENT RECORD LAYOUT                      02690031
011100*----------------------------------------------------------       02700031
011200     COPY XSRD023.                                                02710031
011800                                                                  02720031
004900*----------------------------------------------------------       02730031
005000* PROMO ADHOC STORE GROPU VERSION  COPY BOOK.                     02740031
005100*----------------------------------------------------------       02750031
           COPY PMRD704.                                                02760031
011800                                                                  02770031
030310                                                                  02780031
031400*----------------------------------------------------------       02790031
031500 PROCEDURE DIVISION.                                              02800031
032100*----------------------------------------------------------       02810031
032200 0000-MAINLINE.                                                   02820031
128200     ACCEPT CD-CPU-DATE FROM DATE.                                02830031
128300     IF CD-CPU-YEAR > 80                                          02840031
128400         MOVE 19 TO CD-CPU-CENT                                   02850031
128500     ELSE                                                         02860031
128600         MOVE 20 TO CD-CPU-CENT.                                  02870031
128700     MOVE CD-CPU-DATE TO CD-CPU-YYMMDD.                           02880031
128800                                                                  02890031
128900     ACCEPT CT-CPU-TIME FROM TIME.                                02900031
032300                                                                  02910031
032400     PERFORM 1000-INITIALIZATION.                                 02920031
032500                                                                  02930031
032600     PERFORM 2000-PROCESS-EXTRACT-DATA                            02940031
032700             UNTIL PS-EOF-DOMAIN                                  02950031
032700                OR PS-EOF-PROMO.                                  02960031
                                                                        02970031
           PERFORM 3000-PROCESS-EXTRA-RECORDS                           02980031
032700             UNTIL PS-EOF-DOMAIN                                  02990031
032700               AND PS-EOF-PROMO.                                  03000031
035000                                                                  03010031
035100     PERFORM 9999-WRAPUP.                                         03020031
035200                                                                  03030031
035500     GOBACK.                                                      03040031
035700                                                                  03050031
035701*0000-EXIT.                                                       03060031
035702 EJECT.                                                           03070031
035703                                                                  03080031
035800*----------------------------------------------------------       03090031
035900* 1000-INITIALIZATION.                                            03100031
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            03110031
036100*     UPDATE OR INSERT A RECORD.                                  03120031
036200*----------------------------------------------------------       03130031
036300 1000-INITIALIZATION.                                             03140031
                                                                        03150031
132408     MOVE CD-CPU-YEAR  TO DP132O-RUN-YEAR.                        03160031
132409     MOVE CD-CPU-MONTH TO DP132O-RUN-MONTH.                       03170031
132410     MOVE CD-CPU-DAY   TO DP132O-RUN-DAY.                         03180031
132420     MOVE CT-HOUR    TO DP132O-RUN-HOUR.                          03190031
132430     MOVE CT-MINUTE  TO DP132O-RUN-MINUTE.                        03200031
132440     MOVE 'XSKRP026' TO DP132O-PROGRAM-NAME.                      03210031
132450     MOVE 1          TO DP132O-REPORT-NUMBER.                     03220031
           SET PS-NOT-EOF-PROMO TO TRUE.                                03230031
           SET PS-NOT-EOF-DOMAIN TO TRUE.                               03240031
026600     OPEN INPUT  PROMO-EXTRACT-FILE                               03250031
026600                 DOMAIN-EXTRACT-FILE                              03260031
026600                 CONTROL-CARD                                     03270031
026600          OUTPUT ERROR-FILE                                       03280031
026600                 REPORT-FILE.                                     03290031
                                                                        03300031
           PERFORM 9999-PRINT-HEADINGS.                                 03310031
           PERFORM 9999-READ-CONTROL-CARD.                              03320031
           READ DOMAIN-EXTRACT-FILE INTO PV-XS-TOTAL-RECORD             03330031
           READ PROMO-EXTRACT-FILE INTO PV-PM-TOTAL-RECORD              03340031
                                                                        03350031
           IF PV-PM-TOTAL-NBR-OF-RECS NOT EQUAL TO                      03360031
              PV-XS-TOTAL-NBR-OF-RECS                                   03370031
             MOVE 1 TO CC-START-POINT                                   03380031
             MOVE 1 TO CC-READ-FREQUENCY                                03390031
           END-IF.                                                      03400031
                                                                        03410031
           PERFORM 9999-READ-PROMO-EXTRACT CC-START-POINT TIMES.        03420031
           PERFORM 9999-READ-DOMAIN-EXTRACT  CC-START-POINT TIMES.      03430031
                                                                        03440031
056500                                                                  03450031
037240*1100-EXIT.                                                       03460031
037250 EJECT.                                                           03470031
037251                                                                  03480031
037260*----------------------------------------------------------       03490031
037300* 2000-PROCESS-EXTRACT-DATA.                                      03500031
037400*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            03510031
037500*     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      03520031
037600*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          03530031
037700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      03540031
037800*----------------------------------------------------------       03550031
037900 2000-PROCESS-EXTRACT-DATA.                                       03560031
           IF PM704-ADHC-STR-GP-ID = XS023-ADHC-STR-GP-ID               03570031
              PERFORM 2100-COMPARE-FIELDS                               03580031
              PERFORM 9999-READ-DOMAIN-EXTRACT                          03590031
                      CC-READ-FREQUENCY TIMES                           03600031
              PERFORM 9999-READ-PROMO-EXTRACT                           03610031
                      CC-READ-FREQUENCY TIMES                           03620031
           ELSE                                                         03630031
              IF PM704-ADHC-STR-GP-ID  > XS023-ADHC-STR-GP-ID           03640031
                 MOVE PV-DOMAIN-NF   TO REPORT-NOTES                    03650031
                 MOVE PV-DOMAIN-KEY         TO PROMO-EVNT-KEY           03660031
                 PERFORM 9999-WRITE-ERROR-REPORT                        03670031
                 MOVE XS023-ADHOC-STR-GP-RECORD TO ERROR-RECORD         03680031
                 PERFORM 9999-WRITE-ERROR-RECORD                        03690031
                 PERFORM 9999-READ-DOMAIN-EXTRACT                       03700031
           ELSE                                                         03710031
              IF PM704-ADHC-STR-GP-ID  < XS023-ADHC-STR-GP-ID           03720031
P11215         IF PM704-RUSBL-IND = 'N'                                 03730031
P11215           PERFORM 9999-READ-PROMO-EXTRACT                        03740031
P11215         ELSE                                                     03750031
                 MOVE PV-PROMO-NF TO REPORT-NOTES                       03760031
                 MOVE PV-PROMO-KEY TO PROMO-EVNT-KEY                    03770031
                 PERFORM 9999-WRITE-ERROR-REPORT                        03780031
                 MOVE PM704-ADHOC-STR-GP-RECORD TO ERROR-RECORD         03790031
                 PERFORM 9999-WRITE-ERROR-RECORD                        03800031
                 PERFORM 9999-READ-PROMO-EXTRACT                        03810031
P11215         END-IF                                                   03820031
P11215        END-IF                                                    03830031
           END-IF.                                                      03840031
038000                                                                  03850031
038110*2000-EXIT.                                                       03860031
038200 EJECT.                                                           03870031
                                                                        03880031
038300*------------------------------------------------------           03890031
038400* 2100-COMPARE-FIELDS.                                            03900031
038500*     COMPARES THE EXTRACT FILES AND NOTES ANY DIFFERENCES        03910031
038600*------------------------------------------------------           03920031
038210                                                                  03930031
054400 2100-COMPARE-FIELDS.                                             03940031
036600     IF PM704-BUSINESS-EVNT-ID NOT EQUAL XS023-BUSINESS-EVNT-ID   03950031
              MOVE 'PM704-BUSINESS-EVNT-ID' TO PROMO-RPT-DATA-NAME      03960031
              MOVE PM704-BUSINESS-EVNT-ID   TO PROMO-RPT-DATA-VALUE     03970031
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             03980031
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           03990031
              PERFORM 9999-WRITE-ERROR-REPORT                           04000031
              MOVE 'XS023-BUSINESS-EVNT-ID' TO PROMO-RPT-DATA-NAME      04010031
              MOVE XS023-BUSINESS-EVNT-ID   TO PROMO-RPT-DATA-VALUE     04020031
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04030031
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04040031
              PERFORM 9999-WRITE-ERROR-REPORT                           04050031
              SET PS-ERROR-FOUND     TO TRUE                            04060031
           END-IF.                                                      04070031
                                                                        04080031
036600     IF PM704-ADHC-STR-GP-ID   NOT EQUAL XS023-ADHC-STR-GP-ID     04090031
              MOVE 'PM704-ADHC-STR-GP-ID'   TO PROMO-RPT-DATA-NAME      04100031
              MOVE PM704-ADHC-STR-GP-ID     TO PROMO-RPT-DATA-VALUE     04110031
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             04120031
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           04130031
              PERFORM 9999-WRITE-ERROR-REPORT                           04140031
              MOVE 'XS023-ADHC-STR-GP-ID'   TO PROMO-RPT-DATA-NAME      04150031
              MOVE XS023-ADHC-STR-GP-ID     TO PROMO-RPT-DATA-VALUE     04160031
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04170031
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04180031
              PERFORM 9999-WRITE-ERROR-REPORT                           04190031
              SET PS-ERROR-FOUND     TO TRUE                            04200031
           END-IF.                                                      04210031
                                                                        04220031
036600     IF PM704-ADHC-STR-GP-NM NOT EQUAL XS023-ADHC-STR-GP-NM       04230031
              MOVE 'PM704-ADHC-STR-GP-NM'   TO PROMO-RPT-DATA-NAME      04240031
              MOVE PM704-ADHC-STR-GP-NM     TO PROMO-RPT-DATA-VALUE     04250031
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             04260031
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           04270031
              PERFORM 9999-WRITE-ERROR-REPORT                           04280031
              MOVE 'XS023-ADHC-STR-GP-NM'   TO PROMO-RPT-DATA-NAME      04290031
              MOVE XS023-ADHC-STR-GP-NM     TO PROMO-RPT-DATA-VALUE     04300031
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04310031
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04320031
              PERFORM 9999-WRITE-ERROR-REPORT                           04330031
              SET PS-ERROR-FOUND     TO TRUE                            04340031
           END-IF.                                                      04350031
                                                                        04360031
036600     IF PM704-RUSBL-IND  NOT EQUAL XS023-RUSBL-IND                04370031
              MOVE 'PM704-RUSBL-IND'  TO PROMO-RPT-DATA-NAME            04380031
              MOVE PM704-RUSBL-IND    TO PROMO-RPT-DATA-VALUE           04390031
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             04400031
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           04410031
              PERFORM 9999-WRITE-ERROR-REPORT                           04420031
              MOVE 'XS023-RUSBL-IND' TO PROMO-RPT-DATA-NAME             04430031
              MOVE XS023-RUSBL-IND   TO PROMO-RPT-DATA-VALUE            04440031
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04450031
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04460031
              PERFORM 9999-WRITE-ERROR-REPORT                           04470031
              SET PS-ERROR-FOUND     TO TRUE                            04480031
           END-IF.                                                      04490031
                                                                        04500031
C59272     IF PM704-RUSBL-STRT-TMST(1:10) NOT EQUAL                     04510031
                                            XS023-RUSBL-STRT-TMST(1:10) 04520031
              MOVE 'PM704-RUSBL-STRT-TMST'  TO PROMO-RPT-DATA-NAME      04530031
              MOVE PM704-RUSBL-STRT-TMST TO PROMO-RPT-DATA-VALUE        04540031
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             04550031
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           04560031
              PERFORM 9999-WRITE-ERROR-REPORT                           04570031
              MOVE 'XS023-RUSBL-STRT-TMST' TO PROMO-RPT-DATA-NAME       04580031
              MOVE XS023-RUSBL-STRT-TMST   TO PROMO-RPT-DATA-VALUE      04590031
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04600031
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04610031
              PERFORM 9999-WRITE-ERROR-REPORT                           04620031
              SET PS-ERROR-FOUND     TO TRUE                            04630031
           END-IF.                                                      04640031
                                                                        04650031
C59272     IF PM704-RUSBL-END-TMST(1:10) NOT EQUAL                      04660031
                                           XS023-RUSBL-END-TMST(1:10)   04670031
              MOVE 'PM704-RUSBL-END-TMST'  TO PROMO-RPT-DATA-NAME       04680031
              MOVE PM704-RUSBL-END-TMST TO PROMO-RPT-DATA-VALUE         04690031
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             04700031
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           04710031
              PERFORM 9999-WRITE-ERROR-REPORT                           04720031
              MOVE 'XS023-RUSBL-END-TMST' TO PROMO-RPT-DATA-NAME        04730031
              MOVE XS023-RUSBL-END-TMST   TO PROMO-RPT-DATA-VALUE       04740031
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             04750031
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           04760031
              PERFORM 9999-WRITE-ERROR-REPORT                           04770031
              SET PS-ERROR-FOUND     TO TRUE                            04780031
           END-IF.                                                      04790031
           IF  PS-ERROR-FOUND                                           04800031
037200        IF PM704-LAST-UPD-TMST > XS023-LAST-UPD-TMST              04810031
                 PERFORM 9999-FORMAT-ERROR-RECORD                       04820031
                 PERFORM 9999-WRITE-ERROR-RECORD                        04830031
                 SET PS-ERROR-NOT-FOUND     TO TRUE                     04840031
              END-IF                                                    04850031
           END-IF.                                                      04860031
054500                                                                  04870031
056900 2100-EXIT.                                                       04880031
057000     EXIT.                                                        04890031
043600 EJECT.                                                           04900031
043610                                                                  04910031
                                                                        04920031
      ******************************************************************04930031
      **COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   04940031
      ******************************************************************04950031
       3000-PROCESS-EXTRA-RECORDS.                                      04960031
                                                                        04970031
           IF  PS-NOT-EOF-PROMO                                         04980031
P11215      IF PM704-RUSBL-IND = 'N'                                    04990031
P11215         PERFORM 9999-READ-PROMO-EXTRACT                          05000031
P11215      ELSE                                                        05010031
               INITIALIZE REPORT-DETAIL                                 05020031
               MOVE PV-PROMO-NF             TO REPORT-NOTES             05030031
               MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY          05040031
               PERFORM 9999-WRITE-ERROR-REPORT                          05050031
               MOVE PM704-ADHOC-STR-GP-RECORD TO ERROR-RECORD           05060031
               PERFORM 9999-WRITE-ERROR-RECORD                          05070031
               PERFORM 9999-READ-PROMO-EXTRACT                          05080031
P11215      END-IF                                                      05090031
           END-IF.                                                      05100031
                                                                        05110031
           IF  PS-NOT-EOF-DOMAIN                                        05120031
               INITIALIZE REPORT-DETAIL                                 05130031
               MOVE PV-DOMAIN-NF             TO REPORT-NOTES            05140031
               MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY          05150031
               PERFORM 9999-WRITE-ERROR-REPORT                          05160031
               MOVE XS023-ADHOC-STR-GP-RECORD TO ERROR-RECORD           05170031
               PERFORM 9999-WRITE-ERROR-RECORD                          05180031
               PERFORM 9999-READ-DOMAIN-EXTRACT                         05190031
           END-IF.                                                      05200031
                                                                        05210031
056900 3000-EXIT.                                                       05220031
057000     EXIT.                                                        05230031
                                                                        05240031
       EJECT.                                                           05250031
059800*----------------------------------------------------------       05260031
059900* 9999-WRAPUP.                                                    05270031
059910*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           05280031
059920*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           05290031
059930*     PROGRAM.                                                    05300031
060000*----------------------------------------------------------       05310031
060100 9999-WRAPUP.                                                     05320031
026600     CLOSE PROMO-EXTRACT-FILE                                     05330031
026600           DOMAIN-EXTRACT-FILE                                    05340031
026600           ERROR-FILE                                             05350031
026600           REPORT-FILE.                                           05360031
                                                                        05370031
           IF  PC-ERROR-RECORD-WRITTEN > 0                              05380031
               MOVE 04               TO RETURN-CODE                     05390031
           END-IF.                                                      05400031
                                                                        05410031
                                                                        05420031
060500                                                                  05430031
060710*9999-EXIT.                                                       05440031
060800 EJECT.                                                           05450031
      ***************************************************************** 05460031
      **FORMAT ERROR-RECORD                                             05470031
      ***************************************************************** 05480031
       9999-FORMAT-ERROR-RECORD.                                        05490031
           MOVE PM704-ADHOC-STR-GP-RECORD TO ERROR-RECORD.              05500031
                                                                        05510031
       EJECT.                                                           05520031
      ***************************************************************** 05530031
      **READ PROMO  EXTRACT FILE                                        05540031
      ***************************************************************** 05550031
       9999-READ-PROMO-EXTRACT.                                         05560031
           IF  PS-NOT-EOF-PROMO                                         05570031
               READ PROMO-EXTRACT-FILE INTO PM704-ADHOC-STR-GP-RECORD   05580031
                    AT END                                              05590031
                       SET PS-EOF-PROMO TO TRUE                         05600031
               END-READ                                                 05610031
           END-IF.                                                      05620031
                                                                        05630031
           IF  PS-NOT-EOF-PROMO                                         05640031
               ADD +1                     TO PC-PROMO-EXTRACT-RECS-READ 05650031
               MOVE PM704-ADHC-STR-GP-ID  TO PV-PM-ADHC-STR-GP-ID       05660031
           END-IF.                                                      05670031
                                                                        05680031
       EJECT.                                                           05690031
      ***************************************************************** 05700031
      **READ XS EXTRACT FILE                                            05710031
      ***************************************************************** 05720031
       9999-READ-DOMAIN-EXTRACT.                                        05730031
           IF  PS-NOT-EOF-DOMAIN                                        05740031
               READ DOMAIN-EXTRACT-FILE INTO XS023-ADHOC-STR-GP-RECORD  05750031
                    AT END                                              05760031
                       SET PS-EOF-DOMAIN TO TRUE                        05770031
               END-READ                                                 05780031
           END-IF.                                                      05790031
                                                                        05800031
           IF  PS-NOT-EOF-DOMAIN                                        05810031
               ADD +1              TO PC-DOMAIN-EXTRACT-RECS-READ       05820031
               MOVE XS023-ADHC-STR-GP-ID  TO PV-XS-ADHC-STR-GP-ID       05830031
           END-IF.                                                      05840031
                                                                        05850031
       EJECT.                                                           05860031
      ***************************************************************** 05870031
      **READ CONTROL CARD FOR FREQUENCY OF COMPARE                      05880031
      ***************************************************************** 05890031
       9999-READ-CONTROL-CARD.                                          05900031
                                                                        05910031
           READ CONTROL-CARD INTO CONTROL-CARD-LAYOUT.                  05920031
                                                                        05930031
       EJECT.                                                           05940031
      ***************************************************************** 05950031
      **WRITE ERROR RECORD                                              05960031
      ***************************************************************** 05970031
       9999-WRITE-ERROR-RECORD.                                         05980031
                                                                        05990031
           WRITE DIFFERENCES-RECORD FROM ERROR-RECORD.                  06000031
                                                                        06010031
           ADD +1                       TO PC-ERROR-RECORD-WRITTEN.     06020031
                                                                        06030031
       EJECT.                                                           06040031
      ***************************************************************** 06050031
      **WRITE ERROR REPORT                                              06060031
      ***************************************************************** 06070031
       9999-WRITE-ERROR-REPORT.                                         06080031
           IF PC-ERROR-REPORT-WRITTEN > 66                              06090031
              PERFORM 9999-PRINT-HEADINGS                               06100031
           ELSE                                                         06110031
              WRITE REPORT-RECORD FROM REPORT-DETAIL                    06120031
              INITIALIZE REPORT-DETAIL                                  06130031
              ADD +1 TO PC-ERROR-REPORT-WRITTEN                         06140031
           END-IF.                                                      06150031
       EJECT.                                                           06160031
      ***************************************************************** 06170031
      **PRINT HEADINGS                                                  06180031
      ***************************************************************** 06190031
       9999-PRINT-HEADINGS.                                             06200031
           ADD 1 TO PC-PAGE-CNT.                                        06210031
           MOVE PC-PAGE-CNT TO DP132O-PAGE-NUMBER.                      06220031
           MOVE ZEROS TO PC-ERROR-REPORT-WRITTEN.                       06230031
                                                                        06240031
491700     WRITE REPORT-RECORD                                          06250031
491800         FROM DP132O-STANDRD-HEADER-132-COLS                      06260031
491900         AFTER ADVANCING PAGE.                                    06270031
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     06280031
                                                                        06290031
491700     WRITE REPORT-RECORD                                          06300031
491800         FROM DR-HEAD2                                            06310031
491900         AFTER ADVANCING 1 LINE.                                  06320031
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     06330031
                                                                        06340031
491700     WRITE REPORT-RECORD                                          06350031
491800         FROM DR-HEAD3                                            06360031
491900         AFTER ADVANCING 2 LINE.                                  06370031
           ADD +2                       TO PC-ERROR-REPORT-WRITTEN.     06380031
                                                                        06390031
491700     WRITE REPORT-RECORD                                          06400031
491800         FROM DR-HEAD5                                            06410031
491900         AFTER ADVANCING 1 LINE.                                  06420031
                                                                        06430031
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     06440031
                                                                        06450031
       EJECT.                                                           06460031
