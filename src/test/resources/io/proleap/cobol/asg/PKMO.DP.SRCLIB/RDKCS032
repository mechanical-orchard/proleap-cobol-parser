000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RDKCS032.                                         00020000
000300 AUTHOR.        SCOTT BARTELT                                     00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  02-09-98.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700*---------------------------------------------------------*       00070000
000800* U032 - KOHL'S STORED VALUE CARD MAINTENANCE             *       00080000
000900*                                                         *       00090000
001000* THIS PROGRAM WILL BE USED TO CHANGE THE CARD STATUS     *       00100000
001100* AND/OR THE STORE ASSIGNED TO KOHL'S STORED VALUE CARDS. *       00110000
001200*                                                         *       00120000
001300* ON INITIAL ENTRY THE PROGRAM FILLS IN SOME MAP FIELDS   *       00130000
001400*    1.) THE FOLLOWING FIELD VALUES ARE FILLED IN:        *       00140000
001500*       A.) CARD I.D.                                     *       00150000
001600*       B.) CARD TYPE                                     *       00160000
001700*       C.) CARD STOCK TYPE                               *       00170000
001800*       D.) CONTROL NUMBER RANGE                          *       00180000
001900*       E.) CURRENT CARD STATUS CODE AND DESCRIPTION      *       00190000
002000*       F.) CURRENT STORE CODE AND DESCRIPTION            *       00200000
002100*                                                         *       00210000
002200* THE USER MAY NOW REQUEST TO CHANGE EITHER THE CARD      *       00220000
002300* STATUS OR THE STORE ASSIGNED TO THE CARDS.              *       00230000
002400*                                                         *       00240000
002500* WHEN A CHANGE IS REQUESTED A VARIETY OF EDITS ARE       *       00250000
002600* PERFORMED.  IF ANY OF THE EDITS FAIL, A MESSAGE IS      *       00260000
002700* DELIVERED INDICATING THE PROBLEM.  THE USER MUST THEN   *       00270000
002800* CORRECT THE PROBLEM IN ORDER TO CONTINUE.               *       00280000
002900*                                                         *       00290000
003000* AFTER ALL EDITS ARE SATISFIED, THE SVT_KOHLS_CRD_ACCT   *       00300000
003100* TABLE IS                                                *       00310000
003200* UPDATED PER THE REQUEST USING THE ENTERED FIELD VALUES. *       00320000
003300* ALSO, THE SVT_CRD_ACCT_CMMT TABLE IS UPDATED WITH COMMENT(S) *  00330000
003400* PERTAINING TO THE CHANGE.                               *       00340000
003500*                                                         *       00350000
003600* PLEASE NOTE, SOME EDITS ARE DEPENDENT ON OTHERS SO      *       00360000
003700* SWITCHING THE ORDER OF THE EDITS CAN HAVE AN IMPACT.    *       00370000
003800*---------------------------------------------------------*       00380000
003810* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00381001
003820*            - CHANGE CALL OF DPKUT100 TO                       * 00382001
003830*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00383001
003840*              MAKING THE CALL DYNAMIC VS STATIC                * 00384001
003850*                                                               * 00385001
003860*---------------------------------------------------------------* 00386001
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293         00387002
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00388002
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00389002
CICS  ******************************************************************00389102
003900                                                                  00390000
004000 ENVIRONMENT DIVISION.                                            00400000
004100                                                                  00410000
004200 DATA DIVISION.                                                   00420000
004300                                                                  00430000
004400 WORKING-STORAGE SECTION.                                         00440000
004500                                                                  00450000
004600*---------------------------------------------------------*       00460000
004700* VARIABLES USED IN THE SQL CALLS                         *       00470000
004800*---------------------------------------------------------*       00480000
004900 01  DK-DB2-KEYS.                                                 00490000
005000     05  DF-CNTL-NBR-FROM99      PIC  9(14).                      00500000
005100     05  DF-CONTROL-NBR-FROM9 REDEFINES DF-CNTL-NBR-FROM99.       00510000
005200         10  DF-CRD-PROD-YR9     PIC  9(04).                      00520000
005300         10  DF-CRD-PROD-YR9-R REDEFINES DF-CRD-PROD-YR9.         00530000
005400             15  DF-CRD-PROD-YR9-CC PIC 99.                       00540000
005500             15  DF-CRD-PROD-YR9-YY PIC 99.                       00550000
005600         10  DF-SHIPT-REQ-NBR9   PIC  9(04).                      00560000
005700         10  DF-CNTL-NBR-FROM9   PIC  9(06).                      00570000
005800     05  DF-CONTROL-NBR-FROM.                                     00580000
005900         10  DF-CRD-PROD-YR      PIC S9(04)V COMP.                00590000
006000         10  DF-SHIPT-REQ-NBR    PIC S9(04)V COMP.                00600000
006100         10  DF-CNTL-NBR-FROM    PIC S9(09)V COMP.                00610000
006200     05  DT-CNTL-NBR-TO99        PIC  9(14).                      00620000
006300     05  DT-CONTROL-NBR-TO9 REDEFINES DT-CNTL-NBR-TO99.           00630000
006400         10  DT-CRD-PROD-YR9     PIC  9(04).                      00640000
006500         10  DT-CRD-PROD-YR9-R REDEFINES DT-CRD-PROD-YR9.         00650000
006600             15  DT-CRD-PROD-YR9-CC PIC 99.                       00660000
006700             15  DT-CRD-PROD-YR9-YY PIC 99.                       00670000
006800         10  DT-SHIPT-REQ-NBR9   PIC  9(04).                      00680000
006900         10  DT-CNTL-NBR-TO9     PIC  9(06).                      00690000
007000     05  DT-CONTROL-NBR-TO.                                       00700000
007100         10  DT-CRD-PROD-YR      PIC S9(04)V COMP.                00710000
007200         10  DT-SHIPT-REQ-NBR    PIC S9(04)V COMP.                00720000
007300         10  DT-CNTL-NBR-TO      PIC S9(09)V COMP.                00730000
007400   05  DK-STORE-NUMBER              PIC S9(04) COMP               00740000
007500                                               VALUE ZERO.        00750000
007600   05  DK-CRD-ID                    PIC S9(12)V VALUE ZEROS       00760000
007700                                               COMP-3.            00770000
007800                                                                  00780000
007900*---------------------------------------------------------*       00790000
008000* PC-PROGRAM CONSTANTS                                    *       00800000
008100*---------------------------------------------------------*       00810000
008200 01  PC-PROGRAM-CONSTANTS.                                        00820000
008300   05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE              00830000
008400        'RDKCS032'.                                               00840000
008500   05  PC-CURRENT-MAP-NAME          PIC  X(08) VALUE              00850000
008600        'RD032A  '.                                               00860000
008700   05  PC-CURRENT-MAPSET-NAME       PIC  X(08) VALUE              00870000
008800        'RDKM032 '.                                               00880000
008900   05  PC-MAINTENANCE-AUTH          PIC  X(08) VALUE              00890000
009000        'RDMAINT'.                                                00900000
009100   05  PC-MULTIPLE                  PIC  X(10) VALUE              00910000
009200        'MULTIPLE  '.                                             00920000
009300   05  PC-MULTIPLE-STORES           PIC  X(10) VALUE              00930000
009400        'MUL STORES'.                                             00940000
009500   05  PC-MULTIPLE-STATUS           PIC  X(10) VALUE              00950000
009600        'MUL STATUS'.                                             00960000
009700   05  PC-UNKNOWN                   PIC  X(10) VALUE              00970000
009800        'UNKNOWN   '.                                             00980000
009900   05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3          00990000
010000                                               COMP.              01000000
010100                                                                  01010000
010200   05  PC-INTER-APPL-CODES.                                       01020000
010300     10  PC-INT-APPL-RDKCS021       PIC  X(01) VALUE '7'.         01030000
010400     10  PC-INT-APPL-RDKCS022-RDSKMCL                             01040000
010500                                    PIC  X(01) VALUE '6'.         01050000
010600     10  PC-INT-APPL-RDKCS022-RDSKMCA                             01060000
010700                                    PIC  X(01) VALUE '8'.         01070000
010800                                                                  01080000
010900   05  PC-STORE-TYPE-CODES.                                       01090000
011000     10  PC-HQ                      PIC  X(02) VALUE 'HQ'.        01100000
011100     10  PC-DS                      PIC  X(02) VALUE 'DS'.        01110000
011200                                                                  01120000
011300   05  PC-TSYMSG-NUMBERS.                                         01130000
011400     10  PC-TSYMSG-00005            PIC  9(05) VALUE              01140000
011500                                               00005.             01150000
011600     10  PC-TSYMSG-00007            PIC  9(05) VALUE              01160000
011700                                               00007.             01170000
011800     10  PC-TSYMSG-00008            PIC  9(05) VALUE              01180000
011900                                               00008.             01190000
012000     10  PC-TSYMSG-00017            PIC  9(05) VALUE              01200000
012100                                               00017.             01210000
012200     10  PC-TSYMSG-00059            PIC  9(05) VALUE              01220000
012300                                               00059.             01230000
012400     10  PC-TSYMSG-00148            PIC  9(05) VALUE              01240000
012500                                               00148.             01250000
012600     10  PC-TSYMSG-00233            PIC  9(05) VALUE              01260000
012700                                               00233.             01270000
012800     10  PC-TSYMSG-00342            PIC  9(05) VALUE              01280000
012900                                               00342.             01290000
013000     10  PC-TSYMSG-01210            PIC  9(05) VALUE              01300000
013100                                               01210.             01310000
013200     10  PC-TSYMSG-01263            PIC  9(05) VALUE              01320000
013300                                               01263.             01330000
013400     10  PC-TSYMSG-01686            PIC  9(05) VALUE              01340000
013500                                               01686.             01350000
013600     10  PC-TSYMSG-01687            PIC  9(05) VALUE              01360000
013700                                               01687.             01370000
013800     10  PC-TSYMSG-01688            PIC  9(05) VALUE              01380000
013900                                               01688.             01390000
014000     10  PC-TSYMSG-01690            PIC  9(05) VALUE              01400000
014100                                               01690.             01410000
014200     10  PC-TSYMSG-01691            PIC  9(05) VALUE              01420000
014300                                               01691.             01430000
014400     10  PC-TSYMSG-99910            PIC  9(05) VALUE              01440000
014500                                               99910.             01450000
014600                                                                  01460000
014700*---------------------------------------------------------*       01470000
014800* PS-PROGRAM SWITCHES                                     *       01480000
014900*---------------------------------------------------------*       01490000
015000 01  PS-PROGRAM-SWITCHES.                                         01500000
015100   05  PS-ERROR-SW                  PIC  X(01) VALUE 'N'.         01510000
015200     88  PS-ERROR                              VALUE 'Y'.         01520000
015300     88  PS-NO-ERROR                           VALUE 'N'.         01530000
015400   05  PS-SVT-CRD-PROD-FOUND-SW     PIC  X(01) VALUE 'N'.         01540000
015500     88  PS-SVT-CRD-PROD-FOUND                 VALUE 'Y'.         01550000
015600     88  PS-NO-SVT-CRD-PROD-FOUND              VALUE 'N'.         01560000
015700   05  PS-LOCATION-FOUND-SW         PIC  X(01) VALUE 'N'.         01570000
015800     88  PS-LOCATION-FOUND                     VALUE 'Y'.         01580000
015900     88  PS-NO-LOCATION-FOUND                  VALUE 'N'.         01590000
016000   05  PS-FIRST-FETCH-SW            PIC  X(01) VALUE 'Y'.         01600000
016100     88  PS-FIRST-FETCH                        VALUE 'Y'.         01610000
016200     88  PS-NOT-FIRST-FETCH                    VALUE 'N'.         01620000
016300   05  PS-CRD-STATUS-FOUND-SW       PIC  X(01) VALUE 'N'.         01630000
016400     88  PS-CRD-STATUS-FOUND                   VALUE 'Y'.         01640000
016500     88  PS-NO-CRD-STATUS-FOUND                VALUE 'N'.         01650000
016600   05  PS-FIELD-VALUE-FOUND-SW      PIC  X(01) VALUE 'N'.         01660000
016700     88  PS-FIELD-VALUE-FOUND                  VALUE 'Y'.         01670000
016800     88  PS-NO-FIELD-VALUE-FOUND               VALUE 'N'.         01680000
016900   05  PS-ACTIVITY-FOUND-SW         PIC  X(01) VALUE 'N'.         01690000
017000     88  PS-ACTIVITY-FOUND                     VALUE 'Y'.         01700000
017100     88  PS-NO-ACTIVITY-FOUND                  VALUE 'N'.         01710000
017200   05  PS-ALLOWABLE-STATUS-FOUND-SW PIC  X(01) VALUE 'N'.         01720000
017300     88  PS-ALLOWABLE-STATUS-FOUND             VALUE 'Y'.         01730000
017400     88  PS-NO-ALLOWABLE-STATUS-FOUND          VALUE 'N'.         01740000
017500   05  PS-EDIT-COMMAREA-TYPE-SW     PIC  X(01) VALUE 'N'.         01750000
017600     88  PS-UPD-FUNCT-COMMAREA-CHK             VALUE 'Y'.         01760000
017700     88  PS-NON-UPD-FUNCT-COMMAREA-CHK         VALUE 'N'.         01770000
017800   05  PS-EDIT-AND-SELECT-PROC      PIC  X(02) VALUE '00'.        01780000
017900     88  PS-EDIT-FOR-ACTIVITY                  VALUE '01'.        01790000
018000     88  PS-EDIT-COMMENTS                      VALUE '02'.        01800000
018100     88  PS-EDIT-NEW-STORE                     VALUE '03'.        01810000
018200     88  PS-SEARCH-NEW-CRD-STAT-DESC           VALUE '04'.        01820000
018300     88  PS-EDIT-STATUS-FOR-STR                VALUE '05'.        01830000
018400     88  PS-EDIT-FOR-DUP-STR-ENTERED           VALUE '06'.        01840000
018500     88  PS-EDIT-FOR-ENTERED-NEW-STR           VALUE '07'.        01850000
018600     88  PS-EDIT-FOR-ENTERED-NEW-STAT          VALUE '08'.        01860000
018700     88  PS-EDIT-STR-CLOSE-AND-TYPE            VALUE '09'.        01870000
018800     88  PS-SELECT-CURRENT-TIMESTAMP           VALUE '10'.        01880000
018900     88  PS-ALLOWABLE-FROM-TO-STATUS           VALUE '11'.        01890000
019000     88  PS-EDIT-FOR-DIFFERENT-STORES          VALUE '12'.        01900000
019100     88  PS-EDIT-FOR-DIFFERENT-STATUS          VALUE '13'.        01910000
019200                                                                  01920000
019300*---------------------------------------------------------*       01930000
019400* RESPROGRAM VARIABLES                                    *       01940000
019500*---------------------------------------------------------*       01950000
019600 01  PV-PROGRAM-VARIABLES.                                        01960000
019800   05  PV-CICS-RESPONSE             PIC S9(04) VALUE +0           01980000
019900                                               COMP SYNC.         01990000
020000   05  PV-CRD-STAT-CDE-HOLD         PIC  X(02) VALUE SPACES.      02000000
020100   05  PV-CRD-STR-NBR-HOLD          PIC  9(04) VALUE ZEROES.      02010000
020200   05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0           02020000
020300                                               COMP SYNC.         02030000
020400   05  PV-SEARCH-STATUS-CDE         PIC  X(02) VALUE SPACES.      02040000
020500   05  PV-SEARCH-STATUS-DESC        PIC  X(10) VALUE SPACES.      02050000
020600                                                                  02060000
020700   05  PV-CURRENT-TIMESTAMP         PIC  X(26) VALUE SPACES.      02070000
020800                                                                  02080000
020900   05  PV-TIMESTAMP.                                              02090000
021000     10  PV-CURRENT-DATE          PIC X(10).                      02100000
021100     10  FILLER                   PIC X.                          02110000
021200     10  PV-CURRENT-TIME          PIC X(15).                      02120000
021300     10  FILLER REDEFINES PV-CURRENT-TIME.                        02130000
021400         15  PV-TIME              PIC X(08).                      02140000
021500         15  PV-FRACT-SEC         PIC X(07).                      02150000
021600                                                                  02160000
021700*---------------------------------------------------------*       02170000
021800*    MAP LAYOUT                                           *       02180000
021900*---------------------------------------------------------*       02190000
022000     COPY RDKM032.                                                02200000
022100                                                                  02210000
022200*---------------------------------------------------------*       02220000
022300*    ATTRIBUTE SETTINGS COPYBOOK.                         *       02230000
022400*---------------------------------------------------------*       02240000
022500     COPY DPWS015.                                                02250000
022600                                                                  02260000
022700*---------------------------------------------------------*       02270000
022800* WORK AREA FOR THE CICSAUTH SUBROUTINE                   *       02280000
022900*---------------------------------------------------------*       02290000
023000     COPY DPWS008.                                                02300000
023100                                                                  02310000
023200***************************************************************** 02320000
023300** WORKING STORAGE FOR CONVERSION TO CARD NUMBER                  02330000
023400***************************************************************** 02340000
023500     COPY SVWS007.                                                02350000
023600*---------------------------------------------------------*       02360000
023700*    KOHLS STORED VALUE CARD CONSTANTS                   *        02370000
023800*---------------------------------------------------------*       02380000
023900     COPY SVWS004.                                                02390000
024000                                                                  02400000
024100*---------------------------------------------------------*       02410000
024200*    FUNCTION KEYS COPYBOOK                               *       02420000
024300*---------------------------------------------------------*       02430000
024400     COPY DPWS016.                                                02440000
024500                                                                  02450000
024600*---------------------------------------------------------*       02460000
024700* THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC    *       02470000
024800* EDIT SUB-ROUTINE (DPKUT100).                            *       02480000
024900*---------------------------------------------------------*       02490000
025000     COPY DPWS010I.                                               02500000
025100                                                                  02510000
025200*---------------------------------------------------------*       02520000
025300* THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS       *       02530000
025400* ARCHITECTURAPPLICATION PROGRAMMING INTERFACE            *       02540000
025500* MODULE.                                                 *       02550002
025600*---------------------------------------------------------*       02560000
025700     COPY DPWS030.                                                02570000
CICS       COPY DPWS930.                                                02571002
025800                                                                  02580000
025900*---------------------------------------------------------*       02590000
026000*    STANDARD COMMAREA.                                   *       02600000
026100*---------------------------------------------------------*       02610000
026200     COPY DPWS020.                                                02620000
026300   05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                  02630000
026400                                                                  02640000
026500*---------------------------------------------------------*       02650000
026600*    INTER-APPLICATION COMMAREA.                          *       02660000
026700*---------------------------------------------------------*       02670000
026800     10  INTER-APPL-COMM-AREA       PIC X(200).                   02680000
026900     COPY RDWS030.                                                02690000
027000                                                                  02700000
027100*---------------------------------------------------------*       02710000
027200*    SPECIFIC COMMMAREA FOR RDKCS032.                     *       02720000
027300*---------------------------------------------------------*       02730000
027400     10  ASC-SPECIFIC-COMMAREA.                                   02740000
027600       15  ASC-CRD-ID               PIC  X(12).                   02760000
027700       15  ASC-CRD-TYPE             PIC  X(10).                   02770000
027800       15  ASC-CRD-STK-TYP-ID       PIC  X(08).                   02780000
027900       15  ASC-FROM-CNTL-NUMBER     PIC S9(14) COMP-3.            02790000
028000       15  ASC-TO-CNTL-NUMBER       PIC S9(14) COMP-3.            02800000
028100       15  ASC-CUR-STORE-CDE        PIC  9(04).                   02810000
028200       15  ASC-CUR-STATUS-CDE       PIC  X(02).                   02820000
028300       15  ASC-CUR-STORE-DESC       PIC  X(10).                   02830000
028400       15  ASC-CUR-STATUS-DESC      PIC  X(10).                   02840000
028500       15  ASC-DIFFERENT-STATUS-SW  PIC  X(01).                   02850000
028600         88  ASC-DIFFERENT-STATUS              VALUE 'Y'.         02860000
028700         88  ASC-NO-DIFFERENT-STATUS           VALUE 'N'.         02870000
028800       15  ASC-DIFFERENT-STORES-SW  PIC  X(01).                   02880000
028900         88  ASC-DIFFERENT-STORES              VALUE 'Y'.         02890000
029000         88  ASC-NO-DIFFERENT-STORES           VALUE 'N'.         02900000
029100       15  ASC-SPECIFIC-NEW-OUT-COMMAREA.                         02910000
029200         20  ASC-NEW-STORE-CDE      PIC  X(04).                   02920000
029300         20  ASC-NEW-STORE-CDE-NUM REDEFINES                      02930000
029400               ASC-NEW-STORE-CDE    PIC  9(04).                   02940000
029500         20  ASC-NEW-STATUS-CDE     PIC  X(02).                   02950000
029600         20  ASC-NEW-STORE-DESC     PIC  X(10).                   02960000
029700         20  ASC-NEW-STATUS-DESC    PIC  X(10).                   02970000
029800         20  ASC-COMMENT-1          PIC  X(65).                   02980000
029900         20  ASC-COMMENT-2          PIC  X(65).                   02990000
030000     10  FILLER                     PIC  X(2622).                 03000000
030100                                                                  03010000
030200*---------------------------------------------------------*       03020000
030300*    ABEND PROCESSING COPYBOOK.                           *       03030000
030400*---------------------------------------------------------*       03040000
030500     COPY DPWS013.                                                03050000
030600                                                                  03060000
030700***  DB2 AREA FOR SVT_KOHLS_CRD_ACCT                              03070000
030800***  KOHLS STORED VALUE CARD TABLE                                03080000
030900     EXEC SQL                                                     03090000
031000         INCLUDE SVT00001                                         03100000
031100     END-EXEC.                                                    03110000
031200                                                                  03120000
031300***  DB2 AREA FOR SVT_CRD_PROD (RD-KMC CARD CONTROL TABLE)        03130000
031400     EXEC SQL                                                     03140000
031500         INCLUDE SVT00000                                         03150000
031600     END-EXEC.                                                    03160000
031700                                                                  03170000
031800***  DB2 AREA FOR XST_LOC (XS DOMAIN LOCATION TABLE)              03180000
031900     EXEC SQL                                                     03190000
032000         INCLUDE XST00001                                         03200000
032100     END-EXEC.                                                    03210000
032200                                                                  03220000
032300***  DB2 AREA FOR SVT_KOHLS_CRD_TXN (ACTIVITY TABLE)              03230000
032400     EXEC SQL                                                     03240000
032500         INCLUDE SVT00002                                         03250000
032600     END-EXEC.                                                    03260000
032700                                                                  03270000
032800***  DB2 AREA FOR SVT_CRD_ACCT_CMMT (COMMENTS TABLE)              03280000
032900     EXEC SQL                                                     03290000
033000         INCLUDE SVT00003                                         03300000
033100     END-EXEC.                                                    03310000
033200                                                                  03320000
033300*---------------------------------------------------------*       03330000
033400* CURSOR TO ACCESS CARDS WITHIN THE GIVEN CONTROL NUMBER  *       03340000
033500* RANGE.                                                  *       03350000
033600*---------------------------------------------------------*       03360000
033700     EXEC SQL                                                     03370000
033800         DECLARE SVT-CRD-ACCT-CSR CURSOR FOR                      03380000
033900             SELECT CRD_NBR                                       03390000
034000                   ,CRD_STAT_CDE                                  03400000
034100                   ,STR_NBR                                       03410000
034200             FROM SVT_KOHLS_CRD_ACCT                              03420000
034300             WHERE                                                03430000
034400                CRD_PROD_YR    = :DF-CRD-PROD-YR    AND           03440000
034500                SHIPT_REQ_NBR  = :DF-SHIPT-REQ-NBR  AND           03450000
034600               (CNTL_NBR BETWEEN :DF-CNTL-NBR-FROM                03460000
034700                             AND :DT-CNTL-NBR-TO)                 03470000
034710             WITH UR                                              03471000
034800     END-EXEC.                                                    03480000
034900                                                                  03490000
035000*---------------------------------------------------------*       03500000
035100* CURSOR TO ACCESS CARD ACTIVITY RECORDS.                 *       03510000
035200*---------------------------------------------------------*       03520000
035300     EXEC SQL                                                     03530000
035400         DECLARE SVT_CRD_TXN-CSR CURSOR FOR                       03540000
035500             SELECT A.CRD_NBR                                     03550000
035600             FROM   SVT_KOHLS_CRD_ACCT T                          03560000
035700                   ,SVT_KOHLS_CRD_TXN A                           03570000
035900             WHERE A.CRD_NBR = T.CRD_NBR             AND          03590000
036000              T.CRD_PROD_YR    = :DF-CRD-PROD-YR     AND          03600000
036100              T.SHIPT_REQ_NBR  = :DF-SHIPT-REQ-NBR   AND          03610000
036200               (CNTL_NBR BETWEEN :DF-CNTL-NBR-FROM                03620000
036300                             AND :DT-CNTL-NBR-TO)                 03630000
036310         WITH UR                                                  03631000
036400     END-EXEC.                                                    03640000
036500                                                                  03650000
036600***  DB2 AREA FOR COMMUNICATIONS                                  03660000
036700     EXEC SQL                                                     03670000
036800          INCLUDE SQLCA                                           03680000
036900     END-EXEC.                                                    03690000
037000                                                                  03700000
037100     COPY SQLCA2.                                                 03710000
037200                                                                  03720000
037300 LINKAGE SECTION.                                                 03730000
037400                                                                  03740000
037500 01  DFHCOMMAREA.                                                 03750000
037600   05  FILLER                   OCCURS  1 TO 4072 TIMES           03760000
037700                                DEPENDING ON EIBCALEN.            03770000
037800     10  FILLER                     PIC X.                        03780000
037900                                                                  03790000
038000*---------------------------------------------------------*       03800000
038100* THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE      *       03810000
038200* PROGRAM.  THE SETUP AND PERFORM OF PARAGRAPH            *       03820000
038300* 0001-CALL-CICS-ARCH-API MUST BE THE FIRST CODE EXECUTED *       03830000
038400* IN THIS PROGRAM.                                        *       03840000
038500*                                                         *       03850000
038600* THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE  *       03860000
038700* THE LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM*       03870000
038800*---------------------------------------------------------*       03880000
038900 PROCEDURE DIVISION.                                              03890000
039000                                                                  03900000
039100 0000-MAIN-MODULE.                                                03910000
039200                                                                  03920000
039300     INITIALIZE DP030-CICS-API-FIELDS.                            03930000
039400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03940000
039500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03950000
039600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME(1).          03960000
039700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03970000
039800     MOVE LENGTH OF RD032AI        TO DP030-MAP-LENGTH(1).        03980000
039900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT(1).      03990000
040000                                                                  04000000
040100     PERFORM 0001-CALL-CICS-ARCH-API.                             04010000
040200                                                                  04020000
040300     PERFORM 1000-CONTROL-PROCESSING                              04030000
040400                                                                  04040000
040500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT(1).      04050000
040600     PERFORM 0001-CALL-CICS-ARCH-API.                             04060000
040700                                                                  04070000
040800*---------------------------------------------------------*       04080000
040900* CALL TO API                                             *       04090000
041000*---------------------------------------------------------*       04100000
041100 0001-CALL-CICS-ARCH-API.                                         04110000
041200                                                                  04120000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04130002
041400                                    DFHCOMMAREA                   04140002
041500                                    DP030-CICS-API-FIELDS         04150002
041600                                    DP020-STANDARD-COMMAREA       04160002
041700                                    RD032AI.                      04170002
041800                                                                  04180000
041900     IF  DP030-RC-CALL-SUCCESSFUL                                 04190000
042000         CONTINUE                                                 04200000
042100     ELSE                                                         04210000
042200         SET DP013-NO-ROLLBACK                                    04220000
042300             DP013-XCTL-DISPLAY-RESTART                           04230000
042400             DP013-CICS-ABEND      TO TRUE                        04240000
042500         MOVE 'BEFORE 0000-MAIN-MODULE'                           04250000
042600                                   TO DP013-PARAGRAPH             04260000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04261002
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04262002
042900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT(3)       04290000
043000         PERFORM DP013-0000-PROCESS-ABEND                         04300000
043100     END-IF.                                                      04310000
043200                                                                  04320000
043300*---------------------------------------------------------*       04330000
043400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE    *       04340000
043500* NEXT COURSE OF ACTION IS FOR THIS TRANSACTION.          *       04350000
043600*---------------------------------------------------------*       04360000
043700 1000-CONTROL-PROCESSING.                                         04370000
043800                                                                  04380000
043900     EVALUATE TRUE                                                04390000
044000         WHEN DP020-NEXT-ACT-INITIAL                              04400000
044100              PERFORM 1100-FIND-OBJECT-KEYS                       04410000
044200                                                                  04420000
044300              IF PS-ERROR                                         04430000
044400                SET DP020-NEXT-ACT-APPL-ERROR TO TRUE             04440000
044500              ELSE                                                04450000
044600                PERFORM 3200-RESET-ATTRIBUTES                     04460000
044700                PERFORM 4000-BUILD-INITIAL-PANEL                  04470000
044800                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              04480000
044900              END-IF                                              04490000
045000                                                                  04500000
045100              IF PS-NO-ERROR                                      04510000
045200                MOVE -1 TO NWSTATL                                04520000
045300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               04530000
045400              END-IF                                              04540000
045500                                                                  04550000
045600         WHEN DP020-NEXT-ACT-READ-MAP                             04560000
045700             PERFORM 3200-RESET-ATTRIBUTES                        04570000
045800                                                                  04580000
045900             IF PS-ERROR                                          04590000
046000               CONTINUE                                           04600000
046100             ELSE                                                 04610000
046200               PERFORM 2000-PROCESS-PANEL                         04620000
046300             END-IF                                               04630000
046400                                                                  04640000
046500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04650000
046600                                                                  04660000
046700             IF PS-NO-ERROR                                       04670000
046800               MOVE -1 TO NWSTATL                                 04680000
046900               SET DP030-SET-CURSOR-APPL-1 TO TRUE                04690000
047000             END-IF                                               04700000
047100                                                                  04710000
047200         WHEN DP020-NEXT-ACT-RETURN                               04720000
047300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04730000
047400             SET PS-NON-UPD-FUNCT-COMMAREA-CHK TO TRUE            04740000
047500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04750000
047600                                                                  04760000
047700         WHEN OTHER                                               04770000
047800             SET DP013-LOGIC-ABEND TO TRUE                        04780000
047900             SET DP013-NO-ROLLBACK TO TRUE                        04790000
048000             MOVE '1000-CONTROL-PROCESSING'                       04800000
048100                                   TO DP013-PARAGRAPH             04810000
048200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04820000
048300                                   TO DP013-MESSAGE-TEXT(1)       04830000
048400             MOVE DP020-NEXT-APPL-ACTIVITY                        04840000
048500                                   TO DP013-MESSAGE-TEXT(2)       04850000
048600             PERFORM DP013-0000-PROCESS-ABEND                     04860000
048700     END-EVALUATE.                                                04870000
048800                                                                  04880000
048900*---------------------------------------------------------*       04890000
049000* DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON  *       04900000
049100* THE INTER-APPLICATION FORMAT CODE.                      *       04910000
049200*---------------------------------------------------------*       04920000
049300 1100-FIND-OBJECT-KEYS.                                           04930000
049400                                                                  04940000
049500     PERFORM 1105-CHECK-AUTHORITY.                                04950000
049600                                                                  04960000
049700     IF PS-NO-ERROR                                               04970000
049800       INITIALIZE ASC-SPECIFIC-COMMAREA                           04980000
049900                                                                  04990000
050000       EVALUATE DP020-INT-APPL-FORMAT-IND                         05000000
050100         WHEN PC-INT-APPL-RDKCS021                                05010000
050200             IF RD030-CARD-NUMBER = ZERO                          05020000
050300                 MOVE PC-MULTIPLE                                 05030000
050400                   TO ASC-CRD-ID                                  05040000
050500             ELSE                                                 05050000
050800                 PERFORM 1170-SETUP-CARD-NBR                      05080000
050900             END-IF                                               05090000
051000                                                                  05100000
051100             IF RD030-FROM-CNTL-NUMBER = ZERO                     05110000
051200              OR RD030-TO-CNTL-NUMBER  = ZERO                     05120000
051300                MOVE PC-TSYMSG-00008                              05130000
051400                  TO DP020-MSG-NUMBER                             05140000
051500                SET PS-ERROR                  TO TRUE             05150000
051600                SET DP020-MSG-FATAL                               05160000
051700                    DP020-NEXT-ACT-APPL-ERROR TO TRUE             05170000
051800             ELSE                                                 05180000
051900                MOVE RD030-FROM-CNTL-NUMBER                       05190000
052000                  TO ASC-FROM-CNTL-NUMBER                         05200000
052100                MOVE RD030-TO-CNTL-NUMBER                         05210000
052200                  TO ASC-TO-CNTL-NUMBER                           05220000
052300             END-IF                                               05230000
052400                                                                  05240000
052500         WHEN PC-INT-APPL-RDKCS022-RDSKMCL                        05250000
052600         WHEN PC-INT-APPL-RDKCS022-RDSKMCA                        05260000
052700             IF RD030-CARD-NUMBER = ZERO                          05270000
052800               MOVE PC-TSYMSG-00008                               05280000
052900                 TO DP020-MSG-NUMBER                              05290000
053000               SET PS-ERROR                  TO TRUE              05300000
053100               SET DP020-MSG-FATAL                                05310000
053200                   DP020-NEXT-ACT-APPL-ERROR TO TRUE              05320000
053500             END-IF                                               05350000
053600                                                                  05360000
053700             IF PS-NO-ERROR                                       05370000
053800               PERFORM 1170-SETUP-CARD-NBR                        05380000
053900               PERFORM 5050-SELECT-CRD-CNTL-NBR                   05390000
054000             END-IF                                               05400000
054100                                                                  05410000
054200         WHEN OTHER                                               05420000
054300             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             05430000
054400             SET PS-ERROR         TO TRUE                         05440000
054500             SET DP020-MSG-FATAL                                  05450000
054600                 DP020-NEXT-ACT-APPL-ERROR TO TRUE                05460000
054700       END-EVALUATE                                               05470000
054800     END-IF.                                                      05480000
054900                                                                  05490000
055000*---------------------------------------------------------*       05500000
055100* CALL CICSAUTH MODULE TO VERIFY USERS' AUTHORITY FOR THE *       05510000
055200* CARD STATUS AND STORE CODE CHANGE.                      *       05520000
055300*---------------------------------------------------------*       05530000
055400 1105-CHECK-AUTHORITY.                                            05540000
055500                                                                  05550000
055600     MOVE PC-MAINTENANCE-AUTH  TO DP008-RESOURCE-NAME.            05560000
055700     SET DP008-RSRC-TYPE-FUNC                                     05570000
055800         DP008-ACCESS-TYPE-USE TO TRUE.                           05580000
055900                                                                  05590000
056000     EXEC CICS                                                    05600000
056100         LINK                                                     05610000
056200           PROGRAM   (DP008-SECURITY-SUBROUTINE)                  05620000
056300           COMMAREA  (DP008-SECURITY-COMMAREA)                    05630000
056400           LENGTH    (DP008-SECURITY-COMMAREA-LENGTH)             05640000
056500           RESP      (PV-CICS-RESPONSE)                           05650000
056600     END-EXEC.                                                    05660000
056700                                                                  05670000
056800     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    05680000
056900*        --- BAD LINK TO SECURITY MODULE ---                      05690000
057000       MOVE PC-TSYMSG-00233      TO DP020-MSG-NUMBER              05700000
057100       SET PS-ERROR                                               05710000
057200           DP020-MSG-FATAL       TO TRUE                          05720000
057300     ELSE                                                         05730000
057400       IF DP008-ACCESS-ALLOWED                                    05740000
057500         CONTINUE                                                 05750000
057600       ELSE                                                       05760000
057700*        --- USER DOES NOT HAVE THE NECESSARY SECURITY ---        05770000
057800         MOVE PC-TSYMSG-99910  TO DP020-MSG-NUMBER                05780000
057900         SET PS-ERROR                                             05790000
058000             DP020-MSG-FATAL   TO TRUE                            05800000
058100       END-IF                                                     05810000
058200     END-IF.                                                      05820000
058300                                                                  05830000
058400*---------------------------------------------------------*       05840000
058500* CONVERT THE INPUT CARD NUMBER TO THE CARD NUMBER ON THE *       05850000
058600* DB2 TABLE                                               *       05860000
058700*---------------------------------------------------------*       05870000
058800 1170-SETUP-CARD-NBR.                                             05880000
058900                                                                  05890000
059000     MOVE RD030-FROM-30-DIGT-CRD-NBR TO SV007-CARD-NUMBER-IN9.    05900000
059100     MOVE 0                        TO SV007-CARD-NUMBER-LENGTH    05910000
059200     SET SV007-FORMAT-IN           TO TRUE                        05920000
059300     PERFORM SV007-FORMAT-CARD                                    05930000
059310     MOVE SV007-CARD-NBR           TO DK-CRD-ID ASC-CRD-ID.       05931000
059400                                                                  05940000
059500*---------------------------------------------------------*       05950000
059600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE *       05960000
059700* DATA ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE   *       05970000
059800* KEYS IS NOT USED, EDIT THE DATA ON THE SCREEN AND GO ON *       05980000
059900* TO CHECK THE REST OF THE FUNCTION KEYS.  NOTE THAT WITH *       05990000
060000* THE API, NO INVALID FUNCTION KEYS CAN GET THIS FAR.     *       06000000
060100*---------------------------------------------------------*       06010000
060200 2000-PROCESS-PANEL.                                              06020000
060300                                                                  06030000
060400     EVALUATE TRUE                                                06040000
060500                                                                  06050000
060600         WHEN DP020-SRC-AID = DP016-CLEAR                         06060000
060700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06070000
060800             SET PS-NON-UPD-FUNCT-COMMAREA-CHK TO TRUE            06080000
060900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06090000
061000                                                                  06100000
061100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     06110000
061200             INITIALIZE ASC-SPECIFIC-NEW-OUT-COMMAREA             06120000
061300             PERFORM 4000-BUILD-INITIAL-PANEL                     06130000
061400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06140000
061500             PERFORM 3200-RESET-ATTRIBUTES                        06150000
061600                                                                  06160000
061700         WHEN OTHER                                               06170000
061800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06180000
061900             SET PS-NON-UPD-FUNCT-COMMAREA-CHK TO TRUE            06190000
062000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06200000
062100             IF PS-NO-ERROR                                       06210000
062200               SET DP030-CONTINUE-GO TO TRUE                      06220000
062300               PERFORM 2100-CHECK-FUNCTION-KEY                    06230000
062400             ELSE                                                 06240000
062500               SET DP030-OVERRIDE-GO TO TRUE                      06250000
062600             END-IF                                               06260000
062700                                                                  06270000
062800     END-EVALUATE.                                                06280000
062900                                                                  06290000
063000*---------------------------------------------------------*       06300000
063100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED*       06310000
063200* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE     *       06320000
063300* RETURNED FROM THE CICS ARCHITECTURE API.                *       06330000
063400*---------------------------------------------------------*       06340000
063500 2100-CHECK-FUNCTION-KEY.                                         06350000
063600                                                                  06360000
063700     EVALUATE TRUE                                                06370000
063800         WHEN DP020-SRC-AID = DP016-ENTER                         06380000
063900             CONTINUE                                             06390000
064000                                                                  06400000
064100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06410000
064200             SET PS-UPD-FUNCT-COMMAREA-CHK TO TRUE                06420000
064300                                                                  06430000
064400             IF PS-NO-ERROR                                       06440000
064500               SET PS-SELECT-CURRENT-TIMESTAMP TO TRUE            06450000
064600               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06460000
064700             END-IF                                               06470000
064800                                                                  06480000
064900             IF PS-NO-ERROR                                       06490000
065000               SET PS-EDIT-FOR-DIFFERENT-STATUS TO TRUE           06500000
065100               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06510000
065200             END-IF                                               06520000
065300                                                                  06530000
065400             IF PS-NO-ERROR                                       06540000
065500               SET PS-EDIT-FOR-ENTERED-NEW-STAT TO TRUE           06550000
065600               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06560000
065700             END-IF                                               06570000
065800                                                                  06580000
065900             IF PS-NO-ERROR                                       06590000
066000               SET PS-SEARCH-NEW-CRD-STAT-DESC TO TRUE            06600000
066100               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06610000
066200             END-IF                                               06620000
066300                                                                  06630000
066400             IF PS-NO-ERROR                                       06640000
066500               SET PS-ALLOWABLE-FROM-TO-STATUS TO TRUE            06650000
066600               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06660000
066700             END-IF                                               06670000
066800                                                                  06680000
066900             IF PS-NO-ERROR                                       06690000
067000               SET PS-EDIT-COMMENTS TO TRUE                       06700000
067100               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06710000
067200             END-IF                                               06720000
067300                                                                  06730000
067400             IF PS-NO-ERROR                                       06740000
067500               SET DP030-CONTINUE-GO TO TRUE                      06750000
067600               PERFORM 6100-UPDATE-CRD-STATUS-CDE                 06760000
067700               PERFORM 6300-UPDATE-ACCT-CMMT-LINES                06770000
067800             END-IF                                               06780000
067900                                                                  06790000
068000         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06800000
068100             SET PS-UPD-FUNCT-COMMAREA-CHK TO TRUE                06810000
068200                                                                  06820000
068300             IF PS-NO-ERROR                                       06830000
068400               SET PS-SELECT-CURRENT-TIMESTAMP TO TRUE            06840000
068500               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06850000
068600             END-IF                                               06860000
068700                                                                  06870000
068800             IF PS-NO-ERROR                                       06880000
068900               SET PS-EDIT-FOR-DIFFERENT-STORES TO TRUE           06890000
069000               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06900000
069100             END-IF                                               06910000
069200                                                                  06920000
069300             IF PS-NO-ERROR                                       06930000
069400               SET PS-EDIT-FOR-ENTERED-NEW-STR TO TRUE            06940000
069500               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 06950000
069600             END-IF                                               06960000
069700                                                                  06970000
069800             IF PS-NO-ERROR                                       06980000
069900               SET PS-EDIT-NEW-STORE TO TRUE                      06990000
070000               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 07000000
070100             END-IF                                               07010000
070200                                                                  07020000
070300             IF PS-NO-ERROR                                       07030000
070400               SET PS-EDIT-STR-CLOSE-AND-TYPE TO TRUE             07040000
070500               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 07050000
070600             END-IF                                               07060000
070700                                                                  07070000
070800             IF PS-NO-ERROR                                       07080000
070900               SET PS-EDIT-FOR-DUP-STR-ENTERED TO TRUE            07090000
071000               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 07100000
071100             END-IF                                               07110000
071200                                                                  07120000
071300             IF PS-NO-ERROR                                       07130000
071400               SET PS-EDIT-STATUS-FOR-STR TO TRUE                 07140000
071500               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 07150000
071600             END-IF                                               07160000
071700                                                                  07170000
071800             IF PS-NO-ERROR                                       07180000
071900               SET PS-EDIT-FOR-ACTIVITY TO TRUE                   07190000
072000               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 07200000
072100             END-IF                                               07210000
072200                                                                  07220000
072300             IF PS-NO-ERROR                                       07230000
072400               SET PS-EDIT-COMMENTS TO TRUE                       07240000
072500               PERFORM 3000-EDIT-DATA-IN-COMMAREA                 07250000
072600             END-IF                                               07260000
072700                                                                  07270000
072800             IF PS-NO-ERROR                                       07280000
072900               PERFORM 6200-UPDATE-CRD-STORE-CDE                  07290000
073000               PERFORM 6300-UPDATE-ACCT-CMMT-LINES                07300000
073100             END-IF                                               07310000
073200                                                                  07320000
073300         WHEN OTHER                                               07330000
073400             SET DP013-NO-ROLLBACK                                07340000
073500                 DP013-XCTL-DISPLAY-RESTART                       07350000
073600                 DP013-CICS-ABEND  TO TRUE                        07360000
073700             MOVE '2100-CHECK-FUNCTION-KEY'                       07370000
073800                                   TO DP013-PARAGRAPH             07380000
073900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07390000
074000                                   TO DP013-MESSAGE-TEXT (1)      07400000
074100             PERFORM DP013-0000-PROCESS-ABEND                     07410000
074200     END-EVALUATE.                                                07420000
074300                                                                  07430000
074400*---------------------------------------------------------*       07440000
074500* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE   *       07450000
074600* FIELDS IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS *       07460000
074700* ARE DONE IN THE APPLICATION-SPECIFIC COMMAREA, NOT ON   *       07470000
074800* THE SCREEN.                                             *       07480000
074900*---------------------------------------------------------*       07490000
075000 2200-MOVE-SCREEN-TO-COMMAREA.                                    07500000
075100                                                                  07510000
075200     IF NWSTATL > ZERO                                            07520000
075300       MOVE NWSTATI TO ASC-NEW-STATUS-CDE                         07530000
075400       MOVE SPACES  TO ASC-NEW-STATUS-DESC                        07540000
075500     ELSE                                                         07550000
075600       IF NWSTATF = DP015-ERASE-EOF                               07560000
075700         MOVE SPACE TO ASC-NEW-STATUS-CDE                         07570000
075800                       ASC-NEW-STATUS-DESC                        07580000
075900       END-IF                                                     07590000
076000     END-IF.                                                      07600000
076100                                                                  07610000
076200     IF NWSTRL > ZERO                                             07620000
076300       MOVE NWSTRI   TO ASC-NEW-STORE-CDE                         07630000
076400       MOVE SPACES   TO ASC-NEW-STORE-DESC                        07640000
076500     ELSE                                                         07650000
076600       IF NWSTRF = DP015-ERASE-EOF                                07660000
076700         MOVE SPACES TO ASC-NEW-STORE-CDE                         07670000
076800                        ASC-NEW-STORE-DESC                        07680000
076900       END-IF                                                     07690000
077000     END-IF.                                                      07700000
077100                                                                  07710000
077200     IF CMNT1L > ZERO                                             07720000
077300       MOVE CMNT1I  TO ASC-COMMENT-1                              07730000
077400     ELSE                                                         07740000
077500       IF CMNT1F = DP015-ERASE-EOF                                07750000
077600         MOVE SPACE TO ASC-COMMENT-1                              07760000
077700       END-IF                                                     07770000
077800     END-IF.                                                      07780000
077900                                                                  07790000
078000     IF CMNT2L > ZERO                                             07800000
078100       MOVE CMNT2I  TO ASC-COMMENT-2                              07810000
078200     ELSE                                                         07820000
078300       IF CMNT2F = DP015-ERASE-EOF                                07830000
078400         MOVE SPACE TO ASC-COMMENT-2                              07840000
078500       END-IF                                                     07850000
078600     END-IF.                                                      07860000
078700                                                                  07870000
078800*---------------------------------------------------------*       07880000
078900* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN *       07890000
079000* ERROR IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD  *       07900000
079100* AND AN APPROPRIATE ERROR MESSAGE IS DISPLAYED.          *       07910000
079200*---------------------------------------------------------*       07920000
079300 3000-EDIT-DATA-IN-COMMAREA.                                      07930000
079400                                                                  07940000
079500       EVALUATE TRUE                                              07950000
079600                                                                  07960000
079700         WHEN PS-UPD-FUNCT-COMMAREA-CHK                           07970000
079800                                                                  07980000
079900             EVALUATE TRUE                                        07990000
080000               WHEN PS-EDIT-FOR-DIFFERENT-STATUS                  08000000
080100                   PERFORM 3005-EDIT-FOR-DIFFERENT-STATUS         08010000
080200                                                                  08020000
080300               WHEN PS-EDIT-FOR-ENTERED-NEW-STAT                  08030000
080400                   PERFORM 3010-EDIT-FOR-ENTERED-NEW-STAT         08040000
080500                                                                  08050000
080600               WHEN PS-SEARCH-NEW-CRD-STAT-DESC                   08060000
080700                   PERFORM 3015-SEARCH-NEW-CRD-STAT-DESC          08070000
080800                                                                  08080000
080900               WHEN PS-EDIT-COMMENTS                              08090000
081000                   PERFORM 3020-EDIT-DATA-IN-COMMENTS             08100000
081100                                                                  08110000
081200               WHEN PS-SELECT-CURRENT-TIMESTAMP                   08120000
081300                   PERFORM 3025-SELECT-CURRENT-TIMESTAMP          08130000
081400                                                                  08140000
081500               WHEN PS-ALLOWABLE-FROM-TO-STATUS                   08150000
081600                   PERFORM 3030-ALLOWABLE-FROM-TO-STATUS          08160000
081700                                                                  08170000
081800               WHEN PS-EDIT-FOR-ACTIVITY                          08180000
081900                   PERFORM 3035-EDIT-FOR-ACTIVITY                 08190000
082000                                                                  08200000
082100               WHEN PS-EDIT-FOR-DIFFERENT-STORES                  08210000
082200                   PERFORM 3040-EDIT-FOR-DIFFERENT-STORES         08220000
082300                                                                  08230000
082400               WHEN PS-EDIT-FOR-ENTERED-NEW-STR                   08240000
082500                   PERFORM 3045-EDIT-FOR-ENTERED-NEW-STR          08250000
082600                                                                  08260000
082700               WHEN PS-EDIT-NEW-STORE                             08270000
082800                   PERFORM 3055-EDIT-NEW-STORE                    08280000
082900                                                                  08290000
083000               WHEN PS-EDIT-STR-CLOSE-AND-TYPE                    08300000
083100                   PERFORM 3060-EDIT-STR-CLOSE-AND-TYPE           08310000
083200                                                                  08320000
083300               WHEN PS-EDIT-FOR-DUP-STR-ENTERED                   08330000
083400                   PERFORM 3065-EDIT-FOR-DUP-STR-ENTERED          08340000
083500                                                                  08350000
083600               WHEN PS-EDIT-STATUS-FOR-STR                        08360000
083700                   PERFORM 3070-EDIT-STATUS-FOR-STR               08370000
083800             END-EVALUATE                                         08380000
083900                                                                  08390000
084000         WHEN PS-NON-UPD-FUNCT-COMMAREA-CHK                       08400000
084100                                                                  08410000
084200             IF ASC-NEW-STATUS-CDE > SPACES                       08420000
084300               PERFORM 3015-SEARCH-NEW-CRD-STAT-DESC              08430000
084400             END-IF                                               08440000
084500                                                                  08450000
084600             IF ASC-NEW-STORE-CDE > SPACES                        08460000
084700               PERFORM 3050-EDIT-NUM-NEW-STORE-CDE                08470000
084800             END-IF                                               08480000
084900                                                                  08490000
085000             IF ASC-NEW-STORE-CDE > SPACES                        08500000
085100              AND (PS-NO-ERROR)                                   08510000
085200                PERFORM 3055-EDIT-NEW-STORE                       08520000
085300             ELSE                                                 08530000
085400                IF ASC-NEW-STORE-CDE > SPACES                     08540000
085500                 AND (PS-ERROR)                                   08550000
085600                   MOVE PC-UNKNOWN TO ASC-NEW-STORE-DESC          08560000
085700                END-IF                                            08570000
085800             END-IF                                               08580000
085900                                                                  08590000
086000       END-EVALUATE.                                              08600000
086100                                                                  08610000
086200*---------------------------------------------------------*       08620000
086300* EDIT TO SEE IF THE CARDS ARE ASSIGNED TO MULTIPLE STATUS*       08630000
086400*---------------------------------------------------------*       08640000
086500 3005-EDIT-FOR-DIFFERENT-STATUS.                                  08650000
086600                                                                  08660000
086700     IF ASC-DIFFERENT-STATUS                                      08670000
086800       SET PS-ERROR                TO TRUE                        08680000
086900       SET DP020-MSG-FATAL         TO TRUE                        08690000
087000       MOVE PC-MULTIPLE-STATUS     TO ASC-CUR-STATUS-DESC         08700000
087100       MOVE PC-TSYMSG-01687        TO DP020-MSG-NUMBER            08710000
087200       MOVE DP015-RED              TO NWSTATC                     08720000
087300                                      NWSTATDC                    08730000
087400       MOVE DP015-REVERSE          TO NWSTATH                     08740000
087500                                      NWSTATDH                    08750000
087600       MOVE -1                     TO NWSTATL                     08760000
087700       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        08770000
087800     END-IF.                                                      08780000
087900                                                                  08790000
088000*---------------------------------------------------------*       08800000
088100* EDIT TO VERIFY A VALUE WAS ENTERED FOR THE NEW STATUS.  *       08810000
088200*---------------------------------------------------------*       08820000
088300 3010-EDIT-FOR-ENTERED-NEW-STAT.                                  08830000
088400                                                                  08840000
088500     IF ASC-NEW-STATUS-CDE = SPACES                               08850000
088600       SET PS-ERROR                TO TRUE                        08860000
088700       SET DP020-MSG-FATAL         TO TRUE                        08870000
088800       MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER            08880000
088900       MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTATA                     08890000
089000       MOVE DP015-RED              TO NWSTATC                     08900000
089100       MOVE DP015-REVERSE          TO NWSTATH                     08910000
089200       MOVE -1                     TO NWSTATL                     08920000
089300       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        08930000
089400     END-IF.                                                      08940000
089500                                                                  08950000
089600*---------------------------------------------------------*       08960000
089700* A LOOK-UP OF THE DESCRIPTION FOR THE NEW CARD STATUS    *       08970000
089800* CODE.                                                   *       08980000
089900*---------------------------------------------------------*       08990000
090000 3015-SEARCH-NEW-CRD-STAT-DESC.                                   09000000
090100                                                                  09010000
090200     MOVE ASC-NEW-STATUS-CDE TO PV-SEARCH-STATUS-CDE              09020000
090300                                                                  09030000
090400     PERFORM 5030-SEARCH-CARD-STATUS.                             09040000
090500                                                                  09050000
090600     IF PS-NO-CRD-STATUS-FOUND                                    09060000
090700       SET PS-ERROR                TO TRUE                        09070000
090800       SET DP020-MSG-FATAL         TO TRUE                        09080000
090900       MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER            09090000
091000       MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTATA                     09100000
091100       MOVE DP015-RED              TO NWSTATC                     09110000
091200       MOVE DP015-REVERSE          TO NWSTATH                     09120000
091300       MOVE -1                     TO NWSTATL                     09130000
091400       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        09140000
091500     END-IF.                                                      09150000
091600                                                                  09160000
091700     MOVE PV-SEARCH-STATUS-DESC TO ASC-NEW-STATUS-DESC.           09170000
091800                                                                  09180000
091900*---------------------------------------------------------*       09190000
092000* EDIT TO VERIFY COMMENTS ARE ENTERED                     *       09200000
092100*---------------------------------------------------------*       09210000
092200 3020-EDIT-DATA-IN-COMMENTS.                                      09220000
092300                                                                  09230000
092400     SET PS-NO-FIELD-VALUE-FOUND TO TRUE.                         09240000
092500                                                                  09250000
092600     IF ASC-COMMENT-1 NOT = SPACES                                09260000
092700       SET PS-FIELD-VALUE-FOUND TO TRUE                           09270000
092800     END-IF.                                                      09280000
092900                                                                  09290000
093000     IF ASC-COMMENT-2 NOT = SPACES                                09300000
093100      AND PS-NO-FIELD-VALUE-FOUND                                 09310000
093200        SET PS-FIELD-VALUE-FOUND TO TRUE                          09320000
093300        MOVE ASC-COMMENT-2 TO ASC-COMMENT-1                       09330000
093400        MOVE SPACES TO ASC-COMMENT-2                              09340000
093500     END-IF.                                                      09350000
093600                                                                  09360000
093700     IF PS-NO-FIELD-VALUE-FOUND                                   09370000
093800       SET PS-ERROR                TO TRUE                        09380000
093900       SET DP020-MSG-FATAL         TO TRUE                        09390000
094000       MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER            09400000
094100       MOVE DP015-UNP-ALP-BRT-OFF  TO CMNT1A                      09410000
094200                                      CMNT2A                      09420000
094300       MOVE DP015-RED              TO CMNT1C                      09430000
094400                                      CMNT2C                      09440000
094500       MOVE DP015-UNDERLINE        TO CMNT1H                      09450000
094600                                      CMNT2H                      09460000
094700       MOVE -1                     TO CMNT1L                      09470000
094800       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        09480000
094900     END-IF.                                                      09490000
095000                                                                  09500000
095100*---------------------------------------------------------*       09510000
095200* RETRIEVE THE CURRENT TIMESTAMP                          *       09520000
095300*---------------------------------------------------------*       09530000
095400 3025-SELECT-CURRENT-TIMESTAMP.                                   09540000
095500                                                                  09550000
095600     EXEC SQL                                                     09560000
095700         SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            09570000
095800     END-EXEC.                                                    09580000
095900                                                                  09590000
096000     EVALUATE TRUE                                                09600000
096100       WHEN SQLCODE = +0                                          09610000
096200           CONTINUE                                               09620000
096300       WHEN OTHER                                                 09630000
096400           MOVE '3025-SELECT-CURRENT-TIMESTAMP'                   09640000
096500             TO DP013-PARAGRAPH                                   09650000
096600           MOVE 'RETRIEVING CURRENT TIMESTAMP'                    09660000
096700             TO DP013-MESSAGE-TEXT(1)                             09670000
096800           MOVE SQLCA                                             09680000
096900             TO DP013-SQLCA                                       09690000
097000           SET DP013-DB2-ABEND                                    09700000
097100               DP013-XCTL-DISPLAY-RESTART TO TRUE                 09710000
097200           PERFORM DP013-0000-PROCESS-ABEND                       09720000
097300     END-EVALUATE.                                                09730000
097400                                                                  09740000
097500     MOVE PV-CURRENT-TIMESTAMP  TO  PV-TIMESTAMP.                 09750000
097600                                                                  09760000
097700*---------------------------------------------------------*       09770000
097800* EDIT TO VERIFY THE CURRENT CARD STATUS IS ALLOWED TO    *       09780000
097900* BE CHANGED TO THE NEW CARD STATUS ENTERED BY THE USER.  *       09790000
098000*---------------------------------------------------------*       09800000
098100 3030-ALLOWABLE-FROM-TO-STATUS.                                   09810000
098200                                                                  09820000
098300     SET PS-NO-ALLOWABLE-STATUS-FOUND TO TRUE.                    09830000
098400                                                                  09840000
098500     EVALUATE TRUE                                                09850000
098600                                                                  09860000
098700       WHEN ASC-CUR-STATUS-CDE =                                  09870000
098800               SV004-CRD-STAT-TYP-AVAILABLE                       09880000
098900          IF ((ASC-NEW-STATUS-CDE =                               09890000
099000                  SV004-CRD-STAT-TYP-CANCELLED)                   09900000
099100           OR (ASC-NEW-STATUS-CDE =                               09910000
099200                  SV004-CRD-STAT-TYP-LOST)                        09920000
099300           OR (ASC-NEW-STATUS-CDE =                               09930000
099400                  SV004-CRD-STAT-TYP-STOLEN)                      09940000
099500           OR (ASC-NEW-STATUS-CDE =                               09950000
099600                  SV004-CRD-STAT-TYP-INACTIVE)                    09960000
099700           OR (ASC-NEW-STATUS-CDE =                               09970000
099800                  SV004-CRD-STAT-TYP-EXPIRED))                    09980000
099900             SET PS-ALLOWABLE-STATUS-FOUND TO TRUE                09990000
100000          END-IF                                                  10000000
100100                                                                  10010000
100200                                                                  10020000
100300       WHEN ASC-CUR-STATUS-CDE =                                  10030000
100400               SV004-CRD-STAT-TYP-CANCELLED                       10040000
100500          IF ((ASC-NEW-STATUS-CDE =                               10050000
100600                  SV004-CRD-STAT-TYP-AVAILABLE)                   10060000
100700           OR (ASC-NEW-STATUS-CDE =                               10070000
100800                  SV004-CRD-STAT-TYP-LOST)                        10080000
100900           OR (ASC-NEW-STATUS-CDE =                               10090000
101000                  SV004-CRD-STAT-TYP-STOLEN)                      10100000
101100           OR (ASC-NEW-STATUS-CDE =                               10110000
101200                  SV004-CRD-STAT-TYP-EXPIRED))                    10120000
101300             SET PS-ALLOWABLE-STATUS-FOUND TO TRUE                10130000
101400          END-IF                                                  10140000
101500                                                                  10150000
101600       WHEN ASC-CUR-STATUS-CDE =                                  10160000
101700               SV004-CRD-STAT-TYP-STOLEN                          10170000
101800          IF ((ASC-NEW-STATUS-CDE =                               10180000
101900                  SV004-CRD-STAT-TYP-AVAILABLE)                   10190000
102000           OR (ASC-NEW-STATUS-CDE =                               10200000
102100                  SV004-CRD-STAT-TYP-LOST)                        10210000
102200           OR (ASC-NEW-STATUS-CDE =                               10220000
102300                  SV004-CRD-STAT-TYP-CANCELLED)                   10230000
102400           OR (ASC-NEW-STATUS-CDE =                               10240000
102500                  SV004-CRD-STAT-TYP-EXPIRED))                    10250000
102600             SET PS-ALLOWABLE-STATUS-FOUND TO TRUE                10260000
102700          END-IF                                                  10270000
102800                                                                  10280000
102900       WHEN ASC-CUR-STATUS-CDE =                                  10290000
103000               SV004-CRD-STAT-TYP-LOST                            10300000
103100          IF ((ASC-NEW-STATUS-CDE =                               10310000
103200                  SV004-CRD-STAT-TYP-AVAILABLE)                   10320000
103300           OR (ASC-NEW-STATUS-CDE =                               10330000
103400                  SV004-CRD-STAT-TYP-STOLEN)                      10340000
103500           OR (ASC-NEW-STATUS-CDE =                               10350000
103600                  SV004-CRD-STAT-TYP-CANCELLED)                   10360000
103700           OR (ASC-NEW-STATUS-CDE =                               10370000
103800                  SV004-CRD-STAT-TYP-EXPIRED))                    10380000
103900             SET PS-ALLOWABLE-STATUS-FOUND TO TRUE                10390000
104000          END-IF                                                  10400000
104100                                                                  10410000
104200       WHEN ASC-CUR-STATUS-CDE =                                  10420000
104300               SV004-CRD-STAT-TYP-EXPIRED                         10430000
104400          IF ((ASC-NEW-STATUS-CDE =                               10440000
104500                  SV004-CRD-STAT-TYP-AVAILABLE)                   10450000
104600           OR (ASC-NEW-STATUS-CDE =                               10460000
104700                  SV004-CRD-STAT-TYP-STOLEN)                      10470000
104800           OR (ASC-NEW-STATUS-CDE =                               10480000
104900                  SV004-CRD-STAT-TYP-CANCELLED)                   10490000
105000           OR (ASC-NEW-STATUS-CDE =                               10500000
105100                  SV004-CRD-STAT-TYP-LOST))                       10510000
105200             SET PS-ALLOWABLE-STATUS-FOUND TO TRUE                10520000
105300          END-IF                                                  10530000
105400                                                                  10540000
105500       WHEN ASC-CUR-STATUS-CDE =                                  10550000
105600               SV004-CRD-STAT-TYP-INACTIVE                        10560000
105700          IF ((ASC-NEW-STATUS-CDE =                               10570000
105800                  SV004-CRD-STAT-TYP-AVAILABLE)                   10580000
105900           OR (ASC-NEW-STATUS-CDE =                               10590000
106000                  SV004-CRD-STAT-TYP-STOLEN)                      10600000
106100           OR (ASC-NEW-STATUS-CDE =                               10610000
106200                  SV004-CRD-STAT-TYP-CANCELLED)                   10620000
106300           OR (ASC-NEW-STATUS-CDE =                               10630000
106400                  SV004-CRD-STAT-TYP-LOST))                       10640000
106500             SET PS-ALLOWABLE-STATUS-FOUND TO TRUE                10650000
106600          END-IF                                                  10660000
106700                                                                  10670000
106800     END-EVALUATE.                                                10680000
106900                                                                  10690000
107000     IF PS-NO-ALLOWABLE-STATUS-FOUND                              10700000
107100       SET PS-ERROR                TO TRUE                        10710000
107200       SET DP020-MSG-FATAL         TO TRUE                        10720000
107300       MOVE PC-TSYMSG-01691        TO DP020-MSG-NUMBER            10730000
107400       MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTATA                     10740000
107500       MOVE DP015-RED              TO NWSTATC                     10750000
107600       MOVE DP015-REVERSE          TO NWSTATH                     10760000
107700       MOVE -1                     TO NWSTATL                     10770000
107800       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        10780000
107900     END-IF.                                                      10790000
108000                                                                  10800000
108100*---------------------------------------------------------*       10810000
108200* EDIT TO CHECK FOR ANY EXISTING ACTIVITY                 *       10820000
108300*---------------------------------------------------------*       10830000
108400 3035-EDIT-FOR-ACTIVITY.                                          10840000
108500                                                                  10850000
108600     PERFORM 5040-SELECT-SVT-KOHLS-CRD-TXN.                       10860000
108700                                                                  10870000
108800     IF PS-ACTIVITY-FOUND                                         10880000
108900      AND DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                  10890000
109000        SET PS-ERROR                TO TRUE                       10900000
109100        SET DP020-MSG-FATAL         TO TRUE                       10910000
109200        MOVE SVT00002-CRD-NBR       TO DP020-MSG-TEXT             10920000
109300        MOVE PC-TSYMSG-01688        TO DP020-MSG-NUMBER           10930000
109400        MOVE DP015-UNP-NUM-BRT-OFF  TO NWSTATA                    10940000
109500        MOVE DP015-RED              TO NWSTATC                    10950000
109600        MOVE DP015-REVERSE          TO NWSTATH                    10960000
109700        MOVE -1                     TO NWSTATL                    10970000
109800        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       10980000
109900      END-IF.                                                     10990000
110000                                                                  11000000
110100*---------------------------------------------------------*       11010000
110200* EDIT TO SEE IF THE CARDS ARE ASSIGNED TO MULTIPLE STORES*       11020000
110300*---------------------------------------------------------*       11030000
110400 3040-EDIT-FOR-DIFFERENT-STORES.                                  11040000
110500                                                                  11050000
110600     IF ASC-DIFFERENT-STORES                                      11060000
110700       SET PS-ERROR                TO TRUE                        11070000
110800       SET DP020-MSG-FATAL         TO TRUE                        11080000
110900       MOVE PC-MULTIPLE-STORES     TO ASC-CUR-STORE-DESC          11090000
111000       MOVE PC-TSYMSG-01686        TO DP020-MSG-NUMBER            11100000
111100       MOVE DP015-RED              TO NWSTRC                      11110000
111200                                      NWSTRDC                     11120000
111300       MOVE DP015-REVERSE          TO NWSTRH                      11130000
111400                                      NWSTRDH                     11140000
111500       MOVE -1                     TO NWSTRL                      11150000
111600       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        11160000
111700     END-IF.                                                      11170000
111800                                                                  11180000
111900*---------------------------------------------------------*       11190000
112000* EDIT TO VERIFY A VALUE WAS ENTERED FOR THE NEW STORE.   *       11200000
112100*---------------------------------------------------------*       11210000
112200 3045-EDIT-FOR-ENTERED-NEW-STR.                                   11220000
112300                                                                  11230000
112400     IF ASC-NEW-STORE-CDE = SPACES                                11240000
112500       SET PS-ERROR                TO TRUE                        11250000
112600       SET DP020-MSG-FATAL         TO TRUE                        11260000
112700       MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER            11270000
112800       MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTRA                      11280000
112900       MOVE DP015-RED              TO NWSTRC                      11290000
113000       MOVE DP015-REVERSE          TO NWSTRH                      11300000
113100       MOVE -1                     TO NWSTRL                      11310000
113200       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        11320000
113300     END-IF.                                                      11330000
113400                                                                  11340000
113500*---------------------------------------------------------*       11350000
113600* DISPLAYS A MESSAGE FOR A NON NUMERIC NEW STORE CODE.    *       11360000
113700*---------------------------------------------------------*       11370000
113800 3050-EDIT-NUM-NEW-STORE-CDE.                                     11380000
113900                                                                  11390000
114000     MOVE ASC-NEW-STORE-CDE    TO DP010I-UNEDITED-FIELD.          11400000
114100     MOVE LENGTH OF ASC-NEW-STORE-CDE                             11410000
114200                               TO DP010I-MAXIMUM-DIGITS.          11420000
114300     MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS.        11430000
114400     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     11440000
114510     CALL DP010I-NUMERIC-EDIT-ROUTINE                             11451000
114520                         USING DP010I-NUMERIC-EDIT-AREA           11452000
114600     IF DP010I-ERROR-DETECTED                                     11460000
114700       SET PS-ERROR                TO TRUE                        11470000
114800       SET DP020-MSG-FATAL         TO TRUE                        11480000
114900       MOVE PC-TSYMSG-00342        TO DP020-MSG-NUMBER            11490000
115000       MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTRA                      11500000
115100       MOVE DP015-RED              TO NWSTRC                      11510000
115200       MOVE DP015-REVERSE          TO NWSTRH                      11520000
115300       MOVE -1                     TO NWSTRL                      11530000
115400       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        11540000
115500     ELSE                                                         11550000
115600       MOVE DP010I-NUMERIC-FIELD TO ASC-NEW-STORE-CDE-NUM         11560000
115700     END-IF.                                                      11570000
115800                                                                  11580000
115900*---------------------------------------------------------*       11590000
116000* EDIT TO VERIFY THE NEW STORE IS VALID                   *       11600000
116100*---------------------------------------------------------*       11610000
116200 3055-EDIT-NEW-STORE.                                             11620000
116300                                                                  11630000
116400     MOVE ASC-NEW-STORE-CDE-NUM TO DK-STORE-NUMBER.               11640000
116500                                                                  11650000
116600     PERFORM 5020-SELECT-LOCATION.                                11660000
116700                                                                  11670000
116800     IF PS-LOCATION-FOUND                                         11680000
116900       MOVE XST00001-LOC-10-ABBR-NM TO ASC-NEW-STORE-DESC         11690000
117000     ELSE                                                         11700000
117100       SET PS-ERROR                TO TRUE                        11710000
117200       SET DP020-MSG-FATAL         TO TRUE                        11720000
117300       MOVE PC-UNKNOWN             TO ASC-NEW-STORE-DESC          11730000
117400       MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER            11740000
117500       MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTRA                      11750000
117600       MOVE DP015-RED              TO NWSTRC                      11760000
117700       MOVE DP015-REVERSE          TO NWSTRH                      11770000
117800       MOVE -1                     TO NWSTRL                      11780000
117900       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        11790000
118000     END-IF.                                                      11800000
118100                                                                  11810000
118200*---------------------------------------------------------*       11820000
118300* EDIT TO VERIFY A STORE IS NOT CLOSED AND THAT IT IS A   *       11830000
118400* VALID 'DS' OR 'HQ' TYPE.                                *       11840000
118500*---------------------------------------------------------*       11850000
118600 3060-EDIT-STR-CLOSE-AND-TYPE.                                    11860000
118700                                                                  11870000
118800     IF XST00001-CLO-DTE < PV-CURRENT-DATE                        11880000
118900       SET PS-ERROR                TO TRUE                        11890000
119000       SET DP020-MSG-FATAL         TO TRUE                        11900000
119100       MOVE PC-TSYMSG-01263        TO DP020-MSG-NUMBER            11910000
119200       MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTRA                      11920000
119300       MOVE DP015-RED              TO NWSTRC                      11930000
119400       MOVE DP015-REVERSE          TO NWSTRH                      11940000
119500       MOVE -1                     TO NWSTRL                      11950000
119600       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        11960000
119700     END-IF.                                                      11970000
119800                                                                  11980000
119900     IF (XST00001-LOC-TYP-CDE NOT = PC-HQ AND                     11990000
120000         XST00001-LOC-TYP-CDE NOT = PC-DS AND                     12000000
120100         PS-NO-ERROR)                                             12010000
120200        SET PS-ERROR                TO TRUE                       12020000
120300        SET DP020-MSG-FATAL         TO TRUE                       12030000
120400        MOVE PC-TSYMSG-00017        TO DP020-MSG-NUMBER           12040000
120500        MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTRA                     12050000
120600        MOVE DP015-RED              TO NWSTRC                     12060000
120700        MOVE DP015-REVERSE          TO NWSTRH                     12070000
120800        MOVE -1                     TO NWSTRL                     12080000
120900        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       12090000
121000     END-IF.                                                      12100000
121100                                                                  12110000
121200*---------------------------------------------------------*       12120000
121300* EDIT TO VERIFY THE USER IS NOT TRYING TO CHANGE THE     *       12130000
121400* STORE CODE TO THE SAME ONE IT IS CURRENTLY IN.          *       12140000
121500*---------------------------------------------------------*       12150000
121600 3065-EDIT-FOR-DUP-STR-ENTERED.                                   12160000
121700                                                                  12170000
121800     IF ASC-CUR-STORE-CDE = ASC-NEW-STORE-CDE-NUM                 12180000
121900       SET PS-ERROR                TO TRUE                        12190000
122000       SET DP020-MSG-FATAL         TO TRUE                        12200000
122100       MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER            12210000
122200       MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTRA                      12220000
122300       MOVE DP015-RED              TO NWSTRC                      12230000
122400       MOVE DP015-REVERSE          TO NWSTRH                      12240000
122500       MOVE -1                     TO NWSTRL                      12250000
122600       SET DP030-SET-CURSOR-APPL-1 TO TRUE                        12260000
122700     END-IF.                                                      12270000
122800                                                                  12280000
122900*---------------------------------------------------------*       12290000
123000* EDIT TO EVALUATE THE CARD STATUS WHICH EXISTS.  UNDER   *       12300000
123100* CERTAIN CONDITIONS THE REQUESTED CHANGE WILL NOT BE     *       12310000
123200* ALLOWED.                                                *       12320000
123300*---------------------------------------------------------*       12330000
123400 3070-EDIT-STATUS-FOR-STR.                                        12340000
123500                                                                  12350000
123600     IF  ((ASC-CUR-STORE-CDE = 0)                                 12360000
123700      AND  (ASC-CUR-STATUS-CDE =                                  12370000
123800                    SV004-CRD-STAT-TYP-CANCELLED                  12380000
123900         OR ASC-CUR-STATUS-CDE =                                  12390000
124000                    SV004-CRD-STAT-TYP-LOST                       12400000
124100         OR ASC-CUR-STATUS-CDE =                                  12410000
124200                    SV004-CRD-STAT-TYP-STOLEN))                   12420000
124300             SET PS-ERROR                TO TRUE                  12430000
124400             SET DP020-MSG-FATAL         TO TRUE                  12440000
124500             MOVE ASC-CUR-STATUS-CDE                              12450000
124600               TO DP020-MSG-TEXT                                  12460000
124700             MOVE PC-TSYMSG-01690                                 12470000
124800               TO DP020-MSG-NUMBER                                12480000
124900             MOVE DP015-UNP-ALP-BRT-OFF  TO NWSTRA                12490000
125000             MOVE DP015-RED              TO NWSTRC                12500000
125100             MOVE DP015-REVERSE          TO NWSTRH                12510000
125200             MOVE -1                     TO NWSTRL                12520000
125300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12530000
125400     END-IF.                                                      12540000
125500                                                                  12550000
125600*---------------------------------------------------------*       12560000
125700* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE      *       12570000
125800* FIELDS ON THE MAP.                                      *       12580000
125900*---------------------------------------------------------*       12590000
126000 3200-RESET-ATTRIBUTES.                                           12600000
126100                                                                  12610000
126200     EVALUATE DP020-INT-APPL-FORMAT-IND                           12620000
126300                                                                  12630000
126400       WHEN PC-INT-APPL-RDKCS021                                  12640000
126500       WHEN PC-INT-APPL-RDKCS022-RDSKMCA                          12650000
126600           MOVE DP015-UNP-ALP-NOR-OFF    TO NWSTATA               12660000
126700                                            NWSTRA                12670000
126800                                            CMNT1A                12680000
126900                                            CMNT2A                12690000
127000           MOVE DP015-PRO-NOR-OFF        TO CRSTRA                12700000
127100                                            CRSTRDA               12710000
127200                                            CRSTATA               12720000
127300                                            CRSTATDA              12730000
127400                                                                  12740000
127500           MOVE DP015-GREEN              TO NWSTATC               12750000
127600                                            NWSTRC                12760000
127700                                            CMNT1C                12770000
127800                                            CMNT2C                12780000
127900           MOVE DP015-BLUE               TO CRSTRC                12790000
128000                                            CRSTRDC               12800000
128100                                            CRSTATC               12810000
128200                                            CRSTATDC              12820000
128300                                                                  12830000
128400           MOVE DP015-UNDERLINE          TO NWSTATH               12840000
128500                                            NWSTRH                12850000
128600                                            CMNT1H                12860000
128700                                            CMNT2H                12870000
128800           MOVE DP015-HL-OFF             TO CRSTATH               12880000
128900                                            CRSTATDH              12890000
129000                                            CRSTRH                12900000
129100                                            CRSTRDH               12910000
129200                                                                  12920000
129300       WHEN PC-INT-APPL-RDKCS022-RDSKMCL                          12930000
129400           MOVE DP015-UNP-ALP-NOR-OFF    TO NWSTATA               12940000
129500                                            CMNT1A                12950000
129600                                            CMNT2A                12960000
129700           MOVE DP015-PRO-NOR-OFF        TO NWSTRA                12970000
129800                                            CRSTRA                12980000
129900                                            CRSTRDA               12990000
130000                                            CRSTATA               13000000
130100                                            CRSTATDA              13010000
130200                                                                  13020000
130300           MOVE DP015-GREEN              TO NWSTATC               13030000
130400                                            CMNT1C                13040000
130500                                            CMNT2C                13050000
130600           MOVE DP015-BLUE               TO NWSTRC                13060000
130700                                            CRSTRC                13070000
130800                                            CRSTRDC               13080000
130900                                            CRSTATC               13090000
131000                                            CRSTATDC              13100000
131100                                                                  13110000
131200           MOVE DP015-UNDERLINE          TO NWSTATH               13120000
131300                                            NWSTRH                13130000
131400                                            CMNT1H                13140000
131500                                            CMNT2H                13150000
131600           MOVE DP015-HL-OFF             TO CRSTATH               13160000
131700                                            CRSTATDH              13170000
131800                                            CRSTRH                13180000
131900                                            CRSTRDH               13190000
132000                                                                  13200000
132100     END-EVALUATE.                                                13210000
132200                                                                  13220000
132300*---------------------------------------------------------*       13230000
132400* VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST *       13240000
132500* ENTRY.                                                  *       13250000
132600*---------------------------------------------------------*       13260000
132700 4000-BUILD-INITIAL-PANEL.                                        13270000
132800                                                                  13280000
132900     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        13290000
133000     MOVE -1                       TO NWSTATL.                    13300000
133100                                                                  13310000
133200     MOVE RD030-FROM-CNTL-NUMBER TO ASC-FROM-CNTL-NUMBER.         13320000
133300     MOVE RD030-TO-CNTL-NUMBER   TO ASC-TO-CNTL-NUMBER.           13330000
133400                                                                  13340000
133500*** FILL IN THE CARD STOCK TYPE AND DESCRIPTION ***               13350000
133600     PERFORM 5000-SELECT-SVT-CRD-PROD.                            13360000
133700                                                                  13370000
133800     IF PS-SVT-CRD-PROD-FOUND                                     13380000
133900       MOVE SVT00000-CRD-STK-TYP-ID TO ASC-CRD-STK-TYP-ID         13390000
134000       IF SVT00000-CRD-TYP-CDE = SV004-KMRC-CRD-TYP               13400000
134100         MOVE SV004-KMRC-CRD-SHT-DESC TO ASC-CRD-TYPE             13410000
134200       ELSE                                                       13420000
134300         IF SVT00000-CRD-TYP-CDE = SV004-GIFT-CRD-TYP             13430000
134400           MOVE SV004-GIFT-CRD-SHT-DESC TO ASC-CRD-TYPE           13440000
134500         ELSE                                                     13450000
134600           MOVE PC-UNKNOWN TO ASC-CRD-TYPE                        13460000
134700         END-IF                                                   13470000
134800       END-IF                                                     13480000
134900     ELSE                                                         13490000
135000       MOVE PC-UNKNOWN TO ASC-CRD-TYPE                            13500000
135100     END-IF.                                                      13510000
135200                                                                  13520000
135300*** FIND THE STORE NUMBER AND STATUS OF THE GIVEN CARDS ***       13530000
135400*** ALSO, IT WILL CHECK IF THERE ARE MULTIPLE STATUSES  ***       13540000
135500*** OR STORES ASSIGNED TO THE CARDS.                    ***       13550000
135600     PERFORM 5010-SELECT-SVT-KOHLS-CRD-ACCT.                      13560000
135700                                                                  13570000
135800     IF PS-FIRST-FETCH                                            13580000
135900       MOVE ZEROES     TO ASC-CUR-STORE-CDE                       13590000
136000       MOVE PC-UNKNOWN TO ASC-CUR-STORE-DESC                      13600000
136100     ELSE                                                         13610000
136200       IF ASC-DIFFERENT-STORES                                    13620000
136300         MOVE ZEROES             TO ASC-CUR-STORE-CDE             13630000
136400         MOVE PC-MULTIPLE-STORES TO ASC-CUR-STORE-DESC            13640000
136500       ELSE                                                       13650000
136600         MOVE PV-CRD-STR-NBR-HOLD TO ASC-CUR-STORE-CDE            13660000
136700                                     DK-STORE-NUMBER              13670000
136800         PERFORM 5020-SELECT-LOCATION                             13680000
136900         IF PS-LOCATION-FOUND                                     13690000
137000           MOVE XST00001-LOC-10-ABBR-NM                           13700000
137100             TO ASC-CUR-STORE-DESC                                13710000
137200         ELSE                                                     13720000
137300           MOVE PC-UNKNOWN TO ASC-CUR-STORE-DESC                  13730000
137400         END-IF                                                   13740000
137500       END-IF                                                     13750000
137600     END-IF.                                                      13760000
137700                                                                  13770000
137800     IF PS-FIRST-FETCH                                            13780000
137900       MOVE SPACES     TO ASC-CUR-STATUS-CDE                      13790000
138000       MOVE PC-UNKNOWN TO ASC-CUR-STATUS-DESC                     13800000
138100     ELSE                                                         13810000
138200       IF ASC-DIFFERENT-STATUS                                    13820000
138300         MOVE SPACES             TO ASC-CUR-STATUS-CDE            13830000
138400         MOVE PC-MULTIPLE-STATUS TO ASC-CUR-STATUS-DESC           13840000
138500       ELSE                                                       13850000
138600         MOVE PV-CRD-STAT-CDE-HOLD TO ASC-CUR-STATUS-CDE          13860000
138700                                      PV-SEARCH-STATUS-CDE        13870000
138800         PERFORM 5030-SEARCH-CARD-STATUS                          13880000
138900         MOVE PV-SEARCH-STATUS-DESC                               13890000
139000           TO ASC-CUR-STATUS-DESC                                 13900000
139100       END-IF                                                     13910000
139200     END-IF.                                                      13920000
139300                                                                  13930000
139400*---------------------------------------------------------*       13940000
139500* RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.      *       13950000
139600*---------------------------------------------------------*       13960000
139700 4400-MOVE-COMMAREA-TO-SCREEN.                                    13970000
139800     IF ASC-CRD-ID = PC-MULTIPLE                                  13980000
139900       MOVE PC-MULTIPLE          TO CRDIDO                        13990000
140000     ELSE                                                         14000000
140100       MOVE ASC-CRD-ID           TO SV007-CARD-NUMBER9            14010000
140200       MOVE 13                   TO SV007-CARD-NUMBER-DIS-LENGTH  14020000
140300       SET SV007-FORMAT-DISPLAY  TO TRUE                          14030000
140400       PERFORM SV007-FORMAT-CARD                                  14040000
140500       MOVE SV007-CARD-NUMBER-DISPLAY TO CRDIDO                   14050000
140501     END-IF                                                       14050100
140502     MOVE ASC-CRD-TYPE           TO CRDTYPO.                      14050200
140503     MOVE ASC-CRD-STK-TYP-ID     TO CRDSTTPO.                     14050300
140600     MOVE ASC-FROM-CNTL-NUMBER   TO CNTRLFMO.                     14060000
140700     MOVE ASC-TO-CNTL-NUMBER     TO CNTRLTOO.                     14070000
140800     MOVE ASC-CUR-STORE-CDE      TO CRSTRO.                       14080000
140900     MOVE ASC-CUR-STATUS-CDE     TO CRSTATO.                      14090000
141000     MOVE ASC-CUR-STORE-DESC     TO CRSTRDO.                      14100000
141100     MOVE ASC-CUR-STATUS-DESC    TO CRSTATDO.                     14110000
141200     MOVE ASC-NEW-STORE-CDE-NUM  TO NWSTRO.                       14120000
141300     MOVE ASC-NEW-STATUS-CDE     TO NWSTATO.                      14130000
141400     MOVE ASC-NEW-STORE-DESC     TO NWSTRDO.                      14140000
141500     MOVE ASC-NEW-STATUS-DESC    TO NWSTATDO.                     14150000
141600     MOVE ASC-COMMENT-1          TO CMNT1O.                       14160000
141700     MOVE ASC-COMMENT-2          TO CMNT2O.                       14170000
141800                                                                  14180000
141900*---------------------------------------------------------*       14190000
142000* SELECT TO RETRIEVE THE CARD TYPE.                       *       14200000
142100*---------------------------------------------------------*       14210000
142200 5000-SELECT-SVT-CRD-PROD.                                        14220000
142300                                                                  14230000
142400     PERFORM 7000-DF-CONTROL-NBR-FROM.                            14240000
142500     PERFORM 7200-DF-CONTROL-NBR-TO.                              14250000
142600                                                                  14260000
142700     SET PS-NO-SVT-CRD-PROD-FOUND TO TRUE.                        14270000
142800                                                                  14280000
142900     PERFORM                                                      14290000
143000       WITH TEST AFTER                                            14300000
143100       VARYING PV-RETRY-COUNTER                                   14310000
143200       FROM 1 BY 1                                                14320000
143300       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                 14330000
143400           OR (SQLCODE = ZERO)                                    14340000
143500           OR (SQLCODE = +100))                                   14350000
143600                                                                  14360000
143700         EXEC SQL                                                 14370000
143800             SELECT CRD_STK_TYP_ID                                14380000
143900                   ,CRD_TYP_CDE                                   14390000
144000             INTO   :SVT00000-CRD-STK-TYP-ID                      14400000
144100                   ,:SVT00000-CRD-TYP-CDE                         14410000
144200             FROM SVT_CRD_PROD                                    14420000
144300             WHERE  :DF-CRD-PROD-YR   = CRD_PROD_YR               14430000
144400               AND  :DF-SHIPT-REQ-NBR = SHIPT_REQ_NBR             14440000
144500               AND (:DF-CNTL-NBR-FROM BETWEEN STRT_CNTL_NBR       14450000
144600                                          AND  END_CNTL_NBR)      14460000
144700             WITH UR                                              14470000
144800         END-EXEC                                                 14480000
144900                                                                  14490000
145000         EVALUATE TRUE                                            14500000
145100           WHEN SQLCODE = ZERO                                    14510000
145200               SET PS-SVT-CRD-PROD-FOUND TO TRUE                  14520000
145300           WHEN SQLCODE = +100                                    14530000
145400               MOVE PC-UNKNOWN TO ASC-CRD-TYPE                    14540000
145500           WHEN SQLCODE = -904                                    14550000
145600           WHEN SQLCODE = -913                                    14560000
145700               CONTINUE                                           14570000
145800           WHEN SQLWARN0 NOT = SPACES                             14580000
145900           WHEN SQLCODE < ZERO                                    14590000
146000           WHEN SQLCODE > ZERO                                    14600000
146100               MOVE '5000-SELECT-SVT_CRD_PROD'                    14610000
146200                 TO DP013-PARAGRAPH                               14620000
146300               MOVE 'SELECT CARD STOCK ID & DESCRIPTION:'         14630000
146400                 TO DP013-MESSAGE-TEXT(1)                         14640000
146500               MOVE DF-CNTL-NBR-FROM99                            14650000
146600                 TO DP013-MESSAGE-TEXT(2)                         14660000
146700               MOVE ' THRU '                                      14670000
146800                 TO DP013-MESSAGE-TEXT(3)                         14680000
146900               MOVE DT-CNTL-NBR-TO99                              14690000
147000                 TO DP013-MESSAGE-TEXT(4)                         14700000
147100               MOVE SQLCA                                         14710000
147200                 TO DP013-SQLCA                                   14720000
147300               MOVE 'SVT_CRD_PROD'                                14730000
147400                 TO DP013-DB2-TABLE-NAME(1)                       14740000
147500               SET DP013-DB2-ABEND                                14750000
147600                   DP013-XCTL-DISPLAY-RESTART TO TRUE             14760000
147700               PERFORM DP013-0000-PROCESS-ABEND                   14770000
147800         END-EVALUATE                                             14780000
147900     END-PERFORM.                                                 14790000
148000                                                                  14800000
148100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         14810000
148200       MOVE '5000-SELECT-SVT_CRD_PROD'                            14820000
148300         TO DP013-PARAGRAPH                                       14830000
148400       MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT CARD ST14840000
148500-           'OCK ID & DESCRIPTION: '                              14850000
148600         TO DP013-MESSAGE-TEXT(1)                                 14860000
148700       MOVE DF-CNTL-NBR-FROM99                                    14870000
148800         TO DP013-MESSAGE-TEXT(2)                                 14880000
148900       MOVE ' THRU '                                              14890000
149000         TO DP013-MESSAGE-TEXT(3)                                 14900000
149100       MOVE DT-CNTL-NBR-TO99                                      14910000
149200         TO DP013-MESSAGE-TEXT(4)                                 14920000
149300       MOVE SQLCA                                                 14930000
149400         TO DP013-SQLCA                                           14940000
149500       MOVE 'SVT_CRD_PROD'                                        14950000
149600         TO DP013-DB2-TABLE-NAME(1)                               14960000
149700       SET DP013-DB2-ABEND                                        14970000
149800           DP013-XCTL-DISPLAY-RESTART TO TRUE                     14980000
149900       PERFORM DP013-0000-PROCESS-ABEND                           14990000
150000     END-IF.                                                      15000000
150100                                                                  15010000
150200*---------------------------------------------------------*       15020000
150300* SELECT TO CAPTURE THE STORE AND STATUS ASSIGNED TO THE  *       15030000
150400* CARDS.  IT WILL ALSO DETERMINE IF THERE ARE MULTIPLE    *       15040000
150500* STORES OR STATUSES ASSIGNED TO THE CARDS.               *       15050000
150600*---------------------------------------------------------*       15060000
150700 5010-SELECT-SVT-KOHLS-CRD-ACCT.                                  15070000
150800                                                                  15080000
150900     PERFORM 7000-DF-CONTROL-NBR-FROM.                            15090000
151000     PERFORM 7200-DF-CONTROL-NBR-TO.                              15100000
151100                                                                  15110000
151200     EXEC SQL                                                     15120000
151300         OPEN SVT-CRD-ACCT-CSR                                    15130000
151400     END-EXEC.                                                    15140000
151500                                                                  15150000
151600     EVALUATE TRUE                                                15160000
151700       WHEN SQLCODE NOT = 0                                       15170000
151800       WHEN SQLWARN0    = 'W'                                     15180000
151900           MOVE '5010-SELECT-SVT_KOHLS_CRD_ACCT'                  15190000
152000             TO DP013-PARAGRAPH                                   15200000
152100           MOVE 'OPEN SVT-CRD-ACCT-CSR'                           15210000
152200             TO DP013-MESSAGE-TEXT(1)                             15220000
152300           MOVE DF-CNTL-NBR-FROM99                                15230000
152400             TO DP013-MESSAGE-TEXT(2)                             15240000
152500           MOVE ' THRU '                                          15250000
152600             TO DP013-MESSAGE-TEXT(3)                             15260000
152700           MOVE DT-CNTL-NBR-TO99                                  15270000
152800             TO DP013-MESSAGE-TEXT(4)                             15280000
152900           MOVE SQLCA                                             15290000
153000             TO DP013-SQLCA                                       15300000
153100           MOVE 'SVT_KOHLS_CRD_ACCT'                              15310000
153200             TO DP013-DB2-TABLE-NAME(1)                           15320000
153300           SET DP013-DB2-ABEND                                    15330000
153400               DP013-XCTL-DISPLAY-RESTART TO TRUE                 15340000
153500           PERFORM DP013-0000-PROCESS-ABEND                       15350000
153600     END-EVALUATE.                                                15360000
153700                                                                  15370000
153800     SET ASC-NO-DIFFERENT-STATUS                                  15380000
153900         ASC-NO-DIFFERENT-STORES                                  15390000
154000         PS-FIRST-FETCH TO TRUE.                                  15400000
154100                                                                  15410000
154200     PERFORM                                                      15420000
154300       WITH TEST BEFORE                                           15430000
154400       UNTIL (SQLCODE = +100)                                     15440000
154500                                                                  15450000
154600         EXEC SQL                                                 15460000
154700             FETCH SVT-CRD-ACCT-CSR                               15470000
154800             INTO   :SVT00001-CRD-NBR                             15480000
154900                   ,:SVT00001-CRD-STAT-CDE                        15490000
155000                   ,:SVT00001-STR-NBR                             15500000
155100         END-EXEC                                                 15510000
155200                                                                  15520000
155300         EVALUATE TRUE                                            15530000
155400           WHEN SQLCODE = +0                                      15540000
155500               IF PS-FIRST-FETCH                                  15550000
155600                   MOVE SVT00001-CRD-STAT-CDE                     15560000
155700                                         TO PV-CRD-STAT-CDE-HOLD  15570000
155800                   MOVE SVT00001-STR-NBR TO PV-CRD-STR-NBR-HOLD   15580000
155900                   SET PS-NOT-FIRST-FETCH TO TRUE                 15590000
156000               ELSE                                               15600000
156100                   IF SVT00001-CRD-STAT-CDE NOT =                 15610000
156200                                            PV-CRD-STAT-CDE-HOLD  15620000
156300                       SET ASC-DIFFERENT-STATUS TO TRUE           15630000
156400                   END-IF                                         15640000
156500                   IF SVT00001-STR-NBR NOT = PV-CRD-STR-NBR-HOLD  15650000
156600                       SET ASC-DIFFERENT-STORES TO TRUE           15660000
156700                   END-IF                                         15670000
156800               END-IF                                             15680000
156900           WHEN SQLCODE = +100                                    15690000
157000               CONTINUE                                           15700000
157100         END-EVALUATE                                             15710000
157200     END-PERFORM.                                                 15720000
157300                                                                  15730000
157400     EXEC SQL                                                     15740000
157500         CLOSE SVT-CRD-ACCT-CSR                                   15750000
157600     END-EXEC.                                                    15760000
157700                                                                  15770000
157800     EVALUATE TRUE                                                15780000
157900       WHEN SQLCODE NOT = 0                                       15790000
158000       WHEN SQLWARN0    = 'W'                                     15800000
158100           MOVE '5010-SELECT-CRD-ACCT' TO DP013-PARAGRAPH         15810000
158200           MOVE 'CLOSE ACCT-CSR'       TO DP013-MESSAGE-TEXT (1)  15820000
158300           MOVE DF-CNTL-NBR-FROM99     TO DP013-MESSAGE-TEXT (2)  15830000
158400           MOVE ' THRU '               TO DP013-MESSAGE-TEXT (3)  15840000
158500           MOVE DT-CNTL-NBR-TO99       TO DP013-MESSAGE-TEXT (4)  15850000
158600           MOVE SQLCA                  TO DP013-SQLCA             15860000
158700           MOVE 'SVT_KOHLS_CRD_ACCT'   TO DP013-DB2-TABLE-NAME (1)15870000
158800           SET DP013-DB2-ABEND                                    15880000
158900               DP013-XCTL-DISPLAY-RESTART TO TRUE                 15890000
159000           PERFORM DP013-0000-PROCESS-ABEND                       15900000
159100     END-EVALUATE.                                                15910000
159200                                                                  15920000
159300*---------------------------------------------------------*       15930000
159400* SELECT TO RETRIEVE THE STORE DESCRIPTION.               *       15940000
159500*---------------------------------------------------------*       15950000
159600 5020-SELECT-LOCATION.                                            15960000
159700                                                                  15970000
159800     SET PS-NO-LOCATION-FOUND TO TRUE.                            15980000
159900                                                                  15990000
160000     PERFORM                                                      16000000
160100       WITH TEST AFTER                                            16010000
160200       VARYING PV-RETRY-COUNTER                                   16020000
160300       FROM 1 BY 1                                                16030000
160400       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                 16040000
160500           OR (SQLCODE = ZERO)                                    16050000
160600           OR (SQLCODE = +100))                                   16060000
160700                                                                  16070000
160800         EXEC SQL                                                 16080000
160900             SELECT LOC_10_ABBR_NM                                16090000
161000                   ,LOC_TYP_CDE                                   16100000
161100                   ,CLO_DTE                                       16110000
161200             INTO   :XST00001-LOC-10-ABBR-NM,                     16120000
161300                    :XST00001-LOC-TYP-CDE,                        16130000
161400                    :XST00001-CLO-DTE                             16140000
161500             FROM XST_LOC                                         16150000
161600             WHERE (LOC_NBR = :DK-STORE-NUMBER)                   16160000
161700             WITH UR                                              16170000
161800         END-EXEC                                                 16180000
161900                                                                  16190000
162000         EVALUATE TRUE                                            16200000
162100           WHEN SQLCODE = +0                                      16210000
162200               SET PS-LOCATION-FOUND TO TRUE                      16220000
162300           WHEN SQLCODE = +100                                    16230000
162400               CONTINUE                                           16240000
162500           WHEN SQLCODE = -904                                    16250000
162600           WHEN SQLCODE = -913                                    16260000
162700               CONTINUE                                           16270000
162800           WHEN SQLWARN0 NOT = SPACES                             16280000
162900           WHEN SQLCODE < ZERO                                    16290000
163000           WHEN SQLCODE > ZERO                                    16300000
163100               MOVE '5020-SELECT-LOCATION'                        16310000
163200                 TO DP013-PARAGRAPH                               16320000
163300               MOVE 'SELECT STORE DESCRIPTION:'                   16330000
163400                 TO DP013-MESSAGE-TEXT(1)                         16340000
163500               MOVE DK-STORE-NUMBER                               16350000
163600                 TO DP013-MESSAGE-TEXT(2)                         16360000
163700               MOVE SQLCA                                         16370000
163800                 TO DP013-SQLCA                                   16380000
163900               MOVE 'XST_LOC'                                     16390000
164000                 TO DP013-DB2-TABLE-NAME(1)                       16400000
164100               SET DP013-DB2-ABEND                                16410000
164200                   DP013-XCTL-DISPLAY-RESTART TO TRUE             16420000
164300               PERFORM DP013-0000-PROCESS-ABEND                   16430000
164400         END-EVALUATE                                             16440000
164500     END-PERFORM.                                                 16450000
164600                                                                  16460000
164700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         16470000
164800       MOVE '5020-SELECT-LOCATION'                                16480000
164900         TO DP013-PARAGRAPH                                       16490000
165000       MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT SARD ST16500000
165100-           'TORE DESCRIPTION: '                                  16510000
165200         TO DP013-MESSAGE-TEXT(1)                                 16520000
165300       MOVE DK-STORE-NUMBER                                       16530000
165400         TO DP013-MESSAGE-TEXT(2)                                 16540000
165500       MOVE SQLCA                                                 16550000
165600         TO DP013-SQLCA                                           16560000
165700       MOVE 'XST_LOC'                                             16570000
165800         TO DP013-DB2-TABLE-NAME(1)                               16580000
165900       SET DP013-DB2-ABEND                                        16590000
166000           DP013-XCTL-DISPLAY-RESTART TO TRUE                     16600000
166100       PERFORM DP013-0000-PROCESS-ABEND                           16610000
166200     END-IF.                                                      16620000
166300                                                                  16630000
166400*---------------------------------------------------------*       16640000
166500* SEARCH THE CARD STATUS TABLE.                           *       16650000
166600*---------------------------------------------------------*       16660000
166700 5030-SEARCH-CARD-STATUS.                                         16670000
166800     SET SV004-CARD-ST-IDX TO 1.                                  16680000
166900     SEARCH  SV004-CARD-ST-OCC                                    16690000
167000       AT END                                                     16700000
167100         MOVE PC-UNKNOWN TO PV-SEARCH-STATUS-DESC                 16710000
167200         SET PS-NO-CRD-STATUS-FOUND TO TRUE                       16720000
167300     WHEN SV004-CARD-ST-CD(SV004-CARD-ST-IDX) =                   16730000
167400      PV-SEARCH-STATUS-CDE                                        16740000
167500         MOVE SV004-CARD-ST-SDESC(SV004-CARD-ST-IDX)              16750000
167600           TO PV-SEARCH-STATUS-DESC                               16760000
167700         SET PS-CRD-STATUS-FOUND TO TRUE                          16770000
167800     END-SEARCH.                                                  16780000
167900                                                                  16790000
168000*---------------------------------------------------------*       16800000
168100* SELECT ANY EXISTING ACTIVITY.                           *       16810000
168200*---------------------------------------------------------*       16820000
168300 5040-SELECT-SVT-KOHLS-CRD-TXN.                                   16830000
168400                                                                  16840000
168500     PERFORM 7000-DF-CONTROL-NBR-FROM.                            16850000
168600     PERFORM 7200-DF-CONTROL-NBR-TO.                              16860000
168700                                                                  16870000
168800     EXEC SQL                                                     16880000
168900         OPEN SVT_CRD_TXN-CSR                                     16890000
169000     END-EXEC.                                                    16900000
169100                                                                  16910000
169200     EVALUATE TRUE                                                16920000
169300       WHEN SQLCODE NOT = 0                                       16930000
169400       WHEN SQLWARN0    = 'W'                                     16940000
169500           MOVE '3010-SELECT-SVT_KOHLS_CRD_TXN'                   16950000
169600             TO DP013-PARAGRAPH                                   16960000
169700           MOVE 'OPEN SVT_CRD_TXN-CSR'                            16970000
169800             TO DP013-MESSAGE-TEXT(1)                             16980000
169900           MOVE DF-CNTL-NBR-FROM99                                16990000
170000             TO DP013-MESSAGE-TEXT(2)                             17000000
170100           MOVE ' THRU '                                          17010000
170200             TO DP013-MESSAGE-TEXT(3)                             17020000
170300           MOVE DT-CNTL-NBR-TO99                                  17030000
170400             TO DP013-MESSAGE-TEXT(4)                             17040000
170500           MOVE SQLCA                                             17050000
170600             TO DP013-SQLCA                                       17060000
170700           MOVE 'SVT_KOHLS_CRD_TXN'                               17070000
170800             TO DP013-DB2-TABLE-NAME(1)                           17080000
170900           SET DP013-DB2-ABEND                                    17090000
171000               DP013-XCTL-DISPLAY-RESTART TO TRUE                 17100000
171100           PERFORM DP013-0000-PROCESS-ABEND                       17110000
171200     END-EVALUATE.                                                17120000
171300                                                                  17130000
171400     SET PS-NO-ACTIVITY-FOUND TO TRUE.                            17140000
171500                                                                  17150000
171600     PERFORM                                                      17160000
171700       WITH TEST BEFORE                                           17170000
171800       UNTIL ((PS-ACTIVITY-FOUND)                                 17180000
171900           OR (SQLCODE = +100))                                   17190000
172000                                                                  17200000
172100         EXEC SQL                                                 17210000
172200             FETCH SVT_CRD_TXN-CSR                                17220000
172300             INTO   :SVT00002-CRD-NBR                             17230000
172400         END-EXEC                                                 17240000
172500                                                                  17250000
172600         EVALUATE TRUE                                            17260000
172700           WHEN SQLCODE = +0                                      17270000
172800               SET PS-ACTIVITY-FOUND TO TRUE                      17280000
172900           WHEN SQLCODE = +100                                    17290000
173000               CONTINUE                                           17300000
173100         END-EVALUATE                                             17310000
173200     END-PERFORM.                                                 17320000
173300                                                                  17330000
173400     EXEC SQL                                                     17340000
173500         CLOSE SVT_CRD_TXN-CSR                                    17350000
173600     END-EXEC.                                                    17360000
173700                                                                  17370000
173800     EVALUATE TRUE                                                17380000
173900       WHEN SQLCODE NOT = 0                                       17390000
174000       WHEN SQLWARN0    = 'W'                                     17400000
174100           MOVE '3010-SELECT-SVT_KOHLS_CRD_TXN' TO DP013-PARAGRAPH17410000
174200           MOVE 'CLOSE CRD-TNX-CSR'    TO DP013-MESSAGE-TEXT (1)  17420000
174300           MOVE DF-CNTL-NBR-FROM99     TO DP013-MESSAGE-TEXT (2)  17430000
174400           MOVE ' THRU '               TO DP013-MESSAGE-TEXT (3)  17440000
174500           MOVE DT-CNTL-NBR-TO99       TO DP013-MESSAGE-TEXT (4)  17450000
174600           MOVE SQLCA                  TO DP013-SQLCA             17460000
174700           MOVE 'SVT_KOHLS_CRD_TXN'    TO DP013-DB2-TABLE-NAME (1)17470000
174800           SET DP013-DB2-ABEND                                    17480000
174900               DP013-XCTL-DISPLAY-RESTART TO TRUE                 17490000
175000           PERFORM DP013-0000-PROCESS-ABEND                       17500000
175100     END-EVALUATE.                                                17510000
175200                                                                  17520000
175300*---------------------------------------------------------*       17530000
175400* FETCH THE CARD CONTROL NUMBER FROM SVT_KOHLS_CRD_ACCT   *       17540000
175500*---------------------------------------------------------*       17550000
175600 5050-SELECT-CRD-CNTL-NBR.                                        17560000
175700                                                                  17570000
175800     EXEC SQL                                                     17580000
175900         SELECT CRD_PROD_YR                                       17590000
176000               ,SHIPT_REQ_NBR                                     17600000
176100               ,CNTL_NBR                                          17610000
176200           INTO :SVT00001-CRD-PROD-YR                             17620000
176300               ,:SVT00001-SHIPT-REQ-NBR                           17630000
176400               ,:SVT00001-CNTL-NBR                                17640000
176500           FROM SVT_KOHLS_CRD_ACCT                                17650000
176600          WHERE CRD_NBR = :DK-CRD-ID                              17660000
176700          WITH UR                                                 17670000
176800     END-EXEC.                                                    17680000
176900                                                                  17690000
177000     EVALUATE TRUE                                                17700000
177100                                                                  17710000
177200       WHEN SQLCODE = +0                                          17720000
177300           MOVE SVT00001-CRD-PROD-YR   TO DF-CRD-PROD-YR9         17730000
177400           MOVE SVT00001-SHIPT-REQ-NBR TO DF-SHIPT-REQ-NBR9       17740000
177500           MOVE SVT00001-CNTL-NBR      TO DF-CNTL-NBR-FROM9       17750000
177600           MOVE DF-CNTL-NBR-FROM99     TO RD030-FROM-CNTL-NUMBER  17760000
177700                                          RD030-TO-CNTL-NUMBER    17770000
177800                                                                  17780000
177900       WHEN SQLCODE = +100                                        17790000
178000*         --- CARD ID NOT FOUND ---                               17800000
178100          MOVE PC-TSYMSG-01210 TO DP020-MSG-NUMBER                17810000
178200          SET PS-ERROR         TO TRUE                            17820000
178300          SET DP020-MSG-FATAL                                     17830000
178400              DP020-NEXT-ACT-APPL-ERROR TO TRUE                   17840000
178500                                                                  17850000
178600       WHEN OTHER                                                 17860000
178700           MOVE '5050-SELECT-CRD-CNTL-NBR'                        17870000
178800             TO DP013-PARAGRAPH                                   17880000
178900           MOVE 'UNABLE TO SELECT CARD ID'                        17890000
179000             TO DP013-MESSAGE-TEXT(1)                             17900000
179100           MOVE SQLCA                                             17910000
179200             TO DP013-SQLCA                                       17920000
179300          MOVE 'SVT_KOHLS_CRD_ACCT'                               17930000
179400             TO DP013-DB2-TABLE-NAME(1)                           17940000
179500          SET DP013-DB2-ABEND TO TRUE                             17950000
179600          PERFORM DP013-0000-PROCESS-ABEND                        17960000
179700                                                                  17970000
179800     END-EVALUATE.                                                17980000
179900                                                                  17990000
180000*---------------------------------------------------------*       18000000
180100* APPLY THE CHANGES TO THE CARD STATUS TO THE DB2 TABLE.  *       18010000
180200*---------------------------------------------------------*       18020000
180300 6100-UPDATE-CRD-STATUS-CDE.                                      18030000
180400                                                                  18040000
180500     MOVE ASC-NEW-STATUS-CDE   TO SVT00001-CRD-STAT-CDE.          18050000
180600     PERFORM 7000-DF-CONTROL-NBR-FROM.                            18060000
180700     PERFORM 7200-DF-CONTROL-NBR-TO.                              18070000
180800     PERFORM 6110-UPDATE-STATUS-CDE-RECORD.                       18080000
180900                                                                  18090000
181000*---------------------------------------------------------*       18100000
181100* UPDATE THE ROWS ON THE DB2 TABLE WITH THE NEW CARD      *       18110000
181200* STATUS.                                                 *       18120000
181300*---------------------------------------------------------*       18130000
181400 6110-UPDATE-STATUS-CDE-RECORD.                                   18140000
181500                                                                  18150000
181600     PERFORM                                                      18160000
181700       WITH TEST AFTER                                            18170000
181800       VARYING PV-RETRY-COUNTER                                   18180000
181900       FROM 1 BY 1                                                18190000
182000       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                 18200000
182100           OR (SQLCODE = ZERO))                                   18210000
182200                                                                  18220000
182300                                                                  18230000
182400               EXEC SQL                                           18240000
182500                   UPDATE SVT_KOHLS_CRD_ACCT                      18250000
182600                    SET CRD_STAT_CDE = :SVT00001-CRD-STAT-CDE,    18260000
182700                        STAT_CHG_BY_USR_ID                        18270000
182800                                     = :DP020-USERID,             18280000
182900                        CRD_STAT_CHG_DTE                          18290000
183000                                     = :PV-CURRENT-DATE,          18300000
183100                        CRD_STAT_CHG_TM                           18310000
183200                                     = :PV-TIME                   18320000
183300             WHERE  CRD_PROD_YR       = :DF-CRD-PROD-YR           18330000
183400               AND  SHIPT_REQ_NBR     = :DF-SHIPT-REQ-NBR         18340000
183500               AND (CNTL_NBR BETWEEN    :DF-CNTL-NBR-FROM         18350000
183600                                 AND    :DT-CNTL-NBR-TO)          18360000
183700               END-EXEC                                           18370000
183800                                                                  18380000
183900                                                                  18390000
184000         EVALUATE TRUE                                            18400000
184100           WHEN SQLCODE = ZERO                                    18410000
184200               SET DP020-MSG-INFORMATIONAL TO TRUE                18420000
184300               MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER           18430000
184400           WHEN SQLCODE = -904                                    18440000
184500           WHEN SQLCODE = -913                                    18450000
184600               CONTINUE                                           18460000
184700           WHEN SQLWARN0 NOT = SPACES                             18470000
184800           WHEN SQLCODE < ZERO                                    18480000
184900           WHEN SQLCODE > ZERO                                    18490000
185000              MOVE '6110-UPDATE-STATUS-CDE-RECORD'                18500000
185100                TO DP013-PARAGRAPH                                18510000
185200              MOVE 'UPDATE ROWS ON THE KMC STORED VALUE CRD TABLE'18520000
185300                TO DP013-MESSAGE-TEXT(1)                          18530000
185400              MOVE DF-CNTL-NBR-FROM99                             18540000
185500                TO DP013-MESSAGE-TEXT(2)                          18550000
185600              MOVE ' THRU '                                       18560000
185700                TO DP013-MESSAGE-TEXT(3)                          18570000
185800              MOVE DT-CNTL-NBR-TO99                               18580000
185900                TO DP013-MESSAGE-TEXT(4)                          18590000
186000              MOVE SQLCA                                          18600000
186100                TO DP013-SQLCA                                    18610000
186200              MOVE 'SVT_KOHLS_CRD_ACCT'                           18620000
186300                TO DP013-DB2-TABLE-NAME(1)                        18630000
186400              SET DP013-DB2-ABEND                                 18640000
186500                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18650000
186600              PERFORM DP013-0000-PROCESS-ABEND                    18660000
186700         END-EVALUATE                                             18670000
186800     END-PERFORM.                                                 18680000
186900                                                                  18690000
187000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18700000
187100       MOVE '6110-UPDATE-STATUS-CDE-RECORD'                       18710000
187200         TO DP013-PARAGRAPH                                       18720000
187300       MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE CARD ST18730000
187400-           'ATUS CODES'                                          18740000
187500         TO DP013-MESSAGE-TEXT(1)                                 18750000
187600       MOVE DF-CNTL-NBR-FROM99                                    18760000
187700         TO DP013-MESSAGE-TEXT(2)                                 18770000
187800       MOVE ' THRU '                                              18780000
187900         TO DP013-MESSAGE-TEXT(3)                                 18790000
188000       MOVE DT-CNTL-NBR-TO99                                      18800000
188100         TO DP013-MESSAGE-TEXT(4)                                 18810000
188200       MOVE SQLCA                                                 18820000
188300         TO DP013-SQLCA                                           18830000
188400       MOVE 'SVT_KOHLS_CRD_ACCT'                                  18840000
188500         TO DP013-DB2-TABLE-NAME(1)                               18850000
188600       SET DP013-DB2-ABEND                                        18860000
188700           DP013-XCTL-DISPLAY-RESTART TO TRUE                     18870000
188800       PERFORM DP013-0000-PROCESS-ABEND                           18880000
188900     END-IF.                                                      18890000
189000                                                                  18900000
189100*---------------------------------------------------------*       18910000
189200* APPLY THE CHANGES TO THE STORE CODE TO THE DB2 TABLE.   *       18920000
189300*---------------------------------------------------------*       18930000
189400 6200-UPDATE-CRD-STORE-CDE.                                       18940000
189500                                                                  18950000
189600     MOVE ASC-NEW-STORE-CDE-NUM    TO SVT00001-STR-NBR.           18960000
189700     PERFORM 7000-DF-CONTROL-NBR-FROM.                            18970000
189800     PERFORM 7200-DF-CONTROL-NBR-TO.                              18980000
189900     PERFORM 6210-UPDATE-STORE-CDE-RECORD.                        18990000
190000                                                                  19000000
190100*---------------------------------------------------------*       19010000
190200* UPDATE THE ROWS ON THE DB2 TABLE WITH THE NEW STORE CODE*       19020000
190300*---------------------------------------------------------*       19030000
190400 6210-UPDATE-STORE-CDE-RECORD.                                    19040000
190500                                                                  19050000
190600     PERFORM                                                      19060000
190700       WITH TEST AFTER                                            19070000
190800       VARYING PV-RETRY-COUNTER                                   19080000
190900       FROM 1 BY 1                                                19090000
191000       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                 19100000
191100           OR (SQLCODE = ZERO))                                   19110000
191200                                                                  19120000
191300         MOVE PV-CURRENT-DATE       TO SVT00001-CRD-DISTRB-DTE    19130000
191400         MOVE DP020-USERID          TO SVT00001-DISTRB-USR-ID     19140000
191500         MOVE PV-TIME               TO SVT00001-CRD-DISTRB-TM     19150000
191600                                                                  19160000
191700         EXEC SQL                                                 19170000
191800             UPDATE SVT_KOHLS_CRD_ACCT                            19180000
191900                 SET STR_NBR  = :SVT00001-STR-NBR,                19190000
192000                     CRD_DISTRB_DTE                               19200000
192100                              = :SVT00001-CRD-DISTRB-DTE,         19210000
192200                     DISTRB_USR_ID                                19220000
192300                              = :SVT00001-DISTRB-USR-ID,          19230000
192400                     CRD_DISTRB_TM                                19240000
192500                              = :SVT00001-CRD-DISTRB-TM           19250000
192600             WHERE  CRD_PROD_YR       = :DF-CRD-PROD-YR           19260000
192700               AND  SHIPT_REQ_NBR     = :DF-SHIPT-REQ-NBR         19270000
192800               AND (CNTL_NBR BETWEEN    :DF-CNTL-NBR-FROM         19280000
192900                                 AND    :DT-CNTL-NBR-TO)          19290000
193000         END-EXEC                                                 19300000
193100                                                                  19310000
193200         EVALUATE TRUE                                            19320000
193300           WHEN SQLCODE = ZERO                                    19330000
193400               SET DP020-MSG-INFORMATIONAL TO TRUE                19340000
193500               MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER           19350000
193600           WHEN SQLCODE = -904                                    19360000
193700           WHEN SQLCODE = -913                                    19370000
193800               CONTINUE                                           19380000
193900           WHEN SQLWARN0 NOT = SPACES                             19390000
194000           WHEN SQLCODE < ZERO                                    19400000
194100           WHEN SQLCODE > ZERO                                    19410000
194200              MOVE '6210-UPDATE-STORE-CDE-RECORD'                 19420000
194300                TO DP013-PARAGRAPH                                19430000
194400              MOVE 'UPDATE ROWS ON THE KMC STORED VALUE CRD TABLE'19440000
194500                TO DP013-MESSAGE-TEXT(1)                          19450000
194600              MOVE DF-CNTL-NBR-FROM99                             19460000
194700                TO DP013-MESSAGE-TEXT(2)                          19470000
194800              MOVE ' THRU '                                       19480000
194900                TO DP013-MESSAGE-TEXT(3)                          19490000
195000              MOVE DT-CNTL-NBR-TO99                               19500000
195100                TO DP013-MESSAGE-TEXT(4)                          19510000
195200              MOVE SQLCA                                          19520000
195300                TO DP013-SQLCA                                    19530000
195400              MOVE 'SVT_KOHLS_CRD_ACCT'                           19540000
195500                TO DP013-DB2-TABLE-NAME(1)                        19550000
195600              SET DP013-DB2-ABEND                                 19560000
195700                  DP013-XCTL-DISPLAY-RESTART TO TRUE              19570000
195800              PERFORM DP013-0000-PROCESS-ABEND                    19580000
195900         END-EVALUATE                                             19590000
196000     END-PERFORM.                                                 19600000
196100                                                                  19610000
196200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19620000
196300       MOVE '6210-UPDATE-STORE-CDE-RECORD'                        19630000
196400         TO DP013-PARAGRAPH                                       19640000
196500       MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE CARD ST19650000
196600-           'ORE CODES'                                           19660000
196700         TO DP013-MESSAGE-TEXT(1)                                 19670000
196800       MOVE DF-CNTL-NBR-FROM99                                    19680000
196900         TO DP013-MESSAGE-TEXT(2)                                 19690000
197000       MOVE ' THRU '                                              19700000
197100         TO DP013-MESSAGE-TEXT(3)                                 19710000
197200       MOVE DT-CNTL-NBR-TO99                                      19720000
197300         TO DP013-MESSAGE-TEXT(4)                                 19730000
197400       MOVE SQLCA                                                 19740000
197500         TO DP013-SQLCA                                           19750000
197600       MOVE 'SVT_KOHLS_CRD_ACCT'                                  19760000
197700         TO DP013-DB2-TABLE-NAME(1)                               19770000
197800       SET DP013-DB2-ABEND                                        19780000
197900           DP013-XCTL-DISPLAY-RESTART TO TRUE                     19790000
198000       PERFORM DP013-0000-PROCESS-ABEND                           19800000
198100     END-IF.                                                      19810000
198200                                                                  19820000
198300*---------------------------------------------------------*       19830000
198400* APPLY THE COMMENTS TO THE DB2 TABLE.                    *       19840000
198500*---------------------------------------------------------*       19850000
198600 6300-UPDATE-ACCT-CMMT-LINES.                                     19860000
198700                                                                  19870000
198800     PERFORM 7000-DF-CONTROL-NBR-FROM.                            19880000
198900     PERFORM 7200-DF-CONTROL-NBR-TO.                              19890000
199000                                                                  19900000
199100     EXEC SQL                                                     19910000
199200         OPEN SVT-CRD-ACCT-CSR                                    19920000
199300     END-EXEC.                                                    19930000
199400                                                                  19940000
199500     EVALUATE TRUE                                                19950000
199600       WHEN SQLCODE NOT = 0                                       19960000
199700       WHEN SQLWARN0    = 'W'                                     19970000
199800           MOVE '6310-UPDATE-COMMENTS'                            19980000
199900             TO DP013-PARAGRAPH                                   19990000
200000           MOVE 'OPEN SVT-CRD-ACCT-CSR'                           20000000
200100             TO DP013-MESSAGE-TEXT(1)                             20010000
200200           MOVE DF-CNTL-NBR-FROM99                                20020000
200300             TO DP013-MESSAGE-TEXT(2)                             20030000
200400           MOVE ' THRU '                                          20040000
200500             TO DP013-MESSAGE-TEXT(3)                             20050000
200600           MOVE DT-CNTL-NBR-TO99                                  20060000
200700             TO DP013-MESSAGE-TEXT(4)                             20070000
200800           MOVE SQLCA                                             20080000
200900             TO DP013-SQLCA                                       20090000
201000           MOVE 'SVT_KOHLS_CRD_ACCT'                              20100000
201100             TO DP013-DB2-TABLE-NAME(1)                           20110000
201200           SET DP013-DB2-ABEND                                    20120000
201300               DP013-XCTL-DISPLAY-RESTART TO TRUE                 20130000
201400           PERFORM DP013-0000-PROCESS-ABEND                       20140000
201500     END-EVALUATE.                                                20150000
201600                                                                  20160000
201700     PERFORM                                                      20170000
201800       WITH TEST BEFORE                                           20180000
201900       UNTIL SQLCODE = +100                                       20190000
202000                                                                  20200000
202100         EXEC SQL                                                 20210000
202200             FETCH SVT-CRD-ACCT-CSR                               20220000
202300             INTO   :SVT00001-CRD-NBR                             20230000
202400                   ,:SVT00001-CRD-STAT-CDE                        20240000
202500                   ,:SVT00001-STR-NBR                             20250000
202600         END-EXEC                                                 20260000
202700                                                                  20270000
202800         EVALUATE TRUE                                            20280000
202900           WHEN SQLCODE = +0                                      20290000
203000               PERFORM 6320-ADD-TKMCOMM-LINE                      20300000
203100           WHEN SQLCODE = +100                                    20310000
203200               CONTINUE                                           20320000
203300         END-EVALUATE                                             20330000
203400     END-PERFORM.                                                 20340000
203500                                                                  20350000
203600     EXEC SQL                                                     20360000
203700         CLOSE SVT-CRD-ACCT-CSR                                   20370000
203800     END-EXEC.                                                    20380000
203900                                                                  20390000
204000     EVALUATE TRUE                                                20400000
204100       WHEN SQLCODE NOT = 0                                       20410000
204200       WHEN SQLWARN0    = 'W'                                     20420000
204300           MOVE '6310-UPDATE-COMMENTS' TO DP013-PARAGRAPH         20430000
204400           MOVE 'CLOSE ACCT-CSR'       TO DP013-MESSAGE-TEXT (1)  20440000
204500           MOVE DF-CNTL-NBR-FROM99     TO DP013-MESSAGE-TEXT (2)  20450000
204600           MOVE ' THRU '               TO DP013-MESSAGE-TEXT (3)  20460000
204700           MOVE DT-CNTL-NBR-TO99       TO DP013-MESSAGE-TEXT (4)  20470000
204800           MOVE SQLCA                  TO DP013-SQLCA             20480000
204900           MOVE 'SVT_KOHLS_CRD_ACCT'   TO DP013-DB2-TABLE-NAME (1)20490000
205000           SET DP013-DB2-ABEND                                    20500000
205100               DP013-XCTL-DISPLAY-RESTART TO TRUE                 20510000
205200           PERFORM DP013-0000-PROCESS-ABEND                       20520000
205300     END-EVALUATE.                                                20530000
205400                                                                  20540000
205500*---------------------------------------------------------*       20550000
205600* INSERT THE ROWS ON THE DB2 TABLE WITH THE NEW COMMENT(S)*       20560000
205700*---------------------------------------------------------*       20570000
205800 6320-ADD-TKMCOMM-LINE.                                           20580000
205900                                                                  20590000
206000     MOVE SVT00001-CRD-NBR     TO SVT00003-CRD-NBR.               20600000
206100     MOVE PV-CURRENT-TIMESTAMP TO SVT00003-CRE-TMST.              20610000
206200     MOVE 1                    TO SVT00003-CMNT-SEQ-NBR.          20620000
206300     MOVE ASC-COMMENT-1        TO SVT00003-CMNT-TXT.              20630000
206400     MOVE DP020-USERID         TO SVT00003-CRE-BY-USR-ID.         20640000
206500                                                                  20650000
206600     EXEC SQL                                                     20660000
206700         INSERT                                                   20670000
206800           INTO SVT_CRD_ACCT_CMMT                                 20680000
206900                  (CRD_NBR,                                       20690000
207000                   CRE_TMST,                                      20700000
207100                   CMNT_SEQ_NBR,                                  20710000
207200                   CMNT_TXT,                                      20720000
207300                   CRE_BY_USR_ID)                                 20730000
207400               VALUES                                             20740000
207500                  (:SVT00003-CRD-NBR,                             20750000
207600                   :SVT00003-CRE-TMST,                            20760000
207700                   :SVT00003-CMNT-SEQ-NBR,                        20770000
207800                   :SVT00003-CMNT-TXT,                            20780000
207900                   :SVT00003-CRE-BY-USR-ID)                       20790000
208000           END-EXEC.                                              20800000
208100                                                                  20810000
208200           EVALUATE TRUE                                          20820000
208300             WHEN SQLCODE = +0                                    20830000
208400                 CONTINUE                                         20840000
208500                                                                  20850000
208600             WHEN OTHER                                           20860000
208700                 MOVE '6320-ADD-TKMCOMM-LINE'                     20870000
208800                   TO DP013-PARAGRAPH                             20880000
208900                 MOVE 'INSERT COMMENT LINE 1'                     20890000
209000                   TO DP013-MESSAGE-TEXT(1)                       20900000
209100                 MOVE SQLCA                                       20910000
209200                   TO DP013-SQLCA                                 20920000
209300                 MOVE 'SVT_CRD_ACCT_CMMT'                         20930000
209400                   TO DP013-DB2-TABLE-NAME(1)                     20940000
209500                 SET DP013-DB2-ABEND                              20950000
209600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20960000
209700                 PERFORM DP013-0000-PROCESS-ABEND                 20970000
209800           END-EVALUATE.                                          20980000
209900                                                                  20990000
210000           IF ASC-COMMENT-2 = SPACES                              21000000
210100               CONTINUE                                           21010000
210200           ELSE                                                   21020000
210300               MOVE 2             TO SVT00003-CMNT-SEQ-NBR        21030000
210400               MOVE ASC-COMMENT-2 TO SVT00003-CMNT-TXT            21040000
210500               EXEC SQL                                           21050000
210600                   INSERT                                         21060000
210700                     INTO SVT_CRD_ACCT_CMMT                       21070000
210800                            (CRD_NBR,                             21080000
210900                             CRE_TMST,                            21090000
211000                             CMNT_SEQ_NBR,                        21100000
211100                             CMNT_TXT,                            21110000
211200                             CRE_BY_USR_ID)                       21120000
211300                   VALUES                                         21130000
211400                            (:SVT00003-CRD-NBR,                   21140000
211500                             :SVT00003-CRE-TMST,                  21150000
211600                             :SVT00003-CMNT-SEQ-NBR,              21160000
211700                             :SVT00003-CMNT-TXT,                  21170000
211800                             :SVT00003-CRE-BY-USR-ID)             21180000
211900               END-EXEC                                           21190000
212000               EVALUATE TRUE                                      21200000
212100                 WHEN SQLCODE = +0                                21210000
212200                     CONTINUE                                     21220000
212300                                                                  21230000
212400                 WHEN OTHER                                       21240000
212500                     MOVE '6320-ADD-TKMCOMM-LINE'                 21250000
212600                       TO DP013-PARAGRAPH                         21260000
212700                     MOVE 'INSERT COMMENT LINE 2'                 21270000
212800                       TO DP013-MESSAGE-TEXT(1)                   21280000
212900                     MOVE SQLCA                                   21290000
213000                       TO DP013-SQLCA                             21300000
213100                     MOVE 'SVT_CRD_ACCT_CMMT'                     21310000
213200                       TO DP013-DB2-TABLE-NAME(1)                 21320000
213300                     SET DP013-DB2-ABEND                          21330000
213400                         DP013-XCTL-DISPLAY-RESTART TO TRUE       21340000
213500                     PERFORM DP013-0000-PROCESS-ABEND             21350000
213600               END-EVALUATE                                       21360000
213700           END-IF.                                                21370000
213800                                                                  21380000
213900 7000-DF-CONTROL-NBR-FROM.                                        21390000
214000     MOVE ASC-FROM-CNTL-NUMBER TO DF-CNTL-NBR-FROM99.             21400000
214100                                                                  21410000
214200     IF DF-CRD-PROD-YR9 < 1900                                    21420000
214300        IF  DF-CRD-PROD-YR9-YY > 90                               21430000
214400           MOVE 19 TO DF-CRD-PROD-YR9-CC                          21440000
214500        ELSE                                                      21450000
214600           MOVE 20 TO DF-CRD-PROD-YR9-CC                          21460000
214700        END-IF                                                    21470000
214800     END-IF.                                                      21480000
214900                                                                  21490000
215000     MOVE DF-CRD-PROD-YR9   TO DF-CRD-PROD-YR.                    21500000
215100     MOVE DF-SHIPT-REQ-NBR9 TO DF-SHIPT-REQ-NBR.                  21510000
215200     MOVE DF-CNTL-NBR-FROM9 TO DF-CNTL-NBR-FROM.                  21520000
215300                                                                  21530000
215400 7200-DF-CONTROL-NBR-TO.                                          21540000
215500     MOVE ASC-TO-CNTL-NUMBER TO DT-CNTL-NBR-TO99.                 21550000
215600                                                                  21560000
215700     IF DT-CRD-PROD-YR9 < 1900                                    21570000
215800        IF  DT-CRD-PROD-YR9-YY > 90                               21580000
215900           MOVE 19 TO DT-CRD-PROD-YR9-CC                          21590000
216000        ELSE                                                      21600000
216100           MOVE 20 TO DT-CRD-PROD-YR9-CC                          21610000
216200        END-IF                                                    21620000
216300     END-IF.                                                      21630000
216400                                                                  21640000
216500     MOVE DT-CRD-PROD-YR9   TO DT-CRD-PROD-YR.                    21650000
216600     MOVE DT-SHIPT-REQ-NBR9 TO DT-SHIPT-REQ-NBR.                  21660000
216700     MOVE DT-CNTL-NBR-TO9   TO DT-CNTL-NBR-TO.                    21670000
216800******************************************************************21680000
216900**  CONVERSION OF CARD NUMBER                                    *21690000
217000******************************************************************21700000
217100     COPY SVPD007.                                                21710000
217200*---------------------------------------------------------*       21720000
217300* ABEND PROCESSOR MODULE                                  *       21730000
217400*---------------------------------------------------------*       21740000
217500     COPY DPPD013.                                                21750000
