000100 TITLE 'CONTROLLER FOR PROCESSING PACKS FROM RMS PO SYSTEM'.      00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    XLKUP017.                                         00030000
000400 AUTHOR.        DENNIS STEFFEN.                                   00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  EARLY SPRING 2003.                                00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900 ENVIRONMENT DIVISION.                                            00090000
001000 CONFIGURATION SECTION.                                           00100000
001100 SOURCE-COMPUTER.  IBM-3090.                                      00110000
001200 OBJECT-COMPUTER.  IBM-3090.                                      00120000
001300 DATA DIVISION.                                                   00130000
001400                                                                  00140000
001500 WORKING-STORAGE SECTION.                                         00150000
001600                                                                  00160000
001700 01  PC-CONSTANT-STUFF.                                           00170000
001800     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'XLKUT017'. 00180000
001900 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00190000
002000                                                  COMP SYNC.      00200000
002100 01  PS-SWITCHES.                                                 00210000
002200     05  PS-PROCESS-INDICATOR-SW      PIC X(01)   VALUE 'N'.      00220000
002300         88  PS-PROCESS-CONTINUE-YES                 VALUE 'Y'.   00230000
002400         88  PS-PROCESS-CONTINUE-NO                  VALUE 'N'.   00240000
002500     05  PS-END-OF-MSG                PIC X(01)   VALUE 'N'.      00250000
002600         88  PS-END-OF-MSG-YES                    VALUE 'Y'.      00260000
002700         88  PS-END-OF-MSG-NO                     VALUE 'N'.      00270000
002800     05  PS-EXISTENCE-PO              PIC S9 COMP-3 VALUE ZERO.   00280000
002900         88  PS-PO-EXISTS-YES                       VALUE 1.      00290000
003000         88  PS-PO-EXISTS-NO                        VALUE ZERO.   00300000
003100     05  PS-END-OF-STORES-SW          PIC X(01)   VALUE 'N'.      00310005
003200         88  PS-END-OF-STORES-YES                 VALUE 'Y'.      00320006
003300         88  PS-END-OF-STORES-NO                  VALUE 'N'.      00330006
003400                                                                  00340006
003500     05  PS-RMS-PRICE-SW              PIC X(01) VALUE 'N'.        00350006
003600         88  PS-USE-RMS-PRICES-NO               VALUE 'N'.        00360006
003601         88  PS-USE-RMS-PRICES-YES              VALUE 'Y'.        00360106
003602                                                                  00360200
003603     05  PS-ABEND-SUPRESS-SW          PIC X(01) VALUE 'N'.        00360306
003604         88  PS-ABEND-SUPRESS-NO                VALUE 'N'.        00360406
003605         88  PS-ABEND-SUPRESS-YES               VALUE 'Y'.        00360506
003606                                                                  00360600
003607     05  PS-REPLACE-SW                PIC X(01) VALUE 'N'.        00360706
003608         88  PS-REPLACE-NO                      VALUE 'N'.        00360806
003609         88  PS-REPLACE-YES                     VALUE 'Y'.        00360906
003610                                                                  00361000
003620 01  PV-CRAPOLA.                                                  00362000
003621     05  DN-RTL-NULL               PIC S9(4) COMP VALUE ZERO.     00362106
003622     05  PV-START-TIMESTAMP           PIC X(26).                  00362200
003623     05  PV-RETRY-TIMESTAMP           PIC X(26).                  00362300
003624     05  PV-START                     PIC S9(7) COMP-3 VALUE ZERO.00362400
003625     05  PV-LENGTH                    PIC S9(7) COMP-3 VALUE ZERO.00362500
003626     05  PV-COMPILE-DATE              PIC X(016) VALUE SPACES.    00362600
003627                                                                  00362700
003628*    KEEPS COUNT OF THE SEGMENTS PROCESSED.  IN EVENT OF AN       00362806
003629*    ERROR, THIS WILL POINT TO THE SEGMENT THAT FAILED.           00362906
003630     05  PV-SEGMENT-COUNT             PIC S9(7) COMP-3 VALUE ZERO.00363006
003640                                                                  00364006
003650     05  PV-WORK-QTY                  PIC X(13) JUST RIGHT.       00365006
003660     05  PV-CALLED-PROGRAM            PIC X(08).                  00366006
003670         88  PV-CALL-TPURCHS-PGM                VALUE 'XLKUP005'. 00367006
003680         88  PV-CALL-TPLNSHP-PGM                VALUE 'XLKUP006'. 00368006
003690         88  PV-CALL-TPOAGMT-PGM                VALUE 'XLKUP007'. 00369006
003700         88  PV-CALL-TIMPORL-PGM                VALUE 'XLKUP008'. 00370006
003800         88  PV-CALL-TPURITM-PGM                VALUE 'XLKUP009'. 00380006
003900         88  PV-CALL-TALLPLN-PGM                VALUE 'XLKUP010'. 00390006
004000         88  PV-CALL-TPOPRPK-PGM                VALUE 'XLKUP011'. 00400006
004100         88  PV-CALL-TPOINST-PGM                VALUE 'XLKUP012'. 00410006
004200         88  PV-CALL-TOTALIZER                  VALUE 'XLKUP013'. 00420006
004300*         DRS OBSOLETE                                            00430006
004400*        88  PV-CALL-TRAUDIT-PGM                VALUE 'XLKUP014'. 00440006
004500         88  PV-CALL-TMESTDS-PGM                VALUE 'XLKUP016'. 00450006
004600         88  PV-CALL-ZAPPER-PGM                 VALUE 'XLKUP023'. 00460006
004700         88  PV-CALL-LOG-PGM                    VALUE 'XLKUP024'. 00470006
004800                                                                  00480006
004900     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      00490006
005000     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      00500006
005100     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      00510006
005200     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      00520006
005300     05  PV-DISPLAY-RETURN-CODE       PIC ZZZZ9- VALUE ZERO.      00530006
005400 01  PV-ABEND-VARIABLES.                                          00540006
005500     05  PV-ABEND-CODE         PIC S9(04) VALUE +0 COMP SYNC.     00550006
005600         88  ABEND-4013-DB2-ERROR             VALUE +4013.        00560006
005700         88  ABEND-4020-MQ-ERROR              VALUE +4020.        00570006
005800         88  ABEND-4095-NOTIFY                VALUE +4095.        00580006
005900                                                                  00590006
006000 01  PV-WORK-AREA                     PIC X(500) VALUE SPACES.    00600006
006100 01  PV-DEBUG-ID                      PIC X(20) VALUE SPACES.     00610006
006200 01  PV-END-OF-PACK-SEGMENT.                                      00620006
006300     05  FILLER                       PIC X(20) VALUE             00630006
006400         'END OF PACK MESSAGE '.                                  00640006
006500     05  PV-END-ORDER-NBR             PIC 9(08) VALUE ZEROES.     00650006
006600                                                                  00660006
006700 01  XLRD011-RECORD.                                              00670006
006800     COPY XLRD011.                                                00680006
006900/                                                                 00690006
007000*    NUMERIC EDITING ROUTINE                                      00700006
007100     COPY DPWS010I.                                               00710006
007200/                                                                 00720006
007300     EXEC SQL                                                     00730006
007400          INCLUDE TPOPRPK                                         00740006
007500     END-EXEC.                                                    00750006
007600                                                                  00760006
007700     EXEC SQL                                                     00770006
007800          INCLUDE TPURITM                                         00780006
007900     END-EXEC.                                                    00790006
008000                                                                  00800006
008100     EXEC SQL                                                     00810006
008200          INCLUDE XLT00003                                        00820006
008300     END-EXEC.                                                    00830006
008400                                                                  00840006
008500     EXEC SQL                                                     00850006
008600          INCLUDE SQLCA                                           00860006
008700     END-EXEC.                                                    00870006
008800     COPY SQLCA2.                                                 00880006
008900                                                                  00890006
009000 LINKAGE SECTION.                                                 00900006
009100     COPY XLRD012.                                                00910006
009200/                                                                 00920006
009300 PROCEDURE DIVISION USING XLRD012-RECORD.                         00930006
009400                                                                  00940006
009500     PERFORM 1000-INITIALIZATION.                                 00950006
009600                                                                  00960006
009700     PERFORM 2000-PROCESS                                         00970006
009800         UNTIL PS-PROCESS-CONTINUE-NO                             00980006
009900           OR  PS-END-OF-MSG-YES                                  00990006
010000                                                                  01000006
010100     PERFORM 9000-END.                                            01010006
010200     GOBACK.                                                      01020006
010300/                                                                 01030006
010400 1000-INITIALIZATION.                                             01040006
010500                                                                  01050006
010600     IF XL012-DEBUG-YES                                           01060006
010700         DISPLAY 'XLKUP017 - 1000-INITIALIZATION'                 01070006
010800         MOVE WHEN-COMPILED           TO PV-COMPILE-DATE          01080006
010810         DISPLAY ' COMPILE ON: ' PV-COMPILE-DATE                  01081006
010820     END-IF                                                       01082006
010830                                                                  01083006
010840*    START TIME FOR ALL DST_EVNT_MSG_LOG ROWS INSERTED LATER      01084006
010850     EXEC SQL                                                     01085006
010860         SET :PV-START-TIMESTAMP = CURRENT TIMESTAMP              01086006
010870     END-EXEC                                                     01087006
010880                                                                  01088006
010890     MOVE 1                           TO PV-START                 01089006
010900     MOVE 20                          TO PV-LENGTH.               01090006
011000                                                                  01100006
011100     SET XL012-ACTIVITY-LOG                                       01110006
011200         PV-CALL-LOG-PGM              TO TRUE                     01120006
011300     PERFORM 8010-CALL-LOG-PGM                                    01130006
011400                                                                  01140006
011500     IF XL012-SUCCESSFUL                                          01150006
011600         SET PS-PROCESS-CONTINUE-YES                              01160006
011700             PS-END-OF-MSG-NO                                     01170006
011800             PS-REPLACE-NO                                        01180006
011900             XL011-PACK-YES           TO TRUE                     01190006
012000         MOVE ZERO                    TO PV-SEGMENT-COUNT         01200006
012100     ELSE                                                         01210006
012200         SET PS-PROCESS-CONTINUE-NO   TO TRUE                     01220006
012300     END-IF.                                                      01230006
012400                                                                  01240006
012500 2000-PROCESS.                                                    01250006
012600                                                                  01260006
012700     IF XL012-DEBUG-YES                                           01270006
012800         DISPLAY 'XLKUP017 - 2000-PROCESS'                        01280006
012900     END-IF                                                       01290006
013000                                                                  01300006
013100*    IN THE BEGINNING, WE START AT POSITION 1 FOR LENGTH OF 20    01310006
013200*    WE ARE LOOKING FOR THE MESSAGE THAT IDENTIFIES A PACK        01320006
013300*    ACTION.                                                      01330006
013400                                                                  01340006
013500*   MOVE THE ORDER NUMBER TO THE PACK ENDING MESSAGE              01350006
013600     MOVE XL012-PACK-BUFFER (21:8)    TO PV-END-ORDER-NBR         01360006
013700                                                                  01370006
013800     MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH) TO PV-DEBUG-ID   01380006
013900                                                                  01390006
014000     IF XL012-DEBUG-YES                                           01400006
014100         DISPLAY 'XLKUP017 - PV-DEBUG-ID = ' PV-DEBUG-ID          01410006
014200     END-IF                                                       01420006
014300                                                                  01430006
014400     EVALUATE XL012-PACK-BUFFER (PV-START:PV-LENGTH)              01440006
014500                                                                  01450006
014600         WHEN 'ORD_PACK_HDR_CHANGE'                               01460006
014700             ADD 1                    TO PV-SEGMENT-COUNT         01470006
014800*                                                                 01480006
014900*            WRITE THE ORD_PACK_ADD SEGMENT TO THE LOG TABLE      01490006
015000             COMPUTE PV-LENGTH = LENGTH OF XL011-PK-HDR-CHG + 28  01500006
015100             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          01510006
015200                                      TO PV-WORK-AREA             01520006
015300                                         XL011-DATA               01530006
015400                                                                  01540006
015500*            CALL XLKUP011                                        01550006
015600                                                                  01560006
015700             SET PV-CALL-TPOPRPK-PGM  TO TRUE                     01570006
015800             PERFORM 8000-CALL-PROGRAM                            01580006
015900                                                                  01590006
016000*            DO THIS ONLY ONCE                                    01600006
016100             SET PS-PROCESS-CONTINUE-NO TO TRUE                   01610006
016200                                                                  01620006
016300         WHEN 'ORD_PACK_ADD'                                      01630006
016400             ADD 1                    TO PV-SEGMENT-COUNT         01640006
016500                                                                  01650006
016600*            WRITE THE ORD_PACK_ADD SEGMENT TO THE LOG TABLE      01660006
016700             MOVE XL012-PACK-BUFFER (01:20)                       01670006
016800                                      TO PV-WORK-AREA             01680006
016900                                                                  01690006
017000*            ALSO ADD 8 WHICH THE LENGTH OF THE PO NBR PRECEDING  01700006
017100*            EACH MESSAGE ID.                                     01710006
017200             COMPUTE PV-START = PV-START + PV-LENGTH + 8          01720006
017300             PERFORM 2100-PARSE-ORD-PACK-ADD                      01730006
017400                 UNTIL PS-PROCESS-CONTINUE-NO                     01740006
017500                 OR                                               01750006
017600                 PS-END-OF-MSG-YES                                01760006
017700                 OR                                               01770006
017800                 PV-START >= XL012-DATA-LENGTH                    01780006
017900                                                                  01790006
018000             SET PV-CALL-TOTALIZER        TO TRUE                 01800006
018100             PERFORM 8000-CALL-PROGRAM                            01810006
018200                                                                  01820006
018300             IF XL011-SUCCESSFUL                                  01830006
018400                 SET XL011-PACK-CALC-YES                          01840006
018500                     PV-CALL-TPOPRPK-PGM                          01850006
018600                                      TO TRUE                     01860006
018700                 PERFORM 8000-CALL-PROGRAM                        01870006
018800             END-IF                                               01880006
018900                                                                  01890006
019000                                                                  01900006
019100         WHEN 'ORD_PACK_COST_CHANGE'                              01910006
019200             ADD 1                    TO PV-SEGMENT-COUNT         01920006
019300             COMPUTE PV-START = PV-START + PV-LENGTH + 8          01930006
019400             PERFORM 2400-PARSE-ORD-PACK-COST-CHG                 01940006
019500                 UNTIL PS-PROCESS-CONTINUE-NO                     01950006
019600                 OR                                               01960006
019700                 PS-END-OF-MSG-YES                                01970006
019800                 OR                                               01980006
019900                 PV-START >= XL012-DATA-LENGTH                    01990006
020000                                                                  02000006
020100                                                                  02010006
020200             IF XL011-SUCCESSFUL                                  02020006
020300                 SET PV-CALL-TOTALIZER    TO TRUE                 02030006
020400                 PERFORM 8000-CALL-PROGRAM                        02040006
020500             END-IF                                               02050006
020600                                                                  02060006
020700         WHEN 'ORD_PACK_RTL_CHANGE'                               02070006
020800             ADD 1                    TO PV-SEGMENT-COUNT         02080006
020900             COMPUTE PV-START = PV-START + PV-LENGTH + 8          02090006
021000             PERFORM 2500-PARSE-ORD-PACK-RTL-CHG                  02100006
021100                 UNTIL PS-PROCESS-CONTINUE-NO                     02110006
021200                 OR                                               02120006
021300                 PS-END-OF-MSG-YES                                02130006
021400                 OR                                               02140006
021500                 PV-START >= XL012-DATA-LENGTH                    02150006
021600                                                                  02160006
021700             IF XL011-SUCCESSFUL                                  02170006
021800                 SET PV-CALL-TOTALIZER    TO TRUE                 02180006
021900                 PERFORM 8000-CALL-PROGRAM                        02190006
022000             END-IF                                               02200006
022100                                                                  02210006
022200         WHEN 'ORD_PACK_REPLACE'                                  02220006
022300                                                                  02230006
022400*            IF THE FIRST TRY FAILS, DO NOT ABEND OR LOG THE      02240006
022500*            MESSAGE.                                             02250006
022501                                                                  02250106
022502             SET PS-ABEND-SUPRESS-YES                             02250200
022503                 PS-REPLACE-YES           TO TRUE                 02250300
022504                                                                  02250406
022505*            THIS IS THE FIRST TRY WHICH USUALLY IS SUCCESSFUL    02250506
022506             PERFORM 2000A-REPLACE-MAIN                           02250606
022507                                                                  02250706
022508*            IF THE PACK REPLACE FAILS, TRY IT ONCE MORE          02250806
022509*            BEFORE REJECTING IT.  THIS IS MADE TO                02250906
022510*            HANDLE -911 ERRORS CAUSED BY THE HUGE UNIT OF WORK   02251006
022520                                                                  02252006
022530             IF PS-PROCESS-CONTINUE-NO                            02253006
022531                 IF XL011-SQL-ERROR                               02253106
022532                     EXEC SQL                                     02253200
022533                         SET :PV-RETRY-TIMESTAMP                  02253300
022534                            = CURRENT TIMESTAMP                   02253406
022535                     END-EXEC                                     02253500
022536                                                                  02253606
022537                     DISPLAY '%%%%%%%%%%'                         02253706
022538                     DISPLAY ' ' PV-RETRY-TIMESTAMP               02253806
022539                      ' PACK RETRY FOR '                          02253900
022540                         XL011-ORDER-NBR                          02254006
022550                     DISPLAY '%%%%%%%%%%'                         02255006
022560                                                                  02256006
022561                     PERFORM 7000-ROLLBACK-DB2                    02256106
022562                     SET PS-ABEND-SUPRESS-NO TO TRUE              02256200
022563                     MOVE 1 TO PV-START                           02256306
022564                     MOVE 20 TO PV-LENGTH                         02256406
022565                     PERFORM 2000A-REPLACE-MAIN                   02256506
022566                 END-IF                                           02256606
022567                                                                  02256706
022568             END-IF                                               02256806
022569                                                                  02256906
022570             IF XL011-SQL-ERROR                                   02257006
022571                 EXEC SQL                                         02257100
022572                         SET :PV-RETRY-TIMESTAMP                  02257200
022573                            = CURRENT TIMESTAMP                   02257306
022574                 END-EXEC                                         02257400
022575                                                                  02257506
022576                 DISPLAY '@@@@@@@@@%'                             02257606
022577                 DISPLAY ' ' PV-RETRY-TIMESTAMP                   02257706
022578                 ' PACK RETRY FAILED FOR '                        02257800
022579                         XL011-ORDER-NBR                          02257906
022580                 DISPLAY '@@@@@@@@@@'                             02258006
022590                 END-IF                                           02259006
022600                                                                  02260006
022700         WHEN 'PACK_COMP_CHANGE'                                  02270006
022800                                                                  02280006
022900             ADD 1                    TO PV-SEGMENT-COUNT         02290006
023000*            WRITE THE PACK_COMP_CHANGE SEGMENT TO THE LOG   TABLE02300006
023100             COMPUTE PV-LENGTH = LENGTH OF XL011-PK-COMP-CHG      02310006
023200                                      + 28                        02320006
023300             MOVE XL012-PACK-BUFFER (01:PV-LENGTH)                02330006
023400                                      TO PV-WORK-AREA             02340006
023500                                                                  02350006
023600             MOVE PV-WORK-AREA        TO XL011-DATA               02360006
023700                                                                  02370006
023800*            CALL XLKUP014                                        02380006
023900                                                                  02390006
024000*         DRS OBSOLETE                                            02400006
024100*            SET PV-CALL-TRAUDIT-PGM  TO TRUE                     02410006
024200*            PERFORM 8000-CALL-PROGRAM                            02420006
024300                                                                  02430006
024400*            CALL XLKUP009                                        02440006
024500             SET PV-CALL-TPURITM-PGM  TO TRUE                     02450006
024600             IF XL011-SUCCESSFUL                                  02460006
024700                 PERFORM 8000-CALL-PROGRAM                        02470006
024800             END-IF                                               02480006
024900                                                                  02490006
025000             IF XL011-SUCCESSFUL                                  02500006
025100                 SET XL011-PACK-CALC-YES                          02510006
025200                     PV-CALL-TPOPRPK-PGM                          02520006
025300                                      TO TRUE                     02530006
025400                 PERFORM 8000-CALL-PROGRAM                        02540006
025500             END-IF                                               02550006
025600                                                                  02560006
025700         WHEN OTHER                                               02570006
025800             SET PS-PROCESS-CONTINUE-NO  TO TRUE                  02580006
025900     END-EVALUATE.                                                02590006
026000                                                                  02600006
026100 2000A-REPLACE-MAIN.                                              02610006
026101                                                                  02610106
026102     SET PS-PROCESS-CONTINUE-YES                                  02610200
026103         PS-END-OF-MSG-NO                                         02610300
026104         XL011-PACK-YES           TO TRUE                         02610400
026105                                                                  02610506
026106         MOVE 1                       TO PV-SEGMENT-COUNT         02610600
026107                                                                  02610706
026108*            WRITE THE ORD_PACK_REPLACE SEGMENT TO THE LOG TABLE  02610806
026109         MOVE XL012-PACK-BUFFER (1:28)                            02610906
026110                                      TO PV-WORK-AREA             02611006
026120                                                                  02612006
026130*            WRITE THE ORD_PACK_ADD SEGMENT TO THE LOG TABLE      02613006
026140         MOVE XL012-PACK-BUFFER (29:28)                           02614006
026150                                      TO PV-WORK-AREA             02615006
026160                                                                  02616006
026170*    FIRST EXTRACT THE ORD_SKU_ADD SEGMENT FROM THE MESSAGE       02617006
026180*    IN ORDER TO GET THE PACK SKU NUMBER.                         02618006
026190*                                                                 02619006
026200*    PV-START EQUALS 1 (ORD_PACK_REPLACE)                         02620006
026300*    ADD 56 FOR ALLOW FOR THE ORD_PACK_REPLACE AND ORD_PACK_ADD   02630006
026400*        STUBS.                                                   02640006
026500*    NOW PV-START EQUALS 57.  THIS IS SHOULD BE THE START OF      02650006
026600*    THE ORD_SKU_ADD SEGMENT.  IF NOT THEN IT IS AN ERROR.        02660006
026700*                                                                 02670006
026800                                                                  02680006
026900         ADD 56                   TO PV-START                     02690006
027000         IF XL012-PACK-BUFFER (PV-START:20) = 'ORD_SKU_ADD'       02700006
027100             MOVE LENGTH OF XL011-SKU-ADD TO PV-LENGTH            02710006
027200             ADD 28               TO PV-LENGTH                    02720006
027300             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          02730006
027400                                      TO PV-WORK-AREA             02740006
027500             MOVE PV-WORK-AREA    TO XL011-DATA                   02750006
027600                                                                  02760006
027700*                ADD 2 BECAUSE WE'RE SKIPPING OVER A SEGMENT      02770006
027800             ADD 2                TO PV-SEGMENT-COUNT             02780006
027900                                                                  02790006
028000             MOVE XL011-SA-COMP-SKU-NBR TO XL011-PACK-SKU-NBR     02800006
028100             IF XL011-SA-PROMO-STRT-DTE = SPACES                  02810006
028200                     MOVE '0001-01-01'  TO XL011-PACK-AD-EVNT-DTE 02820006
028300             ELSE                                                 02830006
028400                     STRING XL011-SA-PROMO-STRT-DTE (1:4)         02840006
028500                     '-'                                          02850006
028600                     XL011-SA-PROMO-STRT-DTE (5:2)                02860006
028700                     '-'                                          02870006
028800                     XL011-SA-PROMO-STRT-DTE (7:2)                02880006
028900                     DELIMITED BY SIZE                            02890006
029000                                INTO XL011-PACK-AD-EVNT-DTE       02900006
029100             END-IF                                               02910006
029200                                                                  02920006
029300             MOVE XL011-SA-PIC-SKU-IND                            02930006
029400                                      TO XL011-PACK-PIC-ITM-IND   02940006
029500                                                                  02950006
029600             PERFORM 2001-EDIT-QTYS                               02960006
029700*                                                                 02970006
029800*            CALL XLKUP014                                        02980006
029900                                                                  02990006
030000*         DRS OBSOLETE                                            03000006
030100*                SET PV-CALL-TRAUDIT-PGM  TO TRUE                 03010006
030200*                PERFORM 8000-CALL-PROGRAM                        03020006
030300                                                                  03030006
030400*            CALL XLKUP023                                        03040006
030500                 IF PS-PROCESS-CONTINUE-YES                       03050006
030600                     SET PV-CALL-ZAPPER-PGM  TO TRUE              03060006
030700                     PERFORM 8000-CALL-PROGRAM                    03070006
030800                 END-IF                                           03080006
030900                                                                  03090006
031000                 IF PS-PROCESS-CONTINUE-YES                       03100006
031100*                    CALL XLKUP011                                03110006
031200                     SET PV-CALL-TPOPRPK-PGM  TO TRUE             03120006
031300                     PERFORM 8000-CALL-PROGRAM                    03130006
031400                 END-IF                                           03140006
031500                                                                  03150006
031600             ELSE                                                 03160006
031700                 STRING 'ORD_SKU_ADD SEGMENT NOT FOUND FOR PO '   03170006
031800                         XL012-PACK-BUFFER (21:08)                03180006
031900                         DELIMITED BY SIZE INTO XL011-ERROR-TEXT  03190006
032000                 SET XL011-SYSTEM-ERROR                           03200006
032100                     PS-PROCESS-CONTINUE-NO TO TRUE               03210006
032200             END-IF                                               03220006
032300                                                                  03230006
032400                                                                  03240006
032500             IF PS-PROCESS-CONTINUE-YES                           03250006
032600                 COMPUTE PV-START = PV-START + PV-LENGTH          03260006
032700                 PERFORM 2300-PARSE-ORD-PACK-REPLACE              03270006
032800                     UNTIL PS-PROCESS-CONTINUE-NO                 03280006
032900                     OR                                           03290006
033000                     PV-START >= XL012-DATA-LENGTH                03300006
033100             END-IF                                               03310006
033200                                                                  03320006
033300             IF PS-PROCESS-CONTINUE-YES                           03330006
033400*                CALL XLKUP005                                    03340006
033500                 SET PV-CALL-TPURCHS-PGM TO TRUE                  03350006
033600                 PERFORM 8000-CALL-PROGRAM                        03360006
033700             END-IF                                               03370006
033800                                                                  03380006
033900             IF PS-PROCESS-CONTINUE-YES                           03390006
034000*                CALL XLKUP013                                    03400006
034100                 SET PV-CALL-TOTALIZER TO TRUE                    03410006
034200                 PERFORM 8000-CALL-PROGRAM                        03420006
034300             END-IF                                               03430006
034400                                                                  03440006
034500             IF PS-PROCESS-CONTINUE-YES                           03450006
034600*                CALL XLKUP011                                    03460006
034700                 SET XL011-PACK-CALC-YES                          03470006
034800                     PV-CALL-TPOPRPK-PGM                          03480006
034900                                      TO TRUE                     03490006
035000                 PERFORM 8000-CALL-PROGRAM                        03500006
035100             END-IF.                                              03510006
035200                                                                  03520006
035300 2100-PARSE-ORD-PACK-ADD.                                         03530006
035400                                                                  03540006
035500     IF XL012-DEBUG-YES                                           03550006
035600         DISPLAY 'XLKUP017 - 2100-PARSE-ORD-PACK-ADD'             03560006
035700     END-IF                                                       03570006
035800                                                                  03580006
035900     MOVE 20                          TO PV-LENGTH                03590006
036000                                                                  03600006
036100*    LOOK FOR THE RECORD-TYPE IN THE NEXT 20 BYTES                03610006
036200                                                                  03620006
036300     MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH) TO PV-DEBUG-ID   03630006
036400     EVALUATE XL012-PACK-BUFFER (PV-START:PV-LENGTH)              03640006
036500         WHEN 'ORD_SKU_ADD'                                       03650006
036600                                                                  03660006
036700             ADD 1                    TO PV-SEGMENT-COUNT         03670006
036800*            THIS IS A 'SKU-ADD' SO EXTRACT ENOUGH DATA FOR THAT  03680006
036900*            REC-TYPE AND SEND IT DOWN THE PIPE                   03690006
037000                                                                  03700006
037100             MOVE LENGTH OF XL011-SKU-ADD                         03710006
037200                                      TO PV-LENGTH                03720006
037300             ADD 28                   TO PV-LENGTH                03730006
037400             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          03740006
037500                                      TO PV-WORK-AREA             03750006
037600             MOVE PV-WORK-AREA        TO XL011-DATA               03760006
037700                                                                  03770006
037800*            THESE FIELDS ARE USED TO BUILD PARTS OF THE PACK     03780006
037900             MOVE XL011-SA-COMP-SKU-NBR TO XL011-PACK-SKU-NBR     03790006
038000                                                                  03800006
038100             PERFORM 7050-TPOPRPK-EXIST                           03810006
038200             IF PS-PO-EXISTS-NO                                   03820006
038300                                                                  03830006
038400                 PERFORM 2001-EDIT-QTYS                           03840006
038500                                                                  03850006
038600                 MOVE XL011-SA-PIC-SKU-IND                        03860006
038700                                        TO XL011-PACK-PIC-ITM-IND 03870006
038701                                                                  03870106
038702                 IF XL011-SA-PROMO-STRT-DTE = SPACES              03870200
038703                     MOVE '0001-01-01'  TO XL011-PACK-AD-EVNT-DTE 03870300
038704                 ELSE                                             03870400
038705                     STRING XL011-SA-PROMO-STRT-DTE (1:4)         03870506
038706                     '-'                                          03870606
038707                     XL011-SA-PROMO-STRT-DTE (5:2)                03870706
038708                     '-'                                          03870806
038709                     XL011-SA-PROMO-STRT-DTE (7:2)                03870906
038710                     DELIMITED BY SIZE                            03871006
038711                                INTO XL011-PACK-AD-EVNT-DTE       03871106
038712                 END-IF                                           03871200
038713                                                                  03871306
038714                 SET PV-CALL-TPOPRPK-PGM  TO TRUE                 03871406
038715                 PERFORM 8000-CALL-PROGRAM                        03871506
038716                                                                  03871606
038717*            WE DON'T CREATE ANY PURITMS JUST SAVE DATA TO        03871706
038718*            USE IN CREATING PACK COMPONENTS                      03871806
038719                                                                  03871906
038720*            FIND THE START OF THE NEXT SEGMENT                   03872006
038730             COMPUTE PV-START = PV-START + PV-LENGTH              03873006
038740                                                                  03874006
038750             ELSE                                                 03875006
038751** GB 10/23/14                                                    03875112
038752** IF THE PO PREPACK EXISTS, CONTINUE PROCESSING THE PACK         03875212
038753** COMPONENTS. IF THE PACK COMPONENTS EXIST ON TPURITM, THEY      03875312
038754** WILL BE HANDLED BY XLKUP009                                    03875412
038755** BELOW LOGIC WILL POPULATE THE XL011-WORK-AREA WHICH IS NEEDED  03875512
038756** BY XLKUP009                                                    03875612
038757** GB 10/23/14                                                    03875712
038758                 PERFORM 2001-EDIT-QTYS                           03875812
038759                                                                  03875912
038760                 MOVE XL011-SA-PIC-SKU-IND                        03876012
038761                                        TO XL011-PACK-PIC-ITM-IND 03876112
038762                                                                  03876212
038763                 IF XL011-SA-PROMO-STRT-DTE = SPACES              03876312
038764                     MOVE '0001-01-01'  TO XL011-PACK-AD-EVNT-DTE 03876412
038765                 ELSE                                             03876512
038766                     STRING XL011-SA-PROMO-STRT-DTE (1:4)         03876612
038767                     '-'                                          03876712
038768                     XL011-SA-PROMO-STRT-DTE (5:2)                03876812
038769                     '-'                                          03876912
038770                     XL011-SA-PROMO-STRT-DTE (7:2)                03877012
038771                     DELIMITED BY SIZE                            03877112
038772                                INTO XL011-PACK-AD-EVNT-DTE       03877212
038773                 END-IF                                           03877312
038774                                                                  03877412
038775                                                                  03877512
038776                                                                  03877612
038777*            FIND THE START OF THE NEXT SEGMENT                   03877712
038778             COMPUTE PV-START = PV-START + PV-LENGTH              03877812
038780                                                                  03878006
040000                                                                  04000006
040100             END-IF                                               04010006
040200                                                                  04020006
040300         WHEN 'PACK_COMP_ADD'                                     04030006
040400             ADD 1                    TO PV-SEGMENT-COUNT         04040006
040500*            EXTRACT ENOUGH DATA FOR THAT                         04050006
040600*            REC-TYPE AND SEND IT DOWN THE PIPE                   04060006
040700             MOVE LENGTH OF XL011-PACK-COMP-ADD                   04070006
040800                                      TO PV-LENGTH                04080006
040900             ADD 28                   TO PV-LENGTH                04090006
041000             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          04100006
041100                                      TO PV-WORK-AREA             04110006
041200             MOVE PV-WORK-AREA        TO XL011-DATA               04120006
041300                                                                  04130006
041400*            THE FIRST 8 BYTES OF A SEGMENT IS ALWAYS THE PO      04140006
041500*            MOVE XL012-PACK-BUFFER (PV-START:8)                  04150006
041600*                                     TO XL011-ORDER-NBR          04160006
041700*                                                                 04170006
041701*GB 10/23/14                                                      04170111
041710             IF XL012-DEBUG-YES                                   04171011
041721              DISPLAY 'XLKUP017 - PACK_COMP_ADD         '         04172111
041722              DISPLAY 'XLKUP017 - XL011-PACK-SKU-NBR '            04172211
041723              DISPLAY XL011-PACK-SKU-NBR                          04172311
041724              DISPLAY 'XLKUP017 - XL011-PACK-ORD-QTY '            04172411
041725              DISPLAY XL011-PACK-ORD-QTY                          04172511
041726              DISPLAY 'XLKUP017 - XL011-PACK-CNCLD-QTY   '        04172611
041727              DISPLAY XL011-PACK-CNCLD-QTY                        04172711
041728              DISPLAY 'XLKUP017 - XL011-PACK-AD-EVNT-DTE '        04172811
041729              DISPLAY XL011-PACK-AD-EVNT-DTE                      04172911
041730              DISPLAY 'XLKUP017 - XL011-PACK-PIC-ITM-IND '        04173011
041731              DISPLAY XL011-PACK-PIC-ITM-IND                      04173111
041732              DISPLAY 'CALL XLKUP009                     '        04173211
041733             END-IF                                               04173311
041740*GB 10/23/14                                                      04174011
041800*            CALL XLKUP009                                        04180006
041900             SET PV-CALL-TPURITM-PGM  TO TRUE                     04190006
042000             PERFORM 8000-CALL-PROGRAM                            04200006
042100                                                                  04210006
042200*            MOVE THE STARTING POINT FORWARD                      04220006
042300             COMPUTE PV-START = PV-START + PV-LENGTH              04230006
042400                                                                  04240006
042500         WHEN OTHER                                               04250006
042600             SET PS-END-OF-MSG-YES    TO TRUE                     04260006
042700     END-EVALUATE.                                                04270006
042800                                                                  04280006
042900 2001-EDIT-QTYS.                                                  04290006
043000     IF XL012-DEBUG-YES                                           04300006
043100         DISPLAY 'XLKUP017 - 2001-EDIT-QTYS'                      04310006
043200     END-IF                                                       04320006
043300                                                                  04330006
043400     MOVE XL011-SA-ORD-QTY            TO PV-WORK-QTY              04340006
043500     MOVE PV-WORK-QTY                 TO DP010I-UNEDITED-FIELD    04350006
043600     MOVE 8                           TO DP010I-MAXIMUM-DIGITS    04360006
043700     MOVE 4                           TO DP010I-MAXIMUM-DECIMALS  04370006
043800     PERFORM 8100-NUMERIC-EDIT                                    04380006
043900     MOVE DP010I-NUMERIC-FIELD        TO XL011-PACK-ORD-QTY       04390006
044000                                                                  04400006
044100     MOVE XL011-SA-CNCLD-QTY          TO PV-WORK-QTY              04410006
044200     MOVE PV-WORK-QTY                 TO DP010I-UNEDITED-FIELD    04420006
044300     MOVE 8                           TO DP010I-MAXIMUM-DIGITS    04430006
044400     MOVE 4                           TO DP010I-MAXIMUM-DECIMALS  04440006
044500     PERFORM 8100-NUMERIC-EDIT                                    04450006
044600     MOVE DP010I-NUMERIC-FIELD        TO XL011-PACK-CNCLD-QTY.    04460006
044700                                                                  04470006
046400/                                                                 04640006
046500                                                                  04650006
046600 2300-PARSE-ORD-PACK-REPLACE.                                     04660006
046700                                                                  04670006
046800     IF XL012-DEBUG-YES                                           04680006
046900         DISPLAY 'XLKUP017 - 2300-PARSE-ORD-PACK-REPLACE'         04690006
047000     END-IF                                                       04700006
047100                                                                  04710006
047200     MOVE 20                          TO PV-LENGTH                04720006
047300                                                                  04730006
047400     MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH) TO PV-DEBUG-ID   04740006
047500                                                                  04750006
047600*    LOOK FOR THE RECORD-TYPE IN THE NEXT 20 BYTES                04760006
047700                                                                  04770006
047800     EVALUATE XL012-PACK-BUFFER (PV-START:PV-LENGTH)              04780006
047900         WHEN 'ORD_PACK_ADD'                                      04790006
048000             ADD 1                    TO PV-SEGMENT-COUNT         04800006
048100*            FIND THE START OF THE NEXT SEGMENT                   04810006
048200*            COMPUTE PV-START = PV-START + PV-LENGTH + 8          04820006
048300*                                                                 04830006
048400                                                                  04840006
048500         WHEN 'ORD_SKU_ADD'                                       04850006
048600                                                                  04860006
048700             ADD 1                    TO PV-SEGMENT-COUNT         04870006
048800             MOVE LENGTH OF XL011-SKU-ADD                         04880006
048900                                      TO PV-LENGTH                04890006
049000             ADD 28                   TO PV-LENGTH                04900006
049100             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          04910006
049200                                      TO PV-WORK-AREA             04920006
049300             MOVE PV-WORK-AREA        TO XL011-DATA               04930006
049400                                                                  04940006
049500*            THESE FIELDS ARE USED TO BUILD PARTS OF THE PACK     04950006
049600                                                                  04960006
049700             PERFORM 2001-EDIT-QTYS                               04970006
049800                                                                  04980006
049900             MOVE XL011-SA-PIC-SKU-IND  TO XL011-PACK-PIC-ITM-IND 04990006
049901                                                                  04990106
049902             IF XL011-SA-PROMO-STRT-DTE = SPACES                  04990200
049903                 MOVE '0001-01-01'  TO XL011-PACK-AD-EVNT-DTE     04990300
049904             ELSE                                                 04990400
049905                 STRING XL011-SA-PROMO-STRT-DTE (1:4)             04990506
049906                 '-'                                              04990606
049907                 XL011-SA-PROMO-STRT-DTE (5:2)                    04990706
049908                 '-'                                              04990806
049909                 XL011-SA-PROMO-STRT-DTE (7:2)                    04990906
049910                 DELIMITED BY SIZE                                04991006
049911                                INTO XL011-PACK-AD-EVNT-DTE       04991106
049912             END-IF                                               04991200
049913                                                                  04991306
049914*            CALL XLKUP014                                        04991406
049915*         DRS OBSOLETE                                            04991506
049916*            SET PV-CALL-TRAUDIT-PGM  TO TRUE                     04991606
049917*            PERFORM 8000-CALL-PROGRAM                            04991706
049918                                                                  04991806
049919             IF PS-PROCESS-CONTINUE-YES                           04991906
049920*            CALL XLKUP023 TO DELETE PO LINE INFO                 04992006
049930                 SET PV-CALL-ZAPPER-PGM   TO TRUE                 04993006
049940                 PERFORM 8000-CALL-PROGRAM                        04994006
049950             END-IF                                               04995006
049960                                                                  04996006
049970                                                                  04997006
049980*            MOVE THE STARTING POINT FORWARD                      04998006
049990             COMPUTE PV-START = PV-START + PV-LENGTH              04999006
050000                                                                  05000006
050100         WHEN 'PACK_COMP_ADD'                                     05010006
050200             ADD 1                    TO PV-SEGMENT-COUNT         05020006
050300*            EXTRACT ENOUGH DATA FOR THAT                         05030006
050400*            REC-TYPE AND SEND IT DOWN THE PIPE                   05040006
050500             MOVE LENGTH OF XL011-PACK-COMP-ADD                   05050006
050600                                      TO PV-LENGTH                05060006
050700             ADD 28                   TO PV-LENGTH                05070006
050800             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          05080006
050900                                      TO PV-WORK-AREA             05090006
051000             MOVE PV-WORK-AREA        TO XL011-DATA               05100006
051100                                                                  05110006
051200*            THE FIRST 8 BYTES OF A SEGMENT IS ALWAYS THE PO      05120006
051300*            MOVE XL012-PACK-BUFFER (PV-START:8)                  05130006
051400*                                     TO XL011-ORDER-NBR          05140006
051500*                                                                 05150006
051600*            CALL XLKUP009                                        05160006
051700             SET PV-CALL-TPURITM-PGM  TO TRUE                     05170006
051800             PERFORM 8000-CALL-PROGRAM                            05180006
051900                                                                  05190006
052000                                                                  05200006
052100*            MOVE THE STARTING POINT FORWARD                      05210006
052200             COMPUTE PV-START = PV-START + PV-LENGTH              05220006
052300                                                                  05230006
052400         WHEN 'ORD_LOCATION_ADD'                                  05240006
052500                                                                  05250006
052600             ADD 1                    TO PV-SEGMENT-COUNT         05260006
052700*            EXTRACT ENOUGH DATA FOR THIS AND                     05270006
052800*            REC-TYPE AND SEND IT DOWN THE PIPE                   05280006
052900                                                                  05290006
053000             MOVE LENGTH OF XL011-LOCATION-ADD                    05300006
053100                                      TO PV-LENGTH                05310006
053200             ADD 28                   TO PV-LENGTH                05320006
053300             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          05330006
053400                                      TO PV-WORK-AREA             05340006
053500             MOVE PV-WORK-AREA        TO XL011-DATA               05350006
053600                                                                  05360006
053700*            THESE FIELDS ARE USED TO BUILD PARTS OF THE PACK     05370006
053800             MOVE XL011-LA-COMP-SKU-NBR TO XL011-PACK-SKU-NBR     05380006
053900                                                                  05390006
054000             PERFORM 2001-EDIT-QTYS                               05400006
054100                                                                  05410006
054200*            CALL XLKUP010                                        05420006
054300             IF PS-PROCESS-CONTINUE-YES                           05430006
054400                 SET PV-CALL-TALLPLN-PGM  TO TRUE                 05440006
054500                 PERFORM 8000-CALL-PROGRAM                        05450006
054600             END-IF                                               05460006
054700                                                                  05470006
054800*            FIND THE START OF THE NEXT SEGMENT                   05480006
054900             COMPUTE PV-START = PV-START + PV-LENGTH              05490006
055000                                                                  05500006
055100         WHEN 'STORE_ADD'                                         05510006
055200             SET PS-END-OF-MSG-NO                                 05520006
055300                 PS-END-OF-STORES-NO  TO TRUE                     05530006
055400             PERFORM 2600-PARSE-STORE-ADD                         05540006
055500                 UNTIL PS-PROCESS-CONTINUE-NO                     05550006
055600                 OR                                               05560006
055700                 PS-END-OF-STORES-YES                             05570006
055800                 OR                                               05580006
055900                 PS-END-OF-MSG-YES                                05590006
056000                 OR                                               05600006
056100                 PV-START >= XL012-DATA-LENGTH                    05610006
056200                                                                  05620006
056300         WHEN OTHER                                               05630006
056400             SET PS-END-OF-MSG-YES                                05640006
056500                 PS-PROCESS-CONTINUE-NO                           05650006
056600                                      TO TRUE                     05660006
056700     END-EVALUATE.                                                05670006
056800                                                                  05680006
056900/                                                                 05690006
057000 2400-PARSE-ORD-PACK-COST-CHG.                                    05700006
057100     IF XL012-DEBUG-YES                                           05710006
057200         DISPLAY 'XLKUP017 - 2400-PARSE-ORD-PACK-COST-CHG'        05720006
057300     END-IF                                                       05730006
057400                                                                  05740006
057500     MOVE 20                          TO PV-LENGTH                05750006
057600                                                                  05760006
057700*    LOOK FOR THE RECORD-TYPE IN THE NEXT 20 BYTES                05770006
057800                                                                  05780006
057900     MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH) TO PV-DEBUG-ID   05790006
058000     EVALUATE XL012-PACK-BUFFER (PV-START:PV-LENGTH)              05800006
058100         WHEN 'ORD_SKU_COST_CHANGE'                               05810006
058200                                                                  05820006
058300             ADD 1                    TO PV-SEGMENT-COUNT         05830006
058400*           (NO ACTION REQUIRED)                                  05840006
058500             CONTINUE                                             05850006
058600                                                                  05860006
058700             MOVE LENGTH OF XL011-SKU-COST-CHG                    05870006
058800                                      TO PV-LENGTH                05880006
058900             ADD 28                   TO PV-LENGTH                05890006
059000*            FIND THE START OF THE NEXT SEGMENT                   05900006
059100             COMPUTE PV-START = PV-START + PV-LENGTH              05910006
059200                                                                  05920006
059300         WHEN 'PACK_COMP_CHANGE'                                  05930006
059400             ADD 1                    TO PV-SEGMENT-COUNT         05940006
059500*            EXTRACT ENOUGH DATA FOR THAT                         05950006
059600*            REC-TYPE AND SEND IT DOWN THE PIPE                   05960006
059700             MOVE LENGTH OF XL011-PK-COMP-CHG                     05970006
059800                                      TO PV-LENGTH                05980006
059900             ADD 28                   TO PV-LENGTH                05990006
060000             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          06000006
060100                                      TO PV-WORK-AREA             06010006
060200             MOVE PV-WORK-AREA        TO XL011-DATA               06020006
060300                                                                  06030006
060400*            CALL XLKUP014                                        06040006
060500*         DRS OBSOLETE                                            06050006
060600*            SET PV-CALL-TRAUDIT-PGM  TO TRUE                     06060006
060700*            PERFORM 8000-CALL-PROGRAM                            06070006
060800                                                                  06080006
060900*            CALL XLKUP009                                        06090006
061000             IF PS-PROCESS-CONTINUE-YES                           06100006
061100                 SET PV-CALL-TPURITM-PGM  TO TRUE                 06110006
061200                 PERFORM 8000-CALL-PROGRAM                        06120006
061300             END-IF                                               06130006
061400                                                                  06140006
061500*            MOVE THE STARTING POINT FORWARD                      06150006
061600             COMPUTE PV-START = PV-START + PV-LENGTH              06160006
061700                                                                  06170006
061800         WHEN OTHER                                               06180006
061900             SET PS-END-OF-MSG-YES    TO TRUE                     06190006
062000     END-EVALUATE.                                                06200006
062100                                                                  06210006
062200/                                                                 06220006
062300 2500-PARSE-ORD-PACK-RTL-CHG.                                     06230006
062400     IF XL012-DEBUG-YES                                           06240006
062500         DISPLAY 'XLKUP017 - 2500-PARSE-ORD-PACK-RTL-CHG'         06250006
062600     END-IF                                                       06260006
062700                                                                  06270006
062800     MOVE 20                          TO PV-LENGTH                06280006
062900                                                                  06290006
063000*    LOOK FOR THE RECORD-TYPE IN THE NEXT 20 BYTES                06300006
063100                                                                  06310006
063200     MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH) TO PV-DEBUG-ID   06320006
063300     EVALUATE XL012-PACK-BUFFER (PV-START:PV-LENGTH)              06330006
063400         WHEN 'ORD_SKU_ATTR_CHANGE'                               06340006
063500                                                                  06350006
063600             ADD 1                    TO PV-SEGMENT-COUNT         06360006
063700*           (NO ACTION REQUIRED)                                  06370006
063800             MOVE LENGTH OF XL011-SKU-ATTR-CHG                    06380006
063900                                      TO PV-LENGTH                06390006
064000             ADD 28                   TO PV-LENGTH                06400006
064100*            FIND THE START OF THE NEXT SEGMENT                   06410006
064200             COMPUTE PV-START = PV-START + PV-LENGTH              06420006
064300                                                                  06430006
064400         WHEN 'PACK_COMP_CHANGE'                                  06440006
064500             ADD 1                    TO PV-SEGMENT-COUNT         06450006
064600*            EXTRACT ENOUGH DATA FOR THAT                         06460006
064700*            REC-TYPE AND SEND IT DOWN THE PIPE                   06470006
064800             MOVE LENGTH OF XL011-PK-COMP-CHG                     06480006
064900                                      TO PV-LENGTH                06490006
065000             ADD 28                   TO PV-LENGTH                06500006
065100             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          06510006
065200                                      TO PV-WORK-AREA             06520006
065300             MOVE PV-WORK-AREA        TO XL011-DATA               06530006
065400                                                                  06540006
065500*            CALL XLKUP014                                        06550006
065600*         DRS OBSOLETE                                            06560006
065700*            SET PV-CALL-TRAUDIT-PGM  TO TRUE                     06570006
065800*            PERFORM 8000-CALL-PROGRAM                            06580006
065900                                                                  06590006
066000*            CALL XLKUP009                                        06600006
066100             IF PS-PROCESS-CONTINUE-YES                           06610006
066200                 SET PV-CALL-TPURITM-PGM  TO TRUE                 06620006
066300                 PERFORM 8000-CALL-PROGRAM                        06630006
066400             END-IF                                               06640006
066500                                                                  06650006
066600*            MOVE THE STARTING POINT FORWARD                      06660006
066700             COMPUTE PV-START = PV-START + PV-LENGTH              06670006
066800                                                                  06680006
066900         WHEN OTHER                                               06690006
067000             SET PS-END-OF-MSG-YES    TO TRUE                     06700006
067100     END-EVALUATE.                                                06710006
067200                                                                  06720006
067300/                                                                 06730006
067400 2600-PARSE-STORE-ADD.                                            06740006
067500     IF XL012-DEBUG-YES                                           06750006
067600         DISPLAY 'XLKUP017 - 2600-PARSE-STORE-ADD'                06760006
067700     END-IF                                                       06770006
067800                                                                  06780006
067900     MOVE 20                          TO PV-LENGTH                06790006
068000                                                                  06800006
068100*    LOOK FOR THE RECORD-TYPE IN THE NEXT 20 BYTES                06810006
068200                                                                  06820006
068300     MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH) TO PV-DEBUG-ID   06830006
068400     EVALUATE XL012-PACK-BUFFER (PV-START:PV-LENGTH)              06840006
068500         WHEN 'STORE_ADD'                                         06850006
068600                                                                  06860006
068700             ADD 1                    TO PV-SEGMENT-COUNT         06870006
068800             COMPUTE PV-LENGTH = LENGTH OF XL011-STORE-ADD        06880006
068900                                      + 28                        06890006
069000                                                                  06900006
069100             MOVE XL012-PACK-BUFFER (PV-START:PV-LENGTH)          06910006
069200                                      TO PV-WORK-AREA             06920006
069300             MOVE PV-WORK-AREA        TO XL011-DATA               06930006
069400                                                                  06940006
069500             SET PV-CALL-TMESTDS-PGM  TO TRUE                     06950006
069600             PERFORM 8000-CALL-PROGRAM                            06960006
069700                                                                  06970006
069800                                                                  06980006
069900             MOVE LENGTH OF XL011-STORE-ADD                       06990006
070000                                      TO PV-LENGTH                07000006
070100             ADD 28                   TO PV-LENGTH                07010006
070200*            FIND THE START OF THE NEXT SEGMENT                   07020006
070300             COMPUTE PV-START = PV-START + PV-LENGTH              07030006
070400                                                                  07040006
070500         WHEN OTHER                                               07050006
070600             SET PS-END-OF-MSG-YES    TO TRUE                     07060006
070700     END-EVALUATE.                                                07070006
070800/                                                                 07080006
070900 7000-ROLLBACK-DB2.                                               07090006
071000                                                                  07100006
071100     IF XL012-DEBUG-YES                                           07110006
071200         DISPLAY 'XLKUP017 - 7000-ROLLBACK-DB2'                   07120006
071300     END-IF                                                       07130006
071400                                                                  07140006
071500     EXEC SQL                                                     07150006
071600         ROLLBACK                                                 07160006
071700     END-EXEC.                                                    07170006
071800                                                                  07180006
071900     EVALUATE TRUE                                                07190006
072000         WHEN SQLCODE = ZERO                                      07200006
072100             CONTINUE                                             07210006
072200         WHEN SQLWARN0 NOT = SPACES                               07220006
072300         WHEN SQLCODE  NOT = ZERO                                 07230006
072400             SET XL012-SQL-ERROR                                  07240006
072500                 PS-PROCESS-CONTINUE-NO  TO TRUE                  07250006
072600     END-EVALUATE.                                                07260006
072700/                                                                 07270006
072800 7050-TPOPRPK-EXIST.                                              07280006
072900                                                                  07290006
073000     IF XL012-DEBUG-YES                                           07300006
073100         DISPLAY 'XLKUP017 - 7050-TPOPRPK-EXIST'                  07310006
073200     END-IF                                                       07320006
073201                                                                  07320106
073202     SET PS-PO-EXISTS-NO              TO TRUE                     07320200
073203     MOVE XL011-ORDER-NBR             TO POPRPK-PO-NBR            07320306
073204     MOVE XL011-PACK-SKU-NBR          TO POPRPK-PK-SKU-NBR        07320406
073205                                                                  07320506
073206     EXEC SQL                                                     07320606
073207         SELECT 1                                                 07320706
073208         INTO :PS-EXISTENCE-PO                                    07320806
073209         FROM  TPOPRPK                                            07320906
073210         WHERE PO_NBR               = :POPRPK-PO-NBR              07321006
073220           AND PK_SKU_NBR           = :POPRPK-PK-SKU-NBR          07322006
073230*LMM       AND PREPK_STAT_CDE       = 'A'                         07323006
073240             FETCH FIRST 1 ROWS ONLY                              07324006
073250     END-EXEC                                                     07325006
073260                                                                  07326006
073270     MOVE SQLCODE                  TO XL011-SQLCODE               07327006
073280     EVALUATE TRUE                                                07328006
073290         WHEN SQLCODE = ZERO                                      07329006
073300         WHEN SQLCODE = +100                                      07330006
073400             CONTINUE                                             07340006
073500         WHEN OTHER                                               07350006
073600             SET XL012-SQL-ERROR                                  07360006
073700                 PS-PROCESS-CONTINUE-NO  TO TRUE                  07370006
073800     END-EVALUATE.                                                07380006
073900                                                                  07390006
074000/                                                                 07400006
074100 8000-CALL-PROGRAM.                                               07410006
074200                                                                  07420006
074300     IF XL012-DEBUG-YES                                           07430006
074400         DISPLAY 'XLKUP017 - 8000-CALL-PROGRAM ' PV-CALLED-PROGRAM07440006
074500     END-IF                                                       07450006
074600                                                                  07460006
074700     INITIALIZE XL011-RETURN-AREA                                 07470006
074800     MOVE '8000-CALL-PROGRAM' TO PV-PARAGRAPH-NAME.               07480006
074900     MOVE XL012-DEBUG-SW      TO XL011-DEBUG-SW                   07490006
075000                                                                  07500006
075100     CALL PV-CALLED-PROGRAM USING XLRD011-RECORD                  07510006
075200                                                                  07520006
075300     EVALUATE TRUE                                                07530006
075400        WHEN XL011-SUCCESSFUL                                     07540006
075500             SET PS-PROCESS-CONTINUE-YES TO TRUE                  07550006
075600                                                                  07560006
075700        WHEN XL011-SQL-ERROR                                      07570006
075800        WHEN XL011-SYSTEM-ERROR                                   07580006
075900                                                                  07590006
076000*            THIS WILL GENERATE MQ MESSAGES FOR ALL OF THE        07600006
076100*            SEGMENTS IN THE PACK WITH THE FAULTY SEGMENT         07610006
076200*            SHOWING THE ABEND DETAILS.                           07620006
076300                                                                  07630006
076301             IF PS-REPLACE-YES                                    07630106
076302                 IF PS-ABEND-SUPRESS-YES                          07630200
076303*            THIS SWITCH IS SET ON WITHIN THE PACK-REPLACE        07630306
076304*            ROUTINE SO THAT THE LOGGING WILL HAPPEN ONLY AFTER   07630406
076305*            THE LAST RETRY                                       07630506
076306                                                                  07630606
076307                 SET PS-PROCESS-CONTINUE-NO  TO TRUE              07630706
076308                                                                  07630806
076309*                PERFORM 7000-ROLLBACK-DB2                        07630906
076310                                                                  07631006
076320             ELSE                                                 07632006
076330                                                                  07633006
076340*            THIS CREATES A RECORD OF THE PACK CONTENTS WITH      07634006
076350*            THE CLINKER MARKED WITH ABEND INFO.                  07635006
076360                                                                  07636006
076370             SET XL012-ERROR-LOG                                  07637006
076380                 PV-CALL-LOG-PGM      TO TRUE                     07638006
076390             MOVE PV-SEGMENT-COUNT    TO XL012-FAULT-POINTER      07639006
076400             MOVE XLRD011-RECORD      TO XL012-XLRD011-RECORD-AREA07640006
076500             PERFORM 8010-CALL-LOG-PGM                            07650006
076600             SET PS-PROCESS-CONTINUE-NO  TO TRUE                  07660006
076700                                                                  07670006
076800                 END-IF                                           07680006
076900             END-IF                                               07690006
077000                                                                  07700006
077100     END-EVALUATE.                                                07710006
077200                                                                  07720006
077300 8005-LOCAL-ERROR.                                                07730006
077400*            THIS CREATES A RECORD OF THE PACK CONTENTS WITH      07740006
077500*            THE CLINKER MARKED WITH ABEND INFO.                  07750006
077600                                                                  07760006
077700     SET XL012-ERROR-LOG                                          07770006
077800         PV-CALL-LOG-PGM              TO TRUE                     07780006
077900     MOVE PV-SEGMENT-COUNT            TO XL012-FAULT-POINTER      07790006
078000     MOVE XLRD011-RECORD              TO XL012-XLRD011-RECORD-AREA07800006
078100     PERFORM 8010-CALL-LOG-PGM                                    07810006
078200     SET PS-PROCESS-CONTINUE-NO  TO TRUE.                         07820006
078300                                                                  07830006
078400 8010-CALL-LOG-PGM.                                               07840006
078500                                                                  07850006
078600*    IF XL012-ERROR-LOG                                           07860006
078700*        CONTINUE                                                 07870006
078800*    ELSE                                                         07880006
078900*        INITIALIZE XL012-RETURN-AREA                             07890006
079000*    END-IF                                                       07900006
079100                                                                  07910006
079200     IF XL012-DEBUG-YES                                           07920006
079300         DISPLAY 'XLKUP017 - 8010-CALL-LOG-PGM ' PV-CALLED-PROGRAM07930006
079400     END-IF                                                       07940006
079500                                                                  07950006
079600     MOVE '8010-CALL-LOG-PGM' TO PV-PARAGRAPH-NAME.               07960006
079700                                                                  07970006
079800     CALL PV-CALLED-PROGRAM USING XLRD012-RECORD                  07980006
079900                                                                  07990006
080000     EVALUATE TRUE                                                08000006
080100        WHEN XL012-SUCCESSFUL                                     08010006
080200             SET PS-PROCESS-CONTINUE-YES TO TRUE                  08020006
080300                                                                  08030006
080400        WHEN XL012-SQL-ERROR                                      08040006
080500             SET PS-PROCESS-CONTINUE-NO  TO TRUE                  08050006
080600                                                                  08060006
080700        WHEN XL012-SYSTEM-ERROR                                   08070006
080800             SET PS-PROCESS-CONTINUE-NO  TO TRUE                  08080006
080900                                                                  08090006
081000     END-EVALUATE.                                                08100006
081100/                                                                 08110006
081200 8100-NUMERIC-EDIT.                                               08120006
081300     IF XL012-DEBUG-YES                                           08130006
081400         DISPLAY 'XLKUP017 - 8100-NUMERIC-EDIT'                   08140006
081500     END-IF                                                       08150006
081600                                                                  08160006
081700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      08170006
081800     CALL DP010I-NUMERIC-EDIT-ROUTINE                             08180006
081900          USING DP010I-NUMERIC-EDIT-AREA                          08190006
082000     IF  DP010I-ERROR-DETECTED                                    08200006
082100         MOVE '8100-NUMERIC-EDIT'     TO XL011-ERROR-PARAGRAPH    08210006
082200     END-IF.                                                      08220006
082300/                                                                 08230006
082400 9000-END.                                                        08240006
082500                                                                  08250006
082600     IF XL012-DEBUG-YES                                           08260006
082700         DISPLAY 'XLKUP017 - 9000-END'                            08270006
082800     END-IF                                                       08280006
082900                                                                  08290006
083000     MOVE XLRD011-RECORD             TO XL012-XLRD011-RECORD-AREA.08300006
083100                                                                  08310006
083200 9999-CROAK.                                                      08320006
083300                                                                  08330006
083400     IF XL012-DEBUG-YES                                           08340006
083500         DISPLAY 'XLKUP017 - 9999-CROAK'                          08350006
083600     END-IF                                                       08360006
083700                                                                  08370006
083800     DISPLAY '** ABEND     **'.                                   08380006
083900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08390006
084000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08400006
084100                                                                  08410006
084200     SET ABEND-4013-DB2-ERROR TO TRUE.                            08420006
084300     CALL 'ILBOABN0' USING ABEND-CODE.                            08430006
084400                                                                  08440006
