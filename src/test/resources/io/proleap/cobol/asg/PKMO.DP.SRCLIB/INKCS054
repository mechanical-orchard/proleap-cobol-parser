       IDENTIFICATION DIVISION.                                         00010000
00004  PROGRAM-ID.    INKCS054.                                         00020000
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                          00030000
00007  DATE-WRITTEN.  04-26-2002.                                       00040000
00008  DATE-COMPILED.                                                   00050000
00009                                                                   00060000
00010 ******************************************************************00070000
00011 *    I054 - PHYSICAL INVENTORY ADJUSTMENT INQUIRY SELECTION      *00080000
00012 *                                                                *00090000
00013 *    THIS PROGRAM IS THE ENTRY POINT TO THE PI ADJUSTMENT SUB-   *00100000
00014 *    SYSTEM.  A CORPORATE USER IS PROMPTED FOR THE STORE NUMBER; *00110000
00015 *    A STORE USER HAS THIS FILLED IN.  THE USER MAY OPT TO GO    *00120000
00016 *    TO THE ADJUSTMENT LIST SCREEN. STORE AND AREA NUMBER ARE    *00130002
00017 *    REQUIRED ENTRIES.                                           *00140000
      *                                                                 00150000
      *CHANGE HISTORY:                                                  00160000
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                     00170000
      * -------  ----------  ----------------------------------------   00180000
W23511* W23511   04-25-2002  PHYS INV TOP EXCEPTION RPT ENHANCEMENT     00190000
W23511*                      (CREATION) -ROD JANSSEN                    00200000
25248 * 25248    10-06-2003  UPC CAPABILITIES & STORE NUMBER EXPANSION  00210000
25248 *                      -ROD JANSSEN                               00220000
25248 * P25428   12-06-2003  ALLOW PRINT FUNCTIONALITY                  00230000
25248 *                      -SCOTT JACKSON                             00240000
R25248* 25248    12-24-2003  ASRA ABEND WHEN INV TABLES ARE OUT OF SYNC.00250000
R25248*                      -ROD JANSSEN                               00260000
729187* P729187  01-19-2005  PRINT ISSUE WHEN INK950 IS CALLED DUE TO   00261000
729187*                      TRUNCATION OF THE STORE NUMBER.            00261100
729187*                      -ROD JANSSEN                               00262000
729187* I243585  03-05-2008  CHANGE NEEDED TO FIND DEFAULT STORE PRTDEST00263001
729187*                      -PAUL KEBER                                00265001
      * W33304   05-01-2008  HOLDING INVENTORY LEDGER OPEN ACROSS       00266009
      *                      PERIODS INVENTORY SHORTAGE REPORTING       00267009
      *                      -JILL LIN                                  00268009
      ******************************************************************00270000
263126* CHANGED 10/26/2021    BY JIM HUNTER      WR: CHG0263126         00271012
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00272012
263126* MAKING THE CALL DYNAMIC VS STATIC.                              00273012
      ******************************************************************00273112
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188         00273213
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING 00273313
1122RM* THE CICS ARCHITECTURE API.                                      00273413
      *----------------------------------------------------------------*00273513
00022  ENVIRONMENT DIVISION.                                            00280000
00026  DATA DIVISION.                                                   00290000
                                                                        00300000
00010 /*****************************************************************00310000
00029  WORKING-STORAGE SECTION.                                         00320000
00010 ******************************************************************00330000
P25428                                                                  00340000
P25428 01  TD-TRANSIENT-DATA-AREA.                                      00350000
P25428     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.       00360000
P25428     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4            00370000
P25428                                 COMP SYNC.                       00380000
P25428     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.       00390000
P25428     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80           00400000
P25428                                 COMP SYNC.                       00410000
P25428                                                                  00420000
P25428 01  JL-JCL-WORK-AREA.                                            00430000
P25428     05  JL-JCL-INK950-LINE-1.                                    00440000
P25428         10  FILLER                     PIC X(02)    VALUE '//'.  00450000
P25428         10  JL-JCL-INK950-JOBNAME      PIC X(08)    VALUE SPACES.00460000
P25428         10  FILLER REDEFINES JL-JCL-INK950-JOBNAME.              00470000
P25428             15  FILLER                 PIC X(07).                00480000
P25428             15  JL-JCL-INK950-JOB-UNQ  PIC X(01).                00490000
P25428         10  FILLER                     PIC X(11)    VALUE        00500000
P25428             ' JOB KOHLS,'.                                       00510000
P25428         10  FILLER                     PIC X(01)    VALUE QUOTE. 00520000
P25428         10  FILLER                     PIC X(18)    VALUE        00530000
P25428             'INV ADJUST DTL RPT'.                                00540000
P25428         10  FILLER                     PIC X(01)    VALUE QUOTE. 00550000
P25428         10  FILLER                     PIC X(01)    VALUE ','.   00560000
P25428     05  JL-JCL-INK950-LINE-2.                                    00570000
P25428         10  FILLER                     PIC X(21)    VALUE        00580000
P25428             '//             CLASS='.                             00590000
P25428         10  JL-JCL-INK950-JOBCLASS     PIC X(01)    VALUE 'Q'.   00600000
P25428         10  FILLER                     PIC X(10)    VALUE        00610000
P25428             ',MSGCLASS='.                                        00620000
P25428         10  JL-JCL-INK950-MSGCLASS     PIC X(01)    VALUE 'P'.   00630000
P25428         10  JL-JCL-INK950-NOTIFY-OPT   PIC X(16)    VALUE SPACES.00640000
P25428     05  JL-JCL-INK950-LINE-3.                                    00650000
P25428         10  FILLER                     PIC X(13)    VALUE        00660000
P25428             '/*JOBPARM K=0'.                                     00670000
P25428     05  JL-JCL-INK950-CMT-SHORT.                                 00680000
P25428         10  FILLER                     PIC X(03)    VALUE '//*'. 00690000
P25428     05  JL-JCL-INK950-CMT-LONG.                                  00700000
P25428         10  FILLER                     PIC X(40)    VALUE        00710000
P25428             '//**************************************'.          00720000
P25428         10  FILLER                     PIC X(32)    VALUE        00730000
P25428             '********************************'.                  00740000
P25428     05  JL-JCL-INK950-CMT-USER-INFO.                             00750000
P25428         10  FILLER                     PIC X(26)    VALUE        00760000
P25428             '//* INK950 - SUBMITTED BY '.                        00770000
P25428         10  JL-JCL-INK950-CMT-USRID    PIC X(08)    VALUE SPACES.00780000
P25428         10  FILLER                     PIC X(06)    VALUE        00790000
P25428             ' FROM '.                                            00800000
P25428         10  JL-JCL-INK950-CMT-REGION   PIC X(08)    VALUE SPACES.00810000
P25428         10  FILLER                     PIC X(04)    VALUE        00820000
P25428             ' ON '.                                              00830000
P25428         10  JL-JCL-INK950-CMT-SUBDATE  PIC X(10)    VALUE SPACES.00840000
P25428         10  FILLER                     PIC X(02)    VALUE SPACES.00850000
P25428         10  JL-JCL-INK950-CMT-SUBTIME  PIC X(08)    VALUE SPACES.00860000
P25428     05  JL-JCL-INK950-CMT-1.                                     00870000
P25428         10  FILLER                     PIC X(40)    VALUE        00880000
P25428             '//* THIS JOB PRODUCES A DETAILED REPORT '.          00890000
P25428         10  FILLER                     PIC X(32)    VALUE        00900000
P25428             'OF SKU / UPC ADJUSTMENTS        '.                  00910000
P25428     05  JL-JCL-INK950-CMT-2.                                     00920000
P25428         10  FILLER                     PIC X(40)    VALUE        00930000
P25428             '//* REPORT AND PRINT THEM AT THE USER DE'.          00940000
P25428         10  FILLER                     PIC X(32)    VALUE        00950000
P25428             'FAULT PRINT DESTINATION OR      '.                  00960000
P25428     05  JL-JCL-INK950-CMT-3.                                     00970000
P25428         10  FILLER                     PIC X(40)    VALUE        00980000
P25428             '//* LOCAL, IF THERE IS NO DEFAULT PRINTE'.          00990000
P25428         10  FILLER                     PIC X(32)    VALUE        01000000
P25428             'R DEFINED TO THE USER.          '.                  01010000
P25428     05  JL-JCL-INK950-CMT-4.                                     01020000
P25428         10  FILLER                     PIC X(22)    VALUE        01030000
P25428             '//* OPTION REQUESTED: '.                            01040000
P25428         10  JL-JCL-INK950-CMT-OPTION   PIC X(35)    VALUE SPACES.01050000
P25428     05  JL-JCL-INK950-LINE-10.                                   01060000
P25428         10  FILLER                     PIC X(39)    VALUE        01070000
P25428             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.           01080000
P25428     05  JL-JCL-INK950-LINE-11.                                   01090000
P25428         10  FILLER                     PIC X(03)    VALUE        01100000
P25428             '//*'.                                               01110000
P25428     05  JL-JCL-INK950-LINE-12.                                   01120000
P25428         10  FILLER                     PIC X(32)    VALUE        01130000
P25428             '//PS020    EXEC INK9501,PRTDEST='.                  01140000
P25428         10  JL-JCL-INK950-PRTDEST      PIC X(08)    VALUE        01150000
P25428             'LOCAL'.                                             01160000
P25428     05  JL-JCL-INK950-LINE-13.                                   01170000
P25428         10  FILLER                     PIC X(20)    VALUE        01180000
P25428             '//S010.SYSUT1   DD *'.                              01190000
P25428     05  JL-JCL-INK950-LINE-14.                                   01200000
P25428         10  JL-JCL-INK950-REQ-OPTION   PIC X(44).                01210000
P25428     05  JL-JCL-INK950-LINE-EOD.                                  01220000
P25428         10  FILLER                     PIC X(02)    VALUE '/*'.  01230000
P25428     05  JL-JCL-INK950-LINE-EOF.                                  01240000
P25428         10  FILLER                     PIC X(05)    VALUE        01250000
P25428             '/*EOF'.                                             01260000
P25428     05  JL-JCL-TEST-LINE-10.                                     01270000
P25428         10  FILLER                     PIC X(35)    VALUE        01280000
P25428             '//PROCS  JCLLIB ORDER=(TKMA.PROCLIB'.               01290000
P25428         10  FILLER                     PIC X(20)    VALUE        01300000
P25428             ',QKMO.PROCLIB.STAGE)'.                              01310000
P25428     05  JL-JCL-TEST-LINE-11A.                                    01320000
P25428         10  FILLER                     PIC X(39)    VALUE        01330000
P25428             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.           01340000
P25428     05  JL-JCL-TEST-LINE-11B.                                    01350000
P25428         10  FILLER                     PIC X(39)    VALUE        01360000
P25428             '//         DD DSN=QKMO.LOADLIB,DISP=SHR'.           01370000
P25428     05  JL-JCL-TEST-LINE-11C.                                    01380000
P25428         10  FILLER                     PIC X(39)    VALUE        01390000
P25428             '//         DD DSN=PKMO.LOADLIB,DISP=SHR'.           01400000
P25428     05  JL-JCL-TEST-NOTIFY.                                      01410000
P25428         10  FILLER                     PIC X(08)    VALUE        01420000
P25428             ',NOTIFY='.                                          01430000
P25428         10  JL-JCL-TEST-USER           PIC X(08)    VALUE SPACES.01440000
P25428     05  JL-JCL-INK950-CC-INFO.                                   01450000
P25428         10  FILLER                     PIC X(03)    VALUE        01460000
P25428             'SKU'.                                               01470000
P25428         10  FILLER                     PIC X(01)    VALUE SPACES.01480000
P25428*        10  JL-JCL-INK950-STR-NBR.                               01490000
729187*            15  FILLER                 PIC X(01)    VALUE '0'.   01500000
729187*            15  JL-JCL-INK950-STORE    PIC X(03)    VALUE SPACES.01510000
729187         10  JL-JCL-INK950-STORE        PIC X(04)    VALUE SPACES.01511000
P25428         10  FILLER                     PIC X(01)    VALUE SPACES.01520000
P25428         10  JL-JCL-INK950-AREA         PIC X(07)    VALUE SPACES.01530000
P25428         10  FILLER                     PIC X(01)    VALUE SPACES.01540000
P25428         10  JL-JCL-INK950-SKU          PIC X(08)    VALUE SPACES.01550000
P25428         10  FILLER                     PIC X(01)    VALUE SPACES.01560000
P25428         10  JL-JCL-INK950-RETAIL       PIC X(07)    VALUE SPACES.01570000
P25428                                                                  01580000
W26600         10  FILLER                     PIC X(01)    VALUE SPACES.01581000
W26600         10  JL-JCL-INK950-USERID       PIC X(07)    VALUE SPACES.01582000
W26600         10  FILLER                     PIC X(01)    VALUE SPACES.01583000
W26600         10  JL-JCL-INK950-PRT-IND      PIC X(01)    VALUE SPACES.01583100
                                                                        01584000
00031  01  PC-PROGRAM-CONSTANTS.                                        01590000
00032      05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'INKCS054'.  01600000
00033      05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'IN054A  '.  01610000
00034      05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'INKM054 '.  01620000
00035      05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           01630000
00036                                               COMP.               01640000
00037      05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           01650000
00038                                               COMP.               01660000
00039      05  PC-INTER-APPL-CODES.                                     01670000
00040          10  PC-INTER-APPL-CRIT-SPEC                              01680000
00041                                   PIC  X(01)  VALUE '1'.          01690000
00042          10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          01700000
00043      05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       01710000
00044      05  PC-ASTERISK              PIC  X(01)  VALUE '*'.          01720000
00045      05  PC-COMPANY               PIC  X(02)  VALUE '03'.         01730000
25248      05  PC-4                     PIC  9(01)  VALUE 4.            01740000
00047      05  PC-6                     PIC  9(01)  VALUE 6.            01750000
00050                                                                   01760000
00051      05  PC-TSYMSG-NUMBERS.                                       01770000
00052          10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       01780000
00053          10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       01790000
00054          10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       01800000
00055          10  PC-TSYMSG-00017      PIC  9(05)  VALUE  00017.       01810000
00056          10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       01820000
00057          10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       01830000
00058          10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       01840000
00059          10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       01850000
P25428         10  PC-TSYMSG-00098      PIC  9(05)  VALUE  00098.       01860000
00060          10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       01870000
00061          10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       01880000
00062          10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       01890000
00063          10  PC-TSYMSG-02472      PIC  9(05)  VALUE  02472.       01900000
00064          10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       01910000
00065          10  PC-TSYMSG-00697      PIC  9(05)  VALUE  00697.       01920000
00066          10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       01930000
00067          10  PC-TSYMSG-99903      PIC  9(05)  VALUE  99903.       01940000
00068                                                                   01950000
00069  01  PS-PROGRAM-SWITCHES.                                         01960000
00070      05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01970000
00071          88  PS-ERROR                         VALUE  'Y'.         01980000
00072          88  PS-NO-ERROR                      VALUE  'N'.         01990000
00073      05  PS-STORE-INVENTORY-SW    PIC  X(01)  VALUE  'Y'.         02000000
00074          88  PS-STORE-INVENTORIED             VALUE  'N'.         02010000
RB0115     05  PS-STORE-AREA-FOUND-SW   PIC  X(01)  VALUE  'N'.         02020000
RB0115         88  PS-STORE-AREA-FOUND              VALUE  'Y'.         02030000
RB0115         88  PS-STORE-AREA-NOT-FOUND          VALUE  'N'.         02040000
P25428     05  PS-INTERNAL-READER-ENQ-DEQ-IND PIC X(1)    VALUE 'D'.    02050000
P25428         88  PS-INTERNAL-READER-ENQUEUED            VALUE 'E'.    02060000
P25428         88  PS-INTERNAL-READER-DEQUEUED            VALUE 'D'.    02070000
00075                                                                   02080000
00076  01  PV-PROGRAM-VARIABLES.                                        02090000
00077      05  PV-CICS-RESP             PIC S9(04)  VALUE +0            02100000
00078                                               COMP SYNC.          02110000
00079      05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            02120000
00080                                               COMP SYNC.          02130000
00081      05  PV-ASTERISK-CNT          PIC S9(04)  VALUE +0            02140000
00082                                               COMP SYNC.          02150000
00083      05  PV-NULL                  PIC S9(04)  VALUE +0            02160000
00084                                               COMP SYNC.          02170000
P25428     05  PV-CICS-ID.                                              02180000
P25428         10  PV-FIRST-4              PIC X(4)       VALUE SPACES. 02190000
P25428         10  PV-CICS-REGION-TYPE     PIC X          VALUE SPACE.  02200000
P25428             88  PV-CICS-REGION-PRODUCTION          VALUE 'P'.    02210000
P25428             88  PV-CICS-REGION-ACCEPTANCE          VALUE 'A'.    02220000
P25428             88  PV-CICS-REGION-QUALITY             VALUE 'Q'.    02230000
P25428             88  PV-CICS-REGION-LEARNING            VALUE 'L'.    02240000
P25428             88  PV-CICS-REGION-TEST                VALUE 'T'.    02250000
P25428             88  PV-CICS-REGION-SYSTEST             VALUE 'S'.    02260000
P25428         10  PV-CICS-REGION-CODE     PIC X          VALUE SPACES. 02270000
P25428         10  PV-LAST-2               PIC X(2)       VALUE SPACES. 02280000
00085                                                                   02290000
W30692     05  PV-EDIT-LOC-NBR           PIC 9(04)  VALUE ZEROS.        02290103
W30692     05  PV-EDIT-LOC-NBR-RED REDEFINES                            02290203
W30692         PV-EDIT-LOC-NBR.                                         02290303
W30692         10  PV-EDIT-LOC-NBR-P1    PIC 9(01).                     02290403
W30692         10  PV-EDIT-LOC-NBR-P2    PIC 9(03).                     02290503
W30692     05  PV-USER-USER-CODE         PIC X(08)  VALUE SPACES.       02290603
00085                                                                   02291003
00092      COPY INKM054.                                                02300000
00093                                                                   02310000
00099      COPY DPWS015.                                                02320000
00100                                                                   02330000
00105      COPY DPWS016.                                                02340000
00106                                                                   02350000
00112      COPY DPWS010I.                                               02360000
                                                                        02370000
00118      COPY DPWS030.                                                02380000
1122RM     COPY DPWS930.                                                02381013
                                                                        02390000
00124      COPY DPWS020.                                                02400000
00125      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02410000
00126                                                                   02420000
00131          10  INTER-APPL-COMM-AREA PIC X(200).                     02430000
                                                                        02440000
25248      COPY INWS001.                                                02450000
00136          10  ASC-SPECIFIC-COMMAREA.                               02460000
00137              15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            02470000
25248              15  ASC-STORE-NBRX            PIC  X(04).            02480000
00139              15  ASC-STORE-NBR  REDEFINES ASC-STORE-NBRX          02490000
25248                                            PIC  9(04).            02500000
00141              15  ASC-AREA-NBRX.                                   02510000
00142                  20  ASC-AREA-NBR          PIC  9(06).            02520000
00143              15  ASC-STORE-NAME            PIC  X(25).            02530000
00144              15  ASC-HOLD-INTER-APPL       PIC  X(200).           02540000
25248          10  FILLER                        PIC  X(199).           02550000
00146      EJECT                                                        02560000
00150                                                                   02570000
00151      COPY DPWS013.                                                02580000
00152                                                                   02590000
00157      COPY DPWS017.                                                02600000
00158                                                                   02610000
00010 ******************************************************************02620000
00160 *    STORE TABLE                                                 *02630000
00010 ******************************************************************02640000
00163      EXEC SQL                                                     02650000
25248           INCLUDE XMT00001                                        02660000
00165      END-EXEC.                                                    02670000
00166                                                                   02680000
00010 ******************************************************************02690000
00168 *    INVENTORY PARAMETERS TABLE                                  *02700000
00010 ******************************************************************02710000
00171      EXEC SQL                                                     02720000
00172           INCLUDE TINVPAR                                         02730000
00173      END-EXEC.                                                    02740000
00174                                                                   02750000
W33304******************************************************************02751010
W33304*    INVENTORY CONTROL TABLE                                     *02752010
W33304******************************************************************02753010
W33304     EXEC SQL                                                     02754010
W33304          INCLUDE TINCNTL                                         02755010
W33304     END-EXEC.                                                    02756010
W33304                                                                  02757010
00010 ******************************************************************02760000
00176 *    INVENTORY LOCATION TABLE                                    *02770000
00010 ******************************************************************02780000
00179      EXEC SQL                                                     02790000
00180           INCLUDE TINVLOC                                         02800000
00181      END-EXEC.                                                    02810000
00182                                                                   02820000
00010 ******************************************************************02830000
00176 *    INVENTORY SUM DATA LOADED VIA INK300                        *02840000
00010 ******************************************************************02850000
00179      EXEC SQL                                                     02860000
00180           INCLUDE TSUMINV                                         02870000
00181      END-EXEC.                                                    02880000
00182                                                                   02890000
00010 ******************************************************************02900000
00176 *    INVENTORY ADJUSTMENT ADD TABLE                              *02910000
00010 ******************************************************************02920000
00179      EXEC SQL                                                     02930000
00180           INCLUDE TADJADD                                         02940000
00181      END-EXEC.                                                    02950000
00182                                                                   02960000
00010 ******************************************************************02970000
00176 *    USER PRINT DEFAULT TABLE                                    *02980000
00010 ******************************************************************02990000
00179      EXEC SQL                                                     03000000
00180           INCLUDE TUSER                                           03010000
00181      END-EXEC.                                                    03020000
00182                                                                   03030000
00010 ******************************************************************03040000
00184 *    COMMUNICATIONS AREA                                         *03050000
00010 ******************************************************************03060000
00187      EXEC SQL                                                     03070000
00188           INCLUDE SQLCA                                           03080000
00189      END-EXEC.                                                    03090000
00190                                                                   03100000
00010 /*****************************************************************03110000
00192  LINKAGE SECTION.                                                 03120000
00010 ******************************************************************03130000
00194  01  DFHCOMMAREA.                                                 03140000
00195      05  FILLER                         OCCURS  1 TO 4072 TIMES   03150000
00196                                         DEPENDING ON EIBCALEN.    03160000
00197          10  FILLER                     PIC X.                    03170000
00198                                                                   03180000
00199                                                                   03190000
00010 /*****************************************************************03200000
00202 ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03210000
00203 ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03220000
00204 ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03230000
00205 **                                                             ** 03240000
00206 ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03250000
00207 ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03260000
00010 ******************************************************************03270000
00200  PROCEDURE DIVISION.                                              03280000
00010 ******************************************************************03290000
00209                                                                   03300000
00210  0000-MAIN-MODULE.                                                03310000
00211                                                                   03320000
00212      INITIALIZE DP030-CICS-API-FIELDS.                            03330000
00213      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03340000
00214      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03350000
00215      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03360000
00216      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03370000
00217                                                                   03380000
00218      MOVE LENGTH OF IN054AI        TO DP030-MAP-LENGTH (1).       03390000
00219      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03400000
00220      PERFORM 0001-CALL-CICS-ARCH-API.                             03410000
00221                                                                   03420000
00222      PERFORM 1000-CONTROL-PROCESSING                              03430000
00223                                                                   03440000
00224      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03450000
00225      PERFORM 0001-CALL-CICS-ARCH-API.                             03460000
00226                                                                   03470000
00227  0001-CALL-CICS-ARCH-API.                                         03480000
00228                                                                   03490000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               03500013
1122RM     CALL DP930-CICS-ARCH-API                                     03501013
1122RM                     USING DFHEIBLK                               03502013
00230                            DFHCOMMAREA                            03510000
00231                            DP030-CICS-API-FIELDS                  03520000
00232                            DP020-STANDARD-COMMAREA                03530000
00233                            IN054AI.                               03540000
00234                                                                   03550000
00235      IF  DP030-RC-CALL-SUCCESSFUL                                 03560000
00236          CONTINUE                                                 03570000
00237      ELSE                                                         03580000
00238          SET DP013-NO-ROLLBACK                                    03590000
00239              DP013-XCTL-DISPLAY-RESTART                           03600000
00240              DP013-CICS-ABEND      TO TRUE                        03610000
00241          MOVE 'BEFORE 0000-MAIN-MODULE'                           03620000
00242                                    TO DP013-PARAGRAPH             03630000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03640013
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03650013
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03651013
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03652013
00245          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03660000
00246          PERFORM DP013-0000-PROCESS-ABEND                         03670000
00247      END-IF.                                                      03680000
00248 /                                                                 03690000
00249 *----------------------------------------------------------------*03700000
00250 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03710000
00251 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03720000
00252 *----------------------------------------------------------------*03730000
00253                                                                   03740000
00254  1000-CONTROL-PROCESSING.                                         03750000
00255                                                                   03760000
00256      EVALUATE TRUE                                                03770000
00257          WHEN DP020-NEXT-ACT-INITIAL                              03780000
00258               INITIALIZE ASC-SPECIFIC-COMMAREA                    03790000
00259               PERFORM 4000-BUILD-INITIAL-PANEL                    03800000
00260                                                                   03810000
00261          WHEN DP020-NEXT-ACT-READ-MAP                             03820000
00262               PERFORM 2000-PROCESS-PANEL                          03830000
00263                                                                   03840000
00264          WHEN DP020-NEXT-ACT-RETURN                               03850000
00265               MOVE ASC-HOLD-INTER-APPL                            03860000
00266                                   TO INTER-APPL-COMM-AREA         03870000
00267               PERFORM 3000-EDIT-DATA-IN-COMMAREA                  03880000
00268               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03890000
00269                                                                   03900000
00270          WHEN OTHER                                               03910000
00271               SET DP013-LOGIC-ABEND TO TRUE                       03920000
00272               SET DP013-NO-ROLLBACK TO TRUE                       03930000
00273               MOVE '1000-CONTROL-PROCESSING'                      03940000
00274                                     TO DP013-PARAGRAPH            03950000
00275               MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  03960000
00276                                     TO DP013-MESSAGE-TEXT(1)      03970000
00277               MOVE DP020-NEXT-APPL-ACTIVITY                       03980000
00278                                     TO DP013-MESSAGE-TEXT(2)      03990000
00279               PERFORM DP013-0000-PROCESS-ABEND                    04000000
00280      END-EVALUATE.                                                04010000
00281 /                                                                 04020000
00282 *----------------------------------------------------------------*04030000
00283 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04040000
00284 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04050000
00285 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04060000
00286 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04070000
00287 * FUNCTION KEYS CAN GET THIS FAR.                                *04080000
00288 *----------------------------------------------------------------*04090000
00289                                                                   04100000
00290  2000-PROCESS-PANEL.                                              04110000
00291                                                                   04120000
00292      SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      04130000
00293      IF  IN001-STORE-NBR NOT NUMERIC                              04140000
00294          MOVE ASC-HOLD-INTER-APPL TO INTER-APPL-COMM-AREA         04150000
00295      END-IF.                                                      04160000
00296                                                                   04170000
00297      EVALUATE TRUE                                                04180000
00298                                                                   04190000
00299          WHEN DP020-SRC-AID = DP016-CLEAR                         04200000
00300               PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04210000
00301               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                04220000
00302                                                                   04230000
00303          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04240000
00304               SET DP030-DONT-ERASE                                04250000
00305                   DP030-SEND-DATAONLY (PC-APPL-MAP)               04260000
00306                                    TO TRUE                        04270000
00307               PERFORM 4000-BUILD-INITIAL-PANEL                    04280000
00308               PERFORM 3200-RESET-ATTRIBUTES                       04290000
00309                                                                   04300000
00310          WHEN OTHER                                               04310000
00311               PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                04320000
00312               PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04330000
00313               IF  PS-NO-ERROR                                     04340000
00314                   SET DP030-CONTINUE-GO                           04350000
00315                                    TO TRUE                        04360000
00316                   PERFORM 2100-CHECK-FUNCTION-KEY                 04370000
00317               ELSE                                                04380000
00318                   SET DP030-OVERRIDE-GO                           04390000
00319                                    TO TRUE                        04400000
00320               END-IF                                              04410000
00321      END-EVALUATE.                                                04420000
00322                                                                   04430000
00323 *----------------------------------------------------------------*04440000
00324 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04450000
00325 * FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *04460000
00326 * FROM THE CICS ARCHITECTURE API.                                *04470000
00327 *----------------------------------------------------------------*04480000
00328                                                                   04490000
00329  2100-CHECK-FUNCTION-KEY.                                         04500000
00330                                                                   04510000
00331      EVALUATE TRUE                                                04520000
00332          WHEN DP020-SRC-AID = DP016-ENTER                         04530000
00333               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                04540000
00334                                                                   04550000
00335          WHEN DP020-FK-LOCAL-GOTO    (DP020-SRC-AID)              04560000
W21015         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              04570000
00336               MOVE INTER-APPL-COMM-AREA                           04580000
00337                                    TO  ASC-HOLD-INTER-APPL        04590000
P25428         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              04600000
P25428             PERFORM 8000-FORMAT-AND-SUBMIT                       04610000
**********         PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   04620000
P25428             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04630000
P25428             MOVE PC-TSYMSG-00098 TO DP020-MSG-NUMBER             04640000
P25428             SET DP020-MSG-INFORMATIONAL TO TRUE                  04650000
P25428                                                                  04660000
00338                                                                   04670000
00339          WHEN OTHER                                               04680000
00340              SET DP013-NO-ROLLBACK                                04690000
00341                  DP013-XCTL-DISPLAY-RESTART                       04700000
00342                  DP013-CICS-ABEND  TO TRUE                        04710000
00343              MOVE '2000-PROCESS-PANEL'                            04720000
00344                                    TO DP013-PARAGRAPH             04730000
00345              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04740000
00346                                    TO DP013-MESSAGE-TEXT (1)      04750000
00347              PERFORM DP013-0000-PROCESS-ABEND                     04760000
00348      END-EVALUATE.                                                04770000
00349                                                                   04780000
00350 /                                                                 04790000
00351 *----------------------------------------------------------------*04800000
00352 * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *04810000
00353 * IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *04820000
00354 * THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *04830000
00355 *----------------------------------------------------------------*04840000
00356                                                                   04850000
00357  2200-MOVE-SCREEN-TO-COMMAREA.                                    04860000
00358                                                                   04870000
00359      IF  ASTOREL > ZERO                                           04880000
00360          MOVE ASTOREI              TO ASC-STORE-NBRX              04890000
00361      ELSE                                                         04900000
00362          IF  ASTOREF = DP015-ERASE-EOF                            04910000
00363              MOVE SPACE            TO ASC-STORE-NBRX              04920000
00364          END-IF                                                   04930000
00365      END-IF.                                                      04940000
00366                                                                   04950000
00367      IF  AAREAL > ZERO                                            04960000
00368          MOVE AAREAI               TO ASC-AREA-NBRX               04970000
00369      ELSE                                                         04980000
00370          IF  AAREAF = DP015-ERASE-EOF                             04990000
00371              MOVE SPACE            TO ASC-AREA-NBRX               05000000
00372          END-IF                                                   05010000
00373      END-IF.                                                      05020000
00374                                                                   05030000
00375 /                                                                 05040000
00376 *----------------------------------------------------------------*05050000
00377 * PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *05060000
00378 * IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *05070000
00379 * APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *05080000
00380 *----------------------------------------------------------------*05090000
00381                                                                   05100000
00382  3000-EDIT-DATA-IN-COMMAREA.                                      05110000
00383                                                                   05120000
00384      PERFORM 3200-RESET-ATTRIBUTES.                               05130000
00385      SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      05140000
00386                                                                   05150000
00387      MOVE ASC-AREA-NBRX            TO  DP010I-UNEDITED-FIELD.     05160000
00388      MOVE PC-6                     TO  DP010I-MAXIMUM-DIGITS.     05170000
00389      MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   05180000
00390      SET DP010I-NEGATIVE-NOT-ALLOWED                              05190000
00391                                    TO  TRUE.                      05200000
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05211012
263126          USING DP010I-NUMERIC-EDIT-AREA.                         05212012
00393                                                                   05220000
00394      IF  DP010I-ERROR-DETECTED                                    05230000
00395          SET  PS-ERROR                                            05240000
00396               DP020-MSG-FATAL      TO  TRUE                       05250000
00397          MOVE PC-TSYMSG-00005      TO  DP020-MSG-NUMBER           05260000
00398          MOVE DP015-UNP-ALP-BRT-OFF                               05270000
00399                                    TO  AAREAA                     05280000
00400          MOVE DP015-RED            TO  AAREAC                     05290000
00401          MOVE DP015-REVERSE        TO  AAREAH                     05300000
00402          MOVE -1                   TO  AAREAL                     05310000
00403      ELSE                                                         05320000
00404          MOVE DP010I-NUMERIC-FIELD                                05330000
00405                                    TO  ASC-AREA-NBR               05340000
00406                                        IN001-AREA-NBR             05350000
00407      END-IF.                                                      05360000
00408                                                                   05370000
00409                                                                   05380000
00410      MOVE ASC-STORE-NBRX           TO  DP010I-UNEDITED-FIELD.     05390000
25248      MOVE PC-4                     TO  DP010I-MAXIMUM-DIGITS.     05400000
00412      MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   05410000
00413      SET DP010I-NEGATIVE-NOT-ALLOWED                              05420000
00414                                    TO  TRUE.                      05430000
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                             05441012
263126          USING DP010I-NUMERIC-EDIT-AREA.                         05442012
00416                                                                   05450000
00417      IF  DP010I-ERROR-DETECTED                                    05460000
00418          SET  PS-ERROR                                            05470000
00419               DP020-MSG-FATAL      TO  TRUE                       05480000
00420          MOVE PC-TSYMSG-00005      TO  DP020-MSG-NUMBER           05490000
00421          MOVE DP015-UNP-ALP-BRT-OFF                               05500000
00422                                    TO  ASTOREA                    05510000
00423          MOVE DP015-RED            TO  ASTOREC                    05520000
00424          MOVE DP015-REVERSE        TO  ASTOREH                    05530000
00425          MOVE -1                   TO  ASTOREL                    05540000
00426      ELSE                                                         05550000
00427          MOVE DP010I-NUMERIC-FIELD                                05560000
00428                                    TO  ASC-STORE-NBR              05570000
00429      END-IF.                                                      05580000
00430                                                                   05590000
00431      PERFORM 4100-GET-STORE-NAME.                                 05600000
00432      IF  SQLCODE NOT EQUAL ZERO                                   05610000
00433          SET  PS-ERROR                                            05620000
00434               DP020-MSG-FATAL      TO  TRUE                       05630000
00435          MOVE PC-TSYMSG-00017      TO  DP020-MSG-NUMBER           05640000
00436          MOVE DP015-UNP-ALP-BRT-OFF                               05650000
00437                                    TO  ASTOREA                    05660000
00438          MOVE DP015-RED            TO  ASTOREC                    05670000
00439          MOVE DP015-REVERSE        TO  ASTOREH                    05680000
00440          MOVE -1                   TO  ASTOREL                    05690000
00441      ELSE                                                         05700000
25248          MOVE XMT00001-LOC-NM (1:25) TO ASTRNAMO                  05710000
00443                                        IN001-STORE-NAME           05720000
25248 *        MOVE ASC-STORE-NBR (2:3)  TO  IN001-STORE-NBR            05730000
W26600         MOVE ASC-STORE-NBR        TO  IN001-STORE-NBR            05740000
00445      END-IF.                                                      05750000
00446                                                                   05760000
00447      IF  PS-NO-ERROR                                              05770000
RB0115         MOVE 'N'                  TO PS-STORE-AREA-FOUND-SW      05780000
RB0115         PERFORM 3100-CONTINUE-CHECKING                           05790000
R25248******   IF PS-STORE-AREA-NOT-FOUND                               05800000
R25248         IF PS-NO-ERROR                                           05810000
RB0115             PERFORM 4500-READ-TSUMINV                            05820000
RB0115             IF  PS-NO-ERROR                                      05830000
RB0115                 MOVE -1               TO  ASTOREL                05840000
RB0115             END-IF                                               05850000
R25248         END-IF                                                   05860000
           END-IF.                                                      05870000
W21015                                                                  05880000
00454 *----------------------------------------------------------------*05890000
00455 *    NOW CHECK IF THE INVENTORY PARAMETERS ARE OK AND THAT THE   *05900000
00456 *    AREA EXISTS FOR THE STORE.                                  *05910000
00457 *----------------------------------------------------------------*05920000
00458                                                                   05930000
00459  3100-CONTINUE-CHECKING.                                          05940000
00460                                                                   05950000
00461      PERFORM 4200-READ-TINVPAR.                                   05960000
00462                                                                   05970000
00463      IF  NOT PS-STORE-INVENTORIED                                 05980000
00464          SET PS-ERROR                                             05990000
00465              DP020-MSG-FATAL       TO  TRUE                       06000000
W21015         MOVE PC-TSYMSG-02472      TO  DP020-MSG-NUMBER           06010000
00467          MOVE DP015-UNP-ALP-BRT-OFF                               06020000
00468                                    TO  ASTOREA                    06030000
00469          MOVE DP015-RED            TO  ASTOREC                    06040000
00470          MOVE DP015-REVERSE        TO  ASTOREH                    06050000
00471          MOVE -1                   TO  ASTOREL                    06060000
00472      ELSE                                                         06070000
00473          PERFORM 4300-READ-TINVLOC                                06080000
00484      END-IF.                                                      06090000
00485                                                                   06100000
00486 *----------------------------------------------------------------*06110000
00487 * MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *06120000
00488 * MAP.                                                           *06130000
00489 *----------------------------------------------------------------*06140000
00490                                                                   06150000
00491  3200-RESET-ATTRIBUTES.                                           06160000
00492                                                                   06170000
00493      MOVE DP015-UNP-ALP-NOR-OFF    TO  AAREAA                     06180000
00494                                        ASTOREA.                   06190000
00495      MOVE DP015-GREEN              TO  AAREAC                     06200000
00496                                        ASTOREC.                   06210000
00497      MOVE DP015-UNDERLINE          TO  AAREAH                     06220000
00498                                        ASTOREH.                   06230000
00499                                                                   06240000
00500 /                                                                 06250000
00501 *----------------------------------------------------------------*06260000
00502 *    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *06270000
00503 *    ENTRY.                                                      *06280000
00504 *----------------------------------------------------------------*06290000
00505                                                                   06300000
00506  4000-BUILD-INITIAL-PANEL.                                        06310000
00507                                                                   06320000
00508      SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      06330000
00509      MOVE -1                       TO  ASTOREL.                   06340000
00510      MOVE LOW-VALUES               TO  ASC-STORE-NBRX.            06350000
00511      MOVE LOW-VALUES               TO  ASC-AREA-NBRX.             06360000
00512      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        06370000
00513 /                                                                 06380000
00514 *----------------------------------------------------------------*06390000
00515 * SELECT A ROW FROM THE DB2 STORE TABLE.                         *06400000
00516 *----------------------------------------------------------------*06410000
00517                                                                   06420000
00518  4100-GET-STORE-NAME.                                             06430000
00519                                                                   06440000
25248          MOVE ASC-STORE-NBR TO XMT00001-LOC-NBR.                  06450000
25248                                                                   06460000
00520          EXEC SQL                                                 06470000
25248              SELECT LOC_NM                                        06480000
25248              INTO :XMT00001-LOC-NM                                06490000
25248              FROM XMT_LOC                                         06500000
25248              WHERE  LOC_NBR = :XMT00001-LOC-NBR                   06510000
00530          END-EXEC.                                                06520000
00531                                                                   06530000
00532          EVALUATE TRUE                                            06540000
00533              WHEN SQLCODE = ZERO                                  06550000
00534              WHEN SQLCODE = +100                                  06560000
00535                  CONTINUE                                         06570000
00536              WHEN SQLCODE = -904                                  06580000
00537              WHEN SQLCODE = -913                                  06590000
00538                   PERFORM 9900-SOFT-ABORT                         06600000
00539              WHEN SQLWARN0 NOT = SPACES                           06610000
00540              WHEN SQLCODE NOT EQUAL ZERO                          06620000
00541                  MOVE '4100-GET-STORE-NAME'                       06630000
00542                                    TO DP013-PARAGRAPH             06640000
00543                  MOVE 'SELECT STORE NAME'                         06650000
00544                                    TO DP013-MESSAGE-TEXT (1)      06660000
00545                  MOVE SQLCA        TO DP013-SQLCA                 06670000
25248                  MOVE 'XMT_LOC'    TO DP013-DB2-TABLE-NAME (1)    06680000
00547                  SET DP013-DB2-ABEND                              06690000
00548                      DP013-XCTL-DISPLAY-RESTART                   06700000
00549                                    TO TRUE                        06710000
00550                  PERFORM DP013-0000-PROCESS-ABEND                 06720000
00551          END-EVALUATE.                                            06730000
00552 /                                                                 06740000
00553 *----------------------------------------------------------------*06750000
00554 *     GET THE ACTUAL DATE AND SCAN SWITCH.                       *06760000
00555 *----------------------------------------------------------------*06770000
00556                                                                   06780000
00557  4200-READ-TINVPAR.                                               06790000
00558                                                                   06800000
25248          MOVE ASC-STORE-NBR TO INVPAR-LOC-NBR.                    06810000
25248                                                                   06820000
00559          EXEC SQL                                                 06830000
W33304             SELECT A.ACTL_INV_DTE                                06840010
W21015             INTO :INVPAR-ACTL-INV-DTE                            06850000
W33304             FROM TINVPAR A                                       06860011
W33304                 ,TINCNTL B                                       06861011
W33304             WHERE A.LOC_NBR = :INVPAR-LOC-NBR                    06870010
W33304               AND B.ACTV_IND = 'Y'                               06871010
W33304               AND A.INV_ID = B.INV_ID                            06872010
W33304               AND A.LOC_INV_STAT_CDE = 'IN'                      06874010
W33304               AND A.ACTL_FIN_BK_DTE = '9999-09-09'               06875010
00568          END-EXEC.                                                06880000
00569                                                                   06890000
00570          EVALUATE TRUE                                            06900000
00571              WHEN SQLCODE = ZERO                                  06910000
00572                   CONTINUE                                        06920000
00573              WHEN SQLCODE = +100                                  06930000
W21015             WHEN SQLCODE = -305                                  06940000
W21015                  SET PS-ERROR    TO  TRUE                        06950000
00575              WHEN SQLCODE = -904                                  06960000
00576              WHEN SQLCODE = -913                                  06970000
00577                   PERFORM 9900-SOFT-ABORT                         06980000
00578              WHEN SQLWARN0 NOT = SPACES                           06990000
00579              WHEN SQLCODE NOT EQUAL ZERO                          07000000
00580                  MOVE '4200-READ-TINVPAR - 1'                     07010000
00581                                    TO DP013-PARAGRAPH             07020000
00582                  MOVE 'SELECT STORE NAME'                         07030000
00583                                    TO DP013-MESSAGE-TEXT (1)      07040000
00584                  MOVE SQLCA        TO DP013-SQLCA                 07050000
25248                  MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)    07060000
00586                  SET DP013-DB2-ABEND                              07070000
00587                      DP013-XCTL-DISPLAY-RESTART                   07080000
00588                                    TO TRUE                        07090000
00589                  PERFORM DP013-0000-PROCESS-ABEND                 07100000
00590          END-EVALUATE.                                            07110000
00591                                                                   07120000
00592      IF  SQLCODE EQUAL ZERO                                       07130000
25248          MOVE ASC-STORE-NBR TO INVPAR-LOC-NBR                     07140000
25248                                                                   07150000
00593          EXEC SQL                                                 07160000
00595              SELECT SCAN_INV_IND                                  07170000
00596                   , ACTL_INV_RECD_DTE                             07180000
00598              INTO :INVPAR-SCAN-INV-IND                            07190000
00599                  ,:INVPAR-ACTL-INV-RECD-DTE                       07200000
00600              FROM TINVPAR                                         07210000
25248              WHERE LOC_NBR = :INVPAR-LOC-NBR                      07220000
00605                AND ACTL_INV_DTE = :INVPAR-ACTL-INV-DTE            07230000
00606          END-EXEC                                                 07240000
00607                                                                   07250000
00608          EVALUATE TRUE                                            07260000
00609              WHEN SQLCODE = ZERO                                  07270000
00610              WHEN SQLCODE = +100                                  07280000
00611                  CONTINUE                                         07290000
00612              WHEN SQLCODE = -904                                  07300000
00613              WHEN SQLCODE = -913                                  07310000
00614                   PERFORM 9900-SOFT-ABORT                         07320000
00615              WHEN SQLWARN0 NOT = SPACES                           07330000
00616              WHEN SQLCODE NOT EQUAL ZERO                          07340000
00617                  MOVE '4200-READ-TINVPAR - 2'                     07350000
00618                                    TO DP013-PARAGRAPH             07360000
00619                  MOVE 'SELECT STORE NAME'                         07370000
00620                                    TO DP013-MESSAGE-TEXT (1)      07380000
00621                  MOVE SQLCA        TO DP013-SQLCA                 07390000
25248                  MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)    07400000
00623                  SET DP013-DB2-ABEND                              07410000
00624                      DP013-XCTL-DISPLAY-RESTART                   07420000
00625                                    TO TRUE                        07430000
00626                  PERFORM DP013-0000-PROCESS-ABEND                 07440000
00627          END-EVALUATE                                             07450000
00628      END-IF.                                                      07460000
00629                                                                   07470000
00630      IF (SQLCODE = ZERO                                           07480000
00631      AND INVPAR-ACTL-INV-DTE GREATER THAN SPACES)                 07490000
00632          MOVE INVPAR-ACTL-INV-DTE  TO  IN001-DB2-ACTL-INV-DTE     07500000
00633          MOVE INVPAR-SCAN-INV-IND  TO  IN001-SCANNING-STORE-SW    07510000
00634                                                                   07520000
00635          PERFORM DP017-0000-GET-CURR-DATE-TIME                    07530000
00636          SET DP017-EDITED-YMD-DATE-DASH-1                         07540000
00637              DP017-EDITED-YMD-DATE-DASH-2                         07550000
00638                                    TO  TRUE                       07560000
00639          IF (INVPAR-ACTL-INV-DTE NOT > DP017-EDITED-DATE-YYYYMMDD 07570000
00640          AND INVPAR-ACTL-INV-RECD-DTE NOT >                       07580000
00641                                        DP017-EDITED-DATE-YYYYMMDD)07590000
00642              SET PS-STORE-INVENTORIED  TO  TRUE                   07600000
00643          END-IF                                                   07610000
00644      ELSE                                                         07620000
00645          MOVE 'NO PARAMETER DATA FOUND FOR THIS STORE'            07630000
00646                                    TO  DP020-MSG-MESSAGE          07640000
00647          SET PS-ERROR                                             07650000
00648              DP020-MSG-FATAL       TO  TRUE                       07660000
00649      END-IF.                                                      07670000
00650                                                                   07680000
00651 *----------------------------------------------------------------*07690000
00652 *    READ THE INVENTORY LOCATION TABLE TO ENSURE THE AREA        *07700000
00653 *    PASSED EXISTS.                                              *07710000
00654 *----------------------------------------------------------------*07720000
00655                                                                   07730000
00656  4300-READ-TINVLOC.                                               07740000
00657                                                                   07750000
00658       MOVE ASC-AREA-NBR            TO INVLOC-AREA-NBR.            07760000
25248 *     MOVE ASC-STORE-NBRX (2:3)    TO INVLOC-STORE-NBR.           07770000
W26600      MOVE ASC-STORE-NBR           TO INVLOC-LOC-NBR.             07780000
00659                                                                   07790000
00660       EXEC SQL                                                    07800000
00661           SELECT                                                  07810000
00662                 AREA_NBR                                          07820000
00663           INTO                                                    07830000
00664                 :INVLOC-AREA-NBR                                  07840000
00665           FROM                                                    07850000
00666                 TINVLOC                                           07860000
00667           WHERE                                                   07870000
25248 *               STORE_NBR    =   :INVLOC-STORE-NBR                07880000
W26600                LOC_NBR      =   :INVLOC-LOC-NBR                  07890000
00669             AND                                                   07900000
00670                 AREA_NBR     =   :INVLOC-AREA-NBR                 07910000
00671       END-EXEC.                                                   07920000
00672                                                                   07930000
00673       EVALUATE TRUE                                               07940000
00674           WHEN SQLCODE = ZERO                                     07950000
RB0115              MOVE 'Y' TO PS-STORE-AREA-FOUND-SW                  07960000
00675           WHEN SQLCODE = +100                                     07970000
00676               CONTINUE                                            07980000
00677           WHEN SQLCODE = -904                                     07990000
00678           WHEN SQLCODE = -913                                     08000000
00679                PERFORM 9900-SOFT-ABORT                            08010000
00680           WHEN SQLWARN0 NOT = SPACES                              08020000
00681           WHEN SQLCODE NOT EQUAL ZERO                             08030000
00682               MOVE '4300-READ-TINVLOC'                            08040000
00683                                 TO DP013-PARAGRAPH                08050000
00684               MOVE 'SELECT FOR AREA VALIDATION'                   08060000
00685                                 TO DP013-MESSAGE-TEXT (1)         08070000
00686               MOVE SQLCA        TO DP013-SQLCA                    08080000
00687               MOVE 'TINVLOC'    TO DP013-DB2-TABLE-NAME (1)       08090000
00688               SET DP013-DB2-ABEND                                 08100000
00689                   DP013-XCTL-DISPLAY-RESTART                      08110000
00690                                 TO TRUE                           08120000
00691               PERFORM DP013-0000-PROCESS-ABEND                    08130000
00692       END-EVALUATE.                                               08140000
00693                                                                   08150000
00694 *----------------------------------------------------------------*08160000
00695 *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *08170000
00696 *----------------------------------------------------------------*08180000
00697                                                                   08190000
00698  4400-MOVE-COMMAREA-TO-SCREEN.                                    08200000
00699                                                                   08210000
00700      MOVE IN001-STORE-NAME         TO  ASTRNAMO.                  08220000
00701      MOVE ASC-STORE-NBRX           TO  ASTOREO.                   08230000
00702      MOVE ASC-AREA-NBRX            TO  AAREAO.                    08240000
00703                                                                   08250000
W21015*----------------------------------------------------------------*08260000
W21015*    READ THE INVENTORY SUM TABLE. IF ROW EXISTS, CONTROL PASSED *08270000
W21015*    TO MASS ADD PROGRAM. IF NOT FOUND - LOOK ON TADJADD.        *08280000
W21015*----------------------------------------------------------------*08290000
W21015                                                                  08300000
W21015 4500-READ-TSUMINV.                                               08310000
W21015                                                                  08320000
W21015      MOVE ASC-AREA-NBR            TO SUMINV-AREA-NBR.            08330000
25248 *     MOVE ASC-STORE-NBRX (2:3)    TO SUMINV-STORE-NBR.           08340000
W26600      MOVE ASC-STORE-NBR           TO SUMINV-LOC-NBR.             08350000
W21015                                                                  08360000
W21015      EXEC SQL                                                    08370000
W21015          SELECT DISTINCT(AREA_NBR)                               08380000
W21015            INTO  :SUMINV-AREA-NBR                                08390000
W21015            FROM  TSUMINV                                         08400000
25248 *           WHERE STORE_NBR    = :SUMINV-STORE-NBR                08410000
W26600            WHERE LOC_NBR      = :SUMINV-LOC-NBR                  08420000
W21015              AND AREA_NBR     = :SUMINV-AREA-NBR                 08430000
W21015      END-EXEC.                                                   08440000
W21015                                                                  08450000
W21015      EVALUATE TRUE                                               08460000
W21015          WHEN SQLCODE = ZERO                                     08470000
W21015              CONTINUE                                            08480000
W21015          WHEN SQLCODE = +100                                     08490000
W21015              PERFORM 4550-READ-TADJADD                           08500000
W21015          WHEN SQLCODE = -904                                     08510000
W21015          WHEN SQLCODE = -913                                     08520000
W21015               PERFORM 9900-SOFT-ABORT                            08530000
W21015          WHEN SQLWARN0 NOT = SPACES                              08540000
W21015          WHEN SQLCODE NOT EQUAL ZERO                             08550000
W21015              MOVE '4500-READ-TSUMINV'                            08560000
W21015                                TO DP013-PARAGRAPH                08570000
W21015              MOVE 'SELECT FOR STORE/AREA VALIDATION'             08580000
W21015                                TO DP013-MESSAGE-TEXT (1)         08590000
W21015              MOVE SQLCA        TO DP013-SQLCA                    08600000
W21015              MOVE 'TSUMINV'    TO DP013-DB2-TABLE-NAME (1)       08610000
W21015              SET DP013-DB2-ABEND                                 08620000
W21015                  DP013-XCTL-DISPLAY-RESTART                      08630000
W21015                                TO TRUE                           08640000
W21015              PERFORM DP013-0000-PROCESS-ABEND                    08650000
W21015      END-EVALUATE.                                               08660000
W21015                                                                  08670000
W21015*----------------------------------------------------------------*08680000
W21015*    READ THE ADJUSTMENT ADD TABLE.IF ROW EXISTS, CONTROL PASSED *08690000
W21015*    TO MASS ADD PROGRAM. IF NOT FOUND THEN THIS IS AN ERROR.    *08700000
W21015*----------------------------------------------------------------*08710000
W21015                                                                  08720000
W21015 4550-READ-TADJADD.                                               08730000
W21015                                                                  08740000
W21015      MOVE ASC-AREA-NBR            TO ADJADD-AREA-NBR.            08750000
25248 *     MOVE ASC-STORE-NBRX (2:3)    TO ADJADD-STORE-NBR.           08760000
W26600      MOVE ASC-STORE-NBR           TO ADJADD-LOC-NBR.             08770000
W21015                                                                  08780000
W21015      EXEC SQL                                                    08790000
W21015          SELECT  DISTINCT(AREA_NBR)                              08800000
W21015            INTO  :ADJADD-AREA-NBR                                08810000
W21015            FROM  TADJADD                                         08820000
25248 *           WHERE STORE_NBR    = :ADJADD-STORE-NBR                08830000
W26600            WHERE LOC_NBR      = :ADJADD-LOC-NBR                  08840000
W21015              AND AREA_NBR     = :ADJADD-AREA-NBR                 08850000
W21015      END-EXEC.                                                   08860000
W21015                                                                  08870000
W21015      EVALUATE TRUE                                               08880000
W21015          WHEN SQLCODE = ZERO                                     08890000
W21015              CONTINUE                                            08900000
W21015          WHEN SQLCODE = +100                                     08910000
W21015             SET PS-ERROR                                         08920000
W21015                 DP020-MSG-FATAL   TO  TRUE                       08930000
W21015             MOVE PC-TSYMSG-00697  TO  DP020-MSG-NUMBER           08940000
W21015             MOVE DP015-UNP-ALP-BRT-OFF                           08950000
W21015                                   TO  AAREAA                     08960000
W21015             MOVE DP015-RED        TO  AAREAC                     08970000
W21015             MOVE DP015-REVERSE    TO  AAREAH                     08980000
W21015             MOVE -1               TO  AAREAL                     08990000
W21015          WHEN SQLCODE = -904                                     09000000
W21015          WHEN SQLCODE = -913                                     09010000
W21015               PERFORM 9900-SOFT-ABORT                            09020000
W21015          WHEN SQLWARN0 NOT = SPACES                              09030000
W21015          WHEN SQLCODE NOT EQUAL ZERO                             09040000
W21015              MOVE '4550-READ-TADJADD'                            09050000
W21015                                TO DP013-PARAGRAPH                09060000
W21015              MOVE 'SELECT FOR STORE/AREA VALIDATION'             09070000
W21015                                TO DP013-MESSAGE-TEXT (1)         09080000
W21015              MOVE SQLCA        TO DP013-SQLCA                    09090000
W21015              MOVE 'TADJADD'    TO DP013-DB2-TABLE-NAME (1)       09100000
W21015              SET DP013-DB2-ABEND                                 09110000
W21015                  DP013-XCTL-DISPLAY-RESTART                      09120000
W21015                                TO TRUE                           09130000
W21015              PERFORM DP013-0000-PROCESS-ABEND                    09140000
W21015      END-EVALUATE.                                               09150000
W21015                                                                  09160000
P25428******************************************************************09170000
P25428*** FORMAT AND SUBMIT BATCH JOB.                                **09180000
P25428******************************************************************09190000
P25428 8000-FORMAT-AND-SUBMIT.                                          09200000
P25428                                                                  09210000
P25428     PERFORM 9500-ENQUEUE-INTERNAL-READER.                        09220000
P25428                                                                  09230000
P25428     EXEC CICS                                                    09240000
P25428       ASSIGN                                                     09250000
P25428         APPLID (PV-CICS-ID)                                      09260000
P25428     END-EXEC.                                                    09270000
P25428                                                                  09280000
P25428     IF PV-CICS-REGION-PRODUCTION                                 09290008
P25428         MOVE 'INK950'     TO JL-JCL-INK950-JOBNAME               09300000
P25428         MOVE 'Q'          TO JL-JCL-INK950-JOBCLASS              09310000
P25428         MOVE 'P'          TO JL-JCL-INK950-MSGCLASS              09320000
P25428         MOVE SPACES       TO JL-JCL-INK950-NOTIFY-OPT            09330000
P25428     ELSE                                                         09340000
P25428         MOVE DP020-USERID TO JL-JCL-INK950-JOBNAME               09350000
P25428                              JL-JCL-TEST-USER                    09360000
P25428         MOVE 'P'          TO JL-JCL-INK950-JOB-UNQ               09370000
P25428         MOVE 'A'          TO JL-JCL-INK950-JOBCLASS              09380000
P25428         MOVE 'X'          TO JL-JCL-INK950-MSGCLASS              09390000
P25428         MOVE JL-JCL-TEST-NOTIFY TO JL-JCL-INK950-NOTIFY-OPT      09400000
P25428     END-IF.                                                      09410000
P25428     MOVE JL-JCL-INK950-LINE-1 TO TD-JCL-LINE.                    09420000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09430000
P25428                                                                  09440000
P25428     MOVE JL-JCL-INK950-LINE-2 TO TD-JCL-LINE.                    09450000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09460000
P25428                                                                  09470000
P25428     MOVE JL-JCL-INK950-LINE-3 TO TD-JCL-LINE.                    09480000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09490000
P25428                                                                  09500000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             09510000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09520000
P25428                                                                  09530000
P25428     MOVE JL-JCL-INK950-CMT-LONG      TO TD-JCL-LINE.             09540000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09550000
P25428                                                                  09560000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             09570000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09580000
P25428                                                                  09590000
P25428     MOVE DP020-USERID TO JL-JCL-INK950-CMT-USRID                 09600000
P25428     MOVE PV-CICS-ID   TO JL-JCL-INK950-CMT-REGION.               09610000
P25428     MOVE JL-JCL-INK950-CMT-USER-INFO TO TD-JCL-LINE.             09620000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09630000
P25428                                                                  09640000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             09650000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09660000
P25428                                                                  09670000
P25428     MOVE JL-JCL-INK950-CMT-1         TO TD-JCL-LINE.             09680000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09690000
P25428                                                                  09700000
P25428     MOVE JL-JCL-INK950-CMT-2         TO TD-JCL-LINE.             09710000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09720000
P25428                                                                  09730000
P25428     MOVE JL-JCL-INK950-CMT-3         TO TD-JCL-LINE.             09740000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09750000
P25428                                                                  09760000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             09770000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09780000
P25428                                                                  09790000
P25428**   CONTROL CARD INFORMATION (JL-JCL-INK950-LINE-14)             09800000
P25428     MOVE IN001-STORE-NBR         TO  JL-JCL-INK950-STORE.        09810000
P25428     MOVE IN001-AREA-NBR          TO  JL-JCL-INK950-AREA.         09820000
P25428     MOVE ZEROES                  TO  JL-JCL-INK950-SKU           09830000
P25428                                      JL-JCL-INK950-RETAIL.       09840000
P25428                                                                  09850000
W26600     EXEC CICS ASSIGN                                             09851000
W26600         USERID(JL-JCL-INK950-USERID)                             09852000
W26600     END-EXEC.                                                    09853000
W26600                                                                  09854000
P25428     MOVE JL-JCL-INK950-CC-INFO       TO JL-JCL-INK950-CMT-OPTION.09860000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09870000
P25428                                                                  09880000
P25428     MOVE JL-JCL-INK950-CMT-4         TO TD-JCL-LINE.             09890000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09900000
P25428                                                                  09910000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             09920000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09930000
P25428                                                                  09940000
P25428     MOVE JL-JCL-INK950-CMT-LONG      TO TD-JCL-LINE.             09950000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09960000
P25428                                                                  09970000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             09980000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  09990000
P25428                                                                  10000000
P25428     IF PV-CICS-REGION-PRODUCTION                                 10010000
P25428         MOVE JL-JCL-INK950-LINE-10       TO TD-JCL-LINE          10020000
P25428         PERFORM 8100-WRITE-TD-LINE                               10030000
P25428     ELSE                                                         10040000
P25428         MOVE JL-JCL-TEST-LINE-10         TO TD-JCL-LINE          10050000
P25428         PERFORM 8100-WRITE-TD-LINE                               10060000
P25428         MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE          10070000
P25428         PERFORM 8100-WRITE-TD-LINE                               10080000
P25428                                                                  10090000
P25428         MOVE JL-JCL-TEST-LINE-11A        TO TD-JCL-LINE          10100000
P25428         PERFORM 8100-WRITE-TD-LINE                               10110000
P25428         MOVE JL-JCL-TEST-LINE-11B        TO TD-JCL-LINE          10120000
P25428         PERFORM 8100-WRITE-TD-LINE                               10130000
P25428         MOVE JL-JCL-TEST-LINE-11C        TO TD-JCL-LINE          10140000
P25428         PERFORM 8100-WRITE-TD-LINE                               10150000
P25428     END-IF.                                                      10160000
P25428                                                                  10170000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             10180000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10190000
P25428                                                                  10200000
P25428     MOVE JL-JCL-INK950-LINE-11       TO TD-JCL-LINE.             10210000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10220000
P25428                                                                  10230000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             10240000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10250000
P25428                                                                  10260000
P25428     EXEC SQL                                                     10270000
P25428         SELECT DFLT_PRTR_ID                                      10280000
P25428         INTO  :USER-DFLT-PRTR-ID                                 10290005
P25428         FROM  TUSER                                              10300000
P25428         WHERE USER_CODE = :DP020-USERID                          10310000
P25428     END-EXEC.                                                    10320000
P25428     MOVE 'LOCAL'           TO JL-JCL-INK950-PRTDEST.             10330000
           MOVE 'N'               TO JL-JCL-INK950-PRT-IND.             10331000
P25428     EVALUATE TRUE                                                10340000
P25428         WHEN SQLCODE = ZERO                                      10350000
P25428             IF USER-DFLT-PRTR-ID NOT = SPACES                    10360000
P25428                 MOVE USER-DFLT-PRTR-ID TO JL-JCL-INK950-PRTDEST  10370000
                       MOVE 'Y'               TO JL-JCL-INK950-PRT-IND  10371000
                   ELSE                                                 10371106
P25428                 PERFORM 8001-USE-STORE-DEFAULT-PRTR              10372006
P25428             END-IF                                               10380000
P25428         WHEN SQLCODE = +100                                      10390000
P25428             PERFORM 8001-USE-STORE-DEFAULT-PRTR                  10400003
P25428         WHEN OTHER                                               10410000
P25428             MOVE '8100-FORMAT-AND-SUBMIT'                        10420000
P25428                               TO DP013-PARAGRAPH                 10430000
P25428             MOVE 'SELECT DFLT-PRT-ID'                            10440000
P25428                               TO DP013-MESSAGE-TEXT (1)          10450000
P25428             MOVE SQLCA        TO DP013-SQLCA                     10460000
P25428             MOVE 'TUSER  '    TO DP013-DB2-TABLE-NAME (1)        10470000
P25428             SET DP013-DB2-ABEND                                  10480000
P25428                 DP013-XCTL-DISPLAY-RESTART                       10490000
P25428                               TO TRUE                            10500000
P25428             PERFORM DP013-0000-PROCESS-ABEND                     10510000
P25428     END-EVALUATE.                                                10520000
P25428                                                                  10530000
P25428     MOVE JL-JCL-INK950-LINE-12       TO TD-JCL-LINE.             10540000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10550000
P25428                                                                  10560000
P25428     MOVE JL-JCL-INK950-LINE-13       TO TD-JCL-LINE.             10570000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10580000
P25428                                                                  10590000
P25428**   CONTROL CARD INFORMATION (IN-STREAM DATA ON JOB CARD)        10600000
P25428**                                    JL-JCL-INK950-UPC           10610000
P25428     MOVE JL-JCL-INK950-CC-INFO       TO JL-JCL-INK950-REQ-OPTION.10620000
P25428     MOVE JL-JCL-INK950-LINE-14       TO TD-JCL-LINE.             10630000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10640000
P25428                                                                  10650000
P25428     MOVE JL-JCL-INK950-LINE-EOD      TO TD-JCL-LINE.             10660000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10670000
P25428                                                                  10680000
P25428     MOVE JL-JCL-INK950-CMT-SHORT     TO TD-JCL-LINE.             10690000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10700000
P25428                                                                  10710000
P25428     MOVE JL-JCL-INK950-LINE-EOF      TO TD-JCL-LINE.             10720000
P25428     PERFORM 8100-WRITE-TD-LINE.                                  10730000
P25428                                                                  10740000
P25428     PERFORM 9600-DEQUEUE-INTERNAL-READER.                        10750000
P25428                                                                  10760000
P25428                                                                  10770000
W30692/*****************************************************************10771002
W30692* 8001-USE-STORE-DEFAULT-PRTR.                                    10772002
W30692******************************************************************10773002
W30692 8001-USE-STORE-DEFAULT-PRTR.                                     10774002
W30692                                                                  10775002
W30692     MOVE ASC-STORE-NBR TO PV-EDIT-LOC-NBR.                       10776003
W30692     IF PV-EDIT-LOC-NBR-P1 IS EQUAL TO ZERO                       10777002
W30692         STRING 'TKST' DELIMITED BY SIZE                          10778002
W30692                PV-EDIT-LOC-NBR-P2 DELIMITED BY SIZE              10779002
W30692                            INTO PV-USER-USER-CODE                10779102
W30692     ELSE                                                         10779202
W30692         STRING 'TKS' DELIMITED BY SIZE                           10779302
W30692                PV-EDIT-LOC-NBR DELIMITED BY SIZE                 10779402
W30692                            INTO PV-USER-USER-CODE                10779502
W30692     END-IF.                                                      10779602
W30692                                                                  10779702
W30692     MOVE PV-USER-USER-CODE TO USER-USER-CODE.                    10779802
W30692                                                                  10779902
W30692     EXEC SQL                                                     10780002
W30692         SELECT DFLT_PRTR_ID                                      10780102
W30692         INTO  :USER-DFLT-PRTR-ID                                 10780202
W30692         FROM  TUSER                                              10780302
W30692         WHERE USER_CODE = :USER-USER-CODE                        10780402
W30692         WITH UR                                                  10780502
W30692     END-EXEC.                                                    10780602
W30692                                                                  10780702
W30692     EVALUATE TRUE                                                10780802
W30692         WHEN SQLCODE = ZERO                                      10780902
W30692             IF USER-DFLT-PRTR-ID GREATER SPACES                  10781002
W30692                 MOVE USER-DFLT-PRTR-ID                           10781102
W30692                               TO JL-JCL-INK950-PRTDEST           10781202
W30692                 MOVE 'Y'      TO JL-JCL-INK950-PRT-IND           10781302
W30692             ELSE                                                 10781402
P25428                 MOVE 'LOCAL'  TO JL-JCL-INK950-PRTDEST           10781504
W30692                 MOVE 'N'      TO JL-JCL-INK950-PRT-IND           10781702
W30692             END-IF                                               10781802
W30692         WHEN SQLCODE = +100                                      10781902
P25428             MOVE 'LOCAL'      TO JL-JCL-INK950-PRTDEST           10782004
                   MOVE 'N'          TO JL-JCL-INK950-PRT-IND           10782104
W30692         WHEN OTHER                                               10782302
W30692             MOVE SPACES       TO JL-JCL-INK950-PRTDEST           10782402
W30692             MOVE 'N'          TO JL-JCL-INK950-PRT-IND           10782502
W30692             MOVE '8001-USE-STORE-DEFAULT-PRTR'                   10782602
W30692                               TO DP013-PARAGRAPH                 10782702
W30692             MOVE 'SELECT DFLT-PRT-ID'                            10782802
W30692                               TO DP013-MESSAGE-TEXT (1)          10782902
W30692             MOVE SQLCA        TO DP013-SQLCA                     10783002
W30692             MOVE 'TUSER  '    TO DP013-DB2-TABLE-NAME (1)        10783102
W30692             SET DP013-DB2-ABEND                                  10783202
W30692                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10783302
W30692             PERFORM DP013-0000-PROCESS-ABEND                     10783402
W30692     END-EVALUATE.                                                10783502
W30692                                                                  10783602
P25428******************************************************************10784000
P25428** WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *10790000
P25428** READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER AND ABEND. *10800000
P25428******************************************************************10810000
P25428 8100-WRITE-TD-LINE.                                              10820000
P25428     EXEC CICS                                                    10830000
P25428         WRITEQ TD                                                10840000
P25428             QUEUE(TD-QUEUE-NAME)                                 10850000
P25428             FROM(TD-JCL-LINE)                                    10860000
P25428             LENGTH(TD-JCL-LINE-LENGTH)                           10870000
P25428             RESP(PV-CICS-RESP)                                   10880000
P25428     END-EXEC.                                                    10890000
P25428                                                                  10900000
P25428     IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                        10910000
P25428         SET DP013-CICS-ABEND      TO TRUE                        10920000
P25428         SET DP013-NO-ROLLBACK     TO TRUE                        10930000
P25428         MOVE '8100-WRITE-TD-LINE' TO DP013-PARAGRAPH             10940000
P25428         MOVE 'ATTEMPTING TO WRITE TO INTERNAL READER TD QUEUE'   10950000
P25428                                   TO DP013-MESSAGE-TEXT(1)       10960000
P25428         PERFORM 9600-DEQUEUE-INTERNAL-READER                     10970000
P25428         PERFORM DP013-0000-PROCESS-ABEND                         10980000
P25428     END-IF.                                                      10990000
P25428                                                                  11000000
P25428/                                                                 11010000
P25428******************************************************************11020000
P25428** ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *11030000
P25428** THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *11040000
P25428** BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *11050000
P25428** WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *11060000
P25428** CONDITION.                                                    *11070000
P25428******************************************************************11080000
P25428 9500-ENQUEUE-INTERNAL-READER.                                    11090000
P25428     EXEC CICS                                                    11100000
P25428         ENQ                                                      11110000
P25428             RESOURCE(TD-QUEUE-NAME)                              11120000
P25428             LENGTH(TD-QUEUE-NAME-LENGTH)                         11130000
P25428             RESP(PV-CICS-RESP)                                   11140000
P25428     END-EXEC.                                                    11150000
P25428                                                                  11160000
P25428     IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                        11170000
P25428         SET DP013-CICS-ABEND      TO TRUE                        11180000
P25428         SET DP013-NO-ROLLBACK     TO TRUE                        11190000
P25428         MOVE '9500-ENQUEUE-INTERNAL-READER'                      11200000
P25428                                   TO DP013-PARAGRAPH             11210000
P25428         STRING 'ENQUEUE '            DELIMITED BY SIZE           11220000
P25428                TD-QUEUE-NAME         DELIMITED BY SIZE           11230000
P25428                ' (INTERNAL READER)'  DELIMITED BY SIZE           11240000
P25428             INTO DP013-MESSAGE-TEXT (1)                          11250000
P25428         PERFORM DP013-0000-PROCESS-ABEND                         11260000
P25428     END-IF.                                                      11270000
P25428                                                                  11280000
P25428     SET PS-INTERNAL-READER-ENQUEUED TO TRUE.                     11290000
P25428                                                                  11300000
P25428******************************************************************11310000
P25428** DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *11320000
P25428** THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *11330000
P25428** SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *11340000
P25428** ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *11350000
P25428** FOR THE NEXT USER.                                            *11360000
P25428******************************************************************11370000
P25428 9600-DEQUEUE-INTERNAL-READER.                                    11380000
P25428     SET PS-INTERNAL-READER-DEQUEUED TO TRUE.                     11390000
P25428                                                                  11400000
P25428     EXEC CICS                                                    11410000
P25428         DEQ                                                      11420000
P25428             RESOURCE(TD-QUEUE-NAME)                              11430000
P25428             LENGTH(TD-QUEUE-NAME-LENGTH)                         11440000
P25428             RESP(PV-CICS-RESP)                                   11450000
P25428     END-EXEC.                                                    11460000
P25428                                                                  11470000
P25428     IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                        11480000
P25428         SET DP013-CICS-ABEND      TO TRUE                        11490000
P25428         SET DP013-NO-ROLLBACK     TO TRUE                        11500000
P25428         MOVE '9600-DEQUEUE-INTERNAL-READER'                      11510000
P25428                                   TO DP013-PARAGRAPH             11520000
P25428         STRING 'DEQUEUE '            DELIMITED BY SIZE           11530000
P25428                TD-QUEUE-NAME         DELIMITED BY SIZE           11540000
P25428                ' (INTERNAL READER)'  DELIMITED BY SIZE           11550000
P25428             INTO DP013-MESSAGE-TEXT (1)                          11560000
P25428         PERFORM DP013-0000-PROCESS-ABEND                         11570000
P25428     END-IF.                                                      11580000
P25428                                                                  11590000
00704 /                                                                 11600000
00705 *----------------------------------------------------------------*11610000
00706 *    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *11620000
00707 *    AND THE ERROR SWITCHES.                                     *11630000
00708 *----------------------------------------------------------------*11640000
00709                                                                   11650000
00710  9900-SOFT-ABORT.                                                 11660000
00711                                                                   11670000
00712      SET PS-ERROR                TO  TRUE.                        11680000
00713      SET DP020-MSG-WARNING       TO  TRUE.                        11690000
00714      MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            11700000
00715 /                                                                 11710000
00716 *----------------------------------------------------------------*11720000
00717 *    ABEND PROCESSOR MODULE                                      *11730000
00718 *----------------------------------------------------------------*11740000
00719                                                                   11750000
00720      COPY DPPD013.                                                11760000
00721 /                                                                 11770000
00722 *----------------------------------------------------------------*11780000
00723 *    CURRENT DATE                                                *11790000
00724 *----------------------------------------------------------------*11800000
00725                                                                   11810000
00726      COPY DPPD017.                                                11820000
