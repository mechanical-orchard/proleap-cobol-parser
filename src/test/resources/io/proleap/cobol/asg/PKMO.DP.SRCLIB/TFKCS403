      ******************************************************************00050001
       IDENTIFICATION DIVISION.                                         00060001
      ******************************************************************00070001
                                                                        00080001
       PROGRAM-ID.       TFKCS403.                                      00090001
       AUTHOR.           WILLIAM B. BURT.                               00100001
       INSTALLATION.     KOHLS.                                         00110001
       DATE-WRITTEN      AUGUST, 1996.                                  00120001
       DATE-COMPILED.                                                   00130001
                                                                        00140001
      ******************************************************************00150001
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00160001
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00170001
      * IS A REQUEST TO CREATE BASIC TRANSFER DATA.  THE TRANSMIT IS THE00180006
      * RESPONSE TO THAT REQUEST.                                       00190001
      ******************************************************************00200001
      *  DATE 01/15/01                                                  00210001
      *  ADD CODE FOR 2ND LISTNER                                       00220001
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00230001
      ******************************************************************00240001
      *  DATE 03/28/03                                                  00241005
      *  MOS AND RTV DEF/DAMAGE TRANSFERS                               00242005
      *  MADE BY: DAVE WELLER             WR/IR #: 25501                00243005
      ******************************************************************00244005
      *  DATE 10/06/04                                                  00245011
      *  STORE EXPANSION                                                00246011
      *  MADE BY: DAVE WELLER             WR/IR #: 72349                00247011
      ******************************************************************00248011
021605*  DATE 02/16/2005                                                00249011
021605*  STANDARDS COMPLIANCE WITH TFWS007                              00249111
021605*  MADE BY: DAVE WELLER             WR/IR #: 72349                00249211
021605******************************************************************00249311
051705*  DATE 05/17/05 RAY GRAF                                         00249413
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00249512
051705******************************************************************00249612
011606*  DATE 01/16/06 RAY GRAF                                         00249715
011606*  REJECT ANY TRANSFER WITH A 'TO' LOCATION OF 0.  OCCASIONALLY,  00249815
011606*  A ZERO 'TO' LOCATION WILL PASS FROM THE PPC MIDTIER UP TO      00249915
011606*  THE MAINFRAME FOR SOME UNKNOWN REASON.                         00250015
011606******************************************************************00250115
PB5761*  DATE 10/20/10 CHANGED BY: COGNIZANT     PBI5761                00253027
PB5761*  MODIFIED THE CODE IN 7200-UPDATE-XFER PARA TO HANDLE SQLCODE   00254026
PB5761*  100 AND NOT TO ABEND THE TRANSACTION IN CICS.NOW THE PROGRAM   00255026
PB5761*  WILL SEND THE MESSAGE TO RF DEVICE WITH PC-TSYMSG-01639 MSG    00256026
PB5761*  CODE WITHOUT ABENDING THE TRANSACTION IN CICS.                 00256126
PB5761******************************************************************00257026
      ******************************************************************00260001
       ENVIRONMENT DIVISION.                                            00270001
      ******************************************************************00280001
                                                                        00290001
      ******************************************************************00300001
       DATA DIVISION.                                                   00310001
      ******************************************************************00320001
                                                                        00330001
      ******************************************************************00340001
       WORKING-STORAGE SECTION.                                         00350001
      ******************************************************************00360001
                                                                        00370001
      *                                                                 00380001
      *  LISTENER QUEUE NAMES                                           00390001
      *                                                                 00400001
           COPY RFWS001.                                                00410001
                                                                        00420001
      *                                                                 00430001
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00440001
      *                                                                 00450001
           COPY TFRD007.                                                00460001
                                                                        00470001
      *                                                                 00480001
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00490001
      *                                                                 00500001
           COPY TFRD008.                                                00510001
                                                                        00520001
      *                                                                 00530001
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00540001
      *                                                                 00550001
           COPY DPWS013.                                                00560001
                                                                        00570001
      *                                                                 00580001
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00590001
      *                                                                 00600001
           COPY DPRD507I.                                               00610001
                                                                        00620001
      *                                                                 00630001
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00640001
      *                                                                 00650001
           COPY DPWS011.                                                00660001
                                                                        00670001
      *                                                                 00680001
      * DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER TABLE      00690001
      *                                                                 00700001
           EXEC SQL                                                     00710001
               INCLUDE TTFMSTR                                          00720001
           END-EXEC.                                                    00730001
                                                                        00740001
      *                                                                 00741001
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE LOCATION TABLE     00742005
      *                                                                 00743001
           EXEC SQL                                                     00744001
               INCLUDE XST00001                                         00745111
           END-EXEC.                                                    00746001
                                                                        00747001
      *                                                                 00890001
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER           00900001
      *  CUSTOMER TABLE                                                 00910001
      *                                                                 00920001
           EXEC SQL                                                     00930001
               INCLUDE TTFCUST                                          00940001
           END-EXEC.                                                    00950001
                                                                        00960001
      *                                                                 00970001
      *  COMMUNICATIONS AREA FOR DB2                                    00980001
      *                                                                 00990001
           EXEC SQL                                                     01000001
               INCLUDE SQLCA                                            01010001
           END-EXEC.                                                    01020001
                                                                        01030001
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          01040001
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          01050001
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           01060001
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           01070001
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          01080001
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           01090001
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          01100001
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          01110001
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          01120001
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          01130001
                                                                        01140001
      *    API CONTROL BLOCKS                                           01150001
                                                                        01160001
       01  MQM-OBJECT-DESCRIPTOR.                                       01170001
           COPY CMQODV.                                                 01180001
       01  MQM-MESSAGE-DESCRIPTOR.                                      01190001
           COPY CMQMDV.                                                 01200001
       01  MQM-GET-MESSAGE-OPTIONS.                                     01210001
           COPY CMQGMOV.                                                01220001
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01230001
           COPY CMQPMOV.                                                01240001
                                                                        01250001
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01260001
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01270001
                                                                        01280001
       01  MQM-CONSTANTS.                                               01290001
           COPY CMQV.                                                   01300001
      *                                                                 01310001
      **---------------------------------------------------------------*01320001
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01330001
      **  (EPPD000)                                                    *01340001
      **---------------------------------------------------------------*01350001
                                                                        01360001
           COPY EPWS000.                                                01370001
021605     COPY TFWS007.                                                01371011
                                                                        01380001
      *                                                                 01390001
       01  DK-DB2-KEYS.                                                 01400001
           05  DK-STR-NBR                      PIC S9(04)  VALUE ZEROS  01410001
                                                           COMP SYNC.   01420001
           05  DK-XFER-DKEY-ID                 PIC S9(09)  VALUE ZEROS  01430001
                                                           COMP SYNC.   01440001
      *                                                                 01470001
       01  PC-PROGRAM-CONSTANTS.                                        01480001
           05  PC-OP-CO-NMBR                   PIC  X(02)  VALUE '03'.  01481001
           05  PC-MENOMONEE-FALLS-DC           PIC  9(04)  VALUE 0085.  01482001
           05  PC-FINDLAY-DC                   PIC  9(04)  VALUE 0810.  01483001
           05  PC-STOCK-BALANCE-MSG            PIC  X(13)  VALUE        01488001
                                              'STOCK BALANCE'.          01489001
           05  PC-CUST-NON-HANDCARRY-MSG       PIC  X(22)  VALUE        01490001
                                              'CUSTOMER NON-HANDCARRY'. 01500001
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01540001
               'TFKCS403'.                                              01550001
           05  PC-HAND-CARRY                   PIC  X(02)  VALUE '05'.  01560001
           05  PC-FIVE-DAYS                    PIC  9(01)  VALUE 5.     01570001
051705*    05  PC-MAX-DATE                 PIC X(10) VALUE '9999-09-09'.01580014
           05  PC-YES                          PIC X(01) VALUE 'Y'.     01590001
                                                                        01600001
           05  PC-TSYMSG-NUMBERS.                                       01610001
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                01620001
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.01630001
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           01640001
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.01650001
      * -- CANNOT PROCESS TRANSFER TILL AFTER: (MAX PLANNED INV DATE)   01660001
               10  PC-TSYMSG-01616             PIC  9(05)  VALUE  01616.01670001
      *  THIS TRANSFER WAS DELETED.  PRESS 'ESC' AND RE-CREATE IT       01680001
               10  PC-TSYMSG-01639             PIC  9(05)  VALUE  01639.01690030
      * -- MUST SELECT CUSTOMER WHEN USING HANDCARRY DURING PHYS INV    01700001
               10  PC-TSYMSG-01675             PIC  9(05)  VALUE  01675.01710001
      * -- CAN'T COMPLETE STOCK BALANCE TRANSFERS UNTIL AFTER INVENTORY 01720001
               10  PC-TSYMSG-02002             PIC  9(05)  VALUE  02002.01730001
      *  STORE NUMBER NOT FOUND                                         01740001
               10  PC-TSYMSG-00594             PIC  9(05)  VALUE  00594.01750001
                                                                        01760000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   01770001
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          01780001
           05  PH-REASON                   PIC  S9(09) BINARY.          01790001
                                                                        01800000
      *                                                                 01810001
       01  PS-PROGRAM-SWITCHES.                                         01820001
           05  PS-XFER-CREATED-IND             PIC  X(01)  VALUE 'N'.   01830001
               88  PS-XFER-NOT-CREATED                     VALUE 'N'.   01840001
               88  PS-XFER-CREATED                         VALUE 'Y'.   01850001
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   01860001
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   01870001
      *                                                                 01880001
       01  PV-PROGRAM-VARIABLES.                                        01890001
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          01900001
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          01910001
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          01920001
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          01930001
           05  PV-QM-NAME              PIC X(48).                       01940001
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        01950001
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        01960001
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        01970001
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        01980001
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        01990001
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        02000001
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        02010001
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02020001
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02030001
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02040001
                                                                        02050000
           05  PV-DISPLAY-XFER-DKEY-ID         PIC  9(09)  VALUE ZEROS. 02060001
           05  PV-DISPLAY-STR-NBR              PIC  9(04)  VALUE ZEROS. 02070001
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  02080001
                                                           COMP SYNC.   02090001
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  02100001
                                                           COMP SYNC.   02110001
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.02120001
                                                                        02130001
           05  PV-TCPIPPRQ-RECORD1.                                     02140001
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 02150001
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 02160001
               10  FILLER                      PIC X(4104) VALUE SPACE. 02170001
           05  PV-TCPIPPRQ-RECORD2.                                     02180001
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 02190001
               10  FILLER                      PIC X(4112) VALUE SPACE. 02200001
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02210001
                                                           COMP SYNC.   02220001
           05  PV-NULL-IND                     PIC S9(04)  VALUE ZEROS  02500001
                                                           COMP SYNC.   02510001
           05  PV-ERROR-LINE.                                           02520001
               10  FILLER                      PIC X(04)   VALUE 'STR'. 02530001
               10  PV-ERR-STR                  PIC 9(03).               02540001
               10  FILLER                      PIC X(02)   VALUE SPACE. 02550001
               10  FILLER                      PIC X(04)   VALUE 'TYP'. 02560001
               10  PV-ERR-TYP                  PIC X(02)   VALUE SPACE. 02570001
               10  FILLER                      PIC X(02)   VALUE SPACE. 02580001
               10  FILLER                      PIC X(04)   VALUE 'NBR'. 02590001
               10  PV-ERR-NBR                  PIC 9(08).               02600001
      *                                                                 02610001
      ******************************************************************02620001
       PROCEDURE DIVISION.                                              02630001
      ******************************************************************02640001
       0000-PROGRAM-MAINLINE.                                           02650001
           INITIALIZE TF008-XFER-TO-PTC-RECORD.                         02660001
                                                                        02670001
           PERFORM 1000-RETRIEVE-TEXT.                                  02680001
                                                                        02690001
           PERFORM 2000-PROCESS-PTC-REQUEST.                            02700001
                                                                        02710001
           GOBACK.                                                      02720001
      *                                                                 02730001
       1000-RETRIEVE-TEXT.                                              02740001
           EXEC CICS                                                    02750001
               RETRIEVE                                                 02760001
                   INTO  (TF007-XFER-FROM-PTC-RECORD)                   02770001
                   RESP  (PV-CICS-RESPONSE)                             02780001
           END-EXEC.                                                    02790001
                                                                        02800001
           EVALUATE TRUE                                                02810001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02820001
                   CONTINUE                                             02830001
               WHEN OTHER                                               02840001
                   MOVE '1000-RETRIEVE-TEXT'                            02850006
                                   TO DP013-PARAGRAPH                   02851006
                   MOVE 'UNABLE TO RECEIVE TEXT'                        02860001
                                   TO DP013-MESSAGE-TEXT (1)            02870006
                   MOVE  TF007-XFER-FROM-PTC-RECORD                     02880001
                                   TO DP013-MESSAGE-TEXT (2)            02890006
                   SET DP013-CICS-ABEND                                 02900001
                       DP013-NO-ROLLBACK                                02910006
                                   TO TRUE                              02911006
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      02920001
                   SET  DP011-MSG-FATAL                                 02930006
                                   TO TRUE                              02931006
                   MOVE PC-TSYMSG-01064                                 02940006
                                   TO DP011-MSG-NUMBER                  02941006
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      02950001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   02960001
           END-EVALUATE.                                                02970001
                                                                        02980001
                                                                        02990001
           MOVE TF007-LISTENER-CODE                                     03000006
                                   TO PV-QUEUE-PARM.                    03001006
                                                                        03010001
           IF  PV-VALID-PARM                                            03020001
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      03030006
                                   TO PV-TSQ-NAME                       03031006
                                                                        03040001
           ELSE                                                         03050001
               MOVE '1000-RETRIEVE-TEXT'                                03060006
                                   TO DP013-PARAGRAPH                   03061006
               MOVE 'INVALID PARM VALUE'                                03070006
                                   TO DP013-MESSAGE-TEXT (1)            03071006
               MOVE 'PARM VALUE = '                                     03080006
                                   TO DP013-MESSAGE-TEXT (2)            03081006
               MOVE TF007-LISTENER-CODE                                 03090006
                                   TO DP013-MESSAGE-TEXT (3)            03091006
                                                                        03100001
               SET DP013-LOGIC-ABEND                                    03110001
                   DP013-NO-ROLLBACK                                    03120006
                                   TO TRUE                              03121006
                                                                        03130001
               PERFORM 9999-WRITE-CICS-LOG-MSG                          03140001
                                                                        03150001
               SET DP011-MSG-FATAL TO TRUE                              03160006
                                                                        03170001
               MOVE PC-TSYMSG-01064                                     03180006
                                   TO DP011-MSG-NUMBER                  03181006
                                                                        03190001
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03200001
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03210001
           END-IF.                                                      03220001
                                                                        03230001
                                                                        03240001
      ******************************************************************03250001
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 03260001
      ******************************************************************03270001
       2000-PROCESS-PTC-REQUEST.                                        03280001
011606     IF TF007-TO-STR-NBR = 0                                      03291015
011606         SET DP011-MSG-FATAL TO TRUE                              03291115
011606         MOVE 'SYSTEM ERROR. PLEASE RETURN TO MAIN MENU AND REDO T03291317
011606-             'HIS TRANSFER' TO DP011-MSG-TEXT                    03291418
011606         PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03291615
011606     END-IF.                                                      03292015
           PERFORM 2030-VERIFY-TO-STORE-LOCATION.                       03300000
                                                                        03360001
           PERFORM 2100-POST-RECAP-DATA.                                03370001
                                                                        03380001
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          03390001
      *                                                                 03400000
       2030-VERIFY-TO-STORE-LOCATION.                                   03400100
           INITIALIZE DCLXST00001.                                      03400311
                                                                        03400405
           MOVE TF007-TO-STR-NBR   TO  DK-STR-NBR.                      03400506
                                                                        03403105
           EXEC SQL                                                     03403211
               SELECT  LOC_TYP_CDE                                      03403311
                 INTO  :XST00001-LOC-TYP-CDE                            03403411
                 FROM  XST_LOC                                          03403511
                WHERE  LOC_NBR      =  :DK-STR-NBR                      03403711
               WITH UR                                                  03403811
           END-EXEC.                                                    03403911
                                                                        03404001
           EVALUATE SQLCODE                                             03405005
               WHEN ZERO                                                03405105
                   IF TF007-XFER-TYP-CDE-X =                            03405205
021605                         TF007-DEFECTIVES-DAMAGES-SORT1           03405311
                           OR TF007-XFER-TYP-CDE-X =                    03405405
021605                         TF007-DEFECTIVES-DAMAGES-SORT2           03405511
021605                     OR TF007-XFER-TYP-CDE-X = TF007-CALLBACK     03405611
                       IF XST00001-LOC-TYP-CDE NOT = 'RV'               03405705
                           SET  DP011-MSG-FATAL                         03405806
                                   TO TRUE                              03405906
                           MOVE 'NOT AN RTV LOCATION'                   03406006
                                   TO DP011-MSG-TEXT                    03406106
                           PERFORM 9000-FMT-ERR-MSG-TO-PTC              03406206
                       END-IF                                           03406306
                   END-IF                                               03406406
021605             IF TF007-XFER-TYP-CDE-X = TF007-OFFSITE-STORAGE      03406511
                       IF TF007-FROM-STR-NBR NOT = TF007-TO-STR-NBR     03406606
                           SET  DP011-MSG-FATAL                         03406706
                                   TO TRUE                              03406806
                           MOVE 'DESTINATION STORE IS INVALID'          03406906
                                   TO DP011-MSG-TEXT                    03407006
                           PERFORM 9000-FMT-ERR-MSG-TO-PTC              03407106
                       END-IF                                           03407206
                   END-IF                                               03407306
               WHEN -904                                                03407406
               WHEN -913                                                03407506
                   SET DP011-MSG-FATAL                                  03408006
                                   TO TRUE                              03408106
                   MOVE PC-TSYMSG-01063                                 03409006
                                   TO DP011-MSG-NUMBER                  03409106
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03410001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03410101
               WHEN +100                                                03410205
                   SET  DP011-MSG-FATAL                                 03410306
                                   TO TRUE                              03410406
                   MOVE PC-TSYMSG-00594                                 03410506
                                   TO DP011-MSG-NUMBER                  03410606
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03410706
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03410806
               WHEN OTHER                                               03410906
                   MOVE '2030-VERIFY-TO-STORE-LOCATION'                 03411001
                                   TO DP013-PARAGRAPH                   03411106
                   MOVE 'VERIFY TO STORE LOCATION '                     03411201
                                   TO DP013-MESSAGE-TEXT (1)            03411306
                   MOVE DK-STR-NBR                                      03411406
                                   TO PV-DISPLAY-STR-NBR                03411506
                   MOVE PV-DISPLAY-STR-NBR                              03411706
                                   TO DP013-MESSAGE-TEXT (2)            03411806
                   MOVE SQLCA      TO DP013-SQLCA                       03411906
                   MOVE 'XST_LOC'  TO DP013-DB2-TABLE-NAME (1)          03412111
                   SET DP013-DB2-ABEND                                  03412206
                       DP013-NO-ROLLBACK                                03412306
                                   TO TRUE                              03412406
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      03412506
                   SET DP011-MSG-FATAL                                  03412606
                                   TO TRUE                              03412706
                   MOVE PC-TSYMSG-01064                                 03412806
                                   TO DP011-MSG-NUMBER                  03412906
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03413006
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03414006
           END-EVALUATE.                                                03415201
      *                                                                 03415301
       2100-POST-RECAP-DATA.                                            03460001
           IF (TF007-FROM-STR-NBR  =  PC-MENOMONEE-FALLS-DC             03470001
                     OR                                                 03480001
               TF007-FROM-STR-NBR  =  PC-FINDLAY-DC)                    03490001
021605         IF TF007-XFER-TYP-CDE-X  =  TF007-NON-RETAIL             03500011
                   PERFORM 7000-DELETE-XFER                             03510001
                   PERFORM 7100-INSERT-XFER                             03520001
               ELSE                                                     03530001
                   PERFORM 7200-UPDATE-XFER                             03540001
               END-IF                                                   03550001
           ELSE                                                         03560001
               PERFORM 7200-UPDATE-XFER                                 03570001
           END-IF.                                                      03580001
                                                                        03590001
021605     IF (TF007-XFER-TYP-CDE-X  =  TF007-CUSTOMER                  03600011
                     OR                                                 03610001
021605         TF007-XFER-TYP-CDE-X  =  TF007-OFFSITE-STORAGE)          03620011
               PERFORM 7300-INSERT-CUST                                 03630001
           END-IF.                                                      03640001
      *                                                                 03650001
       7000-DELETE-XFER.                                                04670001
           MOVE TF007-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 04680006
                                                                        04690001
           EXEC SQL                                                     04700001
               DELETE                                                   04710001
                 FROM  TTFMSTR                                          04720001
                WHERE  (XFER_DKEY_ID   =  :DK-XFER-DKEY-ID)             04730001
           END-EXEC.                                                    04740001
                                                                        04750001
           EVALUATE SQLCODE                                             04760008
               WHEN ZERO                                                04761008
                   CONTINUE                                             04762008
               WHEN -904                                                04770008
               WHEN -913                                                04780008
                   SET DP011-MSG-FATAL                                  04790006
                                   TO TRUE                              04791006
                   MOVE PC-TSYMSG-01063                                 04800006
                                   TO DP011-MSG-NUMBER                  04801006
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04810001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04820001
               WHEN OTHER                                               04830008
                   MOVE '7000-DELETE-XFER'                              04860006
                                   TO DP013-PARAGRAPH                   04861006
                   MOVE 'DELETE TRANSFER WITH XFER_DKEY_ID: '           04870001
                                   TO DP013-MESSAGE-TEXT (1)            04880006
                   MOVE DK-XFER-DKEY-ID                                 04890006
                                   TO PV-DISPLAY-XFER-DKEY-ID           04891006
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         04900001
                                   TO DP013-MESSAGE-TEXT (2)            04910006
                   MOVE SQLCA      TO DP013-SQLCA                       04920006
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          04930006
                   SET DP013-DB2-ABEND                                  04940001
                       DP013-NO-ROLLBACK                                04950006
                                   TO TRUE                              04951006
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04960001
                   SET  DP011-MSG-FATAL                                 04970006
                                   TO TRUE                              04971006
                   MOVE PC-TSYMSG-01064                                 04980006
                                   TO DP011-MSG-NUMBER                  04981006
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04990001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05000001
           END-EVALUATE.                                                05030001
      *                                                                 05040001
       7100-INSERT-XFER.                                                05050001
           MOVE TF007-FROM-STR-NBR TO  TFMSTR-FR-STR-NBR.               05060006
           MOVE TF007-TO-STR-NBR   TO  TFMSTR-TO-STR-NBR.               05070006
           MOVE TF007-CALLBACK-NBR TO  TFMSTR-CLBK-NBR.                 05080006
           MOVE TF007-CORP-STK-BAL-APP-NBR                              05090006
                                   TO  TFMSTR-STK-BAL-APVL-NBR.         05091006
                                                                        05100001
           EXEC SQL                                                     05110001
               INSERT INTO TTFMSTR                                      05120001
                   (XFER_DKEY_ID,                                       05130001
                    ENTR_MTHD_TYP_CDE,                                  05140001
                    FR_STR_NBR,                                         05150001
                    XFER_TYP_CDE,                                       05160001
                    CONTNR_TYP_CDE,                                     05170001
                    TO_STR_NBR,                                         05180001
                    CPLD_INIT_1ST_NM,                                   05190001
                    CPLD_LAST_NM,                                       05200001
                    CLBK_NBR,                                           05210001
                    STK_BAL_APVL_NBR,                                   05220001
                    RQSTR_INIT_1ST_NM,                                  05230001
                    RQSTR_LAST_NM,                                      05240001
                    ATTN_INIT_1ST_NM,                                   05250001
                    ATTN_LAST_NM)                                       05260001
               VALUES                                                   05270001
                   (:DK-XFER-DKEY-ID,                                   05280001
                    '01',                                               05290001
                    :TFMSTR-FR-STR-NBR,                                 05300001
                    :TF007-XFER-TYP-CDE-X,                              05310001
                    :TF007-CONTNR-TYP-CDE-X,                            05320001
                    :TFMSTR-TO-STR-NBR,                                 05330001
                    :TF007-COMPLETED-BY-FIRST-INIT,                     05340001
                    :TF007-COMPLETED-BY-LAST-NAME,                      05350001
                    :TFMSTR-CLBK-NBR,                                   05360001
                    :TFMSTR-STK-BAL-APVL-NBR,                           05370001
                    :TF007-REQUESTED-BY-FIRST-INIT,                     05380001
                    :TF007-REQUESTED-BY-LAST-NAME,                      05390001
                    :TF007-ATTENTION-TO-FIRST-INIT,                     05400001
                    :TF007-ATTENTION-TO-LAST-NAME)                      05410001
           END-EXEC.                                                    05420001
                                                                        05430001
           EVALUATE SQLCODE                                             05440005
               WHEN ZERO                                                05441005
                   CONTINUE                                             05442005
               WHEN -904                                                05450005
               WHEN -913                                                05460005
                   SET  DP011-MSG-FATAL                                 05470007
                                   TO TRUE                              05471007
                   MOVE PC-TSYMSG-01063                                 05480007
                                   TO DP011-MSG-NUMBER                  05481007
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05490001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05500001
               WHEN OTHER                                               05510005
                   MOVE '7100-INSERT-XFER'                              05540007
                                   TO DP013-PARAGRAPH                   05541007
                   MOVE 'DB2 ERROR INSERTING ROW INTO TTFMSTR'          05550001
                                   TO DP013-MESSAGE-TEXT (1)            05560007
                   MOVE 'INSERT DATALESS KEY VALUE (XFER_DKEY_ID) WAS: '05570001
                                   TO DP013-MESSAGE-TEXT (2)            05580007
                   MOVE DK-XFER-DKEY-ID                                 05590007
                                   TO PV-DISPLAY-XFER-DKEY-ID           05591007
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         05600001
                                   TO DP013-MESSAGE-TEXT (3)            05610007
                   MOVE SQLCA      TO DP013-SQLCA                       05620007
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          05630007
                   SET DP013-DB2-ABEND                                  05640001
                       DP013-ROLLBACK                                   05650007
                                   TO TRUE                              05651007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05660001
                   SET  DP011-MSG-FATAL                                 05670007
                                   TO TRUE                              05671007
                   MOVE PC-TSYMSG-01064                                 05680007
                                   TO DP011-MSG-NUMBER                  05681007
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05690001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05700001
           END-EVALUATE.                                                05730001
      *                                                                 05740001
       7200-UPDATE-XFER.                                                05750001
           MOVE TF007-XFER-DKEY    TO  DK-XFER-DKEY-ID                  05760007
                                                TFMSTR-XFER-DKEY-ID.    05770001
           MOVE TF007-TO-STR-NBR   TO  TFMSTR-TO-STR-NBR.               05780007
           MOVE TF007-CALLBACK-NBR TO  TFMSTR-CLBK-NBR.                 05790007
           MOVE TF007-CORP-STK-BAL-APP-NBR                              05800007
                                   TO  TFMSTR-STK-BAL-APVL-NBR.         05801007
                                                                        05810001
           EXEC SQL                                                     05820001
             UPDATE  TTFMSTR                                            05830001
                SET  XFER_TYP_CDE      = :TF007-XFER-TYP-CDE-X,         05840001
                     CONTNR_TYP_CDE    = :TF007-CONTNR-TYP-CDE-X,       05850001
                     TO_STR_NBR        = :TFMSTR-TO-STR-NBR,            05860001
                     CPLD_INIT_1ST_NM  = :TF007-COMPLETED-BY-FIRST-INIT,05870001
                     CPLD_LAST_NM      = :TF007-COMPLETED-BY-LAST-NAME, 05880001
                     CLBK_NBR          = :TFMSTR-CLBK-NBR,              05890001
                     STK_BAL_APVL_NBR  = :TFMSTR-STK-BAL-APVL-NBR,      05900001
                     RQSTR_INIT_1ST_NM = :TF007-REQUESTED-BY-FIRST-INIT,05910001
                     RQSTR_LAST_NM     = :TF007-REQUESTED-BY-LAST-NAME, 05920001
                     ATTN_INIT_1ST_NM  = :TF007-ATTENTION-TO-FIRST-INIT,05930001
                     ATTN_LAST_NM      = :TF007-ATTENTION-TO-LAST-NAME  05940001
              WHERE  (XFER_DKEY_ID     = :DK-XFER-DKEY-ID)              05950001
           END-EXEC.                                                    05960001
                                                                        05970001
           EVALUATE SQLCODE                                             05980005
               WHEN ZERO                                                05981005
                   CONTINUE                                             05982005
               WHEN +100                                                05983005
PB5761             SET  DP011-MSG-FATAL                                 05990526
PB5761                             TO TRUE                              05990626
PB5761             MOVE PC-TSYMSG-01639                                 05990726
PB5761                             TO DP011-MSG-NUMBER                  05990826
PB5761             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05990926
PB5761             PERFORM 8000-SEND-DATA-TO-LISTENER                   05991026
               WHEN -904                                                05992007
               WHEN -913                                                06000005
                   SET  DP011-MSG-FATAL                                 06010007
                                   TO TRUE                              06011007
                   MOVE PC-TSYMSG-01063                                 06020007
                                   TO DP011-MSG-NUMBER                  06021007
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06030001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06040001
               WHEN OTHER                                               06260005
                   MOVE '7200-UPDATE-XFER'                              06290001
                                   TO DP013-PARAGRAPH                   06300007
                   MOVE 'UPDATE TRANSFER.  DATALESS KEY VALUE WAS: '    06310001
                                   TO DP013-MESSAGE-TEXT (1)            06320007
                   MOVE DK-XFER-DKEY-ID                                 06330007
                                   TO PV-DISPLAY-XFER-DKEY-ID           06331007
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06340001
                                   TO DP013-MESSAGE-TEXT (2)            06350007
                   MOVE TF007-FROM-STR-NBR                              06360007
                                   TO PV-ERR-STR                        06361007
                   MOVE TF007-XFER-TYP-CDE-X                            06370007
                                   TO PV-ERR-TYP                        06371007
                   MOVE TF007-MATCHING-NBR-FIELD                        06380001
                                   TO PV-ERR-NBR                        06390007
                   MOVE PV-ERROR-LINE                                   06400007
                                   TO DP013-MESSAGE-TEXT (3)            06401007
                   MOVE SQLCA      TO DP013-SQLCA                       06410007
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          06420007
                   SET DP013-DB2-ABEND                                  06430001
                       DP013-NO-ROLLBACK                                06440007
                                   TO TRUE                              06441007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06450001
                   SET  DP011-MSG-FATAL                                 06460007
                                   TO TRUE                              06461007
                   MOVE PC-TSYMSG-01064                                 06470007
                                   TO DP011-MSG-NUMBER                  06471007
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06480001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06490001
           END-EVALUATE.                                                06520001
      *                                                                 06530001
       7300-INSERT-CUST.                                                06540001
           EXEC SQL                                                     06550001
               INSERT INTO TTFCUST                                      06560001
                   (XFER_DKEY_ID,                                       06570001
                    CUST_NM,                                            06580001
                    CUST_1ST_LNE_ADDR,                                  06590001
                    CUST_2ND_LNE_ADDR,                                  06600001
                    CTY_NM,                                             06610001
                    ST_CDE,                                             06620001
                    ZIP_CDE,                                            06630001
                    ZIP_EXT_CDE,                                        06640001
                    PHN_NBR)                                            06650001
               VALUES                                                   06660001
                   (:TFMSTR-XFER-DKEY-ID,                               06670001
                    :TF007-CUST-NAME,                                   06680001
                    :TF007-CUST-ADDR-LN1,                               06690001
                    :TF007-CUST-ADDR-LN2,                               06700001
                    :TF007-CUST-CITY,                                   06710001
                    :TF007-CUST-STATE,                                  06720001
                    :TF007-5-DIGIT-ZIP,                                 06730001
                    :TF007-ZIP-PLUS-4,                                  06740001
                    :TF007-CUST-PHONE-X)                                06750001
           END-EXEC.                                                    06760001
                                                                        06770001
           EVALUATE SQLCODE                                             06780005
               WHEN ZERO                                                06781005
                   CONTINUE                                             06782005
               WHEN -803                                                06790005
                   PERFORM 7350-UPDATE-CUST                             06800001
               WHEN OTHER                                               06810005
                   MOVE '7300-INSERT-CUST'                              06840007
                                   TO DP013-PARAGRAPH                   06841007
                   MOVE 'INSERT CUSTOMER.  DATALESS KEY VALUE WAS: '    06850001
                                   TO DP013-MESSAGE-TEXT (1)            06860007
                   MOVE TFMSTR-XFER-DKEY-ID                             06870007
                                   TO PV-DISPLAY-XFER-DKEY-ID           06871007
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06880001
                                   TO DP013-MESSAGE-TEXT (2)            06890007
                   MOVE SQLCA      TO DP013-SQLCA                       06900007
                   MOVE 'TTFCUST'  TO DP013-DB2-TABLE-NAME (1)          06910007
                   SET DP013-DB2-ABEND                                  06920001
                       DP013-ROLLBACK                                   06930007
                                   TO TRUE                              06931007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06940001
                   SET  DP011-MSG-FATAL                                 06950007
                                   TO TRUE                              06951007
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              06960001
                       MOVE PC-TSYMSG-01063                             06970007
                                   TO DP011-MSG-NUMBER                  06971007
                   ELSE                                                 06980001
                       MOVE PC-TSYMSG-01064                             06990007
                                   TO DP011-MSG-NUMBER                  06991007
                   END-IF                                               07000001
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07010001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07020001
           END-EVALUATE.                                                07050001
                                                                        07060001
      *                                                                 07070001
       7350-UPDATE-CUST.                                                07080001
           EXEC SQL                                                     07090001
             UPDATE  TTFCUST                                            07100001
                SET CUST_NM            = :TF007-CUST-NAME,              07110001
                    CUST_1ST_LNE_ADDR  = :TF007-CUST-ADDR-LN1,          07120001
                    CUST_2ND_LNE_ADDR  = :TF007-CUST-ADDR-LN2,          07130001
                    CTY_NM             = :TF007-CUST-CITY,              07140001
                    ST_CDE             = :TF007-CUST-STATE,             07150001
                    ZIP_CDE            = :TF007-5-DIGIT-ZIP,            07160001
                    ZIP_EXT_CDE        = :TF007-ZIP-PLUS-4,             07170001
                    PHN_NBR            = :TF007-CUST-PHONE-X            07180001
              WHERE  (XFER_DKEY_ID     = :DK-XFER-DKEY-ID)              07190001
           END-EXEC.                                                    07200001
                                                                        07210001
           EVALUATE SQLCODE                                             07220005
               WHEN ZERO                                                07221005
                   CONTINUE                                             07222005
               WHEN OTHER                                               07230005
                   MOVE '7350-UPDATE-CUST'                              07260007
                                   TO DP013-PARAGRAPH                   07261007
                   MOVE 'UPDATE CUSTOMER.  DATALESS KEY VALUE WAS: '    07270001
                                   TO DP013-MESSAGE-TEXT (1)            07280007
                   MOVE TFMSTR-XFER-DKEY-ID                             07290007
                                   TO PV-DISPLAY-XFER-DKEY-ID           07291007
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         07300001
                                   TO DP013-MESSAGE-TEXT (2)            07310007
                   MOVE SQLCA      TO DP013-SQLCA                       07320007
                   MOVE 'TTFCUST'  TO DP013-DB2-TABLE-NAME (1)          07330007
                   SET DP013-DB2-ABEND                                  07340001
                       DP013-ROLLBACK                                   07350007
                                   TO TRUE                              07351007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07360001
                   SET  DP011-MSG-FATAL                                 07370007
                                   TO TRUE                              07371007
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              07380001
                       MOVE PC-TSYMSG-01063                             07390007
                                   TO DP011-MSG-NUMBER                  07391007
                   ELSE                                                 07400001
                       MOVE PC-TSYMSG-01064                             07410007
                                   TO DP011-MSG-NUMBER                  07411007
                   END-IF                                               07420001
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07430001
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07440001
           END-EVALUATE.                                                07470001
                                                                        07480001
      ******************************************************************08810001
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  08820001
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           08830001
      ******************************************************************08840001
       8000-SEND-DATA-TO-LISTENER.                                      08850001
           IF TF007-MQ-INDICATOR-Y                                      08860000
               PERFORM 8500-MQ-SETUP                                    08870001
               PERFORM 8510-MQ-SETUP-REMOTE                             08880001
               PERFORM 8520-PUT-QUEUE                                   08890001
               PERFORM 8600-CLOSE-PUT-Q                                 08900001
               PERFORM 8610-DISCONNECT-QMGR                             08910001
               PERFORM 9100-EXEC-CICS-RETURN                            08920001
           ELSE                                                         08930000
               PERFORM 8110-ENQ-TCPIPPRQ                                08940001
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      08950001
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      08960001
                                                                        08970001
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   08990001
               ADD 1               TO PV-NEXT-RECORD                    09010007
                                                                        09020001
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     09030001
                   MOVE 3          TO PV-NEXT-RECORD                    09040007
               END-IF                                                   09050001
                                                                        09060001
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    09070001
               PERFORM 8160-DEQ-TCPIPPRQ                                09080001
                                                                        09090001
               PERFORM 9100-EXEC-CICS-RETURN                            09100001
           END-IF.                                                      09110000
      *                                                                 09120001
      ******************************************************************09130001
       8110-ENQ-TCPIPPRQ.                                               09140001
           EXEC CICS                                                    09150001
               ENQ                                                      09160001
                   RESOURCE  (PV-TSQ-NAME)                              09170001
                   RESP      (PV-CICS-RESPONSE)                         09180001
           END-EXEC.                                                    09190001
                                                                        09200001
           EVALUATE TRUE                                                09210001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09220001
                   CONTINUE                                             09230001
               WHEN OTHER                                               09240001
                   MOVE '8110-ENQ-TCPIPPRQ'                             09250007
                                   TO DP013-PARAGRAPH                   09251007
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q09260001
      -                 'UEUE: '                                        09270001
                                   TO DP013-MESSAGE-TEXT (1)            09280007
                   MOVE PV-TSQ-NAME                                     09290007
                                   TO DP013-MESSAGE-TEXT (2)            09291007
                   SET DP013-CICS-ABEND                                 09300001
                       DP013-NO-ROLLBACK                                09310007
                                   TO TRUE                              09311007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09320001
                   PERFORM 9100-EXEC-CICS-RETURN                        09330001
           END-EVALUATE.                                                09340001
      *                                                                 09350001
      ******************************************************************09360001
       8120-READQ-TCPIPPRQ-RECORD1.                                     09370001
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           09380007
                                   TO PV-TSQ-LENGTH.                    09381007
                                                                        09390001
           EXEC CICS                                                    09400001
               READQ TS                                                 09410001
                   QUEUE   (PV-TSQ-NAME)                                09420001
                   INTO    (PV-TCPIPPRQ-RECORD1)                        09430001
                   LENGTH  (PV-TSQ-LENGTH)                              09440001
                   ITEM    (1)                                          09450001
                   RESP    (PV-CICS-RESPONSE)                           09460001
           END-EXEC.                                                    09470001
                                                                        09480001
           EVALUATE TRUE                                                09490001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09500001
                   CONTINUE                                             09510001
               WHEN OTHER                                               09520001
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   09530001
                                   TO DP013-PARAGRAPH                   09540007
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 09550001
      -                 'QUEUE: '                                       09560001
                                   TO DP013-MESSAGE-TEXT (1)            09570007
                   MOVE PV-TSQ-NAME                                     09580007
                                   TO DP013-MESSAGE-TEXT (2)            09581007
                   SET DP013-CICS-ABEND                                 09590001
                       DP013-NO-ROLLBACK                                09600007
                                   TO TRUE                              09601007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09610001
                   PERFORM 9100-EXEC-CICS-RETURN                        09620001
           END-EVALUATE.                                                09630001
      *                                                                 09640001
      ******************************************************************09650001
       8130-READQ-TCPIPPRQ-RECORD2.                                     09660001
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           09670007
                                   TO PV-TSQ-LENGTH.                    09671007
                                                                        09680001
           EXEC CICS                                                    09690001
               READQ TS                                                 09700001
                   QUEUE   (PV-TSQ-NAME)                                09710001
                   INTO    (PV-TCPIPPRQ-RECORD2)                        09720001
                   LENGTH  (PV-TSQ-LENGTH)                              09730001
                   ITEM    (2)                                          09740001
                   RESP    (PV-CICS-RESPONSE)                           09750001
           END-EXEC.                                                    09760001
                                                                        09770001
           EVALUATE TRUE                                                09780001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09790001
                   CONTINUE                                             09800001
               WHEN OTHER                                               09810001
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   09820001
                                   TO DP013-PARAGRAPH                   09830007
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 09840001
      -                 'QUEUE: '                                       09850001
                                   TO DP013-MESSAGE-TEXT (1)            09860007
                   MOVE PV-TSQ-NAME                                     09870007
                                   TO DP013-MESSAGE-TEXT (2)            09871007
                   SET DP013-CICS-ABEND                                 09880001
                       DP013-NO-ROLLBACK                                09890007
                                   TO TRUE                              09891007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09900001
                   PERFORM 9100-EXEC-CICS-RETURN                        09910001
           END-EVALUATE.                                                09920001
      *                                                                 09930001
      ******************************************************************09940001
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  09950001
           MOVE LENGTH OF TF008-XFER-TO-PTC-RECORD                      09960001
                                   TO  TF008-TOT-REC-LENGTH.            09970007
                                                                        09980001
           MOVE TF007-MATCHING-NBR-FIELD                                09990007
                                   TO  TF008-MATCHING-NBR-FIELD.        09991007
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     10000007
                                                                        10010001
           EXEC CICS                                                    10020001
               WRITEQ TS                                                10030001
                   QUEUE   (PV-TSQ-NAME)                                10040001
                   FROM    (TF008-XFER-TO-PTC-RECORD)                   10050001
                   LENGTH  (PV-TSQ-LENGTH)                              10060001
                   ITEM    (PV-ITEM-NBR)                                10070001
                       REWRITE                                          10080001
                   RESP    (PV-CICS-RESPONSE)                           10090001
           END-EXEC.                                                    10100001
                                                                        10110001
           EVALUATE TRUE                                                10120001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10130001
                   CONTINUE                                             10140001
               WHEN OTHER                                               10150001
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                10160001
                                   TO DP013-PARAGRAPH                   10170007
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA10180001
      -                 'STORAGE QUEUE: '                               10190001
                                   TO DP013-MESSAGE-TEXT (1)            10200007
                   MOVE PV-TSQ-NAME                                     10210007
                                   TO DP013-MESSAGE-TEXT (2)            10211007
                   SET DP013-CICS-ABEND                                 10220001
                       DP013-NO-ROLLBACK                                10230007
                                   TO TRUE                              10231007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10240001
                   PERFORM 9100-EXEC-CICS-RETURN                        10250001
           END-EVALUATE.                                                10260001
      *                                                                 10270001
      ******************************************************************10280001
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   10290001
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           10300007
                                   TO PV-TSQ-LENGTH.                    10301007
           MOVE +1                 TO PV-ITEM-NBR.                      10310007
                                                                        10320001
           EXEC CICS                                                    10330001
               WRITEQ TS                                                10340001
                   QUEUE   (PV-TSQ-NAME)                                10350001
                   FROM    (PV-TCPIPPRQ-RECORD1)                        10360001
                   LENGTH  (PV-TSQ-LENGTH)                              10370001
                   ITEM    (PV-ITEM-NBR)                                10380001
                       REWRITE                                          10390001
                   RESP    (PV-CICS-RESPONSE)                           10400001
           END-EXEC.                                                    10410001
                                                                        10420001
           EVALUATE TRUE                                                10430001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10440001
                   CONTINUE                                             10450001
               WHEN OTHER                                               10460001
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 10470001
                                   TO DP013-PARAGRAPH                   10480007
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   10490001
                                   TO DP013-MESSAGE-TEXT (1)            10500007
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     10510001
                                   TO DP013-MESSAGE-TEXT (2)            10520007
                   MOVE PV-TSQ-NAME                                     10530007
                                   TO DP013-MESSAGE-TEXT (3)            10531007
                   MOVE PV-TCPIPPRQ-RECORD1                             10540007
                                   TO DP013-MESSAGE-TEXT (4)            10541007
                   SET DP013-CICS-ABEND                                 10550001
                       DP013-NO-ROLLBACK                                10560007
                                   TO TRUE                              10561007
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10570001
                   PERFORM 9100-EXEC-CICS-RETURN                        10580001
           END-EVALUATE.                                                10590001
      *                                                                 10600001
      ******************************************************************10610001
       8160-DEQ-TCPIPPRQ.                                               10620001
           EXEC CICS                                                    10630001
               DEQ                                                      10640001
                   RESOURCE  (PV-TSQ-NAME)                              10650001
                   RESP      (PV-CICS-RESPONSE)                         10660001
           END-EXEC.                                                    10670001
                                                                        10680001
           EVALUATE TRUE                                                10690001
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10700001
                   CONTINUE                                             10710001
               WHEN OTHER                                               10720001
                   MOVE '8160-DEQ-TCPIPPRQ'                             10730007
                                   TO DP013-PARAGRAPH                   10731007
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q10740001
      -                 'UEUE: '                                        10750001
                                   TO DP013-MESSAGE-TEXT (1)            10760007
                   MOVE PV-TSQ-NAME                                     10770007
                                   TO DP013-MESSAGE-TEXT (2)            10771007
                   SET DP013-CICS-ABEND                                 10780001
                       DP013-NO-ROLLBACK                                10790007
                                   TO TRUE                              10791007
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        10800001
                 PERFORM 9100-EXEC-CICS-RETURN                          10810001
           END-EVALUATE.                                                10820001
                                                                        10830000
       8500-MQ-SETUP.                                                   10840000
                                                                        10850000
      * DETERMINE THE SYSTEM                                            10860001
                                                                        10870001
           PERFORM EP000-0000-INITIALIZE.                               10880001
           IF EP000-PV-KOHLS-PROD-SYSTEM                                10890001
               SET PV-PROD-QMGR-NAME                                    10900007
                                   TO TRUE                              10901007
           ELSE                                                         10910001
               IF EP000-PV-KOHLS-QA-SYSTEM                              10920007
                   SET PV-QA-QMGR-NAME                                  10930007
                                   TO TRUE                              10931007
               ELSE                                                     10940007
                   SET PV-TEST-QMGR-NAME                                10950007
                                   TO TRUE                              10960007
               END-IF                                                   10970007
           END-IF.                                                      10980001
                                                                        10990001
      ***************************************************************   11000000
      *    CONNECT TO THE QUEUE MANAGER                                 11010001
      ***************************************************************   11020000
                                                                        11030001
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       11040007
           CALL WS-MQCONN USING PV-QM-NAME                              11050001
                                PV-HCONN                                11060001
                                PV-COMPLETION-CODE                      11070001
                                PV-REASON.                              11080001
                                                                        11090001
      ***************************************************************   11100000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              11110001
      *    AND EXIT                                                     11120001
      ***************************************************************   11130000
                                                                        11140001
           MOVE PV-REASON          TO PV-CON-REASON.                    11150007
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   11160001
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  11170007
               MOVE '8500-MQ-SETUP'                                     11180007
                                   TO DP013-PARAGRAPH                   11181007
               MOVE  PV-ERROR-MESSAGE                                   11190007
                                   TO DP013-MESSAGE-TEXT (1)            11191007
               MOVE  PV-COMPLETION-CODE                                 11200007
                                   TO DP013-MESSAGE-TEXT (2)            11201007
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            11210007
               SET DP013-CICS-ABEND                                     11220001
                   DP013-NO-ROLLBACK                                    11230007
                                   TO TRUE                              11231007
               PERFORM 9999-WRITE-CICS-LOG-MSG                          11240001
               PERFORM 9100-EXEC-CICS-RETURN                            11250001
           END-IF.                                                      11260001
                                                                        11270001
                                                                        11280000
       8510-MQ-SETUP-REMOTE.                                            11290000
      ***************************************************************   11300000
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     11310001
      *    THIS IS A REMOTE QUEUE.                                      11320001
      ***************************************************************   11330000
                                                                        11340001
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      11350001
                                     MQOO-FAIL-IF-QUIESCING.            11360001
                                                                        11370001
           MOVE TF007-REPLYTOQ     TO MQOD-OBJECTNAME.                  11380007
           MOVE TF007-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              11390007
                                                                        11400000
           CALL WS-MQOPEN USING PV-HCONN                                11410001
                                MQM-OBJECT-DESCRIPTOR                   11420001
                                PV-OPEN-OPTIONS                         11430001
                                PV-PQ-HANDLE                            11440001
                                PV-COMPLETION-CODE                      11450001
                                PV-REASON.                              11460001
                                                                        11470001
      ********************************************************          11480000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    11490001
      *    AND EXIT.                                                    11500001
      ********************************************************          11510000
      *                                                                 11520001
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   11530001
               PERFORM 8600-CLOSE-PUT-Q                                 11540001
               PERFORM 8610-DISCONNECT-QMGR                             11550001
               MOVE 'MQOPEN WRITE Q'                                    11560007
                                   TO PV-ERROR-MESSAGE                  11561007
               MOVE '8510-MQ-SETUP-REMOTE'                              11570007
                                   TO DP013-PARAGRAPH                   11571007
               MOVE  PV-ERROR-MESSAGE                                   11580007
                                   TO DP013-MESSAGE-TEXT (1)            11581007
               MOVE  PV-COMPLETION-CODE                                 11590007
                                   TO DP013-MESSAGE-TEXT (2)            11591007
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            11600007
               SET DP013-CICS-ABEND                                     11610001
                   DP013-NO-ROLLBACK                                    11620007
                                   TO TRUE                              11621007
               PERFORM 9999-WRITE-CICS-LOG-MSG                          11630001
               PERFORM 9100-EXEC-CICS-RETURN                            11640001
           END-IF.                                                      11650001
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          11660007
      *                                                                 11670001
      ******************************************************************11680001
       8520-PUT-QUEUE.                                                  11690001
           MOVE TF007-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              11700007
           MOVE TF007-REPLYTOQ     TO MQOD-OBJECTNAME.                  11710007
           MOVE TF007-MSGID        TO MQMD-CORRELID.                    11720007
           MOVE MQMI-NONE          TO MQMD-MSGID.                       11730007
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      11740007
           MOVE 5000               TO MQMD-EXPIRY.                      11750007
           MOVE LENGTH OF TF008-XFER-TO-PTC-RECORD                      11760001
                                   TO PV-DATA-LENGTH.                   11770007
           MOVE TF008-XFER-TO-PTC-RECORD                                11780007
                                   TO PV-MSGBUFFER.                     11781007
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 11790007
                                                                        11800001
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      11810001
                                                                        11820000
                                                                        11830000
                                                                        11840001
           CALL WS-MQPUT USING PV-HCONN                                 11850001
                               PV-FMT-OPEN-OUTPUT-HNDL                  11860001
                               MQM-MESSAGE-DESCRIPTOR                   11870001
                               MQM-PUT-MESSAGE-OPTIONS                  11880001
                               PV-DATA-LENGTH                           11890001
                               PV-MSGBUFFER                             11900001
                               PV-COMPLETION-CODE                       11910001
                               PV-REASON.                               11920001
                                                                        11930001
      ***********************************************************       11940000
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 11950001
      *        AND BREAK OUT OF LOOP                                    11960001
      ***********************************************************       11970000
                                                                        11980001
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   11990001
                MOVE PV-COMPLETION-CODE                                 12000007
                                   TO PH-COMPLETION-CODE                12001007
                MOVE PV-REASON     TO PH-REASON                         12010007
                PERFORM 8600-CLOSE-PUT-Q                                12020007
                PERFORM 8610-DISCONNECT-QMGR                            12030007
                MOVE 'MQPUT ERR'   TO PV-ERROR-MESSAGE                  12040007
                MOVE '8520-PUT-QUEUE'                                   12050007
                                   TO DP013-PARAGRAPH                   12051007
                MOVE PV-ERROR-MESSAGE                                   12060007
                                   TO DP013-MESSAGE-TEXT (1)            12061007
                MOVE PH-COMPLETION-CODE                                 12070007
                                   TO DP013-MESSAGE-TEXT (2)            12071007
                MOVE PH-REASON     TO DP013-MESSAGE-TEXT (3)            12080007
                SET DP013-CICS-ABEND                                    12090007
                    DP013-NO-ROLLBACK                                   12100007
                                   TO TRUE                              12101007
                PERFORM 9999-WRITE-CICS-LOG-MSG                         12110007
                PERFORM 9100-EXEC-CICS-RETURN                           12120007
           ELSE                                                         12130001
              SET PS-MQPUT-SUCCESSFUL                                   12140007
                                   TO TRUE                              12141007
           END-IF.                                                      12150001
      *                                                                 12160001
      ******************************************************************12170001
       8600-CLOSE-PUT-Q.                                                12180001
           CALL WS-MQCLOSE USING PV-HCONN                               12190001
                                 PV-PQ-HANDLE                           12200001
                                 MQCO-NONE                              12210001
                                 PV-COMPLETION-CODE                     12220001
                                 PV-REASON.                             12230001
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12240001
               MOVE 'MQCLOSE PQ HANDLE'                                 12250007
                                   TO PV-ERROR-MESSAGE                  12251007
               MOVE '8600-CLOSE-PUT-Q'                                  12260007
                                   TO DP013-PARAGRAPH                   12261007
               MOVE  PV-ERROR-MESSAGE                                   12270007
                                   TO DP013-MESSAGE-TEXT (1)            12271007
               MOVE  PV-COMPLETION-CODE                                 12280007
                                   TO DP013-MESSAGE-TEXT (2)            12281007
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            12290007
               SET DP013-CICS-ABEND                                     12300001
                   DP013-NO-ROLLBACK                                    12310007
                                   TO TRUE                              12311007
               PERFORM 9999-WRITE-CICS-LOG-MSG                          12320001
               PERFORM 9100-EXEC-CICS-RETURN                            12330001
           END-IF.                                                      12340001
      *                                                                 12350001
      ******************************************************************12360001
       8610-DISCONNECT-QMGR.                                            12370001
                                                                        12380001
           IF PV-CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED      12390001
              CALL WS-MQDISC USING PV-HCONN                             12400001
                                   PV-COMPLETION-CODE                   12410001
                                   PV-REASON                            12420001
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                12430001
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  12441007
                  MOVE '8610-DISCONNECT'                                12450007
                                   TO DP013-PARAGRAPH                   12451007
                  MOVE PV-ERROR-MESSAGE                                 12460007
                                   TO DP013-MESSAGE-TEXT (1)            12461007
                  MOVE PV-COMPLETION-CODE                               12470007
                                   TO DP013-MESSAGE-TEXT (2)            12471007
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            12480007
                  SET DP013-CICS-ABEND                                  12490001
                      DP013-NO-ROLLBACK                                 12500007
                                   TO TRUE                              12501007
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       12510001
                  PERFORM 9100-EXEC-CICS-RETURN                         12520001
              END-IF                                                    12530001
           END-IF.                                                      12540001
                                                                        12550001
      *                                                                 12560001
      ******************************************************************12570001
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          12580001
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   12590001
      *    STREAM BEING SENT BACK TO THE PTC.                           12600001
      ******************************************************************12610001
       9000-FMT-ERR-MSG-TO-PTC.                                         12620001
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         12630001
           MOVE DP011-MSG-LEVEL    TO  TF008-ERR-TYP-IND.               12640007
           MOVE DP011-MSG-TEXT     TO  TF008-ERR-MSG.                   12650007
      *                                                                 12660001
       9100-EXEC-CICS-RETURN.                                           12670001
           EXEC CICS                                                    12680001
               RETURN                                                   12690001
           END-EXEC.                                                    12700001
      *                                                                 12710001
       9999-WRITE-CICS-LOG-MSG.                                         12720001
           MOVE PC-CURRENT-PROGRAM-NAME                                 12730007
                                   TO  DP013-PROGRAM.                   12731007
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  12740007
                                                                        12750001
           INITIALIZE DP013-SRC-TASK-NUMBER                             12760001
                      DP013-STACK.                                      12770001
                                                                        12780001
           SET DP013-LINK-RETURN   TO  TRUE.                            12790007
                                                                        12800001
           EXEC CICS                                                    12810001
               LINK                                                     12820001
                   PROGRAM   (DP013-NAME)                               12830001
                   COMMAREA  (DP013-PARAMETERS)                         12840001
                   LENGTH    (DP013-LENGTH)                             12850001
           END-EXEC.                                                    12860001
                                                                        12870001
      *                                                                 12880001
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           12890001
      *                                                                 12900001
                                                                        12910001
           COPY DPPD011.                                                12920001
      *                                                                 12930001
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     12940001
      *                                                                 12950001
                                                                        12960001
           COPY DPPD014.                                                12970001
                                                                        12980000
           COPY EPPD000.                                                12990001
