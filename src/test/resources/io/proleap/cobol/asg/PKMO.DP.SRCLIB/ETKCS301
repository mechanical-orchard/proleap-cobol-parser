000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    ETKCS301.                                         00040000
000500 AUTHOR.        J. SCHMIDT                                        00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  12/22/93.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    E301 - EDI VENDOR SELECTION LIST                           * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF VENDORS FOR EITHER ALL    * 00130000
001400*    VENDORS OR A SUBSET OF VENDORS AS DETERMINED BY ETKCS300.  * 00140000
001500*    FROM THIS LIST, ETKCS305 (TRADING PARTNER SELECT) OR       * 00150000
001600*    ETKCS320 (TRANSMISSION INTERCHANGE SELECT) CAN BE INVOKEN. * 00160000
001700*                                                               * 00170000
001800*---------------------------------------------------------------* 00180000
001810* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00181002
001820*            - CHANGE CALL OF DPKUT100 TO                       * 00182002
001830*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00183002
001840*              MAKING THE CALL DYNAMIC VS STATIC                * 00184002
001850*                                                               * 00185002
001860*---------------------------------------------------------------* 00186002
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210        00187004
CICS  *                                                                 00188003
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00189003
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00189103
001860*---------------------------------------------------------------* 00189303
001900 EJECT                                                            00190000
002000                                                                  00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600                                                                  00260000
002700 01  WK-DB2-KEYS.                                                 00270000
002800     15  WK-VENDOR-NAME                 PIC  X(30)  VALUE SPACES. 00280000
002900     15  WK-VENDOR-NAME-BYTE            REDEFINES WK-VENDOR-NAME  00290000
003000                                        OCCURS 30 TIMES           00300000
003100                                        PIC  X(01).               00310000
003200                                                                  00320000
003300 01  PC-PROGRAM-CONSTANTS.                                        00330000
003400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00340000
003500                                                    'ET301A  '.   00350000
003600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00360000
003700                                                    'ETKM301 '.   00370000
003800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00380000
003900                                                    'ETKCS301'.   00390000
004000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00400000
004100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00410000
004200     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00420000
004300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00430000
004400                                                    COMP SYNC.    00440000
004500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00450000
004600                                                    COMP SYNC.    00460000
004700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00470000
004800                                                    +1000000      00480000
004900                                                    COMP-3.       00490000
005000     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00500000
005100                                                    COMP SYNC.    00510000
005200     05  PC-START-ITEM-LENGTH           PIC S9(04)  VALUE +7      00520000
005300                                                    COMP SYNC.    00530000
005400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00540000
005500                                                    COMP-3.       00550000
005600     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00560000
005700     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00570000
005800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00580000
005900     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00590000
006000     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00600000
006100     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    00610000
006200     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00620000
006300     05  PC-CORPORATE                   PIC  X(02)  VALUE 'HQ'.   00630000
006400     05  PC-TSYMSG-NUMBERS.                                       00640000
006500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00650000
006600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00660000
006700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00670000
006800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00680000
006900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00690000
007000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00700000
007100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00710000
007200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00720000
007300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00730000
007400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00740000
007500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00750000
007600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00760000
007700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00770000
007800         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  00780000
007900         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00790000
008000         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00800000
008100*                                                                 00810000
008200 01  PS-PROGRAM-SWITCHES.                                         00820000
008300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'N'.    00830000
008400         88  PS-ERROR                               VALUE 'Y'.    00840000
008500         88  PS-NO-ERROR                            VALUE 'N'.    00850000
008600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00860000
008700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00870000
008800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00880000
008900     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00890000
009000         88  PS-DONE                                VALUE 'Y'.    00900000
009100         88  PS-NOT-DONE                            VALUE 'N'.    00910000
009200     05  PS-SET-REMAINING-SW            PIC  X(01)  VALUE 'N'.    00920000
009300         88  PS-SET-REMAINING                       VALUE 'Y'.    00930000
009400         88  PS-DO-NOT-SET-REMAINING                VALUE 'N'.    00940000
009500*                                                                 00950000
009600 01  PV-PROGRAM-VARIABLES.                                        00960000
009700     05  PV-SUB                         PIC S9(04)  VALUE +0      00970000
009800                                                    COMP SYNC.    00980000
009900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00990000
010000                                                    COMP SYNC.    01000000
010100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01010000
010200                                                    COMP-3.       01020000
010300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01030000
010400                                                    COMP-3.       01040000
010500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01050000
010600                                                    COMP-3.       01060000
010700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01070000
010800                                                    COMP-3.       01080000
010900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01090000
011000                                                    COMP-3.       01100000
011100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01110000
011200                                                    COMP-3.       01120000
011300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01130000
011400                                                    COMP-3.       01140000
011500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01150000
011600                                                    COMP SYNC.    01160000
011700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01170000
011800                                                    COMP SYNC.    01180000
011900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01190000
012000                                                    COMP SYNC.    01200000
012100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01210000
012200                                                    COMP SYNC.    01220000
012300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01230000
012400                                                    COMP SYNC.    01240000
012500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01250000
012600                                                    COMP SYNC.    01260000
012700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01270000
012800                                                    COMP SYNC.    01280000
012900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01330000
013400                                                    COMP SYNC.    01340000
013500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01350000
013600                                                    COMP SYNC.    01360000
013700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01370000
013800                                                    COMP SYNC.    01380000
013900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01390000
014000                                                    COMP SYNC.    01400000
014100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01410000
014200                                                    COMP SYNC.    01420000
014300     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01430000
014400                                                    COMP SYNC.    01440000
014500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01450000
014600                                                    COMP SYNC.    01460000
014700                                                                  01470000
014800     05  PV-START-ITEM-REQUEST          PIC  X(05).               01480000
014900                                                                  01490000
015000     05  PV-FROM-ENT-ID                 PIC S9(09)                01500000
015100                                            COMP VALUE +0.        01510000
015200     05  PV-TO-ENT-ID                   PIC S9(09)                01520000
015300                                            COMP VALUE +0.        01530000
015400                                                                  01540000
015500     05  PV-FROM-ALPHA-30               PIC  X(30)  VALUE SPACES. 01550000
015600     05  PV-FROM-ALPHA-BYTE             REDEFINES PV-FROM-ALPHA-3001560000
015700                                        OCCURS 30 TIMES           01570000
015800                                        PIC  X(01).               01580000
015900     05  PV-TO-ALPHA-30                 PIC  X(30)  VALUE SPACES. 01590000
016000     05  PV-TO-ALPHA-BYTE               REDEFINES PV-TO-ALPHA-30  01600000
016100                                        OCCURS 30 TIMES           01610000
016200                                        PIC  X(01).               01620000
016300                                                                  01630000
016400*----------------------------------------------------------------*01640000
016500*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *01650000
016600*   THIS MUST BE THE EXACT SAME FORMAT AS A BLOCK IN THE         *01660000
016700*   APPLICATION-SPECIFIC COMMAREA.                               *01670000
016800*----------------------------------------------------------------*01680000
016900 01  LQW-LIST-QUEUE-WORK-AREA.                                    01690000
017000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01700000
017100     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01710000
017200                                        INDEXED BY LQW-IDX.       01720000
017300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01730000
017400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01740000
017500         10  LQW-SELECTED-SW            PIC  X(01).               01750000
017600             88  LQW-SELECT                         VALUE 'S'.    01760000
017700             88  LQW-DESELECT                       VALUE ' '.    01770000
017800         10  LQW-ACTION                 PIC  X(03).               01780000
017900         10  LQW-ENT-ID                 PIC S9(09)  COMP.         01790000
018000         10  LQW-VENDOR                 PIC  X(30).               01800000
018100                                                                  01810000
018200 EJECT                                                            01820000
018300*---------------------------------------------------------------* 01830000
018400*  RECORD LAYOUT FOR THE VENDOR LIST TEMP STORAGE QUEUE.        * 01840000
018500*---------------------------------------------------------------* 01850000
018600                                                                  01860000
018700     COPY ETWS301.                                                01870000
018800                                                                  01880000
018900     EJECT                                                        01890000
019000*---------------------------------------------------------------* 01900000
019100*    MAP LAYOUT                                                 * 01910000
019200*---------------------------------------------------------------* 01920000
019300                                                                  01930000
019400     COPY ETKM301.                                                01940000
019500*                                                                 01950000
019600 01  MR-OCCURS-LAYOUT                   REDEFINES  ET301AO.       01960000
019700*    ?? NEED TO ADJUST SIZE ??                                    01970000
019800     05  FILLER                         PIC X(48).                01980000
019900     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01990000
020000         10  MR-SELECTL                 PIC S9(04) COMP.          02000000
020100         10  MR-SELECTA                 PIC  X(01).               02010000
020200         10  MR-SELECTC                 PIC  X(01).               02020000
020300         10  MR-SELECTH                 PIC  X(01).               02030000
020400         10  MR-SELECTI                 PIC  X(01).               02040000
020500                                                                  02050000
020600         10  MR-ACTIONL                 PIC S9(04) COMP.          02060000
020700         10  MR-ACTIONA                 PIC  X(01).               02070000
020800         10  MR-ACTIONC                 PIC  X(01).               02080000
020900         10  MR-ACTIONH                 PIC  X(01).               02090000
021000         10  MR-ACTION                  PIC  X(03).               02100000
021100                                                                  02110000
021200         10  MR-VNDRL                   PIC S9(04) COMP.          02120000
021300         10  MR-VNDRA                   PIC  X(01).               02130000
021400         10  MR-VNDRC                   PIC  X(01).               02140000
021500         10  MR-VNDRH                   PIC  X(01).               02150000
021600         10  MR-VNDR                    PIC  X(30).               02160000
021700                                                                  02170000
021800                                                                  02180000
021900 EJECT                                                            02190000
022000*---------------------------------------------------------------* 02200000
022100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02210000
022200*---------------------------------------------------------------* 02220000
022300                                                                  02230000
022400     COPY DPWS015.                                                02240000
022500                                                                  02250000
022600*---------------------------------------------------------------* 02260000
022700*    FUNCTION KEYS COPYBOOK.                                    * 02270000
022800*---------------------------------------------------------------* 02280000
022900                                                                  02290000
023000     COPY DPWS016.                                                02300000
023100                                                                  02310000
023200*---------------------------------------------------------------* 02320000
023300*    NUMERIC EDIT LAYOUT.                                       * 02330000
023400*---------------------------------------------------------------* 02340000
023500                                                                  02350000
023600     COPY DPWS010I.                                               02360000
023700 EJECT                                                            02370000
023800*---------------------------------------------------------------* 02380000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02390003
024000*---------------------------------------------------------------* 02400000
024100                                                                  02410000
024200     COPY DPWS030.                                                02420000
CICS       COPY DPWS930.                                                02421003
024300 EJECT                                                            02430000
024400*---------------------------------------------------------------* 02440000
024500*    STANDARD COMMAREA.                                         * 02450000
024600*---------------------------------------------------------------* 02460000
024700                                                                  02470000
024800     COPY DPWS020.                                                02480000
024900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02490000
025000                                                                  02500000
025100*---------------------------------------------------------------* 02510000
025200*    INTER-APPLICATION COMMAREA.                                * 02520000
025300*                                                               * 02530000
025400*    ETWS300 - IS THE INCLUDE WHEN ARRIVING FROM CRITERIA SPEC  * 02540000
025500*                                                               * 02550000
025600*---------------------------------------------------------------* 02560000
025700                                                                  02570000
025800         10  INTER-APPL-COMM-AREA       PIC X(200).               02580000
025900     COPY ETWS300.                                                02590000
026000                                                                  02600000
026100*---------------------------------------------------------------* 02610000
026200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02620000
026300*---------------------------------------------------------------* 02630000
026400         10  ASC-SPECIFIC-COMMAREA.                               02640000
026500                                                                  02650000
026600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02660000
026700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02670000
026800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02680000
026900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02690000
027000                                                                  02700000
027100                 20  ASC-ITEM-ARRAY.                              02710000
027200                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02720000
027300                         30  ASC-LIST-ITEM-NUMBER                 02730000
027400                                                     PIC S9(09)   02740000
027500                                                     COMP-3.      02750000
027600                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02760000
027700                             88  ASC-VALID-SELECT    VALUES       02770000
027800                                               ' ' 'S' 'B' 'E'.   02780000
027900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02790000
028000                             88  ASC-TEMP-SELECT     VALUE 'S'.   02800000
028100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02810000
028200                             88  ASC-TEMP-END        VALUE 'E'.   02820000
028300                         30  ASC-SELECTED-SW         PIC  X(01).  02830000
028400                             88  ASC-NO-SELECT       VALUE ' '.   02840000
028500                             88  ASC-SELECT          VALUE 'S'.   02850000
028600                             88  ASC-BEGIN           VALUE 'B'.   02860000
028700                             88  ASC-END             VALUE 'E'.   02870000
028800                         30  ASC-ACTION              PIC  X(03).  02880000
028900                         30  ASC-ENT-ID              PIC S9(09)   02890000
029000                                                          COMP.   02900000
029100                         30  ASC-VENDOR-NAME         PIC  X(30).  02910000
029200                                                                  02920000
029300             15  ASC-BLK-SUB                         PIC S9(04)   02930000
029400                                                          COMP    02940000
029500                                                          SYNC.   02950000
029600             15  ASC-ITEM-SUB                        PIC S9(04)   02960000
029700                                                          COMP    02970000
029800                                                          SYNC.   02980000
029900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02990000
030000                                                          COMP-3. 03000000
030100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03010000
030200                                                          COMP-3. 03020000
030300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03030000
030400                                                          COMP-3. 03040000
030500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03050000
030600                                                          COMP-3. 03060000
030700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03070000
030800                                                          COMP-3. 03080000
030900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03090000
031000                                                          COMP    03100000
031100                                                          SYNC.   03110000
031200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03120000
031300                                                          COMP-3. 03130000
031400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03140000
031500                                                          COMP-3. 03150000
031600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03160000
031700                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03170000
031800                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03180000
031900             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03190000
032000                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03200000
032100                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03210000
032200             15  ASC-LIST-QUEUE-NAME.                             03220000
032300                 20  ASC-LIST-TERM-ID                PIC  X(04).  03230000
032400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03240000
032500                                                          COMP-3. 03250000
032600                 20  ASC-LIST-SEQ                    PIC  9(01).  03260000
032700             15  ASC-SEL-QUEUE-NAME.                              03270000
032800                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03280000
032900                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03290000
033000                                                          COMP-3. 03300000
033100                 20  ASC-SEL-SEQ                     PIC  9(01).  03310000
033200                                                                  03320000
033300             15  ASC-START-ITEM-REQUEST.                          03330000
033400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03340000
033500             15  ASC-HOLD-INTER-APPL                 PIC X(200).  03350000
033600         10  FILLER                                  PIC X(1367). 03360000
033700 EJECT                                                            03370000
033800*---------------------------------------------------------------* 03380000
033900*    ABEND PROCESSING COPYBOOK.                                 * 03390000
034000*---------------------------------------------------------------* 03400000
034100                                                                  03410000
034200     COPY DPWS013.                                                03420000
034300                                                                  03430000
034400 EJECT                                                            03440000
034500*---------------------------------------------------------------* 03450000
034600*    DB2 AREA FOR COMMUNICATIONS                                * 03460000
034700*---------------------------------------------------------------* 03470000
034800     EXEC SQL                                                     03480000
034900          INCLUDE SQLCA                                           03490000
035000     END-EXEC.                                                    03500000
035100                                                                  03510000
035200*---------------------------------------------------------------* 03520000
035300*    DB2 AREA FOR ENTITY NAME DETAILS                           * 03530000
035400*---------------------------------------------------------------* 03540000
035500     EXEC SQL                                                     03550000
035600          INCLUDE TENTNME                                         03560000
035700     END-EXEC.                                                    03570000
035800                                                                  03580000
035900*---------------------------------------------------------------* 03590000
036000*    CURSOR FOR ENTITY NAME DETAILS.                            * 03600000
036100*---------------------------------------------------------------* 03610000
036200                                                                  03620000
036300     EXEC SQL                                                     03630000
036400          DECLARE VENDOR-CURSOR CURSOR                            03640000
036500          FOR SELECT                                              03650000
036600                ENT_ID                                            03660000
036700              , SEQ_NBR                                           03670000
036800              , ENT_NAME_DESC                                     03680000
036900              , TYPE_CDE                                          03690000
037000          FROM                                                    03700000
037100                TENTNME                                           03710000
037200          WHERE                                                   03720000
037300                TYPE_CDE = '01'                                   03730000
037400*           AND                                                   03740000
037500*               ENT_ID  BETWEEN :PV-FROM-ENT-ID                   03750000
037600*                         AND   :PV-TO-ENT-ID                     03760000
037700            AND                                                   03770000
037800                ENT_NAME_DESC BETWEEN :PV-FROM-ALPHA-30           03780000
037900                                AND   :PV-TO-ALPHA-30             03790000
038000          ORDER BY                                                03800000
038100                ENT_NAME_DESC                                     03810000
038200     END-EXEC.                                                    03820000
038300                                                                  03830000
038400 EJECT                                                            03840000
038500 LINKAGE SECTION.                                                 03850000
038600                                                                  03860000
038700 01  DFHCOMMAREA.                                                 03870000
038800     05  FILLER                         OCCURS  1 TO 4072 TIMES   03880000
038900                                        DEPENDING ON EIBCALEN.    03890000
039000         10  FILLER                     PIC X.                    03900000
039100                                                                  03910000
039200 PROCEDURE DIVISION.                                              03920000
039300******************************************************************03930000
039400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **03940000
039500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **03950000
039600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **03960000
039700******************************************************************03970000
039800                                                                  03980000
039900 0000-MAIN-MODULE.                                                03990000
040000                                                                  04000000
040100     INITIALIZE DP030-CICS-API-FIELDS.                            04010000
040200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04020000
040300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04030000
040400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04040000
040500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04050000
040600                                                                  04060000
040700     MOVE LENGTH OF ET301AI        TO DP030-MAP-LENGTH (1).       04070000
040800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04080000
040900     PERFORM 0001-CALL-CICS-ARCH-API.                             04090000
041000                                                                  04100000
041100     PERFORM 1000-CONTROL-PROCESSING                              04110000
041200                                                                  04120000
041300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04130000
041400     PERFORM 0001-CALL-CICS-ARCH-API.                             04140000
041500                                                                  04150000
041600*----------------------------------------------------------------*04160000
041700*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *04170000
041800*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *04180000
041900*----------------------------------------------------------------*04190000
042000                                                                  04200000
042100 0001-CALL-CICS-ARCH-API.                                         04210000
042200                                                                  04220000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04230003
042400                                    DFHCOMMAREA                   04240003
042500                                    DP030-CICS-API-FIELDS         04250003
042600                                    DP020-STANDARD-COMMAREA       04260003
042700                                    ET301AI.                      04270003
042800                                                                  04280000
042900     IF  DP030-RC-CALL-SUCCESSFUL                                 04290000
043000         CONTINUE                                                 04300000
043100     ELSE                                                         04310000
043200         SET DP013-NO-ROLLBACK                                    04320000
043300             DP013-XCTL-DISPLAY-RESTART                           04330000
043400             DP013-CICS-ABEND      TO TRUE                        04340000
043500         MOVE '0001-CALL-CICS-ARCH-API'                           04350000
043600                                   TO DP013-PARAGRAPH             04360000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04370003
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04380003
043900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04390000
044000         PERFORM DP013-0000-PROCESS-ABEND                         04400000
044100     END-IF.                                                      04410000
044200                                                                  04420000
044300*----------------------------------------------------------------*04430000
044400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04440000
044500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04450000
044600*                                                                *04460000
044700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04470000
044800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04480000
044900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04490000
045000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04500000
045100*----------------------------------------------------------------*04510000
045200                                                                  04520000
045300 1000-CONTROL-PROCESSING.                                         04530000
045400                                                                  04540000
045500     EVALUATE TRUE                                                04550000
045600         WHEN DP020-NEXT-ACT-INITIAL                              04560000
045700              INITIALIZE ASC-SPECIFIC-COMMAREA                    04570000
045800              MOVE EIBTRMID         TO  ASC-LIST-TERM-ID          04580000
045900                                        ASC-SEL-TERM-ID           04590000
046000              MOVE DP020-SRC-TASK-NUMBER                          04600000
046100                                    TO  ASC-LIST-TASK-NUMBER      04610000
046200                                        ASC-SEL-TASK-NUMBER       04620000
046300              MOVE PC-LIST-QUEUE-SEQ                              04630000
046400                                    TO  ASC-LIST-SEQ              04640000
046500              MOVE PC-SEL-QUEUE-SEQ TO  ASC-SEL-SEQ               04650000
046600                                                                  04660000
046700              MOVE INTER-APPL-COMM-AREA                           04670000
046800                TO  ASC-HOLD-INTER-APPL                           04680000
046900                                                                  04690000
047000              PERFORM 4000-BUILD-INITIAL-PANEL                    04700000
047100                                                                  04710000
047200         WHEN DP020-NEXT-ACT-READ-MAP                             04720000
047300              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       04730000
047400                                   TO PV-TOP-ITEM                 04740000
047500              PERFORM 2000-PROCESS-PANEL                          04750000
047600                                                                  04760000
047700         WHEN DP020-NEXT-ACT-RETURN                               04770000
047800              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       04780000
047900                                   TO PV-TOP-ITEM                 04790000
048000              MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    04800000
048100              MOVE ASC-HOLD-INTER-APPL                            04810000
048200                                   TO INTER-APPL-COMM-AREA        04820000
048300              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                04830000
048400              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04840000
048500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                04850000
048600                                                                  04860000
048700         WHEN OTHER                                               04870000
048800              SET DP013-LOGIC-ABEND TO TRUE                       04880000
048900              SET DP013-NO-ROLLBACK TO TRUE                       04890000
049000              MOVE '1000-CONTROL-PROCESSING'                      04900000
049100                                   TO DP013-PARAGRAPH             04910000
049200              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'   04920000
049300                                   TO DP013-MESSAGE-TEXT(1)       04930000
049400              PERFORM DP013-0000-PROCESS-ABEND                    04940000
049500     END-EVALUATE.                                                04950000
049600                                                                  04960000
049700 EJECT                                                            04970000
049800*----------------------------------------------------------------*04980000
049900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04990000
050000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05000000
050100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05010000
050200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05020000
050300* FUNCTION KEYS CAN GET THIS FAR.                                *05030000
050400*----------------------------------------------------------------*05040000
050500                                                                  05050000
050600 2000-PROCESS-PANEL.                                              05060000
050700                                                                  05070000
050800*    ** THE FOLLOWING LINES WERE ADDED **                         05080000
050900     IF  ET300-VENDOR-NAME = SPACES OR LOW-VALUES                 05090000
051000         MOVE ASC-HOLD-INTER-APPL TO INTER-APPL-COMM-AREA         05100000
051100     END-IF.                                                      05110000
051200*    ****                                                         05120000
051300                                                                  05130000
051400     EVALUATE TRUE                                                05140000
051500         WHEN DP020-SRC-AID = DP016-CLEAR                         05150000
051600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05160000
051700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05170000
051800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05180000
051900                                                                  05190000
052000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05200000
052100             PERFORM 2050-DELETE-LIST-QUEUE                       05210000
052200             PERFORM 4000-BUILD-INITIAL-PANEL                     05220000
052300                                                                  05230000
052400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05240000
052500             PERFORM 2140-DESELECT-ALL-ITEMS                      05250000
052600             PERFORM 3200-RESET-ATTRIBUTES                        05260000
052700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05270000
052800                                                                  05280000
052900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05290000
053000             PERFORM 2150-SELECT-ALL-ITEMS                        05300000
053100             PERFORM 3200-RESET-ATTRIBUTES                        05310000
053200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05320000
053300                                                                  05330000
053400         WHEN OTHER                                               05340000
053500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05350000
053600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05360000
053700             IF  PS-NO-ERROR                                      05370000
053800                 SET DP030-CONTINUE-GO TO TRUE                    05380000
053900                 PERFORM 2100-CHECK-FUNCTION-KEY                  05390000
054000             ELSE                                                 05400000
054100*  ??            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05410000
054200                 SET DP030-OVERRIDE-GO TO TRUE                    05420000
054300             END-IF                                               05430000
054400     END-EVALUATE.                                                05440000
054500                                                                  05450000
054600 EJECT                                                            05460000
054700*----------------------------------------------------------------*05470000
054800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05480000
054900*----------------------------------------------------------------*05490000
055000 2050-DELETE-LIST-QUEUE.                                          05500000
055100                                                                  05510000
055200     EXEC CICS                                                    05520000
055300         DELETEQ TS                                               05530000
055400             QUEUE (ASC-LIST-QUEUE-NAME)                          05540000
055500             RESP  (PV-CICS-RESP)                                 05550000
055600     END-EXEC.                                                    05560000
055700                                                                  05570000
055800     IF (PV-CICS-RESP = DFHRESP(NORMAL)                           05580000
055900     OR  PV-CICS-RESP = DFHRESP(QIDERR))                          05590000
056000         CONTINUE                                                 05600000
056100     ELSE                                                         05610000
056200         SET DP013-CICS-ABEND      TO TRUE                        05620000
056300         SET DP013-NO-ROLLBACK     TO TRUE                        05630000
056400                                                                  05640000
056500         MOVE '2050-DELETE-LIST-QUEUE'                            05650000
056600                                   TO DP013-PARAGRAPH             05660000
056700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05670000
056800                                   TO DP013-MESSAGE-TEXT (1)      05680000
056900         PERFORM DP013-0000-PROCESS-ABEND                         05690000
057000     END-IF.                                                      05700000
057100                                                                  05710000
057200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05720000
057300                                                                  05730000
057400 EJECT                                                            05740000
057500*----------------------------------------------------------------*05750000
057600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05760000
057700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05770000
057800* CICS ARCHITECTURE API.                                         *05780000
057900*----------------------------------------------------------------*05790000
058000                                                                  05800000
058100 2100-CHECK-FUNCTION-KEY.                                         05810000
058200                                                                  05820000
058300     EVALUATE TRUE                                                05830000
058400         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  05840000
058500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              05850000
058600* DP36 ?         INITIALIZE ET300-INTER-APPL-COMMAREA             05860000
058700                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05870000
058800                                TO ET301-SELECTED-ITEMS           05880000
058900                                   ET300-NBR-SELECTED-ITEMS       05890000
059000                 PERFORM 5000-PREPARE-SEL-QUEUE                   05900000
059100             ELSE                                                 05910000
059200                 SET DP030-OVERRIDE-GO                            05920000
059300                                   TO TRUE                        05930000
059400                 MOVE PC-TSYMSG-00057                             05940000
059500                                   TO DP020-MSG-NUMBER            05950000
059600                 SET DP020-MSG-WARNING                            05960000
059700                                   TO TRUE                        05970000
059800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05980000
059900             END-IF                                               05990000
060000                                                                  06000000
060100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06010000
060200             MOVE +1               TO PV-TOP-ITEM                 06020000
060300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06030000
060400                                                                  06040000
060500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06050000
060600             PERFORM 2110-BROWSE-BACKWARD                         06060000
060700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06070000
060800                                                                  06080000
060900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06090000
061000             PERFORM 2120-BROWSE-FORWARD                          06100000
061100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06110000
061200                                                                  06120000
061300         WHEN DP020-SRC-AID = DP016-ENTER                         06130000
061400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06140000
061500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06150000
061600                                                                  06160000
061700         WHEN OTHER                                               06170000
061800             SET DP013-NO-ROLLBACK                                06180000
061900                 DP013-XCTL-DISPLAY-RESTART                       06190000
062000                 DP013-CICS-ABEND  TO TRUE                        06200000
062100             MOVE '2100-CHECK-FUNCTION-KEY'                       06210000
062200                                   TO DP013-PARAGRAPH             06220000
062300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06230000
062400                                   TO DP013-MESSAGE-TEXT (1)      06240000
062500             PERFORM DP013-0000-PROCESS-ABEND                     06250000
062600     END-EVALUATE.                                                06260000
062700                                                                  06270000
062800*----------------------------------------------------------------*06280000
062900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06290000
063000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06300000
063100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06310000
063200*    MESSAGE.                                                    *06320000
063300*----------------------------------------------------------------*06330000
063400                                                                  06340000
063500 2110-BROWSE-BACKWARD.                                            06350000
063600                                                                  06360000
063700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06370000
063800         GIVING PV-TOP-ITEM.                                      06380000
063900                                                                  06390000
064000     IF  ((PV-TOP-ITEM < +1)                                      06400000
064100       OR (PV-TOP-ITEM = +1))                                     06410000
064200         MOVE +1                   TO PV-TOP-ITEM                 06420000
064300*        -- TOP OF LIST --                                        06430000
064400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06440000
064500         SET DP020-MSG-INFORMATIONAL TO TRUE                      06450000
064600     END-IF.                                                      06460000
064700                                                                  06470000
064800 EJECT                                                            06480000
064900*----------------------------------------------------------------*06490000
065000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06500000
065100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06510000
065200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06520000
065300*----------------------------------------------------------------*06530000
065400                                                                  06540000
065500 2120-BROWSE-FORWARD.                                             06550000
065600                                                                  06560000
065700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06570000
065800         GIVING PV-TOP-ITEM.                                      06580000
065900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06590000
066000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06600000
066100                                   TO PV-TOP-ITEM                 06610000
066200*        -- BOTTOM OF LIST --                                     06620000
066300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06630000
066400         SET DP020-MSG-INFORMATIONAL                              06640000
066500                                   TO TRUE                        06650000
066600     ELSE                                                         06660000
066700         COMPUTE PV-BOTTOM-ITEM =                                 06670000
066800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06680000
066900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06690000
067000*            -- BOTTOM OF LIST --                                 06700000
067100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06710000
067200             SET DP020-MSG-INFORMATIONAL                          06720000
067300                                   TO TRUE                        06730000
067400         END-IF                                                   06740000
067500     END-IF.                                                      06750000
067600 EJECT                                                            06760000
067700*----------------------------------------------------------------*06770000
067800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06780000
067900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06790000
068000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06800000
068100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06810000
068200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06820000
068300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06830000
068400*----------------------------------------------------------------*06840000
068500                                                                  06850000
068600 2130-CHECK-FOR-JUMP-BROWSE.                                      06860000
068700                                                                  06870000
068800     SET PS-NO-ERROR               TO TRUE.                       06880000
068900     IF (ASC-START-ITEM-REQUEST = SPACE)                          06890000
069000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06900000
069100                                   TO PV-TOP-ITEM                 06910000
069200     ELSE                                                         06920000
069300         MOVE ASC-START-ITEM-REQUEST                              06930000
069400                                   TO DP010I-UNEDITED-FIELD       06940000
069500                                      PV-START-ITEM-REQUEST       06950000
069600         MOVE PC-START-ITEM-LENGTH TO DP010I-MAXIMUM-DIGITS       06960000
069700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06970000
069800         SET DP010I-NEGATIVE-NOT-ALLOWED                          06980000
069900                                   TO TRUE                        06990000
070010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07001001
070020                         USING DP010I-NUMERIC-EDIT-AREA           07002001
070100                                                                  07010000
070200         IF  NOT DP010I-ERROR-DETECTED                            07020000
070300             MOVE DP010I-NUMERIC-FIELD                            07030000
070400                                   TO  ASC-START-ITEM-REQUEST-N   07040000
070500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07050000
070600                 IF  ASC-START-ITEM-REQUEST-N >                   07060000
070700                                          ASC-NUMBER-OF-ITEMS-READ07070000
070800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07080000
070900                     COMPUTE PV-TOP-ITEM =                        07090000
071000                             ASC-NUMBER-OF-ITEMS-READ             07100000
071100                             - PC-ITEMS-PER-PANEL + 1             07110000
071200                     IF  PV-TOP-ITEM < +1                         07120000
071300                         MOVE +1   TO PV-TOP-ITEM                 07130000
071400                         MOVE PC-TSYMSG-00070                     07140000
071500                                   TO DP020-MSG-NUMBER            07150000
071600                         SET DP020-MSG-INFORMATIONAL              07160000
071700                                   TO TRUE                        07170000
071800                     END-IF                                       07180000
071900                 ELSE                                             07190000
072000                     MOVE ASC-START-ITEM-REQUEST-N                07200000
072100                                   TO PV-TOP-ITEM                 07210000
072200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07220000
072300                     COMPUTE PV-BOTTOM-ITEM =                     07230000
072400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07240000
072500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07250000
072600*                        -- BOTTOM OF LIST --                     07260000
072700                         MOVE PC-TSYMSG-00070                     07270000
072800                                   TO DP020-MSG-NUMBER            07280000
072900                         SET DP020-MSG-INFORMATIONAL              07290000
073000                                   TO TRUE                        07300000
073100                     END-IF                                       07310000
073200                 END-IF                                           07320000
073300             ELSE                                                 07330000
073400*                --- VALUE OUT OF RANGE ----                      07340000
073500                 MOVE PC-TSYMSG-00101                             07350000
073600                                   TO DP020-MSG-NUMBER            07360000
073700                 MOVE -1           TO ASTRTITL                    07370000
073800                 SET DP030-SET-CURSOR-APPL-1                      07380000
073900                                   TO TRUE                        07390000
074000                 MOVE DP015-REVERSE                               07400000
074100                                   TO ASTRTITH                    07410000
074200                 MOVE DP015-RED    TO ASTRTITC                    07420000
074300                 MOVE DP015-UNP-NUM-BRT-OFF                       07430000
074400                                   TO ASTRTITA                    07440000
074500                 SET DP020-MSG-FATAL                              07450000
074600                                   TO TRUE                        07460000
074700                 SET PS-ERROR      TO TRUE                        07470000
074800             END-IF                                               07480000
074900                                                                  07490000
075000         ELSE                                                     07500000
075100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07510000
075200             MOVE -1               TO ASTRTITL                    07520000
075300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07530000
075400             MOVE DP015-REVERSE    TO ASTRTITH                    07540000
075500             MOVE DP015-RED        TO ASTRTITC                    07550000
075600             MOVE DP015-UNP-NUM-BRT-OFF                           07560000
075700                                   TO ASTRTITA                    07570000
075800             SET DP020-MSG-FATAL   TO TRUE                        07580000
075900             SET PS-ERROR          TO TRUE                        07590000
076000         END-IF                                                   07600000
076100     END-IF.                                                      07610000
076200 EJECT                                                            07620000
076300*----------------------------------------------------------------*07630000
076400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07640000
076500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07650000
076600*----------------------------------------------------------------*07660000
076700                                                                  07670000
076800 2140-DESELECT-ALL-ITEMS.                                         07680000
076900                                                                  07690000
077000     MOVE +1                       TO ASC-BLK-SUB.                07700000
077100                                                                  07710000
077200     PERFORM 2141-CLEAR-SELECTED-INDS                             07720000
077300         VARYING ASC-ITEM-SUB                                     07730000
077400         FROM 1 BY 1                                              07740000
077500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07750000
077600                                                                  07760000
077700     ADD +1                        TO ASC-BLK-SUB.                07770000
077800                                                                  07780000
077900     PERFORM 2141-CLEAR-SELECTED-INDS                             07790000
078000         VARYING ASC-ITEM-SUB                                     07800000
078100         FROM 1 BY 1                                              07810000
078200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07820000
078300                                                                  07830000
078400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07840000
078500                                   TO PV-LIST-ITEM-NUMBER.        07850000
078600                                                                  07860000
078700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07870000
078800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07880000
078900                                                                  07890000
079000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07900000
079100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07910000
079200         MOVE +1                   TO ASC-BLK-SUB                 07920000
079300                                                                  07930000
079400         PERFORM 5100-WRITE-TEMP-STORAGE                          07940000
079500                                                                  07950000
079600         MOVE +1                   TO PV-BLOCK-NUMBER             07960000
079700                                                                  07970000
079800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07980000
079900             PV-FIRST-BLOCK-IN-ARRAY - 1                          07990000
080000                                                                  08000000
080100         PERFORM                                                  08010000
080200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08020000
080300                                                                  08030000
080400             PERFORM 4410-READ-TEMP-STORAGE                       08040000
080500                                                                  08050000
080600             PERFORM 2141-CLEAR-SELECTED-INDS                     08060000
080700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08070000
080800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08080000
080900                                                                  08090000
081000             PERFORM 5100-WRITE-TEMP-STORAGE                      08100000
081100                                                                  08110000
081200             ADD +1                TO PV-BLOCK-NUMBER             08120000
081300                                                                  08130000
081400         END-PERFORM                                              08140000
081500                                                                  08150000
081600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08160000
081700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08170000
081800                                                                  08180000
081900         PERFORM                                                  08190000
082000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08200000
082100                   ASC-HIGHEST-BLOCK-WRITTEN                      08210000
082200                                                                  08220000
082300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08230000
082400                                   TO PV-BLOCK-NUMBER             08240000
082500                                                                  08250000
082600             PERFORM 4410-READ-TEMP-STORAGE                       08260000
082700                                                                  08270000
082800             PERFORM 2141-CLEAR-SELECTED-INDS                     08280000
082900                 VARYING ASC-ITEM-SUB                             08290000
083000                 FROM 1 BY 1                                      08300000
083100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08310000
083200                                                                  08320000
083300             PERFORM 5100-WRITE-TEMP-STORAGE                      08330000
083400                                                                  08340000
083500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08350000
083600                                                                  08360000
083700         END-PERFORM                                              08370000
083800                                                                  08380000
083900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08390000
084000                                   TO PV-BLOCK-NUMBER             08400000
084100                                                                  08410000
084200         PERFORM 4410-READ-TEMP-STORAGE                           08420000
084300     END-IF.                                                      08430000
084400                                                                  08440000
084500     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08450000
084600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08460000
084700     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08470000
084800                                                                  08480000
084900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08490000
085000                                                                  08500000
085100 EJECT                                                            08510000
085200*----------------------------------------------------------------*08520000
085300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08530000
085400*----------------------------------------------------------------*08540000
085500                                                                  08550000
085600 2141-CLEAR-SELECTED-INDS.                                        08560000
085700                                                                  08570000
085800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08580000
085900             NOT EQUAL ZERO                                       08590000
086000         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08600000
086100             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08610000
086200                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08620000
086300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08630000
086400                                   TO TRUE                        08640000
086500         END-IF                                                   08650000
086600     END-IF.                                                      08660000
086700                                                                  08670000
086800 EJECT                                                            08680000
086900*----------------------------------------------------------------*08690000
087000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08700000
087100*  FOR ALL ITEMS.                                                *08710000
087200*----------------------------------------------------------------*08720000
087300                                                                  08730000
087400 2150-SELECT-ALL-ITEMS.                                           08740000
087500                                                                  08750000
087600     MOVE +1                       TO ASC-BLK-SUB.                08760000
087700                                                                  08770000
087800     PERFORM 2151-SET-SELECTED-INDS                               08780000
087900         VARYING ASC-ITEM-SUB                                     08790000
088000         FROM 1 BY 1                                              08800000
088100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08810000
088200                                                                  08820000
088300     ADD +1                        TO ASC-BLK-SUB.                08830000
088400                                                                  08840000
088500     PERFORM 2151-SET-SELECTED-INDS                               08850000
088600         VARYING ASC-ITEM-SUB                                     08860000
088700         FROM 1 BY 1                                              08870000
088800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08880000
088900                                                                  08890000
089000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08900000
089100                                   TO PV-LIST-ITEM-NUMBER.        08910000
089200                                                                  08920000
089300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08930000
089400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08940000
089500                                                                  08950000
089600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08960000
089700        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08970000
089800         MOVE +1                   TO ASC-BLK-SUB                 08980000
089900                                                                  08990000
090000         PERFORM 5100-WRITE-TEMP-STORAGE                          09000000
090100                                                                  09010000
090200         MOVE +1                   TO PV-BLOCK-NUMBER             09020000
090300                                                                  09030000
090400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09040000
090500             PV-FIRST-BLOCK-IN-ARRAY - 1                          09050000
090600                                                                  09060000
090700         PERFORM                                                  09070000
090800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09080000
090900                                                                  09090000
091000             PERFORM 4410-READ-TEMP-STORAGE                       09100000
091100                                                                  09110000
091200             PERFORM 2151-SET-SELECTED-INDS                       09120000
091300                 VARYING ASC-ITEM-SUB                             09130000
091400                 FROM 1 BY 1                                      09140000
091500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09150000
091600                                                                  09160000
091700             PERFORM 5100-WRITE-TEMP-STORAGE                      09170000
091800                                                                  09180000
091900             ADD +1                TO PV-BLOCK-NUMBER             09190000
092000                                                                  09200000
092100         END-PERFORM                                              09210000
092200                                                                  09220000
092300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09230000
092400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09240000
092500                                                                  09250000
092600         PERFORM                                                  09260000
092700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09270000
092800                   ASC-HIGHEST-BLOCK-WRITTEN                      09280000
092900                                                                  09290000
093000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09300000
093100                                   TO PV-BLOCK-NUMBER             09310000
093200                                                                  09320000
093300             PERFORM 4410-READ-TEMP-STORAGE                       09330000
093400                                                                  09340000
093500             PERFORM 2151-SET-SELECTED-INDS                       09350000
093600                 VARYING ASC-ITEM-SUB                             09360000
093700                 FROM 1 BY 1                                      09370000
093800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09380000
093900                                                                  09390000
094000             PERFORM 5100-WRITE-TEMP-STORAGE                      09400000
094100                                                                  09410000
094200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09420000
094300                                                                  09430000
094400         END-PERFORM                                              09440000
094500                                                                  09450000
094600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09460000
094700                                   TO PV-BLOCK-NUMBER             09470000
094800                                                                  09480000
094900         PERFORM 4410-READ-TEMP-STORAGE                           09490000
095000     END-IF.                                                      09500000
095100                                                                  09510000
095200                                                                  09520000
095300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09530000
095400                       ASC-NUMBER-OF-SELECTED-ITEMS.              09540000
095500                                                                  09550000
095600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09560000
095700                                                                  09570000
095800 EJECT                                                            09580000
095900*----------------------------------------------------------------*09590000
096000*    MARK EACH ITEM AS BEING SELECTED.                           *09600000
096100*----------------------------------------------------------------*09610000
096200                                                                  09620000
096300 2151-SET-SELECTED-INDS.                                          09630000
096400                                                                  09640000
096500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09650000
096600             NOT EQUAL ZERO                                       09660000
096700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09670000
096800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09680000
096900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09690000
097000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09700000
097100                               TO  TRUE                           09710000
097200         END-IF                                                   09720000
097300     END-IF.                                                      09730000
097400                                                                  09740000
097500*----------------------------------------------------------------*09750000
097600*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *09760000
097700*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *09770000
097800*----------------------------------------------------------------*09780000
097900                                                                  09790000
098000 2200-MOVE-SCREEN-TO-COMMAREA.                                    09800000
098100                                                                  09810000
098200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09820000
098300     MOVE +1                       TO PV-SUB.                     09830000
098400                                                                  09840000
098500*?   PERFORM 3100-SET-SUBSCRIPTS.  ** INSTEAD OF WHERE IT IS BELOW09850000
098600                                                                  09860000
098700     IF  ASTRTITL > ZERO                                          09870000
098800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09880000
098900     ELSE                                                         09890000
099000         IF  ASTRTITF EQUAL DP015-ERASE-EOF                       09900000
099100             INITIALIZE ASC-START-ITEM-REQUEST                    09910000
099200         END-IF                                                   09920000
099300     END-IF.                                                      09930000
099400                                                                  09940000
099500     PERFORM 3100-SET-SUBSCRIPTS.                                 09950000
099600                                                                  09960000
099700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09970000
099800         VARYING PV-SUB                                           09980000
099900         FROM 1 BY 1                                              09990000
100000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10000000
100100                                                                  10010000
100200******************************************************************10020000
100300** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10030000
100400******************************************************************10040000
100500                                                                  10050000
100600 2210-MOVE-LINES-TO-COMMAREA.                                     10060000
100700                                                                  10070000
100800     IF  MR-SELECTL (PV-SUB) > ZERO                               10080000
100900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10090000
101000         MOVE MR-SELECTI (PV-SUB)                                 10100000
101100                                   TO ASC-TEMP-SELECTED-SW        10110000
101200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10120000
101300     ELSE                                                         10130000
101400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10140000
101500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10150000
101600                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10160000
101700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10170000
101800         END-IF                                                   10180000
101900     END-IF.                                                      10190000
102000                                                                  10200000
102100     ADD +1                        TO ASC-ITEM-SUB.               10210000
102200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10220000
102300         ADD +1                    TO ASC-BLK-SUB                 10230000
102400         MOVE +1                   TO ASC-ITEM-SUB                10240000
102500     END-IF.                                                      10250000
102600                                                                  10260000
102700*----------------------------------------------------------------*10270000
102800*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *10280000
102900*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *10290000
103000*----------------------------------------------------------------*10300000
103100                                                                  10310000
103200 3000-EDIT-DATA-IN-COMMAREA.                                      10320000
103300                                                                  10330000
103400     SET PS-NO-ERROR               TO TRUE.                       10340000
103500     PERFORM 3200-RESET-ATTRIBUTES.                               10350000
103600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10360000
103700**                                                                10370000
103800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10380000
103900* EDITTING IS DONE FROM THE BOTTOM UP.                            10390000
104000**                                                                10400000
104100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10410000
104200         ASC-ITEMS-DISPLAYED - 1.                                 10420000
104300     PERFORM 3100-SET-SUBSCRIPTS.                                 10430000
104400     PERFORM 3300-EDIT-SELECTIONS                                 10440000
104500         VARYING PV-SUB                                           10450000
104600         FROM PV-SUB BY -1                                        10460000
104700         UNTIL PV-SUB < +1.                                       10470000
104800                                                                  10480000
104900     IF  PS-NO-ERROR                                              10490000
105000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10500000
105100     END-IF.                                                      10510000
105200                                                                  10520000
105300     IF  ((PS-NO-ERROR)                                           10530000
105400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10540000
105500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10550000
105600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10560000
105700     END-IF.                                                      10570000
105800 EJECT                                                            10580000
105900*----------------------------------------------------------------*10590000
106000*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *10600000
106100*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10610000
106200*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *10620000
106300*                                                                *10630000
106400*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *10640000
106500*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *10650000
106600*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *10660000
106700*    US IN THE 2ND BLOCK OF THE ARRAY.                           *10670000
106800*----------------------------------------------------------------*10680000
106900                                                                  10690000
107000 3100-SET-SUBSCRIPTS.                                             10700000
107100                                                                  10710000
107200     COMPUTE ASC-ITEM-SUB =                                       10720000
107300         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10730000
107400                                                                  10740000
107500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10750000
107600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10760000
107700                                                                  10770000
107800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10780000
107900     ELSE                                                         10790000
108000         MOVE +1                     TO ASC-BLK-SUB               10800000
108100     END-IF.                                                      10810000
108200                                                                  10820000
108300*----------------------------------------------------------------*10830000
108400*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *10840000
108500*----------------------------------------------------------------*10850000
108600                                                                  10860000
108700 3200-RESET-ATTRIBUTES.                                           10870000
108800                                                                  10880000
108900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10890000
109000     MOVE DP015-GREEN              TO ASTRTITC.                   10900000
109100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10910000
109200                                                                  10920000
109300     PERFORM                                                      10930000
109400         VARYING PV-SUB                                           10940000
109500         FROM 1 BY 1                                              10950000
109600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        10960000
109700         MOVE DP015-UNP-ALP-NOR-OFF                               10970000
109800                                   TO MR-SELECTA (PV-SUB)         10980000
109900         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         10990000
110000         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11000000
110100     END-PERFORM.                                                 11010000
110200                                                                  11020000
110300*----------------------------------------------------------------*11030000
110400*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *11040000
110500*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *11050000
110600*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *11060000
110700*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *11070000
110800*----------------------------------------------------------------*11080000
110900                                                                  11090000
111000 3300-EDIT-SELECTIONS.                                            11100000
111100                                                                  11110000
111200     EVALUATE TRUE                                                11120000
111300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11130000
111400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11140000
111500                 CONTINUE                                         11150000
111600                                                                  11160000
111700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11170000
111800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11180000
111900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11190000
112000                 MOVE ASC-TEMP-SELECTED-SW                        11200000
112100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11210000
112200                                TO ASC-SELECTED-SW                11220000
112300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11230000
112400             END-IF                                               11240000
112500                                                                  11250000
112600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11260000
112700                 = SPACE                                          11270000
112800             EVALUATE TRUE                                        11280000
112900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11290000
113000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11300000
113100                     MOVE SPACE TO ASC-SELECTED-SW                11310000
113200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11320000
113300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11330000
113400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11340000
113500                     MOVE SPACE TO ASC-SELECTED-SW                11350000
113600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11360000
113700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11370000
113800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11380000
113900                     MOVE SPACE TO ASC-SELECTED-SW                11390000
114000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11400000
114100             END-EVALUATE                                         11410000
114200                                                                  11420000
114300         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           11430000
114400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11440000
114500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11450000
114600             END-IF                                               11460000
114700             PERFORM 3310-EDIT-RANGE                              11470000
114800                                                                  11480000
114900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             11490000
115000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11500000
115100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11510000
115200             END-IF                                               11520000
115300             PERFORM 3310-EDIT-RANGE                              11530000
115400                                                                  11540000
115500         WHEN OTHER                                               11550000
115600             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           11560000
115700             SET DP020-MSG-FATAL    TO TRUE                       11570000
115800             MOVE -1                TO MR-SELECTL (PV-SUB)        11580000
115900             SET DP030-SET-CURSOR-APPL-1                          11590000
116000                                    TO TRUE                       11600000
116100             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        11610000
116200             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        11620000
116300             SET PS-ERROR TO TRUE                                 11630000
116400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11640000
116500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     11650000
116600                 MOVE SPACE         TO ASC-SELECTED-SW            11660000
116700                                        (ASC-BLK-SUB ASC-ITEM-SUB)11670000
116800             END-IF                                               11680000
116900                                                                  11690000
117000     END-EVALUATE.                                                11700000
117100                                                                  11710000
117200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11720000
117300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               11730000
117400     IF  ASC-ITEM-SUB < 1                                         11740000
117500         SUBTRACT +1 FROM ASC-BLK-SUB                             11750000
117600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                11760000
117700     END-IF.                                                      11770000
117800                                                                  11780000
117900*----------------------------------------------------------------*11790000
118000*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *11800000
118100*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *11810000
118200*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *11820000
118300*  THE ENDING.                                                   *11830000
118400*----------------------------------------------------------------*11840000
118500                                                                  11850000
118600 3310-EDIT-RANGE.                                                 11860000
118700                                                                  11870000
118800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                11880000
118900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   11890000
119000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)11900000
119100                                   TO ASC-SELECTED-SW             11910000
119200                                        (ASC-BLK-SUB ASC-ITEM-SUB)11920000
119300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 11930000
119400         ELSE                                                     11940000
119500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     11950000
119600                 CONTINUE                                         11960000
119700             ELSE                                                 11970000
119800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        11980000
119900                 MOVE PC-TSYMSG-00054                             11990000
120000                                   TO DP020-MSG-NUMBER            12000000
120100                 SET DP020-MSG-FATAL                              12010000
120200                                   TO TRUE                        12020000
120300                 MOVE -1           TO MR-SELECTL (PV-SUB)         12030000
120400                 SET DP030-SET-CURSOR-APPL-1                      12040000
120500                                   TO TRUE                        12050000
120600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12060000
120700                 MOVE DP015-UNDERLINE                             12070000
120800                                   TO MR-SELECTH (PV-SUB)         12080000
120900                 SET PS-ERROR      TO TRUE                        12090000
121000             END-IF                                               12100000
121100         END-IF                                                   12110000
121200     ELSE                                                         12120000
121300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12130000
121400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12140000
121500                                   TO ASC-SELECTED-SW             12150000
121600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12160000
121700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12170000
121800         ELSE                                                     12180000
121900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12190000
122000                 CONTINUE                                         12200000
122100             ELSE                                                 12210000
122200*                -- ONLY ONE END-OF-RANGE ALLOWED --              12220000
122300                 MOVE PC-TSYMSG-00055                             12230000
122400                                   TO DP020-MSG-NUMBER            12240000
122500                 SET DP020-MSG-FATAL                              12250000
122600                                   TO TRUE                        12260000
122700                 MOVE -1           TO MR-SELECTL (PV-SUB)         12270000
122800                 SET DP030-SET-CURSOR-APPL-1                      12280000
122900                                   TO TRUE                        12290000
123000                 SET PS-ERROR      TO TRUE                        12300000
123100             END-IF                                               12310000
123200         END-IF                                                   12320000
123300     END-IF.                                                      12330000
123400                                                                  12340000
123500*----------------------------------------------------------------*12350000
123600*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *12360000
123700*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *12370000
123800*----------------------------------------------------------------*12380000
123900                                                                  12390000
124000 3400-CHECK-RANGE-SEQUENCE.                                       12400000
124100                                                                  12410000
124200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12420000
124300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12430000
124400       AND  ASC-START-OF-SELECTED-RANGE >                         12440000
124500                                         ASC-END-OF-SELECTED-RANGE12450000
124600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                12460000
124700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 12470000
124800         SET DP020-MSG-FATAL TO TRUE                              12480000
124900         SET PS-ERROR TO TRUE                                     12490000
125000         PERFORM 3410-POSITION-AT-ERROR                           12500000
125100     END-IF.                                                      12510000
125200                                                                  12520000
125300*----------------------------------------------------------------*12530000
125400*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *12540000
125500*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *12550000
125600*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *12560000
125700*----------------------------------------------------------------*12570000
125800                                                                  12580000
125900 3410-POSITION-AT-ERROR.                                          12590000
126000                                                                  12600000
126100     SET DP030-SET-CURSOR-APPL-1                                  12610000
126200                                   TO TRUE.                       12620000
126300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 12630000
126400                    - PV-TOP-ITEM + 1.                            12640000
126500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12650000
126600         CONTINUE                                                 12660000
126700     ELSE                                                         12670000
126800         MOVE -1                   TO MR-SELECTL (PV-SUB)         12680000
126900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12690000
127000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12700000
127100     END-IF.                                                      12710000
127200*                                                                 12720000
127300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   12730000
127400                    - PV-TOP-ITEM + 1.                            12740000
127500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12750000
127600         CONTINUE                                                 12760000
127700     ELSE                                                         12770000
127800         MOVE -1                   TO MR-SELECTL (PV-SUB)         12780000
127900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12790000
128000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12800000
128100     END-IF.                                                      12810000
128200 EJECT                                                            12820000
128300*----------------------------------------------------------------*12830000
128400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *12840000
128500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *12850000
128600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *12860000
128700*----------------------------------------------------------------*12870000
128800                                                                  12880000
128900 3500-MARK-RANGE-AS-SELECTED.                                     12890000
129000                                                                  12900000
129100     MOVE +1                       TO  ASC-BLK-SUB.               12910000
129200     PERFORM 3510-MARK-SELECTED-INDS                              12920000
129300         VARYING ASC-ITEM-SUB                                     12930000
129400         FROM 1 BY 1                                              12940000
129500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12950000
129600                                                                  12960000
129700     ADD +1                        TO ASC-BLK-SUB.                12970000
129800     PERFORM 3510-MARK-SELECTED-INDS                              12980000
129900         VARYING ASC-ITEM-SUB                                     12990000
130000         FROM 1 BY 1                                              13000000
130100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13010000
130200                                                                  13020000
130300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13030000
130400                                   TO  PV-LIST-ITEM-NUMBER.       13040000
130500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13050000
130600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13060000
130700               PC-ITEMS-PER-PANEL).                               13070000
130800                                                                  13080000
130900     MOVE ASC-START-OF-SELECTED-RANGE                             13090000
131000                                   TO PV-START-OF-SELECTED-RANGE. 13100000
131100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13110000
131200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13120000
131300               PC-ITEMS-PER-PANEL).                               13130000
131400                                                                  13140000
131500     MOVE ASC-END-OF-SELECTED-RANGE                               13150000
131600                                   TO  PV-END-OF-SELECTED-RANGE.  13160000
131700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13170000
131800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13180000
131900               PC-ITEMS-PER-PANEL).                               13190000
132000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13200000
132100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13210000
132200                                                                  13220000
132300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13230000
132400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13240000
132500         MOVE +1                   TO ASC-BLK-SUB                 13250000
132600         PERFORM 5100-WRITE-TEMP-STORAGE                          13260000
132700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13270000
132800             PV-FIRST-BLOCK-IN-ARRAY - 1                          13280000
132900                                                                  13290000
133000         PERFORM                                                  13300000
133100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13310000
133200                   PV-PREV-BLOCK-IN-ARRAY                         13320000
133300             MOVE PV-FIRST-BLOCK-IN-RANGE                         13330000
133400                                   TO PV-BLOCK-NUMBER             13340000
133500             PERFORM 4410-READ-TEMP-STORAGE                       13350000
133600             PERFORM 3510-MARK-SELECTED-INDS                      13360000
133700                 VARYING ASC-ITEM-SUB                             13370000
133800                 FROM 1 BY 1                                      13380000
133900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13390000
134000             PERFORM 5100-WRITE-TEMP-STORAGE                      13400000
134100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13410000
134200         END-PERFORM                                              13420000
134300                                                                  13430000
134400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13440000
134500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13450000
134600         PERFORM                                                  13460000
134700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13470000
134800                   PV-LAST-BLOCK-IN-RANGE                         13480000
134900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13490000
135000                                   TO PV-BLOCK-NUMBER             13500000
135100             PERFORM 4410-READ-TEMP-STORAGE                       13510000
135200             PERFORM 3510-MARK-SELECTED-INDS                      13520000
135300                 VARYING ASC-ITEM-SUB                             13530000
135400                 FROM 1 BY 1                                      13540000
135500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13550000
135600             PERFORM 5100-WRITE-TEMP-STORAGE                      13560000
135700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13570000
135800         END-PERFORM                                              13580000
135900                                                                  13590000
136000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13600000
136100                                   TO PV-BLOCK-NUMBER             13610000
136200         PERFORM 4410-READ-TEMP-STORAGE                           13620000
136300     END-IF.                                                      13630000
136400                                                                  13640000
136500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 13650000
136600                                      ASC-END-OF-SELECTED-RANGE.  13660000
136700 EJECT                                                            13670000
136800*----------------------------------------------------------------*13680000
136900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *13690000
137000*----------------------------------------------------------------*13700000
137100                                                                  13710000
137200 3510-MARK-SELECTED-INDS.                                         13720000
137300                                                                  13730000
137400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13740000
137500                                ASC-ITEM-SUB) >                   13750000
137600         ASC-START-OF-SELECTED-RANGE)                             13760000
137700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13770000
137800                                ASC-ITEM-SUB) =                   13780000
137900         ASC-START-OF-SELECTED-RANGE)                             13790000
138000                                                                  13800000
138100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13810000
138200                                    ASC-ITEM-SUB) <               13820000
138300             ASC-END-OF-SELECTED-RANGE)                           13830000
138400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13840000
138500                                    ASC-ITEM-SUB) =               13850000
138600             ASC-END-OF-SELECTED-RANGE)                           13860000
138700                                                                  13870000
138800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13880000
138900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   13890000
139000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   13900000
139100                               TO TRUE                            13910000
139200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              13920000
139300                               TO TRUE                            13930000
139400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    13940000
139500             END-IF                                               13950000
139600         END-IF                                                   13960000
139700     END-IF.                                                      13970000
139800 EJECT                                                            13980000
139900*----------------------------------------------------------------*13990000
140000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14000000
140100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14010000
140200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14020000
140300*    DISPLAY THE PANEL TO USER.                                  *14030000
140400*----------------------------------------------------------------*14040000
140500                                                                  14050000
140600 4000-BUILD-INITIAL-PANEL.                                        14060000
140700                                                                  14070000
140800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14080000
140900                                 ASC-BLOCK-ENTRIES (2).           14090000
141000                                                                  14100000
141100     MOVE +1                 TO  ASC-BLK-SUB.                     14110000
141200                                                                  14120000
141300     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           14130000
141400                                                                  14140000
141500     MOVE +0                 TO ASC-ITEM-SUB                      14150000
141600                                ASC-NUMBER-OF-ITEMS-READ          14160000
141700                                ASC-NUMBER-OF-SELECTED-ITEMS      14170000
141800                                ASC-HIGHEST-BLOCK-WRITTEN         14180000
141900                                ASC-START-OF-SELECTED-RANGE       14190000
142000                                ASC-END-OF-SELECTED-RANGE         14200000
142100                                ASC-ITEM-AT-TOP-OF-PANEL.         14210000
142200                                                                  14220000
142300     PERFORM 4100-PREPARE-CURSOR.                                 14230000
142400                                                                  14240000
142500     PERFORM 4010-OPEN-CURSOR.                                    14250000
142600                                                                  14260000
142700     IF SQLCODE = ZERO                                            14270000
142800                                                                  14280000
142900         PERFORM 4300-READ-ITEMS-FROM-DB                          14290000
143000         PERFORM 4020-CLOSE-CURSOR                                14300000
143100                                                                  14310000
143200         MOVE +1        TO  PV-TOP-ITEM                           14320000
143300*  ?     MOVE SPACE     TO  ASC-START-ITEM-REQUEST                14330000
143400                                                                  14340000
143500         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      14350000
143600              SET DP020-NEXT-ACT-APPL-ERROR TO TRUE               14360000
143700              SET DP020-MSG-FATAL           TO TRUE               14370000
143800*                --- NO LIST ITEMS FOUND FOR CRITERIA ----        14380000
143900              MOVE PC-TSYMSG-00050          TO DP020-MSG-NUMBER   14390000
144000         ELSE                                                     14400000
144100*      ??    MOVE -1                        TO MR-SELECTL (1)     14410000
144200*      ??    SET DP030-SET-CURSOR-APPL-1    TO TRUE               14420000
144300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14430000
144400         END-IF                                                   14440000
144500                                                                  14450000
144600     ELSE                                                         14460000
144700        SET DP020-NEXT-ACT-APPL-ERROR       TO TRUE               14470000
144800        SET DP020-MSG-WARNING               TO TRUE               14480000
144900*       --- WAIT 15 SECONDS, THEN RETRY ---                       14490000
145000        MOVE PC-TSYMSG-00551                TO DP020-MSG-NUMBER   14500000
145100                                                                  14510000
145200     END-IF.                                                      14520000
145300                                                                  14530000
145400 EJECT                                                            14540000
145500*----------------------------------------------------------------*14550000
145600* OPEN THE CURSOR.                                               *14560000
145700*   IN THIS PARTICULAR APPLICATION, ONLY 1 CURSOR WILL           *14570000
145800*   BE OPENED FOR THE CRITERIA SPECIFIED BY THE USER.            *14580000
145900*----------------------------------------------------------------*14590000
146000                                                                  14600000
146100 4010-OPEN-CURSOR.                                                14610000
146200                                                                  14620000
146300     MOVE 'OPEN CURSOR:  VENDOR-CURSOR'                           14630000
146400       TO DP013-MESSAGE-TEXT (2).                                 14640000
146500                                                                  14650000
146600     EXEC SQL                                                     14660000
146700          OPEN VENDOR-CURSOR                                      14670000
146800     END-EXEC.                                                    14680000
146900                                                                  14690000
147000     EVALUATE TRUE                                                14700000
147100         WHEN SQLCODE = ZERO                                      14710000
147200         WHEN SQLCODE = +100                                      14720000
147300             CONTINUE                                             14730000
147400         WHEN SQLCODE = -904                                      14740000
147500         WHEN SQLCODE = -913                                      14750000
147600             CONTINUE                                             14760000
147700         WHEN SQLWARN0 NOT = SPACES                               14770000
147800         WHEN SQLCODE  NOT = ZERO                                 14780000
147900             MOVE '4010-OPEN-CURSOR'                              14790000
148000                               TO DP013-PARAGRAPH                 14800000
148100             MOVE 'OPEN VENDOR CURSOR - '                         14810000
148200                               TO DP013-MESSAGE-TEXT (1)          14820000
148300             MOVE SQLCA        TO DP013-SQLCA                     14830000
148400             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)        14840000
148500             SET DP013-DB2-ABEND                                  14850000
148600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               14860000
148700             PERFORM DP013-0000-PROCESS-ABEND                     14870000
148800     END-EVALUATE.                                                14880000
148900                                                                  14890000
149000 EJECT                                                            14900000
149100*----------------------------------------------------------------*14910000
149200* CLOSE THE CURSOR.                                              *14920000
149300*----------------------------------------------------------------*14930000
149400                                                                  14940000
149500 4020-CLOSE-CURSOR.                                               14950000
149600                                                                  14960000
149700     MOVE 'CLOSE CURSOR:  VENDOR-CURSOR'                          14970000
149800       TO DP013-MESSAGE-TEXT (2).                                 14980000
149900                                                                  14990000
150000     EXEC SQL                                                     15000000
150100          CLOSE VENDOR-CURSOR                                     15010000
150200     END-EXEC.                                                    15020000
150300                                                                  15030000
150400     EVALUATE TRUE                                                15040000
150500         WHEN SQLCODE = ZERO                                      15050000
150600             CONTINUE                                             15060000
150700         WHEN SQLWARN0 NOT = SPACES                               15070000
150800         WHEN SQLCODE  NOT = ZERO                                 15080000
150900             MOVE '4020-CLOSE-CURSOR'                             15090000
151000                               TO DP013-PARAGRAPH                 15100000
151100             MOVE 'CLOSE VENDOR CURSOR '                          15110000
151200                               TO DP013-MESSAGE-TEXT (1)          15120000
151300             MOVE SQLCA        TO DP013-SQLCA                     15130000
151400             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)        15140000
151500             SET DP013-DB2-ABEND                                  15150000
151600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15160000
151700             PERFORM DP013-0000-PROCESS-ABEND                     15170000
151800     END-EVALUATE.                                                15180000
151900                                                                  15190000
152000 EJECT                                                            15200000
152100*----------------------------------------------------------------*15210000
152200*    SET UP THE HOST VARIABLES.                                  *15220000
152300*----------------------------------------------------------------*15230000
152400                                                                  15240000
152500 4100-PREPARE-CURSOR.                                             15250000
152600                                                                  15260000
152700     IF  ET300-ENT-ID = ZEROES                                    15270000
152800          MOVE +0         TO PV-FROM-ENT-ID                       15280000
152900          MOVE +999999999 TO PV-TO-ENT-ID                         15290000
153000     ELSE                                                         15300000
153100          MOVE ET300-ENT-ID TO PV-FROM-ENT-ID                     15310000
153200          SUBTRACT 1 FROM PV-FROM-ENT-ID                          15320000
153300          MOVE ET300-ENT-ID TO PV-TO-ENT-ID                       15330000
153400          ADD 1 TO PV-TO-ENT-ID                                   15340000
153500     END-IF.                                                      15350000
153600                                                                  15360000
153700     MOVE ET300-VENDOR-NAME  TO  WK-VENDOR-NAME.                  15370000
153800                                                                  15380000
153900     SET PS-NO-ERROR TO TRUE.                                     15390000
154000     SET PS-DO-NOT-SET-REMAINING TO TRUE.                         15400000
154100                                                                  15410000
154200     PERFORM VARYING PV-SUB FROM +1 BY +1                         15420000
154300         UNTIL PV-SUB EQUAL LENGTH OF ET300-VENDOR-NAME           15430000
154400           OR  PS-ERROR                                           15440000
154500                                                                  15450000
154600             IF PS-SET-REMAINING                                  15460000
154700                 IF  WK-VENDOR-NAME-BYTE (PV-SUB) = SPACE         15470000
154800                      MOVE PC-PERCENT                             15480000
154900                        TO WK-VENDOR-NAME-BYTE (PV-SUB)           15490000
155000                 ELSE                                             15500000
155100*                    (ERROR ENCOUNTERED)                          15510000
155200                      SET PS-ERROR TO TRUE                        15520000
155300                 END-IF                                           15530000
155400             ELSE                                                 15540000
155500                                                                  15550000
155600                 IF  WK-VENDOR-NAME-BYTE (PV-SUB) = '*'           15560000
155700                       MOVE PC-PERCENT                            15570000
155800                         TO WK-VENDOR-NAME-BYTE (PV-SUB)          15580000
155900                       SET PS-SET-REMAINING TO TRUE               15590000
156000                 ELSE                                             15600000
156100                     CONTINUE                                     15610000
156200                 END-IF                                           15620000
156300             END-IF                                               15630000
156400                                                                  15640000
156500     END-PERFORM.                                                 15650000
156600                                                                  15660000
156700     IF  PS-ERROR                                                 15670000
156800         CONTINUE                                                 15680000
156900     ELSE                                                         15690000
157000         INSPECT  WK-VENDOR-NAME                                  15700000
157100         REPLACING  ALL '%' BY LOW-VALUES                         15710000
157200         MOVE WK-VENDOR-NAME                                      15720000
157300           TO PV-FROM-ALPHA-30                                    15730000
157400                                                                  15740000
157500         INSPECT  WK-VENDOR-NAME                                  15750000
157600         REPLACING  ALL LOW-VALUES BY HIGH-VALUES                 15760000
157700         MOVE WK-VENDOR-NAME                                      15770000
157800           TO PV-TO-ALPHA-30                                      15780000
157900     END-IF.                                                      15790000
158000                                                                  15800000
158100 EJECT                                                            15810000
158200*----------------------------------------------------------------*15820000
158300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15830000
158400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15840000
158500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15850000
158600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15860000
158700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15870000
158800*                                                                *15880000
158900* ?  DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15890000
159000* ?  ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15900000
159100* ?  UPON INITIALIZATION.                                        *15910000
159200*----------------------------------------------------------------*15920000
159300                                                                  15930000
159400 4300-READ-ITEMS-FROM-DB.                                         15940000
159500                                                                  15950000
159600     PERFORM                                                      15960000
159700         VARYING PV-READ-COUNT                                    15970000
159800         FROM 1 BY 1                                              15980000
159900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15990000
160000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16000000
160100                                                                  16010000
160200         PERFORM 4310-FETCH                                       16020000
160300                                                                  16030000
160400         IF  ASC-ITEMS-LEFT-ON-DB                                 16040000
160500                                                                  16050000
160600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16060000
160700                 ADD +1            TO  ASC-ITEM-SUB               16070000
160800             ELSE                                                 16080000
160900                 ADD +1            TO  ASC-BLK-SUB                16090000
161000                 MOVE +1           TO  ASC-ITEM-SUB               16100000
161100                                                                  16110000
161200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16120000
161300                     MOVE +1       TO  ASC-BLK-SUB                16130000
161400                     SET ASC-BLOCK-MODIFIED (1)                   16140000
161500                                   TO  TRUE                       16150000
161600                     PERFORM 5100-WRITE-TEMP-STORAGE              16160000
161700                     MOVE ASC-BLOCK-ENTRIES                       16170000
161800                               (PC-MAX-BLOCKS-IN-ARRAY)           16180000
161900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16190000
162000                     ADD +1        TO  ASC-BLK-SUB                16200000
162100                     INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)    16210000
162200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16220000
162300                                   TO  TRUE                       16230000
162400                 END-IF                                           16240000
162500             END-IF                                               16250000
162600                                                                  16260000
162700                 ADD +1            TO ASC-NUMBER-OF-ITEMS-READ    16270000
162800                 MOVE ASC-NUMBER-OF-ITEMS-READ                    16280000
162900                                   TO ASC-LIST-ITEM-NUMBER        16290000
163000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16300000
163100*                ---------------------------------------          16310000
163200*                ** MOVE ALL DB2 ITEMS TO LIST BLOCKS **          16320000
163300*                ---------------------------------------          16330000
163400                 MOVE ENTNME-ENT-ID                               16340000
163500                   TO ASC-ENT-ID      (ASC-BLK-SUB ASC-ITEM-SUB)  16350000
163600                 MOVE ENTNME-ENT-NAME-DESC                        16360000
163700                   TO ASC-VENDOR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)  16370000
163800         END-IF                                                   16380000
163900     END-PERFORM.                                                 16390000
164000                                                                  16400000
164100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16410000
164200         MOVE +1               TO ASC-BLK-SUB                     16420000
164300         PERFORM 5100-WRITE-TEMP-STORAGE                          16430000
164400         ADD +1                TO ASC-BLK-SUB                     16440000
164500         PERFORM 5100-WRITE-TEMP-STORAGE                          16450000
164600                                                                  16460000
164700         MOVE 1                TO ASC-BLK-SUB                     16470000
164800                                  PV-BLOCK-NUMBER                 16480000
164900         PERFORM 4410-READ-TEMP-STORAGE                           16490000
165000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16500000
165100             MOVE 2            TO ASC-BLK-SUB                     16510000
165200                                  PV-BLOCK-NUMBER                 16520000
165300             PERFORM 4410-READ-TEMP-STORAGE                       16530000
165400         END-IF                                                   16540000
165500     END-IF.                                                      16550000
165600                                                                  16560000
165700 EJECT                                                            16570000
165800*----------------------------------------------------------------*16580000
165900*    FETCH THE CURSOR.                                           *16590000
166000*----------------------------------------------------------------*16600000
166100                                                                  16610000
166200 4310-FETCH.                                                      16620000
166300                                                                  16630000
166400     EXEC SQL                                                     16640000
166500          FETCH                                                   16650000
166600                VENDOR-CURSOR                                     16660000
166700          INTO                                                    16670000
166800                :ENTNME-ENT-ID                                    16680000
166900              , :ENTNME-SEQ-NBR                                   16690000
167000              , :ENTNME-ENT-NAME-DESC                             16700000
167100              , :ENTNME-TYPE-CDE                                  16710000
167200     END-EXEC.                                                    16720000
167300                                                                  16730000
167400     EVALUATE TRUE                                                16740000
167500         WHEN SQLCODE = ZERO                                      16750000
167600         WHEN SQLCODE = +100                                      16760000
167700              CONTINUE                                            16770000
167800         WHEN SQLCODE = -904                                      16780000
167900         WHEN SQLCODE = -913                                      16790000
168000              PERFORM 9900-SOFT-ABORT                             16800000
168100         WHEN SQLWARN0 NOT = SPACE                                16810000
168200         WHEN SQLCODE NOT = ZERO                                  16820000
168300              MOVE '4310-FETCH-CURSOR'                            16830000
168400                               TO DP013-PARAGRAPH                 16840000
168500              MOVE 'FETCH VENDOR CURSOR'                          16850000
168600                               TO DP013-MESSAGE-TEXT (1)          16860000
168700              MOVE SQLCA       TO DP013-SQLCA                     16870000
168800              MOVE 'TENTNME '  TO DP013-DB2-TABLE-NAME (1)        16880000
168900              SET DP013-DB2-ABEND                                 16890000
169000                               TO TRUE                            16900000
169100              PERFORM DP013-0000-PROCESS-ABEND                    16910000
169200     END-EVALUATE.                                                16920000
169300                                                                  16930000
169400     IF  SQLCODE EQUAL +100                                       16940000
169500         SET ASC-NO-ITEMS-LEFT-ON-DB                              16950000
169600                               TO TRUE                            16960000
169700     END-IF.                                                      16970000
169800 EJECT                                                            16980000
169900*----------------------------------------------------------------*16990000
170000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17000000
170100*----------------------------------------------------------------*17010000
170200                                                                  17020000
170300 4400-MOVE-COMMAREA-TO-SCREEN.                                    17030000
170400                                                                  17040000
170500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             17050000
170600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          17060000
170700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          17070000
170800             MOVE +1    TO ASC-BLK-SUB                            17080000
170900             PERFORM 5100-WRITE-TEMP-STORAGE                      17090000
171000             ADD +1     TO ASC-BLK-SUB                            17100000
171100             PERFORM 5100-WRITE-TEMP-STORAGE                      17110000
171200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             17120000
171300                 GIVING PV-BLOCK-NUMBER                           17130000
171400                 REMAINDER PV-REMAINDER                           17140000
171500             IF  PV-REMAINDER > ZERO                              17150000
171600                 ADD +1 TO PV-BLOCK-NUMBER                        17160000
171700             END-IF                                               17170000
171800             MOVE +1    TO ASC-BLK-SUB                            17180000
171900             PERFORM 4410-READ-TEMP-STORAGE                       17190000
172000             ADD +1     TO ASC-BLK-SUB                            17200000
172100                           PV-BLOCK-NUMBER                        17210000
172200             PERFORM 4410-READ-TEMP-STORAGE                       17220000
172300     END-IF.                                                      17230000
172400                                                                  17240000
172500     MOVE +1            TO ASC-BLK-SUB.                           17250000
172600     COMPUTE ASC-ITEM-SUB =                                       17260000
172700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17270000
172800         + PC-ITEMS-PER-PANEL).                                   17280000
172900                                                                  17290000
173000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17300000
173100         ADD +1         TO ASC-BLK-SUB                            17310000
173200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17320000
173300     END-IF.                                                      17330000
173400                                                                  17340000
173500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17350000
173600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17360000
173700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17370000
173800     PERFORM 4420-FORMAT-LIST-LINES                               17380000
173900         VARYING PV-SUB                                           17390000
174000         FROM PC-ITEMS-PER-PANEL BY -1                            17400000
174100         UNTIL PV-SUB < +1.                                       17410000
174200                                                                  17420000
174300     COMPUTE ASC-ITEMS-DISPLAYED =                                17430000
174400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17440000
174500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   17450000
174600     IF  PS-NO-ERROR                                              17460000
174700         MOVE PV-TOP-ITEM          TO ASTRTITO                    17470000
174800     END-IF.                                                      17480000
174900                                                                  17490000
175000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17500000
175100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17510000
175200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17520000
175300                                   TO ASELITO.                    17530000
175400                                                                  17540000
175500*    ** THE FOLLOWING 1 LINE WAS ADDED **                         17550000
175600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     17560000
175700                                                                  17570000
175800     IF  DP020-MSG-NUMBER-X = SPACE                               17580000
175900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17590000
176000*            --- MORE ITEMS TO DISPLAY ----                       17600000
176100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17610000
176200             SET DP020-MSG-INFORMATIONAL TO TRUE                  17620000
176300         END-IF                                                   17630000
176400     END-IF.                                                      17640000
176500                                                                  17650000
176600*----------------------------------------------------------------*17660000
176700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17670000
176800*----------------------------------------------------------------*17680000
176900                                                                  17690000
177000 4410-READ-TEMP-STORAGE.                                          17700000
177100                                                                  17710000
177200     EXEC CICS                                                    17720000
177300         READQ TS                                                 17730000
177400             QUEUE (ASC-LIST-QUEUE-NAME)                          17740000
177500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17750000
177600             ITEM  (PV-BLOCK-NUMBER)                              17760000
177700             RESP  (PV-CICS-RESP)                                 17770000
177800     END-EXEC.                                                    17780000
177900                                                                  17790000
178000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17800000
178100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17810000
178200         CONTINUE                                                 17820000
178300     ELSE                                                         17830000
178400         SET DP013-CICS-ABEND     TO TRUE                         17840000
178500         SET DP013-NO-ROLLBACK    TO TRUE                         17850000
178600         MOVE '4410-READ-TEMP-STORAGE'                            17860000
178700                                  TO DP013-PARAGRAPH              17870000
178800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17880000
178900                                  TO DP013-MESSAGE-TEXT(1)        17890000
179000         PERFORM DP013-0000-PROCESS-ABEND                         17900000
179100     END-IF.                                                      17910000
179200                                                                  17920000
179300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17930000
179400                                                                  17940000
179500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17950000
179600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17960000
179700     END-IF.                                                      17970000
179800 EJECT                                                            17980000
179900*----------------------------------------------------------------*17990000
180000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18000000
180100*----------------------------------------------------------------*18010000
180200                                                                  18020000
180300 4420-FORMAT-LIST-LINES.                                          18030000
180400                                                                  18040000
180500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      18050000
180600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18060000
180700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      18070000
180800         MOVE SPACE              TO MR-SELECTI      (PV-SUB)      18080000
180900                                    MR-ACTION       (PV-SUB)      18090000
181000*                          ** ADD YOUR REDEF. FIELDS HERE **      18100000
181100                                    MR-VNDR         (PV-SUB)      18110000
181200     ELSE                                                         18120000
181300*        ** IF ACS-TEMP CODE, WAS ADDED HERE **                   18130000
181400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18140000
181500                                                   > SPACE        18150000
181600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18160000
181700                                 TO MR-SELECTI (PV-SUB)           18170000
181800         ELSE                                                     18180000
181900             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18190000
182000                                 TO MR-SELECTI (PV-SUB)           18200000
182100         END-IF                                                   18210000
182200                                                                  18220000
182300         IF  DP030-SET-CURSOR-TRAILER                             18230000
182400             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)18240000
182500                 > SPACE)                                         18250000
182600               OR (PV-SUB = 1))                                   18260000
182700                SET DP030-SET-CURSOR-APPL-1 TO TRUE               18270000
182800                MOVE -1          TO MR-SELECTL (PV-SUB)           18280000
182900             END-IF                                               18290000
183000         END-IF                                                   18300000
183100                                                                  18310000
183200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           18320000
183300             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB)   18330000
183400                                 TO  MR-ACTION        (PV-SUB)    18340000
183500                                                                  18350000
183600*            ** ADD YOUR REDEFINED DESECT FIELDS HERE **          18360000
183700             MOVE ASC-VENDOR-NAME    (ASC-BLK-SUB ASC-ITEM-SUB)   18370000
183800                                 TO  MR-VNDR          (PV-SUB)    18380000
183900         END-IF                                                   18390000
184000     END-IF.                                                      18400000
184100                                                                  18410000
184200     SUBTRACT +1 FROM ASC-ITEM-SUB                                18420000
184300     IF  ASC-ITEM-SUB < + 1                                       18430000
184400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18440000
184500         MOVE +1                 TO ASC-BLK-SUB                   18450000
184600     END-IF.                                                      18460000
184700                                                                  18470000
184800******************************************************************18480000
184900** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **18490000
185000** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **18500000
185100** ISSUE A WARNING.                                             **18510000
185200******************************************************************18520000
185300                                                                  18530000
185400 4430-CHECK-FOR-BEGIN-AND-END.                                    18540000
185500                                                                  18550000
185600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18560000
185700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18570000
185800*            -- NO END-OF-RANGE SPECFIED ---                      18580000
185900             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18590000
186000             SET DP020-MSG-WARNING TO TRUE                        18600000
186100             PERFORM 4431-POSITION-AT-WARNING                     18610000
186200         END-IF                                                   18620000
186300     ELSE                                                         18630000
186400         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18640000
186500*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18650000
186600             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18660000
186700             SET DP020-MSG-WARNING TO TRUE                        18670000
186800             PERFORM 4431-POSITION-AT-WARNING                     18680000
186900         END-IF                                                   18690000
187000     END-IF.                                                      18700000
187100******************************************************************18710000
187200** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18720000
187300** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18730000
187400** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **18740000
187500** POSITION THE CURSOR THERE.                                   **18750000
187600******************************************************************18760000
187700                                                                  18770000
187800 4431-POSITION-AT-WARNING.                                        18780000
187900                                                                  18790000
188000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18800000
188100                    - PV-TOP-ITEM + 1.                            18810000
188200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18820000
188300         CONTINUE                                                 18830000
188400     ELSE                                                         18840000
188500         SET DP030-SET-CURSOR-APPL-1                              18850000
188600                                   TO TRUE                        18860000
188700         MOVE -1                   TO MR-SELECTL (PV-SUB)         18870000
188800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18880000
188900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18890000
189000     END-IF.                                                      18900000
189100                                                                  18910000
189200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18920000
189300                    - PV-TOP-ITEM + 1.                            18930000
189400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18940000
189500         CONTINUE                                                 18950000
189600     ELSE                                                         18960000
189700         SET DP030-SET-CURSOR-APPL-1                              18970000
189800                                   TO TRUE                        18980000
189900         MOVE -1                   TO MR-SELECTL (PV-SUB)         18990000
190000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19000000
190100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19010000
190200     END-IF.                                                      19020000
190300                                                                  19030000
190400 EJECT                                                            19040000
190500*----------------------------------------------------------------*19050000
190600* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *19060000
190700* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *19070000
190800* FOR THE SELECTED ITEMS QUEUE.                                  *19080000
190900*                                                                *19090000
191000* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *19100000
191100* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *19110000
191200* THE ARRAY IS FULL.                                             *19120000
191300*----------------------------------------------------------------*19130000
191400                                                                  19140000
191500 5000-PREPARE-SEL-QUEUE.                                          19150000
191600                                                                  19160000
191700     MOVE +1                   TO  ASC-BLK-SUB.                   19170000
191800     PERFORM 5100-WRITE-TEMP-STORAGE.                             19180000
191900     ADD +1                    TO  ASC-BLK-SUB.                   19190000
192000     PERFORM 5100-WRITE-TEMP-STORAGE.                             19200000
192100                                                                  19210000
192200     MOVE ASC-SEL-QUEUE-NAME   TO  ET300-SEL-QUEUE-NAME.          19220000
192300     PERFORM 6010-DELETE-SEL-QUEUE.                               19230000
192400                                                                  19240000
192500     SET ASC-UPDATE-TSQ        TO  TRUE.                          19250000
192600                                                                  19260000
192700     SET ET301-IDX             TO  1.                             19270000
192800     MOVE ZERO                 TO ET300-NUMBER-OF-TS-ITEMS.       19280000
192900     INITIALIZE ET301-SELECTED-ITEM-ARRAY.                        19290000
193000                                                                  19300000
193100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           19310000
193200             VARYING PV-ITEM                                      19320000
193300             FROM 1 BY 1                                          19330000
193400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     19340000
193500                                                                  19350000
193600     IF  ET301-IDX > 1                                            19360000
193700         PERFORM 5205-WRITE-SEL-QUEUE                             19370000
193800         ADD +1                TO ET300-NUMBER-OF-TS-ITEMS        19380000
193900     END-IF.                                                      19390000
194000                                                                  19400000
194100 EJECT                                                            19410000
194200*----------------------------------------------------------------*19420000
194300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *19430000
194400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19440000
194500*----------------------------------------------------------------*19450000
194600                                                                  19460000
194700 5100-WRITE-TEMP-STORAGE.                                         19470000
194800                                                                  19480000
194900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19490000
195000                                   TO PV-LIST-ITEM-NUMBER.        19500000
195100     COMPUTE PV-BLOCK-NUMBER =                                    19510000
195200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19520000
195300                                                                  19530000
195400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19540000
195500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19550000
195600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19560000
195700             PERFORM 5105-REWRITE-ASC-LISTQ                       19570000
195800         END-IF                                                   19580000
195900     ELSE                                                         19590000
196000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19600000
196100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19610000
196200         PERFORM 5110-WRITE-ASC-LISTQ                             19620000
196300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19630000
196400     END-IF.                                                      19640000
196500                                                                  19650000
196600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19660000
196700                                                                  19670000
196800******************************************************************19680000
196900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19690000
197000** SPECIFIC COMMAREA.                                           **19700000
197100******************************************************************19710000
197200                                                                  19720000
197300 5105-REWRITE-ASC-LISTQ.                                          19730000
197400                                                                  19740000
197500     EXEC CICS                                                    19750000
197600         WRITEQ TS                                                19760000
197700             QUEUE (ASC-LIST-QUEUE-NAME)                          19770000
197800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19780000
197900             ITEM  (PV-BLOCK-NUMBER)                              19790000
198000             REWRITE                                              19800000
198100             RESP  (PV-CICS-RESP)                                 19810000
198200     END-EXEC.                                                    19820000
198300                                                                  19830000
198400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19840000
198500         CONTINUE                                                 19850000
198600     ELSE                                                         19860000
198700         SET DP013-CICS-ABEND            TO TRUE                  19870000
198800         SET DP013-NO-ROLLBACK           TO TRUE                  19880000
198900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19890000
199000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19900000
199100                                         TO DP013-MESSAGE-TEXT(1) 19910000
199200         PERFORM DP013-0000-PROCESS-ABEND                         19920000
199300     END-IF.                                                      19930000
199400                                                                  19940000
199500******************************************************************19950000
199600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19960000
199700** SPECIFIC COMMAREA.                                           **19970000
199800******************************************************************19980000
199900                                                                  19990000
200000 5110-WRITE-ASC-LISTQ.                                            20000000
200100                                                                  20010000
200200     EXEC CICS                                                    20020000
200300         WRITEQ TS                                                20030000
200400             QUEUE (ASC-LIST-QUEUE-NAME)                          20040000
200500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20050000
200600             ITEM  (PV-BLOCK-NUMBER)                              20060000
200700             RESP  (PV-CICS-RESP)                                 20070000
200800     END-EXEC.                                                    20080000
200900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20090000
201000         SET DP013-CICS-ABEND      TO TRUE                        20100000
201100         SET DP013-NO-ROLLBACK     TO TRUE                        20110000
201200         MOVE '5110-WRITE-ASC-LISTQ'                              20120000
201300                                   TO DP013-PARAGRAPH             20130000
201400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20140000
201500                                   TO DP013-MESSAGE-TEXT(1)       20150000
201600         PERFORM DP013-0000-PROCESS-ABEND                         20160000
201700     END-IF.                                                      20170000
201800                                                                  20180000
201900 EJECT                                                            20190000
202000*----------------------------------------------------------------*20200000
202100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *20210000
202200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *20220000
202300*----------------------------------------------------------------*20230000
202400                                                                  20240000
202500 5200-FILL-SEL-QUEUE-RECORD.                                      20250000
202600                                                                  20260000
202700     PERFORM 6112-READ-LIST-QUEUE.                                20270000
202800                                                                  20280000
202900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       20290000
203000         PERFORM                                                  20300000
203100         VARYING LQW-IDX                                          20310000
203200         FROM 1 BY 1                                              20320000
203300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            20330000
203400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          20340000
203500                                                                  20350000
203600             IF  LQW-SELECT (LQW-IDX)                             20360000
203700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              20370000
203800                                   TO ET301-ITEM       (ET301-IDX)20380000
203900                 MOVE LQW-ENT-ID  (LQW-IDX)                       20390000
204000                                   TO ET301-ENT-ID     (ET301-IDX)20400000
204100                 MOVE LQW-VENDOR  (LQW-IDX)                       20410000
204200                                   TO ET301-VENDOR-NAME(ET301-IDX)20420000
204300                 MOVE SPACE        TO ET301-ACTION-SW  (ET301-IDX)20430000
204400                                                                  20440000
204500                 SET ET301-IDX UP BY 1                            20450000
204600                 IF  ET301-IDX > ET301-MAX-ITEMS                  20460000
204700                     PERFORM 5205-WRITE-SEL-QUEUE                 20470000
204800                     ADD +1        TO ET300-NUMBER-OF-TS-ITEMS    20480000
204900                     INITIALIZE ET301-SELECTED-ITEM-ARRAY         20490000
205000                     SET ET301-IDX TO  1                          20500000
205100                 END-IF                                           20510000
205200             END-IF                                               20520000
205300         END-PERFORM                                              20530000
205400     END-IF.                                                      20540000
205500                                                                  20550000
205600*----------------------------------------------------------------*20560000
205700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20570000
205800*----------------------------------------------------------------*20580000
205900                                                                  20590000
206000 5205-WRITE-SEL-QUEUE.                                            20600000
206100                                                                  20610000
206200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20620000
206300                                   TO ET301-SELECTED-ITEMS.       20630000
206400                                                                  20640000
206500     EXEC CICS                                                    20650000
206600          WRITEQ TS                                               20660000
206700              QUEUE (ASC-SEL-QUEUE-NAME)                          20670000
206800              FROM  (ET301-SELECTED-VNDRS)                        20680000
206900              ITEM  (PV-SEL-QUEUE-ITEM)                           20690000
207000              RESP  (PV-CICS-RESP)                                20700000
207100     END-EXEC.                                                    20710000
207200                                                                  20720000
207300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20730000
207400         CONTINUE                                                 20740000
207500     ELSE                                                         20750000
207600         SET DP013-CICS-ABEND      TO TRUE                        20760000
207700         SET DP013-NO-ROLLBACK     TO TRUE                        20770000
207800         MOVE '5205-WRITE-SEL-QUEUE'                              20780000
207900                                   TO DP013-PARAGRAPH             20790000
208000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20800000
208100                                   TO DP013-MESSAGE-TEXT(1)       20810000
208200         PERFORM DP013-0000-PROCESS-ABEND                         20820000
208300     END-IF.                                                      20830000
208400 EJECT                                                            20840000
208500*----------------------------------------------------------------*20850000
208600*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *20860000
208700*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *20870000
208800*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *20880000
208900*  THE USER.                                                     *20890000
209000*----------------------------------------------------------------*20900000
209100                                                                  20910000
209200 6000-REFRESH-PANEL-FROM-TEMP.                                    20920000
209300                                                                  20930000
209400     IF  ASC-UPDATE-TSQ                                           20940000
209500         SET ASC-NO-TSQ-UPDATE TO TRUE                            20950000
209600         MOVE ZERO                 TO PV-SAVE-ITEM                20960000
209700                                      PV-SEL-QUEUE-ITEM           20970000
209800         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20980000
209900                                   TO PV-HOLD-SELECTED-ITEMS      20990000
210000         PERFORM 6100-UPDATE-TSQ                                  21000000
210100             UNTIL PV-ITEMS-PROCESSED >                           21010000
210200                                     PV-HOLD-SELECTED-ITEMS       21020000
210300         PERFORM 6010-DELETE-SEL-QUEUE                            21030000
210400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         21040000
210500                    ASC-BLOCK-ENTRIES (2)                         21050000
210600                                                                  21060000
210700*        ** THE REMAINING IS ADDED CODE TO THE PARAGRAPH **       21070000
210800         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 21080000
210900                GIVING PV-BLOCK-NUMBER                            21090000
211000                REMAINDER PV-REMAINDER                            21100000
211100         IF  PV-REMAINDER > ZERO                                  21110000
211200             ADD +1     TO PV-BLOCK-NUMBER                        21120000
211300         END-IF                                                   21130000
211400                                                                  21140000
211500         MOVE +1        TO ASC-BLK-SUB                            21150000
211600         PERFORM 4410-READ-TEMP-STORAGE                           21160000
211700         ADD +1         TO ASC-BLK-SUB                            21170000
211800                           PV-BLOCK-NUMBER                        21180000
211900         PERFORM 4410-READ-TEMP-STORAGE                           21190000
212000     END-IF.                                                      21200000
212100                                                                  21210000
212200*----------------------------------------------------------------*21220000
212300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21230000
212400*----------------------------------------------------------------*21240000
212500                                                                  21250000
212600 6010-DELETE-SEL-QUEUE.                                           21260000
212700                                                                  21270000
212800     EXEC CICS                                                    21280000
212900         DELETEQ TS                                               21290000
213000             QUEUE (ASC-SEL-QUEUE-NAME)                           21300000
213100             RESP  (PV-CICS-RESP)                                 21310000
213200     END-EXEC.                                                    21320000
213300                                                                  21330000
213400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      21340000
213500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         21350000
213600         CONTINUE                                                 21360000
213700     ELSE                                                         21370000
213800         SET DP013-CICS-ABEND TO TRUE                             21380000
213900         SET DP013-NO-ROLLBACK TO TRUE                            21390000
214000         MOVE '6010-DELETE-SEL-QUEUE'                             21400000
214100                        TO DP013-PARAGRAPH                        21410000
214200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         21420000
214300                        TO DP013-MESSAGE-TEXT (1)                 21430000
214400         PERFORM DP013-0000-PROCESS-ABEND                         21440000
214500     END-IF.                                                      21450000
214600                                                                  21460000
214700*----------------------------------------------------------------*21470000
214800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *21480000
214900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *21490000
215000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *21500000
215100*    THE TEMP QUEUE.                                             *21510000
215200*----------------------------------------------------------------*21520000
215300                                                                  21530000
215400 6100-UPDATE-TSQ.                                                 21540000
215500                                                                  21550000
215600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             21560000
215700     PERFORM 6105-READ-SEL-QUEUE.                                 21570000
215800     PERFORM                                                      21580000
215900         VARYING ET301-IDX                                        21590000
216000         FROM 1 BY 1                                              21600000
216100         UNTIL ((PV-ITEMS-PROCESSED >                             21610000
216200                              PV-HOLD-SELECTED-ITEMS)             21620000
216300         OR (ET301-IDX GREATER THAN ET301-MAX-ITEMS))             21630000
216400         IF  ET301-ACTION-SW (ET301-IDX) > SPACE                  21640000
216500             PERFORM 6110-PROCESS-ITEMS                           21650000
216600         END-IF                                                   21660000
216700         ADD +1                TO PV-ITEMS-PROCESSED              21670000
216800     END-PERFORM.                                                 21680000
216900                                                                  21690000
217000     PERFORM 6111-WRITE-LIST-QUEUE.                               21700000
217100                                                                  21710000
217200*----------------------------------------------------------------*21720000
217300*    READ THE LIST QUEUE RECORD.                                 *21730000
217400*----------------------------------------------------------------*21740000
217500                                                                  21750000
217600 6105-READ-SEL-QUEUE.                                             21760000
217700                                                                  21770000
217800     EXEC CICS                                                    21780000
217900          READQ TS                                                21790000
218000              QUEUE (ASC-SEL-QUEUE-NAME)                          21800000
218100              INTO  (ET301-SELECTED-VNDRS)                        21810000
218200              ITEM  (PV-SEL-QUEUE-ITEM)                           21820000
218300              RESP  (PV-CICS-RESP)                                21830000
218400     END-EXEC.                                                    21840000
218500                                                                  21850000
218600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21860000
218700         CONTINUE                                                 21870000
218800     ELSE                                                         21880000
218900         SET DP013-CICS-ABEND      TO  TRUE                       21890000
219000         SET DP013-NO-ROLLBACK     TO  TRUE                       21900000
219100         MOVE '6105-READ-SEL-QUEUE'                               21910000
219200                                   TO  DP013-PARAGRAPH            21920000
219300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21930000
219400                                   TO  DP013-MESSAGE-TEXT(1)      21940000
219500         PERFORM DP013-0000-PROCESS-ABEND                         21950000
219600     END-IF.                                                      21960000
219700                                                                  21970000
219800 EJECT                                                            21980000
219900*----------------------------------------------------------------*21990000
220000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22000000
220100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22010000
220200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22020000
220300*----------------------------------------------------------------*22030000
220400                                                                  22040000
220500 6110-PROCESS-ITEMS.                                              22050000
220600                                                                  22060000
220700     COMPUTE PV-ITEM = 1 + ((ET301-ITEM (ET301-IDX) - 1)          22070000
220800                     / PC-ITEMS-PER-PANEL).                       22080000
220900                                                                  22090000
221000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22100000
221100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22110000
221200             PERFORM 6111-WRITE-LIST-QUEUE                        22120000
221300         END-IF                                                   22130000
221400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    22140000
221500                                                                  22150000
221600         PERFORM 6112-READ-LIST-QUEUE                             22160000
221700     END-IF.                                                      22170000
221800                                                                  22180000
221900     COMPUTE PV-SUB = (ET301-ITEM (ET301-IDX)                     22190000
222000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              22200000
222100     SET LQW-DESELECT (PV-SUB) TO    TRUE                         22210000
222200     MOVE LQW-SELECTED-SW (PV-SUB)                                22220000
222300                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  22230000
222400     EVALUATE TRUE                                                22240000
222500         WHEN ET301-INQ (ET301-IDX)                               22250000
222600              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             22260000
222700                                                                  22270000
222800         WHEN ET301-ADD (ET301-IDX)                               22280000
222900              MOVE PC-ADD      TO LQW-ACTION (PV-SUB)             22290000
223000                                                                  22300000
223100         WHEN ET301-UPD (ET301-IDX)                               22310000
223200              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             22320000
223300                                                                  22330000
223400         WHEN ET301-DEL (ET301-IDX)                               22340000
223500              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             22350000
223600                                                                  22360000
223700         WHEN ET301-ERR (ET301-IDX)                               22370000
223800              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             22380000
223900     END-EVALUATE.                                                22390000
224000                                                                  22400000
224100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                22410000
224200                                                                  22420000
224300*----------------------------------------------------------------*22430000
224400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *22440000
224500*----------------------------------------------------------------*22450000
224600                                                                  22460000
224700 6111-WRITE-LIST-QUEUE.                                           22470000
224800                                                                  22480000
224900     EXEC CICS                                                    22490000
225000         WRITEQ TS                                                22500000
225100             QUEUE (ASC-LIST-QUEUE-NAME)                          22510000
225200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     22520000
225300             ITEM  (PV-SAVE-ITEM)                                 22530000
225400             REWRITE                                              22540000
225500             RESP  (PV-CICS-RESP)                                 22550000
225600     END-EXEC.                                                    22560000
225700                                                                  22570000
225800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22580000
225900         CONTINUE                                                 22590000
226000     ELSE                                                         22600000
226100         SET DP013-CICS-ABEND  TO  TRUE                           22610000
226200         SET DP013-NO-ROLLBACK TO  TRUE                           22620000
226300         MOVE '6111-WRITE-LIST-QUEUE'                             22630000
226400                               TO  DP013-PARAGRAPH                22640000
226500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  22650000
226600                               TO  DP013-MESSAGE-TEXT(1)          22660000
226700         PERFORM DP013-0000-PROCESS-ABEND                         22670000
226800     END-IF.                                                      22680000
226900                                                                  22690000
227000 EJECT                                                            22700000
227100*----------------------------------------------------------------*22710000
227200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*22720000
227300*----------------------------------------------------------------*22730000
227400                                                                  22740000
227500 6112-READ-LIST-QUEUE.                                            22750000
227600                                                                  22760000
227700     EXEC CICS                                                    22770000
227800         READQ TS                                                 22780000
227900             QUEUE (ASC-LIST-QUEUE-NAME)                          22790000
228000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     22800000
228100             ITEM  (PV-ITEM)                                      22810000
228200             RESP  (PV-CICS-RESP)                                 22820000
228300     END-EXEC.                                                    22830000
228400                                                                  22840000
228500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22850000
228600         CONTINUE                                                 22860000
228700     ELSE                                                         22870000
228800         SET DP013-CICS-ABEND        TO TRUE                      22880000
228900         SET DP013-NO-ROLLBACK       TO TRUE                      22890000
229000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22900000
229100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22910000
229200                                     TO DP013-MESSAGE-TEXT(1)     22920000
229300         PERFORM DP013-0000-PROCESS-ABEND                         22930000
229400     END-IF.                                                      22940000
229500 EJECT                                                            22950000
229600*----------------------------------------------------------------*22960000
229700*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *22970000
229800*    AND THE ERROR SWITCHES.                                     *22980000
229900*----------------------------------------------------------------*22990000
230000                                                                  23000000
230100 9900-SOFT-ABORT.                                                 23010000
230200                                                                  23020000
230300     SET PS-ERROR                TO  TRUE.                        23030000
230400     SET DP020-MSG-FATAL         TO  TRUE.                        23040000
230500     MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            23050000
230600                                                                  23060000
230700                                                                  23070000
230800*----------------------------------------------------------------*23080000
230900*    ABEND PROCESSOR MODULE                                      *23090000
231000*----------------------------------------------------------------*23100000
231100                                                                  23110000
231200     COPY DPPD013.                                                23120000
