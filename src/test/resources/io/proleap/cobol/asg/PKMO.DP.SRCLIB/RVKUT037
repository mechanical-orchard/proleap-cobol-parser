000100******************************************************************00010035
000200 IDENTIFICATION DIVISION.                                         00020035
000300******************************************************************00030035
000400                                                                  00040035
000500 PROGRAM-ID.   RVKUT037.                                          00050035
000600 AUTHOR.       JOHN HUTCHINSON.                                   00060035
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                           00070035
000800 DATE-WRITTEN. JULY 2011.                                         00080035
000900 DATE-COMPILED.                                                   00090035
001000                                                                  00100035
001100******************************************************************00110035
001200*  RTV - VALIDATE TRANSFER POSITIVE RECEIPT FILE                  00120035
001300*                                                                 00130035
001400*  IF INVALID DATA FOUND IN THE CONTROL RECORD OR THE CONTROL     00140035
001500*  RECORD IS MISSING, SET RETURN CODE 4008.                       00150035
001501*  IF INVALID DATA FOUND WRITE INPUT RECORD TO OUTPUT FILE WITH   00160035
001502*  MESSAGE AND SET RETURN CODE TO 4008.                           00170035
001600*  IF DETAIL TOTALS DO NOT MATCH CONTROL RECORD TOTALS            00180035
001700*  SET RETURN CODE TO 4050.                                       00190078
001800*-----------------------------------------------------------------00200035
001900* DATE:        10/30/2011                                         00210035
002000* PROJ#:       3219  GENCO/RTV UPGRADE PROJECT                    00220035
002100* WR/IR#:      WR40134                                            00230035
002200* PROGRAMMER:  JOHN HUTCHINSON                                    00240035
002300* DESCRIPTION: THIS PROGRAM WILL EDIT THE TRANSFER POSITIVE       00250035
002400*              RECEIPT FILE FROM GENCO AND CREATE AN OUTPUT       00260035
002500*              FILE OF RECORDS WITHOUT ANY ERRORS AND ANOTHER     00270035
002600*              FILE CONTAINING ERRORS ONLY. IT WILL REMOVE THE    00280035
002700*              INPUT FILE CONTROL RECORD.                         00290035
002800*              IF THE CONTROL TOTALS DO NOT MATCH, IT             00300035
002900*              WILL SET THE RETURN CODE TO 4095.                  00310035
003000*-----------------------------------------------------------------00320035
P40383* DATE:        04/25/2013                                         00330080
P40383* WR/IR#:      CHG0051984                                         00340079
P40383* PROGRAMMER:  COGNIZANT                                          00350045
P40383* DESCRIPTION: THE FOLLOWING ARE THE CHANGES DONE AS PART OF THIS 00360075
P40383*              PRB0040383:                                        00370075
P40383*              1. THIS PROGRAM IS CHANGED FROM NON-DB2 TO A       00380075
P40383*              DB2 PROGRAM, SINCE THE RTV LOCATIONS ARE NOW       00390075
P40383*              FETCHED FROM TKRPRPM TABLE INSTEAD CONTROL CARD.   00400075
P40383*              2. BELOW ARE THE PARAGRAPHS WHICH ARE INCLUDED     00410076
P40383*              FOR HANDLING OF THE RTV-CSR.                       00420075
P40383*               1100-GET-RTV-LOCATION                             00430075
P40383*               1110-OPEN-RTV-CURSOR                              00440075
P40383*               1120-FETCH-RTV-CURSOR                             00450075
P40383*               1130-CLOSE-RTV-CURSOR                             00460075
P40383*               2030-EDIT-DTL-REC                                 00470075
P40383*               9200-SQL-ERROR                                    00480075
P40383*              3. RETURN CODES PRODUCED OUT OF THIS PROGRAM       00490076
P40383*               4008 - CONTROL RECORD AND/OR DETAIL RECORDS       00500075
P40383*                      CONTAIN ERRORS FROM GENCO                  00510075
P40383*               4050 - GENCO RTV - OUT OF BALANCE                 00520076
P40383*-----------------------------------------------------------------00530075
003100******************************************************************00540075
003200 ENVIRONMENT DIVISION.                                            00550035
003300******************************************************************00560035
003400                                                                  00570035
003500 CONFIGURATION SECTION.                                           00580035
003600                                                                  00590035
003700 SOURCE-COMPUTER.        IBM-3090.                                00600035
003800 OBJECT-COMPUTER.        IBM-3090.                                00610035
003900                                                                  00620035
004000 INPUT-OUTPUT SECTION.                                            00630035
004100                                                                  00640035
004200 FILE-CONTROL.                                                    00650035
004300                                                                  00660035
004400     SELECT RTV-TPR-INPUT-FILE     ASSIGN TO INP01.               00670035
004500                                                                  00680035
004600     SELECT RTV-TPR-OUTPUT-FILE    ASSIGN TO OUT01.               00690035
004700                                                                  00700035
004800     SELECT RTV-TPR-ERROR-FILE     ASSIGN TO OUT02.               00710035
004900                                                                  00720035
005000******************************************************************00730035
005100 DATA DIVISION.                                                   00740035
005200******************************************************************00750035
005300                                                                  00760035
005400 FILE SECTION.                                                    00770035
005500                                                                  00780035
005600 FD  RTV-TPR-INPUT-FILE                                           00790035
005700     RECORDING MODE IS F                                          00800035
005800     LABEL RECORDS ARE STANDARD                                   00810035
005900     BLOCK CONTAINS 0 RECORDS.                                    00820035
006000                                                                  00830035
006100 01  RTV-TPR-INPUT-RECORD            PIC X(150).                  00840035
006200                                                                  00850035
006300 FD  RTV-TPR-OUTPUT-FILE                                          00860035
006400     RECORDING MODE IS F                                          00870035
006500     LABEL RECORDS ARE STANDARD                                   00880035
006600     BLOCK CONTAINS 0 RECORDS.                                    00890035
006700                                                                  00900035
006800 01  RTV-TPR-OUTPUT-RECORD           PIC X(150).                  00910035
006900                                                                  00920035
007000 FD  RTV-TPR-ERROR-FILE                                           00930035
007100     RECORDING MODE IS F                                          00940035
007200     LABEL RECORDS ARE STANDARD                                   00950035
007300     BLOCK CONTAINS 0 RECORDS.                                    00960035
007400                                                                  00970035
007500 01  RTV-TPR-ERROR-RECORD            PIC X(150).                  00980035
007600                                                                  00990035
007700******************************************************************01000035
007800 WORKING-STORAGE SECTION.                                         01010035
007900******************************************************************01020035
008000                                                                  01030035
008100******************************************************************01040035
008200* INPUT/OUTPUT LAYOUT - RV060-TPR-DETAIL-RECORD                   01050035
008300******************************************************************01060035
008400     COPY RVRD060.                                                01070035
008500                                                                  01080035
008600******************************************************************01090035
008700* OUTPUT ERROR LAYOUT - RV059-ERROR-RECORD.                       01100035
008800******************************************************************01110035
008900     COPY RVRD059.                                                01120035
009200                                                                  01130035
009300 01  PA-PROGRAM-ACCUMULATORS.                                     01140035
009400     05  PA-TOTALS.                                               01150035
009500         10 PA-TOT-RECS-READ          PIC S9(09) VALUE +0 COMP-3. 01160035
009600         10 PA-TOT-DTL-RECS-READ      PIC S9(09) VALUE +0 COMP-3. 01170035
009700         10 PA-TOT-RECS-WRITTEN       PIC S9(09) VALUE +0 COMP-3. 01180035
009800         10 PA-TOT-RECS-ERRORS        PIC S9(09) VALUE +0 COMP-3. 01190035
009900                                                                  01200035
010000 01  PS-PROGRAM-SWITCHES.                                         01210035
010100     05  PS-END-OF-DTL-INPUT-SW        PIC  X(01)    VALUE 'N'.   01220035
010200         88  PS-END-OF-DTL-INPUT-YES                 VALUE 'Y'.   01230035
010300         88  PS-END-OF-DTL-INPUT-NO                  VALUE 'N'.   01240035
010400     05  PS-CRITICAL-ERR-SW            PIC  X(01)    VALUE 'N'.   01250035
010500         88  PS-CRITICAL-ERR-YES                     VALUE 'Y'.   01260035
010600         88  PS-CRITICAL-ERR-NO                      VALUE 'N'.   01270035
010700     05  PS-TIMESTAMP-SW               PIC  X(01)    VALUE 'Y'.   01280035
010800         88  PS-TIMESTAMP-IS-VALID                   VALUE 'Y'.   01290035
010900         88  PS-TIMESTAMP-IS-INVALID                 VALUE 'N'.   01300035
P40383     05  PS-EOF-RTVCSR-SW              PIC X(01)     VALUE 'N'.   01310045
P40383         88  PS-EOF-RTV-CSR                          VALUE 'Y'.   01320045
011000                                                                  01330035
011100 01  PS-ERROR-SWITCHES.                                           01340035
011200     05  PS-ERROR-TEXT                 PIC X(35)     VALUE SPACE. 01350035
011700         88  PS-CTL-ERROR-MESS1                      VALUE        01360035
011800             'INVALID RETAIL AMOUNT SIGN    - CTL'.               01370035
011900         88  PS-CTL-ERROR-MESS2                      VALUE        01380035
012000             'INVALID RETAIL TOTAL AMOUNT   - CTL'.               01390035
012100         88  PS-CTL-ERROR-MESS3                      VALUE        01400035
012200             'INVALID RETAIL TOTAL UNITS    - CTL'.               01410035
012300         88  PS-CTL-ERROR-MESS4                      VALUE        01420035
012400             'INVALID TIMESTAMP             - CTL'.               01430035
012401         88  PS-INVALID-RECORD-TYPE                  VALUE        01440035
012402             'INVALID RECORD TYPE                '.               01450035
012403         88  PS-INVALID-TRANS-KEY                    VALUE        01460035
012404             'INVALID TRANSFER KEY               '.               01470035
012405         88  PS-INVALID-TRANS-NBR-STR                VALUE        01480035
012406             'INVALID TRANSFER STORE NUMBER      '.               01490035
012407         88  PS-INVALID-TRANS-NBR-SEQ                VALUE        01500035
012408             'INVALID TRANSFER SEQUENCE NUMBER   '.               01510035
012409         88  PS-INVALID-TRANS-TYPE-CODE              VALUE        01520035
012410             'INVALID TRANSFER TYPE CODE         '.               01530035
012411         88  PS-INVALID-TRANS-TO-STORE-NBR           VALUE        01540035
012412             'INVALID TRANSFER TO STORE NUMBER   '.               01550035
012500         88  PS-INVALID-TRANS-ACTUAL-STORE           VALUE        01560035
012600             'INVALID TRANSFER ACTUAL STORE      '.               01570035
012700         88  PS-INVALID-TRANS-TIMESTAMP              VALUE        01580035
012800             'INVALID TRANSFER RECEIVED TIMESTAMP'.               01590035
012900         88  PS-INVALID-TRANS-EXP-SIGN               VALUE        01600035
013000             'INVALID TRANSFER RETAIL SIGN       '.               01610035
013100         88  PS-INVALID-TRANS-EXP-AMT                VALUE        01620035
013200             'INVALID TRANSFER EXPECTED AMT      '.               01630035
013300         88  PS-INVALID-TRANS-EXP-UNITS              VALUE        01640035
013400             'INVALID TRANSFER EXPECTED UNITS    '.               01650035
014100         88  PS-INVALID-TRANS-USER-ID                VALUE        01660035
014200             'INVALID TRANSFER SCANNED USER ID   '.               01670035
014300                                                                  01680035
014400 01  PC-PROGRAM-CONSTANTS.                                        01690035
014500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08)  VALUE 'RVKUT037'. 01700035
014600                                                                  01710035
014700 01  PV-PROGRAM-VARIABLES.                                        01720035
032500     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.01730035
032501     05  PV-TOT-RETAIL-AMOUNT       PIC S9(11)V99 VALUE ZEROES.   01740035
032502     05  PV-TOT-UNITS               PIC 9(13)     VALUE ZEROES.   01750035
032503     05  PV-CTL-RETAIL-AMOUNT       PIC S9(11)V99 VALUE ZEROES.   01760035
032504     05  PV-CTL-UNITS               PIC 9(13)     VALUE ZEROES.   01770035
032505     05  PV-TOT-RETAIL-AMOUNT-DISPL PIC 9(11).99  VALUE ZEROES.   01780035
032506     05  PV-CTL-RETAIL-AMOUNT-DISPL PIC 9(11).99  VALUE ZEROES.   01790035
032507     05  PV-TIMESTAMP               PIC X(26)     VALUE SPACES.   01800035
032508     05  FILLER                     REDEFINES                     01810035
032509         PV-TIMESTAMP.                                            01820035
032510         10  PV-TIMESTAMP-CCYY      PIC 9(4).                     01830035
032511         10  PV-TIMESTAMP-DASH1     PIC X.                        01840035
032512         10  PV-TIMESTAMP-MONTH     PIC 9(2).                     01850035
032513         10  PV-TIMESTAMP-DASH2     PIC X.                        01860035
032514         10  PV-TIMESTAMP-DAY       PIC 9(2).                     01870035
W40134         10  PV-TIMESTAMP-DASH3     PIC X.                        01880036
W40134*        10  PV-TIMESTAMP-PERIOD1   PIC X.                        01890036
032516         10  PV-TIMESTAMP-HOUR      PIC 9(2).                     01900035
032517         10  PV-TIMESTAMP-PERIOD2   PIC X.                        01910035
032518         10  PV-TIMESTAMP-MINUTES   PIC 9(2).                     01920035
032519         10  PV-TIMESTAMP-PERIOD3   PIC X.                        01930035
032520         10  PV-TIMESTAMP-SECONDS   PIC 9(2).                     01940035
032521         10  PV-TIMESTAMP-PERIOD4   PIC X.                        01950035
032522         10  PV-TIMESTAMP-HUND-SEC  PIC 9(6).                     01960035
032523                                                                  01970035
P40383     05  PV-PARAGRAPH               PIC X(30)     VALUE SPACES.   01980048
P40383     05  PV-DB2-FUNCTION            PIC X(30)     VALUE SPACES.   01990048
P40383     05  PV-ABEND-TABLE-1           PIC X(20)     VALUE SPACES.   02000048
P40383     05  PV-ABEND-TABLE-2           PIC X(20)     VALUE SPACES.   02010048
P40383     05  PV-ABEND-TABLE-3           PIC X(20)     VALUE SPACES.   02020048
P40383     05  PV-ABEND-TABLE-4           PIC X(20)     VALUE SPACES.   02030048
P40383     05  PV-ABEND-TABLE-5           PIC X(20)     VALUE SPACES.   02040048
P40383     05  PV-ERROR-MSG-1             PIC X(60)     VALUE SPACES.   02050048
P40383     05  PV-ERROR-MSG-2             PIC X(60)     VALUE SPACES.   02060048
P40383     05  PV-ERROR-MSG-3             PIC X(60)     VALUE SPACES.   02070048
P40383     05  PV-TOT-RECS-READ           PIC 9(09)     VALUE ZERO.     02080048
P40383     05  PV-TOT-DTL-RECS-READ       PIC 9(09)     VALUE ZERO.     02090048
P40383     05  PV-TOT-RECS-WRITTEN        PIC 9(09)     VALUE ZERO.     02100048
P40383     05  PV-TOT-RECS-ERRORS         PIC 9(09)     VALUE ZERO.     02110048
P40383     05  PV-RTV-COUNTER             PIC 9(02)     VALUE ZERO.     02120048
P40383     05  PV-RTV-COUNT               PIC 9(02)     VALUE ZERO.     02130048
P40383                                                                  02140038
W40134**  CMS 10/30/2011  BEG                                           02150036
W40134***************************************************************** 02160036
W40134*    CONTROL CARD INPUT                                           02170036
W40134***************************************************************** 02180036
W40134 01  CC-CONTROL-CARD.                                             02190036
W40134     05  CC-LOC                       PIC X(04).                  02200036
W40134     05  FILLER REDEFINES CC-LOC.                                 02210036
W40134         10  CC-RTV-LOCATION          PIC 9(04).                  02220036
W40134     05  FILLER                       PIC X(76).                  02230036
W40134                                                                  02240036
W40134**  CMS 10/30/2011  END                                           02250036
032526                                                                  02260035
P40383***************************************************************** 02270045
P40383*    RTV LOCATION TEMP TABLE                                      02280045
P40383***************************************************************** 02290045
P40383 01  PV-RTV-LOCATION-TABLE.                                       02300045
P40383     05  PV-LOC-NBR                   OCCURS 20 TIMES.            02310081
P40383         10  PV-LOC                   PIC 9(04).                  02320045
P40383                                                                  02330045
P40383***  DB2 ABEND COPYBOOK                                           02340045
P40383     COPY DPWS004.                                                02350045
P40383                                                                  02360045
P40383     EXEC SQL                                                     02370045
P40383         INCLUDE SQLCA                                            02380045
P40383     END-EXEC.                                                    02390045
P40383                                                                  02400045
P40383     COPY SQLCA2.                                                 02410045
P40383                                                                  02420045
P40383*---------------------------------------------------------------* 02430045
P40383*    DCLGEN FOR THE TKRPRPM TABLE                               * 02440045
P40383*---------------------------------------------------------------* 02450045
P40383     EXEC SQL                                                     02460045
P40383         INCLUDE TKRPRPM                                          02470045
P40383     END-EXEC.                                                    02480045
P40383*                                                                 02490045
P40383*---------------------------------------------------------------* 02500045
P40383*   CURSOR USED TO RETRIVE RTV LOCATION FROM TKRPRPM TABLE      * 02510045
P40383*---------------------------------------------------------------* 02520045
P40383     EXEC SQL                                                     02530045
P40383          DECLARE    RTV-CSR CURSOR FOR                           02540045
P40383           SELECT    LOC_ID                                       02550045
P40383              FROM   TKRPRPM                                      02560045
P40383              WHERE  INTFC_SYS_CDE      = 'KHL'                   02570045
P40383              AND    SYS_PRC_FUNC_CDE   = 'VRTVLC'                02580045
P40383              AND    FUNC_PRC_STAT_CDE  = 'AC'                    02590045
P40383           ORDER BY  LOC_ID                                       02600045
P40383           WITH UR                                                02610057
P40383     END-EXEC.                                                    02620057
P40383                                                                  02630057
032527******************************************************************02640035
032528 PROCEDURE DIVISION.                                              02650035
032529******************************************************************02660035
032530                                                                  02670035
032531******************************************************************02680035
032532**   0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM. 02690035
032533******************************************************************02700035
032534                                                                  02710035
032535 0000-PROGRAM-MAINLINE.                                           02720035
032536                                                                  02730035
032537     DISPLAY '************ START OF RVKUT037 ***************'     02740035
032540                                                                  02750035
032539     PERFORM 1000-INITIALIZE.                                     02760035
032561                                                                  02770035
032562     PERFORM 2010-PROCESS-DETAIL                                  02780035
032563         UNTIL PS-END-OF-DTL-INPUT-YES.                           02790035
032564                                                                  02800035
032565     PERFORM 8000-EOJ-ROUTINE.                                    02810035
032566                                                                  02820035
032567     DISPLAY '************  END OF RVKUT037  ***************'     02830035
032568     GOBACK.                                                      02840035
032569                                                                  02850035
032570                                                                  02860035
032571******************************************************************02870035
032572**   INITIALIZE VARIABLES.                                        02880035
032573**   OPEN INPUT FILES.                                            02890035
032574**   DO A PRIME READ FOR THE DETAIL FILE                          02900035
032575******************************************************************02910035
032576                                                                  02920035
032577 1000-INITIALIZE.                                                 02930035
032578                                                                  02940035
032579     OPEN INPUT  RTV-TPR-INPUT-FILE                               02950035
032580          OUTPUT RTV-TPR-OUTPUT-FILE                              02960035
032581                 RTV-TPR-ERROR-FILE.                              02970076
032582                                                                  02980035
P40383     INITIALIZE PV-RTV-LOCATION-TABLE.                            02990059
P40383                                                                  03000059
W40134**   CMS 10/30/2011  BEG                                          03010036
W40134     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           03020036
W40134                                                                  03030036
W40134     IF CC-RTV-LOCATION IS NUMERIC AND                            03040036
W40134        CC-RTV-LOCATION IS GREATER THAN ZERO                      03050036
W40134         NEXT SENTENCE                                            03060036
W40134     ELSE                                                         03070036
W40134         DISPLAY '*************************************'          03080036
W40134         DISPLAY '**              ABEND              **'          03090036
W40134         DISPLAY '** PROGRAM   = RVKUT037            **'          03100036
W40134         DISPLAY '** INPUT CNTL CARD LOCATION IS     **'          03110036
W40134         DISPLAY '** INVALID.                        **'          03120036
W40134         DISPLAY '**                                 **'          03130036
W40134         DISPLAY '** C.C.  RTV LOCATION : ' CC-RTV-LOCATION       03140036
W40134         DISPLAY '*************************************'          03150036
W40134         MOVE +4019 TO PV-ABEND-CODE                              03160036
W40134         CALL 'ILBOABN0' USING PV-ABEND-CODE                      03170036
W40134     END-IF.                                                      03180036
W40134**   CMS 10/30/2011  END                                          03190036
032538                                                                  03200036
P40383     PERFORM 1100-GET-RTV-LOCATION.                               03210068
P40383                                                                  03220068
032583     SET PS-CRITICAL-ERR-NO TO TRUE.                              03230035
032584                                                                  03240035
032585**   ------------------------                                     03250035
032586**   PRIME READ OF INPUT FILE                                     03260035
032587**   ------------------------                                     03270035
032588                                                                  03280035
032589     PERFORM 2020-READ-RTV-DTL-FILE.                              03290035
032590                                                                  03300035
P40383     PERFORM 2000-EDIT-CONTROL-RECORD THRU 2000-EXIT.             03310056
032596                                                                  03320035
P40383******************************************************************03330068
P40383**   RETRIVE RTV LOCATION FROM TKRPRPM TABLE                      03340068
P40383******************************************************************03350068
P40383                                                                  03360068
P40383 1100-GET-RTV-LOCATION.                                           03370068
P40383                                                                  03380068
P40383     PERFORM 1110-OPEN-RTV-CURSOR.                                03390068
P40383                                                                  03400068
P40383     MOVE 1 TO PV-RTV-COUNTER.                                    03410068
P40383                                                                  03420068
P40383     PERFORM 1120-FETCH-RTV-CURSOR                                03430068
P40383             UNTIL  PS-EOF-RTV-CSR.                               03440068
P40383                                                                  03450068
P40383     PERFORM 1130-CLOSE-RTV-CURSOR.                               03460068
P40383                                                                  03470068
P40383******************************************************************03480068
P40383**   OPEN THE RTV-CSR CURSOR                                      03490068
P40383******************************************************************03500068
P40383                                                                  03510068
P40383 1110-OPEN-RTV-CURSOR.                                            03520068
P40383                                                                  03530068
P40383         EXEC SQL                                                 03540068
P40383             OPEN RTV-CSR                                         03550068
P40383         END-EXEC                                                 03560068
P40383                                                                  03570068
P40383     EVALUATE TRUE                                                03580068
P40383                                                                  03590068
P40383         WHEN SQLCODE = ZEROS                                     03600068
P40383             CONTINUE                                             03610068
P40383         WHEN OTHER                                               03620068
P40383             MOVE '1110-OPEN-RTV-CURSOR'  TO PV-PARAGRAPH         03630068
P40383             DISPLAY '** ABEND **'                                03640068
P40383             DISPLAY '** PROGRAM = RVKUT037 **'                   03650068
P40383             MOVE 'SELECT TKRPRPM'        TO PV-ERROR-MSG-1       03660068
P40383             MOVE 'TKRPRPM'               TO PV-ABEND-TABLE-1     03670068
P40383             PERFORM 9200-SQL-ERROR                               03680068
P40383     END-EVALUATE.                                                03690068
P40383                                                                  03700068
P40383******************************************************************03710068
P40383*    FETCH THE RTV-CSR CURSOR                                     03720068
P40383******************************************************************03730068
P40383 1120-FETCH-RTV-CURSOR.                                           03740068
P40383                                                                  03750068
P40383     EXEC SQL                                                     03760068
P40383          FETCH RTV-CSR                                           03770068
P40383           INTO :KRPRPM-LOC-ID                                    03780068
P40383     END-EXEC.                                                    03790068
P40383                                                                  03800068
P40383     EVALUATE TRUE                                                03810071
P40383                                                                  03820071
P40383         WHEN SQLCODE = ZEROS                                     03830071
P40383             MOVE KRPRPM-LOC-ID           TO                      03840071
P40383                  PV-LOC (PV-RTV-COUNTER)                         03850071
P40383             ADD 1 TO PV-RTV-COUNTER                              03860071
P40383                                                                  03870071
P40383         WHEN SQLCODE = +100                                      03880071
P40383             SET  PS-EOF-RTV-CSR          TO TRUE                 03890071
P40383                                                                  03900071
P40383         WHEN OTHER                                               03910071
P40383             MOVE '1120-FETCH-RTV-CURSOR' TO PV-PARAGRAPH         03920071
P40383             DISPLAY '** ABEND **'                                03930071
P40383             DISPLAY '** PROGRAM = RVKUT037 **'                   03940071
P40383             MOVE 'FETCH  TKRPRPM'        TO PV-ERROR-MSG-1       03950071
P40383             MOVE 'TKRPRPM'               TO PV-ABEND-TABLE-1     03960071
P40383             PERFORM 9200-SQL-ERROR                               03970071
P40383     END-EVALUATE.                                                03980071
P40383                                                                  03990071
P40383******************************************************************04000071
P40383*    CLOSE THE RTV-CSR CURSOR                                     04010071
P40383******************************************************************04020071
P40383 1130-CLOSE-RTV-CURSOR.                                           04030071
P40383                                                                  04040071
P40383         EXEC SQL                                                 04050071
P40383             CLOSE RTV-CSR                                        04060071
P40383         END-EXEC                                                 04070071
P40383                                                                  04080071
P40383     EVALUATE TRUE                                                04090071
P40383                                                                  04100071
P40383         WHEN SQLCODE = ZEROS                                     04110071
P40383             CONTINUE                                             04120071
P40383         WHEN OTHER                                               04130071
P40383             MOVE '1130-CLOSE-RTV-CURSOR' TO PV-PARAGRAPH         04140071
P40383             DISPLAY '** ABEND **'                                04150071
P40383             DISPLAY '** PROGRAM = RVKUT037 **'                   04160071
P40383             MOVE 'CLOSE  TKRPRPM'        TO PV-ERROR-MSG-1       04170071
P40383             MOVE 'TKRPRPM'               TO PV-ABEND-TABLE-1     04180071
P40383             PERFORM 9200-SQL-ERROR                               04190071
P40383     END-EVALUATE.                                                04200071
P40383                                                                  04210071
032597                                                                  04220035
032598******************************************************************04230035
032599**   VALIDATES THE INFORMATION ON THE CONTROL RECORD, WHICH       04240035
032600**   MUST BE THE FIRST RECORD READ AND HAVE A VALID RTV LOCATION. 04250035
032601******************************************************************04260035
032602                                                                  04270035
032603 2000-EDIT-CONTROL-RECORD.                                        04280035
032604                                                                  04290035
032605     MOVE RTV-TPR-INPUT-RECORD TO RV060-CTL-RECORD.               04300035
032606     MOVE RV060-CTL-CREATE-TIMESTAMP TO PV-TIMESTAMP.             04310035
032607                                                                  04320035
032608     PERFORM 2040-VALIDATE-TIMESTAMP.                             04330035
032609                                                                  04340035
032610     EVALUATE TRUE                                                04350035
032700         WHEN RV060-CTL-RECORD-TYPE NOT EQUAL '9'                 04360035
059200             DISPLAY '****************************************'   04370035
059210             DISPLAY '**                ABEND               **'   04380035
059300             DISPLAY '**          PROGRAM : RVKUT037        **'   04390035
059500             DISPLAY '**   PARA: 2000-EDIT-CONTROL-RECORD   **'   04400035
059600             DISPLAY '**        MISSING CONTROL RECORD      **'   04410035
059610             DISPLAY '**   CONTROL RECORD TYPE : '                04420035
059620                     RV060-CTL-RECORD-TYPE                        04430035
059700             DISPLAY '****************************************'   04440035
059900             MOVE +4019 TO PV-ABEND-CODE                          04450035
060000             CALL 'ILBOABN0' USING PV-ABEND-CODE                  04460035
060001                                                                  04470035
060002         WHEN RV060-CTL-RECEIVED-STR-NBR NOT EQUAL CC-RTV-LOCATION04480035
060005             DISPLAY '****************************************'   04490035
060006             DISPLAY '**                ABEND               **'   04500035
060007             DISPLAY '**          PROGRAM : RVKUT037        **'   04510035
060008             DISPLAY '**   PARA : 2000-EDIT-CONTROL-RECORD  **'   04520035
060009             DISPLAY '**    INVALID LOCATION/STORE NUMBER   **'   04530035
060010             DISPLAY '**   INPUT LOCATION NBR         : '         04540035
060011                      RV060-CTL-RECEIVED-STR-NBR                  04550035
060010             DISPLAY '**   INPUT CTLCARD LOCATION NBR : '         04560035
060011                      CC-RTV-LOCATION                             04570035
060012             DISPLAY '****************************************'   04580035
060013             MOVE +4019 TO PV-ABEND-CODE                          04590035
060014             CALL 'ILBOABN0' USING PV-ABEND-CODE                  04600035
060015                                                                  04610035
060016         WHEN (RV060-CTL-SUM-TOTAL-SIGN NOT EQUAL SPACES AND      04620035
060017               RV060-CTL-SUM-TOTAL-SIGN NOT EQUAL '-')            04630035
060018             SET PS-CTL-ERROR-MESS1 TO TRUE                       04640035
060019             SET PS-CRITICAL-ERR-YES TO TRUE                      04650035
060020                                                                  04660035
060021         WHEN RV060-CTL-SUM-TOTAL-RTL-AMT NOT NUMERIC             04670035
060022             SET PS-CTL-ERROR-MESS2 TO TRUE                       04680035
060023             SET PS-CRITICAL-ERR-YES TO TRUE                      04690035
060024                                                                  04700035
060025         WHEN  RV060-CTL-SUM-TOTAL-UNITS NOT NUMERIC              04710035
060026             SET PS-CTL-ERROR-MESS3 TO TRUE                       04720035
060027             SET PS-CRITICAL-ERR-YES TO TRUE                      04730035
060028                                                                  04740035
060029         WHEN PS-TIMESTAMP-IS-INVALID                             04750035
060030             SET PS-CTL-ERROR-MESS4 TO TRUE                       04760035
060031             SET PS-CRITICAL-ERR-YES TO TRUE                      04770035
060032                                                                  04780035
060033     END-EVALUATE.                                                04790035
060034                                                                  04800035
060035     IF PS-CRITICAL-ERR-YES                                       04810035
060036         PERFORM 3010-WRITE-ERROR-RECORD                          04820035
060037         GO TO 2000-EXIT                                          04830035
060038     END-IF.                                                      04840035
060039                                                                  04850035
060040     MOVE RV060-CTL-SUM-TOTAL-RTL-AMT TO PV-CTL-RETAIL-AMOUNT.    04860035
060041     MOVE RV060-CTL-SUM-TOTAL-UNITS   TO PV-CTL-UNITS.            04870035
060042                                                                  04880035
060043     IF RV060-CTL-SUM-TOTAL-SIGN EQUAL '-'                        04890035
060044         MULTIPLY PV-CTL-RETAIL-AMOUNT BY -1                      04900035
060045           GIVING PV-CTL-RETAIL-AMOUNT                            04910035
060046     END-IF.                                                      04920035
060047                                                                  04930035
060048 2000-EXIT.                                                       04940035
060049     EXIT.                                                        04950035
060050                                                                  04960035
060051******************************************************************04970035
060052**   PROCESS DETAIL RECORDS UNTIL END OF FILE                    *04980035
060053******************************************************************04990035
060054                                                                  05000035
060055 2010-PROCESS-DETAIL.                                             05010035
060056                                                                  05020035
060057     PERFORM 2020-READ-RTV-DTL-FILE.                              05030035
060058                                                                  05040035
060059     IF PS-END-OF-DTL-INPUT-NO                                    05050035
060060         PERFORM 2030-EDIT-DTL-REC THRU 2030-EXIT                 05060035
060061     END-IF.                                                      05070035
060062                                                                  05080035
060063******************************************************************05090035
060064**   READ THE RTV DETAIL FILE                                    *05100035
060065******************************************************************05110035
060066                                                                  05120035
060067 2020-READ-RTV-DTL-FILE.                                          05130035
060068                                                                  05140035
060069     READ RTV-TPR-INPUT-FILE INTO RV060-TPR-DETAIL-RECORD         05150035
060070         AT END                                                   05160035
060071             SET PS-END-OF-DTL-INPUT-YES TO TRUE                  05170035
060072     END-READ.                                                    05180035
060073                                                                  05190035
060074     IF PS-END-OF-DTL-INPUT-NO                                    05200035
060075        IF RV060-TPR-RECORD-TYPE EQUAL '9'                        05210035
060076            ADD +1  TO PA-TOT-RECS-READ                           05220035
060077        ELSE                                                      05230035
060078            ADD +1  TO PA-TOT-RECS-READ                           05240035
060079                       PA-TOT-DTL-RECS-READ                       05250035
060080        END-IF                                                    05260035
060081     END-IF.                                                      05270035
060082                                                                  05280035
060083******************************************************************05290045
060084**   EDIT THE DETAIL REC                                          05300045
060085******************************************************************05310045
060086                                                                  05320045
060087 2030-EDIT-DTL-REC.                                               05330045
060088                                                                  05340045
060089     SET PS-CRITICAL-ERR-NO TO TRUE.                              05350035
060090                                                                  05360035
060091     MOVE RV060-TPR-TIMESTAMP TO PV-TIMESTAMP.                    05370035
060092                                                                  05380035
060093     PERFORM 2040-VALIDATE-TIMESTAMP.                             05390035
060094                                                                  05400035
060095     EVALUATE TRUE                                                05410035
060096         WHEN RV060-TPR-RECORD-TYPE EQUAL '9'                     05420035
059200             DISPLAY '****************************************'   05430035
059210             DISPLAY '**                ABEND               **'   05440035
059300             DISPLAY '**          PROGRAM : RVKUT037        **'   05450035
059500             DISPLAY '**   PARA: 2030-EDIT-DTL-REC          **'   05460035
059600             DISPLAY '**   MULTIPLE CONTROL RECORDS FOUND   **'   05470035
059600             DISPLAY '**                                    **'   05480035
059620             DISPLAY '** INPUT RECORD TYPE ' RV060-TPR-RECORD-TYPE05490035
059700             DISPLAY '****************************************'   05500035
059900             MOVE +4019 TO PV-ABEND-CODE                          05510035
060000             CALL 'ILBOABN0' USING PV-ABEND-CODE                  05520035
060099                                                                  05530035
060096         WHEN RV060-TPR-RECORD-TYPE NOT EQUAL '2'                 05540035
060097             SET PS-INVALID-RECORD-TYPE TO TRUE                   05550035
060098             SET PS-CRITICAL-ERR-YES TO TRUE                      05560035
060099                                                                  05570035
060100         WHEN RV060-TPR-TRANSFER-KEY-ID NOT NUMERIC               05580035
060101             SET PS-INVALID-TRANS-KEY TO TRUE                     05590035
060102             SET PS-CRITICAL-ERR-YES TO TRUE                      05600035
060103                                                                  05610035
060100         WHEN RV060-TPR-TRANSFER-KEY-ID NOT GREATER THAN ZEROS    05620035
060101             SET PS-INVALID-TRANS-KEY TO TRUE                     05630035
060102             SET PS-CRITICAL-ERR-YES TO TRUE                      05640035
060103                                                                  05650035
060104         WHEN RV060-TPR-TRANSFER-NBR-STR NOT NUMERIC              05660035
060105             SET PS-INVALID-TRANS-NBR-STR TO TRUE                 05670035
060106             SET PS-CRITICAL-ERR-YES TO TRUE                      05680035
060107                                                                  05690035
060104         WHEN RV060-TPR-TRANSFER-NBR-STR NOT GREATER THAN ZEROS   05700035
060105             SET PS-INVALID-TRANS-NBR-STR TO TRUE                 05710035
060106             SET PS-CRITICAL-ERR-YES TO TRUE                      05720035
060107                                                                  05730035
060108         WHEN RV060-TPR-TRANSFER-NBR-SEQ NOT NUMERIC              05740035
060109             SET PS-INVALID-TRANS-NBR-SEQ TO TRUE                 05750035
060110             SET PS-CRITICAL-ERR-YES TO TRUE                      05760035
060107                                                                  05770035
060108         WHEN RV060-TPR-TRANSFER-NBR-SEQ NOT GREATER THAN ZEROS   05780035
060109             SET PS-INVALID-TRANS-NBR-SEQ TO TRUE                 05790035
060110             SET PS-CRITICAL-ERR-YES TO TRUE                      05800035
060111                                                                  05810035
060112         WHEN (RV060-TPR-TRANSFER-TYPE-CODE NOT EQUAL '00' AND    05820035
060113               RV060-TPR-TRANSFER-TYPE-CODE NOT EQUAL '01' AND    05830035
060114               RV060-TPR-TRANSFER-TYPE-CODE NOT EQUAL '02')       05840035
060115             SET PS-INVALID-TRANS-TYPE-CODE TO TRUE               05850035
060116             SET PS-CRITICAL-ERR-YES TO TRUE                      05860035
060117                                                                  05870035
060130         WHEN PS-TIMESTAMP-IS-INVALID                             05880035
060131             SET PS-INVALID-TRANS-TIMESTAMP TO TRUE               05890035
060132             SET PS-CRITICAL-ERR-YES TO TRUE                      05900035
060133                                                                  05910035
060134         WHEN (RV060-TPR-EXP-SIGN NOT EQUAL SPACE AND             05920035
060135               RV060-TPR-EXP-SIGN NOT EQUAL '-')                  05930035
060136             SET PS-INVALID-TRANS-EXP-SIGN TO TRUE                05940035
060137             SET PS-CRITICAL-ERR-YES TO TRUE                      05950035
060138                                                                  05960035
060139         WHEN RV060-TPR-EXP-AMT NOT NUMERIC                       05970035
060140             SET PS-INVALID-TRANS-EXP-AMT TO TRUE                 05980035
060141             SET PS-CRITICAL-ERR-YES TO TRUE                      05990035
060142                                                                  06000035
060143         WHEN RV060-TPR-EXP-UNITS NOT NUMERIC                     06010035
060144             SET PS-INVALID-TRANS-EXP-UNITS TO TRUE               06020035
060145             SET PS-CRITICAL-ERR-YES TO TRUE                      06030035
060146                                                                  06040035
060147         WHEN RV060-TPR-SCANNED-USER-ID EQUAL SPACES              06050035
060148             SET PS-INVALID-TRANS-USER-ID TO TRUE                 06060035
060149             SET PS-CRITICAL-ERR-YES TO TRUE                      06070035
060150                                                                  06080035
060151     END-EVALUATE.                                                06090035
060152                                                                  06100035
P40383     SET PS-CRITICAL-ERR-YES              TO TRUE.                06110060
P40383                                                                  06120058
P40383     PERFORM VARYING PV-RTV-COUNT FROM 1 BY 1                     06130066
P40383             UNTIL   PV-RTV-COUNT = PV-RTV-COUNTER                06140066
P40383                     OR PS-CRITICAL-ERR-NO                        06150066
P40383        IF (RV060-TPR-TO-STORE-NBR EQUAL                          06160066
P40383               PV-LOC(PV-RTV-COUNT))                              06170066
P40383           SET PS-CRITICAL-ERR-NO         TO TRUE                 06180066
P40383        END-IF                                                    06190066
P40383     END-PERFORM.                                                 06200045
P40383*                                                                 06210069
P40383     IF PS-CRITICAL-ERR-YES                                       06220058
P40383        SET PS-INVALID-TRANS-TO-STORE-NBR TO TRUE                 06230058
P40383     END-IF.                                                      06240058
P40383*                                                                 06250058
P40383     SET PS-CRITICAL-ERR-YES              TO TRUE.                06260060
P40383                                                                  06270058
P40383     PERFORM VARYING PV-RTV-COUNT FROM 1 BY 1                     06280058
P40383             UNTIL   PV-RTV-COUNT = PV-RTV-COUNTER                06290047
P40383                     OR PS-CRITICAL-ERR-NO                        06300058
P40383        IF (RV060-TPR-ACTUAL-STORE-NBR EQUAL                      06310058
P40383               PV-LOC (PV-RTV-COUNT))                             06320052
P40383           SET PS-CRITICAL-ERR-NO         TO TRUE                 06330058
P40383        END-IF                                                    06340052
P40383     END-PERFORM.                                                 06350052
P40383*                                                                 06360069
P40383     IF PS-CRITICAL-ERR-YES                                       06370058
P40383        SET PS-INVALID-TRANS-ACTUAL-STORE TO TRUE                 06380058
P40383     END-IF.                                                      06390058
P40383*                                                                 06400058
060153     IF PS-CRITICAL-ERR-YES                                       06410035
060154         PERFORM 3010-WRITE-ERROR-RECORD                          06420035
060155         GO TO 2030-EXIT                                          06430035
060156     END-IF.                                                      06440035
060157                                                                  06450035
060158     IF RV060-TPR-EXP-SIGN EQUAL '-'                              06460035
060159         SUBTRACT RV060-TPR-EXP-AMT FROM PV-TOT-RETAIL-AMOUNT     06470035
060160     ELSE                                                         06480035
060161         ADD RV060-TPR-EXP-AMT TO PV-TOT-RETAIL-AMOUNT            06490035
060162     END-IF.                                                      06500035
060163                                                                  06510035
060164     ADD RV060-TPR-EXP-UNITS TO PV-TOT-UNITS.                     06520035
060165                                                                  06530035
060166     PERFORM 3020-WRITE-OUTPUT-RECORD.                            06540035
060167                                                                  06550035
060168 2030-EXIT.                                                       06560035
060169     EXIT.                                                        06570035
060170                                                                  06580035
060171******************************************************************06590035
060172**    VALIDATE TIMESTAMP FIELDS ARE FORMATTED CORRECTLY          *06600035
060173******************************************************************06610035
060174                                                                  06620035
060175 2040-VALIDATE-TIMESTAMP.                                         06630035
060176                                                                  06640035
060177     SET PS-TIMESTAMP-IS-VALID TO TRUE.                           06650035
060178                                                                  06660035
060179     EVALUATE TRUE                                                06670035
060180                                                                  06680035
060181         WHEN (PV-TIMESTAMP-CCYY     NOT NUMERIC OR               06690035
060182               PV-TIMESTAMP-MONTH    NOT NUMERIC OR               06700035
060183               PV-TIMESTAMP-DAY      NOT NUMERIC OR               06710035
060184               PV-TIMESTAMP-HOUR     NOT NUMERIC OR               06720035
060185               PV-TIMESTAMP-MINUTES  NOT NUMERIC OR               06730035
060186               PV-TIMESTAMP-SECONDS  NOT NUMERIC OR               06740035
060187               PV-TIMESTAMP-HUND-SEC NOT NUMERIC)                 06750035
060188             SET PS-TIMESTAMP-IS-INVALID TO TRUE                  06760035
060189                                                                  06770035
060190         WHEN (PV-TIMESTAMP-DASH1   NOT EQUAL '-'  AND            06780035
060191               PV-TIMESTAMP-DASH2   NOT EQUAL '-'  AND            06790035
W40134               PV-TIMESTAMP-DASH3   NOT EQUAL '-'  AND            06800036
W40134***            PV-TIMESTAMP-PERIOD1 NOT EQUAL '.'  AND            06810036
060193               PV-TIMESTAMP-PERIOD2 NOT EQUAL '.'  AND            06820035
060194               PV-TIMESTAMP-PERIOD3 NOT EQUAL '.'  AND            06830035
060195               PV-TIMESTAMP-PERIOD4 NOT EQUAL '.')                06840035
060196             SET PS-TIMESTAMP-IS-INVALID TO TRUE                  06850035
060197                                                                  06860035
060198         WHEN (PV-TIMESTAMP-CCYY LESS THAN 2000  OR               06870035
060199               PV-TIMESTAMP-CCYY GREATER THAN 2099)               06880035
060200             SET PS-TIMESTAMP-IS-INVALID TO TRUE                  06890035
060201                                                                  06900035
060202         WHEN (PV-TIMESTAMP-MONTH LESS THAN 00   OR               06910035
060203               PV-TIMESTAMP-MONTH GREATER THAN 12)                06920035
060204             SET PS-TIMESTAMP-IS-INVALID TO TRUE                  06930035
060205                                                                  06940035
060206         WHEN (PV-TIMESTAMP-DAY LESS THAN 00     OR               06950035
060207               PV-TIMESTAMP-DAY GREATER THAN 31)                  06960035
060208             SET PS-TIMESTAMP-IS-INVALID TO TRUE                  06970035
060209                                                                  06980035
060210         WHEN (PV-TIMESTAMP-HOUR LESS THAN 00    OR               06990035
060211               PV-TIMESTAMP-HOUR GREATER THAN 24)                 07000035
060212             SET PS-TIMESTAMP-IS-INVALID TO TRUE                  07010035
060213                                                                  07020035
060214         WHEN (PV-TIMESTAMP-MINUTES LESS THAN 00    OR            07030035
060215               PV-TIMESTAMP-MINUTES GREATER THAN 60)              07040035
060216             SET PS-TIMESTAMP-IS-INVALID TO TRUE                  07050035
060217                                                                  07060035
060218         WHEN (PV-TIMESTAMP-SECONDS LESS THAN 00 OR               07070035
060219               PV-TIMESTAMP-SECONDS GREATER THAN 60)              07080035
060220             SET PS-TIMESTAMP-IS-INVALID TO TRUE                  07090035
060221                                                                  07100035
060222     END-EVALUATE.                                                07110035
060223                                                                  07120035
060224                                                                  07130035
060225******************************************************************07140035
060226**   WRITE THE ERROR DETAIL FILE                                  07150035
060227******************************************************************07160035
060228                                                                  07170035
060229 3010-WRITE-ERROR-RECORD.                                         07180035
060230                                                                  07190035
060231     INITIALIZE RV059-ERROR-RECORD.                               07200035
060232                                                                  07210035
060233     MOVE RV060-TPR-DETAIL-RECORD TO RV059-DTL-RECORD.            07220035
060234     MOVE PS-ERROR-TEXT           TO RV059-MESSAGE.               07230035
060235                                                                  07240035
060236     WRITE RTV-TPR-ERROR-RECORD                                   07250035
060237         FROM RV059-ERROR-RECORD.                                 07260035
060238                                                                  07270035
060239     ADD 1 TO PA-TOT-RECS-ERRORS.                                 07280035
060240                                                                  07290035
060241     INITIALIZE RV059-ERROR-RECORD.                               07300035
060242                                                                  07310035
060243                                                                  07320035
060244******************************************************************07330035
060245**   WRITE THE OUTPUT RTV DETAIL FILE                             07340035
060246******************************************************************07350035
060247                                                                  07360035
060248 3020-WRITE-OUTPUT-RECORD.                                        07370035
060249                                                                  07380035
060250     WRITE RTV-TPR-OUTPUT-RECORD                                  07390035
060251         FROM RV060-TPR-DETAIL-RECORD.                            07400035
060252                                                                  07410035
060253     ADD 1 TO PA-TOT-RECS-WRITTEN.                                07420035
060254                                                                  07430035
060255******************************************************************07440035
060256**   8000-EOJ - DISPLAYS ALL OF THE COUNTS AT THE END OF THE PGM  07450035
060257**              AND CHECKS FOR ANY ERRORS.                        07460035
060258******************************************************************07470035
060259                                                                  07480035
060260 8000-EOJ-ROUTINE.                                                07490035
060261                                                                  07500035
060262      CLOSE RTV-TPR-INPUT-FILE                                    07510035
060263            RTV-TPR-OUTPUT-FILE                                   07520035
060264            RTV-TPR-ERROR-FILE.                                   07530038
060265                                                                  07540035
060266     MOVE PV-TOT-RETAIL-AMOUNT TO PV-TOT-RETAIL-AMOUNT-DISPL.     07550035
060267     MOVE PV-CTL-RETAIL-AMOUNT TO PV-CTL-RETAIL-AMOUNT-DISPL.     07560035
060268                                                                  07570035
060269     DISPLAY '*******************************************'.       07580035
060270     DISPLAY '**    * RVKUT037 SUMMARY STATISTICS *    **'.       07590035
060271     DISPLAY '**                                       **'.       07600035
060272     DISPLAY '**    --------------------------------   **'.       07610035
060273     DISPLAY '**    GENCO RTV - OUTPUT RECORD COUNTS   **'.       07620035
060274     DISPLAY '**    --------------------------------   **'.       07630035
060275     DISPLAY '**                                       **'.       07640035
060276     DISPLAY '** TOTAL RECORDS READ    : ' PA-TOT-RECS-READ.      07650035
060277     DISPLAY '** DETAIL RECORDS READ   : ' PA-TOT-DTL-RECS-READ.  07660035
060278     DISPLAY '**                                       **'        07670035
060279     DISPLAY '** TOTAL RETAIL AMOUNT   : '                        07680035
060280                 PV-TOT-RETAIL-AMOUNT-DISPL.                      07690035
060281     DISPLAY '** TOTAL NBR OF UNITS    : ' PV-TOT-UNITS           07700035
060282     DISPLAY '**                                       **'        07710035
060283     DISPLAY '** CONTROL RECORD AMOUNT : '                        07720035
060284                 PV-CTL-RETAIL-AMOUNT-DISPL.                      07730035
060285     DISPLAY '** CONTROL NBR OF UNITS  : ' PV-CTL-UNITS           07740035
060286     DISPLAY '**                                       **'.       07750035
060287     DISPLAY '** DETAIL RECORDS WRITTEN: ' PA-TOT-RECS-WRITTEN.   07760035
060288     DISPLAY '** ERROR RECORDS WRITTEN : ' PA-TOT-RECS-ERRORS.    07770035
060289     DISPLAY '**                                       **'.       07780035
060290     DISPLAY '*******************************************'.       07790035
060291                                                                  07800035
060292     EVALUATE TRUE                                                07810035
060293                                                                  07820035
060294         WHEN PA-TOT-RECS-ERRORS GREATER THAN ZEROS               07830035
060295             MOVE 4008 TO RETURN-CODE                             07840035
060298             DISPLAY '**                                       **'07850035
060299             DISPLAY '** ---------------------------------     **'07860035
060300             DISPLAY '** GENCO RTV - RECORDS CONTAIN ERROR     **'07870035
060301             DISPLAY '** ---------------------------------     **'07880035
060302             DISPLAY '**                                       **'07890035
060303             DISPLAY '** CONTROL RECORD AND/OR DETAIL RECORDS  **'07900035
060304             DISPLAY '** CONTAIN ERRORS FROM GENCO             **'07910035
060305             DISPLAY '**                                       **'07920035
060306             DISPLAY '*******************************************'07930035
060307                                                                  07940035
060308         WHEN (PV-TOT-RETAIL-AMOUNT NOT EQUAL PV-CTL-RETAIL-AMOUNT07950035
060309              OR PV-TOT-UNITS NOT EQUAL PV-CTL-UNITS)             07960035
P40383             MOVE 4050 TO RETURN-CODE                             07970067
060313             DISPLAY '**                                       **'07980035
060314             DISPLAY '**  --------------------------------     **'07990035
060315             DISPLAY '**     GENCO RTV - OUT OF BALANCE        **'08000035
060316             DISPLAY '**  --------------------------------     **'08010035
060317             DISPLAY '**                                       **'08020035
060318             DISPLAY '** CONTROL TOTALS NOT EQUAL DETAIL TOTALS  '08030035
060319             DISPLAY '**                                       **'08040035
060320             DISPLAY '*******************************************'08050035
060321                                                                  08060035
060322     END-EVALUATE.                                                08070035
060323                                                                  08080035
P40383***************************************************************** 08090048
P40383*  PARAGRAPH EXECUTED WHEN SERIOUS DB2 ERROR OCCURRED             08100048
P40383***************************************************************** 08110048
P40383 9200-SQL-ERROR.                                                  08120048
P40383                                                                  08130048
P40383     MOVE SQLCODE                     TO SQLCODE2.                08140048
P40383     MOVE SQLERRD(3)                  TO SQLERRD3.                08150048
P40383                                                                  08160048
P40383     DISPLAY '** ABEND **         ** = SQLERROR'.                 08170048
P40383     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08180048
P40383     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   08190048
P40383     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                08200048
P40383     DISPLAY '**           ** = ' PV-ABEND-TABLE-1.               08210048
P40383     DISPLAY '**           ** = ' PV-ABEND-TABLE-2.               08220048
P40383     DISPLAY '**           ** = ' PV-ABEND-TABLE-3.               08230048
P40383     DISPLAY '**           ** = ' PV-ABEND-TABLE-4.               08240048
P40383     DISPLAY '**           ** = ' PV-ABEND-TABLE-5.               08250048
P40383     DISPLAY '**           ** = ' PV-ERROR-MSG-1                  08260048
P40383     DISPLAY '**           ** = ' PV-ERROR-MSG-2                  08270048
P40383     DISPLAY '**           ** = ' PV-ERROR-MSG-3                  08280048
P40383                                                                  08290048
P40383     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                08300048
P40383     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                08310048
P40383     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 08320048
P40383     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                08330048
P40383                                                                  08340048
P40383     COPY DPPD004.                                                08350048
P40383                                                                  08360048
P40383     MOVE +4013                       TO PV-ABEND-CODE.           08370048
P40383     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08380048
P40383                                                                  08390048
060324******************************************************************08400048
060325*                       END OF PROGRAM                            08410048
060330******************************************************************08420048
