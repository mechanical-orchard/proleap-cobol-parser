 00100************************************************************      00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300************************************************************      00030000
000400                                                                  00040000
000500 PROGRAM-ID.      ARKUT103.                                       00050000
000600 AUTHOR.          J ZIMBAL.                                       00060000
000700 DATE-WRITTEN.    MARCH 2012.                                     00070000
000800                                                                  00080000
000900************************************************************      00090000
001100*** This will take the communication results file from *****      00100002
 01100*** First Data and stripping out accounts that had a   *****      00110033
001100*** have a privacy insert sent to the customer.  This will *      00120002
001100*** then create a non-monetary file and this file will be  *      00130002
001100*** sent back to First Data.                           *****      00140002
001400************************************************************      00150000
C86513******************************************************************00151038
C86513* 17/07/2014  COGNIZANT   CHG0086513                              00152039
C86513*  - CHANGED THE RECORD LENGTH OF CRF FILE AS A PART OF THE       00153038
C86513*    FD JULY MAJOR RELEASE                                        00154038
C86513******************************************************************00155038
001700******************************************************************00160003
001800 ENVIRONMENT DIVISION.                                            00170003
001900******************************************************************00180003
002000                                                                  00190003
002100 CONFIGURATION SECTION.                                           00200003
002200                                                                  00210003
002300 SOURCE-COMPUTER.        IBM-3090.                                00220003
002400 OBJECT-COMPUTER.        IBM-3090.                                00230003
002500                                                                  00240003
002600 INPUT-OUTPUT SECTION.                                            00250003
002700                                                                  00260003
002800 FILE-CONTROL.                                                    00270003
002900                                                                  00280003
003000     SELECT CRF-FILE                                              00290003
003100         ASSIGN TO INP01.                                         00300003
003200                                                                  00310003
003300     SELECT FD-NON-MONS-OUT-FILE                                  00320003
003400         ASSIGN TO OUT01.                                         00330003
003500                                                                  00340003
003600******************************************************************00350003
003700 DATA DIVISION.                                                   00360003
003800******************************************************************00370003
003900                                                                  00380003
004000 FILE SECTION.                                                    00390003
004100                                                                  00400003
004200 FD CRF-FILE                                                      00410003
00051      RECORDING MODE IS V                                          00420005
00052      LABEL RECORDS ARE STANDARD                                   00430005
00053      BLOCK CONTAINS 0 RECORDS.                                    00440005
00056                                                                   00450005
C86513 01 CRF-REC                         PIC X(6298).                  00460038
004700                                                                  00470003
004800 FD FD-NON-MONS-OUT-FILE                                          00480003
004900     RECORDING MODE IS F                                          00490003
005000     BLOCK CONTAINS 0 RECORDS                                     00500003
005100     LABEL RECORDS ARE STANDARD.                                  00510003
005200 01 NON-MON-REC                     PIC X(80).                    00520003
005300                                                                  00530003
005400 WORKING-STORAGE SECTION.                                         00540003
005500******************************************************************00550003
005600*                        ABEND CODES                              00560003
005700******************************************************************00570003
005800     COPY ARWS052.                                                00580003
005900                                                                  00590003
012000*----------------------------------------------------------------*00600008
012100*    WORKING STORAGE FOR DATE ROUTINE                             00610008
012200*----------------------------------------------------------------*00620008
012300     COPY DPWS500.                                                00630008
012400                                                                  00640008
006000******************************************************************00650003
006100*                        SWITCHES                                 00660003
006200******************************************************************00670003
006300 01 PS-PROGRAM-SWITCHES.                                          00680003
006400    05 PS-PROCESSING-SW               PIC X      VALUE SPACES.    00690003
006500       88 PS-CONTINUE-PROCESSING                 VALUE 'Y'.       00700003
006600       88 PS-STOP-PROCESSING                     VALUE 'N'.       00710003
006000    05 PS-PRVTEST-SW                  PIC X      VALUE SPACES.    00720005
006100       88 PS-PRVTEST-FOUND                       VALUE 'Y'.       00730005
006110       88 PS-PRVTEST-NOT-FOUND                   VALUE 'N'.       00740005
006700                                                                  00750003
006800******************************************************************00760003
006900*                        CONSTANTS                                00770003
007000******************************************************************00780003
007100 01 PC-PROGRAM-CONSTANTS.                                         00790003
007200    05 PC-PROGRAM-NAME                PIC X(8)   VALUE 'ARKUT103'.00800004
007300                                                                  00810003
007400******************************************************************00820003
007500*                        VARIABLES                                00830003
007600******************************************************************00840003
007700 01 PV-PROGRAM-VARIABLES.                                         00850003
007800    05 PV-NON-MON-COUNT               PIC S9(9)  VALUE ZEROES     00860003
007900                                                 COMP.            00870003
008000    05 PV-READ-COUNT                  PIC S9(11)  VALUE ZEROES    00880006
008100                                                 COMP.            00890003
          05 WS-CRF-IDX                     PIC 9(4).                   00900005
                                                                        00910005
008200    05 PV-BTCH-DATE.                                              00920003
008300       10 PV-BTCH-DATE-CC             PIC 9(02)  VALUE ZEROS.     00930008
008300       10 PV-BTCH-DATE-YY             PIC 9(02)  VALUE ZEROS.     00940008
008400       10 PV-BTCH-DATE-MM             PIC 9(02)  VALUE ZEROS.     00950003
008500       10 PV-BTCH-DATE-DD             PIC 9(02)  VALUE ZEROS.     00960003
008600    05 PV-BTCH-NBR.                                               00970003
008700       10 PV-BTCH-SEQ-NBR             PIC 9(5)   VALUE ZEROS.     00980028
008800***    10 PV-BTCH-MM                  PIC 9(2)   VALUE ZEROS.     00990028
008900***    10 PV-BTCH-DD                  PIC 9(2)   VALUE ZEROS.     01000028
008600    05 PV-BTCH-RFMT.                                              01010008
008700       10 PV-RFMT-YY                  PIC 9(1)   VALUE ZERO.      01020008
008800       10 PV-RFMT-MM                  PIC 9(2)   VALUE ZEROS.     01030008
008900       10 PV-RFMT-DD                  PIC 9(2)   VALUE ZEROS.     01040010
008910    05 PV-PREV-PRIN                   PIC X(4)   VALUE SPACES.    01050003
009000******************************************************************01060003
009100*                        COPYBOOKS                                01070003
009200******************************************************************01080003
009300                                                                  01090003
009400******************************************************************01100003
009500* FD CRF File Layout                                              01110004
009600******************************************************************01120003
009700     COPY ARRD089.                                                01130004
009800                                                                  01140003
009400******************************************************************01150004
009500* FD NON-MON RECORD LAYOUT                                        01160006
009600******************************************************************01170004
009700     COPY ARRD088.                                                01180004
009800                                                                  01190004
009900******************************************************************01200003
010000 PROCEDURE DIVISION.                                              01210003
010100******************************************************************01220003
010200*--------------*                                                  01230003
010300 0000-MAINLINE.                                                   01240003
010400*--------------*                                                  01250003
010500                                                                  01260003
010600     PERFORM Z050-INITIALIZE.                                     01270003
010500                                                                  01280006
012100     PERFORM 1000-PROCESS-CRF-FILE                                01290006
012200       UNTIL PS-STOP-PROCESSING.                                  01300006
010900                                                                  01310003
011000     PERFORM Z100-END-PROC.                                       01320003
011100                                                                  01330003
011200     STOP RUN.                                                    01340003
011300                                                                  01350003
011400*-------------------------------*                                 01360005
011500 1000-PROCESS-CRF-FILE.                                           01370006
011600*-------------------------------*                                 01380005
030000*                                                                 01390005
006110     SET PS-PRVTEST-NOT-FOUND       TO TRUE                       01400016
           MOVE +1                        TO WS-CRF-IDX                 01410019
030000*                                                                 01420005
                                                                        01430031
028900     IF (AR089-MTHD-RSLT-CT NUMERIC) AND                          01440005
028900        (AR089-MTHD-RSLT-CT > 0) AND                              01450029
              (AR089-RECORD-ID(1:1) NOT = "H")                          01460032
029600         PERFORM 2000-SEARCH-FOR-INSERTS UNTIL                    01470009
                  ((WS-CRF-IDX > AR089-MTHD-RSLT-CT) OR                 01480006
006110              PS-PRVTEST-FOUND)                                   01490006
029900     END-IF.                                                      01500005
030000*                                                                 01510005
           PERFORM 4000-READ-CRF.                                       01520016
030000*                                                                 01530016
011400*-------------------------------*                                 01540006
011500 2000-SEARCH-FOR-INSERTS.                                         01550006
011600*-------------------------------*                                 01560006
                                                                        01570006
           IF AR089-MTHD-NAME(WS-CRF-IDX) = "5PRVTEST"                  01580009
006110       SET PS-PRVTEST-FOUND       TO TRUE                         01590006
010800       PERFORM 3000-PROCESS-NON-MONS                              01600006
           END-IF.                                                      01610009
                                                                        01620006
           IF (WS-CRF-IDX = AR089-MTHD-RSLT-CT)                         01630020
             SET PS-PRVTEST-FOUND       TO TRUE                         01640020
           ELSE                                                         01650020
              ADD +1          TO WS-CRF-IDX                             01660021
           END-IF.                                                      01670020
                                                                        01680006
012400*-------------------------------*                                 01690003
012500 3000-PROCESS-NON-MONS.                                           01700006
012600*-------------------------------*                                 01710003
012800*    CHECK IF NEED BATCH HEADER AND CREATE                        01720006
                                                                        01730006
013000     IF AR089-ACCT-PRIN NOT = PV-PREV-PRIN                        01740005
                                                                        01750013
013500        MOVE SPACES                   TO AR088-HEADER-RECORD      01760013
013100        ADD 1                         TO PV-BTCH-SEQ-NBR          01770003
              MOVE 9                        TO AR088-HDR-BTCH-TYP-CDE   01780005
013200        MOVE PV-BTCH-NBR              TO AR088-HDR-BTCH-NBR       01790005
              MOVE 9368                     TO AR088-HDR-SYS-NBR        01800005
013300        MOVE AR089-ACCT-PRIN          TO AR088-HDR-PRIN-USE-NBR   01810005
              MOVE "ARKO"                   TO AR088-HDR-TERM-ID        01820005
              MOVE "AR"                     TO AR088-HDR-OPER-CDE       01830005
013400        WRITE NON-MON-REC                                         01840003
013500           FROM AR088-HEADER-RECORD                               01850005
013510        MOVE AR089-ACCT-PRIN          TO PV-PREV-PRIN             01860005
013600     END-IF.                                                      01870003
013700                                                                  01880003
014000                                                                  01890003
012800*    THIS IS WRITING OUT THE DETAIL RECORD                        01900006
                                                                        01910006
013500     MOVE SPACES                      TO AR088-NONMON-RECORD      01920013
           MOVE AR089-ACCT-NO               TO AR088-ACCT-ID.           01930009
           MOVE 216                         TO AR088-TRAN-CDE.          01940006
           MOVE 12                          TO AR088-SUB-TRAN-CDE.      01950006
           MOVE SPACES                      TO AR088-TERMINAL-ID.       01960006
           MOVE "AR"                        TO AR088-OPERATOR-CDE.      01970006
           PERFORM 3100-VALIDATE-DATE.                                  01980008
                                                                        01990006
014100     WRITE NON-MON-REC FROM AR088-NONMON-RECORD.                  02000008
                                                                        02010006
014300     ADD 1                       TO PV-NON-MON-COUNT.             02020003
014520                                                                  02030003
012400*-------------------------------*                                 02040007
057800 3100-VALIDATE-DATE.                                              02050007
012400*-------------------------------*                                 02060007
057900                                                                  02070007
058000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02080007
058100     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     02090007
058200     SET DPG52-LK-DTE-JULIAN-CC      TO TRUE.                     02100008
           MOVE AR089-ACCT-CYCLE-DTE       TO DPG52-LK-DATE-INPUT.      02110008
058400                                                                  02120007
058500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    02130007
058600                                             DPG54 DPG55 DPG56.   02140007
058700***  IF DPG54-DATE-INVALID                                        02150008
058700     IF DPG54-DATE-VALID                                          02160008
              MOVE AR089-ACCT-CYCLE-DTE(3:6)    TO AR088-UD-CONTROL-12  02170015
           ELSE                                                         02180008
058800        DISPLAY '*** BAD DATE ** ' AR089-ACCT-NO                  02190009
008600        MOVE PV-BTCH-RFMT            TO AR088-UD-CONTROL-12       02200008
059400     END-IF.                                                      02210007
059500                                                                  02220007
014600*-------------------------------*                                 02230003
014700 4000-READ-CRF.                                                   02240005
014800*-------------------------------*                                 02250003
014900                                                                  02260003
015000     READ CRF-FILE                                                02270003
015100        INTO AR089-CRF-RECORD                                     02280006
015200        AT END                                                    02290003
015300           SET PS-STOP-PROCESSING TO TRUE                         02300003
015400     END-READ.                                                    02310003
015500                                                                  02320003
015600     IF NOT PS-STOP-PROCESSING                                    02330003
015700        ADD 1 TO PV-READ-COUNT                                    02340003
015800     END-IF.                                                      02350003
015900                                                                  02360003
016000******************************************************************02370003
016100* Z050 - INITIALIZE                                               02380003
016200******************************************************************02390003
016300 Z050-INITIALIZE.                                                 02400003
016400                                                                  02410003
016500     OPEN INPUT CRF-FILE.                                         02420003
016600     OPEN OUTPUT FD-NON-MONS-OUT-FILE.                            02430003
016700                                                                  02440003
011700     SET PS-CONTINUE-PROCESSING TO TRUE.                          02450006
016800     ACCEPT PV-BTCH-DATE FROM DATE YYYYMMDD.                      02460003
              DISPLAY 'PV-BTCH-DATE ' PV-BTCH-DATE                      02470026
017000     MOVE PV-BTCH-DATE-YY           TO PV-RFMT-YY.                02480008
016900     MOVE PV-BTCH-DATE-MM           TO PV-RFMT-MM.                02490008
017000     MOVE PV-BTCH-DATE-DD           TO PV-RFMT-DD.                02500008
017100                                                                  02510003
011800**   READING TWICE TO BYPASS HEADER RECORD                        02520005
                                                                        02530005
011900     PERFORM 4000-READ-CRF.                                       02540005
012000                                                                  02550005
017200******************************************************************02560003
017300* Z100 - PREFORMS TASK TERMINATION PROCESSING                     02570003
017400******************************************************************02580003
017500 Z100-END-PROC.                                                   02590003
017600     DISPLAY ' '.                                                 02600003
017700     DISPLAY '**********************'.                            02610003
017800     DISPLAY '   ARKUT103 CONTROLS  '.                            02620004
017900     DISPLAY '**********************'.                            02630003
018000     DISPLAY ' '.                                                 02640003
018100     DISPLAY 'RECORDS READ   : ' PV-READ-COUNT.                   02650003
018200     DISPLAY 'NON MON CREATED : ' PV-NON-MON-COUNT.               02660004
018300     IF PV-NON-MON-COUNT = 0                                      02670003
018400        DISPLAY ' '                                               02680003
018500        DISPLAY '*** NO NON-MONS TO SEND TO FIRST DATA ***'       02690003
018600     END-IF.                                                      02700003
018700                                                                  02710003
018800     CLOSE CRF-FILE                                               02720003
018900           FD-NON-MONS-OUT-FILE.                                  02730003
019000                                                                  02740003
019100******************************************************************02750003
019200* Z999 - ABEND ROUTINE                                            02760003
019300******************************************************************02770003
019400 Z999-ABEND.                                                      02780003
019500                                                                  02790003
019600     CALL 'ILBOABN0' USING ABEND-CODE.                            02800003
019700                                                                  02810003
019800******************************************************************02820003
