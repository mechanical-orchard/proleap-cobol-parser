000100*------------------------*                                        00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*------------------------*                                        00030001
000400 PROGRAM-ID.     APKUT064.                                        00040001
000500 AUTHOR.         KEVIN CATLIN.                                    00050001
000600 DATE-WRITTEN.   SEPTEMBER, 2002.                                 00060001
000700*---------------------------------------------------------------* 00070001
000800*     CREATE OTP TRANSACTIONS FOR IMPORT FIRST COST INVOICES    * 00080001
000900*---------------------------------------------------------------* 00090001
001000*                      COBOL 2 WITH SQL                         * 00100001
001100*---------------------------------------------------------------* 00110001
001200*                                                               * 00120001
001300*    THIS PROGRAM SELECTS NEWLY ENTERED FIRST COST INVOICES FOR * 00130001
001400*  COLBY PURCHASE ORDERS AND FORMAT THEM TO BE INTERFACED INTO  * 00140001
001500*  PEOPLESOFT AS AN OPEN PAYABLE.  THE EFFECTIVE DATED ROWS ON  * 00150001
001600*  TABLE TACCTYP WILL USED TO CONTROL WHICH COLBY INVOICES ARE  * 00160001
001700*  INTERFACED AND WHICH ARE STILL PROCESSED UNDER THE CURRENT   * 00170001
001800*  METHOD OF PRE-PAYMENT.  A SEPARATE INTERFACE RECORD WILL BE  * 00180001
001900*  WRITTEN FOR ANY INVOICE CHARGES FOUND ON THE INVOICES.       * 00190001
002000*                                                               * 00200001
002100*---------------------------------------------------------------* 00210001
002200*                                                               * 00220001
002300*  DB2 TABLES:                                DCLGENS:          * 00230001
002400*   1. AP-PAYMENT CONTROL TABLE               (TAPCNTL)         * 00240001
002500*   2. AP-INVOICE TABLE                       (TINVOIC)         * 00250001
002600*   3. AP-ALLOWANCE/CHARGE TABLE              (TALCHRG)         * 00260001
002700*   4. AP-ACCT NBR/CHARGE TYPE XREF TABLE     (TACCTYP)         * 00270001
002800*   5. AP-VENDOR SPECIFICATIONS TABLE         (TAPVNDS)         * 00280001
002900*   6. AP-INVOICE PAYMENT TERMS TABLE         (TINVCTM)         * 00290001
003000*   7. AP-MERCHANDISE INVOICE TABLE           (TMDINVC)         * 00300001
003100*   8. AP-TRANSACTION CODE TABLE              (TTRNCDE)         * 00310001
003200*   9. PO-PURCHASE AGREEMENT TABLE            (TPOAGMT)         * 00320001
003300*  10. EX-EXTERNAL ENTERPRISE NAME TABLE      (TENTNME)         * 00330001
003400*  11. EX-EXTERNAL ENTERPRISE TABLE           (TEXTENT)         * 00340001
003500*  12. EX-PAYMENT TERM TYPE TABLE             (TPAYTRM)         * 00350001
003510*  13. TR-IMPORT RECIPT PO TABLE              (TIMRCPO)         * 00351001
003600*                                                               * 00360001
003700*  OUTPUT:                                    COPYBOOK:         * 00370001
003800*   1. AP-TRANS-FILE.                         APRD040           * 00380001
003900*   2. INVC-STATUS-UPD-FILE.                  APRD252           * 00390001
004000*                                                               * 00400001
004100*---------------------------------------------------------------* 00410001
004200* CHANGE LOG:                                                   * 00420001
004300*   11/04/2002                                                  * 00430001
004400*      INITIAL VERSION.  COLBY DATING PROCESS.                  * 00440001
004500*   MADE BY: KEVIN CATLIN                WR#: 23750             * 00450001
004600*                                                               * 00460001
004700*  DATE  03/25/2003                                             * 00470001
004800*      CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE * 00480001
004900*      TO COPYBOOK APWS052.                                     * 00490001
005000*      MADE BY: KEVIN CATLIN            WR/IR #: WR24481        * 00500001
005100*                                                               * 00510001
005200*  DATE  09/17/2003                                             * 00520001
005300*      CHANGE MADE: ADDED EFFECTIVE DATE CHECKING FOR TTRNCDE IN* 00530001
005400*      PARA S300-GET-TRNCDE-INFO.                               * 00540001
005500*      MADE BY: MIKE BESKE              WR/IR #: WR21316        * 00550001
005600*                                                               * 00560001
005700* DATE  01/30/2004                                              * 00570001
005800*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE  * 00580001
005900*     TO COPYBOOKS APWS052 AND APPD052. THIS INVOLVES THE VENDOR* 00590001
006000*     INSURANCE EXCEPTION OF NOT CHARGING BACK THE VENDOR FOR   * 00600001
006100*     INSURANCE CHARGE CODES: 'INS' AND '445'.  THE VENDORS ARE * 00610001
006200*     ANDEL JEWELRY '117498121' AND CITIZEN WATCH '078822863'.  * 00620001
006300*     MADE BY: MIKE BESKE              WR/IR #: P000628860      * 00630001
006400*                                                               * 00640001
006500* DATE  01/21/2005                                              * 00650001
006600*     CHANGE MADE: CHANGED PC-COLBY-NBR TO PC-LIFUNG-NBR AND    * 00660001
006700*     VARIOUS DISPLAYS AND COMMENTS TO LI & FUNG INPLACE OF     * 00670001
006800*     COLBY.  LI & FUNG IS THE PARENT COMPANY OF COLBY.         * 00680001
006900*     MADE BY: MIKE BESKE              WR/IR #: WR28114         * 00690001
007000*                                                               * 00700001
007010* DATE  04/29/2005                                              * 00701001
007020*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGES * 00702001
007030*     TO COPYBOOKS APWS052 AND APPD052.                         * 00703001
007050*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28651         * 00705001
007060*                                                               * 00706001
007070* DATE  03/13/2006                                              * 00707001
007080*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGES * 00708001
007090*     TO COPYBOOKS APWS052 AND APPD052.                         * 00709001
007091*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR30028         * 00709101
007092*                                                               * 00709201
007093* DATE  09/26/2006                                              * 00709301
007094*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP THE NEW * 00709401
007095*     FIELD AP040-SEPARATE-CHCK IN THE APRD040 COPYBOOK.        * 00709501
007096*     MADE BY: KRYSTEN LEARY           WR/IR #: WR31177         * 00709601
007097*                                                               * 00709701
007098* DATE  03/22/2007                                              * 00709801
007099*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP THE NEW * 00709901
007100*     FIELDS AP040-WTHD-SETID, AP040-WTHD-SW, AND AP040-WTHD-CD * 00710001
007101*     IN THE APRD040 COPYBOOK.                                  * 00710101
007102*     MADE BY: KRYSTEN LEARY           WR/IR #: WR32060         * 00710201
007103*                                                               * 00710301
007104* DATE  03/14/2023                                              * 00710401
007105*     CHANGE MADE: DIRECT IMPORT PROJECT - MODIFY THE PROGRAM   * 00710501
007106*     TO INCLUDE ALL IMPORT FIRST COST INVOICES THAT NEED TO BE * 00710601
007107*     INTERFACED TO KFS.  IN ADDITION TO L&F, THIS WILL BE THE  * 00710701
007108*     IMPORT MI INVOICES FROM INFOR-NEXUS WHICH HAVE IMPORT     * 00710801
007109*     CHARGE CODE VALUE OF '1NX'.                               * 00710901
007110*     MADE BY: NANCY EILBES            WR/IR #: CHG0285533      * 00711001
007111*                                                               * 00711101
007112* DATE  06/20/2023                                              * 00711201
007113*     CHANGE MADE: DIRECT IMPORT PART 2 - MODIFY THE PROGRAM TO * 00711301
007114*     LOOK UP THE OVERSEAS RECEIPT DATE ON TIMRCPO FOR POS WHERE* 00711401
007115*     THE INVOICE HAS IMPORT SOURCE 1NX.  USE THIS DATE AND ZERO* 00711501
007116*     FLOAT DAYS TO CALCULATE THE PAYMENT DUE DATE FOR THESE    * 00711601
007117*     INVOICES.                                                 * 00711701
007118*     MADE BY: NANCY EILBES            WR/IR #: CHG0289780      * 00711801
007121*                                                               * 00712101
007122* DATE  07/11/2023                                              * 00712201
007123*     CHANGE MADE: ADDED SQL CODE -305 IN ADDITION TO SQL CODE  * 00712301
007124*     +100 IN S900-GET-OVERSEAS-RECEIPT-DATE PARA TO HANDLE     * 00712401
007125*     NULL VALUE EXCEPTION.                                     * 00712501
007126*     MADE BY: SRINIVASAN SIVARAJ      WR/IR #: CHG0290607      * 00712603
007127*                                                               * 00712707
007128* DATE  01/03/2024                                              * 00712807
007129*     CHANGE MADE: INFOR-NEXUS PROJECT PHASE 2. ADDED LOGIC IN  * 00712907
007130*     F100-CREATE-TRANS-REC TO ENSURE THAT ALL ALLOWANCES ON    * 00713007
007131*     THE INVOICE ARE CARRIED TO THE OUTPUT FILE AND USED TO    * 00713107
007132*     CALCULATE THE NET COST.                                   * 00713207
007133*     MADE BY: NANCY EILBES            WR/IR #: CHG0297871      * 00713307
007140*---------------------------------------------------------------* 00714007
007400 ENVIRONMENT DIVISION.                                            00740001
007600 CONFIGURATION SECTION.                                           00760001
007700 SOURCE-COMPUTER.    IBM-3090.                                    00770001
007800 OBJECT-COMPUTER.    IBM-3090.                                    00780001
007900                                                                  00790001
008000 INPUT-OUTPUT SECTION.                                            00800001
008100 FILE-CONTROL.                                                    00810001
008200                                                                  00820001
008300     SELECT AP-TRANS-FILE         ASSIGN TO OUT01.                00830001
008400     SELECT INVC-STATUS-UPD-FILE  ASSIGN TO OUT02.                00840001
008500                                                                  00850001
008600*--------------*                                                  00860001
008700 DATA DIVISION.                                                   00870001
008800*--------------*                                                  00880001
008900 FILE SECTION.                                                    00890001
009000                                                                  00900001
009100 FD  AP-TRANS-FILE                                                00910001
009200     RECORDING MODE IS F                                          00920001
009300     LABEL RECORDS ARE STANDARD                                   00930001
009400     BLOCK CONTAINS 0 RECORDS                                     00940001
009500     DATA RECORD IS AP-TRANS-REC.                                 00950001
009600 01  AP-TRANS-REC                PIC  X(500).                     00960001
009700                                                                  00970001
009800 FD  INVC-STATUS-UPD-FILE                                         00980001
009900     RECORDING MODE IS F                                          00990001
010000     LABEL RECORDS ARE STANDARD                                   01000001
010100     BLOCK CONTAINS 0 RECORDS                                     01010001
010200     DATA RECORD IS INVC-STATUS-UPD-REC.                          01020001
010300 01  INVC-STATUS-UPD-REC         PIC  X(80).                      01030001
010400                                                                  01040001
010500 EJECT                                                            01050001
010600                                                                  01060001
010700 WORKING-STORAGE SECTION.                                         01070001
010800                                                                  01080001
010900 01  FILLER                      PIC  X(27)     VALUE             01090001
011000     '** START OF APKUT064 W/S **'.                               01100001
011100                                                                  01110001
011200 01  PROGRAM-CONSTANTS.                                           01120001
011300     05  PC-PROGRAM-NAME         PIC  X(08)    VALUE 'APKUT064'.  01130001
011400     05  PC-LIFUNG-NBR           PIC  X(09)    VALUE '009206194'. 01140001
011500                                                                  01150001
011600 01  PV-PROCESS-COUNTERS.                                         01160001
011700     05  PV-INVC-CSR-COUNT       PIC  9(08)     VALUE ZEROS.      01170001
011800     05  PV-AP-TRANS-COUNT       PIC  9(08)     VALUE ZEROS.      01180001
011900     05  PV-INVC-UPD-COUNT       PIC  9(08)     VALUE ZEROS.      01190001
012000                                                                  01200001
012100 01  PROGRAM-SWITCHES.                                            01210001
012200     05  PS-END-FILE-SW             PIC  X(01)   VALUE 'N'.       01220001
012300         88  NOT-END-OF-FILE                     VALUE 'N'.       01230001
012400         88  END-OF-FILE                         VALUE 'Y'.       01240001
012500     05  PS-END-INVC-CSR-SW         PIC  X(01)   VALUE 'N'.       01250001
012600         88  MORE-INVC-CSR                       VALUE 'N'.       01260001
012700         88  END-OF-INVC-CSR                     VALUE 'Y'.       01270001
012800     05  PS-INVC-CSR-OPEN-SW        PIC  X(01)   VALUE 'N'.       01280001
012900         88  INVC-CSR-CLOSED                     VALUE 'N'.       01290001
013000         88  INVC-CSR-OPEN                       VALUE 'Y'.       01300001
013100     05  PS-END-ALLOW-CSR-SW        PIC  X(01)   VALUE 'N'.       01310001
013200         88  MORE-ALLOW-CSR                      VALUE 'N'.       01320001
013300         88  END-OF-ALLOW-CSR                    VALUE 'Y'.       01330001
013400     05  PS-ALLOW-CSR-OPEN-SW       PIC  X(01)   VALUE 'N'.       01340001
013500         88  ALLOW-CSR-CLOSED                    VALUE 'N'.       01350001
013600         88  ALLOW-CSR-OPEN                      VALUE 'Y'.       01360001
013700     05  PS-END-CHRG-CSR-SW         PIC  X(01)   VALUE 'N'.       01370001
013800         88  MORE-CHRG-CSR                       VALUE 'N'.       01380001
013900         88  END-OF-CHRG-CSR                     VALUE 'Y'.       01390001
014000     05  PS-CHRG-CSR-OPEN-SW        PIC  X(01)   VALUE 'N'.       01400001
014100         88  CHRG-CSR-CLOSED                     VALUE 'N'.       01410001
014200         88  CHRG-CSR-OPEN                       VALUE 'Y'.       01420001
014300     05  PS-ALLOW-ON-INVC-SW        PIC  X(01)   VALUE 'N'.       01430001
014400         88  NO-ALLOW-ON-INVC                    VALUE 'N'.       01440001
014500         88  ALLOW-ON-INVC                       VALUE 'Y'.       01450001
014600     05  PS-FLOAT-FOUND-SW          PIC  X(01)   VALUE 'N'.       01460001
014700         88  FLOAT-DAY-FOUND                     VALUE 'N'.       01470001
014800         88  FLOAT-DAY-NOT-FOUND                 VALUE 'Y'.       01480001
014900     05  PS-END-OF-MONTH-SW         PIC  X(01)   VALUE 'N'.       01490001
015000         88  NOT-END-OF-MONTH                    VALUE 'N'.       01500001
015100         88  END-OF-MONTH                        VALUE 'Y'.       01510001
015110     05  PS-OVERSEAS-DATE-SW        PIC  X(01)   VALUE 'N'.       01511001
015120         88  OVERSEAS-DATE-NOT-FOUND             VALUE 'N'.       01512001
015130         88  OVERSEAS-DATE-FOUND                 VALUE 'Y'.       01513001
015200                                                                  01520001
015300 01  PROGRAM-VARIABLES.                                           01530001
015400     05  PV-HOLD-PO-NBR        PIC  S9(09)  COMP VALUE ZEROS.     01540001
015500     05  PV-FLOAT-DAY-QTY      PIC  S9(04)  COMP VALUE ZEROS.     01550001
015600     05  PV-DISCOUNT-PCT       PIC  SV9(4)  COMP-3 VALUE ZEROS.   01560001
015700     05  PV-ALW-CHRG-CDE       PIC   X(3)   VALUE SPACES.         01570001
015710     05  PV-HOLD-VND-ID        PIC   X(9)   VALUE SPACES.         01571001
015720     05  PV-HOLD-IMPRT-CDE     PIC   X(3)   VALUE SPACES.         01572001
015800     05  PV-GL-ACCT-NBR        PIC   X(7)   VALUE SPACES.         01580001
015900     05  PV-AUTO-OTP-PSTG-IND  PIC   X(1)   VALUE SPACES.         01590001
016000     05  PV-SUM-ALW-CHRG-AMT   PIC S9(9)V9(2) COMP-3 VALUE ZEROS. 01600001
016100     05  PV-START              PIC S9(02)   COMP VALUE ZEROS.     01610001
016110     05  PV-OVERSEAS-TMST      PIC X(26).                         01611001
016111     05  FILLER REDEFINES PV-OVERSEAS-TMST.                       01611101
016120         10 PV-OVERSEAS-DATE   PIC X(10).                         01612001
016130         10 PV-OVERSEAS-TIME   PIC X(16).                         01613001
016200                                                                  01620001
016300                                                                  01630001
016400 EJECT                                                            01640001
016500                                                                  01650001
016600*----------------------------------------------------------------*01660001
016700*  RECORD LAYOUT FOR THE ACCOUNTS PAYABLE TRANSACTION FILE        01670001
016800*----------------------------------------------------------------*01680001
016900     COPY APRD040.                                                01690001
017000                                                                  01700001
017100*----------------------------------------------------------------*01710001
017200*  RECORD LAYOUT FOR THE OPEN TO PAY INVOICE UPDATE FILE          01720001
017300*----------------------------------------------------------------*01730001
017400     COPY APRD252.                                                01740001
017500                                                                  01750001
017600*----------------------------------------------------------------*01760001
017700*  WORKING STORAGE AREA FOR APPD051 DATE ROUTINE                  01770001
017800*----------------------------------------------------------------*01780001
017900     COPY APWS051.                                                01790001
018000                                                                  01800001
018100*----------------------------------------------------------------*01810001
018200*  WORKING STORAGE AREA FOR DPKUT500                              01820001
018300*----------------------------------------------------------------*01830001
018400     COPY DPWS500.                                                01840001
018500                                                                  01850001
018600*----------------------------------------------------------------*01860001
018700*  WORKING STORAGE AREA FOR APPD052                               01870001
018800*----------------------------------------------------------------*01880001
018900     COPY APWS052.                                                01890001
019000                                                                  01900001
019100*----------------------------------------------------------------*01910001
019200*    SQL COMMUNICATIONS AREA DCLGEN                               01920001
019300*----------------------------------------------------------------*01930001
019400     EXEC SQL                                                     01940001
019500         INCLUDE SQLCA                                            01950001
019600     END-EXEC.                                                    01960001
019700                                                                  01970001
019800*----------------------------------------------------------------*01980001
019900*    AP-PAYMENT CONTROL TABLE                                     01990001
020000*----------------------------------------------------------------*02000001
020100     EXEC SQL                                                     02010001
020200         INCLUDE TAPCNTL                                          02020001
020300     END-EXEC.                                                    02030001
020400                                                                  02040001
020500*----------------------------------------------------------------*02050001
020600*    AP-INVOICE TABLE                                             02060001
020700*----------------------------------------------------------------*02070001
020800     EXEC SQL                                                     02080001
020900         INCLUDE TINVOIC                                          02090001
021000     END-EXEC.                                                    02100001
021100                                                                  02110001
021200*----------------------------------------------------------------*02120001
021300*    AP-ALLOWANCE/CHARGE TABLE                                    02130001
021400*----------------------------------------------------------------*02140001
021500     EXEC SQL                                                     02150001
021600         INCLUDE TALCHRG                                          02160001
021700     END-EXEC.                                                    02170001
021800                                                                  02180001
021900*----------------------------------------------------------------*02190001
022000*    AP-ACCT NBR/CHARGE TYPE XREF TABLE                           02200001
022100*----------------------------------------------------------------*02210001
022200     EXEC SQL                                                     02220001
022300         INCLUDE TACCTYP                                          02230001
022400     END-EXEC.                                                    02240001
022500                                                                  02250001
022600*----------------------------------------------------------------*02260001
022700*    AP-VENDOR SPECIFICATIONS TABLE                               02270001
022800*----------------------------------------------------------------*02280001
022900     EXEC SQL                                                     02290001
023000         INCLUDE TAPVNDS                                          02300001
023100     END-EXEC.                                                    02310001
023200                                                                  02320001
023300*----------------------------------------------------------------*02330001
023400*    AP-INVOICE PAYMENT TERMS TABLE                               02340001
023500*----------------------------------------------------------------*02350001
023600     EXEC SQL                                                     02360001
023700         INCLUDE TINVCTM                                          02370001
023800     END-EXEC.                                                    02380001
023900                                                                  02390001
024000*----------------------------------------------------------------*02400001
024100*    AP-MERCHANDISE INVOICE TABLE                                 02410001
024200*----------------------------------------------------------------*02420001
024300     EXEC SQL                                                     02430001
024400         INCLUDE TMDINVC                                          02440001
024500     END-EXEC.                                                    02450001
024600                                                                  02460001
024700*----------------------------------------------------------------*02470001
024800*    AP-TRANSACTION CODE TABLE                                    02480001
024900*----------------------------------------------------------------*02490001
025000     EXEC SQL                                                     02500001
025100         INCLUDE TTRNCDE                                          02510001
025200     END-EXEC.                                                    02520001
025300                                                                  02530001
025400*----------------------------------------------------------------*02540001
025500*    PO-PURCHASE AGREEMENT TABLE                                  02550001
025600*----------------------------------------------------------------*02560001
025700     EXEC SQL                                                     02570001
025800         INCLUDE TPOAGMT                                          02580001
025900     END-EXEC.                                                    02590001
026000                                                                  02600001
026100*----------------------------------------------------------------*02610001
026200*    EX-EXTERNAL ENTERPRISE NAME TABLE                            02620001
026300*----------------------------------------------------------------*02630001
026400     EXEC SQL                                                     02640001
026500         INCLUDE TENTNME                                          02650001
026600     END-EXEC.                                                    02660001
026700                                                                  02670001
026800*----------------------------------------------------------------*02680001
026900*    EX-EXTERNAL ENTERPRISE TABLE                                 02690001
027000*----------------------------------------------------------------*02700001
027100     EXEC SQL                                                     02710001
027200         INCLUDE TEXTENT                                          02720001
027300     END-EXEC.                                                    02730001
027400                                                                  02740001
027500*----------------------------------------------------------------*02750001
027600*    EX-PAYMENT TERM TYPE TABLE                                   02760001
027700*----------------------------------------------------------------*02770001
027800     EXEC SQL                                                     02780001
027900         INCLUDE TPAYTRM                                          02790001
028000     END-EXEC.                                                    02800001
028100                                                                  02810001
028110*----------------------------------------------------------------*02811001
028120*    TR-IMPORT RECEIPT PO TABLE                                   02812001
028130*----------------------------------------------------------------*02813001
028140     EXEC SQL                                                     02814001
028150         INCLUDE TIMRCPO                                          02815001
028160     END-EXEC.                                                    02816001
028170                                                                  02817001
028200*----------------------------------------------------------------*02820001
028300*    INVOICE CURSOR SELECTING LI & FUNG INVOICES IN ENTERED STATUS02830001
028400*----------------------------------------------------------------*02840001
028500     EXEC SQL                                                     02850001
028600         DECLARE INVOICE_CSR CURSOR FOR                           02860001
028700             SELECT  A.PO_NBR                                     02870001
028800                    ,A.INVC_ID                                    02880001
028810                    ,A.RMIT_VND_ID                                02881001
028900                    ,A.STR_NBR                                    02890001
029000                    ,A.INVC_DTE                                   02900001
029100                    ,A.GRO_COST_AMT                               02910001
029200                    ,A.CRE_DTE                                    02920001
029300                    ,A.CRE_BY_USR_ID                              02930001
029400                    ,A.HOLD_IND                                   02940001
029600                    ,B.IMPRT_CHRG_PRC_CDE                         02960001
029700                    ,B.TERM_SEL_CDE                               02970001
029800               FROM  TINVOIC  A                                   02980001
029900                    ,TMDINVC  B                                   02990001
030000              WHERE  A.PO_NBR       =  B.PO_NBR                   03000001
030100                AND  A.INVC_ID      =  B.INVC_ID                  03010001
030200                AND  A.STATUS_CDE   =  'EN'                       03020001
030300                AND  A.INVC_TYP_CDE =  'MI'                       03030001
030310                AND  B.IMPRT_CHRG_PRC_CDE IN ('1ST','1NX')        03031001
030400*****           AND  A.RMIT_VND_ID  =  :PC-LIFUNG-NBR             03040001
030500           ORDER BY  A.RMIT_VND_ID                                03050001
030510                    ,A.PO_NBR                                     03051001
030600                    ,A.INVC_ID                                    03060001
030700     END-EXEC.                                                    03070001
030800                                                                  03080001
030900*----------------------------------------------------------------*03090001
031000*    ALLOWANCE CURSOR SELECTS ALLOWANCE INFO FOR PO/INVOICE NBR   03100001
031100*----------------------------------------------------------------*03110001
031200     EXEC SQL                                                     03120001
031300         DECLARE ALLOW_CSR CURSOR FOR                             03130001
031400             SELECT  ALW_CHRG_CDE                                 03140001
031500                    ,ALW_CHRG_AMT                                 03150001
031600                    ,ALW_CHRG_PCT                                 03160001
031700                    ,ALW_CHRG_TYP_CDE                             03170001
031800               FROM  TALCHRG                                      03180001
031900              WHERE  PO_NBR           =  :INVOIC-PO-NBR           03190001
032000                AND  INVC_ID          =  :INVOIC-INVC-ID          03200001
032100                AND  ALW_CHRG_TYP_CDE =  'A'                      03210001
032200     END-EXEC.                                                    03220001
032300                                                                  03230001
032400*----------------------------------------------------------------*03240001
032500*    CHARGE CURSOR SELECT CHARGE INFO FOR PO/INVOICE NBR          03250001
032600*----------------------------------------------------------------*03260001
032700     EXEC SQL                                                     03270001
032800         DECLARE CHARGE_CSR CURSOR FOR                            03280001
032900             SELECT  A.ALW_CHRG_CDE                               03290001
033000                    ,B.GL_ACCT_NBR                                03300001
033100                    ,B.AUTO_OTP_PSTG_IND                          03310001
033200                    ,SUM(A.ALW_CHRG_AMT)                          03320001
033300               FROM  TALCHRG  A                                   03330001
033400                    ,TACCTYP  B                                   03340001
033500              WHERE  A.PO_NBR           =  :INVOIC-PO-NBR         03350001
033600                AND  A.INVC_ID          =  :INVOIC-INVC-ID        03360001
033700                AND  A.ALW_CHRG_CDE     =  B.ALW_CHRG_CDE         03370001
033800                AND  A.ALW_CHRG_TYP_CDE =  'C'                    03380001
033900                AND  B.EFF_STRT_DTE    <=  :INVOIC-INVC-DTE       03390001
034000                AND  B.EFF_END_DTE     >=  :INVOIC-INVC-DTE       03400001
034100           GROUP BY  A.ALW_CHRG_CDE                               03410001
034200                    ,B.GL_ACCT_NBR                                03420001
034300                    ,B.AUTO_OTP_PSTG_IND                          03430001
034400     END-EXEC.                                                    03440001
034500                                                                  03450001
034600*----------------------------------------------------------------*03460001
034700*    ABEND DATA AREAS                                             03470001
034800*----------------------------------------------------------------*03480001
034900 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      03490001
035000                                   COMP         SYNC.             03500001
035100                                                                  03510001
035200     88  AC-ANY-ERROR                           VALUE  +4001      03520001
035300                                                THRU   +4019.     03530001
035400     88  AC-OPEN-ERROR                          VALUE  +4005.     03540001
035500     88  AC-CLOSE-ERROR                         VALUE  +4006.     03550001
035600     88  AC-INVALID-DATA                        VALUE  +4008.     03560001
035700     88  AC-DB2-ERROR                           VALUE  +4013.     03570001
035800     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     03580001
035900     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     03590001
036000                                                                  03600001
036100 01  ABEND-AREAS.                                                 03610001
036200     05  AA-ABEND-LIT              PIC  X(40)   VALUE             03620001
036300             '*****       ABEND'.                                 03630001
036400     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             03640001
036500             '*****   PROGRAM: APKUT064'.                         03650001
036600     05  AA-PARAGRAPH-LIT.                                        03660001
036700         10  FILLER                PIC  X(17)   VALUE             03670001
036800             '***** PARAGRAPH: '.                                 03680001
036900         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     03690001
037000     05  AA-MESSAGE-LINE-1.                                       03700001
037100         10  FILLER                PIC  X(06)   VALUE '*****'.    03710001
037200         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     03720001
037300     05  AA-MESSAGE-LINE-2.                                       03730001
037400         10  FILLER                PIC  X(06)   VALUE '*****'.    03740001
037500         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     03750001
037600     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             03760001
037700             '*****    DB2 ERROR'.                                03770001
037800     05  AA-DB2-OPERATION-LIT.                                    03780001
037900         10  FILLER                PIC  X(17)   VALUE             03790001
038000             '***** OPERATION: '.                                 03800001
038100         10  AA-DB2-OPERATION.                                    03810001
038200             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     03820001
038300             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     03830001
038400     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     03840001
038500     05  AA-DB2-TABLE-2            PIC  X(08)   VALUE SPACES.     03850001
038600                                                                  03860001
038700*----------------------------------------------------------------*03870001
038800*    SQLCA FORMATTED MESSAGE AREA                                 03880001
038900*----------------------------------------------------------------*03890001
039000     COPY DPWS004.                                                03900001
039100                                                                  03910001
039200 01  FILLER                      PIC  X(25)     VALUE             03920001
039300     '** END OF APKUT064 W/S **'.                                 03930001
039400                                                                  03940001
039500*-------------------*                                             03950001
039600 PROCEDURE DIVISION.                                              03960001
039700*-------------------*                                             03970001
039800 A100-MAINLINE.                                                   03980001
039900                                                                  03990001
040000     PERFORM B100-INITIALIZE.                                     04000001
040100                                                                  04010001
040200     PERFORM B200-PROCESS-INVOICES                                04020001
040300       UNTIL END-OF-INVC-CSR.                                     04030001
040400                                                                  04040001
040500     PERFORM B300-END-OF-PROGRAM.                                 04050001
040600                                                                  04060001
040700     GOBACK.                                                      04070001
040800                                                                  04080001
040900                                                                  04090001
041000*----------------------------------------------------------------*04100001
041100*    INITIALIZATION PROCESSING                                    04110001
041200*    - OPEN FILES                                                 04120001
041300*    - INITIALIZE DCLGENS AND SWITCHES                            04130001
041400*    - PERFORM SELECTS                                            04140001
041500*    - OPEN INVOICE CURSOR AND PERFORM FIRST FETCH                04150001
041600*----------------------------------------------------------------*04160001
041700 B100-INITIALIZE.                                                 04170001
041800                                                                  04180001
041900     DISPLAY '**------  APKUT064  (PROCESSING MSGS)  ------**'.   04190001
042000                                                                  04200001
042100     OPEN  OUTPUT  AP-TRANS-FILE                                  04210001
042200                   INVC-STATUS-UPD-FILE.                          04220001
042300                                                                  04230001
042400     INITIALIZE  DCLTAPCNTL                                       04240001
042500                 DCLTINVOIC                                       04250001
042600                 DCLTALCHRG                                       04260001
042700                 DCLTACCTYP                                       04270001
042800                 DCLTAPVNDS                                       04280001
042900                 DCLTINVCTM                                       04290001
043000                 DCLTMDINVC                                       04300001
043100                 DCLTTRNCDE                                       04310001
043200                 DCLTPOAGMT                                       04320001
043300                 DCLTENTNME                                       04330001
043400                 DCLTEXTENT                                       04340001
043500                 DCLTPAYTRM                                       04350001
043600                 PROGRAM-SWITCHES.                                04360001
043700                                                                  04370001
043800     PERFORM S200-GET-CONTROL-INFO.                               04380001
043900     DISPLAY '** BATCH PROCESS DATE: ' APCNTL-BTCH-PRC-DTE.       04390001
044000                                                                  04400001
044100     PERFORM S300-GET-TRNCDE-INFO.                                04410001
044400                                                                  04440001
045300     PERFORM X100-OPEN-INVC-CSR.                                  04530001
045400                                                                  04540001
045500     PERFORM S050-FETCH-INVC-CSR.                                 04550001
045600                                                                  04560001
045700     IF END-OF-INVC-CSR                                           04570001
045800        DISPLAY '** NO IMPORT 1ST COST INVOICES FOUND **'         04580001
045900     END-IF.                                                      04590001
046000                                                                  04600001
046100                                                                  04610001
046200*----------------------------------------------------------------*04620001
046300*    PROCESS INVOICES                                             04630001
046400*    - SELECT VENDOR NAME AND ENT-ID FOR THE IMPORT VENDOR        04640001
046410*    - SELECT DATES AND ACCOUNT NUMBER                            04641001
046500*    - FORMAT AND WRITE THE TRANSACTION RECORD FOR THE OTP        04650001
046510*    - FETCH NEXT ROW                                             04651001
046600*----------------------------------------------------------------*04660001
046700 B200-PROCESS-INVOICES.                                           04670001
046800                                                                  04680001
046810     IF INVOIC-RMIT-VND-ID = PV-HOLD-VND-ID                       04681001
046820        CONTINUE                                                  04682001
046830     ELSE                                                         04683001
046831        MOVE INVOIC-RMIT-VND-ID TO PV-HOLD-VND-ID                 04683101
046840        PERFORM S400-GET-ENTITY-INFO                              04684001
046850        PERFORM S500-GET-FLOAT-DAY                                04685001
046860     END-IF.                                                      04686001
046870                                                                  04687001
046880     IF MDINVC-IMPRT-CHRG-PRC-CDE = PV-HOLD-IMPRT-CDE             04688001
046890        CONTINUE                                                  04689001
046891     ELSE                                                         04689101
046892        MOVE MDINVC-IMPRT-CHRG-PRC-CDE TO PV-HOLD-IMPRT-CDE       04689201
046900        PERFORM S600-GET-GL-ACCT-NBR                              04690001
046910     END-IF.                                                      04691001
047000                                                                  04700001
047100     IF ACCTYP-AUTO-OTP-PSTG-IND = 'N'                            04710001
047200        CONTINUE                                                  04720001
047300     ELSE                                                         04730001
047400        PERFORM C100-PROCESS-PO-INVC                              04740001
047500     END-IF                                                       04750001
047600                                                                  04760001
047700     PERFORM S050-FETCH-INVC-CSR.                                 04770001
047800                                                                  04780001
047900                                                                  04790001
048000*----------------------------------------------------------------*04800001
048100*    END OF PROGRAM                                               04810001
048200*    - CLOSE CURSOR, IF OPEN                                      04820001
048300*    - CLOSE FILES                                                04830001
048400*----------------------------------------------------------------*04840001
048500 B300-END-OF-PROGRAM.                                             04850001
048600                                                                  04860001
048700     DISPLAY ' '.                                                 04870001
048800     DISPLAY '*************************************************'. 04880001
048900     DISPLAY '** TOTAL INVOICES READ = ' PV-INVC-CSR-COUNT.       04890001
049000     DISPLAY '*************************************************'. 04900001
049100     DISPLAY '** TOTAL AP TRANS RECS WRT = ' PV-AP-TRANS-COUNT.   04910001
049200     DISPLAY '*************************************************'. 04920001
049300     DISPLAY '** TOTAL INVC UPDT RECS WRT = ' PV-INVC-UPD-COUNT.  04930001
049400     DISPLAY '*************************************************'. 04940001
049500     DISPLAY '**         END OF APKUT064 PROCESSING          **'. 04950001
049600     DISPLAY '*************************************************'. 04960001
049700     DISPLAY ' '.                                                 04970001
049800                                                                  04980001
049900     IF INVC-CSR-OPEN                                             04990001
050000        PERFORM Y100-CLOSE-INVC-CSR                               05000001
050100     END-IF                                                       05010001
050200                                                                  05020001
050300     CLOSE AP-TRANS-FILE                                          05030001
050400           INVC-STATUS-UPD-FILE.                                  05040001
050500                                                                  05050001
050600                                                                  05060001
050700*----------------------------------------------------------------*05070001
050800*    PROCESS INVOICE DETAIL                                       05080001
050900*    - GET PAY TERMS                                              05090001
051000*    - PROCESS ALLOWANCES FOR INVOICE                             05100001
051100*    - PROCESS CHARGES FOR INVOICE                                05110001
051200*    - CREATE AP TRANSACTION AND INVOICE STATUS UPDATE RECORDS    05120001
051300*----------------------------------------------------------------*05130001
051400 C100-PROCESS-PO-INVC.                                            05140001
051500                                                                  05150001
051600     PERFORM D100-GET-PAY-TERMS.                                  05160001
051700                                                                  05170001
051800     INITIALIZE APPD052-VARIABLES.                                05180001
051830     MOVE INVOIC-GRO-COST-AMT   TO APPD052-GROSS-INVOICE-COST.    05183006
051900                                                                  05190001
052000     PERFORM X200-OPEN-ALLOW-CSR.                                 05200001
052100     SET NO-ALLOW-ON-INVC TO TRUE.                                05210001
052200     PERFORM S100-FETCH-ALLOW-CSR.                                05220001
052300     PERFORM UNTIL END-OF-ALLOW-CSR                               05230001
052400         PERFORM E400-CALC-ALW-CHRG                               05240001
052500         PERFORM S100-FETCH-ALLOW-CSR                             05250001
052600     END-PERFORM.                                                 05260001
052700     PERFORM Y200-CLOSE-ALLOW-CSR.                                05270001
052800                                                                  05280001
052900     PERFORM F100-CREATE-TRANS-REC.                               05290001
053000                                                                  05300001
053100     PERFORM F200-CREATE-INVC-UPD-REC.                            05310001
053200                                                                  05320001
053300     PERFORM X300-OPEN-CHRG-CSR.                                  05330001
053400     PERFORM S150-FETCH-CHRG-CSR.                                 05340001
053500     PERFORM D200-PROCESS-CHRG                                    05350001
053600       UNTIL END-OF-CHRG-CSR.                                     05360001
053700     PERFORM Y300-CLOSE-CHRG-CSR.                                 05370001
053800                                                                  05380001
053900                                                                  05390001
054000*----------------------------------------------------------------*05400001
054100*    PROCESS EITHER PO OR INVOICE PAY TERMS                       05410001
054200*    - PERFORM DATE ROUTINE                                       05420001
054300*----------------------------------------------------------------*05430001
054400 D100-GET-PAY-TERMS.                                              05440001
054500                                                                  05450001
054600     IF MDINVC-TERM-SEL-CDE = 'P'                                 05460001
054700        PERFORM E100-PROCESS-PO-TERMS                             05470001
054800     ELSE                                                         05480001
054900        IF MDINVC-TERM-SEL-CDE = 'I'                              05490001
055000           PERFORM E200-PROCESS-INVC-TERMS                        05500001
055100        END-IF                                                    05510001
055200     END-IF                                                       05520001
055300                                                                  05530001
055301     MOVE INVOIC-INVC-DTE          TO APPD051-INVOICE-DATE.       05530101
055302     MOVE PS-END-OF-MONTH-SW       TO APPD051-EOM-IND.            05530201
055303     MOVE PV-FLOAT-DAY-QTY         TO APPD051-FLOAT-DAYS.         05530301
055304                                                                  05530401
055305                                                                  05530501
055306** FOR NEXUS INVOICES WITH INVOICE TERMS, REPLACE THE INVOICE DATE05530601
055307** WITH THE OVERSEAS RECEIPT DATE AND USE ZERO FLOAT DAYS FOR THE 05530701
055308** DUE DATE CALCULATION.                                          05530801
055310     IF  MDINVC-IMPRT-CHRG-PRC-CDE = '1NX'                        05531001
055311     AND MDINVC-TERM-SEL-CDE = 'I'                                05531101
055320        PERFORM S900-GET-OVERSEAS-RECEIPT-DATE                    05532001
055330        IF OVERSEAS-DATE-FOUND                                    05533001
055340           MOVE IMRCPO-PO-RCVD-DELY-TMST TO PV-OVERSEAS-TMST      05534001
055350           MOVE PV-OVERSEAS-DATE         TO APPD051-INVOICE-DATE  05535001
055351           MOVE 0                        TO APPD051-FLOAT-DAYS    05535101
055360        END-IF                                                    05536001
055370     END-IF.                                                      05537001
055380                                                                  05538001
055800     PERFORM E300-CALC-DUE-DATE.                                  05580001
055900                                                                  05590001
056000                                                                  05600001
056100*----------------------------------------------------------------*05610001
056200*    PROCESS ANY CHARGES FOR INVOICE AND WRITE OUT RECORD         05620001
056300*----------------------------------------------------------------*05630001
056400 D200-PROCESS-CHRG.                                               05640001
056500                                                                  05650001
056600     IF PV-AUTO-OTP-PSTG-IND = 'Y'                                05660001
056700        MOVE PV-GL-ACCT-NBR      TO AP040-GL-ACCT-NBR             05670001
056800        MOVE PV-SUM-ALW-CHRG-AMT TO AP040-GRO-COST-AMT            05680001
056900                                    AP040-NET-COST-AMT            05690001
057000        INITIALIZE  AP040-TERM-DISC-PCT                           05700001
057100                    AP040-TERM-DISC-AMT                           05710001
057200        IF ALLOW-ON-INVC                                          05720001
057300           PERFORM E500-CONVERT-INVC-ID                           05730001
057400        END-IF                                                    05740001
057500        PERFORM W100-WRITE-AP-TRANS                               05750001
057600     END-IF                                                       05760001
057700                                                                  05770001
057800     PERFORM S150-FETCH-CHRG-CSR.                                 05780001
057900                                                                  05790001
058000                                                                  05800001
058100*----------------------------------------------------------------*05810001
058200*    PROCESS PO TERMS AND PREPARE FIELDS FOR DATE ROUTINE         05820001
058300*----------------------------------------------------------------*05830001
058400 E100-PROCESS-PO-TERMS.                                           05840001
058500                                                                  05850001
058600     PERFORM S700-GET-PO-PAY-TERMS.                               05860001
058700                                                                  05870001
058800     IF PAYTRM-DISCOUNT-PCT = ZERO                                05880001
058900         MOVE PAYTRM-DUE-DAY-QTY TO APPD051-DISCOUNT-DAYS         05890001
059000     ELSE                                                         05900001
059100         MOVE PAYTRM-DISCOUNT-DAYS-QTY TO APPD051-DISCOUNT-DAYS   05910001
059200     END-IF                                                       05920001
059300                                                                  05930001
059400     IF PAYTRM-DUE-DAY-FR-DTE-TXT = 'EOM'                         05940001
059500         SET END-OF-MONTH TO TRUE                                 05950001
059600     ELSE                                                         05960001
059700         SET NOT-END-OF-MONTH TO TRUE                             05970001
059800     END-IF                                                       05980001
059900                                                                  05990001
060000     MOVE POAGMT-DISC-PAY-DAY-QTY  TO  APPD051-EXTENDED-DAYS.     06000001
060100     MOVE PAYTRM-DISCOUNT-PCT      TO  PV-DISCOUNT-PCT.           06010001
060200                                                                  06020001
060300                                                                  06030001
060400*----------------------------------------------------------------*06040001
060500*    PROCESS INVOICE TERMS AND PREPARE FIELDS FOR DATE ROUTINE    06050001
060600*----------------------------------------------------------------*06060001
060700 E200-PROCESS-INVC-TERMS.                                         06070001
060800                                                                  06080001
060900     PERFORM S800-GET-INVC-PAY-TERMS.                             06090001
061000                                                                  06100001
061100     IF INVCTM-DISC-PCT = ZERO                                    06110001
061200         MOVE INVCTM-NET-DUE-DAY-QTY  TO APPD051-DISCOUNT-DAYS    06120001
061300     ELSE                                                         06130001
061400         MOVE INVCTM-DISC-DUE-DAY-QTY TO APPD051-DISCOUNT-DAYS    06140001
061500     END-IF                                                       06150001
061600                                                                  06160001
061700     IF INVCTM-TERM-TYP-CDE = '02'                                06170001
061800         SET END-OF-MONTH TO TRUE                                 06180001
061900     ELSE                                                         06190001
062000         SET NOT-END-OF-MONTH TO TRUE                             06200001
062100     END-IF                                                       06210001
062200                                                                  06220001
062300     MOVE INVCTM-EXTD-DAYS-QTY  TO  APPD051-EXTENDED-DAYS.        06230001
062400     MOVE INVCTM-DISC-PCT       TO  PV-DISCOUNT-PCT.              06240001
062500                                                                  06250001
062600                                                                  06260001
062700*----------------------------------------------------------------*06270001
062800*    PERFORMS THE COPYBOOK ROUTINE THAT CALCULATES THE PAYMENT    06280001
062900*    DUE DATE                                                     06290001
063000*----------------------------------------------------------------*06300001
063100 E300-CALC-DUE-DATE.                                              06310001
063200                                                                  06320001
063300     PERFORM CALC-PAYMENT-DUE-DATE.                               06330001
063400                                                                  06340001
063500     COPY APPD051.                                                06350001
063600                                                                  06360001
063700                                                                  06370001
063800*----------------------------------------------------------------*06380001
063900*    PERFORMS THE COPYBOOK SUBROUTINE THAT CALCULATES VARIOUS     06390001
064000*    DISCOUNT PERCENTS, DISCOUNT AMOUNTS, AND CHARGES             06400001
064100*----------------------------------------------------------------*06410001
064200 E400-CALC-ALW-CHRG.                                              06420001
064300                                                                  06430001
064400     PERFORM CALC-ALW-CHRG.                                       06440001
064500                                                                  06450001
064600     COPY APPD052.                                                06460001
064700                                                                  06470001
064800                                                                  06480001
064900*---------------------------------------------------------------- 06490001
065000*    CONVERTS THE INVOICE ID FOR THE USE AS THE DOC NUMBER FOR    06500001
065100*    ADJUSTMENTS.  IT LEFT-JUSTIFIES THE NUMBER AND USES THE FIRST06510001
065200*    16 CHARACTERS OF THE INVOICE ID.  THIS IS BECAUSE THE DOC    06520001
065300*    NUMBER IS ONLY 16 CHARACTERS LONG.                           06530001
065400*---------------------------------------------------------------- 06540001
065500 E500-CONVERT-INVC-ID.                                            06550001
065600                                                                  06560001
065700     MOVE LENGTH OF INVOIC-INVC-ID  TO  PV-START.                 06570001
065800                                                                  06580001
065900     PERFORM                                                      06590001
066000       UNTIL INVOIC-INVC-ID (PV-START:1) > SPACES OR              06600001
066100             PV-START = +0                                        06610001
066200         COMPUTE PV-START = PV-START - 1                          06620001
066300     END-PERFORM                                                  06630001
066400                                                                  06640001
066500     IF PV-START < 14                                             06650001
066600         STRING INVOIC-INVC-ID DELIMITED BY ' '                   06660001
066700                PV-ALW-CHRG-CDE DELIMITED BY SIZE                 06670001
066800           INTO AP040-DOC-NBR                                     06680001
066900     ELSE                                                         06690001
067000         SUBTRACT +12 FROM PV-START                               06700001
067100         STRING INVOIC-INVC-ID (PV-START:13) DELIMITED BY SIZE    06710001
067200                PV-ALW-CHRG-CDE DELIMITED BY SIZE                 06720001
067300           INTO AP040-DOC-NBR                                     06730001
067400     END-IF.                                                      06740001
067500                                                                  06750001
067600                                                                  06760001
067700*----------------------------------------------------------------*06770001
067800*    CREATE AP TRANSACTION RECORD                                 06780001
067900*    - FORMAT RECORD                                              06790001
068000*    - WRITE RECORD                                               06800001
068100*----------------------------------------------------------------*06810001
068200 F100-CREATE-TRANS-REC.                                           06820001
068300                                                                  06830001
068400     INITIALIZE AP040-TRANSACTION-FILE.                           06840001
068500                                                                  06850001
068600     MOVE INVOIC-RMIT-VND-ID       TO AP040-VND-NBR.              06860001
068700     MOVE INVOIC-INVC-ID           TO AP040-DOC-NBR.              06870001
068800     MOVE INVOIC-INVC-DTE          TO AP040-DOC-DTE.              06880001
068900     MOVE '01'                     TO AP040-AP-TRN-CDE.           06890001
069000     MOVE INVOIC-PO-NBR            TO AP040-PO-NBR.               06900001
069100     MOVE ACCTYP-GL-ACCT-NBR       TO AP040-GL-ACCT-NBR.          06910001
069200     MOVE TRNCDE-PSTG-TYP-CDE      TO AP040-PSTG-TYP-CDE.         06920001
069300     MOVE 'EXP'                    TO AP040-TRN-TYP-CDE.          06930001
069400     MOVE APCNTL-BTCH-PRC-DTE      TO AP040-ENTR-DTE.             06940001
069500     MOVE '.18-00-00-000000'       TO AP040-ENTR-TME.             06950001
069600     MOVE INVOIC-CRE-BY-USR-ID     TO AP040-ENTR-ID.              06960001
069700     MOVE 'I'                      TO AP040-ORGN-CDE.             06970001
069800     MOVE APCNTL-BTCH-PRC-DTE      TO AP040-INV-CUTOFF-DTE.       06980001
070000     MOVE APCNTL-BTCH-PRC-DTE      TO AP040-PS-BTCH-DTE.          07000001
070100     MOVE 'IMP'                    TO AP040-PS-BTCH-SRC-CDE.      07010001
070200     MOVE '00'                     TO AP040-PS-BTCH-SEQ-NBR.      07020001
070300     MOVE EXTENT-ENT-ID            TO AP040-ENT-ID.               07030001
070400     MOVE ENTNME-ENT-NAME-DESC     TO AP040-ENT-NME-DESC.         07040001
070500     MOVE INVOIC-STR-NBR           TO AP040-STR-NBR.              07050001
070600     MOVE INVOIC-GRO-COST-AMT      TO AP040-GRO-COST-AMT.         07060001
070700     MOVE APPD051-RETURN-DATE-CCYY-MM-DD                          07070001
070800                                   TO AP040-PYMT-DUE-DTE.         07080001
070900     MOVE ACCTYP-AUTO-OTP-PSTG-IND TO AP040-AUTO-OTP-PSTG-IND.    07090001
071000     MOVE TRNCDE-AP-PSTG-IND       TO AP040-AP-PSTG-IND.          07100001
071100                                                                  07110004
071110     MOVE PV-DISCOUNT-PCT          TO AP040-TERM-DISC-PCT.        07111001
072500                                                                  07250001
072510     COMPUTE AP040-TERM-DISC-AMT = (AP040-GRO-COST-AMT *          07251001
072520                                    AP040-TERM-DISC-PCT) + .005.  07252001
072530     COMPUTE AP040-NW-STR-DISC-PCT =                              07253001
072540                          APPD052-NEW-STORE-DISC-PCT / 100.       07254001
072550     COMPUTE AP040-TRD-DISC-PCT =                                 07255001
072560                          APPD052-TRADE-DISC-PCT / 100.           07256001
072570     COMPUTE AP040-MOS-DISC-PCT =                                 07257001
072580                          APPD052-MOS-DISC-PCT / 100.             07258001
072590     COMPUTE AP040-ADV-DISC-PCT =                                 07259001
072591                          APPD052-ADV-DISC-PCT / 100.             07259101
072593     COMPUTE AP040-COOP-DISC-PCT =                                07259301
072594                          APPD052-COOP-ADV-ALLOW-PCT / 100.       07259404
072595     COMPUTE AP040-ALW-DISC-PCT =                                 07259501
072596                          APPD052-PRFT-ASST-COOP-PCT / 100.       07259604
072597     COMPUTE AP040-MSC-DISC-PCT =                                 07259701
072598                          APPD052-MISC-DISC-PCT / 100.            07259805
072599                                                                  07259904
072600     MOVE APPD052-NEW-STORE-AMT      TO AP040-NW-STR-DISC-AMT.    07260004
072601     MOVE APPD052-TRADE-AMT          TO AP040-TRD-DISC-AMT.       07260104
072602     MOVE APPD052-MOS-DISC-AMT       TO AP040-MOS-DISC-AMT.       07260204
072603     MOVE APPD052-ADV-DISC-AMT       TO AP040-ADV-DISC-AMT.       07260304
072604     MOVE APPD052-COOP-ADV-ALLOW-AMT TO AP040-COOP-DISC-AMT.      07260404
072605     MOVE APPD052-PRFT-ASST-COOP-AMT TO AP040-ALW-DISC-AMT.       07260504
072606     MOVE APPD052-MISC-DISC-AMT      TO AP040-MSC-DISC-AMT.       07260605
072607                                                                  07260704
072610*    COMPUTE AP040-NET-COST-AMT =                                 07261004
072700*              INVOIC-GRO-COST-AMT - AP040-TERM-DISC-AMT.         07270004
072800                                                                  07280001
072801     COMPUTE AP040-NET-COST-AMT = (AP040-GRO-COST-AMT             07280101
072804                           - AP040-TERM-DISC-AMT                  07280401
072805                           - AP040-NW-STR-DISC-AMT                07280501
072806                           - AP040-TRD-DISC-AMT                   07280601
072807                           - AP040-MOS-DISC-AMT                   07280701
072808                           - AP040-ADV-DISC-AMT                   07280801
072809                           - AP040-COOP-DISC-AMT                  07280901
072810                           - AP040-ALW-DISC-AMT                   07281001
072811                           - AP040-MSC-DISC-AMT ).                07281101
072820***************                                                   07282001
072900     EVALUATE INVOIC-HOLD-IND                                     07290001
073000         WHEN 'Y'                                                 07300001
073100              MOVE 'D' TO AP040-DOC-HLD-CDE                       07310001
073200         WHEN 'N'                                                 07320001
073300              MOVE 'N' TO AP040-DOC-HLD-CDE                       07330001
073400     END-EVALUATE                                                 07340001
073500                                                                  07350001
073600     PERFORM W100-WRITE-AP-TRANS.                                 07360001
073700                                                                  07370001
073800                                                                  07380001
073900*----------------------------------------------------------------*07390001
074000*    CREATE INVOICE STATUS UPDATE RECORD                          07400001
074100*    - FORMAT RECORD                                              07410001
074200*    - WRITE RECORD                                               07420001
074300*----------------------------------------------------------------*07430001
074400 F200-CREATE-INVC-UPD-REC.                                        07440001
074500                                                                  07450001
074600     INITIALIZE AP252-RECORD.                                     07460001
074700                                                                  07470001
074800     MOVE INVOIC-PO-NBR      TO  AP252-PO-NBR.                    07480001
074900     MOVE INVOIC-INVC-ID     TO  AP252-INVOICE-ID.                07490001
075000     MOVE 'PJ'               TO  AP252-NEW-STATUS-CDE.            07500001
075100     MOVE '9999-09-09'       TO  AP252-PAYT-DTE.                  07510001
075200                                                                  07520001
075300     PERFORM W200-WRITE-INVC-UPD.                                 07530001
075400                                                                  07540001
075500                                                                  07550001
075600*----------------------------------------------------------------*07560001
075700*    FETCH THE INVOICE_CSR CURSOR                                 07570001
075800*----------------------------------------------------------------*07580001
075900 S050-FETCH-INVC-CSR.                                             07590001
076000                                                                  07600001
076100     EXEC SQL                                                     07610001
076200          FETCH  INVOICE_CSR                                      07620001
076300           INTO :INVOIC-PO-NBR                                    07630001
076400               ,:INVOIC-INVC-ID                                   07640001
076410               ,:INVOIC-RMIT-VND-ID                               07641001
076500               ,:INVOIC-STR-NBR                                   07650001
076600               ,:INVOIC-INVC-DTE                                  07660001
076700               ,:INVOIC-GRO-COST-AMT                              07670001
076800               ,:INVOIC-CRE-DTE                                   07680001
076900               ,:INVOIC-CRE-BY-USR-ID                             07690001
077000               ,:INVOIC-HOLD-IND                                  07700001
077200               ,:MDINVC-IMPRT-CHRG-PRC-CDE                        07720001
077300               ,:MDINVC-TERM-SEL-CDE                              07730001
077400     END-EXEC.                                                    07740001
077500                                                                  07750001
077600     EVALUATE TRUE                                                07760001
077700         WHEN SQLCODE = ZERO                                      07770001
077800             ADD +1 TO PV-INVC-CSR-COUNT                          07780001
077900             SET MORE-INVC-CSR TO TRUE                            07790001
078000                                                                  07800001
078100         WHEN SQLCODE = +100                                      07810001
078200             SET END-OF-INVC-CSR TO TRUE                          07820001
078300                                                                  07830001
078400         WHEN SQLWARN0 NOT = SPACES                               07840001
078500         WHEN SQLCODE  NOT = ZERO                                 07850001
078600             MOVE 'S050-FETCH-INVC-CSR'                           07860001
078700                                 TO AA-PARAGRAPH-NAME             07870001
078800             MOVE 'UNSUCCESSFUL FETCH FROM INVOICE_CSR'           07880001
078900                                 TO AA-DB2-OPERATION              07890001
079000             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                07900001
079100             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                07910001
079200             PERFORM Z999-DB2-ABEND                               07920001
079300                                                                  07930001
079400     END-EVALUATE.                                                07940001
079500                                                                  07950001
079600                                                                  07960001
079700*----------------------------------------------------------------*07970001
079800*    FETCH THE ALLOW_CSR CURSOR                                   07980001
079900*----------------------------------------------------------------*07990001
080000 S100-FETCH-ALLOW-CSR.                                            08000001
080100                                                                  08010001
080200     EXEC SQL                                                     08020001
080300          FETCH  ALLOW_CSR                                        08030001
080400           INTO :ALCHRG-ALW-CHRG-CDE                              08040001
080500               ,:ALCHRG-ALW-CHRG-AMT                              08050001
080600               ,:ALCHRG-ALW-CHRG-PCT                              08060001
080700               ,:ALCHRG-ALW-CHRG-TYP-CDE                          08070001
080800     END-EXEC.                                                    08080001
080900                                                                  08090001
081000     EVALUATE TRUE                                                08100001
081100         WHEN SQLCODE = ZERO                                      08110001
081200             SET ALLOW-ON-INVC  TO TRUE                           08120001
081300             SET MORE-ALLOW-CSR TO TRUE                           08130001
081400                                                                  08140001
081500         WHEN SQLCODE = +100                                      08150001
081600             SET END-OF-ALLOW-CSR TO TRUE                         08160001
081700                                                                  08170001
081800         WHEN SQLWARN0 NOT = SPACES                               08180001
081900         WHEN SQLCODE  NOT = ZERO                                 08190001
082000             MOVE 'S100-FETCH-ALLOW-CSR'                          08200001
082100                                 TO AA-PARAGRAPH-NAME             08210001
082200             MOVE 'UNSUCCESSFUL FETCH FROM ALLOW_CSR'             08220001
082300                                 TO AA-DB2-OPERATION              08230001
082400             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                08240001
082500             MOVE SPACES         TO AA-DB2-TABLE-2                08250001
082600             PERFORM Z999-DB2-ABEND                               08260001
082700                                                                  08270001
082800     END-EVALUATE.                                                08280001
082900                                                                  08290001
083000                                                                  08300001
083100*----------------------------------------------------------------*08310001
083200*    FETCH THE CHARGE_CSR CURSOR                                  08320001
083300*----------------------------------------------------------------*08330001
083400 S150-FETCH-CHRG-CSR.                                             08340001
083500                                                                  08350001
083600     EXEC SQL                                                     08360001
083700          FETCH  CHARGE_CSR                                       08370001
083800           INTO :PV-ALW-CHRG-CDE                                  08380001
083900               ,:PV-GL-ACCT-NBR                                   08390001
084000               ,:PV-AUTO-OTP-PSTG-IND                             08400001
084100               ,:PV-SUM-ALW-CHRG-AMT                              08410001
084200     END-EXEC.                                                    08420001
084300                                                                  08430001
084400     EVALUATE TRUE                                                08440001
084500         WHEN SQLCODE = ZERO                                      08450001
084600             SET MORE-CHRG-CSR TO TRUE                            08460001
084700                                                                  08470001
084800         WHEN SQLCODE = +100                                      08480001
084900             SET END-OF-CHRG-CSR TO TRUE                          08490001
085000                                                                  08500001
085100         WHEN SQLWARN0 NOT = SPACES                               08510001
085200         WHEN SQLCODE  NOT = ZERO                                 08520001
085300             MOVE 'S150-FETCH-CHRG-CSR'                           08530001
085400                                 TO AA-PARAGRAPH-NAME             08540001
085500             MOVE 'UNSUCCESSFUL FETCH'                            08550001
085600                                 TO AA-DB2-OPERATION              08560001
085700             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                08570001
085800             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                08580001
085900             PERFORM Z999-DB2-ABEND                               08590001
086000                                                                  08600001
086100     END-EVALUATE.                                                08610001
086200                                                                  08620001
086300                                                                  08630001
086400*----------------------------------------------------------------*08640001
086500*    GET BATCH PROCESS DATE AND PAYMENT FLOAT DAY QUANTITY        08650001
086600*----------------------------------------------------------------*08660001
086700 S200-GET-CONTROL-INFO.                                           08670001
086800                                                                  08680001
086900     EXEC SQL                                                     08690001
087000         SELECT  BTCH_PRC_DTE                                     08700001
087100                ,PAYT_FLOAT_DAY_QTY                               08710001
087200           INTO  :APCNTL-BTCH-PRC-DTE                             08720001
087300                ,:APCNTL-PAYT-FLOAT-DAY-QTY                       08730001
087400           FROM  TAPCNTL                                          08740001
087500     END-EXEC.                                                    08750001
087600                                                                  08760001
087700     EVALUATE TRUE                                                08770001
087800         WHEN SQLCODE = ZERO                                      08780001
087900             CONTINUE                                             08790001
088000                                                                  08800001
088100         WHEN SQLWARN0 NOT = SPACES                               08810001
088200         WHEN SQLCODE NOT  = ZERO                                 08820001
088300             MOVE 'S200-GET-CONTROL-INFO'                         08830001
088400                                 TO AA-PARAGRAPH-NAME             08840001
088500             MOVE 'UNSUCCESSFUL SELECT'                           08850001
088600                                 TO AA-DB2-OPERATION              08860001
088700             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                08870001
088800             MOVE SPACES         TO AA-DB2-TABLE-2                08880001
088900             PERFORM Z999-DB2-ABEND                               08890001
089000                                                                  08900001
089100     END-EVALUATE.                                                08910001
089200                                                                  08920001
089300                                                                  08930001
089400*----------------------------------------------------------------*08940001
089500*    GET TRANCODE INFORMATION                                     08950001
089600*----------------------------------------------------------------*08960001
089700 S300-GET-TRNCDE-INFO.                                            08970001
089800                                                                  08980001
089900     EXEC SQL                                                     08990001
090000         SELECT  PSTG_TYP_CDE                                     09000001
090100                ,AP_PSTG_IND                                      09010001
090200           INTO  :TRNCDE-PSTG-TYP-CDE                             09020001
090300                ,:TRNCDE-AP-PSTG-IND                              09030001
090400           FROM  TTRNCDE                                          09040001
090500          WHERE  AP_TRN_CDE = '01'                                09050001
090600          AND CURRENT DATE  BETWEEN EFF_STRT_DTE AND              09060001
090700                                    EFF_END_DTE                   09070001
090800     END-EXEC.                                                    09080001
090900                                                                  09090001
091000     EVALUATE TRUE                                                09100001
091100         WHEN SQLCODE = ZERO                                      09110001
091200             CONTINUE                                             09120001
091300                                                                  09130001
091400         WHEN SQLWARN0 NOT = SPACES                               09140001
091500         WHEN SQLCODE NOT  = ZERO                                 09150001
091600             MOVE 'S300-GET-TRNCDE-INFO'                          09160001
091700                                 TO AA-PARAGRAPH-NAME             09170001
091800             MOVE 'UNSUCCESSFUL SELECT'                           09180001
091900                                 TO AA-DB2-OPERATION              09190001
092000             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-1                09200001
092100             MOVE SPACES         TO AA-DB2-TABLE-2                09210001
092200             PERFORM Z999-DB2-ABEND                               09220001
092300                                                                  09230001
092400     END-EVALUATE.                                                09240001
092500                                                                  09250001
092600                                                                  09260001
092700*----------------------------------------------------------------*09270001
092800*    GET ENTITY ID AND NAME DESCRIPTION FOR VENDOR LI & FUNG      09280001
092900*----------------------------------------------------------------*09290001
093000 S400-GET-ENTITY-INFO.                                            09300001
093100                                                                  09310001
093200     EXEC SQL                                                     09320001
093300         SELECT  A.ENT_ID                                         09330001
093400                ,B.ENT_NAME_DESC                                  09340001
093500           INTO  :EXTENT-ENT-ID                                   09350001
093600                ,:ENTNME-ENT-NAME-DESC                            09360001
093700           FROM  TEXTENT  A                                       09370001
093800                ,TENTNME  B                                       09380001
093900          WHERE  A.ENT_ID    =  B.ENT_ID                          09390001
094000            AND  A.DUN_NBR   =  :INVOIC-RMIT-VND-ID               09400001
094100            AND  B.TYPE_CDE  =  '01'                              09410001
094200     END-EXEC.                                                    09420001
094300                                                                  09430001
094400     EVALUATE TRUE                                                09440001
094500         WHEN SQLCODE = ZERO                                      09450001
094600             CONTINUE                                             09460001
094700                                                                  09470001
094800         WHEN SQLWARN0 NOT = SPACES                               09480001
094900         WHEN SQLCODE NOT  = ZERO                                 09490001
095000             MOVE 'S400-GET-ENTITY-INFO'                          09500001
095100                                 TO AA-PARAGRAPH-NAME             09510001
095200             MOVE 'UNSUCCESSFUL SELECT'                           09520001
095300                                 TO AA-DB2-OPERATION              09530001
095400             MOVE 'TEXTENT'      TO AA-DB2-TABLE-1                09540001
095500             MOVE 'TENTNME'      TO AA-DB2-TABLE-2                09550001
095600             PERFORM Z999-DB2-ABEND                               09560001
095700                                                                  09570001
095800     END-EVALUATE.                                                09580001
095900                                                                  09590001
096000                                                                  09600001
096100*----------------------------------------------------------------*09610001
096200*    GET PAYMENT FLOAT DAY QUANTITY FOR LI & FUNG                 09620001
096300*----------------------------------------------------------------*09630001
096400 S500-GET-FLOAT-DAY.                                              09640001
096500                                                                  09650001
096600     MOVE EXTENT-ENT-ID  TO  APVNDS-ENT-ID.                       09660001
096700                                                                  09670001
096800     EXEC SQL                                                     09680001
096900         SELECT  PAYT_FLOAT_DAY_QTY                               09690001
097000           INTO  :APVNDS-PAYT-FLOAT-DAY-QTY                       09700001
097100           FROM  TAPVNDS                                          09710001
097200          WHERE  ENT_ID  =  :APVNDS-ENT-ID                        09720001
097300     END-EXEC.                                                    09730001
097400                                                                  09740001
097500     EVALUATE TRUE                                                09750001
097600         WHEN SQLCODE = ZERO                                      09760001
097700             SET FLOAT-DAY-FOUND TO TRUE                          09770001
097800                                                                  09780001
097900         WHEN SQLCODE = +100                                      09790001
098000             SET FLOAT-DAY-NOT-FOUND TO TRUE                      09800001
098100                                                                  09810001
098200         WHEN SQLWARN0 NOT = SPACES                               09820001
098300         WHEN SQLCODE NOT  = ZERO                                 09830001
098400             MOVE 'S500-GET-FLOAT-DAY'                            09840001
098500                                 TO AA-PARAGRAPH-NAME             09850001
098600             MOVE 'UNSUCCESSFUL SELECT'                           09860001
098700                                 TO AA-DB2-OPERATION              09870001
098800             MOVE 'TAPVNDS'      TO AA-DB2-TABLE-1                09880001
098900             MOVE SPACES         TO AA-DB2-TABLE-2                09890001
099000             DISPLAY 'ENT ID: '  APVNDS-ENT-ID                    09900001
099100             PERFORM Z999-DB2-ABEND                               09910001
099200                                                                  09920001
099300     END-EVALUATE.                                                09930001
099400                                                                  09940001
099410     IF FLOAT-DAY-FOUND                                           09941001
099420        MOVE APVNDS-PAYT-FLOAT-DAY-QTY TO PV-FLOAT-DAY-QTY        09942001
099430     ELSE                                                         09943001
099440        MOVE APCNTL-PAYT-FLOAT-DAY-QTY TO PV-FLOAT-DAY-QTY        09944001
099450     END-IF.                                                      09945001
099460***  DISPLAY '** FLOAT DAY QUANTITY: ' PV-FLOAT-DAY-QTY.          09946001
099470                                                                  09947001
099500                                                                  09950001
099600*----------------------------------------------------------------*09960001
099700*    GET GL ACCOUNT NUMBER AND AUTO OTP POSTING INDICATOR         09970001
099810*----------------------------------------------------------------*09981001
099900 S600-GET-GL-ACCT-NBR.                                            09990001
100000                                                                  10000001
100100     EXEC SQL                                                     10010001
100200         SELECT  GL_ACCT_NBR                                      10020001
100300                ,AUTO_OTP_PSTG_IND                                10030001
100400           INTO  :ACCTYP-GL-ACCT-NBR                              10040001
100500                ,:ACCTYP-AUTO-OTP-PSTG-IND                        10050001
100600           FROM  TACCTYP                                          10060001
100700          WHERE  ALW_CHRG_CDE  =  :MDINVC-IMPRT-CHRG-PRC-CDE      10070001
100800            AND  EFF_STRT_DTE <=  :INVOIC-INVC-DTE                10080001
100900            AND  EFF_END_DTE  >=  :INVOIC-INVC-DTE                10090001
101000     END-EXEC.                                                    10100001
101100                                                                  10110001
101200     EVALUATE TRUE                                                10120001
101300         WHEN SQLCODE = ZERO                                      10130001
101400             CONTINUE                                             10140001
101500                                                                  10150001
101600         WHEN SQLWARN0 NOT = SPACES                               10160001
101700         WHEN SQLCODE NOT  = ZERO                                 10170001
101800             MOVE 'S600-GET-GL-ACCT-NBR'                          10180001
101900                                 TO AA-PARAGRAPH-NAME             10190001
102000             MOVE 'UNSUCCESSFUL SELECT'                           10200001
102100                                 TO AA-DB2-OPERATION              10210001
102200             MOVE 'TACCTYP'      TO AA-DB2-TABLE-1                10220001
102300             MOVE SPACES         TO AA-DB2-TABLE-2                10230001
102400             DISPLAY 'ALLW/CHR CODE: ' MDINVC-IMPRT-CHRG-PRC-CDE  10240001
102500             DISPLAY 'INVOICE DTE: ' INVOIC-INVC-DTE              10250001
102600             PERFORM Z999-DB2-ABEND                               10260001
102700                                                                  10270001
102800     END-EVALUATE.                                                10280001
102900                                                                  10290001
103000                                                                  10300001
103100*----------------------------------------------------------------*10310001
103200*    GET PAYMENT TERMS FOR PO BEING PROCESSED                     10320001
103300*----------------------------------------------------------------*10330001
103400 S700-GET-PO-PAY-TERMS.                                           10340001
103500                                                                  10350001
103600     MOVE INVOIC-PO-NBR  TO  POAGMT-PO-NBR.                       10360001
103700                                                                  10370001
103800     EXEC SQL                                                     10380001
103900         SELECT  PA.DISC_PAY_DAY_QTY                              10390001
104000                ,PT.DISCOUNT_PCT                                  10400001
104100                ,PT.DUE_DAY_QTY                                   10410001
104200                ,PT.DISCOUNT_DAYS_QTY                             10420001
104300                ,PT.DUE_DAY_FR_DTE_TXT                            10430001
104400           INTO  :POAGMT-DISC-PAY-DAY-QTY                         10440001
104500                ,:PAYTRM-DISCOUNT-PCT                             10450001
104600                ,:PAYTRM-DUE-DAY-QTY                              10460001
104700                ,:PAYTRM-DISCOUNT-DAYS-QTY                        10470001
104800                ,:PAYTRM-DUE-DAY-FR-DTE-TXT                       10480001
104900           FROM  TPOAGMT PA                                       10490001
105000                ,TPAYTRM PT                                       10500001
105100          WHERE  PA.PO_NBR         = :POAGMT-PO-NBR               10510001
105200            AND  PA.PAYT_TERM_ID   = PT.PAY_TERM_ID               10520001
105300            AND  PA.AGRMT_TYP_ID   = '2'                          10530001
105400            AND  PA.VER_STATUS_CDE = 'A'                          10540001
105500     END-EXEC.                                                    10550001
105600                                                                  10560001
105700     EVALUATE TRUE                                                10570001
105800         WHEN SQLCODE = ZERO                                      10580001
105900             CONTINUE                                             10590001
106000                                                                  10600001
106100         WHEN SQLWARN0 NOT = SPACES                               10610001
106200         WHEN SQLCODE NOT  = ZERO                                 10620001
106300             MOVE 'S700-GET-PO-PAY-TERMS'                         10630001
106400                                 TO AA-PARAGRAPH-NAME             10640001
106500             MOVE 'UNSUCCESSFUL SELECT'                           10650001
106600                                 TO AA-DB2-OPERATION              10660001
106700             MOVE 'TPOAGMT'      TO AA-DB2-TABLE-1                10670001
106800             MOVE 'TPAYTRM'      TO AA-DB2-TABLE-2                10680001
106900             DISPLAY 'PO NUMBER: ' POAGMT-PO-NBR                  10690001
107000             PERFORM Z999-DB2-ABEND                               10700001
107100                                                                  10710001
107200     END-EVALUATE.                                                10720001
107300                                                                  10730001
107400                                                                  10740001
107500*----------------------------------------------------------------*10750001
107600*    GET INVOICE PAYMENT TERMS, IF THEY EXIST                     10760001
107700*----------------------------------------------------------------*10770001
107800 S800-GET-INVC-PAY-TERMS.                                         10780001
107900                                                                  10790001
108000     MOVE INVOIC-PO-NBR   TO  INVCTM-PO-NBR.                      10800001
108100     MOVE INVOIC-INVC-ID  TO  INVCTM-INVC-ID.                     10810001
108200                                                                  10820001
108300     EXEC SQL                                                     10830001
108400         SELECT  DISC_PCT                                         10840001
108500                ,DISC_DUE_DAY_QTY                                 10850001
108600                ,EXTD_DAYS_QTY                                    10860001
108700                ,TERM_TYP_CDE                                     10870001
108800                ,NET_DUE_DAY_QTY                                  10880001
108900           INTO  :INVCTM-DISC-PCT                                 10890001
109000                ,:INVCTM-DISC-DUE-DAY-QTY                         10900001
109100                ,:INVCTM-EXTD-DAYS-QTY                            10910001
109200                ,:INVCTM-TERM-TYP-CDE                             10920001
109300                ,:INVCTM-NET-DUE-DAY-QTY                          10930001
109400           FROM  TINVCTM                                          10940001
109500          WHERE  PO_NBR        = :INVCTM-PO-NBR                   10950001
109600            AND  INVC_ID       = :INVCTM-INVC-ID                  10960001
109700            AND  TERM_SEQ_NBR  = 1                                10970001
109800     END-EXEC.                                                    10980001
109900                                                                  10990001
110000     EVALUATE TRUE                                                11000001
110100         WHEN SQLCODE = ZERO                                      11010001
110200             CONTINUE                                             11020001
110300                                                                  11030001
110400         WHEN SQLWARN0 NOT = SPACES                               11040001
110500         WHEN SQLCODE NOT  = ZERO                                 11050001
110600             MOVE 'S800-GET-INVC-PAY-TERMS'                       11060001
110700                                 TO AA-PARAGRAPH-NAME             11070001
110800             MOVE 'UNSUCCESSFUL SELECT'                           11080001
110900                                 TO AA-DB2-OPERATION              11090001
111000             MOVE 'TINVCTM'      TO AA-DB2-TABLE-1                11100001
111100             MOVE SPACES         TO AA-DB2-TABLE-2                11110001
111200             DISPLAY 'PO NUMBER: '  INVCTM-PO-NBR                 11120001
111300             DISPLAY 'INVOICE ID: ' INVCTM-INVC-ID                11130001
111400             PERFORM Z999-DB2-ABEND                               11140001
111500                                                                  11150001
111600     END-EVALUATE.                                                11160001
111700                                                                  11170001
111710*----------------------------------------------------------------*11171001
111720*    GET OVERSEAS RECEIPT DATE FROM IMPORT RECEIPT TABLE          11172001
111730*----------------------------------------------------------------*11173001
111740 S900-GET-OVERSEAS-RECEIPT-DATE.                                  11174001
111750                                                                  11175001
111760     MOVE INVOIC-PO-NBR   TO  IMRCPO-PO-NBR.                      11176001
111780                                                                  11178001
111790     EXEC SQL                                                     11179001
111791         SELECT  MIN(PO_RCVD_DELY_TMST)                           11179101
111796           INTO  :IMRCPO-PO-RCVD-DELY-TMST                        11179601
111801           FROM  TIMRCPO                                          11180101
111802          WHERE  PO_NBR        = :IMRCPO-PO-NBR                   11180201
111805     END-EXEC.                                                    11180501
111806                                                                  11180601
111807     EVALUATE TRUE                                                11180701
111808         WHEN SQLCODE = ZERO                                      11180801
111809             SET OVERSEAS-DATE-FOUND TO TRUE                      11180901
111810                                                                  11181001
111811         WHEN SQLCODE = +100 OR -305                              11181101
111812             SET OVERSEAS-DATE-NOT-FOUND TO TRUE                  11181201
111813                                                                  11181301
111814         WHEN SQLWARN0 NOT = SPACES                               11181401
111815         WHEN SQLCODE NOT  = ZERO                                 11181501
111816             MOVE 'S900-GET-OVERSEAS-RECEIPT-DATE'                11181601
111817                                 TO AA-PARAGRAPH-NAME             11181701
111818             MOVE 'UNSUCCESSFUL SELECT'                           11181801
111819                                 TO AA-DB2-OPERATION              11181901
111820             MOVE 'TIMRCPO'      TO AA-DB2-TABLE-1                11182001
111821             MOVE SPACES         TO AA-DB2-TABLE-2                11182101
111822             DISPLAY 'PO NUMBER: '  IMRCPO-PO-NBR                 11182201
111823             PERFORM Z999-DB2-ABEND                               11182301
111824                                                                  11182401
111825     END-EVALUATE.                                                11182501
111826                                                                  11182601
111830                                                                  11183001
111900*----------------------------------------------------------------*11190001
112000*    WRITE RECORD TO AP TRANSACTION OUT FILE                      11200001
112100*----------------------------------------------------------------*11210001
112200 W100-WRITE-AP-TRANS.                                             11220001
112300                                                                  11230001
112400     WRITE AP-TRANS-REC  FROM  AP040-TRANSACTION-FILE.            11240001
112500                                                                  11250001
112600     ADD +1 TO PV-AP-TRANS-COUNT.                                 11260001
112700                                                                  11270001
112800                                                                  11280001
112900*----------------------------------------------------------------*11290001
113000*    WRITE RECORD TO INVOICE STATUS UPDATE FILE                   11300001
113100*----------------------------------------------------------------*11310001
113200 W200-WRITE-INVC-UPD.                                             11320001
113300                                                                  11330001
113400     WRITE INVC-STATUS-UPD-REC  FROM  AP252-RECORD.               11340001
113500                                                                  11350001
113600     ADD +1 TO PV-INVC-UPD-COUNT.                                 11360001
113700                                                                  11370001
113800                                                                  11380001
113900*----------------------------------------------------------------*11390001
114000*    OPEN INVOICE_CSR CURSOR                                      11400001
114100*----------------------------------------------------------------*11410001
114200 X100-OPEN-INVC-CSR.                                              11420001
114300                                                                  11430001
114400     EXEC SQL                                                     11440001
114500         OPEN INVOICE_CSR                                         11450001
114600     END-EXEC.                                                    11460001
114700                                                                  11470001
114800     EVALUATE TRUE                                                11480001
114900         WHEN SQLCODE = ZERO                                      11490001
115000             SET INVC-CSR-OPEN TO TRUE                            11500001
115100                                                                  11510001
115200         WHEN SQLWARN0 NOT = SPACES                               11520001
115300         WHEN SQLCODE  NOT = ZERO                                 11530001
115400             MOVE 'X100-OPEN-INVC-CSR'                            11540001
115500                                 TO AA-PARAGRAPH-NAME             11550001
115600             MOVE 'UNSUCCESSFUL OPEN ON INVOICE_CSR'              11560001
115700                                 TO AA-DB2-OPERATION              11570001
115800             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                11580001
115900             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                11590001
116000             PERFORM Z999-DB2-ABEND                               11600001
116100                                                                  11610001
116200     END-EVALUATE.                                                11620001
116300                                                                  11630001
116400                                                                  11640001
116500*----------------------------------------------------------------*11650001
116600*    OPEN ALLOW_CSR CURSOR                                        11660001
116700*----------------------------------------------------------------*11670001
116800 X200-OPEN-ALLOW-CSR.                                             11680001
116900                                                                  11690001
117000     EXEC SQL                                                     11700001
117100         OPEN ALLOW_CSR                                           11710001
117200     END-EXEC.                                                    11720001
117300                                                                  11730001
117400     EVALUATE TRUE                                                11740001
117500         WHEN SQLCODE = ZERO                                      11750001
117600             SET ALLOW-CSR-OPEN TO TRUE                           11760001
117700                                                                  11770001
117800         WHEN SQLWARN0 NOT = SPACES                               11780001
117900         WHEN SQLCODE  NOT = ZERO                                 11790001
118000             MOVE 'X200-OPEN-ALLOW-CSR'                           11800001
118100                                 TO AA-PARAGRAPH-NAME             11810001
118200             MOVE 'UNSUCCESSFUL OPEN ON ALLOW_CSR'                11820001
118300                                 TO AA-DB2-OPERATION              11830001
118400             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                11840001
118500             MOVE SPACES         TO AA-DB2-TABLE-2                11850001
118600             PERFORM Z999-DB2-ABEND                               11860001
118700                                                                  11870001
118800     END-EVALUATE.                                                11880001
118900                                                                  11890001
119000                                                                  11900001
119100*----------------------------------------------------------------*11910001
119200*    OPEN CHARGE_CSR CURSOR                                       11920001
119300*----------------------------------------------------------------*11930001
119400 X300-OPEN-CHRG-CSR.                                              11940001
119500                                                                  11950001
119600     EXEC SQL                                                     11960001
119700         OPEN CHARGE_CSR                                          11970001
119800     END-EXEC.                                                    11980001
119900                                                                  11990001
120000     EVALUATE TRUE                                                12000001
120100         WHEN SQLCODE = ZERO                                      12010001
120200             SET CHRG-CSR-OPEN TO TRUE                            12020001
120300                                                                  12030001
120400         WHEN SQLWARN0 NOT = SPACES                               12040001
120500         WHEN SQLCODE  NOT = ZERO                                 12050001
120600             MOVE 'X300-OPEN-CHRG-CSR'                            12060001
120700                                 TO AA-PARAGRAPH-NAME             12070001
120800             MOVE 'UNSUCCESSFUL OPEN ON CHARGE_CSR'               12080001
120900                                 TO AA-DB2-OPERATION              12090001
121000             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                12100001
121100             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                12110001
121200             PERFORM Z999-DB2-ABEND                               12120001
121300                                                                  12130001
121400     END-EVALUATE.                                                12140001
121500                                                                  12150001
121600                                                                  12160001
121700*----------------------------------------------------------------*12170001
121800*    CLOSE THE INVOICE_CSR CURSOR                                 12180001
121900*----------------------------------------------------------------*12190001
122000 Y100-CLOSE-INVC-CSR.                                             12200001
122100                                                                  12210001
122200     EXEC SQL                                                     12220001
122300         CLOSE INVOICE_CSR                                        12230001
122400     END-EXEC.                                                    12240001
122500                                                                  12250001
122600     EVALUATE TRUE                                                12260001
122700         WHEN SQLCODE = ZERO                                      12270001
122800             SET INVC-CSR-CLOSED TO TRUE                          12280001
122900                                                                  12290001
123000         WHEN SQLWARN0 NOT = SPACES                               12300001
123100         WHEN SQLCODE  NOT = ZERO                                 12310001
123200             MOVE 'Y100-CLOSE-INVC-CSR'                           12320001
123300                                 TO AA-PARAGRAPH-NAME             12330001
123400             MOVE 'UNSUCCESSFUL CLOSE ON INVOICE_CSR'             12340001
123500                                 TO AA-DB2-OPERATION              12350001
123600             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                12360001
123700             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                12370001
123800             PERFORM Z999-DB2-ABEND                               12380001
123900                                                                  12390001
124000       END-EVALUATE.                                              12400001
124100                                                                  12410001
124200                                                                  12420001
124300*----------------------------------------------------------------*12430001
124400*    CLOSE THE ALLOW_CSR CURSOR                                   12440001
124500*----------------------------------------------------------------*12450001
124600 Y200-CLOSE-ALLOW-CSR.                                            12460001
124700                                                                  12470001
124800     EXEC SQL                                                     12480001
124900         CLOSE ALLOW_CSR                                          12490001
125000     END-EXEC.                                                    12500001
125100                                                                  12510001
125200     EVALUATE TRUE                                                12520001
125300         WHEN SQLCODE = ZERO                                      12530001
125400             SET ALLOW-CSR-CLOSED TO TRUE                         12540001
125500                                                                  12550001
125600         WHEN SQLWARN0 NOT = SPACES                               12560001
125700         WHEN SQLCODE  NOT = ZERO                                 12570001
125800             MOVE 'Y200-CLOSE-ALLOW-CSR'                          12580001
125900                                 TO AA-PARAGRAPH-NAME             12590001
126000             MOVE 'UNSUCCESSFUL CLOSE ON ALLOW_CSR'               12600001
126100                                 TO AA-DB2-OPERATION              12610001
126200             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                12620001
126300             MOVE SPACES         TO AA-DB2-TABLE-2                12630001
126400             PERFORM Z999-DB2-ABEND                               12640001
126500                                                                  12650001
126600       END-EVALUATE.                                              12660001
126700                                                                  12670001
126800                                                                  12680001
126900*----------------------------------------------------------------*12690001
127000*    CLOSE THE CHARGE_CSR CURSOR                                  12700001
127100*----------------------------------------------------------------*12710001
127200 Y300-CLOSE-CHRG-CSR.                                             12720001
127300                                                                  12730001
127400     EXEC SQL                                                     12740001
127500         CLOSE CHARGE_CSR                                         12750001
127600     END-EXEC.                                                    12760001
127700                                                                  12770001
127800     EVALUATE TRUE                                                12780001
127900         WHEN SQLCODE = ZERO                                      12790001
128000             SET CHRG-CSR-CLOSED TO TRUE                          12800001
128100                                                                  12810001
128200         WHEN SQLWARN0 NOT = SPACES                               12820001
128300         WHEN SQLCODE  NOT = ZERO                                 12830001
128400             MOVE 'Y300-CLOSE-CHRG-CSR'                           12840001
128500                                 TO AA-PARAGRAPH-NAME             12850001
128600             MOVE 'UNSUCCESSFUL CLOSE ON CHARGE_CSR'              12860001
128700                                 TO AA-DB2-OPERATION              12870001
128800             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                12880001
128900             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                12890001
129000             PERFORM Z999-DB2-ABEND                               12900001
129100                                                                  12910001
129200       END-EVALUATE.                                              12920001
129300                                                                  12930001
129400                                                                  12940001
129500*----------------------------------------------------------------*12950001
129600*    DB2 ABEND ROUTINE                                            12960001
129700*----------------------------------------------------------------*12970001
129800 Z999-DB2-ABEND.                                                  12980001
129900                                                                  12990001
130000     CLOSE AP-TRANS-FILE                                          13000001
130100           INVC-STATUS-UPD-FILE.                                  13010001
130200                                                                  13020001
130300     DISPLAY AA-ABEND-LIT.                                        13030001
130400     DISPLAY AA-MESSAGE-LINE-1.                                   13040001
130500     DISPLAY AA-MESSAGE-LINE-2.                                   13050001
130600     DISPLAY AA-DB2-ERROR-LIT.                                    13060001
130700     DISPLAY AA-PROGRAM-LIT.                                      13070001
130800     DISPLAY AA-PARAGRAPH-LIT.                                    13080001
130900     DISPLAY AA-DB2-OPERATION-LIT.                                13090001
131000     DISPLAY AA-DB2-TABLE-1.                                      13100001
131100     DISPLAY AA-DB2-TABLE-2.                                      13110001
131200     SET AC-DB2-ERROR TO TRUE.                                    13120001
131300                                                                  13130001
131400     COPY DPPD004.                                                13140001
131500                                                                  13150001
131600     CALL 'ILBOABN0' USING ABEND-CODE.                            13160001
131700                                                                  13170001
