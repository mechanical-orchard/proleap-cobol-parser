000100***************************************************************** 00010072
000200 IDENTIFICATION DIVISION.                                         00020072
000300***************************************************************** 00030072
000400 PROGRAM-ID.    RCKUT149.                                         00040072
000500 AUTHOR.        TKMA479.                                          00050072
000600 INSTALLATION.  KOHLS.                                            00060072
000700 DATE-WRITTEN.  SEPTEMBER 2012.                                   00070072
000800 DATE-COMPILED.                                                   00080072
000900***************************************************************** 00090072
001000*  GENERATE AN EXTRACT WHICH RECAPS THE PO-S ASSIGNED TO THE      00100073
001100*  DAY AFTER THANKSGIVING FLOWBACK SET.                           00110073
001200*                                                                 00120073
001300*  THIS PROGRAM WILL TAKE INPUT FROM RCKUT148 AND ADD TO IT       00130073
001400*  CREATING A RCRD092 FILE.  THE OUTPUT WILL BE INPUT INTO        00140073
001500*  SORT STEPS FOR REPORTING PROGRAMS IN THE CURRENT JOB.          00150073
001600*                                                                 00160073
001700*  FOR EACH ROW READ(RCRD091) DO THE FOLLOWING;                   00170073
001800*  - DETERMINE THE PO ALLOCATION QUANTITY FOR THE PO              00180072
001900*  - DETERMINE THE RECEIVER ALLOCATION QUANTITY FOR THE PO        00190072
002000*  - DETERMINE THE RECEIVER VERIFIED QUANTITY                     00200072
002100*  - CALCULATE THE PO ALLOCATION DIFFERENCE                       00210072
002200*  - CALCULATE THE RECEIVER ALLOCATION DIFFERENCE                 00220072
002300*  - GET DMM AND BUYER NAMES AND FORMAT                           00230072
002400*  - WRITE A A RECORD TO AN OUTPUT FILE USING THE RCRD092         00240072
002500*    COPYBOOK                                                     00250072
002600***************************************************************** 00260072
002700 ENVIRONMENT DIVISION.                                            00270072
002800                                                                  00280072
002900 INPUT-OUTPUT SECTION.                                            00290072
003000                                                                  00300072
003100 FILE-CONTROL.                                                    00310072
003200                                                                  00320072
003300     SELECT INPUT-FILE-1   ASSIGN TO UT-S-INP01.                  00330072
003400     SELECT OUTPUT-FILE-1  ASSIGN TO UT-S-OUT01.                  00340072
003500                                                                  00350072
003600 DATA DIVISION.                                                   00360072
003700 FILE SECTION.                                                    00370072
003800                                                                  00380072
003900 FD  INPUT-FILE-1                                                 00390072
004000     RECORDING MODE IS F                                          00400072
004100     LABEL RECORDS ARE STANDARD                                   00410072
004200     RECORD CONTAINS 60                                           00420072
004300     BLOCK CONTAINS 0 RECORDS                                     00430072
004400     DATA RECORD IS INPUT-RECORD-1.                               00440072
004500                                                                  00450072
004600 01  INPUT-RECORD-1             PIC X(60).                        00460072
004700                                                                  00470072
004800 FD  OUTPUT-FILE-1                                                00480072
004900     RECORDING MODE IS F                                          00490072
005000     LABEL RECORDS ARE STANDARD                                   00500072
005100     RECORD CONTAINS 110                                          00510072
005200     BLOCK CONTAINS 0 RECORDS                                     00520072
005300     DATA RECORD IS INPUT-RECORD-1.                               00530072
005400                                                                  00540072
005500 01  OUTPUT-RECORD-1             PIC X(110).                      00550072
005600                                                                  00560072
005700***************************************************************** 00570072
005800 WORKING-STORAGE SECTION.                                         00580072
005900                                                                  00590072
006000 01  PS-PROGRAM-SWITCHES.                                         00600072
006100     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00610072
006200         88  PS-EOF-INPUT                        VALUE 'Y'.       00620072
006300         88  PS-NOT-EOF-INPUT                    VALUE 'N'.       00630072
006400                                                                  00640072
006500 01  PV-PROGRAM-VARIABLES.                                        00650072
006600     05  PV-SQLCODE                   PIC 9999-.                  00660072
006700     05  PV-TOT-READ-COUNT            PIC 9(7) VALUE 0.           00670072
006800     05  PV-TOT-WRITE-COUNT           PIC 9(7) VALUE 0.           00680072
006900     05  PV-PO-ALLOC-QTY              PIC S9(9) COMP VALUE 0.     00690072
007000*CHG101787 - START                                                00700076
007100     05  PV-CURR-SPLIT-QTY            PIC S9(9) COMP VALUE 0.     00710072
007200*CHG101787 - END                                                  00720076
007300     05  PV-RECEIVER-ALLOC-QTY        PIC S9(9) COMP VALUE 0.     00730072
007400     05  PV-RECEIVER-VRFYD-QTY        PIC S9(9) COMP VALUE 0.     00740072
007500     05  PV-DATE                      PIC X(10)  VALUE SPACES.    00750072
007600     05  PV-TMST                      PIC X(26)  VALUE SPACES.    00760072
007700     05  PV-DEPT-NBR-N                PIC 9(4)   VALUE 0.         00770072
007800     05  PV-DEPT-NBR-X REDEFINES PV-DEPT-NBR-N                    00780072
007900                                      PIC X(4).                   00790072
008000     05 PV-FIRST-NAME.                                            00800072
008100        10 PV-FIRST-NAME-BYTE  OCCURS 12 TIMES INDEXED BY INX1    00810072
008200                                      PIC X(01).                  00820072
008300     05 PV-LAST-NAME.                                             00830072
008400        10 PV-LAST-NAME-BYTE   OCCURS 18 TIMES INDEXED BY INX2    00840072
008500                                      PIC X(01).                  00850072
008600     05 PV-NAME.                                                  00860072
008700        10 PV-NAME-BYTE        OCCURS 30 TIMES INDEXED BY INX3    00870072
008800                                      PIC X(01).                  00880072
008900                                                                  00890072
009000 01 PC-PROGRAM-CONSTANTS.                                         00900072
009100     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'RCKUT149'.00910072
009200     05  PC-MAX-RETRIES               PIC S9(03) VALUE +5 COMP-3. 00920072
009300     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            00930072
009400                                     '9999-09-09-09.09.09.999999'.00940072
009500 01  PV-ABEND-FIELDS.                                             00950072
009600     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         00960072
009700                                                 COMP SYNC.       00970072
009800     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT149'.00980072
009900     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00990072
010000     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01000072
010100     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01010072
010200     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01020072
010300     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01030072
010400     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01040072
010500                                                                  01050072
010600***********************************************************       01060072
010700*  DB2 SQL COMMUNICATION AREA                                     01070072
010800***********************************************************       01080072
010900     EXEC SQL                                                     01090072
011000         INCLUDE SQLCA                                            01100072
011100     END-EXEC.                                                    01110072
011200                                                                  01120072
011300***********************************************************       01130072
011400*  TMESTDS TABLE                                                  01140072
011500***********************************************************       01150072
011600     EXEC SQL                                                     01160072
011700         INCLUDE TMESTDS                                          01170072
011800     END-EXEC.                                                    01180072
011900                                                                  01190072
012000***********************************************************       01200072
012100*  TRECDIS TABLE                                                  01210072
012200***********************************************************       01220072
012300     EXEC SQL                                                     01230072
012400         INCLUDE TRECDIS                                          01240072
012500     END-EXEC.                                                    01250072
012600                                                                  01260072
012700***********************************************************       01270072
012800*  TRSPBAR                                                        01280072
012900***********************************************************       01290072
013000     EXEC SQL                                                     01300072
013100         INCLUDE TRSPBAR                                          01310072
013200     END-EXEC.                                                    01320072
013300                                                                  01330072
013400***********************************************************       01340072
013500*  TMDSEAR                                                        01350072
013600***********************************************************       01360072
013700     EXEC SQL                                                     01370072
013800         INCLUDE TMDSEAR                                          01380072
013900     END-EXEC.                                                    01390072
014000                                                                  01400072
014100***********************************************************       01410072
014200*  TRECEIV TABLE                                                  01420072
014300***********************************************************       01430072
014400     EXEC SQL                                                     01440072
014500         INCLUDE TRECEIV                                          01450072
014600     END-EXEC.                                                    01460072
014700                                                                  01470072
014800*CHG101787 - START                                                01480076
014900***********************************************************       01490072
015000*  TALLPLN TABLE                                                  01500072
015100***********************************************************       01510072
015200     EXEC SQL                                                     01520072
015300         INCLUDE TALLPLN                                          01530072
015400     END-EXEC.                                                    01540072
015500*CHG101787 - END                                                  01550076
015600                                                                  01560072
015700***********************************************************       01570072
015800*  INPUT FILE COPYBOOK                                            01580072
015900***********************************************************       01590072
016000     COPY RCRD091.                                                01600072
016100                                                                  01610072
016200***********************************************************       01620072
016300*  OUTPUT FILE COPYBOOK                                           01630072
016400***********************************************************       01640072
016500     COPY RCRD092.                                                01650072
016600                                                                  01660072
016700***********************************************************       01670072
016800*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       01680072
016900***********************************************************       01690072
017000     COPY DPWS004.                                                01700072
017100                                                                  01710072
017200 PROCEDURE DIVISION.                                              01720072
017300                                                                  01730072
017400     DISPLAY '*** START OF RCKUT149 ***'.                         01740072
017500                                                                  01750072
017600     PERFORM 0100-INITIAL.                                        01760072
017700     PERFORM 2000-PROCESS-INPUT-FILE                              01770072
017800        UNTIL PS-EOF-INPUT.                                       01780072
017900     PERFORM 9000-END-OF-PROGRAM.                                 01790072
018000                                                                  01800072
018100     GOBACK.                                                      01810072
018200                                                                  01820072
018300******************************************************************01830072
018400 0100-INITIAL.                                                    01840072
018500******************************************************************01850072
018600                                                                  01860072
018700     MOVE '0100-INITIAL               ' TO PV-ABEND-PARAGRAPH.    01870072
018800                                                                  01880072
018900     OPEN INPUT  INPUT-FILE-1                                     01890072
019000          OUTPUT OUTPUT-FILE-1.                                   01900072
019100                                                                  01910072
019200     PERFORM 7000-GET-TIMESTAMP.                                  01920072
019300                                                                  01930072
019400******************************************************************01940072
019500* READ INPUT FILE                                                 01950072
019600******************************************************************01960072
019700 2000-PROCESS-INPUT-FILE.                                         01970072
019800                                                                  01980072
019900     MOVE '2000-READ-INPUT-FILE       ' TO PV-ABEND-PARAGRAPH.    01990072
020000                                                                  02000072
020100     READ INPUT-FILE-1                                            02010072
020200        INTO RCRD091-SEASET-PO-EXTRACT                            02020072
020300        AT END SET PS-EOF-INPUT TO TRUE.                          02030072
020400                                                                  02040072
020500     IF PS-NOT-EOF-INPUT                                          02050072
020600        ADD 1 TO PV-TOT-READ-COUNT                                02060072
020700        PERFORM 4000-OUTPUT                                       02070072
020800     END-IF.                                                      02080072
020900                                                                  02090072
021000******************************************************************02100072
021100 3000-PO-ALLOC-QTY.                                               02110072
021200******************************************************************02120072
021300                                                                  02130072
021400     MOVE '3000-PO-ALLOC-QTY          ' TO PV-ABEND-PARAGRAPH.    02140072
021500                                                                  02150072
021600     EXEC SQL                                                     02160072
021700        SELECT  SUM(STR_DISTRO_QTY)                               02170072
021800           INTO :PV-PO-ALLOC-QTY                                  02180072
021900           FROM  TMESTDS                                          02190072
022000           WHERE  PO_NBR  = :RC091-PO-NUMBER                      02200072
022100           GROUP BY  PO_NBR                                       02210072
022200           WITH UR                                                02220072
022300     END-EXEC.                                                    02230072
022400                                                                  02240072
022500     EVALUATE TRUE                                                02250072
022600        WHEN SQLCODE = 0                                          02260072
022700           MOVE PV-PO-ALLOC-QTY  TO RC092-PO-ALLOC-QTY            02270072
022800        WHEN SQLCODE = +100                                       02280072
022900           MOVE 0  TO RC092-PO-ALLOC-QTY                          02290072
023000        WHEN OTHER                                                02300072
023100           DISPLAY '***************'                              02310072
023200           DISPLAY '* PO NBR => ' RC091-PO-NUMBER                 02320072
023300           DISPLAY '***************'                              02330072
023400           MOVE '3000-PO-ALLOC-QTY  '                             02340072
023500                                 TO PV-ABEND-PARAGRAPH            02350072
023600           MOVE 'SELECT TMESTDS' TO PV-ABEND-OPERATION            02360072
023700           MOVE ' '              TO PV-ABEND-STRUCTURE-1          02370072
023800           MOVE 'SELECT     '    TO PV-DB2-OPERATION-MESSAGE-1    02380072
023900           PERFORM 9900-DB2-ABEND                                 02390072
024000     END-EVALUATE.                                                02400072
024100                                                                  02410072
024200******************************************************************02420072
024300 3100-RECVR-ALLOC-QTY.                                            02430072
024400******************************************************************02440072
024500                                                                  02450072
024600     MOVE '3100-RECVR-ALLOC-QTY          ' TO PV-ABEND-PARAGRAPH. 02460072
024700                                                                  02470072
024800     EXEC SQL                                                     02480072
024900        SELECT  SUM(A.EXPTED_ITM_QTY)                             02490072
025000           INTO :PV-RECEIVER-ALLOC-QTY                            02500072
025100           FROM  TRECDIS A                                        02510072
025200           WHERE  A.ORD_NBR = :RC091-PO-NUMBER                    02520072
025300           GROUP BY A.ORD_NBR                                     02530072
025400           WITH UR                                                02540072
025500     END-EXEC.                                                    02550072
025600                                                                  02560072
025700     EVALUATE TRUE                                                02570072
025800        WHEN SQLCODE = 0                                          02580072
025900           MOVE PV-RECEIVER-ALLOC-QTY TO RC092-RCVR-ALLOC-QTY     02590072
026000        WHEN SQLCODE = +100                                       02600072
026100           MOVE 0 TO RC092-RCVR-ALLOC-QTY                         02610072
026200        WHEN OTHER                                                02620072
026300           DISPLAY '***************'                              02630072
026400           DISPLAY '* PO NBR => ' RC091-PO-NUMBER                 02640072
026500           DISPLAY '***************'                              02650072
026600           MOVE '3100-RECVR-ALLOC-QTY'                            02660072
026700                                 TO PV-ABEND-PARAGRAPH            02670072
026800           MOVE 'SELECT TRECDIS' TO PV-ABEND-OPERATION            02680072
026900           MOVE ' '              TO PV-ABEND-STRUCTURE-1          02690072
027000           MOVE 'SELECT     '    TO PV-DB2-OPERATION-MESSAGE-1    02700072
027100           PERFORM 9900-DB2-ABEND                                 02710072
027200     END-EVALUATE.                                                02720072
027300                                                                  02730072
027400******************************************************************02740072
027500 3200-RECVR-VERIFIED-QTY.                                         02750072
027600******************************************************************02760072
027700                                                                  02770072
027800     MOVE '3200-RECVR-VERIFIED-QTY       ' TO PV-ABEND-PARAGRAPH. 02780072
027900                                                                  02790072
028000     EXEC SQL                                                     02800072
028100        SELECT  SUM(B.AP_VERIFY_ITM_QTY)                          02810072
028200           INTO :PV-RECEIVER-VRFYD-QTY                            02820072
028300           FROM  TRECEIV A                                        02830072
028400                ,TRECDIS B                                        02840072
028500           WHERE A.ORD_NBR      = :RC091-PO-NUMBER                02850072
028600             AND A.STATUS_CDE   = 'VE'                            02860072
028700             AND A.ORD_NBR      = B.ORD_NBR                       02870072
028800             AND A.REC_SEQ_NBR  = B.REC_SEQ_NBR                   02880072
028900           GROUP BY A.ORD_NBR                                     02890072
029000           WITH UR                                                02900072
029100     END-EXEC.                                                    02910072
029200                                                                  02920072
029300     EVALUATE TRUE                                                02930072
029400        WHEN SQLCODE = 0                                          02940072
029500           MOVE PV-RECEIVER-VRFYD-QTY TO RC092-RCVR-VERFYD-QTY    02950072
029600        WHEN SQLCODE = +100                                       02960072
029700           MOVE 0 TO RC092-RCVR-VERFYD-QTY                        02970072
029800        WHEN OTHER                                                02980072
029900           DISPLAY '***************'                              02990072
030000           DISPLAY '* PO NBR => ' RC091-PO-NUMBER                 03000072
030100           DISPLAY '***************'                              03010072
030200           MOVE '3200-RECVR-VERIFIED-QTY'                         03020072
030300                                 TO PV-ABEND-PARAGRAPH            03030072
030400           MOVE 'SELECT TRECEIV/TRECDIS'                          03040072
030500                                 TO PV-ABEND-OPERATION            03050072
030600           MOVE ' '              TO PV-ABEND-STRUCTURE-1          03060072
030700           MOVE 'SELECT     '    TO PV-DB2-OPERATION-MESSAGE-1    03070072
030800           PERFORM 9900-DB2-ABEND                                 03080072
030900     END-EVALUATE.                                                03090072
031000                                                                  03100072
031100*CHG101787 - START                                                03110076
031200******************************************************************03120072
031300 3300-PO-SPLIT-QTY.                                               03130072
031400******************************************************************03140072
031500                                                                  03150072
031600     MOVE '3300-PO-SPLIT-QTY             ' TO PV-ABEND-PARAGRAPH. 03160072
031700                                                                  03170072
031800     EXEC SQL                                                     03180072
031900        SELECT  SUM(CURR_SPLIT_QTY)                               03190072
032000           INTO :PV-CURR-SPLIT-QTY                                03200072
032100           FROM  TALLPLN                                          03210072
032200           WHERE  PO_NBR  = :RC091-PO-NUMBER                      03220072
032300           GROUP BY  PO_NBR                                       03230072
032400           WITH UR                                                03240072
032500     END-EXEC.                                                    03250072
032600                                                                  03260072
032700     EVALUATE TRUE                                                03270072
032800        WHEN SQLCODE = 0                                          03280072
032900           MOVE PV-CURR-SPLIT-QTY TO RC092-PO-SPLIT-QTY           03290072
033000        WHEN SQLCODE = +100                                       03300072
033100           MOVE 0  TO RC092-PO-SPLIT-QTY                          03310072
033200        WHEN OTHER                                                03320072
033300           DISPLAY '***************'                              03330072
033400           DISPLAY '* PO NBR => ' RC091-PO-NUMBER                 03340072
033500           DISPLAY '***************'                              03350072
033600           MOVE '3300-PO-SPLIT-QTY  '                             03360072
033700                                 TO PV-ABEND-PARAGRAPH            03370072
033800           MOVE 'SELECT TALLPLN' TO PV-ABEND-OPERATION            03380072
033900           MOVE ' '              TO PV-ABEND-STRUCTURE-1          03390072
034000           MOVE 'SELECT     '    TO PV-DB2-OPERATION-MESSAGE-1    03400072
034100           PERFORM 9900-DB2-ABEND                                 03410072
034200     END-EVALUATE.                                                03420072
034300*CHG101787 - END                                                  03430076
034400                                                                  03440072
034500******************************************************************03450072
034600 4000-OUTPUT.                                                     03460072
034700******************************************************************03470072
034800                                                                  03480072
034900     MOVE '4000-OUTPUT                ' TO PV-ABEND-PARAGRAPH.    03490072
035000                                                                  03500072
035100     INITIALIZE RCRD092-SEASET-PO-EXTRACT.                        03510072
035200                                                                  03520072
035300     MOVE RC091-PO-NUMBER        TO RC092-PO-NUMBER.              03530072
035400     MOVE RC091-DEPT-NBR         TO RC092-DEPT-NBR.               03540072
035500     MOVE RC091-TOT-UNT-QTY      TO RC092-TOT-UNT-QTY.            03550072
035600     MOVE RC091-TOT-VAL-COST-AMT TO RC092-TOT-VAL-COST-AMT.       03560072
035700     MOVE RC091-TOT-VAL-RTL-AMT  TO RC092-TOT-VAL-RTL-AMT.        03570072
035800     MOVE RC091-TOT-SKUS-QTY     TO RC092-TOT-SKUS-QTY.           03580072
035900     MOVE RC091-STATUS-CDE       TO RC092-STATUS-CDE.             03590072
036000     MOVE RC091-PKGNG-CDE        TO RC092-PKGNG-CDE.              03600072
036100     MOVE RC091-SEASET-YR        TO RC092-SEASET-YR.              03610072
036200     MOVE RC091-SEASET-SHRT-NM   TO RC092-SEASET-SHRT-NM.         03620072
036300                                                                  03630072
036400     PERFORM 3000-PO-ALLOC-QTY.                                   03640072
036500     PERFORM 3100-RECVR-ALLOC-QTY.                                03650072
036600     PERFORM 3200-RECVR-VERIFIED-QTY.                             03660072
036700*CHG101787 - START                                                03670076
036800     PERFORM 3300-PO-SPLIT-QTY.                                   03680072
036900                                                                  03690072
037000     COMPUTE RC092-PO-SPLIT-DIFF =                                03700072
037100         RC092-PO-SPLIT-QTY - RC092-TOT-UNT-QTY                   03710074
037200     END-COMPUTE.                                                 03720072
037300*CHG101787 - END                                                  03730076
037400                                                                  03740072
037500     COMPUTE RC092-PO-ALLOC-DIFF =                                03750072
037600         RC092-PO-ALLOC-QTY - RC092-TOT-UNT-QTY                   03760072
037700     END-COMPUTE.                                                 03770072
037800                                                                  03780072
037900     COMPUTE RC092-RCVR-ALLOC-DIFF =                              03790072
038000        RC092-RCVR-ALLOC-QTY - RC092-PO-ALLOC-QTY                 03800072
038100     END-COMPUTE.                                                 03810072
038200                                                                  03820072
038300     MOVE RC092-DEPT-NBR TO PV-DEPT-NBR-N.                        03830072
038400     MOVE PV-DEPT-NBR-X(2:3) TO MDSEAR-DEPT-NBR.                  03840072
038500     PERFORM 5000-GET-DPT-INFO.                                   03850072
038600     PERFORM 5200-GET-BYR-NAME.                                   03860072
038700                                                                  03870072
038800     WRITE  OUTPUT-RECORD-1 FROM RCRD092-SEASET-PO-EXTRACT.       03880072
038900                                                                  03890072
039000     ADD 1 TO PV-TOT-WRITE-COUNT.                                 03900072
039100                                                                  03910072
039200 5000-GET-DPT-INFO.                                               03920072
039300                                                                  03930072
039400     MOVE '5000-GET-DPT-INFO          ' TO PV-ABEND-PARAGRAPH.    03940072
039500                                                                  03950072
039600     EXEC SQL                                                     03960072
039700        SELECT DMA_NBR                                            03970072
039800           INTO :MDSEAR-DMA-NBR                                   03980072
039900           FROM TMDSEAR                                           03990072
040000           WHERE   DEPT_NBR    = :MDSEAR-DEPT-NBR AND             04000072
040100                   OPERCO_NBR  = '03' AND                         04010072
040200                   MDSELV_CDE  = 'DPT' AND                        04020072
040300                   (STRT_DTE   < :PV-DATE OR                      04030072
040400                    STRT_DTE   = :PV-DATE) AND                    04040072
040500                   END_DTE    > :PV-DATE                          04050072
040600     END-EXEC.                                                    04060072
040700                                                                  04070072
040800     EVALUATE TRUE                                                04080072
040900        WHEN SQLCODE = 0                                          04090072
041000           PERFORM 5100-GET-DMM-NAME                              04100072
041100        WHEN SQLCODE = +100                                       04110072
041200           MOVE '00'      TO RC092-DMA-NBR                        04120072
041300           MOVE 'UNKNOWN' TO RC092-DMM-NM                         04130072
041400        WHEN OTHER                                                04140072
041500           MOVE '5000-GET-DPT-INFO'                               04150072
041600                                  TO PV-ABEND-PARAGRAPH           04160072
041700           MOVE 'SELECT TMDSEAR'                                  04170072
041800                                  TO PV-ABEND-OPERATION           04180072
041900           MOVE ' '               TO PV-ABEND-STRUCTURE-1         04190072
042000           MOVE 'SELECT      '    TO PV-DB2-OPERATION-MESSAGE-1   04200072
042100           PERFORM 9900-DB2-ABEND                                 04210072
042200     END-EVALUATE.                                                04220072
042300                                                                  04230072
042400 5100-GET-DMM-NAME.                                               04240072
042500                                                                  04250072
042600     MOVE '5100-GET-DMM-NAME          ' TO PV-ABEND-PARAGRAPH.    04260072
042700                                                                  04270072
042800     EXEC SQL                                                     04280072
042900          SELECT B.WORKER_FIR_NAME                                04290072
043000               , B.WORKER_LAST_NAME                               04300072
043100            INTO :RSPBAR-WORKER-FIR-NAME                          04310072
043200               , :RSPBAR-WORKER-LAST-NAME                         04320072
043300            FROM TMDSEAR A                                        04330072
043400                ,TRSPBAR B                                        04340072
043500           WHERE A.OPERCO_NBR       = '03'                        04350072
043600             AND A.MDSELV_CDE       = 'DMA'                       04360072
043700             AND A.DMA_NBR          = :MDSEAR-DMA-NBR             04370072
043800             AND A.STRT_DTE        <= :PV-DATE                    04380072
043900             AND A.END_DTE          > :PV-DATE                    04390072
044000             AND A.MDSEAR_DKEY      = B.MDSEAR_DKEY               04400072
044100             AND B.RSPLVL_CDE       = 'DMM'                       04410072
044200             AND   WORKER_STRT_DTE  <= :PV-DATE                   04420072
044300             AND   WORKER_END_DTE    > :PV-DATE                   04430072
044400     END-EXEC.                                                    04440072
044500                                                                  04450072
044600     EVALUATE TRUE                                                04460072
044700        WHEN SQLCODE = 0                                          04470072
044800           PERFORM 5300-STRING-RSPBAR-NAME                        04480072
044900           MOVE MDSEAR-DMA-NBR TO RC092-DMA-NBR                   04490072
045000           MOVE PV-NAME(1:18)  TO RC092-DMM-NM                    04500072
045100        WHEN SQLCODE = +100                                       04510072
045200           MOVE '00'      TO RC092-DMA-NBR                        04520072
045300           MOVE 'UNKNOWN' TO RC092-DMM-NM                         04530072
045400        WHEN OTHER                                                04540072
045500           MOVE '5100-GET-DMM-NAME'                               04550072
045600                                  TO PV-ABEND-PARAGRAPH           04560072
045700           MOVE 'SELECT TMDSEAR/TRSPBAR'                          04570072
045800                                  TO PV-ABEND-OPERATION           04580072
045900           MOVE ' '               TO PV-ABEND-STRUCTURE-1         04590072
046000           MOVE 'SELECT      '    TO PV-DB2-OPERATION-MESSAGE-1   04600072
046100           PERFORM 9900-DB2-ABEND                                 04610072
046200     END-EVALUATE.                                                04620072
046300                                                                  04630072
046400 5200-GET-BYR-NAME.                                               04640072
046500                                                                  04650072
046600     MOVE '5200-GET-BYR-NAME          ' TO PV-ABEND-PARAGRAPH.    04660072
046700                                                                  04670072
046800     EXEC SQL                                                     04680072
046900          SELECT A.BYR_NBR                                        04690072
047000               , B.WORKER_FIR_NAME                                04700072
047100               , B.WORKER_LAST_NAME                               04710072
047200            INTO :MDSEAR-BYR-NBR                                  04720072
047300               , :RSPBAR-WORKER-FIR-NAME                          04730072
047400               , :RSPBAR-WORKER-LAST-NAME                         04740072
047500            FROM TMDSEAR A                                        04750072
047600                ,TRSPBAR B                                        04760072
047700           WHERE A.OPERCO_NBR       = '03'                        04770072
047800             AND A.MDSELV_CDE       = 'DPT'                       04780072
047900             AND A.DEPT_NBR         = :MDSEAR-DEPT-NBR            04790072
048000             AND A.STRT_DTE        <= :PV-DATE                    04800072
048100             AND A.END_DTE         >= :PV-DATE                    04810072
048200             AND A.MDSEAR_DKEY      = B.MDSEAR_DKEY               04820072
048300             AND B.RSPLVL_CDE       = 'BYR'                       04830072
048400             AND   WORKER_STRT_DTE  <= :PV-DATE                   04840072
048500             AND   WORKER_END_DTE    > :PV-DATE                   04850072
048600     END-EXEC.                                                    04860072
048700                                                                  04870072
048800     EVALUATE TRUE                                                04880072
048900        WHEN SQLCODE = 0                                          04890072
049000           PERFORM 5300-STRING-RSPBAR-NAME                        04900072
049100           MOVE MDSEAR-BYR-NBR TO RC092-BUYER-NBR                 04910072
049200           MOVE PV-NAME(1:18)  TO  RC092-BUYER-NM                 04920072
049300        WHEN SQLCODE = +100                                       04930072
049400           MOVE '00'      TO RC092-BUYER-NBR                      04940072
049500           MOVE 'UNKNOWN' TO RC092-BUYER-NM                       04950072
049600        WHEN OTHER                                                04960072
049700           MOVE '5200-GET-BYR-NAME'                               04970072
049800                                  TO PV-ABEND-PARAGRAPH           04980072
049900           MOVE 'SELECT TMDSEAR/TRSPBAR'                          04990072
050000                                  TO PV-ABEND-OPERATION           05000072
050100           MOVE ' '               TO PV-ABEND-STRUCTURE-1         05010072
050200           MOVE 'SELECT      '    TO PV-DB2-OPERATION-MESSAGE-1   05020072
050300           PERFORM 9900-DB2-ABEND                                 05030072
050400     END-EVALUATE.                                                05040072
050500                                                                  05050072
050600 5300-STRING-RSPBAR-NAME.                                         05060072
050700                                                                  05070072
050800     MOVE RSPBAR-WORKER-FIR-NAME  TO PV-FIRST-NAME.               05080072
050900     MOVE RSPBAR-WORKER-LAST-NAME TO PV-LAST-NAME.                05090072
051000                                                                  05100072
051100     INITIALIZE PV-NAME.                                          05110072
051200     SET INX3 TO 1.                                               05120072
051300                                                                  05130072
051400****  LAST NAME                                                   05140072
051500                                                                  05150072
051600     PERFORM VARYING INX2 FROM 1 BY 1                             05160072
051700                  UNTIL INX2 > 18                                 05170072
051800            IF PV-LAST-NAME-BYTE (INX2) = SPACE                   05180072
051900               IF INX1 < 17                                       05190072
052000                  IF PV-FIRST-NAME-BYTE (INX2 + 1) = SPACE        05200072
052100                     SET INX3 UP BY 2                             05210072
052200                     SET INX2   TO 18                             05220072
052300                  END-IF                                          05230072
052400               END-IF                                             05240072
052500            ELSE                                                  05250072
052600                MOVE PV-LAST-NAME-BYTE (INX2)  TO                 05260072
052700                     PV-NAME-BYTE (INX3)                          05270072
052800                SET INX3 UP BY 1                                  05280072
052900            END-IF                                                05290072
053000     END-PERFORM.                                                 05300072
053100                                                                  05310072
053200****  FIRST NAME                                                  05320072
053300                                                                  05330072
053400     PERFORM VARYING INX1 FROM 1 BY 1                             05340072
053500                 UNTIL INX1 > 12                                  05350072
053600           IF  PV-FIRST-NAME-BYTE (INX1) = SPACE                  05360072
053700               SET INX1   TO 12                                   05370072
053800           ELSE                                                   05380072
053900               MOVE PV-FIRST-NAME-BYTE (INX1)  TO                 05390072
054000                    PV-NAME-BYTE (INX3)                           05400072
054100               SET INX3 UP BY 1                                   05410072
054200           END-IF                                                 05420072
054300     END-PERFORM.                                                 05430072
054400                                                                  05440072
054500     INSPECT PV-NAME REPLACING FIRST ' ' BY ','.                  05450072
054600                                                                  05460072
054700******************************************************************05470072
054800 7000-GET-TIMESTAMP.                                              05480072
054900***************************************************************** 05490072
055000                                                                  05500072
055100     MOVE '7000-GET-TIMESTAMP         ' TO PV-ABEND-PARAGRAPH.    05510072
055200                                                                  05520072
055300     EXEC SQL                                                     05530072
055400         SET :PV-TMST = CURRENT TIMESTAMP                         05540072
055500     END-EXEC.                                                    05550072
055600                                                                  05560072
055700     EVALUATE TRUE                                                05570072
055800        WHEN SQLCODE = ZERO                                       05580072
055900           MOVE PV-TMST(1:10)    TO PV-DATE                       05590072
056000        WHEN OTHER                                                05600072
056100           MOVE '7000-GET-TIMESTAMP'                              05610072
056200                                  TO PV-ABEND-PARAGRAPH           05620072
056300           MOVE 'SET TIMESTAMP  ' TO PV-ABEND-OPERATION           05630072
056400           MOVE ' '               TO PV-ABEND-STRUCTURE-1         05640072
056500           MOVE 'SET TIMESTAMP'   TO PV-DB2-OPERATION-MESSAGE-1   05650072
056600           PERFORM 9900-DB2-ABEND                                 05660072
056700     END-EVALUATE.                                                05670072
056800                                                                  05680072
056900******************************************************************05690072
057000 9000-END-OF-PROGRAM.                                             05700072
057100***************************************************************** 05710072
057200                                                                  05720072
057300*DISPLAY COUNTS.                                                  05730072
057400     DISPLAY ' '.                                                 05740072
057500     DISPLAY '*********** RCKUT149 COUNTS ************'.          05750072
057600     DISPLAY '*** RECORDS READ     ==> ' PV-TOT-READ-COUNT.       05760072
057700     DISPLAY '*** RECORDS WRITTEN  ==> ' PV-TOT-WRITE-COUNT.      05770072
057800     DISPLAY '****************************************'.          05780072
057900     DISPLAY ' '.                                                 05790072
058000                                                                  05800072
058100*CLOSE FILES.                                                     05810072
058200     CLOSE INPUT-FILE-1                                           05820072
058300           OUTPUT-FILE-1.                                         05830072
058400                                                                  05840072
058500*END.                                                             05850072
058600                                                                  05860072
058700     DISPLAY '*** END OF RCKUT149 ***'.                           05870072
058800                                                                  05880072
058900******************************************************************05890072
059000 9900-DB2-ABEND.                                                  05900072
059100******************************************************************05910072
059200     MOVE '9900-DB2-ABEND             ' TO PV-ABEND-PARAGRAPH.    05920072
059300                                                                  05930072
059400     MOVE SQLCODE TO PV-SQLCODE.                                  05940072
059500     DISPLAY '*** DB2 ERROR '.                                    05950072
059600     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       05960072
059700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 05970072
059800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               05980072
059900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               05990072
060000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       06000072
060100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       06010072
060200     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME.                06020072
060300                                                                  06030072
060400*ABEND                                                            06040072
060500                                                                  06050072
060600     DISPLAY '*** RCKUT149 ABEND ***'.                            06060072
060700                                                                  06070072
060800     COPY DPPD004.                                                06080072
060900                                                                  06090072
061000     MOVE +4013 TO PV-ABEND-CODE.                                 06100072
061100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06110072
