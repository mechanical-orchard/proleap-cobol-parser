000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    RCKUT145.                                         00050000
000600 AUTHOR.        VIRGENE LENNEMAN.                                 00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   JANUARY 2008.                                     00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001310*                                                                 00120000
001320*  THIS PROGRAM WILL TAKE DATA FROM THE RCT_PRCG_CNTL             00130026
001330*  RCT_LOC_RNK, RCT_LOC_DEPT_RNK, RCT_LOC_MAJ_RNK AND             00141026
001340*  RCT_LOC_SUB_RNK TABLES AND CREATE 5 EXTRACT FILES, 1 FOR EACH  00142026
001340*  TABLE FOR INPUT INTO INDIVIDUAL TABLE PURGE PROGRAMS           00143026
001340*                                                                 00150000
001400******************************************************************00160000
001600                                                                  00170000
001700 ENVIRONMENT DIVISION.                                            00180000
001800******************************************************************00190000
001900                                                                  00200000
002000 CONFIGURATION SECTION.                                           00210000
002100                                                                  00220000
002200 SOURCE-COMPUTER.        IBM-3090.                                00230000
002300 OBJECT-COMPUTER.        IBM-3090.                                00240000
002400                                                                  00250000
002500 INPUT-OUTPUT SECTION.                                            00260000
002600                                                                  00270000
002700 FILE-CONTROL.                                                    00280000
002900                                                                  00290000
003210     SELECT EXTRACT-FILE1                                         00300085
003220         ASSIGN TO OUT01.                                         00310000
003210     SELECT EXTRACT-FILE2                                         00311085
003220         ASSIGN TO OUT02.                                         00312085
003210     SELECT EXTRACT-FILE3                                         00313085
003220         ASSIGN TO OUT03.                                         00314085
003210     SELECT EXTRACT-FILE4                                         00315085
003220         ASSIGN TO OUT04.                                         00316085
003210     SELECT EXTRACT-FILE5                                         00317085
003220         ASSIGN TO OUT05.                                         00318085
003230                                                                  00320000
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500******************************************************************00350000
003700 FILE SECTION.                                                    00360000
003800                                                                  00370000
004510 FD  EXTRACT-FILE1                                                00380068
004520     RECORDING MODE IS F                                          00390000
004530     LABEL RECORDS ARE STANDARD                                   00400000
004540     BLOCK CONTAINS 0 RECORDS.                                    00410000
004550 01  EXTRACT-REC1                PIC X(25).                       00420068
004560                                                                  00430000
004510 FD  EXTRACT-FILE2                                                00431068
004520     RECORDING MODE IS F                                          00432068
004530     LABEL RECORDS ARE STANDARD                                   00433068
004540     BLOCK CONTAINS 0 RECORDS.                                    00434068
004550 01  EXTRACT-REC2                PIC X(25).                       00435068
004560                                                                  00435168
004510 FD  EXTRACT-FILE3                                                00435268
004520     RECORDING MODE IS F                                          00435368
004530     LABEL RECORDS ARE STANDARD                                   00435468
004540     BLOCK CONTAINS 0 RECORDS.                                    00435568
004550 01  EXTRACT-REC3                PIC X(25).                       00435668
004560                                                                  00435769
004510 FD  EXTRACT-FILE4                                                00435869
004520     RECORDING MODE IS F                                          00435969
004530     LABEL RECORDS ARE STANDARD                                   00436069
004540     BLOCK CONTAINS 0 RECORDS.                                    00436169
004550 01  EXTRACT-REC4                PIC X(25).                       00436269
004560                                                                  00436369
004510 FD  EXTRACT-FILE5                                                00436469
004520     RECORDING MODE IS F                                          00436569
004530     LABEL RECORDS ARE STANDARD                                   00436669
004540     BLOCK CONTAINS 0 RECORDS.                                    00436769
004550 01  EXTRACT-REC5                PIC X(25).                       00436869
004560                                                                  00437068
004600*                                                                 00440000
004700******************************************************************00450000
004800 WORKING-STORAGE SECTION.                                         00460000
004900******************************************************************00470000
005000*                                                                 00480000
005300******************************************************************00490000
005400*  DB2 FORMATTED MESSAGE AREA                                     00500000
005500******************************************************************00510000
005600     COPY DPWS004.                                                00520000
005700*                                                                 00530000
005710******************************************************************00540000
005720*  COPYBOOK                                                       00550000
005730******************************************************************00560000
005740     COPY RCRD042.                                                00570003
005750*                                                                 00580000
007300 01  ABEND-CODE                       PIC S9(04)    VALUE +0      00590000
007400                                                   COMP SYNC.     00600000
007500                                                                  00610000
007600 01  PS-PROGRAM-SWITCHES.                                         00620000
008000     05  PS-END-OF-DRIVE-CSR-SW       PIC X(01) VALUE 'N'.        00630006
008100         88  PS-END-DRIVE-CSR-YES               VALUE 'Y'.        00640006
008200         88  PS-END-DRIVE-CSR-NO                VALUE 'N'.        00650006
           05  PS-END-OF-LOC-CSR-SW         PIC X(01) VALUE 'N'.        00651032
               88  PS-END-OF-LOC-CSR-YES              VALUE 'Y'.        00652032
               88  PS-END-OF-LOC-CSR-NO               VALUE 'N'.        00653032
           05  PS-END-OF-DEPT-CSR-SW        PIC X(01) VALUE 'N'.        00654066
               88  PS-END-OF-DEPT-CSR-YES             VALUE 'Y'.        00655066
               88  PS-END-OF-DEPT-CSR-NO              VALUE 'N'.        00656066
           05  PS-END-OF-MAJ-CSR-SW         PIC X(01) VALUE 'N'.        00657067
               88  PS-END-OF-MAJ-CSR-YES              VALUE 'Y'.        00658067
               88  PS-END-OF-MAJ-CSR-NO               VALUE 'N'.        00659067
           05  PS-END-OF-SUB-CSR-SW         PIC X(01) VALUE 'N'.        00659167
               88  PS-END-OF-SUB-CSR-YES              VALUE 'Y'.        00659267
               88  PS-END-OF-SUB-CSR-NO               VALUE 'N'.        00659367
008300                                                                  00660000
008400 01  PC-PROGRAM-CONSTANTS.                                        00670000
008700     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'RCKUT145'. 00680000
008900                                                                  00690000
009000 01  PV-PROGRAM-VARIABLES.                                        00700000
009030                                                                  00710000
009100     05  PV-READ-COUNTER1            PIC S9(09)    VALUE ZERO     00720095
009200                                                   COMP SYNC.     00730000
009100     05  PV-READ-COUNTER2            PIC S9(09)    VALUE ZERO     00731095
009200                                                   COMP SYNC.     00732087
009100     05  PV-READ-COUNTER3            PIC S9(09)    VALUE ZERO     00733095
009200                                                   COMP SYNC.     00734087
009100     05  PV-READ-COUNTER4            PIC S9(09)    VALUE ZERO     00735095
009200                                                   COMP SYNC.     00736087
009100     05  PV-READ-COUNTER5            PIC S9(09)    VALUE ZERO     00737095
009200                                                   COMP SYNC.     00738087
009500     05  PV-WRITE-COUNTER1           PIC S9(09)    VALUE ZERO     00740074
009600                                                   COMP SYNC.     00750000
009500     05  PV-WRITE-COUNTER2           PIC S9(09)    VALUE ZERO     00751074
009600                                                   COMP SYNC.     00752074
009500     05  PV-WRITE-COUNTER3           PIC S9(09)    VALUE ZERO     00753074
009600                                                   COMP SYNC.     00754074
009500     05  PV-WRITE-COUNTER4           PIC S9(09)    VALUE ZERO     00755074
009600                                                   COMP SYNC.     00756074
009500     05  PV-WRITE-COUNTER5           PIC S9(09)    VALUE ZERO     00757074
009600                                                   COMP SYNC.     00758074
009900     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00760000
010000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00770000
010100     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00780000
010200                                                                  00790000
010300     05  PV-FUNC-TIMESTAMP           PIC  X(26)    VALUE SPACES.  00800000
010310     05  PV-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  00810000
013700                                                                  00820000
005800******************************************************************00830001
005900*  COMMUNICATIONS AREA FOR DB2                                    00840001
006000******************************************************************00850001
006100     EXEC SQL                                                     00860001
006200          INCLUDE SQLCA                                           00870001
006300     END-EXEC.                                                    00880001
007200*                                                                 00890001
007281******************************************************************00900001
007282*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PARM TABLE         00910001
007283******************************************************************00920001
007284     EXEC SQL                                                     00930001
007285          INCLUDE TKRPRPM                                         00940001
007286     END-EXEC.                                                    00950001
007287*                                                                 00960001
007281******************************************************************00970003
007282*  COBOL DECLARATION AND DCLGEN MEMBER FOR RCT_LOC_DEPT_RNK       00980018
007283******************************************************************00990003
007284     EXEC SQL                                                     01000003
007285          INCLUDE RCT00005                                        01010018
007286     END-EXEC.                                                    01020003
007287*                                                                 01030003
007281******************************************************************01030118
007282*  COBOL DECLARATION AND DCLGEN MEMBER FOR RCT_LOC_MAJ_RNK        01030218
007283******************************************************************01030318
007284     EXEC SQL                                                     01030418
007285          INCLUDE RCT00006                                        01030518
007286     END-EXEC.                                                    01030618
007287*                                                                 01030718
007281******************************************************************01030819
007282*  COBOL DECLARATION AND DCLGEN MEMBER FOR RCT_LOC_SUB_RNK        01030919
007283******************************************************************01031019
007284     EXEC SQL                                                     01031119
007285          INCLUDE RCT00007                                        01031219
007286     END-EXEC.                                                    01031319
007281******************************************************************01031419
007282*  COBOL DECLARATION AND DCLGEN MEMBER FOR RCT_LOC_RNK            01031519
007283******************************************************************01031619
007284     EXEC SQL                                                     01031719
007285          INCLUDE RCT00008                                        01031819
007286     END-EXEC.                                                    01031919
007281******************************************************************01032017
007282*  COBOL DECLARATION AND DCLGEN MEMBER FOR RCT_PRCG_CNTL          01032117
007283******************************************************************01033017
007284     EXEC SQL                                                     01034017
007285          INCLUDE RCT00011                                        01035017
007286     END-EXEC.                                                    01036017
007281******************************************************************01040001
007282*  DRIVER CURSOR                                                  01050001
007283******************************************************************01060001
007800     EXEC SQL                                                     01070001
008000         DECLARE DRIVE-CSR CURSOR FOR                             01080001
008100         SELECT                                                   01090001
008200             PRCG_NBR                                             01100003
010500          FROM  RCT_PRCG_CNTL                                     01110003
010600         WHERE  PRCG_END_TMST <= :PV-FUNC-TIMESTAMP               01120008
010700     END-EXEC.                                                    01130001
007287*                                                                 01140001
007800     EXEC SQL                                                     01141020
008000         DECLARE LOC-RNK-CSR CURSOR FOR                           01142034
008100         SELECT                                                   01143020
008200             PRCG_NBR                                             01144023
                  ,LOC_NBR                                              01144123
010500          FROM  RCT_LOC_RNK                                       01145020
010600         WHERE  PRCG_NBR       = :RCT00011-PRCG-NBR               01146064
010700     END-EXEC.                                                    01147020
007287*                                                                 01147121
007800     EXEC SQL                                                     01148021
008000         DECLARE LOC-DEPT-RNK-CSR CURSOR FOR                      01149024
008100         SELECT                                                   01149121
008200             PRCG_NBR                                             01149221
                  ,LOC_NBR                                              01149323
                  ,DEPT_NBR                                             01149423
010500          FROM  RCT_LOC_DEPT_RNK                                  01149523
010600         WHERE  PRCG_NBR       = :RCT00011-PRCG-NBR               01149664
010700     END-EXEC.                                                    01149723
007287*                                                                 01149823
007800     EXEC SQL                                                     01149923
008000         DECLARE LOC-MAJ-RNK-CSR CURSOR FOR                       01150024
008100         SELECT                                                   01150123
008200             PRCG_NBR                                             01150223
                  ,LOC_NBR                                              01150324
                  ,DEPT_NBR                                             01150424
                  ,MAJ_CL_NBR                                           01150524
010500          FROM  RCT_LOC_MAJ_RNK                                   01150624
010600         WHERE  PRCG_NBR       = :RCT00011-PRCG-NBR               01150764
010700     END-EXEC.                                                    01150824
007287*                                                                 01150924
007800     EXEC SQL                                                     01151024
008000         DECLARE LOC-SUB-RNK-CSR CURSOR FOR                       01151124
008100         SELECT                                                   01151224
008200             PRCG_NBR                                             01151324
                  ,LOC_NBR                                              01151424
                  ,DEPT_NBR                                             01151524
                  ,MAJ_CL_NBR                                           01151624
                  ,SUB_CL_NBR                                           01151724
010500          FROM  RCT_LOC_SUB_RNK                                   01151824
010600         WHERE  PRCG_NBR       = :RCT00011-PRCG-NBR               01151964
010700     END-EXEC.                                                    01152024
007290******************************************************************01153024
013800 PROCEDURE DIVISION.                                              01160000
013900******************************************************************01170000
014000 0000-PROGRAM-MAINLINE.                                           01180000
014100******************************************************************01190000
014200*                                                                 01200000
014400     PERFORM 1000-INITIALIZE.                                     01210000
014500                                                                  01220000
015210     PERFORM 2000-PROCESS-DRIVE-CSR                               01230011
015220         UNTIL PS-END-DRIVE-CSR-YES.                              01240006
015300                                                                  01250000
015400     PERFORM 9000-EOJ-ROUTINE.                                    01260000
015401                                                                  01270000
015410     STOP RUN.                                                    01280007
015500                                                                  01290000
015600******************************************************************01300000
015700 1000-INITIALIZE.                                                 01310000
015800******************************************************************01320000
024900     INITIALIZE DCLRCT00011.                                      01321013
015801                                                                  01330000
015900     OPEN OUTPUT EXTRACT-FILE1                                    01340070
015900                 EXTRACT-FILE2                                    01341070
015900                 EXTRACT-FILE3                                    01342070
015900                 EXTRACT-FILE4                                    01343070
015900                 EXTRACT-FILE5.                                   01344070
016200                                                                  01350000
016202     PERFORM 2500-SELECT-TKRPRPM                                  01360044
016204                                                                  01370000
012400     DISPLAY '* * * * * * * * * * * '.                            01380002
012500     DISPLAY 'CURRENT PROGRAM   ' PC-CURRENT-PROGRAM-NAME.        01390096
012500     DISPLAY 'EXTRACT TIMESTAMP ' PV-FUNC-TIMESTAMP               01391096
012600                                                                  01400002
013400     PERFORM 3000-OPEN-DRIVE-CSR.                                 01410025
013500     PERFORM 3100-FETCH-DRIVE-CSR.                                01420025
013600                                                                  01430002
013700 2000-PROCESS-DRIVE-CSR.                                          01440002
           INITIALIZE RC042-RECORD.                                     01441059
013800                                                                  01450002
014600     MOVE RCT00011-PRCG-NBR           TO RC042-PRCG-NBR           01461014
014000     PERFORM 8001-WRITE-RC042-REC.                                01470086
014100                                                                  01480002
           PERFORM 4000-OPEN-LOC-RNK-CSR                                01481028
           INITIALIZE PS-END-OF-LOC-CSR-SW                              01481133
           PERFORM 4100-FETCH-LOC-RNK-CSR                               01481238
           PERFORM 2100-PROCESS-LOC-RNK                                 01481331
               UNTIL PS-END-OF-LOC-CSR-YES                              01481432
           PERFORM 4200-CLOSE-LOC-RNK-CSR                               01481528
                                                                        01481628
           PERFORM 5000-OPEN-LOC-DEPT-RNK-CSR                           01481729
           INITIALIZE PS-END-OF-DEPT-CSR-SW                             01481833
           PERFORM 5100-FETCH-LOC-DEPT-RNK-CSR                          01481940
           PERFORM 2200-PROCESS-DEPT-RNK                                01482031
               UNTIL PS-END-OF-DEPT-CSR-YES                             01482132
           PERFORM 5200-CLOSE-LOC-DEPT-RNK-CSR                          01482240
                                                                        01482329
           PERFORM 6000-OPEN-LOC-MAJ-RNK-CSR                            01482430
           INITIALIZE PS-END-OF-MAJ-CSR-SW                              01482533
           PERFORM 6100-FETCH-LOC-MAJ-RNK-CSR                           01482641
           PERFORM 2300-PROCESS-MAJ-RNK                                 01482731
               UNTIL PS-END-OF-MAJ-CSR-YES                              01482832
           PERFORM 6200-CLOSE-LOC-MAJ-RNK-CSR                           01482942
                                                                        01483030
           PERFORM 7000-OPEN-LOC-SUB-RNK-CSR                            01484028
           INITIALIZE PS-END-OF-SUB-CSR-SW                              01484133
           PERFORM 7100-FETCH-LOC-SUB-RNK-CSR                           01484243
           PERFORM 2400-PROCESS-SUB-RNK                                 01484331
               UNTIL PS-END-OF-SUB-CSR-YES                              01484432
           PERFORM 7200-CLOSE-LOC-SUB-RNK-CSR                           01484544
                                                                        01485027
014200     PERFORM 3100-FETCH-DRIVE-CSR.                                01490025
                                                                        01490158
       2100-PROCESS-LOC-RNK.                                            01491058
008200     MOVE RCT00008-PRCG-NBR   TO RC042-PRCG-NBR                   01491161
           MOVE RCT00008-LOC-NBR    TO RC042-LOC-NBR                    01491261
014000     PERFORM 8002-WRITE-RC042-REC.                                01492073
           PERFORM 4100-FETCH-LOC-RNK-CSR.                              01493093
014300                                                                  01500002
       2200-PROCESS-DEPT-RNK.                                           01501060
008200     MOVE RCT00005-PRCG-NBR   TO RC042-PRCG-NBR                   01501161
           MOVE RCT00005-LOC-NBR    TO RC042-LOC-NBR                    01501261
           MOVE RCT00005-DEPT-NBR   TO RC042-DEPT-NBR                   01501362
014000     PERFORM 8003-WRITE-RC042-REC.                                01501473
           PERFORM 5100-FETCH-LOC-DEPT-RNK-CSR.                         01501593
                                                                        01502060
       2300-PROCESS-MAJ-RNK.                                            01503061
008200     MOVE RCT00006-PRCG-NBR   TO RC042-PRCG-NBR                   01503161
           MOVE RCT00006-LOC-NBR    TO RC042-LOC-NBR                    01503261
           MOVE RCT00006-DEPT-NBR   TO RC042-DEPT-NBR                   01503362
           MOVE RCT00006-MAJ-CL-NBR TO RC042-MAJ-CL-NBR                 01503462
014000     PERFORM 8004-WRITE-RC042-REC.                                01503573
           PERFORM 6100-FETCH-LOC-MAJ-RNK-CSR.                          01503693
                                                                        01503762
       2400-PROCESS-SUB-RNK.                                            01503862
008200     MOVE RCT00007-PRCG-NBR   TO RC042-PRCG-NBR                   01503963
           MOVE RCT00007-LOC-NBR    TO RC042-LOC-NBR                    01504063
           MOVE RCT00007-DEPT-NBR   TO RC042-DEPT-NBR                   01504163
           MOVE RCT00007-MAJ-CL-NBR TO RC042-MAJ-CL-NBR                 01504263
           MOVE RCT00007-SUB-CL-NBR TO RC042-SUB-CL-NBR                 01504363
014000     PERFORM 8005-WRITE-RC042-REC.                                01504473
           PERFORM 7100-FETCH-LOC-SUB-RNK-CSR.                          01504593
                                                                        01505061
019421 2500-SELECT-TKRPRPM.                                             01510044
019422                                                                  01520003
019423     EXEC SQL                                                     01530003
019424         SELECT CURRENT TIMESTAMP - FUNC_QTY DAYS                 01540003
019427               ,CURRENT TIMESTAMP                                 01550003
019428           INTO   :PV-FUNC-TIMESTAMP                              01560003
019429                 ,:PV-CURRENT-TIMESTAMP                           01570003
019430           FROM  TKRPRPM                                          01580003
019431          WHERE LOC_ID            =  90                           01590003
019432            AND INTFC_SYS_CDE     = 'KHL'                         01600003
019433            AND SYS_PRC_FUNC_CDE  = 'PRNKPG'                      01610003
019434            AND FUNC_PRC_STAT_CDE = 'AC'                          01620003
019435      END-EXEC.                                                   01630003
019436                                                                  01640003
019437       EVALUATE TRUE                                              01650003
019438         WHEN SQLCODE = +0                                        01660003
019439              CONTINUE                                            01670003
019440         WHEN SQLCODE = +100                                      01680003
019441         WHEN SQLWARN0 NOT = SPACE                                01690003
019442         WHEN SQLCODE < ZERO                                      01700003
019443         WHEN SQLCODE > ZERO                                      01710003
019444             MOVE '2500-SELECT-TKRPRPM '                          01720044
019445                                 TO PV-PARAGRAPH-NAME             01730003
019446             MOVE 'SELECT PARM VALUE FOR DELETES  '               01740003
019447                                 TO PV-DB2-OPERATION-ATTEMPTED    01750003
019448             PERFORM 9100-SQL-ABEND                               01760003
019449      END-EVALUATE.                                               01770003
019450                                                                  01780003
019492*                                                                 01790003
022800 3000-OPEN-DRIVE-CSR.                                             01850025
022900                                                                  01860002
023000     MOVE '3000-OPEN-DRIVE-CSR'       TO PV-PARAGRAPH-NAME.       01870025
023100                                                                  01880002
023200     EXEC SQL                                                     01890002
023300         OPEN DRIVE-CSR                                           01900002
023400     END-EXEC.                                                    01910002
023500                                                                  01920002
023600     EVALUATE TRUE                                                01930002
023700         WHEN SQLCODE = ZERO                                      01940002
023800             SET PS-END-DRIVE-CSR-NO  TO TRUE                     01950002
023900         WHEN SQLWARN0 NOT = SPACES                               01960002
024000         WHEN SQLCODE < ZERO                                      01970002
024100         WHEN SQLCODE > ZERO                                      01980002
024200             MOVE 'OPEN CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED    01990002
024300             PERFORM 9100-SQL-ABEND                               02000002
024400     END-EVALUATE.                                                02010002
024500                                                                  02020002
024600 3100-FETCH-DRIVE-CSR.                                            02030025
024700                                                                  02040002
024800     MOVE '3100-FETCH-DRIVE-CSR'      TO PV-PARAGRAPH-NAME.       02050025
025000                                                                  02070002
025100     EXEC SQL                                                     02080002
025200         FETCH DRIVE-CSR                                          02090002
025300         INTO                                                     02100002
025400              :RCT00011-PRCG-NBR                                  02110010
027700     END-EXEC.                                                    02120002
027800                                                                  02130002
027900     EVALUATE TRUE                                                02140002
028000         WHEN SQLCODE = ZERO                                      02150002
031100             ADD +1                   TO PV-READ-COUNTER1         02151095
028200         WHEN SQLCODE = +100                                      02170002
028300             SET PS-END-DRIVE-CSR-YES TO TRUE                     02180002
028400         WHEN SQLWARN0 NOT = SPACES                               02190002
028500         WHEN SQLCODE < ZERO                                      02200002
028600         WHEN SQLCODE > ZERO                                      02210002
028700             MOVE 'FETCH CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02220002
028800             PERFORM 9100-SQL-ABEND                               02230002
028900     END-EVALUATE.                                                02240002
029000                                                                  02250002
029100 3200-CLOSE-DRIVE-CSR.                                            02260025
029200                                                                  02270002
029300     MOVE '3200-CLOSE-DRIVE-CSR' TO PV-PARAGRAPH-NAME             02280025
029400     EXEC SQL                                                     02290002
029500         CLOSE DRIVE-CSR                                          02300002
029600     END-EXEC                                                     02310002
029700                                                                  02320002
029800     EVALUATE TRUE                                                02330002
029900         WHEN SQLCODE = ZERO                                      02340002
030000             CONTINUE                                             02350002
030100         WHEN SQLWARN0 NOT = SPACES                               02360002
030200         WHEN SQLCODE < ZERO                                      02370002
030300         WHEN SQLCODE > ZERO                                      02380002
030400             MOVE 'CLOSE CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02390002
030500             PERFORM 9100-SQL-ABEND                               02400002
030600     END-EVALUATE.                                                02410002
                                                                        02410134
022800 4000-OPEN-LOC-RNK-CSR.                                           02411034
022900                                                                  02412034
023000     MOVE '4000-OPEN-LOC-RNK-CSR'     TO PV-PARAGRAPH-NAME.       02413034
023100                                                                  02414034
023200     EXEC SQL                                                     02415034
023300         OPEN LOC-RNK-CSR                                         02416034
023400     END-EXEC.                                                    02417034
023500                                                                  02418034
023600     EVALUATE TRUE                                                02419034
023700         WHEN SQLCODE = ZERO                                      02419134
023800             CONTINUE                                             02419245
023900         WHEN SQLWARN0 NOT = SPACES                               02419334
024000         WHEN SQLCODE < ZERO                                      02419434
024100         WHEN SQLCODE > ZERO                                      02419534
024200             MOVE 'OPEN CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED    02419634
024300             PERFORM 9100-SQL-ABEND                               02419734
024400     END-EVALUATE.                                                02419834
                                                                        02419946
024600 4100-FETCH-LOC-RNK-CSR.                                          02420046
024700                                                                  02420146
024800     MOVE '4100-FETCH-LOC-RNK-CSR'    TO PV-PARAGRAPH-NAME.       02420246
025000                                                                  02420346
025100     EXEC SQL                                                     02420446
025200         FETCH LOC-RNK-CSR                                        02420546
025300         INTO                                                     02420646
008200             :RCT00008-PRCG-NBR                                   02420746
                  ,:RCT00008-LOC-NBR                                    02420846
027700     END-EXEC.                                                    02421046
027800                                                                  02421146
027900     EVALUATE TRUE                                                02421246
028000         WHEN SQLCODE = ZERO                                      02421346
031100             ADD +1                   TO PV-READ-COUNTER2         02421595
028200         WHEN SQLCODE = +100                                      02421646
028300             SET PS-END-OF-LOC-CSR-YES TO TRUE                    02421747
028400         WHEN SQLWARN0 NOT = SPACES                               02421846
028500         WHEN SQLCODE < ZERO                                      02421946
028600         WHEN SQLCODE > ZERO                                      02422046
028700             MOVE 'FETCH CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02422146
028800             PERFORM 9100-SQL-ABEND                               02422246
028900     END-EVALUATE.                                                02422346
029000                                                                  02422446
029100 4200-CLOSE-LOC-RNK-CSR.                                          02422553
029200                                                                  02422653
029300     MOVE '4200-CLOSE-LOC-RNK-CSR' TO PV-PARAGRAPH-NAME           02422754
029400     EXEC SQL                                                     02422853
029500         CLOSE LOC-RNK-CSR                                        02422954
029600     END-EXEC                                                     02423053
029700                                                                  02423153
029800     EVALUATE TRUE                                                02423253
029900         WHEN SQLCODE = ZERO                                      02423353
030000             CONTINUE                                             02423453
030100         WHEN SQLWARN0 NOT = SPACES                               02423553
030200         WHEN SQLCODE < ZERO                                      02423653
030300         WHEN SQLCODE > ZERO                                      02423753
030400             MOVE 'CLOSE CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02423853
030500             PERFORM 9100-SQL-ABEND                               02423953
030600     END-EVALUATE.                                                02424053
                                                                        02424134
022800 5000-OPEN-LOC-DEPT-RNK-CSR.                                      02424234
022900                                                                  02424334
023000     MOVE '5000-OPEN-LOC-DEPT-RNK-CSR' TO PV-PARAGRAPH-NAME.      02424434
023100                                                                  02424534
023200     EXEC SQL                                                     02424634
023300         OPEN LOC-DEPT-RNK-CSR                                    02424734
023400     END-EXEC.                                                    02424834
023500                                                                  02424934
023600     EVALUATE TRUE                                                02425034
023700         WHEN SQLCODE = ZERO                                      02425134
023800             CONTINUE                                             02425245
023900         WHEN SQLWARN0 NOT = SPACES                               02425334
024000         WHEN SQLCODE < ZERO                                      02425434
024100         WHEN SQLCODE > ZERO                                      02425534
024200             MOVE 'OPEN CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED    02425634
024300             PERFORM 9100-SQL-ABEND                               02425734
024400     END-EVALUATE.                                                02425834
                                                                        02425935
024600 5100-FETCH-LOC-DEPT-RNK-CSR.                                     02426048
024700                                                                  02426148
024800     MOVE '5100-FETCH-LOC-DEPT-RNK-CSR' TO PV-PARAGRAPH-NAME.     02426248
025000                                                                  02426348
025100     EXEC SQL                                                     02426448
025200         FETCH LOC-DEPT-RNK-CSR                                   02426549
025300         INTO                                                     02426648
008200             :RCT00005-PRCG-NBR                                   02426749
                  ,:RCT00005-LOC-NBR                                    02426849
                  ,:RCT00005-DEPT-NBR                                   02426965
027700     END-EXEC.                                                    02427048
027800                                                                  02427148
027900     EVALUATE TRUE                                                02427248
028000         WHEN SQLCODE = ZERO                                      02427348
031100             ADD +1                     TO PV-READ-COUNTER3       02427495
028200         WHEN SQLCODE = +100                                      02427648
028300             SET PS-END-OF-DEPT-CSR-YES TO TRUE                   02427750
028400         WHEN SQLWARN0 NOT = SPACES                               02427848
028500         WHEN SQLCODE < ZERO                                      02427948
028600         WHEN SQLCODE > ZERO                                      02428048
028700             MOVE 'FETCH CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02428148
028800             PERFORM 9100-SQL-ABEND                               02428248
028900     END-EVALUATE.                                                02428348
029000                                                                  02428455
029100 5200-CLOSE-LOC-DEPT-RNK-CSR.                                     02428555
029200                                                                  02428655
029300     MOVE '5200-CLOSE-LOC-DEPT-RNK-CSR' TO PV-PARAGRAPH-NAME      02428755
029400     EXEC SQL                                                     02428855
029500         CLOSE LOC-DEPT-RNK-CSR                                   02428955
029600     END-EXEC                                                     02429055
029700                                                                  02429155
029800     EVALUATE TRUE                                                02429255
029900         WHEN SQLCODE = ZERO                                      02429355
030000             CONTINUE                                             02429455
030100         WHEN SQLWARN0 NOT = SPACES                               02429555
030200         WHEN SQLCODE < ZERO                                      02429655
030300         WHEN SQLCODE > ZERO                                      02429755
030400             MOVE 'CLOSE CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02429855
030500             PERFORM 9100-SQL-ABEND                               02429955
030600     END-EVALUATE.                                                02430055
029000                                                                  02430148
       6000-OPEN-LOC-MAJ-RNK-CSR.                                       02430237
022900                                                                  02430336
023000     MOVE '6000-OPEN-LOC-MAJ-RNK-CSR' TO PV-PARAGRAPH-NAME.       02430436
023100                                                                  02430536
023200     EXEC SQL                                                     02430636
023300         OPEN LOC-MAJ-RNK-CSR                                     02430736
023400     END-EXEC.                                                    02430836
023500                                                                  02430936
023600     EVALUATE TRUE                                                02431036
023700         WHEN SQLCODE = ZERO                                      02431136
023800             CONTINUE                                             02431245
023900         WHEN SQLWARN0 NOT = SPACES                               02431336
024000         WHEN SQLCODE < ZERO                                      02431436
024100         WHEN SQLCODE > ZERO                                      02431536
024200             MOVE 'OPEN CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED    02431636
024300             PERFORM 9100-SQL-ABEND                               02431736
024400     END-EVALUATE.                                                02431836
                                                                        02431950
024600 6100-FETCH-LOC-MAJ-RNK-CSR.                                      02432050
024700                                                                  02432150
024800     MOVE '6100-FETCH-LOC-MAJ-RNK-CSR' TO PV-PARAGRAPH-NAME.      02432250
025000                                                                  02432350
025100     EXEC SQL                                                     02432450
025200         FETCH LOC-MAJ-RNK-CSR                                    02432550
025300         INTO                                                     02432650
008200             :RCT00006-PRCG-NBR                                   02432751
                  ,:RCT00006-LOC-NBR                                    02432851
                  ,:RCT00006-DEPT-NBR                                   02432965
                  ,:RCT00006-MAJ-CL-NBR                                 02433051
027700     END-EXEC.                                                    02433150
027800                                                                  02433250
027900     EVALUATE TRUE                                                02433350
028000         WHEN SQLCODE = ZERO                                      02433450
031100             ADD +1                    TO PV-READ-COUNTER4        02433595
028200         WHEN SQLCODE = +100                                      02433750
028300             SET PS-END-OF-MAJ-CSR-YES TO TRUE                    02433850
028400         WHEN SQLWARN0 NOT = SPACES                               02433950
028500         WHEN SQLCODE < ZERO                                      02434050
028600         WHEN SQLCODE > ZERO                                      02434150
028700             MOVE 'FETCH CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02434250
028800             PERFORM 9100-SQL-ABEND                               02434350
028900     END-EVALUATE.                                                02434450
029000                                                                  02434556
029100 6200-CLOSE-LOC-MAJ-RNK-CSR.                                      02434656
029200                                                                  02434756
029300     MOVE '6200-CLOSE-LOC-MAJ-RNK-CSR' TO PV-PARAGRAPH-NAME       02434856
029400     EXEC SQL                                                     02434956
029500         CLOSE LOC-MAJ-RNK-CSR                                    02435056
029600     END-EXEC                                                     02435156
029700                                                                  02435256
029800     EVALUATE TRUE                                                02435356
029900         WHEN SQLCODE = ZERO                                      02435456
030000             CONTINUE                                             02435556
030100         WHEN SQLWARN0 NOT = SPACES                               02435656
030200         WHEN SQLCODE < ZERO                                      02435756
030300         WHEN SQLCODE > ZERO                                      02435856
030400             MOVE 'CLOSE CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02435956
030500             PERFORM 9100-SQL-ABEND                               02436056
030600     END-EVALUATE.                                                02436156
                                                                        02436235
       7000-OPEN-LOC-SUB-RNK-CSR.                                       02436337
022900                                                                  02436437
023000     MOVE '7000-OPEN-LOC-SUB-RNK-CSR' TO PV-PARAGRAPH-NAME.       02436537
023100                                                                  02436637
023200     EXEC SQL                                                     02436737
023300         OPEN LOC-SUB-RNK-CSR                                     02436837
023400     END-EXEC.                                                    02436937
023500                                                                  02437037
023600     EVALUATE TRUE                                                02437137
023700         WHEN SQLCODE = ZERO                                      02437237
023800             CONTINUE                                             02437345
023900         WHEN SQLWARN0 NOT = SPACES                               02437437
024000         WHEN SQLCODE < ZERO                                      02437537
024100         WHEN SQLCODE > ZERO                                      02437637
024200             MOVE 'OPEN CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED    02437737
024300             PERFORM 9100-SQL-ABEND                               02437837
024400     END-EVALUATE.                                                02437937
                                                                        02438052
024600 7100-FETCH-LOC-SUB-RNK-CSR.                                      02438152
024700                                                                  02438252
024800     MOVE '7100-FETCH-LOC-SUB-RNK-CSR' TO PV-PARAGRAPH-NAME.      02438352
025000                                                                  02438452
025100     EXEC SQL                                                     02438552
025200         FETCH LOC-SUB-RNK-CSR                                    02438652
025300         INTO                                                     02438752
008200             :RCT00007-PRCG-NBR                                   02438852
                  ,:RCT00007-LOC-NBR                                    02438952
                  ,:RCT00007-DEPT-NBR                                   02439065
                  ,:RCT00007-MAJ-CL-NBR                                 02439152
                  ,:RCT00007-SUB-CL-NBR                                 02439252
027700     END-EXEC.                                                    02439352
027800                                                                  02439452
027900     EVALUATE TRUE                                                02439552
028000         WHEN SQLCODE = ZERO                                      02439652
031100             ADD +1                    TO PV-READ-COUNTER5        02439795
028200         WHEN SQLCODE = +100                                      02439952
028300             SET PS-END-OF-SUB-CSR-YES TO TRUE                    02440052
028400         WHEN SQLWARN0 NOT = SPACES                               02440152
028500         WHEN SQLCODE < ZERO                                      02440252
028600         WHEN SQLCODE > ZERO                                      02440352
028700             MOVE 'FETCH CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02440452
028800             PERFORM 9100-SQL-ABEND                               02440552
028900     END-EVALUATE.                                                02440652
029000                                                                  02440757
029100 7200-CLOSE-LOC-SUB-RNK-CSR.                                      02440857
029200                                                                  02440957
029300     MOVE '7200-CLOSE-LOC-SUB-RNK-CSR' TO PV-PARAGRAPH-NAME       02441057
029400     EXEC SQL                                                     02441157
029500         CLOSE LOC-SUB-RNK-CSR                                    02441257
029600     END-EXEC                                                     02441357
029700                                                                  02441457
029800     EVALUATE TRUE                                                02441557
029900         WHEN SQLCODE = ZERO                                      02441657
030000             CONTINUE                                             02441757
030100         WHEN SQLWARN0 NOT = SPACES                               02441857
030200         WHEN SQLCODE < ZERO                                      02441957
030300         WHEN SQLCODE > ZERO                                      02442057
030400             MOVE 'CLOSE CURSOR ' TO PV-DB2-OPERATION-ATTEMPTED   02442157
030500             PERFORM 9100-SQL-ABEND                               02442257
030600     END-EVALUATE.                                                02442357
030700                                                                  02442402
030800 8001-WRITE-RC042-REC.                                            02442572
030900     WRITE EXTRACT-REC1 FROM                                      02443072
031000         RC042-RECORD.                                            02450015
031100     ADD +1                           TO PV-WRITE-COUNTER1.       02460075
030700                                                                  02461074
030800 8002-WRITE-RC042-REC.                                            02462075
030900     WRITE EXTRACT-REC2 FROM                                      02463075
031000         RC042-RECORD.                                            02464074
031100     ADD +1                           TO PV-WRITE-COUNTER2.       02465075
030700                                                                  02466076
030800 8003-WRITE-RC042-REC.                                            02467076
030900     WRITE EXTRACT-REC3 FROM                                      02468076
031000         RC042-RECORD.                                            02469076
031100     ADD +1                           TO PV-WRITE-COUNTER3.       02469176
030700                                                                  02469277
030800 8004-WRITE-RC042-REC.                                            02469377
030900     WRITE EXTRACT-REC4 FROM                                      02469477
031000         RC042-RECORD.                                            02469577
031100     ADD +1                           TO PV-WRITE-COUNTER4.       02469677
030700                                                                  02469778
030800 8005-WRITE-RC042-REC.                                            02469878
030900     WRITE EXTRACT-REC5 FROM                                      02469978
031000         RC042-RECORD.                                            02470078
031100     ADD +1                           TO PV-WRITE-COUNTER5.       02470178
031200/                                                                 02471002
036500******************************************************************02480004
031300 9000-EOJ-ROUTINE.                                                02510002
031400                                                                  02520002
031500     PERFORM 3200-CLOSE-DRIVE-CSR.                                02530025
                                                                        02531079
           MOVE PV-READ-COUNTER1 TO PV-DISPLAY-COUNT                    02531189
036900     DISPLAY ' RCT_PRCG_CNTL READ COUNT       = '                 02531289
                                                     PV-DISPLAY-COUNT.  02531389
           MOVE PV-WRITE-COUNTER1 TO PV-DISPLAY-COUNT                   02532085
036900     DISPLAY ' RCT_PRCG_CNTL EXTRACT COUNT    = '                 02540082
                                                     PV-DISPLAY-COUNT.  02540185
           MOVE PV-READ-COUNTER2 TO PV-DISPLAY-COUNT                    02540290
036900     DISPLAY ' RCT_LOC_RNK READ COUNT         = '                 02542090
                                                     PV-DISPLAY-COUNT.  02542185
           MOVE PV-WRITE-COUNTER2 TO PV-DISPLAY-COUNT                   02542290
036900     DISPLAY ' RCT_LOC_RNK EXTRACT COUNT      = '                 02542390
                                                     PV-DISPLAY-COUNT.  02542490
           MOVE PV-READ-COUNTER3 TO PV-DISPLAY-COUNT                    02542591
036900     DISPLAY ' RCT_LOC_DEPT_RNK READ COUNT    = '                 02542694
                                                     PV-DISPLAY-COUNT.  02542791
           MOVE PV-WRITE-COUNTER3 TO PV-DISPLAY-COUNT                   02543085
036900     DISPLAY ' RCT_LOC_DEPT_RNK EXTRACT COUNT = '                 02544081
036900                                               PV-DISPLAY-COUNT.  02545085
           MOVE PV-READ-COUNTER4 TO PV-DISPLAY-COUNT                    02546092
036900     DISPLAY ' RCT_LOC_MAJ_RNK READ COUNT     = '                 02547092
036900                                               PV-DISPLAY-COUNT.  02548085
           MOVE PV-WRITE-COUNTER4 TO PV-DISPLAY-COUNT                   02548192
036900     DISPLAY ' RCT_LOC_MAJ_RNK EXTRACT COUNT  = '                 02548292
036900                                               PV-DISPLAY-COUNT.  02548392
           MOVE PV-READ-COUNTER5 TO PV-DISPLAY-COUNT                    02549092
036900     DISPLAY ' RCT_LOC_SUB_RNK READ COUNT     = '                 02549192
036900                                               PV-DISPLAY-COUNT.  02549285
           MOVE PV-WRITE-COUNTER5 TO PV-DISPLAY-COUNT                   02549392
036900     DISPLAY ' RCT_LOC_SUB_RNK EXTRACT COUNT  = '                 02549492
036900                                               PV-DISPLAY-COUNT.  02549592
031600                                                                  02550002
031700     CLOSE EXTRACT-FILE1                                          02560071
031700           EXTRACT-FILE2                                          02561071
031700           EXTRACT-FILE3                                          02562071
031700           EXTRACT-FILE4                                          02563071
031700           EXTRACT-FILE5.                                         02564071
031800                                                                  02570002
037500******************************************************************02580000
037600 9100-SQL-ABEND.                                                  02590000
037700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    02600000
037800*  ERROR OR WARNING CODE OCCURS.                                  02610000
037900******************************************************************02620000
038000     DISPLAY '9100-SQL-ABEND'.                                    02630000
038100     DISPLAY '** ABEND     **'.                                   02640000
038200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02650000
038300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02660000
038400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     02670000
038500                                                                  02680000
038600*    ABEND COPYBOOK                                               02690000
038700     COPY DPPD004.                                                02700000
038800                                                                  02710000
038900     MOVE +4013                  TO ABEND-CODE.                   02720000
039000     CALL 'ILBOABN0' USING ABEND-CODE.                            02730000
039100/                                                                 02740000
