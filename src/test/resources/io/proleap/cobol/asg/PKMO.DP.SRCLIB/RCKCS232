000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RCKCS232.                                         00020000
000300 AUTHOR.        LOUIE CRISOSTOMO.                                 00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  02-24-94.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*    E232 - PO LINE TROUBLE ROUTINE                               00080000
000900*                                                                 00090000
001000*    THIS IS A CALLED ROUTINE USED TO DETERMINE                   00100000
001100*    IF THE PURCHASE ORDER LINE IS IN TROUBLE                     00110000
001200*                                                                 00120000
001300******************************************************************00130000
      * 03/04/2010 TOM PRIMEAU  WR#38216                                00131000
      *       REMOVED 'PC-870 PIC S9(4)COMP VALUE +870' FROM WORKING    00132000
      *       STORAGE.                                                  00133000
      *       UNCOMMENTED 'COPY XLWS071'.                               00133100
      *       UNCOMMENTED PARAGRAPH '2411-GET-DC' WHICH CALLS XLKUT071. 00133200
      *       ADDED "PERFORM 2411-GET-DC" IN PARAGRAPH "2200-LINE-      00133300
      *         TROUBLE-CHECK" TO RETRIEVE XL071-E-BUS-IND.             00133400
      *       IN PARA 2200-LINE-TROUBLE-CHECK - CHANGED TO CHECK        00133500
      *       EBUSINESS IND RETRIEVED FROM XLKUT071. CHECK FOR 'DC'     00133600
      *       TYPE (XL071-LOC-TYP-CDE = 'DC').                          00133700
001300******************************************************************00133800
001400 ENVIRONMENT DIVISION.                                            00133900
001500 CONFIGURATION SECTION.                                           00134000
001600 SOURCE-COMPUTER.        IBM-3090.                                00135000
001700 OBJECT-COMPUTER.        IBM-3090.                                00136000
001800 DATA DIVISION.                                                   00137000
001900 WORKING-STORAGE SECTION.                                         00138000
002000                                                                  00139000
002100 01  PC-PROGRAM-CONSTANTS.                                        00140000
002200     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          00150000
002300                                                COMP SYNC.        00160000
002400     05  PC-TROUBLE-REASONS.                                      00170000
002600*        10 PC-134                    PIC S9(4) COMP VALUE +134.  00180000
002700         10 PC-222                    PIC S9(4) COMP VALUE +222.  00190000
002800         10 PC-225                    PIC S9(4) COMP VALUE +225.  00200000
002810         10 PC-401                    PIC S9(4) COMP VALUE +401.  00210000
002820         10 PC-522                    PIC S9(4) COMP VALUE +522.  00220000
002830         10 PC-523                    PIC S9(4) COMP VALUE +523.  00230000
002840         10 PC-524                    PIC S9(4) COMP VALUE +524.  00240000
002850         10 PC-528                    PIC S9(4) COMP VALUE +528.  00250000
002860         10 PC-529                    PIC S9(4) COMP VALUE +529.  00260000
002870         10 PC-534                    PIC S9(4) COMP VALUE +534.  00270000
002880     05  PC-600                       PIC S9(4) COMP VALUE +600.  00280000
002900     05  PC-FCLTY-ID                  PIC S9(4) COMP VALUE +1.    00290000
003000     05  PC-A                         PIC X(01) VALUE 'A'.        00300000
003100     05  PC-C                         PIC X(01) VALUE 'C'.        00310000
003200     05  PC-N                         PIC X(01) VALUE 'N'.        00320000
003300     05  PC-Y                         PIC X(01) VALUE 'Y'.        00330000
003400     05  PC-03                        PIC X(02) VALUE '03'.       00340000
003500     05  PC-DS                        PIC X(02) VALUE 'DS'.       00350000
003600     05  PC-CM                        PIC X(02) VALUE 'CM'.       00360000
003700     05  PC-CA                        PIC X(02) VALUE 'CA'.       00370000
003800     05  PC-CB                        PIC X(02) VALUE 'CB'.       00380000
003900     05  PC-AP                        PIC X(02) VALUE 'AP'.       00390000
004000     05  PC-IP                        PIC X(02) VALUE 'IP'.       00400000
004100     05  PC-AC                        PIC X(02) VALUE 'AC'.       00410000
004200     05  PC-RV                        PIC X(02) VALUE 'RV'.       00420000
004300     05  PC-IMPORT                    PIC X(02).                  00430000
004400         88  PC-IMPORT-EXT            VALUE 'IM' 'IE' 'IF'.       00440000
004500     05  PC-000                       PIC X(03) VALUE '000'.      00450000
004600     05  PC-999                       PIC X(03) VALUE '999'.      00460000
004700     05  PC-RCKCS232                  PIC X(08) VALUE             00470000
004800                                                'RCKCS232'.       00480000
004900     05  PC-RCKCS233                  PIC X(08) VALUE             00490000
005000                                                'RCKCS233'.       00500000
005100     05  PC-TMKCS521                  PIC X(08) VALUE             00510000
005200                                                'TMKCS521'.       00520000
005300     05  PC-DEFAULT-TMST              PIC X(26) VALUE             00530000
005400         '9999-09-09-09.09.09.999999'.                            00540000
005500                                                                  00550000
005600     05  PC-LINE-COMPLETE-TEXT.                                   00560000
005700         10  PC-LINE-COMP-TEXT-1.                                 00570000
005800             15  PC-LC-TEXT-1         PIC X(25) VALUE             00580000
005900             '         UNITS RECEIVED: '.                         00590000
006000             15  PC-LC-RCVD           PIC ZZZZZZZZ9.              00600000
006100         10  FILLER                   PIC X(216) VALUE SPACES.    00610000
006200                                                                  00620000
006300     05  PC-PRICE-DISC-TEXT.                                      00630000
006400         10  PC-PRICE-DISC-TEXT-1.                                00640000
006500             15  PC-PD-TEXT-1         PIC X(15) VALUE             00650000
006600             'PO UNIT RTL  : '.                                   00660000
006700             15  PC-PD-PO-UNT-RTL     PIC ZZZZZZ9.99.             00670000
006800             15  PC-PD-TEXT-2         PIC X(15) VALUE             00680000
006900             ' SKU UNIT RTL: '.                                   00690000
007000             15  PC-PD-SKU-UNT-RTL    PIC ZZZZZZ9.99.             00700000
007100         10  PC-PRICE-DISC-TEXT-2.                                00710000
007200             15  PC-PD-TEXT-5         PIC X(21) VALUE             00720000
007300             'PO GRP QTY   :       '.                             00730000
007400             15  PC-PD-PO-GP-QTY      PIC ZZZ9.                   00740000
007500             15  PC-PD-TEXT-6         PIC X(21) VALUE             00750000
007600             ' SKU GRP QTY :       '.                             00760000
007700             15  PC-PD-SKU-GP-QTY     PIC ZZZ9.                   00770000
007800         10  PC-PRICE-DISC-TEXT-3.                                00780000
007900             15  PC-PD-TEXT-3         PIC X(15) VALUE             00790000
008000             'PO GRP RTL   : '.                                   00800000
008100             15  PC-PD-PO-GP-RTL      PIC ZZZZZZ9.99.             00810000
008200             15  PC-PD-TEXT-4         PIC X(15) VALUE             00820000
008300             ' SKU GRP RTL : '.                                   00830000
008400             15  PC-PD-SKU-GP-RTL     PIC ZZZZZZ9.99.             00840000
008500*    05  PC-PRICE-CHG-TEXT.                                       00850000
008600*        10  PC-PRICE-CHG-TEXT-1.                                 00860000
008700*            15  PC-PC-TEXT-1         PIC X(15) VALUE             00870000
008800*            'PO UNIT RTL  : '.                                   00880000
008900*            15  PC-PC-PO-UNT-RTL     PIC ZZZZZZ9.99.             00890000
009000*            15  PC-PC-TEXT-2         PIC X(15) VALUE             00900000
009100*            ' PPC UNIT RTL: '.                                   00910000
009200*            15  PC-PC-PPC-UNT-RTL    PIC ZZZZZZ9.99.             00920000
009300*        10  PC-PRICE-CHG-TEXT-2.                                 00930000
009400*            15  PC-PC-TEXT-5         PIC X(21) VALUE             00940000
009500*            'PO GRP QTY   :       '.                             00950000
009600*            15  PC-PC-PO-GP-QTY      PIC ZZZ9.                   00960000
009700*            15  PC-PC-TEXT-5         PIC X(21) VALUE             00970000
009800*            ' PPC GRP QTY :       '.                             00980000
009900*            15  PC-PC-PPC-GP-QTY     PIC ZZZ9.                   00990000
010000*        10  PC-PRICE-CHG-TEXT-3.                                 01000000
010100*            15  PC-PC-TEXT-3         PIC X(15) VALUE             01010000
010200*            'PO GRP RTL   : '.                                   01020000
010300*            15  PC-PC-PO-GP-RTL      PIC ZZZZZZ9.99.             01030000
010400*            15  PC-PC-TEXT-4         PIC X(15) VALUE             01040000
010500*            ' PPC GRP RTL : '.                                   01050000
010600*            15  PC-PC-PPC-GP-RTL     PIC ZZZZZZ9.99.             01060000
010700                                                                  01070000
010800 01  PS-PROGRAM-SWITCHES.                                         01080000
010900     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        01090000
011000         88  PS-NOT-DONE                        VALUE 'N'.        01100000
011100         88  PS-DONE                            VALUE 'Y'.        01110000
011200     05  PS-TALLPLN-DISTRO-SW         PIC  X    VALUE 'N'.        01120000
011300         88  PS-NO-TALLPLN-DISTRO               VALUE 'N'.        01130000
011400         88  PS-TALLPLN-DISTRO                  VALUE 'Y'.        01140000
011500     05  PS-TMESTDS-DISTRO-SW         PIC  X    VALUE 'N'.        01150000
011600         88  PS-NO-TMESTDS-DISTRO               VALUE 'N'.        01160000
011700         88  PS-TMESTDS-DISTRO                  VALUE 'Y'.        01170000
011800     05  PS-ALLOC-SW                  PIC  X    VALUE 'N'.        01180000
011900         88  PS-DONT-DO-ALLOC                   VALUE 'N'.        01190000
012000         88  PS-DO-ALLOC                        VALUE 'Y'.        01200000
012100*    05  PS-DISCREPANCY-SW            PIC  X    VALUE 'N'.        01210000
012200*        88  PS-NO-DISCREPANCY                  VALUE 'N'.        01220000
012300*        88  PS-DISCREPANCY                     VALUE 'Y'.        01230000
012310     05  PS-WEB-TROUBLE-SW            PIC  X    VALUE 'N'.        01231000
012320         88  PS-NO-WEB-TROUBLE                  VALUE 'N'.        01232000
012330         88  PS-WEB-TROUBLE                     VALUE 'Y'.        01233000
012331     05  PS-PACK-BY-STORE-SW          PIC  X    VALUE 'N'.        01233100
012332         88  PS-NO-PACK-BY-STORE                VALUE 'N'.        01233200
012333         88  PS-PACK-BY-STORE                   VALUE 'Y'.        01233300
012337     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        01233400
012338         88  PS-CALL-API-NO                     VALUE 'N'.        01233500
012339         88  PS-CALL-API-YES                    VALUE 'Y'.        01233600
012340                                                                  01233700
012350 01  PV-PROGRAM-VARIABLES.                                        01233800
012380     05  DK-SKU-SEQ                   PIC X(03).                  01233900
012390     05  DK-INTR-UPC-ID               PIC S9(09) COMP.            01234000
012400     05  DK-FROM-TMST                 PIC X(26).                  01235000
012500     05  DK-TO-TMST                   PIC X(26).                  01236000
012501     05  DK-ITM-NBR                   PIC S9(15)V COMP-3.         01237000
012513                                                                  01238000
012520     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        01239000
012530                                                COMP SYNC.        01240000
012540     05  PV-DB2-COUNT                 PIC S9(09) VALUE +0         01250000
012550                                                 COMP-3.          01251000
012560     05  PV-FROM-TMST.                                            01252000
012570         10  PV-FROM-DATE    PIC X(10).                           01253000
012580         10  FILLER          PIC X(16) VALUE '-00.00.00.000000'.  01254000
012590                                                                  01255000
012600     05  PV-TO-TMST.                                              01256000
012700         10  PV-TO-DATE      PIC X(10).                           01257000
012701         10  FILLER          PIC X(16) VALUE '-23.59.59.999999'.  01258000
012702                                                                  01259000
012703                                                                  01260000
012704                                                                  01270000
012705     05  PV-EIBDATE.                                              01270100
012706         10  PV-EIBDATE-N             PIC 9(5).                   01270200
012707         10  FILLER                   PIC X(5).                   01270300
012708                                                                  01270400
012709     05  PV-CURRENT-DATE              PIC X(10).                  01270500
012710     05  PV-DB2-START-DATE            PIC X(10).                  01270600
012720     05  PV-DB2-END-DATE              PIC X(10).                  01270700
012730*    05  PV-STORE-NUMBER.                                         01270800
012740*        10  PV-STORE-NUMBER-N        PIC 9(4).                   01270900
012750                                                                  01271000
012760     05  PV-TEMP-AMT                  PIC 9(7)V9(2).              01272000
012770     05  PV-TEMP-QTY                  PIC 9(4).                   01273000
012780                                                                  01274000
012790     05  PV-OP.                                                   01275000
012800         10  PV-OP-N                  PIC 9(4).                   01276000
012900     05  PV-FCLTY.                                                01277000
013000         10  PV-FCLTY-N               PIC 9.                      01278000
013100     05  PV-PO.                                                   01279000
013200         10  PV-PO-N                  PIC 9(8).                   01280000
013300     05  PV-LINE.                                                 01290000
013400         10  PV-LINE-N                PIC 999.                    01300000
013500     05  PV-REC-SEQ-NBR.                                          01310000
013600         10  PV-REC-SEQ-NBR-N         PIC 999.                    01320000
013700                                                                  01330000
013800 01  PRV-PROGRAM-RETURN-VARIABLES.                                01340000
013900     05  PRV-00                       PIC X(42) VALUE             01350000
014000         '00PROGRAM CALL WAS SUCCESSFUL             '.            01360000
014100     05  PRV-01                       PIC X(42) VALUE             01370000
014200         '01DIDNT ALLOCATE TO STORES DUE TO TROUBLE '.            01380000
014300     05  PRV-2A                       PIC X(42) VALUE             01390000
014400         '2ARECORD NOT FOUND - TALLPLN SELECT       '.            01400000
014500     05  PRV-2B                       PIC X(42) VALUE             01410000
014600         '2BDB2-ERROR - TALLPLN SELECT              '.            01420000
014700     05  PRV-2C                       PIC X(42) VALUE             01430000
014800         '2CDB2-ERROR - TRECEIV SELECT              '.            01440000
014900     05  PRV-2D                       PIC X(42) VALUE             01450000
015000         '2DDB2-ERROR - TPURITM SELECT              '.            01460000
015100     05  PRV-2E                       PIC X(42) VALUE             01470000
015200         '2EDB2-ERROR - XLV_SKU SELECT              '.            01480000
015300*    05  PRV-2F                       PIC X(42) VALUE             01490000
015400*        '2FDB2-ERROR - TCOCNTL SELECT              '.            01500000
015500*    05  PRV-2G                       PIC X(42) VALUE             01510000
015600*        '2GDB2-ERROR - PRICE-CHANGE-CSR OPEN       '.            01520000
015700*    05  PRV-2H                       PIC X(42) VALUE             01530000
015800*        '2HDB2-ERROR - PRICE-CHANGE-CSR FETCH      '.            01540000
015900*    05  PRV-2I                       PIC X(42) VALUE             01550000
016000*        '2IDB2-ERROR - PRICE-CHANGE-CSR CLOSE      '.            01560000
016300     05  PRV-2K                       PIC X(42) VALUE             01570000
016400         '2KDB2-ERROR - TMESTDS SELECT              '.            01580000
016500     05  PRV-2L                       PIC X(42) VALUE             01590000
016600         '2LDB2-ERROR - XLV_STR SELECT              '.            01600000
016700     05  PRV-2M                       PIC X(42) VALUE             01610000
016800         '2MDB2-ERROR - TWEBITM SELECT              '.            01620000
016810     05  PRV-2N                       PIC X(42) VALUE             01630000
016820         '2NDB2-ERROR - TRECEIV SELECT              '.            01640000
016810     05  PRV-2O                       PIC X(42) VALUE             01650000
016820         '2ODB2-ERROR - XLT_LOC OR XLT_DC_LOC_ASGMT '.            01660000
016900     05  PRV-TM500-RETURN-MSG.                                    01670000
017000         10  PRV-PGM                  PIC X(3).                   01680000
017100         10  FILLER                   PIC X(1).                   01690000
017200         10  PRV-PARA                 PIC X(4).                   01700000
017300         10  FILLER                   PIC X(1).                   01710000
017400         10  PRV-TBL                  PIC X(7).                   01720000
017500         10  FILLER                   PIC X(1).                   01730000
017600         10  PRV-OP                   PIC X(4).                   01740000
017700         10  FILLER                   PIC X(1).                   01750000
017800         10  PRV-FCLTY                PIC X(1).                   01760000
017900         10  FILLER                   PIC X(1).                   01770000
018000         10  PRV-PO                   PIC X(8).                   01780000
018100         10  FILLER                   PIC X(1).                   01790000
018200         10  PRV-LINE                 PIC X(3).                   01800000
018300         10  FILLER                   PIC X(1).                   01810000
018400         10  PRV-REC-SEQ-NBR          PIC X(3).                   01820000
018500*        10  FILLER                   PIC X(1).                   01830000
018600                                                                  01840000
018700******************************************************************01850000
018800*    COPYBOOK AREA                                                01860000
018900******************************************************************01870000
019000     COPY TMWS500.                                                01880000
019100                                                                  01890000
019200******************************************************************01900000
019300*    CALENDAR VARIABLES                                           01910000
019400******************************************************************01920000
019500     COPY DPWS500.                                                01930000
019600                                                                  01940000
019610******************************************************************01950000
019620* COPY BOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 230ZZ  *01960000
019630******************************************************************01961000
019641     COPY XLWS001.                                                01962000
019710*                                                                 01963000
024360******************************************************************01964000
024370* LOCATION MASTER INFORMATION - CALLED MODULE PARAMETERS          01965000
024380******************************************************************01966000
           COPY XLWS071.                                                01967000
019710*                                                                 01968000
019720******************************************************************01969000
019800*    DB2 SQL COMMUNICATION AREA                                   01970000
019900******************************************************************01980000
020000     EXEC SQL                                                     01990000
020100          INCLUDE SQLCA                                           02000000
020200     END-EXEC.                                                    02010000
020300                                                                  02020000
020400******************************************************************02030000
020500*    DB2 DCLGEN FOR PURCHASE TABLE                                02040000
020600******************************************************************02050000
020700     EXEC SQL                                                     02060000
020800          INCLUDE TPURCHS                                         02070000
020900     END-EXEC.                                                    02080000
021000                                                                  02090000
021100******************************************************************02100000
021200*    DB2 DCLGEN FOR PURCHASE ITEM TABLE                           02110000
021300******************************************************************02120000
021400     EXEC SQL                                                     02130000
021500          INCLUDE TPURITM                                         02140000
021600     END-EXEC.                                                    02150000
021700                                                                  02160000
021800******************************************************************02170000
021900*    DB2 DCLGEN FOR ALLOCATION PLAN TABLE                         02180000
022000******************************************************************02190000
022100     EXEC SQL                                                     02200000
022200          INCLUDE TALLPLN                                         02210000
022300     END-EXEC.                                                    02220000
022400                                                                  02230000
022500******************************************************************02240000
022600*    DB2 DCLGEN FOR MERCHANDISE STORE DISTRIBUTION TABLE          02250000
022700******************************************************************02260000
022800     EXEC SQL                                                     02270000
022900          INCLUDE TMESTDS                                         02280000
023000     END-EXEC.                                                    02290000
023100                                                                  02300000
023840                                                                  02310000
023900******************************************************************02320000
024000*    DB2 DCLGEN FOR COMPANY CONTROL TABLE                         02330000
024100******************************************************************02340000
024200*    EXEC SQL                                                     02350000
024300*         INCLUDE TCOCNTL                                         02360000
024400*    END-EXEC.                                                    02370000
024500                                                                  02380000
024600******************************************************************02390000
024700*    DB2 DCLGEN FOR CENTRAL PERMANENT PRICE CHANGE (PPC) TABLE    02400000
024800******************************************************************02410000
024900*    EXEC SQL                                                     02420000
025000*         INCLUDE TCENPPC                                         02430000
025100*    END-EXEC.                                                    02440000
025200                                                                  02450000
025300******************************************************************02460000
025400*    DB2 DCLGEN FOR CENTRAL PPC DETAIL TABLE                      02470000
025500******************************************************************02480000
025600*    EXEC SQL                                                     02490000
025700*         INCLUDE TCPPCDT                                         02500000
025800*    END-EXEC.                                                    02510000
025900                                                                  02520000
027805******************************************************************02530000
027806     EXEC SQL                                                     02540000
027807          INCLUDE TRECEIV                                         02550000
027808     END-EXEC.                                                    02560000
027809                                                                  02570000
027810******************************************************************02580000
027820*    DECLARE PRICE CHANGE CURSOR                                  02590000
027830******************************************************************02600000
027840*    EXEC SQL                                                     02610000
027850*         DECLARE PRICE-CHANGE-CSR CURSOR FOR                     02620000
027860*         SELECT A.NEW_RTL_AMT                                    02630000
027870*              , A.NEW_RTL_GP_AMT                                 02640000
027880*              , A.NEW_RTL_GP_QTY                                 02650000
027890*              , B.EFF_DTE                                        02660000
027900*           FROM TCPPCDT A                                        02670000
028000*              , TCENPPC B                                        02680000
028100*          WHERE A.OPERCO_NBR    = B.OPERCO_NBR                   02690000
028200*            AND A.CENPPC_NBR    = B.CENPPC_NBR                   02700000
028300*            AND A.TSK_ITEM_NMBR = :PURITM-ITM-NBR                02710000
028400*            AND B.DOC_TYP_CDE   = :PC-C                          02720000
028500*            AND (B.STATUS_CDE   = :PC-AP OR                      02730000
028600*                 B.STATUS_CDE   = :PC-IP   )                     02740000
028700*            AND CHAR(DATE(B.EFF_DTE),ISO) BETWEEN                02750000
028800*                 :PV-DB2-START-DATE AND :PV-DB2-END-DATE         02760000
028900*          ORDER BY B.EFF_DTE                                     02770000
029000*    END-EXEC.                                                    02780000
029100                                                                  02790000
029200 LINKAGE SECTION.                                                 02800000
029300                                                                  02810000
029400 01  DFHCOMMAREA.                                                 02820000
029500     05  FILLER                       OCCURS 1 TO 600  TIMES      02830000
029600                                      DEPENDING ON EIBCALEN.      02840000
029700         10  FILLER                   PIC X.                      02850000
029800                                                                  02860000
029900                                                                  02870000
030000 PROCEDURE DIVISION.                                              02880000
030100                                                                  02890000
030200 0000-MAIN-MODULE.                                                02900000
030300                                                                  02910000
030400     PERFORM 1000-INITIAL-PROCESS.                                02920000
030500                                                                  02930000
030600     IF PS-NOT-DONE                                               02940000
030700         PERFORM 2000-MAIN-PROCESS                                02950000
030800     END-IF.                                                      02960000
030900                                                                  02970000
031000     MOVE TM500-FIELDS TO DFHCOMMAREA.                            02980000
031100                                                                  02990000
031200     GOBACK.                                                      03000000
031300                                                                  03010000
031400                                                                  03020000
031500 1000-INITIAL-PROCESS.                                            03030000
031600                                                                  03040000
031700     INITIALIZE TM500-FIELDS.                                     03050000
031800                                                                  03060000
031900     IF EIBCALEN = 0                                              03070000
032000         SET PS-DONE            TO TRUE                           03080000
032100     ELSE                                                         03090000
032200         SET  PS-NO-TALLPLN-DISTRO TO TRUE                        03100000
032300         SET  PS-NO-TMESTDS-DISTRO TO TRUE                        03110000
032400         SET  PS-DONT-DO-ALLOC     TO TRUE                        03120000
032500*        SET  PS-NO-DISCREPANCY    TO TRUE                        03130000
032600         MOVE DFHCOMMAREA          TO TM500-FIELDS                03140000
032700         MOVE PRV-00               TO TM500-RETURN-DATA           03150000
032800         SET  TM500-NO-TROUBLE     TO TRUE                        03160000
032900     END-IF.                                                      03170000
033000                                                                  03180000
033100*SET PV-CURRENT-DATE FOR TWEBITM TABLE.                           03190000
033200     EXEC SQL                                                     03200000
033300         SET :PV-CURRENT-DATE = CURRENT DATE                      03210000
033400     END-EXEC.                                                    03220000
033500                                                                  03230000
033600*SET PV-CURRENT-DATE-TMST FOR TWEBITM TABLE.                      03240000
033700     MOVE PV-CURRENT-DATE     TO PV-FROM-DATE                     03250000
033710                                 PV-TO-DATE.                      03260000
033720                                                                  03270000
033730     MOVE PV-FROM-TMST        TO DK-FROM-TMST.                    03280000
033740     MOVE PV-TO-TMST          TO DK-TO-TMST.                      03290000
033750                                                                  03300000
033760                                                                  03310000
033770                                                                  03320000
033780 2000-MAIN-PROCESS.                                               03330000
033790******************************************************************03340000
033800*    THIS PARAGRAPH CHECKS TABLES TPURITM, TALLPLN AND TSK        03350000
033900*    TO VALIDATE PO LINES.                                        03360000
034000******************************************************************03370000
034100                                                                  03380000
034200     PERFORM 2200-LINE-TROUBLE-CHECK                              03390000
034300                                                                  03400000
034400* DO NOT DO THE DISTRO CHECKS IF THE LINE IS CANCELLED            03410000
034500* (PS-DO-ALLOC SIGNIFIES THAT THE LINE IS NOT CANCELLED)          03420000
034600     IF PS-NOT-DONE AND PS-DO-ALLOC                               03430000
034700         PERFORM 2100-NO-DISTRO-CHECK                             03440000
034800     END-IF.                                                      03450000
034900                                                                  03460000
035000*    IF PS-NOT-DONE AND PS-DO-ALLOC AND                           03470000
035100*       (PURITM-SKU-SEQ-NBR NOT = PC-000) AND                     03480000
035200*       (PURITM-SKU-SEQ-NBR NOT = PC-999)                         03490000
035600*        PERFORM 2400-PRICE-CHANGE-CHECK                          03500000
035800*    END-IF.                                                      03510000
035900                                                                  03520000
036000     IF PS-NOT-DONE AND PS-DO-ALLOC AND TM500-CREATE-AUTO         03530000
036100         PERFORM 2500-CALL-DISTRO-ROUTINE                         03540000
036200     END-IF.                                                      03550000
036300                                                                  03560000
036400                                                                  03570000
036500 2100-NO-DISTRO-CHECK.                                            03580000
036600******************************************************************03590000
036700******************************************************************03600000
036800                                                                  03610000
036900                                                                  03620000
037000     IF PS-NOT-DONE                                               03630000
037100         PERFORM 2120-GET-TALLPLN                                 03640000
037200     END-IF.                                                      03650000
037300                                                                  03660000
037400     IF PS-NOT-DONE AND PS-TALLPLN-DISTRO                         03670000
037500        PERFORM 2130-GET-TMESTDS                                  03680000
037600     END-IF.                                                      03690000
037700                                                                  03700000
037800***************************************************************   03710000
037900* RESOLVE A 'MISDIRECT' TROUBLE RECORD.  TALLPLN DOES NOT HAVE    03720000
038000* TO EXIST IN ORDER TO RESOLVE THIS TROUBLE.                      03730000
038100*                                                                 03740000
038200* RESOLVE A 'NO DISTRO' TROUBLE RECORD ONLY IF BOTH               03750000
038300* TALLPLN AND TMESTDS EXIST.                                      03760000
038400*                                                                 03770000
038500* CREATE 'MISDIRECT' TROUBLE IF TALLPLN DOES NOT EXIST.           03780000
038600* THE SPLIT FOR THE DC ON THIS RECEIPT MAY NOT HAVE BEEN ADDED.   03790000
038700* IF THE SPLIT IS DELETED BEFORE THE PURCHASE ORDER IS RELEASED,  03800000
038800* THE TALLPLN ROW IS DELETED.  IF THE SPLIT IS ADDED AFTER THE    03810000
038900* PURCHASE ORDER IS RELEASED AND THE SPLIT IS THEN DELETED, THE   03820000
039000* TALLPLN ROW IS DELETED.                                         03830000
039100*                                                                 03840000
039200* CREATE 'NO DISTRO' TROUBLE IF ONLY TMESTDS DOES NOT EXIST.      03850000
039300* THIS TROUBLE WOULD BE CREATED IF THE DISTRO WAS DELETED OR IF   03860000
039400* THE SPLIT WAS DELETED AFTER THE PURCHASE ORDER WAS RELEASED.    03870000
039500* THE TALLPLN IS NOT DELETED BUT THE SPLIT ORDER QUANTITY IS      03880000
039600* UPDATED TO ZERO.                                                03890000
039700***************************************************************   03900000
039800                                                                  03910000
039900     IF PS-NOT-DONE AND TM500-RESOLVE-AUTO                        03920000
040000        SET TM500-UPDATE TO TRUE                                  03930000
040100        MOVE PC-225 TO TM500-TRBL-RSN-CDE                         03940000
040200        PERFORM 3000-CREATE-TROUBLE-RECORD                        03950000
040300                                                                  03960000
040400        IF PS-TALLPLN-DISTRO AND PS-TMESTDS-DISTRO                03970000
040500           SET TM500-UPDATE TO TRUE                               03980000
040600           MOVE PC-222 TO TM500-TRBL-RSN-CDE                      03990000
040700           PERFORM 3000-CREATE-TROUBLE-RECORD                     04000000
040800        END-IF                                                    04010000
040900     ELSE                                                         04020000
040910         IF PS-NOT-DONE AND TM500-RESOLVE-SPECIFIC                04030000
040911             SET TM500-UPDATE TO TRUE                             04040000
040912             PERFORM 3000-CREATE-TROUBLE-RECORD                   04050000
040920         ELSE                                                     04060000
041000             IF PS-NO-TALLPLN-DISTRO                              04070000
041100                PERFORM 2150-MISDIRECT-TROUBLE                    04080000
041110         END-IF                                                   04090000
041120     END-IF.                                                      04100000
041200                                                                  04110000
041300     IF PS-NO-TALLPLN-DISTRO                                      04120000
041400           CONTINUE                                               04130000
041500     ELSE                                                         04140000
041600        IF PS-NO-TMESTDS-DISTRO                                   04150000
041700           PERFORM 2140-NO-DISTRO-TROUBLE.                        04160000
041800                                                                  04170000
041900     IF PS-NOT-DONE                                               04180000
042000        IF PS-NO-TALLPLN-DISTRO OR                                04190000
042100           PS-NO-TMESTDS-DISTRO                                   04200000
042200              SET PS-DONE TO TRUE                                 04210000
042300              MOVE PRV-01 TO TM500-RETURN-DATA                    04220000
042400        END-IF                                                    04230000
042500     END-IF.                                                      04240000
042600                                                                  04250000
042700                                                                  04260000
042800                                                                  04270000
042900 2120-GET-TALLPLN.                                                04280000
043000******************************************************************04290000
043100*    THIS PARAGRAPH CHECKS TABLE TALLPLN TO MAKE SURE THAT THERE  04300000
043200*    IS A PLAN ASSOCIATED WITH THIS PO.  IF NOT, PROCESSING STOPS 04310000
043300*    AND AN ERROR MESSAGE IS RETURNED TO THE CALLING PROGRAM.     04320000
043400******************************************************************04330000
043500                                                                  04340000
043600     PERFORM WITH TEST AFTER                                      04350000
043700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    04360000
043800         UNTIL   SQLCODE = +0 OR                                  04370000
043900                 SQLCODE = +100 OR                                04380000
044000                 PS-DONE OR                                       04390000
044100                 PV-RETRY-COUNTER > PC-MAX-RETRIES                04400000
044200                                                                  04410000
044300         EXEC SQL                                                 04420000
044400              SELECT PLAN_NBR                                     04430000
044500                INTO :ALLPLN-PLAN-NBR                             04440000
044600                FROM TALLPLN                                      04450000
044700               WHERE PO_NBR     = :TM500-PO-NBR                   04460000
044800                 AND PO_LNE_NBR = :PURITM-PO-LNE-NBR              04470000
044900                 AND DEST_NBR   = :TM500-OPER-UNT-ID              04480000
045000                 AND STATUS_CDE = :PC-AC                          04490000
045100         END-EXEC                                                 04500000
045200                                                                  04510000
045300         EVALUATE TRUE                                            04520000
045400             WHEN SQLCODE = +0                                    04530000
045500                  SET PS-TALLPLN-DISTRO TO TRUE                   04540000
045600                                                                  04550000
045700             WHEN SQLCODE = +100                                  04560000
045800                  SET PS-NO-TALLPLN-DISTRO TO TRUE                04570000
045900                  MOVE SQLCA       TO TM500-SQLCA                 04580000
046000                  MOVE SQLCODE     TO TM500-SQLCODE               04590000
046100                  MOVE PRV-2A      TO TM500-RETURN-DATA           04600000
046200                                                                  04610000
046300             WHEN SQLCODE = -904                                  04620000
046400             WHEN SQLCODE = -911                                  04630000
046500             WHEN SQLCODE = -913                                  04640000
046600                  CONTINUE                                        04650000
046700                                                                  04660000
046800             WHEN OTHER                                           04670000
046900                  SET PS-DONE  TO TRUE                            04680000
047000                  MOVE SQLCA   TO TM500-SQLCA                     04690000
047100                  MOVE SQLCODE TO TM500-SQLCODE                   04700000
047200                  MOVE PRV-2B  TO TM500-RETURN-DATA               04710000
047300                                                                  04720000
047400                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          04730000
047500                  MOVE '2120'    TO PRV-PARA                      04740000
047600                  MOVE 'TALLPLN' TO PRV-TBL                       04750000
047700                  PERFORM 9999-RETURN-MSG                         04760000
047800         END-EVALUATE                                             04770000
047900     END-PERFORM.                                                 04780000
048000                                                                  04790000
048100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04800000
048200         SET PS-DONE  TO TRUE                                     04810000
048300         MOVE SQLCA   TO TM500-SQLCA                              04820000
048400         MOVE SQLCODE TO TM500-SQLCODE                            04830000
048500         MOVE PRV-2B  TO TM500-RETURN-DATA                        04840000
048600                                                                  04850000
048700         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   04860000
048800         MOVE '2120'    TO PRV-PARA                               04870000
048900         MOVE 'TALLPLN' TO PRV-TBL                                04880000
049000         PERFORM 9999-RETURN-MSG                                  04890000
049100     END-IF.                                                      04900000
049200                                                                  04910000
049300                                                                  04920000
049400 2130-GET-TMESTDS.                                                04930000
049500******************************************************************04940000
049600******************************************************************04950000
049700                                                                  04960000
049800     PERFORM WITH TEST AFTER                                      04970000
049900         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    04980000
050000         UNTIL   SQLCODE = +0 OR                                  04990000
050100                 SQLCODE = -811 OR                                05000000
050200                 SQLCODE = +100 OR                                05010000
050300                 PS-DONE OR                                       05020000
050400                 PV-RETRY-COUNTER > PC-MAX-RETRIES                05030000
050500                                                                  05040000
050600         EXEC SQL                                                 05050000
050700              SELECT PO_NBR                                       05060000
050800                INTO :MESTDS-PO-NBR                               05070000
050900                FROM TMESTDS                                      05080000
051000               WHERE PO_NBR     = :TM500-PO-NBR                   05090000
051100                 AND PO_LNE_NBR = :PURITM-PO-LNE-NBR              05100000
051200                 AND PLAN_NBR   = :ALLPLN-PLAN-NBR                05110000
051300         END-EXEC                                                 05120000
051400                                                                  05130000
051500         EVALUATE TRUE                                            05140000
051600             WHEN SQLCODE = +0                                    05150000
051700             WHEN SQLCODE = -811                                  05160000
051800                  SET PS-TMESTDS-DISTRO TO TRUE                   05170000
051900                                                                  05180000
052000             WHEN SQLCODE = +100                                  05190000
052100                  SET PS-NO-TMESTDS-DISTRO TO TRUE                05200000
052200                                                                  05210000
052300             WHEN SQLCODE = -904                                  05220000
052400             WHEN SQLCODE = -911                                  05230000
052500             WHEN SQLCODE = -913                                  05240000
052600                  CONTINUE                                        05250000
052700                                                                  05260000
052800             WHEN OTHER                                           05270000
052900                  SET PS-DONE  TO TRUE                            05280000
053000                  MOVE SQLCA   TO TM500-SQLCA                     05290000
053100                  MOVE SQLCODE TO TM500-SQLCODE                   05300000
053200                  MOVE PRV-2K  TO TM500-RETURN-DATA               05310000
053300                                                                  05320000
053400                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          05330000
053500                  MOVE '2130'    TO PRV-PARA                      05340000
053600                  MOVE 'TMESTDS' TO PRV-TBL                       05350000
053700                  PERFORM 9999-RETURN-MSG                         05360000
053800         END-EVALUATE                                             05370000
053900     END-PERFORM.                                                 05380000
054000                                                                  05390000
054100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05400000
054200         SET PS-DONE  TO TRUE                                     05410000
054300         MOVE SQLCA   TO TM500-SQLCA                              05420000
054400         MOVE SQLCODE TO TM500-SQLCODE                            05430000
054500         MOVE PRV-2K  TO TM500-RETURN-DATA                        05440000
054600                                                                  05450000
054700         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   05460000
054800         MOVE '2130'    TO PRV-PARA                               05470000
054900         MOVE 'TMESTDS' TO PRV-TBL                                05480000
055000         PERFORM 9999-RETURN-MSG                                  05490000
055100     END-IF.                                                      05500000
055200                                                                  05510000
055300/                                                                 05520000
055400 2140-NO-DISTRO-TROUBLE.                                          05530000
055500******************************************************************05540000
055600******************************************************************05550000
055700                                                                  05560000
055800     SET TM500-ADD-DETAILS                                        05570000
055900         TM500-CREATE            TO TRUE                          05580000
056000     MOVE PC-222                 TO TM500-TRBL-RSN-CDE            05590000
056100     PERFORM 3000-CREATE-TROUBLE-RECORD                           05600000
056200                                                                  05610000
056300     SET TM500-NO-DETAILS                                         05620000
056400         TM500-IN-TROUBLE    TO TRUE.                             05630000
056500/                                                                 05640000
056600 2150-MISDIRECT-TROUBLE.                                          05650000
056700******************************************************************05660000
056800******************************************************************05670000
056900                                                                  05680000
057000     SET TM500-ADD-DETAILS                                        05690000
057100         TM500-CREATE            TO TRUE                          05700000
057200     MOVE PC-225                 TO TM500-TRBL-RSN-CDE            05710000
057300     PERFORM 3000-CREATE-TROUBLE-RECORD                           05720000
057400                                                                  05730000
057500     SET TM500-NO-DETAILS                                         05740000
057600         TM500-IN-TROUBLE    TO TRUE.                             05750000
057700                                                                  05760000
057800/                                                                 05770000
057900 2200-LINE-TROUBLE-CHECK.                                         05780000
058200                                                                  05790000
058210     INITIALIZE XL001-ITEM-COMMAREA.                              05800000
058220                                                                  05810000
058300     PERFORM 2210-GET-TPURITM-RECORD.                             05820000
058402                                                                  05830000
058410     IF    PS-CALL-API-YES          AND                           05840000
058411         ((DK-SKU-SEQ NOT = PC-000) AND                           05841000
058412          (DK-SKU-SEQ NOT = PC-999))                              05841100
058414                                                                  05841200
058419        PERFORM 2220-CALL-CICS-API-ARCH.                          05841300
W38216     PERFORM 2411-GET-DC.                                         05841400
W38216     IF XL071-E-BUS-IND = 'Y' AND                                 05841500
W38215        XL071-LOC-TYP-CDE = 'DC' AND                              05841600
058700        TM500-FCLTY-ID = PC-FCLTY-ID                              05841700
058811         IF  (XL001-WEB-ITEM-NOT-FOUND) OR                        05841800
058812            ((DK-SKU-SEQ = PC-000)       OR                       05841900
058813             (DK-SKU-SEQ = PC-999))                               05842000
058820             SET TM500-CREATE     TO TRUE                         05843000
058830             SET TM500-IN-TROUBLE TO TRUE                         05844000
058840             SET TM500-NO-DETAILS TO TRUE                         05845000
058841             MOVE PC-401          TO TM500-TRBL-RSN-CDE           05846000
058842             PERFORM 3000-CREATE-TROUBLE-RECORD                   05847000
058843         END-IF                                                   05848000
058844     END-IF.                                                      05849000
058845                                                                  05850000
058850**** MOVE TPURCHS.NEW_STR_PO_IND TO TMWS500 FIELD                 05860000
058851**** WHICH WILL BE USED IN RCKCS233                               05870000
058852     MOVE PURCHS-NEW-STR-PO-IND TO TM500-NEW-STR-PO-IND.          05880000
058853                                                                  05881000
058854**** IF TPURCHS.PO_TYP-CDE = 'IM', MOVE 'Y' TO                    05882000
058860**** TM500-IMPORT-ORDER-IND. MOVE TPURITM.PIC_ITM_IND TO          05883000
058870**** TM500-AD-ITM-IND. THESE FIELDS WILL BE USED IN RCKCS233      05884000
058880     IF PC-IMPORT-EXT                                             05885000
058890         MOVE PC-Y TO TM500-IMPORT-PO-IND                         05886000
058900     ELSE                                                         05887000
059000         MOVE PC-N TO TM500-IMPORT-PO-IND                         05888000
059100     END-IF.                                                      05889000
059200                                                                  05890000
059210     MOVE PURITM-PIC-ITM-IND TO TM500-AD-ITM-IND.                 05900000
059220                                                                  05910000
059230                                                                  05920000
059240     IF PURITM-STATUS-CDE = PC-CA OR PC-CM OR PC-CB OR PC-RV      05921000
059250         SET PS-DONT-DO-ALLOC TO TRUE                             05922000
059260         MOVE PRV-01 TO TM500-RETURN-DATA                         05923000
059270     ELSE                                                         05924000
059280         SET PS-DO-ALLOC TO TRUE                                  05925000
059290     END-IF.                                                      05926000
059300                                                                  05927000
059400* TRY TO RESOLVE ANY PRE-EXISTING LINE STATUS TROUBLES            05928000
059500     IF PS-DO-ALLOC AND TM500-RESOLVE-AUTO                        05929000
059600         SET TM500-UPDATE TO TRUE                                 05930000
059700         MOVE PC-522      TO TM500-TRBL-RSN-CDE                   05940000
059800         PERFORM 3000-CREATE-TROUBLE-RECORD                       05950000
059900                                                                  05960000
060000         IF PS-NOT-DONE                                           05970000
060100             SET TM500-UPDATE TO TRUE                             05980000
060200             MOVE PC-523      TO TM500-TRBL-RSN-CDE               05990000
060300             PERFORM 3000-CREATE-TROUBLE-RECORD                   06000000
060400         END-IF                                                   06010000
060500                                                                  06020000
060600         IF PS-NOT-DONE                                           06030000
060700             SET TM500-UPDATE TO TRUE                             06040000
060800             MOVE PC-524      TO TM500-TRBL-RSN-CDE               06050000
060900             PERFORM 3000-CREATE-TROUBLE-RECORD                   06060000
061000         END-IF                                                   06070000
061100                                                                  06080000
061200         IF PS-NOT-DONE                                           06090000
061300             SET TM500-UPDATE TO TRUE                             06100000
061400             MOVE PC-528      TO TM500-TRBL-RSN-CDE               06110000
061500             PERFORM 3000-CREATE-TROUBLE-RECORD                   06120000
061600         END-IF                                                   06130000
061700                                                                  06140000
061800         IF PS-NOT-DONE                                           06150000
061900             SET TM500-UPDATE TO TRUE                             06160000
062000             MOVE PC-529      TO TM500-TRBL-RSN-CDE               06170000
062100             PERFORM 3000-CREATE-TROUBLE-RECORD                   06180000
062200         END-IF                                                   06190000
062300                                                                  06200000
062400         IF PS-NOT-DONE                                           06210000
062500             SET TM500-UPDATE TO TRUE                             06220000
062600             MOVE PC-534      TO TM500-TRBL-RSN-CDE               06230000
062700             PERFORM 3000-CREATE-TROUBLE-RECORD                   06240000
062800         END-IF                                                   06250000
062900     END-IF.                                                      06260000
063000                                                                  06270000
063100* THE LINE STATUS IS CANCELLED.  A TROUBLE ROW MUST BE CREATED    06280000
063200     IF PS-NOT-DONE                                               06290000
063300         EVALUATE PURITM-STATUS-CDE                               06300000
063400         WHEN PC-CA                                               06310000
063500             SET TM500-CREATE TO TRUE                             06320000
063600             MOVE PC-522      TO TM500-TRBL-RSN-CDE               06330000
063700             MOVE TM500-UNITS-TO-ALLOC TO PC-LC-RCVD              06340000
063800             SET TM500-ADD-DETAILS TO TRUE                        06350000
063900             MOVE PC-RCKCS232 TO TM500-CRE-UID                    06360000
064000             MOVE PC-LINE-COMPLETE-TEXT TO TM500-FREEFORM-TEXT    06370000
064100             PERFORM 3000-CREATE-TROUBLE-RECORD                   06380000
064200                                                                  06390000
064300             SET TM500-IN-TROUBLE TO TRUE                         06400000
064400         WHEN PC-CM                                               06410000
064500             SET TM500-CREATE TO TRUE                             06420000
064600             MOVE PC-523      TO TM500-TRBL-RSN-CDE               06430000
064700             MOVE TM500-UNITS-TO-ALLOC TO PC-LC-RCVD              06440000
064800             SET TM500-ADD-DETAILS TO TRUE                        06450000
064900             MOVE PC-RCKCS232 TO TM500-CRE-UID                    06460000
065000             MOVE PC-LINE-COMPLETE-TEXT TO TM500-FREEFORM-TEXT    06470000
065100             PERFORM 3000-CREATE-TROUBLE-RECORD                   06480000
065200                                                                  06490000
065300             SET TM500-IN-TROUBLE TO TRUE                         06500000
065400         WHEN PC-CB                                               06510000
065500             SET TM500-CREATE TO TRUE                             06520000
065600             MOVE PC-524      TO TM500-TRBL-RSN-CDE               06530000
065700             MOVE TM500-UNITS-TO-ALLOC TO PC-LC-RCVD              06540000
065800             SET TM500-ADD-DETAILS TO TRUE                        06550000
065900             MOVE PC-RCKCS232 TO TM500-CRE-UID                    06560000
066000             MOVE PC-LINE-COMPLETE-TEXT TO TM500-FREEFORM-TEXT    06570000
066100             PERFORM 3000-CREATE-TROUBLE-RECORD                   06580000
066200                                                                  06590000
066300             SET TM500-IN-TROUBLE TO TRUE                         06600000
066310         WHEN PC-RV                                               06610000
066320             SET TM500-CREATE TO TRUE                             06620000
066330             MOVE PC-534      TO TM500-TRBL-RSN-CDE               06630000
066340             MOVE TM500-UNITS-TO-ALLOC TO PC-LC-RCVD              06631000
066350             SET TM500-ADD-DETAILS TO TRUE                        06632000
066360             MOVE PC-RCKCS232 TO TM500-CRE-UID                    06633000
066370             MOVE PC-LINE-COMPLETE-TEXT TO TM500-FREEFORM-TEXT    06634000
066380             PERFORM 3000-CREATE-TROUBLE-RECORD                   06635000
066390                                                                  06636000
066391             SET TM500-IN-TROUBLE TO TRUE                         06637000
066392         END-EVALUATE                                             06638000
066393     END-IF.                                                      06639000
066394/                                                                 06639100
066395 2210-GET-TPURITM-RECORD.                                         06639200
066396******************************************************************06639300
066397*    THIS PARAGRAPH CHECKS TABLE TPURITM.  IF THE PO LINE         06639400
066398*    IS COMPLETED OR CANCELLED, IT RETURNS A MESSAGE TO THE       06639500
066399*    CALLING PROGRAM NOT TO CREATE A RECEIPT DISTRIBUTION.        06639600
066400******************************************************************06639700
066500                                                                  06639800
066600     PERFORM WITH TEST AFTER                                      06639900
066700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    06640000
066800         UNTIL   SQLCODE = +0 OR                                  06650000
066900                 PS-DONE OR                                       06660000
067000                 PV-RETRY-COUNTER > PC-MAX-RETRIES                06670000
067100                                                                  06680000
067200         EXEC SQL                                                 06690000
067300              SELECT A.DEPT_NBR                                   06700000
067400                   , A.NEW_STR_PO_IND                             06710000
067500                   , A.PO_TYP_CDE                                 06720000
067600                   , B.PO_LNE_NBR                                 06730000
067700                   , B.SKU_SEQ_NBR                                06740000
067900                   , B.STATUS_CDE                                 06750000
068000                   , B.UNT_RTL_PR_AMT                             06760000
068100                   , B.GP_RTL_AMT                                 06770000
068200                   , B.GP_QTY                                     06780000
068300                   , B.PIC_ITM_IND                                06790000
068310                   , B.ITM_NBR                                    06800000
068400                INTO :PURCHS-DEPT-NBR                             06810000
068500                   , :PURCHS-NEW-STR-PO-IND                       06820000
068600                   , :PURCHS-PO-TYP-CDE                           06830000
068700                   , :PURITM-PO-LNE-NBR                           06840000
068800                   , :PURITM-SKU-SEQ-NBR                          06850000
069000                   , :PURITM-STATUS-CDE                           06860000
069100                   , :PURITM-UNT-RTL-PR-AMT                       06870000
069200                   , :PURITM-GP-RTL-AMT                           06880000
069300                   , :PURITM-GP-QTY                               06890000
069400                   , :PURITM-PIC-ITM-IND                          06900000
069410                   , :PURITM-ITM-NBR                              06910000
069500                FROM TPURCHS A                                    06920000
069600                   , TPURITM B                                    06930000
069700               WHERE A.PO_NBR         = B.PO_NBR                  06940000
069800                 AND A.VER_STATUS_CDE = B.VER_STATUS_CDE          06950000
069900                 AND B.VER_STATUS_CDE = :PC-A                     06960000
070000                 AND B.PO_NBR         = :TM500-PO-NBR             06970000
070100                 AND B.APP_PO_LNE_NBR = :TM500-PO-LNE-NBR         06980000
070200         END-EXEC                                                 06990000
070300*                                                                 07000000
070400         MOVE SPACES  TO PC-IMPORT                                07010000
070610                         DK-SKU-SEQ                               07020000
070620         MOVE ZEROS   TO DK-ITM-NBR                               07030000
070624                                                                  07040000
070630         EVALUATE TRUE                                            07050000
070640             WHEN SQLCODE = +0                                    07060000
070650                  SET  PS-CALL-API-YES    TO TRUE                 07061000
070651                  MOVE PURCHS-PO-TYP-CDE  TO PC-IMPORT            07062000
070680                  MOVE PURITM-SKU-SEQ-NBR TO DK-SKU-SEQ           07063000
070681                  MOVE PURITM-ITM-NBR     TO DK-ITM-NBR           07064000
070690                  CONTINUE                                        07065000
070700                                                                  07066000
070800             WHEN SQLCODE = -904                                  07067000
070900             WHEN SQLCODE = -911                                  07068000
071000             WHEN SQLCODE = -913                                  07069000
071100                  CONTINUE                                        07070000
071200                                                                  07080000
071300             WHEN OTHER                                           07090000
071400                  SET  PS-DONE TO TRUE                            07100000
071500                  MOVE SQLCA   TO TM500-SQLCA                     07110000
071600                  MOVE SQLCODE TO TM500-SQLCODE                   07120000
071700                  MOVE PRV-2D  TO TM500-RETURN-DATA               07130000
071800                                                                  07140000
071900                  MOVE SPACES    TO PRV-TM500-RETURN-MSG          07150000
072000                  MOVE '2210'    TO PRV-PARA                      07160000
072100                  MOVE 'TPURITM' TO PRV-TBL                       07170000
072200                  PERFORM 9999-RETURN-MSG                         07180000
072300         END-EVALUATE                                             07190000
072400     END-PERFORM.                                                 07200000
072500                                                                  07210000
072600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07220000
072700         SET  PS-DONE TO TRUE                                     07230000
072800         MOVE SQLCA   TO TM500-SQLCA                              07240000
072900         MOVE SQLCODE TO TM500-SQLCODE                            07250000
073000         MOVE PRV-2D  TO TM500-RETURN-DATA                        07260000
073100                                                                  07270000
073200         MOVE SPACES    TO PRV-TM500-RETURN-MSG                   07280000
073300         MOVE '2210'    TO PRV-PARA                               07290000
073400         MOVE 'TPURITM' TO PRV-TBL                                07300000
073500         PERFORM 9999-RETURN-MSG                                  07310000
073600     END-IF.                                                      07320000
073701                                                                  07330000
073709 2220-CALL-CICS-API-ARCH.                                         07340000
073712                                                                  07350000
073713        MOVE DK-ITM-NBR           TO XL001-KEY-ITM-NBR.           07360000
073714                                                                  07370000
073715        SET  XL001-BY-ITEM                                        07371000
073716             XL001-SELECT-SKU                                     07371100
073718             XL001-SELECT-WEB-SKU TO TRUE.                        07371200
073719                                                                  07371300
073720        CALL XL001-VSM-PGM USING  DFHEIBLK                        07371400
073721                                  XL001-COMMAREA                  07371500
073722                                  XL001-ITEM-COMMAREA.            07371600
073723     EVALUATE TRUE                                                07371700
073724                                                                  07371800
073728        WHEN XL001-SKU-SQLCODE = +0                               07371900
073729             CONTINUE                                             07372000
073730                                                                  07373000
073731        WHEN XL001-SKU-SQLCODE = +100                             07373100
073733             SET TM500-SKU-NOT-FOUND-FOR-LINE                     07373200
073734                                    TO TRUE                       07373300
073735             SET PS-DONE            TO TRUE                       07373400
073736             MOVE SQLCA             TO TM500-SQLCA                07373500
073737             MOVE XL001-SKU-SQLCODE TO TM500-SQLCODE              07373600
073738             MOVE SPACES            TO PRV-TM500-RETURN-MSG       07373700
073739             MOVE XL001-ERROR-PARAGRAPH-NBR                       07373800
073740                                    TO PRV-PARA                   07373900
073741             MOVE 'XLV_SKU'         TO PRV-TBL                    07374000
073742             PERFORM 9999-RETURN-MSG                              07374100
073743                                                                  07374200
073744        WHEN XL001-SKU-SQLCODE = -904                             07374300
073745        WHEN XL001-SKU-SQLCODE = -911                             07374400
073746        WHEN XL001-SKU-SQLCODE = -913                             07374500
073747             CONTINUE                                             07374600
073748                                                                  07374700
073749      WHEN OTHER                                                  07374800
073750             SET PS-DONE            TO TRUE                       07374900
073751             MOVE SQLCA             TO TM500-SQLCA                07375000
073752             MOVE XL001-SKU-SQLCODE TO TM500-SQLCODE              07375100
073753             MOVE PRV-2E            TO TM500-RETURN-DATA          07375200
073754             MOVE SPACES            TO PRV-TM500-RETURN-MSG       07375300
073755             MOVE XL001-ERROR-PARAGRAPH-NBR                       07375400
073756                                    TO PRV-PARA                   07375500
073757             MOVE 'XLKUT001'        TO PRV-TBL                    07375600
073758             PERFORM 9999-RETURN-MSG                              07375700
073759     END-EVALUATE.                                                07375800
073760                                                                  07375900
080300                                                                  07376000
086500******************************************************************07377000
086600******************************************************************07378000
086420*2400-PRICE-CHANGE-CHECK.                                         07379000
086700                                                                  07380000
086800*    PERFORM 2410-GET-CONTROL-DAYS.                               07390000
086900                                                                  07400000
087000*    IF PS-NOT-DONE                                               07410000
087100*        PERFORM 2420-GET-DATE-RANGE                              07420000
087200*    END-IF.                                                      07430000
087300                                                                  07440000
087400*    IF PS-NOT-DONE                                               07450000
087500*        PERFORM 2430-GET-PRICE-CHANGE                            07460000
087600*    END-IF.                                                      07470000
087700                                                                  07480000
087800*    IF PS-NOT-DONE                                               07490000
087900*        PERFORM 2440-PRICE-CHANGE-TROUBLE                        07500000
088000*    END-IF.                                                      07510000
088100                                                                  07520000
088200                                                                  07530000
088300*2410-GET-CONTROL-DAYS.                                           07540000
088400******************************************************************07550000
088500*    THIS PARAGRAPH RETRIEVES THE DAYS-PR-CHG-NBR OF COCNTL.      07560000
088600******************************************************************07570000
088700                                                                  07580000
      * * *  THE CHECK FOR CORPORATE (90) IS HERE BECAUSE XLKUT071      07590000
      * * *  IS GOING TO ALLOW A 'NOT FOUND' CONDITION ON TABLE         07600000
      * * *  XLT_DC_LOC_ASGMT TO BE XL071-NO-ERRORS WHEN 90 IS          07610000
      * * *  USED AS THE LOCATION-NUMBER                                07620000
      *    IF TM500-OPER-UNT-ID = 90                                    07630000
094700*        SET PS-DONE    TO TRUE                                   07640000
      *    ELSE                                                         07650000
088800*        PERFORM 2411-GET-DC                                      07660000
      *    END-IF.                                                      07670000
088900                                                                  07680000
089800*    IF PS-NOT-DONE                                               07690000
089900*        PERFORM 2413-GET-DAYS-PR-CHG-NBR                         07700000
090000*    END-IF.                                                      07710000
090100                                                                  07720000
      * TOM PRIMEAU 03/04/10 BEGIN*                                     07730000
W38216 2411-GET-DC.                                                     07740000
W38216     INITIALIZE XL071-COMMAREA-REC                                07750000
W38216     MOVE TM500-OPER-UNT-ID TO XL071-LOCATION-NUMBER              07760000
W38216     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    07770000
W38216                                      XL071-COMMAREA              07780000
W38216                                      XL071-COMMAREA-REC          07790000
W38216     EVALUATE TRUE                                                07800000
W38216         WHEN XL071-NO-ERRORS                                     07810000
W38216            CONTINUE                                              07820000
W38216         WHEN XL071-DC-ASGMT-NOT-FND                              07830000
W38216             SET PS-DONE    TO TRUE                               07840000
W38216         WHEN OTHER                                               07850000
W38216             SET PS-DONE    TO TRUE                               07860000
W38216             MOVE XL071-SQLCA                                     07870000
W38216                            TO TM500-SQLCA                        07880000
W38216             MOVE XL071-SQLCODE                                   07890000
W38216                            TO TM500-SQLCODE                      07900000
W38216             MOVE PRV-2O    TO TM500-RETURN-DATA                  07910000
W38216             MOVE SPACES    TO PRV-TM500-RETURN-MSG               07920000
W38216             MOVE '2411'    TO PRV-PARA                           07930000
W38216             MOVE XL071-DB2-TABLE                                 07940000
W38216                            TO PRV-TBL                            07950000
W38216             PERFORM 9999-RETURN-MSG                              07960000
W38216     END-EVALUATE.                                                07970000
100700*2413-GET-DAYS-PR-CHG-NBR.                                        07980000
100800******************************************************************07990000
100900*    THIS PARAGRAPH RETRIEVES THE DAYS-PR-CHG-NBR OF COCNTL.      08000000
101000******************************************************************08010000
101100                                                                  08020000
101200*    PERFORM WITH TEST AFTER                                      08030000
101300*        VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    08040000
101400*        UNTIL   SQLCODE = +0 OR                                  08050000
101500*                PS-DONE OR                                       08060000
101600*                PV-RETRY-COUNTER > PC-MAX-RETRIES                08070000
101700                                                                  08080000
101800*        EXEC SQL                                                 08090000
101900*             SELECT DAYS_PR_CHG_NBR                              08100000
102000*               INTO :COCNTL-DAYS-PR-CHG-NBR                      08110000
102100*               FROM TCOCNTL                                      08120000
102200*              WHERE OPER_UNT_ID = :COCNTL-OPER-UNT-ID            08130000
102300*                AND FCLTY_ID    = :TM500-FCLTY-ID                08140000
102400*        END-EXEC                                                 08150000
102500                                                                  08160000
102600*        EVALUATE TRUE                                            08170000
102700*            WHEN SQLCODE = +0                                    08180000
102800*                 CONTINUE                                        08190000
102900                                                                  08200000
103000*            WHEN SQLCODE = -904                                  08210000
103100*            WHEN SQLCODE = -911                                  08220000
103200*            WHEN SQLCODE = -913                                  08230000
103300*                 CONTINUE                                        08240000
103400                                                                  08250000
103500*            WHEN OTHER                                           08260000
103600*                 SET PS-DONE  TO TRUE                            08270000
103700*                 MOVE SQLCA   TO TM500-SQLCA                     08280000
103800*                 MOVE SQLCODE TO TM500-SQLCODE                   08290000
103900*                 MOVE PRV-2F  TO TM500-RETURN-DATA               08300000
104000                                                                  08310000
104100*                 MOVE SPACES    TO PRV-TM500-RETURN-MSG          08320000
104200*                 MOVE '2413'    TO PRV-PARA                      08330000
104300*                 MOVE 'TCOCNTL' TO PRV-TBL                       08340000
104400*                 PERFORM 9999-RETURN-MSG                         08350000
104500*        END-EVALUATE                                             08360000
104600*    END-PERFORM.                                                 08370000
104700                                                                  08380000
104800*    IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         08390000
104900*        SET PS-DONE  TO TRUE                                     08400000
105000*        MOVE SQLCA   TO TM500-SQLCA                              08410000
105100*        MOVE SQLCODE TO TM500-SQLCODE                            08420000
105200*        MOVE PRV-2F  TO TM500-RETURN-DATA                        08430000
105300                                                                  08440000
105400*        MOVE SPACES    TO PRV-TM500-RETURN-MSG                   08450000
105500*        MOVE '2413'    TO PRV-PARA                               08460000
105600*        MOVE 'TCOCNTL' TO PRV-TBL                                08470000
105700*        PERFORM 9999-RETURN-MSG                                  08480000
105800*    END-IF.                                                      08490000
105900                                                                  08500000
106000                                                                  08510000
106100*2420-GET-DATE-RANGE.                                             08520000
106200******************************************************************08530000
106300*    THIS PARAGRAPH CALCULATES THE END DATE FROM TODAYS DATE      08540000
106400*    USING DAYS-PR-CHG-NBR OF COCNTL TABLE.  THIS END DATE ALONG  08550000
106500*    WITH TODAY'S DATE (BEGIN DATE) WILL BE USED TO RETRIEVE      08560000
106600*    THE PRICE CHANGE THAT FALLS BETWEEN THESE DATES.             08570000
106700******************************************************************08580000
106800                                                                  08590000
106900*    INITIALIZE DPG51 DPG52                                       08600000
107000*               DPG53 DPG54                                       08610000
107100*               DPG55 DPG56.                                      08620000
107200*    MOVE EIBDATE                    TO PV-EIBDATE-N.             08630000
107300*    MOVE PV-EIBDATE                 TO DPG52-LK-DATE-INPUT.      08640000
107400                                                                  08650000
107500*    SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     08660000
107600*    SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     08670000
107700*    SET DPG52-LK-DTE-JULIAN         TO TRUE.                     08680000
107800                                                                  08690000
107900*    CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          08700000
108000*                          DPG53 DPG54                            08710000
108100*                          DPG55 DPG56.                           08720000
108200*                                                                 08730000
108300*    MOVE DPG55-DB2-ISO-DATE-FMT     TO PV-DB2-START-DATE.        08740000
108400                                                                  08750000
108500*    INITIALIZE DPG51 DPG52                                       08760000
108600*               DPG53 DPG54                                       08770000
108700*               DPG55 DPG56.                                      08780000
108800*    MOVE PV-EIBDATE                 TO DPG52-LK-DATE-INPUT.      08790000
108900                                                                  08800000
109000*    SET DPG51-INCREMENT-DATE        TO TRUE.                     08810000
109100*    SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     08820000
109200*    SET DPG52-LK-DTE-JULIAN         TO TRUE.                     08830000
109300                                                                  08840000
109400*    MOVE COCNTL-DAYS-PR-CHG-NBR     TO DPG51-INCR-DECR-DAYS-9.   08850000
109500                                                                  08860000
109600*    CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          08870000
109700*                          DPG53 DPG54                            08880000
109800*                          DPG55 DPG56.                           08890000
109900*                                                                 08900000
110000*    MOVE DPG55-DB2-ISO-DATE-FMT     TO PV-DB2-END-DATE.          08910000
110100                                                                  08920000
110200                                                                  08930000
110300*2430-GET-PRICE-CHANGE.                                           08940000
110400******************************************************************08950000
110500*    THIS PARAGRAPH RETRIEVES THE PRICE CHANGE'S AMOUNT AND       08960000
110600*    QUANTITY, COMPARES TO THE PO'S AMOUNT AND QUANTITY, AND      08970000
110700*    IF THERE IS A DIFFERENCE, RETURNS A MESSAGE TO THE CALLING   08980000
110800*    PROGRAM THAT THERE IS A PRICE DISCREPANCY.                   08990000
110900******************************************************************09000000
111000                                                                  09010000
111100*    PERFORM 2431-OPEN-PRICE-CHG-CSR.                             09020000
111200                                                                  09030000
111300*    IF PS-NOT-DONE                                               09040000
111400*        PERFORM 2432-FETCH-PRICE-CHG-CSR                         09050000
111500*        PERFORM 2433-CLOSE-PRICE-CHG-CSR                         09060000
111600*    END-IF.                                                      09070000
111700                                                                  09080000
111800                                                                  09090000
111900*2431-OPEN-PRICE-CHG-CSR.                                         09100000
112000******************************************************************09110000
112100******************************************************************09120000
112200                                                                  09130000
112300*    EXEC SQL                                                     09140000
112400*         OPEN PRICE-CHANGE-CSR                                   09150000
112500*    END-EXEC.                                                    09160000
112600                                                                  09170000
112700*    IF SQLCODE NOT = +0                                          09180000
112800*        SET PS-DONE  TO TRUE                                     09190000
112900*        MOVE SQLCA   TO TM500-SQLCA                              09200000
113000*        MOVE SQLCODE TO TM500-SQLCODE                            09210000
113100*        MOVE PRV-2G  TO TM500-RETURN-DATA                        09220000
113200                                                                  09230000
113300*        MOVE SPACES    TO PRV-TM500-RETURN-MSG                   09240000
113400*        MOVE '2431'    TO PRV-PARA                               09250000
113500*        MOVE 'TCPPCDT' TO PRV-TBL                                09260000
113600*        PERFORM 9999-RETURN-MSG                                  09270000
113700*    END-IF.                                                      09280000
113800                                                                  09290000
113900                                                                  09300000
114000*2432-FETCH-PRICE-CHG-CSR.                                        09310000
114100******************************************************************09320000
114200******************************************************************09330000
114300                                                                  09340000
114400*    EXEC SQL                                                     09350000
114500*         FETCH PRICE-CHANGE-CSR                                  09360000
114600*          INTO :CPPCDT-NEW-RTL-AMT                               09370000
114700*             , :CPPCDT-NEW-RTL-GP-AMT                            09380000
114800*             , :CPPCDT-NEW-RTL-GP-QTY                            09390000
114900*             , :CENPPC-EFF-DTE                                   09400000
115000*    END-EXEC.                                                    09410000
115100                                                                  09420000
115200*    EVALUATE TRUE                                                09430000
115300*        WHEN SQLCODE = +0                                        09440000
115400*             IF CPPCDT-NEW-RTL-AMT    = PURITM-UNT-RTL-PR-AMT    09450000
115500*                                     AND                         09460000
115600*                CPPCDT-NEW-RTL-GP-AMT = PURITM-GP-RTL-AMT        09470000
115700*                                     AND                         09480000
115800*                CPPCDT-NEW-RTL-GP-QTY = PURITM-GP-QTY            09490000
115900*                 SET PS-NO-DISCREPANCY TO TRUE                   09500000
116000*             ELSE                                                09510000
116100*                 SET PS-DISCREPANCY TO TRUE                      09520000
116200*             END-IF                                              09530000
116300                                                                  09540000
116400*        WHEN SQLCODE = +100                                      09550000
116500*             SET PS-NO-DISCREPANCY TO TRUE                       09560000
116600                                                                  09570000
116700*        WHEN OTHER                                               09580000
116800*             SET PS-DONE  TO TRUE                                09590000
116900*             MOVE SQLCA   TO TM500-SQLCA                         09600000
117000*             MOVE SQLCODE TO TM500-SQLCODE                       09610000
117100*             MOVE PRV-2H  TO TM500-RETURN-DATA                   09620000
117200                                                                  09630000
117300*             MOVE SPACES    TO PRV-TM500-RETURN-MSG              09640000
117400*             MOVE '2432'    TO PRV-PARA                          09650000
117500*             MOVE 'TCPPCDT' TO PRV-TBL                           09660000
117600*             PERFORM 9999-RETURN-MSG                             09670000
117700*    END-EVALUATE.                                                09680000
117800                                                                  09690000
117900                                                                  09700000
118000*2433-CLOSE-PRICE-CHG-CSR.                                        09710000
118100******************************************************************09720000
118200******************************************************************09730000
118300                                                                  09740000
118400*    EXEC SQL                                                     09750000
118500*         CLOSE PRICE-CHANGE-CSR                                  09760000
118600*    END-EXEC.                                                    09770000
118700                                                                  09780000
118800*    IF SQLCODE NOT = +0                                          09790000
118900*        SET PS-DONE  TO TRUE                                     09800000
119000*        MOVE SQLCA   TO TM500-SQLCA                              09810000
119100*        MOVE SQLCODE TO TM500-SQLCODE                            09820000
119200*        MOVE PRV-2I  TO TM500-RETURN-DATA                        09830000
119300                                                                  09840000
119400*        MOVE SPACES    TO PRV-TM500-RETURN-MSG                   09850000
119500*        MOVE '2433'    TO PRV-PARA                               09860000
119600*        MOVE 'TCPPCDT' TO PRV-TBL                                09870000
119700*        PERFORM 9999-RETURN-MSG                                  09880000
119800*    END-IF.                                                      09890000
119900                                                                  09900000
120000                                                                  09910000
120100*2440-PRICE-CHANGE-TROUBLE.                                       09920000
120200******************************************************************09930000
120300******************************************************************09940000
120400                                                                  09950000
120500*    IF PS-DISCREPANCY                                            09960000
120600*        SET TM500-CREATE        TO TRUE                          09970000
120601*                                                                 09980000
120700*        MOVE PC-134         TO TM500-TRBL-RSN-CDE                09990000
120800                                                                  10000000
120900*        SET  TM500-ADD-DETAILS  TO TRUE                          10010000
121000*        MOVE PC-RCKCS232        TO TM500-CRE-UID                 10020000
121100                                                                  10030000
121200*        COMPUTE PV-TEMP-AMT     =  PURITM-UNT-RTL-PR-AMT * 1     10040000
121300*        MOVE PV-TEMP-AMT        TO PC-PC-PO-UNT-RTL              10050000
121400                                                                  10060000
121500*        COMPUTE PV-TEMP-AMT     =  CPPCDT-NEW-RTL-AMT * 1        10070000
121600*        MOVE PV-TEMP-AMT        TO PC-PC-PPC-UNT-RTL             10080000
121700                                                                  10090000
121800*        COMPUTE PV-TEMP-QTY     =  PURITM-GP-QTY * 1             10100000
121900*        MOVE PV-TEMP-QTY        TO PC-PC-PO-GP-QTY               10110000
122000                                                                  10120000
122100*        COMPUTE PV-TEMP-QTY     =  CPPCDT-NEW-RTL-GP-QTY * 1     10130000
122200*        MOVE PV-TEMP-QTY        TO PC-PC-PPC-GP-QTY              10140000
122300                                                                  10150000
122400*        COMPUTE PV-TEMP-AMT     =  PURITM-GP-RTL-AMT * 1         10160000
122500*        MOVE PV-TEMP-AMT        TO PC-PC-PO-GP-RTL               10170000
122600                                                                  10180000
122700*        COMPUTE PV-TEMP-AMT     =  CPPCDT-NEW-RTL-GP-AMT * 1     10190000
122800*        MOVE PV-TEMP-AMT        TO PC-PC-PPC-GP-RTL              10200000
122900                                                                  10210000
123000*        MOVE PC-PRICE-CHG-TEXT  TO TM500-FREEFORM-TEXT           10220000
123100                                                                  10230000
123200*        PERFORM 3000-CREATE-TROUBLE-RECORD                       10240000
123300                                                                  10250000
123400*        SET  TM500-NO-DETAILS TO TRUE                            10260000
123500*    END-IF.                                                      10270000
123600                                                                  10280000
123700                                                                  10290000
123800 2500-CALL-DISTRO-ROUTINE.                                        10300000
123900******************************************************************10310000
124000******************************************************************10320000
124100                                                                  10330000
124200     EXEC CICS                                                    10340000
124300         LINK PROGRAM  (PC-RCKCS233)                              10350000
124400              COMMAREA (TM500-FIELDS)                             10360000
124500              LENGTH   (PC-600)                                   10370000
124600     END-EXEC.                                                    10380000
124700                                                                  10390000
124800     EVALUATE TRUE                                                10400000
124900         WHEN TM500-CALL-SUCCESSFUL                               10410000
125000         WHEN TM500-DUPLICATE-TROUBLE                             10420000
125100         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        10430000
125200              CONTINUE                                            10440000
125300                                                                  10450000
125400         WHEN OTHER                                               10460000
125500              SET PS-DONE TO TRUE                                 10470000
125600     END-EVALUATE.                                                10480000
125700                                                                  10490000
125800                                                                  10500000
125900 3000-CREATE-TROUBLE-RECORD.                                      10510000
126000******************************************************************10520000
126100******************************************************************10530000
126200                                                                  10540000
126300**** IF ((TM500-FREEFORM-TEXT > SPACES) AND                       10550000
126400****    TM500-ADD-DETAILS AND TM500-RESOLVE-AUTO AND              10560000
126500****    TM500-UPDATE)                                             10570000
126600****     SET TM500-NO-DETAILS TO TRUE                             10580000
126700**** END-IF.                                                      10590000
126800                                                                  10600000
126900     EXEC CICS                                                    10610000
127000         LINK PROGRAM  (PC-TMKCS521)                              10620000
127100              COMMAREA (TM500-FIELDS)                             10630000
127200              LENGTH   (PC-600)                                   10640000
127300     END-EXEC.                                                    10650000
127400                                                                  10660000
127500**** IF TM500-FREEFORM-TEXT > SPACES AND                          10670000
127600****    TM500-NO-DETAILS AND TM500-RESOLVE-AUTO AND TM500-UPDATE  10680000
127700****     SET TM500-ADD-DETAILS TO TRUE                            10690000
127800**** END-IF.                                                      10700000
127900                                                                  10710000
128000     EVALUATE TRUE                                                10720000
128100         WHEN TM500-CALL-SUCCESSFUL                               10730000
128200         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        10740000
128300         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       10750000
128400              CONTINUE                                            10760000
128500                                                                  10770000
128600*        WHEN TM500-CREATE AND TM500-DUPLICATE-TROUBLE            10780000
128700*             AND TM500-TRBL-RSN-CDE = PC-134                     10790000
128900*             CONTINUE                                            10800000
129000                                                                  10810000
129100         WHEN OTHER                                               10820000
129200              SET PS-DONE TO TRUE                                 10830000
129300     END-EVALUATE.                                                10840000
129600 9999-RETURN-MSG.                                                 10850000
129700******************************************************************10860000
129800******************************************************************10870000
129900                                                                  10880000
130000     COMPUTE PV-OP-N = TM500-OPER-UNT-ID * 1.                     10890000
130100     COMPUTE PV-FCLTY-N = TM500-FCLTY-ID * 1.                     10900000
130200     COMPUTE PV-PO-N = TM500-PO-NBR      * 1.                     10910000
130300     COMPUTE PV-LINE-N = TM500-PO-LNE-NBR * 1.                    10920000
130400     COMPUTE PV-REC-SEQ-NBR-N = TM500-REC-SEQ-NBR * 1.            10930000
130500                                                                  10940000
130600     MOVE '232'                 TO PRV-PGM.                       10950000
130700     MOVE PV-OP                 TO PRV-OP.                        10960000
130800     MOVE PV-FCLTY              TO PRV-FCLTY.                     10970000
130900     MOVE PV-PO                 TO PRV-PO.                        10980000
131000     MOVE PV-LINE               TO PRV-LINE.                      10990000
131100     MOVE PV-REC-SEQ-NBR        TO PRV-REC-SEQ-NBR.               11000000
131200                                                                  11010000
131300     MOVE PRV-TM500-RETURN-MSG  TO TM500-RETURN-MSG.              11020000
