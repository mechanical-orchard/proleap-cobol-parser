000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         XMKRP037.                                    00020000
000300 AUTHOR.             BOB MCASEY.                                  00030000
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       02-17-2003.                                  00050000
000600 DATE-COMPILED.                                                   00060000
000700*                                                                 00070000
000800******************************************************************00080010
000810*  COMPARES DATA FROM THE XMDOMAIN AND SYSTEM OF RECORD           00090010
000811*  XMT_STR_GP_TYP TABLE.                                          00100010
000820******************************************************************00110010
      *---------------------------------------------------------------* 00120009
      *    WR/PITS#     DATE        DESCRIPTION                       * 00130009
      *    --------   ----------   ---------------------------------  * 00140009
      *    WR24442    08/20/2003   INITIAL CREATION.                  * 00150009
      *---------------------------------------------------------------* 00160009
000800 ENVIRONMENT DIVISION.                                            00170000
000900                                                                  00180000
001000 CONFIGURATION SECTION.                                           00190000
001100                                                                  00200000
001200 SOURCE-COMPUTER.    IBM-3090.                                    00210000
001300 OBJECT-COMPUTER.    IBM-3090.                                    00220000
001400                                                                  00230000
001500 INPUT-OUTPUT SECTION.                                            00240000
001600                                                                  00250000
001700 FILE-CONTROL.                                                    00260000
001800                                                                  00270000
001900     SELECT XMT-INPUT-FILE       ASSIGN TO INP01.                 00280000
002000     SELECT RMS-INPUT-FILE       ASSIGN TO INP02.                 00290000
002100     SELECT ERROR-REPORT         ASSIGN TO RPT01.                 00300000
002200                                                                  00310000
002300 DATA DIVISION.                                                   00320000
002400                                                                  00330000
002500 FILE SECTION.                                                    00340000
002600                                                                  00350000
003300 FD  XMT-INPUT-FILE                                               00360000
003400     RECORDING MODE IS F                                          00370000
003500     BLOCK CONTAINS 0 RECORDS                                     00380000
003600     LABEL RECORDS ARE OMITTED.                                   00390000
003700 01  XMT-INPUT-RECORD                    PIC  X(32).              00400000
003800                                                                  00410000
002700 FD  RMS-INPUT-FILE                                               00420000
002800     RECORDING MODE IS F                                          00430000
002900     BLOCK CONTAINS 0 RECORDS                                     00440000
003000     LABEL RECORDS ARE OMITTED.                                   00450000
003100 01  RMS-INPUT-RECORD                    PIC  X(35).              00460000
003200                                                                  00470000
003900 FD  ERROR-REPORT                                                 00480000
004000     RECORDING MODE IS F                                          00490000
004100     BLOCK CONTAINS 0 RECORDS                                     00500000
004200     LABEL RECORDS ARE OMITTED.                                   00510000
004300 01  ERR-RPT-LINE                        PIC  X(200).             00520000
004400                                                                  00530000
004500 WORKING-STORAGE SECTION.                                         00540000
004600                                                                  00550000
005350                                                                  00560000
005351 01 PC-PROGRAM-CONSTANTS.                                         00570000
005352     05 PC-PGM-NAME           PIC X(08)  VALUE 'XMKRP037'.        00580000
005353                                                                  00590000
005360 01 PV-PROGRAM-VARIABLES.                                         00600000
005370     05 PV-XMT-KEY.                                               00610000
005380        10 PV-XMT-STR-GP-TYP-CDE PIC 9(04).                       00620000
005390     05 PV-XMT-STR-GP-CTG-NM     PIC X(30) VALUE SPACE.           00630000
005400                                                                  00640000
005410     05 PV-RMS-KEY.                                               00650000
005420         10 PV-RMS-STR-GP-TYP-CDE PIC 9(04).                      00660000
005430     05 PV-RMS-STR-GP-CTG-NM      PIC X(30) VALUE SPACE.          00670000
005431                                                                  00680000
005440     05 PV-PAGE-CNT               PIC S9(05)  VALUE ZERO.         00690000
005450     05 PV-LINE-CNT               PIC S9(04)  COMP VALUE ZERO.    00700000
005460     05 PV-MAX-LINES              PIC S9(04)  COMP VALUE +71.     00710000
005470                                                                  00720000
005480     05 PV-DISPLAY-CNT            PIC ZZZZ9.                      00730000
005492     05 PV-NBR-ERRORS             PIC S9(04)  COMP                00740000
005493                                                VALUE ZERO.       00750000
005494     05 PV-DATE-YYMMDD.                                           00760000
005495          10 PV-YYMMDD-YY       PIC X(02)  VALUE SPACE.           00770000
005496          10 PV-YYMMDD-MM       PIC X(02)  VALUE SPACE.           00780000
005497          10 PV-YYMMDD-DD       PIC X(02)  VALUE SPACE.           00790000
005498     05 PV-TIME-HHMMSS.                                           00800000
005499          10 PV-HHMMSS-HH       PIC X(02)  VALUE SPACE.           00810000
005500          10 PV-HHMMSS-MM       PIC X(02)  VALUE SPACE.           00820000
005501          10 PV-HHMMSS-SS       PIC X(02)  VALUE SPACE.           00830000
005502     05 PV-MESSAGE              PIC X(58)  VALUE SPACE.           00840000
005510                                                                  00850000
005530 01 RPT-TOTAL-LINE.                                               00860000
005540     05 FILLER     PIC  X(23) VALUE                               00870000
005550                         'TOTAL NUMBER OF ERRORS '.               00880000
005560     05 RPT-NBR-ERRORS PIC ZZZZZZ9.                               00890000
005561                                                                  00900000
005562 01 RPT-END-OF-REPORT-LINE.                                       00910000
005563     05 FILLER     PIC  X(21) VALUE                               00920000
005564                            '*** END OF REPORT ***'.              00930000
005565 01 PA-PROGRAM-ACCUMULATORS.                                      00940000
005566     05 PA-ERROR-MESSAGES      PIC 9(13) VALUE ZERO.              00950000
005567     05 PA-XMT-RECS-READ       PIC 9(13) VALUE ZERO.              00960000
005568     05 PA-RMS-RECS-READ       PIC 9(13) VALUE ZERO.              00970000
005569                                                                  00980000
005571 01 PS-PROGRAM-SWITCHES.                                          00990000
005572     05 PS-MORE-RMS-INPUT-RECS-SW PIC X(01)  VALUE 'Y'.           01000000
005573         88 PS-MORE-RMS-INPUT-RECS           VALUE 'Y'.           01010000
005574         88 PS-END-OF-RMS-INPUT-RECS         VALUE 'N'.           01020000
005575     05 PS-MORE-XMT-INPUT-RECS-SW PIC X(01)  VALUE 'Y'.           01030000
005576         88 PS-MORE-XMT-INPUT-RECS           VALUE 'Y'.           01040000
005577         88 PS-END-OF-XMT-INPUT-RECS         VALUE 'N'.           01050000
005578     05 PS-RMS-OR-XMT-ERR        PIC X(01)   VALUE '0'.           01060000
005579         88 PS-RMS-ERROR                     VALUE '1'.           01070000
005580         88 PS-XMT-ERROR                     VALUE '2'.           01080000
005581         88 PS-DATA-ERROR                    VALUE '3'.           01090000
005582                                                                  01100000
005583 01 RPT-REPORT-HEADING.                                           01110000
005584     05 FILLER     PIC  X(80)    VALUE SPACES.                    01120008
005585     05 FILLER     PIC  X(41)    VALUE                            01130000
005586         'XM STORE GROUP TYPE DATA INTEGRITY ERRORS'.             01140001
005587                                                                  01150000
005588 01 RPT-COL-HEADING-1.                                            01160000
005589     05 FILLER     PIC  X(01) VALUE SPACE.                        01170000
005590     05 FILLER     PIC  X(02) VALUE ALL '-'.                      01180000
005591     05 FILLER     PIC  X(03) VALUE 'KEY'.                        01190000
005592     05 FILLER     PIC  X(02) VALUE ALL '-'.                      01200000
005593                                                                  01210000
005594 01 RPT-COL-HEADING-2.                                            01220000
005595     05 FILLER     PIC  X(01) VALUE SPACE.                        01230000
005596     05 FILLER     PIC  X(19) VALUE 'STR_GP'.                     01240000
005597     05 FILLER     PIC  X(34) VALUE 'XMDOMAIN'.                   01250001
005598     05 FILLER     PIC  X(37) VALUE 'SYSTEM OF RECORD'.           01260000
005599     05 FILLER     PIC  X(07) VALUE 'MESSAGE'.                    01270000
005600                                                                  01280000
005601 01 RPT-COL-HEADING-3.                                            01290000
005602     05 FILLER     PIC  X(01) VALUE SPACE.                        01300000
005603     05 FILLER     PIC  X(19) VALUE 'TYP_CDE'.                    01310000
005604     05 FILLER     PIC  X(34) VALUE 'VALUE'.                      01320000
005605     05 FILLER     PIC  X(05) VALUE 'VALUE'.                      01330000
005606                                                                  01340000
005607 01 RPT-COL-HEADING-4.                                            01350000
005608     05 FILLER     PIC  X(132) VALUE ALL '-'.                     01360000
005612                                                                  01370000
005613 01 DL-DETAIL-LINE.                                               01380000
005614     05 FILLER              PIC  X(01) VALUE SPACE.               01390000
005615     05 DL-STR-GP-TYP-CDE   PIC  X(04) VALUE SPACE.               01400000
005616     05 FILLER              PIC  X(15) VALUE SPACE.               01410000
005617     05 DL-XMT-VALUE        PIC  X(30) VALUE SPACE.               01420000
005618     05 FILLER              PIC  X(06) VALUE SPACE.               01430000
005619     05 DL-RMS-VALUE        PIC  X(30) VALUE SPACE.               01440000
005620     05 FILLER              PIC  X(06) VALUE SPACE.               01450000
005621     05 DL-MESSAGE          PIC  X(58) VALUE SPACE.               01460000
005622                                                                  01470000
005300     COPY DPWS200O.                                               01480001
005301                                                                  01490000
004700     COPY HORD007.                                                01500001
004800                                                                  01510000
005310 01 XMT-REC.                                                      01520000
005320     05 XMT-STR-GP-TYP-CDE    PIC S9(04) COMP.                    01530000
005340     05 XMT-STR-GP-CTG-NM     PIC X(30)  VALUE SPACES.            01540003
      ******************************************************************01550003
005624 PROCEDURE DIVISION.                                              01560000
005625******************************************************************01570000
005640 0000-MAIN-MODULE.                                                01580000
005650                                                                  01590000
005681                                                                  01600000
005690       PERFORM 1000-INITIALIZE.                                   01610000
005691       PERFORM 7000-READ-XMT-INPUT-FILE.                          01620000
005692       PERFORM 7100-READ-RMS-INPUT-FILE.                          01630000
005693                                                                  01640000
005694       PERFORM 2000-PROCESS-RECS                                  01650000
005695          UNTIL (PS-END-OF-XMT-INPUT-RECS                         01660000
005696            AND PS-END-OF-RMS-INPUT-RECS).                        01670000
005700                                                                  01680000
005710       PERFORM 8400-WRITE-TOTALS.                                 01690000
005720                                                                  01700000
005800       CLOSE RMS-INPUT-FILE                                       01710000
005900             XMT-INPUT-FILE                                       01720000
006000             ERROR-REPORT.                                        01730000
006010                                                                  01740000
006100       DISPLAY '**** XMKRP037 STATISTICS ****'                    01750000
006200       DISPLAY 'TOTAL ERROR MESSAGES   : ' PA-ERROR-MESSAGES.     01760000
006300       DISPLAY 'TOTAL XMT RECORDS READ : ' PA-XMT-RECS-READ.      01770000
006400       DISPLAY 'TOTAL RMS RECORDS READ : ' PA-RMS-RECS-READ.      01780000
006500       DISPLAY ' '                                                01790000
006600                                                                  01800000
006700       STOP RUN.                                                  01810000
006710                                                                  01820000
006800 1000-INITIALIZE.                                                 01830000
006900                                                                  01840000
005660       OPEN INPUT RMS-INPUT-FILE                                  01850000
005670                  XMT-INPUT-FILE                                  01860000
005680            OUTPUT ERROR-REPORT.                                  01870000
                                                                        01880000
007000       ACCEPT PV-DATE-YYMMDD FROM DATE.                           01890000
007100       MOVE PV-YYMMDD-YY TO DP200O-RUN-YEAR.                      01900000
007200       MOVE PV-YYMMDD-MM TO DP200O-RUN-MONTH.                     01910000
007300       MOVE PV-YYMMDD-DD TO DP200O-RUN-DAY.                       01920000
007400                                                                  01930000
007500       ACCEPT PV-TIME-HHMMSS FROM TIME.                           01940000
007600       MOVE PV-HHMMSS-HH TO DP200O-RUN-HOUR.                      01950000
007700       MOVE PV-HHMMSS-MM TO DP200O-RUN-MINUTE.                    01960000
007800       MOVE PC-PGM-NAME  TO DP200O-PROGRAM-NAME.                  01970000
007900       MOVE 1            TO DP200O-REPORT-NUMBER.                 01980000
008000                                                                  01990000
008100       PERFORM 8100-WRITE-STD-RPT-HEADING.                        02000000
008200       PERFORM 8200-WRITE-REPORT-HEADING.                         02010000
008300       PERFORM 8300-WRITE-COLUMN-HEADING.                         02020000
008400                                                                  02030000
008500 2000-PROCESS-RECS.                                               02040000
008501                                                                  02050000
008510       MOVE HO007-SGT-STR-TYP-CDE   TO  PV-RMS-STR-GP-TYP-CDE.    02060000
008520       MOVE HO007-SGT-STR-GP-CTG-NM TO  PV-RMS-STR-GP-CTG-NM.     02070000
008530                                                                  02080000
008540       MOVE XMT-STR-GP-TYP-CDE  TO  PV-XMT-STR-GP-TYP-CDE.        02090000
008550       MOVE XMT-STR-GP-CTG-NM   TO  PV-XMT-STR-GP-CTG-NM.         02100000
008560                                                                  02110000
008561       IF PV-XMT-KEY = PV-RMS-KEY                                 02120000
008563          PERFORM 3000-COMPARE-FIELDS                             02130000
008564          PERFORM 7000-READ-XMT-INPUT-FILE                        02140000
008565          PERFORM 7100-READ-RMS-INPUT-FILE                        02150000
008566       ELSE                                                       02160000
008570           IF ((PV-RMS-KEY < PV-XMT-KEY)                          02170000
008580              OR PS-END-OF-XMT-INPUT-RECS) AND                    02180000
008590              PS-MORE-RMS-INPUT-RECS                              02190000
008591              MOVE '1' TO PS-RMS-OR-XMT-ERR                       02200000
008592              MOVE 'KEY ON SYSTEM OF RECORD TABLE ONLY'           02210006
008593                  TO PV-MESSAGE                                   02220000
008594              PERFORM 8000-WRITE-OUTPUT-REC                       02230000
008595              PERFORM 7100-READ-RMS-INPUT-FILE                    02240000
008596           ELSE                                                   02250000
008620              IF (PV-RMS-KEY > PV-XMT-KEY                         02260000
008630                    OR PS-END-OF-RMS-INPUT-RECS)                  02270000
008640                   AND PS-MORE-XMT-INPUT-RECS                     02280000
008650                 MOVE '2' TO PS-RMS-OR-XMT-ERR                    02290000
008660                 MOVE 'KEY ON XM DOMAIN TABLE ONLY'               02300006
008661                                                  TO PV-MESSAGE   02310000
008670                 PERFORM 8000-WRITE-OUTPUT-REC                    02320000
008680                 PERFORM 7000-READ-XMT-INPUT-FILE                 02330000
008690              END-IF                                              02340000
008691           END-IF                                                 02350000
008692       END-IF.                                                    02360000
008693                                                                  02370000
008694 3000-COMPARE-FIELDS.                                             02380000
008695                                                                  02390000
008696      EVALUATE TRUE                                               02400000
008697         WHEN HO007-SGT-STR-GP-CTG-NM NOT = XMT-STR-GP-CTG-NM     02410000
008703             MOVE '3' TO PS-RMS-OR-XMT-ERR                        02420000
008704             MOVE 'STORE GROUP NAME DATA DOES NOT MATCH'          02430000
008705                                                TO PV-MESSAGE     02440000
008706             PERFORM 8000-WRITE-OUTPUT-REC                        02450000
008708      END-EVALUATE.                                               02460000
008709                                                                  02470000
008710 7000-READ-XMT-INPUT-FILE.                                        02480000
008800                                                                  02490000
008900       INITIALIZE XMT-REC.                                        02500000
009000                                                                  02510000
009100       READ XMT-INPUT-FILE INTO XMT-REC                           02520000
009200           AT END SET PS-END-OF-XMT-INPUT-RECS TO TRUE.           02530000
             IF NOT PS-END-OF-XMT-INPUT-RECS                            02540004
009400           ADD 1 TO PA-XMT-RECS-READ                              02550004
             END-IF.                                                    02560004
009500                                                                  02570000
009600 7100-READ-RMS-INPUT-FILE.                                        02580000
009700                                                                  02590000
009800       INITIALIZE HO007-STR-GP-TYPE-DATA.                         02600000
009900                                                                  02610000
010000       READ RMS-INPUT-FILE INTO HO007-STR-GP-TYPE-DATA            02620000
010100            AT END SET PS-END-OF-RMS-INPUT-RECS TO TRUE.          02630000
010200                                                                  02640000
             IF NOT PS-END-OF-RMS-INPUT-RECS                            02650004
010300           ADD 1 TO PA-RMS-RECS-READ                              02660005
             END-IF.                                                    02670005
010400                                                                  02680000
010500 8000-WRITE-OUTPUT-REC.                                           02690000
010620                                                                  02700000
010700       IF PS-RMS-ERROR                                            02710000
010800          MOVE SPACES TO DL-DETAIL-LINE                           02720000
010900          MOVE PV-RMS-STR-GP-TYP-CDE TO DL-STR-GP-TYP-CDE         02730000
011000          MOVE PV-RMS-STR-GP-CTG-NM TO DL-RMS-VALUE               02740000
011100          MOVE PV-MESSAGE TO DL-MESSAGE                           02750000
011200       ELSE                                                       02760000
011300          IF PS-XMT-ERROR                                         02770000
011310             MOVE SPACES TO DL-DETAIL-LINE                        02780000
011400             MOVE PV-XMT-STR-GP-TYP-CDE TO DL-STR-GP-TYP-CDE      02790000
011500             MOVE PV-XMT-STR-GP-CTG-NM TO DL-XMT-VALUE            02800000
011600             MOVE PV-MESSAGE TO DL-MESSAGE                        02810000
011610          ELSE                                                    02820000
011611             MOVE SPACES TO DL-DETAIL-LINE                        02830000
011612             MOVE PV-RMS-STR-GP-TYP-CDE TO DL-STR-GP-TYP-CDE      02840000
011614             MOVE PV-RMS-STR-GP-CTG-NM TO DL-RMS-VALUE            02850000
011615             MOVE PV-XMT-STR-GP-CTG-NM TO DL-XMT-VALUE            02860000
011616             MOVE PV-MESSAGE TO DL-MESSAGE                        02870000
011620          END-IF                                                  02880000
011700       END-IF.                                                    02890000
011710                                                                  02900000
011800       IF PV-LINE-CNT > PV-MAX-LINES                              02910000
011810          PERFORM 8100-WRITE-STD-RPT-HEADING                      02920000
011820          PERFORM 8200-WRITE-REPORT-HEADING                       02930000
011830          PERFORM 8300-WRITE-COLUMN-HEADING                       02940000
011840       END-IF.                                                    02950000
011850                                                                  02960000
011900       WRITE ERR-RPT-LINE FROM DL-DETAIL-LINE                     02970000
012000             AFTER ADVANCING 1 LINE.                              02980000
012100       ADD +1 TO PV-LINE-CNT.                                     02990000
012200       MOVE 4095 TO RETURN-CODE.                                  03000000
012300       ADD 1 TO PA-ERROR-MESSAGES.                                03010000
012400                                                                  03020000
012500 8100-WRITE-STD-RPT-HEADING.                                      03030000
012600                                                                  03040000
012700       ADD 1  TO PV-PAGE-CNT.                                     03050000
012800       MOVE PV-PAGE-CNT TO DP200O-PAGE-NUMBER.                    03060000
012900       WRITE ERR-RPT-LINE FROM DP200O-STANDRD-HEADER-200-COLS     03070000
013000             AFTER ADVANCING PAGE.                                03080000
013100       MOVE +1 TO PV-LINE-CNT.                                    03090000
013200                                                                  03100000
013300 8200-WRITE-REPORT-HEADING.                                       03110000
013400                                                                  03120000
013500       WRITE ERR-RPT-LINE FROM RPT-REPORT-HEADING                 03130000
013600            AFTER ADVANCING 1 LINES.                              03140000
013700       ADD +1 TO PV-LINE-CNT.                                     03150000
013800                                                                  03160000
013900 8300-WRITE-COLUMN-HEADING.                                       03170000
013910                                                                  03180000
013920       WRITE ERR-RPT-LINE FROM RPT-COL-HEADING-1                  03190000
013930            AFTER ADVANCING 2 LINES.                              03200000
013940       WRITE ERR-RPT-LINE FROM RPT-COL-HEADING-2                  03210000
013950            AFTER ADVANCING 1 LINES.                              03220000
013960       WRITE ERR-RPT-LINE FROM RPT-COL-HEADING-3                  03230000
013970            AFTER ADVANCING 1 LINES.                              03240000
013971       WRITE ERR-RPT-LINE FROM RPT-COL-HEADING-4                  03250000
013972            AFTER ADVANCING 1 LINES.                              03260000
013980       ADD +5 TO PV-LINE-CNT.                                     03270000
014000                                                                  03280000
014100 8400-WRITE-TOTALS.                                               03290000
014101                                                                  03300000
014102       IF PV-LINE-CNT > PV-MAX-LINES                              03310000
014103          PERFORM 8100-WRITE-STD-RPT-HEADING                      03320000
014104          PERFORM 8200-WRITE-REPORT-HEADING                       03330000
014105          PERFORM 8300-WRITE-COLUMN-HEADING                       03340000
014106       END-IF.                                                    03350000
014107                                                                  03360000
014110      MOVE PA-ERROR-MESSAGES TO RPT-NBR-ERRORS                    03370000
014200      WRITE ERR-RPT-LINE FROM RPT-TOTAL-LINE                      03380000
014210            AFTER ADVANCING 1 LINES.                              03390000
014300      WRITE ERR-RPT-LINE FROM RPT-END-OF-REPORT-LINE              03400000
014400            AFTER ADVANCING 1 LINES.                              03410000
014500                                                                  03420000
