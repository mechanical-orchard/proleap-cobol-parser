      *----------------------------------------------------------       00000100
       IDENTIFICATION DIVISION.                                         00000200
      *----------------------------------------------------------       00000300
       PROGRAM-ID.    PXKUT092.                                         00000400
       AUTHOR.        DAVID WELLER.                                     00000500
       DATE-WRITTEN.  MAY, 2007.                                        00000600
                                                                        00000700
      *----------------------------------------------------------       00000800
      *            EXTRACT MOS PRICE CHANGES                            00000900
      *----------------------------------------------------------       00005000
      * HISTORY LOG:                                                    00006000
      *                                                                 00007000
      *----------------------------------------------------------       00008000
      * DATE:                                                           00009000
      * WR/IR#:                                                         00010000
      * PROGRAMMER:                                                     00020000
      * DESCRIPTION:                                                    00030000
      *                                                                 00040000
      *----------------------------------------------------------       00050000
       ENVIRONMENT DIVISION.                                            00060000
      *----------------------------------------------------------       00070000
       CONFIGURATION SECTION.                                           00080000
       SOURCE-COMPUTER. IBM-3090.                                       00090000
       OBJECT-COMPUTER. IBM-3090.                                       00100000
                                                                        00110000
       INPUT-OUTPUT SECTION.                                            00120000
                                                                        00130000
       FILE-CONTROL.                                                    00140000
                                                                        00150000
           SELECT NUMBER-OF-DAYS-FILE                                   00160001
               ASSIGN TO INP01.                                         00170000
                                                                        00180000
006926                                                                  00190030
006926     SELECT DATE-CONTROL-CARD                                     00200030
006926         ASSIGN TO INP02.                                         00210030
006926                                                                  00211030
           SELECT EXTRACT-FILE                                          00220000
               ASSIGN TO OUT01.                                         00230000
      *----------------------------------------------------------       00240000
       DATA DIVISION.                                                   00250000
      *----------------------------------------------------------       00260000
       FILE SECTION.                                                    00270000
                                                                        00280000
       FD  EXTRACT-FILE                                                 00290000
           RECORDING MODE IS F                                          00300000
           LABEL RECORDS ARE OMITTED                                    00310000
           RECORD CONTAINS 31 CHARACTERS                                00320009
           DATA RECORD IS EXTRACT-RECORD.                               00330001
       01  EXTRACT-RECORD              PIC X(31).                       00340009
                                                                        00350000
       FD  NUMBER-OF-DAYS-FILE                                          00360003
           RECORDING MODE IS F                                          00370000
           LABEL RECORDS ARE STANDARD                                   00380000
           RECORD CONTAINS 80 CHARACTERS                                00390000
           BLOCK CONTAINS 0 RECORDS                                     00400000
           DATA RECORD IS DATE-RECORD.                                  00410000
       01  DATE-RECORD                 PIC X(80).                       00420000
006926                                                                  00421030
006926 FD  DATE-CONTROL-CARD                                            00430030
006926     RECORDING MODE IS F                                          00440030
006926     LABEL RECORDS ARE STANDARD                                   00450030
006926     RECORD CONTAINS 80 CHARACTERS                                00460030
006926     BLOCK CONTAINS 0 RECORDS                                     00470030
006926     DATA RECORD IS DATE-CONTROL-RECORD.                          00480030
006926 01  DATE-CONTROL-RECORD         PIC X(80).                       00481030
006926                                                                  00482030
      *---------------------------------------------------------        00490000
                                                                        00500000
       WORKING-STORAGE SECTION.                                         00510000
      *---------------------------------------------------------        00520000
006926*DATE CONTROL CARD LAYOUT                                         00522030
006926*---------------------------------------------------------        00523030
006926 01 CC-CONTROL-DATE.                                              00524030
006926    05 CC-DATE.                                                   00525030
006926       10  CC-CONTROL-YY              PIC  9(04) VALUE ZEROS.     00526030
006926       10  FILLER                     PIC  X(01) VALUE SPACE.     00527030
006926       10  CC-CONTROL-MM              PIC  9(02) VALUE ZEROS.     00528030
006926       10  FILLER                     PIC  X(01) VALUE SPACE.     00529030
006926       10  CC-CONTROL-DD              PIC  9(02) VALUE ZEROS.     00529130
006926       10  FILLER                     PIC  X(70) VALUE SPACE.     00529230
006926*---------------------------------------------------------        00529330
      * PC- PROGRAM CONSTANTS                                           00530000
      *----------------------------------------------------------       00540000
       01  PC-PROGRAM-CONSTANTS.                                        00550000
           05  PC-PROGRAM-NAME              PIC X(08) VALUE 'PXKUT092'. 00560000
           05  PC-DAYS-FR                   PIC S9(3)  VALUE +0.        00561024
           05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00570000
           05  PC-NULL-VALUE                PIC S9(04) VALUE -1         00571003
                                                       COMP SYNC.       00572003
           05  NV-GP-AMT-NULL-IND           PIC S9(04) VALUE +0         00573018
                                                       COMP SYNC.       00574003
           05  NV-GP-QTY-NULL-IND           PIC S9(04) VALUE +0         00575003
                                                       COMP SYNC.       00576003
           05  NV-EFF-END-DTE-NULL-IND      PIC S9(04) VALUE +0         00577012
                                                       COMP SYNC.       00578012
                                                                        00580000
      *----------------------------------------------------------       00590000
      * PS- PROGRAM SWITCHES                                            00600000
      *----------------------------------------------------------       00610000
       01  PS-PROGRAM-SWITCHES.                                         00620000
           05  PS-EOF-EXTRACT-SW           PIC X(01)    VALUE SPACE.    00630030
               88  PS-EOF-EXTRACT                       VALUE 'Y'.      00640030
               88  PS-NOT-EOF-EXTRACT                   VALUE 'N'.      00650030
           05  PS-NUMBER-OF-DAYS-FILE-SW    PIC  X(01)  VALUE 'N'.      00660003
               88  PS-NUMBER-OF-DAYS-FILE-END           VALUE 'Y'.      00670003
               88  PS-NUMBER-OF-DAYS-FILE-START         VALUE 'N'.      00680003
006926     05  PS-END-OF-DATE-CONTROL-SW    PIC  X(01)  VALUE 'N'.      00690030
006926         88  PS-DATE-CONTROL-END                  VALUE 'Y'.      00700030
                                                                        00720000
      *----------------------------------------------------------       00730000
      * PV- PROGRAM VARIABLES                                           00740000
      *----------------------------------------------------------       00750000
       01  CC-NUMBER-OF-DAYS-FILE.                                      00760003
           05  CC-START-DATE                PIC X(10).                  00770000
           05  FILLER                       PIC X(01).                  00780000
           05  CC-END-DATE                  PIC X(10).                  00790000
                                                                        00800000
       01 PV-PROGRAM-VARIABLES.                                         00840000
          05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 00850000
          05  PV-DB2-DATE                   PIC X(10).                  00851023
          05  PV-DAYS-FR-DATE               PIC X(10).                  00852023
          05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00860000
          05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00870000
          05  PV-AD-EVNT-ID                 PIC S9(09) VALUE +0.        00880000
          05  PV-ACTION-CODE                PIC X(01).                  00890000
              88  PV-INSERT-DATA                       VALUE 'I'.       00900000
              88  PV-UPDATE-DATA                       VALUE 'U'.       00910000
                                                                        00920000
          05  PV-RECORD-COUNT               PIC 9(05) VALUE ZEROS.      00930000
          05  PV-LD-STATUS-CDE              PIC X(02).                  00931000
              88  PV-NO-ERROR                          VALUE '00'.      00932000
              88  PV-CRITICAL-ERROR                    VALUE '01'.      00933000
              88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      00934000
                                                                        00935000
          05  PV-STRT-PARM.                                             00936000
              10  PV-STRT-DTE-CC            PIC X(02).                  00937000
              10  PV-STRT-DTE-YY            PIC X(02).                  00938000
              10  PV-STRT-DTE-MM            PIC X(02).                  00939000
              10  PV-STRT-DTE-DD            PIC X(02).                  00940000
              10  FILLER                    PIC X.                      00950000
              10  PV-DECREMENT              PIC X(03).                  00960000
              10  FILLER                    PIC X(68).                  00970000
                                                                        00980000
          05  PV-AD-EVNT-STRT-DTE           PIC X(10).                  00990000
                                                                        01000000
           05  PV-OPERATION-MSG             PIC  X(60)  VALUE SPACES.   01010000
           05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.   01020000
                                                                        01030000
          05  PV-AD-EVNT-END-DTE-TM.                                    01040000
              10  PV-AD-EVNT-END-DTE.                                   01050000
                  15  PV-AD-EVNT-DTE-TM2-CCYY   PIC X(04).              01060000
                  15  FILLER                    PIC X(01).              01070000
                  15  PV-AD-EVNT-DTE-TM2-MM     PIC X(02).              01080000
                  15  FILLER                    PIC X(01).              01090000
                  15  PV-AD-EVNT-DTE-TM2-DD     PIC X(02).              01100000
              10  PV-AD-EVNT-END-TM             PIC X(16).              01110000
                                                                        01120000
                                                                        01130000
       01  PV-TOTAL-RECORD.                                             01140000
           05 PV-BUSINESS-EVNT-ID              PIC 9(03) VALUE ZERO.    01150000
           05 PV-ACTION-CDE                    PIC X(01) VALUE 'T'.     01160000
           05 PV-TOTAL-NBR-OF-RECS             PIC 9(11) VALUE ZERO.    01170000
      ***************************************************************** 01180000
      *  EXTRACT RECORD LAYOUT                                          01190000
      ***************************************************************** 01200000
      *01  PXRD046-EXTRACT-RECORD.                                      01210001
           COPY PXRD046.                                                01211001
                                                                        01221001
      ***************************************************************** 01222001
      *  PARAMETER IN RECORD LAYOUT                                     01223001
      ***************************************************************** 01224001
      *01  PX035-PARAMETER-RECORD.                                      01225001
           COPY PXRD035.                                                01226001
                                                                        01227001
      *----------------------------------------------------------       01230000
      * DATE ROUTINE COPY MEMBERS                                       01240000
      *----------------------------------------------------------       01250000
           COPY DPWS500.                                                01260000
                                                                        01270000
      *----------------------------------------------------------       01280000
      * VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01290000
      *----------------------------------------------------------       01300000
           COPY DPWS004.                                                01310000
                                                                        01320000
      *---------------------------------------------                    01330000
      *  DB2 COMMUNICATION AREA.                                        01340000
      *---------------------------------------------                    01350000
           EXEC SQL                                                     01360000
                INCLUDE SQLCA                                           01370000
           END-EXEC.                                                    01380000
                                                                        01390000
           COPY SQLCA2.                                                 01400000
      *---------------------------------------------                    01410000
      *  DB2 TABLE PXT00003 (PXT_MOS_SKU_STR)                           01420001
      *---------------------------------------------                    01430000
           EXEC SQL                                                     01440000
                INCLUDE PXT00003                                        01450001
           END-EXEC.                                                    01460000
                                                                        01470000
      *---------------------------------------------                    01471001
      *  DB2 TABLE XST00008 (XST_SKU_LOC)                               01472001
      *---------------------------------------------                    01473001
           EXEC SQL                                                     01474001
                INCLUDE XST00008                                        01475001
           END-EXEC.                                                    01476001
                                                                        01477001
      *---------------------------------------------                    01478001
      *  DB2 TABLE XST00010 (XST_SKU)                                   01479001
      *---------------------------------------------                    01479101
           EXEC SQL                                                     01479201
                INCLUDE XST00010                                        01479301
           END-EXEC.                                                    01479401
                                                                        01479501
      *---------------------------------------------                    01480000
      *   EXTRACT-CUR CURSOR DB2 SELECT                                 01490001
      *---------------------------------------------                    01500000
           EXEC SQL                                                     01510000
             DECLARE EXTRACT-CUR CURSOR FOR                             01520005
               SELECT A.SKU_NBR                                         01530010
                     ,A.STR_NBR                                         01540000
                     ,A.EFF_BEG_DTE                                     01550010
                     ,A.EFF_END_DTE                                     01560010
               FROM   PXT_MOS_SKU_STR   A                               01563000
               WHERE A.EFF_BEG_DTE = :PV-DAYS-FR-DATE                   01566027
                 AND (A.EFF_END_DTE IS NULL                             01567029
                  OR  A.EFF_END_DTE >= A.EFF_BEG_DTE)                   01568029
              WITH UR                                                   01569500
           END-EXEC.                                                    01569600
                                                                        01569700
      *----------------------------------------------------------       01569800
       PROCEDURE DIVISION.                                              01569900
      *----------------------------------------------------------       01570000
       0000-MAINLINE.                                                   01571000
                                                                        01580000
           PERFORM 1000-INITIALIZATION.                                 01590000
                                                                        01600000
           PERFORM 2000-EXTRACT-DATA                                    01610000
                   UNTIL PS-EOF-EXTRACT.                                01620000
                                                                        01630000
           PERFORM 9999-WRAPUP.                                         01660000
                                                                        01670000
           GOBACK.                                                      01680000
                                                                        01690000
      *0000-EXIT.                                                       01700000
       EJECT.                                                           01710000
                                                                        01720000
      *----------------------------------------------------------       01730000
      * 1000-INITIALIZATION.                                            01740000
      *     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01750000
      *     UPDATE OR INSERT A RECORD.                                  01760000
      *----------------------------------------------------------       01770000
       1000-INITIALIZATION.                                             01780000
           SET PS-NOT-EOF-EXTRACT TO TRUE.                              01790000
                                                                        01800000
           OPEN INPUT NUMBER-OF-DAYS-FILE.                              01810003
           OPEN OUTPUT EXTRACT-FILE.                                    01830001
006926     OPEN INPUT DATE-CONTROL-CARD.                                01831030
006926                                                                  01832030
006926     READ DATE-CONTROL-CARD INTO CC-CONTROL-DATE                  01833030
006926         AT END                                                   01834030
006926             SET PS-DATE-CONTROL-END TO TRUE.                     01835030
006926                                                                  01836030
006926     IF PS-DATE-CONTROL-END                                       01837030
006926             MOVE 'DATE CONTROL CARD MISSING'                     01838030
006926                                 TO PV-OPERATION-MSG-1            01839030
006926             PERFORM Z910-ABEND                                   01839130
006926     END-IF.                                                      01839230
006926     DISPLAY PC-PROGRAM-NAME ' DATE CONTROL CARD:  '              01839330
006926             CC-CONTROL-DATE.                                     01839430
                                                                        01840000
           PERFORM 2010-COMPUTE-STRT-DTE                                01850000
              THRU 2010-EXIT.                                           01860000
                                                                        01870000
           EXEC SQL                                                     01880000
               OPEN EXTRACT-CUR                                         01890001
           END-EXEC.                                                    01900000
                                                                        01910000
           IF SQLCODE < 0                                               01920000
               DISPLAY 'OPEN  UNSUCCESSFUL FOR TABLE PXT_MOS_SKU_STR'   01921007
               PERFORM U9980-SQL-ERROR                                  01922000
                  THRU U9980-EXIT.                                      01923000
                                                                        01924000
           IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01925000
                 SQLWARN0 = 'W'                                         01926000
               DISPLAY 'FETCH WARNING FOR TABLE PXT_MOS_SKU_STR'        01927007
               PERFORM U9990-SQL-WARNING                                01928000
                  THRU U9990-EXIT.                                      01929000
                                                                        01932000
           INITIALIZE DCLPXT00003.                                      01933003
                                                                        01934000
      *1100-EXIT.                                                       01935000
       EJECT.                                                           01936000
                                                                        01937000
      *----------------------------------------------------------       01938000
      * 2000-EXTRACT-DATA.                                              01939000
      *     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            01940000
      *     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      01950000
      *     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          01960000
      *     PROCESS AN ERROR AND EXIT THE PROGRAM.                      01970000
      *----------------------------------------------------------       01980000
       2000-EXTRACT-DATA.                                               01990000
                                                                        02010000
           PERFORM 2100-FETCH-EXTRACT                                   02020000
              THRU 2100-EXIT.                                           02030000
                                                                        02040000
           IF PS-NOT-EOF-EXTRACT                                        02040111
               IF PXT00003-EFF-BEG-DTE = PV-DAYS-FR-DATE                02041025
                   PERFORM 3300-SELECT-XST-SKU                          02051007
                      THRU 3300-EXIT                                    02052007
      * LOOK FOR THE STORE PRICE FIRST                                  02052107
                   MOVE PXT00003-SKU-NBR   TO XST00010-SKU-NBR          02053007
                   PERFORM 3400-GET-PRICES                              02054007
                      THRU 3400-EXIT                                    02055007
                   IF SQLCODE = +100                                    02056007
      * LOOK FOR THE ZERO STORE PRICE IF STORE PRICE NOT FOUND          02056107
                       MOVE +0             TO XST00010-SKU-NBR          02056207
                       PERFORM 3400-GET-PRICES                          02056307
                          THRU 3400-EXIT                                02056407
                   END-IF                                               02057007
                   IF SQLCODE = 0                                       02058007
                       PERFORM 2200-FORMAT-EXTRACT-FILE                 02060007
                          THRU 2200-EXIT                                02070007
                                                                        02080007
                       PERFORM 3000-WRITE-EXTRACT                       02090007
                          THRU 3000-EXIT                                02100007
                   ELSE                                                 02100107
                       DISPLAY '***'                                    02100207
                       DISPLAY 'NO PRICE ROW FOUND'                     02100307
                       DISPLAY 'STR:  ' PXT00003-STR-NBR                02100407
                       DISPLAY 'SKU:  ' PXT00003-SKU-NBR                02100507
                   END-IF                                               02101007
               END-IF                                                   02102007
           END-IF.                                                      02110000
                                                                        02120000
      *2000-EXIT.                                                       02130000
       EJECT.                                                           02140000
                                                                        02150000
       2010-COMPUTE-STRT-DTE.                                           02160000
                                                                        02170000
           READ NUMBER-OF-DAYS-FILE INTO PX035-PARAMETER-RECORD         02180003
              AT END                                                    02190000
                 SET PS-NUMBER-OF-DAYS-FILE-END TO TRUE                 02200003
           END-READ.                                                    02210000
                                                                        02220000
           IF PS-NUMBER-OF-DAYS-FILE-END                                02230003
               MOVE 'NO DAY FILE TO PROCESS'                            02240003
                                       TO PV-OPERATION-MSG-1            02250005
               PERFORM Z910-ABEND                                       02260000
           ELSE                                                         02270000
               DISPLAY 'NBR-OF-DAYS = ' PX035-DAYS-FR-EVNT-NBR          02280003
           END-IF.                                                      02300000
                                                                        02301005
           IF PX035-SIGN = '+' OR PX035-SIGN = ' '                      02301126
               MOVE PX035-DAYS         TO PC-DAYS-FR                    02302024
           ELSE                                                         02303024
               COMPUTE PC-DAYS-FR = PX035-DAYS * -1                     02303124
           END-IF.                                                      02303224
                                                                        02303324
006926                                                                  02303430
006926     MOVE CC-DATE TO PV-DB2-DATE                                  02303530
                                                                        02307023
           DISPLAY 'PV-DB2-DATE:  ' PV-DB2-DATE.                        02308023
                                                                        02308123
           IF PX035-SIGN = '+' OR PX035-SIGN = ' '                      02308226
               PERFORM 2011-INCREMENT-DATE                              02308324
                  THRU 2011-EXIT                                        02308424
           ELSE                                                         02308524
               PERFORM 2012-DECREMENT-DATE                              02308624
                  THRU 2012-EXIT                                        02310024
           END-IF.                                                      02320024
                                                                        02330024
       2010-EXIT.                                                       02460000
           EXIT.                                                        02470000
       EJECT.                                                           02480000
                                                                        02481024
       2011-INCREMENT-DATE.                                             02482024
                                                                        02483024
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02490524
           MOVE PV-DB2-DATE              TO DPG52-LK-DATE-INPUT.        02490624
           SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       02490724
           SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       02490824
           SET DPG51-INCREMENT-DATE      TO TRUE.                       02490924
           MOVE PC-DAYS-FR               TO DPG51-INCR-DECR-DAYS-9.     02491024
           PERFORM 9999-DATE-ROUTINE.                                   02491124
           MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-DAYS-FR-DATE.            02491224
                                                                        02491324
           DISPLAY 'PV-DAYS-FR-DATE: ' PV-DAYS-FR-DATE.                 02491424
                                                                        02491524
       2011-EXIT.                                                       02491624
           EXIT.                                                        02491724
                                                                        02491824
       2012-DECREMENT-DATE.                                             02491924
                                                                        02492124
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02492224
           MOVE PV-DB2-DATE              TO DPG52-LK-DATE-INPUT.        02492324
           SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       02492524
           SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       02492624
           SET DPG51-DECREMENT-DATE      TO TRUE.                       02492724
           MOVE PC-DAYS-FR               TO DPG51-INCR-DECR-DAYS-9.     02492824
           PERFORM 9999-DATE-ROUTINE.                                   02493024
           MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-DAYS-FR-DATE.            02493124
                                                                        02493324
           DISPLAY 'PV-DAYS-FR-DATE: ' PV-DAYS-FR-DATE.                 02493424
                                                                        02493524
       2012-EXIT.                                                       02493624
           EXIT.                                                        02493724
                                                                        02493824
       EJECT.                                                           02493924
      *------------------------------------------------------           02494024
      * 2100-FETCH-EXTRACT                                              02500000
      *     EXTRACTS THE AD EVENT RECORD.                               02510000
      *------------------------------------------------------           02520000
                                                                        02530000
       2100-FETCH-EXTRACT.                                              02540000
                                                                        02550000
           EXEC SQL                                                     02560000
               FETCH EXTRACT-CUR                                        02561001
                   INTO :PXT00003-SKU-NBR,                              02562001
                        :PXT00003-STR-NBR,                              02563001
                        :PXT00003-EFF-BEG-DTE,                          02564001
                        :PXT00003-EFF-END-DTE                           02564413
                            :NV-EFF-END-DTE-NULL-IND                    02564513
           END-EXEC.                                                    02564613
                                                                        02564713
           IF SQLCODE < 0                                               02564813
               DISPLAY 'FETCH UNSUCCESSFUL FOR TABLE PXT_MOS_SKU_STR'   02564913
               PERFORM U9980-SQL-ERROR                                  02565013
                  THRU U9980-EXIT.                                      02565113
                                                                        02566000
           IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02567000
                 SQLWARN0 = 'W'                                         02568000
               DISPLAY 'FETCH WARNING FOR TABLE PXT_MOS_SKU_STR'        02569001
               PERFORM U9990-SQL-WARNING                                02570000
                  THRU U9990-EXIT.                                      02570100
                                                                        02570200
           IF SQLCODE = +100                                            02570300
               MOVE 'Y' TO PS-EOF-EXTRACT-SW.                           02570400
                                                                        02570500
       2100-EXIT.                                                       02570600
           EXIT.                                                        02570700
                                                                        02570823
                                                                        02573023
       EJECT.                                                           02573123
      *------------------------------------------------------           02573200
      * 2200-FORMAT-EXTRACT-FILE                                        02573300
      *     FORMATS THE AD EVENT COPY BOOK.                             02573400
      *------------------------------------------------------           02573500
       2200-FORMAT-EXTRACT-FILE.                                        02573600
                                                                        02574001
           MOVE PXT00003-EFF-BEG-DTE   TO PXRD046-EFF-DATE.             02601001
           MOVE PXT00003-STR-NBR       TO PXRD046-STR-NBR.              02602001
           MOVE PXT00003-SKU-NBR       TO PXRD046-SKU-NBR.              02604001
           MOVE XST00008-UNT-RTL-AMT   TO PXRD046-UNT-RTL-AMT.          02606001
                                                                        02609501
      ***DETERMINES IF GROUP PRICING IS AVAILABLE FOR ITEM              02609601
           IF  NV-GP-QTY-NULL-IND  = PC-NULL-VALUE                      02609703
               MOVE ZEROS              TO PXRD046-GP-RTL-QTY            02609803
               MOVE PC-NULL-VALUE      TO PXRD046-GP-RTL-QTY-NULL-IND   02609903
           ELSE                                                         02610001
               MOVE XST00008-GP-RTL-QTY                                 02610103
                                       TO PXRD046-GP-RTL-QTY            02610203
           END-IF.                                                      02610302
                                                                        02610402
      ***DETERMINES IF GROUP PRICING IS AVAILABLE FOR ITEM              02610502
           IF  NV-GP-AMT-NULL-IND  = PC-NULL-VALUE                      02610718
               MOVE ZEROS              TO PXRD046-GP-RTL-AMT            02610803
               MOVE PC-NULL-VALUE      TO PXRD046-GP-RTL-AMT-NULL-IND   02610903
           ELSE                                                         02611002
               MOVE XST00008-GP-RTL-AMT                                 02611103
                                       TO PXRD046-GP-RTL-AMT            02611203
           END-IF.                                                      02611302
                                                                        02612002
       2200-EXIT.                                                       02620000
           EXIT.                                                        02630000
       EJECT.                                                           02640000
                                                                        02653000
      *------------------------------------------------------           02660000
      * 3000-WRITE-EXTRACT.                                             02670001
      *     WRITE EXTRACT FILE.                                         02680000
      *------------------------------------------------------           02690000
       3000-WRITE-EXTRACT.                                              02700001
           ADD 1 TO PV-RECORD-COUNT.                                    02710000
           WRITE EXTRACT-RECORD FROM PXRD046-EXTRACT-RECORD.            02720001
                                                                        02730000
       3000-EXIT.                                                       02740000
           EXIT.                                                        02750000
       EJECT.                                                           02760000
                                                                        02761003
      ***************************************************************** 02762003
      **RETRIEVE PRICING FROM XST_SKU_LOC                               02763003
      ***************************************************************** 02764003
       3400-GET-PRICES.                                                 02765003
           IF NV-EFF-END-DTE-NULL-IND = PC-NULL-VALUE                   02766022
           EXEC SQL                                                     02769003
                SELECT UNT_RTL_AMT                                      02769103
                      ,GP_RTL_AMT                                       02769220
                      ,GP_RTL_QTY                                       02769320
                INTO  :XST00008-UNT-RTL-AMT                             02769403
                     ,:XST00008-GP-RTL-AMT  :NV-GP-AMT-NULL-IND         02769518
                     ,:XST00008-GP-RTL-QTY  :NV-GP-QTY-NULL-IND         02769618
                FROM   XST_SKU_LOC                                      02769703
                WHERE  INTR_UPC_ID       =  :XST00010-INTR-UPC-ID       02769808
                  AND  LOC_NBR           =  :XST00008-LOC-NBR           02769908
                  AND  DATE(BEG_TMST)    <= :PXT00003-EFF-BEG-DTE       02770108
                  AND  (END_TMST         IS NULL                        02770216
                   OR  END_TMST     >= CURRENT TIMESTAMP)               02770422
                WITH UR                                                 02770503
           END-EXEC                                                     02770622
           ELSE                                                         02770722
           EXEC SQL                                                     02770822
                SELECT UNT_RTL_AMT                                      02770922
                      ,GP_RTL_AMT                                       02771022
                      ,GP_RTL_QTY                                       02771122
                INTO  :XST00008-UNT-RTL-AMT                             02771222
                     ,:XST00008-GP-RTL-AMT  :NV-GP-AMT-NULL-IND         02771322
                     ,:XST00008-GP-RTL-QTY  :NV-GP-QTY-NULL-IND         02771422
                FROM   XST_SKU_LOC                                      02771522
                WHERE  INTR_UPC_ID       =  :XST00010-INTR-UPC-ID       02771622
                  AND  LOC_NBR           =  :XST00008-LOC-NBR           02771722
                  AND  DATE(BEG_TMST)    <= :PXT00003-EFF-BEG-DTE       02771822
                  AND  (END_TMST         IS NULL                        02771922
                   OR  DATE(END_TMST)    >= :PXT00003-EFF-END-DTE)      02772122
                WITH UR                                                 02772222
           END-EXEC                                                     02772322
           END-IF.                                                      02772422
           EVALUATE TRUE                                                02772522
              WHEN SQLCODE = +0                                         02772622
              WHEN SQLCODE = +100                                       02772722
                   CONTINUE                                             02772822
              WHEN OTHER                                                02772922
                DISPLAY 'SELECT FAILED FOR TABLE XST_SKU_LOC'           02773022
                DISPLAY 'INTR-UPC-ID: ' XST00010-INTR-UPC-ID            02773122
                DISPLAY 'LOC-NBR:     ' XST00008-LOC-NBR                02773222
                DISPLAY 'EFF-BEG-DTE: ' PXT00003-EFF-BEG-DTE            02773322
                DISPLAY 'NULL-IND:    ' NV-EFF-END-DTE-NULL-IND         02773422
                DISPLAY 'EFF-END-DTE: ' PXT00003-EFF-END-DTE            02773522
                PERFORM U9980-SQL-ERROR                                 02773622
                  THRU U9980-EXIT                                       02773722
           END-EVALUATE.                                                02773822
                                                                        02773922
       3400-EXIT.                                                       02774022
           EXIT.                                                        02774122
                                                                        02774222
       EJECT.                                                           02774322
                                                                        02774422
      ******************************************************************02774522
       3300-SELECT-XST-SKU.                                             02774622
      *     SELECT DOMAIN SKU TABLE. DCLGEN IS XST00010.                02774722
      ******************************************************************02774822
                                                                        02774922
           MOVE PXT00003-SKU-NBR       TO XST00010-SKU-NBR.             02775022
                                                                        02776022
           EXEC SQL                                                     02779403
               SELECT INTR_UPC_ID                                       02779503
                 INTO :XST00010-INTR-UPC-ID                             02779703
                 FROM XST_SKU                                           02779903
                WHERE SKU_NBR    = :XST00010-SKU-NBR                    02780003
                      WITH UR                                           02780103
           END-EXEC.                                                    02780203
                                                                        02780303
           EVALUATE TRUE                                                02780403
               WHEN SQLCODE = 0                                         02780803
                   CONTINUE                                             02780903
               WHEN SQLWARN NOT EQUAL SPACES                            02781003
               WHEN SQLCODE NOT EQUAL ZERO                              02781103
                DISPLAY 'SELECT FAILED FOR TABLE XST_SKU'               02781203
                PERFORM U9980-SQL-ERROR                                 02781303
                  THRU U9980-EXIT                                       02781403
           END-EVALUATE.                                                02782203
                                                                        02782303
       3300-EXIT.                                                       02782403
           EXIT.                                                        02782503
                                                                        02784000
      *----------------------------------------------------------       02790000
      * 9999-WRAPUP.                                                    02800000
      *     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           02810000
      *     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           02820000
      *     PROGRAM.                                                    02830000
      *----------------------------------------------------------       02840000
*                                                                       02850000
      *----------------------------------------------------------       02860000
       U9980-SQL-ERROR.                                                 02870000
      *----------------------------------------------------------       02880000
                                                                        02890000
           MOVE SQLCODE    TO SQLCODE2.                                 02900000
           MOVE SQLERRD(3) TO SQLERRD3.                                 02910000
           DISPLAY '** ABEND **       ** = SQLWARNING'.                 02920000
           DISPLAY '** PROGRAM        ** = PXKUT092'.                   02930000
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02940000
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02950000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02960000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02970000
                                                                        02980000
           MOVE 4013 TO ABEND-CODE.                                     02990000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03000000
                                                                        03010000
       U9980-EXIT.                                                      03020000
           EXIT.                                                        03030000
                                                                        03040000
      *----------------------------------------------------------       03050000
       U9990-SQL-WARNING.                                               03060000
      *----------------------------------------------------------       03070000
                                                                        03080000
           MOVE SQLCODE    TO SQLCODE2.                                 03090000
           MOVE SQLERRD(3) TO SQLERRD3.                                 03100000
           DISPLAY '** ABEND **       ** = SQLWARNING'.                 03110000
           DISPLAY '** PROGRAM        ** = PXKUT092'.                   03120000
                                                                        03130000
           MOVE 4013 TO ABEND-CODE.                                     03140000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03150000
                                                                        03160000
       U9990-EXIT.                                                      03170000
           EXIT.                                                        03180000
                                                                        03270000
       9999-WRAPUP.                                                     03280000
           CLOSE NUMBER-OF-DAYS-FILE.                                   03290003
           CLOSE EXTRACT-FILE.                                          03310003
006926     CLOSE DATE-CONTROL-CARD.                                     03311031
                                                                        03320000
           EXEC SQL                                                     03330000
               CLOSE EXTRACT-CUR                                        03340003
           END-EXEC.                                                    03350000
                                                                        03370000
      *9999-EXIT.                                                       03380000
       EJECT.                                                           03390000
                                                                        03391023
      ******************************************************************03400023
      **RUN DATE ROUTINE                                                03401023
      ******************************************************************03401123
       9999-DATE-ROUTINE.                                               03401223
                                                                        03401523
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            03401623
                      USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.        03401723
                                                                        03401823
           EVALUATE TRUE                                                03401923
                WHEN DPG54-NO-ERROR                                     03402023
                     CONTINUE                                           03402123
                WHEN OTHER                                              03402223
                   DISPLAY 'RETRIEVING END DATE...'                     03402323
                   DISPLAY DPG54-ERROR-MESSAGE                          03402423
                   PERFORM Z910-ABEND                                   03402623
           END-EVALUATE.                                                03402723
                                                                        03403000
      ******************************************************************03410000
      * Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *03420000
      ******************************************************************03430000
       Z910-ABEND.                                                      03440000
                                                                        03450000
           DISPLAY '** ABEND           **'.                             03460000
      *    DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  03470000
      *    DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        03480000
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         03490000
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       03500000
                                                                        03510000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03520000
