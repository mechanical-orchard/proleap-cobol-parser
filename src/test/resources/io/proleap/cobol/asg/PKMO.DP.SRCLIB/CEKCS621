000100*--------------------------------------------------------------*  00010021
000200 IDENTIFICATION DIVISION.                                         00020021
000300*--------------------------------------------------------------*  00030021
000400 PROGRAM-ID.    CEKCS621.                                         00040021
000500 AUTHOR.        EKTA AGRAWAL.                                     00050021
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060021
000700 DATE-WRITTEN.  07-30-10.                                         00070021
000800 DATE-COMPILED.                                                   00080021
000900*--------------------------------------------------------------*  00090021
001000*    S621 - CE-CENTRAL STK PULL BY DC LIST.                     * 00100021
001100*---------------------------------------------------------------* 00110021
001200*    THIS PROGRAM GENERATES A LIST OF DC'S FOR A CENTRAL STOCK  * 00120021
001300*    PULL NUMBER.  IT INCLUDES THE PULL NUMBER, PULL CREATE     * 00130021
001400*    DATE, PULL COMPLETE DATE, TOTALS BY PULL INCLUDE PULLED    * 00140021
001500*    UNITS AND UNITS SHIPPED TO STORES PLUS THE PERCENT OF UNITS* 00150021
001600*    SHIPPED TO STORE.  THE DETAIL LEVEL INCLUDES DC NUMBERS,   * 00160021
001700*    STATUS OF TRAILER ENROUTE TO DC OR TRAILER ARRIVED AT DC OR* 00170021
001800*    PULL NUMBER UNITS WERE SHIPPED FROM THE DC TO THE STORE.   * 00180021
001900*    ALSO THE ARRIVE AT DC DATE AND TIME, PULL SHIPPED DATE,    * 00190021
002000*    TIME, UNITS AND CARTON COUNT. PLUS REQUESTED UNITS AND     * 00200021
002100*    PERCENT SHIPPED. THIS SCREEN IS USED BY BOTH LOGISITCS     * 00210021
002200*    AND MERCHANTS TO TRACK PULLS.                              * 00220021
002300*--------------------------------------------------------------*  00230021
263455* CHANGED 10/29/2021    BY JIM HUNTER      WR: CHG0263455         00231028
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00232028
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00233028
263455*----------------------------------------------------------------*00234028
CICS  * CHANGED 10/20/2022    BY JIM HUNTER      WR: CHG0276924         00235030
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00236029
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00237029
CICS  *-----------------------------------------------------------------00238029
002400 ENVIRONMENT DIVISION.                                            00240021
002500*--------------------------------------------------------------*  00250021
002600                                                                  00260021
002700*--------------------------------------------------------------*  00270021
002800 DATA DIVISION.                                                   00280021
002900*--------------------------------------------------------------*  00290021
003000                                                                  00300021
003100 WORKING-STORAGE SECTION.                                         00310021
003200                                                                  00320021
003300 01  DK-DB2-KEYS.                                                 00330021
003400     05  DK-REC-SEQ-NBR                 PIC S9(09) COMP VALUE +0. 00340021
003500                                                                  00350021
003600 01  PC-PROGRAM-CONSTANTS.                                        00360021
003700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00370021
003800                                                    'CE621A  '.   00380021
003900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00390021
004000                                                    'CEKM621 '.   00400021
004100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00410021
004200                                                    'CEKCS621'.   00420021
004300     05  PC-VEA                         PIC  X(04)  VALUE 'VE-A'. 00430021
004400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00440021
004500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00450021
004600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00460021
004700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00470021
004800                                                    COMP SYNC.    00480021
004900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00490021
005000                                                    COMP SYNC.    00500021
005100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00510021
005200                                                    +1000000      00520021
005300                                                    COMP-3.       00530021
005400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00540021
005500                                                    COMP SYNC.    00550021
005600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00560021
005700                                                    COMP-3.       00570021
005800     05  PC-TSYMSG-NUMBERS.                                       00580021
005900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00590021
006000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00600021
006100         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00610021
006200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00620021
006300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00630021
006400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00640021
006500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00650021
006600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00660021
006700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00670021
006800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00680021
006900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00690021
007000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00700021
007100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00710021
007200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00720021
007300         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  00730021
007400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00740021
007500                                                                  00750021
007600 01  PS-PROGRAM-SWITCHES.                                         00760021
007700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00770021
007800         88  PS-NO-ERROR                            VALUE 'Y'.    00780021
007900         88  PS-ERROR                               VALUE 'N'.    00790021
008000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00800021
008100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00810021
008200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00820021
008300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00830021
008400         88  PS-DONE                                VALUE 'Y'.    00840021
008500         88  PS-NOT-DONE                            VALUE 'N'.    00850021
008600     05  PS-AURECD-EOF-SW               PIC  X(01)  VALUE 'N'.    00860021
008700         88  PS-AURECD-EOF                          VALUE 'Y'.    00870021
008800         88  PS-AURECD-NOT-EOF                      VALUE 'N'.    00880021
008900     05  PS-AURECD-NOT-FOUND-SW         PIC  X(01)  VALUE 'N'.    00890021
009000         88  PS-AURECD-FOUND                        VALUE 'Y'.    00900021
009100         88  PS-AURECD-NOT-FOUND                    VALUE 'N'.    00910021
009200     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    00920021
009300         88  PS-LIST-END                            VALUE 'Y'.    00930021
009400         88  PS-NO-LIST-END                         VALUE 'N'.    00940021
009500                                                                  00950021
009600 01  DN-DB2-NULL-INDICATORS.                                      00960021
009610     05  DN-PULL-CMP-DTE            PIC S9(04) COMP VALUE ZEROES. 00961021
009620     05  DN-TOT-UNITS-TO-STR        PIC S9(04) COMP VALUE ZEROES. 00962021
009630     05  DN-OTBND-STAT-TMST         PIC S9(04) COMP VALUE ZEROES. 00963021
009640     05  DN-CTN-CNT                 PIC S9(04) COMP VALUE ZEROES. 00964021
009650     05  DN-SHPD-UNT-QTY            PIC S9(04) COMP VALUE ZEROES. 00965021
009660     05  DN-OPER-UNT-ID             PIC S9(04) COMP VALUE ZEROES. 00966021
009670     05  DN-ARRIVAL-DATE            PIC S9(04) COMP VALUE ZEROES. 00967021
009671     05  DN-ARRIVAL-TIME            PIC S9(04) COMP VALUE ZEROES. 00967121
009672     05  DN-REQ-ORD-QTY             PIC S9(04) COMP VALUE ZEROES. 00967221
009673     05  DN-KRPRPM-FUNC-TXT         PIC S9(04) COMP VALUE ZEROES. 00967321
009674     05  DN-TRIP-STATUS-CDE        PIC S9(04) COMP VALUE ZEROES.  00967421
009675                                                                  00967521
009676 01  PV-PROGRAM-VARIABLES.                                        00967621
009677                                                                  00967721
009678     05  PV-SUB                         PIC S9(04)  VALUE +0      00967821
009679                                                    COMP SYNC.    00967921
009680     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00968021
009690                                                    COMP SYNC.    00969021
009700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00970021
009800                                                    COMP-3.       00980021
009900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00990021
010000                                                    COMP-3.       01000021
010100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01010021
010200                                                    COMP-3.       01020021
010300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01030021
010400                                                    COMP-3.       01040021
010500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01050021
010600                                                    COMP-3.       01060021
010700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01070021
010800                                                    COMP-3.       01080021
010900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01090021
011000                                                    COMP-3.       01100021
011100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01110021
011200                                                    COMP SYNC.    01120021
011300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01130021
011400                                                    COMP SYNC.    01140021
011500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01150021
011600                                                    COMP SYNC.    01160021
011700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01170021
011800                                                    COMP SYNC.    01180021
011900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01190021
012000                                                    COMP SYNC.    01200021
012100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01210021
012200                                                    COMP SYNC.    01220021
012300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01230021
012400                                                    COMP SYNC.    01240021
012500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01250021
012600                                                    COMP SYNC.    01260021
012700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01270021
012800                                                    COMP SYNC.    01280021
012900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290021
013000                                                    COMP SYNC.    01300021
013100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01310021
013200                                                    COMP SYNC.    01320021
013300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01330021
013400                                                    COMP SYNC.    01340021
013500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01350021
013600                                                    COMP SYNC.    01360021
013700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01370021
013800                                                    COMP SYNC.    01380021
013900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01390021
014000                                                    COMP SYNC.    01400021
014100     05  PV-DOLLARS-VERIFIED            PIC S9(10)V99 VALUE +0    01410021
014200                                                      COMP-3.     01420021
014300     05  PV-CALC-DLRS-VERIFIED          PIC S9(10)V99 VALUE +0    01430021
014400                                                      COMP-3.     01440021
014500     05  PV-DOLLARS-VERIFIED-NULL       PIC S9(04)  VALUE +0      01450021
014600                                                    COMP.         01460021
014700     05  PV-UNITS-VERIFIED              PIC S9(06)  VALUE +0      01470021
014800                                                      COMP-3.     01480021
014900     05  PV-UNITS-VERIFIED-NULL         PIC S9(04)  VALUE +0      01490021
015000                                                    COMP.         01500021
015100     05  PV-SUM-UNIT-QTY                PIC S9(06)  VALUE +0      01510021
015200                                                      COMP-3.     01520021
015300     05  PV-SUM-LINE-UNIT-QTY           PIC S9(06)  VALUE +0      01530021
015400                                                      COMP-3.     01540021
015500     05  PV-REQ-ORD-QTY                 PIC S9(06)  VALUE +0      01550021
015600                                                      COMP-3.     01560021
015700     05  PV-PCT-SHPD                    PIC 9999V99.              01570021
015800                                                                  01580021
015900     05  PV-PCT-UNITS-TO-STR            PIC 9999V99.              01590021
016000                                                                  01600021
016100     05  PV-DIST-UNT-ZERO-SUPPRESS       PIC ZZZZ9- VALUE ZEROES. 01610021
016200                                                                  01620021
016300     05  PV-REC-DTE                     PIC X(10) VALUE SPACES.   01630021
016400     05  PV-REC-TIM                     PIC X(15) VALUE SPACES.   01640021
016410     05  PV-VER-DTE                     PIC X(10) VALUE SPACES.   01641021
016420     05  PV-VER-TIM                     PIC X(15) VALUE SPACES.   01642021
016430     05  PV-UPD-DTE                     PIC X(10) VALUE SPACES.   01643021
016440     05  PV-UPD-TIM                     PIC X(15) VALUE SPACES.   01644021
016450     05  PV-UPD-DTE-FIRST               PIC X(06) VALUE SPACES.   01645021
016460     05  PV-OPER-UNT-ID                 PIC  S9(4) COMP.          01646021
016470     05  PV-DC-NBR                      PIC  S9(4) COMP.          01647021
016480     05  PV-DC-NBR-ORG                  PIC  S9(4) COMP.          01648021
016490     05  DK-DC-NBR                      PIC  S9(4) COMP.          01649021
016500     05  PV-CTN-CNT                     PIC  S9(9) COMP.          01650021
016600     05  PV-SHPD-UNT-QTY                PIC  S9(9)V COMP-3.       01660021
016700     05  PV-SELECT-VAR                  PIC X(01) VALUE SPACE.    01670021
016800     05  PV-TRLR-STATUS                 PIC X(02) VALUE SPACE.    01680021
016900                                                                  01690021
017000     05  PV-ORD-DTE                     PIC X(10) VALUE SPACES.   01700021
017100     05  PV-PULL-CRT-DTE                PIC  9(10).               01710021
017200     05  PV-ARRIVAL-DATE                PIC X(10) VALUE SPACES.   01720021
017300     05  PV-ARRIVAL-TIME                PIC X(10) VALUE SPACES.   01730021
017400     05  PV-PULL-CMP-DTE                PIC X(26) VALUE SPACES.   01740021
017500     05  PV-OTBND-STAT-TMST             PIC X(26) VALUE SPACES.   01750021
017510                                                                  01751021
017520     05  PV-TOT-DOLLARS-VER             PIC S9(09)V99 VALUE +0    01752021
017530                                                       COMP-3.    01753021
017540     05  PV-TOT-UNITS-SHPD              PIC S9(07) VALUE +0       01754021
017550                                                       COMP-3.    01755021
017560     05  PV-TOT-CTN-CNT                 PIC S9(07) VALUE +0       01756021
017570                                                       COMP-3.    01757021
017580     05  PV-TOT-REQ-UNITS               PIC S9(07) VALUE +0       01758021
017590                                                       COMP-3.    01759021
017600                                                                  01760021
017700     05  PV-UPD-TMST              PIC X(26).                      01770021
017800     05  PV-UPD-TMST-RDF REDEFINES PV-UPD-TMST.                   01780021
017900         10  PV-UPD-TMST-CC       PIC X(02).                      01790021
018000         10  PV-UPD-TMST-YY       PIC X(02).                      01800021
018100         10  FILLER               PIC X(01).                      01810021
018200         10  PV-UPD-TMST-MM       PIC X(02).                      01820021
018300         10  FILLER               PIC X(01).                      01830021
018400         10  PV-UPD-TMST-DD       PIC X(02).                      01840021
018500         10  FILLER               PIC X(01).                      01850021
018600         10  PV-UPD-TMST-TIME     PIC X(15).                      01860021
018700                                                                  01870021
018800     05  PV-UPD-DATE.                                             01880021
018900         10  PV-UPD-DATE-MM             PIC 9(2)   VALUE ZEROS.   01890021
019000         10  PV-UPD-DATE-DD             PIC 9(2)   VALUE ZEROS.   01900021
019100         10  PV-UPD-DATE-YY             PIC 9(2)   VALUE ZEROS.   01910021
019200                                                                  01920021
019300     05  PV-KEY-PULL-NBR                PIC 9(09).                01930021
019400     05  PV-DIVERT-DC                 PIC 9(04)  VALUE ZEROES.    01940021
019500     05  PV-DIVERT-DC-CHAR            REDEFINES PV-DIVERT-DC.     01950021
019600         10  PV-DIVERT-DC-X1          PIC X(01).                  01960021
019700         10  PV-DIVERT-DC-X3          PIC X(03).                  01970021
019800*---------------------------------------------------------------* 01980021
019810*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01981021
019820*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01982021
019830*   APPLICATION-SPECIFIC COMMAREA.                              * 01983021
019840*---------------------------------------------------------------* 01984021
019850 01  LQW-LIST-QUEUE-WORK-AREA.                                    01985021
019860     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01986021
019870     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           01987021
019880                                        INDEXED BY LQW-IDX.       01988021
019890         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01989021
019900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01990021
020000         10  LQW-SELECTED-SW            PIC  X(01).               02000021
020100             88  LQW-SELECT                         VALUE 'S'.    02010021
020200             88  LQW-DESELECT                       VALUE ' '.    02020021
020300         10  LQW-ACTION                 PIC  X(04).               02030021
020400         10  LQW-DC-LOC                 PIC  Z(04).               02040021
020500         10  LQW-DC-STAT-CD             PIC  X(04).               02050021
020600         10  LQW-ARRIVAL-DTE            PIC  X(08).               02060021
020700         10  LQW-ARRIVAL-TIME           PIC  X(05).               02070021
020800         10  LQW-SHPTSTR-DTE            PIC  X(08).               02080021
020900         10  LQW-SHPTSTR-TIME           PIC  X(05).               02090021
021000         10  LQW-DC-SHP-UNT             PIC  Z(06).               02100021
021100         10  LQW-CARTON-CNT             PIC  Z(05).               02110021
021200         10  LQW-REQ-UNT                PIC  Z(05).               02120021
021300         10  LQW-PCT-SHPD               PIC  Z(04).               02130021
021400/                                                                 02140021
021500*---------------------------------------------------------------* 02150021
021600*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02160021
021700*---------------------------------------------------------------* 02170021
021800     COPY SUWS010.                                                02180021
021900     COPY CEWS003.                                                02190021
022000/                                                                 02200021
022100*---------------------------------------------------------------* 02210021
022200*    MAP LAYOUT                                                 * 02220021
022300*---------------------------------------------------------------* 02230021
022400     COPY CEKM621.                                                02240021
022500                                                                  02250021
022600 01  MR-OCCURS-LAYOUT                   REDEFINES  CE621AO.       02260021
022700     05  FILLER                         PIC X(12).                02270021
022800     05  FILLER.                                                  02280021
022900         10  MR-PULL-NBRL               PIC S9(04) COMP.          02290021
023000         10  MR-PULL-NBRA               PIC  X(01).               02300021
023100         10  MR-PULL-NBRC               PIC  X(01).               02310021
023200         10  MR-PULL-NBRH               PIC  X(01).               02320021
023300         10  MR-PULL-NBR-X.                                       02330021
023400             15  MR-PULL-NBR            PIC  ZZZZZZZZZ.           02340021
023500                                                                  02350021
023600         10  MR-PULL-UNITL              PIC S9(04) COMP.          02360021
023700         10  MR-PULL-UNITA              PIC  X(01).               02370021
023800         10  MR-PULL-UNITC              PIC  X(01).               02380021
023900         10  MR-PULL-UNITH              PIC  X(01).               02390021
024000         10  MR-PULL-UNIT-X.                                      02400021
024100*            15  MR-PULL-UNIT           PIC  ZZZ.                 02410021
024200             15  MR-PULL-UNIT           PIC  ZZZZ9.               02420021
024300                                                                  02430021
024400         10  MR-PULL-CRT-DTEL           PIC S9(04) COMP.          02440021
024500         10  MR-PULL-CRT-DTEA           PIC  X(01).               02450021
024600         10  MR-PULL-CRT-DTEC           PIC  X(01).               02460021
024700         10  MR-PULL-CRT-DTEH           PIC  X(01).               02470021
024800         10  MR-PULL-CRT-DTE            PIC  X(08).               02480021
024900                                                                  02490021
025000         10  MR-UNIT-SHPDL              PIC S9(04) COMP.          02500021
025100         10  MR-UNIT-SHPDA              PIC  X(01).               02510021
025200         10  MR-UNIT-SHPDC              PIC  X(01).               02520021
025300         10  MR-UNIT-SHPDH              PIC  X(01).               02530021
025400         10  MR-UNIT-SHPD-X.                                      02540021
025500             15  MR-UNIT-SHPD           PIC  ZZZZZ.               02550021
025600                                                                  02560021
025700         10  MR-PULL-CMP-DTEL           PIC S9(04) COMP.          02570021
025800         10  MR-PULL-CMP-DTEA           PIC  X(01).               02580021
025900         10  MR-PULL-CMP-DTEC           PIC  X(01).               02590021
026000         10  MR-PULL-CMP-DTEH           PIC  X(01).               02600021
026100         10  MR-PULL-CMP-DTE            PIC  X(08).               02610021
026200                                                                  02620021
026300         10  MR-PCT-CTN-UNTL           PIC S9(04) COMP.           02630021
026400         10  MR-PCT-CTN-UNTA           PIC  X(01).                02640021
026500         10  MR-PCT-CTN-UNTC           PIC  X(01).                02650021
026600         10  MR-PCT-CTN-UNTH           PIC  X(01).                02660021
026700         10  MR-PCT-CTN-UNT            PIC  Z(04).                02670021
026800                                                                  02680021
026900     05  FILLER                         PIC X(36).                02690021
027000                                                                  02700021
027100     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          02710021
027200         10  MR-SELECTL                 PIC S9(04) COMP.          02720021
027300         10  MR-SELECTA                 PIC  X(01).               02730021
027400         10  MR-SELECTC                 PIC  X(01).               02740021
027500         10  MR-SELECTH                 PIC  X(01).               02750021
027600         10  MR-SELECT                  PIC  X(01).               02760021
027700                                                                  02770021
027800         10  MR-ACTIONL                 PIC S9(04) COMP.          02780021
027900         10  MR-ACTIONA                 PIC  X(01).               02790021
028000         10  MR-ACTIONC                 PIC  X(01).               02800021
028100         10  MR-ACTIONH                 PIC  X(01).               02810021
028200         10  MR-ACTION                  PIC  ZZZZ.                02820021
028300                                                                  02830021
028400         10  MR-DC-LOCL                 PIC S9(04) COMP.          02840021
028500         10  MR-DC-LOCA                 PIC  X(01).               02850021
028600         10  MR-DC-LOCC                 PIC  X(01).               02860021
028700         10  MR-DC-LOCH                 PIC  X(01).               02870021
028800         10  MR-DC-LOC                  PIC  ZZZZ.                02880021
028900                                                                  02890021
029000         10  MR-DC-STAT-CDL             PIC S9(04) COMP.          02900021
029100         10  MR-DC-STAT-CDA             PIC  X(01).               02910021
029200         10  MR-DC-STAT-CDC             PIC  X(01).               02920021
029300         10  MR-DC-STAT-CDH             PIC  X(01).               02930021
029400         10  MR-DC-STAT-CD              PIC  X(04).               02940021
029500                                                                  02950021
029600         10  MR-ARRIVAL-DTEL            PIC S9(04) COMP.          02960021
029700         10  MR-ARRIVAL-DTEA            PIC  X(01).               02970021
029800         10  MR-ARRIVAL-DTEC            PIC  X(01).               02980021
029900         10  MR-ARRIVAL-DTEH            PIC  X(01).               02990021
030000         10  MR-ARRIVAL-DTE             PIC  X(08).               03000021
030100                                                                  03010021
030200         10  MR-ARRIVAL-TIMEL           PIC S9(04) COMP.          03020021
030300         10  MR-ARRIVAL-TIMEA           PIC  X(01).               03030021
030400         10  MR-ARRIVAL-TIMEC           PIC  X(01).               03040021
030500         10  MR-ARRIVAL-TIMEH           PIC  X(01).               03050021
030600         10  MR-ARRIVAL-TIME            PIC  X(05).               03060021
030700                                                                  03070021
030800         10  MR-SHPTSTR-DTEL            PIC S9(04) COMP.          03080021
030900         10  MR-SHPTSTR-DTEA            PIC  X(01).               03090021
031000         10  MR-SHPTSTR-DTEC            PIC  X(01).               03100021
031100         10  MR-SHPTSTR-DTEH            PIC  X(01).               03110021
031200         10  MR-SHPTSTR-DTE             PIC  X(08).               03120021
031300                                                                  03130021
031400         10  MR-SHPTSTR-TIMEL           PIC S9(04) COMP.          03140021
031500         10  MR-SHPTSTR-TIMEA           PIC  X(01).               03150021
031600         10  MR-SHPTSTR-TIMEC           PIC  X(01).               03160021
031700         10  MR-SHPTSTR-TIMEH           PIC  X(01).               03170021
031800         10  MR-SHPTSTR-TIME            PIC  X(05).               03180021
031900                                                                  03190021
032000         10  MR-DC-SHP-UNTL             PIC S9(04) COMP.          03200021
032100         10  MR-DC-SHP-UNTA             PIC  X(01).               03210021
032200         10  MR-DC-SHP-UNTC             PIC  X(01).               03220021
032300         10  MR-DC-SHP-UNTH             PIC  X(01).               03230021
032400         10  MR-DC-SHP-UNT-X.                                     03240021
032500             15  MR-DC-SHP-UNT          PIC  ZZ,ZZZ.              03250021
032600                                                                  03260021
032700         10  MR-CARTON-CNTL             PIC S9(04) COMP.          03270021
032800         10  MR-CARTON-CNTA             PIC  X(01).               03280021
032900         10  MR-CARTON-CNTC             PIC  X(01).               03290021
033000         10  MR-CARTON-CNTH             PIC  X(01).               03300021
033100         10  MR-CARTON-CNT-X.                                     03310021
033200             15  MR-CARTON-CNT          PIC   ZZ,ZZZ.             03320021
033300                                                                  03330021
033400         10  MR-REQ-UNTL                PIC S9(04) COMP.          03340021
033500         10  MR-REQ-UNTA                PIC  X(01).               03350021
033600         10  MR-REQ-UNTC                PIC  X(01).               03360021
033700         10  MR-REQ-UNTH                PIC  X(01).               03370021
033800         10  MR-REQ-UNT-X.                                        03380021
033900             15  MR-REQ-UNT             PIC  ZZZZZ.               03390021
034000                                                                  03400021
034100         10  MR-PCT-SHPDL               PIC S9(04) COMP.          03410021
034200         10  MR-PCT-SHPDA               PIC  X(01).               03420021
034300         10  MR-PCT-SHPDC               PIC  X(01).               03430021
034400         10  MR-PCT-SHPDH               PIC  X(01).               03440021
034500         10  MR-PCT-SHPD-X.                                       03450021
034600             15  MR-PCT-SHPD            PIC  ZZZ.                 03460021
034700                                                                  03470021
034800     05  FILLER.                                                  03480021
034900         10  MR-TOT-SHP-UNTL            PIC S9(04) COMP.          03490021
035000         10  MR-TOT-SHP-UNTA            PIC  X(01).               03500021
035100         10  MR-TOT-SHP-UNTC            PIC  X(01).               03510021
035200         10  MR-TOT-SHP-UNTH            PIC  X(01).               03520021
035300         10  MR-TOT-SHP-UNT-X.                                    03530021
035400             15  MR-TOT-SHP-UNT         PIC  ZZZZZ9.              03540021
035500                                                                  03550021
035600     05  FILLER.                                                  03560021
035700         10  MR-TOT-CTN-CNTL            PIC S9(04) COMP.          03570021
035800         10  MR-TOT-CTN-CNTA            PIC  X(01).               03580021
035900         10  MR-TOT-CTN-CNTC            PIC  X(01).               03590021
036000         10  MR-TOT-CTN-CNTH            PIC  X(01).               03600021
036100         10  MR-TOT-CTN-CNT-X.                                    03610021
036200             15  MR-TOT-CTN-CNT         PIC  ZZZZZ9.              03620021
036300                                                                  03630021
036400     05  FILLER.                                                  03640021
036500         10  MR-TOT-REQ-UNTL            PIC S9(04) COMP.          03650021
036600         10  MR-TOT-REQ-UNTA            PIC  X(01).               03660021
036610         10  MR-TOT-REQ-UNTC            PIC  X(01).               03661021
036620         10  MR-TOT-REQ-UNTH            PIC  X(01).               03662021
036630         10  MR-TOT-REQ-UNT-X.                                    03663021
036631             15  MR-TOT-REQ-UNT         PIC  ZZZZ9.               03663121
036632                                                                  03663221
036633/                                                                 03663321
036634*---------------------------------------------------------------* 03663421
036635*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03663521
036636*---------------------------------------------------------------* 03663621
036637     COPY DPWS015.                                                03663721
036638/                                                                 03663821
036639*---------------------------------------------------------------* 03663921
036640*    FUNCTION KEYS COPYBOOK.                                    * 03664021
036650*---------------------------------------------------------------* 03665021
036660     COPY DPWS016.                                                03666021
036670/                                                                 03667021
036680*---------------------------------------------------------------* 03668021
036690*    NUMERIC EDIT LAYOUT.                                       * 03669021
036700*---------------------------------------------------------------* 03670021
036800     COPY DPWS010I.                                               03680021
036900/                                                                 03690021
037000*---------------------------------------------------------------* 03700021
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03711029
037200*---------------------------------------------------------------* 03720021
037300     COPY DPWS030.                                                03730021
CICS       COPY DPWS930.                                                03731029
037400/                                                                 03740021
037500*---------------------------------------------------------------* 03750021
037600*    STANDARD COMMAREA.                                         * 03760021
037700*---------------------------------------------------------------* 03770021
037800     COPY DPWS020.                                                03780021
037900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03790021
038000/                                                                 03800021
038100*---------------------------------------------------------------* 03810021
038200* INTER-APPLICATION COMMAREA.                                   * 03820021
038300*---------------------------------------------------------------* 03830021
038400         10  INTER-APPL-COMM-AREA       PIC X(200).               03840021
038500     COPY CEWS002.                                                03850021
038600     COPY SUWS009.                                                03860021
038700/                                                                 03870021
038800*---------------------------------------------------------------* 03880021
038900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03890021
039000*---------------------------------------------------------------* 03900021
039100         10  ASC-SPECIFIC-COMMAREA.                               03910021
039200             15  ASC-LIST-KEYS.                                   03920021
039300                 20  ASC-KEY-PULL-NBR      PIC S9(09) COMP.       03930021
039400                 20  ASC-TOT-PULL-UNIT     PIC S9(06) COMP.       03940021
039500                 20  ASC-PULL-CRT-DTE      PIC  9(10).            03950021
039600                 20  ASC-TOT-UNITS-TO-STR  PIC S9(07) COMP-3.     03960021
039700                 20  ASC-PULL-CMP-DTE      PIC X(08).             03970021
039800                 20  ASC-PCT-UNITS-TO-STR  PIC 9(03).             03980021
039900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03990021
040000                 20  ASC-BLOCK-MODIFIED-SW                        04000021
040100                                        PIC X(01).                04010021
040200                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    04020021
040300                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    04030021
040400                                                                  04040021
040500                 20  ASC-ITEM-ARRAY.                              04050021
040600                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        04060021
040700                         30  ASC-LIST-ITEM-NUMBER                 04070021
040800                                        PIC S9(09)  COMP-3.       04080021
040900                         30  ASC-TEMP-SELECTED-SW                 04090021
041000                                        PIC X(01).                04100021
041100                             88  ASC-VALID-SELECT   VALUE ' '     04110021
041200                                                          'S'     04120021
041300                                                          'B'     04130021
041400                                                          'E'.    04140021
041500                             88  ASC-TEMP-NO-SELECT VALUE ' '.    04150021
041600                             88  ASC-TEMP-SELECT    VALUE 'S'.    04160021
041700                             88  ASC-TEMP-BEGIN     VALUE 'B'.    04170021
041800                             88  ASC-TEMP-END       VALUE 'E'.    04180021
041900                         30  ASC-SELECTED-SW                      04190021
042000                                        PIC X(01).                04200021
042100                             88  ASC-NO-SELECT      VALUE ' '.    04210021
042200                             88  ASC-SELECT         VALUE 'S'.    04220021
042300                             88  ASC-BEGIN          VALUE 'B'.    04230021
042400                             88  ASC-END            VALUE 'E'.    04240021
042500                         30  ASC-ACTION              PIC  Z(04).  04250021
042600                         30  ASC-DC-LOC              PIC  Z(04).  04260021
042700                         30  ASC-DC-STAT-CD          PIC  X(04).  04270021
042800                         30  ASC-ARRIVAL-DTE         PIC  X(08).  04280021
042900                         30  ASC-ARRIVAL-TIME        PIC  X(05).  04290021
043000                         30  ASC-SHPTSTR-DTE         PIC  X(08).  04300021
043100                         30  ASC-SHPTSTR-TIME        PIC  X(05).  04310021
043200                         30  ASC-DC-SHP-UNT          PIC  9(06).  04320021
043300                         30  ASC-CARTON-CNT          PIC  9(05).  04330021
043400                         30  ASC-REQ-UNT             PIC  9(05).  04340021
043500                         30  ASC-PCT-SHPD            PIC  Z(04).  04350021
043600                                                                  04360021
043700             15  ASC-TOT-SHP-UNT        PIC S9(06)                04370021
043800                                               COMP-3.            04380021
043900             15  ASC-TOT-CTN-CNT        PIC S9(06)                04390021
044000                                               COMP-3.            04400021
044100             15  ASC-TOT-REQ-UNITS      PIC S9(05)                04410021
044200                                               COMP-3.            04420021
044300                                                                  04430021
044400             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     04440021
044500             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     04450021
044600             15  ASC-NUMBER-OF-ITEMS-READ                         04460021
044700                                        PIC S9(09) COMP-3.        04470021
044800             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04480021
044900                                        PIC S9(09) COMP-3.        04490021
045000             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        04500021
045100             15  ASC-ITEM-AT-TOP-OF-PANEL                         04510021
045200                                        PIC S9(09) COMP-3.        04520021
045300             15  ASC-ITEM-AT-BOT-OF-PANEL                         04530021
045400                                        PIC S9(09) COMP-3.        04540021
045500             15  ASC-HIGHEST-BLOCK-WRITTEN                        04550021
045600                                        PIC S9(04) COMP SYNC.     04560021
045700             15  ASC-START-OF-SELECTED-RANGE                      04570021
045800                                        PIC S9(09) COMP-3.        04580021
045900             15  ASC-END-OF-SELECTED-RANGE                        04590021
046000                                        PIC S9(09) COMP-3.        04600021
046100             15  ASC-ITEMS-LEFT-INDICATOR                         04610021
046200                                        PIC X(01).                04620021
046300                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04630021
046400                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04640021
046500             15  ASC-TEMP-QUEUE-UPDATE-SW                         04650021
046600                                        PIC X(01).                04660021
046700                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04670021
046800                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04680021
046900             15  ASC-LIST-QUEUE-NAME.                             04690021
047000                 20  ASC-LIST-TERM-ID   PIC X(04).                04700021
047100                 20  ASC-LIST-TASK-NUMBER                         04710021
047200                                        PIC S9(05) COMP-3.        04720021
047300                 20  ASC-LIST-SEQ       PIC 9(01).                04730021
047400             15  ASC-SEL-QUEUE-NAME.                              04740021
047500                 20  ASC-SEL-TERM-ID    PIC X(04).                04750021
047600                 20  ASC-SEL-TASK-NUMBER                          04760021
047700                                        PIC S9(05) COMP-3.        04770021
047800                 20  ASC-SEL-SEQ        PIC 9(01).                04780021
047900                                                                  04790021
048000             15  ASC-START-ITEM-REQUEST.                          04800021
048100                 20  ASC-START-ITEM-REQUEST-N                     04810021
048200                                        PIC 9(07).                04820021
048300             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04830021
048400             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04840021
048500             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04850021
048600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04860021
048700             15  ASC-SEL-QUEUE-NAME-OUT.                          04870021
048800                 20  ASC-SEL-TERM-ID-OUT      PIC  X(04).         04880021
048900                 20  ASC-SEL-TASK-NUMBER-OUT  PIC S9(05) COMP-3.  04890021
049000                 20  ASC-SEL-SEQ-OUT          PIC  9(01).         04900021
049100             15  ASC-SEL-QUEUE-NAME-IN.                           04910021
049200                 20  ASC-SEL-TERM-ID-IN       PIC  X(04).         04920021
049300                 20  ASC-SEL-TASK-NUMBER-IN   PIC S9(05) COMP-3.  04930021
049400                 20  ASC-SEL-SEQ-IN           PIC  9(01).         04940021
049500             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04950021
049600             15  ASC-ENT-NAME-DESC      PIC X(30).                04960021
049700/                                                                 04970021
049800*---------------------------------------------------------------* 04980021
049900*    ABEND PROCESSING COPYBOOK.                                 * 04990021
050000*---------------------------------------------------------------* 05000021
050100     COPY DPWS013.                                                05010021
050200/                                                                 05020021
050300*---------------------------------------------------------------* 05030021
050400*    DB2 AREA FOR XLT_LOC TABLE                                 * 05040021
050500*---------------------------------------------------------------* 05050021
050600     EXEC SQL                                                     05060021
050700          INCLUDE XLT00010                                        05070021
050800     END-EXEC.                                                    05080021
050900/                                                                 05090021
051000*---------------------------------------------------------------* 05100021
051100*    DB2 AREA FOR TTRIPST TABLE                                 * 05110021
051200*---------------------------------------------------------------* 05120021
051300     EXEC SQL                                                     05130021
051400          INCLUDE TTRIPST                                         05140021
051500     END-EXEC.                                                    05150021
051600/                                                                 05160021
051700*---------------------------------------------------------------* 05170021
051800*    DB2 AREA FOR TSUOBTR TABLE                                 * 05180022
051900*---------------------------------------------------------------* 05190021
052000     EXEC SQL                                                     05200021
052100          INCLUDE TSUOBTR                                         05210022
052200     END-EXEC.                                                    05220021
052201                                                                  05220122
052210*---------------------------------------------------------------* 05221022
052220*    DB2 AREA FOR TSUOBTS TABLE                                 * 05222022
052230*---------------------------------------------------------------* 05223022
052240     EXEC SQL                                                     05224022
052250          INCLUDE TSUOBTS                                         05225022
052260     END-EXEC.                                                    05226022
052300/                                                                 05230021
052400*---------------------------------------------------------------* 05240021
052500*    DB2 AREA FOR TSUCDOT TABLE                                 * 05250021
052600*---------------------------------------------------------------* 05260021
052700     EXEC SQL                                                     05270021
052800          INCLUDE TSUCDOT                                         05280021
052900     END-EXEC.                                                    05290021
053000/                                                                 05300021
053100*---------------------------------------------------------------* 05310021
053200*    DB2 AREA FOR TCEPLRQ TABLE                                 * 05320021
053300*---------------------------------------------------------------* 05330021
053400     EXEC SQL                                                     05340021
053500          INCLUDE TCEPLRQ                                         05350021
053600     END-EXEC.                                                    05360021
053700/                                                                 05370021
053800*---------------------------------------------------------------* 05380021
053900*    DB2 AREA FOR TCEPLIT TABLE                                 * 05390021
054000*---------------------------------------------------------------* 05400021
054100     EXEC SQL                                                     05410021
054200          INCLUDE TCEPLIT                                         05420021
054300     END-EXEC.                                                    05430021
054400/                                                                 05440021
054500*---------------------------------------------------------------* 05450021
054600*    DB2 AREA FOR TCEPLST TABLE                                 * 05460021
054700*---------------------------------------------------------------* 05470021
054800     EXEC SQL                                                     05480021
054900          INCLUDE TCEPLST                                         05490021
055000     END-EXEC.                                                    05500021
055100/                                                                 05510021
055200*---------------------------------------------------------------* 05520021
055300*    DB2 AREA FOR TCEPLDS TABLE                                 * 05530021
055400*---------------------------------------------------------------* 05540021
055500     EXEC SQL                                                     05550021
055600          INCLUDE TCEPLDS                                         05560021
055700     END-EXEC.                                                    05570021
055800/                                                                 05580021
055900*---------------------------------------------------------------* 05590021
056000*    DB2 AREA FOR SUT_OTBND_CART TABLE                          * 05600021
056100*---------------------------------------------------------------* 05610021
056200     EXEC SQL                                                     05620021
056300          INCLUDE SUT00024                                        05630021
056400     END-EXEC.                                                    05640021
056500/                                                                 05650021
056600*---------------------------------------------------------------* 05660021
056700*    DB2 AREA FOR SUT_OTBND_LOC TABLE                          *  05670021
056800*---------------------------------------------------------------* 05680021
056900     EXEC SQL                                                     05690021
057000          INCLUDE SUT00027                                        05700021
057100     END-EXEC.                                                    05710021
057200/                                                                 05720021
057300*---------------------------------------------------------------* 05730021
057310*    DB2 AREA FOR SUT_TRLR_RPLN_CART TABLE                      * 05731021
057320*---------------------------------------------------------------* 05732021
057330     EXEC SQL                                                     05733021
057340          INCLUDE SUT00113                                        05734021
057350     END-EXEC.                                                    05735021
057360/                                                                 05736021
057370*---------------------------------------------------------------* 05737021
057380*    DB2 AREA FOR XLT_DC_LOC_ASGMT TABLE                        * 05738021
057390*---------------------------------------------------------------* 05739021
057400     EXEC SQL                                                     05740021
057500          INCLUDE XLT00014                                        05750021
057600     END-EXEC.                                                    05760021
057700/                                                                 05770021
057800*---------------------------------------------------------------* 05780021
057900*    DB2 AREA FOR SUT_OTBND_UPC TABLE                           * 05790021
058000*---------------------------------------------------------------* 05800021
058100     EXEC SQL                                                     05810021
058200          INCLUDE SUT00028                                        05820021
058300     END-EXEC.                                                    05830021
058400/                                                                 05840021
058500*---------------------------------------------------------------* 05850021
058600*    DB2 AREA FOR PARAMETER TABLES TKRPRPM                      * 05860021
058700*---------------------------------------------------------------* 05870021
058800     EXEC SQL                                                     05880021
058900          INCLUDE TKRPRPM                                         05890021
059000     END-EXEC.                                                    05900021
059100/                                                                 05910021
059200*---------------------------------------------------------------* 05920021
059300*    DB2 AREA FOR PARAMETER TABLES CARTON DIVERT TSUCRDV        * 05930021
059400*---------------------------------------------------------------* 05940021
059410     EXEC SQL                                                     05941021
059420          INCLUDE TSUCRDV                                         05942021
059430     END-EXEC.                                                    05943021
059440/                                                                 05944021
059450*---------------------------------------------------------------* 05945021
059460*    DB2 AREA FOR COMMUNICATIONS                                * 05946021
059470*---------------------------------------------------------------* 05947021
059480     EXEC SQL                                                     05948021
059481          INCLUDE SQLCA                                           05948121
059482     END-EXEC.                                                    05948221
059483/                                                                 05948321
059484*---------------------------------------------------------------* 05948421
059485*  CURSOR TO SELECT DC FOR THE PULL                             * 05948521
059486*---------------------------------------------------------------* 05948621
059487     EXEC SQL                                                     05948721
059488          DECLARE DC-CSR CURSOR FOR                               05948821
059489          SELECT DISTINCT(B.DC_NBR)                               05948921
059490               , E_BUS_IND                                        05949021
059500          FROM   XLT_LOC           A                              05950021
059600                ,XLT_DC_LOC_ASGMT  B                              05960021
059700                ,TCEPLDS           C                              05970021
059800          WHERE  C.STR_NBR = B.LOC_NBR                            05980021
059900             AND A.LOC_NBR = B.LOC_NBR                            05990021
060000             AND A.LOC_TYP_CDE = ('DS')                           06000021
060100             AND C.CNSTK_REQ_PL_NBR = :ASC-KEY-PULL-NBR           06010021
060200             AND B.EFF_BEG_DTE =                                  06020021
060300                 (SELECT MAX(D.EFF_BEG_DTE)                       06030021
060400                  FROM   XLT_DC_LOC_ASGMT D                       06040021
060500                  WHERE  D.LOC_NBR = A.LOC_NBR                    06050021
060600                    AND  D.EFF_BEG_DTE <= CURRENT DATE)           06060021
060700            ORDER BY B.DC_NBR                                     06070021
060800    END-EXEC.                                                     06080021
060900                                                                  06090021
061000*---------------------------------------------------------------* 06100021
061100 LINKAGE SECTION.                                                 06110021
061200*---------------------------------------------------------------* 06120021
061300 01  DFHCOMMAREA.                                                 06130021
061400     05  FILLER                         OCCURS  1 TO 4072 TIMES   06140021
061500                                        DEPENDING ON EIBCALEN.    06150021
061600         10  FILLER                     PIC X.                    06160021
061700/                                                                 06170021
061800*---------------------------------------------------------------* 06180021
061900 PROCEDURE DIVISION.                                              06190021
062000*---------------------------------------------------------------* 06200021
062100*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 06210021
062200*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 06220021
062300*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 06230021
062400*---------------------------------------------------------------* 06240021
062500 0000-MAIN-MODULE.                                                06250021
062600                                                                  06260021
062700     INITIALIZE DP030-CICS-API-FIELDS.                            06270021
062800                                                                  06280021
062900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06290021
063000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06300021
063100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06310021
063200                                                                  06320021
063300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06330021
063400                                                                  06340021
063500     MOVE LENGTH OF CE621AI        TO DP030-MAP-LENGTH (1).       06350021
063600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06360021
063700                                                                  06370021
063800     PERFORM 9000-CALL-CICS-ARCH-API.                             06380021
063900     PERFORM 1000-CONTROL-PROCESSING                              06390021
064000                                                                  06400021
064100     DISPLAY 'PROGRAM EXIT CALL'                                  06410021
064200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06420021
064300     PERFORM 9000-CALL-CICS-ARCH-API.                             06430021
064400/                                                                 06440021
064500*----------------------------------------------------------------*06450021
064600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06460021
064700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06470021
064800*                                                                *06480021
064900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06490021
065000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06500021
065100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06510021
065200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06520021
065300*----------------------------------------------------------------*06530021
065400 1000-CONTROL-PROCESSING.                                         06540021
065500                                                                  06550021
065600     EVALUATE TRUE                                                06560021
065700                                                                  06570021
065800         WHEN DP020-NEXT-ACT-INITIAL                              06580021
065900              DISPLAY 'FIRST'                                     06590021
066000             INITIALIZE ASC-SPECIFIC-COMMAREA                     06600021
066100                                                                  06610021
066200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06620021
066300                                      ASC-SEL-TERM-ID             06630021
066400             MOVE DP020-SRC-TASK-NUMBER                           06640021
066500                                   TO ASC-LIST-TASK-NUMBER        06650021
066600                                      ASC-SEL-TASK-NUMBER         06660021
066700             MOVE PC-LIST-QUEUE-SEQ                               06670021
066800                                   TO ASC-LIST-SEQ                06680021
066900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06690021
067000                                                                  06700021
067100             SET PS-COMMAREA-VALID    TO TRUE                     06710021
067200             MOVE SPACE               TO ASC-START-ITEM-REQUEST   06720021
067300                                                                  06730021
067400             IF  PS-COMMAREA-NOT-VALID                            06740021
067500                 SET DP020-NEXT-ACT-APPL-ERROR                    06750021
067600                                   TO TRUE                        06760021
067700             ELSE                                                 06770021
067800                 PERFORM 1100-PROCESS-INTER-APPL-COMM             06780021
067900                 DISPLAY 'FIRST'                                  06790021
068000                 PERFORM 4000-BUILD-INITIAL-PANEL                 06800021
068100             END-IF                                               06810021
068200                                                                  06820021
068300         WHEN DP020-NEXT-ACT-READ-MAP                             06830021
068400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06840021
068500                                   TO PV-TOP-ITEM                 06850021
068600                 DISPLAY 'SECOND'                                 06860021
068700             PERFORM 2000-PROCESS-PANEL                           06870021
068800                                                                  06880021
068900         WHEN DP020-NEXT-ACT-RETURN                               06890021
068910             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06891021
068920                                   TO PV-TOP-ITEM                 06892021
068930             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06893021
068940             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06894021
068950             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06895021
068960             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06896021
068970                                                                  06897021
068980         WHEN OTHER                                               06898021
068990             SET DP013-LOGIC-ABEND TO TRUE                        06899021
069000             SET DP013-NO-ROLLBACK TO TRUE                        06900021
069100             MOVE '1000-CONTROL-PROCESSING'                       06910021
069200                                   TO DP013-PARAGRAPH             06920021
069300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06930021
069400                                   TO DP013-MESSAGE-TEXT(1)       06940021
069500             PERFORM DP013-0000-PROCESS-ABEND                     06950021
069600     END-EVALUATE.                                                06960021
069700                                                                  06970021
069800*----------------------------------------------------------------*06980021
069900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06990021
070000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07000021
070100*----------------------------------------------------------------*07010021
070200 1100-PROCESS-INTER-APPL-COMM.                                    07020021
070300                                                                  07030021
070400     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07040021
070500         CONTINUE                                                 07050021
070600     ELSE                                                         07060021
070700         SET ASC-USE-SELECTION-QUEUE TO TRUE                      07070021
070800         MOVE CE002-NUMBER-OF-SELECTED-ITEMS TO                   07080021
070900                                      ASC-NUMBER-OF-SELECTED-ITEMS07090021
071000         MOVE CE002-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  07100021
071100         MOVE CE002-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN   07110021
071200         PERFORM 1120-PREPARE-LIST-ENTRY                          07120021
071300     END-IF.                                                      07130021
071400                                                                  07140021
071500*-----------------------------------------------------------------07150021
071600 1120-PREPARE-LIST-ENTRY.                                         07160021
071610                                                                  07161021
071620     MOVE CE003-MAX-ITEMS          TO ASC-SEL-SUB.                07162021
071621     MOVE ZERO                     TO ASC-SEL-ITEM.               07162121
071622     PERFORM 1130-GET-NEXT-RECORD.                                07162221
071623                                                                  07162321
071624*-----------------------------------------------------------------07162421
071625*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*07162521
071626*-----------------------------------------------------------------07162621
071627 1130-GET-NEXT-RECORD.                                            07162721
071628                                                                  07162821
071629     ADD +1                       TO ASC-SEL-SUB.                 07162921
071630                                                                  07163021
071631     IF  ASC-SEL-SUB > CE003-MAX-ITEMS                            07163121
071632         ADD +1                   TO ASC-SEL-ITEM                 07163221
071633         MOVE +1                  TO ASC-SEL-SUB                  07163321
071634     END-IF.                                                      07163421
071635                                                                  07163521
071636     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07163621
071637         PERFORM 9100-READ-SEL-QUEUE                              07163721
071638         IF  CE003-ITEM (ASC-SEL-SUB) > ZERO                      07163821
071639             MOVE CE003-PULL-NUMBER (ASC-SEL-SUB)                 07163921
071640                                              TO ASC-KEY-PULL-NBR 07164021
071641             MOVE CE003-CREATE-DATE (ASC-SEL-SUB)                 07164121
071642                                              TO PV-PULL-CRT-DTE  07164221
071643             MOVE CE003-DIST-PULL-UNITS (ASC-SEL-SUB)             07164321
071644                                              TO ASC-TOT-PULL-UNIT07164421
071645             SET  CE003-INQ (ASC-SEL-SUB) TO TRUE                 07164521
071646             PERFORM 9200-REWRITE-SEL-QUEUE                       07164621
071647         ELSE                                                     07164721
071648             SUBTRACT +1 FROM ASC-SEL-SUB                         07164821
071649             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07164921
071650             SET DP020-MSG-INFORMATIONAL                          07165021
071651                 PS-LIST-END             TO TRUE                  07165121
071652         END-IF                                                   07165221
071653     ELSE                                                         07165321
071654         SUBTRACT +1 FROM ASC-SEL-ITEM                            07165421
071655         MOVE CE003-MAX-ITEMS     TO ASC-SEL-SUB                  07165521
071656         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07165621
071657         SET DP020-MSG-INFORMATIONAL                              07165721
071658             PS-LIST-END             TO TRUE                      07165821
071659     END-IF.                                                      07165921
071660                                                                  07166021
071661*-----------------------------------------------------------------07166121
071662*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07166221
071663*    PROCESSED.                                                  *07166321
071664*-----------------------------------------------------------------07166421
071665 1140-GET-PREV-RECORD.                                            07166521
071666                                                                  07166621
071667     SUBTRACT +1 FROM ASC-SEL-SUB.                                07166721
071668                                                                  07166821
071669     IF  ASC-SEL-SUB < +1                                         07166921
071670         SUBTRACT +1 FROM ASC-SEL-ITEM                            07167021
071671         MOVE CE003-MAX-ITEMS     TO ASC-SEL-SUB                  07167121
071672     END-IF.                                                      07167221
071673                                                                  07167321
071674     IF  ASC-SEL-ITEM > ZERO                                      07167421
071675         PERFORM 9100-READ-SEL-QUEUE                              07167521
071676             MOVE CE003-PULL-NUMBER (ASC-SEL-SUB)                 07167621
071677                                              TO ASC-KEY-PULL-NBR 07167721
071678             MOVE CE003-CREATE-DATE (ASC-SEL-SUB)                 07167821
071679                                              TO PV-PULL-CRT-DTE  07167921
071680             MOVE CE003-DIST-PULL-UNITS (ASC-SEL-SUB)             07168021
071681                                              TO ASC-TOT-PULL-UNIT07168121
071682         SET CE003-INQ (ASC-SEL-SUB) TO TRUE                      07168221
071683         PERFORM 9200-REWRITE-SEL-QUEUE                           07168321
071684     ELSE                                                         07168421
071685         MOVE +1                  TO ASC-SEL-ITEM                 07168521
071686                                     ASC-SEL-SUB                  07168621
071687         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             07168721
071688         SET DP020-MSG-INFORMATIONAL                              07168821
071689             PS-LIST-END             TO TRUE                      07168921
071690     END-IF.                                                      07169021
071691                                                                  07169121
071692/                                                                 07169221
071693*----------------------------------------------------------------*07169321
071694* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07169421
071695* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07169521
071696* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07169621
071697* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07169721
071698* FUNCTION KEYS CAN GET THIS FAR.                                *07169821
071699*----------------------------------------------------------------*07169921
071700 2000-PROCESS-PANEL.                                              07170021
071800     EVALUATE TRUE                                                07180021
071900         WHEN DP020-SRC-AID = DP016-CLEAR                         07190021
072000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07200021
072100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07210021
072200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07220021
072300                                                                  07230021
072400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07240021
072500             PERFORM 2050-DELETE-LIST-QUEUE                       07250021
072600*            MOVE SU010-PO-RCVR(SU010-IDX) TO ASC-KEY-PULL-NBR    07260021
072700             PERFORM 4000-BUILD-INITIAL-PANEL                     07270021
072800                                                                  07280021
072900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07290021
073000             PERFORM 2140-DESELECT-ALL-ITEMS                      07300021
073100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07310021
073200                                                                  07320021
073300         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 07330021
073400              PERFORM 2150-SELECT-ALL-ITEMS                       07340021
073500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07350021
073600                                                                  07360021
073700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07370021
073800             IF  ASC-USE-SELECTION-QUEUE                          07380021
073900                 PERFORM 1130-GET-NEXT-RECORD                     07390021
074000                 IF PS-LIST-END                                   07400021
074100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07410021
074200                     SET PS-NO-LIST-END TO TRUE                   07420021
074300                 ELSE                                             07430021
074310                     PERFORM 2050-DELETE-LIST-QUEUE               07431021
074320                     PERFORM 3200-RESET-ATTRIBUTES                07432021
074330                     PERFORM 4000-BUILD-INITIAL-PANEL             07433021
074340                 END-IF                                           07434021
074350              ELSE                                                07435021
074360                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07436021
074370*                --- BOTTOM OF LIST ---                           07437021
074380                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         07438021
074390                 SET DP020-MSG-INFORMATIONAL TO TRUE              07439021
074391             END-IF                                               07439121
074392                                                                  07439221
074393         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07439321
074394             IF  ASC-USE-SELECTION-QUEUE                          07439421
074395                 PERFORM 1140-GET-PREV-RECORD                     07439521
074396                 IF PS-LIST-END                                   07439621
074397                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07439721
074398                     SET PS-NO-LIST-END TO TRUE                   07439821
074399                 ELSE                                             07439921
074400                     PERFORM 2050-DELETE-LIST-QUEUE               07440021
074401                     PERFORM 3200-RESET-ATTRIBUTES                07440121
074402                     PERFORM 4000-BUILD-INITIAL-PANEL             07440221
074403                 END-IF                                           07440321
074404             ELSE                                                 07440421
074405                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07440521
074406                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         07440621
074407                 SET DP020-MSG-INFORMATIONAL TO TRUE              07440721
074408             END-IF                                               07440821
074409                                                                  07440921
074410         WHEN OTHER                                               07441021
074411             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07441121
074412             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07441221
074413             IF  PS-NO-ERROR                                      07441321
074414                 SET DP030-CONTINUE-GO TO TRUE                    07441421
074415                 PERFORM 2100-CHECK-FUNCTION-KEY                  07441521
074416             ELSE                                                 07441621
074417                 SET DP030-OVERRIDE-GO TO TRUE                    07441721
074418             END-IF                                               07441821
074419     END-EVALUATE.                                                07441921
074420/                                                                 07442021
074430*----------------------------------------------------------------*07443021
074440*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07444021
074450*----------------------------------------------------------------*07445021
074460 2050-DELETE-LIST-QUEUE.                                          07446021
074470                                                                  07447021
074480     EXEC CICS                                                    07448021
074490         DELETEQ TS                                               07449021
074500           QUEUE (ASC-LIST-QUEUE-NAME)                            07450021
074600            RESP (PV-CICS-RESP)                                   07460021
074700     END-EXEC.                                                    07470021
074800                                                                  07480021
074900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07490021
075000        (PV-CICS-RESP = DFHRESP(QIDERR))                          07500021
075100         CONTINUE                                                 07510021
075200     ELSE                                                         07520021
075300         SET DP013-CICS-ABEND      TO TRUE                        07530021
075400         SET DP013-NO-ROLLBACK     TO TRUE                        07540021
075500                                                                  07550021
075600         MOVE '2050-DELETE-LIST-QUEUE'                            07560021
075700                                   TO DP013-PARAGRAPH             07570021
075800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07580021
075900                                   TO DP013-MESSAGE-TEXT (1)      07590021
076000         PERFORM DP013-0000-PROCESS-ABEND                         07600021
076100     END-IF.                                                      07610021
076200                                                                  07620021
076300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07630021
076400/                                                                 07640021
076500*----------------------------------------------------------------*07650021
076600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07660021
076700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07670021
076800* CICS ARCHITECTURE API.                                         *07680021
076900*----------------------------------------------------------------*07690021
077000 2100-CHECK-FUNCTION-KEY.                                         07700021
077100                                                                  07710021
077200     EVALUATE TRUE                                                07720021
077300         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               07730021
077400                                                                  07740021
077500             IF ASC-NUMBER-OF-SELECTED-ITEMS > 0                  07750021
077600                INITIALIZE SU009-INTER-APPL-COMMAREA              07760021
077700                SET SU009-UPDATE-TSQ TO TRUE                      07770021
077800                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 07780021
077900                                TO SU009-NUMBER-OF-SELECTED-ITEMS 07790021
078000                MOVE ASC-KEY-PULL-NBR TO PV-KEY-PULL-NBR          07800021
078100                MOVE PV-KEY-PULL-NBR(2:8)                         07810021
078200                                      TO SU009-PO-RCVR(1:8)       07820021
078300                MOVE '-'              TO SU009-PO-RCVR(09:1)      07830021
078400                MOVE 'CS'             TO SU009-PO-RCVR(10:2)      07840021
078500             ELSE                                                 07850021
078600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07860021
078700                 SET DP030-OVERRIDE-GO                            07870021
078800                                   TO TRUE                        07880021
078900                 MOVE PC-TSYMSG-00057                             07890021
079000                                   TO DP020-MSG-NUMBER            07900021
079100                 SET DP020-MSG-WARNING                            07910021
079200                                   TO TRUE                        07920021
079300             END-IF                                               07930021
079310                                                                  07931021
079320             PERFORM 5000-PREPARE-SEL-QUEUE                       07932021
079330                                                                  07933021
079340         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07934021
079350             MOVE +1               TO PV-TOP-ITEM                 07935021
079360             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07936021
079370             PERFORM 3200-RESET-ATTRIBUTES                        07937021
079380                                                                  07938021
079390* F7                                                              07939021
079400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07940021
079500             PERFORM 2110-BROWSE-BACKWARD                         07950021
079600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07960021
079700             PERFORM 3200-RESET-ATTRIBUTES                        07970021
079800* F8                                                              07980021
079900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07990021
080000             PERFORM 2120-BROWSE-FORWARD                          08000021
080100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08010021
080200             PERFORM 3200-RESET-ATTRIBUTES                        08020021
080300                                                                  08030021
080400         WHEN DP020-SRC-AID = DP016-ENTER                         08040021
080500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08050021
080600             IF  PS-ERROR                                         08060021
080700                 CONTINUE                                         08070021
080800             ELSE                                                 08080021
080900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08090021
081000             END-IF                                               08100021
081100                                                                  08110021
081200         WHEN OTHER                                               08120021
081300             SET DP013-NO-ROLLBACK                                08130021
081400                 DP013-XCTL-DISPLAY-RESTART                       08140021
081500                 DP013-CICS-ABEND  TO TRUE                        08150021
081600             MOVE '2100-CHECK-FUNCTION-KEY1'                      08160021
081700                                   TO DP013-PARAGRAPH             08170021
081800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08180021
081900                                   TO DP013-MESSAGE-TEXT (1)      08190021
082000             PERFORM DP013-0000-PROCESS-ABEND                     08200021
082100     END-EVALUATE.                                                08210021
082200/                                                                 08220021
082300*----------------------------------------------------------------*08230021
082400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08240021
082500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08250021
082600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08260021
082700*    MESSAGE.                                                    *08270021
082800*----------------------------------------------------------------*08280021
082900 2110-BROWSE-BACKWARD.                                            08290021
083000                                                                  08300021
083100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08310021
083200         GIVING PV-TOP-ITEM.                                      08320021
083300                                                                  08330021
083400     IF  ((PV-TOP-ITEM < +1)                                      08340021
083500       OR (PV-TOP-ITEM = +1))                                     08350021
083600         MOVE +1                   TO PV-TOP-ITEM                 08360021
083700*        -- TOP OF LIST --                                        08370021
083800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08380021
083900         SET DP020-MSG-INFORMATIONAL                              08390021
084000                                   TO TRUE                        08400021
084100     END-IF.                                                      08410021
084200/                                                                 08420021
084300*----------------------------------------------------------------*08430021
084400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08440021
084500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08450021
084600*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08460021
084700*----------------------------------------------------------------*08470021
084800 2120-BROWSE-FORWARD.                                             08480021
084900                                                                  08490021
085000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08500021
085100         GIVING PV-TOP-ITEM.                                      08510021
085200                                                                  08520021
085300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08530021
085400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08540021
085500                                   TO PV-TOP-ITEM                 08550021
085600*        -- BOTTOM OF LIST --                                     08560021
085700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08570021
085800         SET DP020-MSG-INFORMATIONAL                              08580021
085900                                   TO TRUE                        08590021
086000     ELSE                                                         08600021
086100         COMPUTE PV-BOTTOM-ITEM =                                 08610021
086200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08620021
086300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08630021
086400*            -- BOTTOM OF LIST --                                 08640021
086500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08650021
086600             SET DP020-MSG-INFORMATIONAL                          08660021
086700                                   TO TRUE                        08670021
086800         END-IF                                                   08680021
086900     END-IF.                                                      08690021
087000/                                                                 08700021
087100*----------------------------------------------------------------*08710021
087200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08720021
087300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08730021
087400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08740021
087500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08750021
087600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08760021
087700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08770021
087800*----------------------------------------------------------------*08780021
087900 2130-CHECK-FOR-JUMP-BROWSE.                                      08790021
088000                                                                  08800021
088100     SET PS-NO-ERROR               TO TRUE.                       08810021
088200     IF (ASC-START-ITEM-REQUEST = SPACE)                          08820021
088300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08830021
088400                                   TO PV-TOP-ITEM                 08840021
088500     ELSE                                                         08850021
088600         MOVE ASC-START-ITEM-REQUEST                              08860021
088700                                   TO DP010I-UNEDITED-FIELD       08870021
088800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08880021
088900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08890021
089000         SET DP010I-NEGATIVE-NOT-ALLOWED                          08900021
089100                                   TO TRUE                        08910021
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08921028
263455              USING DP010I-NUMERIC-EDIT-AREA                      08922028
089300                                                                  08930021
089400         IF  NOT DP010I-ERROR-DETECTED                            08940021
089500             MOVE DP010I-NUMERIC-FIELD                            08950021
089600                                   TO ASC-START-ITEM-REQUEST-N    08960021
089700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08970021
089800                 IF  ASC-START-ITEM-REQUEST-N >                   08980021
089900                                          ASC-NUMBER-OF-ITEMS-READ08990021
090000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09000021
090100                     COMPUTE PV-TOP-ITEM =                        09010021
090200                             ASC-NUMBER-OF-ITEMS-READ             09020021
090300                             - PC-ITEMS-PER-PANEL + 1             09030021
090400                     IF  PV-TOP-ITEM < +1                         09040021
090500                         MOVE +1   TO PV-TOP-ITEM                 09050021
090600                         MOVE PC-TSYMSG-00070                     09060021
090700                                   TO DP020-MSG-NUMBER            09070021
090800                         SET DP020-MSG-INFORMATIONAL              09080021
090900                                   TO TRUE                        09090021
091000                     END-IF                                       09100021
091100                 ELSE                                             09110021
091200                     MOVE ASC-START-ITEM-REQUEST-N                09120021
091300                                   TO PV-TOP-ITEM                 09130021
091400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09140021
091500                     COMPUTE PV-BOTTOM-ITEM =                     09150021
091600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09160021
091700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09170021
091800*                        -- BOTTOM OF LIST --                     09180021
091900                         MOVE PC-TSYMSG-00070                     09190021
092000                                   TO DP020-MSG-NUMBER            09200021
092100                         SET DP020-MSG-INFORMATIONAL              09210021
092200                                   TO TRUE                        09220021
092300                     END-IF                                       09230021
092400                 END-IF                                           09240021
092500             ELSE                                                 09250021
092600*                --- VALUE OUT OF RANGE ----                      09260021
092700                 MOVE PC-TSYMSG-00101                             09270021
092800                                   TO DP020-MSG-NUMBER            09280021
092900                 MOVE -1           TO ASTRTITL                    09290021
093000                 SET DP030-SET-CURSOR-APPL-1                      09300021
093100                                   TO TRUE                        09310021
093200                 MOVE DP015-REVERSE                               09320021
093300                                   TO ASTRTITH                    09330021
093400                 MOVE DP015-RED    TO ASTRTITC                    09340021
093500                 MOVE DP015-UNP-NUM-BRT-MDT                       09350021
093600                                   TO ASTRTITA                    09360021
093700                 SET DP020-MSG-FATAL                              09370021
093800                                   TO TRUE                        09380021
093900                 SET PS-ERROR      TO TRUE                        09390021
094000             END-IF                                               09400021
094100                                                                  09410021
094200         ELSE                                                     09420021
094300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09430021
094400             MOVE -1               TO ASTRTITL                    09440021
094500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09450021
094600             MOVE DP015-REVERSE    TO ASTRTITH                    09460021
094700             MOVE DP015-RED        TO ASTRTITC                    09470021
094800             MOVE DP015-UNP-NUM-BRT-MDT                           09480021
094900                                   TO ASTRTITA                    09490021
095000             SET DP020-MSG-FATAL   TO TRUE                        09500021
095100             SET PS-ERROR          TO TRUE                        09510021
095200         END-IF                                                   09520021
095300     END-IF.                                                      09530021
095400/                                                                 09540021
095500*----------------------------------------------------------------*09550021
095600*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09560021
095700*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09570021
095800*----------------------------------------------------------------*09580021
095900 2140-DESELECT-ALL-ITEMS.                                         09590021
096000                                                                  09600021
096100     MOVE +1                       TO ASC-BLK-SUB.                09610021
096200                                                                  09620021
096300     PERFORM 2141-CLEAR-SELECTED-INDS                             09630021
096400         VARYING ASC-ITEM-SUB                                     09640021
096500         FROM 1 BY 1                                              09650021
096600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09660021
096700                                                                  09670021
096800     ADD +1                        TO ASC-BLK-SUB.                09680021
096900                                                                  09690021
097000     PERFORM 2141-CLEAR-SELECTED-INDS                             09700021
097100         VARYING ASC-ITEM-SUB                                     09710021
097200         FROM 1 BY 1                                              09720021
097300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09730021
097400                                                                  09740021
097500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09750021
097600                                   TO PV-LIST-ITEM-NUMBER.        09760021
097700                                                                  09770021
097800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09780021
097900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09790021
098000                                                                  09800021
098100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09810021
098200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09820021
098300         MOVE +1                   TO ASC-BLK-SUB                 09830021
098400                                                                  09840021
098500         PERFORM 5100-WRITE-TEMP-STORAGE                          09850021
098600                                                                  09860021
098700         MOVE +1                   TO PV-BLOCK-NUMBER             09870021
098800                                                                  09880021
098900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09890021
099000             PV-FIRST-BLOCK-IN-ARRAY - 1                          09900021
099100                                                                  09910021
099200         PERFORM                                                  09920021
099300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09930021
099400                                                                  09940021
099500             PERFORM 4410-READ-TEMP-STORAGE                       09950021
099600                                                                  09960021
099700             PERFORM 2141-CLEAR-SELECTED-INDS                     09970021
099800                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09980021
099900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09990021
100000                                                                  10000021
100100             PERFORM 5100-WRITE-TEMP-STORAGE                      10010021
100200                                                                  10020021
100300             ADD +1                TO PV-BLOCK-NUMBER             10030021
100400                                                                  10040021
100500         END-PERFORM                                              10050021
100600                                                                  10060021
100700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10070021
100800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10080021
100900                                                                  10090021
101000         PERFORM                                                  10100021
101100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10110021
101200                   ASC-HIGHEST-BLOCK-WRITTEN                      10120021
101300                                                                  10130021
101400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10140021
101500                                   TO PV-BLOCK-NUMBER             10150021
101600                                                                  10160021
101700             PERFORM 4410-READ-TEMP-STORAGE                       10170021
101800                                                                  10180021
101900             PERFORM 2141-CLEAR-SELECTED-INDS                     10190021
102000                 VARYING ASC-ITEM-SUB                             10200021
102100                 FROM 1 BY 1                                      10210021
102200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10220021
102300                                                                  10230021
102400             PERFORM 5100-WRITE-TEMP-STORAGE                      10240021
102500                                                                  10250021
102600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10260021
102700                                                                  10270021
102800         END-PERFORM                                              10280021
102900                                                                  10290021
103000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10300021
103100                                   TO PV-BLOCK-NUMBER             10310021
103200                                                                  10320021
103300         PERFORM 4410-READ-TEMP-STORAGE                           10330021
103400     END-IF.                                                      10340021
103500                                                                  10350021
103600     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.10360021
103700     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 10370021
103800     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   10380021
103900                                                                  10390021
104000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10400021
104100/                                                                 10410021
104200*----------------------------------------------------------------*10420021
104300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10430021
104400*----------------------------------------------------------------*10440021
104500 2141-CLEAR-SELECTED-INDS.                                        10450021
104600                                                                  10460021
104700     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          10470021
104800             NOT EQUAL ZERO                                       10480021
104900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10490021
105000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10500021
105100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10510021
105200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10520021
105300                                   TO TRUE                        10530021
105400         END-IF                                                   10540021
105500     END-IF.                                                      10550021
105600/                                                                 10560021
105700*----------------------------------------------------------------*10570021
105800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10580021
105900*  FOR ALL ITEMS.                                                *10590021
106000*----------------------------------------------------------------*10600021
106100 2150-SELECT-ALL-ITEMS.                                           10610021
106200                                                                  10620021
106300     MOVE +1                       TO ASC-BLK-SUB.                10630021
106400                                                                  10640021
106500     PERFORM 2151-SET-SELECTED-INDS                               10650021
106600         VARYING ASC-ITEM-SUB                                     10660021
106700         FROM 1 BY 1                                              10670021
106800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10680021
106900                                                                  10690021
107000     ADD +1                        TO ASC-BLK-SUB.                10700021
107100                                                                  10710021
107200     PERFORM 2151-SET-SELECTED-INDS                               10720021
107300         VARYING ASC-ITEM-SUB                                     10730021
107400         FROM 1 BY 1                                              10740021
107500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10750021
107600                                                                  10760021
107700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10770021
107800                                   TO PV-LIST-ITEM-NUMBER.        10780021
107900                                                                  10790021
108000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10800021
108100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10810021
108200                                                                  10820021
108300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10830021
108400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10840021
108500         MOVE +1                   TO ASC-BLK-SUB                 10850021
108600                                                                  10860021
108700         PERFORM 5100-WRITE-TEMP-STORAGE                          10870021
108800                                                                  10880021
108900         MOVE +1                   TO PV-BLOCK-NUMBER             10890021
109000                                                                  10900021
109100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10910021
109200             PV-FIRST-BLOCK-IN-ARRAY - 1                          10920021
109300                                                                  10930021
109400         PERFORM                                                  10940021
109500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10950021
109600                                                                  10960021
109700             PERFORM 4410-READ-TEMP-STORAGE                       10970021
109800                                                                  10980021
109900             PERFORM 2151-SET-SELECTED-INDS                       10990021
110000                 VARYING ASC-ITEM-SUB                             11000021
110100                 FROM 1 BY 1                                      11010021
110200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11020021
110300                                                                  11030021
110400             PERFORM 5100-WRITE-TEMP-STORAGE                      11040021
110500                                                                  11050021
110600             ADD +1                TO PV-BLOCK-NUMBER             11060021
110700         END-PERFORM                                              11070021
110800                                                                  11080021
110900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11090021
111000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11100021
111100                                                                  11110021
111200         PERFORM                                                  11120021
111300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11130021
111400                   ASC-HIGHEST-BLOCK-WRITTEN                      11140021
111500                                                                  11150021
111600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11160021
111700                                   TO PV-BLOCK-NUMBER             11170021
111800                                                                  11180021
111900             PERFORM 4410-READ-TEMP-STORAGE                       11190021
112000                                                                  11200021
112100             PERFORM 2151-SET-SELECTED-INDS                       11210021
112200                 VARYING ASC-ITEM-SUB                             11220021
112300                 FROM 1 BY 1                                      11230021
112400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11240021
112500                                                                  11250021
112600             PERFORM 5100-WRITE-TEMP-STORAGE                      11260021
112700                                                                  11270021
112800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11280021
112900         END-PERFORM                                              11290021
113000                                                                  11300021
113100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11310021
113200                                   TO PV-BLOCK-NUMBER             11320021
113300                                                                  11330021
113400         PERFORM 4410-READ-TEMP-STORAGE                           11340021
113500     END-IF.                                                      11350021
113600                                                                  11360021
113700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11370021
113800          ASC-NUMBER-OF-SELECTED-ITEMS.                           11380021
113900                                                                  11390021
114000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11400021
114100/                                                                 11410021
114200*----------------------------------------------------------------*11420021
114300*    MARK EACH ITEM AS BEING SELECTED.                           *11430021
114400*----------------------------------------------------------------*11440021
114500 2151-SET-SELECTED-INDS.                                          11450021
114600                                                                  11460021
114700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11470021
114800             NOT EQUAL ZERO                                       11480021
114900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11490021
115000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11500021
115100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11510021
115200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11520021
115300                                   TO TRUE                        11530021
115400         END-IF                                                   11540021
115500     END-IF.                                                      11550021
115600/                                                                 11560021
115700*----------------------------------------------------------------*11570021
115800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *11580021
115900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *11590021
116000*----------------------------------------------------------------*11600021
116100 2200-MOVE-SCREEN-TO-COMMAREA.                                    11610021
116200                                                                  11620021
116300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11630021
116400     MOVE +1                       TO PV-SUB.                     11640021
116500                                                                  11650021
116600     PERFORM 3100-SET-SUBSCRIPTS.                                 11660021
116700                                                                  11670021
116800     IF  ASTRTITL > ZERO                                          11680021
116900         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      11690021
117000     ELSE                                                         11700021
117100         IF  ASTRTITF = DP015-ERASE-EOF                           11710021
117200             INITIALIZE ASC-START-ITEM-REQUEST                    11720021
117300         END-IF                                                   11730021
117400     END-IF.                                                      11740021
117500                                                                  11750021
117600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11760021
117700         VARYING PV-SUB                                           11770021
117800         FROM 1 BY 1                                              11780021
117900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11790021
118000/                                                                 11800021
118100*----------------------------------------------------------------*11810021
118200*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *11820021
118300*----------------------------------------------------------------*11830021
118400 2210-MOVE-LINES-TO-COMMAREA.                                     11840021
118500                                                                  11850021
118600     IF  MR-SELECTL (PV-SUB) > ZERO                               11860021
118700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     11870021
118800                                   TO TRUE                        11880021
118900         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        11890021
119000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11900021
119100     ELSE                                                         11910021
119200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11920021
119300             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         11930021
119400             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        11940021
119500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11950021
119600         END-IF                                                   11960021
119700     END-IF.                                                      11970021
119800                                                                  11980021
119900     ADD +1                        TO ASC-ITEM-SUB.               11990021
120000                                                                  12000021
120100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12010021
120200         ADD +1                    TO ASC-BLK-SUB                 12020021
120300         MOVE +1                   TO ASC-ITEM-SUB                12030021
120400     END-IF.                                                      12040021
120500/                                                                 12050021
120600*----------------------------------------------------------------*12060021
120700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12070021
120800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12080021
120900*----------------------------------------------------------------*12090021
121000 3000-EDIT-DATA-IN-COMMAREA.                                      12100021
121100                                                                  12110021
121200     SET PS-NO-ERROR               TO TRUE.                       12120021
121300                                                                  12130021
121400     PERFORM 3200-RESET-ATTRIBUTES.                               12140021
121500                                                                  12150021
121600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12160021
121700                                                                  12170021
121800     DISPLAY 'ASC-ITEMS-DISPLAYED: ' ASC-ITEMS-DISPLAYED          12180021
121900                                                                  12190021
122000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12200021
122100* EDITTING IS DONE FROM THE BOTTOM UP.                            12210021
122200**                                                                12220021
122300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12230021
122400         ASC-ITEMS-DISPLAYED - 1.                                 12240021
122500                                                                  12250021
122600     PERFORM 3100-SET-SUBSCRIPTS.                                 12260021
122700     PERFORM 3300-EDIT-SELECTIONS                                 12270021
122800         VARYING PV-SUB                                           12280021
122900         FROM PV-SUB BY -1                                        12290021
123000         UNTIL PV-SUB < +1                                        12300021
123100                                                                  12310021
123200     IF  PS-NO-ERROR                                              12320021
123300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12330021
123400     END-IF.                                                      12340021
123500                                                                  12350021
123600     IF  ((PS-NO-ERROR)                                           12360021
123700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12370021
123800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12380021
123900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12390021
124000     END-IF.                                                      12400021
124100/                                                                 12410021
124200*----------------------------------------------------------------*12420021
124300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12430021
124400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12440021
124500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12450021
124600*                                                                *12460021
124700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12470021
124800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12480021
124900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12490021
125000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12500021
125100*----------------------------------------------------------------*12510021
125200 3100-SET-SUBSCRIPTS.                                             12520021
125300                                                                  12530021
125400     COMPUTE ASC-ITEM-SUB =                                       12540021
125500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12550021
125600                                                                  12560021
125700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12570021
125800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12580021
125900                                                                  12590021
126000         MOVE PC-MAX-BLOCKS-IN-ARRAY                              12600021
126100                                   TO ASC-BLK-SUB                 12610021
126200     ELSE                                                         12620021
126300         MOVE +1                   TO ASC-BLK-SUB                 12630021
126400     END-IF.                                                      12640021
126500/                                                                 12650021
126600*----------------------------------------------------------------*12660021
126700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *12670021
126800*----------------------------------------------------------------*12680021
126900 3200-RESET-ATTRIBUTES.                                           12690021
127000                                                                  12700021
127100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12710021
127200     MOVE DP015-GREEN              TO ASTRTITC.                   12720021
127300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12730021
127400                                                                  12740021
127500     IF DP020-NEXT-ACT-RETURN                                     12750021
127600     OR DP020-NEXT-ACT-READ-MAP                                   12760021
127700        PERFORM                                                   12770021
127800            VARYING PV-SUB                                        12780021
127900            FROM 1 BY 1                                           12790021
128000            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    12800021
128100            MOVE DP015-UNP-ALP-NOR-OFF                            12810021
128200                                      TO MR-SELECTA (PV-SUB)      12820021
128300            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      12830021
128400            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      12840021
128500        END-PERFORM                                               12850021
128600     ELSE                                                         12860021
128700        PERFORM                                                   12870021
128800            VARYING PV-SUB                                        12880021
128900            FROM 1 BY 1                                           12890021
129000            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     12900021
129100            MOVE DP015-UNP-ALP-NOR-OFF                            12910021
129200                                      TO MR-SELECTA (PV-SUB)      12920021
129300            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      12930021
129400            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      12940021
129500        END-PERFORM                                               12950021
129600     END-IF.                                                      12960021
129700/                                                                 12970021
129800*----------------------------------------------------------------*12980021
129900*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *12990021
130000*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *13000021
130100*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *13010021
130200*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *13020021
130300*----------------------------------------------------------------*13030021
130400 3300-EDIT-SELECTIONS.                                            13040021
130500                                                                  13050021
130600     EVALUATE TRUE                                                13060021
130700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13070021
130800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13080021
130900                 CONTINUE                                         13090021
131000                                                                  13100021
131100         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13110021
131200             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13120021
131300                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS13130021
131400                 MOVE ASC-TEMP-SELECTED-SW                        13140021
131500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13150021
131600                                   TO ASC-SELECTED-SW             13160021
131700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13170021
131800             END-IF                                               13180021
131900                                                                  13190021
132000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13200021
132100                 = SPACE                                          13210021
132200             EVALUATE TRUE                                        13220021
132300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13230021
132400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13240021
132500                     MOVE SPACE    TO ASC-SELECTED-SW             13250021
132600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13260021
132700                                                                  13270021
132800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13280021
132900                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 13290021
133000                     MOVE SPACE    TO ASC-SELECTED-SW             13300021
133100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13310021
133200                                                                  13320021
133300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13330021
133400                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   13340021
133500                     MOVE SPACE    TO ASC-SELECTED-SW             13350021
133600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13360021
133700             END-EVALUATE                                         13370021
133800                                                                  13380021
133900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13390021
134000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13400021
134100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13410021
134200             END-IF                                               13420021
134300             PERFORM 3310-EDIT-RANGE                              13430021
134400                                                                  13440021
134500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13450021
134600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13460021
134700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13470021
134800             END-IF                                               13480021
134900             PERFORM 3310-EDIT-RANGE                              13490021
135000                                                                  13500021
135100         WHEN OTHER                                               13510021
135200             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            13520021
135300             SET DP020-MSG-FATAL   TO TRUE                        13530021
135400             MOVE -1               TO MR-SELECTL (PV-SUB)         13540021
135500             SET DP030-SET-CURSOR-APPL-1                          13550021
135600                                   TO TRUE                        13560021
135700             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         13570021
135800             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         13580021
135900             SET PS-ERROR          TO TRUE                        13590021
136000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13600021
136100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13610021
136200                 MOVE SPACE        TO ASC-SELECTED-SW             13620021
136300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13630021
136400             END-IF                                               13640021
136500     END-EVALUATE.                                                13650021
136600                                                                  13660021
136700     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             13670021
136800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13680021
136900                                                                  13690021
137000     IF  ASC-ITEM-SUB < 1                                         13700021
137100         SUBTRACT +1 FROM ASC-BLK-SUB                             13710021
137200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13720021
137300     END-IF.                                                      13730021
137400/                                                                 13740021
137500*----------------------------------------------------------------*13750021
137600*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *13760021
137700*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *13770021
137800*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *13780021
137900*  THE ENDING.                                                   *13790021
138000*----------------------------------------------------------------*13800021
138100 3310-EDIT-RANGE.                                                 13810021
138200                                                                  13820021
138300     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13830021
138400         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13840021
138500             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13850021
138600                                   TO ASC-SELECTED-SW             13860021
138700                                        (ASC-BLK-SUB ASC-ITEM-SUB)13870021
138800             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13880021
138900         ELSE                                                     13890021
139000             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13900021
139100                 CONTINUE                                         13910021
139200             ELSE                                                 13920021
139300*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13930021
139400                 MOVE PC-TSYMSG-00054                             13940021
139500                                   TO DP020-MSG-NUMBER            13950021
139600                 SET DP020-MSG-FATAL                              13960021
139700                                   TO TRUE                        13970021
139800                 MOVE -1           TO MR-SELECTL (PV-SUB)         13980021
139900                 SET DP030-SET-CURSOR-APPL-1                      13990021
140000                                   TO TRUE                        14000021
140100                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14010021
140200                 MOVE DP015-UNDERLINE                             14020021
140300                                   TO MR-SELECTH (PV-SUB)         14030021
140400                 SET PS-ERROR      TO TRUE                        14040021
140500             END-IF                                               14050021
140600         END-IF                                                   14060021
140700     ELSE                                                         14070021
140800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14080021
140900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14090021
141000                                   TO ASC-SELECTED-SW             14100021
141100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14110021
141200             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14120021
141300         ELSE                                                     14130021
141400             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14140021
141500                 CONTINUE                                         14150021
141600             ELSE                                                 14160021
141700*                -- ONLY ONE END-OF-RANGE ALLOWED --              14170021
141800                 MOVE PC-TSYMSG-00055                             14180021
141900                                   TO DP020-MSG-NUMBER            14190021
142000                 SET DP020-MSG-FATAL                              14200021
142100                                   TO TRUE                        14210021
142200                 MOVE -1           TO MR-SELECTL (PV-SUB)         14220021
142300                 SET DP030-SET-CURSOR-APPL-1                      14230021
142400                                   TO TRUE                        14240021
142500                 SET PS-ERROR      TO TRUE                        14250021
142600             END-IF                                               14260021
142700         END-IF                                                   14270021
142800     END-IF.                                                      14280021
142900/                                                                 14290021
143000*----------------------------------------------------------------*14300021
143100*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *14310021
143200*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *14320021
143300*----------------------------------------------------------------*14330021
143400 3400-CHECK-RANGE-SEQUENCE.                                       14340021
143500                                                                  14350021
143600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14360021
143700       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14370021
143800       AND  ASC-START-OF-SELECTED-RANGE >                         14380021
143900                                         ASC-END-OF-SELECTED-RANGE14390021
144000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14400021
144100         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            14410021
144200         SET DP020-MSG-FATAL       TO TRUE                        14420021
144300         SET PS-ERROR              TO TRUE                        14430021
144400         PERFORM 3410-POSITION-AT-ERROR                           14440021
144500     END-IF.                                                      14450021
144600/                                                                 14460021
144700*----------------------------------------------------------------*14470021
144800*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *14480021
144900*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *14490021
145000*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *14500021
145100*----------------------------------------------------------------*14510021
145200 3410-POSITION-AT-ERROR.                                          14520021
145300                                                                  14530021
145400     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14540021
145500                                                                  14550021
145600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14560021
145700                    - PV-TOP-ITEM + 1.                            14570021
145800                                                                  14580021
145900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14590021
146000         CONTINUE                                                 14600021
146100     ELSE                                                         14610021
146200         MOVE -1                   TO MR-SELECTL (PV-SUB)         14620021
146300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14630021
146400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14640021
146500     END-IF.                                                      14650021
146600                                                                  14660021
146700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14670021
146800                    - PV-TOP-ITEM + 1.                            14680021
146900                                                                  14690021
147000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14700021
147100         CONTINUE                                                 14710021
147200     ELSE                                                         14720021
147300         MOVE -1                   TO MR-SELECTL (PV-SUB)         14730021
147400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14740021
147500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14750021
147600     END-IF.                                                      14760021
147700/                                                                 14770021
147800*----------------------------------------------------------------*14780021
147900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14790021
148000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14800021
148100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14810021
148200*----------------------------------------------------------------*14820021
148300 3500-MARK-RANGE-AS-SELECTED.                                     14830021
148400                                                                  14840021
148500     MOVE +1                       TO ASC-BLK-SUB.                14850021
148600                                                                  14860021
148700     PERFORM 3510-MARK-SELECTED-INDS                              14870021
148800         VARYING ASC-ITEM-SUB                                     14880021
148900         FROM 1 BY 1                                              14890021
149000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14900021
149100                                                                  14910021
149200     ADD +1                        TO ASC-BLK-SUB.                14920021
149300                                                                  14930021
149400     PERFORM 3510-MARK-SELECTED-INDS                              14940021
149500         VARYING ASC-ITEM-SUB                                     14950021
149600         FROM 1 BY 1                                              14960021
149700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14970021
149800                                                                  14980021
149900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14990021
150000                                   TO PV-LIST-ITEM-NUMBER.        15000021
150100                                                                  15010021
150200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15020021
150300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15030021
150400               PC-ITEMS-PER-PANEL).                               15040021
150500                                                                  15050021
150600     MOVE ASC-START-OF-SELECTED-RANGE                             15060021
150700                                   TO PV-START-OF-SELECTED-RANGE. 15070021
150800                                                                  15080021
150900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15090021
151000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15100021
151100               PC-ITEMS-PER-PANEL).                               15110021
151200                                                                  15120021
151300     MOVE ASC-END-OF-SELECTED-RANGE                               15130021
151400                                   TO PV-END-OF-SELECTED-RANGE.   15140021
151500                                                                  15150021
151600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15160021
151700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15170021
151800               PC-ITEMS-PER-PANEL).                               15180021
151900                                                                  15190021
152000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15200021
152100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15210021
152200                                                                  15220021
152300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15230021
152400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15240021
152500         MOVE +1                   TO ASC-BLK-SUB                 15250021
152600         PERFORM 5100-WRITE-TEMP-STORAGE                          15260021
152700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15270021
152800             PV-FIRST-BLOCK-IN-ARRAY - 1                          15280021
152900                                                                  15290021
153000         PERFORM                                                  15300021
153100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15310021
153200                   PV-PREV-BLOCK-IN-ARRAY                         15320021
153300             MOVE PV-FIRST-BLOCK-IN-RANGE                         15330021
153400                                   TO PV-BLOCK-NUMBER             15340021
153500             PERFORM 4410-READ-TEMP-STORAGE                       15350021
153600             PERFORM 3510-MARK-SELECTED-INDS                      15360021
153700                 VARYING ASC-ITEM-SUB                             15370021
153800                 FROM 1 BY 1                                      15380021
153900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15390021
154000             PERFORM 5100-WRITE-TEMP-STORAGE                      15400021
154100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15410021
154200         END-PERFORM                                              15420021
154300                                                                  15430021
154400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15440021
154500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15450021
154600         PERFORM                                                  15460021
154700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15470021
154800                   PV-LAST-BLOCK-IN-RANGE                         15480021
154900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15490021
155000                                   TO PV-BLOCK-NUMBER             15500021
155100             PERFORM 4410-READ-TEMP-STORAGE                       15510021
155200             PERFORM 3510-MARK-SELECTED-INDS                      15520021
155300                 VARYING ASC-ITEM-SUB                             15530021
155400                 FROM 1 BY 1                                      15540021
155500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15550021
155600             PERFORM 5100-WRITE-TEMP-STORAGE                      15560021
155700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15570021
155800         END-PERFORM                                              15580021
155900                                                                  15590021
156000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15600021
156100                                   TO PV-BLOCK-NUMBER             15610021
156200         PERFORM 4410-READ-TEMP-STORAGE                           15620021
156300     END-IF.                                                      15630021
156400                                                                  15640021
156500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15650021
156600                                      ASC-END-OF-SELECTED-RANGE.  15660021
156700/                                                                 15670021
156800*----------------------------------------------------------------*15680021
156900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15690021
157000*----------------------------------------------------------------*15700021
157100 3510-MARK-SELECTED-INDS.                                         15710021
157200                                                                  15720021
157300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         15730021
157400         ASC-START-OF-SELECTED-RANGE)                             15740021
157500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         15750021
157600         ASC-START-OF-SELECTED-RANGE)                             15760021
157700                                                                  15770021
157800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     15780021
157900             ASC-END-OF-SELECTED-RANGE)                           15790021
158000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     15800021
158100             ASC-END-OF-SELECTED-RANGE)                           15810021
158200                                                                  15820021
158300             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15830021
158400                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15840021
158500                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15850021
158600                                   TO TRUE                        15860021
158700                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15870021
158800                                   TO TRUE                        15880021
158900                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS15890021
159000             END-IF                                               15900021
159100         END-IF                                                   15910021
159200     END-IF.                                                      15920021
159300/                                                                 15930021
159400*----------------------------------------------------------------*15940021
159500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15950021
159600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15960021
159700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15970021
159800*    DISPLAY THE PANEL TO USER.                                  *15980021
159900*----------------------------------------------------------------*15990021
160000 4000-BUILD-INITIAL-PANEL.                                        16000021
160100                                                                  16010021
160200     INITIALIZE ASC-BLOCK-ENTRIES (1)                             16020021
160300                ASC-BLOCK-ENTRIES (2).                            16030021
160400                                                                  16040021
160500     MOVE +1                       TO ASC-BLK-SUB.                16050021
160600                                                                  16060021
160700     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       16070021
160800                                                                  16080021
160900     MOVE +0                       TO ASC-ITEM-SUB                16090021
161000                                      ASC-NUMBER-OF-ITEMS-READ    16100021
161100                                      ASC-NUMBER-OF-SELECTED-ITEMS16110021
161200                                      ASC-HIGHEST-BLOCK-WRITTEN   16120021
161300                                      ASC-START-OF-SELECTED-RANGE 16130021
161400                                      ASC-END-OF-SELECTED-RANGE   16140021
161500                                      ASC-ITEM-AT-TOP-OF-PANEL.   16150021
161600                                                                  16160021
161700     PERFORM 4010-OPEN-CURSOR.                                    16170021
161800                                                                  16180021
161900     PERFORM 4300-READ-ITEMS-FROM-DB.                             16190021
162000                                                                  16200021
162100     PERFORM 4020-CLOSE-CURSOR.                                   16210021
162200                                                                  16220021
162300     MOVE +1                       TO PV-TOP-ITEM.                16230021
162400                                                                  16240021
162500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16250021
162600         SET DP020-NEXT-ACT-APPL-ERROR                            16260021
162700                                   TO TRUE                        16270021
162800         SET DP020-MSG-FATAL       TO TRUE                        16280021
162900         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            16290021
163000     ELSE                                                         16300021
163100         MOVE -1                   TO MR-SELECTL (1)              16310021
163200         SET DP030-SET-CURSOR-APPL-1                              16320021
163300                                   TO TRUE                        16330021
163400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16340021
163500     END-IF.                                                      16350021
163600/                                                                 16360021
163700*----------------------------------------------------------------*16370021
163800* OPEN THE DC CURSOR.                                            *16380021
163900*----------------------------------------------------------------*16390021
164000 4010-OPEN-CURSOR.                                                16400021
164100                                                                  16410021
164200         EXEC SQL                                                 16420021
164300             OPEN DC-CSR                                          16430021
164400         END-EXEC                                                 16440021
164500                                                                  16450021
164600     EVALUATE TRUE                                                16460021
164700         WHEN SQLCODE = ZERO                                      16470021
164800                 CONTINUE                                         16480021
164900                                                                  16490021
165000         WHEN SQLCODE = -904                                      16500021
165100         WHEN SQLCODE = -911                                      16510021
165200         WHEN SQLCODE = -913                                      16520021
165300              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       16530021
165400              SET PS-ERROR                                        16540021
165500                  DP020-NEXT-ACT-APPL-ERROR                       16550021
165600                  DP020-MSG-FATAL                                 16560021
165700                      TO TRUE                                     16570021
165800              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 16580021
165900              PERFORM 9000-CALL-CICS-ARCH-API                     16590021
166000                                                                  16600021
166100         WHEN SQLWARN0 NOT = SPACES                               16610021
166200         WHEN SQLCODE < ZERO                                      16620021
166300         WHEN SQLCODE > ZERO                                      16630021
166400             MOVE '4010-OPEN-CURSOR'                              16640021
166500                               TO DP013-PARAGRAPH                 16650021
166600             MOVE 'OPEN DC-CSR CURSOR'                            16660021
166700                               TO DP013-MESSAGE-TEXT (1)          16670021
166800             MOVE SQLCA        TO DP013-SQLCA                     16680021
166900             MOVE 'XLT_LOC '           TO DP013-DB2-TABLE-NAME (1)16690021
167000             MOVE 'XLT_DC_LOC_ASGMT '  TO DP013-DB2-TABLE-NAME (2)16700021
167100             MOVE 'TCEPLDSM'           TO DP013-DB2-TABLE-NAME (3)16710021
167200             SET DP013-DB2-ABEND                                  16720021
167300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16730021
167400             PERFORM DP013-0000-PROCESS-ABEND                     16740021
167500     END-EVALUATE.                                                16750021
167600/                                                                 16760021
167700*----------------------------------------------------------------*16770021
167800* CLOSE THE DC CURSOR                                            *16780021
167900*----------------------------------------------------------------*16790021
168000 4020-CLOSE-CURSOR.                                               16800021
168100                                                                  16810021
168200     EXEC SQL                                                     16820021
168300         CLOSE DC-CSR                                             16830021
168400     END-EXEC.                                                    16840021
168500                                                                  16850021
168600     EVALUATE TRUE                                                16860021
168700         WHEN SQLCODE = ZERO                                      16870021
168800             CONTINUE                                             16880021
168900         WHEN SQLCODE = -904                                      16890021
169000         WHEN SQLCODE = -911                                      16900021
169100         WHEN SQLCODE = -913                                      16910021
169200              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       16920021
169300              SET PS-ERROR                                        16930021
169400                  DP020-NEXT-ACT-APPL-ERROR                       16940021
169500                  DP020-MSG-FATAL                                 16950021
169600                      TO TRUE                                     16960021
169700              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 16970021
169800              PERFORM 9000-CALL-CICS-ARCH-API                     16980021
169900                                                                  16990021
170000         WHEN SQLWARN0 NOT = SPACES                               17000021
170100         WHEN SQLCODE < ZERO                                      17010021
170200         WHEN SQLCODE > ZERO                                      17020021
170300             MOVE '4020-CLOSE-CURSOR'                             17030021
170400                                   TO DP013-PARAGRAPH             17040021
170500             MOVE 'CLOSE DC-CSR CURSOR'                           17050021
170600                                   TO DP013-MESSAGE-TEXT (1)      17060021
170700             MOVE SQLCA            TO DP013-SQLCA                 17070021
170800             MOVE 'XLT_LOC '           TO DP013-DB2-TABLE-NAME (1)17080021
170900             MOVE 'XLT_DC_LOC_ASGMT '  TO DP013-DB2-TABLE-NAME (2)17090021
171000             MOVE 'TCEPLDS '           TO DP013-DB2-TABLE-NAME (3)17100021
171100             SET DP013-DB2-ABEND                                  17110021
171200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17120021
171300             PERFORM DP013-0000-PROCESS-ABEND                     17130021
171400     END-EVALUATE.                                                17140021
171500/                                                                 17150021
171600*----------------------------------------------------------------*17160021
171700*    GET THE UNITS AND DOLLARS ORDERED FROM TPURCHS, THEN        *17170021
171800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17180021
171900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17190021
172000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17200021
172100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17210021
172200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17220021
172300*                                                                *17230021
172400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17240021
172500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17250021
172600*    UPON INITIALIZATION.                                        *17260021
172700*----------------------------------------------------------------*17270021
172800 4300-READ-ITEMS-FROM-DB.                                         17280021
172900                                                                  17290021
173000     PERFORM 4305-GET-PULL-CMP-DTE.                               17300021
173100                                                                  17310021
173200     PERFORM                                                      17320021
173300         VARYING PV-READ-COUNT                                    17330021
173400         FROM 1 BY 1                                              17340021
173500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17350021
173600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17360021
173700                                                                  17370021
173800         PERFORM 4310-FETCH                                       17380021
173900                                                                  17390021
174000         IF ASC-NO-ITEMS-LEFT-ON-DB                               17400021
174100            CONTINUE                                              17410021
174200         ELSE                                                     17420021
174300            IF XLT00010-E-BUS-IND = 'Y'                           17430021
174400               PERFORM 4700-GET-ECOMM-DC                          17440021
174500            END-IF                                                17450021
174600            PERFORM 4800-INCR-ASC-COMM-AREA                       17460021
174700            PERFORM 4315-GET-DETAIL                               17470021
174800         END-IF                                                   17480021
174900                                                                  17490021
175000     END-PERFORM.                                                 17500021
175100                                                                  17510021
175200     STRING PV-PULL-CRT-DTE(3:2) '/'                              17520021
175300            PV-PULL-CRT-DTE(6:2) '/'                              17530021
175400            PV-PULL-CRT-DTE(9:2)                                  17540021
175500            DELIMITED BY SIZE INTO ASC-PULL-CRT-DTE               17550021
175600                                                                  17560021
175700     IF PV-PULL-CMP-DTE = SPACES                                  17570021
175800        MOVE SPACES TO ASC-PULL-CMP-DTE                           17580021
175900     ELSE                                                         17590021
176000        STRING PV-PULL-CMP-DTE(6:2) '/'                           17600021
176100               PV-PULL-CMP-DTE(9:2) '/'                           17610021
176200               PV-PULL-CMP-DTE(3:2)                               17620021
176300               DELIMITED BY SIZE INTO ASC-PULL-CMP-DTE            17630021
176400     END-IF                                                       17640021
176500                                                                  17650021
176600     MOVE PV-TOT-UNITS-SHPD          TO ASC-TOT-SHP-UNT           17660021
176700                                        ASC-TOT-UNITS-TO-STR      17670021
176800     MOVE PV-TOT-CTN-CNT             TO ASC-TOT-CTN-CNT           17680021
176900     MOVE PV-TOT-REQ-UNITS           TO ASC-TOT-REQ-UNITS         17690021
177000                                                                  17700021
177100     IF PV-TOT-REQ-UNITS > ZEROS                                  17710021
177200                                                                  17720021
177300        DIVIDE PV-TOT-UNITS-SHPD BY PV-TOT-REQ-UNITS              17730021
177400        GIVING PV-PCT-UNITS-TO-STR ROUNDED                        17740021
177500                                                                  17750021
177600        MULTIPLY PV-PCT-UNITS-TO-STR BY 100                       17760021
177700        GIVING ASC-PCT-UNITS-TO-STR                               17770021
177800                                                                  17780021
177900     ELSE                                                         17790021
178000        MOVE ZEROS TO ASC-PCT-UNITS-TO-STR                        17800021
178100     END-IF                                                       17810021
178200                                                                  17820021
178300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17830021
178400         MOVE +1                   TO ASC-BLK-SUB                 17840021
178500         PERFORM 5100-WRITE-TEMP-STORAGE                          17850021
178600         ADD +1                    TO ASC-BLK-SUB                 17860021
178700         PERFORM 5100-WRITE-TEMP-STORAGE                          17870021
178800                                                                  17880021
178900         MOVE 1                    TO ASC-BLK-SUB                 17890021
179000                                      PV-BLOCK-NUMBER             17900021
179100         PERFORM 4410-READ-TEMP-STORAGE                           17910021
179200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17920021
179300             MOVE 2                TO ASC-BLK-SUB                 17930021
179400                                      PV-BLOCK-NUMBER             17940021
179500             PERFORM 4410-READ-TEMP-STORAGE                       17950021
179600         END-IF                                                   17960021
179700     END-IF.                                                      17970021
179800/                                                                 17980021
179900*----------------------------------------------------------------*17990021
180000*    GET PULL COMPLETE DATE                                      *18000021
180100*----------------------------------------------------------------*18010021
180200 4305-GET-PULL-CMP-DTE.                                           18020021
180300                                                                  18030021
180400         EXEC SQL                                                 18040021
180500            SELECT MAX(CRE_TMST)                                  18050021
180600              INTO :PV-PULL-CMP-DTE :DN-PULL-CMP-DTE              18060021
180700            FROM   TCEPLST                                        18070021
180800            WHERE  CNSTK_REQ_PL_NBR = :ASC-KEY-PULL-NBR           18080021
180900              AND  STAT_CDE = 'PD'                                18090021
181000         END-EXEC.                                                18100021
181100                                                                  18110021
181200     EVALUATE TRUE                                                18120021
181300         WHEN SQLCODE = ZERO                                      18130021
181400              IF DN-PULL-CMP-DTE = -1                             18140021
181500                 MOVE SPACES       TO   PV-PULL-CMP-DTE           18150021
181600              ELSE                                                18160021
181700                 CONTINUE                                         18170021
181800              END-IF                                              18180021
181900         WHEN SQLCODE = +100                                      18190021
182000              MOVE SPACE  TO PV-PULL-CMP-DTE                      18200021
182100         WHEN SQLCODE = -904                                      18210021
182200         WHEN SQLCODE = -911                                      18220021
182300         WHEN SQLCODE = -913                                      18230021
182310              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       18231021
182320              SET PS-ERROR                                        18232021
182330                  DP020-NEXT-ACT-APPL-ERROR                       18233021
182340                  DP020-MSG-FATAL                                 18234021
182350                      TO TRUE                                     18235021
182360              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 18236021
182370              PERFORM 9000-CALL-CICS-ARCH-API                     18237021
182380                                                                  18238021
182390         WHEN SQLWARN0 NOT = SPACES                               18239021
182400         WHEN SQLCODE < ZERO                                      18240021
182500         WHEN SQLCODE > ZERO                                      18250021
182600             MOVE '4305-GET-PULL-CMP-DTE'                         18260021
182700                               TO DP013-PARAGRAPH                 18270021
182800             MOVE 'GET PULL COMPLETE DATE '                       18280021
182900                               TO DP013-MESSAGE-TEXT (1)          18290021
183000             MOVE SQLCA        TO DP013-SQLCA                     18300021
183100             MOVE 'TCEPLST '   TO DP013-DB2-TABLE-NAME (1)        18310021
183200             SET DP013-DB2-ABEND                                  18320021
183300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18330021
183400             PERFORM DP013-0000-PROCESS-ABEND                     18340021
183500     END-EVALUATE.                                                18350021
183600/                                                                 18360021
183700*----------------------------------------------------------------*18370021
183800*    FETCH A RCVR ROW                                            *18380021
183900*----------------------------------------------------------------*18390021
184000 4310-FETCH.                                                      18400021
184100                                                                  18410021
184200     EXEC SQL                                                     18420021
184300         FETCH DC-CSR                                             18430021
184400          INTO :XLT00014-DC-NBR                                   18440021
184500             , :XLT00010-E-BUS-IND                                18450021
184600     END-EXEC.                                                    18460021
184700                                                                  18470021
184800     EVALUATE TRUE                                                18480021
184900         WHEN SQLCODE = +0                                        18490021
185000              MOVE XLT00014-DC-NBR TO PV-DC-NBR                   18500021
185100                                      PV-DC-NBR-ORG               18510021
185200         WHEN SQLCODE = +100                                      18520021
185300              SET ASC-NO-ITEMS-LEFT-ON-DB                         18530021
185400                                   TO TRUE                        18540021
185500         WHEN SQLWARN0 NOT = SPACE                                18550021
185600         WHEN SQLCODE < +0                                        18560021
185700         WHEN SQLCODE > +0                                        18570021
185800              MOVE '4310-FETCH-CURSOR'                            18580021
185900                                   TO DP013-PARAGRAPH             18590021
186000              MOVE 'FETCH DC CURSOR'                              18600021
186100                                   TO DP013-MESSAGE-TEXT (1)      18610021
186200              MOVE SQLCA           TO DP013-SQLCA                 18620021
186300              MOVE 'XLT00014-DC-NBR'  TO DP013-DB2-TABLE-NAME (1) 18630021
186400              MOVE 'TSTATCD'       TO DP013-DB2-TABLE-NAME (2)    18640021
186500              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (3)    18650021
186600              SET DP013-DB2-ABEND  TO TRUE                        18660021
186700              PERFORM DP013-0000-PROCESS-ABEND                    18670021
186800     END-EVALUATE.                                                18680021
186900                                                                  18690021
187000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18700021
187100         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             18710021
187200         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             18720021
187300                                   TO DP013-MESSAGE-TEXT (1)      18730021
187400         MOVE SQLCA                TO DP013-SQLCA                 18740021
187500         SET DP013-DB2-ABEND                                      18750021
187600             DP013-XCTL-DISPLAY-RESTART                           18760021
187700                                   TO TRUE                        18770021
187800         PERFORM DP013-0000-PROCESS-ABEND                         18780021
187900     END-IF.                                                      18790021
188000                                                                  18800021
188100/                                                                 18810021
188200 4315-GET-DETAIL.                                                 18820021
188300                                                                  18830021
188400      MOVE XLT00014-DC-NBR  TO DK-DC-NBR.                         18840021
188500         PERFORM 4330-GET-ARRIVAL-DATE-TIME                       18850021
188600                                                                  18860021
188700         IF PV-TRLR-STATUS = 'AR'                                 18870021
188800            CONTINUE                                              18880021
188900         ELSE                                                     18890021
189000            PERFORM 4326-GET-EN-STATUS                            18900021
189100         END-IF                                                   18910021
189200                                                                  18920021
189300         PERFORM 4340-GET-SHPTSTR-DATA                            18930021
189400         PERFORM 4342-GET-SHPTSTR-CRTNS                           18940021
189500                                                                  18950021
189600      PERFORM 4350-GET-REQ-UNITS.                                 18960021
189700      MOVE PV-DC-NBR-ORG        TO ASC-ACTION                     18970021
189800                                    (ASC-BLK-SUB ASC-ITEM-SUB).   18980021
189900      MOVE PV-DC-NBR            TO ASC-DC-LOC                     18990021
190000                                    (ASC-BLK-SUB ASC-ITEM-SUB).   19000021
190100      MOVE PV-TRLR-STATUS       TO ASC-DC-STAT-CD                 19010021
190200                                    (ASC-BLK-SUB ASC-ITEM-SUB).   19020021
190300      IF PV-ARRIVAL-DATE = SPACES                                 19030021
190400         MOVE SPACES TO ASC-ARRIVAL-DTE (ASC-BLK-SUB ASC-ITEM-SUB)19040021
190500      ELSE                                                        19050021
190600         STRING PV-ARRIVAL-DATE(6:2) '/'                          19060021
190700                PV-ARRIVAL-DATE(9:2) '/'                          19070021
190800                PV-ARRIVAL-DATE(3:2)                              19080021
190900                DELIMITED BY SIZE                                 19090021
191000                            INTO ASC-ARRIVAL-DTE                  19100021
191100                                 (ASC-BLK-SUB ASC-ITEM-SUB)       19110021
191200              MOVE SPACES TO PV-ARRIVAL-DATE                      19120021
191300      END-IF.                                                     19130021
191400                                                                  19140021
191500      IF PV-ARRIVAL-TIME = SPACES                                 19150021
191600        MOVE SPACES TO ASC-ARRIVAL-TIME (ASC-BLK-SUB ASC-ITEM-SUB)19160021
191700      ELSE                                                        19170021
191800        STRING PV-ARRIVAL-TIME(1:2) ':'                           19180021
191900               PV-ARRIVAL-TIME(4:2)                               19190021
192000               DELIMITED BY SIZE                                  19200021
192100                            INTO ASC-ARRIVAL-TIME                 19210021
192200                                 (ASC-BLK-SUB ASC-ITEM-SUB)       19220021
192300              MOVE SPACES TO PV-ARRIVAL-TIME                      19230021
192400      END-IF.                                                     19240021
192500                                                                  19250021
192600                                                                  19260021
192700      IF PV-OTBND-STAT-TMST = SPACES                              19270021
192800        MOVE SPACES TO ASC-SHPTSTR-DTE  (ASC-BLK-SUB ASC-ITEM-SUB)19280021
192900                       ASC-SHPTSTR-TIME (ASC-BLK-SUB ASC-ITEM-SUB)19290021
193000      ELSE                                                        19300021
193100        STRING PV-OTBND-STAT-TMST(6:2) '/'                        19310021
193200               PV-OTBND-STAT-TMST(9:2) '/'                        19320021
193300               PV-OTBND-STAT-TMST(3:2)                            19330021
193400               DELIMITED BY SIZE                                  19340021
193500                               INTO ASC-SHPTSTR-DTE               19350021
193600                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19360021
193700                                                                  19370021
193800        STRING PV-OTBND-STAT-TMST(12:2) ':'                       19380021
193900               PV-OTBND-STAT-TMST(15:2)                           19390021
194000               DELIMITED BY SIZE                                  19400021
194100                               INTO ASC-SHPTSTR-TIME              19410021
194200                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19420021
194300              MOVE SPACES TO PV-OTBND-STAT-TMST                   19430021
194400      END-IF.                                                     19440021
194500                                                                  19450021
194600                                                                  19460021
194700      IF  PV-REQ-ORD-QTY  GREATER THAN ZERO                       19470021
194800          MOVE PV-REQ-ORD-QTY                                     19480021
194900                                TO ASC-REQ-UNT                    19490021
195000                                    (ASC-BLK-SUB ASC-ITEM-SUB)    19500021
195100      ELSE                                                        19510021
195200          MOVE ZEROS                                              19520021
195300                                TO ASC-REQ-UNT                    19530021
195400                                    (ASC-BLK-SUB ASC-ITEM-SUB)    19540021
195500      END-IF.                                                     19550021
195600                                                                  19560021
195700      IF (ASC-SHPTSTR-TIME(ASC-BLK-SUB ASC-ITEM-SUB)) =           19570021
195800          SPACES                                                  19580021
195900          MOVE ZEROES TO                                          19590021
196000                      ASC-DC-SHP-UNT (ASC-BLK-SUB ASC-ITEM-SUB)   19600021
196100                      ASC-CARTON-CNT (ASC-BLK-SUB ASC-ITEM-SUB)   19610021
196200      ELSE                                                        19620021
196300          MOVE PV-SHPD-UNT-QTY  TO  ASC-DC-SHP-UNT                19630021
196400                                    (ASC-BLK-SUB ASC-ITEM-SUB)    19640021
196500                                                                  19650021
196600          MOVE PV-CTN-CNT       TO  ASC-CARTON-CNT                19660021
196700                                    (ASC-BLK-SUB ASC-ITEM-SUB)    19670021
196800      END-IF.                                                     19680021
196900                                                                  19690021
197000            DIVIDE ASC-DC-SHP-UNT (ASC-BLK-SUB ASC-ITEM-SUB) BY   19700021
197100                ASC-REQ-UNT (ASC-BLK-SUB ASC-ITEM-SUB)            19710021
197200                GIVING PV-PCT-SHPD ROUNDED.                       19720021
197300                                                                  19730021
197400           MULTIPLY PV-PCT-SHPD BY 100                            19740021
197500               GIVING ASC-PCT-SHPD (ASC-BLK-SUB ASC-ITEM-SUB).    19750021
197600                                                                  19760021
197700      COMPUTE PV-TOT-UNITS-SHPD = PV-TOT-UNITS-SHPD +             19770021
197800               ASC-DC-SHP-UNT (ASC-BLK-SUB ASC-ITEM-SUB).         19780021
197900                                                                  19790021
198000      COMPUTE PV-TOT-CTN-CNT = PV-TOT-CTN-CNT +                   19800021
198100             ASC-CARTON-CNT (ASC-BLK-SUB ASC-ITEM-SUB).           19810021
198200                                                                  19820021
198300      COMPUTE PV-TOT-REQ-UNITS = PV-TOT-REQ-UNITS +               19830021
198400             ASC-REQ-UNT (ASC-BLK-SUB ASC-ITEM-SUB).              19840021
198500                                                                  19850021
198600                                                                  19860021
198700*----------------------------------------------------------------*19870021
198800*    GET TRAILOR STATUS 'EN' FROM DB2 TABLES                     *19880021
198900*----------------------------------------------------------------*19890021
199000 4326-GET-EN-STATUS.                                              19900021
199100                                                                  19910021
199200         EXEC SQL                                                 19920021
199300            SELECT A.TRIP_STATUS_CDE                              19930021
199400              INTO :TRIPST-TRIP-STATUS-CDE :DN-TRIP-STATUS-CDE    19940021
199500              FROM TTRIPST            A                           19950021
199600                 , SUT_OTBND_UPC      B                           19960021
199700                 , SUT_TRLR_RPLN_CART C                           19970021
199800             WHERE B.SHIPT_UNT_ID  = C.SHIPT_UNT_ID               19980021
199900               AND A.TRIP_ID = C.INBND_TRIP_ID                    19990021
200000               AND B.TRN_NBR = :ASC-KEY-PULL-NBR                  20000021
200100               AND B.TRN_TYP_CDE   = 'CS'                         20010021
200200               AND A.TRIP_STATUS_CDE = 'EN'                       20020021
200300               AND A.OPER_UNT_ID = :DK-DC-NBR                     20030021
200400         END-EXEC.                                                20040021
200500                                                                  20050021
200600     EVALUATE TRUE                                                20060021
200700         WHEN SQLCODE = ZERO                                      20070021
200800         WHEN SQLCODE = -811                                      20080021
200900              IF DN-TRIP-STATUS-CDE = -1                          20090021
201000                 MOVE SPACES TO PV-TRLR-STATUS                    20100021
201100              ELSE                                                20110021
201200                 MOVE TRIPST-TRIP-STATUS-CDE TO PV-TRLR-STATUS    20120021
201300              END-IF                                              20130021
201400         WHEN SQLCODE = +100                                      20140021
201500                 MOVE SPACES TO PV-TRLR-STATUS                    20150021
201600         WHEN SQLCODE = -904                                      20160021
201700         WHEN SQLCODE = -911                                      20170021
201800         WHEN SQLCODE = -913                                      20180021
201900              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       20190021
202000              SET PS-ERROR                                        20200021
202100                  DP020-NEXT-ACT-APPL-ERROR                       20210021
202200                  DP020-MSG-FATAL                                 20220021
202300                      TO TRUE                                     20230021
202400              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 20240021
202500              PERFORM 9000-CALL-CICS-ARCH-API                     20250021
202600                                                                  20260021
202700         WHEN SQLWARN0 NOT = SPACES                               20270021
202800         WHEN SQLCODE < ZERO                                      20280021
202900         WHEN SQLCODE > ZERO                                      20290021
203000             MOVE '4326-GET-EN-STATUS'                            20300021
203100                                   TO DP013-PARAGRAPH             20310021
203200             MOVE 'GET-TRLR-STAT'                                 20320021
203300                                   TO DP013-MESSAGE-TEXT (1)      20330021
203400             MOVE SQLCA            TO DP013-SQLCA                 20340021
203500             MOVE 'TTRIPST'        TO  DP013-DB2-TABLE-NAME (1)   20350021
203600             MOVE 'SUT_OTBND_UPC'  TO  DP013-DB2-TABLE-NAME (2)   20360021
203700             MOVE 'SUT_TRLR_RPLN_CART' TO DP013-DB2-TABLE-NAME (3)20370021
203800             SET DP013-DB2-ABEND                                  20380021
203900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20390021
204000             PERFORM DP013-0000-PROCESS-ABEND                     20400021
204100     END-EVALUATE.                                                20410021
204200                                                                  20420021
204300/                                                                 20430021
204400*----------------------------------------------------------------*20440021
204500*    GET ARRIVAL DATE AND TIME FROM THE DB2 TABLES               *20450021
204600*----------------------------------------------------------------*20460021
204700 4330-GET-ARRIVAL-DATE-TIME.                                      20470021
204800                                                                  20480021
204900                                                                  20490021
205000         EXEC SQL                                                 20500021
205100            SELECT MIN(A.STATUS_DTE)                              20510021
205200                 , MIN(A.STATUS_TME)                              20520021
205300                 , A.OPER_UNT_ID                                  20530021
205400              INTO :PV-ARRIVAL-DATE :DN-ARRIVAL-DATE              20540021
205500                 , :PV-ARRIVAL-TIME :DN-ARRIVAL-TIME              20550021
205600                 , :PV-OPER-UNT-ID :DN-OPER-UNT-ID                20560021
205700              FROM TTRIPST            A                           20570021
205800                 , SUT_OTBND_UPC      B                           20580021
205900                 , SUT_TRLR_RPLN_CART C                           20590021
206000             WHERE B.SHIPT_UNT_ID  = C.SHIPT_UNT_ID               20600021
206100               AND A.TRIP_ID = C.INBND_TRIP_ID                    20610021
206200               AND A.OPER_UNT_ID = :DK-DC-NBR                     20620021
206300               AND B.TRN_NBR = :ASC-KEY-PULL-NBR                  20630021
206400               AND B.TRN_TYP_CDE   = 'CS'                         20640021
206500               AND A.TRIP_STATUS_CDE = 'AR'                       20650021
206600          GROUP BY A.OPER_UNT_ID                                  20660021
206700         END-EXEC.                                                20670021
206800                                                                  20680021
206900                                                                  20690021
207000     EVALUATE TRUE                                                20700021
207100         WHEN SQLCODE = ZERO                                      20710021
207200             MOVE 'AR' TO PV-TRLR-STATUS                          20720021
207300             IF DN-OPER-UNT-ID = -1                               20730021
207400                MOVE ZEROS TO PV-OPER-UNT-ID                      20740021
207500             END-IF                                               20750021
207600             IF DN-ARRIVAL-DATE = -1                              20760021
207700                MOVE ZEROS TO PV-ARRIVAL-DATE                     20770021
207800             END-IF                                               20780021
207900             IF DN-ARRIVAL-TIME = -1                              20790021
208000                MOVE ZEROS TO PV-ARRIVAL-TIME                     20800021
208100             END-IF                                               20810021
208200         WHEN SQLCODE = +100                                      20820021
208300              MOVE SPACES TO PV-TRLR-STATUS                       20830021
208400              MOVE ZEROS TO PV-OPER-UNT-ID                        20840021
208500              MOVE SPACES TO PV-ARRIVAL-DATE                      20850021
208600              MOVE SPACES TO PV-ARRIVAL-TIME                      20860021
208700         WHEN SQLCODE = -904                                      20870021
208800         WHEN SQLCODE = -911                                      20880021
208900         WHEN SQLCODE = -913                                      20890021
209000              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       20900021
209100              SET PS-ERROR                                        20910021
209200                  DP020-NEXT-ACT-APPL-ERROR                       20920021
209300                  DP020-MSG-FATAL                                 20930021
209400                      TO TRUE                                     20940021
209500              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 20950021
209600              PERFORM 9000-CALL-CICS-ARCH-API                     20960021
209700                                                                  20970021
209800         WHEN SQLWARN0 NOT = SPACES                               20980021
209900         WHEN SQLCODE < ZERO                                      20990021
210000         WHEN SQLCODE > ZERO                                      21000021
210100             MOVE '4330-GET-ARRIVAL-DATE-TIME'                    21010021
210200                               TO DP013-PARAGRAPH                 21020021
210300             MOVE 'GET ARRIVAL DATE AND TIME '                    21030021
210400                               TO DP013-MESSAGE-TEXT (1)          21040021
210500             MOVE SQLCA        TO DP013-SQLCA                     21050021
210600             MOVE 'TTRIPST'        TO  DP013-DB2-TABLE-NAME (1)   21060021
210700             MOVE 'SUT_OTBND_UPC'  TO  DP013-DB2-TABLE-NAME (2)   21070021
210800             MOVE 'SUT_TRLR_RPLN_CART' TO DP013-DB2-TABLE-NAME (3)21080021
210900             SET DP013-DB2-ABEND                                  21090021
211000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21100021
211100             PERFORM DP013-0000-PROCESS-ABEND                     21110021
211200     END-EVALUATE.                                                21120021
211300/                                                                 21130021
211400*----------------------------------------------------------------*21140021
211500*    GET SHIP TO STORE EARLIEST STATUS DATE                      *21150021
211600*----------------------------------------------------------------*21160021
211700 4340-GET-SHPTSTR-DATA.                                           21170021
211800                                                                  21180021
211900         EXEC SQL                                                 21190021
212000            SELECT  MIN(H.OTBND_STAT_TMST)                        21200021
212010              INTO :PV-OTBND-STAT-TMST :DN-OTBND-STAT-TMST        21201021
212100              FROM  TSUCRDV        A                              21210021
212200                  , TSUCDOT        B                              21220021
212300                  , TSUOBTS        H                              21230021
212400                  , TSUOBTR        K                              21240021
212500             WHERE A.SHIPT_UNT_ID  IN                             21250021
212600                    (SELECT DISTINCT(M.SHIPT_UNT_ID)              21260021
212700                       FROM SUT_OTBND_UPC M                       21270021
212800                      WHERE M.TRN_NBR     = :ASC-KEY-PULL-NBR     21280021
212900                        AND M.TRN_TYP_CDE = 'CS')                 21290021
213000               AND  A.ACTV_CDE            =  'A'                  21300021
213100               AND  A.DIVERT_TMST         =                       21310021
213200                    (SELECT MAX(E.DIVERT_TMST)                    21320021
213300                       FROM  TSUCRDV E                            21330021
213400                      WHERE  A.SHIPT_UNT_ID = E.SHIPT_UNT_ID      21340021
213500                        AND  E.ACTV_CDE     = 'A'                 21350021
213600                     )                                            21360021
213700               AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID           21370025
213800               AND  A.DIVERT_TMST     >=  B.STRT_DIVERT_TMST      21380025
213900               AND  A.DIVERT_TMST     <=  B.END_DIVERT_TMST       21390025
214000               AND  A.DOOR_ID          =  B.DOOR_ID               21400025
214100               AND  B.OTBND_TRIP_ID    =  H.OTBND_TRIP_ID         21410025
214200               AND  B.OPER_UNT_ID      =  H.STAT_OPER_UNT_ID      21420025
214300               AND  H.TRIP_STAT_CDE    =  'DS'                    21430025
214400               AND  H.OTBND_TRIP_ID    =  K.OTBND_TRIP_ID         21440025
214500               AND  K.ORGN_OPER_UNT_ID =  :DK-DC-NBR              21450025
214600              WITH UR                                             21460021
214800         END-EXEC.                                                21480021
214900                                                                  21490021
215000     EVALUATE TRUE                                                21500021
215100         WHEN SQLCODE = ZERO                                      21510021
215200              IF DN-OTBND-STAT-TMST = -1                          21520021
215300                 MOVE SPACES       TO   PV-OTBND-STAT-TMST        21530021
215400              ELSE                                                21540021
215500                 MOVE 'DS' TO PV-TRLR-STATUS                      21550021
215600              END-IF                                              21560021
215700         WHEN SQLCODE = +100                                      21570021
215800              MOVE SPACES  TO PV-OTBND-STAT-TMST                  21580021
215900         WHEN SQLCODE = -904                                      21590021
216000         WHEN SQLCODE = -911                                      21600021
216100         WHEN SQLCODE = -913                                      21610021
216200              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       21620021
216300              SET PS-ERROR                                        21630021
216400                  DP020-NEXT-ACT-APPL-ERROR                       21640021
216500                  DP020-MSG-FATAL                                 21650021
216600                      TO TRUE                                     21660021
216700              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 21670021
216800              PERFORM 9000-CALL-CICS-ARCH-API                     21680021
216900                                                                  21690021
217000         WHEN SQLWARN0 NOT = SPACES                               21700021
217100         WHEN SQLCODE < ZERO                                      21710021
217200         WHEN SQLCODE > ZERO                                      21720021
217300             MOVE '4340-GET-SHPTSTR-DATA'                         21730021
217400                               TO DP013-PARAGRAPH                 21740021
217500             MOVE 'GET SHIP TO STORE QTY AND CTN CNT'             21750021
217600                               TO DP013-MESSAGE-TEXT (1)          21760021
217700             MOVE SQLCA        TO DP013-SQLCA                     21770021
217800             MOVE 'TSUOBTS'        TO  DP013-DB2-TABLE-NAME (1)   21780021
217900             MOVE 'SUT_OTBND_UPC'  TO  DP013-DB2-TABLE-NAME (2)   21790021
218000             MOVE 'SUT_OTBND_CART' TO  DP013-DB2-TABLE-NAME (3)   21800021
218100             MOVE 'SUT_OTBND_LOC'  TO  DP013-DB2-TABLE-NAME (4)   21810021
218200             SET DP013-DB2-ABEND                                  21820021
218300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21830021
218400             PERFORM DP013-0000-PROCESS-ABEND                     21840021
218500     END-EVALUATE.                                                21850021
218600/                                                                 21860021
218700 4342-GET-SHPTSTR-CRTNS.                                          21870021
218800                                                                  21880021
218900         EXEC SQL                                                 21890021
219000           SELECT COUNT(T1.SSCC)                                  21900021
219100                , SUM(T1.UPC_QTY)                                 21910021
219110            INTO   :PV-CTN-CNT      :DN-CTN-CNT                   21911021
219120                ,  :PV-SHPD-UNT-QTY :DN-SHPD-UNT-QTY              21912021
219200            FROM (                                                21920021
219300                  (SELECT DISTINCT(D.SHIPT_UNT_ID) AS SSCC        21930021
219400                        , SUM(D.SHPD_UNT_QTY) AS UPC_QTY          21940021
219500                     FROM  SUT_OTBND_UPC  D                       21950021
219600                         , TSUCRDV        A                       21960021
219700                         , TSUCDOT        B                       21970021
219800                         , TSUOBTS        H                       21980021
219900                         , TSUOBTR        K                       21990021
220000                    WHERE (D.SHIPT_UNT_ID  IN                     22000021
220100                            (SELECT L.SHIPT_UNT_ID                22010021
220200                               FROM SUT_OTBND_UPC L               22020021
220300                              WHERE L.TRN_NBR = :ASC-KEY-PULL-NBR 22030021
220400                                AND L.TRN_TYP_CDE = 'CS')         22040024
220500                      AND  D.TRN_NBR       = :ASC-KEY-PULL-NBR    22050026
220600                      AND  D.TRN_TYP_CDE   = 'CS'                 22060026
220700                      AND  D.SHIPT_UNT_ID  =  A.SHIPT_UNT_ID      22070026
220800                      AND  A.ACTV_CDE      =  'A'                 22080026
220900                      AND  A.DIVERT_TMST   =                      22090026
221000                           (SELECT MAX(I.DIVERT_TMST)             22100021
221100                              FROM  TSUCRDV I                     22110021
221200                             WHERE  A.SHIPT_UNT_ID =              22120021
221210                                        I.SHIPT_UNT_ID            22121021
221300                               AND  I.ACTV_CDE     = 'A')         22130021
221400                      AND  A.OPER_UNT_ID   =  B.OPER_UNT_ID       22140025
221500                      AND  A.DIVERT_TMST  >=  B.STRT_DIVERT_TMST  22150025
221600                      AND  A.DIVERT_TMST  <=  B.END_DIVERT_TMST   22160025
221700                      AND  A.DOOR_ID       =  B.DOOR_ID           22170025
221800                      AND  B.OTBND_TRIP_ID =  H.OTBND_TRIP_ID     22180025
221900                      AND  B.OPER_UNT_ID   =  H.STAT_OPER_UNT_ID  22190025
222000                      AND  H.TRIP_STAT_CDE =  'DS'                22200025
222100                      AND  H.OTBND_TRIP_ID =  K.OTBND_TRIP_ID     22210025
222200                      AND  K.ORGN_OPER_UNT_ID  = :DK-DC-NBR       22220021
222300                          )                                       22230021
222400                    GROUP BY D.SHIPT_UNT_ID                       22240021
222500                  )                                               22250021
222600                                                                  22260021
222700            UNION                                                 22270021
222800                  (                                               22280021
222900                   SELECT DISTINCT(E.SHIPT_UNT_ID) AS SSCC        22290021
223000                          , SUM(G.SHPD_UNT_QTY) AS UPC_QTY        22300021
223100                     FROM  SUT_OTBND_LOC  E                       22310021
223200                        ,  SUT_OTBND_UPC  G                       22320021
223300                        ,  TSUOBTR        M                       22330021
223400                    WHERE (E.SCN_CDE          = 'SHON'            22340021
223410                      AND  E.ACTV_CDE         = 'A'               22341021
223420                      AND  E.OTBND_TRIP_ID    =  M.OTBND_TRIP_ID  22342021
223430                      AND  M.ORGN_OPER_UNT_ID = :DK-DC-NBR        22343021
223431                      AND  E.SHIPT_UNT_ID  IN                     22343121
223432                           (SELECT N.SHIPT_UNT_ID                 22343221
223433                              FROM SUT_OTBND_UPC N                22343321
223434                             WHERE N.TRN_NBR = :ASC-KEY-PULL-NBR  22343421
223435                               AND N.TRN_TYP_CDE  = 'CS')         22343521
223436                      AND  E.SHIPT_UNT_ID  =  G.SHIPT_UNT_ID      22343621
223437                      AND  G.TRN_NBR       = :ASC-KEY-PULL-NBR    22343721
223438                      AND  G.TRN_TYP_CDE   = 'CS'                 22343821
223439                          )                                       22343921
223440                    GROUP BY E.SHIPT_UNT_ID                       22344021
223441                   )                                              22344121
223442                  )  AS T1                                        22344221
223443          WITH UR                                                 22344321
223444         END-EXEC.                                                22344421
223445                                                                  22344521
223446     EVALUATE TRUE                                                22344621
223447         WHEN SQLCODE = ZERO                                      22344721
223448              IF DN-CTN-CNT = -1                                  22344821
223449                 MOVE ZEROS TO PV-CTN-CNT                         22344921
223450              END-IF                                              22345021
223451              IF DN-SHPD-UNT-QTY  = -1                            22345123
223452                 MOVE ZEROS TO PV-SHPD-UNT-QTY                    22345221
223453              END-IF                                              22345321
223454         WHEN SQLCODE = +100                                      22345421
223455              MOVE ZEROS   TO PV-SHPD-UNT-QTY                     22345521
223456              MOVE ZEROS   TO PV-CTN-CNT                          22345621
223457         WHEN SQLCODE = -904                                      22345721
223458         WHEN SQLCODE = -911                                      22345821
223459         WHEN SQLCODE = -913                                      22345921
223460              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       22346021
223461              SET PS-ERROR                                        22346121
223462                  DP020-NEXT-ACT-APPL-ERROR                       22346221
223463                  DP020-MSG-FATAL                                 22346321
223464                      TO TRUE                                     22346421
223465              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 22346521
223466              PERFORM 9000-CALL-CICS-ARCH-API                     22346621
223467                                                                  22346721
223468         WHEN SQLWARN0 NOT = SPACES                               22346821
223469         WHEN SQLCODE < ZERO                                      22346921
223470         WHEN SQLCODE > ZERO                                      22347021
223471             MOVE '4342-GET-SHPTSTR-CRTNS'                        22347121
223472                               TO DP013-PARAGRAPH                 22347221
223473             MOVE 'GET SHIP TO STORE QTY AND CTN CNT'             22347321
223474                               TO DP013-MESSAGE-TEXT (1)          22347421
223475             MOVE SQLCA        TO DP013-SQLCA                     22347521
223476             MOVE 'TSUOBTS'        TO  DP013-DB2-TABLE-NAME (1)   22347621
223477             MOVE 'SUT_OTBND_UPC'  TO  DP013-DB2-TABLE-NAME (2)   22347721
223478             MOVE 'SUT_OTBND_CART' TO  DP013-DB2-TABLE-NAME (3)   22347821
223479             MOVE 'SUT_OTBND_LOC'  TO  DP013-DB2-TABLE-NAME (4)   22347921
223480             SET DP013-DB2-ABEND                                  22348021
223481                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22348121
223482             PERFORM DP013-0000-PROCESS-ABEND                     22348221
223483     END-EVALUATE.                                                22348321
223484/                                                                 22348421
223485*----------------------------------------------------------------*22348521
223486*    GET REQ UNITS FROM DB2 TABLES                               *22348621
223487*----------------------------------------------------------------*22348721
223488 4350-GET-REQ-UNITS.                                              22348821
223489                                                                  22348921
223490         EXEC SQL                                                 22349021
223491            SELECT SUM(C.REQ_ORD_QTY)                             22349121
223492                 INTO :PV-REQ-ORD-QTY :DN-REQ-ORD-QTY             22349221
223493                 FROM XLT_LOC           A                         22349321
223494                    , XLT_DC_LOC_ASGMT  B                         22349421
223495                    , TCEPLDS           C                         22349521
223496             WHERE    C.STR_NBR = B.LOC_NBR                       22349621
223497               AND    A.LOC_NBR = B.LOC_NBR                       22349721
223500               AND    A.LOC_TYP_CDE = ('DS')                      22350021
223600               AND    C.CNSTK_REQ_PL_NBR = :ASC-KEY-PULL-NBR      22360021
223700               AND    B.DC_NBR = :PV-DC-NBR-ORG                   22370021
223800               AND    B.EFF_BEG_DTE =                             22380021
223900                      (SELECT   MAX(D.EFF_BEG_DTE)                22390021
224000                         FROM   XLT_DC_LOC_ASGMT D                22400021
224100                       WHERE    D.LOC_NBR = A.LOC_NBR             22410021
224200                         AND    D.EFF_BEG_DTE <= CURRENT DATE)    22420021
224300              GROUP BY B.DC_NBR                                   22430021
224400         END-EXEC.                                                22440021
224500                                                                  22450021
224600     EVALUATE TRUE                                                22460021
224700         WHEN SQLCODE = ZERO                                      22470021
224800              IF DN-REQ-ORD-QTY = -1                              22480021
224900                 MOVE ZEROS TO PV-REQ-ORD-QTY                     22490021
225000              ELSE                                                22500021
225100                 CONTINUE                                         22510021
225200              END-IF                                              22520021
225300         WHEN SQLCODE = +100                                      22530021
225400              MOVE ZEROS   TO PV-REQ-ORD-QTY                      22540021
225500         WHEN SQLCODE = -904                                      22550021
225600         WHEN SQLCODE = -911                                      22560021
225700         WHEN SQLCODE = -913                                      22570021
225800              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       22580021
225900              SET PS-ERROR                                        22590021
226000                  DP020-NEXT-ACT-APPL-ERROR                       22600021
226100                  DP020-MSG-FATAL                                 22610021
226200                      TO TRUE                                     22620021
226300              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 22630021
226400              PERFORM 9000-CALL-CICS-ARCH-API                     22640021
226500                                                                  22650021
226600         WHEN SQLWARN0 NOT = SPACES                               22660021
226700         WHEN SQLCODE < ZERO                                      22670021
226800         WHEN SQLCODE > ZERO                                      22680021
226900             MOVE '4350-GET-REQ-UNITS'                            22690021
227000                               TO DP013-PARAGRAPH                 22700021
227100             MOVE 'GET REQUESTED QTY '                            22710021
227200                               TO DP013-MESSAGE-TEXT (1)          22720021
227300             MOVE SQLCA        TO DP013-SQLCA                     22730021
227400             MOVE 'XLT_LOC'          TO  DP013-DB2-TABLE-NAME (1) 22740021
227500             MOVE 'XLT_DC_LOC_ASGMT' TO  DP013-DB2-TABLE-NAME (2) 22750021
227600             MOVE 'TCEPLDS'          TO  DP013-DB2-TABLE-NAME (3) 22760021
227700             SET DP013-DB2-ABEND                                  22770021
227800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22780021
227900             PERFORM DP013-0000-PROCESS-ABEND                     22790021
228000     END-EVALUATE.                                                22800021
228100/                                                                 22810021
228200*----------------------------------------------------------------*22820021
228300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22830021
228400*----------------------------------------------------------------*22840021
228500 4400-MOVE-COMMAREA-TO-SCREEN.                                    22850021
228600                                                                  22860021
228700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22870021
228800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22880021
228900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22890021
229000             MOVE +1               TO ASC-BLK-SUB                 22900021
229100             PERFORM 5100-WRITE-TEMP-STORAGE                      22910021
229200             ADD +1                TO ASC-BLK-SUB                 22920021
229300             PERFORM 5100-WRITE-TEMP-STORAGE                      22930021
229400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22940021
229500                 GIVING PV-BLOCK-NUMBER                           22950021
229600                 REMAINDER PV-REMAINDER                           22960021
229700             IF  PV-REMAINDER > ZERO                              22970021
229800                 ADD +1            TO PV-BLOCK-NUMBER             22980021
229900             END-IF                                               22990021
230000             MOVE +1               TO ASC-BLK-SUB                 23000021
230100             PERFORM 4410-READ-TEMP-STORAGE                       23010021
230200             ADD +1                TO ASC-BLK-SUB                 23020021
230300                                      PV-BLOCK-NUMBER             23030021
230400             PERFORM 4410-READ-TEMP-STORAGE                       23040021
230500     END-IF.                                                      23050021
230600                                                                  23060021
230700     MOVE +1                       TO ASC-BLK-SUB.                23070021
230800                                                                  23080021
230900     COMPUTE ASC-ITEM-SUB =                                       23090021
231000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23100021
231100         + PC-ITEMS-PER-PANEL).                                   23110021
231200                                                                  23120021
231300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23130021
231400         ADD +1                    TO ASC-BLK-SUB                 23140021
231500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23150021
231600     END-IF.                                                      23160021
231700                                                                  23170021
231800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           23180021
231900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23190021
232000                                                                  23200021
232100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23210021
232200     PERFORM 4420-FORMAT-LIST-LINES                               23220021
232300         VARYING PV-SUB                                           23230021
232400         FROM PC-ITEMS-PER-PANEL BY -1                            23240021
232500         UNTIL PV-SUB < +1.                                       23250021
232600                                                                  23260021
232700     COMPUTE ASC-ITEMS-DISPLAYED =                                23270021
232800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23280021
232900                                                                  23290021
233000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23300021
233100                                      ASTRTITO.                   23310021
233200                                                                  23320021
233300     MOVE ASC-KEY-PULL-NBR     TO MR-PULL-NBR.                    23330021
233400     MOVE ASC-TOT-PULL-UNIT    TO MR-PULL-UNIT.                   23340021
233500     MOVE ASC-PULL-CRT-DTE     TO MR-PULL-CRT-DTE.                23350021
233600     MOVE ASC-TOT-SHP-UNT      TO MR-TOT-SHP-UNT.                 23360021
233700     MOVE ASC-TOT-CTN-CNT      TO MR-TOT-CTN-CNT.                 23370021
233800     MOVE ASC-TOT-REQ-UNITS    TO MR-TOT-REQ-UNT.                 23380021
233900     MOVE ASC-TOT-UNITS-TO-STR TO MR-UNIT-SHPD.                   23390021
234000     MOVE ASC-PULL-CMP-DTE     TO MR-PULL-CMP-DTE.                23400021
234100     MOVE ASC-PCT-UNITS-TO-STR TO MR-PCT-CTN-UNT.                 23410021
234200                                                                  23420021
234300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    23430021
234400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    23440021
234500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23450021
234600                                   TO ASELITO.                    23460021
234700                                                                  23470021
234800     IF  DP020-MSG-NUMBER-X = SPACE                               23480021
234900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  23490021
235000*            --- MORE ITEMS TO DISPLAY ----                       23500021
235100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23510021
235200             SET DP020-MSG-INFORMATIONAL                          23520021
235300                                   TO TRUE                        23530021
235400         END-IF                                                   23540021
235500     END-IF.                                                      23550021
235600/                                                                 23560021
235700*----------------------------------------------------------------*23570021
235800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23580021
235900*----------------------------------------------------------------*23590021
236000 4410-READ-TEMP-STORAGE.                                          23600021
236100                                                                  23610021
236200     EXEC CICS                                                    23620021
236300         READQ TS                                                 23630021
236400             QUEUE (ASC-LIST-QUEUE-NAME)                          23640021
236500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23650021
236600             ITEM  (PV-BLOCK-NUMBER)                              23660021
236700             RESP  (PV-CICS-RESP)                                 23670021
236800     END-EXEC.                                                    23680021
236900                                                                  23690021
237000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23700021
237100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23710021
237200         CONTINUE                                                 23720021
237300     ELSE                                                         23730021
237400         SET DP013-CICS-ABEND      TO TRUE                        23740021
237500         SET DP013-NO-ROLLBACK     TO TRUE                        23750021
237600         MOVE '4410-READ-TEMP-STORAGE'                            23760021
237700                                   TO DP013-PARAGRAPH             23770021
237800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23780021
237900                                   TO DP013-MESSAGE-TEXT(1)       23790021
238000         PERFORM DP013-0000-PROCESS-ABEND                         23800021
238100     END-IF.                                                      23810021
238200                                                                  23820021
238300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      23830021
238400                                   TO TRUE.                       23840021
238500                                                                  23850021
238600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23860021
238700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23870021
238800     END-IF.                                                      23880021
238900/                                                                 23890021
239000*----------------------------------------------------------------*23900021
239100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23910021
239200*----------------------------------------------------------------*23920021
239300 4420-FORMAT-LIST-LINES.                                          23930021
239400                                                                  23940021
239500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23950021
239600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23960021
239700         MOVE DP015-HL-OFF         TO MR-SELECTH (PV-SUB)         23970021
239800         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         23980021
239900         INITIALIZE                 MR-PULL-NBR                   23990021
240000                                    MR-PULL-UNIT                  24000021
240100                                    MR-PULL-CRT-DTE               24010021
240200                                    MR-SELECT (PV-SUB)            24020021
240300                                    MR-ACTION (PV-SUB)            24030021
240400                                    MR-DC-STAT-CD (PV-SUB)        24040021
240500                                    MR-ARRIVAL-DTE (PV-SUB)       24050021
240600                                    MR-ARRIVAL-TIME (PV-SUB)      24060021
240700                                    MR-SHPTSTR-DTE (PV-SUB)       24070021
240800                                    MR-SHPTSTR-TIME (PV-SUB)      24080021
240900                                    MR-DC-LOC (PV-SUB)            24090021
241000                                    MR-DC-SHP-UNT (PV-SUB)        24100021
241100                                    MR-CARTON-CNT (PV-SUB)        24110021
241200                                    MR-REQ-UNT (PV-SUB)           24120021
241300                                    MR-PCT-SHPD (PV-SUB)          24130021
241400     ELSE                                                         24140021
241500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24150021
241600                                                   > SPACE        24160021
241700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24170021
241800                                   TO MR-SELECT (PV-SUB)          24180021
241900         ELSE                                                     24190021
242000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24200021
242100                                   TO MR-SELECT (PV-SUB)          24210021
242200         END-IF                                                   24220021
242300                                                                  24230021
242400         IF  DP030-SET-CURSOR-TRAILER                             24240021
242500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24250021
242600                 > SPACE)                                         24260021
242700               OR (PV-SUB = 1))                                   24270021
242800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24280021
242900                MOVE -1            TO MR-SELECTL (PV-SUB)         24290021
243000             END-IF                                               24300021
243100         END-IF                                                   24310021
243200                                                                  24320021
243300         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               24330021
243400                                 TO MR-ACTION (PV-SUB)            24340021
243500             MOVE ASC-DC-LOC (ASC-BLK-SUB ASC-ITEM-SUB)           24350021
243600                                   TO MR-DC-LOC (PV-SUB)          24360021
243700             MOVE ASC-DC-STAT-CD (ASC-BLK-SUB ASC-ITEM-SUB)       24370021
243800                                 TO MR-DC-STAT-CD (PV-SUB)        24380021
243900             MOVE ASC-ARRIVAL-DTE (ASC-BLK-SUB ASC-ITEM-SUB)      24390021
244000                                   TO MR-ARRIVAL-DTE (PV-SUB)     24400021
244100             MOVE ASC-ARRIVAL-TIME (ASC-BLK-SUB ASC-ITEM-SUB)     24410021
244200                                   TO MR-ARRIVAL-TIME (PV-SUB)    24420021
244300             MOVE ASC-SHPTSTR-DTE (ASC-BLK-SUB ASC-ITEM-SUB)      24430021
244400                                   TO MR-SHPTSTR-DTE (PV-SUB)     24440021
244500             MOVE ASC-SHPTSTR-TIME (ASC-BLK-SUB ASC-ITEM-SUB)     24450021
244600                                   TO MR-SHPTSTR-TIME (PV-SUB)    24460021
244700             MOVE ASC-CARTON-CNT (ASC-BLK-SUB ASC-ITEM-SUB)       24470021
244800                                 TO MR-CARTON-CNT (PV-SUB)        24480021
244900             MOVE ASC-DC-SHP-UNT (ASC-BLK-SUB ASC-ITEM-SUB)       24490021
245000                                 TO MR-DC-SHP-UNT (PV-SUB)        24500021
245100             MOVE ASC-REQ-UNT (ASC-BLK-SUB ASC-ITEM-SUB)          24510021
245200                                 TO MR-REQ-UNT (PV-SUB)           24520021
245300             MOVE ASC-PCT-SHPD (ASC-BLK-SUB ASC-ITEM-SUB)         24530021
245400                                 TO MR-PCT-SHPD (PV-SUB)          24540021
245500     END-IF.                                                      24550021
245600                                                                  24560021
245700                                                                  24570021
245800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               24580021
245900                                                                  24590021
246000     IF  ASC-ITEM-SUB < + 1                                       24600021
246100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                24610021
246200         MOVE +1                   TO ASC-BLK-SUB                 24620021
246300     END-IF.                                                      24630021
246400/                                                                 24640021
246500*----------------------------------------------------------------*24650021
246600*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *24660021
246700*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *24670021
246800*  ISSUE A WARNING.                                              *24680021
246900*----------------------------------------------------------------*24690021
247000 4430-CHECK-FOR-BEGIN-AND-END.                                    24700021
247100                                                                  24710021
247200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24720021
247300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24730021
247400*            -- NO END-OF-RANGE SPECFIED ---                      24740021
247500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24750021
247600             SET DP020-MSG-WARNING TO TRUE                        24760021
247700             PERFORM 4431-POSITION-AT-WARNING                     24770021
247800         END-IF                                                   24780021
247900     ELSE                                                         24790021
248000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24800021
248100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24810021
248200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24820021
248300             SET DP020-MSG-WARNING TO TRUE                        24830021
248400             PERFORM 4431-POSITION-AT-WARNING                     24840021
248500         END-IF                                                   24850021
248600     END-IF.                                                      24860021
248700/                                                                 24870021
248800*----------------------------------------------------------------*24880021
248900*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *24890021
249000*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *24900021
249100*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *24910021
249200*  POSITION THE CURSOR THERE.                                    *24920021
249300*----------------------------------------------------------------*24930021
249400 4431-POSITION-AT-WARNING.                                        24940021
249500                                                                  24950021
249600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24960021
249700                    - PV-TOP-ITEM + 1.                            24970021
249800                                                                  24980021
249900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24990021
250000         CONTINUE                                                 25000021
250100     ELSE                                                         25010021
250200         SET DP030-SET-CURSOR-APPL-1                              25020021
250300                                   TO TRUE                        25030021
250400         MOVE -1                   TO MR-SELECTL (PV-SUB)         25040021
250500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25050021
250600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25060021
250700     END-IF.                                                      25070021
250800                                                                  25080021
250900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25090021
251000                    - PV-TOP-ITEM + 1.                            25100021
251100                                                                  25110021
251200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25120021
251300         CONTINUE                                                 25130021
251400     ELSE                                                         25140021
251500         SET DP030-SET-CURSOR-APPL-1                              25150021
251600                                   TO TRUE                        25160021
251700         MOVE -1                   TO MR-SELECTL (PV-SUB)         25170021
251800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25180021
251900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25190021
252000     END-IF.                                                      25200021
252100                                                                  25210021
252200/                                                                 25220021
252300                                                                  25230021
252400 4700-GET-ECOMM-DC.                                               25240021
252500* IF THE STORE IS AN EBUS LOCATION, USE THE ECOMMERCE             25250021
252600* SERVICING DC NUMBER                                             25260021
252700                                                                  25270021
252800     INITIALIZE DCLTKRPRPM.                                       25280021
252900     MOVE PV-DC-NBR TO KRPRPM-LOC-ID.                             25290021
253000                                                                  25300021
253100     EXEC SQL                                                     25310021
253200       SELECT  FUNC_TXT                                           25320021
253210         INTO  :KRPRPM-FUNC-TXT :DN-KRPRPM-FUNC-TXT               25321021
253211         FROM  TKRPRPM                                            25321121
253212        WHERE  LOC_ID = :KRPRPM-LOC-ID                            25321221
253213          AND  INTFC_SYS_CDE = 'KHL'                              25321321
253214          AND  FUNC_PRC_STAT_CDE = 'AC'                           25321421
253215          AND  SYS_PRC_FUNC_CDE = 'ECDCSU'                        25321521
253216          AND  CURRENT DATE >= DATE(FUNC_BEG_TMST)                25321621
253217     END-EXEC                                                     25321721
253218                                                                  25321821
253219     EVALUATE TRUE                                                25321921
253220         WHEN SQLCODE = ZERO                                      25322021
253221              IF DN-KRPRPM-FUNC-TXT = -1                          25322121
253222                 MOVE SPACES TO PV-DIVERT-DC-X3                   25322221
253223              ELSE                                                25322321
253224                 MOVE KRPRPM-FUNC-TXT TO PV-DIVERT-DC-X3          25322421
253225              END-IF                                              25322521
253226              MOVE PV-DIVERT-DC    TO PV-DC-NBR                   25322621
253227                                      XLT00014-DC-NBR             25322721
253228         WHEN SQLCODE = +100                                      25322821
253229              CONTINUE                                            25322921
253230         WHEN SQLCODE = -904                                      25323021
253231         WHEN SQLCODE = -911                                      25323121
253232         WHEN SQLCODE = -913                                      25323221
253233              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       25323321
253234              SET PS-ERROR                                        25323421
253235                  DP020-NEXT-ACT-APPL-ERROR                       25323521
253236                  DP020-MSG-FATAL                                 25323621
253237                      TO TRUE                                     25323721
253238              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 25323821
253239              PERFORM 9000-CALL-CICS-ARCH-API                     25323921
253240                                                                  25324021
253241         WHEN SQLWARN0 NOT = SPACES                               25324121
253242         WHEN SQLCODE < ZERO                                      25324221
253243         WHEN SQLCODE > ZERO                                      25324321
253244             MOVE '4700-GET-ECOMM-DC  '                           25324421
253245                               TO DP013-PARAGRAPH                 25324521
253246             MOVE 'GET PULL COMPLETE DATE '                       25324621
253247                               TO DP013-MESSAGE-TEXT (1)          25324721
253248             MOVE SQLCA        TO DP013-SQLCA                     25324821
253249             MOVE 'TKRPRPM '   TO DP013-DB2-TABLE-NAME (1)        25324921
253250             SET DP013-DB2-ABEND                                  25325021
253251                 DP013-XCTL-DISPLAY-RESTART TO TRUE               25325121
253252             PERFORM DP013-0000-PROCESS-ABEND                     25325221
253253     END-EVALUATE.                                                25325321
253254                                                                  25325421
253255 4800-INCR-ASC-COMM-AREA.                                         25325521
253256                                                                  25325621
253257     IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                         25325721
253258         ADD +1                  TO ASC-ITEM-SUB                  25325821
253259     ELSE                                                         25325921
253260         ADD +1                  TO ASC-BLK-SUB                   25326021
253270         MOVE +1                 TO ASC-ITEM-SUB                  25327021
253280                                                                  25328021
253290         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 25329021
253300             MOVE +1             TO ASC-BLK-SUB                   25330021
253400             SET ASC-BLOCK-MODIFIED (1)                           25340021
253500                                 TO TRUE                          25350021
253600             PERFORM 5100-WRITE-TEMP-STORAGE                      25360021
253700             MOVE ASC-BLOCK-ENTRIES                               25370021
253800                         (PC-MAX-BLOCKS-IN-ARRAY)                 25380021
253900                          TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)       25390021
254000             ADD +1              TO ASC-BLK-SUB                   25400021
254100             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           25410021
254200             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              25420021
254300                                 TO TRUE                          25430021
254400           END-IF                                                 25440021
254500       END-IF                                                     25450021
254600       ADD +1                      TO ASC-NUMBER-OF-ITEMS-READ    25460021
254700       MOVE ASC-NUMBER-OF-ITEMS-READ                              25470021
254800                             TO ASC-LIST-ITEM-NUMBER              25480021
254900                                (ASC-BLK-SUB ASC-ITEM-SUB).       25490021
255000                                                                  25500021
255100*----------------------------------------------------------------*25510021
255200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *25520021
255300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *25530021
255400* FOR THE SELECTED ITEMS QUEUE.                                  *25540021
255500*                                                                *25550021
255600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *25560021
255700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *25570021
255800* THE ARRAY IS FULL.                                             *25580021
255900*----------------------------------------------------------------*25590021
256000 5000-PREPARE-SEL-QUEUE.                                          25600021
256100                                                                  25610021
256200     DISPLAY '5000-PREPARE-SEL-QUEUE'                             25620021
256300                                                                  25630021
256400     MOVE +1                       TO ASC-BLK-SUB.                25640021
256500     PERFORM 5100-WRITE-TEMP-STORAGE.                             25650021
256600     ADD +1                        TO ASC-BLK-SUB.                25660021
256700     PERFORM 5100-WRITE-TEMP-STORAGE.                             25670021
256800                                                                  25680021
256900     MOVE ASC-SEL-QUEUE-NAME       TO SU009-SEL-QUEUE-NAME.       25690021
257000     PERFORM 6010-DELETE-SEL-QUEUE.                               25700021
257100                                                                  25710021
257200     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      25720021
257300         SET ASC-UPDATE-TSQ        TO TRUE                        25730021
257400     END-IF.                                                      25740021
257500                                                                  25750021
257600     SET SU010-IDX                 TO 1.                          25760021
257700     MOVE ZERO                     TO SU009-NUMBER-OF-TS-ITEMS.   25770021
257800     INITIALIZE SU010-SELECTED-ITEM-ARRAY.                        25780021
257900                                                                  25790021
258000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25800021
258100             VARYING PV-ITEM                                      25810021
258200             FROM 1 BY 1                                          25820021
258300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25830021
258400                                                                  25840021
258500     IF  SU010-IDX > 1                                            25850021
258600         PERFORM 5205-WRITE-SEL-QUEUE                             25860021
258700         ADD +1                    TO SU009-NUMBER-OF-TS-ITEMS    25870021
258800     END-IF.                                                      25880021
258900                                                                  25890021
259000/                                                                 25900021
259100*----------------------------------------------------------------*25910021
259200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25920021
259300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25930021
259400*----------------------------------------------------------------*25940021
259500 5100-WRITE-TEMP-STORAGE.                                         25950021
259600                                                                  25960021
259700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25970021
259800                                   TO PV-LIST-ITEM-NUMBER.        25980021
259900     COMPUTE PV-BLOCK-NUMBER =                                    25990021
260000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    26000021
260100                                                                  26010021
260200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             26020021
260300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             26030021
260400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      26040021
260500             PERFORM 5105-REWRITE-ASC-LISTQ                       26050021
260600         END-IF                                                   26060021
260700     ELSE                                                         26070021
260800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       26080021
260900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            26090021
261000         PERFORM 5110-WRITE-ASC-LISTQ                             26100021
261100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   26110021
261200     END-IF.                                                      26120021
261300                                                                  26130021
261400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      26140021
261500                                   TO TRUE.                       26150021
261600/                                                                 26160021
261700*----------------------------------------------------------------*26170021
261800*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *26180021
261900*  SPECIFIC COMMAREA.                                            *26190021
262000*----------------------------------------------------------------*26200021
262100 5105-REWRITE-ASC-LISTQ.                                          26210021
262200                                                                  26220021
262300     EXEC CICS                                                    26230021
262400         WRITEQ TS                                                26240021
262500             QUEUE (ASC-LIST-QUEUE-NAME)                          26250021
262600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26260021
262700             ITEM  (PV-BLOCK-NUMBER)                              26270021
262800             REWRITE                                              26280021
262900             RESP  (PV-CICS-RESP)                                 26290021
263000     END-EXEC.                                                    26300021
263100                                                                  26310021
263200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26320021
263300         CONTINUE                                                 26330021
263400     ELSE                                                         26340021
263500         SET DP013-CICS-ABEND      TO TRUE                        26350021
263600         SET DP013-NO-ROLLBACK     TO TRUE                        26360021
263700         MOVE '5105-REWRITE-ASC-LISTQ'                            26370021
263800                                   TO DP013-PARAGRAPH             26380021
263900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26390021
264000                                   TO DP013-MESSAGE-TEXT(1)       26400021
264100         PERFORM DP013-0000-PROCESS-ABEND                         26410021
264200     END-IF.                                                      26420021
264300/                                                                 26430021
264400*----------------------------------------------------------------*26440021
264500*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *26450021
264600*  SPECIFIC COMMAREA.                                            *26460021
264700*----------------------------------------------------------------*26470021
264800 5110-WRITE-ASC-LISTQ.                                            26480021
264900                                                                  26490021
265000     EXEC CICS                                                    26500021
265100         WRITEQ TS                                                26510021
265200             QUEUE (ASC-LIST-QUEUE-NAME)                          26520021
265300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26530021
265400             ITEM  (PV-BLOCK-NUMBER)                              26540021
265500             RESP  (PV-CICS-RESP)                                 26550021
265600     END-EXEC.                                                    26560021
265700                                                                  26570021
265800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26580021
265900         SET DP013-CICS-ABEND      TO TRUE                        26590021
266000         SET DP013-NO-ROLLBACK     TO TRUE                        26600021
266100         MOVE '5110-WRITE-ASC-LISTQ'                              26610021
266200                                   TO DP013-PARAGRAPH             26620021
266300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26630021
266400                                   TO DP013-MESSAGE-TEXT(1)       26640021
266500         PERFORM DP013-0000-PROCESS-ABEND                         26650021
266600     END-IF.                                                      26660021
266700/                                                                 26670021
266800*----------------------------------------------------------------*26680021
266900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *26690021
267000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *26700021
267100*----------------------------------------------------------------*26710021
267200 5200-FILL-SEL-QUEUE-RECORD.                                      26720021
267300                                                                  26730021
267400     PERFORM 6112-READ-LIST-QUEUE.                                26740021
267500                                                                  26750021
267600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26760021
267700         PERFORM                                                  26770021
267800         VARYING LQW-IDX                                          26780021
267900         FROM 1 BY 1                                              26790021
268000         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26800021
268100           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26810021
268200                                                                  26820021
268300             IF  LQW-SELECT (LQW-IDX)                             26830021
268400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26840021
268500                                   TO SU010-ITEM (SU010-IDX)      26850021
268600                 MOVE LQW-DC-LOC (LQW-IDX)                        26860021
268700                                   TO SU010-OPER-UNIT-ID          26870021
268800                                        (SU010-IDX)               26880021
268900                 MOVE LQW-REQ-UNT (LQW-IDX)                       26890021
269000                                   TO SU010-UNTS-VRFD             26900021
269100                                        (SU010-IDX)               26910021
269200                 MOVE ASC-KEY-PULL-NBR                            26920021
269300                                   TO SU010-PO-RCVR(SU010-IDX)    26930021
269400                                                                  26940021
269500                                                                  26950021
269600                 MOVE SPACE        TO SU010-ACTION-SW (SU010-IDX) 26960021
269700                 SET SU010-IDX UP BY 1                            26970021
269800                 IF  SU010-IDX > SU010-MAX-ITEMS                  26980021
269900                     PERFORM 5205-WRITE-SEL-QUEUE                 26990021
270000                     ADD +1        TO SU009-NUMBER-OF-TS-ITEMS    27000021
270100                     INITIALIZE SU010-SELECTED-ITEM-ARRAY         27010021
270200                     SET SU010-IDX TO 1                           27020021
270300                 END-IF                                           27030021
270400             END-IF                                               27040021
270500         END-PERFORM                                              27050021
270600     END-IF.                                                      27060021
270700/                                                                 27070021
270800*----------------------------------------------------------------*27080021
270900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *27090021
271000*----------------------------------------------------------------*27100021
271100 5205-WRITE-SEL-QUEUE.                                            27110021
271200                                                                  27120021
271300     DISPLAY '5205-WRITE-SEL-QUEUE'                               27130021
271400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27140021
271500                                   TO SU010-SELECTED-ITEMS.       27150021
271600                                                                  27160021
271700     EXEC CICS                                                    27170021
271800          WRITEQ TS                                               27180021
271900              QUEUE (ASC-SEL-QUEUE-NAME)                          27190021
272000              FROM  (SU010-SELECT-RECORD)                         27200021
272100              ITEM  (PV-SEL-QUEUE-ITEM)                           27210021
272200              RESP  (PV-CICS-RESP)                                27220021
272300     END-EXEC.                                                    27230021
272400                                                                  27240021
272500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27250021
272600         CONTINUE                                                 27260021
272700     ELSE                                                         27270021
272800         SET DP013-CICS-ABEND      TO TRUE                        27280021
272900         SET DP013-NO-ROLLBACK     TO TRUE                        27290021
273000         MOVE '5205-WRITE-SEL-QUEUE'                              27300021
273100                                   TO DP013-PARAGRAPH             27310021
273200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          27320021
273300                                   TO DP013-MESSAGE-TEXT(1)       27330021
273400         PERFORM DP013-0000-PROCESS-ABEND                         27340021
273500     END-IF.                                                      27350021
273600/                                                                 27360021
273700*----------------------------------------------------------------*27370021
273800*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *27380021
273900*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *27390021
274000*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *27400021
274100*  THE USER.                                                     *27410021
274200*----------------------------------------------------------------*27420021
274300 6000-REFRESH-PANEL-FROM-TEMP.                                    27430021
274400                                                                  27440021
274500     IF  ASC-UPDATE-TSQ                                           27450021
274600         SET ASC-NO-TSQ-UPDATE     TO TRUE                        27460021
274700         MOVE ZERO                 TO PV-SAVE-ITEM                27470021
274800                                      PV-SEL-QUEUE-ITEM           27480021
274900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        27490021
275000                                   TO PV-HOLD-SELECTED-ITEMS      27500021
275100         PERFORM 6100-UPDATE-TSQ                                  27510021
275200             UNTIL PV-ITEMS-PROCESSED >                           27520021
275300                                     ASC-NUMBER-OF-SELECTED-ITEMS 27530021
275400         PERFORM 6010-DELETE-SEL-QUEUE                            27540021
275500         INITIALIZE ASC-BLOCK-ENTRIES (1)                         27550021
275600                    ASC-BLOCK-ENTRIES (2)                         27560021
275700     END-IF.                                                      27570021
275800/                                                                 27580021
275900*----------------------------------------------------------------*27590021
276000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *27600021
276100*----------------------------------------------------------------*27610021
276200 6010-DELETE-SEL-QUEUE.                                           27620021
276300                                                                  27630021
276400     EXEC CICS                                                    27640021
276500         DELETEQ TS                                               27650021
276600             QUEUE (ASC-SEL-QUEUE-NAME)                           27660021
276700             RESP  (PV-CICS-RESP)                                 27670021
276800     END-EXEC.                                                    27680021
276900                                                                  27690021
277000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27700021
277100         (PV-CICS-RESP = DFHRESP(QIDERR)))                        27710021
277200         CONTINUE                                                 27720021
277300     ELSE                                                         27730021
277400         SET DP013-CICS-ABEND      TO TRUE                        27740021
277500         SET DP013-NO-ROLLBACK     TO TRUE                        27750021
277600         MOVE '6010-DELETE-SEL-QUEUE'                             27760021
277700                                   TO DP013-PARAGRAPH             27770021
277800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27780021
277900                                   TO DP013-MESSAGE-TEXT (1)      27790021
278000         PERFORM DP013-0000-PROCESS-ABEND                         27800021
278100     END-IF.                                                      27810021
278200/                                                                 27820021
278300*----------------------------------------------------------------*27830021
278400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27840021
278500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27850021
278600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27860021
278700*    THE TEMP QUEUE.                                             *27870021
278800*----------------------------------------------------------------*27880021
278900 6100-UPDATE-TSQ.                                                 27890021
279000                                                                  27900021
279100     ADD 1                         TO PV-SEL-QUEUE-ITEM.          27910021
279200     PERFORM 6105-READ-SEL-QUEUE.                                 27920021
279300                                                                  27930021
279400     PERFORM                                                      27940021
279500         VARYING SU010-IDX                                        27950021
279600         FROM 1 BY 1                                              27960021
279700         UNTIL ((PV-ITEMS-PROCESSED >                             27970021
279800                              PV-HOLD-SELECTED-ITEMS)             27980021
279900         OR (SU010-IDX GREATER THAN SU010-MAX-ITEMS))             27990021
280000         IF  SU010-ACTION-SW (SU010-IDX) > SPACE                  28000021
280100             PERFORM 6110-PROCESS-ITEMS                           28010021
280200         END-IF                                                   28020021
280300         ADD +1                    TO PV-ITEMS-PROCESSED          28030021
280400     END-PERFORM.                                                 28040021
280500                                                                  28050021
280600     PERFORM 6111-WRITE-LIST-QUEUE.                               28060021
280700/                                                                 28070021
280800*----------------------------------------------------------------*28080021
280900*    READ THE LIST QUEUE RECORD.                                 *28090021
281000*----------------------------------------------------------------*28100021
281100 6105-READ-SEL-QUEUE.                                             28110021
281200                                                                  28120021
281300     EXEC CICS                                                    28130021
281400          READQ TS                                                28140021
281500              QUEUE (ASC-SEL-QUEUE-NAME)                          28150021
281600              INTO  (SU010-SELECT-RECORD)                         28160021
281700              ITEM  (PV-SEL-QUEUE-ITEM)                           28170021
281800              RESP  (PV-CICS-RESP)                                28180021
281900     END-EXEC.                                                    28190021
282000                                                                  28200021
282100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28210021
282200         CONTINUE                                                 28220021
282300     ELSE                                                         28230021
282400         SET DP013-CICS-ABEND      TO TRUE                        28240021
282500         SET DP013-NO-ROLLBACK     TO TRUE                        28250021
282600         MOVE '6105-READ-SEL-QUEUE'                               28260021
282700                                   TO DP013-PARAGRAPH             28270021
282800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           28280021
282900                                   TO DP013-MESSAGE-TEXT(1)       28290021
283000         PERFORM DP013-0000-PROCESS-ABEND                         28300021
283100     END-IF.                                                      28310021
283200/                                                                 28320021
283300*----------------------------------------------------------------*28330021
283400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*28340021
283500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*28350021
283600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *28360021
283700*----------------------------------------------------------------*28370021
283800 6110-PROCESS-ITEMS.                                              28380021
283900                                                                  28390021
284000     COMPUTE PV-ITEM = 1 + ((SU010-ITEM (SU010-IDX) - 1)          28400021
284100                     / PC-ITEMS-PER-PANEL).                       28410021
284200                                                                  28420021
284300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           28430021
284400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          28440021
284500             PERFORM 6111-WRITE-LIST-QUEUE                        28450021
284600         END-IF                                                   28460021
284700         MOVE PV-ITEM              TO PV-SAVE-ITEM                28470021
284800                                                                  28480021
284900         PERFORM 6112-READ-LIST-QUEUE                             28490021
285000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               28500021
285100             CONTINUE                                             28510021
285200         END-IF                                                   28520021
285300     END-IF.                                                      28530021
285400                                                                  28540021
285500     COMPUTE PV-SUB = (SU010-ITEM (SU010-IDX)                     28550021
285600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28560021
285700                                                                  28570021
285800     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       28580021
285900     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        28590021
286000                                     (PV-SUB).                    28600021
286100                                                                  28610021
286200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28620021
286300/                                                                 28630021
286400*----------------------------------------------------------------*28640021
286500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *28650021
286600*----------------------------------------------------------------*28660021
286700 6111-WRITE-LIST-QUEUE.                                           28670021
286800                                                                  28680021
286900     EXEC CICS                                                    28690021
287000         WRITEQ TS                                                28700021
287100             QUEUE (ASC-LIST-QUEUE-NAME)                          28710021
287200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28720021
287300             ITEM  (PV-SAVE-ITEM)                                 28730021
287400             REWRITE                                              28740021
287500             RESP  (PV-CICS-RESP)                                 28750021
287600     END-EXEC.                                                    28760021
287700                                                                  28770021
287800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28780021
287900     OR  PV-CICS-RESP = DFHRESP (ITEMERR)                         28790021
288000         CONTINUE                                                 28800021
288100     ELSE                                                         28810021
288200         SET DP013-CICS-ABEND      TO TRUE                        28820021
288300         SET DP013-NO-ROLLBACK     TO TRUE                        28830021
288400         MOVE '6111-WRITE-LIST-QUEUE'                             28840021
288500                                   TO DP013-PARAGRAPH             28850021
288600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28860021
288700                                   TO DP013-MESSAGE-TEXT(1)       28870021
288800         PERFORM DP013-0000-PROCESS-ABEND                         28880021
288900     END-IF.                                                      28890021
289000/                                                                 28900021
289100*----------------------------------------------------------------*28910021
289200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28920021
289300*----------------------------------------------------------------*28930021
289400 6112-READ-LIST-QUEUE.                                            28940021
289500                                                                  28950021
289600     EXEC CICS                                                    28960021
289700         READQ TS                                                 28970021
289800             QUEUE (ASC-LIST-QUEUE-NAME)                          28980021
289900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28990021
290000             ITEM  (PV-ITEM)                                      29000021
290100             RESP  (PV-CICS-RESP)                                 29010021
290200     END-EXEC.                                                    29020021
290300                                                                  29030021
290400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29040021
290500         CONTINUE                                                 29050021
290600     ELSE                                                         29060021
290700         SET DP013-CICS-ABEND      TO TRUE                        29070021
290800         SET DP013-NO-ROLLBACK     TO TRUE                        29080021
290900         MOVE '6112-READ-LIST-QUEUE'                              29090021
291000                                   TO DP013-PARAGRAPH             29100021
291100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    29110021
291200                                   TO DP013-MESSAGE-TEXT(1)       29120021
291300         PERFORM DP013-0000-PROCESS-ABEND                         29130021
291400     END-IF.                                                      29140021
291500/                                                                 29150021
291600*-----------------------------------------------------------------29160021
291700*  READ THE LIST QUEUE RECORD                                     29170021
291800*-----------------------------------------------------------------29180021
291900 9100-READ-SEL-QUEUE.                                             29190021
292000                                                                  29200021
292100     EXEC CICS                                                    29210021
292200         READQ TS                                                 29220021
292300             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        29230021
292400             INTO  (CE003-SELECT-RECORD)                          29240021
292500             ITEM  (ASC-SEL-ITEM)                                 29250021
292600             RESP  (PV-CICS-RESP)                                 29260021
292700     END-EXEC.                                                    29270021
292800     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        29280021
292900         CONTINUE                                                 29290021
293000     ELSE                                                         29300021
293100         SET DP013-LOGIC-ABEND                                    29310021
293200             DP013-NO-ROLLBACK   TO   TRUE                        29320021
293300         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          29330021
293400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   29340021
293500                                 TO   DP013-MESSAGE-TEXT (1)      29350021
293600         PERFORM DP013-0000-PROCESS-ABEND                         29360021
293700     END-IF.                                                      29370021
293800                                                                  29380021
293900*-----------------------------------------------------------------29390021
294000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *29400021
294100*-----------------------------------------------------------------29410021
294200 9200-REWRITE-SEL-QUEUE.                                          29420021
294300                                                                  29430021
294400     EXEC CICS                                                    29440021
294500          WRITEQ TS                                               29450021
294600              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      29460021
294700              FROM   (CE003-SELECT-RECORD)                        29470021
294800              ITEM   (ASC-SEL-ITEM)                               29480021
294900              RESP   (PV-CICS-RESP)                               29490021
295000              REWRITE                                             29500021
295100     END-EXEC.                                                    29510021
295200                                                                  29520021
295300     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   29530021
295400         SET DP013-CICS-ABEND                                     29540021
295500             DP013-NO-ROLLBACK     TO TRUE                        29550021
295600         MOVE '9200-REWRITE-SEL-QUEUE'                            29560021
295700                                   TO DP013-PARAGRAPH             29570021
295800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   29580021
295810                                   TO DP013-MESSAGE-TEXT (1)      29581021
295811         PERFORM DP013-0000-PROCESS-ABEND                         29581121
295812     END-IF.                                                      29581221
295813                                                                  29581321
295814*----------------------------------------------------------------*29581421
295815*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *29581521
295816*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *29581621
295817*----------------------------------------------------------------*29581721
295818*---------------------------------------------------------------* 29581821
295819*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 29581921
295820*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 29582021
295821*---------------------------------------------------------------* 29582121
295822 9000-CALL-CICS-ARCH-API.                                         29582221
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      29582429
295824                                    DFHCOMMAREA                   29582529
295825                                    DP030-CICS-API-FIELDS         29582629
295826                                    DP020-STANDARD-COMMAREA       29582729
295827                                    CE621AI.                      29582829
295828                                                                  29582921
295829     IF DP030-RC-CALL-SUCCESSFUL OR                               29583021
295830        DP030-RC-APPL-ERROR                                       29583121
295840*        CONTINUE                                                 29584021
295850         DISPLAY ' SUCCESS'                                       29585021
295860     ELSE                                                         29586021
295870         SET DP013-NO-ROLLBACK                                    29587021
295880             DP013-XCTL-DISPLAY-RESTART                           29588021
295890             DP013-CICS-ABEND      TO TRUE                        29589021
295900         MOVE '9000-CALL-CICS-ARCH-API'                           29590021
296000                                   TO DP013-PARAGRAPH             29600021
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O29601029
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      29602029
296300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      29630021
296400         PERFORM DP013-0000-PROCESS-ABEND                         29640021
296500     END-IF.                                                      29650021
296600/                                                                 29660021
296700*----------------------------------------------------------------*29670021
296800*    ABEND PROCESSOR MODULE                                      *29680021
296900*----------------------------------------------------------------*29690021
297000     COPY DPPD013.                                                29700021
297100*----------------------------------------------------------------*29710021
297200*----------------------------------------------------------------*29720021
