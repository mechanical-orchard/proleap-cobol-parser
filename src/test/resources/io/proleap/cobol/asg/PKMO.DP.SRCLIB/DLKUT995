000006************************************************************      00000609
000007* THIS PROGRAM WAS COPIED FROM DLKUT003 IN APRIL OF 2015   *      00000709
000008* FOR THE SOLE PURPOSE OF BEING ABLE TO PULL DATA FROM     *      00000809
000009* THE REPOSITORY TALBES FOR TESTING PURPOSES ONLY.         *      00000909
000010*                                                          *      00001009
000020* TEST JCL FOR RUNNING THIS PROGRAM CAN BE FOUND IN:       *      00002009
000030*     TKMA.TM04.JCL(DLKUT995))                             *      00003099
000040*                                                          *      00004009
000050* IN THIS PROGRAM, CHANGE THE TIMESTAMP VALUE IN FIELD     *      00005009
000060* PV-CRE-TIMESTAMP TO CONTROL THE DATA TO BE EXTRACTED.    *      00006009
000061* PULL THE PROGRAM INTO TEST, CHANGE THE PV-CRE-TIMESTAMP  *      00006199
000062* AND RUN AGAINST PRODUCTION.                              *      00006299
000063* FOR MORE INFORMATION ON RUNNING THIS PROGRAM TO PULL     *      00006399
000064* DATA, LOOK INTO THE DL FAQ DOCUMENT AND DO A SEARCH FOR  *      00006499
000065* DLKUT995 WHICH WILL LEAD YOU TO A WORD DOCUMENT ABOUT    *      00006599
000066* USING THIS PROGRAM INCLUDING SETTING THE VALUE IN THE    *      00006699
000067* PV-CRE-TIMESTAMP FIELD.                                  *      00006799
000068*                                                          *      00006899
000069* FYI, THIS PROGRAM ONLY DOES SELECTS AGAINST DB2 TABLES,  *      00006999
000070* THERE ARE NO UPDATES, DELETES OR INSERTS DONE.           *      00007099
000071************************************************************      00007109
000080 TITLE 'EXTRACT EAI EXPORT TABLE DATA'.                           00008009
000090 IDENTIFICATION DIVISION.                                         00009009
000100 PROGRAM-ID.    DLKUT995.                                         00010009
000200 AUTHOR.        RON KRIER.                                        00020009
000300 DATE-WRITTEN.  JANUARY 2004.                                     00030009
000400 ENVIRONMENT DIVISION.                                            00040009
000500 INPUT-OUTPUT SECTION.                                            00050009
000600                                                                  00060009
000700 FILE-CONTROL.                                                    00070009
000800     SELECT SELECT-TMST-EXTRACT-FILE ASSIGN TO INP01.             00080009
000900     SELECT EXPORT-EXTRACT-FILE      ASSIGN TO OUT01.             00090009
001000     SELECT EXPORT-KEY-FILE          ASSIGN TO OUT02.             00100009
001010     SELECT EXPORT-CLOCK-IN-FILE     ASSIGN TO OUT03.             00101009
001020                                                                  00102009
001030 DATA DIVISION.                                                   00103009
001040 FILE SECTION.                                                    00104009
001050                                                                  00105009
001060 FD  SELECT-TMST-EXTRACT-FILE                                     00106009
001070     RECORDING MODE IS F                                          00107009
001080     LABEL RECORDS ARE STANDARD                                   00108009
001090     BLOCK CONTAINS 0 RECORDS.                                    00109009
001100                                                                  00110009
001200 01  SELECT-TMST-EXTRACT-RECORD       PIC X(52).                  00120009
001300                                                                  00130009
001400 FD  EXPORT-EXTRACT-FILE                                          00140009
001500     RECORDING MODE IS F                                          00150009
001600     LABEL RECORDS ARE STANDARD                                   00160009
001700     BLOCK CONTAINS 0 RECORDS.                                    00170009
001800                                                                  00180009
001900 01  EXPORT-EXTRACT-RECORD            PIC X(900).                 00190009
002000                                                                  00200009
002100 FD  EXPORT-KEY-FILE                                              00210009
002200     RECORDING MODE IS F                                          00220009
002300     LABEL RECORDS ARE STANDARD                                   00230009
002400     BLOCK CONTAINS 0 RECORDS.                                    00240009
002500                                                                  00250009
002600 01  EXPORT-KEY-RECORD                PIC X(050).                 00260009
002700                                                                  00270009
002800 FD  EXPORT-CLOCK-IN-FILE                                         00280009
002900     RECORDING MODE IS F                                          00290009
003000     LABEL RECORDS ARE STANDARD                                   00300009
003100     BLOCK CONTAINS 0 RECORDS.                                    00310009
003200                                                                  00320009
003300 01  EXPORT-CLOCK-IN-RECORD           PIC X(100).                 00330009
003400                                                                  00340009
003500 WORKING-STORAGE SECTION.                                         00350009
003600                                                                  00360009
003700 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO.    00370009
003800                                                                  00380009
003900 01  PS-PROGRAM-SWITCHES.                                         00390009
004000     05  PS-END-CSR-SW                PIC X(1)   VALUE 'N'.       00400009
004100         88  PS-END-CSR                          VALUE 'Y'.       00410009
004200     05  PS-EXPORT-DETAIL-SW          PIC X(1)   VALUE 'N'.       00420009
004300         88  PS-EXPORT-DETAIL-FOUND              VALUE 'Y'.       00430009
004400         88  PS-EXPORT-DETAIL-NOT-FOUND          VALUE 'N'.       00440009
004500     05  PS-EOF-SEL-TMST-FILE-SW      PIC X(1)   VALUE 'N'.       00450009
004600         88  PS-EOF-SEL-TMST-FILE                VALUE 'Y'.       00460009
004700         88  PS-NOT-EOF-SEL-TMST-FILE            VALUE 'N'.       00470009
004800     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       00480009
004810         88  PS-END-OF-CURSOR                    VALUE 'Y'.       00481009
004820         88  PS-NOT-END-OF-CURSOR                VALUE 'N'.       00482009
004830                                                                  00483009
004840 01  CC-CONTROL-CARD-PARAMETERS.                                  00484009
004850      05 CC-DC-NBR                      PIC 9(04).                00485009
004860      05 FILLER                         PIC X(76) VALUE SPACE.    00486009
004870                                                                  00487009
004880 01  PV-PROGRAM-VARIABLES.                                        00488009
004890     05  PV-RETRY-COUNT               PIC S9(04)  VALUE ZERO      00489009
004900                                                  COMP SYNC.      00490009
005000     05  PV-TEAM-ASSIGN-COUNT         PIC S9(04)  VALUE ZERO      00500009
005100                                                  COMP SYNC.      00510009
005200     05  PV-TIMESTAMP                 PIC X(26)   VALUE SPACES.   00520009
005300     05  PV-CRE-TIMESTAMP             PIC X(26)   VALUE           00530009
005400         '2016-10-21-04.00.00.000000'.                            00540099
005500     05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACES.   00550009
005600     05  PV-ERROR-MESSAGE-1           PIC X(60)   VALUE SPACES.   00560009
005700     05  PV-ERROR-MESSAGE-2           PIC X(60)   VALUE SPACES.   00570009
005800     05  PV-SQLCODE                   PIC 9(9)    VALUE ZERO.     00580009
005900     05  PV-APP-ID                    PIC X(02)   VALUE SPACES.   00590009
006000         88  PV-PC-APP-ID                         VALUE 'PC'.     00600009
006100         88  PV-SU-APP-ID                         VALUE 'SU'.     00610009
006200     05  PV-AUDIT-DATE                PIC X(10)   VALUE SPACES.   00620009
006300     05  PV-OUTPUT-DC                 PIC 9(04)   VALUE ZERO.     00630009
006400     05  PV-FUNC-QTY                  PIC S9(09) COMP.            00640009
006500     05  PV-DISPLAY-SEQ-NBR           PIC 9(04) VALUE ZEROS.      00650009
006600     05  PV-DISPLAY-NUMBER            PIC 9999999999.             00660009
006700     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00670009
006800     05  PV-DISPLAY-OPER-UNT-ID       PIC 9(04) VALUE ZEROS.      00680009
006900     05  PV-EVENT-FETCH-COUNT         PIC S9(9)   COMP-3          00690009
007000                                                  VALUE ZEROS.    00700009
007100     05  PV-SU-EVENT-FETCH-COUNT      PIC S9(9)   COMP-3          00710009
007200                                                  VALUE ZEROS.    00720009
007300     05  PV-PC-EVENT-FETCH-COUNT      PIC S9(9)   COMP-3          00730009
007400                                                  VALUE ZEROS.    00740009
007500     05  PV-EVENT-DTL-SELECT-COUNT    PIC S9(9)   COMP-3          00750009
007600                                                  VALUE ZEROS.    00760009
007700     05  PV-SU-EVENT-DTL-SELECT-COUNT PIC S9(9)   COMP-3          00770009
007800                                                  VALUE ZEROS.    00780009
007900     05  PV-PC-EVENT-DTL-SELECT-COUNT PIC S9(9)   COMP-3          00790009
008000                                                  VALUE ZEROS.    00800009
008100     05  PV-EXTRACT-WRITE-COUNT       PIC S9(9)   COMP-3          00810009
008200                                                  VALUE ZEROS.    00820009
008300     05  PV-KEY-WRITE-COUNT           PIC S9(9)   COMP-3          00830009
008400                                                  VALUE ZEROS.    00840009
008500     05  PV-NULL-REF-ID-IND           PIC S9(4)   VALUE ZERO      00850009
008600                                                  COMP SYNC.      00860009
008700     05  PV-NULL-EK1NBR-IND           PIC S9(4)   VALUE ZERO      00870009
008800                                                  COMP SYNC.      00880009
008900     05  PV-NULL-EK2NBR-IND           PIC S9(4)   VALUE ZERO      00890009
009000                                                  COMP SYNC.      00900009
009100     05  PV-NULL-EK3NBR-IND           PIC S9(4)   VALUE ZERO      00910009
009200                                                  COMP SYNC.      00920009
009300     05  PV-NULL-EK4NBR-IND           PIC S9(4)   VALUE ZERO      00930009
009400                                                  COMP SYNC.      00940009
009500     05  PV-NULL-EK5NBR-IND           PIC S9(4)   VALUE ZERO      00950009
009600                                                  COMP SYNC.      00960009
009700     05  PV-NULL-EK1TXT-IND           PIC S9(4)   VALUE ZERO      00970009
009800                                                  COMP SYNC.      00980009
009900     05  PV-NULL-EK2TXT-IND           PIC S9(4)   VALUE ZERO      00990009
010000                                                  COMP SYNC.      01000009
010100     05  PV-NULL-EK3TXT-IND           PIC S9(4)   VALUE ZERO      01010009
010200                                                  COMP SYNC.      01020009
010300     05  PV-NULL-EK4TXT-IND           PIC S9(4)   VALUE ZERO      01030009
010400                                                  COMP SYNC.      01040009
010500     05  PV-NULL-EK5TXT-IND           PIC S9(4)   VALUE ZERO      01050009
010600                                                  COMP SYNC.      01060009
010700     05  PV-NULL-EK1TMST-IND          PIC S9(4)   VALUE ZERO      01070009
010800                                                  COMP SYNC.      01080009
010900     05  PV-NULL-EK2TMST-IND          PIC S9(4)   VALUE ZERO      01090009
011000                                                  COMP SYNC.      01100009
011100     05  PV-NULL-EK3TMST-IND          PIC S9(4)   VALUE ZERO      01110009
011200                                                  COMP SYNC.      01120009
011300     05  PV-NULL-EK4TMST-IND          PIC S9(4)   VALUE ZERO      01130009
011400                                                  COMP SYNC.      01140009
011500     05  PV-NULL-EK5TMST-IND          PIC S9(4)   VALUE ZERO      01150009
011600                                                  COMP SYNC.      01160009
011610     05  PV-WORK-TMST                 PIC X(26).                  01161093
011700     05  PV-INPUT-TMST.                                           01170009
011800         10 PV-INPUT-TMST-DATE.                                   01180009
011810             15 PV-INPUT-TMST-YR      PIC 9(04).                  01181009
011820             15 FILLER                PIC X.                      01182009
011830             15 PV-INPUT-TMST-MO      PIC 9(02).                  01183009
011840             15 FILLER                PIC X.                      01184009
011850             15 PV-INPUT-TMST-DA      PIC 9(02).                  01185009
011860         10 FILLER                    PIC X.                      01186009
011870         10 PV-INPUT-TMST-TIME.                                   01187009
011880             15 PV-INPUT-TMST-HR      PIC 9(02).                  01188009
011890             15 FILLER                PIC X.                      01189009
011891             15 PV-INPUT-TMST-MN      PIC 9(02).                  01189109
011892             15 FILLER                PIC X.                      01189209
011893             15 PV-INPUT-TMST-SS      PIC 9(02).                  01189309
011894         10 FILLER                PIC X.                          01189409
011895         10 FILLER                PIC X(06).                      01189509
011896                                                                  01189609
011897     05  PV-KEY-ASSGNMT-DATA.                                     01189709
011898         10  PV-KEY-ASSGNMT-DTL.                                  01189809
011899             15  PV-KEY-ASGMT-STRT-DTE.                           01189909
011900                 20  PV-KEY-ASGMT-STRT-YYYY       PIC  9(04).     01190009
011901                 20  PV-KEY-ASGMT-STRT-SLASH1     PIC  X(01).     01190109
011902                 20  PV-KEY-ASGMT-STRT-MM         PIC  9(02).     01190209
011903                 20  PV-KEY-ASGMT-STRT-SLASH2     PIC  X(01).     01190309
011904                 20  PV-KEY-ASGMT-STRT-DD         PIC  9(02).     01190409
011905             15  PV-KEY-ASGMT-NBR-TXT             PIC  X(10).     01190509
011906             15  PV-KEY-ASGMT-NBR-SEQ-NBR         PIC  9(09).     01190609
011907             15  PV-KEY-ASGMT-SEQ-DTL-NBR         PIC  9(09).     01190709
011908         10  PV-KEY-FILLER1                       PIC  X(962).    01190809
011909                                                                  01190909
011910     05  PV-SAVE-DC                   PIC 9(04) VALUE ZEROS.      01191009
011920     05  PV-RETRY-COUNTER             PIC S9(04) VALUE 0 COMP.    01192009
011930 01  PC-PROGRAM-CONSTANTS.                                        01193009
011940     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'DLKUT995'.01194009
011950     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         01195009
011960                                                 COMP SYNC.       01196009
011970     05  PC-N                         PIC X(01) VALUE 'N'.        01197009
011980 01  PV-ABEND-FIELDS.                                             01198009
011990     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'DLKUT995'.01199009
012000     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01200009
012100     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01210009
012200     05  PV-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    01220009
012300     05  PV-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    01230009
012400     05  PV-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    01240009
012500     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01250009
012600     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01260009
012700     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01270009
012800     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01280009
012900     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01290009
013000                                                                  01300009
013100 01  DK-DB-KEYS.                                                  01310009
013200     05 DK-ASGMT-STRT-DTE             PIC X(10).                  01320009
013300     05 DK-ASGMT-NBR-TXT              PIC X(10).                  01330009
013400     05 DK-ASGMT-NBR-SEQ-NBR          PIC S9(09) COMP.            01340009
013500     05 DK-OPER-UNT-ID                PIC S9(04) COMP.            01350009
013510 01  DN-NULL-INDICATORS.                                          01351009
013520     05  DN-KOHLS-USR-ID-NULL-IND     PIC S9(04) VALUE ZERO       01352009
013530                                                     COMP SYNC.   01353009
013540     05  DN-TMP-USR-ID-NULL-IND       PIC S9(04) VALUE ZERO       01354009
013550                                                     COMP SYNC.   01355009
013560                                                                  01356009
013570/                                                                 01357009
013580*    EXPORT EXTRACT FILE LAYOUT                                   01358009
013590     COPY DLRD003.                                                01359009
013600                                                                  01360009
013700*    EXPORT KEY FILE LAYOUT                                       01370009
013800     COPY DLRD004.                                                01380009
013900                                                                  01390009
014000*    SELECT TIMESTAMP EXTRACT FILE LAYOUT                         01400009
014100     COPY DLRD012.                                                01410009
014200*    SELECT TIMESTAMP EXTRACT FILE LAYOUT                         01420009
014300     COPY DLRD017.                                                01430009
014400/                                                                 01440009
014500*    DCLGEN FOR SU APPLICATION ID BUSINESS EVENT CONTROL TABLE    01450009
014600     EXEC SQL                                                     01460009
014700         INCLUDE SUT00035                                         01470009
014800     END-EXEC                                                     01480009
014900                                                                  01490009
015000*    DCLGEN FOR SU APPLICATION ID BUSINESS EVENT EXPORT TABLE     01500009
015100     EXEC SQL                                                     01510009
015200         INCLUDE SUT00037                                         01520009
015300     END-EXEC                                                     01530009
015400                                                                  01540009
015500*    DCLGEN FOR SU APPLICATION ID BUSINESS EVENT EXPORT           01550009
015600*    DETAIL TABLE                                                 01560009
015700     EXEC SQL                                                     01570009
015800         INCLUDE SUT00038                                         01580009
015900     END-EXEC                                                     01590009
016000                                                                  01600009
016100*    DCLGEN FOR PC APPLICATION ID BUSINESS EVENT CONTROL TABLE    01610009
016200     EXEC SQL                                                     01620009
016300         INCLUDE PCT00009                                         01630009
016400     END-EXEC                                                     01640009
016500                                                                  01650009
016600*    DCLGEN FOR PC APPLICATION ID BUSINESS EVENT EXPORT TABLE     01660009
016700     EXEC SQL                                                     01670009
016800         INCLUDE PCT00011                                         01680009
016900     END-EXEC                                                     01690009
017000                                                                  01700009
017100*    DCLGEN FOR PC APPLICATION ID BUSINESS EVENT EXPORT           01710009
017200*    DETAIL TABLE                                                 01720009
017300     EXEC SQL                                                     01730009
017400         INCLUDE PCT00012                                         01740009
017500     END-EXEC                                                     01750009
017600                                                                  01760009
017700*    DCLGEN FOR DATE ATTRIBUTE TABLE                              01770009
017800     EXEC SQL                                                     01780009
017900         INCLUDE TDTATTR                                          01790009
018000     END-EXEC                                                     01800009
018100*    DCLGEN FOR DLT_TEM_ASGMT ATTRIBUTE TABLE                     01810009
018200     EXEC SQL                                                     01820009
018210         INCLUDE DLT00003                                         01821009
018220     END-EXEC                                                     01822009
018230******************************************************************01823009
018240*    TKRPRPM TABLE                                                01824009
018250******************************************************************01825009
018260     EXEC SQL                                                     01826009
018270          INCLUDE TKRPRPM                                         01827009
018280     END-EXEC.                                                    01828009
018290*                                                                 01829009
018300/                                                                 01830009
018400     EXEC SQL                                                     01840009
018500         DECLARE EXPORT-CSR CURSOR FOR                            01850009
018600             SELECT                                               01860009
018700                   'SU' AS APP_ID                                 01870009
018800              , A.EVNT_EXPRT_ID                                   01880009
018900              , A.EVNT_OBJ_TXT                                    01890009
019000              , A.EVNT_OBJ_ACTN_TXT                               01900009
019100              , A.CRE_TMST                                        01910009
019200              , A.CRE_BY_USR_ID                                   01920009
019300              , A.CRE_BY_PGM_NM                                   01930009
019400              , A.REF_ID                                          01940009
019500              , A.EVNT_KY_1_NBR                                   01950009
019600              , A.EVNT_KY_2_NBR                                   01960009
019700              , A.EVNT_KY_3_NBR                                   01970009
019800              , A.EVNT_KY_4_NBR                                   01980009
019900              , A.EVNT_KY_5_NBR                                   01990009
020000              , A.EVNT_KY_1_TXT                                   02000009
020100              , A.EVNT_KY_2_TXT                                   02010009
020200              , A.EVNT_KY_3_TXT                                   02020009
020300              , A.EVNT_KY_4_TXT                                   02030009
020400              , A.EVNT_KY_5_TXT                                   02040009
020500              , A.EVNT_KY_1_TMST                                  02050009
020600              , A.EVNT_KY_2_TMST                                  02060009
020700              , A.EVNT_KY_3_TMST                                  02070009
020800              , A.EVNT_KY_4_TMST                                  02080009
020900              , A.EVNT_KY_5_TMST                                  02090009
021000              , A.EXPRT_STAT_CDE                                  02100009
021100              , A.LAST_UPD_TMST                                   02110009
021200              , A.EVNT_PRTY_NBR                                   02120009
021300             FROM                                                 02130009
021400                   SUT_BUS_EVNT_EXPRT A                           02140009
021500              ,    SUT_BUS_EVNT_CNTL  B                           02150009
021600             WHERE A.EVNT_OBJ_TXT      = B.EVNT_OBJ_TXT           02160009
021700               AND A.EVNT_OBJ_ACTN_TXT = B.EVNT_OBJ_ACTN_TXT      02170009
021800               AND A.EXPRT_STAT_CDE    = 'P'                      02180009
021900               AND A.LAST_UPD_TMST     = :PV-TIMESTAMP            02190089
021930               AND B.PGM_CDE_NM      = 'DLKUT003'                 02193009
021940               AND A.CRE_TMST          > :PV-CRE-TIMESTAMP        02194009
021950             UNION                                                02195009
021960             SELECT                                               02196009
021970                   'PC' AS APP_ID                                 02197009
021980              , B.EVNT_EXPRT_ID                                   02198009
021990              , B.EVNT_OBJ_TXT                                    02199009
022000              , B.EVNT_OBJ_ACTN_TXT                               02200009
022010              , B.CRE_TMST                                        02201009
022020              , B.CRE_BY_USR_ID                                   02202009
022030              , B.CRE_BY_PGM_NM                                   02203009
022040              , B.REF_ID                                          02204009
022050              , B.EVNT_KY_1_NBR                                   02205009
022060              , B.EVNT_KY_2_NBR                                   02206009
022070              , B.EVNT_KY_3_NBR                                   02207009
022080              , B.EVNT_KY_4_NBR                                   02208009
022090              , B.EVNT_KY_5_NBR                                   02209009
022100              , B.EVNT_KY_1_TXT                                   02210009
022200              , B.EVNT_KY_2_TXT                                   02220009
022300              , B.EVNT_KY_3_TXT                                   02230009
022400              , B.EVNT_KY_4_TXT                                   02240009
022500              , B.EVNT_KY_5_TXT                                   02250009
022600              , B.EVNT_KY_1_TMST                                  02260009
022700              , B.EVNT_KY_2_TMST                                  02270009
022800              , B.EVNT_KY_3_TMST                                  02280009
022900              , B.EVNT_KY_4_TMST                                  02290009
023000              , B.EVNT_KY_5_TMST                                  02300009
023100              , B.EXPRT_STAT_CDE                                  02310009
023200              , B.LAST_UPD_TMST                                   02320009
023300              , B.EVNT_PRTY_NBR                                   02330009
023400             FROM                                                 02340009
023500                   PCT_BUS_EVNT_EXPRT B                           02350009
023600              ,    PCT_BUS_EVNT_CNTL  C                           02360009
023700             WHERE B.EVNT_OBJ_TXT      = C.EVNT_OBJ_TXT           02370009
023800               AND B.EVNT_OBJ_ACTN_TXT = C.EVNT_OBJ_ACTN_TXT      02380009
023900               AND B.EXPRT_STAT_CDE    = 'P'                      02390009
024000               AND B.LAST_UPD_TMST     = :PV-TIMESTAMP            02400089
024300               AND C.PGM_CDE_NM        = 'DLKUT003'               02430009
024400               AND B.CRE_TMST          > :PV-CRE-TIMESTAMP        02440097
024500         ORDER BY 5                                               02450009
024600          WITH UR                                                 02460009
024700     END-EXEC                                                     02470009
024800/                                                                 02480009
024900******************************************************************02490009
025000*    CURSOR TO GET ASSOCIATES ON A TEAM ASSIGNMENT                02500009
025100******************************************************************02510009
025200                                                                  02520009
025300     EXEC SQL                                                     02530009
025310        DECLARE ASSOCIATE-CURSOR CURSOR FOR                       02531009
025320         SELECT                                                   02532009
025330                TEM.ASGMT_STRT_DTE                                02533009
025340               ,TEM.ASGMT_NBR_TXT                                 02534009
025350               ,TEM.KOHLS_USR_ID                                  02535009
025360               ,TEM.TMP_USR_ID                                    02536009
025370               ,TEM.JN_TMST + :PV-FUNC-QTY HOURS                  02537009
025380               ,TEM.CRE_BY_USR_ID                                 02538009
025390                                                                  02539009
025391          FROM  DLT_TEM_ASGMT   TEM                               02539109
025392                                                                  02539209
025393         WHERE  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        02539309
025394           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         02539409
025395           AND  TEM.ASGMT_NBR_SEQ_NBR =                           02539509
025396                              :DK-ASGMT-NBR-SEQ-NBR               02539609
025397***        AND  TEM.LVE_RSN_CDE      <> :PC-N                     02539799
025398           AND  TEM.LVE_TMST         <  :PV-TIMESTAMP             02539899
025399           AND  TEM.LVE_RSN_CDE      <> :PC-N                     02539999
025400     END-EXEC.                                                    02540099
025401                                                                  02540199
025410*  USED FOR DB2 ERROR MESSAGE BUILDING                            02541099
025500     COPY DPWS004.                                                02550009
025600                                                                  02560009
025610******************************************************************02561009
025620*  COPYBOOK SUWS050 (SU- BUSINESS EVENT EXPORT DETAIL)            02562009
025630******************************************************************02563009
025640     COPY SUWS050.                                                02564009
025650*                                                                 02565009
025660******************************************************************02566009
025670*  COPYBOOK PSWS242 (PC - BUSINESS EVENT EXPORT DETAIL)           02567009
025680******************************************************************02568009
025690     COPY PCWS242.                                                02569009
025691*                                                                 02569109
025692*   DB2 SQL COMMUNICATION AREA                                    02569209
025693     EXEC SQL                                                     02569309
025694          INCLUDE SQLCA                                           02569409
025695     END-EXEC.                                                    02569509
025696/                                                                 02569609
025697 PROCEDURE DIVISION.                                              02569709
025698                                                                  02569809
025699     PERFORM 1000-INIT.                                           02569909
025700                                                                  02570009
025800     PERFORM 2000-PROCESS UNTIL PS-END-CSR.                       02580009
025900                                                                  02590009
026000     PERFORM 9000-TERMINATE.                                      02600009
026100                                                                  02610009
026200     GOBACK.                                                      02620009
026300                                                                  02630009
026400 1000-INIT.                                                       02640009
026500                                                                  02650009
026600     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                02660009
026700     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS: '              02670009
026800             CC-CONTROL-CARD-PARAMETERS.                          02680009
026900     IF CC-DC-NBR NOT NUMERIC                                     02690009
027000         MOVE 0                     TO CC-DC-NBR                  02700009
027100     END-IF.                                                      02710009
027200                                                                  02720009
027300     OPEN INPUT  SELECT-TMST-EXTRACT-FILE.                        02730009
027400     OPEN OUTPUT EXPORT-EXTRACT-FILE.                             02740009
027500     OPEN OUTPUT EXPORT-KEY-FILE.                                 02750009
027600     OPEN OUTPUT EXPORT-CLOCK-IN-FILE.                            02760009
027700*GB 05/25/15                                                      02770009
027800     MOVE CC-DC-NBR  TO DK-OPER-UNT-ID                            02780009
027900     PERFORM 6000-GET-TKRPRPM-TIME-ZONE.                          02790009
028000                                                                  02800009
028100     SET PS-NOT-EOF-SEL-TMST-FILE   TO TRUE.                      02810009
028200                                                                  02820009
028300     PERFORM 7200-READ-TMST-EXTRACT-FILE.                         02830009
028400                                                                  02840009
028500     IF  PS-NOT-EOF-SEL-TMST-FILE                                 02850009
028600         MOVE DL012-CONTROL-TMST    TO PV-TIMESTAMP               02860009
028700         DISPLAY ' '                                              02870009
028800         DISPLAY 'CONTROL TIMESTAMP FOR THIS RUN IS: '            02880009
028900                 PV-TIMESTAMP                                     02890009
029000     ELSE                                                         02900009
029100         MOVE '1000-INIT'           TO PV-PARAGRAPH-NAME          02910009
029200         MOVE 'CONTROL TIMESTAMP FILE IS EMPTY'                   02920009
029300                                    TO PV-ERROR-MESSAGE-1         02930009
029400         PERFORM 9950-NON-SQL-ABEND                               02940009
029500     END-IF.                                                      02950009
029600                                                                  02960009
029700     PERFORM 7000-OPEN-EXPORT-CSR.                                02970009
029800     PERFORM 7010-FETCH-EXPORT-CSR.                               02980009
029900                                                                  02990009
030000 2000-PROCESS.                                                    03000009
030100                                                                  03010009
030200     PERFORM 3000-BUILD-EXTRACT.                                  03020009
030400     IF DL003-EVNT-OBJ-ACTN-TXT = 'INDIRECT LABOR' OR             03040009
030500        DL003-EVNT-OBJ-ACTN-TXT = 'ASSOCIATE ADD'                 03050009
030600         MOVE DL003-EVNT-KY-1-NBR   TO PV-OUTPUT-DC               03060009
030700*        DISPLAY 'PV-OUTPUT-DC ' PV-OUTPUT-DC                     03070055
030800     ELSE                                                         03080009
030900     IF DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT CLOSE' OR           03090009
031000        DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT USER ADD'           03100009
031100         MOVE DL003-EVNT-KY-2-NBR   TO PV-OUTPUT-DC               03110009
031200*        DISPLAY 'PV-OUTPUT-DC ' PV-OUTPUT-DC                     03120055
031300     ELSE                                                         03130009
031400         MOVE DL003-DTL-TXT-AREA(11:4) TO PV-OUTPUT-DC            03140009
031500     END-IF.                                                      03150009
031600                                                                  03160009
031700     IF CC-DC-NBR = PV-OUTPUT-DC                                  03170009
031800         PERFORM 8100-WRITE-EXTRACT-REC                           03180009
031900         PERFORM 8200-WRITE-KEY-REC                               03190009
031910         PERFORM 3100-BUILD-CLOCK-IN                              03191058
032000     END-IF.                                                      03200009
032100                                                                  03210009
032200     INITIALIZE PV-NULL-REF-ID-IND                                03220009
032300                PV-NULL-EK1NBR-IND                                03230009
032400                PV-NULL-EK2NBR-IND                                03240009
032500                PV-NULL-EK3NBR-IND                                03250009
032600                PV-NULL-EK4NBR-IND                                03260009
032700                PV-NULL-EK5NBR-IND                                03270009
032800                PV-NULL-EK1TXT-IND                                03280009
032900                PV-NULL-EK2TXT-IND                                03290009
033000                PV-NULL-EK3TXT-IND                                03300009
033100                PV-NULL-EK4TXT-IND                                03310009
033200                PV-NULL-EK5TXT-IND                                03320009
033300                PV-NULL-EK1TMST-IND                               03330009
033400                PV-NULL-EK2TMST-IND                               03340009
033500                PV-NULL-EK3TMST-IND                               03350009
033600                PV-NULL-EK4TMST-IND                               03360009
033700                PV-NULL-EK5TMST-IND.                              03370009
033800                                                                  03380009
033900     PERFORM 7010-FETCH-EXPORT-CSR.                               03390009
034000/                                                                 03400009
034100 3000-BUILD-EXTRACT.                                              03410009
034200                                                                  03420009
034300     SET PS-EXPORT-DETAIL-NOT-FOUND TO TRUE.                      03430009
034400     IF  PV-SU-APP-ID                                             03440009
034500         ADD +1 TO PV-SU-EVENT-FETCH-COUNT                        03450009
034600         PERFORM 7150-SELECT-SU-EXPORT-DTL                        03460009
034700     ELSE                                                         03470009
034800         IF  PV-PC-APP-ID                                         03480009
034900             ADD +1 TO PV-PC-EVENT-FETCH-COUNT                    03490009
035000             PERFORM 7160-SELECT-PC-EXPORT-DTL                    03500009
035100         ELSE                                                     03510009
035200             MOVE '3000-BUILD-EXTRACT'                            03520009
035300                                       TO PV-ABEND-PARAGRAPH      03530009
035400             MOVE 'INVALID APP ID'     TO PV-ABEND-OPERATION      03540009
035500             MOVE 'NOT PC APP ID     ' TO PV-ABEND-STRUCTURE-1    03550009
035600             MOVE 'NOT SU APP ID     ' TO PV-ABEND-STRUCTURE-2    03560009
035700             PERFORM 9900-DB2-ABEND                               03570009
035800         END-IF                                                   03580009
035900     END-IF.                                                      03590009
036000                                                                  03600009
036100     INITIALIZE DL003-EXPORT-RECORD-LAYOUT.                       03610009
036200     INITIALIZE DL004-EAI-KEY-RECORD-LAYOUT.                      03620009
036300     INITIALIZE DL017-ASSOC-STRT-REC-LAYOUT.                      03630009
036400                                                                  03640009
036500     MOVE PV-APP-ID                   TO DL003-APP-ID-EXPORT-CDE  03650009
036600                                         DL004-APP-ID-EXPORT-CDE. 03660009
036700     MOVE PV-TIMESTAMP                TO DL004-EXTRACT-TIMESTAMP. 03670009
036800                                                                  03680009
036900     MOVE SUT00037-EVNT-EXPRT-ID      TO DL004-EVNT-EXPRT-ID.     03690009
037000     MOVE SUT00037-EVNT-OBJ-TXT       TO DL003-EVNT-OBJ-TXT.      03700009
037100     MOVE SUT00037-EVNT-OBJ-ACTN-TXT  TO DL003-EVNT-OBJ-ACTN-TXT. 03710009
037200     MOVE SUT00037-CRE-BY-USR-ID      TO DL003-CRE-BY-USR-ID.     03720009
037300     MOVE SUT00037-CRE-BY-PGM-NM      TO DL003-CRE-PGM-NM.        03730009
037301**** GB 05/07/15                                                  03730109
037302     MOVE SUT00037-CRE-TMST           TO DL003-EVENT-DB-CRE-TMST. 03730209
037303     IF  PV-NULL-REF-ID-IND = -1                                  03730309
037304         MOVE SPACES                  TO DL003-REF-ID             03730409
037305     ELSE                                                         03730509
037306         MOVE SUT00037-REF-ID         TO DL003-REF-ID             03730609
037307     END-IF.                                                      03730709
037308                                                                  03730809
037309     IF  PV-NULL-EK1NBR-IND = -1                                  03730909
037310         MOVE ZEROS                   TO DL003-EVNT-KY-1-NBR      03731009
037320     ELSE                                                         03732009
037330         MOVE SUT00037-EVNT-KY-1-NBR  TO DL003-EVNT-KY-1-NBR      03733009
037340     END-IF.                                                      03734009
037350                                                                  03735009
037360     IF  PV-NULL-EK2NBR-IND = -1                                  03736009
037370         MOVE ZEROS                   TO DL003-EVNT-KY-2-NBR      03737009
037380     ELSE                                                         03738009
037390         MOVE SUT00037-EVNT-KY-2-NBR  TO DL003-EVNT-KY-2-NBR      03739009
037400     END-IF.                                                      03740009
037500                                                                  03750009
037600     IF  PV-NULL-EK3NBR-IND = -1                                  03760009
037700         MOVE ZEROS                   TO DL003-EVNT-KY-3-NBR      03770009
037800     ELSE                                                         03780009
037900         MOVE SUT00037-EVNT-KY-3-NBR  TO DL003-EVNT-KY-3-NBR      03790009
038000     END-IF.                                                      03800009
038100                                                                  03810009
038200     IF  PV-NULL-EK4NBR-IND = -1                                  03820009
038300         MOVE ZEROS                   TO DL003-EVNT-KY-4-NBR      03830009
038400     ELSE                                                         03840009
038500         MOVE SUT00037-EVNT-KY-4-NBR  TO DL003-EVNT-KY-4-NBR      03850009
038600     END-IF.                                                      03860009
038700                                                                  03870009
038800     IF  PV-NULL-EK5NBR-IND = -1                                  03880009
038900         MOVE ZEROS                   TO DL003-EVNT-KY-5-NBR      03890009
039000     ELSE                                                         03900009
039100         MOVE SUT00037-EVNT-KY-5-NBR  TO DL003-EVNT-KY-5-NBR      03910009
039200     END-IF.                                                      03920009
039300                                                                  03930009
039400     IF  PV-NULL-EK1TXT-IND = -1                                  03940009
039500         MOVE SPACES                  TO DL003-EVNT-KY-1-TXT      03950009
039600     ELSE                                                         03960009
039700         MOVE SUT00037-EVNT-KY-1-TXT  TO DL003-EVNT-KY-1-TXT      03970009
039800     END-IF.                                                      03980009
039900                                                                  03990009
040000     IF  PV-NULL-EK2TXT-IND = -1                                  04000009
040100         MOVE SPACES                  TO DL003-EVNT-KY-2-TXT      04010009
040200     ELSE                                                         04020009
040300         MOVE SUT00037-EVNT-KY-2-TXT  TO DL003-EVNT-KY-2-TXT      04030009
040400     END-IF.                                                      04040009
040500                                                                  04050009
040600     IF  PV-NULL-EK3TXT-IND = -1                                  04060009
040700         MOVE SPACES                  TO DL003-EVNT-KY-3-TXT      04070009
040800     ELSE                                                         04080009
040900         MOVE SUT00037-EVNT-KY-3-TXT  TO DL003-EVNT-KY-3-TXT      04090009
041000     END-IF.                                                      04100009
041100                                                                  04110009
041200     IF  PV-NULL-EK4TXT-IND = -1                                  04120009
041300         MOVE SPACES                  TO DL003-EVNT-KY-4-TXT      04130009
041400     ELSE                                                         04140009
041500         MOVE SUT00037-EVNT-KY-4-TXT  TO DL003-EVNT-KY-4-TXT      04150009
041600     END-IF.                                                      04160009
041700                                                                  04170009
041800     IF  PV-NULL-EK5TXT-IND = -1                                  04180009
041900         MOVE SPACES                  TO DL003-EVNT-KY-5-TXT      04190009
042000     ELSE                                                         04200009
042100         MOVE SUT00037-EVNT-KY-5-TXT  TO DL003-EVNT-KY-5-TXT      04210009
042200     END-IF.                                                      04220009
042300                                                                  04230009
042400     IF  PV-NULL-EK1TMST-IND = -1                                 04240009
042500         MOVE SPACES                  TO DL003-EVNT-KY-1-TMST     04250009
042600     ELSE                                                         04260009
042700         MOVE SUT00037-EVNT-KY-1-TMST TO DL003-EVNT-KY-1-TMST     04270009
042800     END-IF.                                                      04280009
042900                                                                  04290009
043000     IF  PV-NULL-EK2TMST-IND = -1                                 04300009
043100         MOVE SPACES                  TO DL003-EVNT-KY-2-TMST     04310009
043200     ELSE                                                         04320009
043300         MOVE SUT00037-EVNT-KY-2-TMST TO DL003-EVNT-KY-2-TMST     04330009
043400     END-IF.                                                      04340009
043500                                                                  04350009
043600     IF  PV-NULL-EK3TMST-IND = -1                                 04360009
043700         MOVE SPACES                  TO DL003-EVNT-KY-3-TMST     04370009
043800     ELSE                                                         04380009
043900         MOVE SUT00037-EVNT-KY-3-TMST TO DL003-EVNT-KY-3-TMST     04390009
044000     END-IF.                                                      04400009
044100                                                                  04410009
044200     IF  PV-NULL-EK4TMST-IND = -1                                 04420009
044300         MOVE SPACES                  TO DL003-EVNT-KY-4-TMST     04430009
044400     ELSE                                                         04440009
044500         MOVE SUT00037-EVNT-KY-4-TMST TO DL003-EVNT-KY-4-TMST     04450009
044600     END-IF.                                                      04460009
044700                                                                  04470009
044800     IF  PV-NULL-EK5TMST-IND = -1                                 04480009
044900         MOVE SPACES                  TO DL003-EVNT-KY-5-TMST     04490009
045000     ELSE                                                         04500009
045100         MOVE SUT00037-EVNT-KY-5-TMST TO DL003-EVNT-KY-5-TMST     04510009
045200     END-IF.                                                      04520009
045300                                                                  04530009
045400     MOVE SPACES                  TO DL003-DTL-TXT-AREA.          04540009
045500     IF  PS-EXPORT-DETAIL-NOT-FOUND                               04550009
045600         MOVE SPACES                  TO DL003-DTL-TXT-AREA       04560009
045700     ELSE                                                         04570009
045800         IF  PV-SU-APP-ID                                         04580009
045900             MOVE SUT00038-DTL-TXT-TEXT   TO DL003-DTL-TXT-AREA   04590009
046000         ELSE                                                     04600009
046100             IF  PV-PC-APP-ID                                     04610009
046200                 MOVE PCT00012-DTL-TXT-TEXT   TO                  04620009
046300                      DL003-DTL-TXT-AREA                          04630009
046400             ELSE                                                 04640009
046500                CONTINUE                                          04650009
046600             END-IF                                               04660009
046700         END-IF                                                   04670009
046800     END-IF.                                                      04680009
046900***GB                                                             04690009
047100                                                                  04710009
047200                                                                  04720009
047300 3100-BUILD-CLOCK-IN.                                             04730009
047400     INITIALIZE PV-KEY-ASSGNMT-DTL.                               04740009
047500     MOVE DL003-DTL-TXT-AREA      TO PV-KEY-ASSGNMT-DTL.          04750009
047600                                                                  04760009
047700     DISPLAY '3100-BUILD-CLOCK-IN'                                04770078
047800     DISPLAY 'DL003-EVNT-KY-1-NBR' DL003-EVNT-KY-1-NBR            04780078
047900     DISPLAY 'DL003-EVNT-KY-2-NBR' DL003-EVNT-KY-2-NBR            04790078
048000     DISPLAY 'DL003-EVNT-KY-1-TXT' DL003-EVNT-KY-1-TXT            04800078
048100     DISPLAY 'DL003-EVNT-KY-1-TMST' DL003-EVNT-KY-1-TMST          04810078
048200                                                                  04820009
048300     IF PS-EXPORT-DETAIL-FOUND                                    04830009
048400       DISPLAY 'PS-EXPORT-DETAIL-FOUND '                          04840078
048500       DISPLAY 'SUT00037-CRE-BY-USR-ID ' SUT00037-CRE-BY-USR-ID   04850078
048510       MOVE PV-KEY-ASGMT-NBR-SEQ-NBR  TO DK-ASGMT-NBR-SEQ-NBR     04851009
048520       MOVE CC-DC-NBR                 TO PV-SAVE-DC               04852009
048530       MOVE PV-KEY-ASGMT-NBR-TXT      TO DK-ASGMT-NBR-TXT         04853009
048540       MOVE PV-KEY-ASGMT-STRT-DTE     TO DK-ASGMT-STRT-DTE        04854009
048541       IF DK-ASGMT-STRT-DTE > SPACE                               04854194
048542          PERFORM 3200-PROCESS-TEAM-ASSIGN                        04854294
048543       END-IF                                                     04854394
048560     ELSE                                                         04856009
048570       IF DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT CLOSE'            04857009
048580*        DISPLAY  'ASSIGNMENT CLOSE'                              04858009
048581         MOVE DL003-EVNT-KY-1-NBR       TO DK-ASGMT-NBR-SEQ-NBR   04858109
048582         MOVE DL003-EVNT-KY-2-NBR       TO PV-SAVE-DC             04858209
048583         MOVE DL003-EVNT-KY-1-TXT       TO DK-ASGMT-NBR-TXT       04858309
048584         MOVE DL003-EVNT-KY-1-TMST      TO PV-INPUT-TMST          04858409
048585         MOVE PV-INPUT-TMST-DATE        TO DK-ASGMT-STRT-DTE      04858509
048586         DISPLAY 'DK-ASGMT-NBR-SEQ-NBR' DK-ASGMT-NBR-SEQ-NBR      04858678
048587         DISPLAY 'DL003-EVNT-KY-1-TXT ' DL003-EVNT-KY-1-TXT       04858778
048588         DISPLAY 'DK-ASGMT-STRT-DTE '   DK-ASGMT-STRT-DTE         04858878
048589         PERFORM 3200-PROCESS-TEAM-ASSIGN                         04858909
048590       ELSE                                                       04859009
048591         IF DL003-EVNT-OBJ-ACTN-TXT = 'INDIRECT LABOR'            04859109
048614          MOVE DL003-EVNT-KY-1-NBR    TO DL017-DC-NUMBER          04861491
048615          MOVE DL003-CRE-BY-USR-ID    TO DL017-CRE-BY-USR-ID      04861591
048616** GB 8/4/15                                                      04861691
048617          PERFORM 6100-SET-ADJUSTED-TIME-ZONE                     04861791
048618          MOVE PV-WORK-TMST           TO DL017-EVENT-DB-CRE-TMST  04861891
048619** GB 8/4/15                                                      04861991
048620          PERFORM 8300-WRITE-CLOCK-IN-REC                         04862091
048621         ELSE                                                     04862191
048622           IF DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT USER ADD'     04862291
048623            MOVE DL003-EVNT-KY-2-NBR  TO DL017-DC-NUMBER          04862391
048624            MOVE DL003-EVNT-KY-2-TXT  TO DL017-CRE-BY-USR-ID      04862491
048625** GB 8/4/15                                                      04862591
048626            PERFORM 6100-SET-ADJUSTED-TIME-ZONE                   04862691
048627            MOVE PV-WORK-TMST         TO DL017-EVENT-DB-CRE-TMST  04862791
048628** GB 8/4/15                                                      04862891
048629            PERFORM 8300-WRITE-CLOCK-IN-REC                       04862991
048630           ELSE                                                   04863099
048631****TEST                                                          04863199
048632           DISPLAY 'NO CLOCK IN RECORD '                          04863299
048633           DISPLAY 'DL003-EVNT-OBJ-TXT  ' DL003-EVNT-OBJ-TXT      04863399
048634           DISPLAY 'DL003-EVNT-OBJ-TXT  ' DL003-EVNT-OBJ-ACTN-TXT 04863499
048635           DISPLAY 'DL003-CRE-BY-USR-ID ' DL003-CRE-BY-USR-ID     04863599
048636****TEST                                                          04863699
048637           END-IF                                                 04863791
048638        END-IF                                                    04863898
048639       END-IF                                                     04863998
048640     END-IF.                                                      04864098
048641                                                                  04864198
048642                                                                  04864298
048643 3200-PROCESS-TEAM-ASSIGN.                                        04864398
048644                                                                  04864498
048645     SET PS-NOT-END-OF-CURSOR TO TRUE.                            04864598
048646     MOVE +0 TO PV-TEAM-ASSIGN-COUNT                              04864698
048647     PERFORM 5000-OPEN-ASSOCIATE-CURSOR.                          04864798
048648                                                                  04864898
048649     PERFORM UNTIL (PS-END-OF-CURSOR)                             04864998
048650        PERFORM 5100-FETCH-ASSOCIATE                              04865098
048651     END-PERFORM.                                                 04865198
048652                                                                  04865298
048653     PERFORM 5200-CLOSE-ASSOCIATE-CURSOR.                         04865309
048654                                                                  04865409
048655****************************************************************  04865509
048656*                                                              *  04865609
048657*                                                              *  04865709
048658****************************************************************  04865809
048659 5000-OPEN-ASSOCIATE-CURSOR.                                      04865909
048660     MOVE '5000-OPEN-ASSOCIATE-CURSOR'   TO PV-ABEND-PARAGRAPH.   04866009
048661***  DISPLAY 'NOW IN 5000-OPEN-ASSOCIATE-CURSOR'.                 04866109
048662                                                                  04866209
048663     PERFORM                                                      04866309
048664         WITH TEST AFTER                                          04866409
048665             VARYING PV-RETRY-COUNTER                             04866509
048666             FROM 1 BY 1                                          04866609
048667             UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES              04866709
048668                OR SQLCODE = ZERO                                 04866809
048669                                                                  04866909
048670         EXEC SQL                                                 04867009
048671              OPEN  ASSOCIATE-CURSOR                              04867109
048672         END-EXEC                                                 04867209
048673                                                                  04867309
048674         EVALUATE TRUE                                            04867409
048675             WHEN SQLCODE = ZERO                                  04867509
048676             WHEN SQLCODE = +100                                  04867609
048677             WHEN SQLCODE = -904                                  04867709
048678             WHEN SQLCODE = -913                                  04867809
048679             WHEN SQLCODE = -911                                  04867909
048680                  CONTINUE                                        04868009
048681                                                                  04868109
048682             WHEN SQLWARN0 NOT = SPACES                           04868209
048683             WHEN SQLCODE NOT = ZERO                              04868309
048684                  MOVE +4             TO PV-RETRY-COUNTER         04868409
048685         END-EVALUATE                                             04868509
048686     END-PERFORM.                                                 04868609
048687                                                                  04868709
048688     IF SQLCODE = ZERO                                            04868809
048689        CONTINUE                                                  04868909
048690     ELSE                                                         04869009
048691     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04869109
048692         MOVE SQLCODE               TO PV-SQLCODE                 04869209
048693         MOVE 'CURSOR OPEN ERROR'   TO PV-DB2-OPERATION-MESSAGE-1 04869309
048694         MOVE 'DLT_TEM_ASGMT'      TO PV-ABEND-STRUCTURE-1        04869409
048695         PERFORM 9900-DB2-ABEND                                   04869509
048696     END-IF.                                                      04869609
048697                                                                  04869709
048698****************************************************************  04869809
048699*                                                              *  04869909
048700*                                                              *  04870009
048701****************************************************************  04870109
048702 5100-FETCH-ASSOCIATE.                                            04870209
048703     DISPLAY 'NOW IN 5100-FETCH-ASSOCIATE-CURSOR'.                04870390
048704                                                                  04870409
048705     PERFORM                                                      04870509
048706         WITH TEST AFTER                                          04870609
048707         VARYING PV-RETRY-COUNTER                                 04870709
048708         FROM 1 BY 1                                              04870809
048709         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  04870909
048710            OR SQLCODE = ZERO                                     04871009
048711            OR SQLCODE = +100                                     04871109
048712                                                                  04871209
048713         EXEC SQL                                                 04871309
048714             FETCH  ASSOCIATE-CURSOR                              04871409
048715                                                                  04871509
048716              INTO  :DLT00003-ASGMT-STRT-DTE                      04871609
048717                   ,:DLT00003-ASGMT-NBR-TXT                       04871709
048718                   ,:DLT00003-KOHLS-USR-ID                        04871809
048719                              :DN-KOHLS-USR-ID-NULL-IND           04871909
048720                   ,:DLT00003-TMP-USR-ID                          04872009
048721                              :DN-TMP-USR-ID-NULL-IND             04872109
048722                   ,:DLT00003-JN-TMST                             04872209
048723                   ,:DLT00003-CRE-BY-USR-ID                       04872309
048724                                                                  04872409
048725         END-EXEC                                                 04872509
048726                                                                  04872609
048727         EVALUATE TRUE                                            04872709
048728             WHEN SQLCODE = ZERO                                  04872809
048729             WHEN SQLCODE = -904                                  04872909
048730             WHEN SQLCODE = -911                                  04873009
048731             WHEN SQLCODE = -913                                  04873109
048732                  CONTINUE                                        04873209
048733             WHEN SQLCODE = +100                                  04873309
048734                  SET PS-END-OF-CURSOR TO TRUE                    04873409
048735                                                                  04873509
048736             WHEN SQLWARN0 NOT = SPACES                           04873609
048737             WHEN SQLCODE NOT = ZERO                              04873709
048738                  MOVE +4             TO PV-RETRY-COUNTER         04873809
048739         END-EVALUATE                                             04873909
048740     END-PERFORM.                                                 04874009
048741                                                                  04874109
048742     IF SQLCODE = ZERO                                            04874209
048743         ADD +1 TO PV-TEAM-ASSIGN-COUNT                           04874309
048750         INITIALIZE DL017-ASSOC-STRT-REC-LAYOUT                   04875009
048751**       DISPLAY 'DLT00003-JN-TMST' DLT00003-JN-TMST              04875149
048753         MOVE PV-SAVE-DC            TO DL017-DC-NUMBER            04875390
048754         MOVE DLT00003-JN-TMST      TO DL017-EVENT-DB-CRE-TMST    04875490
048755         IF DN-KOHLS-USR-ID-NULL-IND < +0                         04875590
048756             MOVE DLT00003-TMP-USR-ID                             04875690
048757                                    TO DL017-CRE-BY-USR-ID        04875790
048758         ELSE                                                     04875890
048759             MOVE DLT00003-KOHLS-USR-ID                           04875990
048760                                    TO DL017-CRE-BY-USR-ID        04876090
048761         END-IF                                                   04876190
048762         DISPLAY 'PV-SAVE-DC'          PV-SAVE-DC                 04876290
048763         DISPLAY 'DL017-CRE-BY-USR-ID' DL017-CRE-BY-USR-ID        04876390
048764         PERFORM 8300-WRITE-CLOCK-IN-REC                          04876490
048765     ELSE                                                         04876590
048766     IF SQLCODE = +100                                            04876690
048767        CONTINUE                                                  04876790
048768     ELSE                                                         04876890
048769     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04876990
048770         MOVE SQLCODE               TO PV-SQLCODE                 04877090
048771         MOVE 'FETCH TEAM ASGMT'    TO PV-DB2-OPERATION-MESSAGE-1 04877190
048772         MOVE DK-ASGMT-NBR-SEQ-NBR  TO PV-DISPLAY-SEQ-NBR         04877290
048773         STRING 'ASSIGNMENT INFO * '    DELIMITED BY SIZE         04877390
048774                'START DATE = '         DELIMITED BY SIZE         04877490
048775                 DK-ASGMT-STRT-DTE      DELIMITED BY SIZE         04877590
048776                ' ASSIGNMENT NUM = '    DELIMITED BY SIZE         04877690
048777                 DK-ASGMT-NBR-TXT       DELIMITED BY SIZE         04877790
048778                ' SEQ NUM = '           DELIMITED BY SIZE         04877890
048779                 PV-DISPLAY-NUMBER      DELIMITED BY SIZE         04877990
048780                                   INTO PV-DB2-OPERATION-MESSAGE-204878090
048781         MOVE 'DLT_TEM_ASGMT'       TO PV-ABEND-STRUCTURE-1       04878190
048782         PERFORM 9900-DB2-ABEND                                   04878290
048783     END-IF.                                                      04878390
048784                                                                  04878490
048785****************************************************************  04878590
048786*                                                              *  04878690
048787*                                                              *  04878790
048788****************************************************************  04878890
048789 5200-CLOSE-ASSOCIATE-CURSOR.                                     04878990
048790     MOVE '5200-CLOSE-ASSOCIATE-CURSOR'   TO PV-ABEND-PARAGRAPH.  04879090
048791***  DISPLAY 'NOW IN 5200-CLOSE-ASSOCIATE-CURSOR'.                04879190
048792                                                                  04879290
048793     PERFORM                                                      04879390
048794         WITH TEST AFTER                                          04879490
048795         VARYING PV-RETRY-COUNTER                                 04879590
048796         FROM 1 BY 1                                              04879690
048797         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  04879790
048798            OR SQLCODE = ZERO                                     04879890
048799                                                                  04879990
048800         EXEC SQL                                                 04880090
048801              CLOSE ASSOCIATE-CURSOR                              04880190
048802         END-EXEC                                                 04880290
048803                                                                  04880390
048804         EVALUATE TRUE                                            04880490
048805             WHEN SQLCODE = ZERO                                  04880590
048806             WHEN SQLCODE = -904                                  04880690
048807             WHEN SQLCODE = -913                                  04880790
048808             WHEN SQLCODE = -911                                  04880890
048809                  CONTINUE                                        04880990
048810                                                                  04881090
048811             WHEN SQLCODE = +100                                  04881190
048812             WHEN SQLWARN0 NOT = SPACES                           04881290
048813             WHEN SQLCODE NOT = ZERO                              04881390
048814                  MOVE +4             TO PV-RETRY-COUNTER         04881490
048815         END-EVALUATE                                             04881590
048816     END-PERFORM.                                                 04881690
048817                                                                  04881790
048818     IF SQLCODE = ZERO                                            04881890
048819        CONTINUE                                                  04881990
048820     ELSE                                                         04882090
048821        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      04882190
048822         MOVE SQLCODE               TO PV-SQLCODE                 04882290
048823         MOVE 'CURSOR CLOSE ERROR'  TO PV-DB2-OPERATION-MESSAGE-1 04882390
048824         MOVE 'DLT_TEM_ASGMT'      TO PV-ABEND-STRUCTURE-1        04882490
048825         PERFORM 9900-DB2-ABEND                                   04882590
048826        END-IF                                                    04882690
048827     END-IF.                                                      04882790
048828*----------------------------------------------------------------*04882890
048829*    RETRIEVE THE TIMEZN SYS-PRC-FUNC-CDE TO DETERMINE THE NUMBER 04882990
048830*    OF HOURS TO ADD OR SUBTRACT FROM THE CURRENT TIME INORDER    04883090
048831*    TO BE IN THE CORRECT TIMEZONE.                               04883190
048832*----------------------------------------------------------------*04883290
048833*                                                                 04883390
048834 6000-GET-TKRPRPM-TIME-ZONE.                                      04883490
048835       EXEC SQL                                                   04883590
048836           SELECT FUNC_QTY                                        04883690
048837             INTO   :PV-FUNC-QTY                                  04883790
048838             FROM   TKRPRPM                                       04883890
048839            WHERE LOC_ID           = :DK-OPER-UNT-ID              04883990
048840              AND INTFC_SYS_CDE    = 'KHL'                        04884090
048841              AND SYS_PRC_FUNC_CDE = 'TIMEZN'                     04884190
048842              AND FUNC_PRC_STAT_CDE = 'AC'                        04884290
048843       END-EXEC                                                   04884390
048844                                                                  04884490
048845       EVALUATE TRUE                                              04884590
048846           WHEN SQLCODE = +0                                      04884690
048847           WHEN SQLCODE = -904                                    04884790
048848           WHEN SQLCODE = -913                                    04884890
048849           WHEN SQLCODE = -911                                    04884990
048850               DISPLAY 'PV-FUNC-QTY'  PV-FUNC-QTY                 04885090
048851               CONTINUE                                           04885190
048852           WHEN OTHER                                             04885290
048853               MOVE 0 TO PV-FUNC-QTY                              04885390
048854               DISPLAY '6000-GET-TKRPRPM ERROR'                   04885490
048855               MOVE DK-OPER-UNT-ID TO  PV-DISPLAY-OPER-UNT-ID     04885590
048856               DISPLAY ' OPER UNIT   - '                          04885690
048857                       PV-DISPLAY-OPER-UNT-ID                     04885790
048858       END-EVALUATE.                                              04885890
048859                                                                  04885990
048860 6100-SET-ADJUSTED-TIME-ZONE.                                     04886091
048861     IF DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT USER ADD'           04886191
048862      EXEC SQL                                                    04886291
048863         SET :PV-WORK-TMST                                        04886391
048864        = (TIMESTAMP(:DL003-EVNT-KY-2-TMST) + :PV-FUNC-QTY HOURS) 04886491
048865      END-EXEC                                                    04886591
048866     ELSE                                                         04886691
048867      EXEC SQL                                                    04886791
048868         SET :PV-WORK-TMST                                        04886891
048869        = (TIMESTAMP(:DL003-EVNT-KY-1-TMST) + :PV-FUNC-QTY HOURS) 04886991
048870      END-EXEC                                                    04887091
048871     END-IF.                                                      04887191
048872                                                                  04887290
048873/                                                                 04887390
048874 7000-OPEN-EXPORT-CSR.                                            04887490
048875     PERFORM                                                      04887590
048876         WITH TEST AFTER                                          04887609
048880         VARYING PV-RETRY-COUNT                                   04888009
048890         FROM 1 BY 1                                              04889009
048900         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 04890009
049000            OR  (SQLCODE = +100)                                  04900009
049100            OR  (SQLCODE = +0))                                   04910009
049200     EXEC SQL                                                     04920009
049300         OPEN EXPORT-CSR                                          04930009
049400     END-EXEC                                                     04940009
049500                                                                  04950009
049600     EVALUATE TRUE                                                04960009
049700         WHEN SQLCODE = ZERO                                      04970009
049800         WHEN SQLCODE = -904                                      04980009
049900         WHEN SQLCODE = -913                                      04990009
050000         WHEN SQLCODE = -911                                      05000009
050100             CONTINUE                                             05010009
050200         WHEN SQLWARN0 NOT = SPACE                                05020009
050300         WHEN SQLCODE  NOT = ZERO                                 05030009
050400             MOVE '7000-OPEN-EXPORT-CSR'                          05040009
050500                                       TO PV-ABEND-PARAGRAPH      05050009
050600             MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION      05060009
050700             MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1    05070009
050800             MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2    05080009
050900             PERFORM 9900-DB2-ABEND                               05090009
051000     END-EVALUATE                                                 05100009
051100     END-PERFORM.                                                 05110009
051200     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      05120009
051300          SQLCODE NOT = ZERO                                      05130009
051400          DISPLAY '**************************************'        05140009
051500          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        05150009
051600          DISPLAY 'OPEN EXTRACT CURSOR    '                       05160009
051700          DISPLAY '**************************************'        05170009
051800          MOVE '7000-OPEN-EXPORT-CSR'                             05180009
051900                                    TO PV-ABEND-PARAGRAPH         05190009
052000          MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION         05200009
052100          MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       05210009
052200          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2       05220009
052300          MOVE 'OPEN CURSOR ERROR'  TO PV-DB2-OPERATION-MESSAGE-1 05230009
052400          PERFORM 9900-DB2-ABEND                                  05240009
052500      END-IF.                                                     05250009
052600                                                                  05260009
052700 7010-FETCH-EXPORT-CSR.                                           05270009
052800      PERFORM                                                     05280009
052900          WITH TEST AFTER                                         05290009
053000          VARYING PV-RETRY-COUNT                                  05300009
053100          FROM 1 BY 1                                             05310009
053200          UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                05320009
053300             OR  (SQLCODE = +100)                                 05330009
053400             OR  (SQLCODE = +0))                                  05340009
053500       EXEC SQL                                                   05350009
053600           FETCH EXPORT-CSR                                       05360009
053700           INTO                                                   05370009
053800               :PV-APP-ID                                         05380009
053900           ,   :SUT00037-EVNT-EXPRT-ID                            05390009
054000           ,   :SUT00037-EVNT-OBJ-TXT                             05400009
054100           ,   :SUT00037-EVNT-OBJ-ACTN-TXT                        05410009
054200           ,   :SUT00037-CRE-TMST                                 05420009
054300           ,   :SUT00037-CRE-BY-USR-ID                            05430009
054400           ,   :SUT00037-CRE-BY-PGM-NM                            05440009
054500           ,   :SUT00037-REF-ID         :PV-NULL-REF-ID-IND       05450009
054600           ,   :SUT00037-EVNT-KY-1-NBR  :PV-NULL-EK1NBR-IND       05460009
054700           ,   :SUT00037-EVNT-KY-2-NBR  :PV-NULL-EK2NBR-IND       05470009
054800           ,   :SUT00037-EVNT-KY-3-NBR  :PV-NULL-EK3NBR-IND       05480009
054900           ,   :SUT00037-EVNT-KY-4-NBR  :PV-NULL-EK4NBR-IND       05490009
055000           ,   :SUT00037-EVNT-KY-5-NBR  :PV-NULL-EK5NBR-IND       05500009
055100           ,   :SUT00037-EVNT-KY-1-TXT  :PV-NULL-EK1TXT-IND       05510009
055200           ,   :SUT00037-EVNT-KY-2-TXT  :PV-NULL-EK2TXT-IND       05520009
055300           ,   :SUT00037-EVNT-KY-3-TXT  :PV-NULL-EK3TXT-IND       05530009
055400           ,   :SUT00037-EVNT-KY-4-TXT  :PV-NULL-EK4TXT-IND       05540009
055500           ,   :SUT00037-EVNT-KY-5-TXT  :PV-NULL-EK5TXT-IND       05550009
055600           ,   :SUT00037-EVNT-KY-1-TMST :PV-NULL-EK1TMST-IND      05560009
055700           ,   :SUT00037-EVNT-KY-2-TMST :PV-NULL-EK2TMST-IND      05570009
055800           ,   :SUT00037-EVNT-KY-3-TMST :PV-NULL-EK3TMST-IND      05580009
055900           ,   :SUT00037-EVNT-KY-4-TMST :PV-NULL-EK4TMST-IND      05590009
056000           ,   :SUT00037-EVNT-KY-5-TMST :PV-NULL-EK5TMST-IND      05600009
056100           ,   :SUT00037-EXPRT-STAT-CDE                           05610009
056200           ,   :SUT00037-LAST-UPD-TMST                            05620009
056300           ,   :SUT00037-EVNT-PRTY-NBR                            05630009
056400       END-EXEC                                                   05640009
056500                                                                  05650009
056600       EVALUATE TRUE                                              05660009
056700           WHEN SQLCODE = ZERO                                    05670009
056800               ADD 1                    TO PV-EVENT-FETCH-COUNT   05680009
056900           WHEN SQLCODE = +100                                    05690009
057000               SET PS-END-CSR           TO TRUE                   05700009
057100           WHEN SQLCODE = -904                                    05710009
057200           WHEN SQLCODE = -913                                    05720009
057300           WHEN SQLCODE = -911                                    05730009
057400                CONTINUE                                          05740009
057500           WHEN SQLWARN0 NOT = SPACE                              05750009
057600           WHEN SQLCODE  NOT = ZERO                               05760009
057700               MOVE '7010-FETCH-EXPORT-CSR'                       05770009
057800                                         TO PV-ABEND-PARAGRAPH    05780009
057900               MOVE 'FETCH CURSOR'       TO PV-ABEND-OPERATION    05790009
058000               MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1  05800009
058100               MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2  05810009
058200               PERFORM 9900-DB2-ABEND                             05820009
058300       END-EVALUATE                                               05830009
058400       END-PERFORM.                                               05840009
058500     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      05850009
058600          SQLCODE NOT = ZERO                                      05860009
058700          DISPLAY '**************************************'        05870009
058800          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        05880009
058900          DISPLAY 'OPEN EXTRACT CURSOR    '                       05890009
059000          DISPLAY '**************************************'        05900009
059100          MOVE '7000-OPEN-EXPORT-CSR'                             05910009
059200                                    TO PV-ABEND-PARAGRAPH         05920009
059300          MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION         05930009
059400          MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       05940009
059500          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2       05950009
059600          MOVE 'FETCH CURSOR ERROR' TO PV-DB2-OPERATION-MESSAGE-1 05960009
059700          PERFORM 9900-DB2-ABEND                                  05970009
059800      END-IF.                                                     05980009
059900                                                                  05990009
060000 7020-CLOSE-EXPORT-CSR.                                           06000009
060100     PERFORM                                                      06010009
060200         WITH TEST AFTER                                          06020009
060300         VARYING PV-RETRY-COUNT                                   06030009
060400         FROM 1 BY 1                                              06040009
060500         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 06050009
060600            OR  (SQLCODE = +100)                                  06060009
060700            OR  (SQLCODE = +0))                                   06070009
060800     EXEC SQL                                                     06080009
060900         CLOSE EXPORT-CSR                                         06090009
061000     END-EXEC                                                     06100009
061100                                                                  06110009
061200     EVALUATE TRUE                                                06120009
061300         WHEN SQLCODE = ZERO                                      06130009
061400         WHEN SQLCODE = -904                                      06140009
061500         WHEN SQLCODE = -913                                      06150009
061600         WHEN SQLCODE = -911                                      06160009
061700             CONTINUE                                             06170009
061800         WHEN SQLWARN0 NOT = SPACE                                06180009
061900         WHEN SQLCODE  NOT = ZERO                                 06190009
062000             MOVE '7020-CLOSE-EXPORT-CSR'                         06200009
062100                                       TO PV-ABEND-PARAGRAPH      06210009
062200             MOVE 'CLOSE CURSOR'       TO PV-ABEND-OPERATION      06220009
062300             MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1    06230009
062400             MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2    06240009
062500             PERFORM 9900-DB2-ABEND                               06250009
062600     END-EVALUATE                                                 06260009
062700     END-PERFORM.                                                 06270009
062800     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      06280009
062900          SQLCODE NOT = ZERO                                      06290009
063000          DISPLAY '**************************************'        06300009
063100          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        06310009
063200          DISPLAY 'OPEN EXTRACT CURSOR    '                       06320009
063300          DISPLAY '**************************************'        06330009
063400          MOVE '7020-CLOSE-EXPORT-CSR'                            06340009
063500                                    TO PV-ABEND-PARAGRAPH         06350009
063600          MOVE 'CLOSE CURSOR'       TO PV-ABEND-OPERATION         06360009
063700          MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       06370009
063800          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2       06380009
063900          MOVE 'CLOSE CURSOR ERROR' TO PV-DB2-OPERATION-MESSAGE-1 06390009
064000          PERFORM 9900-DB2-ABEND                                  06400009
064100      END-IF.                                                     06410009
064200                                                                  06420009
064300 7150-SELECT-SU-EXPORT-DTL.                                       06430009
064400                                                                  06440009
064500     PERFORM                                                      06450009
064600         WITH TEST AFTER                                          06460009
064700         VARYING PV-RETRY-COUNT                                   06470009
064800         FROM 1 BY 1                                              06480009
064900         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 06490009
065000            OR  (SQLCODE = +100)                                  06500009
065100            OR  (SQLCODE = +0))                                   06510009
065200     EXEC SQL                                                     06520009
065300         SELECT  DTL_TXT                                          06530009
065400           INTO  :SUT00038-DTL-TXT                                06540009
065500           FROM  SUT_BUS_EVNT_DTL                                 06550009
065600          WHERE  EVNT_EXPRT_ID    = :SUT00037-EVNT-EXPRT-ID       06560009
065700          WITH UR                                                 06570009
065800     END-EXEC                                                     06580009
065900                                                                  06590009
066000     EVALUATE TRUE                                                06600009
066100         WHEN SQLCODE = ZERO                                      06610009
066200             SET PS-EXPORT-DETAIL-FOUND TO TRUE                   06620009
066300             ADD +1 TO PV-EVENT-DTL-SELECT-COUNT                  06630009
066400             ADD +1 TO PV-SU-EVENT-DTL-SELECT-COUNT               06640009
066500         WHEN SQLCODE = +100                                      06650009
066510             SET PS-EXPORT-DETAIL-NOT-FOUND TO TRUE               06651095
066600         WHEN SQLCODE = -904                                      06660009
066700         WHEN SQLCODE = -913                                      06670009
066800         WHEN SQLCODE = -911                                      06680009
066900             CONTINUE                                             06690009
067000         WHEN SQLWARN0 NOT = SPACE                                06700009
067100         WHEN SQLCODE  NOT = ZERO                                 06710009
067200             MOVE '7150-SELECT-SU-EXPORT-DTL'                     06720009
067300                                       TO PV-ABEND-PARAGRAPH      06730009
067400             MOVE 'SELECT'             TO PV-ABEND-OPERATION      06740009
067500             MOVE 'SUT_BUS_EVNT_DTL' TO PV-ABEND-STRUCTURE-1      06750009
067600             MOVE SUT00037-EVNT-EXPRT-ID TO PV-DISPLAY-NUMBER     06760009
067700             STRING 'SUT00037-EVNT-EXPRT-ID= '  PV-DISPLAY-NUMBER 06770009
067800                 DELIMITED BY SIZE INTO PV-ABEND-STRUCTURE-2      06780009
067900             PERFORM 9900-DB2-ABEND                               06790009
068000     END-EVALUATE                                                 06800009
068100     END-PERFORM.                                                 06810009
068200     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      06820009
068300          SQLCODE NOT = ZERO                                      06830009
068400          DISPLAY '**************************************'        06840009
068500          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        06850009
068600          DISPLAY 'OPEN EXTRACT CURSOR    '                       06860009
068700          DISPLAY '**************************************'        06870009
068800          MOVE '7150-SELECT-SU-EXPORT-DTL'                        06880009
068900                                    TO PV-ABEND-PARAGRAPH         06890009
069000          MOVE 'SELECT'             TO PV-ABEND-OPERATION         06900009
069100          MOVE 'SUT_BUS_EVNT_DTL'   TO PV-ABEND-STRUCTURE-1       06910009
069200          MOVE SUT00037-EVNT-EXPRT-ID TO PV-DISPLAY-NUMBER        06920009
069300          STRING 'SUT00037-EVNT-EXPRT-ID= '  PV-DISPLAY-NUMBER    06930009
069400          DELIMITED BY SIZE INTO PV-ABEND-STRUCTURE-2             06940009
069500          PERFORM 9900-DB2-ABEND                                  06950009
069600      END-IF.                                                     06960009
069700                                                                  06970009
069800 7160-SELECT-PC-EXPORT-DTL.                                       06980009
069900                                                                  06990009
070000     PERFORM                                                      07000009
070100         WITH TEST AFTER                                          07010009
070200         VARYING PV-RETRY-COUNT                                   07020009
070300         FROM 1 BY 1                                              07030009
070400         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 07040009
070500            OR  (SQLCODE = +100)                                  07050009
070600            OR  (SQLCODE = +0))                                   07060009
070700     EXEC SQL                                                     07070009
070800         SELECT  DTL_TXT                                          07080009
070900           INTO  :PCT00012-DTL-TXT                                07090009
071000           FROM  PCT_BUS_EVNT_DTL                                 07100009
071100***       WHERE  EVNT_EXPRT_ID    = :PCT00011-EVNT-EXPRT-ID       07110009
071200          WHERE  EVNT_EXPRT_ID    = :SUT00037-EVNT-EXPRT-ID       07120009
071300          WITH UR                                                 07130009
071400     END-EXEC                                                     07140009
071500                                                                  07150009
071600     EVALUATE TRUE                                                07160009
071700         WHEN SQLCODE = ZERO                                      07170009
071800             SET PS-EXPORT-DETAIL-FOUND TO TRUE                   07180009
071900             ADD +1 TO PV-EVENT-DTL-SELECT-COUNT                  07190009
072000             ADD +1 TO PV-PC-EVENT-DTL-SELECT-COUNT               07200009
072100         WHEN SQLCODE = +100                                      07210009
072110             SET PS-EXPORT-DETAIL-NOT-FOUND TO TRUE               07211095
072200         WHEN SQLCODE = -904                                      07220009
072300         WHEN SQLCODE = -913                                      07230009
072400         WHEN SQLCODE = -911                                      07240009
072500             CONTINUE                                             07250009
072600         WHEN SQLWARN0 NOT = SPACE                                07260009
072700         WHEN SQLCODE  NOT = ZERO                                 07270009
072800             MOVE '7160-SELECT-PC-EXPORT-DTL'                     07280009
072900                                       TO PV-ABEND-PARAGRAPH      07290009
073000             MOVE 'SELECT'             TO PV-ABEND-OPERATION      07300009
073100             MOVE 'PCT_BUS_EVNT_DTL' TO PV-ABEND-STRUCTURE-1      07310009
073200             MOVE SUT00037-EVNT-EXPRT-ID TO PV-DISPLAY-NUMBER     07320009
073300             STRING 'SUT00037-EVNT-EXPRT-ID= '  PV-DISPLAY-NUMBER 07330009
073400                 DELIMITED BY SIZE INTO PV-ABEND-STRUCTURE-2      07340009
073500             PERFORM 9900-DB2-ABEND                               07350009
073600     END-EVALUATE                                                 07360009
073700     END-PERFORM.                                                 07370009
073800     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      07380009
073900          SQLCODE NOT = ZERO                                      07390009
074000          DISPLAY '**************************************'        07400009
074100          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        07410009
074200          DISPLAY 'OPEN EXTRACT CURSOR    '                       07420009
074300          DISPLAY '**************************************'        07430009
074400          MOVE '7160-SELECT-PC-EXPORT-DTL'                        07440009
074500                                    TO PV-ABEND-PARAGRAPH         07450009
074600          MOVE 'SELECT'             TO PV-ABEND-OPERATION         07460009
074700          MOVE 'PCT_BUS_EVNT_DTL'   TO PV-ABEND-STRUCTURE-1       07470009
074800          MOVE SUT00037-EVNT-EXPRT-ID TO PV-DISPLAY-NUMBER        07480009
074900          STRING 'SUT00037-EVNT-EXPRT-ID= '  PV-DISPLAY-NUMBER    07490009
075000          DELIMITED BY SIZE INTO PV-ABEND-STRUCTURE-2             07500009
075100          PERFORM 9900-DB2-ABEND                                  07510009
075200      END-IF.                                                     07520009
075300                                                                  07530009
075400 7200-READ-TMST-EXTRACT-FILE.                                     07540009
075500                                                                  07550009
075600     READ SELECT-TMST-EXTRACT-FILE                                07560009
075700       INTO DL012-CONTROL-RECORD                                  07570009
075800           AT END                                                 07580009
075900               SET PS-EOF-SEL-TMST-FILE TO TRUE.                  07590009
076000                                                                  07600009
076100                                                                  07610009
076200 8100-WRITE-EXTRACT-REC.                                          07620009
076300                                                                  07630009
076400     ADD 1 TO PV-EXTRACT-WRITE-COUNT.                             07640009
076500     WRITE EXPORT-EXTRACT-RECORD FROM                             07650009
076600           DL003-EXPORT-RECORD-LAYOUT.                            07660009
076700                                                                  07670009
076800 8200-WRITE-KEY-REC.                                              07680009
076900                                                                  07690009
077000     ADD 1 TO PV-KEY-WRITE-COUNT.                                 07700009
077100     WRITE EXPORT-KEY-RECORD FROM                                 07710009
077200           DL004-EAI-KEY-RECORD-LAYOUT.                           07720009
077300 8300-WRITE-CLOCK-IN-REC.                                         07730009
077400                                                                  07740009
077500     ADD 1 TO PV-KEY-WRITE-COUNT.                                 07750009
077510     WRITE EXPORT-CLOCK-IN-RECORD FROM                            07751009
077520           DL017-ASSOC-STRT-REC-LAYOUT.                           07752009
077530/                                                                 07753009
077540 9000-TERMINATE.                                                  07754009
077550                                                                  07755009
077560     PERFORM 7020-CLOSE-EXPORT-CSR.                               07756009
077570                                                                  07757009
077580     CLOSE SELECT-TMST-EXTRACT-FILE                               07758009
077590           EXPORT-EXTRACT-FILE                                    07759009
077600           EXPORT-KEY-FILE                                        07760009
077700           EXPORT-CLOCK-IN-FILE.                                  07770009
077800                                                                  07780009
077900**** IF  PV-EVENT-FETCH-COUNT = 0                                 07790009
078000     IF  PV-EXTRACT-WRITE-COUNT = 0                               07800009
078100         MOVE 1 TO RETURN-CODE                                    07810009
078200     END-IF.                                                      07820009
078300                                                                  07830009
078400     DISPLAY '************************'.                          07840009
078500     DISPLAY '******* DLKUT995 *******'.                          07850009
078600     DISPLAY '************************'.                          07860009
078700     DISPLAY SPACES                                               07870009
078800                                                                  07880009
078900     MOVE PV-EVENT-FETCH-COUNT        TO PV-DISPLAY-COUNT.        07890009
079000     DISPLAY 'TOTAL BUS EVENTS FETCHED      = ' PV-DISPLAY-COUNT. 07900009
079100                                                                  07910009
079200     MOVE PV-SU-EVENT-FETCH-COUNT     TO PV-DISPLAY-COUNT.        07920009
079300     DISPLAY 'TOTAL SU BUS EVENTS FETCHED   = ' PV-DISPLAY-COUNT. 07930009
079400                                                                  07940009
079500     MOVE PV-PC-EVENT-FETCH-COUNT     TO PV-DISPLAY-COUNT.        07950009
079600     DISPLAY 'TOTAL PC BUS EVENTS FETCHED   = ' PV-DISPLAY-COUNT. 07960009
079700                                                                  07970009
079800     MOVE PV-EVENT-DTL-SELECT-COUNT   TO PV-DISPLAY-COUNT.        07980009
079900     DISPLAY 'TOTAL EVENT DTLS SELECTED     = ' PV-DISPLAY-COUNT. 07990009
080000                                                                  08000009
080100     MOVE PV-SU-EVENT-DTL-SELECT-COUNT TO PV-DISPLAY-COUNT.       08010009
080200     DISPLAY 'TOTAL SU EVENT DTLS SELECTED  = ' PV-DISPLAY-COUNT. 08020009
080300                                                                  08030009
080400     MOVE PV-PC-EVENT-DTL-SELECT-COUNT TO PV-DISPLAY-COUNT.       08040009
080500     DISPLAY 'TOTAL PC EVENT DTLS SELECTED  = ' PV-DISPLAY-COUNT. 08050009
080600                                                                  08060009
080700     MOVE PV-EXTRACT-WRITE-COUNT       TO PV-DISPLAY-COUNT.       08070009
080800     DISPLAY 'TOTAL EXTRACT RECORDS WRITTEN = ' PV-DISPLAY-COUNT. 08080009
080900                                                                  08090009
081000     MOVE PV-KEY-WRITE-COUNT           TO PV-DISPLAY-COUNT.       08100009
081100     DISPLAY 'TOTAL KEY RECORDS WRITTEN     = ' PV-DISPLAY-COUNT. 08110009
081200                                                                  08120009
081300     DISPLAY SPACES                                               08130009
081400     DISPLAY '************************'.                          08140009
081500                                                                  08150009
081600                                                                  08160009
081700 9900-DB2-ABEND.                                                  08170009
081800                                                                  08180009
081900     MOVE SQLCODE TO PV-SQLCODE.                                  08190009
082000     DISPLAY '*** DB2 ERROR '.                                    08200009
082100     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       08210009
082200     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08220009
082300     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08230009
082400     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08240009
082500     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08250009
082600     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08260009
082700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       08270009
082800     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             08280009
082900                                                                  08290009
083000     IF PV-ABEND-STRUCTURE-2 > SPACES                             08300009
083100         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          08310009
083200     END-IF.                                                      08320009
083300                                                                  08330009
083400                                                                  08340009
083500     COPY DPPD004.                                                08350009
083600                                                                  08360009
083700     MOVE +4013                  TO PV-ABEND-CODE.                08370009
083800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08380009
083900                                                                  08390009
084000 9950-NON-SQL-ABEND.                                              08400009
084100******************************************************************08410009
084200*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       08420009
084300******************************************************************08430009
084400     DISPLAY '***************************'.                       08440009
084500     DISPLAY '**       ABEND           **'.                       08450009
084600     DISPLAY '**  IN PROGRAM DLKUT995  **'.                       08460009
084700     DISPLAY '***************************'.                       08470009
084800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08480009
084900     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       08490009
085000     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       08500009
085100*                                                                 08510009
085200     MOVE +4014                  TO PV-ABEND-CODE.                08520009
085300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08530009
085400                                                                  08540009
