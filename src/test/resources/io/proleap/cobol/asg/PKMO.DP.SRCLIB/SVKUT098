000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         SVKUT098.                                    00020007
000300 AUTHOR.             COGNIZANT.                                   00030006
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       OCT 2012.                                    00050006
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070006
000800*REQUIREMENT   : PAYMENT RELATED CHANGES FOR FSH PROJECT          00080006
000900*PROJECT ID    : W3540C                                           00090006
001000*AUTHOR        : COGNIZANT                                        00100006
001100*DATE WRITTEN  : 15-OCT-2012                                      00110006
001200*DESCRIPTION   : THE PROGRAM CREATES THE CURRENT AND PREVIOUS     00120015
001300*                PROCESSING DATES BASED ON THE SCHEDULE DATE      00130015
001400*                RECEIVED FROM THE JOB AND SVCC000 CONTROL CARD   00140015
001500*                                                                 00150015
001600******************************************************************00160006
001700 ENVIRONMENT DIVISION.                                            00170000
001800******************************************************************00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.    IBM-3090.                                    00210000
002200 OBJECT-COMPUTER.    IBM-3090.                                    00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT CONTROL-DATE-FILE ASSIGN  TO INP01                    00280018
002900                 FILE STATUS IS FS-FILE-STATUS.                   00281018
003000                                                                  00290000
003100******************************************************************00300000
003200 DATA DIVISION.                                                   00310000
003300******************************************************************00320000
003400                                                                  00330000
003500 FILE SECTION.                                                    00340000
003600                                                                  00350000
003700 FD  CONTROL-DATE-FILE                                            00360000
003800     RECORDING MODE IS F                                          00370000
003900     BLOCK CONTAINS 0 RECORDS                                     00380000
004000     LABEL RECORDS ARE OMITTED.                                   00390000
004100                                                                  00400000
004200 01  CONTROL-DATE-RECORD              PIC  X(80).                 00410000
004300                                                                  00420000
004400 WORKING-STORAGE SECTION.                                         00430000
004500                                                                  00440000
004600******************************************************************00450011
004700*    DATE ROUTINE COPY MEMBERS                                   *00460011
004800******************************************************************00470011
004900     COPY DPWS500.                                                00480011
005000                                                                  00490011
005100 01  SD-SCHEDULE-DATE.                                            00500000
005200     05  SD-CC                        PIC  X(02).                 00510000
005300     05  SD-YY                        PIC  X(02).                 00520000
005400     05  SD-MM                        PIC  X(02).                 00530000
005500     05  SD-DD                        PIC  X(02).                 00540000
005600                                                                  00550000
005700 01  CR-CONTROL-RECORD.                                           00560000
005800     05  CR-CURRENT-DATE.                                         00570000
005900         10  CR-CURRENT-CC            PIC  9(02) VALUE ZEROES.    00580000
006000         10  CR-CURRENT-YY            PIC  9(02) VALUE ZEROES.    00590000
006100         10  CR-CURRENT-MM            PIC  9(02) VALUE ZEROES.    00600000
006200         10  CR-CURRENT-DD            PIC  9(02) VALUE ZEROES.    00610000
006300     05  FILLER                       PIC  X(01).                 00620000
006400     05  CR-PREVIOUS-DATE.                                        00630000
006500         10  CR-PREVIOUS-CC           PIC  9(02) VALUE ZEROES.    00640000
006600         10  CR-PREVIOUS-YY           PIC  9(02) VALUE ZEROES.    00650000
006700         10  CR-PREVIOUS-MM           PIC  9(02) VALUE ZEROES.    00660000
006800         10  CR-PREVIOUS-DD           PIC  9(02) VALUE ZEROES.    00670000
006900     05  FILLER                       PIC  X(63).                 00680000
007000                                                                  00690000
007100 01  PS-PROGRAM-SWITCHES.                                         00700000
007200     05  PS-END-OF-CONTROL-FILE-SW    PIC  X(01) VALUE 'N'.       00710000
007300         88  PS-END-OF-CONTROL-FILE              VALUE 'Y'.       00720000
007400                                                                  00730000
007500 01 ABEND-CODE                        PIC S9(04) COMP VALUE ZERO. 00740025
007600 01 FS-FILE-STATUS                    PIC  X(02).                 00741018
007700 01 PV-PROGRAM-NAME                   PIC  X(08) VALUE 'SVKUT098'.00750018
007800                                                                  00760002
007900 01 PV-PROGRAM-VARIABLES.                                         00761033
008000    05 PV-CURRENT-DATE                PIC  X(18)                  00762033
008100                                      VALUE 'CURRENT PROCESSING'. 00763033
008200    05 PV-PREVIOUS-DATE               PIC  X(19)                  00764033
008300                                      VALUE 'PREVIOUS PROCESSING'.00765033
008400    05 PV-SCHEDULE-DATE               PIC  X(08)                  00766033
008500                                      VALUE 'SCHEDULE'.           00767033
008600    05 PV-DATE                        PIC  X(19) VALUE SPACES.    00768035
008700                                                                  00769033
008800 LINKAGE SECTION.                                                 00770000
008900 01  PARM-IN.                                                     00780000
009000     05  PARM-LEN                     PIC S9(04) COMP.            00790000
009100     05  PARM-DATA                    PIC  X(08).                 00800000
009200                                                                  00810000
009300******************************************************************00820002
009400 PROCEDURE DIVISION USING PARM-IN.                                00830000
009500******************************************************************00840002
009600                                                                  00850000
009700 0000-MAINLINE.                                                   00860000
009800                                                                  00870000
009900      PERFORM 1000-INITIALIZE.                                    00880000
010000                                                                  00890045
010100      IF PS-END-OF-CONTROL-FILE                                   00900000
010200         DISPLAY '** ABEND **'                                    00910017
010300         DISPLAY '** PROGRAM = ' PV-PROGRAM-NAME ' **'            00920034
010400         DISPLAY '** PARAGRAPH = 0000-MAINLINE **'                00930017
010500         DISPLAY '** CONTROL CARD IS EMPTY **'                    00940017
010600         MOVE +4003                   TO ABEND-CODE               00950024
010700         CALL 'ILBOABN0' USING ABEND-CODE                         00960017
010800      END-IF.                                                     00970015
010900                                                                  00980015
011000      MOVE CONTROL-DATE-RECORD        TO CR-CONTROL-RECORD.       00990018
011100      CLOSE CONTROL-DATE-FILE.                                    00991027
011200                                                                  00992027
011300      PERFORM 2000-VALIDATE-INPUT-DATES.                          01000017
011400                                                                  01001027
012700      MOVE CR-CURRENT-DATE            TO CR-PREVIOUS-DATE.        01010018
012800      MOVE SD-SCHEDULE-DATE           TO CR-CURRENT-DATE.         01020018
012900                                                                  01020127
011500      IF CR-CURRENT-DATE = CR-PREVIOUS-DATE                       01020248
011600         DISPLAY '** ABEND **'                                    01020348
011700         DISPLAY '** PROGRAM = ' PV-PROGRAM-NAME ' **'            01020448
011800         DISPLAY '** PARAGRAPH = 0000-MAINLINE **'                01020548
011900         DISPLAY '** JOB HAS BEEN EXECUTED FOR SECOND TIME'       01020648
012000                 ' ON THE SAME DAY **'                            01020748
012100         DISPLAY '** CURRENT & PREVIOUS PROCESSING '              01020848
012200                 'DATE SHOULD NOT BE THE SAME **'                 01020948
012300         MOVE +4019                   TO ABEND-CODE               01021048
012400         CALL 'ILBOABN0' USING ABEND-CODE                         01021148
012500      END-IF.                                                     01021248
012600                                                                  01021348
013000      OPEN OUTPUT CONTROL-DATE-FILE.                              01022028
013100      WRITE CONTROL-DATE-RECORD FROM CR-CONTROL-RECORD.           01030027
013200                                                                  01030117
013300      IF FS-FILE-STATUS = '00'                                    01031020
013400         DISPLAY '** PROCESS DATE HAS BEEN UPDATED SUCCESSFULLY'  01032133
013500                 ' IN THE CONTROL CARD '                          01032239
013600         DISPLAY '   WITH THE CONTROL DATE: ' CR-CURRENT-DATE     01032340
013700                 ' ' CR-PREVIOUS-DATE ' **'                       01032440
013800      ELSE                                                        01033017
013900         DISPLAY '** ABEND **'                                    01033117
014000         DISPLAY '** PROGRAM = ' PV-PROGRAM-NAME ' **'            01033234
014100         DISPLAY '** PARAGRAPH = 0000-MAINLINE **'                01033317
014200         DISPLAY '** ERROR IN WRITE      **'                      01033429
014300         MOVE +4001                   TO ABEND-CODE               01033524
014400         CALL 'ILBOABN0' USING ABEND-CODE                         01033617
014500      END-IF.                                                     01033717
014600                                                                  01034017
014700      CLOSE CONTROL-DATE-FILE.                                    01040015
014800                                                                  01050000
014900      GOBACK.                                                     01060000
015000                                                                  01070000
015100 1000-INITIALIZE.                                                 01080000
015200                                                                  01090000
015300      INITIALIZE SD-SCHEDULE-DATE                                 01100015
015400                 CR-CONTROL-RECORD                                01110019
015500                 FS-FILE-STATUS.                                  01110119
015600                                                                  01111017
015700      MOVE PARM-DATA                  TO SD-SCHEDULE-DATE.        01120018
015800      OPEN INPUT CONTROL-DATE-FILE.                               01130027
015900                                                                  01131017
016000      READ CONTROL-DATE-FILE                                      01140000
016100        AT END                                                    01150000
016200           SET PS-END-OF-CONTROL-FILE TO TRUE.                    01160018
016300                                                                  01170000
016400 2000-VALIDATE-INPUT-DATES.                                       01180015
016500                                                                  01190000
016600******************************************************************01200011
016700*  VERIFY THE CONTROL DATE IS VALID.                             *01210011
016800******************************************************************01220011
016900                                                                  01230011
017000     PERFORM 2100-INITIALIZE-DPWS500.                             01240015
017100     MOVE CR-CURRENT-DATE             TO DPG52-LK-DATE-INPUT.     01250018
017200     MOVE PV-CURRENT-DATE             TO PV-DATE.                 01251033
017300     PERFORM 2200-CALL-CALENDAR-ROUTINE.                          01260015
017400                                                                  01270011
017500     PERFORM 2100-INITIALIZE-DPWS500.                             01280015
017600     MOVE CR-PREVIOUS-DATE            TO DPG52-LK-DATE-INPUT.     01290018
017700     MOVE PV-PREVIOUS-DATE            TO PV-DATE.                 01291033
017800     PERFORM 2200-CALL-CALENDAR-ROUTINE.                          01300015
017900                                                                  01310013
018000     PERFORM 2100-INITIALIZE-DPWS500.                             01320015
018100     MOVE SD-SCHEDULE-DATE            TO DPG52-LK-DATE-INPUT.     01330018
018200     MOVE PV-SCHEDULE-DATE            TO PV-DATE.                 01331033
018300     PERFORM 2200-CALL-CALENDAR-ROUTINE.                          01340015
018400                                                                  01350015
018500 2100-INITIALIZE-DPWS500.                                         01360015
018600                                                                  01370015
018700     INITIALIZE DPG51 DPG52 DPG53                                 01380015
018800                DPG54 DPG55 DPG56.                                01390015
018900     SET DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                    01400032
019000     SET DPG52-LK-DTE-ISO             TO TRUE.                    01420018
019100                                                                  01430015
019200 2200-CALL-CALENDAR-ROUTINE.                                      01440015
019300                                                                  01450015
019400     CALL DP500-KOHLS-CALENDAR-ROUTINE                            01460015
019500       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 01470015
019600                                                                  01480015
019700     EVALUATE TRUE                                                01490013
019800       WHEN DPG54-SEVERE-ERROR                                    01500013
019900       WHEN DPG54-DATE-INVALID                                    01510013
020000         DISPLAY '** ABEND     **'                                01530013
020100         DISPLAY '** PROGRAM   ** = ' PV-PROGRAM-NAME ' **'       01540034
020200         DISPLAY '** PARAGRAPH ** = 2200-CALL-CALENDAR-ROUTINE **'01550033
020300         DISPLAY '** BAD CALL TO CALENDAR MODULE **'              01560033
020400         DISPLAY '** FOR ' PV-DATE ' DATE: ' DPG52-LK-DATE-INPUT  01561036
020500         DISPLAY '** DETERMINE VALID DATE **'                     01570013
020600         DISPLAY '** ' DPG54-ERROR-MESSAGE ' **'                  01580034
020700         MOVE +4019                   TO ABEND-CODE               01590018
020800         CALL 'ILBOABN0' USING ABEND-CODE                         01600013
020900       WHEN DPG54-DATE-VALID                                      01601033
021000       WHEN DPG54-NO-ERROR                                        01601133
021100         DISPLAY '** VALIDATED ' PV-DATE                          01601333
021200                 ' DATE: ' DPG52-LK-DATE-INPUT '**'               01601441
021300     END-EVALUATE.                                                01610013
