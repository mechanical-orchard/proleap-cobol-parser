000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TXKUT914.                                00050040
000600 AUTHOR.                 GREGORY B SHEFF.                         00060041
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           APRIL 2003.                              00080024
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001110*                                                                 00111058
001120*  THE ITEM FILE MUST FIRST BE SORTED BY STATE CODE AND INTERNAL  00112059
001130*  UPC ID.                                                        00113059
001140*                                                                 00114059
001150*  THIS PROGRAM CREATES THE ITEM TAXABILITY CHANGE FILE.  THE     00115059
001160*  PROGRAM COMPARES THE FILE CREATED TODAY WITH THE FILE CREATED  00116059
001170*  YESTERDAY TO IDENTIFY ITEMS WITH A CHANGED TAXABILITY          00117059
001180*  INDICATOR.                                                     00118059
001600*                                                                 00160000
001910******************************************************************00191009
002200 ENVIRONMENT DIVISION.                                            00220000
002300******************************************************************00230000
002400                                                                  00240000
002500 CONFIGURATION SECTION.                                           00250000
002600                                                                  00260000
002700 SOURCE-COMPUTER.    IBM-3090.                                    00270000
002800 OBJECT-COMPUTER.    IBM-3090.                                    00280000
002900                                                                  00290000
003000 INPUT-OUTPUT SECTION.                                            00300000
003100                                                                  00310000
003200 FILE-CONTROL.                                                    00320000
003300                                                                  00330000
003700     SELECT PREV-TAX-FILE                                         00370040
003800         ASSIGN TO INP01.                                         00380032
003900                                                                  00390000
003910     SELECT CURR-TAX-FILE                                         00391059
003920         ASSIGN TO INP02.                                         00392032
003930                                                                  00393032
004000     SELECT UPDATED-TAX-FILE                                      00400040
004100         ASSIGN TO OUT01.                                         00410000
004200                                                                  00420000
004300******************************************************************00430000
004400 DATA DIVISION.                                                   00440000
004500******************************************************************00450000
004600                                                                  00460000
004700 FILE SECTION.                                                    00470000
004800                                                                  00480000
005600                                                                  00560000
005700 FD  PREV-TAX-FILE                                                00570040
005800     RECORDING MODE IS F                                          00580000
005900     LABEL RECORDS ARE STANDARD                                   00590000
006000     BLOCK CONTAINS 0 RECORDS                                     00600000
006100     RECORD CONTAINS 60 CHARACTERS.                               00610060
006200                                                                  00620000
006300 01  PREV-TAX-RECORD          PIC X(60).                          00630060
006400                                                                  00640000
006500 FD  CURR-TAX-FILE                                                00650040
006600     RECORDING MODE IS F                                          00660000
006700     LABEL RECORDS ARE STANDARD                                   00670000
006800     BLOCK CONTAINS 0 RECORDS                                     00680000
006900     RECORD CONTAINS 60 CHARACTERS.                               00690060
007000                                                                  00700000
007100 01  CURR-TAX-RECORD       PIC X(60).                             00710060
007200                                                                  00720000
007210 FD  UPDATED-TAX-FILE                                             00721040
007220     RECORDING MODE IS F                                          00722033
007230     LABEL RECORDS ARE STANDARD                                   00723033
007240     BLOCK CONTAINS 0 RECORDS                                     00724033
007250     RECORD CONTAINS 60 CHARACTERS.                               00725060
007260                                                                  00726033
007270 01  UPDATED-TAX-RECORD   PIC X(60).                              00727060
007280                                                                  00728033
007290******************************************************************00729047
007300 WORKING-STORAGE SECTION.                                         00730000
007400******************************************************************00740047
010100                                                                  01010000
010200 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01020000
010300                                                  COMP SYNC.      01030000
010520     88  AC-INVALID-DATA                          VALUE +4008.    01052038
010600                                                                  01060000
011000 01  PS-PROGRAM-SWITCHES.                                         01100000
011100     05  PS-END-OF-PREV-TAX-FILE-SW           PIC X(1)  VALUE 'N'.01110040
011300         88  PS-NOT-END-OF-PREV-TAX-FILE                VALUE 'N'.01130040
011400         88  PS-END-OF-PREV-TAX-FILE                    VALUE 'Y'.01140040
011410                                                                  01141034
011500     05  PS-END-OF-CURR-TAX-FILE-SW           PIC X(1)  VALUE 'N'.01150040
011700         88  PS-END-OF-CURR-TAX-FILE                    VALUE 'Y'.01170040
012140                                                                  01214028
012200 01  PC-PROGRAM-CONSTANTS.                                        01220000
012300     05  PC-PROGRAM-NAME                                          01230052
012310                                 PIC X(8)        VALUE 'TXKUT914'.01231040
012400                                                                  01240000
012500 01  PV-PROGRAM-VARIABLES.                                        01250000
012600     05  PV-PARAGRAPH-NAME       PIC   X(30)        VALUE SPACE.  01260000
012601     05  PV-OPERATION-MSG-1      PIC   X(40)        VALUE SPACE.  01260139
012602     05  PV-OPERATION-MSG-2      PIC   X(40)        VALUE SPACE.  01260239
012604                                                                  01260440
012610     05  PV-DISPLAY-PREV-CNT     PIC ZZZ,ZZZ,ZZ9-.                01261040
012611     05  PV-DISPLAY-CURR-CNT     PIC ZZZ,ZZZ,ZZ9-.                01261140
012612     05  PV-DISPLAY-OUT-CNT      PIC ZZZ,ZZZ,ZZ9-.                01261233
012613                                                                  01261333
012614     05  PV-TAX-PREV-KEY.                                         01261445
012617         10  PV-PREV-STATE-CODE          PIC  X(2).               01261740
012618         10  PV-PREV-INTR-UPC-ID         PIC S9(12) COMP-3.       01261862
012620                                                                  01262026
012623     05  PV-TAX-CURR-KEY.                                         01262345
012627         10  PV-CURR-STATE-CODE          PIC  X(2).               01262740
012628         10  PV-CURR-INTR-UPC-ID         PIC S9(12) COMP-3.       01262862
012631                                                                  01263138
012635 01  PA-PROGRAM-ACCUMULATORS.                                     01263526
012640     05  PA-TAX-PREV-CNT                 PIC S9(9) COMP-3         01264045
012650                                             VALUE ZERO.          01265026
012660     05  PA-TAX-CURR-CNT                 PIC S9(9) COMP-3         01266045
012670                                             VALUE ZERO.          01267033
014100     05  PA-WRITTEN-OUT-CNT              PIC S9(9) COMP-3         01410044
014200                                             VALUE ZERO.          01420000
014300     05  PA-NEW-REC-CNT                  PIC S9(9) COMP-3         01430044
014400                                             VALUE ZERO.          01440044
014411     05  PA-UPDATED-REC-CNT              PIC S9(9) COMP-3         01441144
014420                                             VALUE ZERO.          01442044
014500                                                                  01450000
014510***************************************************************** 01451025
014520*  CURR TAX EXTRACT FILE                                          01452040
014530***************************************************************** 01453025
014540     COPY TXRD911 REPLACING 'TX911-' BY 'TX911C-'.                01454051
014541                                                                  01454128
014550***************************************************************** 01455025
014560*  PREV TAX EXTRACT FILE                                          01456049
014570***************************************************************** 01457025
014571     COPY TXRD911 REPLACING 'TX911-' BY 'TX911P-'.                01457151
014700                                                                  01470028
016100******************************************************************01610000
016200 PROCEDURE DIVISION.                                              01620000
016300******************************************************************01630000
016400 0000-MAINLINE.                                                   01640000
016500                                                                  01650000
016600     PERFORM 1000-INITIALIZE.                                     01660000
016700                                                                  01670000
017400     PERFORM 2000-PROCESS-TAX-RECS                                01740045
017500             UNTIL PS-END-OF-CURR-TAX-FILE.                       01750040
017600                                                                  01760000
018200     PERFORM 9000-EOJ-ROUTINE.                                    01820000
018300                                                                  01830000
018400     GOBACK.                                                      01840000
018500                                                                  01850000
018600******************************************************************01860000
018610* 1000-INITIALIZE.                                                01861047
018700* OPEN ALL FILES, READ FIRST RECORD FROM EACH FILE                01870047
018800******************************************************************01880000
018900 1000-INITIALIZE.                                                 01890000
019000                                                                  01900033
019200     OPEN INPUT  PREV-TAX-FILE                                    01920040
019210                 CURR-TAX-FILE                                    01921040
019300          OUTPUT UPDATED-TAX-FILE.                                01930040
023810                                                                  02381038
023900     PERFORM 7000-READ-PREV-TAX-FILE.                             02390040
024000     PERFORM 7100-READ-CURR-TAX-FILE.                             02400040
024100                                                                  02410038
032612******************************************************************03261226
032613* 2000-PROCESS-TAX-RECS.                                          03261347
032614* CONVERT TAX DATA                                               *03261445
032615******************************************************************03261526
032616 2000-PROCESS-TAX-RECS.                                           03261645
032617                                                                  03261726
032618     IF PV-TAX-PREV-KEY = PV-TAX-CURR-KEY                         03261845
032619        PERFORM 2100-RECORDS-MATCH                                03261938
032623     ELSE                                                         03262333
032624        IF PV-TAX-PREV-KEY > PV-TAX-CURR-KEY                      03262445
032625           PERFORM 2200-MISSING-PREV-REC                          03262540
032628        ELSE                                                      03262833
032641           IF PS-NOT-END-OF-PREV-TAX-FILE                         03264149
032644              PERFORM 7000-READ-PREV-TAX-FILE                     03264440
032645           END-IF                                                 03264538
032646        END-IF                                                    03264638
032647     END-IF.                                                      03264738
032648                                                                  03264838
032653******************************************************************03265336
032654* 2100-RECORDS-MATCH                                              03265447
032655* IF PARM CODE CHANGED SET REC TYPE TO 'U'                        03265547
032656******************************************************************03265636
032657 2100-RECORDS-MATCH.                                              03265738
032658                                                                  03265836
032675     IF TX911P-TX-PARM-CDE NOT = TX911C-TX-PARM-CDE               03267549
032676        MOVE 'U' TO TX911C-REC-TYPE                               03267649
032679        ADD +1 TO PA-UPDATED-REC-CNT                              03267944
032680        PERFORM 8000-WRITE-UPDATE-REC                             03268048
032686     END-IF.                                                      03268644
032687                                                                  03268738
032689     PERFORM 7000-READ-PREV-TAX-FILE.                             03268949
032697     PERFORM 7100-READ-CURR-TAX-FILE.                             03269749
032699                                                                  03269940
032701******************************************************************03270138
032702* 2200-MISSING-PREV-REC                                           03270247
032703* SET REC TYPE TO 'N'                                             03270347
032704******************************************************************03270438
032705 2200-MISSING-PREV-REC.                                           03270540
032727                                                                  03272738
032729     MOVE 'N' TO TX911C-REC-TYPE.                                 03272949
032730     ADD +1 TO PA-NEW-REC-CNT.                                    03273045
032740                                                                  03274040
032746     PERFORM 8000-WRITE-UPDATE-REC.                               03274640
032747                                                                  03274740
032752     PERFORM 7100-READ-CURR-TAX-FILE.                             03275249
032754                                                                  03275440
032755******************************************************************03275526
032756* 7000-READ-PREV-TAX-FILE.                                        03275647
032757* READ A PREV DAY'S TAX RECORD                                    03275747
032758******************************************************************03275826
032759 7000-READ-PREV-TAX-FILE.                                         03275940
032760                                                                  03276026
032761     READ PREV-TAX-FILE                                           03276140
032762         INTO TX911P-TAX-ITEM-RECORD                              03276249
032763         AT END                                                   03276326
032764             SET PS-END-OF-PREV-TAX-FILE TO TRUE                  03276440
032765             MOVE HIGH-VALUES TO PV-TAX-PREV-KEY                  03276549
032766         NOT AT END                                               03276626
032767             ADD +1 TO PA-TAX-PREV-CNT                            03276745
032768             MOVE TX911P-INTR-UPC-ID TO PV-PREV-INTR-UPC-ID       03276859
032769             MOVE TX911P-STATE-CODE TO PV-PREV-STATE-CODE         03276949
032770     END-READ.                                                    03277026
032771                                                                  03277126
032772******************************************************************03277233
032773* 7100-READ-CURR-TAX-FILE.                                        03277347
032774* READ A CURR DAY'S TAX RECORD                                    03277447
032775******************************************************************03277533
032776 7100-READ-CURR-TAX-FILE.                                         03277640
032777                                                                  03277733
032778     READ CURR-TAX-FILE                                           03277840
032779         INTO TX911C-TAX-ITEM-RECORD                              03277949
032780         AT END                                                   03278033
032781             SET PS-END-OF-CURR-TAX-FILE TO TRUE                  03278140
032782         NOT AT END                                               03278233
032783             ADD +1 TO PA-TAX-CURR-CNT                            03278345
032784             MOVE TX911C-INTR-UPC-ID TO PV-CURR-INTR-UPC-ID       03278459
032785             MOVE TX911C-STATE-CODE TO PV-CURR-STATE-CODE         03278549
032786     END-READ.                                                    03278633
032787                                                                  03278736
032790******************************************************************03279000
032791* 8000-WRITE-UPDATE-REC.                                          03279147
032800* WRITE AN UPDATED ITEM RECORD                                   *03280047
032900******************************************************************03290000
033000 8000-WRITE-UPDATE-REC.                                           03300026
033100                                                                  03310000
033200     WRITE UPDATED-TAX-RECORD                                     03320040
033300           FROM TX911C-TAX-ITEM-RECORD.                           03330049
033310     ADD +1 TO PA-WRITTEN-OUT-CNT.                                03331044
033400                                                                  03340000
033500******************************************************************03350000
033510* 9000-EOJ-ROUTINE.                                               03351047
033600* DISPLAY TOYTALS AND CLOSE ALL FILES                             03360047
033700******************************************************************03370000
033800 9000-EOJ-ROUTINE.                                                03380000
033900                                                                  03390033
033901     DISPLAY 'PROGRAM : ' PC-PROGRAM-NAME.                        03390152
033902                                                                  03390252
033910     MOVE PA-TAX-PREV-CNT TO PV-DISPLAY-PREV-CNT.                 03391045
033920     DISPLAY 'PREV TAX RECORDS READ   : '                         03392045
033930             PV-DISPLAY-PREV-CNT.                                 03393040
033931                                                                  03393126
033932     MOVE PA-TAX-CURR-CNT TO PV-DISPLAY-CURR-CNT.                 03393245
033933     DISPLAY 'CURR TAX RECORDS READ   : '                         03393345
033934             PV-DISPLAY-CURR-CNT.                                 03393440
033935                                                                  03393533
033936     MOVE PA-WRITTEN-OUT-CNT TO PV-DISPLAY-OUT-CNT.               03393644
033937     DISPLAY 'TOTAL ITEM RECORDS WRITTEN  : '                     03393744
033938             PV-DISPLAY-OUT-CNT.                                  03393833
033941                                                                  03394144
033942     MOVE PA-NEW-REC-CNT TO PV-DISPLAY-OUT-CNT.                   03394244
033943     DISPLAY 'NEW ITEM RECORDS WRITTEN    : '                     03394344
033944             PV-DISPLAY-OUT-CNT.                                  03394444
033945                                                                  03394544
033946     MOVE PA-UPDATED-REC-CNT TO PV-DISPLAY-OUT-CNT.               03394644
033947     DISPLAY 'UPDATED ITEM RECORDS WRITTEN: '                     03394744
033948             PV-DISPLAY-OUT-CNT.                                  03394844
033950                                                                  03395026
034000     CLOSE PREV-TAX-FILE                                          03400040
034100           CURR-TAX-FILE                                          03410040
034110           UPDATED-TAX-FILE.                                      03411040
034200                                                                  03420000
035400******************************************************************03540039
035500* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           03550039
035600******************************************************************03560039
035700*9999-ABEND.                                                      03570049
035800*    DISPLAY '** ABEND           **'.                             03580049
035900*    DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  03590049
036000*    DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        03600049
036100*    DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       03610049
036200*    DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       03620049
036300*    CALL 'ILBOABN0' USING AC-ABEND-CODE.                         03630049
