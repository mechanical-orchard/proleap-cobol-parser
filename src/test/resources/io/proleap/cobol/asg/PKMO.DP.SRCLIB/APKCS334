000100*-----------------------*                                         00010008
000200 IDENTIFICATION DIVISION.                                         00020008
000300*-----------------------*                                         00030008
000400 PROGRAM-ID.    APKCS334.                                         00040008
000500 AUTHOR.        KOHLS.                                            00050008
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060008
000700 DATE-WRITTEN.  06-07-94.                                         00070008
000800 DATE-COMPILED.                                                   00080008
000900                                                                  00090008
001000*--------------------------------------------------------------*  00100020
001100* A334 - NON-INVOICED RECEIPT LIST                             *  00110020
001200*                                                              *  00120020
001300* THIS PROGRAM DISPLAYS A LIST OF NON-INVOICED RECEIPTS        *  00130020
001400* SELECTED FROM THE CRITERIA SPEC SCREEN (A324).  THIS         *  00140020
001500* IS A NON-SELECTABLE LIST PROGRAM.                            *  00150020
001700*---------------------------------------------------------------* 00170008
002000* CHANGE LOG:                                                   * 00200008
002100*                                                               * 00210008
002200* 01/10/95    BMW  ADDED CODE TO ALSO CLEAR OUT THE PO LINE NBR * 00220008
002300*                  AND CREATE DATE WHEN THERE IS NO DATA TO     * 00230008
002400*                  DISPLAY FOR A LINE.  SEE PARA 4420-          * 00240008
002500*                  ALSO CHANGED ORDER BY ON RECEIPT-CSR TO      * 00250008
002600*                  FIRST SORT BY STATUS CODE                    * 00260008
002900*                                                               * 00290008
003000*    PAUL KEBER - STRATAGEM    03/10/95    WR#: 3259            * 00300008
003100*    CHANGED SCREEN TO DISPLAY EXTENDED COST TOTALS BY STATUS,  * 00310008
003200*    TO REPLACE RECEIPT LINE N/I SEQ# WITH STYLE NUMBER, AND TO * 00320008
003300*    ALLOW THE USE OF PFKEYS 22 AND 23 TO SORT RECEIPT LINES    * 00330008
003400*    BY STYLE NUMBER (RECEIPT_STYLE_CSR) OR BY PO LINE NUMBER   * 00340008
003500*    (RECEIPT_POLN_CSR).                                        * 00350008
003600*                                                               * 00360008
003700*    MARY KING    09/18/95                                      * 00370008
003800*    CHANGED TNINREC JOIN WITH TPURITM TO MATCH ON              * 00380008
003900*    APP_PO_LNE_NBR INSTEAD OF PO_LNE_NBR.                      * 00390008
004000*                                                               * 00400008
004100*    MARY KING    11/15/95                                      * 00410008
004200*    CHANGED TO CALL DPKCS030 STATICALLY RATHER THAN            * 00420008
004300*    DYNAMICALLY. (CHANGED CALL TO USE A LITERAL INSTEAD OF     * 00430008
004400*    A VARIABLE.)  IN 2000, CHANGED TO MOVE REDEFINED ASC-KEY-  * 00440008
004500*    PO-NBR-9 TO AP300-PO-NBR SO DATA TYPES MATCH.              * 00450008
004600*                                                               * 00460008
004700*    03/21/97   MJW - ADDED LOGIC TO PROCESS NEW 'W' CODE IN    * 00470008
004800*                     AP-PROC-CDE.                              * 00480008
004900*                                                               * 00490008
005000*    MIKE BESKE    06/25/97               PITS# 92943           * 00500008
005100*    ADDED A CHECK FOR VALUE OF 'W' FOR NINREC-STATUS-CDE IN THE* 00510008
005200*    4305-CONTINUE-DB-ACCESS PARAGRAPH.  THE VALUE OF 'W' WILL  * 00520008
005300*    BE PROCESSED THE SAME AS THE VALUE OF 'J' IS.              * 00530008
005400*                                                               * 00540008
005500*    MIKE BESKE    04/23/2004             WR# 25805             * 00550009
005600*    INCREASED THE SIZE OF THE STORE NUMBER TO 4 DIGITS AS PART * 00560009
005700*    OF THE STORE CONSTRAINTS PROJECT.                          * 00570009
005800*                                                               * 00580009
005810*    KRYSTEN LEARY   03/11/2007             WR# 21578           * 00581021
005840*    MATCH BY DC -- ADDED PV-DC-NBR TO WORKING STORAGE.         * 00584018
005900*    REPLACED ALL OCCURRENCES OF ASC-VEND-STYL-NAME WITH        * 00590018
005910*    ASC-DC-NBR AND MR-VEND-STYL-NAME WITH MR-DC-NBR.  INCLUDED * 00591018
005920*    A.DC_NBR IN THE SELECT AND FETCH STATEMENTS OF BOTH THE    * 00592018
005930*    RECEIPT_STYLE_CSR AND THE RECEIPT_POLN_CSR CURSORS.  IN    * 00593018
005940*    PARAGRAPH 4305-CONTINUE-DB-ACCESS, POPULATED THE ASC-DC-NBR* 00594018
005950*    WITH THE NINREC-DC-NBR.  ADDED MR-DC-NBR TO THE ZEROING    * 00595018
005960*    PHRASE IN PARAGRAPH 4420-FORMAT-LIST-LINES.  REPLACED ALL  * 00596018
005970*    REFERENCES OF STYLE IN THE APKM334 MAP WITH DC NUMBER.     * 00597019
005980* DATE  09/01/2021                                                00598022
005990*            - CHANGE CALL OF 'DPKUT100' TO                     * 00599022
005991*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00599122
005992*              MAKING THE CALL DYNAMIC VS STATIC                * 00599222
005993*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        00599324
005994* DATE  10/24/2022                                              * 00599425
005995*     ADD COPYBOOK DPWS930                                      * 00599526
005996*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API  * 00599626
005997*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864      * 00599726
006000*---------------------------------------------------------------* 00600011
006100 ENVIRONMENT DIVISION.                                            00610008
006200                                                                  00620008
006300 DATA DIVISION.                                                   00630008
006400                                                                  00640020
006500 WORKING-STORAGE SECTION.                                         00650008
006600                                                                  00660008
006700 01  PC-PROGRAM-CONSTANTS.                                        00670008
006800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00680008
006900                                                    'AP334A  '.   00690008
007000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00700008
007100                                                    'APKM334 '.   00710008
007200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00720008
007300                                                    'APKCS334'.   00730008
007400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00740008
007500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00750008
007600     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00760008
007700     05  PC-A                           PIC  X(01)  VALUE 'A'.    00770008
007800     05  PC-JOURNALIZED                 PIC  X(01)  VALUE 'J'.    00780008
007900     05  PC-WRITE-OFF                   PIC  X(01)  VALUE 'W'.    00790008
008000     05  PC-MATCHED                     PIC  X(01)  VALUE 'M'.    00800008
008100     05  PC-UNMATCHED                   PIC  X(01)  VALUE ' '.    00810008
008200     05  PC-SCREEN-SEQ-DEFAULT          PIC  X(01)  VALUE 'S'.    00820008
008300     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00830008
008400     05  PC-LIST-SCREEN-FORMAT          PIC  X(01)  VALUE '2'.    00840008
008500     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00850008
008600     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    00860008
008700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00870008
008800                                                    COMP SYNC.    00880008
008900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00890008
009000                                                    COMP SYNC.    00900008
009100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00910008
009200                                                    +1000000      00920008
009300                                                    COMP-3.       00930008
009400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00940008
009500                                                    COMP SYNC.    00950008
009600     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00960008
009700                                                     COMP-3.      00970008
009800     05  PC-MAX-NUM-WEEKS               PIC S9(03)  VALUE +3      00980008
009900                                                    COMP-3.       00990008
010000     05  PC-YEAR-99                     PIC  9(2)   VALUE 99.     01000008
010100                                                                  01010008
010200 01  PC-TSYMSG-NUMBERS.                                           01020008
010300     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  01030008
010400     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  01040008
010500     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  01050008
010600     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  01060008
010700     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  01070008
010800     05  PC-TSYMSG-00113                PIC 9(5)    VALUE 00113.  01080008
010900     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  01090008
011000     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  01100008
011100     05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.  01110008
011200     05  PC-TSYMSG-00831                PIC 9(5)    VALUE 00831.  01120008
011300                                                                  01130008
011400 01  PS-PROGRAM-SUBSCRIPTS.                                       01140008
011500     05  PS-SUB                         PIC S9(04)   VALUE +0     01150008
011600                                                     COMP SYNC.   01160008
011700                                                                  01170008
011800 01  PS-PROGRAM-SWITCHES.                                         01180008
011900     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   01190008
012000         88  PS-NO-ERROR                             VALUE 'Y'.   01200008
012100         88  PS-ERROR                                VALUE 'N'.   01210008
012200     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   01220008
012300         88  PS-COMMAREA-VALID                       VALUE 'Y'.   01230008
012400         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   01240008
012500     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   01250008
012600         88  PS-LIST-END                             VALUE 'Y'.   01260008
012700         88  PS-NO-LIST-END                          VALUE 'N'.   01270008
012800     05  PS-START-ITEM-ERROR-SW       PIC  X         VALUE 'Y'.   01280008
012900         88  PS-NO-START-ITEM-ERROR                  VALUE 'Y'.   01290008
013000         88  PS-START-ITEM-ERROR                     VALUE 'N'.   01300008
013100                                                                  01310020
013200 01  PV-PROGRAM-VARIABLES.                                        01320008
013300     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     01330008
013400                                                     COMP SYNC.   01340008
013500     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     01350008
013600                                                     COMP-3.      01360008
013700     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01370008
013800                                                     COMP-3.      01380008
013900     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01390008
014000                                                     COMP-3.      01400008
014100     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01410008
014200                                                     COMP SYNC.   01420008
014300     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01430008
014400                                                     COMP SYNC.   01440008
014500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01450008
014600                                                     COMP SYNC.   01460008
014700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01470008
014800                                                     COMP SYNC.   01480008
014900     05  PV-SQL-SUB                     PIC S9(4)    COMP.        01490008
015000     05  PV-STR-NBR                     PIC S9(4)    VALUE +0.    01500009
015010     05  PV-DC-NBR                      PIC S9(5)    VALUE +0.    01501010
015100     05  PV-ENT-ID                      PIC S9(9)    USAGE COMP.  01510008
015200     05  PV-PO-NBR                      PIC ZZZZZZZZZ.            01520008
015300     05  PV-STATUS-CODE                 PIC X(01)    VALUE SPACE. 01530008
015400                                                                  01540008
015600*--------------------------------------------------------------*  01560020
015700* PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).     *  01570020
015800*--------------------------------------------------------------*  01580020
016000     COPY DPWS030.                                                01600008
016010     COPY DPWS930.                                                01601026
016100                                                                  01610020
016200*--------------------------------------------------------------*  01620020
016300* STANDARD COMMAREA                                            *  01630020
016400*--------------------------------------------------------------*  01640020
016600     COPY DPWS020.                                                01660008
016700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01670008
016800                                                                  01680008
016810*--------------------------------------------------------------*  01681020
016820* INTER-APPLICATION COMMAREA                                   *  01682020
016830*--------------------------------------------------------------*  01683020
017200         10  INTER-APPL-COMM-AREA PIC X(200).                     01720008
017300     COPY APWS300.                                                01730008
017400                                                                  01740008
017500*--------------------------------------------------------------*  01750020
017600*    SPECIFIC COMMMAREA FOR APKCS334.                          *  01760020
017700*--------------------------------------------------------------*  01770020
017800         10  ASC-SPECIFIC-COMMAREA.                               01780008
017900                                                                  01790008
018000             15  ASC-AP-KEY-INFO.                                 01800008
018100                 20  ASC-KEY-PO-NBR                  PIC  X(09).  01810008
018200                 20  ASC-KEY-PO-NBR-9 REDEFINES                   01820008
018300                     ASC-KEY-PO-NBR                  PIC  9(09).  01830008
018400                                                                  01840008
018500             15  ASC-AP-HEADER-INFO.                              01850008
018600                 20  ASC-PO-NBR                      PIC  X(09).  01860008
018700                 20  ASC-VENDOR-NAME                 PIC  X(20).  01870008
018800                 20  ASC-DEPT-NBR                    PIC  X(3).   01880008
018900                 20  ASC-UNMTCHD-TOT-COST            PIC S9(10)V9901890008
019000                                                         COMP-3.  01900008
019100                 20  ASC-MATCHED-TOT-COST            PIC S9(10)V9901910008
019200                                                         COMP-3.  01920008
019300                 20  ASC-JOURNLD-TOT-COST            PIC S9(10)V9901930008
019400                                                         COMP-3.  01940008
019500                                                                  01950008
019600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01960008
019700                 20  ASC-BLOCK-MODIFIED-SW                        01970008
019800                                        PIC X(01).                01980008
019900                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     01990008
020000                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     02000008
020100                                                                  02010008
020200                 20  ASC-ITEM-ARRAY.                              02020008
020300                                                                  02030008
020400                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        02040008
020500                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   02050008
020600                                                     COMP-3.      02060008
020700                         30  ASC-STORE-NBR           PIC  9(04).  02070009
020800                         30  ASC-PO-LNE-NBR          PIC  9(04).  02080008
020900                         30  ASC-DC-NBR              PIC  9(05).  02090010
021000                         30  ASC-NON-INVCD-QTY       PIC  9(07).  02100008
021100                         30  ASC-UNIT-COST-AMT     PIC S9(7)V9(3) 02110008
021200                                                     COMP-3.      02120008
021300                         30  ASC-EXTENDED-COST     PIC S9(10)V99  02130008
021400                                                     COMP-3.      02140008
021500                         30  ASC-CRE-TMST            PIC X(08).   02150008
021600                         30  ASC-STATUS-CODE         PIC X(07).   02160008
021700                                                                  02170008
021800                                                                  02180008
021900             15  ASC-BLK-SUB                         PIC S9(04)   02190008
022000                                                         COMP     02200008
022100                                                         SYNC.    02210008
022200             15  ASC-ITEM-SUB                        PIC S9(04)   02220008
022300                                                         COMP     02230008
022400                                                         SYNC.    02240008
022500             15  ASC-SEL-SUB                         PIC S9(04)   02250008
022600                                                         COMP.    02260008
022700             15  ASC-SEL-ITEM                        PIC S9(04)   02270008
022800                                                         COMP.    02280008
022900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02290008
023000                                                         COMP-3.  02300008
023100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02310008
023200                                                         COMP-3.  02320008
023300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02330008
023400                                                         COMP-3.  02340008
023500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02350008
023600                                                         COMP-3.  02360008
023700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02370008
023800                                                         COMP-3.  02380008
023900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02390008
024000                                                         COMP-3.  02400008
024100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02410008
024200                                                         COMP     02420008
024300                                                         SYNC.    02430008
024400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02440008
024500                                                         COMP-3.  02450008
024600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02460008
024700                                                         COMP-3.  02470008
024800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02480008
024900                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 02490008
025000                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 02500008
025100             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02510008
025200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02520008
025300             15  ASC-LIST-QUEUE-NAME.                             02530008
025400                 20  ASC-LIST-TERM-ID                PIC  X(04).  02540008
025500                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02550008
025600                                                         COMP-3.  02560008
025700                 20  ASC-LIST-SEQ                    PIC  9(01).  02570008
025800             15  ASC-SEL-QUEUE-NAME.                              02580008
025900                 20  ASC-SEL-TERM-ID                 PIC  X(04).  02590008
026000                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   02600008
026100                                                          COMP-3. 02610008
026200                 20  ASC-SEL-SEQ                     PIC  9(01).  02620008
026300             15  ASC-TS-ITEM-NMBR                    PIC S9(04)   02630008
026400                                                         COMP.    02640008
026500             15  ASC-START-ITEM-REQUEST.                          02650008
026600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  02660008
026700             15  ASC-SCREEN-SEQUENCE-IND             PIC  X(01).  02670008
026800                 88  ASC-STYLE-SEQUENCE                VALUE 'S'. 02680008
026900                 88  ASC-POLINE-SEQUENCE               VALUE 'P'. 02690008
027000                                                                  02700008
027200*--------------------------------------------------------------*  02720020
027300* TS QUEUE AREA                                                *  02730020
027400*--------------------------------------------------------------*  02740020
027600     COPY APWS301.                                                02760008
027610                                                                  02761020
027700*--------------------------------------------------------------*  02770020
027800* ABEND PROCESSING COPYBOOK.                                   *  02780020
027900*--------------------------------------------------------------*  02790020
028100     COPY DPWS013.                                                02810008
028200                                                                  02820008
028400*--------------------------------------------------------------*  02840020
028500* ATTRIBUTE SETTINGS COPYBOOK.                                 *  02850020
028600*--------------------------------------------------------------*  02860020
028800     COPY DPWS015.                                                02880008
028900                                                                  02890008
029000*--------------------------------------------------------------*  02900020
029100* FUNCTION KEYS COPYBOOK.                                      *  02910020
029200*--------------------------------------------------------------*  02920020
029400     COPY DPWS016.                                                02940008
029500                                                                  02950008
029600*--------------------------------------------------------------*  02960020
029700* NUMERIC EDIT LAYOUT.                                         *  02970020
029800*--------------------------------------------------------------*  02980020
030000     COPY DPWS010I.                                               03000008
030100                                                                  03010008
030200*--------------------------------------------------------------*  03020020
030300* MAP LAYOUT                                                   *  03030020
030400*--------------------------------------------------------------*  03040020
030600     COPY APKM334.                                                03060008
030700                                                                  03070008
030800 01  MR-OCCURS-LAYOUT          REDEFINES  AP334AO.                03080008
030900     05  FILLER                PIC X(143).                        03090017
031000     05  MR-SCROLL-AREA OCCURS 10 TIMES.                          03100008
031100         10  MR-STORE-NBRL              PIC S9(04) COMP.          03110008
031200         10  MR-STORE-NBRA              PIC  X(01).               03120008
031300         10  MR-STORE-NBRC              PIC  X(01).               03130008
031400         10  MR-STORE-NBRH              PIC  X(01).               03140008
031500         10  MR-STORE-NBR.                                        03150008
031600             15 MR-STORE-NBR-9          PIC  ZZZ9.                03160009
031700                                                                  03170008
031800         10  MR-PO-LNE-NBRL             PIC S9(04) COMP.          03180008
031900         10  MR-PO-LNE-NBRA             PIC  X(01).               03190008
032000         10  MR-PO-LNE-NBRC             PIC  X(01).               03200008
032100         10  MR-PO-LNE-NBRH             PIC  X(01).               03210008
032200         10  MR-PO-LNE-NBR.                                       03220008
032300             15  MR-PO-LNE-NBR-9        PIC  ZZZ9.                03230008
032400                                                                  03240008
032500         10  MR-DC-NBRL                 PIC S9(04) COMP.          03250010
032600         10  MR-DC-NBRA                 PIC  X(01).               03260010
032700         10  MR-DC-NBRC                 PIC  X(01).               03270010
032800         10  MR-DC-NBRH                 PIC  X(01).               03280010
032900         10  MR-DC-NBR.                                           03290010
033000             15 MR-DC-NBR-9             PIC  ZZZZ9.               03300010
033010                                                                  03301010
033100         10  MR-NON-INVCD-QTYL          PIC S9(04) COMP.          03310008
033200         10  MR-NON-INVCD-QTYA          PIC  X(01).               03320008
033300         10  MR-NON-INVCD-QTYC          PIC  X(01).               03330008
033400         10  MR-NON-INVCD-QTYH          PIC  X(01).               03340008
033500         10  MR-NON-INVCD-QTY.                                    03350008
033600             15  MR-NON-INVCD-QTY-9     PIC  ZZZZZ9.              03360008
033700                                                                  03370008
033800         10  MR-UNIT-COST-AMTL          PIC S9(04) COMP.          03380008
033900         10  MR-UNIT-COST-AMTA          PIC  X(01).               03390008
034000         10  MR-UNIT-COST-AMTC          PIC  X(01).               03400008
034100         10  MR-UNIT-COST-AMTH          PIC  X(01).               03410008
034200         10  MR-UNIT-COST-AMT.                                    03420008
034300             15  MR-UNIT-COST-AMT-9     PIC    ZZZZ9.99.          03430008
034400                                                                  03440008
034500         10  MR-EXTENDED-COSTL          PIC S9(04) COMP.          03450008
034600         10  MR-EXTENDED-COSTA          PIC  X(01).               03460008
034700         10  MR-EXTENDED-COSTC          PIC  X(01).               03470008
034800         10  MR-EXTENDED-COSTH          PIC  X(01).               03480008
034900         10  MR-EXTENDED-COST.                                    03490008
035000             15  MR-EXTENDED-COST-9     PIC   ZZZZZZZ9.99.        03500008
035100                                                                  03510008
035200         10  MR-CRE-TMSTL               PIC S9(04) COMP.          03520008
035300         10  MR-CRE-TMSTA               PIC  X(01).               03530008
035400         10  MR-CRE-TMSTC               PIC  X(01).               03540008
035500         10  MR-CRE-TMSTH               PIC  X(01).               03550008
035600         10  MR-CRE-TMST                PIC  X(08).               03560008
035700                                                                  03570008
035800         10  MR-STATUS-CODEL            PIC S9(04) COMP.          03580008
035900         10  MR-STATUS-CODEA            PIC  X(01).               03590008
036000         10  MR-STATUS-CODEC            PIC  X(01).               03600008
036100         10  MR-STATUS-CODEH            PIC  X(01).               03610008
036200         10  MR-STATUS-CODE             PIC  X(07).               03620008
036300                                                                  03630008
036600*--------------------------------------------------------------*  03660020
036700* DB2 AREA FOR PURCHASE ORDER TABLE                            *  03670020
036800*--------------------------------------------------------------*  03680020
036900     EXEC SQL                                                     03690008
037000          INCLUDE TPURCHS                                         03700008
037100     END-EXEC.                                                    03710008
037200                                                                  03720008
037300*--------------------------------------------------------------*  03730020
037400* DB2 AREA FOR EXTERNAL NAME TABLE                             *  03740020
037500*--------------------------------------------------------------*  03750020
037600     EXEC SQL                                                     03760008
037700          INCLUDE TENTNME                                         03770008
037800     END-EXEC.                                                    03780008
037900                                                                  03790008
038000*--------------------------------------------------------------*  03800020
038100* DB2 AREA FOR A/P NON-INVOICED RECEIPT TABLE                  *  03810020
038200*--------------------------------------------------------------*  03820020
038300     EXEC SQL                                                     03830008
038400          INCLUDE TNINREC                                         03840008
038500     END-EXEC.                                                    03850008
038600                                                                  03860008
038700*--------------------------------------------------------------*  03870020
038800* DB2 AREA FOR PO PURCHASE ITEM TABLE                          *  03880020
038900*--------------------------------------------------------------*  03890020
039000     EXEC SQL                                                     03900008
039100          INCLUDE TPURITM                                         03910008
039200     END-EXEC.                                                    03920008
039300                                                                  03930008
039400*--------------------------------------------------------------*  03940020
039500* DB2 AREA FOR COMMUNICATIONS                                  *  03950020
039600*--------------------------------------------------------------*  03960020
039700     EXEC SQL                                                     03970008
039800          INCLUDE SQLCA                                           03980008
039900     END-EXEC.                                                    03990008
040000                                                                  04000008
040100*--------------------------------------------------------------*  04010020
040200* CURSOR TO OBTAIN LONG DESCRIPTION AND CORRECTIVE ACTION.     *  04020020
040300* ROWS ARE SORTED IN STATUS, STORE, STYLE, PO LINE NUMBER      *  04030020
040400* SEQUENCE.                                                    *  04040020
040500*--------------------------------------------------------------*  04050020
040700     EXEC SQL                                                     04070008
040800         DECLARE RECEIPT_STYLE_CSR CURSOR FOR                     04080008
040900         SELECT '1'                                               04090008
041000               ,A.PO_NBR                                          04100008
041100*              ,A.VER_NBR                                         04110008
041200               ,A.PO_LNE_NBR                                      04120008
041300               ,A.STR_NBR                                         04130008
041400               ,A.NON_INVC_UNT_QTY                                04140008
041500               ,A.UNT_COST_AMT                                    04150008
041600               ,A.REC_TMST                                        04160008
041700               ,A.STATUS_CDE                                      04170008
041800               ,B.VEND_STYL_NAME                                  04180008
041810               ,A.DC_NBR                                          04181012
041900          FROM  TNINREC A,                                        04190008
042000                TPURITM B                                         04200008
042100         WHERE  A.PO_NBR           = :AP300-PO-NBR                04210008
042200           AND  B.PO_NBR           = A.PO_NBR                     04220008
042300*          AND  A.VER_NBR          = :AP300-PO-VER-NBR            04230008
042400*          AND  A.PO_LNE_NBR       = :AP300-PO-LNE-NBR            04240008
042500           AND  A.STATUS_CDE       = :PC-UNMATCHED                04250008
042600           AND  B.APP_PO_LNE_NBR   = A.PO_LNE_NBR                 04260008
042700           AND  B.VER_STATUS_CDE   = :PC-A                        04270008
042800                                                                  04280008
042900         UNION ALL                                                04290008
043000                                                                  04300008
043100         SELECT '2'                                               04310008
043200               ,A.PO_NBR                                          04320008
043300*              ,A.VER_NBR                                         04330008
043400               ,A.PO_LNE_NBR                                      04340008
043500               ,A.STR_NBR                                         04350008
043600               ,A.NON_INVC_UNT_QTY                                04360008
043700               ,A.UNT_COST_AMT                                    04370008
043800               ,A.REC_TMST                                        04380008
043900               ,A.STATUS_CDE                                      04390008
044000               ,B.VEND_STYL_NAME                                  04400008
044010               ,A.DC_NBR                                          04401012
044100          FROM  TNINREC A,                                        04410008
044200                TPURITM B                                         04420008
044300         WHERE  A.PO_NBR           = :AP300-PO-NBR                04430008
044400           AND  B.PO_NBR           = A.PO_NBR                     04440008
044500*          AND  A.VER_NBR          = :AP300-PO-VER-NBR            04450008
044600*          AND  A.PO_LNE_NBR       = :AP300-PO-LNE-NBR            04460008
044700           AND  A.STATUS_CDE       = :PC-MATCHED                  04470008
044800           AND  B.APP_PO_LNE_NBR   = A.PO_LNE_NBR                 04480008
044900           AND  B.VER_STATUS_CDE   = :PC-A                        04490008
045000                                                                  04500008
045100         UNION ALL                                                04510008
045200                                                                  04520008
045300         SELECT '3'                                               04530008
045400               ,A.PO_NBR                                          04540008
045500*              ,A.VER_NBR                                         04550008
045600               ,A.PO_LNE_NBR                                      04560008
045700               ,A.STR_NBR                                         04570008
045800               ,A.NON_INVC_UNT_QTY                                04580008
045900               ,A.UNT_COST_AMT                                    04590008
046000               ,A.REC_TMST                                        04600008
046100               ,A.STATUS_CDE                                      04610008
046200               ,B.VEND_STYL_NAME                                  04620008
046210               ,A.DC_NBR                                          04621012
046300          FROM  TNINREC A,                                        04630008
046400                TPURITM B                                         04640008
046500         WHERE  A.PO_NBR           = :AP300-PO-NBR                04650008
046600           AND  B.PO_NBR           = A.PO_NBR                     04660008
046700*          AND  A.VER_NBR          = :AP300-PO-VER-NBR            04670008
046800*          AND  A.PO_LNE_NBR       = :AP300-PO-LNE-NBR            04680008
046900           AND  A.STATUS_CDE     IN (:PC-JOURNALIZED,             04690008
047000                                     :PC-WRITE-OFF)               04700008
047100           AND  B.APP_PO_LNE_NBR   = A.PO_LNE_NBR                 04710008
047200           AND  B.VER_STATUS_CDE   = :PC-A                        04720008
047300                                                                  04730008
047400      ORDER BY 1, 4, 9, 3                                         04740008
047500                                                                  04750008
047600     END-EXEC.                                                    04760008
047700                                                                  04770008
047800*--------------------------------------------------------------*  04780020
047900* CURSOR TO OBTAIN LONG DESCRIPTION AND CORRECTIVE ACTION.     *  04790020
048000* ROWS ARE SORTED IN STATUS, STORE, PO LINE NUMBER SEQUENCE.   *  04800020
048100*--------------------------------------------------------------*  04810020
048300     EXEC SQL                                                     04830008
048400         DECLARE RECEIPT_POLN_CSR CURSOR FOR                      04840008
048500         SELECT '1'                                               04850008
048600               ,A.PO_NBR                                          04860008
048700*              ,A.VER_NBR                                         04870008
048800               ,A.PO_LNE_NBR                                      04880008
048900               ,A.STR_NBR                                         04890008
049000               ,A.NON_INVC_UNT_QTY                                04900008
049100               ,A.UNT_COST_AMT                                    04910008
049200               ,A.REC_TMST                                        04920008
049300               ,A.STATUS_CDE                                      04930008
049400               ,B.VEND_STYL_NAME                                  04940008
049410               ,A.DC_NBR                                          04941012
049500          FROM  TNINREC A,                                        04950008
049600                TPURITM B                                         04960008
049700         WHERE  A.PO_NBR           = :AP300-PO-NBR                04970008
049800           AND  B.PO_NBR           = A.PO_NBR                     04980008
049900*          AND  A.VER_NBR          = :AP300-PO-VER-NBR            04990008
050000*          AND  A.PO_LNE_NBR       = :AP300-PO-LNE-NBR            05000008
050100           AND  A.STATUS_CDE       = :PC-UNMATCHED                05010008
050200           AND  B.APP_PO_LNE_NBR   = A.PO_LNE_NBR                 05020008
050300           AND  B.VER_STATUS_CDE   = :PC-A                        05030008
050400                                                                  05040008
050500         UNION ALL                                                05050008
050600                                                                  05060008
050700         SELECT '2'                                               05070008
050800               ,A.PO_NBR                                          05080008
050900*              ,A.VER_NBR                                         05090008
051000               ,A.PO_LNE_NBR                                      05100008
051100               ,A.STR_NBR                                         05110008
051200               ,A.NON_INVC_UNT_QTY                                05120008
051300               ,A.UNT_COST_AMT                                    05130008
051400               ,A.REC_TMST                                        05140008
051500               ,A.STATUS_CDE                                      05150008
051600               ,B.VEND_STYL_NAME                                  05160008
051610               ,A.DC_NBR                                          05161012
051700          FROM  TNINREC A,                                        05170008
051800                TPURITM B                                         05180008
051900         WHERE  A.PO_NBR           = :AP300-PO-NBR                05190008
052000           AND  B.PO_NBR           = A.PO_NBR                     05200008
052100*          AND  A.VER_NBR          = :AP300-PO-VER-NBR            05210008
052200*          AND  A.PO_LNE_NBR       = :AP300-PO-LNE-NBR            05220008
052300           AND  A.STATUS_CDE       = :PC-MATCHED                  05230008
052400           AND  B.APP_PO_LNE_NBR   = A.PO_LNE_NBR                 05240008
052500           AND  B.VER_STATUS_CDE   = :PC-A                        05250008
052600                                                                  05260008
052700         UNION ALL                                                05270008
052800                                                                  05280008
052900         SELECT '3'                                               05290008
053000               ,A.PO_NBR                                          05300008
053100*              ,A.VER_NBR                                         05310008
053200               ,A.PO_LNE_NBR                                      05320008
053300               ,A.STR_NBR                                         05330008
053400               ,A.NON_INVC_UNT_QTY                                05340008
053500               ,A.UNT_COST_AMT                                    05350008
053600               ,A.REC_TMST                                        05360008
053700               ,A.STATUS_CDE                                      05370008
053800               ,B.VEND_STYL_NAME                                  05380008
053810               ,A.DC_NBR                                          05381012
053900          FROM  TNINREC A,                                        05390008
054000                TPURITM B                                         05400008
054100         WHERE  A.PO_NBR           = :AP300-PO-NBR                05410008
054200           AND  B.PO_NBR           = A.PO_NBR                     05420008
054300*          AND  A.VER_NBR          = :AP300-PO-VER-NBR            05430008
054400*          AND  A.PO_LNE_NBR       = :AP300-PO-LNE-NBR            05440008
054500           AND  A.STATUS_CDE     IN (:PC-JOURNALIZED,             05450008
054600                                     :PC-WRITE-OFF)               05460008
054700           AND  B.APP_PO_LNE_NBR   = A.PO_LNE_NBR                 05470008
054800           AND  B.VER_STATUS_CDE   = :PC-A                        05480008
054900                                                                  05490008
055000      ORDER BY 1, 4, 3                                            05500008
055100                                                                  05510008
055200                                                                  05520008
055300     END-EXEC.                                                    05530008
055310                                                                  05531020
055400*-----------------------*                                         05540020
055600 LINKAGE SECTION.                                                 05560008
055700*-----------------------*                                         05570020
055800 01  DFHCOMMAREA.                                                 05580008
055900     05  FILLER                         OCCURS  1 TO 4072 TIMES   05590008
056000                                        DEPENDING ON EIBCALEN.    05600008
056100         10  FILLER                     PIC X.                    05610008
056200                                                                  05620008
056300*----------------------*                                          05630020
056400 PROCEDURE DIVISION.                                              05640008
056500*----------------------*                                          05650020
056600 0000-MAIN-MODULE.                                                05660008
056700                                                                  05670008
056800     INITIALIZE DP030-CICS-API-FIELDS.                            05680008
056900     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        05690008
057000     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           05700008
057100     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          05710008
057200     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        05720008
057300     MOVE LENGTH OF AP334AI       TO DP030-MAP-LENGTH (1).        05730008
057400     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      05740008
057500     PERFORM 0001-CALL-CICS-ARCH-API.                             05750008
057600                                                                  05760008
057700     PERFORM 1000-CONTROL-PROCESSING.                             05770008
057800                                                                  05780008
057900     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      05790008
058000     PERFORM 0001-CALL-CICS-ARCH-API.                             05800008
058100                                                                  05810008
058200*---------------------------------------------------------------* 05820020
058300* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE     * 05830020
058400* AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.           * 05840020
058500*---------------------------------------------------------------* 05850020
058700 0001-CALL-CICS-ARCH-API.                                         05870008
058800                                                                  05880008
058900     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     05890025
059000                                     DFHCOMMAREA                  05900025
059100                                     DP030-CICS-API-FIELDS        05910025
059200                                     DP020-STANDARD-COMMAREA      05920025
059300                                     AP334AI.                     05930026
059400                                                                  05940008
059500     IF  DP030-RC-CALL-SUCCESSFUL                                 05950008
059600         CONTINUE                                                 05960008
059700     ELSE                                                         05970008
059800         SET DP013-NO-ROLLBACK TO TRUE                            05980008
059900         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   05990008
060000         SET DP013-CICS-ABEND TO TRUE                             06000008
060100         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        06010008
060110         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06011026
060120-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06012026
060400         MOVE DP030-RETURN-CODE                                   06040008
060500                               TO DP013-MESSAGE-TEXT (3)          06050008
060600         PERFORM DP013-0000-PROCESS-ABEND                         06060008
060700     END-IF.                                                      06070008
060800                                                                  06080008
060900*--------------------------------------------------------------*  06090020
061000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    *  06100020
061100* COURSE OF ACTION IS FOR THIS TRANSACTION.                    *  06110020
061200*                                                              *  06120020
061300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE*  06130020
061400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS  *  06140020
061500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS *  06150020
061600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS*  06160020
061700*--------------------------------------------------------------*  06170020
061900 1000-CONTROL-PROCESSING.                                         06190008
062000                                                                  06200008
062100*-->     ** COMING IN FROM THE CRITERIA SPEC SCREEN **            06210008
062200                                                                  06220008
062300     EVALUATE TRUE                                                06230008
062400         WHEN DP020-NEXT-ACT-INITIAL                              06240008
062500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06250008
062600             IF  PS-COMMAREA-NOT-VALID                            06260008
062700                 SET DP020-NEXT-ACT-APPL-ERROR                    06270008
062800                               TO  TRUE                           06280008
062900             ELSE                                                 06290008
063000                 MOVE EIBTRMID         TO ASC-LIST-TERM-ID        06300008
063100                                          ASC-SEL-TERM-ID         06310008
063200                 MOVE DP020-SRC-TASK-NUMBER                       06320008
063300                                       TO ASC-LIST-TASK-NUMBER    06330008
063400                                          ASC-SEL-TASK-NUMBER     06340008
063500                 MOVE PC-DTL-QUEUE-SEQ TO ASC-LIST-SEQ            06350008
063600                 MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ             06360008
063700                 PERFORM 2050-DELETE-DETAIL-QUEUE                 06370008
063800                 SET ASC-STYLE-SEQUENCE TO TRUE                   06380008
063900                 PERFORM 4000-BUILD-INITIAL-PANEL                 06390008
064000             END-IF                                               06400008
064100                                                                  06410008
064200         WHEN DP020-NEXT-ACT-READ-MAP                             06420008
064300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06430008
064400                               TO PV-TOP-ITEM                     06440008
064500             PERFORM 2000-PROCESS-PANEL                           06450008
064600                                                                  06460008
064700         WHEN DP020-NEXT-ACT-RETURN                               06470008
064800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06480008
064900                               TO PV-TOP-ITEM                     06490008
065000             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL        06500008
065100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06510008
065200                                                                  06520008
065300         WHEN OTHER                                               06530008
065400             SET DP013-LOGIC-ABEND TO TRUE                        06540008
065500             SET DP013-NO-ROLLBACK TO TRUE                        06550008
065600             MOVE '1000-CONTROL-PROCESSING'                       06560008
065700                               TO  DP013-PARAGRAPH                06570008
065800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06580008
065900                               TO  DP013-MESSAGE-TEXT(1)          06590008
066000             PERFORM DP013-0000-PROCESS-ABEND                     06600008
066100     END-EVALUATE.                                                06610008
066200                                                                  06620020
066300*--------------------------------------------------------------*  06630020
066400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR  *  06640020
066500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.            *  06650020
066600*--------------------------------------------------------------*  06660020
066800 1100-PROCESS-INTER-APPL-COMM.                                    06680008
066900                                                                  06690008
067000     SET PS-COMMAREA-VALID     TO TRUE.                           06700008
067100     INITIALIZE ASC-SPECIFIC-COMMAREA.                            06710008
067200     MOVE SPACE                TO ASC-START-ITEM-REQUEST.         06720008
067300                                                                  06730008
067400***  --> NAVIGATIONAL KEY DATA <--                                06740008
067500                                                                  06750008
067600     IF DP020-NAV-KEY-DATA > SPACES                               06760008
067700         MOVE DP020-NAV-KEY-DATA TO ASC-KEY-PO-NBR                06770008
067800         MOVE ASC-KEY-PO-NBR     TO DP010I-UNEDITED-FIELD         06780008
067900         MOVE 9                  TO DP010I-MAXIMUM-DIGITS         06790008
068000         MOVE 0                  TO DP010I-MAXIMUM-DECIMALS       06800008
068100         SET DP010I-NEGATIVE-NOT-ALLOWED                          06810008
068200                                 TO TRUE                          06820008
068320         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06832022
068330                         USING DP010I-NUMERIC-EDIT-AREA           06833022
068400         IF DP010I-ERROR-DETECTED                                 06840008
068500             SET PS-ERROR          TO TRUE                        06850008
068600             SET DP020-MSG-FATAL   TO TRUE                        06860008
068700*        -- MUST BE NUMERIC --                                    06870008
068800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            06880008
068900             SET DP020-MSG-FATAL   TO TRUE                        06890008
069000             SET DP020-NEXT-ACT-APPL-ERROR                        06900008
069100                                   TO TRUE                        06910008
069200         ELSE                                                     06920008
069300             MOVE DP010I-NUMERIC-FIELD                            06930008
069400                                   TO AP300-PO-NBR                06940008
069500         END-IF                                                   06950008
069600     END-IF.                                                      06960008
069700                                                                  06970020
069800     EVALUATE TRUE                                                06980008
069900                                                                  06990008
070000     WHEN AP300-PO-NBR > ZERO                                     07000008
070100         MOVE AP300-PO-NBR   TO  ASC-KEY-PO-NBR                   07010008
070200*        IF AP300-PO-VER-NBR  > ZERO   AND                        07020008
070300*           AP300-PO-LNE-NBR  > ZERO                              07030008
070400*            MOVE AP300-PO-NBR     TO ASC-KEY-PO-NBR              07040008
070500*            MOVE AP300-PO-VER-NBR TO ASC-KEY-PO-VER-NBR          07050008
070600*            MOVE AP300-PO-LNE-NBR TO ASC-KEY-PO-LINE-NBR         07060008
070700*        ELSE                                                     07070008
070800*            -- INVALID COMBINATION OF FIELDS --                  07080008
070900*            MOVE PC-TSYMSG-00831  TO DP020-MSG-NUMBER            07090008
071000*            SET DP020-MSG-FATAL   TO TRUE                        07100008
071100*            SET PS-COMMAREA-NOT-VALID                            07110008
071200*                                  TO TRUE                        07120008
071300*        END-IF                                                   07130008
071400                                                                  07140008
071500     WHEN OTHER                                                   07150008
071600         MOVE PC-TSYMSG-00148                                     07160008
071700                       TO DP020-MSG-NUMBER                        07170008
071800         SET DP020-MSG-FATAL TO TRUE                              07180008
071900         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    07190008
072000                                                                  07200008
072100     END-EVALUATE.                                                07210008
072200                                                                  07220008
072400*--------------------------------------------------------------*  07240020
072500* RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED  *  07250020
072600* ON WHAT FUNCTION KEY WAS SELECTED.                           *  07260020
072700*--------------------------------------------------------------*  07270020
072900 2000-PROCESS-PANEL.                                              07290008
073000                                                                  07300008
073100     EVALUATE TRUE                                                07310008
073200         WHEN DP020-SRC-AID = DP016-CLEAR                         07320008
073300             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                07330008
073400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07340008
073500             PERFORM 3200-RESET-ATTRIBUTES                        07350008
073600                                                                  07360008
073700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07370008
073800             PERFORM 2050-DELETE-DETAIL-QUEUE                     07380008
073900             PERFORM 4000-BUILD-INITIAL-PANEL                     07390008
074000             PERFORM 3200-RESET-ATTRIBUTES                        07400008
074100                                                                  07410008
074200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07420008
074300             MOVE +1 TO PV-TOP-ITEM                               07430008
074400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07440008
074500             PERFORM 3200-RESET-ATTRIBUTES                        07450008
074600                                                                  07460008
074700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07470008
074800             PERFORM 2110-BROWSE-BACKWARD                         07480008
074900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07490008
075000             PERFORM 3200-RESET-ATTRIBUTES                        07500008
075100                                                                  07510008
075200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07520008
075300             PERFORM 2120-BROWSE-FORWARD                          07530008
075400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07540008
075500             PERFORM 3200-RESET-ATTRIBUTES                        07550008
075600                                                                  07560008
075700         WHEN DP020-SRC-AID = DP016-ENTER                         07570008
075800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07580008
075900             IF  PS-ERROR                                         07590008
076000                 CONTINUE                                         07600008
076100             ELSE                                                 07610008
076200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07620008
076300                 PERFORM 3200-RESET-ATTRIBUTES                    07630008
076400             END-IF                                               07640008
076500                                                                  07650008
076600*        WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07660008
076700*             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07670008
076800*             PERFORM 3200-RESET-ATTRIBUTES                       07680008
076900                                                                  07690008
077000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07700008
077100             PERFORM 2050-DELETE-DETAIL-QUEUE                     07710008
077200             SET ASC-STYLE-SEQUENCE TO TRUE                       07720008
077300             PERFORM 4000-BUILD-INITIAL-PANEL                     07730008
077400             PERFORM 3200-RESET-ATTRIBUTES                        07740008
077500                                                                  07750008
077600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07760008
077700             PERFORM 2050-DELETE-DETAIL-QUEUE                     07770008
077800             SET ASC-POLINE-SEQUENCE TO TRUE                      07780008
077900             PERFORM 4000-BUILD-INITIAL-PANEL                     07790008
078000             PERFORM 3200-RESET-ATTRIBUTES                        07800008
078100                                                                  07810008
078200         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 07820008
078300             INITIALIZE AP300-INTER-APPL-COMMAREA                 07830008
078400             MOVE ASC-KEY-PO-NBR-9                                07840008
078500                                TO AP300-PO-NBR                   07850008
078600         WHEN OTHER                                               07860008
078700             SET DP013-NO-ROLLBACK TO TRUE                        07870008
078800             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               07880008
078900             SET DP013-CICS-ABEND TO TRUE                         07890008
079000             MOVE '2000-PROCESS-PANEL' TO DP013-PARAGRAPH         07900008
079100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07910008
079200                                   TO DP013-MESSAGE-TEXT (1)      07920008
079300             PERFORM DP013-0000-PROCESS-ABEND                     07930008
079500     END-EVALUATE.                                                07950008
079600                                                                  07960020
079700*--------------------------------------------------------------*  07970020
079800* DELETE THE TEMPORARY STORAGE QUEUE.                          *  07980020
079900*--------------------------------------------------------------*  07990020
080100 2050-DELETE-DETAIL-QUEUE.                                        08010008
080200                                                                  08020008
080300     EXEC CICS                                                    08030008
080400         DELETEQ TS                                               08040008
080500             QUEUE (ASC-LIST-QUEUE-NAME)                          08050008
080600             RESP  (PV-CICS-RESP)                                 08060008
080700     END-EXEC.                                                    08070008
080800                                                                  08080008
080900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08090008
081000        (PV-CICS-RESP = DFHRESP(QIDERR))                          08100008
081100         CONTINUE                                                 08110008
081200     ELSE                                                         08120008
081300         SET DP013-CICS-ABEND TO TRUE                             08130008
081400         SET DP013-NO-ROLLBACK TO TRUE                            08140008
081500                                                                  08150008
081600         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH       08160008
081700         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  08170008
081800                        TO DP013-MESSAGE-TEXT (1)                 08180008
081900         PERFORM DP013-0000-PROCESS-ABEND                         08190008
082000     END-IF.                                                      08200008
082100                                                                  08210008
082200     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        08220008
082300                                                                  08230020
082400*--------------------------------------------------------------*  08240020
082500* IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP      *  08250020
082600* ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,       *  08260020
082700* SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST    *  08270020
082800* MESSAGE.                                                     *  08280020
082900*--------------------------------------------------------------*  08290020
083100 2110-BROWSE-BACKWARD.                                            08310008
083200                                                                  08320008
083300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08330008
083400         GIVING PV-TOP-ITEM.                                      08340008
083500                                                                  08350008
083600     IF  PV-TOP-ITEM < +1                                         08360008
083700         MOVE +1              TO PV-TOP-ITEM                      08370008
083800*        -- TOP OF LIST --                                        08380008
083900         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 08390008
084000         SET DP020-MSG-INFORMATIONAL TO TRUE                      08400008
084100     END-IF.                                                      08410008
084200                                                                  08420008
084500*--------------------------------------------------------------*  08450020
084600* IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       *  08460020
084700* ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO    *  08470020
084800* PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.              *  08480020
084900*--------------------------------------------------------------*  08490020
085100 2120-BROWSE-FORWARD.                                             08510008
085200                                                                  08520008
085300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08530008
085400         GIVING PV-TOP-ITEM.                                      08540008
085500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08550008
085600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08560008
085700                                   TO PV-TOP-ITEM                 08570008
085800*        -- BOTTOM OF LIST --                                     08580008
085900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08590008
086000         SET DP020-MSG-INFORMATIONAL                              08600008
086100                                   TO TRUE                        08610008
086200     ELSE                                                         08620008
086300         COMPUTE PV-BOTTOM-ITEM =                                 08630008
086400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08640008
086500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08650008
086600*            -- BOTTOM OF LIST --                                 08660008
086700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08670008
086800             SET DP020-MSG-INFORMATIONAL                          08680008
086900                                   TO TRUE                        08690008
087000         END-IF                                                   08700008
087100     END-IF.                                                      08710008
087200                                                                  08720020
087300*--------------------------------------------------------------*  08730020
087400* THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO     *  08740020
087500* THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.    *  08750020
087600* THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST   *  08760020
087700* RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.       *  08770020
087800* THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT      *  08780020
087900* IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           *  08790020
088000*--------------------------------------------------------------*  08800020
088200 2130-CHECK-FOR-JUMP-BROWSE.                                      08820008
088300                                                                  08830020
088400     IF ASTRTITL > ZEROES                                         08840008
088500         MOVE ASTRTITI TO ASC-START-ITEM-REQUEST.                 08850008
088600                                                                  08860020
088700     IF (ASC-START-ITEM-REQUEST = SPACE)                          08870008
088800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08880008
088900                                   TO PV-TOP-ITEM                 08890008
089000     ELSE                                                         08900008
089100         MOVE ASC-START-ITEM-REQUEST                              08910008
089200                                   TO DP010I-UNEDITED-FIELD       08920008
089300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08930008
089400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08940008
089500         SET DP010I-NEGATIVE-NOT-ALLOWED                          08950008
089600                                   TO TRUE                        08960008
089720         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08972022
089730                         USING DP010I-NUMERIC-EDIT-AREA           08973022
089800                                                                  08980008
089900         IF  NOT DP010I-ERROR-DETECTED                            08990008
090000             MOVE DP010I-NUMERIC-FIELD                            09000008
090100                                   TO ASC-START-ITEM-REQUEST-N    09010008
090200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09020008
090300                 IF  ASC-START-ITEM-REQUEST-N >                   09030008
090400                                          ASC-NUMBER-OF-ITEMS-READ09040008
090500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09050008
090600                     COMPUTE PV-TOP-ITEM =                        09060008
090700                             ASC-NUMBER-OF-ITEMS-READ             09070008
090800                             - PC-ITEMS-PER-PANEL + 1             09080008
090900                     IF  PV-TOP-ITEM < +1                         09090008
091000                         MOVE +1   TO PV-TOP-ITEM                 09100008
091100                         MOVE PC-TSYMSG-00070                     09110008
091200                                   TO DP020-MSG-NUMBER            09120008
091300                         SET DP020-MSG-INFORMATIONAL              09130008
091400                                   TO TRUE                        09140008
091500                     END-IF                                       09150008
091600                 ELSE                                             09160008
091700                     MOVE ASC-START-ITEM-REQUEST-N                09170008
091800                                   TO PV-TOP-ITEM                 09180008
091900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09190008
092000                     COMPUTE PV-BOTTOM-ITEM =                     09200008
092100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09210008
092200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09220008
092300*                        -- BOTTOM OF LIST --                     09230008
092400                         MOVE PC-TSYMSG-00070                     09240008
092500                                   TO DP020-MSG-NUMBER            09250008
092600                         SET DP020-MSG-INFORMATIONAL              09260008
092700                                   TO TRUE                        09270008
092800                     END-IF                                       09280008
092900                 END-IF                                           09290008
093000             ELSE                                                 09300008
093100*                --- VALUE OUT OF RANGE ----                      09310008
093200                 MOVE PC-TSYMSG-00101                             09320008
093300                                   TO DP020-MSG-NUMBER            09330008
093400                 MOVE -1           TO ASTRTITL                    09340008
093500                 SET DP030-SET-CURSOR-APPL-1                      09350008
093600                                   TO TRUE                        09360008
093700                 MOVE DP015-REVERSE                               09370008
093800                                   TO ASTRTITH                    09380008
093900                 MOVE DP015-RED    TO ASTRTITC                    09390008
094000                 MOVE DP015-UNP-NUM-BRT-OFF                       09400008
094100                                   TO ASTRTITA                    09410008
094200                 SET DP020-MSG-FATAL                              09420008
094300                     PS-START-ITEM-ERROR                          09430008
094400                                   TO TRUE                        09440008
094500             END-IF                                               09450008
094600                                                                  09460008
094700         ELSE                                                     09470008
094800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09480008
094900             MOVE -1               TO ASTRTITL                    09490008
095000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09500008
095100             MOVE DP015-REVERSE    TO ASTRTITH                    09510008
095200             MOVE DP015-RED        TO ASTRTITC                    09520008
095300             MOVE DP015-UNP-NUM-BRT-OFF                           09530008
095400                                   TO ASTRTITA                    09540008
095500             SET DP020-MSG-FATAL                                  09550008
095600                 PS-START-ITEM-ERROR                              09560008
095700                                   TO TRUE                        09570008
095800         END-IF                                                   09580008
095900     END-IF.                                                      09590008
096000                                                                  09600008
096800*--------------------------------------------------------------*  09680020
096900* RESET ATTRIBUTES.                                            *  09690020
097000*--------------------------------------------------------------*  09700020
097200 3200-RESET-ATTRIBUTES.                                           09720008
097300                                                                  09730008
097400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   09740008
097500     MOVE DP015-GREEN              TO ASTRTITC.                   09750008
097600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   09760008
097700     MOVE -1                       TO ASTRTITL.                   09770008
097800     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       09780008
097900                                                                  09790008
098200*--------------------------------------------------------------*  09820020
098300* INITIALIZE BOTH BLOCKS IN THE ARRAY.                         *  09830020
098400* INITIALIZE ALL COUNTERS AND FLAGS.                           *  09840020
098500* READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.   *  09850020
098600* DISPLAY THE PANEL TO USER.                                   *  09860020
098700*--------------------------------------------------------------*  09870020
098900 4000-BUILD-INITIAL-PANEL.                                        09890008
099000                                                                  09900008
099100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            09910008
099200                                 ASC-BLOCK-ENTRIES (2).           09920008
099300     MOVE +1                 TO  ASC-BLK-SUB.                     09930008
099400     SET ASC-ITEMS-LEFT-ON-DB                                     09940008
099500                             TO  TRUE.                            09950008
099600                                                                  09960008
099700     MOVE +0                 TO  ASC-ITEM-SUB                     09970008
099800                                 ASC-NUMBER-OF-ITEMS-READ         09980008
099900                                 ASC-NUMBER-OF-SELECTED-ITEMS     09990008
100000                                 ASC-HIGHEST-BLOCK-WRITTEN        10000008
100100                                 ASC-START-OF-SELECTED-RANGE      10010008
100200                                 ASC-END-OF-SELECTED-RANGE        10020008
100300                                 ASC-ITEM-AT-TOP-OF-PANEL         10030008
100400                                 ASC-UNMTCHD-TOT-COST             10040008
100500                                 ASC-MATCHED-TOT-COST             10050008
100600                                 ASC-JOURNLD-TOT-COST.            10060008
100700                                                                  10070008
100800                                                                  10080008
100900*    PERFORM 4100-PREPARE-CURSOR.                                 10090008
101000                                                                  10100008
101100     IF  ASC-POLINE-SEQUENCE                                      10110008
101200         PERFORM 4015-OPEN-POLN-CURSOR                            10120008
101300         PERFORM 4300-READ-ITEMS-FROM-DB                          10130008
101400         PERFORM 4025-CLOSE-POLN-CURSOR                           10140008
101500     ELSE                                                         10150008
101600         PERFORM 4010-OPEN-STYLE-CURSOR                           10160008
101700         PERFORM 4300-READ-ITEMS-FROM-DB                          10170008
101800         PERFORM 4020-CLOSE-STYLE-CURSOR                          10180008
101900     END-IF.                                                      10190008
102000                                                                  10200008
102100     MOVE +1                 TO  PV-TOP-ITEM.                     10210008
102200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          10220008
102300         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    10230008
102400         SET DP020-MSG-FATAL   TO  TRUE                           10240008
102500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               10250008
102600     ELSE                                                         10260008
102700         MOVE -1             TO ASTRTITL                          10270008
102800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      10280008
102900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     10290008
103000     END-IF.                                                      10300008
103100                                                                  10310020
103300*--------------------------------------------------------------*  10330020
103400* OPEN THE RECEIPT STYLE CURSOR.                               *  10340020
103500*--------------------------------------------------------------*  10350020
103700 4010-OPEN-STYLE-CURSOR.                                          10370008
103800                                                                  10380008
103900     EXEC SQL                                                     10390008
104000          OPEN RECEIPT_STYLE_CSR                                  10400008
104100     END-EXEC.                                                    10410008
104200                                                                  10420008
104300     EVALUATE TRUE                                                10430008
104400         WHEN SQLCODE = ZERO                                      10440008
104500              CONTINUE                                            10450008
104600         WHEN SQLWARN0 NOT EQUAL SPACE                            10460008
104700         WHEN SQLCODE NOT EQUAL ZERO                              10470008
104800              MOVE '4010-OPEN-STYLE-CURSOR'                       10480008
104900                           TO  DP013-PARAGRAPH                    10490008
105000              MOVE 'OPEN RECEIPT STYLE CURSOR'                    10500008
105100                           TO  DP013-MESSAGE-TEXT (1)             10510008
105200              MOVE SQLCA   TO  DP013-SQLCA                        10520008
105300              SET DP013-DB2-ABEND                                 10530008
105400                           TO  TRUE                               10540008
105500              PERFORM DP013-0000-PROCESS-ABEND                    10550008
105600     END-EVALUATE.                                                10560008
105700                                                                  10570008
105900*--------------------------------------------------------------*  10590020
106000* OPEN THE RECEIPT PO LINE NUMBER CURSOR.                      *  10600020
106100*--------------------------------------------------------------*  10610020
106300 4015-OPEN-POLN-CURSOR.                                           10630008
106400                                                                  10640008
106500     EXEC SQL                                                     10650008
106600          OPEN RECEIPT_POLN_CSR                                   10660008
106700     END-EXEC.                                                    10670008
106800                                                                  10680008
106900     EVALUATE TRUE                                                10690008
107000         WHEN SQLCODE = ZERO                                      10700008
107100              CONTINUE                                            10710008
107200         WHEN SQLWARN0 NOT EQUAL SPACE                            10720008
107300         WHEN SQLCODE NOT EQUAL ZERO                              10730008
107400              MOVE '4015-OPEN-POLN-CURSOR'                        10740008
107500                           TO  DP013-PARAGRAPH                    10750008
107600              MOVE 'OPEN RECEIPT PO LINE NR CURSOR'               10760008
107700                           TO  DP013-MESSAGE-TEXT (1)             10770008
107800              MOVE SQLCA   TO  DP013-SQLCA                        10780008
107900              SET DP013-DB2-ABEND                                 10790008
108000                           TO  TRUE                               10800008
108100              PERFORM DP013-0000-PROCESS-ABEND                    10810008
108200     END-EVALUATE.                                                10820008
108300                                                                  10830008
108500*--------------------------------------------------------------*  10850020
108600* CLOSE THE RECEIPT STYLE CURSOR.                              *  10860020
108700*--------------------------------------------------------------*  10870020
108900 4020-CLOSE-STYLE-CURSOR.                                         10890008
109000                                                                  10900008
109100     EXEC SQL                                                     10910008
109200         CLOSE RECEIPT_STYLE_CSR                                  10920008
109300     END-EXEC.                                                    10930008
109400                                                                  10940008
109500     EVALUATE TRUE                                                10950008
109600         WHEN SQLCODE = ZERO                                      10960008
109700              CONTINUE                                            10970008
109800         WHEN SQLWARN0 NOT EQUAL SPACE                            10980008
109900         WHEN SQLCODE NOT EQUAL ZERO                              10990008
110000              MOVE '4020-CLOSE-STYLE-CURSOR'                      11000008
110100                           TO  DP013-PARAGRAPH                    11010008
110200              MOVE 'CLOSE RECEIPT STYLE CURSOR'                   11020008
110300                           TO  DP013-MESSAGE-TEXT (1)             11030008
110400              MOVE SQLCA   TO  DP013-SQLCA                        11040008
110500              SET DP013-DB2-ABEND                                 11050008
110600                           TO  TRUE                               11060008
110700              PERFORM DP013-0000-PROCESS-ABEND                    11070008
110800     END-EVALUATE.                                                11080008
110900                                                                  11090020
111000*--------------------------------------------------------------*  11100020
111100* CLOSE THE RECEIPT PO LINE NUMBER CURSOR.                     *  11110020
111200*--------------------------------------------------------------*  11120020
111400 4025-CLOSE-POLN-CURSOR.                                          11140008
111500                                                                  11150008
111600     EXEC SQL                                                     11160008
111700         CLOSE RECEIPT_POLN_CSR                                   11170008
111800     END-EXEC.                                                    11180008
111900                                                                  11190008
112000     EVALUATE TRUE                                                11200008
112100         WHEN SQLCODE = ZERO                                      11210008
112200              CONTINUE                                            11220008
112300         WHEN SQLWARN0 NOT EQUAL SPACE                            11230008
112400         WHEN SQLCODE NOT EQUAL ZERO                              11240008
112500              MOVE '4025-CLOSE-POLN-CURSOR'                       11250008
112600                           TO  DP013-PARAGRAPH                    11260008
112700              MOVE 'CLOSE RECEIPT PO LINE NR CURSOR'              11270008
112800                           TO  DP013-MESSAGE-TEXT (1)             11280008
112900              MOVE SQLCA   TO  DP013-SQLCA                        11290008
113000              SET DP013-DB2-ABEND                                 11300008
113100                           TO  TRUE                               11310008
113200              PERFORM DP013-0000-PROCESS-ABEND                    11320008
113300     END-EVALUATE.                                                11330008
113700                                                                  11370008
113800*--------------------------------------------------------------*  11380020
113900* READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE     *  11390020
114000* BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,      *  11400020
114100* WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND   *  11410020
114200* BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE      *  11420020
114300* 2ND BLOCK MAKING IT AVAILABLE TO BE USED.                    *  11430020
114400*                                                              *  11440020
114500* DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE     *  11450020
114600* ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM   *  11460020
114700* UPON INITIALIZATION.                                         *  11470020
114800*--------------------------------------------------------------*  11480020
115000 4300-READ-ITEMS-FROM-DB.                                         11500008
115100                                                                  11510008
115300**  RETRIEVE THE PURCHASE ORDER HEADER ROW (ENT-ID, DEPT-NBR)     11530020
115500     PERFORM                                                      11550008
115600         WITH TEST AFTER                                          11560008
115700         VARYING PV-SQL-SUB                                       11570008
115800         FROM 1 BY 1                                              11580008
115900         UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                      11590008
116000            OR   SQLCODE = +0                                     11600008
116100            OR   SQLCODE = +100)                                  11610008
116200                                                                  11620008
116300         EXEC SQL                                                 11630008
116400              SELECT DEPT_NBR                                     11640008
116500                    ,ENT_ID                                       11650008
116600                INTO :PURCHS-DEPT-NBR                             11660008
116700                    ,:PURCHS-ENT-ID                               11670008
116800                FROM TPURCHS                                      11680008
116900               WHERE PO_NBR         = :AP300-PO-NBR               11690008
117000                 AND VER_STATUS_CDE = 'A'                         11700008
117100         END-EXEC                                                 11710008
117200                                                                  11720008
117300         EVALUATE TRUE                                            11730008
117400             WHEN SQLCODE = +0                                    11740008
117500                  MOVE PURCHS-DEPT-NBR                            11750008
117600                                 TO ASC-DEPT-NBR                  11760008
117700                  MOVE PURCHS-ENT-ID                              11770008
117800                                 TO PV-ENT-ID                     11780008
117900                  PERFORM 4302-GET-VENDOR-NAME                    11790008
118000                                                                  11800008
118100             WHEN SQLCODE = -904                                  11810008
118200             WHEN SQLCODE = -913                                  11820008
118300                  CONTINUE                                        11830008
118400                                                                  11840008
118500             WHEN SQLCODE = +100                                  11850008
118600                 MOVE SPACES  TO  ASC-DEPT-NBR                    11860008
118700                                  ASC-VENDOR-NAME                 11870008
118800                                                                  11880008
118900             WHEN SQLWARN0 NOT = SPACES                           11890008
119000             WHEN SQLCODE < +0                                    11900008
119100             WHEN SQLCODE > +0                                    11910008
119200                  MOVE '4300-READ-ITEMS-FROM-DB'                  11920008
119300                                  TO DP013-PARAGRAPH              11930008
119400                  MOVE 'UNSUCCESSFUL SELECT ON PO HEADER'         11940008
119500                                  TO DP013-MESSAGE-TEXT (1)       11950008
119600                  MOVE SQLCA      TO DP013-SQLCA                  11960008
119700                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     11970008
119800                  SET DP013-DB2-ABEND                             11980008
119900                      DP013-XCTL-DISPLAY-RESTART                  11990008
120000                                  TO TRUE                         12000008
120100                  PERFORM DP013-0000-PROCESS-ABEND                12010008
120200         END-EVALUATE                                             12020008
120300     END-PERFORM.                                                 12030008
120400                                                                  12040008
120500     IF  PV-READ-COUNT > PC-MAX-RETRIES                           12050008
120600         MOVE '4300-READ-ITEMS-FROM-DB'                           12060008
120700                                  TO DP013-PARAGRAPH              12070008
120800         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         12080008
120900                                  TO DP013-MESSAGE-TEXT (1)       12090008
121000         MOVE SQLCA               TO DP013-SQLCA                  12100008
121100         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     12110008
121200         SET DP013-DB2-ABEND      TO TRUE                         12120008
121300         PERFORM DP013-0000-PROCESS-ABEND                         12130008
121400     END-IF.                                                      12140008
121500                                                                  12150008
121600     IF SQLCODE = +0                                              12160008
121700         PERFORM 4305-CONTINUE-DB-ACCESS                          12170008
121800     END-IF.                                                      12180008
121900                                                                  12190008
122200*--------------------------------------------------------------*  12220020
122300* RETRIEVE THE PRIMARY VENDOR NAME                             *  12230020
122400*--------------------------------------------------------------*  12240020
122500 4302-GET-VENDOR-NAME.                                            12250008
122600                                                                  12260008
122700     PERFORM                                                      12270008
122800         WITH TEST AFTER                                          12280008
122900         VARYING PV-READ-COUNT                                    12290008
123000         FROM 1 BY 1                                              12300008
123100         UNTIL ((PV-READ-COUNT > PC-MAX-RETRIES)                  12310008
123200             OR (SQLCODE = +0))                                   12320008
123300                                                                  12330008
123400         EXEC SQL                                                 12340008
123500              SELECT ENT_NAME_DESC                                12350008
123600                INTO :ENTNME-ENT-NAME-DESC                        12360008
123700                FROM TENTNME                                      12370008
123800              WHERE ENT_ID   = :PV-ENT-ID                         12380008
123900                 AND TYPE_CDE = '01'                              12390008
124000         END-EXEC                                                 12400008
124100                                                                  12410008
124200         EVALUATE TRUE                                            12420008
124300             WHEN SQLCODE = +0                                    12430008
124400                  MOVE ENTNME-ENT-NAME-DESC                       12440008
124500                                  TO ASC-VENDOR-NAME              12450008
124600             WHEN SQLCODE = -904                                  12460008
124700             WHEN SQLCODE = -913                                  12470008
124800                  CONTINUE                                        12480008
124900                                                                  12490008
125000             WHEN SQLCODE = +100                                  12500008
125100                  MOVE SPACES  TO  ASC-VENDOR-NAME                12510008
125200                                                                  12520008
125300             WHEN SQLWARN0 NOT = SPACES                           12530008
125400             WHEN SQLCODE < +0                                    12540008
125500             WHEN SQLCODE > +0                                    12550008
125600                  MOVE '4300-READ-ITEMS-FROM-DB'                  12560008
125700                                  TO DP013-PARAGRAPH              12570008
125800                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      12580008
125900                                  TO DP013-MESSAGE-TEXT (1)       12590008
126000                  MOVE SQLCA      TO DP013-SQLCA                  12600008
126100                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     12610008
126200                  SET DP013-DB2-ABEND                             12620008
126300                                  TO TRUE                         12630008
126400                  PERFORM DP013-0000-PROCESS-ABEND                12640008
126500         END-EVALUATE                                             12650008
126600     END-PERFORM.                                                 12660008
126700                                                                  12670008
126800                                                                  12680008
126900     IF  PV-READ-COUNT > PC-MAX-RETRIES                           12690008
127000         MOVE '4300-READ-ITEMS-FROM-DB'                           12700008
127100                                  TO DP013-PARAGRAPH              12710008
127200         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    12720008
127300                                  TO DP013-MESSAGE-TEXT (1)       12730008
127400         MOVE SQLCA               TO DP013-SQLCA                  12740008
127500         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     12750008
127600         SET DP013-DB2-ABEND      TO TRUE                         12760008
127700         PERFORM DP013-0000-PROCESS-ABEND                         12770008
127800     END-IF.                                                      12780008
127900                                                                  12790008
128110*--------------------------------------------------------------*  12811020
128120* CONTINUE TO ACCESS THE DATABASE                              *  12812020
128130*--------------------------------------------------------------*  12813020
128200 4305-CONTINUE-DB-ACCESS.                                         12820008
128300                                                                  12830008
128400     PERFORM                                                      12840008
128500         VARYING PV-READ-COUNT                                    12850008
128600         FROM 1 BY 1                                              12860008
128700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    12870008
128800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         12880008
128900                                                                  12890008
129000         IF  ASC-POLINE-SEQUENCE                                  12900008
129100             PERFORM 4315-FETCH-POLN-CURSOR                       12910008
129200         ELSE                                                     12920008
129300             PERFORM 4310-FETCH-STYLE-CURSOR                      12930008
129400         END-IF                                                   12940008
129500                                                                  12950008
129600         IF  ASC-ITEMS-LEFT-ON-DB                                 12960008
129700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                12970008
129800                 ADD +1            TO ASC-ITEM-SUB                12980008
129900             ELSE                                                 12990008
130000                 ADD +1            TO ASC-BLK-SUB                 13000008
130100                 MOVE +1           TO ASC-ITEM-SUB                13010008
130200                                                                  13020008
130300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         13030008
130400                     MOVE +1       TO ASC-BLK-SUB                 13040008
130500                     SET ASC-BLOCK-MODIFIED (1)                   13050008
130600                                   TO TRUE                        13060008
130700                     PERFORM 5100-WRITE-TEMP-STORAGE              13070008
130800                     MOVE ASC-BLOCK-ENTRIES                       13080008
130900                               (PC-MAX-BLOCKS-IN-ARRAY)           13090008
131000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 13100008
131100                     ADD +1        TO ASC-BLK-SUB                 13110008
131200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   13120008
131300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      13130008
131400                                   TO TRUE                        13140008
131500                 END-IF                                           13150008
131600             END-IF                                               13160008
131700                                                                  13170008
131800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    13180008
131900             MOVE ASC-NUMBER-OF-ITEMS-READ                        13190008
132000                                   TO ASC-LIST-ITEM-NUMBER        13200008
132100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13210008
132200                                                                  13220008
132300             MOVE NINREC-STR-NBR       TO PV-STR-NBR              13230009
132400             MOVE PV-STR-NBR           TO ASC-STORE-NBR           13240009
132500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13250009
132510             MOVE NINREC-DC-NBR        TO PV-DC-NBR               13251010
132520             MOVE PV-DC-NBR            TO ASC-DC-NBR              13252010
132530                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13253010
132600             MOVE NINREC-PO-LNE-NBR                               13260008
132700                                       TO ASC-PO-LNE-NBR          13270008
132800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13280008
132900*            MOVE PURITM-VEND-STYL-NAME                           13290010
133000*                                      TO ASC-VEND-STYL-NAME      13300010
133100*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 13310010
133200             MOVE NINREC-NON-INVC-UNT-QTY                         13320008
133300                                       TO ASC-NON-INVCD-QTY       13330008
133400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13340008
133500             MOVE NINREC-UNT-COST-AMT                             13350008
133600                                       TO ASC-UNIT-COST-AMT       13360008
133700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13370008
133800                                                                  13380008
133900             COMPUTE ASC-EXTENDED-COST (ASC-BLK-SUB ASC-ITEM-SUB) 13390008
134000                 ROUNDED =                                        13400008
134100                     ASC-NON-INVCD-QTY (ASC-BLK-SUB ASC-ITEM-SUB) 13410008
134200                 *   ASC-UNIT-COST-AMT (ASC-BLK-SUB ASC-ITEM-SUB) 13420008
134300                                                                  13430008
134400             MOVE SPACES               TO ASC-CRE-TMST            13440008
134500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13450008
134600             STRING NINREC-REC-TMST(6:2) DELIMITED BY SIZE        13460008
134700                    '/'                  DELIMITED BY SIZE        13470008
134800                    NINREC-REC-TMST(9:2) DELIMITED BY SIZE        13480008
134900                    '/'                  DELIMITED BY SIZE        13490008
135000                    NINREC-REC-TMST(3:2) DELIMITED BY SIZE        13500008
135100                                     INTO ASC-CRE-TMST            13510008
135200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13520008
135300             EVALUATE NINREC-STATUS-CDE                           13530008
135400                 WHEN 'M'                                         13540008
135500                     ADD ASC-EXTENDED-COST                        13550008
135600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13560008
135700                         TO ASC-MATCHED-TOT-COST                  13570008
135800                     MOVE 'MATCHED'     TO ASC-STATUS-CODE        13580008
135900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13590008
136000                 WHEN 'J'                                         13600008
136100                 WHEN 'W'                                         13610008
136200                     ADD ASC-EXTENDED-COST                        13620008
136300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13630008
136400                         TO ASC-JOURNLD-TOT-COST                  13640008
136500                     MOVE 'JOURNLD'     TO ASC-STATUS-CODE        13650008
136600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13660008
136700                 WHEN OTHER                                       13670008
136800                     ADD ASC-EXTENDED-COST                        13680008
136900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13690008
137000                         TO ASC-UNMTCHD-TOT-COST                  13700008
137100                     MOVE 'UNMTCHD'     TO ASC-STATUS-CODE        13710008
137200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13720008
137300             END-EVALUATE                                         13730008
137400         END-IF                                                   13740008
137500     END-PERFORM.                                                 13750008
137600                                                                  13760008
137800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          13780008
137900         MOVE +1                       TO  ASC-BLK-SUB            13790008
138000         PERFORM 5100-WRITE-TEMP-STORAGE                          13800008
138100         ADD +1                        TO  ASC-BLK-SUB            13810008
138200         PERFORM 5100-WRITE-TEMP-STORAGE                          13820008
138300                                                                  13830008
138400         MOVE 1                        TO  ASC-BLK-SUB            13840008
138500                                           PV-BLOCK-NUMBER        13850008
138600         PERFORM 4410-READ-TEMP-STORAGE                           13860008
138700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             13870008
138800             MOVE 2                    TO  ASC-BLK-SUB            13880008
138900                                           PV-BLOCK-NUMBER        13890008
139000             PERFORM 4410-READ-TEMP-STORAGE                       13900008
139100         END-IF                                                   13910008
139200     END-IF.                                                      13920008
139300                                                                  13930008
139500*--------------------------------------------------------------*  13950020
139600* FETCH THE NON-INVOICED RECEIPTS (A/P) STYLE CURSOR           *  13960020
139700*--------------------------------------------------------------*  13970020
139900 4310-FETCH-STYLE-CURSOR.                                         13990008
140000                                                                  14000008
140100     PERFORM                                                      14010008
140200         WITH TEST AFTER                                          14020008
140300         VARYING PV-SQL-SUB                                       14030008
140400         FROM 1 BY 1                                              14040008
140500         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             14050008
140600            OR SQLCODE = 0                                        14060008
140700            OR SQLCODE = +100                                     14070008
140800                                                                  14080008
140900         EXEC SQL                                                 14090008
141000              FETCH RECEIPT_STYLE_CSR                             14100008
141100              INTO  :PV-STATUS-CODE                               14110008
141200                   ,:NINREC-PO-NBR                                14120008
141300                   ,:NINREC-PO-LNE-NBR                            14130008
141400                   ,:NINREC-STR-NBR                               14140008
141500                   ,:NINREC-NON-INVC-UNT-QTY                      14150008
141600                   ,:NINREC-UNT-COST-AMT                          14160008
141700                   ,:NINREC-REC-TMST                              14170008
141800                   ,:NINREC-STATUS-CDE                            14180008
141900                   ,:PURITM-VEND-STYL-NAME                        14190008
141910                   ,:NINREC-DC-NBR                                14191012
142000         END-EXEC                                                 14200008
142100                                                                  14210008
142200         EVALUATE TRUE                                            14220008
142300             WHEN SQLCODE = ZERO                                  14230008
142400             WHEN SQLCODE = +100                                  14240008
142500             WHEN SQLCODE = -904                                  14250008
142600             WHEN SQLCODE = -913                                  14260008
142700                  CONTINUE                                        14270008
142800             WHEN SQLWARN0 NOT EQUAL SPACE                        14280008
142900             WHEN SQLCODE NOT EQUAL ZERO                          14290008
143000                  MOVE '4310-FETCH-STYLE-CURSOR'                  14300008
143100                               TO  DP013-PARAGRAPH                14310008
143200                  MOVE 'FETCH RECEIPT STYLE CURSOR'               14320008
143300                               TO  DP013-MESSAGE-TEXT (1)         14330008
143400                  MOVE SQLCA   TO  DP013-SQLCA                    14340008
143500                  SET DP013-DB2-ABEND                             14350008
143600                               TO  TRUE                           14360008
143700                  PERFORM DP013-0000-PROCESS-ABEND                14370008
143800         END-EVALUATE                                             14380008
143900     END-PERFORM.                                                 14390008
144000                                                                  14400008
144100     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   14410008
144200         MOVE '4310-FETCH-STYLE-CURSOR'                           14420008
144300                               TO  DP013-PARAGRAPH                14430008
144400         MOVE 'MAX RETRIES EXCEEDED FOR FETCH STYLE CURSOR'       14440008
144500                               TO  DP013-MESSAGE-TEXT (1)         14450008
144600         MOVE SQLCA            TO  DP013-SQLCA                    14460008
144700         SET DP013-DB2-ABEND   TO  TRUE                           14470008
144800         PERFORM DP013-0000-PROCESS-ABEND                         14480008
144900     END-IF.                                                      14490008
145000                                                                  14500008
145100     IF  SQLCODE EQUAL +100                                       14510008
145200         SET ASC-NO-ITEMS-LEFT-ON-DB                              14520008
145300                               TO  TRUE                           14530008
145400     END-IF.                                                      14540008
145500                                                                  14550008
145700*--------------------------------------------------------------*  14570020
145800* FETCH THE NON-INVOICED RECEIPTS (A/P) PO LINE NUMBER CURSOR  *  14580020
145900*--------------------------------------------------------------*  14590020
146100 4315-FETCH-POLN-CURSOR.                                          14610008
146200                                                                  14620008
146300     PERFORM                                                      14630008
146400         WITH TEST AFTER                                          14640008
146500         VARYING PV-SQL-SUB                                       14650008
146600         FROM 1 BY 1                                              14660008
146700         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             14670008
146800            OR SQLCODE = 0                                        14680008
146900            OR SQLCODE = +100                                     14690008
147000                                                                  14700008
147100         EXEC SQL                                                 14710008
147200              FETCH RECEIPT_POLN_CSR                              14720008
147300              INTO  :PV-STATUS-CODE                               14730008
147400                   ,:NINREC-PO-NBR                                14740008
147500                   ,:NINREC-PO-LNE-NBR                            14750008
147600                   ,:NINREC-STR-NBR                               14760008
147700                   ,:NINREC-NON-INVC-UNT-QTY                      14770008
147800                   ,:NINREC-UNT-COST-AMT                          14780008
147900                   ,:NINREC-REC-TMST                              14790008
148000                   ,:NINREC-STATUS-CDE                            14800008
148100                   ,:PURITM-VEND-STYL-NAME                        14810008
148110                   ,:NINREC-DC-NBR                                14811012
148200         END-EXEC                                                 14820008
148300                                                                  14830008
148400         EVALUATE TRUE                                            14840008
148500             WHEN SQLCODE = ZERO                                  14850008
148600             WHEN SQLCODE = +100                                  14860008
148700             WHEN SQLCODE = -904                                  14870008
148800             WHEN SQLCODE = -913                                  14880008
148900                  CONTINUE                                        14890008
149000             WHEN SQLWARN0 NOT EQUAL SPACE                        14900008
149100             WHEN SQLCODE NOT EQUAL ZERO                          14910008
149200                  MOVE '4315-FETCH-POLN-CURSOR'                   14920008
149300                               TO  DP013-PARAGRAPH                14930008
149400                  MOVE 'FETCH RECEIPT PO LINE NR CURSOR'          14940008
149500                               TO  DP013-MESSAGE-TEXT (1)         14950008
149600                  MOVE SQLCA   TO  DP013-SQLCA                    14960008
149700                  SET DP013-DB2-ABEND                             14970008
149800                               TO  TRUE                           14980008
149900                  PERFORM DP013-0000-PROCESS-ABEND                14990008
150000         END-EVALUATE                                             15000008
150100     END-PERFORM.                                                 15010008
150200                                                                  15020008
150300     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   15030008
150400         MOVE '4315-FETCH-POLN-CURSOR'                            15040008
150500                               TO  DP013-PARAGRAPH                15050008
150600         MOVE 'MAX RETRIES EXCEEDED FOR FETCH PO LINE NR CURSOR'  15060008
150700                               TO  DP013-MESSAGE-TEXT (1)         15070008
150800         MOVE SQLCA            TO  DP013-SQLCA                    15080008
150900         SET DP013-DB2-ABEND   TO  TRUE                           15090008
151000         PERFORM DP013-0000-PROCESS-ABEND                         15100008
151100     END-IF.                                                      15110008
151200                                                                  15120008
151300     IF  SQLCODE EQUAL +100                                       15130008
151400         SET ASC-NO-ITEMS-LEFT-ON-DB                              15140008
151500                               TO  TRUE                           15150008
151600     END-IF.                                                      15160008
151700                                                                  15170008
152000*--------------------------------------------------------------*  15200020
152100* FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.            *  15210020
152200*--------------------------------------------------------------*  15220020
152400 4400-MOVE-COMMAREA-TO-SCREEN.                                    15240008
152500                                                                  15250008
152600     MOVE ASC-KEY-PO-NBR-9       TO PV-PO-NBR.                    15260008
152700     MOVE PV-PO-NBR              TO APONBRO.                      15270008
152800     MOVE ASC-VENDOR-NAME        TO AVENDRO.                      15280008
152900     MOVE ASC-DEPT-NBR           TO ADEPTO.                       15290008
153000     MOVE ASC-UNMTCHD-TOT-COST   TO AUNMTOTO.                     15300008
153100     MOVE ASC-MATCHED-TOT-COST   TO AMATTOTO.                     15310008
153200     MOVE ASC-JOURNLD-TOT-COST   TO AJRNTOTO.                     15320008
153300                                                                  15330008
153400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15340008
153500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15350008
153600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15360008
153700             MOVE +1               TO ASC-BLK-SUB                 15370008
153800             PERFORM 5100-WRITE-TEMP-STORAGE                      15380008
153900             ADD +1                TO ASC-BLK-SUB                 15390008
154000             PERFORM 5100-WRITE-TEMP-STORAGE                      15400008
154100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15410008
154200                 GIVING PV-BLOCK-NUMBER                           15420008
154300                 REMAINDER PV-REMAINDER                           15430008
154400             IF  PV-REMAINDER > ZERO                              15440008
154500                 ADD +1            TO PV-BLOCK-NUMBER             15450008
154600             END-IF                                               15460008
154700             MOVE +1               TO ASC-BLK-SUB                 15470008
154800             PERFORM 4410-READ-TEMP-STORAGE                       15480008
154900             ADD +1                TO ASC-BLK-SUB                 15490008
155000                                      PV-BLOCK-NUMBER             15500008
155100             PERFORM 4410-READ-TEMP-STORAGE                       15510008
155200     END-IF.                                                      15520008
155300                                                                  15530008
155400     MOVE +1                       TO ASC-BLK-SUB.                15540008
155500                                                                  15550008
155600     COMPUTE ASC-ITEM-SUB =                                       15560008
155700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              15570008
155800         + PC-ITEMS-PER-PANEL).                                   15580008
155900                                                                  15590008
156000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15600008
156100         ADD +1                    TO ASC-BLK-SUB                 15610008
156200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15620008
156300     END-IF.                                                      15630008
156400                                                                  15640008
156500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15650008
156600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15660008
156700                                                                  15670008
156800     PERFORM 4420-FORMAT-LIST-LINES                               15680008
156900         VARYING PS-SUB                                           15690008
157000         FROM PC-ITEMS-PER-PANEL BY -1                            15700008
157100         UNTIL PS-SUB < +1.                                       15710008
157200                                                                  15720008
157300     COMPUTE ASC-ITEMS-DISPLAYED =                                15730008
157400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15740008
157500                                                                  15750008
157600     IF PS-NO-START-ITEM-ERROR                                    15760008
157700         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL15770008
157800                                          ASTRTITO                15780008
157900         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  15790008
158000     ELSE                                                         15800008
158100         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                15810008
158200     END-IF.                                                      15820008
158300                                                                  15830008
158400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    15840008
158500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    15850008
158600                                                                  15860008
158700     IF  DP020-MSG-NUMBER-X = SPACE                               15870008
158800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  15880008
158900*            --- MORE ITEMS TO DISPLAY ----                       15890008
159000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            15900008
159100             SET DP020-MSG-INFORMATIONAL                          15910008
159200                                   TO TRUE                        15920008
159300         END-IF                                                   15930008
159400     END-IF.                                                      15940008
159500                                                                  15950008
159600*--------------------------------------------------------------*  15960020
159700* READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          *  15970020
159800*--------------------------------------------------------------*  15980020
160000 4410-READ-TEMP-STORAGE.                                          16000008
160100                                                                  16010008
160200     EXEC CICS                                                    16020008
160300         READQ TS                                                 16030008
160400             QUEUE (ASC-LIST-QUEUE-NAME)                          16040008
160500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16050008
160600             ITEM  (PV-BLOCK-NUMBER)                              16060008
160700             RESP  (PV-CICS-RESP)                                 16070008
160800     END-EXEC.                                                    16080008
160900                                                                  16090008
161000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       16100008
161100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     16110008
161200         CONTINUE                                                 16120008
161300     ELSE                                                         16130008
161400         SET DP013-CICS-ABEND TO  TRUE                            16140008
161500         SET DP013-NO-ROLLBACK TO  TRUE                           16150008
161600         MOVE '4410-READ-TEMP-STORAGE'                            16160008
161700                               TO  DP013-PARAGRAPH                16170008
161800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      16180008
161900                               TO  DP013-MESSAGE-TEXT(1)          16190008
162000         PERFORM DP013-0000-PROCESS-ABEND                         16200008
162100     END-IF.                                                      16210008
162200                                                                  16220008
162300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             16230008
162400                                                                  16240008
162500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         16250008
162600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               16260008
162700     END-IF.                                                      16270008
162800                                                                  16280020
162900*--------------------------------------------------------------*  16290020
163000* PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.     *  16300020
163100*--------------------------------------------------------------*  16310020
163300 4420-FORMAT-LIST-LINES.                                          16330008
163400                                                                  16340008
163500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16350008
163600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16360008
163700         MOVE SPACES    TO MR-STORE-NBR          (PS-SUB)         16370008
163800                           MR-PO-LNE-NBR         (PS-SUB)         16380008
163810                           MR-DC-NBR             (PS-SUB)         16381010
163900*                          MR-VEND-STYL-NAME     (PS-SUB)         16390010
164000                           MR-NON-INVCD-QTY      (PS-SUB)         16400008
164100                           MR-UNIT-COST-AMT      (PS-SUB)         16410008
164200                           MR-EXTENDED-COST      (PS-SUB)         16420008
164300                           MR-CRE-TMST           (PS-SUB)         16430008
164400                           MR-STATUS-CODE        (PS-SUB)         16440008
164500     ELSE                                                         16450008
164600         MOVE ASC-STORE-NBR       (ASC-BLK-SUB ASC-ITEM-SUB)      16460009
164700                        TO MR-STORE-NBR-9      (PS-SUB)           16470008
164800                                                                  16480008
164900         MOVE ASC-PO-LNE-NBR      (ASC-BLK-SUB ASC-ITEM-SUB)      16490008
165000                        TO MR-PO-LNE-NBR-9     (PS-SUB)           16500008
165100                                                                  16510008
165110         MOVE ASC-DC-NBR          (ASC-BLK-SUB ASC-ITEM-SUB)      16511010
165120                        TO MR-DC-NBR-9         (PS-SUB)           16512015
165200*        MOVE ASC-VEND-STYL-NAME  (ASC-BLK-SUB ASC-ITEM-SUB)      16520010
165300*                       TO MR-VEND-STYL-NAME   (PS-SUB)           16530010
165400                                                                  16540008
165500         MOVE ASC-NON-INVCD-QTY   (ASC-BLK-SUB ASC-ITEM-SUB)      16550008
165600                        TO MR-NON-INVCD-QTY-9  (PS-SUB)           16560008
165700                                                                  16570008
165800         MOVE ASC-UNIT-COST-AMT   (ASC-BLK-SUB ASC-ITEM-SUB)      16580008
165900                        TO MR-UNIT-COST-AMT-9  (PS-SUB)           16590008
166000                                                                  16600008
166100         MOVE ASC-EXTENDED-COST   (ASC-BLK-SUB ASC-ITEM-SUB)      16610008
166200                        TO MR-EXTENDED-COST-9  (PS-SUB)           16620008
166300                                                                  16630008
166400         MOVE ASC-CRE-TMST        (ASC-BLK-SUB ASC-ITEM-SUB)      16640008
166500                        TO MR-CRE-TMST         (PS-SUB)           16650008
166600         MOVE ASC-STATUS-CODE     (ASC-BLK-SUB ASC-ITEM-SUB)      16660008
166700                        TO MR-STATUS-CODE      (PS-SUB)           16670008
166800     END-IF.                                                      16680008
166900                                                                  16690008
167000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16700008
167100     IF  ASC-ITEM-SUB < + 1                                       16710008
167200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  16720008
167300         MOVE +1                 TO ASC-BLK-SUB                   16730008
167400     END-IF.                                                      16740008
167500                                                                  16750020
167600*--------------------------------------------------------------*  16760020
167700* WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       *  16770020
167800* REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.     *  16780020
167900*--------------------------------------------------------------*  16790020
168100 5100-WRITE-TEMP-STORAGE.                                         16810008
168200                                                                  16820008
168300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     16830008
168400                                   TO PV-LIST-ITEM-NUMBER.        16840008
168500     COMPUTE PV-BLOCK-NUMBER =                                    16850008
168600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16860008
168700                                                                  16870008
168800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             16880008
168900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             16890008
169000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      16900008
169100             PERFORM 5105-REWRITE-ASC-LISTQ                       16910008
169200         END-IF                                                   16920008
169300     ELSE                                                         16930008
169400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       16940008
169500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            16950008
169600         PERFORM 5110-WRITE-ASC-LISTQ                             16960008
169700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   16970008
169800     END-IF.                                                      16980008
169900                                                                  16990008
170000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      17000008
170100                                   TO TRUE.                       17010008
170200                                                                  17020008
170400*--------------------------------------------------------------*  17040020
170500* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    *  17050020
170600* SPECIFIC COMMAREA.                                           *  17060020
170700*--------------------------------------------------------------*  17070020
170800 5105-REWRITE-ASC-LISTQ.                                          17080008
170900                                                                  17090008
171000     EXEC CICS                                                    17100008
171100         WRITEQ TS                                                17110008
171200             QUEUE (ASC-LIST-QUEUE-NAME)                          17120008
171300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17130008
171400             ITEM  (PV-BLOCK-NUMBER)                              17140008
171500             REWRITE                                              17150008
171600             RESP  (PV-CICS-RESP)                                 17160008
171700     END-EXEC.                                                    17170008
171800                                                                  17180008
171900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           17190008
172000         CONTINUE                                                 17200008
172100     ELSE                                                         17210008
172200         SET DP013-CICS-ABEND      TO TRUE                        17220008
172300         SET DP013-NO-ROLLBACK     TO TRUE                        17230008
172400         MOVE '5105-REWRITE-ASC-LISTQ'                            17240008
172500                                   TO DP013-PARAGRAPH             17250008
172600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     17260008
172700                                   TO DP013-MESSAGE-TEXT(1)       17270008
172800         PERFORM DP013-0000-PROCESS-ABEND                         17280008
172900     END-IF.                                                      17290008
173000                                                                  17300008
173200*--------------------------------------------------------------*  17320020
173300* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      *  17330020
173400* SPECIFIC COMMAREA.                                           *  17340020
173500*--------------------------------------------------------------*  17350020
173600 5110-WRITE-ASC-LISTQ.                                            17360008
173700                                                                  17370008
173800     EXEC CICS                                                    17380008
173900         WRITEQ TS                                                17390008
174000             QUEUE (ASC-LIST-QUEUE-NAME)                          17400008
174100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17410008
174200             ITEM  (PV-BLOCK-NUMBER)                              17420008
174300             RESP  (PV-CICS-RESP)                                 17430008
174400     END-EXEC.                                                    17440008
174500                                                                  17450008
174600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      17460008
174700         SET DP013-CICS-ABEND      TO TRUE                        17470008
174800         SET DP013-NO-ROLLBACK     TO TRUE                        17480008
174900         MOVE '5110-WRITE-ASC-LISTQ'                              17490008
175000                                   TO DP013-PARAGRAPH             17500008
175100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           17510008
175200                                   TO DP013-MESSAGE-TEXT(1)       17520008
175300         PERFORM DP013-0000-PROCESS-ABEND                         17530008
175400     END-IF.                                                      17540008
175500                                                                  17550008
175600*--------------------------------------------------------------*  17560020
175700* ABEND PROCESSOR MODULE                                       *  17570020
175800*--------------------------------------------------------------*  17580020
176000     COPY DPPD013.                                                17600008
176100                                                                  17610020
