000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.         RCKUT192.                                    00040000
000500 AUTHOR.             DENISE HAHN.                                 00050000
000600 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00060000
000700 DATE-WRITTEN.       FEBRUARY 2022.                               00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000******************************************************************00100000
001100* THIS IS A COPY OF RCKUT162 - USES PARM INSTEAD OF HARDCODED    *00110000
001110* JOB/PROGRAM                                                   * 00111003
001111*                                                                *00111100
001112* THIS PROGRAM PREPARES THE FILE TO BE SENT FROM RECEIVERS       *00111200
001113* CREATED BY THIRD PARTY (RCKUP072) TO HAVE THE DATA SENT TO     *00111300
001114* RMS PO UNDER THE DB2 CHECKPOINT RESTART SYSTEM. (RCKUP073)     *00111401
001115*                                                                *00111500
001116* THE PROGRAM READS THE 3WD RECEIVERS DATA FILE,                 *00111600
001117* REFORMATS THE RECORDS AND SETS A CHECKPOINT INDICATOR ON THE   *00111700
001118* RECORD BASED ON HOW CHECKPOINTS WILL BE TAKEN BY THE LOGICAL   *00111800
001119* TRANSACTION METHOD.                                            *00111900
001120* AFTER A RECORD HAS BEEN REFORMATTED IT IS PASSED TO THE        *00112000
001130* TRANSACTION PREPARATION MODULE (DPKUT900) WHICH DOES SOME MORE *00113000
001140* PROCESSING ON THE RECORDS AND WRITES THE REFORMATTED RECORDS   *00114000
001150* OUT TO A SEQUENTIAL FILE.                                      *00115000
001160*                                                                *00116000
001170* THE PROGRAM COMMUNICATES WITH THE TRANSACTION PREPARATION      *00117000
001180* MODULE USING FUNCTION CODES (OPEN, WRITE, & CLOSE) AND CHECKS  *00118000
001190* THE RETURN CODE AFTER EACH REQUEST.  IF AN INVALID RETURN CODE *00119000
001200* IS RECEIVED, ANY INFORMATION THAT MAY BE HELPFUL IN RESOLVING  *00120000
001300* THE BAD RETURN CODE IS DISPLAYED ON SYSOUT AND THE PROGRAM     *00130000
001400* ABENDS.                                                        *00140000
001500* INPUT FILE:   PO-RCVR-OPER-FILE              DDNAME = INP01    *00150003
001600*                                                                *00160000
001700* OUTPUT FILES: PO-RCVR-OPER-TRNSPREP-FILE     DDNAME = OUT01    *00170001
001800*                                                                *00180000
001900******************************************************************00190000
002000                                                                  00200000
002100******************************************************************00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300******************************************************************00230000
002400                                                                  00240000
002500 CONFIGURATION SECTION.                                           00250000
002600                                                                  00260000
002700 SOURCE-COMPUTER.    IBM-3090.                                    00270000
002800 OBJECT-COMPUTER.    IBM-3090.                                    00280000
002900                                                                  00290000
003000 INPUT-OUTPUT SECTION.                                            00300000
003100                                                                  00310000
003200 FILE-CONTROL.                                                    00320000
003300                                                                  00330000
003400     SELECT PO-RCVR-OPER-FILE ASSIGN TO INP01.                    00340003
003500                                                                  00350000
003600******************************************************************00360000
003700 DATA DIVISION.                                                   00370000
003800******************************************************************00380000
003900                                                                  00390000
004000 FILE SECTION.                                                    00400000
004100                                                                  00410000
004200 FD  PO-RCVR-OPER-FILE                                            00420003
004300     RECORDING MODE IS F                                          00430000
004400     BLOCK CONTAINS 0 RECORDS                                     00440000
004500     LABEL RECORDS ARE OMITTED.                                   00450000
004600                                                                  00460000
004700 01  PO-RCVR-OPER-RECORD         PIC  X(125).                     00470003
004800                                                                  00480000
004900 WORKING-STORAGE SECTION.                                         00490000
005000                                                                  00500000
005100 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00510000
005200                                                                  00520000
005300******************************************************************00530000
005400*PC - PROGRAM CONSTANTS                                           00540000
005500******************************************************************00550000
005600 01  PROGRAM-CONSTANTS.                                           00560000
005700     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'RCKUT192'. 00570000
005800     05  PC-TRAN-PREP-FUNC-CODES.                                 00580000
005900         10  PC-TRAN-PREP-FUNC-OPEN                               00590000
006000                                 PIC X(05)      VALUE 'OPEN '.    00600000
006100         10  PC-TRAN-PREP-FUNC-WRITE                              00610000
006200                                 PIC X(05)      VALUE 'WRITE'.    00620000
006300         10  PC-TRAN-PREP-FUNC-CLOSE                              00630000
006400                                 PIC X(05)      VALUE 'CLOSE'.    00640000
006500     05  PC-JOB-NAME             PIC X(08)      VALUE SPACES.     00650000
006600     05  PC-PLAN-NAME            PIC X(08)      VALUE 'RCKUP073'. 00660001
006700     05  PC-TRANS-RECORD-LENGTH  PIC S9(04)     VALUE +125 COMP.  00670000
006800                                                                  00680000
006900******************************************************************00690000
007000*PV - PROGRAM VARIABLES                                           00700000
007100******************************************************************00710000
007200 01  PROGRAM-VARIABLES.                                           00720000
007300     05  PV-CHECKPOINT-TYPE      PIC X(01)      VALUE SPACE.      00730000
007400         88  CONTROL-BREAK                      VALUE 'C'.        00740000
007500         88  LOGICAL-TRANSACTION                VALUE 'L'.        00750000
007600         88  TIME-INTERVAL                      VALUE 'T'.        00760000
007700         88  REQUESTED-BY-PROGRAM               VALUE 'R'.        00770000
007710     05  PV-CURRENT-DATE        PIC X(10).                        00771002
007800                                                                  00780000
007900******************************************************************00790000
008000*PA - PROGRAM ACCUMULATORS                                        00800000
008100******************************************************************00810000
008200 01  PROGRAM-ACCUMULATORS.                                        00820000
008300     05  PA-INPUT-RECORDS-READ   PIC S9(11)     COMP-3 VALUE 0.   00830000
008400     05  PA-OUTPUT-RECS-WRITTEN  PIC S9(11)     COMP-3 VALUE 0.   00840000
008500                                                                  00850000
008600******************************************************************00860000
008700*PS - PROGRAM SWITCHES                                            00870000
008800******************************************************************00880000
008900 01  PROGRAM-SWITCHES.                                            00890000
009000     05  PS-INPUT-EOF-SW         PIC X(01)      VALUE 'N'.        00900000
009100         88  PS-INPUT-EOF                       VALUE 'Y'.        00910000
009200     05  PS-FIRST-TRANS-READ-SW  PIC X(01)      VALUE 'Y'.        00920000
009300         88  FIRST-TRANS-READ                   VALUE 'Y'.        00930000
009400     05  PS-DETAIL-FOUND-SW      PIC X(01)      VALUE 'N'.        00940000
009500         88  PS-DETAIL-FOUND                    VALUE 'Y'.        00950000
009600         88  PS-DETAIL-NOT-FOUND                VALUE 'N'.        00960000
009700                                                                  00970000
009800******************************************************************00980000
009900*  INPUT LAYOUT                                                  *00990001
010000******************************************************************01000000
010100     COPY RCRD095.                                                01010000
010200                                                                  01020000
010300******************************************************************01030000
010400*  TRANSACTION PREPARATION MODULE LINKAGE SECTION                *01040000
010500******************************************************************01050000
010600     COPY DPWS990.                                                01060000
010700                                                                  01070000
010800     COPY DPLS000.                                                01080000
010900                                                                  01090000
011000******************************************************************01100000
011100*  SQL COMMUNICATIONS WORK AREA                                  *01110000
011200****************************************************************  01120000
011210     EXEC SQL                                                     01121002
011220         INCLUDE SQLCA                                            01122002
011230     END-EXEC.                                                    01123002
011300     COPY SQLCA2.                                                 01130000
011400                                                                  01140000
011500******************************************************************01150000
011600 PROCEDURE DIVISION.                                              01160000
011700******************************************************************01170000
011800* A100-MAINLINE-PROCESSING                                        01180000
011900*    CONTROLS FLOW OF THE PROGRAM                                *01190000
012000******************************************************************01200000
012100 A100-MAINLINE-PROCESSING.                                        01210000
012200                                                                  01220000
012202     ACCEPT PC-JOB-NAME FROM SYSIN.                               01220200
012220                                                                  01222002
012230     EXEC SQL                                                     01223002
012240          SET :PV-CURRENT-DATE = CURRENT DATE                     01224002
012250     END-EXEC.                                                    01225002
012260                                                                  01226002
012300     PERFORM B100-INITIALIZE.                                     01230000
012400                                                                  01240000
012500     PERFORM B200-PROCESS-INPUT-FILE                              01250000
012600         UNTIL PS-INPUT-EOF.                                      01260000
012700                                                                  01270000
012800     PERFORM B300-END-OF-JOB-ROUTINE.                             01280000
012900                                                                  01290000
013000     GOBACK.                                                      01300000
013100                                                                  01310000
013200******************************************************************01320000
013300* B100-INITIALIZE                                                *01330000
013400******************************************************************01340000
013500 B100-INITIALIZE.                                                 01350000
013600                                                                  01360000
013700     PERFORM C100-ISSUE-OPEN-REQUEST.                             01370000
013800                                                                  01380000
013900     OPEN INPUT PO-RCVR-OPER-FILE.                                01390003
014000                                                                  01400000
014100     DISPLAY '**********************'.                            01410000
014200     DISPLAY '   RCKUT192 MESSAGES  '.                            01420000
014300     DISPLAY '**********************'.                            01430000
014400                                                                  01440000
014500     PERFORM C200-READ-INPUT-FILE                                 01450000
014600       UNTIL PS-DETAIL-FOUND                                      01460000
014700          OR PS-INPUT-EOF.                                        01470000
014800                                                                  01480000
014900     IF PS-INPUT-EOF                                              01490000
015000         DISPLAY ' '                                              01500000
015100         DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME          01510000
015200         DISPLAY 'INPUT FILE FILE HAS NO RECORDS'                 01520001
015300         DISPLAY ' '                                              01530000
015400     END-IF.                                                      01540000
015500                                                                  01550000
015600******************************************************************01560000
015700* B200-PROCESS-INPUT-FILE                                        *01570000
015800*     READ A INPUT FILE RECORD.                                  *01580001
015900*     IF END-OF-FILE, STOP PROCESSING.                           *01590000
016000*     IF A RECORD IS READ, GATHER WHATEVER OTHER DATA IS         *01600000
016100*     NECESSARY TO TAKE CHECKPOINTS BASED ON THE TYPE OF         *01610000
016200*     CHECKPOINTS BEING TAKEN BY RCKUP065 AND ISSUE A WRITE      *01620000
016300*     REQUEST TO THE TRANSACTION PREPARATION PROGRAM.            *01630000
016400******************************************************************01640000
016500 B200-PROCESS-INPUT-FILE.                                         01650000
016600                                                                  01660000
016700     IF FIRST-TRANS-READ                                          01670000
016800         MOVE 'N' TO PS-FIRST-TRANS-READ-SW                       01680000
016900     END-IF.                                                      01690000
017000                                                                  01700000
017100     IF CONTROL-BREAK                                             01710000
017200         PERFORM C300-CKPT-BY-CNTL-BREAK                          01720000
017300     ELSE                                                         01730000
017400         IF LOGICAL-TRANSACTION                                   01740000
017500             PERFORM C400-CKPT-BY-LOGICAL-TRANS                   01750000
017600         ELSE                                                     01760000
017700             PERFORM C500-CKPT-BY-TIME-OR-REQUEST                 01770000
017800         END-IF                                                   01780000
017900     END-IF.                                                      01790000
018000                                                                  01800000
018100     SET PS-DETAIL-NOT-FOUND  TO TRUE.                            01810000
018200                                                                  01820000
018300     PERFORM C200-READ-INPUT-FILE                                 01830000
018400       UNTIL PS-DETAIL-FOUND                                      01840000
018500          OR PS-INPUT-EOF.                                        01850000
018600                                                                  01860000
018700                                                                  01870000
018800******************************************************************01880000
018900* B300-END-OF-JOB-ROUTINE                                        *01890000
019000*                                                                *01900000
019100*                                                                *01910000
019200******************************************************************01920000
019300 B300-END-OF-JOB-ROUTINE.                                         01930000
019400                                                                  01940000
019500     CLOSE PO-RCVR-OPER-FILE.                                     01950003
019600                                                                  01960000
019700     DISPLAY ' '.                                                 01970000
019800     DISPLAY 'NUMBER OF INPUT RECORDS READ:             '         01980001
019900             PA-INPUT-RECORDS-READ.                               01990000
020000     DISPLAY 'NUMBER OF TRANS/PREP RECORDS WRITTEN:     '         02000000
020100             PA-OUTPUT-RECS-WRITTEN.                              02010000
020200     DISPLAY ' '.                                                 02020000
020300                                                                  02030000
020400     PERFORM C600-ISSUE-CLOSE-REQUEST.                            02040000
020500                                                                  02050000
020600******************************************************************02060000
020700* C100-ISSUE-OPEN-REQUEST                                        *02070000
020800*     ISSUE AN 'OPEN' REQUEST TO THE TRANSACTION PREPARATION     *02080000
020900*     MODULE.                                                    *02090000
021000******************************************************************02100000
021100 C100-ISSUE-OPEN-REQUEST.                                         02110000
021200                                                                  02120000
021300     MOVE PC-TRAN-PREP-FUNC-OPEN TO DP000-FUNC-CODE.              02130000
021400     MOVE PC-JOB-NAME            TO DP000-JOB-NAME.               02140000
021500     MOVE PC-PLAN-NAME           TO DP000-PLAN-NAME.              02150000
021600                                                                  02160000
021700     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         02170000
021800                                                                  02180000
021900     MOVE DP000-CKPT-TYPE-CODE   TO PV-CHECKPOINT-TYPE.           02190000
022000                                                                  02200000
022100******************************************************************02210000
022200* C200-READ-INPUT-FILE                                           *02220000
022300***  THE HEADER AND TRAILER CHECKS SHOULD NEVER BE HIT.  PROGRAM *02230000
022400***  RVKRP030 WILL STRIP THEM OUT AND ONLY PASS THE DETAIL       *02240000
022500***  RECORDS TO THIS PROGRAM.                                    *02250000
022600******************************************************************02260000
022700 C200-READ-INPUT-FILE.                                            02270000
022800                                                                  02280000
022900     READ PO-RCVR-OPER-FILE        INTO RC095-TRKG-REC            02290003
023000         AT END                                                   02300000
023100             SET PS-INPUT-EOF TO TRUE.                            02310000
023200                                                                  02320000
023300                                                                  02330000
023400     IF PS-INPUT-EOF                                              02340000
023500         CONTINUE                                                 02350000
023600     ELSE                                                         02360000
023700         ADD +1 TO PA-INPUT-RECORDS-READ                          02370000
023800         SET PS-DETAIL-FOUND     TO TRUE                          02380000
023900     END-IF.                                                      02390000
024000                                                                  02400000
024100                                                                  02410000
024200******************************************************************02420000
024300* C300-CKPT-BY-CNTL-BREAK                                        *02430000
024400*     THIS ROUTINE SETS THE CHECKPOINT INDICATOR ON THE TRANSAC- *02440000
024500*     TION RECORD "ON" FOR EACH RECORD IN CASE THE CHECKPOINT    *02450000
024600*     CONTROL FILE IS EVER CHANGED TO TAKE CHECKPOINTS BY        *02460000
024700*     CONTROL BREAK.                                             *02470000
024800*     AFTER THE TRANSACTION RECORD HAS BEEN FORMATTED, A WRITE   *02480000
024900*     REQUEST IS ISSUED TO THE TRANSACTION PREPARATION MODULE.   *02490000
025000******************************************************************02500000
025100 C300-CKPT-BY-CNTL-BREAK.                                         02510000
025200                                                                  02520000
025300     MOVE 'Y'                     TO DP000-CHECKPOINT-IND.        02530000
025400     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      02540000
025500     MOVE RC095-TRKG-REC          TO DP000-TRANS-REC.             02550000
025600     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             02560000
025700     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              02570000
025800     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             02580000
025900                                                                  02590000
026000     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         02600000
026100     ADD +1 TO PA-OUTPUT-RECS-WRITTEN.                            02610000
026200                                                                  02620000
026300******************************************************************02630000
026400* C400-CKPT-BY-LOGICAL-TRANS.                                    *02640000
026500*                                                                *02650000
026600*     THIS ROUTINE SETS THE CHECKPOINT INDICATOR ON THE          *02660000
026700*     TRANSACTION RECORD "ON".  THE UPDATE PROGRAM WILL CHECK    *02670000
026800*     THE CHECKPOINT FREQUENCY TO KNOW WHETHER A CHECKPOINT      *02680000
026900*     SHOULD BE TAKEN.                                           *02690000
027000*                                                                *02700000
027100*     AFTER THE TRANSACTION RECORD HAS BEEN FORMATTED, A WRITE   *02710000
027200*     REQUEST IS ISSUED TO THE TRANSACTION PREPARATION MODULE.   *02720000
027300******************************************************************02730000
027400 C400-CKPT-BY-LOGICAL-TRANS.                                      02740000
027500                                                                  02750000
027600     MOVE 'Y'                     TO DP000-CHECKPOINT-IND.        02760000
027700     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      02770000
027800     MOVE RC095-TRKG-REC          TO DP000-TRANS-REC.             02780000
027900     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             02790000
028000     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              02800000
028100     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             02810000
028200                                                                  02820000
028300     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         02830000
028400     ADD +1 TO PA-OUTPUT-RECS-WRITTEN.                            02840000
028500                                                                  02850000
028600******************************************************************02860000
028700* C500-CKPT-BY-TIME-OR-REQUEST.                                  *02870000
028800*     THIS ROUTINE BUILDS THE TRANSACTION RECORD AND ISSUES A    *02880000
028900*     WRITE REQUEST TO THE TRANSACTION PREPARATION MODULE IF     *02890000
029000*     CHECKPOINTS ARE TAKEN BY TIME INTERVAL (SECONDS) OR        *02900000
029100*     REQUESTED BY THE MAINTENANCE PROGRAM.                      *02910000
029200******************************************************************02920000
029300 C500-CKPT-BY-TIME-OR-REQUEST.                                    02930000
029400                                                                  02940000
029500     MOVE 'Y' TO DP000-CHECKPOINT-IND.                            02950000
029600     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      02960000
029700     MOVE RC095-TRKG-REC          TO DP000-TRANS-REC.             02970000
029800     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             02980000
029900     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              02990000
030000     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             03000000
030100                                                                  03010000
030200     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         03020000
030300     ADD +1 TO PA-OUTPUT-RECS-WRITTEN.                            03030000
030400                                                                  03040000
030500******************************************************************03050000
030600* C600-ISSUE-CLOSE-REQUEST                                       *03060000
030700*     ISSUE A 'CLOSE' REQUEST TO THE TRANSACTION PREPARATION     *03070000
030800*     MODULE.                                                    *03080000
030900******************************************************************03090000
031000 C600-ISSUE-CLOSE-REQUEST.                                        03100000
031100                                                                  03110000
031200     MOVE PC-TRAN-PREP-FUNC-CLOSE TO DP000-FUNC-CODE.             03120000
031300     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              03130000
031400     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             03140000
031500                                                                  03150000
031600     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         03160000
031700                                                                  03170000
031800******************************************************************03180000
031900*  TRANSACTION PREPARATION MODULE CALL AND ERROR ROUTINES        *03190000
032000******************************************************************03200000
032100     COPY DPPD000.                                                03210000
032200                                                                  03220000
