00001                                                                   06/13/94
00002                                                                   ETKCS300
00003                                                                      LV002
00004 *-----------------------*                                         ETKCS300
00005  IDENTIFICATION DIVISION.                                         ETKCS300
00006 *-----------------------*                                         ETKCS300
00007  PROGRAM-ID.    ETKCS300.                                         ETKCS300
00008  AUTHOR.        J. SCHMIDT                                        ETKCS300
00009  INSTALLATION.  KOHLS DEPARTMENT STORES.                          ETKCS300
00010  DATE-WRITTEN.  12-06-93.                                         ETKCS300
00011  DATE-COMPILED.                                                   ETKCS300
00012                                                                   ETKCS300
00013 *----------------------------------------------------------------*ETKCS300
00014 *    E300 - EDI VENDOR CRITERIA SPEC SCREEN                      *ETKCS300
00015 *                                                                *ETKCS300
00016 *    THIS PROGRAM IS THE ENTRY POINT TO THE EDI VENDOR SUB-      *ETKCS300
00017 *    SYSTEM. IT CAN BE ENTERED FROM EITHER THE ETMENU SCREEN OF  *ETKCS300
00018 *    THE CICS ARCHITECTURE, OR BY A USER HITTING A LOCAL-GO-TO   *ETKCS300
00019 *    PF-KEY IN THE VENDOR SUB-SYSTEM LIST SCREEN (VNLVNDRS).     *ETKCS300
00020 *    EITHER THE USER ENTERS A VENDOR NAME, OR THEY SELECT A      *ETKCS300
00021 *    VENDOR FROM THE VENDOR LIST SCREEN PRIOR TO HITTING A LOCAL-*ETKCS300
00022 *    GO-TO PF-KEY.  AFTER INITIAL VALIDATION, AND NO ERRORS ARE  *ETKCS300
00023 *    DETECTED, CONTROL IS PASSED TO ETKCS301; THE LIST PROGRAM.  *ETKCS300
00024 *                                                                *ETKCS300
00025 *----------------------------------------------------------------*ETKCS300
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210        ETKCS300
CICS  *                                                                 ETKCS300
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     ETKCS300
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      ETKCS300
CICS  *----------------------------------------------------------------*ETKCS300
00026                                                                   ETKCS300
00027                                                                   ETKCS300
00028  ENVIRONMENT DIVISION.                                            ETKCS300
00029                                                                   ETKCS300
00030                                                                   ETKCS300
00031                                                                   ETKCS300
00032  DATA DIVISION.                                                   ETKCS300
00033                                                                   ETKCS300
00034                                                                   ETKCS300
00035  EJECT                                                            ETKCS300
00036  WORKING-STORAGE SECTION.                                         ETKCS300
00037                                                                   ETKCS300
00038  01  PC-PROGRAM-CONSTANTS.                                        ETKCS300
00039      05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'ETKCS300'.  ETKCS300
00040      05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'ET300A  '.  ETKCS300
00041      05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'ETKM300 '.  ETKCS300
00042                                                                   ETKCS300
00043      05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           ETKCS300
00044                                               COMP.               ETKCS300
00045      05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           ETKCS300
00046                                               COMP.               ETKCS300
00047      05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           ETKCS300
00048                                               COMP.               ETKCS300
00049                                                                   ETKCS300
00050      05  PC-INTER-APPL-CODES.                                     ETKCS300
00051          10  PC-INTER-APPL-CRIT-SPEC                              ETKCS300
00052                                   PIC  X(01)  VALUE '1'.          ETKCS300
00053          10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          ETKCS300
00054          10  PC-INTER-APPL-VNDR   PIC  X(01)  VALUE '3'.          ETKCS300
00055                                                                   ETKCS300
00056      05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       ETKCS300
00057      05  PC-ASTERISK              PIC  X(01)  VALUE '*'.          ETKCS300
00058                                                                   ETKCS300
00059      05  PC-ASTERISK-NAME         PIC  X(30)  VALUE               ETKCS300
00060          '*                             '.                        ETKCS300
00061                                                                   ETKCS300
00062      05  PC-TSYMSG-NUMBERS.                                       ETKCS300
00063          10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       ETKCS300
00064          10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       ETKCS300
00065          10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       ETKCS300
00066          10  PC-TSYMSG-00017      PIC  9(05)  VALUE  00017.       ETKCS300
00067          10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       ETKCS300
00068          10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       ETKCS300
00069          10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       ETKCS300
00070          10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       ETKCS300
00071          10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       ETKCS300
00072          10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       ETKCS300
00073          10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       ETKCS300
00074          10  PC-TSYMSG-00543      PIC  9(05)  VALUE  00543.       ETKCS300
00075          10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       ETKCS300
00076          10  PC-TSYMSG-00697      PIC  9(05)  VALUE  00697.       ETKCS300
00077          10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       ETKCS300
00078          10  PC-TSYMSG-99903      PIC  9(05)  VALUE  99903.       ETKCS300
00079                                                                   ETKCS300
00080  01  PS-PROGRAM-SWITCHES.                                         ETKCS300
00081      05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         ETKCS300
00082          88  PS-ERROR                         VALUE  'Y'.         ETKCS300
00083          88  PS-NO-ERROR                      VALUE  'N'.         ETKCS300
00084      05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'Y'.         ETKCS300
00085          88  PS-COMMAREA-VALID                VALUE  'Y'.         ETKCS300
00086          88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         ETKCS300
00087      05  PS-RETURN-PROCESSING-SW  PIC  X(01)  VALUE  'N'.         ETKCS300
00088          88  PS-RETURN-PROCESSING             VALUE  'Y'.         ETKCS300
00089          88  PS-REGULAR-PROCESSING            VALUE  'N'.         ETKCS300
00090      05  PS-ENT-NAME-FOUND-SW     PIC  X(01)  VALUE  'N'.         ETKCS300
00091          88  PS-ENT-NAME-FOUND                VALUE  'Y'.         ETKCS300
00092          88  PS-NO-ENT-NAME-FOUND             VALUE  'N'.         ETKCS300
00093                                                                   ETKCS300
00094  01  PV-PROGRAM-VARIABLES.                                        ETKCS300
00095      05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            ETKCS300
00096                                               COMP SYNC.          ETKCS300
00097      05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            ETKCS300
00098                                               COMP SYNC.          ETKCS300
00099      05  PV-ASTERISK-CNT          PIC S9(04)  VALUE +0            ETKCS300
00100                                               COMP SYNC.          ETKCS300
00101      05  PV-NULL                  PIC S9(04)  VALUE +0            ETKCS300
00102                                               COMP SYNC.          ETKCS300
00103                                                                   ETKCS300
00104  EJECT                                                            ETKCS300
00105 *----------------------------------------------------------------*ETKCS300
00106 *  RECORD LAYOUT FOR THE 'VENDOR SELECTION' TEMP STORAGE QUEUE.  *ETKCS300
00107 *----------------------------------------------------------------*ETKCS300
00108                                                                   ETKCS300
00109      COPY VNWS003.                                                   CL**2
00110                                                                   ETKCS300
00111  EJECT                                                            ETKCS300
00112 *----------------------------------------------------------------*ETKCS300
00113 *    MAP LAYOUT                                                  *ETKCS300
00114 *----------------------------------------------------------------*ETKCS300
00115                                                                   ETKCS300
00116      COPY ETKM300.                                                ETKCS300
00117                                                                   ETKCS300
00118  EJECT                                                            ETKCS300
00119 *----------------------------------------------------------------*ETKCS300
00120 *    ATTRIBUTE SETTINGS COPYBOOK.                                *ETKCS300
00121 *----------------------------------------------------------------*ETKCS300
00122                                                                   ETKCS300
00123      COPY DPWS015.                                                ETKCS300
00124                                                                   ETKCS300
00125  EJECT                                                            ETKCS300
00126 *----------------------------------------------------------------*ETKCS300
00127 *    FUNCTION KEYS COPYBOOK                                      *ETKCS300
00128 *----------------------------------------------------------------*ETKCS300
00129                                                                   ETKCS300
00130      COPY DPWS016.                                                ETKCS300
00131                                                                   ETKCS300
00132  EJECT                                                            ETKCS300
00133 *----------------------------------------------------------------*ETKCS300
00134 *  THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT     *ETKCS300
00135 *  SUB-ROUTINE (DPKUT100).                                       *ETKCS300
00136 *----------------------------------------------------------------*ETKCS300
00137      COPY DPWS010I.                                               ETKCS300
00138                                                                   ETKCS300
00139  EJECT                                                            ETKCS300
00140 *----------------------------------------------------------------*ETKCS300
CICS  *  PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.             *ETKCS300
00143 *----------------------------------------------------------------*ETKCS300
00144      COPY DPWS030.                                                ETKCS300
CICS       COPY DPWS930.                                                ETKCS300
00145                                                                   ETKCS300
00146  EJECT                                                            ETKCS300
00147 **--------------------------------------------------------------**ETKCS300
00148 *    STANDARD COMMAREA.                                           ETKCS300
00149 **--------------------------------------------------------------**ETKCS300
00150                                                                   ETKCS300
00151      COPY DPWS020.                                                ETKCS300
00152                                                                   ETKCS300
00153  EJECT                                                            ETKCS300
00154                                                                   ETKCS300
00155      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                ETKCS300
00156                                                                   ETKCS300
00157 ***************************************************************** ETKCS300
00158 * INTER-APPLICATION COMMAREA.                                   * ETKCS300
00159 *   VNWS002 - INPUT FROM VENDOR SYSTEM, LOCAL-GO FUNCTION (F22) * ETKCS300
00160 *   ETWS300 - OUTPUT TO LOCAL-GO FUNCTION                       * ETKCS300
00161 ***************************************************************** ETKCS300
00162                                                                   ETKCS300
00163          10  INTER-APPL-COMM-AREA      PIC X(200).                ETKCS300
00164                                                                   ETKCS300
00165  EJECT                                                            ETKCS300
00166                                                                   ETKCS300
00167      COPY VNWS002.                                                ETKCS300
00168                                                                   ETKCS300
00169  EJECT                                                            ETKCS300
00170                                                                   ETKCS300
00171      COPY ETWS300.                                                ETKCS300
00172                                                                   ETKCS300
00173  EJECT                                                            ETKCS300
00174 ***************************************************************** ETKCS300
00175 *    SPECIFIC COMMMAREA FOR ETKCS300.                             ETKCS300
00176 ***************************************************************** ETKCS300
00177          10  ASC-APPL-SPECIFIC-COMMAREA.                          ETKCS300
00178                                                                   ETKCS300
00179              15  ASC-INT-APPL-FORMAT-IND       PIC  X(01).        ETKCS300
00180                  88  ASC-ET-MENU                      VALUE ' '.  ETKCS300
00181                  88  ASC-VNDR-LIST                    VALUE '2'.  ETKCS300
00182                                                                   ETKCS300
00183              15  ASC-TEMP-STORAGE-CNTL.                           ETKCS300
00184                  20  ASC-USE-SELECTION-SW      PIC  X(01).        ETKCS300
00185                      88  ASC-USE-SELECTION-QUEUE      VALUE 'Y'.  ETKCS300
00186                      88  ASC-NO-SELECTION-QUEUE       VALUE 'N'.  ETKCS300
00187                                                                   ETKCS300
00188                  20  ASC-SEL-QUEUE-NAME        PIC  X(08).        ETKCS300
00189                  20  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3. ETKCS300
00190                  20  ASC-NUMBER-OF-SELECTED-ITEMS                 ETKCS300
00191                                                PIC S9(09) COMP-3. ETKCS300
00192                  20  ASC-SEL-SUB               PIC S9(04) COMP.   ETKCS300
00193                  20  ASC-SEL-ITEM              PIC S9(04) COMP.   ETKCS300
00194                                                                   ETKCS300
00195              15  ASC-KEY-DATA.                                    ETKCS300
00196 *                (VENDOR SUB-SYSTEM SELECTED ITEMS QUEUE)         ETKCS300
00197 *                (FROM KEY-DATA AREA IN TS QUEUE 'VNWS003')       ETKCS300
00198 **               20  ASC-DEPARTMENT            PIC XXX.           ETKCS300
00199                  20  ASC-ENT-ID                PIC S9(9) COMP.    ETKCS300
00200 **               20  ASC-FUNCTION-ID           PIC S9(4) COMP.    ETKCS300
00201 **               20  ASC-SEQ-NBR               PIC S9(4) COMP.    ETKCS300
00202                                                                   ETKCS300
00203              15  ASC-SCREEN-FIELDS.                               ETKCS300
00204                  20  ASC-VENDOR-NAME           PIC  X(30).        ETKCS300
00205                                                                   ETKCS300
00206              15  ASC-HOLD-INTER-APPL           PIC  X(200).       ETKCS300
00207          10  FILLER                            PIC  X(2609).      ETKCS300
00208                                                                   ETKCS300
00209  EJECT                                                            ETKCS300
00210 *----------------------------------------------------------------*ETKCS300
00211 *    ABEND PROCESSING COPYBOOK.                                  *ETKCS300
00212 *----------------------------------------------------------------*ETKCS300
00213                                                                   ETKCS300
00214      COPY DPWS013.                                                ETKCS300
00215                                                                   ETKCS300
00216  EJECT                                                            ETKCS300
00217 *----------------------------------------------------------------*ETKCS300
00218 *    CURRENT DATE COPYBOOK.                                      *ETKCS300
00219 *----------------------------------------------------------------*ETKCS300
00220                                                                   ETKCS300
00221      COPY DPWS017.                                                ETKCS300
00222                                                                   ETKCS300
00223  EJECT                                                            ETKCS300
00224 *---------------------------------------------------------------* ETKCS300
00225 *    DB2 AREA FOR COMMUNICATIONS                                * ETKCS300
00226 *---------------------------------------------------------------* ETKCS300
00227      EXEC SQL                                                     ETKCS300
00228           INCLUDE SQLCA                                           ETKCS300
00229      END-EXEC.                                                    ETKCS300
00230                                                                   ETKCS300
00231 *---------------------------------------------------------------* ETKCS300
00232 *    DB2 AREA FOR ENTITY NAME DETAILS                           * ETKCS300
00233 *---------------------------------------------------------------* ETKCS300
00234      EXEC SQL                                                     ETKCS300
00235           INCLUDE TENTNME                                         ETKCS300
00236      END-EXEC.                                                    ETKCS300
00237                                                                   ETKCS300
00238  EJECT                                                            ETKCS300
00239                                                                   ETKCS300
00240  LINKAGE SECTION.                                                 ETKCS300
00241                                                                   ETKCS300
00242  01  DFHCOMMAREA.                                                 ETKCS300
00243      05  FILLER                         OCCURS  1 TO 4072 TIMES   ETKCS300
00244                                         DEPENDING ON EIBCALEN.    ETKCS300
00245          10  FILLER                     PIC X.                    ETKCS300
00246                                                                   ETKCS300
00247  EJECT                                                            ETKCS300
00248                                                                   ETKCS300
00249                                                                   ETKCS300
00250  PROCEDURE DIVISION.                                              ETKCS300
00251 **-------------------------------------------------------------** ETKCS300
00252 ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** ETKCS300
00253 ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** ETKCS300
00254 ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** ETKCS300
00255 **                                                             ** ETKCS300
00256 ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** ETKCS300
00257 ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** ETKCS300
00258 **-------------------------------------------------------------** ETKCS300
00259                                                                   ETKCS300
00260  0000-MAIN-MODULE.                                                ETKCS300
00261                                                                   ETKCS300
00262      INITIALIZE DP030-CICS-API-FIELDS.                            ETKCS300
00263      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       ETKCS300
00264      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          ETKCS300
00265      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         ETKCS300
00266                                                                   ETKCS300
00267      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       ETKCS300
00268      MOVE LENGTH OF ET300AI        TO DP030-MAP-LENGTH (1).       ETKCS300
00269      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     ETKCS300
00270      PERFORM 0001-CALL-CICS-ARCH-API.                             ETKCS300
00271                                                                   ETKCS300
00272      PERFORM 1000-CONTROL-PROCESSING                              ETKCS300
00273                                                                   ETKCS300
00274      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     ETKCS300
00275      PERFORM 0001-CALL-CICS-ARCH-API.                             ETKCS300
00276                                                                   ETKCS300
00277  0001-CALL-CICS-ARCH-API.                                         ETKCS300
00278                                                                   ETKCS300
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      ETKCS300
00280                                     DFHCOMMAREA                   ETKCS300
00281                                     DP030-CICS-API-FIELDS         ETKCS300
00282                                     DP020-STANDARD-COMMAREA       ETKCS300
00283                                     ET300AI.                      ETKCS300
00284                                                                   ETKCS300
00285      IF  DP030-RC-CALL-SUCCESSFUL                                 ETKCS300
00286          CONTINUE                                                 ETKCS300
00287      ELSE                                                         ETKCS300
00288          SET DP013-NO-ROLLBACK                                    ETKCS300
00289              DP013-XCTL-DISPLAY-RESTART                           ETKCS300
00290              DP013-CICS-ABEND      TO TRUE                        ETKCS300
00291          MOVE 'BEFORE 0000-MAIN-MODULE'                           ETKCS300
00292                                    TO DP013-PARAGRAPH             ETKCS300
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE OETKCS300
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      ETKCS300
00295          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      ETKCS300
00296          PERFORM DP013-0000-PROCESS-ABEND                         ETKCS300
00297      END-IF.                                                      ETKCS300
00298                                                                   ETKCS300
00299  EJECT                                                            ETKCS300
00300 *----------------------------------------------------------------*ETKCS300
00301 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *ETKCS300
00302 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *ETKCS300
00303 *----------------------------------------------------------------*ETKCS300
00304                                                                   ETKCS300
00305  1000-CONTROL-PROCESSING.                                         ETKCS300
00306                                                                   ETKCS300
00307      SET PS-REGULAR-PROCESSING TO TRUE.                           ETKCS300
00308                                                                   ETKCS300
00309      EVALUATE TRUE                                                ETKCS300
00310                                                                   ETKCS300
00311          WHEN DP020-NEXT-ACT-INITIAL                              ETKCS300
00312 **            ** THIS SIGNALS INITIAL ENTRY TO THE PROGRAM **     ETKCS300
00313                                                                   ETKCS300
00314               PERFORM 1100-PROC-INTER-APPL-COMMAREA               ETKCS300
00315               IF PS-COMMAREA-NOT-VALID                            ETKCS300
00316                   CONTINUE                                        ETKCS300
00317               ELSE                                                ETKCS300
00318                   PERFORM 3000-EDIT-DATA-IN-COMMAREA              ETKCS300
00319                   PERFORM 4000-BUILD-INITIAL-PANEL                ETKCS300
00320               END-IF                                              ETKCS300
00321                                                                   ETKCS300
00322          WHEN DP020-NEXT-ACT-READ-MAP                             ETKCS300
00323               PERFORM 2000-FKEY-PROCESSING                        ETKCS300
00324                                                                   ETKCS300
00325          WHEN DP020-NEXT-ACT-RETURN                               ETKCS300
00326 *            ** MUST HAVE UPDATED ASC-HOLD PRIOR TO THIS POINT    ETKCS300
00327                                                                   ETKCS300
00328               IF  ASC-ET-MENU                                     ETKCS300
00329                    MOVE ASC-HOLD-INTER-APPL                       ETKCS300
00330                      TO ET300-INTER-APPL-COMMAREA                 ETKCS300
00331               END-IF                                              ETKCS300
00332                                                                   ETKCS300
00333               IF  ASC-VNDR-LIST                                   ETKCS300
00334                    MOVE ASC-HOLD-INTER-APPL                       ETKCS300
00335                      TO VN002-INTER-APPL-COMMAREA                 ETKCS300
00336                                                                   ETKCS300
00337 *                 ** RETRIEVE THE LAST SELECTED VENDOR FROM THE   ETKCS300
00338 *                 ** VENDOR LIST TS QUEUE AND LOAD THE SCREEN     ETKCS300
00339                   SET ASC-USE-SELECTION-QUEUE TO TRUE             ETKCS300
00340                   MOVE VN002-SEL-QUEUE-NAME                       ETKCS300
00341                     TO ASC-SEL-QUEUE-NAME                         ETKCS300
00342                   MOVE VN002-NUMBER-OF-TS-ITEMS                   ETKCS300
00343                     TO ASC-NUMBER-OF-TS-ITEMS                     ETKCS300
00344                   MOVE VN002-NUMBER-OF-SELECTED-ITEMS             ETKCS300
00345                     TO ASC-NUMBER-OF-SELECTED-ITEMS               ETKCS300
00346                                                                   ETKCS300
00347 *                 ** PREPARE LIST ENTRY **                        ETKCS300
00348                   SET PS-RETURN-PROCESSING TO TRUE                ETKCS300
00349 **  N/A           MOVE VN003-MAX-ITEMS TO ASC-SEL-SUB             ETKCS300
00350 **  N/A           MOVE ZERO            TO ASC-SEL-ITEM            ETKCS300
00351                   PERFORM 2110-RETRIEVE-NEXT-ITEM                 ETKCS300
00352                                                                   ETKCS300
00353                   PERFORM 2130-RETRIEVE-ENTITY-NAME               ETKCS300
00354                                                                   ETKCS300
00355               END-IF                                              ETKCS300
00356                                                                   ETKCS300
00357               PERFORM 3000-EDIT-DATA-IN-COMMAREA                  ETKCS300
00358               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                ETKCS300
00359                                                                   ETKCS300
00360          WHEN OTHER                                               ETKCS300
00361               SET DP013-LOGIC-ABEND TO TRUE                       ETKCS300
00362               SET DP013-NO-ROLLBACK TO TRUE                       ETKCS300
00363               MOVE '1000-CONTROL-PROCESSING'                      ETKCS300
00364                                     TO DP013-PARAGRAPH            ETKCS300
00365               MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  ETKCS300
00366                                     TO DP013-MESSAGE-TEXT(1)      ETKCS300
00367               MOVE DP020-NEXT-APPL-ACTIVITY                       ETKCS300
00368                                     TO DP013-MESSAGE-TEXT(2)      ETKCS300
00369               PERFORM DP013-0000-PROCESS-ABEND                    ETKCS300
00370      END-EVALUATE.                                                ETKCS300
00371                                                                   ETKCS300
00372  EJECT                                                            ETKCS300
00373 *----------------------------------------------------------------*ETKCS300
00374 *                                                                *ETKCS300
00375 *----------------------------------------------------------------*ETKCS300
00376                                                                   ETKCS300
00377  1100-PROC-INTER-APPL-COMMAREA.                                   ETKCS300
00378                                                                   ETKCS300
00379      SET PS-COMMAREA-VALID TO TRUE.                               ETKCS300
00380      INITIALIZE ASC-APPL-SPECIFIC-COMMAREA.                       ETKCS300
00381                                                                   ETKCS300
00382      MOVE DP020-INT-APPL-FORMAT-IND                               ETKCS300
00383        TO ASC-INT-APPL-FORMAT-IND.                                ETKCS300
00384                                                                   ETKCS300
00385      IF  ASC-ET-MENU                                              ETKCS300
00386 *        ** PRESENT AN EMPTY SELECTION CRITERION SCREEN **        ETKCS300
00387                                                                   ETKCS300
00388          MOVE SPACES     TO ET300-INT-APPL-FORMAT-IND             ETKCS300
00389                             ET300-SEL-QUEUE-NAME                  ETKCS300
00390                             ET300-VEND-INCHG-QUAL                 ETKCS300
00391                             ET300-VEND-INCHG-ID                   ETKCS300
00392                             ET300-NETWK-ID                        ETKCS300
00393                             ET300-NETWORK-NAME                    ETKCS300
00394                                                                   ETKCS300
00395          MOVE PC-ASTERISK-NAME TO ET300-VENDOR-NAME               ETKCS300
00396                                                                   ETKCS300
00397          MOVE +0         TO ET300-NBR-SELECTED-ITEMS              ETKCS300
00398                             ET300-NUMBER-OF-TS-ITEMS              ETKCS300
00399                             ET300-ENT-ID                          ETKCS300
00400                             ET300-TP-DKEY                         ETKCS300
00401                                                                   ETKCS300
00402          MOVE ET300-INTER-APPL-COMMAREA                           ETKCS300
00403            TO ASC-HOLD-INTER-APPL                                 ETKCS300
00404                                                                   ETKCS300
00405      END-IF.                                                      ETKCS300
00406                                                                   ETKCS300
00407      IF  ASC-VNDR-LIST                                            ETKCS300
00408                                                                   ETKCS300
00409 *        ** SAVE INITIAL COMMAREA FROM VENDOR SYSTEM              ETKCS300
00410          MOVE VN002-INTER-APPL-COMMAREA                           ETKCS300
00411            TO ASC-HOLD-INTER-APPL                                 ETKCS300
00412                                                                   ETKCS300
00413 *        ** RETRIEVE FIRST SELECTED VENDOR FROM THE               ETKCS300
00414 *        ** VENDOR LIST SCREEN AND LOAD INITIAL SCREEN            ETKCS300
00415                                                                   ETKCS300
00416          SET ASC-USE-SELECTION-QUEUE                              ETKCS300
00417                                  TO TRUE                          ETKCS300
00418          MOVE VN002-SEL-QUEUE-NAME                                ETKCS300
00419                                  TO ASC-SEL-QUEUE-NAME            ETKCS300
00420          MOVE VN002-NUMBER-OF-TS-ITEMS                            ETKCS300
00421                                  TO ASC-NUMBER-OF-TS-ITEMS        ETKCS300
00422          MOVE VN002-NUMBER-OF-SELECTED-ITEMS                      ETKCS300
00423                                  TO ASC-NUMBER-OF-SELECTED-ITEMS  ETKCS300
00424          MOVE VN003-MAX-ITEMS                                     ETKCS300
00425                                  TO ASC-SEL-SUB                   ETKCS300
00426          MOVE ZERO                                                ETKCS300
00427                                  TO ASC-SEL-ITEM                  ETKCS300
00428                                                                   ETKCS300
00429 *        RETRIEVE ASC-ENT-ID TO IDENTIFY 1ST VENDOR TO PROCESS    ETKCS300
00430          PERFORM 2110-RETRIEVE-NEXT-ITEM                          ETKCS300
00431          PERFORM 2130-RETRIEVE-ENTITY-NAME                        ETKCS300
00432                                                                   ETKCS300
00433      END-IF.                                                      ETKCS300
00434                                                                   ETKCS300
00435  EJECT                                                            ETKCS300
00436 *----------------------------------------------------------------*ETKCS300
00437 * DETERMINE FUTHER THE PROCESSING PATH, BASED ON ANY FUNCTION    *ETKCS300
00438 * KEY ACTIONS PERFORMED BY A USER. SPECIFIC FUNCTION KEYS LISTED *ETKCS300
00439 * HERE, ARE ACTED UPON REGARDLESS OF ANY EDITS THAT ARE YET TO   *ETKCS300
00440 * BE PERFORMED.                                                  *ETKCS300
00441 *                                                                *ETKCS300
00442 * IF NONE OF THE FUNCTION KEYS LISTED WERE PRESSED, EDIT THE     *ETKCS300
00443 * DATA ON THE SCREEN. CONTINUE ON, CHECKING THE REST OF THE      *ETKCS300
00444 * FUNCTION KEYS.                                                 *ETKCS300
00445 *                                                                *ETKCS300
00446 * NOTE THAT WITH API, NO INVALID FUNCTION KEYS CAN GET THIS FAR. *ETKCS300
00447 *----------------------------------------------------------------*ETKCS300
00448                                                                   ETKCS300
00449  2000-FKEY-PROCESSING.                                            ETKCS300
00450                                                                   ETKCS300
00451 **   (FOR THIS MODULE, CURSOR CONTROL IS HANDLED IN THE           ETKCS300
00452 **     3200 PARA BECAUSE CURSOR POSITION IS DIFFERENT             ETKCS300
00453 **     DEPENDING ON THE SOURCE CALLING THIS MODULE.)              ETKCS300
00454                                                                   ETKCS300
00455 **   SET DP030-SET-CURSOR-APPL-1     TO  TRUE.                    ETKCS300
00456                                                                   ETKCS300
00457      IF  ET300-VENDOR-NAME = (SPACES OR LOW-VALUES)               ETKCS300
00458           MOVE ASC-HOLD-INTER-APPL   TO INTER-APPL-COMM-AREA      ETKCS300
00459      END-IF.                                                      ETKCS300
00460                                                                   ETKCS300
00461      EVALUATE TRUE                                                ETKCS300
00462                                                                   ETKCS300
00463          WHEN DP020-SRC-AID = DP016-CLEAR                         ETKCS300
00464               PERFORM 3000-EDIT-DATA-IN-COMMAREA                  ETKCS300
00465               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                ETKCS300
00466                                                                   ETKCS300
00467          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     ETKCS300
00468               SET DP030-DONT-ERASE                                ETKCS300
00469                   DP030-SEND-DATAONLY (PC-APPL-MAP)               ETKCS300
00470                                    TO TRUE                        ETKCS300
00471 *             INITIALIZE ASC-SPECIFIC-COMMAREA                    ETKCS300
00472               PERFORM 3200-RESET-ATTRIBUTES                       ETKCS300
00473               PERFORM 4000-BUILD-INITIAL-PANEL                    ETKCS300
00474               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                ETKCS300
00475                                                                   ETKCS300
00476          WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             ETKCS300
00477               IF  ASC-USE-SELECTION-QUEUE                         ETKCS300
00478                   PERFORM 2110-RETRIEVE-NEXT-ITEM                 ETKCS300
00479                   PERFORM 2130-RETRIEVE-ENTITY-NAME               ETKCS300
00480                   PERFORM 3000-EDIT-DATA-IN-COMMAREA              ETKCS300
00481                   PERFORM 4000-BUILD-INITIAL-PANEL                ETKCS300
00482                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            ETKCS300
00483               ELSE                                                ETKCS300
00484 *                 --- BOTTOM OF LIST ---                          ETKCS300
00485                   MOVE PC-TSYMSG-00070                            ETKCS300
00486                                    TO DP020-MSG-NUMBER            ETKCS300
00487                   SET DP020-MSG-INFORMATIONAL                     ETKCS300
00488                                    TO TRUE                        ETKCS300
00489               END-IF                                              ETKCS300
00490                                                                   ETKCS300
00491          WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             ETKCS300
00492               IF  ASC-USE-SELECTION-QUEUE                         ETKCS300
00493                   PERFORM 2120-GET-PREV-ITEM                      ETKCS300
00494                   PERFORM 2130-RETRIEVE-ENTITY-NAME               ETKCS300
00495                   PERFORM 3000-EDIT-DATA-IN-COMMAREA              ETKCS300
00496                   PERFORM 4000-BUILD-INITIAL-PANEL                ETKCS300
00497                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            ETKCS300
00498               ELSE                                                ETKCS300
00499 *                 --- TOP OF LIST ---                             ETKCS300
00500                   MOVE PC-TSYMSG-00069                            ETKCS300
00501                                    TO DP020-MSG-NUMBER            ETKCS300
00502                   SET DP020-MSG-INFORMATIONAL                     ETKCS300
00503                                    TO TRUE                        ETKCS300
00504               END-IF                                              ETKCS300
00505                                                                   ETKCS300
00506          WHEN OTHER                                               ETKCS300
00507               PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                ETKCS300
00508               PERFORM 3000-EDIT-DATA-IN-COMMAREA                  ETKCS300
00509               IF  PS-NO-ERROR                                     ETKCS300
00510                   SET DP030-CONTINUE-GO  TO TRUE                  ETKCS300
00511                   PERFORM 2100-CHECK-FUNCTION-KEY                 ETKCS300
00512               ELSE                                                ETKCS300
00513                   SET DP030-OVERRIDE-GO  TO TRUE                  ETKCS300
00514               END-IF                                              ETKCS300
00515               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                ETKCS300
00516                                                                   ETKCS300
00517      END-EVALUATE.                                                ETKCS300
00518                                                                   ETKCS300
00519 *----------------------------------------------------------------*ETKCS300
00520 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *ETKCS300
00521 * FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *ETKCS300
00522 * FROM THE CICS ARCHITECTURE API.                                *ETKCS300
00523 *----------------------------------------------------------------*ETKCS300
00524                                                                   ETKCS300
00525  2100-CHECK-FUNCTION-KEY.                                         ETKCS300
00526                                                                   ETKCS300
00527      EVALUATE TRUE                                                ETKCS300
00528          WHEN DP020-SRC-AID = DP016-ENTER                         ETKCS300
00529               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                ETKCS300
00530                                                                   ETKCS300
00531          WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 ETKCS300
00532 * ???         ** CAL'S TEMPLATE HAS THIS REVERSED ?               ETKCS300
00533               MOVE INTER-APPL-COMM-AREA                           ETKCS300
00534                 TO ASC-HOLD-INTER-APPL                            ETKCS300
00535                                                                   ETKCS300
00536          WHEN OTHER                                               ETKCS300
00537              SET DP013-NO-ROLLBACK                                ETKCS300
00538                  DP013-XCTL-DISPLAY-RESTART                       ETKCS300
00539                  DP013-CICS-ABEND  TO TRUE                        ETKCS300
00540              MOVE '2100-CHECK-FUNCTION-KEY'                       ETKCS300
00541                                    TO DP013-PARAGRAPH             ETKCS300
00542              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      ETKCS300
00543                                    TO DP013-MESSAGE-TEXT (1)      ETKCS300
00544              PERFORM DP013-0000-PROCESS-ABEND                     ETKCS300
00545      END-EVALUATE.                                                ETKCS300
00546                                                                   ETKCS300
00547  EJECT                                                            ETKCS300
00548 *----------------------------------------------------------------*ETKCS300
00549 *                                                                *ETKCS300
00550 *----------------------------------------------------------------*ETKCS300
00551  2110-RETRIEVE-NEXT-ITEM.                                         ETKCS300
00552                                                                   ETKCS300
00553      IF PS-RETURN-PROCESSING                                      ETKCS300
00554          CONTINUE                                                 ETKCS300
00555      ELSE                                                         ETKCS300
00556          ADD +1                    TO  ASC-SEL-SUB                ETKCS300
00557      END-IF.                                                      ETKCS300
00558                                                                   ETKCS300
00559      IF  ASC-SEL-SUB > VN003-MAX-ITEMS                            ETKCS300
00560          ADD +1                    TO  ASC-SEL-ITEM               ETKCS300
00561          MOVE +1                   TO  ASC-SEL-SUB                ETKCS300
00562      END-IF.                                                      ETKCS300
00563                                                                   ETKCS300
00564      IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                ETKCS300
00565                                                                   ETKCS300
00566          PERFORM 9100-READ-SEL-QUEUE                              ETKCS300
00567                                                                   ETKCS300
00568          IF  VN003-ITEM (ASC-SEL-SUB) > ZERO                      ETKCS300
00569                                                                   ETKCS300
00570 *            RETRIEVE THE TS QUEUE DATA, FOR THE ASC AREA         ETKCS300
00571 **  ?        MOVE VN003-KEY-DATA (ASC-SEL-SUB)                    ETKCS300
00572 **  ?                              TO  ASC-KEY-DATA               ETKCS300
00573                                                                   ETKCS300
00574 *            ** IDENTIFY THE VENDOR TO BE PROCESSED **            ETKCS300
00575              MOVE VN003-ENT-ID (ASC-SEL-SUB)                      ETKCS300
00576                                    TO  ASC-ENT-ID                 ETKCS300
00577                                                                   ETKCS300
00578              SET VN003-INQ (ASC-SEL-SUB)  TO  TRUE                ETKCS300
00579              PERFORM 9200-REWRITE-SEL-QUEUE                       ETKCS300
00580                                                                   ETKCS300
00581          ELSE                                                     ETKCS300
00582              SUBTRACT +1 FROM ASC-SEL-SUB                         ETKCS300
00583 *            --- BOTTOM OF LIST ---                               ETKCS300
00584              MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER           ETKCS300
00585              SET DP020-MSG-INFORMATIONAL                          ETKCS300
00586                                    TO  TRUE                       ETKCS300
00587          END-IF                                                   ETKCS300
00588                                                                   ETKCS300
00589      ELSE                                                         ETKCS300
00590          SUBTRACT +1 FROM ASC-SEL-ITEM                            ETKCS300
00591          MOVE VN003-MAX-ITEMS      TO  ASC-SEL-SUB                ETKCS300
00592          MOVE PC-TSYMSG-00070      TO  DP020-MSG-NUMBER           ETKCS300
00593          SET DP020-MSG-INFORMATIONAL                              ETKCS300
00594                                    TO  TRUE                       ETKCS300
00595      END-IF.                                                      ETKCS300
00596                                                                   ETKCS300
00597  EJECT                                                            ETKCS300
00598 *----------------------------------------------------------------*ETKCS300
00599 *                                                                *ETKCS300
00600 *----------------------------------------------------------------*ETKCS300
00601                                                                   ETKCS300
00602  2120-GET-PREV-ITEM.                                              ETKCS300
00603                                                                   ETKCS300
00604      SUBTRACT +1 FROM ASC-SEL-SUB.                                ETKCS300
00605      IF  ASC-SEL-SUB < +1                                         ETKCS300
00606          SUBTRACT +1 FROM ASC-SEL-ITEM                            ETKCS300
00607          MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 ETKCS300
00608      END-IF.                                                      ETKCS300
00609                                                                   ETKCS300
00610      IF  ASC-SEL-ITEM > ZERO                                      ETKCS300
00611                                                                   ETKCS300
00612          PERFORM 9100-READ-SEL-QUEUE                              ETKCS300
00613                                                                   ETKCS300
00614 *            RETRIEVE THE TS QUEUE DATA, FOR THE ASC AREA         ETKCS300
00615 **  ?        MOVE VN003-KEY-DATA (ASC-SEL-SUB)                    ETKCS300
00616 **  ?                              TO  ASC-KEY-DATA               ETKCS300
00617                                                                   ETKCS300
00618 *            ** IDENTIFY THE VENDOR TO BE PROCESSED **            ETKCS300
00619              MOVE VN003-ENT-ID (ASC-SEL-SUB)                      ETKCS300
00620                                    TO  ASC-ENT-ID                 ETKCS300
00621                                                                   ETKCS300
00622          SET VN003-INQ (ASC-SEL-SUB)                              ETKCS300
00623                                    TO  TRUE                       ETKCS300
00624          PERFORM 9200-REWRITE-SEL-QUEUE                           ETKCS300
00625      ELSE                                                         ETKCS300
00626          MOVE +1                   TO ASC-SEL-ITEM                ETKCS300
00627                                       ASC-SEL-SUB                 ETKCS300
00628 *        --- TOP OF LIST ---                                      ETKCS300
00629          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            ETKCS300
00630          SET DP020-MSG-INFORMATIONAL                              ETKCS300
00631                                    TO TRUE                        ETKCS300
00632      END-IF.                                                      ETKCS300
00633                                                                   ETKCS300
00634  EJECT                                                            ETKCS300
00635 *----------------------------------------------------------------*ETKCS300
00636 *                                                                *ETKCS300
00637 *----------------------------------------------------------------*ETKCS300
00638                                                                   ETKCS300
00639  2130-RETRIEVE-ENTITY-NAME.                                       ETKCS300
00640                                                                   ETKCS300
00641 *    ASC-ENT-ID IDENTIFY'S WHICH VENDOR TO PROCESS **             ETKCS300
00642                                                                   ETKCS300
00643      SET PS-NO-ENT-NAME-FOUND TO TRUE.                            ETKCS300
00644      PERFORM 9300-RETRIEVE-ENT-NAME.                              ETKCS300
00645                                                                   ETKCS300
00646      IF PS-ENT-NAME-FOUND                                         ETKCS300
00647         MOVE ENTNME-ENT-ID         TO ET300-ENT-ID                ETKCS300
00648         MOVE ENTNME-ENT-NAME-DESC  TO ET300-VENDOR-NAME           ETKCS300
00649      ELSE                                                         ETKCS300
00650         MOVE ZEROES                TO ET300-ENT-ID                ETKCS300
00651         MOVE SPACES                TO ET300-VENDOR-NAME           ETKCS300
00652      END-IF.                                                      ETKCS300
00653                                                                   ETKCS300
00654  EJECT                                                            ETKCS300
00655 *----------------------------------------------------------------*ETKCS300
00656 * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *ETKCS300
00657 * IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *ETKCS300
00658 * THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *ETKCS300
00659 *----------------------------------------------------------------*ETKCS300
00660                                                                   ETKCS300
00661  2200-MOVE-SCREEN-TO-COMMAREA.                                    ETKCS300
00662                                                                   ETKCS300
00663      IF  AVENDORL > ZERO                                          ETKCS300
00664          MOVE AVENDORI             TO ASC-VENDOR-NAME             ETKCS300
00665      ELSE                                                         ETKCS300
00666          IF  AVENDORF = DP015-ERASE-EOF                           ETKCS300
00667              MOVE PC-ASTERISK-NAME TO ASC-VENDOR-NAME             ETKCS300
00668          END-IF                                                   ETKCS300
00669      END-IF.                                                      ETKCS300
00670                                                                   ETKCS300
00671      MOVE ASC-VENDOR-NAME          TO ET300-VENDOR-NAME.          ETKCS300
00672      MOVE ASC-ENT-ID               TO ET300-ENT-ID.               ETKCS300
00673                                                                   ETKCS300
00674  EJECT                                                            ETKCS300
00675 *----------------------------------------------------------------*ETKCS300
00676 * ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *ETKCS300
00677 * CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *ETKCS300
00678 * A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE     *ETKCS300
00679 * DONE IN THE DESTINATION PROGRAM, NOT HERE.                     *ETKCS300
00680 *                                                                *ETKCS300
00681 * PERFORM EDITS ON EACH FIELD ENTERED BY THE USER, OR RECEIVED   *ETKCS300
00682 * FROM THE VENDOR SUB-SYSTEM MODULE. IF AN ERROR IS FOUND,       *ETKCS300
00683 * THE CURSOR IS POSITIONED AT THAT FIELD AND AN APPROPRIATE      *ETKCS300
00684 * ERROR MESSAGE IS DISPLAYED.                                    *ETKCS300
00685 *----------------------------------------------------------------*ETKCS300
00686                                                                   ETKCS300
00687  3000-EDIT-DATA-IN-COMMAREA.                                      ETKCS300
00688                                                                   ETKCS300
00689      PERFORM 3200-RESET-ATTRIBUTES.                               ETKCS300
00690                                                                   ETKCS300
00691      IF ET300-VENDOR-NAME = (SPACES OR LOW-VALUES)                ETKCS300
00692          MOVE PC-ASTERISK-NAME     TO  ET300-VENDOR-NAME          ETKCS300
00693      END-IF.                                                      ETKCS300
00694                                                                   ETKCS300
00695      MOVE ET300-VENDOR-NAME        TO  ASC-VENDOR-NAME.           ETKCS300
00696                                                                   ETKCS300
00697      IF  PS-ERROR                                                 ETKCS300
00698 *       ** AN ERROR IS DETECTED **                                ETKCS300
00699          MOVE PC-TSYMSG-00005      TO  DP020-MSG-NUMBER           ETKCS300
00700          MOVE DP015-UNP-ALP-BRT-OFF                               ETKCS300
00701                                    TO  AVENDORA                   ETKCS300
00702          MOVE DP015-RED            TO  AVENDORC                   ETKCS300
00703          MOVE DP015-REVERSE        TO  AVENDORH                   ETKCS300
00704          MOVE -1                   TO  AVENDORL                   ETKCS300
00705      END-IF.                                                      ETKCS300
00706                                                                   ETKCS300
00707 *----------------------------------------------------------------*ETKCS300
00708 * MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *ETKCS300
00709 * MAP.                                                           *ETKCS300
00710 *----------------------------------------------------------------*ETKCS300
00711                                                                   ETKCS300
00712  3200-RESET-ATTRIBUTES.                                           ETKCS300
00713                                                                   ETKCS300
00714      IF  ASC-ET-MENU                                              ETKCS300
00715          MOVE DP015-UNP-ALP-NOR-OFF  TO AVENDORA                  ETKCS300
00716          MOVE DP015-GREEN            TO AVENDORC                  ETKCS300
00717          MOVE DP015-UNDERLINE        TO AVENDORH                  ETKCS300
00718                                                                   ETKCS300
00719          SET DP030-SET-CURSOR-APPL-1 TO  TRUE                     ETKCS300
00720          MOVE -1                     TO  AVENDORL                 ETKCS300
00721      END-IF.                                                      ETKCS300
00722                                                                   ETKCS300
00723      IF  ASC-VNDR-LIST                                            ETKCS300
00724          MOVE DP015-PRO-BRT-OFF      TO AVENDORA                  ETKCS300
00725          MOVE DP015-BLUE             TO AVENDORC                  ETKCS300
00726          MOVE DP015-HL-OFF           TO AVENDORH                  ETKCS300
00727 *        ( ARCHITECTURE WILL DEFAULT CURSOR TO COMMAND LINE )     ETKCS300
00728      END-IF.                                                      ETKCS300
00729                                                                   ETKCS300
00730  EJECT                                                            ETKCS300
00731 *----------------------------------------------------------------*ETKCS300
00732 *  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *ETKCS300
00733 *  IT HERE.                                                      *ETKCS300
00734 *----------------------------------------------------------------*ETKCS300
00735                                                                   ETKCS300
00736  4000-BUILD-INITIAL-PANEL.                                        ETKCS300
00737                                                                   ETKCS300
00738      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        ETKCS300
00739                                                                   ETKCS300
00740 *----------------------------------------------------------------*ETKCS300
00741 *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *ETKCS300
00742 *----------------------------------------------------------------*ETKCS300
00743                                                                   ETKCS300
00744  4400-MOVE-COMMAREA-TO-SCREEN.                                    ETKCS300
00745                                                                   ETKCS300
00746      MOVE ASC-VENDOR-NAME          TO  AVENDORO.                  ETKCS300
00747                                                                   ETKCS300
00748  EJECT                                                            ETKCS300
00749 *----------------------------------------------------------------*ETKCS300
00750 * READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *ETKCS300
00751 *----------------------------------------------------------------*ETKCS300
00752                                                                   ETKCS300
00753  9100-READ-SEL-QUEUE.                                             ETKCS300
00754                                                                   ETKCS300
00755      EXEC CICS                                                    ETKCS300
00756          READQ TS                                                 ETKCS300
00757              QUEUE (ASC-SEL-QUEUE-NAME)                           ETKCS300
00758              INTO  (VN003-VENDOR-SEL-REC)                         ETKCS300
00759              ITEM  (ASC-SEL-ITEM)                                 ETKCS300
00760              RESP  (PV-CICS-RESPONSE)                             ETKCS300
00761      END-EXEC.                                                    ETKCS300
00762                                                                   ETKCS300
00763      IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   ETKCS300
00764           CONTINUE                                                ETKCS300
00765      ELSE                                                         ETKCS300
00766          SET DP013-LOGIC-ABEND                                    ETKCS300
00767              DP013-NO-ROLLBACK     TO TRUE                        ETKCS300
00768          MOVE '9100-READ-SEL-QUEUE'                               ETKCS300
00769                                    TO DP013-PARAGRAPH             ETKCS300
00770          MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   ETKCS300
00771                                    TO DP013-MESSAGE-TEXT (1)      ETKCS300
00772          PERFORM DP013-0000-PROCESS-ABEND                         ETKCS300
00773      END-IF.                                                      ETKCS300
00774                                                                   ETKCS300
00775  EJECT                                                            ETKCS300
00776 *----------------------------------------------------------------*ETKCS300
00777 * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *ETKCS300
00778 *----------------------------------------------------------------*ETKCS300
00779                                                                   ETKCS300
00780  9200-REWRITE-SEL-QUEUE.                                          ETKCS300
00781                                                                   ETKCS300
00782      EXEC CICS                                                    ETKCS300
00783           WRITEQ TS                                               ETKCS300
00784               QUEUE  (ASC-SEL-QUEUE-NAME)                         ETKCS300
00785               FROM   (VN003-VENDOR-SEL-REC)                       ETKCS300
00786               ITEM   (ASC-SEL-ITEM)                               ETKCS300
00787               RESP   (PV-CICS-RESPONSE)                           ETKCS300
00788               REWRITE                                             ETKCS300
00789      END-EXEC.                                                    ETKCS300
00790                                                                   ETKCS300
00791      IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               ETKCS300
00792          SET DP013-CICS-ABEND                                     ETKCS300
00793              DP013-NO-ROLLBACK     TO TRUE                        ETKCS300
00794          MOVE '9200-REWRITE-SEL-QUEUE'                            ETKCS300
00795                                    TO DP013-PARAGRAPH             ETKCS300
00796          MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   ETKCS300
00797                                    TO DP013-MESSAGE-TEXT (1)      ETKCS300
00798          PERFORM DP013-0000-PROCESS-ABEND                         ETKCS300
00799      END-IF.                                                      ETKCS300
00800                                                                   ETKCS300
00801  EJECT                                                            ETKCS300
00802 *---------------------------------------------------------------* ETKCS300
00803 *    CURSOR FOR ENTITY NAME DETAILS.                            * ETKCS300
00804 *---------------------------------------------------------------* ETKCS300
00805                                                                   ETKCS300
00806  9300-RETRIEVE-ENT-NAME.                                          ETKCS300
00807                                                                   ETKCS300
00808      EXEC SQL                                                     ETKCS300
00809           SELECT                                                  ETKCS300
00810                 ENT_ID                                            ETKCS300
00811               , SEQ_NBR                                           ETKCS300
00812               , ENT_NAME_DESC                                     ETKCS300
00813               , TYPE_CDE                                          ETKCS300
00814           INTO                                                    ETKCS300
00815                 :ENTNME-ENT-ID                                    ETKCS300
00816               , :ENTNME-SEQ-NBR                                   ETKCS300
00817               , :ENTNME-ENT-NAME-DESC                             ETKCS300
00818               , :ENTNME-TYPE-CDE                                  ETKCS300
00819           FROM                                                    ETKCS300
00820                 TENTNME                                           ETKCS300
00821           WHERE                                                   ETKCS300
00822                 ENT_ID        =  :ASC-ENT-ID                      ETKCS300
00823             AND TYPE_CDE      =  '01'                             ETKCS300
00824      END-EXEC.                                                    ETKCS300
00825 * ?       ORDER BY                                                ETKCS300
00826 * ?             ENT_NAME_DESC                                     ETKCS300
00827                                                                   ETKCS300
00828      EVALUATE TRUE                                                ETKCS300
00829                                                                   ETKCS300
00830          WHEN SQLCODE = ZERO                                      ETKCS300
00831               SET PS-ENT-NAME-FOUND TO TRUE                       ETKCS300
00832          WHEN SQLCODE = +100                                      ETKCS300
00833 *             (NO PRIMARY NAME FOUND FOR ENT-ID)                  ETKCS300
00834               SET PS-NO-ENT-NAME-FOUND TO TRUE                    ETKCS300
00835                                                                   ETKCS300
00836          WHEN SQLCODE = -904                                      ETKCS300
00837          WHEN SQLCODE = -913                                      ETKCS300
00838               PERFORM 9900-SOFT-ABORT                             ETKCS300
00839                                                                   ETKCS300
00840          WHEN SQLWARN0 NOT = SPACE                                ETKCS300
00841          WHEN SQLCODE NOT = ZERO                                  ETKCS300
00842               MOVE '9300-RETRIEVE-ENT-NAME'                       ETKCS300
00843                                TO DP013-PARAGRAPH                 ETKCS300
00844               MOVE 'SELECT ENTITY NAME, USING ENT-ID'             ETKCS300
00845                                TO DP013-MESSAGE-TEXT (1)          ETKCS300
00846               MOVE SQLCA       TO DP013-SQLCA                     ETKCS300
00847               MOVE 'TENTNME '  TO DP013-DB2-TABLE-NAME (1)        ETKCS300
00848               SET DP013-DB2-ABEND                                 ETKCS300
00849                                TO TRUE                            ETKCS300
00850               PERFORM DP013-0000-PROCESS-ABEND                    ETKCS300
00851      END-EVALUATE.                                                ETKCS300
00852                                                                   ETKCS300
00853  EJECT                                                            ETKCS300
00854 *----------------------------------------------------------------*ETKCS300
00855 *    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *ETKCS300
00856 *    AND THE ERROR SWITCHES.                                     *ETKCS300
00857 *----------------------------------------------------------------*ETKCS300
00858                                                                   ETKCS300
00859  9900-SOFT-ABORT.                                                 ETKCS300
00860                                                                   ETKCS300
00861      SET PS-ERROR                TO  TRUE.                        ETKCS300
00862      SET DP020-MSG-FATAL         TO  TRUE.                        ETKCS300
00863      MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            ETKCS300
00864                                                                   ETKCS300
00865  EJECT                                                            ETKCS300
00866 *----------------------------------------------------------------*ETKCS300
00867 *    ABEND PROCESSOR MODULE                                      *ETKCS300
00868 *----------------------------------------------------------------*ETKCS300
00869                                                                   ETKCS300
00870      COPY DPPD013.                                                ETKCS300
00871                                                                   ETKCS300
00872  EJECT                                                            ETKCS300
00873 *----------------------------------------------------------------*ETKCS300
00874 *    CURRENT DATE MODULE                                         *ETKCS300
00875 *----------------------------------------------------------------*ETKCS300
00876                                                                   ETKCS300
00877      COPY DPPD017.                                                ETKCS300
00878                                                                   ETKCS300
00879  EJECT                                                            ETKCS300
