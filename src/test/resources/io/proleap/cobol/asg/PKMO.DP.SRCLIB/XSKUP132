000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      XSKUP132.                                       00020001
000300 AUTHOR.          MEDHA CHOUDHURY.                                00030001
000400 DATE-WRITTEN.    FEBRUARY 2010.                                  00040001
000500*--------------------------------------------------------------*  00050001
000600* DESCRIPTION:                                                 *  00060001
000700*      LOADS THE PRICE CHANGE DATA EXTRACTED FROM THE          *  00070001
000800*      OPERATIONAL TABLES TO PRICE CHANGE HISTORY TABLES       *  00080001
001300*                                                              *  00130001
001400*  INPUTS:                                                     *  00140001
001500*      PKMO.XS.PRCHG.HIST.LOAD.FILE   (READ BY DPKUT901)       *  00150003
001600*                                                              *  00160001
001700* OUTPUTS:                                                     *  00170001
001800*      NONE                                                    *  00180001
001900*--------------------------------------------------------------*  00190001
002000*--------------------------------------------------------------*  00200001
002100* HISTORY LOG:                                                    00210001
002200*--------------------------------------------------------------*  00220001
002300* DATE:        02/03/2010                                         00230001
002400* WR/IR#:      WR33394                                            00240019
002500* PROGRAMMER:  MEDHA CHOUDHURY                                    00250001
002600* DESCRIPTION: LOAD PRCHGH, STR_GP_PRCHGH & PRCHG_MDSEH TABLES    00260001
002800*--------------------------------------------------------------*  00280001
260107* DATE:        08-19-21                                           00290025
260107* WR/IR#:      CHG0260107                                         00300025
260107* PROGRAMMER:  JIM HUNTER                                         00310025
260107* DESCRIPTION: ADD COPYBOOK DPWS991 TO MAKE DPKUT901 CALL DYNAMIC.00320025
003300*--------------------------------------------------------------*  00330001
004770 ENVIRONMENT DIVISION.                                            00477001
004780 CONFIGURATION SECTION.                                           00478001
004790 SOURCE-COMPUTER.        IBM-3090.                                00479001
004800 OBJECT-COMPUTER.        IBM-3090.                                00480001
004900 INPUT-OUTPUT SECTION.                                            00490001
004901                                                                  00490103
005000                                                                  00500001
005100 DATA DIVISION.                                                   00510001
005200 FILE SECTION.                                                    00520001
005300                                                                  00530001
005400*--------------------------------------------------------------*  00540001
005500 WORKING-STORAGE SECTION.                                         00550001
005600*--------------------------------------------------------------*  00560001
005700 01  PS-PROGRAM-SWITCHES.                                         00570001
005800     05  PS-END-OF-FILE-SW               PIC  X(001).             00580019
005900         88  PS-END-OF-FILE-YES                     VALUE 'Y'.    00590019
006000         88  PS-END-OF-FILE-NO                      VALUE 'N'.    00600019
006100     05  PS-RESTART-REQUIRED-SW  PIC X(01)          VALUE 'N'.    00610001
006200         88  PS-RESTART-REQUIRED                    VALUE 'Y'.    00620001
006300         88  PS-RESTART-NOT-REQUIRED                VALUE 'N'.    00630001
006410     05  PS-PRCHG-INSERT-UPD-SW  PIC X(01)          VALUE 'I'.    00641011
006420         88  PS-PRCHG-INSERTED                      VALUE 'I'.    00642011
006430         88  PS-PRCHG-UPDATED                       VALUE 'U'.    00643011
006431     05  PS-STRGP-INSERT-UPD-SW  PIC X(01)          VALUE 'I'.    00643111
006432         88  PS-STRGP-INSERTED                      VALUE 'I'.    00643211
006433         88  PS-STRGP-UPDATED                       VALUE 'U'.    00643311
006434     05  PS-PMDSE-INS-UPD-FAIL-SW  PIC X(01)        VALUE 'Y'.    00643415
006435         88  PS-PMDSE-INSERT-FAILED                 VALUE 'I'.    00643515
006436         88  PS-PMDSE-UPDATE-FAILED                 VALUE 'U'.    00643615
006437         88  PS-PMDSE-INS-UPD-SUCCESS               VALUE 'Y'.    00643715
006440                                                                  00644011
006500*--------------------------------------------------------------*  00650001
006600* PROGRAM CONSTANTS                                               00660001
006700*--------------------------------------------------------------*  00670001
006800 01  PC-PROGRAM-CONSTANTS.                                        00680001
006900     05  PC-JOB-NAME                 PIC  X(06)  VALUE 'XSK125'.  00690019
006910     05  PC-NULL-VALUE               PIC  X(01)  VALUE '~'.       00691019
007000     05  PC-CKPT-JOB-NAME            PIC  X(06)  VALUE 'XSK125'.  00700019
007100     05  PC-PROGRAM-NAME             PIC  X(08)  VALUE 'XSKUP132'.00710019
007200     05  PC-CKPT-PLAN-NAME           PIC  X(08)  VALUE 'XSKUP132'.00720019
007300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)  VALUE 'XSKUP132'.00730019
007400     05  PC-MAX-RETRIES              PIC S9(03)  VALUE +3 COMP-3. 00740019
007500     05  PC-MAX-DEADLOCKS            PIC S9(03)  VALUE +3 COMP-3. 00750019
007600     05  PC-TRAN-PRES-FUNC-CODES.                                 00760001
007700         10  PC-TRAN-PRES-FUNC-OPEN  PIC  X(05)  VALUE 'OPEN '.   00770019
007800         10  PC-TRAN-PRES-FUNC-CKPT  PIC  X(05)  VALUE 'CKPT '.   00780019
007900         10  PC-TRAN-PRES-FUNC-TRANS PIC  X(05)  VALUE 'TRANS'.   00790019
008000         10  PC-TRAN-PRES-FUNC-RSTRT PIC  X(05)  VALUE 'RSTRT'.   00800019
008100         10  PC-TRAN-PRES-FUNC-CLOSE PIC  X(05)  VALUE 'CLOSE'.   00810019
008200                                                                  00820001
008300*--------------------------------------------------------------*  00830001
008400* PV- PROGRAM VARIABLES                                           00840001
008500*--------------------------------------------------------------*  00850001
008600 01  PV-PROGRAM-VARAIBLES.                                        00860001
008700     05  PV-PARAGRAPH-NAME           PIC X(40)   VALUE SPACES.    00870019
008800     05  PV-SQL-SUB                  PIC S9(09)  VALUE 0  COMP.   00880019
008900     05  PV-RETRY                    PIC 9999    VALUE 0  COMP.   00890019
009000     05  PV-ABEND-CODE               PIC 9999    VALUE 0  COMP.   00900019
009100     05  PV-CALC-DB2-DATE            PIC  X(10)  VALUE SPACES.    00910019
009200     05  PV-CALC-NBR-DAYS            PIC  9(05)  VALUE 0.         00920019
009300     05  PV-DEL-MARK-TMST            PIC  X(26)  VALUE SPACES.    00930019
009400     05  PV-DEL-EXPIRE-DATE          PIC  X(10)  VALUE SPACES.    00940019
009500     05  PV-DEL-OLDER-DATE           PIC  X(10)  VALUE SPACES.    00950019
009600     05  PV-LAST-PRCHG-ID           PIC  S9(9)  VALUE ZEROES COMP.00960019
009700     05  PV-EXIST-VAR                PIC  S9(4)  COMP SYNC.       00970019
009800                                                                  00980001
009810*--------------------------------------------------------------*  00981007
009820* PV- DB2 NULL VARIABLES                                          00982007
009830*--------------------------------------------------------------*  00983007
009840 01  PV-DB2-VARIABLES.                                            00984007
009892     05  PV-NULL-PRCHG-DEPT       PIC S9(04) VALUE +0 COMP SYNC.  00989207
009893     05  PV-NULL-PRCHG-DESC       PIC S9(04) VALUE +0 COMP SYNC.  00989307
009894     05  PV-NULL-ALL-RMNG-STR     PIC S9(04) VALUE +0 COMP SYNC.  00989407
009895     05  PV-NULL-APP-TMST         PIC S9(04) VALUE +0 COMP SYNC.  00989507
009896     05  PV-NULL-DEPT             PIC S9(04) VALUE +0 COMP SYNC.  00989607
009897     05  PV-NULL-MAJ-CL           PIC S9(04) VALUE +0 COMP SYNC.  00989707
009898     05  PV-NULL-SUB-CL           PIC S9(04) VALUE +0 COMP SYNC.  00989807
009899     05  PV-NULL-STYLE            PIC S9(04) VALUE +0 COMP SYNC.  00989907
009900     05  PV-NULL-SKU              PIC S9(04) VALUE +0 COMP SYNC.  00990007
009901     05  PV-NULL-UNIT-RTL         PIC S9(04) VALUE +0 COMP SYNC.  00990107
009902     05  PV-NULL-NCLR-RTL-AMT     PIC S9(04) VALUE +0 COMP SYNC.  00990207
009903     05  PV-NULL-CLR-TYP-CDE      PIC S9(04) VALUE +0 COMP SYNC.  00990307
009904     05  PV-NULL-GP-PRIC-ID       PIC S9(04) VALUE +0 COMP SYNC.  00990407
009905     05  PV-NULL-GP-RTL-QTY       PIC S9(04) VALUE +0 COMP SYNC.  00990507
009906     05  PV-NULL-GP-RTL-AMT       PIC S9(04) VALUE +0 COMP SYNC.  00990607
009910*--------------------------------------------------------------*  00991001
010000* INPUT FILE LAYOUT                                               01000001
010100*--------------------------------------------------------------*  01010001
010200     COPY XSRD147.                                                01020003
010300                                                                  01030001
010400*--------------------------------------------------------------*  01040001
010500* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01050001
010600*--------------------------------------------------------------*  01060001
010700     COPY DPWS004.                                                01070001
010800                                                                  01080001
010900*--------------------------------------------------------------*  01090001
011000* DATE ROUTINE COPY MEMBERS                                       01100001
011100*--------------------------------------------------------------*  01110001
011200     COPY DPWS500.                                                01120001
011300                                                                  01130001
011400*--------------------------------------------------------------*  01140001
011500* DB2 ABEND COPYBOOK                                              01150001
011600*--------------------------------------------------------------*  01160001
011700     COPY DPWS900.                                                01170001
011800                                                                  01180001
011900*--------------------------------------------------------------*  01190001
012000* DB2 MESSAGE AREA                                                01200001
012100*--------------------------------------------------------------*  01210001
012200     COPY SQLCA2.                                                 01220001
012300                                                                  01230001
012400*--------------------------------------------------------------*  01240001
012500* PROGRAM COUNTERS                                                01250001
012600*--------------------------------------------------------------*  01260001
012700 01  PV-PROGRAM-COUNTERS         COMP-3.                          01270001
012800     05  PV-NUMBER-OF-RETRIES     PIC 9(9) VALUE 0.               01280001
012900     05  PV-PRCHG-LOAD-CNT        PIC 9(9) VALUE 0.               01290003
013000     05  PV-STRGP-PRCHG-LOAD-CNT  PIC 9(9) VALUE 0.               01300003
013100     05  PV-MDSE-PRCHG-LOAD-CNT   PIC 9(9) VALUE 0.               01310003
013110     05  PV-PRCHG-UPDT-CNT        PIC 9(9) VALUE 0.               01311015
013120     05  PV-STRGP-PRCHG-UPDT-CNT  PIC 9(9) VALUE 0.               01312015
013130     05  PV-MDSE-PRCHG-UPDT-CNT   PIC 9(9) VALUE 0.               01313015
013200     05  PV-PRCHG-READ-CNT        PIC 9(9) VALUE 0.               01320003
013210     05  PV-STRGP-PRCHG-READ-CNT  PIC 9(9) VALUE 0.               01321003
013220     05  PV-MDSE-PRCHG-READ-CNT   PIC 9(9) VALUE 0.               01322003
013300                                                                  01330001
013400*--------------------------------------------------------------*  01340001
013500* ERROR HANDLING                                                  01350001
013600*--------------------------------------------------------------*  01360001
013700 01  PV-MISC-ABEND-FIELDS.                                        01370001
013800     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          01380001
013900     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          01390001
014000     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          01400001
014100                                                                  01410001
014200 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    01420001
014300     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           01430001
014400     88  ABEND-4013-DB2-ERROR              VALUE +4013.           01440001
014500     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           01450001
014700     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           01470001
014800     88  ABEND-4008                        VALUE +4008.           01480001
014900     88  ABEND-4005                        VALUE +4005.           01490001
015000                                                                  01500001
015100*--------------------------------------------------------------*  01510001
015200* DB2 COMMUNICATIONS AREA                                         01520001
015300*--------------------------------------------------------------*  01530001
015400     EXEC SQL                                                     01540001
015500       INCLUDE SQLCA                                              01550001
015600     END-EXEC.                                                    01560001
015700                                                                  01570001
015800*--------------------------------------------------------------*  01580001
015900* DB2 TABLE XST00127 (XST_PRCHGH) PRICE CHANGE TABLE              01590003
016000*--------------------------------------------------------------*  01600001
016100     EXEC SQL                                                     01610001
016200       INCLUDE XST00127                                           01620003
016300     END-EXEC.                                                    01630001
016400                                                                  01640001
016500*--------------------------------------------------------------*  01650001
016600* DB2 TABLE XST00128 (XST_STR_GP_PRCHGH) STORE GROUP PRICE CHANGE 01660003
016700*--------------------------------------------------------------*  01670001
016800     EXEC SQL                                                     01680001
016900       INCLUDE XST00128                                           01690003
017000     END-EXEC.                                                    01700001
017100                                                                  01710001
017200*--------------------------------------------------------------*  01720001
017300* DB2 TABLE XST00129 (XST_PRCHG_MDSEH) PRICE CHANGE MERCHANDISE   01730003
017400*--------------------------------------------------------------*  01740001
017500     EXEC SQL                                                     01750001
017600       INCLUDE XST00129                                           01760003
017700     END-EXEC.                                                    01770001
017800                                                                  01780001
017900******************************************************************01790001
018000*  TRANSACTION PREPARATION MODULE COMMUNICATIONS AREA             01800001
018100******************************************************************01810001
260107     COPY DPWS991.                                                01820025
018200                                                                  01821025
018200     COPY DPLS001.                                                01822025
018300     05  WORK-STORAGE-PASSED.                                     01830001
018400******************************************************************01840001
018500*PA - PROGRAM ACCUMULATORS                                        01850001
018600******************************************************************01860001
018700         10  PROGRAM-ACCUMULATORS.                                01870001
018800             15  PA-ROWS-INSERTED PIC S9(11)           VALUE ZERO 01880001
018900                                                       COMP-3.    01890001
019000                                                                  01900001
019100*--------------------------------------------------------------*  01910001
019200 PROCEDURE DIVISION.                                              01920001
019300*--------------------------------------------------------------*  01930001
019400 0000-MAINLINE.                                                   01940001
019500                                                                  01950001
019600     PERFORM 1000-INITIALIZATION.                                 01960001
019700                                                                  01970001
019810     PERFORM 2000-PROCESS-LOADS UNTIL DP001-PREP-TRANS-EOF.       01981003
019900                                                                  01990001
020000     PERFORM 9999-WRAPUP.                                         02000001
020100                                                                  02010001
020200     GOBACK.                                                      02020001
020300                                                                  02030001
020400*--------------------------------------------------------------*  02040001
020500* PREPARE CHECKPOINT RESTART TABLES FOR PROCESSING / RESTART      02050001
020600*--------------------------------------------------------------*  02060001
020700 1000-INITIALIZATION.                                             02070001
020800     MOVE PC-TRAN-PRES-FUNC-OPEN TO DP001-FUNC-CODE.              02080001
020900                                                                  02090001
020910     DISPLAY '********************************************'.      02091012
020920     DISPLAY '*   START OF PROGRAM XSKUP132              *'.      02092012
020930     DISPLAY '********************************************'.      02093012
020940                                                                  02094012
021000     PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      02100001
021100                                                                  02110001
021200*--------------------------------------------------------------*  02120001
021300*  LOAD THE HISTORY TABLES.                                       02130006
021400*--------------------------------------------------------------*  02140001
021500 2000-PROCESS-LOADS.                                              02150006
021600                                                                  02160001
021700     SET PS-RESTART-NOT-REQUIRED TO TRUE.                         02170001
021710                                                                  02171006
021800     EVALUATE TRUE                                                02180001
021900         WHEN XS147-PRCHGH-TABLE                                  02190004
021910             SET PS-PRCHG-INSERTED TO TRUE                        02191015
022000             PERFORM 2100-LOAD-PRCHGH                             02200006
022100         WHEN XS147-STRGP-PRCHG-TABLE                             02210004
022110             SET PS-STRGP-INSERTED TO TRUE                        02211017
022200             PERFORM 2300-LOAD-STRGP-PRCHGH                       02220006
022300         WHEN XS147-MDSE-PRCHG-TABLE                              02230004
022400             PERFORM 2500-LOAD-PRCHG-MDSEH                        02240006
022500     END-EVALUATE.                                                02250001
022600                                                                  02260001
022700*----------------------------------------------------------------*02270001
022800*  IF A RESTART IS REQUIRED, ISSUE A RESTART CALL RATHER THAN A  *02280001
022900*  TRANS CALL.  THIS WILL ALLOW PROCESSING TO RESUME WITH THE    *02290001
023000*  FIRST TRANSACTION AFTER THE LAST COMMIT.                      *02300001
023100*----------------------------------------------------------------*02310001
023200     IF PS-RESTART-REQUIRED                                       02320001
023300         MOVE PC-TRAN-PRES-FUNC-RSTRT TO DP001-FUNC-CODE          02330001
023400     ELSE                                                         02340001
023500         MOVE PC-TRAN-PRES-FUNC-TRANS TO DP001-FUNC-CODE          02350001
023600     END-IF.                                                      02360001
023700                                                                  02370001
023800     PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      02380001
023900     EVALUATE TRUE                                                02390001
024000        WHEN DP001-GOOD-RET-CODE                                  02400001
024100        WHEN DP001-CKPT-TAKEN                                     02410001
024200            MOVE DP001-TRANS-RECORD    TO                         02420001
024300              XS147-PERM-EXTRACT                                  02430005
024400        WHEN OTHER                                                02440001
024500            DISPLAY '2000-PROCESS-LOADS '                         02450006
024600            DISPLAY 'ERROR CALLING CHECKPOINT ROUTINE ON TRANS'   02460001
024700            DISPLAY 'DP001-RET-CODE IS ' DP001-RET-CODE           02470001
024800            PERFORM Z900-SQL-ABEND                                02480001
024900     END-EVALUATE.                                                02490001
024910                                                                  02491006
025000*2000-EXIT.                                                       02500006
025010                                                                  02501006
025100*--------------------------------------------------------------*  02510001
025200*   THE FOLLOWING PARAGRAPH WILL MOVE THE VALUES FROM THE      *  02520006
025210*   INPUT LAYOUT TO THE DCLGEN VARIABLES                          02521006
025300*--------------------------------------------------------------*  02530001
025400 2100-LOAD-PRCHGH.                                                02540006
025401     INITIALIZE DCLXST00127.                                      02540106
025403                                                                  02540306
025404     MOVE XS147-PRCHG-ID             TO XST00127-PRCHG-ID.        02540406
025405                                                                  02540507
025406     IF XS147-PRCHG-DESC = PC-NULL-VALUE                          02540607
025407        MOVE -1                      TO PV-NULL-PRCHG-DESC        02540707
025408     ELSE                                                         02540807
025409        MOVE XS147-PRCHG-DESC           TO XST00127-PRCHG-DESC    02540907
025410     END-IF.                                                      02541007
025411                                                                  02541107
025412     MOVE XS147-DEPT-NBR-PRCHG       TO XST00127-DEPT-NBR.        02541206
025413     MOVE XS147-EVNT-CTG-CDE         TO XST00127-EVNT-CTG-CDE.    02541306
025414     MOVE XS147-PRCHG-TYP-CDE        TO XST00127-PRCHG-TYP-CDE.   02541406
025415     MOVE XS147-PRCHG-ST-CDE         TO XST00127-PRCHG-ST-CDE.    02541506
025416                                                                  02541611
025417     IF XS147-ALL-RMNG-STR-IND = PC-NULL-VALUE                    02541711
025418        MOVE -1                      TO PV-NULL-ALL-RMNG-STR      02541811
025419     ELSE                                                         02541911
025420        MOVE XS147-ALL-RMNG-STR-IND  TO                           02542011
025421                                     XST00127-ALL-RMNG-STR-IND    02542111
025422     END-IF.                                                      02542211
025423                                                                  02542311
025424     IF XS147-APP-TMST = PC-NULL-VALUE                            02542411
025425        MOVE -1                      TO PV-NULL-APP-TMST          02542511
025426     ELSE                                                         02542611
025427        MOVE XS147-APP-TMST          TO XST00127-APP-TMST         02542711
025428     END-IF.                                                      02542811
025429                                                                  02542911
025430     MOVE XS147-SOR-LAST-UPD-TMST1  TO XST00127-SOR-LAST-UPD-TMST.02543011
025431     MOVE XS147-LAST-UPD-TMST1       TO XST00127-LAST-UPD-TMST.   02543111
025432     MOVE XS147-LAST-ACTN-CDE1       TO XST00127-LAST-ACTN-CDE.   02543211
025433                                                                  02543311
025434     PERFORM 2200-INSERT-PRCHGH.                                  02543411
025435                                                                  02543514
025436     IF PS-PRCHG-UPDATED                                          02543614
025437        DISPLAY '  INSERT FAILED FOR PRCHG ID: ' XS147-PRCHG-ID   02543714
025439        PERFORM 2250-UPDATE-PRCHGH                                02543916
025440     END-IF.                                                      02544014
025441                                                                  02544111
025442*2100-EXIT.                                                       02544211
025443                                                                  02544311
025444*--------------------------------------------------------------*  02544411
025445*   INSERT ROW INTO XST_PRCHGH TABLE                           *  02544519
025446*   IF THE ROW ALREADY EXISTS (-803) SET FLAG TO UPDATE THE ROW*  02544619
025447*--------------------------------------------------------------*  02544706
025450 2200-INSERT-PRCHGH.                                              02545006
025500     MOVE '2200-INSERT-PRCHGH' TO PV-PARAGRAPH-NAME.              02550006
025600                                                                  02560001
025700     PERFORM                                                      02570001
025800         WITH TEST AFTER                                          02580001
025900         VARYING PV-NUMBER-OF-RETRIES                             02590001
026000         FROM 1 BY 1                                              02600001
026100         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       02610001
026200            OR (SQLCODE = -803 OR +0))                            02620014
026300         EXEC SQL                                                 02630001
026400              INSERT  INTO  XST_PRCHGH                            02640006
026500                              ( PRCHG_ID                          02650006
026600                               ,PRCHG_DESC                        02660009
026700                               ,DEPT_NBR                          02670009
026800                               ,EVNT_CTG_CDE                      02680006
026900                               ,PRCHG_TYP_CDE                     02690006
026910                               ,PRCHG_ST_CDE                      02691006
026920                               ,ALL_RMNG_STR_IND                  02692006
026930                               ,APP_TMST                          02693009
026940                               ,SOR_LAST_UPD_TMST                 02694006
026950                               ,LAST_UPD_TMST                     02695006
026960                               ,LAST_ACTN_CDE                     02696006
026970                               ,CRE_ROW_DT)                       02697006
026980                      VALUES                                      02698006
026990                            (:XST00127-PRCHG-ID                   02699009
026991                            ,:XST00127-PRCHG-DESC                 02699109
026992                             :PV-NULL-PRCHG-DESC                  02699208
026993                            ,:XST00127-DEPT-NBR                   02699309
026994                             :PV-NULL-PRCHG-DEPT                  02699408
026995                            ,:XST00127-EVNT-CTG-CDE               02699509
026996                            ,:XST00127-PRCHG-TYP-CDE              02699609
026997                            ,:XST00127-PRCHG-ST-CDE               02699709
026998                            ,:XST00127-ALL-RMNG-STR-IND           02699809
026999                             :PV-NULL-ALL-RMNG-STR                02699909
027000                            ,:XST00127-APP-TMST                   02700009
027001                             :PV-NULL-APP-TMST                    02700109
027002                            ,:XST00127-SOR-LAST-UPD-TMST          02700209
027003                            ,:XST00127-LAST-UPD-TMST              02700309
027010                            ,:XST00127-LAST-ACTN-CDE              02701009
027100                            ,CURRENT_DATE)                        02710009
027110         END-EXEC                                                 02711006
027200         EVALUATE TRUE                                            02720001
027300           WHEN SQLCODE = 0                                       02730001
027400                ADD +1 TO PV-PRCHG-LOAD-CNT                       02740007
027500           WHEN SQLCODE = -803                                    02750014
027520                SET PS-PRCHG-UPDATED TO TRUE                      02752014
027600           WHEN SQLCODE = -904                                    02760001
027700           WHEN SQLCODE = -911                                    02770001
027800           WHEN SQLCODE = -913                                    02780001
027900                CONTINUE                                          02790001
028000           WHEN OTHER                                             02800001
028100                DISPLAY '>>> FAILING ON INSERT TO XST_PRCHGH '    02810006
028200                     '  PRCHG ID - ' XS147-PRCHG-ID               02820007
028700             MOVE 'ERROR ON INSERT TO XST_PRCHGH ' TO             02870007
028800                  PV-DB2-OPERATION                                02880001
028900             PERFORM 9900-SQL-ABEND                               02890001
029000                                                                  02900001
029100         END-EVALUATE                                             02910001
029200     END-PERFORM.                                                 02920001
029300                                                                  02930001
029400     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               02940001
029500         MOVE 'PRCHG INSERT RETRY EXCEEDED' TO PV-DB2-OPERATION   02950007
029600         PERFORM 9900-SQL-ABEND                                   02960001
029700     END-IF.                                                      02970001
029800                                                                  02980001
029810*2200-EXIT.                                                       02981007
029820                                                                  02982007
029830*--------------------------------------------------------------*  02983014
029840*   UPDATE THE PRCHG ROW                                       *  02984019
029860*--------------------------------------------------------------*  02986014
029870 2250-UPDATE-PRCHGH.                                              02987014
029880     MOVE '2200-UPDATE-PRCHGH' TO PV-PARAGRAPH-NAME.              02988014
029890                                                                  02989014
029891     PERFORM                                                      02989114
029892         WITH TEST AFTER                                          02989214
029893         VARYING PV-NUMBER-OF-RETRIES                             02989314
029894         FROM 1 BY 1                                              02989414
029895         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       02989514
029896            OR (SQLCODE = +100 OR +0))                            02989614
029897         EXEC SQL                                                 02989714
029898              UPDATE  XST_PRCHGH                                  02989814
029899                 SET PRCHG_ID = :XST00127-PRCHG-ID                02989915
029900                    ,PRCHG_DESC = :XST00127-PRCHG-DESC            02990015
029901                                  :PV-NULL-PRCHG-DESC             02990115
029902                    ,DEPT_NBR  = :XST00127-DEPT-NBR               02990215
029903                                 :PV-NULL-PRCHG-DEPT              02990315
029904                    ,EVNT_CTG_CDE = :XST00127-EVNT-CTG-CDE        02990415
029905                    ,PRCHG_TYP_CDE = :XST00127-PRCHG-TYP-CDE      02990515
029906                    ,PRCHG_ST_CDE = :XST00127-PRCHG-ST-CDE        02990615
029907                    ,ALL_RMNG_STR_IND = :XST00127-ALL-RMNG-STR-IND02990715
029908                    ,APP_TMST = :XST00127-APP-TMST                02990815
029909                                :PV-NULL-APP-TMST                 02990915
029910                    ,SOR_LAST_UPD_TMST =                          02991015
029911                                 :XST00127-SOR-LAST-UPD-TMST      02991115
029912                    ,LAST_UPD_TMST = :XST00127-LAST-UPD-TMST      02991215
029913                    ,LAST_ACTN_CDE = :XST00127-LAST-ACTN-CDE      02991315
029914                   ,CRE_ROW_DT = CURRENT_DATE                     02991416
029915              WHERE PRCHG_ID = :XST00127-PRCHG-ID                 02991515
029932         END-EXEC                                                 02993214
029933                                                                  02993315
029934         EVALUATE TRUE                                            02993414
029935           WHEN SQLCODE = 0                                       02993514
029936                ADD +1 TO PV-PRCHG-UPDT-CNT                       02993615
029940           WHEN SQLCODE = -904                                    02994014
029941           WHEN SQLCODE = -911                                    02994114
029942           WHEN SQLCODE = -913                                    02994214
029943                CONTINUE                                          02994314
029944           WHEN OTHER                                             02994414
029945                DISPLAY '>>> FAILING ON UPDATE TO XST_PRCHGH '    02994515
029946                     '  PRCHG ID - ' XS147-PRCHG-ID               02994614
029947             MOVE 'ERROR ON UPDATE TO XST_PRCHGH ' TO             02994715
029948                  PV-DB2-OPERATION                                02994814
029949             PERFORM 9900-SQL-ABEND                               02994914
029950                                                                  02995014
029951         END-EVALUATE                                             02995114
029952     END-PERFORM.                                                 02995214
029953                                                                  02995314
029954     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               02995414
029955         MOVE 'PRCHG INSERT RETRY EXCEEDED' TO PV-DB2-OPERATION   02995514
029956         PERFORM 9900-SQL-ABEND                                   02995614
029957     END-IF.                                                      02995714
029958                                                                  02995814
029959*2200-EXIT.                                                       02995914
029960                                                                  02996014
029970*--------------------------------------------------------------*  02997014
030000* 2300-LOAD-STR-GP-PRCHG.                                      *  03000007
030100*   POPULATES THE STORE GROUP PRICE CHANGE DCLGEN VARIABLES    *  03010019
030200*--------------------------------------------------------------*  03020001
030300 2300-LOAD-STRGP-PRCHGH.                                          03030010
030400                                                                  03040001
030401     INITIALIZE DCLXST00128.                                      03040107
030402                                                                  03040207
030403     MOVE XS147-PRCHG-ID-KEY       TO XST00128-PRCHG-ID           03040307
030404     MOVE XS147-STR-GP-TYP-CDE     TO XST00128-STR-GP-TYP-CDE     03040407
030405     MOVE XS147-STR-GP-ID          TO XST00128-STR-GP-ID          03040507
030406     MOVE XS147-PRCHG-EFF-DTE      TO XST00128-PRCHG-EFF-DTE      03040607
030407     MOVE XS147-OH-AUTO-CNT-IND    TO XST00128-OH-AUTO-CNT-IND    03040707
030408     MOVE XS147-SOR-LAST-UPD-TMST2 TO XST00128-SOR-LAST-UPD-TMST  03040807
030409     MOVE XS147-LAST-UPD-TMST2     TO XST00128-LAST-UPD-TMST      03040907
030410     MOVE XS147-LAST-ACTN-CDE2     TO XST00128-LAST-ACTN-CDE      03041007
030411                                                                  03041107
030412     PERFORM 2400-INSERT-STR-GP-PRCHG.                            03041207
030413                                                                  03041314
030414     IF PS-STRGP-UPDATED                                          03041414
030420        DISPLAY ' STR_GP_PRCHG INSERT FAILED FOR PRCHG_ID: '      03042022
030421             XS147-PRCHG-ID-KEY                                   03042122
030422            ' STR GP: ' XS147-STR-GP-TYP-CDE                      03042222
030423            ' STR ID: ' XS147-STR-GP-ID                           03042322
030424        PERFORM 2450-UPDATE-STR-GP-PRCHG                          03042422
030425     END-IF.                                                      03042522
030426                                                                  03042622
030427*2300-EXIT.                                                       03042722
030428                                                                  03042822
030429*--------------------------------------------------------------*  03042922
030430* 2400-INSERT-STR-GP-PRCHG.                                    *  03043022
030431*   INSERT STR-GP-PRCHG ROW.                                   *  03043122
030440*--------------------------------------------------------------*  03044007
030450 2400-INSERT-STR-GP-PRCHG.                                        03045007
030460                                                                  03046007
030500     MOVE '2400-INSERT-STR-GP-PRCHG' TO PV-PARAGRAPH-NAME.        03050007
030600                                                                  03060001
030700     PERFORM                                                      03070001
030800        WITH TEST AFTER                                           03080001
030900        VARYING PV-NUMBER-OF-RETRIES                              03090001
031000        FROM 1 BY 1                                               03100001
031100        UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES        03110001
031200           OR (SQLCODE = -803 OR +0))                             03120014
031300                                                                  03130001
031400         EXEC SQL                                                 03140001
031500              INSERT INTO XST_STR_GP_PRCHGH                       03150007
031600                               ( STR_GP_TYP_CDE                   03160007
031700                                 ,STR_GP_ID                       03170007
031800                                 ,PRCHG_ID                        03180007
031900                                 ,PRCHG_EFF_DTE                   03190007
031910                                 ,OH_AUTO_CNT_IND                 03191007
031920                                 ,SOR_LAST_UPD_TMST               03192007
031930                                 ,LAST_UPD_TMST                   03193007
031940                                 ,LAST_ACTN_CDE                   03194007
031950                                 ,CRE_ROW_DT                      03195007
031960                                )                                 03196007
031970                       VALUES                                     03197007
031980                             (:XST00128-STR-GP-TYP-CDE            03198009
031990                             ,:XST00128-STR-GP-ID                 03199009
031991                             ,:XST00128-PRCHG-ID                  03199109
031992                             ,:XST00128-PRCHG-EFF-DTE             03199209
031993                             ,:XST00128-OH-AUTO-CNT-IND           03199309
031994                             ,:XST00128-SOR-LAST-UPD-TMST         03199409
031995                             ,:XST00128-LAST-UPD-TMST             03199509
031996                             ,:XST00128-LAST-ACTN-CDE             03199609
031997                             ,CURRENT_DATE)                       03199707
032000         END-EXEC                                                 03200001
032100                                                                  03210001
032200         EVALUATE TRUE                                            03220001
032300           WHEN SQLCODE = 0                                       03230001
032400             ADD +1 TO PV-STRGP-PRCHG-LOAD-CNT                    03240007
032500           WHEN SQLCODE = -803                                    03250014
032510             SET PS-STRGP-UPDATED TO TRUE                         03251014
032600           WHEN SQLCODE = -904                                    03260001
032700           WHEN SQLCODE = -911                                    03270001
032800           WHEN SQLCODE = -913                                    03280001
032900             CONTINUE                                             03290001
033000           WHEN OTHER                                             03300001
033100             DISPLAY '>>> FAILING ON INSERT TO STR GP PRCHGH'     03310007
033200                     XS147-STR-GP-TYP-CDE, '-',                   03320007
033300                     XS147-STR-GP-ID, ' FOR ',                    03330007
033400                     XS147-PRCHG-ID-KEY,                          03340007
033500                     '<<<'                                        03350001
033600             MOVE 'ERROR ON INSERT OF STR_GP_PRCHG' TO            03360007
033700                  PV-DB2-OPERATION                                03370001
033800             PERFORM 9900-SQL-ABEND                               03380001
033900                                                                  03390001
034000         END-EVALUATE                                             03400001
034100     END-PERFORM.                                                 03410001
034200                                                                  03420001
034300     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               03430001
034400         MOVE 'INSERT RETRIES EXCEEDED' TO PV-DB2-OPERATION       03440007
034500         PERFORM 9900-SQL-ABEND                                   03450001
034600     END-IF.                                                      03460001
034700                                                                  03470001
034710*2400-EXIT.                                                       03471007
034720                                                                  03472007
034730*--------------------------------------------------------------*  03473015
034740* 2450-UPDATE-STR-GP-PRCHG.                                    *  03474015
034750*   DELETE STR-GP-PRCHG ROW.                                   *  03475015
034760*--------------------------------------------------------------*  03476015
034770 2450-UPDATE-STR-GP-PRCHG.                                        03477015
034780                                                                  03478015
034790     MOVE '2450-UPDATE-STR-GP-PRCHG' TO PV-PARAGRAPH-NAME.        03479015
034791                                                                  03479115
034792     PERFORM                                                      03479215
034793        WITH TEST AFTER                                           03479315
034794        VARYING PV-NUMBER-OF-RETRIES                              03479415
034795        FROM 1 BY 1                                               03479515
034796        UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES        03479615
034797           OR (SQLCODE = +100 OR +0))                             03479717
034798                                                                  03479815
034799         EXEC SQL                                                 03479915
034800              UPDATE XST_STR_GP_PRCHGH                            03480015
034801                 SET STR_GP_TYP_CDE = :XST00128-STR-GP-TYP-CDE    03480115
034802                    ,STR_GP_ID = :XST00128-STR-GP-ID              03480215
034803                    ,PRCHG_ID = :XST00128-PRCHG-ID                03480315
034804                    ,PRCHG_EFF_DTE = :XST00128-PRCHG-EFF-DTE      03480415
034805                    ,OH_AUTO_CNT_IND = :XST00128-OH-AUTO-CNT-IND  03480515
034806                    ,SOR_LAST_UPD_TMST =                          03480615
034807                                     :XST00128-SOR-LAST-UPD-TMST  03480715
034808                    ,LAST_UPD_TMST = :XST00128-LAST-UPD-TMST      03480815
034809                    ,LAST_ACTN_CDE = :XST00128-LAST-ACTN-CDE      03480915
034810                    ,CRE_ROW_DT = CURRENT_DATE                    03481015
034811              WHERE PRCHG_ID = :XST00128-PRCHG-ID                 03481115
034812                AND STR_GP_TYP_CDE = :XST00128-STR-GP-TYP-CDE     03481215
034813                AND STR_GP_ID = :XST00128-STR-GP-ID               03481315
034822         END-EXEC                                                 03482215
034823                                                                  03482315
034824         EVALUATE TRUE                                            03482415
034825           WHEN SQLCODE = 0                                       03482515
034826             ADD +1 TO PV-STRGP-PRCHG-UPDT-CNT                    03482615
034829           WHEN SQLCODE = -904                                    03482915
034830           WHEN SQLCODE = -911                                    03483015
034831           WHEN SQLCODE = -913                                    03483115
034832             CONTINUE                                             03483215
034833           WHEN OTHER                                             03483315
034834             DISPLAY '>>> FAILING ON UPDATE TO STR GP PRCHGH'     03483415
034835                     XS147-STR-GP-TYP-CDE, '-',                   03483515
034836                     XS147-STR-GP-ID, ' FOR ',                    03483615
034837                     XS147-PRCHG-ID-KEY,                          03483715
034838                     '<<<'                                        03483815
034839             MOVE 'ERROR ON INSERT OF STR_GP_PRCHG' TO            03483915
034840                  PV-DB2-OPERATION                                03484015
034841             PERFORM 9900-SQL-ABEND                               03484115
034842                                                                  03484215
034843         END-EVALUATE                                             03484315
034844     END-PERFORM.                                                 03484415
034845                                                                  03484515
034846     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               03484615
034847         MOVE 'INSERT RETRIES EXCEEDED' TO PV-DB2-OPERATION       03484715
034848         PERFORM 9900-SQL-ABEND                                   03484815
034849     END-IF.                                                      03484915
034850                                                                  03485015
034851*2450-EXIT.                                                       03485115
034852                                                                  03485215
034860*--------------------------------------------------------------*  03486015
034900*  POPULATE THE DCLGEN VARIABLES FOR  XST_PRCHG_MDSEH TABLE       03490019
035100*--------------------------------------------------------------*  03510001
035200 2500-LOAD-PRCHG-MDSEH.                                           03520007
035300                                                                  03530001
035400     MOVE '2500-LOAD-PRCHG-MDSEH' TO  PV-PARAGRAPH-NAME.          03540007
035410     INITIALIZE DCLXST00129.                                      03541007
035420                                                                  03542007
035430     MOVE XS147-PRCHG-ID-KEY      TO XST00129-PRCHG-ID            03543007
035440     MOVE XS147-STR-GP-TYP-CDE-K  TO XST00129-STR-GP-TYP-CDE      03544007
035450     MOVE XS147-STR-GP-ID-K       TO XST00129-STR-GP-ID           03545007
035460     MOVE XS147-PRCHG-MDSE-ID     TO XST00129-PRCHG-MDSE-ID       03546007
035470     MOVE XS147-MDSE-HIER-CDE     TO XST00129-MDSE-HIER-CDE       03547007
035471                                                                  03547107
035472     IF XS147-DEPT-NBR-NUL = PC-NULL-VALUE                        03547207
035473        MOVE -1                   TO PV-NULL-DEPT                 03547307
035474     ELSE                                                         03547407
035475        MOVE XS147-DEPT-NBR       TO XST00129-DEPT-NBR            03547507
035476     END-IF.                                                      03547607
035480                                                                  03548007
035490     IF XS147-MAJ-CL-NBR-NUL = PC-NULL-VALUE                      03549007
035491        MOVE -1                   TO PV-NULL-MAJ-CL               03549107
035492     ELSE                                                         03549207
035493        MOVE XS147-MAJ-CL-NBR        TO XST00129-MAJ-CL-NBR       03549307
035494     END-IF.                                                      03549407
035495                                                                  03549507
035496     IF XS147-SUB-CL-NBR = PC-NULL-VALUE                          03549607
035497        MOVE -1                   TO PV-NULL-SUB-CL               03549707
035498     ELSE                                                         03549807
035499        MOVE XS147-SUB-CL-NBR        TO XST00129-SUB-CL-NBR       03549907
035500     END-IF.                                                      03550007
035501                                                                  03550107
035502     IF XS147-STYL-ID-NUL = PC-NULL-VALUE                         03550207
035503        MOVE -1                   TO PV-NULL-STYLE                03550307
035504     ELSE                                                         03550407
035505        MOVE XS147-STYL-ID        TO XST00129-STYL-ID             03550507
035506     END-IF.                                                      03550607
035507                                                                  03550707
035508     IF XS147-SKU-NBR-NUL = PC-NULL-VALUE                         03550807
035509        MOVE -1                   TO PV-NULL-SKU                  03550907
035510     ELSE                                                         03551007
035511        MOVE XS147-SKU-NBR           TO XST00129-SKU-NBR          03551107
035512     END-IF.                                                      03551207
035513                                                                  03551307
035514     IF XS147-UNT-RTL-AMT-NUL = PC-NULL-VALUE                     03551407
035515        MOVE -1                   TO PV-NULL-UNIT-RTL             03551507
035516     ELSE                                                         03551607
035517        MOVE XS147-UNT-RTL-AMT       TO XST00129-UNT-RTL-AMT      03551707
035518     END-IF.                                                      03551807
035519                                                                  03551907
035520     IF XS147-GP-PRIC-ID-NUL = PC-NULL-VALUE                      03552007
035521        MOVE -1                   TO PV-NULL-GP-PRIC-ID           03552107
035522     ELSE                                                         03552207
035523        MOVE XS147-GP-PRIC-ID        TO XST00129-GP-PRIC-ID       03552307
035524     END-IF.                                                      03552407
035525                                                                  03552507
035526     IF XS147-GP-RTL-QTY-NUL = PC-NULL-VALUE                      03552607
035527        MOVE -1                   TO PV-NULL-GP-RTL-QTY           03552707
035528     ELSE                                                         03552807
035529        MOVE XS147-GP-RTL-QTY     TO XST00129-GP-RTL-QTY          03552907
035530     END-IF.                                                      03553007
035531                                                                  03553107
035532     IF XS147-GP-RTL-AMT-NUL = PC-NULL-VALUE                      03553207
035533        MOVE -1                  TO PV-NULL-GP-RTL-AMT            03553307
035534     ELSE                                                         03553407
035535        MOVE XS147-GP-RTL-AMT        TO XST00129-GP-RTL-AMT       03553507
035536     END-IF.                                                      03553607
035537                                                                  03553707
035538     IF XS147-CLR-TYP-CDE = PC-NULL-VALUE                         03553807
035539        MOVE -1                   TO PV-NULL-CLR-TYP-CDE          03553907
035540     ELSE                                                         03554007
035541        MOVE XS147-CLR-TYP-CDE       TO XST00129-CLR-TYP-CDE      03554107
035542     END-IF.                                                      03554207
035543                                                                  03554307
035544     MOVE XS147-SOR-LAST-UPD-TMST3                                03554407
035545                                  TO XST00129-SOR-LAST-UPD-TMST   03554507
035546     MOVE XS147-LAST-UPD-TMST3    TO XST00129-LAST-UPD-TMST       03554607
035547     MOVE XS147-LAST-ACTN-CDE3    TO XST00129-LAST-ACTN-CDE       03554707
035548                                                                  03554807
035549     IF PS-STRGP-UPDATED                                          03554914
035550        PERFORM 2700-UPDATE-PRCHG-MDSEH                           03555014
035552        IF PS-PMDSE-UPDATE-FAILED                                 03555215
035553           DISPLAY ' UPDATE OF MDSE FAILED ROW WILL BE INSRTED'   03555319
035554           PERFORM 2600-INSERT-PRCHG-MDSEH                        03555415
035555        END-IF                                                    03555515
035556     ELSE                                                         03555614
035557        PERFORM 2600-INSERT-PRCHG-MDSEH                           03555714
035559        IF PS-PMDSE-INSERT-FAILED                                 03555915
035560           DISPLAY ' INSERT OF MDSE FAILED ROW WILL BE UPDATED'   03556019
035561           PERFORM 2700-UPDATE-PRCHG-MDSEH                        03556115
035562        END-IF                                                    03556215
035563     END-IF.                                                      03556314
035564                                                                  03556407
035565*2500-EXIT.                                                       03556507
035566                                                                  03556607
035567*--------------------------------------------------------------*  03556707
035568*  INSERT XST_PRCHG_MDSEH ROW                                     03556819
035569*--------------------------------------------------------------*  03556907
035570 2600-INSERT-PRCHG-MDSEH.                                         03557007
035571                                                                  03557107
035572     MOVE '2600-INSERT-PRCHG-MDSEH' TO  PV-PARAGRAPH-NAME.        03557207
035580                                                                  03558007
035600     PERFORM                                                      03560001
035700         WITH TEST AFTER                                          03570001
035800         VARYING PV-NUMBER-OF-RETRIES                             03580001
035900         FROM 1 BY 1                                              03590001
036000         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       03600001
036100            OR (SQLCODE = -803 OR +0))                            03610015
036200                                                                  03620001
036300         EXEC SQL                                                 03630001
036400             INSERT INTO XST_PRCHG_MDSEH                          03640007
036500                        ( STR_GP_TYP_CDE                          03650007
036600                         ,STR_GP_ID                               03660007
036610                         ,PRCHG_ID                                03661007
036620                         ,PRCHG_MDSE_ID                           03662007
036630                         ,MDSE_HIER_CDE                           03663007
036640                         ,DEPT_NBR                                03664007
036650                         ,MAJ_CL_NBR                              03665007
036660                         ,SUB_CL_NBR                              03666007
036670                         ,STYL_ID                                 03667007
036680                         ,SKU_NBR                                 03668007
036690                         ,UNT_RTL_AMT                             03669007
036692                         ,GP_PRIC_ID                              03669207
036694                         ,GP_RTL_QTY                              03669407
036696                         ,GP_RTL_AMT                              03669607
036698                         ,CLR_TYP_CDE                             03669807
036701                         ,SOR_LAST_UPD_TMST                       03670107
036702                         ,LAST_UPD_TMST                           03670207
036703                         ,LAST_ACTN_CDE                           03670307
036704                         ,CRE_ROW_DT)                             03670407
036705                 VALUES (:XST00129-STR-GP-TYP-CDE                 03670509
036706                        ,:XST00129-STR-GP-ID                      03670609
036707                        ,:XST00129-PRCHG-ID                       03670709
036708                        ,:XST00129-PRCHG-MDSE-ID                  03670809
036709                        ,:XST00129-MDSE-HIER-CDE                  03670909
036710                        ,:XST00129-DEPT-NBR                       03671009
036711                         :PV-NULL-DEPT                            03671108
036712                        ,:XST00129-MAJ-CL-NBR                     03671209
036713                         :PV-NULL-MAJ-CL                          03671308
036714                        ,:XST00129-SUB-CL-NBR                     03671409
036715                         :PV-NULL-SUB-CL                          03671508
036716                        ,:XST00129-STYL-ID                        03671609
036717                         :PV-NULL-STYLE                           03671708
036718                        ,:XST00129-SKU-NBR                        03671809
036719                         :PV-NULL-SKU                             03671908
036720                        ,:XST00129-UNT-RTL-AMT                    03672009
036721                         :PV-NULL-UNIT-RTL                        03672108
036722                        ,:XST00129-GP-PRIC-ID                     03672209
036723                         :PV-NULL-GP-PRIC-ID                      03672308
036724                        ,:XST00129-GP-RTL-QTY                     03672409
036725                         :PV-NULL-GP-RTL-QTY                      03672508
036726                        ,:XST00129-GP-RTL-AMT                     03672609
036727                         :PV-NULL-GP-RTL-AMT                      03672708
036728                        ,:XST00129-CLR-TYP-CDE                    03672809
036729                         :PV-NULL-CLR-TYP-CDE                     03672908
036730                        ,:XST00129-SOR-LAST-UPD-TMST              03673009
036731                        ,:XST00129-LAST-UPD-TMST                  03673109
036732                        ,:XST00129-LAST-ACTN-CDE                  03673209
036733                        ,CURRENT_DATE)                            03673307
036740         END-EXEC                                                 03674001
036800                                                                  03680001
036900         EVALUATE TRUE                                            03690001
037000             WHEN SQLCODE = 0                                     03700001
037100                 ADD +1 TO PV-MDSE-PRCHG-LOAD-CNT                 03710008
037200                 SET PS-PMDSE-INS-UPD-SUCCESS TO TRUE             03720015
037210             WHEN SQLCODE = -803                                  03721015
037220                 SET PS-PMDSE-INSERT-FAILED TO TRUE               03722015
037300             WHEN SQLCODE = -904                                  03730001
037400             WHEN SQLCODE = -911                                  03740001
037500             WHEN SQLCODE = -913                                  03750001
037600                 CONTINUE                                         03760001
037700             WHEN OTHER                                           03770001
037800                DISPLAY '>>> FAILING ON INSERT OF PRCHG_MDSEH '   03780007
037900                     XS147-PRCHG-ID-KEY, '-',                     03790007
038000                     '<<<'                                        03800001
038100                 MOVE 'ERROR ON INSERT OF PRCHG_MDSEH ' TO        03810007
038200                      PV-DB2-OPERATION                            03820001
038300                 PERFORM 9900-SQL-ABEND                           03830001
038400         END-EVALUATE                                             03840001
038500     END-PERFORM.                                                 03850001
038600                                                                  03860001
038700     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               03870001
038800         MOVE 'INSERT RETRIES EXCEEDED' TO PV-DB2-OPERATION       03880008
038900         PERFORM 9900-SQL-ABEND                                   03890001
039000     END-IF.                                                      03900001
039100                                                                  03910001
039110*2600-EXIT.                                                       03911007
039120                                                                  03912007
039130*--------------------------------------------------------------*  03913015
039140*  UPDATE THE XST_PRCHG_MDSEH TABLE                               03914019
039150*--------------------------------------------------------------*  03915015
039160 2700-UPDATE-PRCHG-MDSEH.                                         03916015
039170                                                                  03917015
039180     MOVE '2600-INSERT-PRCHG-MDSEH' TO  PV-PARAGRAPH-NAME.        03918015
039190                                                                  03919015
039191     PERFORM                                                      03919115
039192         WITH TEST AFTER                                          03919215
039193         VARYING PV-NUMBER-OF-RETRIES                             03919315
039194         FROM 1 BY 1                                              03919415
039195         UNTIL (PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES       03919515
039196            OR (SQLCODE = +100 OR +0))                            03919615
039197                                                                  03919715
039198         EXEC SQL                                                 03919815
039199             UPDATE XST_PRCHG_MDSEH                               03919915
039200                SET STR_GP_TYP_CDE = :XST00129-STR-GP-TYP-CDE     03920015
039201                   ,STR_GP_ID = :XST00129-STR-GP-ID               03920115
039202                   ,PRCHG_ID =  :XST00129-PRCHG-ID                03920215
039203                   ,PRCHG_MDSE_ID = :XST00129-PRCHG-MDSE-ID       03920315
039204                   ,MDSE_HIER_CDE = :XST00129-MDSE-HIER-CDE       03920415
039205                   ,DEPT_NBR = :XST00129-DEPT-NBR                 03920515
039206                               :PV-NULL-DEPT                      03920615
039207                   ,MAJ_CL_NBR = :XST00129-MAJ-CL-NBR             03920715
039208                               :PV-NULL-MAJ-CL                    03920815
039209                   ,SUB_CL_NBR = :XST00129-SUB-CL-NBR             03920915
039210                               :PV-NULL-SUB-CL                    03921015
039211                   ,STYL_ID = :XST00129-STYL-ID                   03921115
039212                              :PV-NULL-STYLE                      03921215
039213                   ,SKU_NBR = :XST00129-SKU-NBR                   03921315
039214                              :PV-NULL-SKU                        03921415
039215                   ,UNT_RTL_AMT = :XST00129-UNT-RTL-AMT           03921515
039216                                  :PV-NULL-UNIT-RTL               03921615
039217                   ,GP_PRIC_ID =  :XST00129-GP-PRIC-ID            03921715
039218                                  :PV-NULL-GP-PRIC-ID             03921815
039219                   ,GP_RTL_QTY =  :XST00129-GP-RTL-QTY            03921915
039220                                  :PV-NULL-GP-RTL-QTY             03922015
039221                   ,GP_RTL_AMT =  :XST00129-GP-RTL-AMT            03922115
039222                                  :PV-NULL-GP-RTL-AMT             03922215
039223                   ,CLR_TYP_CDE = :XST00129-CLR-TYP-CDE           03922315
039224                                  :PV-NULL-CLR-TYP-CDE            03922415
039225                   ,SOR_LAST_UPD_TMST =                           03922515
039226                                      :XST00129-SOR-LAST-UPD-TMST 03922615
039227                   ,LAST_UPD_TMST = :XST00129-LAST-UPD-TMST       03922715
039228                   ,LAST_ACTN_CDE = :XST00129-LAST-ACTN-CDE       03922815
039229                   ,CRE_ROW_DT = CURRENT_DATE                     03922915
039230             WHERE STR_GP_TYP_CDE = :XST00129-STR-GP-TYP-CDE      03923015
039231               AND STR_GP_ID = :XST00129-STR-GP-ID                03923115
039232               AND PRCHG_ID = :XST00129-PRCHG-ID                  03923215
039233               AND PRCHG_MDSE_ID = :XST00129-PRCHG-MDSE-ID        03923315
039259         END-EXEC                                                 03925915
039260                                                                  03926015
039261         EVALUATE TRUE                                            03926115
039262             WHEN SQLCODE = 0                                     03926215
039263                 ADD +1 TO PV-MDSE-PRCHG-UPDT-CNT                 03926317
039264                 SET PS-PMDSE-INS-UPD-SUCCESS TO TRUE             03926415
039265             WHEN SQLCODE = +100                                  03926523
039266                 SET PS-PMDSE-UPDATE-FAILED  TO TRUE              03926623
039268             WHEN SQLCODE = -904                                  03926815
039269             WHEN SQLCODE = -911                                  03926915
039270             WHEN SQLCODE = -913                                  03927015
039271                 CONTINUE                                         03927115
039272             WHEN OTHER                                           03927215
039273                DISPLAY '>>> FAILING ON UPDATE OF PRCHG_MDSEH '   03927315
039274                     XS147-PRCHG-ID-KEY, '-',                     03927415
039275                     '<<<'                                        03927515
039276                 MOVE 'ERROR ON INSERT OF PRCHG_MDSEH ' TO        03927615
039277                      PV-DB2-OPERATION                            03927715
039278                 PERFORM 9900-SQL-ABEND                           03927815
039279         END-EVALUATE                                             03927915
039280     END-PERFORM.                                                 03928015
039281                                                                  03928115
039282     IF PV-NUMBER-OF-RETRIES GREATER PC-MAX-RETRIES               03928215
039283         MOVE 'INSERT RETRIES EXCEEDED' TO PV-DB2-OPERATION       03928315
039284         PERFORM 9900-SQL-ABEND                                   03928415
039285     END-IF.                                                      03928515
039286                                                                  03928615
039287*2700-EXIT.                                                       03928715
039288                                                                  03928815
039290*--------------------------------------------------------------*  03929015
039300* 9900-SQL-ABEND.                                                 03930001
039400*     SQL ABEND ROUTINE.                                          03940001
039500*--------------------------------------------------------------*  03950001
039600 9900-SQL-ABEND.                                                  03960001
039700                                                                  03970001
039800     DISPLAY '** ABEND     **'.                                   03980001
039900     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                03990001
040000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04000001
040100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               04010001
040200                                                                  04020001
040300     COPY DPPD004.                                                04030001
040400     SET ABEND-4013-DB2-ERROR TO TRUE.                            04040001
040500     CALL 'ILBOABN0' USING ABEND-CODE.                            04050001
040600                                                                  04060001
040700*--------------------------------------------------------------*  04070001
040800* 9999-WRAPUP.                                                    04080001
040900*     END OF PROGRAM ROUTINE.  RESET STATUS CODE AND DISPLAYS     04090001
041000*     DATA COUNTS FROM THE PROGRAM.                               04100001
041100*--------------------------------------------------------------*  04110001
041200 9999-WRAPUP.                                                     04120001
041300                                                                  04130001
041400     DISPLAY '   '.                                               04140001
041500     DISPLAY '**************************************************'.04150008
041600     DISPLAY '**SUMMARY OF XSKUP132 - PRICE CHANGE HISTORY LOAD*'.04160008
041700     DISPLAY '**************************************************'.04170008
041800     DISPLAY ' # XST TOTAL ROWS INSERTED TO XST_PRCHGH: '         04180024
041900             PV-PRCHG-LOAD-CNT.                                   04190008
042000     DISPLAY ' # XST TOTAL ROWS INSERTED TO XST_STR_GP_PRCHGH: '  04200017
042100             PV-STRGP-PRCHG-LOAD-CNT.                             04210008
042200     DISPLAY ' # XST TOTAL ROWS INSERTED TO XST_PRCHG_MDSEH: '    04220017
042300             PV-MDSE-PRCHG-LOAD-CNT.                              04230008
042600                                                                  04260001
042610     DISPLAY ' # XST TOTAL ROWS UPDATED  TO XST_PRCHGH: '         04261024
042620             PV-PRCHG-UPDT-CNT.                                   04262017
042630     DISPLAY ' # XST TOTAL ROWS UPDATED TO XST_STR_GP_PRCHGH: '   04263017
042640             PV-STRGP-PRCHG-UPDT-CNT.                             04264017
042650     DISPLAY ' # XST TOTAL ROWS UPDATED TO XST_PRCHG_MDSEH:  '    04265017
042660             PV-MDSE-PRCHG-UPDT-CNT.                              04266017
042670                                                                  04267017
042680     DISPLAY '   '.                                               04268020
042700     DISPLAY '       END OF PROGRAM: ' PC-PROGRAM-NAME.           04270001
042710     DISPLAY '   '.                                               04271020
042800                                                                  04280001
042900     MOVE PC-TRAN-PRES-FUNC-CLOSE TO DP001-FUNC-CODE.             04290001
043000     PERFORM Z100-BUILD-COMM-AREA-TRAN-PRES.                      04300001
043100                                                                  04310001
043200******************************************************************04320001
043300*     Z100-BUILD-COMM-AREA-TRAN-PRES                             *04330001
043400*     - BUILD THE COMMUNICATION AREA FOR A CALL TO THE           *04340001
043500*       TRANSACTION PRESENTATION MODULE.                         *04350001
043600******************************************************************04360001
043700 Z100-BUILD-COMM-AREA-TRAN-PRES.                                  04370001
043800                                                                  04380001
043900     MOVE LENGTH OF WORK-STORAGE-PASSED                           04390001
044000                                       TO DP001-WORK-STRG-LENGTH. 04400001
044100     MOVE PC-CKPT-JOB-NAME             TO DP001-JOB-NAME.         04410001
044200     MOVE PC-CKPT-PLAN-NAME            TO DP001-PLAN-NAME.        04420001
044300     PERFORM Z900-CALL-TRANS-PRES-MODULE.                         04430001
044400     IF DP001-GOOD-RET-CODE                                       04440001
044500             OR DP001-CKPT-TAKEN                                  04450001
044600             OR DP001-RESTART                                     04460001
044700         MOVE DP001-TRANS-RECORD TO  XS147-PERM-EXTRACT           04470011
044800     ELSE                                                         04480001
044900         DISPLAY 'Z100-BUILD-COMM-AREA-TRAN-PRES '                04490001
045000         DISPLAY 'ERROR CALLING CHECKPOINT ROUTINE ON '           04500001
045100             DP001-FUNC-CODE                                      04510001
045200         DISPLAY 'DP001-RET-CODE IS ' DP001-RET-CODE              04520001
045300         PERFORM Z900-SQL-ABEND                                   04530001
045400     END-IF.                                                      04540001
045500                                                                  04550001
045600******************************************************************04560001
045700*  ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING    *04570001
045800*  CODE OCCURS.                                                  *04580001
045900******************************************************************04590001
046000 Z900-SQL-ABEND.                                                  04600001
046100                                                                  04610001
046200     DISPLAY '** ABEND     **'.                                   04620001
046300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04630001
046400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04640001
046500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               04650001
046600                                                                  04660001
046700******************************************************************04670001
046800*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-  *04680001
046900*  MENTS THAT ARE REQUIRED TO INVOKE THE TRANSACTION PRESENTATION*04690001
047000*  MODULE (DPKUT901) OF THE DB2 CHECKPOINT RESTART SYSTEM.       *04700001
047100******************************************************************04710001
047200     COPY DPPD001.                                                04720001
