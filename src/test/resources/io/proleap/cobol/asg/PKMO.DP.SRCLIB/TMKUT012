000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.             TMKUT012.                                        
000600 AUTHOR.                 VIRGENE LENNEMAN.                                
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                         
000800 DATE-WRITTEN            02/13/98.                                        
000900 DATE-COMPILED.                                                           
001000                                                                          
001100*----------------------------------------------------------------*        
001200* THIS PROGRAM WILL CREATE A MERGED FILE FROM TMKUT010 AND FROM  *        
001300* TMKUT011 CONTAINING ALL THE INFORMATION NEEDED FOR TMKRP015    *        
001500* (TOP XXXX TROUBLE VENDORS REPORT PROGRAM)                      *        
001600*----------------------------------------------------------------*        
001700                                                                          
001800******************************************************************        
001900 ENVIRONMENT DIVISION.                                                    
002000******************************************************************        
002100                                                                          
002200 CONFIGURATION SECTION.                                                   
002300                                                                          
002400 SOURCE-COMPUTER.        IBM-3090.                                        
002500 OBJECT-COMPUTER.        IBM-3090.                                        
002600                                                                          
002700 INPUT-OUTPUT SECTION.                                                    
002800                                                                          
002900 FILE-CONTROL.                                                            
003000                                                                          
003100      SELECT EXTRACT-TRBL-FILE-IN       ASSIGN TO INP01.                  
003200                                                                          
003300      SELECT RECEIVER-FILE-IN           ASSIGN TO INP02.                  
003000                                                                          
003100      SELECT EXTRACT-TRBL-FILE-OUT      ASSIGN TO OUT01.                  
003400                                                                          
003500******************************************************************        
003600 DATA DIVISION.                                                           
003700******************************************************************        
003800                                                                          
003900 FILE SECTION.                                                            
004000 FD  EXTRACT-TRBL-FILE-IN                                                 
004100     LABEL RECORDS ARE STANDARD                                           
004200     BLOCK CONTAINS 0 RECORDS                                             
004300     RECORDING MODE IS F                                                  
004400     RECORD CONTAINS 400 CHARACTERS                                       
004500     DATA RECORD IS TE-TRBL-EXTRACT-RCD-IN.                               
004600                                                                          
004700 01  TE-TRBL-EXTRACT-RCD-IN          PIC X(400).                          
004800                                                                          
004900                                                                          
005000 FD  RECEIVER-FILE-IN                                                     
005100     LABEL RECORDS ARE STANDARD                                           
005200     BLOCK CONTAINS 0 RECORDS                                             
005300     RECORDING MODE IS F                                                  
005400     RECORD CONTAINS 50  CHARACTERS                                       
005500     DATA RECORD IS RECEIVER-RECORD.                                      
005600                                                                          
005700 01  RECEIVER-RECORD                 PIC X(50).                           
004900                                                                          
004000 FD  EXTRACT-TRBL-FILE-OUT                                                
004100     LABEL RECORDS ARE STANDARD                                           
004200     BLOCK CONTAINS 0 RECORDS                                             
004300     RECORDING MODE IS F                                                  
004400     RECORD CONTAINS 400 CHARACTERS                                       
004500     DATA RECORD IS TE-TRBL-EXTRACT-RCD-OUT.                              
004600                                                                          
004700 01  TE-TRBL-EXTRACT-RCD-OUT         PIC X(400).                          
004800                                                                          
005800*------------------------------------------------------*                  
005900 WORKING-STORAGE SECTION.                                                 
006000*------------------------------------------------------*                  
009100                                                                          
006100 01 PC-PROGRAM-CONSTANTS.                                                 
006200    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'TMKUT012'.          
006300    05 PC-DEFAULT-CC-DATE            PIC X(10) VALUE '1999-99-99'.        
005200    05 PC-DEFAULT-TIMESTAMP          PIC X(26) VALUE                      
005300                                     '9999-09-09-09.09.09.999999'.        
006600    05 PC-A                          PIC  X(01) VALUE 'A'.                
006600    05 PC-B                          PIC  X(01) VALUE 'B'.                
006600    05 PC-999                        PIC  X(03) VALUE '999'.              
006600    05 PC-9999                       PIC S9(04) VALUE +9999.              
006600    05 PC-9999999                    PIC S9(07) VALUE +9999999.           
006600    05 PC-999999999                  PIC S9(09) VALUE +999999999.         
009100                                                                          
014700 01 PS-PROGRAM-SWITCHES.                                                  
015100    05 PS-END-OF-FILE-TE-SW          PIC X(01)     VALUE 'N'.             
015200       88 PS-EOF-TE                                VALUE 'Y'.             
015300       88 PS-NOT-EOF-TE                            VALUE 'N'.             
015100    05 PS-END-OF-FILE-RCV-SW         PIC X(01)     VALUE 'N'.             
015200       88 PS-EOF-RCV                               VALUE 'Y'.             
015300       88 PS-NOT-EOF-RCV                           VALUE 'N'.             
015800    05 PS-FIRST-TIME-SW              PIC X(01)     VALUE 'Y'.             
015900       88 PS-FIRST-TIME                            VALUE 'Y'.             
016000       88 PS-NOT-FIRST-TIME                        VALUE 'N'.             
015800    05 PS-WAITNG-FOR-AL-B-SW         PIC X(01)     VALUE 'Y'.             
015900       88 PS-WAITING-FOR-AL-B                      VALUE 'Y'.             
016000       88 PS-NOT-WAITING-FOR-AL-B                  VALUE 'N'.             
015800    05 PS-WAITNG-FOR-BF-B-SW         PIC X(01)     VALUE 'Y'.             
015900       88 PS-WAITING-FOR-BF-B                      VALUE 'Y'.             
016000       88 PS-NOT-WAITING-FOR-BF-B                  VALUE 'N'.             
015800    05 PS-FIRST-AL-SW                PIC X(01)     VALUE 'Y'.             
015900       88 PS-FIRST-AL                              VALUE 'Y'.             
016000       88 PS-NOT-FIRST-AL                          VALUE 'N'.             
015800    05 PS-FIRST-BF-SW                PIC X(01)     VALUE 'Y'.             
015900       88 PS-FIRST-BF                              VALUE 'Y'.             
016000       88 PS-NOT-FIRST-BF                          VALUE 'N'.             
018200                                                                          
023600                                                                          
023700 01 PV-PROGRAM-VARIABLES.                                                 
023800    05  PV-ABEND-CODE                PIC  9(04)    VALUE ZEROS.           
029800    05  PV-PARA-NAME                 PIC  X(30)    VALUE SPACE.           
035100    05  PV-DISPLAY-RSN-CDE           PIC 9(9)      VALUE ZEROS.           
035200    05  PV-ABEND-PARA-NAME           PIC X(30)     VALUE SPACE.           
035600    05  PV-PARAGRAPH-NAME            PIC X(30)     VALUE SPACE.           
035700    05  PV-SAVE-KEY.                                                      
041800        10  PV-SAVE-ENT              PIC S9(09) VALUE 0 COMP.             
041800        10  PV-SAVE-DEPT             PIC  X(03) VALUE SPACES.             
041800    05  PV-RCVR-IN-TRBL-CNT          PIC S9(09) VALUE 0 COMP-3.           
041800    05  PV-TE-RECS-READ              PIC  9(09) VALUE ZEROS.              
041800    05  PV-RCV-RECS-READ             PIC  9(09) VALUE ZEROS.              
041800    05  PV-TE-RECS-WRITTEN           PIC  9(09) VALUE ZEROS.              
041800    05  PV-ASSIGN-TOT-QTY            PIC S9(07) VALUE 0 COMP-3.           
048400    05  PV-SAVE-RCVRS-VRFYD-QTY      PIC S9(09) VALUE 0 COMP-3.           
048400    05  PV-SAVE-VRFYD-TRBL-QTY       PIC S9(09) VALUE 0 COMP-3.           
048400    05  PV-SAVE-PO-RECVD-QTY         PIC S9(09) VALUE 0 COMP-3.           
048400    05  PV-SAVE-PO-IN-TRBL-QTY       PIC S9(09) VALUE 0 COMP-3.           
041800    05  PV-SAVE-AL-TRBL              PIC S9(07) VALUE 0 COMP-3.           
041800                                                                          
041800                                                                          
041800                                                                          
041900*** FILE LAYOUT AREA OF RECEIVER FILE                                     
009200 01  WS-RECEIVER-RECORD.                                                  
009300     05  RCV-RECEIPT-KEY.                                                 
009300         10 RCV-RECEIPT-ENT-ID       PIC S9(09) COMP.                     
009400         10 RCV-RECEIPT-DEPT-NBR     PIC  X(03) VALUE SPACES.             
009900     05  RCV-RECEIPT-RCVRS-VRFYD-QTY PIC S9(09) COMP-3.                   
010000     05  RCV-RECEIPT-VRFYD-TRBL-QTY  PIC S9(09) COMP-3.                   
010000     05  RCV-RECEIPT-PO-RECVD-QTY    PIC S9(09) COMP-3.                   
010000     05  RCV-RECEIPT-PO-IN-TRBL-QTY  PIC S9(09) COMP-3.                   
010700     05  FILLER                      PIC  X(23) VALUE SPACES.             
010800                                                                          
010800*** SORT FIELDS FOR OUTPUT EXTRACT RECORD                                 
010800 01  WS-SORT-FIELDS-TMKUT012.                                             
010800     05  WS-SF-VDR-ASSIGN-TOT-QTY    PIC S9(07) COMP-3 VALUE 0.           
010800     05  WS-SF-VDR-ENT-ID            PIC S9(09) COMP   VALUE 0.           
010800     05  WS-SF-DPT-ASSIGN-TOT-QTY    PIC S9(07) COMP-3 VALUE 0.           
010800     05  WS-SF-DPT-DEPT-NBR          PIC  X(03)     VALUE SPACES.         
010800     05  WS-SF-TRB-ASSIGN-TOT-QTY    PIC S9(07) COMP-3 VALUE 0.           
010800     05  WS-SF-TRB-TRBL-RSN-CDE      PIC S9(04) COMP   VALUE 0.           
010800     05  WS-SF-REPORT-NOTIF-CDE      PIC X          VALUE SPACES.         
010800     05  FILLER                      PIC  X(03)     VALUE SPACES.         
010800                                                                          
010800*** SAVE AREA FOR TROUBLE RECORD 'A', THIS IS ONLY PART OF                
010800*** THE TROUBLE EXTRACT RECORD LAYOUT COVERING THE HEADER RECORD,         
010800*** THE VENDOR DETAIL SUMMARY (AL), THE VENDOR DEPARTMENT SUMMARY         
010800*** (BF) AND THE VENDOR DEPARTMENT TROUBLE REASON (CF) RECORDS.           
010800                                                                          
001200 01  SAVEA-TRBL-EXT-RECORD.                                               
001300     05  SAVEA-RECORD-TYPE-CDE       PIC X(02).                           
002010     05  SAVEA-SORT-FIELD            PIC X(25).                           
002020     05  SAVEA-REPORT-DIVISION       PIC X(2).                            
002052     05  SAVEA-REPORT-NOTIF-CDE      PIC X(1).                            
002055     05  SAVEA-REPORT-OPER-UNT-ID    PIC S9(4)  COMP.                     
002056     05  SAVEA-REPORT-GMM-NBR        PIC X(2).                            
002057     05  FILLER                      PIC X(05).                           
002100                                                                          
002200     05  SAVEA-HEADER-DETAIL-LAYOUT  PIC X(361) VALUE SPACES.             
010800******** 'AL' - VENDOR DETAIL SUMMARY                                     
014300     05  SAVEA-VENDOR-TOTAL-LAYOUT  REDEFINES                             
014400         SAVEA-HEADER-DETAIL-LAYOUT.                                      
014500                                                                          
014600         10  SAVEA-VTL-ENT-ID            PIC  S9(9) COMP.                 
014700         10  SAVEA-VTL-ENT-NAME-DESC     PIC   X(30).                     
014800         10  SAVEA-VTL-ASSIGN-TOT-QTY    PIC  S9(7) COMP-3.               
014810         10  SAVEA-VTL-RESOLVED-HOURS    PIC  S9(5) COMP-3.               
014820         10  SAVEA-VTL-RESOLVED-MINUTES  PIC  S9(3) COMP-3.               
014820         10  SAVEA-VTL-RCVRS-VRFYD-QTY   PIC  S9(9) COMP-3.               
014820         10  SAVEA-VTL-VRFYD-TRBL-QTY    PIC  S9(9) COMP-3.               
014820         10  SAVEA-VTL-PO-RECVD-QTY      PIC  S9(9) COMP-3.               
014820         10  SAVEA-VTL-PO-IN-TRBL-QTY    PIC  S9(9) COMP-3.               
014900         10  FILLER                      PIC   X(298).                    
014221                                                                          
010800******** 'BF' - VENDOR DEPARTMENT SUMMARY                                 
014290                                                                          
014300     05  SAVEA-VDR-DEPT-TOTAL-LAYOUT  REDEFINES                           
014400         SAVEA-HEADER-DETAIL-LAYOUT.                                      
014500                                                                          
014600         10  SAVEA-VDTL-ENT-ID           PIC  S9(9) COMP.                 
014700         10  SAVEA-VDTL-ENT-NAME-DESC    PIC   X(30).                     
014700         10  SAVEA-VDTL-DEPT-NBR         PIC   X(03).                     
014700         10  SAVEA-VDTL-DEPT-DESCRIPTION PIC   X(32).                     
014800         10  SAVEA-VDTL-ASSIGN-TOT-QTY   PIC  S9(7) COMP-3.               
014810         10  SAVEA-VDTL-AVG-RESOLV-HRS   PIC  S9(5) COMP-3.               
014820         10  SAVEA-VDTL-AVG-RESOLV-MINS  PIC  S9(3) COMP-3.               
014820         10  SAVEA-VDTL-RCVRS-VRFYD-QTY  PIC  S9(9) COMP-3.               
014820         10  SAVEA-VDTL-VRFYD-TRBL-QTY   PIC  S9(9) COMP-3.               
014820         10  SAVEA-VDTL-PO-RECVD-QTY     PIC  S9(9) COMP-3.               
014820         10  SAVEA-VDTL-PO-IN-TRBL-QTY   PIC  S9(9) COMP-3.               
014900         10  FILLER                      PIC   X(263).                    
014290                                                                          
010800******** 'CF' - VENDOR DEPARTMENT TROUBLE REASON                          
014300     05  SAVEA-VDR-DEPT-TRBL-TOT-LAYOUT  REDEFINES                        
014400         SAVEA-HEADER-DETAIL-LAYOUT.                                      
014500                                                                          
014600         10  SAVEA-VDTTL-ENT-ID            PIC S9(9)     COMP.            
014700         10  SAVEA-VDTTL-ENT-NAME-DESC     PIC X(30).                     
014700         10  SAVEA-VDTTL-DEPT-NBR          PIC X(03).                     
014700         10  SAVEA-VDTTL-DEPT-DESCRIPTION  PIC X(32).                     
014800         10  SAVEA-VDTTL-TRBL-RSN-CDE      PIC S9(4)     COMP.            
014810         10  SAVEA-VDTTL-TRBL-RSN-CDE-DESC PIC X(20).                     
014820         10  SAVEA-VDTTL-ASSIGN-TOT-QTY    PIC S9(7)     COMP-3.          
014820         10  SAVEA-VDTTL-AVG-RESOLV-HRS    PIC S9(5)     COMP-3.          
014820         10  SAVEA-VDTTL-AVG-RESOLV-MINS   PIC S9(3)     COMP-3.          
014900         10  FILLER                        PIC X(261).                    
044330                                                                          
044330                                                                          
010800*** SAVE AREA FOR TROUBLE RECORD 'B', THIS IS ONLY PART OF                
010800*** THE TROUBLE EXTRACT RECORD LAYOUT COVERING THE HEADER RECORD,         
010800*** THE VENDOR DETAIL SUMMARY (AL), THE VENDOR DEPARTMENT SUMMARY         
010800*** (BF) AND THE VENDOR DEPARTMENT TROUBLE REASON (CF) RECORDS.           
010800                                                                          
001200 01  SAVEB-TRBL-EXT-RECORD.                                               
001300     05  SAVEB-RECORD-TYPE-CDE       PIC X(02).                           
002010     05  SAVEB-SORT-FIELD            PIC X(25).                           
002020     05  SAVEB-REPORT-DIVISION       PIC X(2).                            
002052     05  SAVEB-REPORT-NOTIF-CDE      PIC X(1).                            
002055     05  SAVEB-REPORT-OPER-UNT-ID    PIC S9(4)  COMP.                     
002056     05  SAVEB-REPORT-GMM-NBR        PIC X(2).                            
002057     05  FILLER                      PIC X(05).                           
002100                                                                          
002200     05  SAVEB-HEADER-DETAIL-LAYOUT  PIC X(361) VALUE SPACES.             
010800******** 'AL' - VENDOR DETAIL SUMMARY                                     
014300     05  SAVEB-VENDOR-TOTAL-LAYOUT  REDEFINES                             
014400         SAVEB-HEADER-DETAIL-LAYOUT.                                      
014500                                                                          
014600         10  SAVEB-VTL-ENT-ID            PIC  S9(9) COMP.                 
014700         10  SAVEB-VTL-ENT-NAME-DESC     PIC   X(30).                     
014800         10  SAVEB-VTL-ASSIGN-TOT-QTY    PIC  S9(7) COMP-3.               
014810         10  SAVEB-VTL-RESOLVED-HOURS    PIC  S9(5) COMP-3.               
014820         10  SAVEB-VTL-RESOLVED-MINUTES  PIC  S9(3) COMP-3.               
014820         10  SAVEB-VTL-RCVRS-VRFYD-QTY   PIC  S9(9) COMP-3.               
014820         10  SAVEB-VTL-VRFYD-TRBL-QTY    PIC  S9(9) COMP-3.               
014820         10  SAVEB-VTL-PO-RECVD-QTY      PIC  S9(9) COMP-3.               
014820         10  SAVEB-VTL-PO-IN-TRBL-QTY    PIC  S9(9) COMP-3.               
014900         10  FILLER                      PIC   X(298).                    
014221                                                                          
010800******** 'BF' - VENDOR DEPARTMENT SUMMARY                                 
014290                                                                          
014300     05  SAVEB-VDR-DEPT-TOTAL-LAYOUT  REDEFINES                           
014400         SAVEB-HEADER-DETAIL-LAYOUT.                                      
014500                                                                          
014600         10  SAVEB-VDTL-ENT-ID           PIC  S9(9) COMP.                 
014700         10  SAVEB-VDTL-ENT-NAME-DESC    PIC   X(30).                     
014700         10  SAVEB-VDTL-DEPT-NBR         PIC   X(03).                     
014700         10  SAVEB-VDTL-DEPT-DESCRIPTION PIC   X(32).                     
014800         10  SAVEB-VDTL-ASSIGN-TOT-QTY   PIC  S9(7) COMP-3.               
014810         10  SAVEB-VDTL-AVG-RESOLV-HRS   PIC  S9(5) COMP-3.               
014820         10  SAVEB-VDTL-AVG-RESOLV-MINS  PIC  S9(3) COMP-3.               
014820         10  SAVEB-VDTL-RCVRS-VRFYD-QTY  PIC  S9(9) COMP-3.               
014820         10  SAVEB-VDTL-VRFYD-TRBL-QTY   PIC  S9(9) COMP-3.               
014820         10  SAVEB-VDTL-PO-RECVD-QTY     PIC  S9(9) COMP-3.               
014820         10  SAVEB-VDTL-PO-IN-TRBL-QTY   PIC  S9(9) COMP-3.               
014900         10  FILLER                      PIC   X(263).                    
014290                                                                          
010800******** 'CF' - VENDOR DEPARTMENT TROUBLE REASON                          
014300     05  SAVEB-VDR-DEPT-TRBL-TOT-LAYOUT  REDEFINES                        
014400         SAVEB-HEADER-DETAIL-LAYOUT.                                      
014500                                                                          
014600         10  SAVEB-VDTTL-ENT-ID            PIC S9(9)     COMP.            
014700         10  SAVEB-VDTTL-ENT-NAME-DESC     PIC X(30).                     
014700         10  SAVEB-VDTTL-DEPT-NBR          PIC X(03).                     
014700         10  SAVEB-VDTTL-DEPT-DESCRIPTION  PIC X(32).                     
014800         10  SAVEB-VDTTL-TRBL-RSN-CDE      PIC S9(4)     COMP.            
014810         10  SAVEB-VDTTL-TRBL-RSN-CDE-DESC PIC X(20).                     
014820         10  SAVEB-VDTTL-ASSIGN-TOT-QTY    PIC S9(7)     COMP-3.          
014820         10  SAVEB-VDTTL-AVG-RESOLV-HRS    PIC S9(5)     COMP-3.          
014820         10  SAVEB-VDTTL-AVG-RESOLV-MINS   PIC S9(3)     COMP-3.          
014900         10  FILLER                        PIC X(261).                    
044330                                                                          
044330                                                                          
044330                                                                          
044330                                                                          
041900*** FILE LAYOUT AREA OF TROUBLE EXTRACT FILE                              
042000     COPY TMRD001.                                                        
042100                                                                          
041900*** CONTROL CARD PARAMETERS                                               
042000 01  CC-CONTROL-CARD-PARAMETERS.                                          
042100     05  CC-TOTAL-TROUBLE-ASSIGN-CDE PIC X   VALUE SPACE.                 
044330         88  CC-ONE-AL-BF                    VALUE 'A'.                   
044330         88  CC-TWO-AL-BF                    VALUE 'B'.                   
044330                                                                          
044330                                                                          
044400 PROCEDURE DIVISION.                                                      
044500                                                                          
044600 0000-MAINLINE-PROCESSING.                                                
044700                                                                          
044800     PERFORM 0100-INITIALIZATION.                                         
044900                                                                          
045000     PERFORM 0200-MAIN-LOOP                                               
045100         UNTIL PS-EOF-TE.                                                 
045200                                                                          
045300     PERFORM 9000-END-OF-PROGRAM.                                         
045400                                                                          
045500     STOP RUN.                                                            
045600                                                                          
045700 0100-INITIALIZATION.                                                     
046100     OPEN INPUT  EXTRACT-TRBL-FILE-IN                                     
046200                 RECEIVER-FILE-IN                                         
046300          OUTPUT EXTRACT-TRBL-FILE-OUT.                                   
046500                                                                          
040300      ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                       
046500                                                                          
040300      DISPLAY '* * * * * * * * * * * * * * * * * * * * * * * '.           
040300      DISPLAY 'CONTROL CARD PARMS FOR THIS RUN OF TMKUT012 : '            
040300               CC-CONTROL-CARD-PARAMETERS.                                
040300      DISPLAY '* * * * * * * * * * * * * * * * * * * * * * * '.           
046500                                                                          
046500                                                                          
046500                                                                          
064800 0200-MAIN-LOOP.                                                          
046400     PERFORM 7000-READ-TE-INPUT.                                          
048400                                                                          
048400     IF PS-NOT-EOF-TE                                                     
048400         EVALUATE TRUE                                                    
048400             WHEN TM001-RECORD-TYPE-HEADER                                
048400                 PERFORM 0210-RESET-SORT-FIELDS                           
048400                 MOVE WS-SORT-FIELDS-TMKUT012 TO TM001-SORT-FIELD         
048400                 PERFORM 8000-WRITE-OUTPUT                                
048400             WHEN TM001-RECORD-TYPE-VNDDTLSUM                             
048400                 PERFORM 0300-PROCESS-AL                                  
048400             WHEN TM001-RECORD-TYPE-VNDDPTSUM                             
048400                 PERFORM 0400-PROCESS-BF                                  
048400             WHEN TM001-RECORD-TYPE-VNDDPTRSN                             
048400                 PERFORM 0500-PROCESS-CF                                  
048400         END-EVALUATE.                                                    
048400                                                                          
048400                                                                          
048400 0210-RESET-SORT-FIELDS.                                                  
048400     MOVE PC-9999999       TO WS-SF-VDR-ASSIGN-TOT-QTY.                   
048400     MOVE PC-999999999     TO WS-SF-VDR-ENT-ID.                           
048400     MOVE PC-9999999       TO WS-SF-DPT-ASSIGN-TOT-QTY.                   
048400     MOVE PC-999           TO WS-SF-DPT-DEPT-NBR.                         
048400     MOVE PC-9999999       TO WS-SF-TRB-ASSIGN-TOT-QTY.                   
048400     MOVE PC-9999          TO WS-SF-TRB-TRBL-RSN-CDE.                     
048400     MOVE SPACES           TO WS-SF-REPORT-NOTIF-CDE.                     
048400                                                                          
048400 0300-PROCESS-AL.                                                         
048400     PERFORM 0210-RESET-SORT-FIELDS                                       
048400                                                                          
048400     EVALUATE TRUE                                                        
048400         WHEN CC-ONE-AL-BF                                                
048400             PERFORM 0310-ONE-AL                                          
048400         WHEN CC-TWO-AL-BF                                                
048400             PERFORM 0320-TWO-AL                                          
048400     END-EVALUATE.                                                        
048400                                                                          
048400 0310-ONE-AL.                                                             
048400     SET PS-NOT-WAITING-FOR-AL-B TO TRUE                                  
048400     MOVE TM001-TROUBLE-EXT-RECORD TO SAVEA-TRBL-EXT-RECORD.              
048400     MOVE TM001-VTL-ASSIGN-TOT-QTY TO WS-SF-VDR-ASSIGN-TOT-QTY.           
048400     MOVE TM001-VTL-ENT-ID         TO WS-SF-VDR-ENT-ID.                   
048400     MOVE PC-A                     TO WS-SF-REPORT-NOTIF-CDE.             
048400     MOVE WS-SORT-FIELDS-TMKUT012  TO TM001-SORT-FIELD.                   
048400     MOVE TM001-VTL-ENT-ID         TO PV-SAVE-ENT.                        
048400     MOVE ZEROS                    TO PV-SAVE-DEPT.                       
048400     PERFORM 7100-READ-RCV-INPUT                                          
048400        UNTIL RCV-RECEIPT-KEY = PV-SAVE-KEY                               
048400           OR  RCV-RECEIPT-KEY > PV-SAVE-KEY                              
048400           OR  PS-EOF-RCV.                                                
048400                                                                          
048400     IF RCV-RECEIPT-KEY = PV-SAVE-KEY                                     
048400         MOVE RCV-RECEIPT-RCVRS-VRFYD-QTY TO                              
048400                            TM001-VTL-RCVRS-VRFYD-QTY                     
048400         MOVE RCV-RECEIPT-VRFYD-TRBL-QTY  TO                              
048400                            TM001-VTL-VRFYD-TRBL-QTY                      
048400         MOVE RCV-RECEIPT-PO-RECVD-QTY TO                                 
048400                            TM001-VTL-PO-RECVD-QTY                        
048400         MOVE RCV-RECEIPT-PO-IN-TRBL-QTY  TO                              
048400                            TM001-VTL-PO-IN-TRBL-QTY                      
048400     ELSE                                                                 
048400         MOVE ZEROS TO TM001-VTL-RCVRS-VRFYD-QTY                          
048400                       TM001-VTL-VRFYD-TRBL-QTY                           
048400                       TM001-VTL-PO-RECVD-QTY                             
048400                       TM001-VTL-PO-IN-TRBL-QTY                           
048400     END-IF.                                                              
048400                                                                          
048400     PERFORM 8000-WRITE-OUTPUT.                                           
048400                                                                          
048400 0320-TWO-AL.                                                             
048400     IF PS-FIRST-AL                                                       
048400         SET PS-NOT-FIRST-AL TO TRUE                                      
048400         MOVE TM001-VTL-ENT-ID    TO PV-SAVE-ENT                          
048400         MOVE ZEROS               TO PV-SAVE-DEPT                         
048400         PERFORM 7100-READ-RCV-INPUT                                      
048400            UNTIL RCV-RECEIPT-KEY = PV-SAVE-KEY                           
048400               OR RCV-RECEIPT-KEY > PV-SAVE-KEY                           
048400               OR PS-EOF-RCV                                              
048400                                                                          
048400         IF RCV-RECEIPT-KEY = PV-SAVE-KEY                                 
048400             MOVE RCV-RECEIPT-RCVRS-VRFYD-QTY TO                          
048400                                PV-SAVE-RCVRS-VRFYD-QTY                   
048400             MOVE RCV-RECEIPT-VRFYD-TRBL-QTY TO                           
048400                                PV-SAVE-VRFYD-TRBL-QTY                    
048400             MOVE RCV-RECEIPT-PO-RECVD-QTY TO                             
048400                                PV-SAVE-PO-RECVD-QTY                      
048400             MOVE RCV-RECEIPT-PO-IN-TRBL-QTY  TO                          
048400                                PV-SAVE-PO-IN-TRBL-QTY                    
048400         ELSE                                                             
048400             MOVE ZEROS TO PV-SAVE-RCVRS-VRFYD-QTY                        
048400                           PV-SAVE-VRFYD-TRBL-QTY                         
048400                           PV-SAVE-PO-RECVD-QTY                           
048400                           PV-SAVE-PO-IN-TRBL-QTY                         
048400         END-IF                                                           
048400     END-IF                                                               
048400                                                                          
048400     IF TM001-REPORT-TROUBLE                                              
048400         MOVE TM001-VTL-ENT-ID        TO WS-SF-VDR-ENT-ID                 
048400         MOVE TM001-VTL-ASSIGN-TOT-QTY                                    
048400                                      TO WS-SF-VDR-ASSIGN-TOT-QTY         
048400                                         PV-SAVE-AL-TRBL                  
048400         MOVE TM001-TROUBLE-EXT-RECORD TO SAVEA-TRBL-EXT-RECORD           
048400         MOVE PV-SAVE-RCVRS-VRFYD-QTY TO SAVEA-VTL-RCVRS-VRFYD-QTY        
048400         MOVE PV-SAVE-VRFYD-TRBL-QTY  TO SAVEA-VTL-VRFYD-TRBL-QTY         
048400         MOVE PV-SAVE-PO-RECVD-QTY    TO SAVEA-VTL-PO-RECVD-QTY           
048400         MOVE PV-SAVE-PO-IN-TRBL-QTY  TO SAVEA-VTL-PO-IN-TRBL-QTY         
048400         MOVE PC-A                    TO WS-SF-REPORT-NOTIF-CDE           
048400         MOVE WS-SORT-FIELDS-TMKUT012 TO SAVEA-SORT-FIELD                 
048400         MOVE SAVEA-TRBL-EXT-RECORD   TO TM001-TROUBLE-EXT-RECORD         
048400         PERFORM 8000-WRITE-OUTPUT                                        
048400         SET PS-WAITING-FOR-AL-B       TO TRUE                            
048400     ELSE                                                                 
048400         SET PS-NOT-WAITING-FOR-AL-B   TO TRUE                            
048400         MOVE TM001-TROUBLE-EXT-RECORD TO SAVEB-TRBL-EXT-RECORD           
048400         MOVE TM001-VTL-ENT-ID         TO WS-SF-VDR-ENT-ID                
048400         MOVE PV-SAVE-AL-TRBL         TO WS-SF-VDR-ASSIGN-TOT-QTY         
048400         MOVE PV-SAVE-RCVRS-VRFYD-QTY TO SAVEB-VTL-RCVRS-VRFYD-QTY        
048400         MOVE PV-SAVE-VRFYD-TRBL-QTY  TO SAVEB-VTL-VRFYD-TRBL-QTY         
048400         MOVE PV-SAVE-PO-RECVD-QTY    TO SAVEB-VTL-PO-RECVD-QTY           
048400         MOVE PV-SAVE-PO-IN-TRBL-QTY  TO SAVEB-VTL-PO-IN-TRBL-QTY         
048400         MOVE PC-B                    TO WS-SF-REPORT-NOTIF-CDE           
048400         MOVE WS-SORT-FIELDS-TMKUT012 TO SAVEB-SORT-FIELD                 
048400         MOVE SAVEB-TRBL-EXT-RECORD   TO TM001-TROUBLE-EXT-RECORD         
048400         PERFORM 8000-WRITE-OUTPUT                                        
048400         SET PS-FIRST-AL TO TRUE                                          
048400     END-IF.                                                              
048400                                                                          
048400 0400-PROCESS-BF.                                                         
048400     IF  PS-WAITING-FOR-AL-B                                              
048400         DISPLAY '***********************************'                    
048400         DISPLAY 'IN PARAGRAPH 0400-PROCESS-BF'                           
048400         DISPLAY 'MISSING EXPECTED 2ND "AL" RECORD'                       
048400         DISPLAY 'PROCESSING CANNOT CONTINUE'                             
048400         DISPLAY 'RUN ABORTED'                                            
048400         DISPLAY '***********************************'                    
048400         MOVE 4008          TO PV-ABEND-CODE                              
048400         PERFORM 9999-ABORT                                               
048400     END-IF.                                                              
048400                                                                          
048400                                                                          
048400     EVALUATE TRUE                                                        
048400         WHEN CC-ONE-AL-BF                                                
048400             PERFORM 0410-ONE-BF                                          
048400         WHEN CC-TWO-AL-BF                                                
048400             PERFORM 0420-TWO-BF                                          
048400     END-EVALUATE.                                                        
048400                                                                          
048400 0410-ONE-BF.                                                             
048400     SET PS-NOT-WAITING-FOR-BF-B TO TRUE                                  
048400     MOVE TM001-TROUBLE-EXT-RECORD TO SAVEA-TRBL-EXT-RECORD.              
048400     MOVE TM001-VDTL-ASSIGN-TOT-QTY TO WS-SF-DPT-ASSIGN-TOT-QTY.          
048400     MOVE TM001-VDTL-DEPT-NBR       TO WS-SF-DPT-DEPT-NBR.                
048400     MOVE PC-9999999                TO WS-SF-TRB-ASSIGN-TOT-QTY.          
048400     MOVE PC-9999                   TO WS-SF-TRB-TRBL-RSN-CDE.            
048400     MOVE PC-A                      TO WS-SF-REPORT-NOTIF-CDE.            
048400     MOVE WS-SORT-FIELDS-TMKUT012   TO TM001-SORT-FIELD.                  
048400     MOVE TM001-VDTL-ENT-ID         TO PV-SAVE-ENT.                       
048400     MOVE TM001-VDTL-DEPT-NBR       TO PV-SAVE-DEPT.                      
048400     PERFORM 7100-READ-RCV-INPUT                                          
048400        UNTIL RCV-RECEIPT-KEY = PV-SAVE-KEY                               
048400           OR  RCV-RECEIPT-KEY > PV-SAVE-KEY                              
048400           OR  PS-EOF-RCV.                                                
048400                                                                          
048400     IF RCV-RECEIPT-KEY = PV-SAVE-KEY                                     
048400         MOVE RCV-RECEIPT-RCVRS-VRFYD-QTY TO                              
048400                            TM001-VDTL-RCVRS-VRFYD-QTY                    
048400         MOVE RCV-RECEIPT-VRFYD-TRBL-QTY  TO                              
048400                            TM001-VDTL-VRFYD-TRBL-QTY                     
048400         MOVE RCV-RECEIPT-PO-RECVD-QTY TO                                 
048400                            TM001-VDTL-PO-RECVD-QTY                       
048400         MOVE RCV-RECEIPT-PO-IN-TRBL-QTY  TO                              
048400                            TM001-VDTL-PO-IN-TRBL-QTY                     
048400     ELSE                                                                 
048400         MOVE ZEROS TO TM001-VDTL-RCVRS-VRFYD-QTY                         
048400                       TM001-VDTL-VRFYD-TRBL-QTY                          
048400                       TM001-VDTL-PO-RECVD-QTY                            
048400                       TM001-VDTL-PO-IN-TRBL-QTY                          
048400     END-IF.                                                              
048400                                                                          
048400     PERFORM 8000-WRITE-OUTPUT.                                           
048400                                                                          
048400                                                                          
048400 0420-TWO-BF.                                                             
048400     IF PS-FIRST-BF                                                       
048400         SET PS-NOT-FIRST-BF TO TRUE                                      
048400         MOVE TM001-VDTL-ENT-ID   TO PV-SAVE-ENT                          
048400         MOVE TM001-VDTL-DEPT-NBR TO PV-SAVE-DEPT                         
048400         PERFORM 7100-READ-RCV-INPUT                                      
048400            UNTIL RCV-RECEIPT-KEY = PV-SAVE-KEY                           
048400               OR RCV-RECEIPT-KEY > PV-SAVE-KEY                           
048400               OR PS-EOF-RCV                                              
048400                                                                          
048400         IF RCV-RECEIPT-KEY = PV-SAVE-KEY                                 
048400             MOVE RCV-RECEIPT-RCVRS-VRFYD-QTY TO                          
048400                                PV-SAVE-RCVRS-VRFYD-QTY                   
048400             MOVE RCV-RECEIPT-VRFYD-TRBL-QTY TO                           
048400                                PV-SAVE-VRFYD-TRBL-QTY                    
048400             MOVE RCV-RECEIPT-PO-RECVD-QTY TO                             
048400                                PV-SAVE-PO-RECVD-QTY                      
048400             MOVE RCV-RECEIPT-PO-IN-TRBL-QTY  TO                          
048400                                PV-SAVE-PO-IN-TRBL-QTY                    
048400         ELSE                                                             
048400             MOVE ZEROS TO PV-SAVE-RCVRS-VRFYD-QTY                        
048400                           PV-SAVE-VRFYD-TRBL-QTY                         
048400                           PV-SAVE-PO-RECVD-QTY                           
048400                           PV-SAVE-PO-IN-TRBL-QTY                         
048400         END-IF                                                           
048400     END-IF                                                               
048400                                                                          
048400     IF TM001-REPORT-TROUBLE                                              
048400         MOVE TM001-VDTL-ASSIGN-TOT-QTY                                   
048400                                  TO WS-SF-DPT-ASSIGN-TOT-QTY             
048400         MOVE TM001-VDTL-DEPT-NBR TO WS-SF-DPT-DEPT-NBR                   
048400         MOVE PC-9999999          TO WS-SF-TRB-ASSIGN-TOT-QTY             
048400         MOVE PC-9999             TO WS-SF-TRB-TRBL-RSN-CDE               
048400         MOVE TM001-TROUBLE-EXT-RECORD TO SAVEA-TRBL-EXT-RECORD           
048400         MOVE PV-SAVE-RCVRS-VRFYD-QTY                                     
048400                                    TO SAVEA-VDTL-RCVRS-VRFYD-QTY         
048400         MOVE PV-SAVE-VRFYD-TRBL-QTY TO SAVEA-VDTL-VRFYD-TRBL-QTY         
048400         MOVE PV-SAVE-PO-RECVD-QTY  TO SAVEA-VDTL-PO-RECVD-QTY            
048400         MOVE PV-SAVE-PO-IN-TRBL-QTY TO SAVEA-VDTL-PO-IN-TRBL-QTY         
048400         MOVE PC-A                    TO WS-SF-REPORT-NOTIF-CDE           
048400         MOVE WS-SORT-FIELDS-TMKUT012 TO SAVEA-SORT-FIELD                 
048400         MOVE SAVEA-TRBL-EXT-RECORD   TO TM001-TROUBLE-EXT-RECORD         
048400         PERFORM 8000-WRITE-OUTPUT                                        
048400         SET PS-WAITING-FOR-BF-B       TO TRUE                            
048400     ELSE                                                                 
048400         SET PS-NOT-WAITING-FOR-BF-B   TO TRUE                            
048400         MOVE TM001-TROUBLE-EXT-RECORD TO SAVEB-TRBL-EXT-RECORD           
048400         MOVE PV-SAVE-RCVRS-VRFYD-QTY                                     
048400                                    TO SAVEB-VDTL-RCVRS-VRFYD-QTY         
048400         MOVE PV-SAVE-VRFYD-TRBL-QTY TO SAVEB-VDTL-VRFYD-TRBL-QTY         
048400         MOVE PV-SAVE-PO-RECVD-QTY  TO SAVEB-VDTL-PO-RECVD-QTY            
048400         MOVE PV-SAVE-PO-IN-TRBL-QTY TO SAVEB-VDTL-PO-IN-TRBL-QTY         
048400         MOVE PC-B                    TO WS-SF-REPORT-NOTIF-CDE           
048400         MOVE WS-SORT-FIELDS-TMKUT012 TO SAVEB-SORT-FIELD                 
048400         MOVE SAVEB-TRBL-EXT-RECORD   TO TM001-TROUBLE-EXT-RECORD         
048400         PERFORM 8000-WRITE-OUTPUT                                        
048400         SET PS-FIRST-BF TO TRUE                                          
048400     END-IF.                                                              
048400                                                                          
048400 0500-PROCESS-CF.                                                         
048400     IF  PS-WAITING-FOR-BF-B                                              
048400         DISPLAY '***********************************'                    
048400         DISPLAY 'IN PARAGRAPH 0500-PROCESS-CF'                           
048400         DISPLAY 'MISSING EXPECTED 2ND "BF" RECORD'                       
048400         DISPLAY 'PROCESSING CANNOT CONTINUE'                             
048400         DISPLAY 'RUN ABORTED'                                            
048400         DISPLAY '***********************************'                    
048400         MOVE 4008          TO PV-ABEND-CODE                              
048400         PERFORM 9999-ABORT                                               
048400     END-IF.                                                              
048400                                                                          
048400     MOVE TM001-VDTTL-ASSIGN-TOT-QTY TO WS-SF-TRB-ASSIGN-TOT-QTY.         
048400     MOVE TM001-VDTTL-TRBL-RSN-CDE   TO WS-SF-TRB-TRBL-RSN-CDE.           
048400     MOVE SPACE                      TO WS-SF-REPORT-NOTIF-CDE.           
048400     MOVE WS-SORT-FIELDS-TMKUT012    TO TM001-SORT-FIELD.                 
048400                                                                          
048400     PERFORM 8000-WRITE-OUTPUT.                                           
048400                                                                          
048400                                                                          
048400 7000-READ-TE-INPUT.                                                      
048400     READ EXTRACT-TRBL-FILE-IN INTO TM001-TROUBLE-EXT-RECORD              
048400         AT END SET PS-EOF-TE TO TRUE.                                    
048400                                                                          
048400     IF PS-NOT-EOF-TE                                                     
048400         ADD  1        TO PV-TE-RECS-READ                                 
048400     END-IF.                                                              
048400                                                                          
048400 7100-READ-RCV-INPUT.                                                     
048400     READ RECEIVER-FILE-IN     INTO WS-RECEIVER-RECORD                    
048400         AT END SET PS-EOF-RCV TO TRUE.                                   
048400                                                                          
048400     IF PS-NOT-EOF-RCV                                                    
048400         ADD  1        TO PV-RCV-RECS-READ                                
048400     END-IF.                                                              
048400                                                                          
048400 8000-WRITE-OUTPUT.                                                       
048400     WRITE TE-TRBL-EXTRACT-RCD-OUT FROM TM001-TROUBLE-EXT-RECORD.         
048400                                                                          
048400     ADD  1            TO PV-TE-RECS-WRITTEN.                             
048400                                                                          
048400                                                                          
149300 9000-END-OF-PROGRAM.                                                     
149400******* WRITE OUT LAST VENDOR/DEPT RECORDS                                
150100*****PERFORM 8000-WRITE-VND-DEPT-RECS.                                    
150200                                                                          
150200     CLOSE  EXTRACT-TRBL-FILE-IN                                          
150200            RECEIVER-FILE-IN                                              
150300            EXTRACT-TRBL-FILE-OUT.                                        
150500                                                                          
150600     DISPLAY '**  TROUBLE EXTRACT RECORDS READ =========== '              
150700             PV-TE-RECS-READ.                                             
150600     DISPLAY '**  RECEIPTS RECORDS READ =========== '                     
150700             PV-RCV-RECS-READ.                                            
151200     DISPLAY '**  RECORDS WRITTEN ======== '                              
151300             PV-TE-RECS-WRITTEN.                                          
151600                                                                          
152100 9999-ABORT.                                                              
152300     DISPLAY '** ABEND CODE      ** = ' PV-ABEND-CODE.                    
153100     MOVE +4008                  TO PV-ABEND-CODE.                        
153200     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                               
153300                                                                          
153400*********** END OF TMKUT011 SOURCE CODE *************************         
