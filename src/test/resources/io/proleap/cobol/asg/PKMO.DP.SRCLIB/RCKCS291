000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.             RCKCS291.                                00020000
000300 AUTHOR.                 DAN HINTZ.                               00030000
000400 INSTALLATION.           KOHLS.                                   00040000
000500 DATE-WRITTEN            APRIL 1997.                              00050000
000600 DATE-COMPILED.                                                   00060000
000610******************************************************************00061000
000620* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! 00062000
000630*   FOR TESTING HAVE HARDCODE A SHIPMENT NUMBER IN CURSOR         00063000
000640*   MUST BE REMOVED BEFORE INSTALLING                             00064000
000650******************************************************************00065000
000660                                                                  00066000
000670                                                                  00067000
000680******************************************************************00068000
000690* VERIFICATION SWEEPER                                            00069000
000700* THIS TRANSACTION PERFORMS THE VERIFICATION PROCESS FOR ANY      00070000
000800* RECEIVER LINES THAT WERE SUSPENDED IN A PREVIOUS VERIFICATION   00080000
000900* ATTEMPT.                                                        00090000
001000******************************************************************00100000
001100                                                                  00110000
001200 ENVIRONMENT DIVISION.                                            00120000
001300 DATA DIVISION.                                                   00130000
001400 WORKING-STORAGE SECTION.                                         00140000
001500                                                                  00150000
001600*---------------------------------------------------------------* 00160000
001700*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00170000
001800*  THE VERIFICATION TRANSACTION (PCKCS200).                     * 00180000
001900*---------------------------------------------------------------* 00190000
002000     COPY RCWS289.                                                00200000
002100                                                                  00210000
002200*---------------------------------------------------------------* 00220000
002300*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00230000
002400*  THE VERIFICATION ELIGIBILITY MODULE (RCKUT124).              * 00240000
002500*---------------------------------------------------------------* 00250000
002600     COPY RCWS038.                                                00260000
002700                                                                  00270000
002800*---------------------------------------------------------------* 00280000
002900*  RECORD LAYOUTS FOR THE AUTO VERF PARM CHECK MODULE (RCKUT127)  00290000
003000*---------------------------------------------------------------* 00300000
003100     COPY RCWS040.                                                00310000
003200                                                                  00320000
003300*---------------------------------------------------------------* 00330000
003400*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00340000
003500*  THE FULLCASE CONFIRMATION MODULE (RCKUT125).                 * 00350000
003600*---------------------------------------------------------------* 00360000
003700     COPY RCWS041.                                                00370000
003800                                                                  00380000
003900*---------------------------------------------------------------* 00390000
004000*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00400000
004100*  THE ADJUST SYSTEM AUDIT MODULE (SUKCS762).                   * 00410000
004200*---------------------------------------------------------------* 00420000
004300     COPY SUWS047.                                                00430000
004400                                                                  00440000
004500*-----------------------------------------------------------------00450000
004600*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00460000
004700*-----------------------------------------------------------------00470000
004800     COPY DPWS013.                                                00480000
004900*                                                                 00490000
005000     COPY RCWS071.                                                00500000
005100*                                                                 00510000
005200 01  PC-PROGRAM-CONSTANTS.                                        00520000
005300     05  PC-MAX-RETRIES                  PIC S9(03)  VALUE +3     00530000
005400                                                     COMP-3.      00540000
005500     05  PC-I                            PIC  X(01)  VALUE 'I'.   00550000
005600     05  PC-N                            PIC  X(01)  VALUE 'N'.   00560000
005700     05  PC-R                            PIC  X(01)  VALUE 'R'.   00570000
005800     05  PC-T                            PIC  X(01)  VALUE 'T'.   00580000
005900                                                                  00590000
006000     05  PC-PREPK-DRIVER-LNE             PIC  X(01)  VALUE 'D'.   00600000
006100     05  PC-NON-PREPK-N                  PIC  X(01)  VALUE 'N'.   00610000
006200     05  PC-NON-PREPK                    PIC  X(01)  VALUE ' '.   00620000
006300                                                                  00630000
006400     05  PC-NOT-MULT-RATIO               PIC  X(01)  VALUE 'A'.   00640000
006500     05  PC-SPLIT-STATUS                 PIC  X(01)  VALUE 'B'.   00650000
006600     05  PC-RESET-TO-DOWNLOAD            PIC  X(01)  VALUE 'D'.   00660000
006700     05  PC-ERROR-STATUS                 PIC  X(01)  VALUE 'E'.   00670000
006800     05  PC-ERROR-NO-PRO                 PIC  X(01)  VALUE 'F'.   00680000
006900     05  PC-ERROR-NOT-ARR                PIC  X(01)  VALUE 'G'.   00690000
007000     05  PC-INV-CYCLE                    PIC  X(01)  VALUE 'I'.   00700000
007100     05  PC-PREVIOUSLY-VERIFIED          PIC  X(01)  VALUE 'P'.   00710000
007200     05  PC-DELETED-RCVR-CANCEL          PIC  X(01)  VALUE 'C'.   00720000
007300     05  PC-READY-TO-VERIFY              PIC  X(01)  VALUE 'R'.   00730000
007400     05  PC-UNRSLVD-AUTO-ADJ             PIC  X(01)  VALUE 'H'.   00740000
007500     05  PC-NOT-FOUND                    PIC  X(01)  VALUE 'C'.   00750000
007600     05  PC-TRANID-E291                  PIC  X(04)  VALUE 'E291'.00760000
007700     05  PC-SPACES                       PIC  X(22)  VALUE SPACES.00770000
007800     05  PC-NO-FREIGHT-BILL-STATUS       PIC  X(01)  VALUE 'F'.   00780000
007900     05  PC-NOT-ARRIVED-STATUS           PIC  X(01)  VALUE 'G'.   00790000
008000     05  PC-READY-TO-VERIFY-STATUS       PIC  X(01)  VALUE 'R'.   00800000
008100     05  PC-CURRENT-PGM-NAME             PIC  X(08)  VALUE        00810000
008200         'RCKCS291'.                                              00820000
008300     05  PC-VEM-MODULE                  PIC X(08) VALUE           00830000
008400         'RCKUT124'.                                              00840000
008500     05  PC-FULLCASE-CONFIRM-PGM        PIC X(08)  VALUE          00850000
008600         'RCKUT125'.                                              00860000
008700     05  PC-DEFAULT-DATE-1               PIC  X(26)  VALUE        00870000
008800                                   '9999-09-09-09.09.09.999999'.  00880000
008900     05  PC-DEFAULT-DATE-2               PIC  X(26)  VALUE        00890000
009000                                   '0001-01-01-00.00.00.000000'.  00900000
009100     05  PC-DEFAULT-TMST                 PIC  X(26)   VALUE       00910000
009200                                   '9999-09-09-09.09.09.999999'.  00920000
009300     05  PC-R291-TRANSID             PIC  X(04) VALUE 'R291'.     00930000
009400*                                                                 00940000
009500 01  PS-PROGRAM-SWITCHES.                                         00950000
009600     05  PS-END-OF-UNVFYD-DATA-SW        PIC  X(01)  VALUE 'N'.   00960000
009700         88  PS-END-OF-UNVFYD-DATA                   VALUE 'Y'.   00970000
009800         88  PS-NOT-END-OF-UNVFYD-DATA               VALUE 'N'.   00980000
009900     05  PS-FREIGHT-BILL-SW              PIC  X(01)  VALUE 'N'.   00990000
010000         88  PS-FREIGHT-BILL-FOUND                   VALUE 'Y'.   01000000
010100         88  PS-NO-FREIGHT-BILL                      VALUE 'N'.   01010000
010200     05  PS-ARRIVED-SW                   PIC  X(01)  VALUE 'Y'.   01020000
010300         88  PS-ARRIVED                              VALUE 'Y'.   01030000
010400         88  PS-NOT-ARRIVED                          VALUE 'N'.   01040000
010500     05  PS-P2L-BAD-RATIO-SW             PIC  X(01)  VALUE 'Y'.   01050000
010600         88  PS-P2L-BAD-RATIO                        VALUE 'Y'.   01060000
010700         88  PS-NOT-P2L-BAD-RATIO                    VALUE 'N'.   01070000
010800     05  PS-PREVIOUSLY-VERIFIED-SW       PIC  X(01)  VALUE 'N'.   01080000
010900         88  PS-PREVIOUSLY-VERIFIED                  VALUE 'Y'.   01090000
011000         88  PS-NOT-PREVIOUSLY-VERIFIED              VALUE 'N'.   01100000
011100     05  PS-PREPK-LINES-LEFT-SW          PIC  X(01)  VALUE 'Y'.   01110000
011200         88  PS-PREPK-LINES-LEFT                     VALUE 'Y'.   01120000
011300         88  PS-NO-PREPK-LINES-LEFT                  VALUE 'N'.   01130000
011400     05  PS-CSSL-LOGGING-SW              PIC  X(01)  VALUE 'N'.   01140000
011500         88  PS-CSSL-LOGGING-YES                     VALUE 'Y'.   01150000
011600         88  PS-CSSL-LOGGING-NO                      VALUE 'N'.   01160000
011700     05  PS-WMOS-RCVR-FOUND-SW           PIC  X(01)  VALUE 'N'.   01170000
011800         88  PS-WMOS-RCVR-YES                        VALUE 'Y'.   01180000
011900         88  PS-WMOS-RCVR-NO                         VALUE 'N'.   01190000
012000*                                                                 01200000
012100 01  DK-DB2-KEYS.                                                 01210000
012200     05  DK-ORD-NBR                      PIC S9(09)  VALUE ZERO   01220000
012300                                                     COMP.        01230000
012400     05  DK-REC-SEQ-NBR                  PIC S9(09)  VALUE ZERO   01240000
012500                                                     COMP.        01250000
012600     05  DK-ORD-LNE-NBR                  PIC S9(04)  VALUE ZERO   01260000
012700                                                     COMP.        01270000
012710     05  DK-MAX-LNE-NBR                  PIC S9(04)  VALUE ZERO   01271004
012720                                                     COMP.        01272004
012800     05  DK-WRK-ORD-SEQ-NBR              PIC S9(4)   VALUE ZERO   01280000
012900                                                     COMP.        01290000
013000     05  DK-PREPK-PO-NBR         PIC S9(9) VALUE ZERO COMP SYNC.  01300000
013100     05  DK-PREPK-REC-SEQ-NBR    PIC S9(9) VALUE ZERO COMP SYNC.  01310000
013200     05  DK-PREPK-LINE-NBR       PIC S9(9) VALUE ZERO COMP SYNC.  01320000
013300     05  DK-PREPK-LINE-NBR-2     PIC S9(9) VALUE ZERO COMP SYNC.  01330000
013400     05  DK-PREPK-ID             PIC S9(4) VALUE ZERO COMP SYNC.  01340000
013500                                                                  01350000
013600 01  PV-PROGRAM-VARIABLES.                                        01360000
013700     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01370000
013800                                                     COMP SYNC.   01380000
013900     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZEROS  01390000
014000                                                     COMP SYNC.   01400000
014100     05  PV-NULL-IND                     PIC S9(04)  VALUE ZEROS  01410000
014200                                                     COMP SYNC.   01420000
014300     05  PV-DB2-TROUBLE-COUNT            PIC S9(09)  VALUE ZEROS  01430000
014400                                                     COMP-3.      01440000
014500     05  PV-DB2-FREIGHT-COUNT            PIC S9(09)  VALUE ZEROS  01450000
014600                                                     COMP-3.      01460000
014700     05  PV-ARRIVED-COUNT                PIC S9(09)  VALUE ZEROS  01470000
014800                                                     COMP-3.      01480000
014900     05  PV-TASK-X.                                               01490000
015000         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  01500000
015100     05  PV-RECEIVE-LENGTH               PIC S9(04)  VALUE +0     01510000
015200                                                     COMP SYNC.   01520000
015300     05  PV-WRITE-LENGTH                 PIC S9(04)  VALUE +0     01530000
015400                                                     COMP SYNC.   01540000
015500     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01550000
015600                                                     COMP SYNC.   01560000
015700     05  PV-STACK-RBA                    PIC S9(09)  VALUE ZEROS  01570000
015800                                                     COMP SYNC.   01580000
015900     05  PV-CICS-MSG-AREA                PIC  X(120) VALUE SPACE. 01590000
016000     05  PV-ERROR-ORD-NBR                PIC  9(08)  VALUE ZEROS. 01600000
016100     05  PV-ERROR-RCVR-SEQ-NBR           PIC  9(04)  VALUE ZEROS. 01610000
016200     05  PV-ERROR-ORD-LNE-NBR            PIC  9(04)  VALUE ZEROS. 01620000
016300     05  PV-RCVRS-VRFYD                  PIC  9(04)  VALUE ZEROS. 01630000
016400     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACE. 01640000
016500     05  PV-PREV-TIMESTAMP               PIC  X(26)  VALUE SPACE. 01650000
016600     05  PV-PRCG-STAT-CDE                PIC  X(01)  VALUE SPACE. 01660000
016700     05  PV-PRPK-REC-ORD-LNE-NBR         PIC S9(09)  VALUE ZEROS  01670000
016800                                                     COMP.        01680000
016900     05  PV-RESTART-TIME                 PIC  S9(09)    VALUE +0  01690000
017000                                                     COMP SYNC.   01700000
017100                                                                  01710000
017200     05  PV-DISPLAY-REASON               PIC   X(30) VALUE SPACE. 01720000
017300         88  PV-DISPLAY-A VALUE 'OPEN SYSTEM AUDIT             '. 01730000
017400         88  PV-DISPLAY-B VALUE 'STORE MISMATCH-TRECDIS/TDISTHD'. 01740000
017500         88  PV-DISPLAY-C VALUE 'ERROR                         '. 01750000
017600         88  PV-DISPLAY-D VALUE 'NO PRO/FREIGHT BILL           '. 01760000
017700         88  PV-DISPLAY-E VALUE 'STORE INVENTORY CYCLE         '. 01770000
017800         88  PV-DISPLAY-F VALUE 'RECEIVER NOT ACTIVE           '. 01780000
017900         88  PV-DISPLAY-G VALUE 'RECEIVER NOT FOUND            '. 01790000
018000         88  PV-DISPLAY-H VALUE 'LINE NOT FOUND                '. 01800000
018100         88  PV-DISPLAY-I VALUE 'NO ARRIVED                    '. 01810000
018200         88  PV-DISPLAY-J VALUE 'RECEIVER ALREADY VERIFIED     '. 01820000
018300         88  PV-DISPLAY-K VALUE 'LINE ALREADY VERIFIED         '. 01830000
018400         88  PV-DISPLAY-L VALUE 'RECEIVER LEVEL TROUBLE        '. 01840000
018500         88  PV-DISPLAY-M VALUE 'LINE LEVEL TROUBLE            '. 01850000
018600         88  PV-DISPLAY-N VALUE 'LINE NOT VERIFIED             '. 01860000
018700         88  PV-DISPLAY-O VALUE 'CASEPACK NOT PERFORMED        '. 01870000
018800         88  PV-DISPLAY-P VALUE 'CHECKED IN - NOT MANIFESTED   '. 01880000
018900                                                                  01890000
019000     05  PV-DISP-PO-NBR                  PIC  9(09).              01900000
019100     05  PV-DISP-RCVR-NBR                PIC  9(04).              01910000
019200     05  PV-DISP-LINE-NBR                PIC  9(04).              01920000
019300     05  PV-PARA-NAME                    PIC  X(23).              01930000
019400*---------------------------------------------------------------* 01940000
019500*    DB2 AREA FOR TDISTHD - DISTRIBUTION TRANSACTION HEADER     * 01950000
019600*---------------------------------------------------------------* 01960000
019700     EXEC SQL                                                     01970000
019800          INCLUDE TDISTHD                                         01980000
019900     END-EXEC.                                                    01990000
020000                                                                  02000000
020100*---------------------------------------------------------------* 02010000
020200*    DB2 AREA FOR TRECITM - RECEIPT LINE ITEM TABLE             * 02020000
020300*---------------------------------------------------------------* 02030000
020400     EXEC SQL                                                     02040000
020500          INCLUDE TRECITM                                         02050000
020600     END-EXEC.                                                    02060000
020700                                                                  02070000
020800*---------------------------------------------------------------* 02080000
020900*    DB2 AREA FOR TPURITM                                       * 02090000
021000*---------------------------------------------------------------* 02100000
021100     EXEC SQL                                                     02110000
021200          INCLUDE TPURITM                                         02120000
021300     END-EXEC.                                                    02130000
021400                                                                  02140000
021500*---------------------------------------------------------------* 02150000
021600*    DB2 AREA FOR TRECEIV                                       * 02160000
021700*---------------------------------------------------------------* 02170000
021800     EXEC SQL                                                     02180000
021900          INCLUDE TRECEIV                                         02190000
022000     END-EXEC.                                                    02200000
022100                                                                  02210000
022200*---------------------------------------------------------------* 02220000
022300*    DB2 AREA FOR TKRPRPM - PARAMENTERS TABLE                   * 02230000
022400*---------------------------------------------------------------* 02240000
022500     EXEC SQL                                                     02250000
022600          INCLUDE TKRPRPM                                         02260000
022700     END-EXEC.                                                    02270000
022800*                                                                 02280000
022900*---------------------------------------------------------------* 02290000
023000*    UNVERIFIED RECEIVERS CURSOR                                * 02300000
023100*---------------------------------------------------------------* 02310000
023200                                                                  02320000
023300     EXEC SQL                                                     02330000
023400          DECLARE UNVFYD-RCVR-CSR CURSOR WITH HOLD                02340000
023500          FOR SELECT                                              02350000
023600                ORD_NBR                                           02360000
023700              , RCVR_SEQ_NBR                                      02370000
023800              , ORD_LNE_NBR                                       02380000
023900              , PRCG_STAT_CDE                                     02390000
024000              , WRK_ORD_SEQ_NBR                                   02400000
024100              , FCSE_CNFRMN_TMST                                  02410000
024200              , FCSE_CART_CNT                                     02420000
024300              , P2L_CART_CNT                                      02430000
024400              , INPK_CART_CNT                                     02440000
024500              , PREPK_LNE_PRC_CDE                                 02450000
024600              , RSLTS_RCVD_TMST                                   02460000
024700          FROM                                                    02470000
024800                TDISTHD                                           02480007
024900          WHERE                                                   02490007
025000                PRCG_STAT_CDE  NOT IN ('P','V','D','C')           02500007
025100            AND PREPK_LNE_PRC_CDE IN ('D','N',' ')                02510007
025200            FOR UPDATE OF PRCG_STAT_CDE                           02520007
025300     END-EXEC.                                                    02530000
025400                                                                  02540000
025500                                                                  02550000
025600*---------------------------------------------------------------* 02560000
025700* PREPACK CURSOR FOR LINES FOR A SPECIFIC PULL THAT WERE NOT    * 02570000
025800* USED AS THE DRIVER/PROCESS LINE                               * 02580000
025900*---------------------------------------------------------------* 02590000
026000     EXEC SQL                                                     02600000
026100          DECLARE PRE_PACK_LNE_CSR CURSOR FOR                     02610000
026200              SELECT A.ORD_LNE_NBR                                02620000
026300                FROM TRECITM A                                    02630000
026400                    ,TPURITM B                                    02640000
026500               WHERE A.ORD_NBR         = :DK-PREPK-PO-NBR         02650000
026600                 AND A.REC_SEQ_NBR     = :DK-PREPK-REC-SEQ-NBR    02660000
026700                 AND A.PREPK_ID        = :DK-PREPK-ID             02670000
026800                 AND A.ORD_LNE_NBR    <> :DK-PREPK-LINE-NBR       02680000
026900                 AND A.ORD_NBR         = B.PO_NBR                 02690000
027000                 AND A.ORD_LNE_NBR     = B.APP_PO_LNE_NBR         02700000
027100                 AND A.VER_STATUS_CDE  = 'A'                      02710000
027200                 AND A.PO_VER_NBR      = B.VER_NBR                02720000
027300          ORDER BY                                                02730000
027400                A.ORD_LNE_NBR                                     02740000
027500     END-EXEC.                                                    02750000
027600                                                                  02760000
027700                                                                  02770000
027800*---------------------------------------------------------------* 02780000
027900*    DB2 AREA FOR COMMUNICATIONS                                * 02790000
028000*---------------------------------------------------------------* 02800000
028100     EXEC SQL                                                     02810000
028200          INCLUDE SQLCA                                           02820000
028300     END-EXEC.                                                    02830000
028400/                                                                 02840000
028500 PROCEDURE DIVISION.                                              02850000
028600                                                                  02860000
028700 0000-PROGRAM-MAINLINE.                                           02870000
028800                                                                  02880000
028900     MOVE EIBTASKN               TO PV-TASK.                      02890000
029000                                                                  02900000
029100     PERFORM 9300-CHECK-LOGGING.                                  02910000
029200                                                                  02920000
029300     STRING ' RCKCS291 STARTED - TASK = ' PV-TASK-X               02930000
029400     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                     02940000
029500     PERFORM 9990-WRITE-CICS.                                     02950000
029600                                                                  02960000
029700     PERFORM 0001-GET-RESTART-INFO.                               02970000
029800                                                                  02980000
029900     PERFORM 1000-OPEN-UNVFYD-RCVR-CSR.                           02990000
030000                                                                  03000000
030100     PERFORM 1100-READ-UNVFYD-RCVR-ROW.                           03010000
030200                                                                  03020000
030300                                                                  03030000
030400     INITIALIZE PV-RCVRS-VRFYD.                                   03040000
030500     PERFORM 2000-PROCESS-UNVFYD-RCVR-DATA                        03050000
030600         UNTIL PS-END-OF-UNVFYD-DATA.                             03060000
030700                                                                  03070000
030800     PERFORM 1200-CLOSE-UNVFYD-RCVR-CSR.                          03080000
030900                                                                  03090000
031000     STRING ' RCKCS291 ENDED - TASK = '                           03100000
031100            PV-TASK-X                    DELIMITED BY SIZE        03110000
031200       INTO PV-CICS-MSG-AREA.                                     03120000
031300     PERFORM 9990-WRITE-CICS.                                     03130000
031400                                                                  03140000
031500                                                                  03150000
031600     EXEC CICS                                                    03160000
031700          RETURN                                                  03170000
031800     END-EXEC.                                                    03180000
031900                                                                  03190000
032000******************************************************************03200000
032100*               START NEXT E291 'XX' SECONDS LATER                03210000
032200*=================================================================03220000
032300* DETERMINES WHEN THE NEXT TIME THIS PROCESS IS RUN. 'XX' SECONDS 03230000
032400* IS OBTAINED FROM THE (TKRPRPM) TABLE FOR PARM 'VFYRST'.  IF     03240000
032500* THE SECONDS OBTAINED (PV-RESTART-TIME) IS EQUAL TO 0, THE TRANS 03250000
032600* WILL NOT BE RESTARTED.                                          03260000
032700******************************************************************03270000
032800 0001-GET-RESTART-INFO.                                           03280000
032900                                                                  03290000
033000     IF  PS-CSSL-LOGGING-YES                                      03300000
033100         MOVE '0001-GET-RESTART-INFO '  TO PV-PARA-NAME           03310000
033200         PERFORM 9998-BUILD-MESSAGE                               03320000
033300     END-IF.                                                      03330000
033400                                                                  03340000
033500     PERFORM                                                      03350000
033600            WITH TEST AFTER                                       03360000
033700         VARYING PV-RETRY-COUNTER                                 03370000
033800            FROM 1 BY 1                                           03380000
033900           UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                03390000
034000              OR SQLCODE = ZERO                                   03400000
034100              OR SQLCODE = +100                                   03410000
034200                                                                  03420000
034300         EXEC SQL                                                 03430000
034400              SELECT FUNC_QTY                                     03440000
034500                INTO :KRPRPM-FUNC-QTY                             03450000
034600                FROM TKRPRPM                                      03460000
034700               WHERE LOC_ID             =   90                    03470000
034800                 AND INTFC_SYS_CDE      =  'KHL'                  03480000
034900                 AND FUNC_PRC_STAT_CDE  =  'AC'                   03490000
035000                 AND SYS_PRC_FUNC_CDE   =  'VFYRST'               03500000
035100                 AND (CURRENT DATE                                03510000
035200                     BETWEEN DATE(FUNC_BEG_TMST) AND              03520000
035300                             DATE(FUNC_END_TMST))                 03530000
035400         END-EXEC                                                 03540000
035500                                                                  03550000
035600         EVALUATE TRUE                                            03560000
035700            WHEN SQLCODE = ZERO                                   03570000
035800               MOVE  KRPRPM-FUNC-QTY  TO  PV-RESTART-TIME         03580000
035900                                                                  03590000
036000            WHEN SQLCODE = -904                                   03600000
036100            WHEN SQLCODE = -913                                   03610000
036200            WHEN SQLCODE = -911                                   03620000
036300               CONTINUE                                           03630000
036400                                                                  03640000
036500          WHEN OTHER                                              03650000
036600             MOVE '0001-GET-RESTART-INFO'                         03660000
036700                               TO DP013-PARAGRAPH                 03670000
036800             MOVE 'ERROR SELECTING DATA FOR E291 '                03680000
036900                               TO DP013-MESSAGE-TEXT (1)          03690000
037000             MOVE SQLCA        TO DP013-SQLCA                     03700000
037100             MOVE 'TKRPRPM '   TO DP013-DB2-TABLE-NAME (1)        03710000
037200             SET DP013-NO-ROLLBACK                                03720000
037300                 DP013-DB2-ABEND  TO TRUE                         03730000
037400             PERFORM 9999-WRITE-CICS-LOG-MSG                      03740000
037500         END-EVALUATE                                             03750000
037600     END-PERFORM.                                                 03760000
037700                                                                  03770000
037800     IF PV-RESTART-TIME > 0                                       03780000
037900         EXEC CICS                                                03790000
038000             START TRANSID(PC-TRANID-E291)                        03800000
038100                 AFTER SECONDS (PV-RESTART-TIME)                  03810000
038200         END-EXEC.                                                03820000
038300                                                                  03830000
038400****************************************************************  03840000
038500*  OPEN THE CURSOR TO RETRIEVE ALL RECEIVER LINE ITEMS         *  03850000
038600*  PROCESSED IN THE PACK TO LIGHT SYSTEM THAT WERE NOT         *  03860000
038700*  VERIFIED SUCCESSFULLY.                                      *  03870000
038800****************************************************************  03880000
038900 1000-OPEN-UNVFYD-RCVR-CSR.                                       03890000
039000                                                                  03900000
039100     IF  PS-CSSL-LOGGING-YES                                      03910000
039200         MOVE '1000-OPEN-UNVFYD-RCVR-CSR' TO PV-PARA-NAME         03920000
039300         PERFORM 9998-BUILD-MESSAGE                               03930000
039400     END-IF.                                                      03940000
039500                                                                  03950000
039600     EXEC SQL                                                     03960000
039700         OPEN UNVFYD-RCVR-CSR                                     03970000
039800     END-EXEC.                                                    03980000
039900                                                                  03990000
040000                                                                  04000000
040100     EVALUATE TRUE                                                04010000
040200         WHEN SQLCODE = ZERO                                      04020000
040300             CONTINUE                                             04030000
040400         WHEN SQLWARN0 NOT = SPACES                               04040000
040500         WHEN SQLCODE < ZERO                                      04050000
040600         WHEN SQLCODE > ZERO                                      04060000
040700             MOVE '1000-OPEN-UNVFYD-RCVR-CSR'                     04070000
040800                               TO DP013-PARAGRAPH                 04080000
040900             MOVE 'ERROR OPENING UNVERIFIED RECEIVERS CURSOR'     04090000
041000                               TO DP013-MESSAGE-TEXT (1)          04100000
041100             MOVE SQLCA        TO DP013-SQLCA                     04110000
041200             MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)        04120000
041300             SET DP013-NO-ROLLBACK                                04130000
041400                 DP013-DB2-ABEND                                  04140000
041500                               TO TRUE                            04150000
041600             PERFORM 9999-WRITE-CICS-LOG-MSG                      04160000
041700     END-EVALUATE.                                                04170000
041800/                                                                 04180000
041900****************************************************************  04190000
042000*  RETRIEVE A ROW FROM THE UNVERIFIED RECEIVERS CURSOR.        *  04200000
042100****************************************************************  04210000
042200 1100-READ-UNVFYD-RCVR-ROW.                                       04220000
042300                                                                  04230000
042400     IF  PS-CSSL-LOGGING-YES                                      04240000
042500         MOVE '1100-READ-UNVFYD-RCVR-ROW' TO PV-PARA-NAME         04250000
042600         PERFORM 9998-BUILD-MESSAGE                               04260000
042700     END-IF.                                                      04270000
042800                                                                  04280000
042900     INITIALIZE DCLTDISTHD                                        04290000
043000                                                                  04300000
043100     EXEC SQL                                                     04310000
043200          FETCH UNVFYD-RCVR-CSR                                   04320000
043300          INTO  :DISTHD-ORD-NBR                                   04330000
043400              , :DISTHD-RCVR-SEQ-NBR                              04340000
043500              , :DISTHD-ORD-LNE-NBR                               04350000
043600              , :DISTHD-PRCG-STAT-CDE                             04360000
043700              , :DISTHD-WRK-ORD-SEQ-NBR                           04370000
043800              , :DISTHD-FCSE-CNFRMN-TMST                          04380000
043900              , :DISTHD-FCSE-CART-CNT                             04390000
044000              , :DISTHD-P2L-CART-CNT                              04400000
044100              , :DISTHD-INPK-CART-CNT                             04410000
044200              , :DISTHD-PREPK-LNE-PRC-CDE                         04420000
044300              , :DISTHD-RSLTS-RCVD-TMST                           04430000
044400     END-EXEC.                                                    04440000
044500                                                                  04450000
044600     EVALUATE TRUE                                                04460000
044700         WHEN SQLCODE = ZERO                                      04470000
044800             MOVE DISTHD-ORD-NBR       TO DK-ORD-NBR              04480000
044900             MOVE DISTHD-RCVR-SEQ-NBR  TO DK-REC-SEQ-NBR          04490000
045000             MOVE DISTHD-ORD-LNE-NBR   TO DK-ORD-LNE-NBR          04500000
045100             MOVE DISTHD-WRK-ORD-SEQ-NBR TO DK-WRK-ORD-SEQ-NBR    04510000
045200         WHEN SQLCODE = +100                                      04520000
045300             SET PS-END-OF-UNVFYD-DATA                            04530000
045400                               TO TRUE                            04540000
045500         WHEN SQLWARN0 NOT = SPACES                               04550000
045600         WHEN SQLCODE < ZERO                                      04560000
045700         WHEN SQLCODE > ZERO                                      04570000
045800             MOVE '1100-READ-UNVFYD-RCVR-ROW'                     04580000
045900                               TO DP013-PARAGRAPH                 04590000
046000             MOVE 'ERROR SELECTING DATA FROM UNVFYD RCVRS CURSOR' 04600000
046100                               TO DP013-MESSAGE-TEXT (1)          04610000
046200             MOVE SQLCA        TO DP013-SQLCA                     04620000
046300             MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)        04630000
046400             SET DP013-ROLLBACK                                   04640000
046500                 DP013-DB2-ABEND                                  04650000
046600                               TO TRUE                            04660000
046700             PERFORM 9999-WRITE-CICS-LOG-MSG                      04670000
046800     END-EVALUATE.                                                04680000
046900/                                                                 04690000
047000****************************************************************  04700000
047100*  CLOSE THE CURSOR TO RETRIEVE ALL RECEIVER LINE ITEMS        *  04710000
047200*  PROCESSED IN THE PACK TO LIGHT SYSTEM THAT WERE NOT         *  04720000
047300*  VERIFIED SUCCESSFULLY.                                      *  04730000
047400****************************************************************  04740000
047500 1200-CLOSE-UNVFYD-RCVR-CSR.                                      04750000
047600                                                                  04760000
047700     IF  PS-CSSL-LOGGING-YES                                      04770000
047800         MOVE '1200-CLOSE-UNVFYD-RCVR-CSR'  TO PV-PARA-NAME       04780000
047900         PERFORM 9998-BUILD-MESSAGE                               04790000
048000     END-IF.                                                      04800000
048100                                                                  04810000
048200     EXEC SQL                                                     04820000
048300         CLOSE UNVFYD-RCVR-CSR                                    04830000
048400     END-EXEC.                                                    04840000
048500                                                                  04850000
048600     EVALUATE TRUE                                                04860000
048700         WHEN SQLCODE = ZERO                                      04870000
048800             CONTINUE                                             04880000
048900         WHEN SQLWARN0 NOT = SPACES                               04890000
049000         WHEN SQLCODE < ZERO                                      04900000
049100         WHEN SQLCODE > ZERO                                      04910000
049200             MOVE '1200-CLOSE-UNVFYD-RCVR-CSR'                    04920000
049300                               TO DP013-PARAGRAPH                 04930000
049400             MOVE 'ERROR CLOSING UNVERIFIED RECEIVERS CURSOR'     04940000
049500                               TO DP013-MESSAGE-TEXT (1)          04950000
049600             MOVE SQLCA        TO DP013-SQLCA                     04960000
049700             MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)        04970000
049800             SET DP013-NO-ROLLBACK                                04980000
049900                 DP013-DB2-ABEND                                  04990000
050000                               TO TRUE                            05000000
050100             PERFORM 9999-WRITE-CICS-LOG-MSG                      05010000
050200     END-EVALUATE.                                                05020000
050300/                                                                 05030000
050400******************************************************************05040000
050500*  IF THE STATUS CODE IS EQUAL TO A 'B' (SPLIT PERFORMED AND ONLY*05050000
050600*  ONE PORTION IS COMPLETED), THEN ONLY THE RECITM CHECK IS      *05060000
050700*  NEEDED TO DETERMINE IF IT WAS MANUALLY VERIFIED.  IF NOT EQUAL*05070000
050800*  TO 'B' PERFORM ALL THE CHECKS.                                *05080000
050900******************************************************************05090000
051000 2000-PROCESS-UNVFYD-RCVR-DATA.                                   05100000
051100                                                                  05110000
051200     IF  PS-CSSL-LOGGING-YES                                      05120000
051300         MOVE '2000-PROCESS-UNVFYD-RCVR-DA' TO PV-PARA-NAME       05130000
051400         PERFORM 9998-BUILD-MESSAGE                               05140000
051500     END-IF.                                                      05150000
051600     PERFORM 2300-GET-TRECEIV.                                    05160000
051700     IF (RECEIV-PKGNG-CDE  = 'M'  OR                              05170000
051800         RECEIV-PKGNG-CDE  = 'I') AND                             05180000
051900        DISTHD-ORD-LNE-NBR  >  0                                  05190000
052000         PERFORM 2350-GET-PREPK-ID                                05200000
052100     ELSE                                                         05210000
052200         MOVE  ZEROES  TO  DK-PREPK-ID                            05220000
052300     END-IF.                                                      05230000
052400                                                                  05240000
052500     IF RECEIV-STATUS-CDE = 'DE'                                  05250000
052600        MOVE PC-DELETED-RCVR-CANCEL TO PV-PRCG-STAT-CDE           05260000
052700        IF DISTHD-PRCG-STAT-CDE NOT = PV-PRCG-STAT-CDE            05270000
052800            PERFORM 2200-UPDATE-TDISTHD                           05280000
052900            PERFORM 2250-CALL-TRACKIN-MODULE                      05290000
053000        END-IF                                                    05300000
053100* DMH 8/18/04 - BEGIN                                             05310000
053200     ELSE                                                         05320000
053300        IF  DISTHD-ORD-LNE-NBR  >  0                              05330000
053400            PERFORM 2400-CHECK-TRECITM-STATUS                     05340000
053500        ELSE                                                      05350000
053600            MOVE  SPACES  TO  RECITM-STATUS-CDE                   05360000
053700            MOVE  ZEROES  TO  RECITM-PREPK-ID                     05370000
053800        END-IF                                                    05380000
053900**** DMH 8/18/04 - END                                            05390000
054000                                                                  05400000
054100        IF DISTHD-PRCG-STAT-CDE = 'B'                             05410000
054200                                                                  05420000
054300           SET PS-ARRIVED  TO  TRUE                               05430000
054400           PERFORM 2600-CHECK-IF-ARRIVED                          05440000
054500                                                                  05450000
054600           SET PS-NOT-PREVIOUSLY-VERIFIED TO TRUE                 05460000
054700           IF RECITM-STATUS-CDE = 'VE'                            05470000
054800               SET  PS-PREVIOUSLY-VERIFIED TO TRUE                05480000
054900               MOVE PC-PREVIOUSLY-VERIFIED TO PV-PRCG-STAT-CDE    05490000
055000               IF DISTHD-PRCG-STAT-CDE NOT = PV-PRCG-STAT-CDE     05500000
055100                   PERFORM 2200-UPDATE-TDISTHD                    05510000
055200                   PERFORM 2250-CALL-TRACKIN-MODULE               05520000
055300               END-IF                                             05530000
055400               IF  DISTHD-PREPK-LNE-PRC-CDE  =  'D'               05540000
055500                   PERFORM 2700-PROCESS-PREPK                     05550000
055600               END-IF                                             05560000
055700               PERFORM 9000-SYNCPOINT                             05570000
055800               MOVE DK-ORD-NBR        TO PV-ERROR-ORD-NBR         05580000
055900               MOVE DK-REC-SEQ-NBR    TO PV-ERROR-RCVR-SEQ-NBR    05590000
056000               MOVE DK-ORD-LNE-NBR    TO PV-ERROR-ORD-LNE-NBR     05600000
056100               STRING ' RCKCS291 -'                               05610000
056200                      ' RCVR: '                                   05620000
056300                     PV-ERROR-ORD-NBR '-'                         05630000
056400                     PV-ERROR-RCVR-SEQ-NBR '-'                    05640000
056500                     PV-ERROR-ORD-LNE-NBR                         05650000
056600                     ' SPLIT BUT PREV VFYD'  DELIMITED BY SIZE    05660000
056700                                         INTO PV-CICS-MSG-AREA    05670000
056800               PERFORM 9990-WRITE-CICS                            05680000
056900            END-IF                                                05690000
057000        ELSE                                                      05700000
057010** BASED ON THE CURR OPER CHECK FOR PARM FOR WMOS DC              05701000
057020** GB 6/10/07                                                     05702000
057021           IF RECEIV-CURR-OPER-UNT-ID = KRPRPM-LOC-ID             05702100
057022              CONTINUE                                            05702200
057023           ELSE                                                   05702300
057024              PERFORM 3200-CHECK-WMOS-DC                          05702400
057025           END-IF                                                 05702500
057026                                                                  05702600
057027           IF PS-WMOS-RCVR-YES                                    05702700
057028              PERFORM 2001-PROCESS-NON-SPLIT-RECS                 05702800
057029           ELSE                                                   05702900
057030              IF DISTHD-PRCG-STAT-CDE = 'K' OR 'L'                05703000
057040                 PERFORM 3010-CALL-RCKUT125-CONFIRM               05704000
057050              ELSE                                                05705000
057060                 PERFORM 2001-PROCESS-NON-SPLIT-RECS              05706000
057070              END-IF                                              05707000
057080        END-IF                                                    05708000
057090     END-IF.                                                      05709000
057100                                                                  05710000
057200     PERFORM 1100-READ-UNVFYD-RCVR-ROW.                           05720000
057300                                                                  05730000
057400******************************************************************05740000
057500*  PROCESS ALL OF THE RECEIVER LINES THAT WERE NOT PROCESSED     *05750000
057600*  SUCCESSFULLY IN THE PACK TO LIGHT VERIFICATION PROCESS.       *05760000
057700*  CHECK IF THERE IS ANY TROUBLE FOR THE SPECIFIED RECEIVER.     *05770000
057800*  IF THERE ISN'T ANY UNRESOLVED TROUBLE PRESENT, START THE      *05780000
057900*  TRANSACTION THAT INITIATES THE VERIFICATION PROCESS.          *05790000
058000******************************************************************05800000
058100 2001-PROCESS-NON-SPLIT-RECS.                                     05810000
058200                                                                  05820000
058300     IF  PS-CSSL-LOGGING-YES                                      05830000
058400         MOVE '2001-PROCESS-NON-SPLIT-RECS' TO PV-PARA-NAME       05840000
058500         PERFORM 9998-BUILD-MESSAGE                               05850000
058600     END-IF.                                                      05860000
058700                                                                  05870000
058800*    PERFORM 2300-GET-TRECEIV.                                    05880000
058900                                                                  05890000
059000* DMH 8/18/2004 - END                                             05900000
059100                                                                  05910000
059200     PERFORM 2360-CHECK-IF-AUTOVE.                                05920000
059300                                                                  05930000
059400* DMH 8/26/04 - BEGIN                                             05940000
059500     INITIALIZE  RC038-FIELDS.                                    05950000
059600* DMH 8/26/04 - END                                               05960000
059700                                                                  05970000
059800     MOVE PC-CURRENT-PGM-NAME      TO RC038-PROGRAM-NAME.         05980000
059900     MOVE DK-ORD-NBR               TO RC038-PO-NBR.               05990000
060000     MOVE DK-REC-SEQ-NBR           TO RC038-REC-SEQ-NBR.          06000000
060100     MOVE DK-ORD-LNE-NBR           TO RC038-PO-LNE-NBR.           06010000
060200     MOVE DK-PREPK-ID              TO RC038-PREPACK-ID.           06020000
060300     MOVE RECEIV-OPER-UNT-ID       TO RC038-OPER-UNT-ID.          06030000
060400     MOVE 1                        TO RC038-FCLTY-ID.             06040000
060500     MOVE 'SWEEPER'                TO RC038-USER-ID.              06050000
060600                                                                  06060000
060700     IF RECEIV-PACK-BY-ST-IND = 'Y' OR PS-WMOS-RCVR-YES           06070000
060800        SET RC038-PBS              TO TRUE                        06080000
060900        MOVE SPACES                TO RC038-PKGNG-CDE             06090000
061000     ELSE                                                         06100000
061100         IF RECEIV-PKGNG-CDE = 'M' OR 'I'                         06110000
061200            MOVE RECEIV-PKGNG-CDE                                 06120000
061300                                   TO RC038-PKGNG-CDE             06130000
061400            MOVE SPACES            TO RC038-PBS-IND               06140000
061500         ELSE                                                     06150000
061600            MOVE 'B'               TO RC038-PKGNG-CDE             06160000
061700            MOVE SPACES            TO RC038-PBS-IND               06170000
061800         END-IF                                                   06180000
061900     END-IF.                                                      06190000
062000                                                                  06200000
062100     MOVE RC040-AUTO-VE-SW         TO RC038-AUTOVE-PO-SW.         06210000
062200                                                                  06220000
062300     MOVE LENGTH OF RC038-FIELDS   TO PV-COMMAREA-LENGTH.         06230000
062400                                                                  06240000
062500     EXEC CICS                                                    06250000
062600         LINK PROGRAM  (PC-VEM-MODULE)                            06260000
062700              COMMAREA (RC038-FIELDS)                             06270000
062800              LENGTH   (PV-COMMAREA-LENGTH)                       06280000
062900              RESP     (PV-CICS-RESPONSE)                         06290000
063000     END-EXEC.                                                    06300000
063100                                                                  06310000
063200     EVALUATE TRUE                                                06320000
063300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06330000
063400             IF  RC038-INVALID-SQL     OR                         06340000
063500                 RC038-DATABASE-BUSY                              06350000
063600                   INITIALIZE PV-CICS-MSG-AREA                    06360000
063700                   MOVE DK-ORD-NBR     TO PV-ERROR-ORD-NBR        06370000
063800                   MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   06380000
063900                   MOVE DK-ORD-LNE-NBR TO PV-ERROR-ORD-LNE-NBR    06390000
064000                   STRING ' RCKCS291 -'                           06400000
064100                          ' RCVR: '                               06410000
064200                         PV-ERROR-ORD-NBR '-'                     06420000
064300                         PV-ERROR-RCVR-SEQ-NBR '-'                06430000
064400                         PV-ERROR-ORD-LNE-NBR                     06440000
064500                       ' INVALID SQL OR BUSY'  DELIMITED BY SIZE  06450000
064600                                   INTO PV-CICS-MSG-AREA          06460000
064700                   PERFORM 9990-WRITE-CICS                        06470000
064800             ELSE                                                 06480000
064900                 PERFORM 2100-CHECK-FOR-UPDATE                    06490000
065000             END-IF                                               06500000
065100         WHEN OTHER                                               06510000
065200             MOVE DK-ORD-NBR     TO PV-ERROR-ORD-NBR              06520000
065300             MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR         06530000
065400             MOVE DK-ORD-LNE-NBR TO PV-ERROR-ORD-LNE-NBR          06540000
065500             STRING ' RCKCS291 -'                                 06550000
065600                    ' RCVR: '                                     06560000
065700                   PV-ERROR-ORD-NBR '-'                           06570000
065800                   PV-ERROR-RCVR-SEQ-NBR '-'                      06580000
065900                   PV-ERROR-ORD-LNE-NBR                           06590000
066000                 ' INVALID CALL TO VEM ' DELIMITED BY SIZE        06600000
066100                                 INTO PV-CICS-MSG-AREA            06610000
066200             PERFORM 9990-WRITE-CICS                              06620000
066300     END-EVALUATE.                                                06630000
066400                                                                  06640000
066500                                                                  06650000
066600 2002-GET-TIMESTAMP.                                              06660000
066700                                                                  06670000
066800      EXEC SQL                                                    06680000
066900         SELECT CURRENT TIMESTAMP                                 06690000
067000         INTO  :PV-CURRENT-TIMESTAMP                              06700000
067100         FROM  TKRPRPM                                            06710000
067200      END-EXEC.                                                   06720000
067300                                                                  06730000
067400      EVALUATE TRUE                                               06740000
067500       WHEN SQLCODE = ZERO                                        06750000
067600       WHEN SQLCODE = -811                                        06760000
067700          CONTINUE                                                06770000
067800       WHEN OTHER                                                 06780000
067900          MOVE '2001-GET-TIMESTAMP           '                    06790000
068000                          TO DP013-PARAGRAPH                      06800000
068100          MOVE 'ERROR SELECTING CURR TIMESTAMP'                   06810000
068200                          TO DP013-MESSAGE-TEXT (1)               06820000
068300          MOVE SQLCA      TO DP013-SQLCA                          06830000
068400          MOVE 'TKRPRPM '   TO DP013-DB2-TABLE-NAME (1)           06840000
068500          SET DP013-NO-ROLLBACK                                   06850000
068600              DP013-DB2-ABEND  TO TRUE                            06860000
068700          PERFORM 9999-WRITE-CICS-LOG-MSG                         06870000
068800      END-EVALUATE.                                               06880000
068900                                                                  06890000
069000******************************************************************06900000
069100*    CHECK THE PROCESSING STATUS CODE ON TDISTHD.  IF IT IS EQUAL*06910000
069200*    TO 'A', THE LINE CANNOT BE VERIFIED.  IF RC038-VERIFY-NO    *06920000
069300*    IS TRUE, SEE IF THE PROCESSING STATUS CODE ON TDISTHD NEEDS *06930000
069400*    TO BE UPDATED.                                              *06940000
069500*    IF THE UPDATE IS DONE, A SYNPOINT IS TAKEN TO UNLOCK THE    *06950000
069600*    TABLE.                                                      *06960000
069700******************************************************************06970000
069800 2100-CHECK-FOR-UPDATE.                                           06980000
069900                                                                  06990000
070000     IF  PS-CSSL-LOGGING-YES                                      07000000
070100         MOVE '2100-CHECK-FOR-UPDATE      ' TO PV-PARA-NAME       07010000
070200         PERFORM 9998-BUILD-MESSAGE                               07020000
070300     END-IF.                                                      07030000
070400                                                                  07040000
070500     IF  DISTHD-PRCG-STAT-CDE  =  PC-NOT-MULT-RATIO               07050000
070600         SET  PS-P2L-BAD-RATIO      TO  TRUE                      07060000
070700         MOVE DK-ORD-NBR            TO PV-ERROR-ORD-NBR           07070000
070800         MOVE DK-REC-SEQ-NBR        TO PV-ERROR-RCVR-SEQ-NBR      07080000
070900         MOVE DK-ORD-LNE-NBR        TO PV-ERROR-ORD-LNE-NBR       07090000
071000         STRING ' RCKCS291 -'                                     07100000
071100                ' RCVR: '                                         07110000
071200               PV-ERROR-ORD-NBR '-'                               07120000
071300               PV-ERROR-RCVR-SEQ-NBR '-'                          07130000
071400               PV-ERROR-ORD-LNE-NBR                               07140000
071500               ' BAD RATIO - RE-UPLOAD FROM P2L NEEDED'           07150000
071600                                           DELIMITED BY SIZE      07160000
071700                                 INTO PV-CICS-MSG-AREA            07170000
071800         PERFORM 9990-WRITE-CICS                                  07180000
071900     ELSE                                                         07190000
072000         IF RC038-VERIFY-NO                                       07200000
072100             INITIALIZE PV-CICS-MSG-AREA                          07210000
072200                        PV-DISPLAY-REASON                         07220000
072300             EVALUATE TRUE                                        07230000
072400                 WHEN RC038-OPEN-SYSTEM-AUDIT                     07240000
072500                      SET PV-DISPLAY-A  TO  TRUE                  07250000
072600                 WHEN RC038-DISTRO-NO-MATCH                       07260000
072700                      SET PV-DISPLAY-B  TO  TRUE                  07270000
072800                 WHEN RC038-ERROR                                 07280000
072900                      SET PV-DISPLAY-C  TO  TRUE                  07290000
073000                 WHEN RC038-NO-PRO                                07300000
073100                      SET PV-DISPLAY-D  TO  TRUE                  07310000
073200                 WHEN RC038-STORE-INVENTORY                       07320000
073300                      SET PV-DISPLAY-E  TO  TRUE                  07330000
073400                 WHEN RC038-RCVR-NOT-ACTIVE                       07340000
073500                      SET PV-DISPLAY-F  TO  TRUE                  07350000
073600                 WHEN RC038-RCVR-NOT-FOUND                        07360000
073700                      SET PV-DISPLAY-G  TO  TRUE                  07370000
073800                 WHEN RC038-LINE-NOT-FOUND                        07380000
073900                      SET PV-DISPLAY-H  TO  TRUE                  07390000
074000                 WHEN RC038-NOT-ARRIVED                           07400000
074100                      SET PV-DISPLAY-I  TO  TRUE                  07410000
074200                 WHEN RC038-RECEIVER-ALREADY-VE                   07420000
074300                      SET PV-DISPLAY-J  TO  TRUE                  07430000
074400                 WHEN RC038-LINE-ALREADY-VE                       07440000
074500                      SET PV-DISPLAY-K  TO  TRUE                  07450000
074600                 WHEN RC038-RECV-TROUBLE                          07460000
074700                      SET PV-DISPLAY-L  TO  TRUE                  07470000
074800                 WHEN RC038-LINE-TROUBLE                          07480000
074900                      SET PV-DISPLAY-M  TO  TRUE                  07490000
075000                 WHEN RC038-LINE-NOT-VE                           07500000
075100                      SET PV-DISPLAY-N  TO  TRUE                  07510000
075200                 WHEN RC038-CASEPACK-NOT-PERFORMED                07520000
075300                      SET PV-DISPLAY-O  TO  TRUE                  07530000
075400                 WHEN RC038-NOT-MANIFESTD                         07540000
075500                      SET PV-DISPLAY-P  TO  TRUE                  07550000
075600                 WHEN OTHER                                       07560000
075700                      MOVE RC038-NO-VERIFY-REASON                 07570000
075800                      TO  PV-DISPLAY-REASON                       07580000
075900             END-EVALUATE                                         07590000
076000             MOVE DK-ORD-NBR            TO PV-ERROR-ORD-NBR       07600000
076100             MOVE DK-REC-SEQ-NBR        TO PV-ERROR-RCVR-SEQ-NBR  07610000
076200             MOVE DK-ORD-LNE-NBR        TO PV-ERROR-ORD-LNE-NBR   07620000
076300             STRING ' RCKCS291 -'                                 07630000
076400                    ' RCVR: '                                     07640000
076500                   PV-ERROR-ORD-NBR '-'                           07650000
076600                   PV-ERROR-RCVR-SEQ-NBR '-'                      07660000
076700                   PV-ERROR-ORD-LNE-NBR                           07670000
076800                   ' NO VERIFY REASON - '                         07680000
076900                   PV-DISPLAY-REASON           DELIMITED BY SIZE  07690000
077000                                     INTO PV-CICS-MSG-AREA        07700000
077100             PERFORM 9990-WRITE-CICS                              07710000
077200             PERFORM 2105-LINE-NOT-VRFD                           07720000
077300         ELSE                                                     07730000
077400             IF DISTHD-RSLTS-RCVD-TMST = PC-DEFAULT-TMST AND      07740000
077500                DISTHD-P2L-CART-CNT > 0                           07750000
077600                 IF DISTHD-FCSE-CNFRMN-TMST = PC-DEFAULT-TMST     07760000
077700                     MOVE PC-RESET-TO-DOWNLOAD TO PV-PRCG-STAT-CDE07770000
077800                 ELSE                                             07780000
077900                     MOVE PC-SPLIT-STATUS     TO PV-PRCG-STAT-CDE 07790000
078000                 END-IF                                           07800000
078100                 IF DISTHD-PRCG-STAT-CDE NOT = PV-PRCG-STAT-CDE   07810000
078200                     PERFORM 2200-UPDATE-TDISTHD                  07820000
078300                     PERFORM 2250-CALL-TRACKIN-MODULE             07830000
078400                 END-IF                                           07840000
078500                 IF DISTHD-PREPK-LNE-PRC-CDE  =  'D'              07850000
078600                     PERFORM 2700-PROCESS-PREPK                   07860000
078700                 END-IF                                           07870000
078800             ELSE                                                 07880000
078900                 PERFORM 2110-LINE-CAN-VRFY                       07890000
079000             END-IF                                               07900000
079100     END-IF.                                                      07910000
079200                                                                  07920000
079300 2105-LINE-NOT-VRFD.                                              07930000
079400                                                                  07940000
079500     IF  PS-CSSL-LOGGING-YES                                      07950000
079600         MOVE '2105-LINE-NOT-VRFD         ' TO PV-PARA-NAME       07960000
079700         PERFORM 9998-BUILD-MESSAGE                               07970000
079800     END-IF.                                                      07980000
079900                                                                  07990000
080000     EVALUATE TRUE                                                08000000
080100         WHEN RC038-OPEN-SYSTEM-AUDIT                             08010000
080200              IF DISTHD-PRCG-STAT-CDE NOT = PC-UNRSLVD-AUTO-ADJ   08020000
080300                  MOVE PC-UNRSLVD-AUTO-ADJ TO PV-PRCG-STAT-CDE    08030000
080400                  PERFORM 2200-UPDATE-TDISTHD                     08040000
080500                  PERFORM 2250-CALL-TRACKIN-MODULE                08050000
080600                  IF DISTHD-PREPK-LNE-PRC-CDE  =  'D'             08060000
080700                      PERFORM 2700-PROCESS-PREPK                  08070000
080800                  END-IF                                          08080000
080900              END-IF                                              08090000
081000              PERFORM 3000-CALL-ADJUST-SYST-AUDIT                 08100000
081100              PERFORM 9000-SYNCPOINT                              08110000
081200         WHEN RC038-NO-PRO                                        08120000
081300              IF DISTHD-PRCG-STAT-CDE NOT = PC-ERROR-NO-PRO       08130000
081400                  MOVE PC-ERROR-NO-PRO TO PV-PRCG-STAT-CDE        08140000
081500                  PERFORM 2200-UPDATE-TDISTHD                     08150000
081600                  PERFORM 2250-CALL-TRACKIN-MODULE                08160000
081700                  IF DISTHD-PREPK-LNE-PRC-CDE  =  'D'             08170000
081800                      PERFORM 2700-PROCESS-PREPK                  08180000
081900                  END-IF                                          08190000
082000              END-IF                                              08200000
082100              PERFORM 9000-SYNCPOINT                              08210000
082200         WHEN RC038-NOT-ARRIVED                                   08220000
082300              IF DISTHD-PRCG-STAT-CDE NOT = PC-ERROR-NOT-ARR      08230000
082400                  MOVE PC-ERROR-NOT-ARR TO PV-PRCG-STAT-CDE       08240000
082500                  PERFORM 2200-UPDATE-TDISTHD                     08250000
082600                  PERFORM 2250-CALL-TRACKIN-MODULE                08260000
082700                  IF DISTHD-PREPK-LNE-PRC-CDE  =  'D'             08270000
082800                      PERFORM 2700-PROCESS-PREPK                  08280000
082900                  END-IF                                          08290000
083000              END-IF                                              08300000
083100              PERFORM 9000-SYNCPOINT                              08310000
083200         WHEN RC038-RCVR-NOT-ACTIVE                               08320000
083300         WHEN RC038-RCVR-NOT-FOUND                                08330000
083400         WHEN RC038-LINE-NOT-FOUND                                08340000
083500              IF DISTHD-PRCG-STAT-CDE NOT = PC-NOT-FOUND          08350000
083600                  MOVE PC-NOT-FOUND  TO PV-PRCG-STAT-CDE          08360000
083700                  PERFORM 2200-UPDATE-TDISTHD                     08370000
083800                  PERFORM 2250-CALL-TRACKIN-MODULE                08380000
083900                  IF DISTHD-PREPK-LNE-PRC-CDE  =  'D'             08390000
084000                      PERFORM 2700-PROCESS-PREPK                  08400000
084100                  END-IF                                          08410000
084200              END-IF                                              08420000
084300              PERFORM 9000-SYNCPOINT                              08430000
084400         WHEN RC038-DISTRO-NO-MATCH                               08440000
084500         WHEN RC038-ERROR                                         08450000
084600         WHEN RC038-RECV-TROUBLE                                  08460000
084700         WHEN RC038-LINE-TROUBLE                                  08470000
084800              IF DISTHD-PRCG-STAT-CDE NOT = PC-ERROR-STATUS       08480000
084900                  MOVE PC-ERROR-STATUS TO PV-PRCG-STAT-CDE        08490000
085000                  PERFORM 2200-UPDATE-TDISTHD                     08500000
085100                  PERFORM 2250-CALL-TRACKIN-MODULE                08510000
085200                  IF DISTHD-PREPK-LNE-PRC-CDE  =  'D'             08520000
085300                      PERFORM 2700-PROCESS-PREPK                  08530000
085400                  END-IF                                          08540000
085500              END-IF                                              08550000
085600              PERFORM 9000-SYNCPOINT                              08560000
085700         WHEN RC038-STORE-INVENTORY                               08570000
085800              IF DISTHD-PRCG-STAT-CDE NOT = PC-INV-CYCLE          08580000
085900                  MOVE PC-INV-CYCLE  TO PV-PRCG-STAT-CDE          08590000
086000                  PERFORM 2200-UPDATE-TDISTHD                     08600000
086100                  PERFORM 2250-CALL-TRACKIN-MODULE                08610000
086200                  IF DISTHD-PREPK-LNE-PRC-CDE  =  'D'             08620000
086300                      PERFORM 2700-PROCESS-PREPK                  08630000
086400                  END-IF                                          08640000
086500              END-IF                                              08650000
086600              PERFORM 9000-SYNCPOINT                              08660000
086700         WHEN RC038-RECEIVER-ALREADY-VE                           08670000
086800         WHEN RC038-LINE-ALREADY-VE                               08680000
086900              IF DISTHD-PRCG-STAT-CDE NOT = PC-PREVIOUSLY-VERIFIED08690000
087000                  MOVE PC-PREVIOUSLY-VERIFIED TO PV-PRCG-STAT-CDE 08700000
087100                  PERFORM 2200-UPDATE-TDISTHD                     08710000
087200                  PERFORM 2250-CALL-TRACKIN-MODULE                08720000
087300                  IF DISTHD-PREPK-LNE-PRC-CDE  =  'D'             08730000
087400                      PERFORM 2700-PROCESS-PREPK                  08740000
087500                  END-IF                                          08750000
087600              END-IF                                              08760000
087700              PERFORM 9000-SYNCPOINT                              08770000
087800     END-EVALUATE.                                                08780000
087900                                                                  08790000
088000*----------------------------------------------------------------*08800000
088100*    THE VEM SAYS THE LINE CAN BE VERIFIED.  UPDATE TDISTHD TO   *08810000
088200*    'R' IF PRCG-STAT-CDE NOT = 'R'.                             *08820000
088300*----------------------------------------------------------------*08830000
088400 2110-LINE-CAN-VRFY.                                              08840000
088500                                                                  08850000
088600     IF  PS-CSSL-LOGGING-YES                                      08860000
088700         MOVE '2110-LINE-CAN-VRFY         ' TO PV-PARA-NAME       08870000
088800         PERFORM 9998-BUILD-MESSAGE                               08880000
088900     END-IF.                                                      08890000
089000                                                                  08900000
089100     IF DISTHD-PRCG-STAT-CDE NOT = PC-READY-TO-VERIFY-STATUS      08910000
089200         MOVE PC-READY-TO-VERIFY-STATUS TO PV-PRCG-STAT-CDE       08920000
089300         PERFORM 2200-UPDATE-TDISTHD                              08930000
089400         PERFORM 2250-CALL-TRACKIN-MODULE                         08940000
089500         IF  DISTHD-PREPK-LNE-PRC-CDE  =  'D'                     08950000
089600             PERFORM 2700-PROCESS-PREPK                           08960000
089700         END-IF                                                   08970000
089800         PERFORM 9000-SYNCPOINT                                   08980000
089900     END-IF.                                                      08990000
090000                                                                  09000000
090100     PERFORM 3100-CHECK-FOR-SPLIT.                                09010000
090200***GB 6/10/07                                                     09020000
090300     IF PS-WMOS-RCVR-YES                                          09030000
090301        PERFORM 3300-SEL-DISTHD-MAX-LNE                           09030103
090310        IF DK-ORD-LNE-NBR = DK-MAX-LNE-NBR                        09031003
090400           PERFORM 8005-START-W313                                09040003
090410        END-IF                                                    09041003
090500     ELSE                                                         09050000
090600        PERFORM 8000-START-E200                                   09060000
090700     END-IF                                                       09070000
090800                                                                  09080000
090900     MOVE DK-ORD-NBR     TO PV-ERROR-ORD-NBR.                     09090000
091000     MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR.                09100000
091100     MOVE DK-ORD-LNE-NBR TO PV-ERROR-ORD-LNE-NBR.                 09110000
091200     STRING ' RCKCS291 -'                                         09120000
091300            ' RCVR: '                                             09130000
091400           PV-ERROR-ORD-NBR '-'                                   09140000
091500           PV-ERROR-RCVR-SEQ-NBR '-'                              09150000
091600           PV-ERROR-ORD-LNE-NBR                                   09160000
091700           ' VERIFY ATTEMPT'      DELIMITED BY SIZE               09170000
091800                        INTO PV-CICS-MSG-AREA                     09180000
091900       PERFORM 9990-WRITE-CICS.                                   09190000
092000                                                                  09200000
092100*----------------------------------------------------------------*09210000
092200*    CHANGE THE STATUS ON THE DISTRIBUTION HEADER RECORD FOR THE *09220000
092300*    SPECIFIED LINE TO AN 'R' (READY TO VERIFY), A 'P'           *09230000
092400*    (PREVIOUSLY VERIFIED), OR 'F' (NO PRO NUMBER).              *09240000
092500*----------------------------------------------------------------*09250000
092600 2200-UPDATE-TDISTHD.                                             09260000
092700                                                                  09270000
092800     IF  PS-CSSL-LOGGING-YES                                      09280000
092900         MOVE '2200-UPDATE-TDISTHD        ' TO PV-PARA-NAME       09290000
093000         PERFORM 9998-BUILD-MESSAGE                               09300000
093100     END-IF.                                                      09310000
093200                                                                  09320000
093300     PERFORM                                                      09330000
093400         WITH TEST AFTER                                          09340000
093500         VARYING PV-RETRY-COUNTER                                 09350000
093600         FROM 1 BY 1                                              09360000
093700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09370000
093800             OR (SQLCODE = +0)                                    09380000
093900             OR (SQLCODE = +100))                                 09390000
094000                                                                  09400000
094100         EXEC SQL                                                 09410000
094200             UPDATE TDISTHD                                       09420000
094300                 SET PRCG_STAT_CDE   = :PV-PRCG-STAT-CDE          09430000
094400             WHERE CURRENT OF UNVFYD-RCVR-CSR                     09440000
094500         END-EXEC                                                 09450000
094600                                                                  09460000
094700         EVALUATE TRUE                                            09470000
094800             WHEN SQLCODE = ZERO                                  09480000
094900             WHEN SQLCODE = +100                                  09490000
095000             WHEN SQLCODE = -904                                  09500000
095100             WHEN SQLCODE = -911                                  09510000
095200             WHEN SQLCODE = -913                                  09520000
095300                 CONTINUE                                         09530000
095400             WHEN SQLWARN0 NOT = SPACES                           09540000
095500             WHEN SQLCODE < ZERO                                  09550000
095600             WHEN SQLCODE > ZERO                                  09560000
095700                 MOVE '2200-UPDATE-TDISTHD'                       09570000
095800                                   TO DP013-PARAGRAPH             09580000
095900                 MOVE 'ERROR UPDATING TDISTHD'                    09590000
096000                                   TO DP013-MESSAGE-TEXT (1)      09600000
096100                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            09610000
096200                 MOVE DK-REC-SEQ-NBR                              09620000
096300                                   TO PV-ERROR-RCVR-SEQ-NBR       09630000
096400                 MOVE DK-ORD-LNE-NBR                              09640000
096500                                   TO PV-ERROR-ORD-LNE-NBR        09650000
096600                 STRING ' RCVR: '                                 09660000
096700                      PV-ERROR-ORD-NBR '-'                        09670000
096800                      PV-ERROR-RCVR-SEQ-NBR '-'                   09680000
096900                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    09690000
097000                                 INTO DP013-MESSAGE-TEXT (2)      09700000
097100                 MOVE SQLCA        TO DP013-SQLCA                 09710000
097200                 MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)    09720000
097300                 SET DP013-ROLLBACK                               09730000
097400                     DP013-DB2-ABEND                              09740000
097500                                   TO TRUE                        09750000
097600                 PERFORM 9999-WRITE-CICS-LOG-MSG                  09760000
097700         END-EVALUATE                                             09770000
097800     END-PERFORM.                                                 09780000
097900                                                                  09790000
098000     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  09800000
098100         (SQLCODE NOT = +0)                                       09810000
098200         MOVE '2200-UPDATE-TDISTHD'                               09820000
098300                                  TO DP013-PARAGRAPH              09830000
098400         MOVE 'MAX RETRIES EXCEEDED ON UPDATE OF TDISTHD ROW'     09840000
098500                                  TO DP013-MESSAGE-TEXT (1)       09850000
098600         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             09860000
098700         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        09870000
098800         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         09880000
098900         STRING ' RCVR: '                                         09890000
099000              PV-ERROR-ORD-NBR '-'                                09900000
099100              PV-ERROR-RCVR-SEQ-NBR '-'                           09910000
099200              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            09920000
099300                                INTO DP013-MESSAGE-TEXT (2)       09930000
099400         MOVE SQLCA               TO DP013-SQLCA                  09940000
099500         MOVE 'TDISTHD'           TO DP013-DB2-TABLE-NAME (1)     09950000
099600         SET DP013-DB2-ABEND                                      09960000
099700             DP013-ROLLBACK       TO TRUE                         09970000
099800         PERFORM 9999-WRITE-CICS-LOG-MSG                          09980000
099900     END-IF.                                                      09990000
100000                                                                  10000000
100100 2250-CALL-TRACKIN-MODULE.                                        10010000
100200                                                                  10020000
100300     INITIALIZE RC071-FIELDS.                                     10030000
100400     MOVE DK-ORD-NBR                TO RC071-PO-NBR               10040000
100500     MOVE DK-REC-SEQ-NBR            TO RC071-PO-RCVR              10050000
100600     MOVE DK-ORD-LNE-NBR            TO RC071-PO-LINE              10060000
100700     MOVE DK-PREPK-ID               TO RC071-PREPK-ID             10070000
100800     MOVE RECEIV-OPER-UNT-ID        TO RC071-SIGNON-LOCATION      10080000
100900     MOVE 'SWEEPER'                 TO RC071-USER-ID              10090000
101000                                                                  10100000
101100     MOVE PC-CURRENT-PGM-NAME       TO RC071-CALLING-PROGRAM      10110000
101200                                                                  10120000
101300     EVALUATE TRUE                                                10130000
101400        WHEN PV-PRCG-STAT-CDE = PC-DELETED-RCVR-CANCEL            10140000
101500        WHEN PV-PRCG-STAT-CDE = PC-NOT-FOUND                      10150000
101600          SET RC071-SUSP-SWEEP-CANCELLED    TO  TRUE              10160000
101700        WHEN PV-PRCG-STAT-CDE = PC-PREVIOUSLY-VERIFIED            10170000
101800          SET RC071-SUSP-SWEEP-PREV-VRFY    TO  TRUE              10180000
101900        WHEN PV-PRCG-STAT-CDE = PC-SPLIT-STATUS                   10190000
102000          SET RC071-SUSP-SWEEP-P2-INCMPL    TO  TRUE              10200000
102100        WHEN PV-PRCG-STAT-CDE = PC-UNRSLVD-AUTO-ADJ               10210000
102200          SET RC071-SUSP-SWEEP-OP-SY-AUD    TO  TRUE              10220000
102300        WHEN PV-PRCG-STAT-CDE = PC-ERROR-NO-PRO                   10230000
102400          SET RC071-SUSP-SWEEP-NO-PRONBR    TO  TRUE              10240000
102500        WHEN PV-PRCG-STAT-CDE = PC-ERROR-NOT-ARR                  10250000
102600          SET RC071-SUSP-SWEEP-NT-ARRVD     TO  TRUE              10260000
102700        WHEN PV-PRCG-STAT-CDE = PC-ERROR-STATUS                   10270000
102800          SET RC071-SUSP-SWEEP-RCVR-TRBL    TO  TRUE              10280000
102900        WHEN PV-PRCG-STAT-CDE = PC-INV-CYCLE                      10290000
103000          SET RC071-SUSP-SWEEP-ST-INVTRY    TO  TRUE              10300000
103100        WHEN PV-PRCG-STAT-CDE = PC-READY-TO-VERIFY-STATUS         10310000
103200          SET RC071-SUSP-SWEEP-FOR-READY    TO  TRUE              10320000
103300        WHEN PV-PRCG-STAT-CDE = PC-RESET-TO-DOWNLOAD              10330000
103400          SET RC071-SUSP-SWEEP-RSET-DWNLOD  TO  TRUE              10340000
103500     END-EVALUATE                                                 10350000
103600                                                                  10360000
103700     MOVE LENGTH OF RC071-FIELDS    TO PV-COMMAREA-LENGTH.        10370000
103800                                                                  10380000
103900     CALL RC071-PO-RCVR-TRACKING USING  DFHEIBLK                  10390000
104000                                        RC071-COMMAREA            10400000
104100                                        RC071-FIELDS.             10410000
104200                                                                  10420000
104300     EVALUATE TRUE                                                10430000
104400         WHEN RC071-SUCCESSFUL                                    10440000
104500             CONTINUE                                             10450000
104600         WHEN OTHER                                               10460000
104700             STRING ' RCKCS291 - '        DELIMITED BY SIZE       10470000
104800               '2250-CALL-TRACKIN-MODULE' DELIMITED BY SIZE       10480000
104900                    ' RETURN MESSAGE - '  DELIMITED BY SIZE       10490000
105000                    RC071-SUCCESS-IND     DELIMITED BY SIZE       10500000
105100                                        INTO PV-CICS-MSG-AREA     10510000
105200             PERFORM 9997-WRITE-TO-CSSL                           10520000
105300     END-EVALUATE.                                                10530000
105400                                                                  10540000
105500                                                                  10550000
105600******************************************************************10560000
105700*    GET INFOMATION FROM TRECEIV INORDER TO CALL VEM.             10570000
105800******************************************************************10580000
105900 2300-GET-TRECEIV.                                                10590000
106000                                                                  10600000
106100     IF  PS-CSSL-LOGGING-YES                                      10610000
106200         MOVE '2300-GET-TRECEIV           ' TO PV-PARA-NAME       10620000
106300         PERFORM 9998-BUILD-MESSAGE                               10630000
106400     END-IF.                                                      10640000
106500                                                                  10650000
106600     EXEC SQL                                                     10660000
106700          SELECT PACK_BY_ST_IND                                   10670000
106800                ,OPER_UNT_ID                                      10680000
106900                ,PKGNG_CDE                                        10690000
107000                ,STATUS_CDE                                       10700000
107100                ,CURR_OPER_UNT_ID                                 10710000
107200            INTO :RECEIV-PACK-BY-ST-IND                           10720000
107300                ,:RECEIV-OPER-UNT-ID                              10730000
107400                ,:RECEIV-PKGNG-CDE                                10740000
107500                ,:RECEIV-STATUS-CDE                               10750000
107510                ,:RECEIV-CURR-OPER-UNT-ID                         10751000
107520            FROM TRECEIV                                          10752000
107530           WHERE ORD_NBR       = :DK-ORD-NBR                      10753000
107540             AND REC_SEQ_NBR   = :DK-REC-SEQ-NBR                  10754000
107550     END-EXEC                                                     10755000
107560                                                                  10756000
107570     EVALUATE TRUE                                                10757000
107580         WHEN SQLCODE = +0                                        10758000
107590            CONTINUE                                              10759000
107600         WHEN OTHER                                               10760000
107700             MOVE '2300-GET-TRECEIV         '                     10770000
107800                               TO DP013-PARAGRAPH                 10780000
107900             MOVE 'UNABLE TO GET TRECEIV        '                 10790000
108000                               TO DP013-MESSAGE-TEXT (1)          10800000
108100             MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR                10810000
108200             MOVE DK-REC-SEQ-NBR                                  10820000
108300                               TO PV-ERROR-RCVR-SEQ-NBR           10830000
108400             STRING ' RCVR: '                                     10840000
108500                  PV-ERROR-ORD-NBR '-'                            10850000
108600                  PV-ERROR-RCVR-SEQ-NBR                           10860000
108700                                         DELIMITED BY SIZE        10870000
108800                             INTO DP013-MESSAGE-TEXT (2)          10880000
108900             MOVE SQLCA        TO DP013-SQLCA                     10890000
109000             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        10900000
109100             SET DP013-ROLLBACK                                   10910000
109200                 DP013-DB2-ABEND                                  10920000
109300                               TO TRUE                            10930000
109400             PERFORM 9999-WRITE-CICS-LOG-MSG                      10940000
109500     END-EVALUATE.                                                10950000
109600                                                                  10960000
109700******************************************************************10970000
109800*    GET PREPK-ID                                                *10980000
109900******************************************************************10990000
110000 2350-GET-PREPK-ID.                                               11000000
110100                                                                  11010000
110200     IF  PS-CSSL-LOGGING-YES                                      11020000
110300         MOVE '2350-GET-PREPK-ID          ' TO PV-PARA-NAME       11030000
110400         PERFORM 9998-BUILD-MESSAGE                               11040000
110500     END-IF.                                                      11050000
110600                                                                  11060000
110700     PERFORM                                                      11070000
110800         WITH TEST AFTER                                          11080000
110900         VARYING PV-RETRY-COUNTER                                 11090000
111000         FROM 1 BY 1                                              11100000
111100         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                11110000
111200             OR (SQLCODE = +0)                                    11120000
111300                                                                  11130000
111400     EXEC SQL                                                     11140000
111500          SELECT PREPK_ID                                         11150000
111600            INTO :DK-PREPK-ID                                     11160000
111700            FROM TRECITM                                          11170000
111800           WHERE ORD_NBR         = :DK-ORD-NBR                    11180000
111900             AND REC_SEQ_NBR     = :DK-REC-SEQ-NBR                11190000
112000             AND ORD_LNE_NBR     = :DK-ORD-LNE-NBR                11200000
112100     END-EXEC                                                     11210000
112200                                                                  11220000
112300         EVALUATE TRUE                                            11230000
112400             WHEN SQLCODE = ZERO                                  11240000
112500             WHEN SQLCODE = -904                                  11250000
112600             WHEN SQLCODE = -911                                  11260000
112700             WHEN SQLCODE = -913                                  11270000
112800                 CONTINUE                                         11280000
112900             WHEN SQLWARN0 NOT = SPACES                           11290000
113000             WHEN SQLCODE < ZERO                                  11300000
113100             WHEN SQLCODE > ZERO                                  11310000
113200                 MOVE '2350-GET-PREPK-ID        '                 11320000
113300                                   TO DP013-PARAGRAPH             11330000
113400                 MOVE 'UNABLE TO GET PREPK ID        '            11340000
113500                                   TO DP013-MESSAGE-TEXT (1)      11350000
113600                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            11360000
113700                 MOVE DK-REC-SEQ-NBR                              11370000
113800                                   TO PV-ERROR-RCVR-SEQ-NBR       11380000
113900                 MOVE DK-ORD-LNE-NBR                              11390000
114000                                   TO PV-ERROR-ORD-LNE-NBR        11400000
114100                 STRING ' RCVR: '                                 11410000
114200                      PV-ERROR-ORD-NBR '-'                        11420000
114300                      PV-ERROR-RCVR-SEQ-NBR '-'                   11430000
114400                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    11440000
114500                                 INTO DP013-MESSAGE-TEXT (2)      11450000
114600                 MOVE SQLCA        TO DP013-SQLCA                 11460000
114700                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    11470000
114800                 SET DP013-ROLLBACK                               11480000
114900                     DP013-DB2-ABEND                              11490000
115000                                   TO TRUE                        11500000
115100                 PERFORM 9999-WRITE-CICS-LOG-MSG                  11510000
115200         END-EVALUATE                                             11520000
115300     END-PERFORM.                                                 11530000
115400                                                                  11540000
115500     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  11550000
115600         (SQLCODE NOT = +0)                                       11560000
115700         MOVE '2350-GET-PREPK-ID        '                         11570000
115800                                  TO DP013-PARAGRAPH              11580000
115900         MOVE 'MAX RETRIES EXCEEDED ON TRECITM PREPK ID    '      11590000
116000                                  TO DP013-MESSAGE-TEXT (1)       11600000
116100         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             11610000
116200         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        11620000
116300         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         11630000
116400         STRING ' RCVR: '                                         11640000
116500              PV-ERROR-ORD-NBR '-'                                11650000
116600              PV-ERROR-RCVR-SEQ-NBR '-'                           11660000
116700              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            11670000
116800                                INTO DP013-MESSAGE-TEXT (2)       11680000
116900         MOVE SQLCA               TO DP013-SQLCA                  11690000
117000         MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)     11700000
117100         SET DP013-DB2-ABEND                                      11710000
117200             DP013-ROLLBACK    TO TRUE                            11720000
117300         PERFORM 9999-WRITE-CICS-LOG-MSG                          11730000
117400     END-IF.                                                      11740000
117500                                                                  11750000
117600******************************************************************11760000
117700*    CHECK IF PO IS AN AUTOVE PO                                 *11770000
117800******************************************************************11780000
117900 2360-CHECK-IF-AUTOVE.                                            11790000
118000                                                                  11800000
118100     IF  PS-CSSL-LOGGING-YES                                      11810000
118200         MOVE '2360-CHECK-IF-AUTOVE       ' TO PV-PARA-NAME       11820000
118300         PERFORM 9998-BUILD-MESSAGE                               11830000
118400     END-IF.                                                      11840000
118500                                                                  11850000
118600     INITIALIZE RC040-FIELDS.                                     11860000
118700     MOVE DK-ORD-NBR               TO RC040-PO-NBR                11870000
118800     MOVE DK-REC-SEQ-NBR           TO RC040-PO-RCVR               11880000
118900                                                                  11890000
119000     SET RC040-RCVR-EXISTS         TO TRUE                        11900000
119100                                                                  11910000
119200     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  11920000
119300                                        RC040-COMMAREA            11930000
119400                                        RC040-FIELDS.             11940000
119500                                                                  11950000
119600     EVALUATE TRUE                                                11960000
119700         WHEN RC040-SUCCESSFUL                                    11970000
119800             CONTINUE                                             11980000
119900         WHEN OTHER                                               11990000
120000              MOVE '2360-CHECK-IF-AUTOVE     '                    12000000
120100                                   TO DP013-PARAGRAPH             12010000
120200              MOVE 'CALL TO RCKUT127              '               12020000
120300                                   TO DP013-MESSAGE-TEXT (1)      12030000
120400              MOVE DK-ORD-NBR      TO PV-ERROR-ORD-NBR            12040000
120500              MOVE DK-REC-SEQ-NBR  TO PV-ERROR-RCVR-SEQ-NBR       12050000
120600              MOVE DK-ORD-LNE-NBR  TO PV-ERROR-ORD-LNE-NBR        12060000
120700              STRING ' RCVR: '                                    12070000
120800                      PV-ERROR-ORD-NBR '-'                        12080000
120900                      PV-ERROR-RCVR-SEQ-NBR '-'                   12090000
121000                      PV-ERROR-ORD-LNE-NBR  '--'                  12100000
121100                      RC040-SUCCESS-IND '--'                      12110000
121200                      RC040-CRA-REQ-ID       DELIMITED BY SIZE    12120000
121300                                 INTO DP013-MESSAGE-TEXT (2)      12130000
121400              MOVE RC040-CRA-RET-MSG                              12140000
121500                                   TO DP013-MESSAGE-TEXT (3)      12150000
121600              MOVE SQLCA           TO DP013-SQLCA                 12160000
121700              SET DP013-ROLLBACK                                  12170000
121800                     DP013-DB2-ABEND TO TRUE                      12180000
121900                 PERFORM 9999-WRITE-CICS-LOG-MSG                  12190000
122000     END-EVALUATE.                                                12200000
122100                                                                  12210000
122200                                                                  12220000
122300                                                                  12230000
122400                                                                  12240000
122500******************************************************************12250000
122600*    CHECK ON THE STATUS OF THE RECEIPT LINE ITEM.               *12260000
122700******************************************************************12270000
122800 2400-CHECK-TRECITM-STATUS.                                       12280000
122900                                                                  12290000
123000     IF  PS-CSSL-LOGGING-YES                                      12300000
123100         MOVE '2400-CHECK-TRECITM-STATUS  ' TO PV-PARA-NAME       12310000
123200         PERFORM 9998-BUILD-MESSAGE                               12320000
123300     END-IF.                                                      12330000
123400                                                                  12340000
123500     INITIALIZE DCLTRECITM.                                       12350000
123600                                                                  12360000
123700     PERFORM                                                      12370000
123800         WITH TEST AFTER                                          12380000
123900         VARYING PV-RETRY-COUNTER                                 12390000
124000         FROM 1 BY 1                                              12400000
124100         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                12410000
124200             OR (SQLCODE = +0)                                    12420000
124300                                                                  12430000
124400         EXEC SQL                                                 12440000
124500              SELECT                                              12450000
124600                    STATUS_CDE                                    12460000
124700                   ,PREPK_ID                                      12470000
124800                INTO                                              12480000
124900                    :RECITM-STATUS-CDE                            12490000
125000                   ,:RECITM-PREPK-ID                              12500000
125100                FROM                                              12510000
125200                    TRECITM                                       12520000
125300               WHERE                                              12530000
125400                    ORD_NBR        = :DK-ORD-NBR      AND         12540000
125500                    REC_SEQ_NBR    = :DK-REC-SEQ-NBR  AND         12550000
125600                    ORD_LNE_NBR    = :DK-ORD-LNE-NBR  AND         12560000
125700                    VER_STATUS_CDE = 'A'                          12570000
125800         END-EXEC                                                 12580000
125900                                                                  12590000
126000         EVALUATE TRUE                                            12600000
126100             WHEN SQLCODE = ZERO                                  12610000
126200             WHEN SQLCODE = -904                                  12620000
126300             WHEN SQLCODE = -911                                  12630000
126400             WHEN SQLCODE = -913                                  12640000
126500                 CONTINUE                                         12650000
126600             WHEN SQLWARN0 NOT = SPACES                           12660000
126700             WHEN SQLCODE < ZERO                                  12670000
126800             WHEN SQLCODE > ZERO                                  12680000
126900                 MOVE '2400-CHECK-TRECITM-STATUS'                 12690000
127000                                   TO DP013-PARAGRAPH             12700000
127100                 MOVE 'UNABLE TO CHECK TRECITM STATUS'            12710000
127200                                   TO DP013-MESSAGE-TEXT (1)      12720000
127300                 MOVE DK-ORD-NBR   TO PV-ERROR-ORD-NBR            12730000
127400                 MOVE DK-REC-SEQ-NBR                              12740000
127500                                   TO PV-ERROR-RCVR-SEQ-NBR       12750000
127600                 MOVE DK-ORD-LNE-NBR                              12760000
127700                                   TO PV-ERROR-ORD-LNE-NBR        12770000
127800                 STRING ' RCVR: '                                 12780000
127900                      PV-ERROR-ORD-NBR '-'                        12790000
128000                      PV-ERROR-RCVR-SEQ-NBR '-'                   12800000
128100                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    12810000
128200                                 INTO DP013-MESSAGE-TEXT (2)      12820000
128300                 MOVE SQLCA        TO DP013-SQLCA                 12830000
128400                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    12840000
128500                 SET DP013-ROLLBACK                               12850000
128600                     DP013-DB2-ABEND                              12860000
128700                                   TO TRUE                        12870000
128800                 PERFORM 9999-WRITE-CICS-LOG-MSG                  12880000
128900         END-EVALUATE                                             12890000
129000     END-PERFORM.                                                 12900000
129100                                                                  12910000
129200     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  12920000
129300         (SQLCODE NOT = +0)                                       12930000
129400         MOVE '2400-CHECK-TRECITM-STATUS'                         12940000
129500                                  TO DP013-PARAGRAPH              12950000
129600         MOVE 'MAX RETRIES EXCEEDED ON TRECITM STATUS CHECK'      12960000
129700                                  TO DP013-MESSAGE-TEXT (1)       12970000
129800         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             12980000
129900         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        12990000
130000         MOVE DK-ORD-LNE-NBR      TO PV-ERROR-ORD-LNE-NBR         13000000
130100         STRING ' RCVR: '                                         13010000
130200              PV-ERROR-ORD-NBR '-'                                13020000
130300              PV-ERROR-RCVR-SEQ-NBR '-'                           13030000
130400              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            13040000
130500                                INTO DP013-MESSAGE-TEXT (2)       13050000
130600         MOVE SQLCA               TO DP013-SQLCA                  13060000
130700         MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)     13070000
130800         SET DP013-DB2-ABEND                                      13080000
130900             DP013-ROLLBACK    TO TRUE                            13090000
131000         PERFORM 9999-WRITE-CICS-LOG-MSG                          13100000
131100     END-IF.                                                      13110000
131200                                                                  13120000
131300******************************************************************13130000
131400*    CHECK TRECEIV TO SEE IF ARRIVED.                            *13140000
131500******************************************************************13150000
131600 2600-CHECK-IF-ARRIVED.                                           13160000
131700                                                                  13170000
131800     IF  PS-CSSL-LOGGING-YES                                      13180000
131900         MOVE '2600-CHECK-IF-ARRIVED      ' TO PV-PARA-NAME       13190000
132000         PERFORM 9998-BUILD-MESSAGE                               13200000
132100     END-IF.                                                      13210000
132200                                                                  13220000
132300     MOVE  ZEROES  TO  PV-ARRIVED-COUNT.                          13230000
132400                                                                  13240000
132500     PERFORM                                                      13250000
132600         WITH TEST AFTER                                          13260000
132700         VARYING PV-RETRY-COUNTER                                 13270000
132800         FROM 1 BY 1                                              13280000
132900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13290000
133000             OR (SQLCODE = +0)                                    13300000
133100             OR (SQLCODE = +100))                                 13310000
133200                                                                  13320000
133300         EXEC SQL                                                 13330000
133400              SELECT COUNT(*)                                     13340000
133500                INTO :PV-ARRIVED-COUNT                            13350000
133600                FROM TRECEIV                                      13360000
133700               WHERE ORD_NBR       = :DK-ORD-NBR                  13370000
133800                 AND REC_SEQ_NBR   = :DK-REC-SEQ-NBR              13380000
133900                 AND REC_TMST      = :PC-DEFAULT-TMST             13390000
134000         END-EXEC                                                 13400000
134100                                                                  13410000
134200         EVALUATE TRUE                                            13420000
134300             WHEN SQLCODE = +0                                    13430000
134400             WHEN SQLCODE = +100                                  13440000
134500                  IF PV-ARRIVED-COUNT  > 0                        13450000
134600                     SET PS-NOT-ARRIVED  TO TRUE                  13460000
134700                  ELSE                                            13470000
134800                     SET PS-ARRIVED      TO TRUE                  13480000
134900                  END-IF                                          13490000
135000             WHEN SQLCODE = -904                                  13500000
135100             WHEN SQLCODE = -911                                  13510000
135200             WHEN SQLCODE = -913                                  13520000
135300                  SET PS-NOT-ARRIVED  TO TRUE                     13530000
135400                                                                  13540000
135500             WHEN SQLWARN0 NOT = SPACES                           13550000
135600             WHEN SQLCODE < +0                                    13560000
135700             WHEN SQLCODE > +0                                    13570000
135800                  MOVE '2600-CHECK-IF-ARRIVED'                    13580000
135900                                  TO DP013-PARAGRAPH              13590000
136000                  MOVE 'CHECK IF PO/RCVR IS ARRIVED       S'      13600000
136100                                  TO DP013-MESSAGE-TEXT (1)       13610000
136200                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             13620000
136300                  MOVE DK-REC-SEQ-NBR                             13630000
136400                                  TO PV-ERROR-RCVR-SEQ-NBR        13640000
136500                  STRING ' RCVR: '                                13650000
136600                       PV-ERROR-ORD-NBR '-'                       13660000
136700                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   13670000
136800                                INTO DP013-MESSAGE-TEXT (2)       13680000
136900                  MOVE SQLCA      TO DP013-SQLCA                  13690000
137000                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     13700000
137100                  SET DP013-DB2-ABEND                             13710000
137200                      DP013-XCTL-DISPLAY-RESTART                  13720000
137300                      DP013-ROLLBACK                              13730000
137400                                  TO TRUE                         13740000
137500                  PERFORM 9999-WRITE-CICS-LOG-MSG                 13750000
137600         END-EVALUATE                                             13760000
137700     END-PERFORM.                                                 13770000
137800                                                                  13780000
137900     IF  (PV-RETRY-COUNTER > PC-MAX-RETRIES) AND                  13790000
138000         (SQLCODE NOT = +0)                                       13800000
138100         MOVE '2600-CHECK-IF-ARRIVED'                             13810000
138200                                  TO DP013-PARAGRAPH              13820000
138300         MOVE 'MAX RETRIES EXCEEDED ON CHECK IF ARRIVED      '    13830000
138400                                  TO DP013-MESSAGE-TEXT (1)       13840000
138500         MOVE DK-ORD-NBR          TO PV-ERROR-ORD-NBR             13850000
138600         MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR        13860000
138700         STRING ' RCVR: '                                         13870000
138800              PV-ERROR-ORD-NBR '-'                                13880000
138900              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            13890000
139000                                INTO DP013-MESSAGE-TEXT (2)       13900000
139100         MOVE SQLCA               TO DP013-SQLCA                  13910000
139200         MOVE 'TRECEIV'           TO DP013-DB2-TABLE-NAME (1)     13920000
139300         SET DP013-DB2-ABEND                                      13930000
139400             DP013-ROLLBACK    TO TRUE                            13940000
139500         PERFORM 9999-WRITE-CICS-LOG-MSG                          13950000
139600     END-IF.                                                      13960000
139700                                                                  13970000
139800                                                                  13980000
139900*----------------------------------------------------------------*13990000
140000* WHEN IT HAS BEEN DETERMINED THAT THE LINE IS PART OF A PREPK   *14000000
140100* ORDER.  THE OTHER LINES ASSOCIATED WITH THE PREPK (THAT WERE   *14010000
140200* NOT SENT TO P2L) NEED TO BE UPDATED ALSO. (TDISTHD)            *14020000
140300*----------------------------------------------------------------*14030000
140400 2700-PROCESS-PREPK.                                              14040000
140500                                                                  14050000
140600     IF  PS-CSSL-LOGGING-YES                                      14060000
140700         MOVE '2700-PROCESS-PREPK         ' TO PV-PARA-NAME       14070000
140800         PERFORM 9998-BUILD-MESSAGE                               14080000
140900     END-IF.                                                      14090000
141000                                                                  14100000
141100     SET  PS-PREPK-LINES-LEFT     TO  TRUE.                       14110000
141200     MOVE DK-ORD-NBR              TO  DK-PREPK-PO-NBR.            14120000
141300     MOVE DK-REC-SEQ-NBR          TO  DK-PREPK-REC-SEQ-NBR.       14130000
141400     MOVE DK-ORD-LNE-NBR          TO  DK-PREPK-LINE-NBR.          14140000
141500     MOVE RECITM-PREPK-ID         TO  DK-PREPK-ID.                14150000
141600                                                                  14160000
141700     SET  PS-PREPK-LINES-LEFT     TO  TRUE.                       14170000
141800     PERFORM 2710-OPEN-PREPK-CSR.                                 14180000
141900     PERFORM 2715-FETCH-PREPK-CSR                                 14190000
142000       UNTIL PS-NO-PREPK-LINES-LEFT.                              14200000
142100     PERFORM 2720-CLOSE-PREPK-CSR.                                14210000
142200                                                                  14220000
142300                                                                  14230000
142400*----------------------------------------------------------------*14240000
142500* PRE-PACK ORDER - OPEN CURSOR                                   *14250000
142600*----------------------------------------------------------------*14260000
142700 2710-OPEN-PREPK-CSR.                                             14270000
142800                                                                  14280000
142900     IF  PS-CSSL-LOGGING-YES                                      14290000
143000         MOVE '2710-OPEN-PREPK-CSR        ' TO PV-PARA-NAME       14300000
143100         PERFORM 9998-BUILD-MESSAGE                               14310000
143200     END-IF.                                                      14320000
143300                                                                  14330000
143400     EXEC SQL                                                     14340000
143500          OPEN PRE_PACK_LNE_CSR                                   14350000
143600     END-EXEC.                                                    14360000
143700                                                                  14370000
143800     EVALUATE TRUE                                                14380000
143900         WHEN SQLCODE = ZERO                                      14390000
144000             CONTINUE                                             14400000
144100         WHEN SQLCODE = -904                                      14410000
144200         WHEN SQLCODE = -911                                      14420000
144300         WHEN SQLCODE = -913                                      14430000
144400         WHEN SQLWARN0 NOT = SPACES                               14440000
144500         WHEN SQLCODE < ZERO                                      14450000
144600         WHEN SQLCODE > ZERO                                      14460000
144700             MOVE '2710-OPEN-PREPK-CSR    '                       14470000
144800                               TO DP013-PARAGRAPH                 14480000
144900             MOVE 'OPEN PREPACK LINE CURSOR - '                   14490000
145000                               TO DP013-MESSAGE-TEXT (1)          14500000
145100             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        14510000
145200             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   14520000
145300             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    14530000
145400             STRING ' RCVR: '                                     14540000
145500                    PV-ERROR-ORD-NBR '-'                          14550000
145600                    PV-ERROR-RCVR-SEQ-NBR '-'                     14560000
145700                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       14570000
145800                                     INTO DP013-MESSAGE-TEXT (2)  14580000
145900             MOVE SQLCA               TO DP013-SQLCA              14590000
146000             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 14600000
146100             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 14610000
146200             SET DP013-ROLLBACK                                   14620000
146300                 DP013-DB2-ABEND      TO TRUE                     14630000
146400             PERFORM 9999-WRITE-CICS-LOG-MSG                      14640000
146500     END-EVALUATE.                                                14650000
146600                                                                  14660000
146700                                                                  14670000
146800*----------------------------------------------------------------*14680000
146900* PRE-PACK ORDER - FETCH CURSOR - LINES NOT DOWNLOADED TO P2L    *14690000
147000*----------------------------------------------------------------*14700000
147100 2715-FETCH-PREPK-CSR.                                            14710000
147200                                                                  14720000
147300     IF  PS-CSSL-LOGGING-YES                                      14730000
147400         MOVE '2715-FETCH-PREPK-CSR       ' TO PV-PARA-NAME       14740000
147500         PERFORM 9998-BUILD-MESSAGE                               14750000
147600     END-IF.                                                      14760000
147700                                                                  14770000
147800     EXEC SQL                                                     14780000
147900          FETCH PRE_PACK_LNE_CSR                                  14790000
148000           INTO :PV-PRPK-REC-ORD-LNE-NBR                          14800000
148100     END-EXEC.                                                    14810000
148200                                                                  14820000
148300     EVALUATE TRUE                                                14830000
148400         WHEN SQLCODE = ZERO                                      14840000
148500              PERFORM 2725-UPDATE-PREPK-HEADER                    14850000
148600                                                                  14860000
148700         WHEN SQLCODE = +100                                      14870000
148800         SET PS-NO-PREPK-LINES-LEFT                               14880000
148900                                   TO TRUE                        14890000
149000         WHEN SQLCODE = -904                                      14900000
149100         WHEN SQLCODE = -911                                      14910000
149200         WHEN SQLCODE = -913                                      14920000
149300         WHEN SQLWARN0 NOT = SPACE                                14930000
149400         WHEN SQLCODE NOT = ZERO                                  14940000
149500             MOVE '2715-FETCH-PREPK-CSR   '                       14950000
149600                               TO DP013-PARAGRAPH                 14960000
149700             MOVE 'FETCH PREPACK LINE CURSOR - '                  14970000
149800                               TO DP013-MESSAGE-TEXT (1)          14980000
149900             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        14990000
150000             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   15000000
150100             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    15010000
150200             STRING ' RCVR: '                                     15020000
150300                    PV-ERROR-ORD-NBR '-'                          15030000
150400                    PV-ERROR-RCVR-SEQ-NBR '-'                     15040000
150500                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       15050000
150600                                     INTO DP013-MESSAGE-TEXT (2)  15060000
150700             MOVE SQLCA               TO DP013-SQLCA              15070000
150800             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 15080000
150900             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 15090000
151000             SET DP013-ROLLBACK                                   15100000
151100                 DP013-DB2-ABEND      TO TRUE                     15110000
151200             PERFORM 9999-WRITE-CICS-LOG-MSG                      15120000
151300     END-EVALUATE.                                                15130000
151400                                                                  15140000
151500*----------------------------------------------------------------*15150000
151600* PRE-PACK ORDER - CLOSE CURSOR                                  *15160000
151700*----------------------------------------------------------------*15170000
151800 2720-CLOSE-PREPK-CSR.                                            15180000
151900                                                                  15190000
152000     IF  PS-CSSL-LOGGING-YES                                      15200000
152100         MOVE '2720-CLOSE-PREPK-CSR       ' TO PV-PARA-NAME       15210000
152200         PERFORM 9998-BUILD-MESSAGE                               15220000
152300     END-IF.                                                      15230000
152400                                                                  15240000
152500     EXEC SQL                                                     15250000
152600          CLOSE PRE_PACK_LNE_CSR                                  15260000
152700     END-EXEC.                                                    15270000
152800                                                                  15280000
152900     EVALUATE TRUE                                                15290000
153000         WHEN SQLCODE = ZERO                                      15300000
153100             CONTINUE                                             15310000
153200         WHEN SQLCODE = -904                                      15320000
153300         WHEN SQLCODE = -911                                      15330000
153400         WHEN SQLCODE = -913                                      15340000
153500         WHEN SQLWARN0 NOT = SPACES                               15350000
153600         WHEN SQLCODE < ZERO                                      15360000
153700         WHEN SQLCODE > ZERO                                      15370000
153800             MOVE '2720-CLOSE-PREPK-CSR   '                       15380000
153900                               TO DP013-PARAGRAPH                 15390000
154000             MOVE 'CLOSE PREPACK LINE CURSOR - '                  15400000
154100                               TO DP013-MESSAGE-TEXT (1)          15410000
154200             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        15420000
154300             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   15430000
154400             MOVE DK-PREPK-LINE-NBR    TO PV-ERROR-ORD-LNE-NBR    15440000
154500             STRING ' RCVR: '                                     15450000
154600                    PV-ERROR-ORD-NBR '-'                          15460000
154700                    PV-ERROR-RCVR-SEQ-NBR '-'                     15470000
154800                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       15480000
154900                                     INTO DP013-MESSAGE-TEXT (2)  15490000
155000             MOVE SQLCA               TO DP013-SQLCA              15500000
155100             MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1) 15510000
155200             MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (2) 15520000
155300             SET DP013-ROLLBACK                                   15530000
155400                 DP013-DB2-ABEND      TO TRUE                     15540000
155500             PERFORM 9999-WRITE-CICS-LOG-MSG                      15550000
155600     END-EVALUATE.                                                15560000
155700                                                                  15570000
155800                                                                  15580000
155900*----------------------------------------------------------------*15590000
156000* UPDATE DISTRIBUTION HEADER PREPK LINE NOT DOWNLOADED (TDISTHD) *15600000
156100*----------------------------------------------------------------*15610000
156200 2725-UPDATE-PREPK-HEADER.                                        15620000
156300                                                                  15630000
156400     IF  PS-CSSL-LOGGING-YES                                      15640000
156500         MOVE '2725-UPDATE-PREPK-HEADER   ' TO PV-PARA-NAME       15650000
156600         PERFORM 9998-BUILD-MESSAGE                               15660000
156700     END-IF.                                                      15670000
156800                                                                  15680000
156900     EXEC SQL                                                     15690000
157000          UPDATE TDISTHD                                          15700000
157100             SET PRCG_STAT_CDE   = :PV-PRCG-STAT-CDE              15710000
157200           WHERE ORD_NBR             = :DK-PREPK-PO-NBR           15720000
157300             AND RCVR_SEQ_NBR        = :DK-PREPK-REC-SEQ-NBR      15730000
157400             AND ORD_LNE_NBR         = :PV-PRPK-REC-ORD-LNE-NBR   15740000
157500     END-EXEC.                                                    15750000
157600                                                                  15760000
157700     EVALUATE TRUE                                                15770000
157800         WHEN SQLCODE = ZERO                                      15780000
157900         WHEN SQLCODE = +100                                      15790000
158000              CONTINUE                                            15800000
158100         WHEN SQLCODE = -904                                      15810000
158200         WHEN SQLCODE = -911                                      15820000
158300         WHEN SQLCODE = -913                                      15830000
158400         WHEN SQLWARN0 NOT = SPACES                               15840000
158500         WHEN SQLCODE NOT EQUAL ZERO                              15850000
158600             MOVE '2725-UPDATE-PREPK-DISTHD'                      15860000
158700                               TO DP013-PARAGRAPH                 15870000
158800             MOVE 'UPDATE PREPACK LINE - '                        15880000
158900                               TO DP013-MESSAGE-TEXT (1)          15890000
159000             MOVE DK-PREPK-PO-NBR      TO PV-ERROR-ORD-NBR        15900000
159100             MOVE DK-PREPK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   15910000
159200             MOVE PV-PRPK-REC-ORD-LNE-NBR                         15920000
159300                                       TO PV-ERROR-ORD-LNE-NBR    15930000
159400             STRING ' RCVR: '                                     15940000
159500                    PV-ERROR-ORD-NBR '-'                          15950000
159600                    PV-ERROR-RCVR-SEQ-NBR '-'                     15960000
159700                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       15970000
159800                                     INTO DP013-MESSAGE-TEXT (2)  15980000
159900             MOVE SQLCA               TO DP013-SQLCA              15990000
160000             MOVE 'TDISTHD '          TO DP013-DB2-TABLE-NAME (1) 16000000
160100             SET DP013-ROLLBACK                                   16010000
160200                 DP013-DB2-ABEND      TO TRUE                     16020000
160300             PERFORM 9999-WRITE-CICS-LOG-MSG                      16030000
160400     END-EVALUATE.                                                16040000
160500                                                                  16050000
160600******************************************************************16060000
160700*    CHECK TO DETERMINE IF THIS CAN BE AUTOMATICALLY ADJUSTED    *16070000
160800*    BY CALLING THE SUKCS762 MODULE.                             *16080000
160900******************************************************************16090000
161000 3000-CALL-ADJUST-SYST-AUDIT.                                     16100000
161100                                                                  16110000
161200     IF  PS-CSSL-LOGGING-YES                                      16120000
161300         MOVE '3000-CALL-ADJUST-SYST-AUDIT' TO PV-PARA-NAME       16130000
161400         PERFORM 9998-BUILD-MESSAGE                               16140000
161500     END-IF.                                                      16150000
161600                                                                  16160000
161700     INITIALIZE SU047-COMMAREA-REC.                               16170000
161800     MOVE DK-ORD-NBR              TO  SU047-PO-NBR.               16180000
161900     MOVE DK-REC-SEQ-NBR          TO  SU047-REC-SEQ-NBR.          16190000
162000     MOVE DK-ORD-LNE-NBR          TO  SU047-PO-LNE-NBR.           16200000
162100     MOVE RECEIV-OPER-UNT-ID      TO  SU047-OPER-UNT-ID.          16210000
162200     MOVE 1                       TO  SU047-FCLTY-ID.             16220000
162300     MOVE RECITM-PREPK-ID         TO  SU047-PREPACK-ID.           16230000
162400     IF RECEIV-PACK-BY-ST-IND = 'Y'                               16240000
162500         SET SU047-PBS            TO TRUE                         16250000
162600     ELSE                                                         16260000
162700         MOVE RECEIV-PKGNG-CDE    TO SU047-PKGNG-CDE              16270000
162800     END-IF.                                                      16280000
162900     MOVE 'RCKCS291'              TO  SU047-USER-ID.              16290000
163000     MOVE 'RCKCS291'              TO  SU047-CALLING-PROGRAM.      16300000
163100                                                                  16310000
163200     MOVE LENGTH OF SU047-COMMAREA-REC   TO PV-COMMAREA-LENGTH.   16320000
163300                                                                  16330000
163400     EXEC CICS                                                    16340000
163500         LINK PROGRAM  (SU047-MODULE-NAME)                        16350000
163600              COMMAREA (SU047-COMMAREA-REC)                       16360000
163700              LENGTH   (PV-COMMAREA-LENGTH)                       16370000
163800              RESP     (PV-CICS-RESPONSE)                         16380000
163900     END-EXEC.                                                    16390000
164000                                                                  16400000
164100     EVALUATE TRUE                                                16410000
164200         WHEN SU047-SUCCESSFUL                                    16420000
164300            CONTINUE                                              16430000
164400         WHEN SU047-DATABASE-BUSY                                 16440000
164500            MOVE DK-ORD-NBR             TO PV-ERROR-ORD-NBR       16450000
164600            MOVE DK-REC-SEQ-NBR         TO PV-ERROR-RCVR-SEQ-NBR  16460000
164700            MOVE DK-ORD-LNE-NBR         TO PV-ERROR-ORD-LNE-NBR   16470000
164800            STRING ' RCKCS291 - CALL TO '                         16480000
164900                   SU047-MODULE-NAME                              16490000
165000                   ' PO/RCVR: '                                   16500000
165100                  PV-ERROR-ORD-NBR '-'                            16510000
165200                  PV-ERROR-RCVR-SEQ-NBR '-'                       16520000
165300                  PV-ERROR-ORD-LNE-NBR ' - '                      16530000
165400                  SU047-SUCCESS-IND '-'                           16540000
165500                  SU047-SQLCODE                 DELIMITED BY SIZE 16550000
165600                                      INTO PV-CICS-MSG-AREA       16560000
165700            PERFORM 9900-WRITE-CICS                               16570000
165800            STRING ' RCKCS291 - SQLCA - '                         16580000
165900                   SU047-SQLCA                  DELIMITED BY SIZE 16590000
166000                                      INTO PV-CICS-MSG-AREA       16600000
166100            PERFORM 9900-WRITE-CICS                               16610000
166200            STRING ' RCKCS291 - RET MSG -'                        16620000
166300                   SU047-CRA-RET-MSG            DELIMITED BY SIZE 16630000
166400                                      INTO PV-CICS-MSG-AREA       16640000
166500            PERFORM 9900-WRITE-CICS                               16650000
166600            MOVE '3000-CALL-ADJUST-SYST-AUDIT' TO DP013-PARAGRAPH 16660000
166700            MOVE 'AUTOMATIC ADJUSTMNTS- ' TO DP013-MESSAGE-TEXT(1)16670000
166800            MOVE DK-ORD-NBR             TO PV-ERROR-ORD-NBR       16680000
166900            MOVE DK-REC-SEQ-NBR         TO PV-ERROR-RCVR-SEQ-NBR  16690000
167000            MOVE DK-ORD-LNE-NBR         TO PV-ERROR-ORD-LNE-NBR   16700000
167100            STRING ' RCVR: '                                      16710000
167200                   PV-ERROR-ORD-NBR '-'                           16720000
167300                    PV-ERROR-RCVR-SEQ-NBR '-'                     16730000
167400                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       16740000
167500                                     INTO DP013-MESSAGE-TEXT (2)  16750000
167600             MOVE SQLCA               TO DP013-SQLCA              16760000
167700             MOVE 'SUKCS762'          TO DP013-DB2-TABLE-NAME (1) 16770000
167800             SET DP013-ROLLBACK                                   16780000
167900                 DP013-DB2-ABEND      TO TRUE                     16790000
168000             PERFORM 9999-WRITE-CICS-LOG-MSG                      16800000
168100         WHEN OTHER                                               16810000
168200            MOVE DK-ORD-NBR             TO PV-ERROR-ORD-NBR       16820000
168300            MOVE DK-REC-SEQ-NBR         TO PV-ERROR-RCVR-SEQ-NBR  16830000
168400            MOVE DK-ORD-LNE-NBR         TO PV-ERROR-ORD-LNE-NBR   16840000
168500            STRING ' RCKCS291 - CALL TO '                         16850000
168600                   SU047-MODULE-NAME                              16860000
168700                   ' PO/RCVR: '                                   16870000
168800                  PV-ERROR-ORD-NBR '-'                            16880000
168900                  PV-ERROR-RCVR-SEQ-NBR '-'                       16890000
169000                  PV-ERROR-ORD-LNE-NBR '  -  '                    16900000
169100                  SU047-SUCCESS-IND '-'                           16910000
169200                  SU047-SQLCODE                 DELIMITED BY SIZE 16920000
169300                                      INTO PV-CICS-MSG-AREA       16930000
169400            PERFORM 9900-WRITE-CICS                               16940000
169500            STRING ' RCKCS291 - SQLCA - '                         16950000
169600                   SU047-SQLCA                  DELIMITED BY SIZE 16960000
169700                                      INTO PV-CICS-MSG-AREA       16970000
169800            PERFORM 9900-WRITE-CICS                               16980000
169900            STRING ' RCKCS291 - RET MSG -'                        16990000
170000                   SU047-CRA-RET-MSG            DELIMITED BY SIZE 17000000
170100                                      INTO PV-CICS-MSG-AREA       17010000
170200            PERFORM 9900-WRITE-CICS                               17020000
170300            MOVE '3000-CALL-ADJUST-SYST-AUDIT' TO DP013-PARAGRAPH 17030000
170400            MOVE 'AUTOMATIC ADJUSTMNTS- ' TO DP013-MESSAGE-TEXT(1)17040000
170500            MOVE DK-ORD-NBR             TO PV-ERROR-ORD-NBR       17050000
170600            MOVE DK-REC-SEQ-NBR         TO PV-ERROR-RCVR-SEQ-NBR  17060000
170700            MOVE DK-ORD-LNE-NBR         TO PV-ERROR-ORD-LNE-NBR   17070000
170800            STRING ' RCVR: '                                      17080000
170900                   PV-ERROR-ORD-NBR '-'                           17090000
171000                    PV-ERROR-RCVR-SEQ-NBR '-'                     17100000
171100                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       17110000
171200                                     INTO DP013-MESSAGE-TEXT (2)  17120000
171300             MOVE SQLCA               TO DP013-SQLCA              17130000
171400             MOVE 'SUKCS762'          TO DP013-DB2-TABLE-NAME (1) 17140000
171500             SET DP013-ROLLBACK                                   17150000
171600                 DP013-DB2-ABEND      TO TRUE                     17160000
171700             PERFORM 9999-WRITE-CICS-LOG-MSG                      17170000
171800     END-EVALUATE.                                                17180000
171900                                                                  17190000
172000******************************************************************17200000
172100*    RECEVIERS THAT HAVE PRCG STAT CODE OF 'K' OR 'L' HAVE BEEN  *17210000
172200*    SUSPENDED DUE TO OPEN SYTEM AUDIT(K) OR TROUBLE(L). THESE   *17220000
172300*    RECEIVERS HAVE NOT BEEN CONFIRMED , SO CALL RCKUT125 TO     *17230000
172400*    PROCESS                                                     *17240000
172500******************************************************************17250000
172600 3010-CALL-RCKUT125-CONFIRM.                                      17260000
172700                                                                  17270000
172800     INITIALIZE RC041-FIELDS.                                     17280000
172900                                                                  17290000
173000     IF  PS-CSSL-LOGGING-YES                                      17300000
173100         MOVE '3010-CALL-RCKUT125-CONFIRM ' TO PV-PARA-NAME       17310000
173200         PERFORM 9998-BUILD-MESSAGE                               17320000
173300     END-IF.                                                      17330000
173400                                                                  17340000
173500*    PERFORM 2300-GET-TRECEIV.                                    17350000
173600     MOVE DK-ORD-NBR             TO  RC041-PO-NBR.                17360000
173700     MOVE DK-REC-SEQ-NBR         TO  RC041-REC-SEQ-NBR.           17370000
173800                                                                  17380000
173900     IF  RECEIV-PKGNG-CDE  = 'M'  OR                              17390000
174000         RECEIV-PKGNG-CDE  = 'I'                                  17400000
174100         PERFORM 2350-GET-PREPK-ID                                17410000
174200         MOVE DK-PREPK-ID  TO RC041-PREPACK-ID                    17420000
174300     END-IF.                                                      17430000
174400     MOVE DK-ORD-LNE-NBR         TO  RC041-PO-LNE-NBR             17440000
174500     MOVE  RECEIV-PKGNG-CDE      TO RC041-PKGNG-CDE.              17450000
174600                                                                  17460000
174700     MOVE RECEIV-OPER-UNT-ID     TO  RC041-OPER-UNT-ID.           17470000
174800     MOVE 'SWEEPER'              TO  RC041-USER-ID.               17480000
174900     MOVE PC-CURRENT-PGM-NAME    TO  RC041-PROGRAM-NAME.          17490000
175000     SET RC041-VERIFY-YES        TO  TRUE.                        17500000
175100                                                                  17510000
175200     MOVE LENGTH OF RC041-FIELDS    TO PV-COMMAREA-LENGTH.        17520000
175300                                                                  17530000
175400     EXEC CICS                                                    17540000
175500         LINK PROGRAM  (PC-FULLCASE-CONFIRM-PGM)                  17550000
175600              COMMAREA (RC041-FIELDS)                             17560000
175700              LENGTH   (PV-COMMAREA-LENGTH)                       17570000
175800              RESP     (PV-CICS-RESPONSE)                         17580000
175900     END-EXEC.                                                    17590000
176000                                                                  17600000
176100     EVALUATE TRUE                                                17610000
176200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 17620000
176300             IF  RC041-INVALID-SQL     OR                         17630000
176400                 RC041-DATABASE-BUSY                              17640000
176500                   INITIALIZE PV-CICS-MSG-AREA                    17650000
176600                   MOVE DK-ORD-NBR     TO PV-ERROR-ORD-NBR        17660000
176700                   MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR   17670000
176800                   MOVE DK-ORD-LNE-NBR TO PV-ERROR-ORD-LNE-NBR    17680000
176900                   STRING ' RCKCS291 -'                           17690000
177000                          ' RCVR: '                               17700000
177100                         PV-ERROR-ORD-NBR '-'                     17710000
177200                         PV-ERROR-RCVR-SEQ-NBR '-'                17720000
177300                         PV-ERROR-ORD-LNE-NBR                     17730000
177400                       ' INVALID SQL OR BUSY'  DELIMITED BY SIZE  17740000
177500                                   INTO PV-CICS-MSG-AREA          17750000
177600                   PERFORM 9990-WRITE-CICS                        17760000
177700             END-IF                                               17770000
177800         WHEN OTHER                                               17780000
177900             MOVE DK-ORD-NBR     TO PV-ERROR-ORD-NBR              17790000
178000             MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR         17800000
178100             MOVE DK-ORD-LNE-NBR TO PV-ERROR-ORD-LNE-NBR          17810000
178200             STRING ' RCKCS291 -'                                 17820000
178300                    ' RCVR: '                                     17830000
178400                   PV-ERROR-ORD-NBR '-'                           17840000
178500                   PV-ERROR-RCVR-SEQ-NBR '-'                      17850000
178600                   PV-ERROR-ORD-LNE-NBR                           17860000
178700                 ' INVALID CALL TO CONFIRMATION' DELIMITED BY SIZE17870000
178800                                 INTO PV-CICS-MSG-AREA            17880000
178900             PERFORM 9990-WRITE-CICS                              17890000
179000     END-EVALUATE.                                                17900000
179100                                                                  17910000
179200                                                                  17920000
179300******************************************************************17930000
179400*    CHECK TO DETERMINE IF THE LINE BEING PROCESSED IS BEING     *17940000
179500*    SPLIT BETWEEN P2L AND CASE OR IF THE LINE IS ALL P2L OR     *17950000
179600*    ALL CASE.                                                   *17960000
179700******************************************************************17970000
179800 3100-CHECK-FOR-SPLIT.                                            17980000
179900                                                                  17990000
180000     IF  PS-CSSL-LOGGING-YES                                      18000000
180100         MOVE '3100-CHECK-FOR-SPLIT       ' TO PV-PARA-NAME       18010000
180200         PERFORM 9998-BUILD-MESSAGE                               18020000
180300     END-IF.                                                      18030000
180400                                                                  18040000
180500     IF  DISTHD-FCSE-CNFRMN-TMST IS EQUAL TO PC-DEFAULT-DATE-1    18050000
180600     OR  DISTHD-FCSE-CNFRMN-TMST IS EQUAL TO PC-DEFAULT-DATE-2    18060000
180700         SET RC289-P2L-PROCESS TO TRUE                            18070000
180800     ELSE                                                         18080000
180900         IF  DISTHD-FCSE-CART-CNT IS GREATER THAN ZERO            18090000
181000         OR  DISTHD-INPK-CART-CNT IS GREATER THAN ZERO            18100000
181100             IF  DISTHD-P2L-CART-CNT IS GREATER THAN ZERO         18110000
181200                 SET RC289-P2L-CASE-PROCESS TO TRUE               18120000
181300             ELSE                                                 18130000
181400                 SET RC289-CASE-PROCESS TO TRUE                   18140000
181500             END-IF                                               18150000
181600         END-IF                                                   18160000
181700     END-IF.                                                      18170000
181800/                                                                 18180000
181900******************************************************************18190000
182000*    CHECK TO DETERMINE IF THE CURRENT OPER ON THE DC IS         *18200000
182100*    PROCESSING USING WMOS  (VERIFICATION FOR A WMOS DC IS       *18210000
182200*    WSKCS313)                                                    18220000
182300******************************************************************18230000
182400 3200-CHECK-WMOS-DC.                                              18240000
182500                                                                  18250000
182600     IF  PS-CSSL-LOGGING-YES                                      18260000
182700         MOVE '3200-CHECK-WMOS-DC    '  TO PV-PARA-NAME           18270000
182800         PERFORM 9998-BUILD-MESSAGE                               18280000
182900     END-IF.                                                      18290000
183000                                                                  18300000
183100     MOVE RECEIV-CURR-OPER-UNT-ID  TO KRPRPM-LOC-ID               18310000
183110                                                                  18311000
183111     EXEC SQL                                                     18311100
183112       SELECT FUNC_TXT                                            18311200
183113         INTO :KRPRPM-FUNC-TXT                                    18311300
183114         FROM TKRPRPM                                             18311400
183115        WHERE LOC_ID             =  :KRPRPM-LOC-ID                18311500
183116          AND INTFC_SYS_CDE      =  'KHL'                         18311600
183117          AND FUNC_PRC_STAT_CDE  =  'AC'                          18311700
183118          AND SYS_PRC_FUNC_CDE   =  'WMOSDC'                      18311800
183119          AND (CURRENT DATE                                       18311900
183120              BETWEEN DATE(FUNC_BEG_TMST) AND                     18312000
183121                      DATE(FUNC_END_TMST))                        18312100
183122     END-EXEC                                                     18312200
183123                                                                  18312300
183124     EVALUATE TRUE                                                18312400
183125        WHEN SQLCODE = ZERO                                       18312500
183126           MOVE KRPRPM-FUNC-TXT TO PS-WMOS-RCVR-FOUND-SW          18312600
183127        WHEN SQLCODE = +100                                       18312700
183128           SET PS-WMOS-RCVR-NO TO TRUE                            18312800
183129        WHEN SQLCODE = -904                                       18312900
183130        WHEN SQLCODE = -913                                       18313000
183131        WHEN SQLCODE = -911                                       18313100
183132           CONTINUE                                               18313200
183133                                                                  18313300
183134      WHEN OTHER                                                  18313400
183135         MOVE '3200-CHECK-WMOS-DC '                               18313500
183136                           TO DP013-PARAGRAPH                     18313600
183137         MOVE 'ERROR SELECTING DATA FOR E291 '                    18313700
183138                           TO DP013-MESSAGE-TEXT (1)              18313800
183139         MOVE SQLCA        TO DP013-SQLCA                         18313900
183140         MOVE 'TKRPRPM '   TO DP013-DB2-TABLE-NAME (1)            18314000
183141         SET DP013-NO-ROLLBACK                                    18314100
183142             DP013-DB2-ABEND  TO TRUE                             18314200
183143         PERFORM 9999-WRITE-CICS-LOG-MSG                          18314300
183144     END-EVALUATE.                                                18314400
183145                                                                  18314500
183146******************************************************************18314603
183147*    CHECK TO DETERMINE IF THE CURRENT OPER ON THE DC IS         *18314703
183148*    PROCESSING USING WMOS  (VERIFICATION FOR A WMOS DC IS       *18314803
183149*    WSKCS313)                                                    18314903
183150******************************************************************18315003
183151 3300-SEL-DISTHD-MAX-LNE.                                         18315103
183152                                                                  18315203
183153     IF  PS-CSSL-LOGGING-YES                                      18315303
183154         MOVE '3300-SEL-DISTHD-MAX-LNE' TO PV-PARA-NAME           18315403
183155         PERFORM 9998-BUILD-MESSAGE                               18315503
183156     END-IF.                                                      18315603
183157                                                                  18315703
183159                                                                  18315903
183160     EXEC SQL                                                     18316003
183161       SELECT                                                     18316103
183162             MAX(ORD_LNE_NBR)                                     18316203
183163       INTO  :DK-MAX-LNE-NBR                                      18316303
183164       FROM                                                       18316403
183165             TDISTHD                                              18316503
183166       WHERE                                                      18316603
183167             PRCG_STAT_CDE  NOT IN ('P','V','D','C')              18316703
183168         AND PREPK_LNE_PRC_CDE IN ('D','N',' ')                   18316803
183169         AND ORD_NBR       = :DISTHD-ORD-NBR                      18316903
183170         AND RCVR_SEQ_NBR  = :DISTHD-RCVR-SEQ-NBR                 18317003
183171     END-EXEC                                                     18317103
183172                                                                  18317203
183173     EVALUATE TRUE                                                18317303
183174        WHEN SQLCODE = ZERO                                       18317403
183176        WHEN SQLCODE = +100                                       18317603
183177           CONTINUE                                               18317704
183178        WHEN SQLCODE = -904                                       18317803
183179        WHEN SQLCODE = -913                                       18317903
183180        WHEN SQLCODE = -911                                       18318003
183181           CONTINUE                                               18318103
183182                                                                  18318203
183183      WHEN OTHER                                                  18318303
183184         MOVE '3300-SEL-DISTHD-MAX-LNE '                          18318404
183185                           TO DP013-PARAGRAPH                     18318503
183186         MOVE 'ERROR SELECTING DATA FOR E291 '                    18318603
183187                           TO DP013-MESSAGE-TEXT (1)              18318703
183188         MOVE SQLCA        TO DP013-SQLCA                         18318803
183189         MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)            18318904
183190         SET DP013-NO-ROLLBACK                                    18319003
183191             DP013-DB2-ABEND  TO TRUE                             18319103
183192         PERFORM 9999-WRITE-CICS-LOG-MSG                          18319203
183193     END-EVALUATE.                                                18319303
183194                                                                  18319403
183195******************************************************************18319503
183196*    START THE TRANSACTION E200 (PCKCS200) WHICH PERFORMS THE    *18319603
183197*    VERIFICATION PROCESS FOR THE SPECIFIED RECEIPT LINE ITEM.   *18319703
183198******************************************************************18319803
183199 8000-START-E200.                                                 18319903
183200                                                                  18320003
183201     IF  PS-CSSL-LOGGING-YES                                      18320103
183202         MOVE '8000-START-E200            ' TO PV-PARA-NAME       18320203
183203         PERFORM 9998-BUILD-MESSAGE                               18320303
183210     END-IF.                                                      18321003
183300                                                                  18330000
183400     MOVE DK-ORD-NBR           TO RC289-ORD-NBR.                  18340000
183500     MOVE DK-REC-SEQ-NBR       TO RC289-RCVR-SEQ-NBR.             18350000
183600     MOVE DK-ORD-LNE-NBR       TO RC289-ORD-LNE-NBR.              18360000
183700     MOVE PC-CURRENT-PGM-NAME  TO RC289-CALLING-PROGRAM.          18370000
183800     MOVE 'SWEEPER'            TO RC289-USER-ID                   18380000
183900     SET  RC289-VERIF-SWEEPER  TO TRUE.                           18390000
184000     MOVE RC040-AUTO-VE-SW     TO RC289-AUTOVE-PO-IND.            18400000
184100                                                                  18410000
184200     EXEC CICS                                                    18420000
184300          START TRANSID ('E200')                                  18430000
184400               FROM (RC289-COMMAREA-FOR-E200)                     18440000
184500     END-EXEC.                                                    18450000
184600/                                                                 18460000
184700 8005-START-W313.                                                 18470000
184800                                                                  18480000
184900     IF  PS-CSSL-LOGGING-YES                                      18490000
185000         MOVE '8005-START-W313            ' TO PV-PARA-NAME       18500000
185100         PERFORM 9998-BUILD-MESSAGE                               18510000
185110     END-IF.                                                      18511000
185120                                                                  18512000
185130     MOVE DK-ORD-NBR           TO RC289-ORD-NBR.                  18513000
185140     MOVE DK-REC-SEQ-NBR       TO RC289-RCVR-SEQ-NBR.             18514000
185150     MOVE DK-ORD-LNE-NBR       TO RC289-ORD-LNE-NBR.              18515000
185160     MOVE PC-CURRENT-PGM-NAME  TO RC289-CALLING-PROGRAM.          18516000
185170     MOVE 'SWEEPER'            TO RC289-USER-ID                   18517000
185180     SET  RC289-VERIF-SWEEPER  TO TRUE.                           18518000
185190     MOVE RC040-AUTO-VE-SW     TO RC289-AUTOVE-PO-IND.            18519000
185191                                                                  18519100
185192     EXEC CICS                                                    18519200
185193          START TRANSID ('W313')                                  18519300
185194               FROM (RC289-COMMAREA-FOR-E200)                     18519400
185195     END-EXEC.                                                    18519500
185196/                                                                 18519600
185197 9000-SYNCPOINT.                                                  18519700
185198                                                                  18519800
185199     IF  PS-CSSL-LOGGING-YES                                      18519900
185200         MOVE '9000-SYNCPOINT             ' TO PV-PARA-NAME       18520000
185300         PERFORM 9998-BUILD-MESSAGE                               18530000
185400     END-IF.                                                      18540000
185500                                                                  18550000
185600     EXEC CICS                                                    18560000
185700         SYNCPOINT                                                18570000
185800     END-EXEC.                                                    18580000
185900/                                                                 18590000
186000 9300-CHECK-LOGGING.                                              18600000
186100                                                                  18610000
186200     EXEC SQL                                                     18620000
186300         SELECT FUNC_TXT                                          18630000
186400           INTO :KRPRPM-FUNC-TXT                                  18640000
186500           FROM TKRPRPM                                           18650000
186600          WHERE SYS_PRC_FUNC_CDE  = 'RC291D'                      18660000
186700            AND LOC_ID            = 90                            18670000
186800            AND INTFC_SYS_CDE     = 'KHL'                         18680000
186900            AND FUNC_PRC_STAT_CDE = 'AC'                          18690000
187000     END-EXEC.                                                    18700000
187100                                                                  18710000
187200     EVALUATE TRUE                                                18720000
187300         WHEN SQLCODE = ZERO                                      18730000
187400              IF  KRPRPM-FUNC-TXT  =  'Y'                         18740000
187500                  SET  PS-CSSL-LOGGING-YES  TO  TRUE              18750000
187600              ELSE                                                18760000
187700                  SET  PS-CSSL-LOGGING-NO   TO  TRUE              18770000
187800              END-IF                                              18780000
187900                                                                  18790000
188000         WHEN SQLCODE = +100                                      18800000
188100              SET  PS-CSSL-LOGGING-NO   TO  TRUE                  18810000
188200                                                                  18820000
188300         WHEN SQLWARN0 NOT = SPACE                                18830000
188400         WHEN SQLCODE NOT = ZERO                                  18840000
188500            STRING ' RCVR: '                                      18850000
188600                   PV-ERROR-ORD-NBR '-'                           18860000
188700                    PV-ERROR-RCVR-SEQ-NBR '-'                     18870000
188800                    PV-ERROR-ORD-LNE-NBR  DELIMITED BY SIZE       18880000
188900                                     INTO DP013-MESSAGE-TEXT (2)  18890000
189000            STRING ' INVALID SELECT FOR LOGGING TO CSSL'          18900000
189100                                          DELIMITED BY SIZE       18910000
189200                                     INTO DP013-MESSAGE-TEXT (1)  18920000
189300             MOVE SQLCA               TO DP013-SQLCA              18930000
189400             MOVE 'TKRPRPM'          TO DP013-DB2-TABLE-NAME (1)  18940000
189500             SET DP013-ROLLBACK                                   18950000
189600                 DP013-DB2-ABEND      TO TRUE                     18960000
189700             PERFORM 9999-WRITE-CICS-LOG-MSG                      18970000
189800     END-EVALUATE.                                                18980000
189900                                                                  18990000
190000                                                                  19000000
190100******************************************************************19010000
190200*    WRITE A MESSAGE TO THE CICS LOG.                            *19020000
190300******************************************************************19030000
190400 9900-WRITE-CICS.                                                 19040000
190500     MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.      19050000
190600                                                                  19060000
190700     EXEC CICS                                                    19070000
190800         WRITEQ TD                                                19080000
190900         QUEUE ('CSSL')                                           19090000
191000         FROM (PV-CICS-MSG-AREA)                                  19100000
191100         LENGTH (PV-COMMAREA-LENGTH)                              19110000
191200         RESP (PV-CICS-RESPONSE)                                  19120000
191300     END-EXEC.                                                    19130000
191400                                                                  19140000
191500     MOVE SPACES TO PV-CICS-MSG-AREA.                             19150000
191600                                                                  19160000
191700******************************************************************19170000
191800*    WRITE A MESSAGE TO THE CICS LOG.                            *19180000
191900******************************************************************19190000
192000 9990-WRITE-CICS.                                                 19200000
192100     MOVE 120 TO PV-WRITE-LENGTH.                                 19210000
192200                                                                  19220000
192300     EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA)     19230000
192400          LENGTH(PV-WRITE-LENGTH) NOHANDLE                        19240000
192500     END-EXEC.                                                    19250000
192600                                                                  19260000
192700     MOVE SPACES TO PV-CICS-MSG-AREA.                             19270000
192800                                                                  19280000
192900******************************************************************19290000
193000*    WRITE A MESSAGE TO THE CICS LOG - FOR LOGGING               *19300000
193100******************************************************************19310000
193200 9997-WRITE-TO-CSSL.                                              19320000
193300                                                                  19330000
193400     MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.      19340000
193500                                                                  19350000
193600     EXEC CICS                                                    19360000
193700          WRITEQ TD                                               19370000
193800           QUEUE   ('CSSL')                                       19380000
193900            FROM   (PV-CICS-MSG-AREA)                             19390000
194000          LENGTH   (PV-COMMAREA-LENGTH)                           19400000
194100            RESP   (PV-CICS-RESPONSE)                             19410000
194200     END-EXEC.                                                    19420000
194300                                                                  19430000
194400                                                                  19440000
194500 9998-BUILD-MESSAGE.                                              19450000
194600      MOVE DK-ORD-NBR        TO PV-DISP-PO-NBR.                   19460000
194700      MOVE DK-REC-SEQ-NBR    TO PV-DISP-RCVR-NBR.                 19470000
194800      MOVE DK-ORD-LNE-NBR    TO PV-DISP-LINE-NBR.                 19480000
194900      STRING   ' RCKCS291 '                                       19490000
195000               PV-PARA-NAME                                       19500000
195100               ' PO = '                                           19510000
195200               PV-DISP-PO-NBR '-'                                 19520000
195300               PV-DISP-RCVR-NBR '-'                               19530000
195400               PV-DISP-LINE-NBR                                   19540000
195500               DELIMITED BY SIZE                                  19550000
195600                               INTO PV-CICS-MSG-AREA.             19560000
195700      PERFORM 9997-WRITE-TO-CSSL.                                 19570000
195800                                                                  19580000
195900************************************************************      19590000
196000*  WRITE ALL OF THE CICS ABEND INFORMATION TO THE CICS LOG *      19600000
196100*  AND RETURN CONTROL TO CICS.                             *      19610000
196200************************************************************      19620000
196300 9999-WRITE-CICS-LOG-MSG.                                         19630000
196400     MOVE PC-CURRENT-PGM-NAME  TO  DP013-PROGRAM.                 19640000
196500     MOVE DFHEIBLK             TO  DP013-DFHEIBLK.                19650000
196600                                                                  19660000
196700     INITIALIZE DP013-SRC-TASK-NUMBER                             19670000
196800                DP013-STACK.                                      19680000
196900     SET DP013-LINK-RETURN     TO TRUE.                           19690000
197000                                                                  19700000
197100     EXEC CICS                                                    19710000
197200         LINK                                                     19720000
197300             PROGRAM   (DP013-NAME)                               19730000
197400             COMMAREA  (DP013-PARAMETERS)                         19740000
197500             LENGTH    (DP013-LENGTH)                             19750000
197600     END-EXEC.                                                    19760000
197700                                                                  19770000
197800     EXEC CICS                                                    19780000
197900         RETURN                                                   19790000
198000     END-EXEC.                                                    19800000
198100*                                                                 19810000
