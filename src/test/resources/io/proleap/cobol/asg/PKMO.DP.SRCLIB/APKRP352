000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.     APKRP352.                                        00020099
000300 AUTHOR.         JEAN KURK.                                       00030099
000400*DATE-WRITTEN.   NOV 15 2021.                                     00040099
000500*DATE-COMPILED.                                                   00050099
000600****************************************************************  00060099
000700* COBOL 2                                                      *  00070099
000800*--------------------------------------------------------------*  00080099
000900* EDI REJECTION REPORT PROGRAM - DETAILS FOR SPECIFIC ERROR    *  00090099
000900* ERRORS CURRENTLY INCLUDED:                                   *  00100099
000900*   ERROR 36 - SUM EXTEN OF DET NOT = GROSS INVCD              *  00110099
001100*--------------------------------------------------------------*  00120099
002000* CHANGE LOG:                                                  *  00130099
002200* 11/15/21    BY JEAN KURK                                     *  00140099
002300*             INITIAL VERSION                 CHG0264007       *  00150099
030001*                                                              *  00160099
002200* 03/16/23    BY JEAN KURK                    CHG0285404       *  00170099
002300*             RECOMPILE FOR UPDATED COPYBOOK APRD051           *  00180099
030001*                                                              *  00190099
002200* 04/14/23    BY JEAN KURK                    CHG0285404       *  00200099
002300*             INCREASE SIZE OF WS-PCK-TABLE FROM 100 TO 500    *  00210099
030001*                                                              *  00220099
002200* 10/23/23    BY JEAN KURK                    CHG0293986       *  00230099
002300*             ADD DB2 TO ADD PACK RATIO TO REPORT              *  00240099
030001*                                                              *  00250099
ST3648* 02/19/24    BY SARVESWARAN KANNAN           CHG0301695       *  00251099
ST3648*             CHANGES MADE TO HANDLE DB2 SQLCODE -420 AND -811 *  00252099
ST3648*             ERROR FROM FETCH PREPACK RATIO QUERY.            *  00252199
ST3648*             GETTING -420 WHEN THERE IS NO PREPACK UPC FOR    *  00252299
ST3648*             A PO/INVOICE AND GETTING -811 WHEN AN UPC IS IN  *  00252399
ST3648*             MULTIPLE PREPACKS.                               *  00253099
ST3648*             NO PREPACK UPC/PACKITEM DETAILS MESSAGE WILL BE  *  00254099
ST3648*             WRITTEN IN THE REPORT IF THOSE ARE MISSING IN THE*  00254199
ST3648*             INPUT FILE FOR A PO AND INVOICE.                 *  00255099
ST3648*             CODING TAG:ST3648 TO KNOW THE CHANGES            *  00257099
030001*                                                              *  00258099
ST3648* 03/21/24    BY SARVESWARAN KANNAN           CHG0305671       *  00259099
ST3648*             CHANGES MADE TO HANDLE DB2 SQLCODE +100          *  00259199
ST3648*             IN S100-FETCH-PREPK-RATIO PARA.                  *  00259299
ST3648*             CODING TAG:ST3648 TO KNOW THE CHANGES            *  00259999
ST3648****************************************************************  00260099
012603                                                                  00270099
012604 ENVIRONMENT DIVISION.                                            00280099
012605 CONFIGURATION SECTION.                                           00290099
012606                                                                  00300099
012607 SOURCE-COMPUTER. IBM-3090.                                       00310099
012608 OBJECT-COMPUTER. IBM-3090.                                       00320099
012609                                                                  00330099
012610 INPUT-OUTPUT SECTION.                                            00340099
012620 FILE-CONTROL.                                                    00350099
012700                                                                  00360099
012800      SELECT EDI-REJ-ERRORS ASSIGN TO INP01.                      00370099
012800      SELECT EDI-REJ-FILE ASSIGN TO INP02.                        00380099
012900      SELECT EDI-REPORT ASSIGN TO RPT01.                          00390099
013200                                                                  00400099
013300 DATA DIVISION.                                                   00410099
013400 FILE SECTION.                                                    00420099
013500                                                                  00430099
013500* THIS CONTAINS THE RECORDS THAT WILL BE REPORTED ON              00440099
013600 FD  EDI-REJ-ERRORS                                               00450099
013700     RECORDING MODE IS F                                          00460099
013800     LABEL RECORDS ARE STANDARD                                   00470099
013900     BLOCK CONTAINS 0 RECORDS                                     00480099
014000     DATA RECORD IS EDI-ERROR-REC.                                00490099
014100 01  EDI-ERROR-REC               PIC X(500).                      00500099
014200                                                                  00510099
013500* THIS IS THE ENTIRE REJECT FILE FROM APKED201                    00520099
013600 FD  EDI-REJ-FILE                                                 00530099
013700     RECORDING MODE IS F                                          00540099
013800     LABEL RECORDS ARE STANDARD                                   00550099
013900     BLOCK CONTAINS 0 RECORDS                                     00560099
014000     DATA RECORD IS EDI-RECORD.                                   00570099
014100 01  EDI-RECORD                  PIC X(500).                      00580099
014200                                                                  00590099
014300 FD  EDI-REPORT                                                   00600099
014400     RECORDING MODE IS F                                          00610099
014500     LABEL RECORDS ARE STANDARD                                   00620099
014600     RECORD CONTAINS 132 CHARACTERS                               00630099
014700     BLOCK CONTAINS 0 RECORDS                                     00640099
014800     DATA RECORD IS EDI-LINE.                                     00650099
014900 01  EDI-LINE                    PIC X(132).                      00660099
015000                                                                  00670099
016700 WORKING-STORAGE SECTION.                                         00680099
016800*--------------------------------------------------------------*  00690099
016900* STANDARD HEADER 132 COLUMNS                                  *  00700099
017000*--------------------------------------------------------------*  00710099
017100     COPY DPWS132O.                                               00720099
017200                                                                  00730099
010310*----------------------------------------------------------------*00740099
010320* SQLCA FORMATTED MESSAGE AREA                                   *00750099
010330*----------------------------------------------------------------*00760099
010400     COPY DPWS004.                                                00770099
010600                                                                  00780099
010700*----------------------------------------------------------------*00790099
010800* COMMUNICATIONS AREA2 FOR DB2                                   *00800099
010900*----------------------------------------------------------------*00810099
011000     COPY SQLCA2.                                                 00820099
011010                                                                  00830099
011100*----------------------------------------------------------------*00840099
011200* DB2 AREA FOR COMMUNICATIONS                                    *00850099
011300*----------------------------------------------------------------*00860099
011400     EXEC SQL                                                     00870099
011500          INCLUDE SQLCA                                           00880099
011600     END-EXEC.                                                    00890099
011610                                                                  00900099
011620*----------------------------------------------------------------*00910099
011630* PURCHASE ITEM TABLE                                            *00920099
011640*----------------------------------------------------------------*00930099
011800     EXEC SQL                                                     00940099
011900          INCLUDE TPURITM                                         00950099
012000     END-EXEC.                                                    00960099
012100                                                                  00970099
011620*----------------------------------------------------------------*00980099
011630* PREPACK TABLE                                                  *00990099
011640*----------------------------------------------------------------*01000099
011800     EXEC SQL                                                     01010099
011900          INCLUDE TPOPRPK                                         01020099
012000     END-EXEC.                                                    01030099
012100                                                                  01040099
011620*----------------------------------------------------------------*01050099
011630* XLT_UPC - LOGISTICS UPC                                        *01060099
011640*----------------------------------------------------------------*01070099
011800     EXEC SQL                                                     01080099
011900          INCLUDE XLT00006                                        01090099
012000     END-EXEC.                                                    01100099
012100                                                                  01110099
011620*----------------------------------------------------------------*01120099
011630* XLT_SKU - LOGISTICS SKU                                        *01130099
011640*----------------------------------------------------------------*01140099
011800     EXEC SQL                                                     01150099
011900          INCLUDE XLT00003                                        01160099
012000     END-EXEC.                                                    01170099
012100                                                                  01180099
017800*--------------------------------------------------------------*  01190099
017900* EDI REJECTION INPUT FILE LAYOUT                              *  01200099
018000*--------------------------------------------------------------*  01210099
018100 01  WS-EDI-REJECT-REC.                                           01220099
018200     COPY APRD051.                                                01230099
018300                                                                  01240099
018100 01  WS-EDI-ERROR-REC.                                            01250099
018200     COPY APRD051 REPLACING 'AP051-' BY 'ERROR-'.                 01260099
018300                                                                  01270099
018500*--------------------------------------------------------------*  01280099
018600* REPORT LINES                                                 *  01290099
018700*--------------------------------------------------------------*  01300099
018800 01  DIVIDE-LINE.                                                 01310099
018900     05  FILLER                  PIC X(132)   VALUE ALL '-'.      01320099
019000                                                                  01330099
045000 01  ALLOW-HDR-LINE.                                              01340099
045100     05  FILLER                  PIC X(21)    VALUE               01350099
045200         'ALLOW/CHARGE RECORDS:'.                                 01360099
045300     05  FILLER                  PIC X(05)    VALUE SPACES.       01370099
045100     05  FILLER                  PIC X(27)    VALUE               01380099
045200         'TYPE   ALLW TYP   PERCENT  '.                           01390099
045100     05  FILLER                  PIC X(41)    VALUE               01400099
045200         '             AMOUNT             CALC AMT'.              01410099
045100     05  FILLER                  PIC X(39)    VALUE               01420099
045200         '      CALC AMT USING SUM OF PACK ITEMS'.                01430099
025000                                                                  01440099
045400 01  ALLOW-DTL-LINE.                                              01450099
045500     05  FILLER                  PIC X(26)    VALUE SPACES.       01460099
045700     05  ALLW-CHRG-TYPE          PIC X(01)    VALUE SPACES.       01470099
045800     05  FILLER                  PIC X(06)    VALUE SPACES.       01480099
046100     05  ALLW-CHRG-CD            PIC X(03)    VALUE SPACES.       01490099
046200     05  FILLER                  PIC X(09)    VALUE SPACES.       01500099
047800     05  ALLW-CHRG-PCT           PIC ZZZ.99-.                     01510099
047900     05  FILLER                  PIC X(07)    VALUE SPACES.       01520099
048000     05  ALLW-AMOUNT             PIC ZZ,ZZZ,ZZZ.99-.              01530099
047900     05  FILLER                  PIC X(07)    VALUE SPACES.       01540099
048000     05  ALLW-CALC-AMT           PIC ZZ,ZZZ,ZZZ.99-.              01550099
048400     05  FILLER                  PIC X(20)    VALUE SPACES.       01560099
048000     05  ALLW-PACK-CALC-AMT      PIC ZZ,ZZZ,ZZZ.99-.              01570099
048400     05  FILLER                  PIC X(06)    VALUE SPACES.       01580099
045000 01  ALLOW-TOTAL-LINE.                                            01590099
045100     05  FILLER                  PIC X(60)    VALUE SPACES.       01600099
048000     05  ALLW-TOT-COST           PIC Z,ZZZ,ZZZ.99-.               01610099
045100     05  FILLER                  PIC X(42)    VALUE SPACES.       01620099
048000     05  ALLW-TOT-CALC-COST      PIC Z,ZZZ,ZZZ.99-.               01630099
045100     05  FILLER                  PIC X(05)    VALUE SPACES.       01640099
048500                                                                  01650099
045400 01  SUMRY-DTL-LINE.                                              01660099
045500     05  FILLER                  PIC X(59)    VALUE               01670099
045200         'SUMMARY RECORD:'.                                       01680099
048000     05  SMRY-AMOUNT             PIC ZZ,ZZZ,ZZZ.99-.              01690099
048400     05  FILLER                  PIC X(60)    VALUE SPACES.       01700099
048500                                                                  01710099
045000 01  DETAIL-HDR-LINE.                                             01720099
045100     05  FILLER                  PIC X(30)    VALUE               01730099
045200         'DETAIL RECORDS:           TYP '.                        01740099
045100     05  FILLER                  PIC X(42)    VALUE               01750099
045200         'UPC             COUNT               AMOUNT'.            01760099
045100     05  FILLER                  PIC X(30)    VALUE               01770099
045200         '          CALC AMOUNT         '.                        01780099
045100     05  FILLER                  PIC X(31)    VALUE SPACES.       01790099
045400 01  DETAIL-DTL-LINE.                                             01800099
045500     05  FILLER                  PIC X(26)    VALUE SPACES.       01810099
045700     05  DTL-UNIT-MSR            PIC X(02)    VALUE SPACES.       01820099
045800     05  FILLER                  PIC X(02)    VALUE SPACES.       01830099
045800     05  DTL-UPC-CD              PIC X(12)    VALUE SPACES.       01840099
045800     05  FILLER                  PIC X(02)    VALUE SPACES.       01850099
047800     05  DTL-QTY                 PIC ZZZ,ZZ9.                     01860099
047900     05  FILLER                  PIC X(09)    VALUE SPACES.       01870099
048000     05  DTL-UNIT-COST           PIC Z,ZZZ,ZZZ.99-.               01880099
047900     05  FILLER                  PIC X(08)    VALUE SPACES.       01890099
048000     05  DTL-CALC-COST           PIC Z,ZZZ,ZZZ.99-.               01900099
048400     05  FILLER                  PIC X(31)    VALUE SPACES.       01910099
045000 01  DETAIL-TOT-LINE.                                             01920099
045100     05  FILLER                  PIC X(81)    VALUE SPACES.       01930099
048000     05  DTL-TOT-COST            PIC Z,ZZZ,ZZZ.99-.               01940099
045100     05  FILLER                  PIC X(39)    VALUE               01950099
045200         '   TOTAL OF DETAIL RECORDS    '.                        01960099
025000                                                                  01970099
045000 01  PACK-HDR-LINE1.                                              01980099
045100     05  FILLER                  PIC X(133)   VALUE               01990099
045200         'GENERATED PACK ITEM DETAIL RECORDS'.                    02000099
025000                                                                  02010099
045000 01  PACK-HDR-LINE2.                                              02020099
045100     05  FILLER                  PIC X(40)   VALUE                02030099
045200         '                              UPC      '.               02040099
045100     05  FILLER                  PIC X(40)   VALUE                02050099
045200         '        QTY            UNIT COST       '.               02060099
045100     05  FILLER                  PIC X(40)   VALUE                02070099
045200         '  EXTEND COST      RATIO               '.               02080099
045100     05  FILLER                  PIC X(13)   VALUE SPACES.        02090099
025000                                                                  02100099
045400 01  PACK-DTL-LINE.                                               02110099
045500     05  FILLER                  PIC X(26)    VALUE SPACES.       02120099
045700     05  PACK-TYPE               PIC X(02)    VALUE SPACES.       02130099
045800     05  FILLER                  PIC X(02)    VALUE SPACES.       02140099
045800     05  PACK-UPC-CD             PIC X(12)    VALUE SPACES.       02150099
045800     05  FILLER                  PIC X(02)    VALUE SPACES.       02160099
047800     05  PACK-QTY                PIC ZZZ,ZZ9.                     02170099
047900     05  FILLER                  PIC X(09)    VALUE SPACES.       02180099
048000     05  PACK-COST               PIC Z,ZZZ,ZZZ.99-.               02190099
047900     05  FILLER                  PIC X(08)    VALUE SPACES.       02200099
048000     05  PACK-CALC-COST          PIC Z,ZZZ,ZZZ.99-.               02210099
048400     05  FILLER                  PIC X(08)    VALUE SPACES.       02220099
048000     05  PACK-RATIO              PIC Z9.                          02230099
048400     05  FILLER                  PIC X(21)    VALUE SPACES.       02240099
045000 01  PACK-TOTAL-LINE.                                             02250099
045100     05  FILLER                  PIC X(81)    VALUE SPACES.       02260099
048000     05  PACK-TOT-COST           PIC Z,ZZZ,ZZZ.99-.               02270099
045100     05  FILLER                  PIC X(39)    VALUE               02280099
045200         '   TOTAL PACK COST     '.                               02290099
059500                                                                  02300099
045000 01  SUMMARY-TOT-LINE.                                            02310099
045100     05  SUMM-TITLE1             PIC X(40)    VALUE SPACES.       02320099
045100     05  SUMM-TITLE2             PIC X(41)    VALUE SPACES.       02330099
048000     05  SUMM-COST               PIC Z,ZZZ,ZZZ.99-.               02340099
045100     05  FILLER                  PIC X(39)    VALUE SPACES.       02350099
059500                                                                  02360099
045000 01  PGM-BLANK-LINE.                                              02370099
045100     05  FILLER                  PIC X(133)   VALUE SPACES.       02380099
059500                                                                  02390099
045000 01  PGM-TOTAL-LINE.                                              02400099
045100     05  FILLER                  PIC X(133)   VALUE               02410099
045200         'PROGRAM CALCULATES INVOICE TOTAL:'.                     02420099
059600*--------------------------------------------------------------*  02430099
059700* REPORT HEADING LINES                                         *  02440099
059800*--------------------------------------------------------------*  02450099
059900 01  HL-HEADING-LINE1.                                            02460099
060000     05  FILLER                  PIC X(50)     VALUE SPACES.      02470099
060100     05  FILLER                  PIC X(30)     VALUE              02480099
060200             ' EDI INVOICE REJECTION REPORT '.                    02490099
060300     05  FILLER                  PIC X(05)     VALUE SPACES.      02500099
060400     05  HEADER-TYPE             PIC X(25)     VALUE SPACES.      02510099
060500     05  FILLER                  PIC X(20)     VALUE SPACES.      02520099
060600                                                                  02530099
060700 01  HL-HEADING-LINE2.                                            02540099
060800     05  FILLER                  PIC X(15)     VALUE              02550099
060900         'VENDOR DUN NO: '.                                       02560099
061000     05  HL2-VENDOR-NBR          PIC ZZZZZZZZ9.                   02570099
061100     05  FILLER                  PIC X(02)     VALUE SPACES.      02580099
061200     05  HL2-ENT-ID-DESC         PIC X(25)     VALUE SPACES.      02590099
061300     05  FILLER                  PIC X(04)     VALUE SPACES.      02600099
061400     05  FILLER                  PIC X(11)     VALUE              02610099
061500         'INVOICE # '.                                            02620099
061600     05  HL2-INVOICE-NBR         PIC X(22)     VALUE SPACES.      02630099
061700     05  FILLER                  PIC X(07)     VALUE SPACES.      02640099
061800     05  FILLER                  PIC X(05)     VALUE 'PO # '.     02650099
061900     05  HL2-PO-NBR              PIC ZZZZZZZZ9.                   02660099
062000     05  FILLER                  PIC X(02)     VALUE SPACES.      02670099
062100     05  FILLER                  PIC X(06)     VALUE 'ISA # '.    02680099
062200     05  HL2-INTERCHG-CNTL-NBR   PIC ZZZZZZZZ9.                   02690099
062300                                                                  02700099
064000 01  NO-DATA-LINE.                                                02710099
064100     05  FILLER                  PIC X(44)     VALUE SPACES.      02720099
064200     05  FILLER                  PIC X(41)     VALUE              02730099
064300             ' NO REJECTION INVOICES FOR THIS RUN      '.         02740099
064400     05  FILLER                  PIC X(46)     VALUE SPACES.      02750099
064500                                                                  02751099
ST3648 01  NO-UPC-DATA-LINE.                                            02752099
ST3648     05  FILLER                  PIC X(44)     VALUE SPACES.      02753099
ST3648     05  FILLER                  PIC X(41)     VALUE              02754099
ST3648             ' NO PREPACK-UPC DATA FOR THIS INVOICE    '.         02755099
ST3648     05  FILLER                  PIC X(46)     VALUE SPACES.      02756099
ST3648                                                                  02757099
ST3648 01  NO-PACK-ITEM-LINE.                                           02759099
ST3648     05  FILLER                  PIC X(44)     VALUE SPACES.      02760099
ST3648     05  FILLER                  PIC X(41)     VALUE              02761099
ST3648             ' NO PACK-ITEM DETAILS FOR THIS INVOICE   '.         02762099
ST3648     05  FILLER                  PIC X(46)     VALUE SPACES.      02763099
ST3648                                                                  02764099
065000 01  PV-PROGRAM-VARIABLES.                                        02770099
065100     05  PV-ABEND-CODE           PIC S9(04)    VALUE ZEROES       02780099
065200                                               COMP.              02790099
065300                                                                  02800099
065400     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'APKRP352'.  02810099
065500     05  PV-LINE-COUNT           PIC S9(03)    VALUE ZEROES       02820099
065600                                               COMP-3.            02830099
066300     05  PV-LINE-LIMIT           PIC S9(03)    VALUE +60          02840099
066400                                               COMP-3.            02850099
066500     05  PV-PAGE-COUNT           PIC S9(06)    VALUE ZEROES       02860099
066600                                               COMP-3.            02870099
067400     05  PV-HOLD-PO-NBR          PIC S9(9) COMP VALUE ZERO.       02880099
067400     05  PV-HOLD-UPC-NBR         PIC X(13)      VALUE ZERO.       02890099
067400     05  PV-GROSS-INV-AMT        PIC S9(9)V99   VALUE ZERO.       02900099
067400     05  PV-CALC-AMT             PIC S9(9)V99   VALUE ZERO.       02910099
067400     05  PV-TOTAL-CALC-ALLW      PIC S9(9)V99   VALUE ZERO.       02920099
067400     05  PV-PACK-CALC-ALLW       PIC S9(9)V99   VALUE ZERO.       02930099
067400     05  PV-TOTAL-INV-AMT        PIC S9(9)V99   VALUE ZERO.       02940099
067400     05  PV-TOTAL-PACK-COST      PIC S9(9)V99   VALUE ZERO.       02950099
067400     05  PV-TOTAL-UPC-COST       PIC S9(9)V99   VALUE ZERO.       02960099
067500     05  PV-UPC-QTY              PIC ZZZ,ZZ9    VALUE ZERO.       02970099
067500     05  PV-UPC-COST             PIC Z,ZZZ,ZZ9.999    VALUE ZERO. 02980099
067500     05  PV-ALLW-PCT             PIC ZZZ.999    VALUE ZERO.       02990099
067500     05  PV-ALLW-COST            PIC ZZ,ZZZ,ZZ9.999   VALUE ZERO. 03000099
067600                                                                  03010099
067700 01  WS-PROGRAM-SWITCHES.                                         03020099
067800     05  WS-EDI-REJ-EOF-SW       PIC X(01)    VALUE 'N'.          03030099
067900         88  WS-EDI-REJ-EOF          VALUE 'Y'.                   03040099
067800     05  WS-EDI-ERR-EOF-SW       PIC X(01)    VALUE 'N'.          03050099
067900         88  WS-EDI-ERR-EOF          VALUE 'Y'.                   03060099
068800     05  WS-EDI-ERR-LINE-SWITCH  PIC X(01)    VALUE 'N'.          03070099
068900         88  EDI-ERR-LINE                     VALUE 'Y'.          03080099
069000         88  NO-EDI-ERR-LINE                  VALUE 'N'.          03090099
069100     05  WS-FIRST-ALLOW-SWITCH   PIC X(01)  VALUE 'Y'.            03100099
069200         88  EDI-FIRST-ALLW                   VALUE 'Y'.          03110099
069300         88  EDI-NOT-FIRST-ALLW               VALUE 'N'.          03120099
069100     05  WS-FIRST-DETAIL-SWITCH  PIC X(01)  VALUE 'Y'.            03130099
069200         88  EDI-FIRST-DTL                    VALUE 'Y'.          03140099
069300         88  EDI-NOT-FIRST-DTL                VALUE 'N'.          03150099
069100     05  WS-FIRST-SUMMRY-SWITCH  PIC X(01)  VALUE 'Y'.            03160099
069200         88  EDI-FIRST-SMRY                   VALUE 'Y'.          03170099
069300         88  EDI-NOT-FIRST-SMRY               VALUE 'N'.          03180099
069100     05  WS-TRAN-COMPLETED       PIC X(01)  VALUE 'N'.            03190099
069200         88  WS-TRAN-DONE                     VALUE 'Y'.          03200099
069300         88  WS-TRAN-NOT-DONE                 VALUE 'N'.          03210099
ST3648     05  WS-NO-PREPACK-UPC-SWITCH   PIC X(01) VALUE 'Y'.          03211099
ST3648         88  NO-PREPACK-UPC-FIRST             VALUE 'Y'.          03212099
ST3648         88  NO-PREPACK-UPC-NOT-FIRST         VALUE 'N'.          03213099
ST3648     05  WS-PACK-ITEM-SWITCH     PIC X(01)    VALUE 'Y'.          03214099
ST3648         88  PACK-ITEM-AVAIL                  VALUE 'Y'.          03215099
ST3648         88  PACK-ITEM-NOT-AVAIL              VALUE 'N'.          03216099
070000                                                                  03220099
070000     05  WS-PCK-ITEMS.                                            03230099
070000         10  WS-PCK-TABLE              OCCURS 500 TIMES           03240099
070000                                       INDEXED BY PCK-INDX.       03250099
070000             15  WS-PCK-UPC            PIC X(13).                 03260099
070000             15  WS-PCK-TYPE           PIC X(13).                 03270099
070000             15  WS-PCK-QTY            PIC 9(06).                 03280099
070000             15  WS-PCK-COST           PIC 9(07)V999.             03290099
070000             15  WS-PCK-CALC-COST      PIC 9(07)V999.             03300099
070000             15  WS-PCK-RATIO          PIC 9(4).                  03310099
070000                                                                  03320099
070000     05  WS-ALLW-ITEMS.                                           03330099
070000         10  WS-ALLW-TBL               OCCURS 100 TIMES           03340099
070000                                       INDEXED BY ALLW-INDX.      03350099
070000             15  WS-ALLW-TYPE          PIC X(01).                 03360099
070000             15  WS-ALLW-CODE          PIC X(03).                 03370099
070000             15  WS-ALLW-PCT           PIC 9(03)V99.              03380099
070000             15  WS-ALLW-AMT           PIC 9(08)V99.              03390099
070000                                                                  03400099
070100 01  REPORT-TYPE-CONTROL         PIC X(01)     VALUE SPACE.       03410099
070200                                                                  03420099
070300 01  SD-SYSTEM-DATE.                                              03430099
070400     05  SD-SYSTEM-YEAR          PIC 9(02)     VALUE ZEROES.      03440099
070500     05  SD-SYSTEM-MONTH         PIC 9(02)     VALUE ZEROES.      03450099
070600     05  SD-SYSTEM-DAY           PIC 9(02)     VALUE ZEROES.      03460099
070700                                                                  03470099
070800 01  ST-SYSTEM-TIME.                                              03480099
070900     05  ST-SYSTEM-HOUR          PIC 9(02)     VALUE ZEROES.      03490099
071000     05  ST-SYSTEM-MINUTE        PIC 9(02)     VALUE ZEROES.      03500099
071100     05  FILLER                  PIC X(04)     VALUE SPACES.      03510099
071200                                                                  03520099
009000                                                                  03530099
059900 01  ABEND-AREAS.                                                 03540099
060000     05  AA-ABEND-LIT          PIC  X(40)  VALUE                  03550099
060100             '*****       ABEND'.                                 03560099
060200     05  AA-PROGRAM-LIT        PIC  X(40)  VALUE                  03570099
060300             '*****   PROGRAM: APKRP148'.                         03580099
060400     05  AA-PARAGRAPH-LIT.                                        03590099
060500         10  FILLER            PIC  X(17)  VALUE                  03600099
060600             '***** PARAGRAPH: '.                                 03610099
060700         10  AA-PARAGRAPH-NAME PIC  X(35)  VALUE SPACES.          03620099
060718                                                                  03630099
060719     05  AA-MESSAGE-LINE-1.                                       03640099
060720         10  FILLER            PIC  X(06)   VALUE '*****'.        03650099
060730         10  AA-MESSAGE-1      PIC  X(80)   VALUE SPACES.         03660099
060740     05  AA-MESSAGE-LINE-2.                                       03670099
060750         10  FILLER            PIC  X(06)   VALUE '*****'.        03680099
060760         10  AA-MESSAGE-2      PIC  X(80)   VALUE SPACES.         03690099
009000                                                                  03700099
027000*----------------------------------------------------------------*03710099
027100* DB2 ABEND AREA                                                 *03720099
027110*----------------------------------------------------------------*03730099
027120 01  ABEND-CODE                  PIC S9(4) COMP SYNC VALUE ZERO.  03740099
027150     88 AC-EMPTY-FILE                      VALUE +4005.           03750099
027160     88 AC-DB2-ERROR                       VALUE +4013.           03760099
008900     88 AC-TABLE-OVERFLOW                  VALUE +4004.           03770099
027170                                                                  03780099
027180 01  WS-ABEND-FILEDS.                                             03790099
ST3648     05  WS-ABEND-PROGRAM        PIC X(8)  VALUE 'APKRP352'.      03800099
027191     05  WS-ABEND-PARAGRAPH      PIC X(50) VALUE SPACES.          03810099
027192     05  WS-ABEND-OPERATION      PIC X(50) VALUE SPACES.          03820099
027193     05  WS-ABEND-STRUCTURE-1    PIC X(8)  VALUE SPACES.          03830099
027194     05  WS-ABEND-STRUCTURE-2    PIC X(8)  VALUE SPACES.          03840099
027200                                                                  03850099
009000                                                                  03860099
071800*------------------------*                                        03870099
071900 PROCEDURE DIVISION.                                              03880099
072000*------------------------*                                        03890099
072100 A000-MAIN-DRIVER.                                                03900099
072200                                                                  03910099
072300*--------------------------------------------------------------*  03920099
072400* THIS MODULE CONTROLS THE OVERALL FLOW OF THE PROGRAM THROUGH *  03930099
072500* TO ITS END.                                                  *  03940099
072600*--------------------------------------------------------------*  03950099
072700                                                                  03960099
072800     OPEN INPUT  EDI-REJ-ERRORS                                   03970099
072800                 EDI-REJ-FILE                                     03980099
072900          OUTPUT EDI-REPORT.                                      03990099
073200                                                                  04000099
073300     PERFORM H000-HOUSEKEEPING.                                   04010099
073400     IF NOT WS-EDI-ERR-EOF                                        04020099
073500        PERFORM B000-PROCESS                                      04030099
073600             UNTIL WS-EDI-ERR-EOF                                 04040099
073600                OR WS-EDI-REJ-EOF                                 04050099
108500        IF WS-TRAN-NOT-DONE                                       04060099
073800            PERFORM P100-FINISH-ERROR                             04070099
073800        END-IF                                                    04080099
073700     END-IF.                                                      04090099
073700                                                                  04100099
073800     PERFORM Z900-END-OF-JOB.                                     04110099
073900     STOP RUN.                                                    04120099
074000                                                                  04130099
074100*--------------------------------------------------------------*  04140099
074200* PROCESS THE EDI TRANSMISSION REJECTED INVOICES               *  04150099
074300*--------------------------------------------------------------*  04160099
074400 B000-PROCESS.                                                    04170099
074500                                                                  04180099
074600     IF  AP051-KOHLS-PO-NBR = ERROR-KOHLS-PO-NBR                  04190099
074600     AND AP051-VENDOR-INVOICE-NBR = ERROR-VENDOR-INVOICE-NBR      04200099
075900         EVALUATE AP051-RECORD-TYPE-IND                           04210099
076800            WHEN '05'                                             04220099
076900                 PERFORM C400-TYPE5                               04230099
077000            WHEN '06'                                             04240099
077100                 PERFORM C500-TYPE6                               04250099
077200            WHEN '07'                                             04260099
077300                 PERFORM C600-TYPE7                               04270099
077700            WHEN OTHER                                            04280099
077700                 CONTINUE                                         04290099
077900         END-EVALUATE                                             04300099
074600         PERFORM R101-READ-EDI-REJECT                             04310099
074600     ELSE                                                         04320099
074600        IF (AP051-KOHLS-PO-NBR < ERROR-KOHLS-PO-NBR               04330099
074600         OR (AP051-KOHLS-PO-NBR = ERROR-KOHLS-PO-NBR AND          04340099
074600             AP051-VENDOR-INVOICE-NBR <                           04350099
074600                                     ERROR-VENDOR-INVOICE-NBR))   04360099
074600            PERFORM R101-READ-EDI-REJECT                          04370099
074600        ELSE                                                      04380099
074600           IF (AP051-KOHLS-PO-NBR > ERROR-KOHLS-PO-NBR            04390099
074600            OR (AP051-KOHLS-PO-NBR = ERROR-KOHLS-PO-NBR AND       04400099
074600                AP051-VENDOR-INVOICE-NBR >                        04410099
074600                                     ERROR-VENDOR-INVOICE-NBR))   04420099
ST3648               PERFORM C700-DETAIL-TOTAL                          04421099
074600               PERFORM P100-FINISH-ERROR                          04430099
074600               PERFORM R100-READ-EDI-ERROR                        04440099
074600           END-IF                                                 04450099
074600        END-IF                                                    04460099
074600     END-IF.                                                      04470099
074600                                                                  04480099
079100                                                                  04490099
097600*--------------------------------------------------------------*  04500099
097700* PROCESS THE ALLW/CHRG RECORD                                 *  04510099
097800*--------------------------------------------------------------*  04520099
097900 C400-TYPE5.                                                      04530099
098000                                                                  04600099
098001     MOVE AP051-ALLW-CHG-TYPE      TO WS-ALLW-TYPE (ALLW-INDX).   04610099
098001     MOVE AP051-ALLW-CHRG-CODE     TO WS-ALLW-CODE (ALLW-INDX).   04620099
098002     MOVE AP051-ALLW-CHRG-PCT      TO PV-ALLW-PCT.                04630099
098001     MOVE PV-ALLW-PCT              TO WS-ALLW-PCT (ALLW-INDX).    04640099
098003     MOVE AP051-ALLW-CHRG-TOTAL    TO PV-ALLW-COST.               04650099
098001     MOVE PV-ALLW-COST             TO WS-ALLW-AMT (ALLW-INDX).    04660099
098001     SET ALLW-INDX                 UP BY 1.                       04670099
098001     IF ALLW-INDX > 100                                           04680099
134100        DISPLAY '********************************* *'             04690099
134200        DISPLAY '*   ALLW TABLE TOO SMALL          *'             04700099
134300        DISPLAY '*   PROGRAM ** = APKRP352         *'             04710099
134400        DISPLAY '*   PARAGRAPH  = C400-TYPE5       *'             04720099
134500        DISPLAY '***********************************'             04730099
101900        MOVE 'C400-TYPE5'           TO AA-PARAGRAPH-NAME          04740099
102100        MOVE 'ALLW TABLE TOO SMALL' TO AA-MESSAGE-1               04750099
102100        SET AC-TABLE-OVERFLOW       TO TRUE                       04760099
102500        PERFORM Z999-ABEND                                        04770099
108300     END-IF.                                                      04780099
109300                                                                  04790099
109400*--------------------------------------------------------------*  04800099
109500* PROCESS THE SUMMARY RECORD                                   *  04810099
109600*--------------------------------------------------------------*  04820099
109700 C500-TYPE6.                                                      04830099
109800                                                                  04840099
098000     IF EDI-FIRST-SMRY                                            04850099
108500         IF PV-TOTAL-INV-AMT NOT = ZERO                           04860099
108500             MOVE PV-TOTAL-INV-AMT  TO DTL-TOT-COST               04870099
108500             WRITE EDI-LINE FROM DETAIL-TOT-LINE                  04880099
108500             WRITE EDI-LINE FROM PGM-BLANK-LINE                   04890099
108500             ADD 2                  TO PV-LINE-COUNT              04900099
098000             MOVE PV-TOTAL-INV-AMT                                04910099
098000                                    TO PV-GROSS-INV-AMT           04920099
108500         END-IF                                                   04930099
098000         SET EDI-NOT-FIRST-SMRY     TO TRUE                       04940099
098000     END-IF.                                                      04950099
098000                                                                  04960099
098000     MOVE AP051-GROSS-INVOICE-AMT   TO SMRY-AMOUNT.               04970099
108500     WRITE EDI-LINE FROM PGM-BLANK-LINE.                          04980099
108500     WRITE EDI-LINE FROM SUMRY-DTL-LINE.                          04990099
108500     WRITE EDI-LINE FROM PGM-BLANK-LINE.                          05000099
108000     ADD 2 TO PV-LINE-COUNT.                                      05010099
098000                                                                  05020099
108100     IF PV-LINE-COUNT >= PV-LINE-LIMIT                            05030099
108200        PERFORM W200-HEADING-ROUTINE                              05040099
108300     END-IF.                                                      05050099
109300                                                                  05060099
113300*--------------------------------------------------------------*  05070099
113400* PROCESS THE ITEM DETAIL RECORD                               *  05080099
113500*--------------------------------------------------------------*  05090099
113600 C600-TYPE7.                                                      05100099
113700                                                                  05110099
098000     IF EDI-FIRST-DTL                                             05120099
108500         WRITE EDI-LINE FROM DETAIL-HDR-LINE                      05130099
098000         SET EDI-NOT-FIRST-DTL          TO TRUE                   05140099
108000         ADD 1                          TO PV-LINE-COUNT          05150099
098000     END-IF.                                                      05160099
098000                                                                  05170099
098000     EVALUATE TRUE                                                05180099
098000       WHEN AP051-IT1-MSR-PK-HDR                                  05190099
098000       WHEN AP051-IT1-MSR-EACH                                    05200099
098000         MOVE AP051-IT1-UNIT-MEASURE    TO DTL-UNIT-MSR           05210099
098000         MOVE AP051-UPC-CODE            TO DTL-UPC-CD             05220099
098000         MOVE AP051-QUANTITY-INVOICED   TO DTL-QTY                05230099
098000         MOVE AP051-WHOLSALE-UNIT-COST  TO DTL-UNIT-COST          05240099
098000         COMPUTE PV-CALC-AMT = AP051-QUANTITY-INVOICED *          05250099
098000                               AP051-WHOLSALE-UNIT-COST           05260099
098000         MOVE PV-CALC-AMT               TO DTL-CALC-COST          05270099
098000         ADD PV-CALC-AMT                TO PV-TOTAL-INV-AMT       05280099
ST3648       IF   AP051-UPC-CODE NOT = SPACES                           05281099
108500         WRITE EDI-LINE FROM DETAIL-DTL-LINE                      05290099
108000         ADD 1 TO PV-LINE-COUNT                                   05300099
098000                                                                  05310099
108100         IF PV-LINE-COUNT >= PV-LINE-LIMIT                        05320099
108200            PERFORM W200-HEADING-ROUTINE                          05330099
108300         END-IF                                                   05340099
ST3648       ELSE                                                       05341099
ST3648            IF NO-PREPACK-UPC-FIRST                               05342099
ST3648               WRITE EDI-LINE FROM PGM-BLANK-LINE                 05343099
ST3648               WRITE EDI-LINE FROM NO-UPC-DATA-LINE               05344099
ST3648               WRITE EDI-LINE FROM PGM-BLANK-LINE                 05345099
ST3648               SET NO-PREPACK-UPC-NOT-FIRST TO TRUE               05346099
ST3648            END-IF                                                05347099
ST3648       END-IF                                                     05350099
098000                                                                  05351099
098000       WHEN AP051-IT1-MSR-PK-ITEM                                 05360099
098001         MOVE AP051-EAN-UPC            TO WS-PCK-UPC (PCK-INDX)   05370099
098001         MOVE AP051-IT1-UNIT-MEASURE   TO WS-PCK-TYPE (PCK-INDX)  05380099
098002         MOVE AP051-QUANTITY-INVOICED  TO PV-UPC-QTY              05390099
098001         MOVE PV-UPC-QTY               TO WS-PCK-QTY (PCK-INDX)   05400099
098003         MOVE AP051-WHOLSALE-UNIT-COST TO PV-UPC-COST             05410099
098001         MOVE PV-UPC-COST              TO WS-PCK-COST (PCK-INDX)  05420099
098000         COMPUTE PV-CALC-AMT = WS-PCK-QTY (PCK-INDX) *            05430099
098000                               WS-PCK-COST (PCK-INDX)             05440099
108500         MOVE PV-CALC-AMT         TO WS-PCK-CALC-COST (PCK-INDX)  05450099
108500         ADD PV-CALC-AMT               TO PV-TOTAL-PACK-COST      05460099
098001         MOVE AP051-EAN-UPC            TO PV-HOLD-UPC-NBR         05470099
ST3648         IF   AP051-EAN-UPC NOT = SPACES                          05471099
108500         PERFORM S100-FETCH-PREPK-RATIO                           05480099
108500         MOVE PURITM-PREPK-RATO-QTY    TO WS-PCK-RATIO (PCK-INDX) 05490099
ST3648         ELSE                                                     05490199
ST3648              SET PACK-ITEM-NOT-AVAIL  TO TRUE                    05490299
ST3648         END-IF                                                   05491099
098001         SET PCK-INDX                  UP BY 1                    05500099
098001         IF PCK-INDX > 500                                        05510099
134100            DISPLAY '********************************* *'         05520099
134200            DISPLAY '*   PACK TABLE TOO SMALL          *'         05530099
134300            DISPLAY '*   PROGRAM ** = APKRP352         *'         05540099
134400            DISPLAY '*   PARAGRAPH  = C600-TYPE7       *'         05550099
134500            DISPLAY '***********************************'         05560099
101900            MOVE 'C600-TYPE7'           TO AA-PARAGRAPH-NAME      05570099
102100            MOVE 'PACK TABLE TOO SMALL' TO AA-MESSAGE-1           05580099
102100            SET AC-TABLE-OVERFLOW       TO TRUE                   05590099
102500            PERFORM Z999-ABEND                                    05600099
098001         END-IF                                                   05610099
108300     END-EVALUATE.                                                05620099
098000                                                                  05630099
ST3648*--------------------------------------------------------------*  05632099
ST3648* PROCESS THE TOTAL OF DETAIL RECORDS                         *   05633099
ST3648*--------------------------------------------------------------*  05634099
ST3648 C700-DETAIL-TOTAL.                                               05635099
ST3648                                                                  05636099
ST3648         IF PV-TOTAL-INV-AMT NOT = ZERO                           05638099
ST3648             MOVE PV-TOTAL-INV-AMT  TO DTL-TOT-COST               05639099
ST3648             WRITE EDI-LINE FROM DETAIL-TOT-LINE                  05639199
ST3648             WRITE EDI-LINE FROM PGM-BLANK-LINE                   05639299
ST3648             ADD 2                  TO PV-LINE-COUNT              05639399
ST3648             MOVE PV-TOTAL-INV-AMT                                05639499
ST3648                                    TO PV-GROSS-INV-AMT           05639599
ST3648         END-IF                                                   05639699
ST3648         SET EDI-NOT-FIRST-SMRY     TO TRUE.                      05639799
ST3648                                                                  05640999
129800*--------------------------------------------------------------*  05641099
129900* PERFORM ALL DATE ROUTINES, FILE OPENS, ETC                   *  05650099
130000*--------------------------------------------------------------*  05660099
130100 H000-HOUSEKEEPING.                                               05670099
130200                                                                  05680099
130300     ACCEPT SD-SYSTEM-DATE FROM DATE.                             05690099
130400     ACCEPT ST-SYSTEM-TIME FROM TIME.                             05700099
130500                                                                  05710099
130600     ACCEPT REPORT-TYPE-CONTROL.                                  05720099
130700     EVALUATE REPORT-TYPE-CONTROL                                 05730099
130800        WHEN 'T'                                                  05740099
130900          MOVE '     EDI TEST DATA       ' TO HEADER-TYPE         05750099
131200        WHEN 'P'                                                  05760099
131300          MOVE '  EDI PRODUCTION DATA    ' TO HEADER-TYPE         05770099
131600        WHEN 'A'                                                  05780099
131700          MOVE ' EDI PRE-PRODUCTION DATA ' TO HEADER-TYPE         05790099
132000        WHEN OTHER                                                05800099
132100          MOVE '   DATA TYPE UNKNOWN     ' TO HEADER-TYPE         05810099
132400     END-EVALUATE.                                                05820099
132500                                                                  05830099
132600     DISPLAY 'TYPE OF REPORT = ' REPORT-TYPE-CONTROL.             05840099
132700                                                                  05850099
132800     MOVE SD-SYSTEM-YEAR TO DP132O-RUN-YEAR.                      05860099
132900     MOVE SD-SYSTEM-MONTH TO DP132O-RUN-MONTH.                    05870099
133000     MOVE SD-SYSTEM-DAY TO DP132O-RUN-DAY.                        05880099
133100                                                                  05890099
133200     MOVE ST-SYSTEM-HOUR TO DP132O-RUN-HOUR.                      05900099
133300     MOVE ST-SYSTEM-MINUTE TO DP132O-RUN-MINUTE.                  05910099
133400                                                                  05920099
133500     MOVE PV-PROGRAM-NAME TO DP132O-PROGRAM-NAME.                 05930099
133600                                                                  05940099
133900     PERFORM R100-READ-EDI-ERROR.                                 05950099
134000     IF WS-EDI-ERR-EOF                                            05960099
134100        DISPLAY '********************************* *'             05970099
134200        DISPLAY '*   EMPTY EDI REJECTION FILE      *'             05980099
134300        DISPLAY '*   PROGRAM ** = APKRP352         *'             05990099
134400        DISPLAY '*   PARAGRAPH  = H000-HOUSEKEEPING*'             06000099
134500        DISPLAY '***********************************'             06010099
134600        MOVE ZEROS                     TO HL2-VENDOR-NBR          06020099
134700                                          HL2-PO-NBR              06030099
134800                                          HL2-INTERCHG-CNTL-NBR   06040099
134900        MOVE SPACES                    TO HL2-INVOICE-NBR         06050099
135000                                          HL2-ENT-ID-DESC         06060099
135100        PERFORM W200-HEADING-ROUTINE                              06070099
135200        WRITE EDI-LINE FROM NO-DATA-LINE                          06080099
136000     ELSE                                                         06090099
133900        PERFORM R101-READ-EDI-REJECT                              06100099
133900            UNTIL (ERROR-KOHLS-PO-NBR = AP051-KOHLS-PO-NBR        06110099
133900              AND  ERROR-VENDOR-INVOICE-NBR =                     06120099
133900                                       AP051-VENDOR-INVOICE-NBR)  06130099
133900               OR WS-EDI-REJ-EOF                                  06140099
134000        IF WS-EDI-REJ-EOF                                         06150099
134100            DISPLAY '********************************* *'         06160099
134200            DISPLAY '*   INVALID EDI REJECTION FILE    *'         06170099
134300            DISPLAY '*   PROGRAM ** = APKRP352         *'         06180099
134400            DISPLAY '*   PARAGRAPH  = H000-HOUSEKEEPING*'         06190099
134500            DISPLAY '***********************************'         06200099
101900            MOVE 'H000-HOUSEKEEPING'    TO AA-PARAGRAPH-NAME      06210099
102100            MOVE 'MISSING/INVALID ERROR FILE'                     06220099
102100                                        TO AA-MESSAGE-1           06230099
102100            SET AC-EMPTY-FILE           TO TRUE                   06240099
102500            PERFORM Z999-ABEND                                    06250099
102500        END-IF.                                                   06260099
137100                                                                  06270099
137200*--------------------------------------------------------------*  06280099
137300* FINISH PROCESSING THE ERROR RECORD                           *  06290099
137400*--------------------------------------------------------------*  06300099
137500 P100-FINISH-ERROR.                                               06310099
108500                                                                  06320099
025000     PERFORM VARYING ALLW-INDX FROM 1 BY 1                        06330099
025000         UNTIL ALLW-INDX > 100 OR WS-ALLW-TYPE(ALLW-INDX) = SPACES06340099
025000         IF WS-ALLW-TYPE (ALLW-INDX) NOT = SPACES                 06350099
ST3648             IF EDI-FIRST-ALLW                                    06351099
ST3648                WRITE EDI-LINE FROM ALLOW-HDR-LINE                06352099
ST3648                SET EDI-NOT-FIRST-ALLW     TO TRUE                06353099
ST3648                ADD 1                      TO PV-LINE-COUNT       06354099
ST3648             END-IF                                               06355099
108500             MOVE WS-ALLW-TYPE (ALLW-INDX) TO ALLW-CHRG-TYPE      06360099
108500             MOVE WS-ALLW-CODE (ALLW-INDX) TO ALLW-CHRG-CD        06370099
108500             MOVE WS-ALLW-PCT (ALLW-INDX)  TO ALLW-CHRG-PCT       06380099
108500             MOVE WS-ALLW-AMT (ALLW-INDX)  TO ALLW-AMOUNT         06390099
098000             IF WS-ALLW-PCT (ALLW-INDX) = 0                       06400099
098000                 MOVE WS-ALLW-AMT (ALLW-INDX) TO PV-CALC-AMT      06410099
098000             ELSE                                                 06420099
098000                 COMPUTE PV-CALC-AMT = PV-GROSS-INV-AMT *         06430099
098000                               WS-ALLW-PCT (ALLW-INDX) / 100      06440099
098000             END-IF                                               06450099
108500             MOVE PV-CALC-AMT            TO ALLW-CALC-AMT         06460099
108500             ADD PV-CALC-AMT             TO PV-TOTAL-CALC-ALLW    06470099
108500             IF PV-TOTAL-PACK-COST > 0                            06480099
098000                 COMPUTE PV-CALC-AMT ROUNDED =                    06490099
098000                           PV-TOTAL-PACK-COST *                   06500099
098000                           WS-ALLW-PCT (ALLW-INDX) / 100          06510099
108500                 MOVE PV-CALC-AMT        TO ALLW-PACK-CALC-AMT    06520099
108500                 ADD PV-CALC-AMT         TO PV-PACK-CALC-ALLW     06530099
108500             ELSE                                                 06540099
108500                 MOVE 0                  TO ALLW-PACK-CALC-AMT    06550099
108500             END-IF                                               06560099
108500             WRITE EDI-LINE FROM ALLOW-DTL-LINE                   06570099
108500             ADD 1                       TO PV-LINE-COUNT         06580099
025000         END-IF                                                   06590099
025000     END-PERFORM.                                                 06600099
098000                                                                  06610099
108100     IF PV-LINE-COUNT >= PV-LINE-LIMIT                            06620099
108200        PERFORM W200-HEADING-ROUTINE                              06630099
108300     END-IF.                                                      06640099
109300                                                                  06650099
108500*    PRINT ALLOWANCE TOTAL LINE                                   06660099
108500     IF PV-TOTAL-CALC-ALLW > 0                                    06670099
108500         MOVE PV-TOTAL-CALC-ALLW     TO ALLW-TOT-COST             06680099
108500         MOVE PV-PACK-CALC-ALLW      TO ALLW-TOT-CALC-COST        06690099
108500         WRITE EDI-LINE FROM ALLOW-TOTAL-LINE                     06700099
108500         WRITE EDI-LINE FROM PGM-BLANK-LINE                       06710099
108500         ADD 2                       TO PV-LINE-COUNT             06720099
137600     END-IF.                                                      06730099
137600                                                                  06740099
108500*    PRINT SUMMARY TOTAL LINES                                    06750099
108500     MOVE 'TOTAL OF DETAILS MINUS ALLOWANCES SHOULD'              06760099
108500                                 TO SUMM-TITLE1.                  06770099
108500     MOVE ' EQUAL SUMMARY TOTAL'                                  06780099
108500                                 TO SUMM-TITLE2.                  06790099
108500     MOVE PV-GROSS-INV-AMT       TO SUMM-COST.                    06800099
108500     WRITE EDI-LINE FROM SUMMARY-TOT-LINE.                        06810099
108500     ADD 1                       TO PV-LINE-COUNT.                06820099
108500                                                                  06830099
108500     MOVE SPACES                 TO SUMM-TITLE1.                  06840099
108500     MOVE SPACES                 TO SUMM-TITLE2.                  06850099
108500     MOVE PV-TOTAL-CALC-ALLW     TO SUMM-COST.                    06860099
108500     WRITE EDI-LINE FROM SUMMARY-TOT-LINE.                        06870099
108500     ADD 1                       TO PV-LINE-COUNT.                06880099
108500                                                                  06890099
108500     COMPUTE PV-CALC-AMT = PV-GROSS-INV-AMT -                     06900099
108500                           PV-TOTAL-CALC-ALLW.                    06910099
108500     MOVE SPACES                 TO SUMM-TITLE1.                  06920099
108500     MOVE SPACES                 TO SUMM-TITLE2.                  06930099
108500     MOVE PV-CALC-AMT            TO SUMM-COST.                    06940099
108500     WRITE EDI-LINE FROM SUMMARY-TOT-LINE.                        06950099
108500     ADD 1                       TO PV-LINE-COUNT.                06960099
137600                                                                  06970099
108500     WRITE EDI-LINE FROM PGM-BLANK-LINE.                          06980099
108500     ADD 1                       TO PV-LINE-COUNT.                06990099
137600                                                                  07000099
108500*    PRINT PACK ITEM DETAIL                                       07010099
025000     IF PV-TOTAL-PACK-COST > 0                                    07020099
108500         WRITE EDI-LINE FROM PACK-HDR-LINE1                       07030099
108500         WRITE EDI-LINE FROM PACK-HDR-LINE2                       07040099
108500         ADD 2                       TO PV-LINE-COUNT             07050099
025000                                                                  07060099
025000         PERFORM VARYING PCK-INDX FROM 1 BY 1                     07070099
025000             UNTIL PCK-INDX > 500 OR                              07080099
025000                   WS-PCK-UPC (PCK-INDX) = SPACES                 07090099
025000             IF WS-PCK-UPC (PCK-INDX) NOT = SPACES                07100099
108500                 MOVE WS-PCK-TYPE (PCK-INDX) TO PACK-TYPE         07110099
108500                 MOVE WS-PCK-UPC (PCK-INDX)  TO PACK-UPC-CD       07120099
108500                 MOVE WS-PCK-QTY (PCK-INDX)  TO PACK-QTY          07130099
108500                 MOVE WS-PCK-COST (PCK-INDX) TO PACK-COST         07140099
108500                 MOVE WS-PCK-CALC-COST (PCK-INDX)                 07150099
108500                                         TO PACK-CALC-COST        07160099
108500                 MOVE WS-PCK-RATIO (PCK-INDX)                     07170099
108500                                         TO PACK-RATIO            07180099
108500                 WRITE EDI-LINE FROM PACK-DTL-LINE                07190099
108500                 ADD 1                       TO PV-LINE-COUNT     07200099
025000             END-IF                                               07210099
025000         END-PERFORM                                              07220099
025000                                                                  07230099
025000         IF PACK-ITEM-NOT-AVAIL                                   07231099
ST3648                 WRITE EDI-LINE FROM PGM-BLANK-LINE               07231199
ST3648                 WRITE EDI-LINE FROM NO-PACK-ITEM-LINE            07231299
ST3648                 WRITE EDI-LINE FROM PGM-BLANK-LINE               07231399
ST3648         END-IF                                                   07232099
025000                                                                  07233099
025000         MOVE PV-TOTAL-PACK-COST TO PACK-TOT-COST                 07240099
108500         WRITE EDI-LINE FROM PACK-TOTAL-LINE                      07250099
108500         ADD 1                   TO PV-LINE-COUNT                 07260099
059500                                                                  07270099
108500*    PRINT PROGRAM TOTAL LINE                                     07280099
108500         WRITE EDI-LINE FROM PGM-BLANK-LINE                       07290099
108500         WRITE EDI-LINE FROM PGM-TOTAL-LINE                       07300099
108500         ADD 2                   TO PV-LINE-COUNT                 07310099
025000                                                                  07320099
108500         MOVE '          SUM OF DETAIL USING PACK ITEMS'          07330099
108500                                 TO SUMM-TITLE1                   07340099
108500         MOVE SPACES             TO SUMM-TITLE2                   07350099
108500         MOVE PV-TOTAL-PACK-COST TO SUMM-COST                     07360099
108500         WRITE EDI-LINE FROM SUMMARY-TOT-LINE                     07370099
108500         ADD 1                   TO PV-LINE-COUNT                 07380099
108500                                                                  07390099
108500         MOVE '          SUM OF ALLOWANCES USING SUMMED'          07400099
108500                                 TO SUMM-TITLE1                   07410099
108500         MOVE ' PACK ITEMS'      TO SUMM-TITLE2                   07420099
108500         MOVE PV-PACK-CALC-ALLW  TO SUMM-COST                     07430099
108500         WRITE EDI-LINE FROM SUMMARY-TOT-LINE                     07440099
108500         ADD 1                   TO PV-LINE-COUNT                 07450099
108500                                                                  07460099
108500         COMPUTE PV-CALC-AMT = PV-TOTAL-PACK-COST -               07470099
108500                               PV-PACK-CALC-ALLW                  07480099
108500         MOVE SPACES             TO SUMM-TITLE1                   07490099
108500         MOVE SPACES             TO SUMM-TITLE2                   07500099
108500         MOVE PV-CALC-AMT        TO SUMM-COST                     07510099
108500         WRITE EDI-LINE FROM SUMMARY-TOT-LINE                     07520099
108500         ADD 1                   TO PV-LINE-COUNT                 07530099
108500     END-IF.                                                      07540099
108500                                                                  07550099
108500     SET WS-TRAN-DONE            TO TRUE.                         07560099
108500                                                                  07570099
137200*--------------------------------------------------------------*  07580099
137300* READ THE FILE OF JUST THE ERROR RECORDS TO BE PRINTED        *  07590099
137400*--------------------------------------------------------------*  07600099
137500 R100-READ-EDI-ERROR.                                             07610099
137600                                                                  07620099
137700     READ EDI-REJ-ERRORS INTO WS-EDI-ERROR-REC                    07630099
137800         AT END                                                   07640099
137900             SET WS-EDI-ERR-EOF  TO TRUE                          07650099
137800         NOT AT END                                               07660099
136100             MOVE ERROR-SORT-VENDOR-NBR   TO HL2-VENDOR-NBR       07670099
136200             MOVE ERROR-SORT-INVOICE-NBR  TO HL2-INVOICE-NBR      07680099
136300             MOVE ERROR-KOHLS-PO-NBR      TO HL2-PO-NBR           07690099
136300             MOVE ERROR-KOHLS-PO-NBR      TO PV-HOLD-PO-NBR       07700099
136400             MOVE ERROR-VENDOR-DESC       TO HL2-ENT-ID-DESC      07710099
136500             MOVE ERROR-SAVE-INTERCHG-CNTL-NBR                    07720099
136500                                          TO HL2-INTERCHG-CNTL-NBR07730099
136700             PERFORM W200-HEADING-ROUTINE                         07740099
136700             SET EDI-FIRST-ALLW           TO TRUE                 07750099
136700             SET EDI-FIRST-DTL            TO TRUE                 07760099
136700             SET EDI-FIRST-SMRY           TO TRUE                 07770099
136700             SET WS-TRAN-NOT-DONE         TO TRUE                 07780099
ST3648             SET NO-PREPACK-UPC-FIRST     TO TRUE                 07781099
ST3648             SET PACK-ITEM-AVAIL          TO TRUE                 07782099
108000             MOVE 0                       TO PV-TOTAL-INV-AMT     07790099
108000             MOVE 0                       TO PV-TOTAL-PACK-COST   07800099
108000             MOVE 0                       TO PV-TOTAL-UPC-COST    07810099
108000             MOVE 0                       TO PV-TOTAL-CALC-ALLW   07820099
108000             MOVE 0                       TO PV-GROSS-INV-AMT     07830099
108000             MOVE 0                       TO PV-PACK-CALC-ALLW    07840099
108000             INITIALIZE WS-PCK-ITEMS                              07850099
108000             SET PCK-INDX                 TO 1                    07860099
108000             INITIALIZE WS-ALLW-ITEMS                             07870099
108000             SET ALLW-INDX                TO 1.                   07880099
137100                                                                  07890099
137200*--------------------------------------------------------------*  07900099
137300* READ THE EDI TRANSMISSION REJECTION FILE (COMPLETE FILE)     *  07910099
137400*--------------------------------------------------------------*  07920099
137500 R101-READ-EDI-REJECT.                                            07930099
137600                                                                  07940099
137700     READ EDI-REJ-FILE INTO WS-EDI-REJECT-REC                     07950099
137800         AT END                                                   07960099
137900             SET WS-EDI-REJ-EOF  TO TRUE.                         07970099
138000                                                                  07980099
038400*--------------------------------------------------------------*  07990099
038500* FETCH PREPACK RATIO                                          *  08000099
038600*--------------------------------------------------------------*  08010099
038700 S100-FETCH-PREPK-RATIO.                                          08020099
038800                                                                  08030099
      *    DISPLAY 'PO ' PV-HOLD-PO-NBR ' UPC ' PV-HOLD-UPC-NBR.        08040199
                                                                        08050099
039210     EXEC SQL                                                     08060099
039211        SELECT PREPK_RATO_QTY                                     08070099
039212          INTO :PURITM-PREPK-RATO-QTY                             08080099
039212          FROM TPURITM P                                          08090099
039212             , TPOPRPK K                                          08100099
039212             , XLT_UPC U                                          08110099
039212             , XLT_SKU S                                          08120099
039212         WHERE P.PO_NBR         = :PV-HOLD-PO-NBR                 08130099
039212           AND U.UPC_NBR        = :PV-HOLD-UPC-NBR                08140099
039212           AND K.PO_NBR         = P.PO_NBR                        08150099
039212           AND K.PO_PREPK_ID    = P.PO_PREPK_ID                   08160099
039212           AND P.ITM_NBR        = S.ITM_NBR                       08170099
039212           AND S.INTR_UPC_ID    = U.INTR_UPC_ID                   08180099
039212           AND P.VER_STATUS_CDE = 'A'                             08190099
ST3648           AND K.PREPK_UPC_NBR  = :DTL-UPC-CD                     08200099
039212       WITH UR                                                    08210099
039214     END-EXEC.                                                    08220099
039215                                                                  08230099
039216     EVALUATE TRUE                                                08240099
039217         WHEN SQLCODE = ZERO                                      08250099
039221             CONTINUE                                             08260099
ST3648         WHEN SQLCODE = -420                                      08261099
ST3648             CONTINUE                                             08262099
ST3648         WHEN SQLCODE = +100                                      08280099
ST3648             DISPLAY 'PO-NBR= ' PV-HOLD-PO-NBR                    08282099
ST3648             DISPLAY 'PREPACK-UPC-NBR=' DTL-UPC-CD                08283099
ST3648             DISPLAY 'UPC-NBR=' PV-HOLD-UPC-NBR                   08284099
ST3648             CONTINUE                                             08284199
039218         WHEN SQLCODE = -904                                      08285099
039220         WHEN SQLCODE = -913                                      08290099
039222         WHEN SQLWARN0 NOT = SPACES                               08300099
039223         WHEN SQLCODE  NOT = ZERO                                 08310099
039224             MOVE 'S100-FETCH-PREPK-RATIO'                        08320099
039225                                       TO WS-ABEND-PARAGRAPH      08330099
039226             MOVE 'UNSUCCESSFUL FETCH' TO WS-ABEND-OPERATION      08340099
039227             MOVE 'TPURITM'            TO WS-ABEND-STRUCTURE-1    08350099
039228             MOVE 'XLT_UPC'            TO WS-ABEND-STRUCTURE-2    08360099
102100             SET AC-DB2-ERROR          TO TRUE                    08370099
039229             PERFORM Z999-DB2-ABEND                               08380099
039230     END-EVALUATE.                                                08390099
039239                                                                  08400099
154900*--------------------------------------------------------------*  08410099
155000* WRITE THE DETAIL LINE HEADING - EDI                          *  08420099
155100*--------------------------------------------------------------*  08430099
155200 W200-HEADING-ROUTINE.                                            08440099
155300                                                                  08450099
155400     ADD 1 TO PV-PAGE-COUNT.                                      08460099
155500     EVALUATE REPORT-TYPE-CONTROL                                 08470099
155600        WHEN 'T'                                                  08480099
155700           MOVE 1 TO DP132O-REPORT-NUMBER                         08490099
155800        WHEN 'A'                                                  08500099
155900           MOVE 3 TO DP132O-REPORT-NUMBER                         08510099
156000        WHEN 'P'                                                  08520099
156100           MOVE 5 TO DP132O-REPORT-NUMBER                         08530099
156200        WHEN OTHER                                                08540099
156300           MOVE 1 TO DP132O-REPORT-NUMBER                         08550099
156400     END-EVALUATE.                                                08560099
156500                                                                  08570099
156600     MOVE  9 TO PV-LINE-COUNT.                                    08580099
156700                                                                  08590099
156800     MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    08600099
156900                                                                  08610099
157000     WRITE EDI-LINE FROM DP132O-STANDRD-HEADER-132-COLS           08620099
157100         AFTER ADVANCING PAGE.                                    08630099
157200                                                                  08640099
157300     WRITE EDI-LINE FROM HL-HEADING-LINE1                         08650099
157400         AFTER ADVANCING 2 LINE.                                  08660099
157500                                                                  08670099
157600     WRITE EDI-LINE FROM HL-HEADING-LINE2                         08680099
157700         AFTER ADVANCING 2 LINE.                                  08690099
157800                                                                  08700099
158200     WRITE EDI-LINE FROM DIVIDE-LINE                              08710099
158300         AFTER ADVANCING 1 LINE.                                  08720099
158400                                                                  08730099
197200*--------------------------------------------------------------*  08740099
197300* END OF JOB ROUTINES, PRINT COUNTS, CLOSE FILES               *  08750099
197400*--------------------------------------------------------------*  08760099
197500 Z900-END-OF-JOB.                                                 08770099
199600                                                                  08780099
200403     CLOSE EDI-REJ-ERRORS                                         08790099
200403           EDI-REJ-FILE                                           08800099
200404           EDI-REPORT.                                            08810099
199600                                                                  08820099
160900******************************************************************08830099
161000*  ABEND ROUTINE                                                  08840099
161100******************************************************************08850099
161200 Z999-ABEND.                                                      08860099
161300     DISPLAY '**********************************************'     08870099
161400     DISPLAY 'PROGRAM NAME = APKRP352'                            08880099
161700     DISPLAY '**********************************************'     08890099
161800                                                                  08900099
200403     CLOSE EDI-REJ-ERRORS                                         08910099
200403           EDI-REJ-FILE                                           08920099
200404           EDI-REPORT.                                            08930099
162200                                                                  08940099
162300     DISPLAY AA-ABEND-LIT.                                        08950099
162400     DISPLAY AA-MESSAGE-LINE-1.                                   08960099
162500     DISPLAY AA-MESSAGE-LINE-2.                                   08970099
162700     DISPLAY AA-PROGRAM-LIT.                                      08980099
162800     DISPLAY AA-PARAGRAPH-LIT.                                    08990099
163400                                                                  09000099
163410*    COPY DPPD004.                                                09010099
163420                                                                  09020099
163500     CALL 'ILBOABN0' USING ABEND-CODE.                            09030099
052000                                                                  09040099
052000                                                                  09050099
057800*--------------------------------------------------------------*  09060099
057900* PROCESS DB2 ABENDS                                           *  09070099
058000*--------------------------------------------------------------*  09080099
058010 Z999-DB2-ABEND.                                                  09090099
058100                                                                  09100099
058200     DISPLAY '*** DB2 ERROR '.                                    09110099
058300     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 09120099
058400     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               09130099
058500     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               09140099
058600     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             09150099
058700     IF WS-ABEND-STRUCTURE-2 > SPACES                             09160099
058800        DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2           09170099
058810     END-IF.                                                      09180099
059000     MOVE +4013                    TO ABEND-CODE.                 09190099
059100                                                                  09200099
059200     COPY DPPD004.                                                09210099
059300     CALL 'ILBOABN0' USING ABEND-CODE.                            09220099
