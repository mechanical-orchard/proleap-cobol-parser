000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    APKUT302.                                         00030000
000400 INSTALLATION.  BATUS RETAIL GROUP.                               00040000
000500 AUTHOR.        MARIE LAMARTINE.                                  00050000
000600 DATE-WRITTEN.  NOVEMBER,1984.                                    00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900***************************************************************** 00090000
001000*     THIS PROGRAM READS THE AP ADJUSTMENT JOURNAL EXTRACT FILE   00100000
001100*     AND REFORMATS RECORDS TO INTERFACE BACK TO THE OLD KOHLS    00110000
001200*     MERCHANDISE SYSTEM.                                         00120000
001300*                                                                 00130000
001400*    11/26/97  CHRIS BOEHNLEIN              WR#3973               00140000
001500*          ADDED DB2 LOGIC TO PULL THE INHOUSE VENDOR NUMBER.     00150000
001600*          USING THE PO NUMBER, THE INHOUSE NUMBER IS ATTEMPED    00160000
001700*          TO BE RETRIEVED.  IF IT IS NOT FOUND, THEN A           00170000
001800*          COMBINATION OF DUNNS AND DEPT IS USED.  IF THAT DOESN'T00180000
001900*          WORK THEN 001 IS USED.                                 00190000
002000***************************************************************** 00200000
002100*                 PROGRAM SPECIFICATIONS                          00210000
002200*    INPUT   PURCHASE JOURNAL EXTRACT FILE                        00220000
002300*            SEQUENTIAL                                           00230000
002400*            LENGTH - 175 BYTES                                   00240000
002500*    OUTPUT  PURCHASE JOURNAL REFORMATTED FILE                    00250000
002600*            SEQUENTIAL                                           00260000
002700*            LENGTH - 80 BYTES                                    00270000
002800*PROCESS                                                          00280000
002900*        READ PJ FILE                                             00290000
003000*        BYPASS TRAILER RECORDS                                   00300000
003100*        BYPASS EXPENSE RECORDS                                   00310000
003300*        FORMAT AND WRITE RECORD                                  00320000
003400*            FIELD NAME              VALUE                        00330000
003500*            ---------------------------------------------------- 00340000
003600*            QM10-CODE-1             1                            00350000
003700*            ML015-PURCH-VEND-NBR    AP046-VND-NBR (LAST 5 BYTES) 00360000
003800*            ML015-PURCH-DEPT-CLASS                               00370000
003900*               FIRST 3 BYTES        AP046-DEPT-NBR               00380000
004000*               LAST 2 BYTES         PJR-DETAIL-CLASS             00390000
004100*                                             (FIRST 2 BYTES)     00400000
004200*            ML015-PURCH-PO-NBR      AP046-PO-NBR  (LAST 5 BYTES) 00410000
004300*                                    IF SPACES - MOVE ZEROES      00420000
004400*            ML015-PURCH-BATCH-NBR   CURRENT DAY -                00430000
004500*                                      JULIAN FORMAT + 500        00440000
004600*            ML015-PURCH-KOHLS-MM    AP046-PSTG-FMN-NBR           00450000
004700*            ML015-PURCH-DOC-DTE     AP046-DOC-DTE                00460000
004800*                                    CONVERT TO CALENDER FORMAT   00470000
004900*            ML015-PURCH-DOC-5-NBR   0                            00480000
005000*            ML015-PURCH-ACCT-NBR                                 00490000
005100*****  TVN 9/93 FIRST 3 BYTES        483                          00500000
005200*****  TVN 9/93 LAST 2 BYTES         AP046-STR-NBR(LAST 2 BYTES)  00510000
005300*               FIRST 2 BYTES        00                           00520000
005400*               LAST 3 BYTES         AP046-STR-NBR(ALL  3 BYTES)  00530000
005500*            ML015-PURCH-MERCH-AMT   AP046-GRO-COST-AMT           00540000
005600*            ML015-PURCH-DISCT-AMT   COMPUTE                      00550000
005700*                                                                 00560000
005800*                                                                 00570000
005900*            ML015-PURCH-FRGHT-AMT   AP046-FRGT-AMT               00580000
006000*            ML015-PURCH-NET         COMPUTE                      00590000
006100*                  AP046-GRO-COST-AMT   + AP046-FRGT-AMT          00600000
006200*                                       - ML015-PURCH-DISCT-AMT   00610000
006300*            ML015-PURCH-RETAIL      AP046-RETL-AMT               00620000
006400*            ML015-PURCH-TRANS-CDE   01                           00630000
006500*                                                                 00640000
006600*        DISPLAY TOTALS                                           00650000
006700*            RECORDS READ                                         00660000
006800*            RECORDS BYPASSED                                     00670000
006900*            RECORDS WRITTEN                                      00680000
007000***************************************************************** 00690000
007100*                                                                 00700000
007200* PROGRAM MAINTENANCE LOG.                                        00710000
007300*                                                                 00720000
007400*         MODIFIED 05/16/85 A.CHENG TO GENERATE RECORDS WITH      00730000
007500*        DIFFERENT TRANSACTION CODES.                             00740000
007600*                                                                 00750000
007700*         MODIFIED 05/19/85 A.CHENG TO GENERATE DOUBLE RECORDS FOR00760000
007800*        TRANSACTION WITH OPPOSITE-SIGNED COST/RETAIL.            00770000
007900*                                                                 00780000
008000*         MODIFIED 05/23/85 B.KABLIS TO GENERATE EQUAL MULTIPUL   00790000
008100*        RECORDS(LAST RECORD WILL HAVE ANY REMAINDER) WITH        00800000
008200*        LIMITATIONS FOR RETAIL-AMT > 84999, MERCH-AMT < 50000    00810000
008300*        BEFORE MULTIPUL RECORDS ARE PRODUCED.                    00820000
008400*                                                                 00830000
008500*         MODIFIED 06/03/85 A.CHENG TO GENERATE FREIGHT RECORDS   00840000
008600*         WITH UNSIGNED NUMERIC FIELDS.                           00850000
008700*                                                                 00860000
008800*         MODIFIED 06/20/85 A.CHENG TO MAKE RETAIL ONLY TO        00870000
008900*         COST AND RETAIL AND GENERATE AND OFFSET COST ONLY       00880000
009000*         TRANSACTIONS.                                           00890000
009100*                                                                 00900000
009200*         MODIFIED 07/10/85 M.LAMARTINE                           00910000
009300*         CHANGED PROGRAM TO COMPARE FIELDS BEFORE TRUNCATION     00920000
009400*         IN PARA 6000-RECORD-LIMITATIONS BY USE OF TEMP FIELDS   00930000
009500*                                                                 00940000
009600*         MODIFIED 07/20/85 A.CHENG                               00950000
009700*         CHANGED PROGRAM TO PUT 1 PENNY IN TO TRANSER COST FIELD 00960000
009800*         SO THAT THESE TRANSACTIONS WILL NOT BE REJECTED BY      00970000
009900*         MERCHANDISE LEDGER SYSTEM.                              00980000
010000*                                                                 00990000
010100*   LAST CHANGE:  9/93  STEVE ROEGNER--CONVERT TO NEW DATE RTN    01000000
010200*   LAST CHANGE:  9/93  TOM NICKELS  REFORMAT D110-ACCT-NO FIELD  01010000
010300*                       FOR MERCHANDISE LEDGER TO YYZZZ           01020000
010400*                       WHERE YY  = 00                            01030000
010500*                       WHERE ZZZ = THREE DIGIT STORE NUMBER      01040000
010600*                                                                 01050000
010700*    DATE  12/17/93                                               01060000
010800*        CHANGE MADE: - IN 6110- PARAGRAPH, ADDED LOGIC TO BALANCE01070000
010900*        EACH RECORD W/IN ITSELF, AS WELL AS ALL RECORDS INVOLVED 01080000
011000*        IN THE SPLIT.                                            01090000
011100*        POPULATE A NEW FIELD, D110-INVEN-CUTOFF-DTE, W/ IT'S PJR 01100000
011200*        COUNTERPART.                                             01110000
011300*        MADE BY: MARC BLAZICH            WR #:                   01120000
011400*                                                                 01130000
011500*   08/11/94   MARY KING                                          01140000
011600*              CHANGED CODE IN PARAGRAPH 3000-PROCESS-DETAIL:     01150000
011700*              - ADDED NEW TRAN CODES 15 (DO NOT PAY CHARGE),     01160000
011800*                34 (PJ TOLERANCE ADJ CREDIT), AND 36 (PJ UNIT    01170000
011900*                COST ADJ CREDIT) TO BE PROCESSED THE SAME AS     01180000
012000*                TRAN CODE 12.                                    01190000
012100*              - ADDED NEW TRAN CODES 16 (PRICE CLAIM CREDIT),    01200000
012200*                17 (MERCHANDISE PAYMENT OVERSHIPMENT), 35        01210000
012300*                (PJ TOLERANCE ADJ CHARGE), AND 37 (PJ UNIT       01220000
012400*                COST ADJ CHARGE) TO BE PROCESSED THE SAME AS     01230000
012500*                TRAN CODE 11.                                    01240000
012600*                                                                 01250000
012700*   05/26/95   PAUL KEBER  (STRATAGEM)                            01260000
012800*              CHANGED CODE IN PARAGRAPH 3000-PROCESS-DETAIL:     01270000
012900*              THE WS-TRANCDE CHECK TO DECIDE IF SIGNS SHOULD BE  01280000
013000*              REVERSED HAS THE VALUES REPLACED BY THE CST-RET-DB 01290000
013100*              88 LEVEL OF THE KDAPTRAN RECORD STATEMENT WHICH    01300000
013200*              INCLUDES NEW VALUE 17.                             01310000
013300*                                                                 01320000
013400*   08/06/96   MARILYN WILKINSON                                  01330000
013500*              ADDED CTR FIELD TO 3500- AND 8000- TO COUNT THE    01340000
013600*              NUMBER OF ADDITIONAL RECORDS BEING WRITTEN TO      01350000
013700*              THE OUTPUT FILE.  SOME TRANSACTIONS CREATE MORE    01360000
013800*              THAN ONE OUTPUT RECORD FOR EACH INPUT RECORD.      01370000
013900*                                                                 01380000
014000*   08/06/96   MARILYN WILKINSON                                  01390000
014100*              ADDED CTR FIELD TO 3500- AND 8000- TO COUNT THE    01400000
014200*              NUMBER OF ADDITIONAL RECORDS BEING WRITTEN TO      01410000
014300*              THE OUTPUT FILE.  SOME TRANSACTIONS CREATE MORE    01420000
014400*              THAN ONE OUTPUT RECORD FOR EACH INPUT RECORD.      01430000
014500*                                                                 01440000
014600*    11/26/97  CHRIS BOEHNLEIN              WR#3973               01450000
014700*          ADDED DB2 LOGIC TO PULL THE INHOUSE VENDOR NUMBER.     01460000
014800*          USING THE PO NUMBER, THE INHOUSE NUMBER IS ATTEMPED    01470000
014900*          TO BE RETRIEVED.  IF IT IS NOT FOUND, THEN A           01480000
015000*          COMBINATION OF DUNNS AND DEPT IS USED.  IF THAT DOESN'T01490000
015100*          WORK THEN 001 IS USED.                                 01500000
015200*                                                                 01510000
015300*    09/04/98  CAROLYN GIFFORD              WR#                   01520000
015400*          CHANGED TO HANDLE TRANSACTION CODES 'Z1' (SAME WAY AS  01530000
015500*          '41') AND 'Z2' (SAMES AS '42').                        01540000
015600*                                                                 01550000
015700*    01/25/99  ROBIN BERNOSKI               WR#                   01560000
015800*          MODIFIED PROGRAM TO USE THE ADJUSTMENT JOURNAL EXTRACT 01570000
015900*          FILE INSTEAD.  IT HAS ALSO BEEN RENAMED TO USE THE     01580000
016000*          CURRENT NAMING CONVENTIONS AND HAS BEEN MODIFIED TO    01590000
016100*          REMOVE THE JULIAN DATE PROCESSING AND TO USE THE ML    01600000
016200*          COPYBOOK INSTEAD OF HARD-CODING THE OUTPUT FILE.       01610000
016300*                                                                 01620000
016400*    10/11/99  L SCHALLHORN                 WR#6041               01630000
016500*          REMOVED COPYBOOK DPWS500 - NOT USED.  ALSO REMOVED     01640000
016600*          THE PARAGRAPH THAT REFERENCES IT.                      01650000
016700*                                                                 01660000
016800*    01/10/00  MIKE BESKE                   WR#????               01670000
016900*          ADDED CODE TO SPLIT LARGE DISCOUNT AMOUNTS ONLY (TRAN  01680000
017000*          CODE = 28) INTO MULTIPLE RECORDS BECAUSE THE ML        01690000
017100*          COPYBOOK CAN ONLY HANDLE AMOUNTS UP TO 9999.99.  IF IT 01700000
017200*          IS LARGER THEN THAT DOLLAR AMOUNT WILL BE TRUNCATED.   01710000
017300*                                                                 01720000
017400*    06/05/01  NANCY EILBES                 WR#20704              01730000
017500*          PROGRAM WAS NOT CORRECTLY CREATING MULTIPLE RECORDS    01740000
017600*          WHEN THE FREIGHT AMOUNT WAS TOO BIG, BUT THE GROSS WAS 01750000
017700*          NOT TOO BIG.  MODIFIED LOGIC IN 6000-RECORD-LIMITATIONS01760000
017800*          TO CHECK IF THE FREIGHT EQUALS THE NET, IN WHICH CASE  01770000
017900*          SPECIAL LOGIC FOR A FREIGHT-ONLY TRANSACTION IS DONE.  01780000
018000*          OTHERWISE, LOGIC WILL FALL THROUGH TO 6100-CONTINUE,   01790000
018100*          WHERE A CHANGE WAS MADE TO DIVIDE TEMP-NET INSTEAD OF  01800000
018200*          TEMP-MERCH TO DETERMINE IF MULTIPLE RECORDS ARE NEEDED.01810000
018300*                                                                 01820000
018400*    05/16/2002                                                   01830000
018500*      CHANGE MADE:  NI-SKU CHANGES.  RECOMPILE FROM PRODUCTION   01840000
018600*      TO INCORPORATE CHANGES TO COPYBOOK APRD046.                01850000
018700*    MADE BY:  KEVIN CATLIN                   WR/IR #: 21278      01860000
018800*                                                                 01870000
018900*    08/21/2002                                                   01880000
019000*      ADDED LOGIC IN 6100-CONTINUE TO CALCULATE A NUMBER OF      01890000
019100*      RECORDS SPLIT ON THE FREIGHT FIELD AND INCORPORATE THIS    01900000
019200*      EXTRA COUNTER INTO THE LATER LOGIC DETERMINING HOW MANY    01910000
019300*      'SPLIT' RECORDS NEED TO BE CREATED.  THIS CHANGE IS TO FIX 01920000
019400*      A PROBLEM WHERE THE FREIGHT FIELD OVERFLOWED, BUT MULTIPLE 01930000
019500*      RECORDS WERE NOT CREATED BECAUSE IT WAS NOT A FREIGHT-ONLY 01940000
019600*      TRANSACTION, AND NEITHER THE NET COST NOR THE RETAIL CAUSED01950000
019700*      AN OVERFLOW CONDITION.                                     01960000
019800*    MADE BY:  NANCY EILBES                   WR/IR #: 22902      01970000
019900*                                                                 01980000
020000*    03/25/2004                                                   01990000
020100*      MODIFIED CODE TO USE THE CHANGES TO MLRD015.  AMONG THE    02000000
020200*      CHANGES WERE REMOVING THE SPLIT RECORD LOGIC BECAUSE THE   02010000
020300*      AMOUNT FIELD SIZES WERE INCREASED, REMOVED THE LOGIC THAT  02020000
020400*      SELECTS THE INHOUSE NUMBER AND REPLACED IT WITH ENT ID     02030000
020500*      FROM TEXTENT, PO NUMBER AND STORE NUMBER SIZES WERE        02040000
020600*      INCREASED, THE CENTURY WAS ADDED TO THE INV-CUTOFF DATE,   02050000
020700*      THE CENTURY AND YEAR WERE ADDED TO THE PURCH-DOC DATE, AND 02060000
020800*      THE OUTPUT FILESIZE WAS INCREASED FROM 80 TO 150.  ADDED   02070000
020900*      CODE TO POPULATED A NEW FIELD (ML015-PURCH-SKU-NBR WITH    02080000
021000*      AP046-SKU-NBR IF THERE IS ANYTHING IN THAT FIELD OTHERWISE 02090000
021100*      IT WILL BE POPULATED WITH THE STING VALUE OF CLASS, DEPT   02100000
021200*      AND TRAILING ZEROES AT THE REQUEST OF THE ML TEAM.         02110000
021300*    MADE BY:  MIKE BESKE                     WR/IR #: 25805      02120000
021400*                                                                 02130000
021500*    04/21/2004                                                   02140000
021600*      RESTORED THE LOGIC THAT GETS THE INHOUSE NUMBER BECAUSE    02150000
021700*      ROD JANSSEN REQUESTED THAT THE ENTID AND THE INHOUSE BE    02160000
021800*      SUPPLIED. HE SAID THAT THE ML APPLICATION REQUESTS THIS OF 02170000
021900*      ALL EXTERNAL FEEDS TO THEIR PROCESSING.                    02180000
022000*    MADE BY:  MIKE BESKE                     WR/IR #: 25805      02190000
022100*                                                                 02200000
022200*    04/23/2004                                                   02210000
022300*      MODIFIED CODE TO START MOVING AP046-DOC-NBR TO             02220000
022400*      ML015-PURCH-DOC-5-NBR PER A REQUEST FROM RONNA MACDONALD   02230000
022500*      ON THE ML TEAM.                                            02240000
022600*    MADE BY:  MIKE BESKE                     WR/IR #: 25805      02250000
022700*                                                                 02260000
022800*    05/06/2004                                                   02270001
022900*      CHANGE MADE:  CHANGED VALUE OF 'BYPASS TRANCODES' TO '00'  02280001
023000*      SO NONE WOULD BE AUTOMATICALLY BYPASSED. THIS LOGIC WILL BE02290001
023100*      REMOVED ENTIRELY IN A LATER CHANGE.                        02300001
023200*    MADE BY:  NANCY EILBES                   WR/IR #: 26677      02310001
023300*                                                                 02320001
023400*    05/07/2004                                                   02330002
023500*      CHANGE MADE:  REMOVED THE LOGIC THAT WAS BYPASSING         02340002
023600*      TRANCODES MENTIONED IN THE ABOVE CHANGE COMMENT.  ALSO     02350002
023700*      REMOVED THE W/S DEFINITIONS OF THE BYPASS TRANCODES.       02360002
023800*    MADE BY:  MIKE BESKE                     WR/IR #: 25805      02370002
023300*                                                                 02370105
023400*    03/07/2022                                                   02371040
023500*      CHANGE MADE:  IF THE FREIGHT CHARGES ARE OVER 1 MILLION,   02372005
023600*      BREAK THE TRANS INTO MULTIPLE RECORDS.  ML WILL TRUNCATE   02373005
023700*      ANY VALUES OVER 1 MILLION.                                 02374005
023800*    MADE BY:  JEAN KURK                      CHG#: CHG0265697    02375005
023900*                                                                 02380002
024000******************************************************************02390000
024100                                                                  02400000
024200 ENVIRONMENT DIVISION.                                            02410000
024300                                                                  02420000
024400 INPUT-OUTPUT SECTION.                                            02430000
024500 FILE-CONTROL.                                                    02440000
024600                                                                  02450000
024700     SELECT ADJSTMNT-JOURNAL-FILE                                 02460000
024800         ASSIGN TO UT-S-INP01.                                    02470000
024900                                                                  02480000
025000     SELECT ADJ-REFORMAT-FILE                                     02490000
025100         ASSIGN TO UT-S-OUT01.                                    02500000
025200 EJECT                                                            02510000
025300 DATA DIVISION.                                                   02520000
025400                                                                  02530000
025500 FILE SECTION.                                                    02540000
025600                                                                  02550000
025700 FD  ADJSTMNT-JOURNAL-FILE                                        02560000
025800     RECORDING MODE IS F                                          02570000
025900     LABEL RECORDS ARE OMITTED                                    02580000
026000     RECORD CONTAINS 250 CHARACTERS                               02590000
026100     BLOCK CONTAINS 0 RECORDS                                     02600000
026200     DATA RECORD IS ADJ-EXTRACT-REC.                              02610000
026300 01  ADJ-EXTRACT-REC                   PIC X(250).                02620000
026400                                                                  02630000
026500 FD  ADJ-REFORMAT-FILE                                            02640000
026600     RECORDING MODE IS F                                          02650000
026700     LABEL RECORDS ARE OMITTED                                    02660000
026800     RECORD CONTAINS 150 CHARACTERS                               02670000
026900     BLOCK CONTAINS 0 RECORDS                                     02680000
027000     DATA RECORD IS ML015-ADJST-JOURNAL-REC.                      02690000
027100 01  ML015-ADJST-JOURNAL-REC            PIC X(150).               02700000
027200     EJECT                                                        02710000
027300 WORKING-STORAGE SECTION.                                         02720000
027400*------------------------------------------------------------     02730000
027500*  DB2 AREA FOR TEXTENT                                           02740000
027600*------------------------------------------------------------     02750000
027700                                                                  02760000
027800     EXEC SQL                                                     02770000
027900       INCLUDE TEXTENT                                            02780000
028000     END-EXEC.                                                    02790000
028100                                                                  02800000
028200*------------------------------------------------------------     02810000
028300*  DB2 AREA FOR TPURCHS                                           02820000
028400*------------------------------------------------------------     02830000
028500                                                                  02840000
028600     EXEC SQL                                                     02850000
028700       INCLUDE TPURCHS                                            02860000
028800     END-EXEC.                                                    02870000
028900                                                                  02880000
029000*------------------------------------------------------------     02890000
029100*  DB2 AREA FOR TVNDDPT                                           02900000
029200*------------------------------------------------------------     02910000
029300                                                                  02920000
029400     EXEC SQL                                                     02930000
029500        INCLUDE TVNDDPT                                           02940000
029600     END-EXEC.                                                    02950000
029700                                                                  02960000
029800*------------------------------------------------------------     02970000
029900*  DB2 COMMUNICATIONS                                             02980000
030000*------------------------------------------------------------     02990000
030100                                                                  03000000
030200     EXEC SQL                                                     03010000
030300        INCLUDE SQLCA                                             03020000
030400     END-EXEC.                                                    03030000
030500                                                                  03040000
030600*------------------------------------------------------------     03050000
030700*   ABEND AREA                                                    03060000
030800*------------------------------------------------------------     03070000
030900                                                                  03080000
031000 01  ABEND-CODE                  PIC S9(04)  VALUE ZERO           03090000
031100                                             COMP SYNC.           03100000
031200     88  AC-BAD-DATA                         VALUE +4003.         03110000
031300     88  AC-DB2-ERROR                        VALUE +4013.         03120000
031400                                                                  03130000
031500                                                                  03140000
031600 01  ABEND-AREAS.                                                 03150000
031700     05  AA-ABEND-LIT           PIC  X(40)  VALUE                 03160000
031800           '*****       ABEND'.                                   03170000
031900     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                03180000
032000             '*****   PROGRAM: APKUT302'.                         03190000
032100     05  AA-PARAGRAPH-LIT.                                        03200000
032200         10  FILLER              PIC  X(17)  VALUE                03210000
032300             '***** PARAGRAPH: '.                                 03220000
032400         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        03230000
032500     05  AA-MESSAGE-LINE.                                         03240000
032600         10  FILLER              PIC  X(06)  VALUE '*****'.       03250000
032700         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        03260000
032500     05  AA-MESSAGE-LINE-2.                                       03261019
032600         10  FILLER              PIC  X(06)  VALUE '*****'.       03262019
032700         10  AA-MESSAGE-2        PIC  X(127) VALUE SPACES.        03263019
032800     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                03270000
032900             '*****    DB2 ERROR'.                                03280000
033000     05  AA-DB2-OPERATION-LIT.                                    03290000
033100         10  FILLER              PIC  X(17)  VALUE                03300000
033200             '***** OPERATION: '.                                 03310000
033300         10  AA-DB2-OPERATION.                                    03320000
033400             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        03330000
033500             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        03340000
033600     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        03350000
033700     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        03360000
033800     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        03370000
033900     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        03380000
034000                                                                  03390000
034100                                                                  03400000
034200     COPY DPWS004.                                                03410000
034300                                                                  03420000
034400 01  FILLER    PIC X(30) VALUE 'BEGIN WORKING-STORAGE APKUT302'.  03430000
034500                                                                  03440000
034600 01  PROGRAM-COUNTERS.                                            03450000
034700     05  REC-READ-CTR           PIC 9(7)   COMP-3  VALUE 0.       03460000
034800     05  REC-BYPASS-CTR         PIC 9(7)   COMP-3  VALUE 0.       03470000
034900     05  REC-WRITTEN-CTR        PIC 9(7)   COMP-3  VALUE 0.       03480000
035000     05  LOOP-CTR               PIC 9999   VALUE ZERO.            03490000
035100                                                                  03500000
035200 01  PROGRAM-SWITCHES.                                            03510000
035300     05  END-OF-PJ-SW           PIC XXX    VALUE 'NO'.            03520000
035400         88  END-OF-PJ                     VALUE 'YES'.           03530000
035500     05  DISCOUNT-PROCESS-SW    PIC X      VALUE 'N'.             03540000
035600         88  END-OF-DISC-PROCESS           VALUE 'Y'.             03550000
035700         88  NOT-END-OF-DISC-PROCESS       VALUE 'N'.             03560000
035800     05  DISCOUNT-SPLIT-SW      PIC X      VALUE 'N'.             03570000
035900         88  END-OF-DISC-SPLIT             VALUE 'Y'.             03580000
036000         88  NOT-END-OF-DISC-SPLIT         VALUE 'N'.             03590000
036100     05  WS-NET-COST            PIC S9(9)V99 COMP-3.              03600000
036200     05  WS-NET-COST-DIFFERENCE PIC  9(9)V99.                     03610000
036300     05  WS-AP046-PO-HOLD       PIC X(07)  VALUE '99999'.         03620000
036400     05  WS-AP046-PO-VAR        PIC S9(09) COMP VALUE ZERO.       03630000
036500     05  WS-DISPLAY-GROSS       PIC ZZZZZZZZ9.99-.                03640000
036600     05  WS-DISPLAY-RETAIL      PIC ZZZZZZZZ9.99-.                03650000
036600     05  WS-10MILL              PIC 9(09)V99                      03651016
036600                                     VALUE 9999999.99.            03652016
036600     05  WS-9MILL               PIC 9(09)V99                      03653032
036600                                     VALUE 9000000.00.            03654032
036700                                                                  03660000
036800                                                                  03670000
036900 01  PROGRAM-WORK-AREA.                                           03680000
037000     05  WS-COMP-ABEND-CODE     PIC S9(4)  COMP  VALUE +0.        03690000
037100     05  ANTI-DISCT-AMT         PIC S9(11)V9   VALUE +0.          03700000
037200     05  HD-FRGT                PIC S9(07)V99  VALUE +0.          03710000
037300     05  WS-FRGT-REM            PIC S9(09)V99  VALUE +0.          03720032
037400     05  WS-DISC-REM            PIC S9(09)V99  VALUE +0.          03730032
037400     05  WS-MRCH-REM            PIC S9(09)V99  VALUE +0.          03731032
037300     05  WS-FRGT-WRK            PIC S9(09)V99  VALUE +0.          03733032
037400     05  WS-MRCH-WRK            PIC S9(09)V99  VALUE +0.          03736032
037500     05  HD-NET                 PIC S9(07)V99  VALUE +0.          03740000
037600     05  HD-DISC                PIC S9(07)V99  VALUE +0.          03750000
037700     05  HD-RETAIL              PIC S9(07)V99  VALUE +0.          03760000
037800     05  HD-MERCH               PIC S9(07)V99  VALUE +0.          03770000
037900     05  TEMP-FRGT              PIC S9(07)V99  VALUE +0.          03780000
038000     05  TEMP-NET               PIC S9(07)V99  VALUE +0.          03790000
038100     05  TEMP-DISC              PIC S9(07)V99  VALUE +0.          03800000
038200     05  TEMP-RETAIL            PIC S9(07)V99  VALUE +0.          03810000
038300     05  TEMP-MERCH             PIC S9(07)V99  VALUE +0.          03820000
038400     05  LEFTOVER               PIC S9(07)V99  VALUE +0.          03830000
038500     05  LEFTOVER-2             PIC S9(07)V99  VALUE +0.          03840000
038600     05  LEFTOVER-3             PIC S9(07)V99  VALUE +0.          03850000
038700     05  NO-OF-REC              PIC 9999       VALUE  0.          03860000
038800     05  NO-OF-REC-2            PIC 9999       VALUE  0.          03870000
038900     05  NO-OF-REC-3            PIC 9999       VALUE  0.          03880000
039000     05  FRGT-RMDR              PIC S9(07)V99  VALUE +0.          03890000
039100     05  NET-RMDR               PIC S9(07)V99  VALUE +0.          03900000
039200     05  DISC-RMDR              PIC S9(07)V99  VALUE +0.          03910000
039300     05  RETAIL-RMDR            PIC S9(07)V99  VALUE +0.          03920000
039400     05  MERCH-RMDR             PIC S9(07)V99  VALUE +0.          03930000
039500     05  WS-NUM-REC             PIC 9999       VALUE  0.          03940000
039600     05  WS-PURCH-BATCH-NBR     PIC 9(03)      VALUE  0.          03950000
039700     05  WS-VNDDPT-INHOUSE-NBR  PIC 9(05)      VALUE  0.          03960000
039700     05  WS-LAST-REC            PIC X          VALUE  'N'.        03961013
008600     05  PC-ARRAY-ENTRY-LIMIT   PIC  9(02)     VALUE 15.          03962021
039800                                                                  03970000
039900     COPY APRD046.                                                03980000
040000                                                                  03990000
040100 01  REFORMAT-AREA.                                               04000000
040200     05  HOLD-JULIAN            PIC 9(5).                         04010000
040300     05  HOLD-JULIAN-RED REDEFINES HOLD-JULIAN.                   04020000
040400         10  FILLER             PIC 99.                           04030000
040500         10  JULIAN-DAY-HOLD    PIC 999.                          04040000
040600     05  REF-CLASS.                                               04050000
040700         10  REF-CLASS-FIRST2   PIC XX.                           04060000
040800         10  FILLER             PIC X.                            04070000
040900     05  HOLD-CLASS.                                              04080000
041000         10  CLASS-FIRST3       PIC 999.                          04090000
041100         10  CLASS-LAST2        PIC 99.                           04100000
041200     05  HOLD-SKU-NBR           PIC 9(8).                         04110000
041300     05  HOLD-SKU-NBR-RED REDEFINES HOLD-SKU-NBR.                 04120000
041400         10  HOLD-SKU-FIRST5    PIC 9(5).                         04130000
041500         10  HOLD-SKU-LAST3     PIC 9(3).                         04140000
041600     05  UNPAK-DATE             PIC S9(5).                        04150000
041700     EJECT                                                        04160000
041800                                                                  04170000
041900     COPY MLRD015.                                                04180000
042000                                                                  04190000
040100 01  WS-COST-AREA.                                                04190118
040100     05  WS-COST-ARRAY          OCCURS 15 TIMES                   04190318
040100                                      INDEXED BY WS-IDX.          04190418
040200         10  WS-COST-NET        PIC S9(9)V99.                     04190519
040200         10  WS-COST-MERCH      PIC S9(9)V99.                     04190619
040200         10  WS-COST-DISCT      PIC S9(9)V99.                     04190719
040200         10  WS-COST-FRGHT      PIC S9(9)V99.                     04190819
042000                                                                  04195018
042100     EJECT                                                        04200000
042200 PROCEDURE DIVISION.                                              04210000
042300                                                                  04220000
042400 1000-MAIN-ROUTINE.                                               04230000
042500                                                                  04240000
042600     OPEN  INPUT  ADJSTMNT-JOURNAL-FILE                           04250000
042700           OUTPUT ADJ-REFORMAT-FILE.                              04260000
042800                                                                  04270000
042900     INITIALIZE AP046-EXTRACT-FILE                                04280000
043000                ML015-PURCHASE-RECORD.                            04290000
043100                                                                  04300000
043200     READ ADJSTMNT-JOURNAL-FILE INTO AP046-EXTRACT-FILE           04310000
043300        AT END                                                    04320000
043400            DISPLAY '*** PGM APKUT302 HAS NO INPUT ***'           04330000
043500            MOVE 'YES' TO END-OF-PJ-SW.                           04340000
043600                                                                  04350000
043700     IF NOT END-OF-PJ                                             04360000
043800         ACCEPT HOLD-JULIAN FROM DAY                              04370000
043900         PERFORM 2000-READ-PURCHASE                               04380000
044000             UNTIL END-OF-PJ.                                     04390000
044100                                                                  04400000
044200     DISPLAY '***** APKUT302 TOTALS *****'.                       04410000
044300     DISPLAY '     RECORDS READ: ' REC-READ-CTR.                  04420000
044400     DISPLAY ' RECORDS BYPASSED: ' REC-BYPASS-CTR.                04430000
044500     DISPLAY '  RECORDS WRITTEN: ' REC-WRITTEN-CTR.               04440000
044600                                                                  04450000
044700     CLOSE ADJSTMNT-JOURNAL-FILE                                  04460000
044800           ADJ-REFORMAT-FILE.                                     04470000
044900                                                                  04480000
045000     STOP RUN.                                                    04490000
045100     EJECT                                                        04500000
045200 2000-READ-PURCHASE.                                              04510000
045300                                                                  04520000
045400     ADD 1 TO REC-READ-CTR.                                       04530000
045500                                                                  04540002
045600     PERFORM 3000-PROCESS-DETAIL THRU 3000-EXIT.                  04550002
045700                                                                  04560000
045800     READ ADJSTMNT-JOURNAL-FILE INTO AP046-EXTRACT-FILE           04570000
045900         AT END                                                   04580000
046000             MOVE 'YES' TO END-OF-PJ-SW.                          04590000
046100                                                                  04600000
046200 3000-PROCESS-DETAIL.                                             04610000
046300                                                                  04620000
046400     PERFORM 8500-GET-INHOUSE-NBR-PO.                             04630000
046500                                                                  04640000
046600     IF AP046-MISC-CHRG-AMT NOT = 0                               04651036
046700       ADD AP046-MISC-CHRG-AMT TO AP046-GRO-COST-AMT.             04660000
046800                                                                  04670000
046900     IF AP046-CREDIT                                              04680000
047000         MULTIPLY -1 BY AP046-GRO-COST-AMT                        04690000
047100         MULTIPLY -1 BY AP046-FRGT-AMT                            04700000
047200         MULTIPLY -1 BY AP046-RETL-AMT                            04710000
047300         MULTIPLY -1 BY AP046-NET-COST-AMT                        04720000
047400         MULTIPLY -1 BY AP046-DISC-AMT                            04730000
047500     END-IF.                                                      04740000
047600                                                                  04750000
047700     SET ML015-VALID-PURCH-CDE  TO TRUE.                          04760000
047800     MOVE VNDDPT-INHOUSE-NBR    TO  WS-VNDDPT-INHOUSE-NBR.        04770000
047900     MOVE WS-VNDDPT-INHOUSE-NBR TO  ML015-PURCH-VENDOR-INHSE-NMBR.04780000
048000     MOVE AP046-DEPT-NBR        TO  CLASS-FIRST3.                 04790000
048100     IF AP046-CL-NBR = ZERO                                       04800000
048200        MOVE AP046-MAJ-CL-NBR   TO  CLASS-LAST2                   04810000
048300     ELSE                                                         04820000
048400        MOVE AP046-CL-NBR       TO  CLASS-LAST2                   04830000
048500     END-IF.                                                      04840000
048600     MOVE HOLD-CLASS            TO  ML015-PURCH-DEPT-CLASS.       04850000
048700     IF AP046-PO-NBR NOT NUMERIC                                  04860000
048800         MOVE ZEROES            TO  ML015-PURCH-PO-NBR            04870000
048900     ELSE                                                         04880000
049000         MOVE AP046-PO-NBR      TO  ML015-PURCH-PO-NBR            04890000
049100     END-IF.                                                      04900000
049200     MOVE JULIAN-DAY-HOLD       TO  WS-PURCH-BATCH-NBR.           04910000
049300     ADD 500                    TO  WS-PURCH-BATCH-NBR.           04920000
049400     MOVE WS-PURCH-BATCH-NBR    TO  ML015-PURCH-BATCH-NBR.        04930000
049500     MOVE AP046-PSTG-FMN-NBR    TO  ML015-PURCH-KOHLS-MM.         04940000
049600                                                                  04950000
049700     MOVE AP046-INV-CUTOFF-MM   TO  ML015-PURCH-INV-DTE-MM.       04960000
049800     MOVE AP046-INV-CUTOFF-DD   TO  ML015-PURCH-INV-DTE-DD.       04970000
049900     MOVE AP046-INV-CUTOFF-CC   TO  ML015-PURCH-INV-DTE-CC.       04980000
050000     MOVE AP046-INV-CUTOFF-YY   TO  ML015-PURCH-INV-DTE-YY.       04990000
050100                                                                  05000000
050200     MOVE AP046-AP-TRN-CDE      TO  ML015-PURCH-AP-TRANS-CDE.     05010000
050300     MOVE AP046-STR-NBR         TO  ML015-PURCH-STORE-NBR.        05020000
050400     MOVE AP046-DOC-MM          TO  ML015-PURCH-DOC-DTE-MM.       05030000
050500     MOVE AP046-DOC-DD          TO  ML015-PURCH-DOC-DTE-DD.       05040000
050600     MOVE AP046-DOC-CC          TO  ML015-PURCH-DOC-DTE-CC.       05050000
050700     MOVE AP046-DOC-YY          TO  ML015-PURCH-DOC-DTE-YY.       05060000
050800     MOVE AP046-DOC-NBR         TO  ML015-PURCH-DOC-5-NBR.        05070000
050900     MOVE AP046-GRO-COST-AMT    TO  ML015-PURCH-MERCH-AMT         05080000
051000                                    TEMP-MERCH.                   05090000
051100     MOVE AP046-RETL-AMT        TO  ML015-PURCH-RETAIL            05100000
051200                                    TEMP-RETAIL.                  05110000
051300                                                                  05120000
051400     MOVE AP046-FRGT-AMT         TO ML015-PURCH-FRGHT-AMT         05130000
051500                                    TEMP-FRGT.                    05140000
051600     MOVE AP046-DISC-AMT         TO ML015-PURCH-DISCT-AMT         05150000
051700                                    TEMP-DISC.                    05160000
051800     MOVE AP046-NET-COST-AMT     TO ML015-PURCH-NET               05170000
051900                                    TEMP-NET.                     05180000
052000                                                                  05190000
052100     PERFORM 8000-GET-ENT-ID.                                     05200000
052200     MOVE EXTENT-ENT-ID          TO ML015-PURCH-ENT-ID.           05210000
052300                                                                  05220000
052400     IF AP046-SKU-NBR NOT = ZEROES                                05230000
052500        MOVE AP046-SKU-NBR       TO ML015-PURCH-SKU-NBR           05240000
052600     ELSE                                                         05250000
052700        MOVE ZEROES              TO HOLD-SKU-NBR                  05260000
052800        MOVE HOLD-CLASS          TO HOLD-SKU-FIRST5               05270000
052900        MOVE HOLD-SKU-NBR        TO ML015-PURCH-SKU-NBR           05280000
053000     END-IF.                                                      05290000
053100                                                                  05300000
053200     IF AP046-CREDIT                                              05310000
053300        MOVE 02 TO ML015-PURCH-TRANS-CDE                          05320000
053400     ELSE                                                         05330000
053500        IF AP046-CHARGE                                           05340000
053600           MOVE 01 TO ML015-PURCH-TRANS-CDE                       05350000
053700        ELSE                                                      05360000
053800           MOVE 99 TO ML015-PURCH-TRANS-CDE                       05370000
053900        END-IF                                                    05380000
054000     END-IF.                                                      05390000
054100                                                                  05400000
054200     IF  AP046-NET-COST-AMT   EQUAL 0                             05410000
054300     AND AP046-RETL-AMT        EQUAL 0                            05420000
054400**** AND AP046-FRGT-AMT         EQUAL 0                           05430000
054500        ADD 1 TO REC-BYPASS-CTR                                   05440000
054600        GO TO 3000-EXIT.                                          05450000
054700                                                                  05460000
054800     IF ML015-PURCH-MERCH-AMT = 0 AND                             05470000
054900        ML015-PURCH-DISCT-AMT = 0 AND                             05480000
055000        ML015-PURCH-FRGHT-AMT = 0 AND                             05490000
055100        ML015-PURCH-NET = 0 AND                                   05500000
055200        ML015-PURCH-RETAIL = 0                                    05510000
055300        CONTINUE                                                  05520000
055400     ELSE                                                         05530000
052900         MOVE 'N'                   TO WS-LAST-REC                05530129
052900         INITIALIZE WS-COST-AREA                                  05530229
040100         SET WS-IDX TO 1                                          05530329
052900         MOVE ML015-PURCH-FRGHT-AMT TO WS-FRGT-REM                05530432
052900         MOVE ML015-PURCH-MERCH-AMT TO WS-MRCH-REM                05530532
052900         MOVE ML015-PURCH-DISCT-AMT TO WS-DISC-REM                05530732
052900*  ML CANNOT HANDLE COSTS OVER 10 MILLION, SO BREAK THE TRAN      05530833
052900*  INTO MULTIPLE RECS WITH ALL COSTS UNDER 10 MILLION             05530933
055500*  WS-10MILL ACTUALLY CONTAINS 9,999,999.99                       05531033
054800         IF ML015-PURCH-MERCH-AMT > WS-10MILL OR                  05531130
055000            ML015-PURCH-FRGHT-AMT > WS-10MILL                     05531230
055200             PERFORM 3100-SPLIT-TRAN                              05531316
055200                 UNTIL WS-LAST-REC = 'Y'                          05531420
055100             IF ML015-PURCH-NET   > WS-10MILL                     05531518
055200                 PERFORM 3150-SPLIT-NET                           05531618
055700             END-IF                                               05531718
040100             SET WS-IDX TO 1                                      05531818
055500             PERFORM 3300-WRITE-COST-ARRAY                        05531918
055500                 UNTIL WS-COST-NET (WS-IDX) = 0                   05532021
055200         ELSE                                                     05532218
055100             IF ML015-PURCH-NET   > WS-10MILL                     05532318
055200                 PERFORM 3150-SPLIT-NET                           05533018
040100                 SET WS-IDX TO 1                                  05533218
055500                 PERFORM 3300-WRITE-COST-ARRAY                    05533318
055500                     UNTIL WS-COST-NET (WS-IDX) = 0               05533421
055200             ELSE                                                 05534018
055500                 WRITE ML015-ADJST-JOURNAL-REC                    05542018
055500                                  FROM ML015-PURCHASE-RECORD      05543016
055600                ADD 1 TO REC-WRITTEN-CTR                          05550018
055700             END-IF                                               05560018
055700         END-IF                                                   05560118
055700     END-IF.                                                      05561016
055800                                                                  05570000
055900 3000-EXIT.                                                       05580000
056000     EXIT.                                                        05590000
056100     EJECT                                                        05600000
056200                                                                  05610000
056200                                                                  05610105
045500*  GROSS AND/OR FREIGHT ARE OVER 10 MILLION.  SPLIT THE AMOUNTS   05610233
045500*  SO THAT EVERY FIELD IS UNDER 10 MILLION - UP TO 15 RECORDS.    05610333
045500*  LOADING 9 MILLION AS A STARTING POINT, SO THAT THERE IS        05610432
045500*  ROOM FOR MISCELLANOUS COSTS TO BE ADDED IN.                    05610532
055500*  NOTE: FIELD WS-10MILL ACTUALLY CONTAINS 9,999,999.99           05610632
046200 3100-SPLIT-TRAN.                                                 05610732
055500     IF WS-MRCH-REM < WS-10MILL AND                               05610833
055500        WS-FRGT-REM < WS-10MILL                                   05611033
055500         MOVE WS-MRCH-REM       TO ML015-PURCH-MERCH-AMT          05611133
055500         MOVE WS-DISC-REM       TO ML015-PURCH-DISCT-AMT          05611233
055500         MOVE WS-FRGT-REM       TO ML015-PURCH-FRGHT-AMT          05611333
055500         COMPUTE ML015-PURCH-NET =                                05611433
055500                 ML015-PURCH-MERCH-AMT +                          05611533
055500                 ML015-PURCH-FRGHT-AMT -                          05611633
055500                 ML015-PURCH-DISCT-AMT                            05611733
055500         IF ML015-PURCH-NET > WS-10MILL                           05612033
055500             PERFORM 3150-SPLIT-NET                               05612133
055500         ELSE                                                     05612233
055500             PERFORM 3200-LOAD-COST-ARRAY                         05612333
055500         END-IF                                                   05612433
055500         MOVE 'Y'               TO WS-LAST-REC                    05612532
055500     ELSE                                                         05612632
055500         IF WS-MRCH-REM > WS-10MILL                               05612732
055500             MOVE WS-9MILL      TO ML015-PURCH-MERCH-AMT          05612832
055500             SUBTRACT WS-9MILL  FROM WS-MRCH-REM                  05612932
055500         ELSE                                                     05613032
055500             MOVE WS-MRCH-REM   TO ML015-PURCH-MERCH-AMT          05613132
055500             MOVE 0             TO WS-MRCH-REM                    05613236
055500         END-IF                                                   05613336
055500         IF WS-FRGT-REM > WS-10MILL                               05613436
055500             MOVE WS-9MILL      TO ML015-PURCH-FRGHT-AMT          05613536
055500             SUBTRACT WS-9MILL  FROM WS-FRGT-REM                  05613636
055500         ELSE                                                     05613736
055500             MOVE WS-FRGT-REM   TO ML015-PURCH-FRGHT-AMT          05613836
055500             MOVE 0             TO WS-FRGT-REM                    05613936
055500         END-IF                                                   05614036
055500         IF WS-DISC-REM > 0                                       05614136
055500             MOVE WS-DISC-REM   TO ML015-PURCH-DISCT-AMT          05614236
055500             MOVE 0             TO WS-DISC-REM                    05614336
055500         ELSE                                                     05614436
055500             MOVE WS-DISC-REM   TO ML015-PURCH-DISCT-AMT          05614536
055500             MOVE 0             TO WS-DISC-REM                    05614636
055500         END-IF                                                   05614736
055500         COMPUTE ML015-PURCH-NET =                                05614836
055500                 ML015-PURCH-MERCH-AMT +                          05614936
055500                 ML015-PURCH-FRGHT-AMT -                          05615036
055500                 ML015-PURCH-DISCT-AMT                            05615136
055500         IF ML015-PURCH-NET > WS-10MILL                           05615336
055500             PERFORM 3150-SPLIT-NET                               05615436
055500         ELSE                                                     05615536
055500             PERFORM 3200-LOAD-COST-ARRAY                         05615636
055500         END-IF                                                   05615736
055500     END-IF.                                                      05615818
052900                                                                  05616018
046100                                                                  05616117
045500*  GROSS & FREIGHT ARE BOTH BELOW 10 MILLION, BUT THEIR SUM (NET) 05616232
045500*  IS OVER 10 MILLION - SPLIT INTO 2 TRANS                        05623018
046200 3150-SPLIT-NET.                                                  05623118
055500     COMPUTE WS-MRCH-WRK = (ML015-PURCH-MERCH-AMT / 2).           05624234
055500     SUBTRACT WS-MRCH-WRK FROM ML015-PURCH-MERCH-AMT.             05624834
055500     COMPUTE WS-FRGT-WRK  = (ML015-PURCH-FRGHT-AMT / 2).          05625035
055500     SUBTRACT WS-FRGT-WRK FROM ML015-PURCH-FRGHT-AMT.             05625135
055500     COMPUTE ML015-PURCH-NET =                                    05625235
055500                ML015-PURCH-MERCH-AMT +                           05625335
055500                ML015-PURCH-FRGHT-AMT -                           05625435
055500                ML015-PURCH-DISCT-AMT.                            05625535
055500     PERFORM 3200-LOAD-COST-ARRAY.                                05625635
045500                                                                  05625735
055500     MOVE WS-MRCH-WRK           TO ML015-PURCH-MERCH-AMT.         05625835
055500     MOVE WS-FRGT-WRK           TO ML015-PURCH-FRGHT-AMT.         05625935
055500     MOVE 0                     TO ML015-PURCH-DISCT-AMT.         05626035
055500     COMPUTE ML015-PURCH-NET =                                    05626135
055500                ML015-PURCH-MERCH-AMT +                           05626235
055500                ML015-PURCH-FRGHT-AMT -                           05626335
055500                ML015-PURCH-DISCT-AMT.                            05626435
055500     PERFORM 3200-LOAD-COST-ARRAY.                                05626535
045500                                                                  05626635
045500                                                                  05626735
045500*  LOAD THE SPLIT DOLLAR AMOUNTS INTO THE ARRAY                   05626835
046200 3200-LOAD-COST-ARRAY.                                            05626935
045500     MOVE ML015-PURCH-NET       TO WS-COST-NET (WS-IDX).          05627035
045500     MOVE ML015-PURCH-MERCH-AMT TO WS-COST-MERCH (WS-IDX).        05627135
045500     MOVE ML015-PURCH-FRGHT-AMT TO WS-COST-FRGHT (WS-IDX).        05627235
045500     MOVE ML015-PURCH-DISCT-AMT TO WS-COST-DISCT (WS-IDX).        05628018
045800                                                                  05632118
045900     SET WS-IDX UP BY 1.                                          05632618
044400     IF WS-IDX > PC-ARRAY-ENTRY-LIMIT                             05632718
044600        MOVE '3200-LOAD-COST-ARRAY'                               05632818
044700                              TO AA-PARAGRAPH-NAME                05632918
044800        MOVE '*** OVERFLOW OF INTERNAL ARRAY'                     05633018
044900                              TO AA-MESSAGE                       05633119
045000        MOVE '*** NUMBER OF ENTRIES EXCEEDED LIMIT OF 15'         05633218
045100                              TO AA-MESSAGE-2                     05633318
045200        MOVE +4004            TO ABEND-CODE                       05633418
045300        PERFORM Z999-ABEND                                        05633519
045400     END-IF.                                                      05633620
046100                                                                  05633718
045400                                                                  05633818
045400*  FOR EACH ENTRY IN THE ARRAY THAT HAS A NET COST, WRITE 1       05633918
045400*  RECORD TO THE OUTPUT FILE                                      05634018
046200 3300-WRITE-COST-ARRAY.                                           05634118
045800     MOVE WS-COST-MERCH (WS-IDX)  TO ML015-PURCH-MERCH-AMT.       05634718
045800     MOVE WS-COST-FRGHT (WS-IDX)  TO ML015-PURCH-FRGHT-AMT.       05634818
045800     MOVE WS-COST-DISCT (WS-IDX)  TO ML015-PURCH-DISCT-AMT.       05634918
045800     MOVE WS-COST-NET   (WS-IDX)  TO ML015-PURCH-NET.             05635020
045800                                                                  05635218
055500     WRITE ML015-ADJST-JOURNAL-REC                                05635318
055500                                  FROM ML015-PURCHASE-RECORD.     05635418
055600     ADD 1 TO REC-WRITTEN-CTR.                                    05635518
045900     SET WS-IDX UP BY 1.                                          05635618
045500                                                                  05636818
056300 8000-GET-ENT-ID.                                                 05636918
056400                                                                  05637018
056500     INITIALIZE DCLTEXTENT.                                       05640000
056600                                                                  05650000
056700     EXEC SQL                                                     05660000
056800       SELECT A.ENT_ID                                            05670000
056900       INTO  :EXTENT-ENT-ID                                       05680000
057000        FROM  TEXTENT A                                           05690000
057100        WHERE A.DUN_NBR = :AP046-VND-NBR                          05700000
057200     END-EXEC.                                                    05710000
057300                                                                  05720000
057400      EVALUATE TRUE                                               05730000
057500          WHEN SQLCODE = ZERO                                     05740000
057600               CONTINUE                                           05750000
057700                                                                  05760000
057800          WHEN SQLCODE = +100                                     05770000
057900          WHEN SQLWARN0 NOT = SPACES                              05780000
058000          WHEN SQLCODE  NOT = ZERO                                05790000
058100              MOVE '8000-GET-ENT-ID     ' TO AA-PARAGRAPH-NAME    05800000
058200              MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION    05810000
058300              MOVE 'TEXTENT'               TO AA-DB2-TABLE-1      05820000
058400              MOVE '       '               TO AA-DB2-TABLE-2      05830000
058500                                              AA-DB2-TABLE-3      05840000
058600              PERFORM 9998-DB2-ABEND                              05850000
058700      END-EVALUATE.                                               05860000
058800                                                                  05870000
058900 8000-EXIT.  EXIT.                                                05880000
059000                                                                  05890000
059100 8500-GET-INHOUSE-NBR-PO.                                         05900000
059200                                                                  05910000
059300     INITIALIZE DCLTEXTENT.                                       05920000
059400     INITIALIZE DCLTVNDDPT.                                       05930000
059500     INITIALIZE DCLTPURCHS.                                       05940000
059600                                                                  05950000
059700     MOVE AP046-PO-NBR       TO  WS-AP046-PO-VAR.                 05960000
059800                                                                  05970000
059900     EXEC SQL                                                     05980000
060000        SELECT A.INHOUSE_NBR                                      05990000
060100        INTO :VNDDPT-INHOUSE-NBR                                  06000000
060200        FROM TVNDDPT A                                            06010000
060300            ,TPURCHS B                                            06020000
060400        WHERE A.ENT_ID = B.ENT_ID      AND                        06030000
060500              B.VER_STATUS_CDE   = 'A'   AND                      06040000
060600              B.PO_NBR = :WS-AP046-PO-VAR AND                     06050000
060700              A.DEPT_NBR = B.DEPT_NBR                             06060000
060800     END-EXEC.                                                    06070000
060900                                                                  06080000
061000     EVALUATE TRUE                                                06090000
061100         WHEN SQLCODE = ZERO                                      06100000
061200              CONTINUE                                            06110000
061300                                                                  06120000
061400         WHEN SQLCODE = +100                                      06130000
061500               CONTINUE                                           06140000
061600                                                                  06150000
061700         WHEN SQLWARN0 NOT = SPACES                               06160000
061800         WHEN SQLCODE  NOT = ZERO                                 06170000
061900             DISPLAY 'PO NBR = ' WS-AP046-PO-VAR                  06180000
062000             MOVE '8500-GET-INHOUSE-NBR' TO AA-PARAGRAPH-NAME     06190000
062100             MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION     06200000
062200             MOVE 'TPURCHS'               TO AA-DB2-TABLE-1       06210000
062300             MOVE 'TVNDDPT'               TO AA-DB2-TABLE-2       06220000
062400                                             AA-DB2-TABLE-3       06230000
062500             PERFORM 9998-DB2-ABEND.                              06240000
062600                                                                  06250000
062700         IF VNDDPT-INHOUSE-NBR = 0                                06260000
062800            PERFORM 8750-GET-INHOUSE-NMR                          06270000
062900         END-IF.                                                  06280000
063000                                                                  06290000
063100 8750-GET-INHOUSE-NMR.                                            06300000
063200                                                                  06310000
063300     INITIALIZE DCLTEXTENT.                                       06320000
063400     INITIALIZE DCLTVNDDPT.                                       06330000
063500                                                                  06340000
063600     EXEC SQL                                                     06350000
063700       SELECT A.INHOUSE_NBR                                       06360000
063800       INTO  :VNDDPT-INHOUSE-NBR                                  06370000
063900        FROM  TVNDDPT A                                           06380000
064000             ,TEXTENT B                                           06390000
064100        WHERE A.ENT_ID = B.ENT_ID          AND                    06400000
064200              B.DUN_NBR = :AP046-VND-NBR    AND                   06410000
064300              A.DEPT_NBR = :AP046-DEPT-NBR    AND                 06420000
064400              A.VEND_TYP_IND = 'M'                                06430000
064500     END-EXEC.                                                    06440000
064600                                                                  06450000
064700*      IF VNDDPT-INHOUSE-NBR = 0                                  06460038
064800*        MOVE AP046-GRO-COST-AMT    TO WS-DISPLAY-GROSS           06470038
064900*        MOVE AP046-RETL-AMT         TO WS-DISPLAY-RETAIL         06480038
065000*        DISPLAY  AP046-VND-NBR ' ' AP046-DEPT-NBR ' '            06490038
065100*                VNDDPT-INHOUSE-NBR ' ' AP046-PO-NBR ' '          06500038
065200*                WS-DISPLAY-GROSS ' ' WS-DISPLAY-RETAIL ' '       06510038
065300*                AP046-PSTG-TYP-CDE                               06520038
065400*      END-IF.                                                    06530038
065500                                                                  06540000
065600      EVALUATE TRUE                                               06550000
065700          WHEN SQLCODE = ZERO                                     06560000
065800               CONTINUE                                           06570000
065900                                                                  06580000
066000          WHEN SQLCODE = +100                                     06590000
066100                MOVE 1 TO VNDDPT-INHOUSE-NBR                      06600000
066200                                                                  06610000
066300          WHEN SQLWARN0 NOT = SPACES                              06620000
066400          WHEN SQLCODE  NOT = ZERO                                06630000
066500              MOVE '8750-GET-INHOUSE-NBR' TO AA-PARAGRAPH-NAME    06640000
066600              MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION    06650000
066700              MOVE 'TEXTENT'               TO AA-DB2-TABLE-1      06660000
066800              MOVE 'TVNDDPT'               TO AA-DB2-TABLE-2      06670000
066900                                              AA-DB2-TABLE-3      06680000
067000              PERFORM 9998-DB2-ABEND.                             06690000
067100                                                                  06700000
067200 9998-DB2-ABEND.                                                  06710000
067300                                                                  06720000
067400     DISPLAY AA-ABEND-LIT.                                        06730000
067500     DISPLAY AA-DB2-ERROR-LIT.                                    06740000
067600     DISPLAY AA-PROGRAM-LIT.                                      06750000
067700     DISPLAY AA-PARAGRAPH-LIT.                                    06760000
067800     DISPLAY AA-DB2-OPERATION-LIT.                                06770000
067900     DISPLAY AA-DB2-TABLE-1.                                      06780000
068000     DISPLAY AA-DB2-TABLE-2.                                      06790000
068100     DISPLAY AA-DB2-TABLE-3.                                      06800000
068200     DISPLAY AA-DB2-TABLE-4.                                      06810000
068300     SET AC-DB2-ERROR TO TRUE.                                    06820000
068400                                                                  06830000
068500     COPY DPPD004.                                                06840000
068600     CALL 'ILBOABN0' USING ABEND-CODE.                            06850000
067100                                                                  06851019
089800*----------------------------------------------------------------*06860019
089900*    ABEND ROUTINE                                                06870019
090000*----------------------------------------------------------------*06880019
090100 Z999-ABEND.                                                      06890019
090200                                                                  06900019
044700     CLOSE ADJSTMNT-JOURNAL-FILE                                  06901019
044800           ADJ-REFORMAT-FILE.                                     06902019
044900                                                                  06903019
090700     DISPLAY AA-ABEND-LIT.                                        06950019
090800     DISPLAY AA-PROGRAM-LIT.                                      06960019
090900     DISPLAY AA-PARAGRAPH-LIT.                                    06970019
091000     DISPLAY AA-MESSAGE-LINE.                                     06980019
091100     DISPLAY AA-MESSAGE-LINE-2.                                   06990019
091200                                                                  07000019
091300     CALL 'ILBOABN0' USING ABEND-CODE.                            07010019
091400                                                                  07020019
091500                                                                  07030019
