000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             RDKRP024.                                00050002
000600 AUTHOR.                 JIM LEIKNESS.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            MAY 2003.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*                                                                 00120000
001300*  THIS PROGRAM WILL PROCESS MAIL CHECK REQUESTS. IT WILL         00130000
001400*  CREATE THE OUTPUT THAT WILL BE PRINTED ON THE CHECKS AS WELL   00140000
001500*  AS UPDATE THE REFUND TABLE WITH THE CHECK ASSIGNED TO THE      00150000
001600*  PARTICULAR REQUEST.                                            00160002
001800*                                                                 00180000
001900*   INPUT: INP01  - CONTAINS FIRST CHECK NUMBER.                  00190059
001910*          INP02  - CONTAINS ACCOUNT NUMBER.                      00191039
002400*                                                                 00240000
002500*  OUTPUT: OUT01  - FILE FOR BANK RECONCILIATION.                 00250040
002600*          OUT02  - FILE FOR CHECKPOINT RESTART.                  00260040
002600*          OUT03  - FILE CONTAINS FIRST CHECK NUMBER OF NEXT RUN. 00270059
002800*          RPT01  - CHECK REGISTER REPORT.                        00280039
002810*          RPT02  - RECONCILIATION SUMMARY.                       00281039
002820*          RPT03  - CONTAINS FIRST NAME, LAST NAME, ADDRESS,      00282040
002830*                   CITY, STATE, ZIP CODE, TRANSACTION TOTAL      00283040
002840*                   AMOUNT, STORE, REGISTER, TRANSACTION NUMBER.  00284040
002820*          RPT04  - CONTAINS FIRST NAME, LAST NAME, ADDRESS,      00285065
002830*                   CITY, STATE, ZIP CODE, TRANSACTION TOTAL      00286065
002840*                   AMOUNT, STORE, REGISTER, TRANSACTION NUMBER.  00287065
002900*                                                                 00290039
003000*                                                                 00300000
003100***************************************************************** 00310000
003200 ENVIRONMENT DIVISION.                                            00320000
003300***************************************************************** 00330000
003400                                                                  00340000
003500 CONFIGURATION SECTION.                                           00350000
003600                                                                  00360000
003700 SOURCE-COMPUTER.        IBM-3090.                                00370000
003800                                                                  00380000
003900 OBJECT-COMPUTER.        IBM-3090.                                00390000
004000                                                                  00400000
004100 INPUT-OUTPUT SECTION.                                            00410000
004200                                                                  00420000
004300 FILE-CONTROL.                                                    00430000
004400                                                                  00440000
004730     SELECT CHECK-NUMBER-FILE                                     00450056
004730         ASSIGN TO INP01.                                         00460056
004730                                                                  00470056
004710     SELECT ACCOUNT-FILE                                          00471030
004720         ASSIGN TO INP02.                                         00472030
004730                                                                  00473030
005100     SELECT APK-FILE                                              00510000
005200         ASSIGN TO OUT01.                                         00520040
005300                                                                  00530000
005310     SELECT CHECKPOINT-FILE                                       00531001
005320         ASSIGN TO OUT02.                                         00532040
005330                                                                  00533001
005310     SELECT CHECK-NUMBER-OUT-FILE                                 00534056
005320         ASSIGN TO OUT03.                                         00535056
005330                                                                  00536056
005400     SELECT REGISTER-REPORT                                       00540000
005500         ASSIGN TO RPT01.                                         00550000
005600                                                                  00560000
005610     SELECT RECONCILE-REPORT                                      00561030
005620         ASSIGN TO RPT02.                                         00562030
005621                                                                  00562140
005622     SELECT MAIL-CHECK-FILE                                       00562240
005623         ASSIGN TO RPT03.                                         00562340
005624                                                                  00562440
005622     SELECT MAIL-CHECK-FILE-2                                     00562565
005623         ASSIGN TO RPT04.                                         00562665
005624                                                                  00562765
005700******************************************************************00570000
005800 DATA DIVISION.                                                   00580000
005900******************************************************************00590000
006000                                                                  00600000
006100 FILE SECTION.                                                    00610000
006200                                                                  00620000
006810 FD  ACCOUNT-FILE                                                 00681029
006820     RECORDING MODE IS F                                          00682029
006830     BLOCK CONTAINS 0 RECORDS                                     00683029
006840     LABEL RECORDS ARE STANDARD.                                  00684029
006850 01  ACCOUNT-RECORD                   PIC  X(80).                 00685029
006860                                                                  00686029
004730 FD  CHECK-NUMBER-FILE                                            00687044
006820     RECORDING MODE IS F                                          00687156
006830     BLOCK CONTAINS 0 RECORDS                                     00687256
006840     LABEL RECORDS ARE STANDARD.                                  00687356
004730 01  CHECK-NUMBER-RECORD              PIC  X(80).                 00689356
006860                                                                  00690244
004730 FD  CHECK-NUMBER-OUT-FILE                                        00690356
006820     RECORDING MODE IS F                                          00690456
006830     BLOCK CONTAINS 0 RECORDS                                     00690556
006840     LABEL RECORDS ARE STANDARD.                                  00690656
004730 01  CHECK-NUMBER-OUT-RECORD          PIC  X(80).                 00690756
006860                                                                  00690856
006900 FD  MAIL-CHECK-FILE                                              00691044
007000     RECORDING MODE IS F                                          00700000
007100     BLOCK CONTAINS 0  RECORDS                                    00710000
007200     LABEL RECORDS ARE STANDARD.                                  00720000
007400 01  MAIL-CHECK-RECORD                PIC  X(375).                00740064
007500                                                                  00750000
006900 FD  MAIL-CHECK-FILE-2                                            00751065
007000     RECORDING MODE IS F                                          00752065
007100     BLOCK CONTAINS 0  RECORDS                                    00753065
007200     LABEL RECORDS ARE STANDARD.                                  00754065
007400 01  MAIL-CHECK-RECORD-2              PIC  X(375).                00755065
007500                                                                  00756065
007600 FD  APK-FILE                                                     00760000
007700     RECORDING MODE IS F                                          00770000
007800     BLOCK CONTAINS 0  RECORDS                                    00780000
007900     LABEL RECORDS ARE STANDARD.                                  00790000
008100 01  APK-RECORD                       PIC  X(80).                 00810034
008200                                                                  00820000
008210 FD  CHECKPOINT-FILE                                              00821001
008220     RECORDING MODE IS F                                          00822001
008230     BLOCK CONTAINS 0  RECORDS                                    00823001
008240     LABEL RECORDS ARE STANDARD.                                  00824001
008260 01  CHECKPOINT-RECORD                PIC  X(36).                 00826027
008270                                                                  00827001
008300 FD  REGISTER-REPORT                                              00830000
008400     RECORDING MODE IS F                                          00840000
008500     BLOCK CONTAINS 0 RECORDS.                                    00850000
008600 01  REGISTER-LINE                    PIC  X(80).                 00860014
008700                                                                  00870000
008710 FD  RECONCILE-REPORT                                             00871029
008720     RECORDING MODE IS F                                          00872029
008730     BLOCK CONTAINS 0 RECORDS.                                    00873029
008740 01  RECONCILE-LINE                   PIC  X(80).                 00874029
008750                                                                  00875029
008800******************************************************************00880000
008900 WORKING-STORAGE SECTION.                                         00890000
009000******************************************************************00900000
009100                                                                  00910000
009200 01  FILLER                           PIC  X(50) VALUE            00920000
009300     ' *** WORKING STORAGE STARTS HERE FOR RDKRP024 *** '.        00930026
009400                                                                  00940000
010200*-----------------------------------------------------------------01020044
010200*    FILE LAYOUT CONTAINING STARTING CHECK NUMBER                 01021056
010200*-----------------------------------------------------------------01022044
010200 01  RD-CK-NBR-RECORD.                                            01023044
010200     05  RD-START-CHECK-NBR             PIC  9(09)  VALUE ZERO.   01024044
010200     05  FILLER                         PIC  X(71)  VALUE SPACE.  01025044
010200                                                                  01026044
010300******************************************************************01030030
010301* ACCOUNT CONTROL CARD.                                           01030130
010302******************************************************************01030230
010303 01  ACCOUNT-CONTROL-CARD.                                        01030330
010304     05  AC-ACCOUNT-NUMBER            PIC  9(08) VALUE ZERO.      01030430
010305     05  FILLER                       PIC  X(72) VALUE SPACE.     01030530
010306                                                                  01030630
010310******************************************************************01030762
010306 01 CA-COMMON-AREA.                                               01030862
010306    05 CA-REFUND-AMT              PIC 9(05)V9(02) VALUE 0.        01030962
010306    05 CA-REFUND-IN-WORDS         PIC X(80)       VALUE SPACE.    01031062
010306                                                                  01031162
010310******************************************************************01032062
010400 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       01040049
010500                                                   COMP SYNC.     01050000
010600     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     01060000
010700     88  AC-DB2-ERROR                            VALUE +4013.     01070000
010900                                                                  01090000
011000******************************************************************01100000
011100 01  PS-PROGRAM-SWITCHES.                                         01110000
011200     05  PS-END-OF-CURSOR             PIC  X(01) VALUE 'N'.       01120000
011300         88  PS-END-OF-CURSOR-YES                VALUE 'Y'.       01130000
011200     05  PS-CHECK-NUMBER-SW           PIC  X(01) VALUE 'N'.       01131044
011300         88  PS-END-OF-CHECK-NUMBER              VALUE 'Y'.       01132044
011400     05  PS-END-OF-FILE-1-SW          PIC  X(01) VALUE 'N'.       01140000
011500         88  PS-END-OF-FILE-1-YES                VALUE 'Y'.       01150000
011600     05  PS-END-OF-FILE-2-SW          PIC  X(01) VALUE 'N'.       01160030
011700         88  PS-END-OF-FILE-2-YES                VALUE 'Y'.       01170032
011600     05  PS-END-OF-CHECK-FILE-SW      PIC  X(01) VALUE 'N'.       01171056
011700         88  PS-END-OF-CHECK-FILE                VALUE 'Y'.       01172056
012200                                                                  01220000
012300******************************************************************01230000
012400 01  PC-CONSTANTS.                                                01240000
012610     05  PC-MAX-RETRIES               PIC S9(03) VALUE 3          01261010
012620                                                 COMP-3.          01262010
012700     05  PC-PROGRAM-NAME              PIC  X(08) VALUE            01270000
012800                                                 'RDKRP024'.      01280026
012801     05  PC-REPORT-NBR-1              PIC  X(01) VALUE '1'.       01280100
012802     05  PC-REPORT-NBR-2              PIC  X(01) VALUE '2'.       01280229
012810     05  PC-MAX-LINES                 PIC  S9(04) COMP            01281000
012820                                                 VALUE +57.       01282041
012900******************************************************************01290000
013000                                                                  01291044
013000                                                                  01311044
013000 01  PV-MISC-FIELDS.                                              01312044
013200     05  PV-REMAINDER                 PIC  9(01) VALUE ZERO.      01320000
013300     05  PV-MISC                      PIC  9(08) VALUE ZERO.      01330000
013600     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     01360000
013700     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     01370000
013800     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     01380000
013900     05  PV-DB2-OPERATION             PIC  X(30) VALUE SPACE.     01390000
014500     05  PV-FIRST-NAME                PIC  X(30) VALUE SPACE.     01450000
014600     05  PV-LAST-NAME                 PIC  X(30) VALUE SPACE.     01460000
014640     05  PV-SEQ-NBR                   PIC  9(03) VALUE ZERO.      01464022
014700     05  PV-POINTER                   PIC  9(02) VALUE 1.         01470000
014800     05  PV-CHECK-DATE.                                           01480000
014900         10  PV-CHECK-CC              PIC  X(02) VALUE SPACE.     01490000
014910         10  PV-CHECK-YY              PIC  X(02) VALUE SPACE.     01491000
015000         10  FILLER                   PIC  X(01) VALUE '-'.       01500000
015100         10  PV-CHECK-MM              PIC  X(02) VALUE SPACE.     01510000
015200         10  FILLER                   PIC  X(01) VALUE '-'.       01520000
015300         10  PV-CHECK-DD              PIC  X(02) VALUE SPACE.     01530000
015600     05  PV-PAGE-CNT                  PIC  S9(04) COMP            01560000
015700                                                 VALUE ZERO.      01570000
015800     05  PV-LINE-CNT                  PIC  S9(04) COMP            01580000
015900                                                 VALUE ZERO.      01590000
015921     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         01592111
015922                                                   COMP SYNC.     01592210
015930     05  PV-CHECK-COUNT               PIC  9(06) VALUE ZERO.      01593000
015940                                                                  01594000
016000     05  PV-SYSTEM-DATE.                                          01600000
016100         10  PV-SYSTEM-CC             PIC 9(02)  VALUE ZERO.      01610000
016110         10  PV-SYSTEM-YY             PIC 9(02)  VALUE ZERO.      01611000
016200         10  PV-SYSTEM-MM             PIC 9(02)  VALUE ZERO.      01620000
016300         10  PV-SYSTEM-DD             PIC 9(02)  VALUE ZERO.      01630000
016301                                                                  01630100
016310     05  PV-CURR-DATE-CCYYMMDD.                                   01631000
016320         10  PV-CURR-DATE-CCYY         PIC  9(04) VALUE ZERO.     01632000
016330         10  PV-CURR-DATE-MM           PIC  9(02) VALUE ZERO.     01633000
016340         10  PV-CURR-DATE-DD           PIC  9(02) VALUE ZERO.     01634000
016341                                                                  01634100
016350     05  PV-CURR-TIME.                                            01635000
016360        10  PV-CURR-TIME-HH           PIC  9(02) VALUE ZERO.      01636000
016370        10  PV-CURR-TIME-MM           PIC  9(02) VALUE ZERO.      01637000
016380        10  PV-CURR-TIME-SSHH         PIC  9(04) VALUE ZERO.      01638000
016400                                                                  01640000
016410     05  PV-REG-TOTAL                 PIC  S9(09)V99 COMP-3       01641000
016420                                                 VALUE ZERO.      01642000
016500******************************************************************01650000
016600*  DETAIL LINE FOR MAIL CHECK RECORD.                             01660000
016700******************************************************************01670000
016800 01  DL-DETAIL-LINE.                                              01680000
016900     05  DL-NAME                      PIC  X(61) VALUE SPACE.     01690000
017000     05  FILLER                       PIC  X(01) VALUE SPACE.     01700000
017100     05  DL-ADDRESS                   PIC  X(35) VALUE SPACE.     01710000
017200     05  FILLER                       PIC  X(01) VALUE SPACE.     01720000
017300     05  DL-ADDRESS-2                 PIC  X(40) VALUE SPACE.     01730000
017400     05  FILLER                       PIC  X(01) VALUE SPACE.     01740000
017500     05  DL-ADDRESS-3                 PIC  X(40) VALUE SPACE.     01750000
017600     05  FILLER                       PIC  X(01) VALUE SPACE.     01760000
017700     05  DL-CITY                      PIC  X(20) VALUE SPACE.     01770000
017800     05  FILLER                       PIC  X(01) VALUE SPACE.     01780000
017900     05  DL-STATE                     PIC  X(02) VALUE SPACE.     01790000
018000     05  FILLER                       PIC  X(01) VALUE SPACE.     01800000
018100     05  DL-ZIP-CODE                  PIC  X(05) VALUE SPACE.     01810000
018200     05  FILLER                       PIC  X(01) VALUE SPACE.     01820000
018300     05  DL-TRAN-TOTAL                PIC  *,***,**9.99           01830000
018400                                           VALUE ZERO.            01840000
018500     05  DL-TRAN-TOTAL-V        REDEFINES DL-TRAN-TOTAL           01850000
018600                                      PIC  X(12).                 01860000
018700     05  DL-CHECK-NBR                 PIC  ZZZ999999 VALUE ZERO.  01870000
018800     05  FILLER                       PIC  X(01) VALUE SPACE.     01880000
018900     05  DL-STORE-NBR                 PIC  9(04) VALUE ZERO.      01890042
019000     05  FILLER                       PIC  X(01) VALUE SPACE.     01900000
019100     05  DL-RGST-ID                   PIC  9(04) VALUE ZERO.      01910000
019200     05  FILLER                       PIC  X(01) VALUE SPACE.     01920000
019300     05  DL-TRAN-NBR                  PIC  9(04) VALUE ZERO.      01930000
019400     05  FILLER                       PIC  X(01) VALUE SPACE.     01940000
019500     05  DL-CHECK-DATE                PIC  X(10) VALUE SPACE.     01950000
019400     05  FILLER                       PIC  X(01) VALUE SPACE.     01960047
019500     05  DL-DATE-OF-RETURN            PIC  X(10) VALUE SPACE.     01961047
019400     05  FILLER                       PIC  X(01) VALUE SPACE.     01962047
019500     05  DL-STORE-NAME                PIC  X(25) VALUE SPACE.     01963047
019400     05  FILLER                       PIC  X(01) VALUE SPACE.     01964062
019400     05  DL-CHECK-AMT-CHAR            PIC  X(80) VALUE SPACE.     01965062
019700                                                                  01970000
019800******************************************************************01980000
019900*  CHECK REGISTER                                                 01990000
020000******************************************************************02000000
020100 01 REG-HEADING.                                                  02010000
020200     05 FILLER                       PIC  X(30) VALUE SPACES.     02020029
020300     05 FILLER                       PIC  X(15) VALUE             02030029
020400                                            'CHECK REGISTER '.    02040029
020500                                                                  02050000
020600 01 REG-COL-HEADING-1.                                            02060000
020700     05 FILLER                       PIC  X(01) VALUE SPACE.      02070029
020800     05 FILLER                       PIC  X(14) VALUE             02080029
020810                                             'NAME & ADDRESS'.    02081029
020900     05 FILLER                       PIC  X(07) VALUE SPACE.      02090029
021000     05 FILLER                       PIC  X(05) VALUE 'CHECK'.    02100029
021100     05 FILLER                       PIC  X(06) VALUE SPACE.      02110029
021200     05 FILLER                       PIC  X(05) VALUE 'CHECK'.    02120029
021300     05 FILLER                       PIC  X(08) VALUE SPACE.      02130029
021400     05 FILLER                       PIC  X(05) VALUE 'CHECK'.    02140029
021500     05 FILLER                       PIC  X(02) VALUE SPACE.      02150029
021600     05 FILLER                       PIC  X(05) VALUE 'STORE'.    02160029
021610     05 FILLER                       PIC  X(01) VALUE SPACE.      02161029
021620     05 FILLER                       PIC  X(04) VALUE 'RGST'.     02162029
021630     05 FILLER                       PIC  X(01) VALUE SPACE.      02163029
021640     05 FILLER                       PIC  X(04) VALUE 'TRAN'.     02164029
021650     05 FILLER                       PIC  X(01) VALUE SPACE.      02165029
021660     05 FILLER                       PIC  X(03) VALUE 'SEQ'.      02166029
021700                                                                  02170000
021710 01 REG-COL-HEADING-2.                                            02171014
021740     05 FILLER                      PIC  X(23) VALUE SPACE.       02174029
021750     05 FILLER                      PIC  X(04) VALUE 'DATE'.      02175029
021760     05 FILLER                      PIC  X(07) VALUE SPACE.       02176029
021770     05 FILLER                      PIC  X(03) VALUE 'NBR'.       02177029
021780     05 FILLER                      PIC  X(09) VALUE SPACE.       02178029
021790     05 FILLER                      PIC  X(06) VALUE 'AMOUNT'.    02179029
021791     05 FILLER                      PIC  X(02) VALUE SPACE.       02179129
021792     05 FILLER                      PIC  X(03) VALUE 'NBR'.       02179229
021793     05 FILLER                      PIC  X(03) VALUE SPACE.       02179329
021794     05 FILLER                      PIC  X(02) VALUE 'ID'.        02179429
021795     05 FILLER                      PIC  X(03) VALUE SPACE.       02179529
021796     05 FILLER                      PIC  X(02) VALUE 'ID'.        02179629
021797     05 FILLER                      PIC  X(02) VALUE SPACE.       02179729
021798     05 FILLER                      PIC  X(03) VALUE 'NBR'.       02179829
021799                                                                  02179914
021800 01  REG-DETAIL-LINE1.                                            02180000
021900     05  REG-NAME                   PIC  X(19) VALUE SPACE.       02190029
022000     05  FILLER                     PIC  X(01) VALUE SPACE.       02200029
022100     05  REG-DATE                   PIC  X(10) VALUE SPACE.       02210029
022200     05  FILLER                     PIC  X(01) VALUE SPACE.       02220029
022300     05  REG-CHECK-NBR              PIC  ZZZZZZ9                  02230029
022400                                               VALUE ZERO.        02240029
022500     05  FILLER                     PIC  X(02) VALUE SPACE.       02250029
022600     05  REG-AMOUNT                 PIC  Z,ZZZ,ZZZ.99             02260029
022700                                               VALUE ZERO.        02270029
022800     05  FILLER                     PIC  X(01) VALUE SPACE.       02280029
022910     05  REG-STORE-ID               PIC  X(05) VALUE SPACE.       02291029
022920     05  FILLER                     PIC  X(01) VALUE SPACE.       02292029
022930     05  REG-RGST-ID                PIC  X(04) VALUE SPACE.       02293029
022940     05  FILLER                     PIC  X(01) VALUE SPACE.       02294029
022950     05  REG-TRN-NBR                PIC  X(04) VALUE SPACE.       02295029
022960     05  FILLER                     PIC  X(01) VALUE SPACE.       02296029
022970     05  REG-SEQ-NBR                PIC  X(03) VALUE SPACE.       02297029
023000                                                                  02300000
023100 01  REG-DETAIL-LINE2.                                            02310000
023200     05  REG-ADDR-1                 PIC  X(40) VALUE SPACE.       02320029
023300                                                                  02330000
023400 01  REG-DETAIL-LINE3.                                            02340000
023500     05  REG-ADDR-2                 PIC  X(40) VALUE SPACE.       02350029
023600                                                                  02360000
023700 01  REG-TOTAL-LINE.                                              02370000
023800     05  FILLER                     PIC  X(10)  VALUE SPACE.      02380029
023900     05  FILLER                     PIC  X(22)                    02390029
023910                             VALUE 'TOTALS:       CHECKS: '.      02391029
024000     05  REG-TOT-CHK                PIC  ZZZZZ9 VALUE ZERO.       02400029
024100     05  FILLER                     PIC  X(02)  VALUE SPACE.      02410029
024300     05  REG-TOT-AMT                PIC  Z,ZZZ,ZZZ.99             02430029
024400                                                VALUE ZERO.       02440029
024500                                                                  02450000
024510******************************************************************02451029
024520*  REFUND RECONCILIATION REPORT                                   02452029
024530******************************************************************02453029
024540 01 REC-SUM-HEADING.                                              02454029
024550     05 FILLER                     PIC  X(18)    VALUE SPACES.    02455029
024560     05 FILLER                     PIC  X(38)    VALUE            02456029
024570                     'CUSTOMER REFUND RECONCILIATION SUMMARY'.    02457029
024580                                                                  02458029
024590 01 REC-SUM-LINE1.                                                02459029
024591     05 FILLER                     PIC  X(23) VALUE SPACE.        02459137
024592     05 FILLER                     PIC  X(10) VALUE 'CHECK DATE'. 02459229
024593     05 FILLER                     PIC  X(04) VALUE SPACE.        02459329
024594     05 REC-SUM-DATE.                                             02459429
024595        10 REC-SUM-MM              PIC  X(02) VALUE SPACE.        02459531
024596        10 FILLER                  PIC  X(01) VALUE '/'.          02459631
024597        10 REC-SUM-DD              PIC  X(02) VALUE SPACE.        02459731
024598        10 FILLER                  PIC  X(01) VALUE '/'.          02459831
024599        10 REC-SUM-YY              PIC  X(02) VALUE SPACE.        02459931
024600                                                                  02460029
024601 01 REC-SUM-LINE2.                                                02460129
024602     05 FILLER                     PIC  X(15) VALUE SPACE.        02460237
024603     05 FILLER                     PIC  X(18) VALUE               02460329
024604                                            'FIRST CHECK ISSUED'. 02460429
024605     05 FILLER                     PIC  X(04) VALUE SPACE.        02460535
024606     05 REC-SUM-FRST-CK            PIC  ZZZZZZZ9                  02460629
024607                                              VALUE ZERO.         02460729
024608                                                                  02460829
024609 01 REC-SUM-LINE3.                                                02460929
024610     05 FILLER                     PIC  X(16) VALUE SPACE.        02461037
024611     05 FILLER                     PIC  X(17) VALUE               02461129
024612                                          'LAST CHECK ISSUED'.    02461229
024613     05 FILLER                     PIC  X(04) VALUE SPACE.        02461335
024614     05 REC-SUM-LAST-CK            PIC  ZZZZZZZ9                  02461429
024615                                              VALUE ZERO.         02461529
024616                                                                  02461629
024617 01 REC-SUM-LINE4.                                                02461729
024618     05 FILLER                     PIC  X(17) VALUE SPACE.        02461838
024619     05 FILLER                     PIC  X(16) VALUE               02461929
024620                                          'NUMBER OF CHECKS'.     02462029
024621     05 FILLER                     PIC  X(08) VALUE SPACE.        02462129
024622     05 REC-SUM-NBR                PIC  ZZZ9  VALUE ZERO.         02462229
024623                                                                  02462329
024630 01 REC-SUM-LINE5.                                                02463029
024640     05 FILLER                     PIC  X(16) VALUE SPACE.        02464037
024650     05 FILLER                     PIC  X(17) VALUE               02465033
024651                                          'TOTAL AMOUNT PAID'.    02465129
024660     05 FILLER                     PIC  X(02) VALUE SPACE.        02466029
024661     05 REC-SUM-AMT                PIC  ZZZ,ZZ9.99 VALUE ZERO.    02466129
024663                                                                  02466329
024664 01 REC-SUM-LINE6.                                                02466429
024665     05 FILLER                     PIC  X(14) VALUE SPACE.        02466537
024666     05 FILLER                     PIC  X(34) VALUE               02466629
024667                       '***  END OF REPORT RDKRP024-2  ***'.      02466729
024670***************************************************************** 02467029
024700*   OUTPUT RECORD FOR FILE GOING TO APKUT010                    * 02470000
024800***************************************************************** 02480000
024910     COPY RDRD040.                                                02491028
024920                                                                  02492028
027310***************************************************************** 02731001
027320*   RECORD LAYOUT FOR CHECKPOINT RESTART FILE                   * 02732013
027330***************************************************************** 02733001
027332     COPY RDRD039.                                                02733214
027333                                                                  02733314
027410***************************************************************** 02741001
027500*   INDICATOR VARIABLES.                                          02750000
027600***************************************************************** 02760000
027700*                                                                 02770000
027800 01  IV-INDICATOR-VARIABLE.                                       02780000
028010     05  IV-ADJ-RFND-AMT              PIC  S9(04) COMP            02801000
028020                                                 VALUE ZERO.      02802000
028100                                                                  02810000
028200******************************************************************02820000
028300*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             02830000
028400******************************************************************02840000
028500                                                                  02850000
028600     COPY DPWS500.                                                02860000
028700                                                                  02870000
028800******************************************************************02880000
028900*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            02890000
029000******************************************************************02900000
029200     COPY DPWS004.                                                02920000
029300                                                                  02930000
029400******************************************************************02940000
029500*  STANDARD 75 COL HEADER                                         02950013
029600******************************************************************02960000
029800     COPY DPWS075O.                                               02980013
029900                                                                  02990000
030000******************************************************************03000000
030100*  DB2 COMMUNICATION AREA.                                        03010000
030200******************************************************************03020000
030300                                                                  03030000
030400     EXEC SQL                                                     03040000
030500          INCLUDE SQLCA                                           03050000
030600     END-EXEC.                                                    03060000
030700                                                                  03070000
030700******************************************************************03071047
030700*    XST_LOC                                                     *03072047
030700******************************************************************03073047
030700     EXEC SQL                                                     03074047
030700         INCLUDE XST00001                                         03075047
030700     END-EXEC.                                                    03076047
030700                                                                  03077047
030800******************************************************************03080000
030900*  DB2 TABLE DB2PDBA.RDT_CUST TABLE.                              03090000
031000******************************************************************03100000
031100                                                                  03110000
031200     EXEC SQL                                                     03120000
031300          INCLUDE RDT00000                                        03130000
031400     END-EXEC.                                                    03140000
031500                                                                  03150000
031600******************************************************************03160000
031700*  DB2 TABLE DB2PDBA.RDT_MAL_CK_RFND TABLE.                       03170000
031800******************************************************************03180000
031900                                                                  03190000
032000     EXEC SQL                                                     03200000
032100          INCLUDE RDT00001                                        03210000
032200     END-EXEC.                                                    03220000
032300                                                                  03230000
032400******************************************************************03240000
032500*  MAIL-CHECK - LOOK FOR GOOD MAIL CHECK REQUESTS.                03250000
032600******************************************************************03260000
032700     EXEC SQL                                                     03270000
032800          DECLARE MAIL-CHECK CURSOR WITH HOLD FOR                 03280000
032900          SELECT  A.CUST_ID                                       03290000
033200                 ,B.LAST_NM                                       03320000
033300                 ,B.FRST_NM                                       03330000
033500                 ,B.M2A_LNE_1_ADDR                                03350000
033600                 ,B.M2A_LNE_2_ADDR                                03360000
033700                 ,B.M2A_CTY_NM                                    03370000
033800                 ,B.M2A_ST_CDE                                    03380000
033900                 ,B.M2A_PSTL_CDE                                  03390000
034000                 ,A.RFND_AMT                                      03400000
034010                 ,A.ADJ_RFND_AMT                                  03401000
034100                 ,A.STR_NBR                                       03410000
034200                 ,A.STR_RGST_ID                                   03420000
034300                 ,A.RGST_TRN_NBR                                  03430000
034400                 ,A.RFND_SEQ_NBR                                  03440000
062502                 ,A.RFND_REQ_DTE                                  03441048
034500            FROM  RDT_MAL_CK_RFND  A,                             03450000
034600                  RDT_CUST   B                                    03460000
034700           WHERE  A.CUST_ID = B.CUST_ID                           03470000
034800             AND  A.RFND_STAT_CDE = 'A'                           03480000
034900             AND  A.RFND_CK_NBR IS NULL                           03490000
035000          ORDER BY A.CUST_ID                                      03500000
035100                                                                  03510000
035200     END-EXEC.                                                    03520000
035300                                                                  03530000
035400***************************************************************** 03540000
035500 PROCEDURE DIVISION.                                              03550000
035600******************************************************************03560000
035700                                                                  03570000
035800******************************************************************03580000
035900 0000-MAINLINE-PARAGRAPH.                                         03590000
036000******************************************************************03600000
036100                                                                  03610000
036200     PERFORM 1000-INITIALIZE.                                     03620000
036500                                                                  03650000
036600     PERFORM 3000-POPULATE-DATA                                   03660000
036800       UNTIL PS-END-OF-CURSOR-YES.                                03680000
036810                                                                  03681000
036900     PERFORM 7000-END-OF-JOB.                                     03690000
037000                                                                  03700000
037700     STOP RUN.                                                    03770000
037800                                                                  03780000
037900******************************************************************03790000
038000 1000-INITIALIZE.                                                 03800000
038100*     OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS.   03810000
038200******************************************************************03820000
038300                                                                  03830000
038401     OPEN INPUT ACCOUNT-FILE                                      03840156
038402                CHECK-NUMBER-FILE.                                03840256
038402                                                                  03840344
038500     OPEN OUTPUT MAIL-CHECK-FILE                                  03850029
038500                 MAIL-CHECK-FILE-2                                03851065
038600                 REGISTER-REPORT                                  03860000
038601                 RECONCILE-REPORT                                 03860130
038610                 CHECKPOINT-FILE                                  03861004
038700                 CHECK-NUMBER-OUT-FILE                            03870056
038700                 APK-FILE.                                        03871056
038800                                                                  03880000
039200     READ CHECK-NUMBER-FILE INTO RD-CK-NBR-RECORD                 03930856
039000        AT END                                                    03930956
039100           SET PS-END-OF-CHECK-FILE    TO TRUE.                   03931056
039200                                                                  03931144
024606     MOVE  RD-START-CHECK-NBR  TO REC-SUM-FRST-CK.                03931258
010200                                                                  03931458
039310     MOVE FUNCTION CURRENT-DATE  TO PV-SYSTEM-DATE.               03934053
039350                                                                  03935000
039400     MOVE PV-SYSTEM-CC   TO PV-CHECK-CC.                          03940000
039410     MOVE PV-SYSTEM-YY   TO PV-CHECK-YY.                          03941000
039420     MOVE PV-SYSTEM-YY   TO PV-CHECK-YY.                          03942029
039500     MOVE PV-SYSTEM-MM   TO PV-CHECK-MM.                          03950000
039600     MOVE PV-SYSTEM-DD   TO PV-CHECK-DD.                          03960000
039700                                                                  03970000
040700                                                                  04070000
042300     READ ACCOUNT-FILE INTO ACCOUNT-CONTROL-CARD                  04230030
042310        AT END                                                    04231030
042320           SET PS-END-OF-FILE-2-YES    TO TRUE.                   04232030
042321                                                                  04232130
042322     IF PS-END-OF-FILE-2-YES                                      04232230
042323        MOVE '1000-INITIALIZE'        TO PV-PARAGRAPH-NAME        04232330
042324        MOVE 'ACCOUNT CONTROL CARD IS EMPTY'                      04232430
042325                                      TO PV-OPERATION-MSG-1       04232530
042326        SET AC-CONTROL-CARD-ERROR     TO TRUE                     04232630
042327        PERFORM 9999-ABEND                                        04232730
042328     END-IF.                                                      04232830
042329                                                                  04232930
042330     DISPLAY 'PROGRAM NAME:       ' PC-PROGRAM-NAME.              04233030
042331     DISPLAY 'CONTROL CARD 2:     ' ACCOUNT-CONTROL-CARD.         04233130
042332                                                                  04233230
042333     IF AC-ACCOUNT-NUMBER IS NUMERIC                              04233330
042334        CONTINUE                                                  04233430
042335     ELSE                                                         04233530
042336        MOVE '1000-INITIALIZE'        TO PV-PARAGRAPH-NAME        04233630
042337        MOVE 'INVALID ACCOUNT NUMBER' TO PV-OPERATION-MSG-1       04233730
042338        MOVE AC-ACCOUNT-NUMBER        TO PV-OPERATION-MSG-2       04233830
042339        SET AC-CONTROL-CARD-ERROR     TO TRUE                     04233930
042340        PERFORM 9999-ABEND                                        04234030
042341     END-IF.                                                      04234130
042342     PERFORM 8200-WRITE-REGISTRY-HEADERS.                         04234230
042343     PERFORM 7100-OPEN-MAIL-CHECK.                                04234330
042350     PERFORM 5000-FETCH-MAIL-CHECK.                               04235000
042400                                                                  04240000
050700******************************************************************05070000
050800 3000-POPULATE-DATA.                                              05080000
050900*     POPULATE NECESSARY FIELDS AND PRINT RECORD.                 05090000
051000******************************************************************05100000
051100                                                                  05110000
051200     INITIALIZE DL-DETAIL-LINE.                                   05120042
051300                                                                  05130042
051610*----------------------------------------                         05161002
051620*   POPULATE FIELDS ON REFUND CHECK                               05162002
051630*----------------------------------------                         05163002
051632                                                                  05163242
051640     MOVE RDT00000-FRST-NM           TO PV-FIRST-NAME.            05164002
051650     MOVE RDT00000-LAST-NM           TO PV-LAST-NAME.             05165002
051660     MOVE RDT00000-M2A-LNE-1-ADDR    TO DL-ADDRESS                05166002
051670                                        REG-ADDR-1.               05167002
051680     MOVE RDT00000-M2A-CTY-NM        TO DL-CITY.                  05168002
051690     MOVE RDT00000-M2A-ST-CDE        TO DL-STATE.                 05169002
051700     MOVE RDT00000-M2A-PSTL-CDE      TO DL-ZIP-CODE.              05170000
051701                                                                  05170100
051710     IF IV-ADJ-RFND-AMT = -1                                      05171000
051800        MOVE RDT00001-RFND-AMT       TO DL-TRAN-TOTAL             05180000
051800        MOVE RDT00001-RFND-AMT       TO CA-REFUND-AMT             05180163
051800        CALL 'ARKUT050' USING CA-COMMON-AREA                      05180263
051800        MOVE CA-REFUND-IN-WORDS      TO DL-CHECK-AMT-CHAR         05180363
051801        ADD  RDT00001-RFND-AMT       TO PV-REG-TOTAL              05180462
051802     ELSE                                                         05180562
051803        MOVE RDT00001-ADJ-RFND-AMT   TO DL-TRAN-TOTAL             05180662
051800        MOVE RDT00001-ADJ-RFND-AMT   TO CA-REFUND-AMT             05180766
051800        CALL 'ARKUT050' USING CA-COMMON-AREA                      05180863
051800        MOVE CA-REFUND-IN-WORDS      TO DL-CHECK-AMT-CHAR         05180963
051804        ADD  RDT00001-ADJ-RFND-AMT   TO PV-REG-TOTAL              05181062
051805     END-IF.                                                      05181162
051806                                                                  05182062
051900     MOVE RDT00001-STR-NBR           TO DL-STORE-NBR              05190047
051910                                        XST00001-LOC-NBR.         05191047
                                                                        05192047
           PERFORM 5500-FIND-STORE-NAME.                                05193047
                                                                        05194047
052000     MOVE RDT00001-STR-RGST-ID       TO DL-RGST-ID.               05200022
052010                                                                  05201023
052100     MOVE RDT00001-RGST-TRN-NBR      TO DL-TRAN-NBR.              05210022
052110                                                                  05211023
052200     MOVE RDT00000-M2A-LNE-2-ADDR    TO DL-ADDRESS-2.             05220000
052300     MOVE RD-START-CHECK-NBR         TO DL-CHECK-NBR.             05230044
052400     MOVE PV-CHECK-DATE              TO DL-CHECK-DATE.            05240000
062502     MOVE RDT00001-RFND-REQ-DTE      TO DL-DATE-OF-RETURN.        05241048
052520                                                                  05252000
052600     STRING PV-FIRST-NAME DELIMITED BY SPACE                      05260000
052700            INTO DL-NAME WITH POINTER PV-POINTER.                 05270000
052800                                                                  05280000
052900     MOVE SPACE                      TO DL-NAME(PV-POINTER:1).    05290000
053000                                                                  05300000
053100     COMPUTE PV-POINTER = PV-POINTER + 1.                         05310000
053200                                                                  05320000
053300     MOVE PV-LAST-NAME               TO DL-NAME(PV-POINTER:30).   05330000
053400     MOVE 1                          TO PV-POINTER.               05340000
053500                                                                  05350000
053700     PERFORM 8000-WRITE-OUTPUT.                                   05370000
054100                                                                  05410000
054200     ADD +1                          TO PV-CHECK-COUNT.           05420000
054400                                                                  05440000
054500     MOVE RD-START-CHECK-NBR         TO RDT00001-RFND-CK-NBR.     05450051
054600*-----                                                            05460000
054700*----  POPULATE FIELDS ON THE CHECK REGISTER                      05470000
054800*-----                                                            05480000
054900     MOVE DL-NAME                   TO   REG-NAME.                05490022
055000     MOVE DL-CHECK-DATE             TO   REG-DATE.                05500022
055100     MOVE DL-CHECK-NBR              TO   REG-CHECK-NBR.           05510022
055200     MOVE DL-TRAN-TOTAL             TO   REG-AMOUNT.              05520022
055201     MOVE DL-STORE-NBR              TO   REG-STORE-ID.            05520122
055230     MOVE DL-RGST-ID                TO   REG-RGST-ID.             05523022
055250     MOVE DL-TRAN-NBR               TO   REG-TRN-NBR.             05525022
055280                                                                  05528022
055300     MOVE RDT00001-RFND-SEQ-NBR     TO   PV-SEQ-NBR.              05530022
055301     MOVE PV-SEQ-NBR                TO   REG-SEQ-NBR.             05530122
055310                                                                  05531000
056211     STRING RDT00000-M2A-LNE-2-ADDR DELIMITED BY '  '             05621100
056212               ' '                  DELIMITED BY SIZE             05621200
056220            RDT00000-M2A-CTY-NM     DELIMITED BY '  '             05622000
056221               ' '                  DELIMITED BY SIZE             05622100
056230            RDT00000-M2A-ST-CDE     DELIMITED BY SIZE             05623000
056231               ' '                  DELIMITED BY SIZE             05623100
056240            RDT00000-M2A-PSTL-CDE   DELIMITED BY '  '             05624000
056280       INTO REG-ADDR-2                                            05628000
056290                                                                  05629000
056300     IF PV-LINE-CNT > PC-MAX-LINES                                05630000
056400        PERFORM 8200-WRITE-REGISTRY-HEADERS                       05640000
056500     END-IF.                                                      05650000
056600                                                                  05660000
056700     PERFORM 8300-WRITE-REGISTRY.                                 05670000
056800*-----                                                            05680000
056900*----  POPULATE FIELDS FOR THE CHECK RECONCILIATION FILE          05690028
057000*-----                                                            05700000
057010     MOVE  RD-START-CHECK-NBR        TO RD040-CHECK-NUMBER.       05701044
057011     STRING RDT00000-FRST-NM DELIMITED BY '  '                    05701128
057012            ' '              DELIMITED BY SIZE                    05701228
057013            RDT00000-LAST-NM DELIMITED BY '  '                    05701328
057014       INTO RD040-VENDOR-NAME.                                    05701428
057020                                                                  05702028
057030     MOVE  PV-CHECK-MM               TO RD040-FULL-MONTH.         05703030
057031     MOVE  PV-CHECK-DD               TO RD040-FULL-DAY.           05703130
057032     MOVE  PV-CHECK-YY               TO RD040-FULL-YEAR.          05703230
057040     MOVE  AC-ACCOUNT-NUMBER         TO RD040-ACCOUNT-NUMBER.     05704030
057050                                                                  05705028
057051     IF IV-ADJ-RFND-AMT = -1                                      05705128
057052        MOVE RDT00001-RFND-AMT       TO RD040-CHECK-AMOUNT        05705228
057053     ELSE                                                         05705328
057054        MOVE RDT00001-ADJ-RFND-AMT   TO RD040-CHECK-AMOUNT        05705428
057055     END-IF.                                                      05705528
057060                                                                  05706028
058110*------------------------------------------------                 05811002
058120*   POPULATE FIELDS FOR CHECKPOINT RESTART FILE                   05812002
058130*------------------------------------------------                 05813002
058140     MOVE RDT00001-CUST-ID        TO RD039-CUST-ID.               05814014
058150     MOVE RDT00001-STR-RGST-ID    TO RD039-STR-RGST-ID.           05815015
058160     MOVE RDT00001-RGST-TRN-NBR   TO RD039-RGST-TRN-NBR.          05816014
058170     MOVE RDT00001-RFND-SEQ-NBR   TO RD039-RFND-SEQ-NBR.          05817015
058180     MOVE RD-START-CHECK-NBR      TO RD039-CHECK-NBR.             05818044
058181     MOVE PV-CHECK-DATE           TO RD039-CHECK-DATE             05818114
058191*------------------------------------------------                 05819102
058192                                                                  05819202
058200     PERFORM 8500-WRITE-APK-FILE.                                 05820000
058210     PERFORM 8600-WRITE-CHKPT-FILE.                               05821003
058400                                                                  05822044
058300     ADD +1   TO RD-START-CHECK-NBR.                              05822144
058420     PERFORM 5000-FETCH-MAIL-CHECK.                               05842344
058430                                                                  05843000
062410******************************************************************06241000
062420 5000-FETCH-MAIL-CHECK.                                           06242000
062430******************************************************************06243000
062440     PERFORM WITH TEST AFTER                                      06244009
062441        VARYING PV-RETRY-COUNTER                                  06244109
062442        FROM 1 BY 1                                               06244209
062443        UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                  06244309
062444               OR SQLCODE = +100                                  06244409
062445               OR SQLCODE = 0)                                    06244509
062446                                                                  06244609
062450        EXEC SQL                                                  06245010
062460           FETCH MAIL-CHECK                                       06246010
062470            INTO :RDT00001-CUST-ID                                06247010
062480                ,:RDT00000-LAST-NM                                06248010
062490                ,:RDT00000-FRST-NM                                06249010
062491                ,:RDT00000-M2A-LNE-1-ADDR                         06249110
062492                ,:RDT00000-M2A-LNE-2-ADDR                         06249210
062493                ,:RDT00000-M2A-CTY-NM                             06249310
062494                ,:RDT00000-M2A-ST-CDE                             06249410
062495                ,:RDT00000-M2A-PSTL-CDE                           06249510
062496                ,:RDT00001-RFND-AMT                               06249610
062497                ,:RDT00001-ADJ-RFND-AMT                           06249710
062498                 :IV-ADJ-RFND-AMT                                 06249810
062499                ,:RDT00001-STR-NBR                                06249910
062500                ,:RDT00001-STR-RGST-ID                            06250010
062501                ,:RDT00001-RGST-TRN-NBR                           06250110
062502                ,:RDT00001-RFND-SEQ-NBR                           06250210
062502                ,:RDT00001-RFND-REQ-DTE                           06250348
062503        END-EXEC                                                  06250448
062504                                                                  06250548
062505        EVALUATE TRUE                                             06250648
062506           WHEN SQLCODE = 0                                       06250748
062508           WHEN SQLCODE = +100                                    06250809
062520           WHEN SQLCODE = -911                                    06252009
062521              CONTINUE                                            06252109
062522           WHEN OTHER                                             06252209
062523              MOVE '5000-FETCH-MAIL-CHECK'  TO PV-PARAGRAPH-NAME  06252309
062524              MOVE 'ERROR DURING FETCH'     TO PV-DB2-OPERATION   06252409
062525              SET AC-DB2-ERROR              TO TRUE               06252509
062526              PERFORM 9100-SQL-ABEND                              06252609
062529        END-EVALUATE                                              06252909
062530     END-PERFORM.                                                 06253009
062531                                                                  06253109
062532     IF SQLCODE = +100                                            06253209
062533        DISPLAY '*** END OF PROCESSING ***'                       06253309
062534        MOVE PV-CHECK-COUNT  TO REG-TOT-CHK                       06253429
062535                                REC-SUM-NBR                       06253529
062537        COMPUTE REC-SUM-LAST-CK = RD-START-CHECK-NBR - 1          06253744
062546        SET PS-END-OF-CURSOR-YES   TO TRUE                        06254637
062547     END-IF.                                                      06254737
062550******************************************************************06255047
062550*     - RETRIEVES THE STORE NAME FROM THE DB2 LOCATION TABLE.    *06256247
062550******************************************************************06256447
062550 5500-FIND-STORE-NAME.                                            06256551
062550     EXEC SQL                                                     06256647
062550        SELECT LOC_NM                                             06256747
062550          INTO  :XST00001-LOC-NM                                  06256847
062550          FROM  XST_LOC                                           06256947
062550         WHERE  LOC_NBR     = :XST00001-LOC-NBR                   06257047
062550     END-EXEC.                                                    06257147
062550     EVALUATE TRUE                                                06257247
062550         WHEN SQLCODE = +0                                        06257347
062550             MOVE XST00001-LOC-NM    TO DL-STORE-NAME             06257448
062550         WHEN SQLCODE = +100                                      06257647
062550             MOVE SPACES             TO DL-STORE-NAME             06257748
062550         WHEN OTHER                                               06257847
062550             MOVE '5500-FIND-STORE-NAME          '                06257951
062550                               TO PV-PARAGRAPH-NAME               06258047
062550             MOVE 'SELECT LOC-NM FROM XST_LOC    '                06258147
062550                               TO PV-DB2-OPERATION                06258249
062525             SET AC-DB2-ERROR              TO TRUE                06258650
062526             PERFORM 9100-SQL-ABEND                               06258750
062550     END-EVALUATE.                                                06258847
062550                                                                  06259047
065400******************************************************************06540000
065500 7000-END-OF-JOB.                                                 06550000
065600******************************************************************06560000
065700                                                                  06570000
058400     WRITE CHECK-NUMBER-OUT-RECORD FROM RD-CK-NBR-RECORD.         06573056
058400                                                                  06574044
065800     PERFORM 7200-CLOSE-MAIL-CHECK.                               06580700
065801                                                                  06580800
065810     IF PV-LINE-CNT > PC-MAX-LINES                                06581000
065820          PERFORM 8200-WRITE-REGISTRY-HEADERS                     06582000
065830     END-IF.                                                      06583019
065831                                                                  06583100
065832     PERFORM 8400-WRITE-TOTALS.                                   06583219
065833     PERFORM 8700-WRITE-RECONCILE-RPT.                            06583330
065900                                                                  06590000
066000     CLOSE MAIL-CHECK-FILE                                        06600029
066000           MAIL-CHECK-FILE-2                                      06601065
066100           ACCOUNT-FILE                                           06610030
066101           APK-FILE                                               06610130
066110           CHECKPOINT-FILE                                        06611004
066200           REGISTER-REPORT                                        06620030
066210           RECONCILE-REPORT                                       06621044
066210           CHECK-NUMBER-FILE                                      06622056
066210           CHECK-NUMBER-OUT-FILE.                                 06623056
066300                                                                  06630000
066400******************************************************************06640000
066500 7100-OPEN-MAIL-CHECK.                                            06650000
066600******************************************************************06660000
066700                                                                  06670000
066800     EXEC SQL                                                     06680000
066810          OPEN MAIL-CHECK                                         06681000
066820     END-EXEC.                                                    06682000
066830                                                                  06683000
066840     IF NOT SQLCODE = ZERO                                        06684000
066850        MOVE '7100-OPEN-MAIL-CHECK'   TO PV-PARAGRAPH-NAME        06685000
066860        MOVE 'OPEN MAIL-CHECK CSR'    TO PV-DB2-OPERATION         06686000
066870        SET AC-DB2-ERROR              TO TRUE                     06687000
066880        PERFORM 9100-SQL-ABEND                                    06688000
066890     END-IF.                                                      06689000
066891                                                                  06689100
066892******************************************************************06689200
066893 7200-CLOSE-MAIL-CHECK.                                           06689300
066894******************************************************************06689400
066895                                                                  06689500
066896     EXEC SQL                                                     06689600
066897          CLOSE MAIL-CHECK                                        06689700
066898     END-EXEC.                                                    06689800
066899                                                                  06689900
066900     IF NOT SQLCODE = ZERO                                        06690000
066901        MOVE '7200-CLOSE-MAIL-CHECK'  TO PV-PARAGRAPH-NAME        06690100
066902        MOVE 'CLOSE OF CURSOR'        TO PV-DB2-OPERATION         06690200
066903        SET AC-DB2-ERROR              TO TRUE                     06690300
066904        PERFORM 9100-SQL-ABEND                                    06690400
066905     END-IF.                                                      06690500
066906                                                                  06690600
066930******************************************************************06693000
067000 8000-WRITE-OUTPUT.                                               06700000
067100******************************************************************06710000
067200                                                                  06720000
067300     WRITE MAIL-CHECK-RECORD                                      06730029
067400        FROM DL-DETAIL-LINE.                                      06740000
067500                                                                  06750000
067300     WRITE MAIL-CHECK-RECORD-2                                    06760065
067400        FROM DL-DETAIL-LINE.                                      06770065
067500                                                                  06771065
067800                                                                  06780000
069100******************************************************************06910000
069200 8200-WRITE-REGISTRY-HEADERS.                                     06920000
069300******************************************************************06930000
069400                                                                  06940000
069500       ADD 1  TO PV-PAGE-CNT.                                     06950000
069600       MOVE PV-PAGE-CNT TO DP075O-PAGE-NUMBER.                    06960015
069601       MOVE PC-REPORT-NBR-1   TO DP075O-REPORT-NUMBER.            06960115
069610       MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD. 06961000
069620       ACCEPT PV-CURR-TIME FROM TIME.                             06962000
069630                                                                  06963000
069640       MOVE PV-CURR-DATE-MM             TO DP075O-RUN-MONTH       06964029
069641                                           REC-SUM-MM.            06964129
069650       MOVE PV-CURR-DATE-DD             TO DP075O-RUN-DAY         06965032
069651                                           REC-SUM-DD.            06965129
069660       MOVE PV-CURR-DATE-CCYY(3:2)      TO DP075O-RUN-YEAR        06966035
069661                                           REC-SUM-YY.            06966129
069670                                                                  06967000
069680       MOVE PV-CURR-TIME-HH             TO DP075O-RUN-HOUR.       06968015
069690       MOVE PV-CURR-TIME-MM             TO DP075O-RUN-MINUTE.     06969015
069691       MOVE PC-PROGRAM-NAME             TO DP075O-PROGRAM-NAME.   06969115
069692                                                                  06969200
069700       WRITE REGISTER-LINE FROM DP075O-STANDARD-HEADER-75-COLS    06970016
069800             AFTER ADVANCING PAGE.                                06980000
069900       MOVE +1 TO PV-LINE-CNT.                                    06990000
070000                                                                  07000000
070100       INITIALIZE REGISTER-LINE.                                  07010000
070200                                                                  07020000
070300       WRITE REGISTER-LINE FROM REG-HEADING                       07030000
070400            AFTER ADVANCING 1 LINES.                              07040000
070500       ADD +1 TO PV-LINE-CNT.                                     07050000
070600                                                                  07060000
070700       INITIALIZE REGISTER-LINE.                                  07070000
070800                                                                  07080000
070900       WRITE REGISTER-LINE FROM REG-COL-HEADING-1                 07090000
071000            AFTER ADVANCING 2 LINES.                              07100000
071100       ADD +2 TO PV-LINE-CNT.                                     07110000
071101                                                                  07110107
071110       INITIALIZE REGISTER-LINE.                                  07111007
071120                                                                  07112007
071121       WRITE REGISTER-LINE FROM REG-COL-HEADING-2                 07112114
071122            AFTER ADVANCING 1 LINES.                              07112214
071123       ADD +1 TO PV-LINE-CNT.                                     07112314
071124                                                                  07112414
071125       INITIALIZE REGISTER-LINE.                                  07112514
071126                                                                  07112614
071130       MOVE SPACES   TO         REG-COL-HEADING-1                 07113007
071131       WRITE REGISTER-LINE FROM REG-COL-HEADING-1                 07113107
071140            AFTER ADVANCING 1 LINES.                              07114007
071150       ADD +1 TO PV-LINE-CNT.                                     07115007
071200                                                                  07120000
071300******************************************************************07130000
071400 8300-WRITE-REGISTRY.                                             07140000
071500******************************************************************07150000
071600                                                                  07160000
071700                                                                  07170000
071800      WRITE REGISTER-LINE FROM REG-DETAIL-LINE1                   07180000
071900            AFTER ADVANCING 1 LINES.                              07190000
072000                                                                  07200000
072100      INITIALIZE REGISTER-LINE.                                   07210000
072200                                                                  07220000
072300      WRITE REGISTER-LINE FROM REG-DETAIL-LINE2                   07230000
072400            AFTER ADVANCING 1 LINES.                              07240000
072500                                                                  07250000
072600      INITIALIZE REGISTER-LINE.                                   07260000
072700                                                                  07270000
072800      WRITE REGISTER-LINE FROM REG-DETAIL-LINE3                   07280000
072900            AFTER ADVANCING 1 LINES.                              07290000
073000                                                                  07300000
073100      INITIALIZE REGISTER-LINE.                                   07310000
073200                                                                  07320000
073201      MOVE SPACES   TO REG-DETAIL-LINE3                           07320113
073202                                                                  07320213
073210      WRITE REGISTER-LINE FROM REG-DETAIL-LINE3                   07321013
073220            AFTER ADVANCING 1 LINES.                              07322013
073230                                                                  07323013
073300      ADD +4 TO PV-LINE-CNT.                                      07330013
073400                                                                  07340000
073500******************************************************************07350000
073600 8400-WRITE-TOTALS.                                               07360000
073700******************************************************************07370000
073800                                                                  07380000
073900      IF PV-LINE-CNT > PC-MAX-LINES                               07390000
074000         PERFORM 8200-WRITE-REGISTRY-HEADERS                      07400000
074100      END-IF.                                                     07410000
074200                                                                  07420000
074211      MOVE PV-REG-TOTAL   TO REG-TOT-AMT                          07421129
074212                             REC-SUM-AMT.                         07421229
074220                                                                  07422000
074300      WRITE REGISTER-LINE FROM REG-TOTAL-LINE                     07430000
074400            AFTER ADVANCING 2 LINES.                              07440000
074500                                                                  07450000
074600******************************************************************07460000
074700 8500-WRITE-APK-FILE.                                             07470000
074800******************************************************************07480000
074900      WRITE APK-RECORD FROM RD040-DETAIL-RECORD.                  07490028
075000                                                                  07500000
075100      INITIALIZE RD040-DETAIL-RECORD.                             07510043
075200                                                                  07520043
075411******************************************************************07541103
075412 8600-WRITE-CHKPT-FILE.                                           07541203
075413******************************************************************07541303
075414      WRITE CHECKPOINT-RECORD FROM RD039-RECORD.                  07541414
075416                                                                  07541603
075417******************************************************************07541729
075418 8700-WRITE-RECONCILE-RPT.                                        07541829
075419******************************************************************07541929
075420                                                                  07542029
075421       MOVE 1  TO PV-PAGE-CNT.                                    07542129
075423       MOVE PV-PAGE-CNT TO DP075O-PAGE-NUMBER.                    07542336
075424       MOVE PC-REPORT-NBR-2   TO DP075O-REPORT-NUMBER.            07542436
075425       MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD. 07542536
075426       ACCEPT PV-CURR-TIME FROM TIME.                             07542636
075427                                                                  07542736
075428       MOVE PV-CURR-DATE-MM             TO DP075O-RUN-MONTH.      07542836
075429       MOVE PV-CURR-DATE-DD             TO DP075O-RUN-DAY.        07542936
075430       MOVE PV-CURR-DATE-CCYY(3:2)      TO DP075O-RUN-YEAR.       07543036
075431                                                                  07543136
075432       MOVE PV-CURR-TIME-HH             TO DP075O-RUN-HOUR.       07543236
075433       MOVE PV-CURR-TIME-MM             TO DP075O-RUN-MINUTE.     07543336
075434       MOVE PC-PROGRAM-NAME             TO DP075O-PROGRAM-NAME.   07543436
075435                                                                  07543536
075436       WRITE RECONCILE-LINE FROM DP075O-STANDARD-HEADER-75-COLS.  07543636
075437                                                                  07543736
075438       MOVE +1 TO PV-LINE-CNT.                                    07543836
075439                                                                  07543936
075440       INITIALIZE RECONCILE-LINE.                                 07544036
075441                                                                  07544136
075442       WRITE RECONCILE-LINE FROM REC-SUM-HEADING                  07544236
075443            AFTER ADVANCING 1 LINES.                              07544336
075444       ADD +1 TO PV-LINE-CNT.                                     07544436
075445                                                                  07544536
075446       INITIALIZE RECONCILE-LINE.                                 07544636
075447                                                                  07544736
075448       WRITE RECONCILE-LINE FROM REC-SUM-LINE1                    07544836
075449            AFTER ADVANCING 10 LINES.                             07544936
075450       ADD +10 TO PV-LINE-CNT.                                    07545036
075451                                                                  07545136
075452       INITIALIZE RECONCILE-LINE.                                 07545236
075453                                                                  07545336
075454       WRITE RECONCILE-LINE FROM REC-SUM-LINE2                    07545436
075455            AFTER ADVANCING 3 LINES.                              07545536
075456       ADD +3 TO PV-LINE-CNT.                                     07545636
075457                                                                  07545736
075458       INITIALIZE RECONCILE-LINE.                                 07545836
075459                                                                  07545936
075460       WRITE RECONCILE-LINE FROM REC-SUM-LINE3                    07546036
075461            AFTER ADVANCING 3 LINES.                              07546136
075462       ADD +3 TO PV-LINE-CNT.                                     07546236
075463                                                                  07546336
075464       INITIALIZE RECONCILE-LINE.                                 07546436
075465                                                                  07546536
075466       WRITE RECONCILE-LINE FROM REC-SUM-LINE4                    07546636
075467            AFTER ADVANCING 3 LINES.                              07546736
075468       ADD +3 TO PV-LINE-CNT.                                     07546836
075469                                                                  07546936
075470       INITIALIZE RECONCILE-LINE.                                 07547036
075471                                                                  07547136
075472       WRITE RECONCILE-LINE FROM REC-SUM-LINE5                    07547236
075473            AFTER ADVANCING 3 LINES.                              07547336
075474       ADD +3 TO PV-LINE-CNT.                                     07547436
075475                                                                  07547536
075476       INITIALIZE RECONCILE-LINE.                                 07547636
075477                                                                  07547736
075478       WRITE RECONCILE-LINE FROM REC-SUM-LINE6                    07547836
075479            AFTER ADVANCING 10 LINES.                             07547936
075480       ADD +10 TO PV-LINE-CNT.                                    07548036
075481                                                                  07548136
075485******************************************************************07548536
075486 9100-SQL-ABEND.                                                  07548636
075487*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.07548736
075490******************************************************************07549029
075500                                                                  07550000
075600     DISPLAY '** ABEND     **'.                                   07560000
075700     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                07570000
075800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07580000
075900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               07590000
076000                                                                  07600000
076100******************************************************************07610000
076200* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     07620000
076300* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      07630000
076400******************************************************************07640000
076500                                                                  07650000
076600     COPY DPPD004.                                                07660042
076700                                                                  07670000
076800     SET AC-DB2-ERROR TO TRUE.                                    07680000
076900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07690049
077000                                                                  07700000
077100******************************************************************07710000
077200 9999-ABEND.                                                      07720000
077300*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  07730000
077400******************************************************************07740000
077500                                                                  07750000
077600     DISPLAY '** ABEND           **'.                             07760000
077700     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          07770000
077800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07780000
077900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       07790000
078000     DISPLAY '** INVALID DATA    ** = ' PV-OPERATION-MSG-2.       07800000
078100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07810049
078200                                                                  07820000
078300********************** END OF PROGRAM ****************************07830000
