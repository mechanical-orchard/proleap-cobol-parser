000100 IDENTIFICATION DIVISION.                                         00020001
000200 PROGRAM-ID.      XSKRP012.                                       00030001
000300 AUTHOR.          DOUG JONES / NANCY MARTIN                       00040001
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050001
000500 DATE-WRITTEN.    04/28/2003.                                     00060001
000600 DATE-COMPILED.                                                   00070001
000700******************************************************************00080001
000800**XS DOMAIN TABLE INTEGRITY PROCESS - FOR TABLE XST_SKU_ATTR      00090001
000900******************************************************************00100001
001000**THIS PROGRAM VALIDATES THE DATA IN THE XS DOMAIN IS THE SAME    00110001
001100**AS THE DATA IN THE SOR                                          00120001
NEMADD**   THIS PROGRAM WAS CLONED FROM XSKRP009.                       00121001
NEMADD**   PROGRAM CREATED FOR NEW PROMO SYSTEM WORK WR21428            00122017
001200******************************************************************00130001
001300 ENVIRONMENT DIVISION.                                            00140001
001400 CONFIGURATION SECTION.                                           00150001
001500 SOURCE-COMPUTER.        IBM-3090.                                00160001
001600 OBJECT-COMPUTER.        IBM-3090.                                00170001
001700 INPUT-OUTPUT SECTION.                                            00180001
001800 FILE-CONTROL.                                                    00190001
001900                                                                  00200001
002000     SELECT SKIP-RECD-CNTL-FILE                                   00210001
002100            ASSIGN TO INP01.                                      00220001
002400     SELECT SOR-SKU-ATTR-EXTRACT-FILE                             00230001
002500            ASSIGN TO INP02.                                      00240001
002600     SELECT XS-SKU-ATTR-EXTRACT-FILE                              00250001
002700            ASSIGN TO INP03.                                      00260001
002800     SELECT XS-SKU-ATTR-INTEG-RPT-FILE                            00270001
002900            ASSIGN TO RPT01.                                      00280001
003000                                                                  00290001
003100 DATA DIVISION.                                                   00300001
003200 FILE SECTION.                                                    00310001
003300                                                                  00320001
003400 FD  SKIP-RECD-CNTL-FILE                                          00330001
003500     RECORDING MODE F                                             00340001
003600     BLOCK CONTAINS 0 RECORDS                                     00350001
003700     LABEL RECORDS ARE OMITTED                                    00360001
003800     DATA RECORD IS SKIP-RECD-CNTL-RECORD.                        00370001
003900 01  SKIP-RECD-CNTL-RECORD            PIC X(080).                 00380001
004700                                                                  00390001
004800 FD  SOR-SKU-ATTR-EXTRACT-FILE                                    00400001
004900     RECORDING MODE F                                             00410001
005000     BLOCK CONTAINS 0 RECORDS                                     00420001
005100     LABEL RECORDS ARE OMITTED                                    00430001
005200     DATA RECORD IS SOR-SKU-ATTR-EXTRACT-RECORD.                  00440001
005300 01  SOR-SKU-ATTR-EXTRACT-RECORD     PIC X(500).                  00450002
005400                                                                  00460001
005500 FD  XS-SKU-ATTR-EXTRACT-FILE                                     00470001
005600     RECORDING MODE F                                             00480001
005700     BLOCK CONTAINS 0 RECORDS                                     00490001
005800     LABEL RECORDS ARE OMITTED                                    00500001
005900     DATA RECORD IS XS-SKU-ATTR-EXTRACT-RECORD.                   00510001
006000 01  XS-SKU-ATTR-EXTRACT-RECORD      PIC X(004).                  00520003
006100                                                                  00530001
006200 FD  XS-SKU-ATTR-INTEG-RPT-FILE                                   00540001
006300     RECORDING MODE IS F                                          00550001
006400     BLOCK CONTAINS 0  RECORDS.                                   00560001
006500 01  XS-SKU-ATTR-INTEG-RPT-RECORD    PIC  X(200).                 00570001
006600                                                                  00580001
006700 WORKING-STORAGE SECTION.                                         00590001
006800                                                                  00600001
006900 01  FILLER                              PIC X(41)                00610001
007000     VALUE 'WORKING STORAGE STARTS HERE FOR XSKRP012'.            00620001
007100                                                                  00630001
007200 01  PS-PROGRAM-SWITCHES.                                         00640001
007300     05  PS-END-SKIP-RECD-FILE-SW        PIC X(01) VALUE 'N'.     00650001
007400         88  PS-END-SKIP-RECD-FILE                 VALUE 'Y'.     00660001
007500         88  PS-NOT-END-SKIP-RECD-FILE             VALUE 'N'.     00670001
007900     05  PS-END-OF-SOR-SKU-ATTR-SW       PIC X(01) VALUE 'N'.     00680001
008000         88  PS-END-OF-SOR-SKU-ATTR                VALUE 'Y'.     00690001
008100         88  PS-NOT-END-OF-SOR-SKU-ATTR            VALUE 'N'.     00700001
008200     05  PS-END-OF-XS-SKU-ATTR-SW        PIC X(01) VALUE 'N'.     00710001
008300         88  PS-END-OF-XS-SKU-ATTR                 VALUE 'Y'.     00720001
008400         88  PS-NOT-END-OF-XS-SKU-ATTR             VALUE 'N'.     00730001
008800     05  PS-INTR-UPC-ID-ERROR-SW         PIC X(01) VALUE 'N'.     00770001
008900         88  PS-INTR-UPC-ID-ERROR                  VALUE 'Y'.     00780001
009000         88  PS-NO-INTR-UPC-ID-ERROR             VALUE 'N'.       00790001
009100     05  PS-ERROR-FOUND-SW               PIC X(01) VALUE 'N'.     00800001
009200         88  PS-ERROR-FOUND                        VALUE 'Y'.     00810001
009300         88  PS-NO-ERROR-FOUND                     VALUE 'N'.     00820001
009400                                                                  00830001
010500 01  PC-PROGRAM-CONSTANTS.                                        00900001
010600     05  PC-CURRENT-PROGRAM-NAME         PIC X(08)  VALUE         00910001
010700                                                    'XSKRP012'.   00920001
010800     05  PC-REPORT-NBR-1                 PIC  9(01) VALUE 1.      00930001
010900     05  PC-ONE                          PIC  9(01) VALUE 1.      00940001
011200     05  PC-MAX-REPORT-LINES             PIC S9(05) VALUE +74     00950001
011300                                                    COMP-3.       00960001
011400                                                                  00970001
011500     05  PC-NO-ERROR-MESSAGE             PIC  X(200) VALUE        00980001
011600         'NO ERRORS'.                                             00990001
011900                                                                  01020001
012000     05  PC-MISMATCHED-INTR-UPC-ID       PIC  X(35) VALUE         01030001
012100         'INTR UPC ID NUMBERS NOT IN SYNCH   '.                   01040014
012200                                                                  01050001
012600     05  PC-MISSING-FROM-SOR-SKU-ATTR    PIC  X(53) VALUE         01090001
012700         'MATCHING DATA IS NOT FOUND ON SOR SKU ATTR EXTRACT'.    01100001
012800                                                                  01110001
012900     05  PC-MISSING-FROM-XS-SKU-ATTR     PIC  X(52) VALUE         01120001
013000         'MATCHING DATA IS NOT FOUND ON XS SKU ATTR EXTRACT'.     01130001
013100                                                                  01140001
013200 01  PV-MISCELANEOUS.                                             01150001
013300     05  PV-TEMP-INTR-UPC-ID             PIC S9(11) COMP          01160022
                                                          VALUE ZEROS.  01161022
013400     05  PV-PRINT-RECORD                 PIC X(200) VALUE SPACE.  01170001
013500     05  PV-LINE-SPACING                 PIC S9(04) VALUE ZEROES  01180001
013600                                                    COMP SYNC.    01190001
013700     05  PV-CURR-TIME.                                            01200001
013800        10  PV-CURR-TIME-HH              PIC  9(02) VALUE ZEROES. 01210001
013900        10  PV-CURR-TIME-MM              PIC  9(02) VALUE ZEROES. 01220001
014000        10  PV-CURR-TIME-SSHH            PIC  9(04) VALUE ZEROES. 01230001
014100                                                                  01240001
014200     05  PV-CURR-DATE-CCYYMMDD.                                   01250001
014300         10  PV-CURR-DATE-CCYY           PIC  9(04) VALUE ZEROES. 01260001
014400         10  PV-CURR-DATE-MM             PIC  9(02) VALUE ZEROES. 01270001
014500         10  PV-CURR-DATE-DD             PIC  9(02) VALUE ZEROES. 01280001
014600                                                                  01290001
014700 01  PV-PROGRAM-COUNTER.                                          01300001
014800     05  PV-PAGE-CNT                     PIC  9(05) VALUE ZEROS.  01310001
014900     05  PV-LINE-CNT                     PIC S9(07) VALUE ZEROS.  01320001
015000     05  PV-SOR-SKU-ATTR-RECS-READ-CNT   PIC  9(09) VALUE ZEROS.  01330019
015100     05  PV-SOR-READ-SKIP-CNT            PIC 9(09) VALUE ZEROS.   01340001
015200     05  PV-XS-EXTRACT-REC-READ-CNT      PIC  9(09) VALUE ZEROS.  01350019
015300     05  PV-ERROR-RECORD-WRITTEN-CNT     PIC  9(09) VALUE ZEROS.  01360019
015400     05  PV-VALID-MATCH-CNT              PIC  9(09) VALUE ZEROS.  01370019
015500                                                                  01380001
015600 01  PV-MISC-ABEND-FIELDS.                                        01390001
015700     05  PV-PARAGRAPH-NAME               PIC  X(30) VALUE SPACE.  01400001
015800     05  PV-OPERATION-MSG-1              PIC  X(40) VALUE SPACE.  01410001
015900     05  PV-OPERATION-MSG-2              PIC  X(40) VALUE SPACE.  01420001
NEMDEL***  05  PV-DB2-OPERATION                PIC  X(30) VALUE SPACE.  01430018
016100                                                                  01440001
016200 01  PV-ABEND-CODE   COMP  SYNC          PIC S9(04) VALUE +0000.  01450001
016300     88  PV-ABEND-4008-DATA-ERROR                   VALUE +4008.  01460001
016400     88  PV-ABEND-4009-CARD-ERROR                   VALUE +4009.  01470001
NEMDEL**   88  PV-ABEND-4013-DB2-ERROR                    VALUE +4013.  01490018
016700                                                                  01500001
016800******************************************************************01510001
016900*  TOP OF PAGE HEADING LINE FOR PRINTING A 200 CHARACTER REPORT.  01520001
017000******************************************************************01530001
017100     COPY DPWS200.                                                01540001
017200                                                                  01550001
017300 01  HL2-HEADING-LINE-2.                                          01560001
017400     05  FILLER                  PIC X(84)   VALUE SPACES.        01570004
017500     05  FILLER                  PIC X(33)   VALUE                01580004
017600         'XS SKU ATTR DATA INTEGRITY ERRORS'.                     01590004
017700     05  FILLER                  PIC X(83)   VALUE SPACES.        01600004
017800                                                                  01610001
017900 01  HL3-HEADING-LINE-3.                                          01620001
018000     05  FILLER                  PIC X(01)   VALUE SPACES.        01630001
018400     05  FILLER                  PIC X(11)   VALUE                01670011
018500         '--SOR KEY--'.                                           01680011
018600     05  FILLER                  PIC X(02)   VALUE SPACES.        01690011
018700     05  FILLER                  PIC X(11)   VALUE                01700011
018800         '-- XS KEY--'.                                           01710011
018900     05  FILLER                  PIC X(02)   VALUE SPACES.        01720011
019000     05  FILLER                  PIC X(35)   VALUE                01730011
019100         '--------------------- ERROR MESSAGE'.                   01740011
019200     05  FILLER                  PIC X(31)   VALUE                01750005
019300         ' ------------------------------'.                       01760001
019400     05  FILLER                  PIC X(107)  VALUE SPACES.        01770011
019500                                                                  01780001
019600******************************************************************01790001
019700*  DETAIL LINE LAYOUT FOR THE ERROR REPORT.                       01800001
019800******************************************************************01810001
019900 01  DL1-DETAIL-LINE-1.                                           01820001
020000     05  FILLER                  PIC X(01)     VALUE SPACES.      01830019
020500     05  DL1-SOR-INTR-UPC-ID     PIC Z(10)-    VALUE ZEROES.      01880019
020800     05  FILLER                  PIC X(04)     VALUE SPACES.      01910011
020900     05  DL1-XS-INTR-UPC-ID      PIC Z(10)-    VALUE ZEROES.      01920019
021000     05  FILLER                  PIC X(02)     VALUE SPACES.      01930019
021100     05  DL1-ERROR-MESSAGE       PIC X(55)     VALUE SPACES.      01940006
021200     05  FILLER                  PIC X(107)    VALUE SPACES.      01950011
021300                                                                  01960001
021400******************************************************************01970001
021500*  TRAILER LAYOUT FOR THE ERROR REPORT.                           01980001
021600******************************************************************01990001
021700 01  TR1-TRAILER-LINE-1.                                          02000001
021800     05  FILLER                  PIC X(25)   VALUE                02010001
021900         ' TOTAL NUMBER OF ERRORS: '.                             02020001
022000     05  TR1-TOTAL-ERROR-CNT     PIC Z(09)   VALUE ZEROS.         02030001
022100     05  FILLER                  PIC X(166)  VALUE SPACES.        02040001
022200                                                                  02050001
022300******************************************************************02060001
022400**COPYBOOKS                                                       02070001
022500******************************************************************02080001
022600                                                                  02090001
022700***VSM EXTRACT FILE LAYOUT                                        02100001
022800     COPY IMRD053.                                                02110001
022900                                                                  02120001
023000***XS EXTRACT FILE LAYOUT                                         02130001
023100     COPY XSRD029.                                                02140001
023200                                                                  02150001
023210***XS DOMAIN INTEGRITY CONTROL CARD                               02151014
023220     COPY XSRD046.                                                02152014
023230                                                                  02153014
023300***************************************************************** 02160001
023400 PROCEDURE DIVISION.                                              02170001
023500***************************************************************** 02180001
023600 0000-MAINLINE.                                                   02190001
023700                                                                  02200001
023800     PERFORM 1000-INITIALIZATION.                                 02210001
023900                                                                  02220001
024000     PERFORM 2000-PROCESS-RECORDS                                 02230001
024100             UNTIL PS-END-OF-SOR-SKU-ATTR                         02240001
024200                OR PS-END-OF-XS-SKU-ATTR.                         02250001
024300                                                                  02260001
024400     PERFORM 2500-PROCESS-EXTRA-RECORDS                           02270001
024500             UNTIL PS-END-OF-SOR-SKU-ATTR                         02280001
024600               AND PS-END-OF-XS-SKU-ATTR.                         02290001
024700                                                                  02300001
024710     IF PV-ERROR-RECORD-WRITTEN-CNT = 0                           02310001
024720         MOVE PC-NO-ERROR-MESSAGE TO DL1-DETAIL-LINE-1            02320001
024730         MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD              02330001
024740         PERFORM 8900-WRITE-REPORT-LINE                           02340001
024750     ELSE                                                         02350001
024760         MOVE PV-ERROR-RECORD-WRITTEN-CNT TO                      02360001
024770                TR1-TOTAL-ERROR-CNT                               02370001
024780         MOVE TR1-TRAILER-LINE-1  TO PV-PRINT-RECORD              02380001
024790         PERFORM 8900-WRITE-REPORT-LINE                           02390001
024791     END-IF.                                                      02400001
024792                                                                  02410001
024800     PERFORM 9000-END-OF-PGM.                                     02420001
024900                                                                  02430001
025000     GOBACK.                                                      02440001
025100                                                                  02450001
025200******************************************************************02460001
025300*1000-INITIALIZATION.                                             02470001
025400* INITIALIZATION AREA                                             02480001
025500******************************************************************02490001
025600 1000-INITIALIZATION.                                             02500001
025700                                                                  02510001
025800     INITIALIZE PV-PROGRAM-COUNTER.                               02520001
025900                                                                  02530001
026000     OPEN INPUT  SKIP-RECD-CNTL-FILE                              02540001
026200                 SOR-SKU-ATTR-EXTRACT-FILE                        02550001
026300                 XS-SKU-ATTR-EXTRACT-FILE.                        02560001
026400                                                                  02570001
026500     OPEN OUTPUT XS-SKU-ATTR-INTEG-RPT-FILE.                      02580001
026600                                                                  02590001
026700     READ SKIP-RECD-CNTL-FILE INTO XS046-CONTROL-CARD             02600014
026800        AT END                                                    02610001
026900           SET PS-END-SKIP-RECD-FILE TO TRUE.                     02620001
027000                                                                  02630001
027100     IF PS-END-SKIP-RECD-FILE                                     02640001
027200         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              02650001
027300         MOVE 'NO SKIP RECD CNTL FILE DATA' TO PV-OPERATION-MSG-1 02660001
027400         SET PV-ABEND-4009-CARD-ERROR TO TRUE                     02670001
027500         PERFORM 9999-ABEND                                       02680001
027600     END-IF.                                                      02690001
027700                                                                  02700001
027800     CLOSE SKIP-RECD-CNTL-FILE.                                   02710001
029200                                                                  02720001
029300     PERFORM 7000-READ-SOR-SKU-ATTR-EXTRACT                       02730001
029400        UNTIL PV-SOR-READ-SKIP-CNT = XS046-START-POINT            02740014
029500                OR PS-END-OF-SOR-SKU-ATTR.                        02750001
029600                                                                  02760001
029700     IF PS-END-OF-SOR-SKU-ATTR                                    02770001
029800         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              02780001
029900         MOVE 'END OF SOR SKU ATTR FILE ON PRIMING READ'          02790013
029950           TO PV-OPERATION-MSG-1                                  02791013
030000         SET PV-ABEND-4008-DATA-ERROR TO TRUE                     02800001
030100         PERFORM 9999-ABEND                                       02810001
030200     END-IF.                                                      02820001
030300                                                                  02830001
030400     IF XS046-READ-FREQUENCY = PC-ONE                             02840014
030500        PERFORM 7100-READ-XS-SKU-ATTR-EXTRACT                     02850001
030550          XS046-START-POINT TIMES                                 02851014
030600     ELSE                                                         02860001
030700        PERFORM 7100-READ-XS-SKU-ATTR-EXTRACT                     02870001
030800          UNTIL XS029-INTR-UPC-ID >= IM053-INTR-UPC-ID            02880001
030900     END-IF.                                                      02890001
031000                                                                  02900001
031100     ACCEPT PV-CURR-TIME FROM TIME.                               02910001
031200     MOVE PV-CURR-TIME-HH          TO DP200-RUN-HOUR.             02920001
031300     MOVE PV-CURR-TIME-MM          TO DP200-RUN-MINUTE.           02930001
031400                                                                  02940001
031500     MOVE FUNCTION CURRENT-DATE (1:8)                             02950001
031600                                   TO PV-CURR-DATE-CCYYMMDD.      02960001
031700                                                                  02970001
031800     MOVE PV-CURR-DATE-MM          TO DP200-RUN-MONTH.            02980001
031900     MOVE PV-CURR-DATE-DD          TO DP200-RUN-DAY.              02990001
032000     MOVE PV-CURR-DATE-CCYY        TO DP200-RUN-YEAR.             03000001
032100                                                                  03010001
032200     MOVE PC-CURRENT-PROGRAM-NAME  TO DP200-PROGRAM-NAME.         03020001
032300                                                                  03030001
032400     PERFORM 8700-REPORT-HEADER-ROUTINE.                          03040001
032500                                                                  03050001
032600******************************************************************03060001
032700*2000-PROCESS-RECORDS.                                            03070001
032800* THIS SECTION COMPARES RECORDS ON THE SOR ITEM SKU FILE & XS     03080013
032900* DOMAIN SKU ATTR EXTRACT FILE.  IF KEYS MATCH, THE PROGRAM       03090013
033000* DOES NO REPORTING. IF THE KEY (INTERNAL UPC ID) DOES            03100013
033010* NOT APPEAR ON ONE FILE, BUT IS ON THE OTHER FILE THEN AN        03100113
033100* APPROPRIATE MESSAGE WILL BE WRITTEN TO THE ERROR FILE, ALONG    03101013
033200* WITH THE DATA ON THE CORRESPONDING FILES.                       03120013
033300******************************************************************03130001
033400 2000-PROCESS-RECORDS.                                            03140001
033500                                                                  03150001
033600     INITIALIZE DL1-DETAIL-LINE-1.                                03160001
033700     MOVE ZEROS TO PV-SOR-READ-SKIP-CNT.                          03170001
033800                                                                  03180001
033900     EVALUATE TRUE                                                03190001
034000        WHEN IM053-INTR-UPC-ID = XS029-INTR-UPC-ID                03200001
034100             PERFORM 2100-COMPARE-FIELDS                          03210001
034200             PERFORM 7000-READ-SOR-SKU-ATTR-EXTRACT               03220001
034300                UNTIL PV-SOR-READ-SKIP-CNT =                      03230001
034400                       XS046-READ-FREQUENCY OR                    03240014
034500                       PS-END-OF-SOR-SKU-ATTR                     03250001
034600             IF XS046-READ-FREQUENCY = PC-ONE                     03260014
034700                PERFORM 7100-READ-XS-SKU-ATTR-EXTRACT             03270001
034800                   XS046-START-POINT TIMES                        03280014
034900             ELSE                                                 03290001
035000                PERFORM 7100-READ-XS-SKU-ATTR-EXTRACT UNTIL       03300001
035100                   XS029-INTR-UPC-ID >= IM053-INTR-UPC-ID         03310001
035200             END-IF                                               03320001
035300        WHEN IM053-INTR-UPC-ID < XS029-INTR-UPC-ID                03330001
035400             PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                  03340001
035500             PERFORM 2700-MOVE-SOR-VALUES                         03350001
035600             MOVE PC-MISSING-FROM-XS-SKU-ATTR                     03360001
035700                TO DL1-ERROR-MESSAGE                              03370001
035800             MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD            03380001
035900             ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                03390001
036000             PERFORM 8900-WRITE-REPORT-LINE                       03400001
036100             PERFORM 7000-READ-SOR-SKU-ATTR-EXTRACT               03410001
036200        WHEN IM053-INTR-UPC-ID > XS029-INTR-UPC-ID                03420001
036300             PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                  03430001
036400             PERFORM 2800-MOVE-XS-VALUES                          03440001
036500             MOVE PC-MISSING-FROM-SOR-SKU-ATTR                    03450001
036600                TO DL1-ERROR-MESSAGE                              03460001
036700             MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD            03470001
036800             ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                03480001
036900             PERFORM 8900-WRITE-REPORT-LINE                       03490001
037000             PERFORM 7100-READ-XS-SKU-ATTR-EXTRACT                03500001
037100     END-EVALUATE.                                                03510001
037200                                                                  03520001
037300******************************************************************03530001
037400*2100-COMPARE-FIELDS.                                             03540001
037500* COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   03550001
037600******************************************************************03560001
037700 2100-COMPARE-FIELDS.                                             03570001
037800                                                                  03580001
037900     SET                                                          03590001
038000         PS-NO-INTR-UPC-ID-ERROR                                  03600001
038100         PS-NO-ERROR-FOUND               TO TRUE.                 03610001
038200                                                                  03620001
038800     IF  IM053-INTR-UPC-ID  NOT EQUAL XS029-INTR-UPC-ID           03680001
038900         SET PS-ERROR-FOUND                                       03690001
039000         PS-INTR-UPC-ID-ERROR             TO TRUE                 03700001
039100     END-IF.                                                      03710001
039200                                                                  03720001
039300     IF  PS-ERROR-FOUND                                           03730001
039400         PERFORM 2600-CHECK-IF-NEW-PG-NEEDED                      03740001
039500         PERFORM 2700-MOVE-SOR-VALUES                             03750001
039600         PERFORM 2800-MOVE-XS-VALUES                              03760001
039700         PERFORM 2900-MOVE-ERROR-MSG                              03770001
039800         MOVE DL1-DETAIL-LINE-1 TO PV-PRINT-RECORD                03780001
039900         ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                    03790001
040000         PERFORM 8900-WRITE-REPORT-LINE                           03800001
040100     ELSE                                                         03810001
040200         ADD +1 TO PV-VALID-MATCH-CNT                             03820001
040300     END-IF.                                                      03830001
040400                                                                  03840001
040500     MOVE ZEROS TO PV-SOR-READ-SKIP-CNT.                          03850001
040600                                                                  03860001
040700******************************************************************03870001
040800**COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   03880001
040900******************************************************************03890001
041000 2500-PROCESS-EXTRA-RECORDS.                                      03900001
041100                                                                  03910001
041200     INITIALIZE DL1-DETAIL-LINE-1.                                03920001
041300     MOVE ZEROS TO PV-SOR-READ-SKIP-CNT.                          03930001
041400                                                                  03940001
041500     IF  PS-NOT-END-OF-SOR-SKU-ATTR                               03950001
041600         IF IM053-INTR-UPC-ID NOT = XS029-INTR-UPC-ID             03960001
041700            PERFORM 2700-MOVE-SOR-VALUES                          03970001
041800            MOVE PC-MISSING-FROM-XS-SKU-ATTR                      03980001
041900               TO DL1-ERROR-MESSAGE                               03990001
042000            MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD           04000001
042010            ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                 04010001
042100            PERFORM 8900-WRITE-REPORT-LINE                        04020001
042200         END-IF                                                   04030001
042300         PERFORM 7000-READ-SOR-SKU-ATTR-EXTRACT                   04040001
042400     END-IF.                                                      04050001
042500                                                                  04060001
042600     IF  PS-NOT-END-OF-XS-SKU-ATTR                                04070001
042700         IF IM053-INTR-UPC-ID NOT = XS029-INTR-UPC-ID             04080001
042800            PERFORM 2800-MOVE-XS-VALUES                           04090001
042900            MOVE PC-MISSING-FROM-SOR-SKU-ATTR                     04100001
043000                TO DL1-ERROR-MESSAGE                              04110001
043100            MOVE DL1-DETAIL-LINE-1   TO PV-PRINT-RECORD           04120001
043110            ADD +1 TO PV-ERROR-RECORD-WRITTEN-CNT                 04130001
043200            PERFORM 8900-WRITE-REPORT-LINE                        04140001
043300         END-IF                                                   04150001
043400         PERFORM 7100-READ-XS-SKU-ATTR-EXTRACT                    04160001
043500     END-IF.                                                      04170001
043600                                                                  04180001
043700******************************************************************04190001
043800* 2600-CHECK-IF-NEW-PG-NEEDED.                                    04200001
043900*     CHECKS TO SEE IF A NEW PAGE IS NEEDED.                      04210001
044000***************************************************************** 04220001
044100 2600-CHECK-IF-NEW-PG-NEEDED.                                     04230001
044200                                                                  04240001
044300     IF PV-LINE-CNT > PC-MAX-REPORT-LINES                         04250001
044400        PERFORM 8700-REPORT-HEADER-ROUTINE                        04260001
044500     END-IF.                                                      04270001
044600                                                                  04280001
044700******************************************************************04290001
044800* 2700-MOVE-SOR-VALUES.                                           04300001
044900*     MOVES THE SOR ITEM SKU LOC VALUES TO THE ERROR RECORD.      04310015
045000***************************************************************** 04320001
045100 2700-MOVE-SOR-VALUES.                                            04330001
045200                                                                  04340001
045300     MOVE IM053-INTR-UPC-ID     TO PV-TEMP-INTR-UPC-ID            04350001
045400     MOVE PV-TEMP-INTR-UPC-ID   TO DL1-SOR-INTR-UPC-ID.           04360001
045700                                                                  04390001
045800******************************************************************04400001
045900* 2800-MOVE-XS-VALUES.                                            04410001
046000*     MOVES THE XS SKU LOC ATTR VALUES TO THE ERROR RECORD.       04420015
046100***************************************************************** 04430001
046200 2800-MOVE-XS-VALUES.                                             04440001
046300                                                                  04450001
046400     MOVE XS029-INTR-UPC-ID     TO PV-TEMP-INTR-UPC-ID.           04460001
046500     MOVE PV-TEMP-INTR-UPC-ID   TO DL1-XS-INTR-UPC-ID.            04480004
046800                                                                  04500001
046900******************************************************************04510001
047000* 2900-MOVE-ERROR-MSG.                                            04520001
047100*     MOVES THE ERROR MESSAGE TO THE ERROR RECORD.                04530001
047200***************************************************************** 04540001
047300 2900-MOVE-ERROR-MSG.                                             04550001
047400                                                                  04560001
047500     IF PS-INTR-UPC-ID-ERROR                                      04570001
048100        MOVE PC-MISMATCHED-INTR-UPC-ID   TO DL1-ERROR-MESSAGE     04630001
048300     END-IF.                                                      04650001
048400                                                                  04660001
048500***************************************************************** 04670001
048600*7000-READ-SOR-SKU-ATTR-EXTRACT.                                  04680001
048700*  READ SOR ITEM SKU EXTRACT FILE                                 04690001
048800*  READS THE VMS EXTRACT FILE, SKIPPING THE NUMBER OF RECORDS     04700001
048900*  SPECIFIED IN THE START/SKIP RECORD CONTROL CARD.               04710001
049100***************************************************************** 04720001
049200 7000-READ-SOR-SKU-ATTR-EXTRACT.                                  04730001
049300                                                                  04740001
049400     IF  PS-NOT-END-OF-SOR-SKU-ATTR                               04750001
049500         READ SOR-SKU-ATTR-EXTRACT-FILE                           04760001
049550            INTO IM053-ITEM-SKU-DOMAIN-REC                        04761001
049600              AT END                                              04770001
049700                 SET PS-END-OF-SOR-SKU-ATTR TO TRUE               04780001
049800         END-READ                                                 04790001
049900     END-IF.                                                      04800001
050000                                                                  04810001
050100     IF  PS-NOT-END-OF-SOR-SKU-ATTR                               04820001
050900         ADD +1 TO PV-SOR-READ-SKIP-CNT                           04830001
052200         ADD +1 TO PV-SOR-SKU-ATTR-RECS-READ-CNT                  04840001
052500     END-IF.                                                      04870001
052600                                                                  04880001
052700***************************************************************** 04890001
052800*7100-READ-XS-SKU-ATTR-EXTRACT.                                   04900001
052900* READ XS EXTRACT FILE                                            04910001
053000***************************************************************** 04920001
053100 7100-READ-XS-SKU-ATTR-EXTRACT.                                   04930001
053200                                                                  04940001
053300     IF  PS-NOT-END-OF-XS-SKU-ATTR                                04950001
053400         READ XS-SKU-ATTR-EXTRACT-FILE                            04960001
053450           INTO XS029-SKU-ATTR-UNLOAD                             04960114
053500              AT END                                              04970001
053600                 SET PS-END-OF-XS-SKU-ATTR TO TRUE                04980001
053700         END-READ                                                 04990001
053800     END-IF.                                                      05000001
053900                                                                  05010001
054000     IF  PS-NOT-END-OF-XS-SKU-ATTR                                05020001
054100         ADD +1                   TO PV-XS-EXTRACT-REC-READ-CNT   05030001
054200     END-IF.                                                      05040001
054300                                                                  05050001
054400******************************************************************05060001
054500* 8700-REPORT-HEADER-ROUTINE.                                     05070001
054600*     PRINT THE HEADINGS FOR THE REPORT.                          05080001
054700******************************************************************05090001
054800 8700-REPORT-HEADER-ROUTINE.                                      05100001
054900                                                                  05110001
055000     MOVE ZEROS                  TO PV-LINE-CNT.                  05120001
055100     ADD +1                      TO PV-PAGE-CNT.                  05130001
055200     MOVE PV-PAGE-CNT            TO DP200-PAGE-NUMBER.            05140001
055300                                                                  05150001
055400     MOVE PC-REPORT-NBR-1        TO DP200-REPORT-NUMBER.          05160001
055500     MOVE DP200-STANDRD-HEADER-200-COLS                           05170001
055600                                 TO PV-PRINT-RECORD.              05180001
055700                                                                  05190001
055800     PERFORM 8800-WRITE-RPT-TOP-OF-PAGE.                          05200001
055900                                                                  05210001
056000     MOVE HL2-HEADING-LINE-2     TO PV-PRINT-RECORD.              05220001
056100     MOVE +2                     TO PV-LINE-SPACING.              05230001
056200     PERFORM 8900-WRITE-REPORT-LINE.                              05240001
056300                                                                  05250001
056400     MOVE HL3-HEADING-LINE-3     TO PV-PRINT-RECORD.              05260001
056500     MOVE +3                     TO PV-LINE-SPACING.              05270001
056600     PERFORM 8900-WRITE-REPORT-LINE.                              05280001
056700                                                                  05290001
056800******************************************************************05300001
056900* 8800-WRITE-RPT-TOP-OF-PAGE                                      05310001
057000*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   05320001
057100******************************************************************05330001
057200 8800-WRITE-RPT-TOP-OF-PAGE.                                      05340001
057300                                                                  05350001
057400     WRITE XS-SKU-ATTR-INTEG-RPT-RECORD                           05360001
057500       FROM PV-PRINT-RECORD                                       05370001
057600         AFTER ADVANCING PAGE.                                    05380001
057700                                                                  05390001
057800     MOVE +1 TO PV-LINE-CNT.                                      05400001
057900                                                                  05410001
058000******************************************************************05420001
058100* 8900-WRITE-REPORT-LINE                                          05430001
058200*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             05440001
058300******************************************************************05450001
058400 8900-WRITE-REPORT-LINE.                                          05460001
058500                                                                  05470001
058600     WRITE XS-SKU-ATTR-INTEG-RPT-RECORD                           05480001
058700       FROM PV-PRINT-RECORD                                       05490001
058800         AFTER ADVANCING PV-LINE-SPACING.                         05500001
058900                                                                  05510001
059000     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          05520001
059100                                                                  05530001
059200****************************************************************  05540001
059300*END OF PROGRAM ROUTINE                                           05550001
059400****************************************************************  05560001
059500 9000-END-OF-PGM.                                                 05570001
059600                                                                  05580001
060800     DISPLAY '******** XSKRP012 COUNTS *********'.                05590012
NEMADD     DISPLAY ' INTEGRITY CK FOR SKU ATTR '                        05600016
060900     DISPLAY '    SOR REC READ CNT='                              05600121
060950                     PV-SOR-SKU-ATTR-RECS-READ-CNT.               05601001
061000     DISPLAY 'XS SKU ATTR READ CNT=' PV-XS-EXTRACT-REC-READ-CNT.  05610021
061100     DISPLAY '  ERROR RECS WRITTEN=' PV-ERROR-RECORD-WRITTEN-CNT. 05620021
061200     DISPLAY '   VALID MATCH COUNT=' PV-VALID-MATCH-CNT.          05630021
061300     DISPLAY '                              '.                    05640001
061350     DISPLAY ' ==== CONTROL CARD VALUES     '.                    05641013
061400     DISPLAY '    START RECORD POINT= ' XS046-START-POINT.        05650014
061500     DISPLAY ' SKIP RECORD FREQUENCY= ' XS046-READ-FREQUENCY.     05660014
061700     DISPLAY '**********************************'.                05670011
061800                                                                  05680001
061900     IF  PV-ERROR-RECORD-WRITTEN-CNT > 0                          05690001
062000         MOVE 04               TO RETURN-CODE                     05700001
062100     END-IF.                                                      05710001
062200                                                                  05720001
062300     CLOSE SOR-SKU-ATTR-EXTRACT-FILE                              05730001
062400           XS-SKU-ATTR-EXTRACT-FILE                               05740001
062500           XS-SKU-ATTR-INTEG-RPT-FILE.                            05750001
062600                                                                  05760001
062700******************************************************************05770001
062800*     9999-ABEND                                                 *05780001
062900* ==> PROCESSES:                                                 *05790001
063000*     -PERFORMS ABEND PROCESSING FOR NON-SQL-ERRORS.             *05800001
063100******************************************************************05810001
063200 9999-ABEND.                                                      05820001
063300                                                                  05830001
063400     DISPLAY '9999-ABEND'.                                        05840001
063500     DISPLAY '**  ABEND     **', PC-CURRENT-PROGRAM-NAME.         05850012
063600     DISPLAY '**  PARAGRAPH ** ' PV-PARAGRAPH-NAME.               05860001
063700     DISPLAY '**  OPERATION ** ' PV-OPERATION-MSG-1.              05870001
063800     DISPLAY '**            ** ' PV-OPERATION-MSG-2.              05880001
063900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05890001
