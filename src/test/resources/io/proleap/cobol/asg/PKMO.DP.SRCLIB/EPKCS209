000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.                EPKCS209.                             00050001
000600 AUTHOR.                    TAMARA KOLTUN.                        00060001
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070001
000800 DATE-WRITTEN.              03-12-96.                             00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  CICS PROGRAM - EPKCS209 - S209                                *00120001
001300*                                                                *00130001
001400*       KMC AUTHORIZATION PROCESSOR.                             *00140001
001500*                                                                *00150001
001600*  THE PURPOSE OF THIS PROGRAM IS TO RECEIVE THE AUTHORIZATION   *00160001
001700*  FROM THE ISP, UNPACK THE INFORMATION, RUN THE DATA THRU THE   *00170001
001800*  AUTHORIZATION MODULE, AND RETURN A RESPONSE BACK TO THE ISP.  *00180001
001900*  THE KMC ACTIVITY TABLE WILL BE UPDATED WITH ANY APPROVED      *00190001
002000*  RESPONSES.                                                    *00200001
002100*                                                                *00210001
002200******************************************************************00220001
002300*                                                                *00230032
002400* 04/13/11 - Ty Hopp                                             *00240001
002500*    Modifying test card responses for POS.  Changes marked      *00250001
002600*    TDH001.                                                     *00260001
002700******************************************************************00270001
002702* 09/20/18 - Jim Hunter                                          *00270217
002703*    Mainframe Refactoring - replace CGU042MC with DPWS036.      *00270317
002704******************************************************************00270417
002710* 08/29/18 - COGNIZANT                       CHG0208643          *00271023
002720*    MODIFIED THE PROGRAM TO HANDLE NEWLY ADDED ORD_NBR FIELD    *00272007
002730*    IN THE SVT TABLES.                                          *00273007
002740******************************************************************00274007
002800 ENVIRONMENT DIVISION.                                            00280001
002900******************************************************************00290001
003000                                                                  00300001
003100******************************************************************00310001
003200 DATA DIVISION.                                                   00320001
003300******************************************************************00330001
003400                                                                  00340001
003500 WORKING-STORAGE SECTION.                                         00350001
003600                                                                  00360001
003700*                                                                 00370001
003800*  WORKING-STORAGE VARIABLES REQUIRED FOR THE USE OF THE          00380001
003900*  KOHL'S CICS STORE TABLE (CRKCS030), AND THE LOG MESSAGE        00390001
004000*  ROUTINE (EPPD000).                                             00400001
004100*                                                                 00410001
004200                                                                  00420001
004300     COPY EPWS000.                                                00430001
004400                                                                  00440001
004500*                                                                 00450001
004600*  MQ SERIES VARIABLE DEFINITIONS                                 00460001
004700*                                                                 00470001
004800 01  MQM-OBJECT-DESCRIPTOR.                                       00480001
004900     COPY CMQODV.                                                 00490001
005000                                                                  00500001
005100 01  MQM-MESSAGE-DESCRIPTOR.                                      00510001
005200     COPY CMQMDV.                                                 00520001
005300                                                                  00530001
005400 01  MQM-PUT-MESSAGE-OPTIONS.                                     00540001
005500     COPY CMQPMOV.                                                00550001
005600                                                                  00560001
005700*    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   00570001
005800*    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          00580001
005900                                                                  00590001
006000 01  MQM-CONSTANTS.                                               00600001
006100     COPY CMQV.                                                   00610001
006200                                                                  00620001
006300                                                                  00630001
006400* Stored Value Constants.                                         00640001
006500     COPY SVWS004.                                                00650001
006600                                                                  00660001
006700******************************************************************00670001
006800*    DATE ROUTINE COPY MEMBERS                                   *00680001
006900******************************************************************00690001
007000*    COPY DPWS500.                                                00700001
007100                                                                  00710001
007200 01  PS-PROGRAM-SWITCHES.                                         00720001
007300     05  PS-SYSTEM-LOG-QUEUING   PIC X(1)     VALUE 'D'.          00730001
007400         88  PS-SYSTEM-LOG-ENQUEUED           VALUE 'E'.          00740001
007500         88  PS-SYSTEM-LOG-DEQUEUED           VALUE 'D'.          00750001
007600     05  PS-SYSTEM-ERROR-IND     PIC X(1)     VALUE 'N'.          00760001
007700         88  PS-SYSTEM-ERROR-DETECTED         VALUE 'Y'.          00770001
007800         88  PS-NO-SYSTEM-ERROR-DETECTED      VALUE 'N'.          00780001
007900     05  PS-CHECK-DIGIT-COMPUTE-IND                               00790001
008000                                 PIC X(1)     VALUE '1'.          00800001
008100         88  PS-MULTIPLY-DIGIT-BY-1           VALUE '1'.          00810001
008200         88  PS-MULTIPLY-DIGIT-BY-2           VALUE '2'.          00820001
008300     05  PS-ERROR-TYPE           PIC X(1).                        00830001
008400         88  PS-DB2-ERROR                     VALUE 'D'.          00840001
008500         88  PS-AUTH-MESSAGE-ERROR            VALUE 'M'.          00850001
008600         88  PS-SYSTEM-ERROR                  VALUE 'S'.          00860001
008700     05  PS-SEND-IND             PIC X(1)     VALUE 'N'.          00870001
008800         88  PS-DO-THE-SEND                   VALUE 'Y'.          00880001
008900         88  PS-DONT-DO-THE-SEND              VALUE 'N'.          00890001
009000     05  PS-STORE-MONITOR-IND    PIC X(1)     VALUE ' '.          00900001
009100         88  PS-STORE-MONITOR-ON              VALUE 'Y'.          00910001
009200         88  PS-STORE-MONITOR-OFF             VALUE 'N'.          00920001
009300     05  PS-MONITOR-TIME-IND     PIC X(1)     VALUE ' '.          00930001
009400         88  PS-TIME-OK                       VALUE 'O'.          00940001
009500         88  PS-TIME-EXPIRED                  VALUE 'E'.          00950001
009600                                                                  00960001
009700 01  PC-PROGRAM-CONSTANTS.                                        00970001
009800     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'EPKCS209'.   00980001
009900     05  PC-COMMUNICATIONS-IN-LENGTH                              00990001
010000                                 PIC S9(4)    VALUE +420          01000001
010100                                 COMP SYNC.                       01010001
010200     05  PC-MODEL-ID             PIC  X(2)    VALUE 'o'.         01020001
010300     05  PC-RECV-AUTH-MSG-LENGTH PIC S9(4)    VALUE +69           01030001
010400                                 COMP SYNC.                       01040001
010500     05  PC-REMOTE-AUTH-RESP-MSG-LENGTH                           01050001
010600                                 PIC S9(4)    VALUE +36           01060001
010700                                 COMP SYNC.                       01070001
010800     05  PC-MAXIMUM-VARIABLE-AUTH-BYTES                           01080001
010900                                 PIC S9(4)    VALUE +100          01090001
011000                                 COMP SYNC.                       01100001
011100     05  PC-TCOS-HDR-LENGTH      PIC S9(4)    VALUE +8            01110001
011200                                 COMP SYNC.                       01120001
011300     05  PC-MAXIMUM-DIGIT-AMOUNT PIC  9(1)    VALUE 9.            01130001
011400     05  PC-MAXIMUM-FIELD-WORK-BYTES                              01140001
011500                                 PIC S9(4)    VALUE +21           01150029
011600                                 COMP SYNC.                       01160001
011700     05  PC-MAXIMUM-RETRY-COUNT  PIC S9(4)    VALUE +2            01170001
011800                                 COMP SYNC.                       01180001
011900     05  PC-MOD-10               PIC 9(2)     VALUE 10.           01190001
012000     05  PC-HEX-AUTH-RESP-MSG-TYPE-8201                           01200001
012100                                 PIC S9(5)    VALUE -32255        01210001
012200                                 COMP-3.                          01220001
012300     05  PC-STORES-IV-RESP-FORMAT-COMP                            01230001
012400                                 PIC S9(4)    VALUE +145          01240001
012500                                 COMP SYNC.                       01250001
012600     05  FILLER                  REDEFINES                        01260001
012700                                   PC-STORES-IV-RESP-FORMAT-COMP. 01270001
012800         10  FILLER              PIC X(1).                        01280001
012900         10  PC-STORES-IV-RESPONSE-FORMAT                         01290001
013000                                 PIC X(1).                        01300001
013100     05  PC-F-FILL               PIC  X(1)    VALUE 'F'.          01310001
013200     05  PC-ONE                  PIC S9(1)    VALUE  +1.          01320001
013300     05  PC-MINUS-ONE            PIC S9(1)    VALUE -1.           01330001
013400     05  PC-RESP-CODE-1          PIC  9(01)   VALUE 1.            01340001
013500     05  PC-INVALID-REQ-CD       PIC  9(01)   VALUE 9.            01350001
013600     05  PC-TRNG-KMRC-1000000008 PIC  9(10)   VALUE 1000000008.   01360001
013700     05  PC-TRNG-KMRC-1000000016 PIC  9(10)   VALUE 1000000016.   01370001
013800     05  PC-TRNG-KMRC-1000000024 PIC  9(10)   VALUE 1000000024.   01380001
013900     05  PC-TRNG-KMRC-1000000032 PIC  9(10)   VALUE 1000000032.   01390001
014000     05  PC-TRNG-KMRC-1000000040 PIC  9(10)   VALUE 1000000040.   01400001
014100     05  PC-TRNG-KMRC-1000000057 PIC  9(10)   VALUE 1000000057.   01410001
014200     05  PC-TRNG-KMRC-1000000065 PIC  9(10)   VALUE 1000000065.   01420001
014300     05  PC-TRNG-KMRC-1000000149 PIC  9(10)   VALUE 1000000149.   01430001
014400     05  PC-TRNG-KMRC-1000000420 PIC  9(10)   VALUE 1000000420.   01440001
014500     05  PC-TRNG-KMRC-101000000006 PIC 9(12) VALUE 101000000006.  01450001
014600     05  PC-TRNG-KMRC-101000000014 PIC 9(12) VALUE 101000000014.  01460001
014700     05  PC-TRNG-KMRC-101000000022 PIC 9(12) VALUE 101000000022.  01470001
014800     05  PC-TRNG-KMRC-101000000030 PIC 9(12) VALUE 101000000030.  01480001
014900     05  PC-TRNG-KMRC-101000000048 PIC 9(12) VALUE 101000000048.  01490001
015000     05  PC-TRNG-KMRC-101000000055 PIC 9(12) VALUE 101000000055.  01500001
015100     05  PC-TRNG-KMRC-101000000063 PIC 9(12) VALUE 101000000063.  01510001
015200     05  PC-TRNG-KMRC-101000000147 PIC 9(12) VALUE 101000000147.  01520001
015300     05  PC-TRNG-KMRC-101000000428 PIC 9(12) VALUE 101000000428.  01530001
015400                                                                  01540001
015500     05  PC-TRNG-GIFT-1000000164 PIC  9(10)   VALUE 1000000164.   01550001
015600     05  PC-TRNG-GIFT-1000000172 PIC  9(10)   VALUE 1000000172.   01560001
015700     05  PC-TRNG-GIFT-1000000180 PIC  9(10)   VALUE 1000000180.   01570001
015800     05  PC-TRNG-GIFT-1000000198 PIC  9(10)   VALUE 1000000198.   01580001
015900     05  PC-TRNG-GIFT-1000000206 PIC  9(10)   VALUE 1000000206.   01590001
016000     05  PC-TRNG-GIFT-1000000214 PIC  9(10)   VALUE 1000000214.   01600001
016100     05  PC-TRNG-GIFT-1000000222 PIC  9(10)   VALUE 1000000222.   01610001
016200     05  PC-TRNG-GIFT-1000000230 PIC  9(10)   VALUE 1000000230.   01620001
016300     05  PC-TRNG-GIFT-1000000248 PIC  9(10)   VALUE 1000000248.   01630001
016400     05  PC-TRNG-GIFT-1000000255 PIC  9(10)   VALUE 1000000255.   01640001
016500     05  PC-TRNG-GIFT-1000000263 PIC  9(10)   VALUE 1000000263.   01650001
016600     05  PC-TRNG-GIFT-1000000271 PIC  9(10)   VALUE 1000000271.   01660001
016700     05  PC-TRNG-GIFT-1000000438 PIC  9(10)   VALUE 1000000438.   01670001
016800     05  PC-TRNG-GIFT-101000000162 PIC 9(12) VALUE 101000000162.  01680001
016900     05  PC-TRNG-GIFT-101000000170 PIC 9(12) VALUE 101000000170.  01690001
017000     05  PC-TRNG-GIFT-101000000188 PIC 9(12) VALUE 101000000188.  01700001
017100     05  PC-TRNG-GIFT-101000000196 PIC 9(12) VALUE 101000000196.  01710001
017200     05  PC-TRNG-GIFT-101000000204 PIC 9(12) VALUE 101000000204.  01720001
017300     05  PC-TRNG-GIFT-101000000212 PIC 9(12) VALUE 101000000212.  01730001
017400     05  PC-TRNG-GIFT-101000000220 PIC 9(12) VALUE 101000000220.  01740001
017500     05  PC-TRNG-GIFT-101000000238 PIC 9(12) VALUE 101000000238.  01750001
017600     05  PC-TRNG-GIFT-101000000246 PIC 9(12) VALUE 101000000246.  01760001
017700     05  PC-TRNG-GIFT-101000000253 PIC 9(12) VALUE 101000000253.  01770001
017800     05  PC-TRNG-GIFT-101000000261 PIC 9(12) VALUE 101000000261.  01780001
017900     05  PC-TRNG-GIFT-101000000279 PIC 9(12) VALUE 101000000279.  01790001
018000     05  PC-TRNG-GIFT-101000000436 PIC 9(12) VALUE 101000000436.  01800001
018100                                                                  01810001
018200     05  PC-TEST-KMRC-1000000073 PIC  9(10)   VALUE 1000000073.   01820001
018300     05  PC-TEST-KMRC-1000000081 PIC  9(10)   VALUE 1000000081.   01830001
018400     05  PC-TEST-KMRC-1000000099 PIC  9(10)   VALUE 1000000099.   01840001
018500     05  PC-TEST-KMRC-1000000107 PIC  9(10)   VALUE 1000000107.   01850001
018600     05  PC-TEST-KMRC-1000000115 PIC  9(10)   VALUE 1000000115.   01860001
018700     05  PC-TEST-KMRC-1000000123 PIC  9(10)   VALUE 1000000123.   01870001
018800     05  PC-TEST-KMRC-1000000131 PIC  9(10)   VALUE 1000000131.   01880001
018900     05  PC-TEST-KMRC-1000000156 PIC  9(10)   VALUE 1000000156.   01890001
019000     05  PC-TEST-KMRC-1000000404 PIC  9(10)   VALUE 1000000404.   01900001
019100     05  PC-TEST-KMRC-1000000446 PIC  9(10)   VALUE 1000000446.   01910001
019200     05  PC-TEST-KMRC-1000000453 PIC  9(10)   VALUE 1000000453.   01920001
019300     05  PC-TEST-KMRC-1000000487 PIC  9(10)   VALUE 1000000487.   01930001
019400     05  PC-TEST-KMRC-1000000495 PIC  9(10)   VALUE 1000000495.   01940001
019500     05  PC-TEST-KMRC-1000000503 PIC  9(10)   VALUE 1000000503.   01950001
019600     05  PC-TEST-KMRC-1000000511 PIC  9(10)   VALUE 1000000511.   01960001
019700     05  PC-TEST-KMRC-1000000529 PIC  9(10)   VALUE 1000000529.   01970001
019800     05  PC-TEST-KMRC-1000000537 PIC  9(10)   VALUE 1000000537.   01980001
019900     05  PC-TEST-KMRC-1000000560 PIC  9(10)   VALUE 1000000560.   01990001
020000     05  PC-TEST-KMRC-1000000578 PIC  9(10)   VALUE 1000000578.   02000001
020100     05  PC-TEST-KMRC-1999123456 PIC  9(10)   VALUE 1999123456.   02010001
020200     05  PC-TEST-KMRC-2008123453 PIC  9(10)   VALUE 2008123453.   02020001
020300     05  PC-TEST-KMRC-101000000071 PIC 9(12) VALUE 101000000071.  02030001
020400     05  PC-TEST-KMRC-101000000089 PIC 9(12) VALUE 101000000089.  02040001
020500     05  PC-TEST-KMRC-101000000097 PIC 9(12) VALUE 101000000097.  02050001
020600     05  PC-TEST-KMRC-101000000105 PIC 9(12) VALUE 101000000105.  02060001
020700     05  PC-TEST-KMRC-101000000113 PIC 9(12) VALUE 101000000113.  02070001
020800     05  PC-TEST-KMRC-101000000121 PIC 9(12) VALUE 101000000121.  02080001
020900     05  PC-TEST-KMRC-101000000139 PIC 9(12) VALUE 101000000139.  02090001
021000     05  PC-TEST-KMRC-101000000154 PIC 9(12) VALUE 101000000154.  02100001
021100     05  PC-TEST-KMRC-101000000402 PIC 9(12) VALUE 101000000402.  02110001
021200     05  PC-TEST-KMRC-101000000444 PIC 9(12) VALUE 101000000444.  02120001
021300     05  PC-TEST-KMRC-101000000451 PIC 9(12) VALUE 101000000451.  02130001
021400     05  PC-TEST-KMRC-101000000485 PIC 9(12) VALUE 101000000485.  02140001
021500     05  PC-TEST-KMRC-101000000493 PIC 9(12) VALUE 101000000493.  02150001
021600     05  PC-TEST-KMRC-101000000501 PIC 9(12) VALUE 101000000501.  02160001
021700     05  PC-TEST-KMRC-101000000519 PIC 9(12) VALUE 101000000519.  02170001
021800     05  PC-TEST-KMRC-101000000527 PIC 9(12) VALUE 101000000527.  02180001
021900     05  PC-TEST-KMRC-101000000535 PIC 9(12) VALUE 101000000535.  02190001
022000     05  PC-TEST-KMRC-101000000568 PIC 9(12) VALUE 101000000568.  02200001
022100     05  PC-TEST-KMRC-101000000576 PIC 9(12) VALUE 101000000576.  02210001
022200     05  PC-TEST-KMRC-101999123454 PIC 9(12) VALUE 101999123454.  02220001
022300     05  PC-TEST-KMRC-102008123451 PIC 9(12) VALUE 102008123451.  02230001
022400                                                                  02240001
022500     05  PC-TEST-GIFT-1000000289 PIC  9(10)   VALUE 1000000289.   02250001
022600     05  PC-TEST-GIFT-1000000297 PIC  9(10)   VALUE 1000000297.   02260001
022700     05  PC-TEST-GIFT-1000000305 PIC  9(10)   VALUE 1000000305.   02270001
022800     05  PC-TEST-GIFT-1000000313 PIC  9(10)   VALUE 1000000313.   02280001
022900     05  PC-TEST-GIFT-1000000321 PIC  9(10)   VALUE 1000000321.   02290001
023000     05  PC-TEST-GIFT-1000000339 PIC  9(10)   VALUE 1000000339.   02300001
023100     05  PC-TEST-GIFT-1000000347 PIC  9(10)   VALUE 1000000347.   02310001
023200     05  PC-TEST-GIFT-1000000354 PIC  9(10)   VALUE 1000000354.   02320001
023300     05  PC-TEST-GIFT-1000000362 PIC  9(10)   VALUE 1000000362.   02330001
023400     05  PC-TEST-GIFT-1000000370 PIC  9(10)   VALUE 1000000370.   02340001
023500     05  PC-TEST-GIFT-1000000388 PIC  9(10)   VALUE 1000000388.   02350001
023600     05  PC-TEST-GIFT-1000000396 PIC  9(10)   VALUE 1000000396.   02360001
023700     05  PC-TEST-GIFT-1000000412 PIC  9(10)   VALUE 1000000412.   02370001
023800     05  PC-TEST-GIFT-1000000461 PIC  9(10)   VALUE 1000000461.   02380001
023900     05  PC-TEST-GIFT-1000000479 PIC  9(10)   VALUE 1000000479.   02390001
024000     05  PC-TEST-GIFT-1000000545 PIC  9(10)   VALUE 1000000545.   02400001
024100     05  PC-TEST-GIFT-1000000552 PIC  9(10)   VALUE 1000000552.   02410001
024200     05  PC-TEST-GIFT-1000000586 PIC  9(10)   VALUE 1000000586.   02420001
024300     05  PC-TEST-GIFT-5555555555 PIC  9(10)   VALUE 5555555555.   02430001
024400     05  PC-TEST-GIFT-6500290298 PIC  9(10)   VALUE 6500290298.   02440001
024500     05  PC-TEST-GIFT-7962525544 PIC  9(10)   VALUE 7962525544.   02450001
024600     05  PC-TEST-GIFT-5401000400 PIC  9(10)   VALUE 5401000400.   02460001
024700     05  PC-TEST-GIFT-6713247606 PIC  9(10)   VALUE 6713247606.   02470001
024800     05  PC-TEST-GIFT-5432100013 PIC  9(10)   VALUE 5432100013.   02480001
024900     05  PC-TEST-GIFT-6200750757 PIC  9(10)   VALUE 6200750757.   02490001
025000     05  PC-TEST-GIFT-7670782676 PIC  9(10)   VALUE 7670782676.   02500001
025100     05  PC-TEST-GIFT-1999123456 PIC  9(10)   VALUE 1999123456.   02510001
025200     05  PC-TEST-GIFT-2008123453 PIC  9(10)   VALUE 2008123453.   02520001
025300     05  PC-TEST-GIFT-101000000287 PIC 9(12) VALUE 101000000287.  02530001
025400     05  PC-TEST-GIFT-101000000295 PIC 9(12) VALUE 101000000295.  02540001
025500     05  PC-TEST-GIFT-101000000303 PIC 9(12) VALUE 101000000303.  02550001
025600     05  PC-TEST-GIFT-101000000311 PIC 9(12) VALUE 101000000311.  02560001
025700     05  PC-TEST-GIFT-101000000329 PIC 9(12) VALUE 101000000329.  02570001
025800     05  PC-TEST-GIFT-101000000337 PIC 9(12) VALUE 101000000337.  02580001
025900     05  PC-TEST-GIFT-101000000345 PIC 9(12) VALUE 101000000345.  02590001
026000     05  PC-TEST-GIFT-101000000352 PIC 9(12) VALUE 101000000352.  02600001
026100     05  PC-TEST-GIFT-101000000360 PIC 9(12) VALUE 101000000360.  02610001
026200     05  PC-TEST-GIFT-101000000378 PIC 9(12) VALUE 101000000378.  02620001
026300     05  PC-TEST-GIFT-101000000386 PIC 9(12) VALUE 101000000386.  02630001
026400     05  PC-TEST-GIFT-101000000394 PIC 9(12) VALUE 101000000394.  02640001
026500     05  PC-TEST-GIFT-101000000410 PIC 9(12) VALUE 101000000410.  02650001
026600     05  PC-TEST-GIFT-101000000469 PIC 9(12) VALUE 101000000469.  02660001
026700     05  PC-TEST-GIFT-101000000477 PIC 9(12) VALUE 101000000477.  02670001
026800     05  PC-TEST-GIFT-101000000543 PIC 9(12) VALUE 101000000543.  02680001
026900     05  PC-TEST-GIFT-101000000550 PIC 9(12) VALUE 101000000550.  02690001
027000     05  PC-TEST-GIFT-101000000584 PIC 9(12) VALUE 101000000584.  02700001
027100     05  PC-TEST-GIFT-105555555553 PIC 9(12) VALUE 105555555553.  02710001
027200     05  PC-TEST-GIFT-106500290296 PIC 9(12) VALUE 106500290296.  02720001
027300     05  PC-TEST-GIFT-107962525542 PIC 9(12) VALUE 107962525542.  02730001
027400     05  PC-TEST-GIFT-105401000408 PIC 9(12) VALUE 105401000408.  02740001
027500     05  PC-TEST-GIFT-106713247604 PIC 9(12) VALUE 106713247604.  02750001
027600     05  PC-TEST-GIFT-105432100012 PIC 9(12) VALUE 105432100012.  02760001
027700     05  PC-TEST-GIFT-106200750755 PIC 9(12) VALUE 106200750755.  02770001
027800     05  PC-TEST-GIFT-107670782674 PIC 9(12) VALUE 107670782674.  02780001
027900     05  PC-TEST-GIFT-101999123454 PIC 9(12) VALUE 101999123454.  02790001
028000     05  PC-TEST-GIFT-102008123451 PIC 9(12) VALUE 102008123451.  02800001
028100     05  PC-TWO-DOLLARS          PIC  9V99    VALUE 2.00.         02810001
028200*                MQ CALL CONSTANTS                                02820001
028300     05  PC-MQCONN               PIC  X(8)  VALUE 'CSQCCONN'.     02830001
028400     05  PC-MQOPEN               PIC  X(8)  VALUE 'CSQCOPEN'.     02840001
028500     05  PC-MQINQ                PIC  X(8)  VALUE 'CSQCINQ'.      02850001
028600     05  PC-MQPUT1               PIC  X(8)  VALUE 'CSQCPUT1'.     02860001
028700     05  PC-MQCLOSE              PIC  X(8)  VALUE 'CSQCCLOS'.     02870001
028800     05  PC-MQDISC               PIC  X(8)  VALUE 'CSQCDISC'.     02880001
028900     05  PC-AUTH-Q-NAME          PIC  X(9)  VALUE 'EP.AUTH.Q'.    02890001
029000     05  PC-QMGR-NAME            PIC  X(4)  VALUE SPACES.         02900001
029100         88  PC-PROD-QMGR-NAME              VALUE 'QKSP'.         02910001
029200         88  PC-TEST-QMGR-NAME              VALUE 'QKST'.         02920001
029300         88  PC-QA-QMGR-NAME                VALUE 'QKSQ'.         02930001
029400                                                                  02940001
029500 01  PV-PROGRAM-VARIABLES.                                        02950001
029600     05  PV-CICS-RESPONSE        PIC S9(9)    VALUE ZERO          02960001
029700                                 COMP SYNC.                       02970001
029800     05  PV-CICS-RESPONSE-DISP   PIC ZZZZZ9999-.                  02980001
029900     05  PV-RETRY-COUNT          PIC S9(4)         VALUE ZERO     02990001
030000                                 COMP SYNC.                       03000001
030010     05  PV-ORD-NBR-NULL-IND     PIC S9(04)  COMP  VALUE ZERO.    03001007
030020     05  PV-SPACE-COUNT          PIC S9(04) VALUE +0 COMP SYNC.   03002022
030030     05  PV-ZERO-COUNT           PIC S9(04) VALUE +0 COMP SYNC.   03003022
030031     05  PV-OPRT-ID-LEN          PIC S9(04) VALUE +0 COMP SYNC.   03003125
030040     05  PV-7-N                  PIC  9(01)        VALUE 7.       03004022
030100     05  PV-DRIVERS-LICENSE-NBR                                   03010001
030200                                 PIC X(21)         VALUE SPACES.  03020001
030300     05  PV-CHECK-DIGIT          PIC 9(1)          VALUE ZERO.    03030001
030400     05  PV-KMC-AMOUNT           PIC 9(10)V99 COMP-3 VALUE ZERO.  03040001
030410     05  PV-REQUEST-TYPE1        PIC X(01)         VALUE SPACES.  03041001
030420     05  PV-REVERSAL-IND1        PIC X(01)         VALUE SPACES.  03042001
030430     05  PV-KMC-ID               PIC  9(12)        VALUE 0.       03043001
030440         88 PV-TRAINING-KMRC-ACCOUNTS              VALUE          03044001
030450         1000000008, 1000000016, 1000000024, 1000000032,          03045001
030460         1000000040, 1000000057, 1000000065, 1000000149,          03046001
030470         1000000420,                                              03047001
030480         101000000006, 101000000014, 101000000022, 101000000030,  03048001
030490         101000000048, 101000000055, 101000000063, 101000000147,  03049001
030500         101000000428.                                            03050001
030600         88 PV-TRAINING-GIFT-CARD-ACCOUNTS         VALUE          03060001
030700         1000000164, 1000000172, 1000000180, 1000000198,          03070001
030800         1000000206, 1000000214, 1000000222, 1000000230,          03080001
030900         1000000248, 1000000255, 1000000263, 1000000271,          03090001
031000         1000000438,                                              03100001
031100         101000000162, 101000000170, 101000000188, 101000000196,  03110001
031200         101000000204, 101000000212, 101000000220, 101000000238,  03120001
031300         101000000246, 101000000253, 101000000261, 101000000279,  03130001
031400         101000000436.                                            03140001
031500         88 PV-TEST-KMRC-ACCOUNTS                  VALUE          03150001
031600         1000000073, 1000000081, 1000000099, 1000000107,          03160001
031700         1000000115, 1000000123, 1000000131, 1000000156,          03170001
031800         1000000404, 1000000446, 1000000453, 1000000487,          03180001
031900         1000000495, 1000000503, 1000000511, 1000000529,          03190001
032000         1000000537, 1000000560, 1000000578, 1999123456,          03200001
032100         2008123453,                                              03210001
032200         101000000071, 101000000089, 101000000097, 101000000105,  03220001
032300         101000000113, 101000000121, 101000000139, 101000000154,  03230001
032400         101000000402, 101000000444, 101000000451, 101000000485,  03240001
032500         101000000493, 101000000501, 101000000519, 101000000527,  03250001
032600         101000000535, 101000000568, 101000000576, 101999123454,  03260001
032700         102008123451.                                            03270001
032800         88 PV-TEST-GIFT-CARD-ACCOUNTS             VALUE          03280001
032900         1000000289, 1000000297, 1000000305, 1000000313,          03290001
033000         1000000321, 1000000339, 1000000347, 1000000354,          03300001
033100         1000000362, 1000000370, 1000000388, 1000000396,          03310001
033200         1000000412, 1000000461, 1000000479, 1000000545,          03320001
033300         1000000552, 1000000586, 5555555555, 6500290298,          03330001
033400         7962525544, 5401000400, 6713247606, 5432100013,          03340001
033500         6200750757, 7670782676, 1999123456, 2008123453,          03350001
033600         101000000287, 101000000295, 101000000303, 101000000311,  03360001
033700         101000000329, 101000000337, 101000000345, 101000000352,  03370001
033800         101000000360, 101000000378, 101000000386, 101000000394,  03380001
033900         101000000410, 101000000469, 101000000477, 101000000543,  03390001
034000         101000000550, 101000000584, 105555555553, 106500290296,  03400001
034100         107962525542, 105401000408, 106713247604, 105432100012,  03410001
034200         106200760755, 107670782674, 101999123454, 102008123451.  03420001
034300     05  PV-MOD-10-DIGIT-SUM     PIC 9(1)  VALUE ZERO.            03430001
034400     05  PV-ACCOUNT-DIGIT-MOD-10 PIC 9(2)  VALUE ZERO.            03440001
034500     05  PV-REFERRAL-CODE-NUMBER PIC 9(1)  VALUE ZERO.            03450001
034600         88  PV-SUCCESSFUL-AUTHORIZATION      VALUE ZERO.         03460001
034700         88  PV-EDIT-ERROR                    VALUE 2.            03470001
034800         88  PV-CODE-HARD-DECLINE             VALUE 7.            03480001
034900         88  PV-REFERRAL-CODE                 VALUE 8.            03490001
035000         88  PV-SYSTEM-ERROR-REFERRAL-CODE    VALUE 9.            03500001
035100     05  PV-REMOTE-AUTH-RESP-MSG-TYPE-C                           03510001
035200                                 PIC S9(4)    VALUE ZERO          03520001
035300                                 COMP SYNC.                       03530001
035400     05  PV-REMOTE-AUTH-RESP-MSG-TYPE                             03540001
035500                                 REDEFINES                        03550001
035600                                   PV-REMOTE-AUTH-RESP-MSG-TYPE-C 03560001
035700                                 PIC X(2).                        03570001
035800     05 PV-REQUEST-TYPE-INFO.                                     03580001
035900        10 PV-REVERSAL-IND       PIC S9(1) COMP-3.                03590001
036000           88 PV-NORMAL          VALUE  0.                        03600001
036100           88 PV-REVERSAL        VALUE  1.                        03610001
036200           88 PV-REAUTH          VALUE  2.                        03620001
036300           88 PV-REVERSAL-REAUTH VALUE  3.                        03630001
036400        10 PV-REQUEST-TYPE       PIC S9(1) COMP-3.                03640001
036500           88 PV-BALANCE-INQUIRY       VALUE 0.                   03650001
036600           88 PV-ISSUANCE-AS-KMRC      VALUE 1.                   03660001
036700           88 PV-ISSUANCE-AS-GIFT-CARD VALUE 2.                   03670001
036800           88 PV-TENDER                VALUE 3.                   03680001
036900     05 PV-FIELD-CODE-FIVE.                                       03690001
037000         10 PV-TENDER-TYPE       PIC X(02).                       03700001
037100            88  PV-GIFT-CARD-TENDER-TYPE      VALUE '13'.         03710001
037200            88  PV-KMRC-CARD-TENDER-TYPE      VALUE '02'.         03720001
037300            88  PV-VALID-TENDER-TYPE          VALUE '02', '13'.   03730001
037400         10 PV-SCAN-SOURCE-CODE  PIC X(02).                       03740001
037500            88  PV-KMC-KEY-ENTERED            VALUE '00'.         03750001
037600     05 PV-CRD-TYP-CDE-FULL.                                      03760001
037700        10  PV-CRD-TYP-CDE-FILL  PIC X(01).                       03770001
037800        10  PV-CRD-TYP-CDE       PIC 9(01).                       03780001
037900            88  PV-KMRC-CRD-TYP-CDE           VALUE 1.            03790001
038000            88  PV-GIFT-CRD-TYP-CDE           VALUE 2.            03800001
038100            88  PV-VALID-CRD-TYP-CDE          VALUE 1, 2.         03810001
038200     05 PV-CARD-TYPE             PIC 9(01).                       03820001
038300     05 PV-OPERATOR-ID           PIC X(40).                       03830010
038310     05 PV-POS-OPRT-ID-11-N      PIC 9(11).                       03831014
038400     05 PV-DECLINE-X             PIC X(06)    VALUE SPACES.       03840001
038500     05 PV-DECLINE-9 REDEFINES PV-DECLINE-X  PIC 9(06).           03850001
038600     05 PV-DECLINE-REASON-PACKED PIC 9(07) COMP-3.                03860001
038700     05 FILLER REDEFINES PV-DECLINE-REASON-PACKED.                03870001
038800        10 PV-DECLINE-REASON-BCD PIC X(3).                        03880001
038900        10 FILLER                PIC X(1).                        03890001
039000     05 PV-APPROVAL-NBR-PACKED   PIC S9(7) COMP-3.                03900001
039100     05 FILLER            REDEFINES PV-APPROVAL-NBR-PACKED.       03910001
039200        10 PV-APPROVAL-NBR-BCD   PIC X(3).                        03920001
039300        10 FILLER                PIC X(1).                        03930001
039400     05 PV-AUTHORIZATION-RESPONSE.                                03940001
039500        10 FILLER                PIC S9(4) COMP VALUE +1049.      03950001
039600        10 FILLER                PIC S9(4) COMP VALUE +0002.      03960001
039700           88  PV-AUTH-RESP-SRC-INTENDED        VALUE +0002.      03970001
039800           88  PV-AUTH-RESP-SRC-NOT-INTENDED    VALUE +0001.      03980001
039900        10 FILLER                PIC S9(4) COMP VALUE +1542.      03990001
040000        10 PV-APPROVAL-NBR       PIC  X(3)      VALUE SPACE.      04000001
040100        10 PV-RESPONSE-CODE      PIC  9(1)      VALUE 0.          04010001
040200     05 PV-DISPLAY-TRANS-AMT     PIC -Z(5).99.                    04020001
040300     05 PV-DISPLAY-APPROVAL-AMT  PIC -Z(5).99.                    04030001
040400                                                                  04040001
040500     05  PV-AUTH-INQ-MESSAGE-AREA.                                04050001
040600         10  PV-AI-MQ-MESSAGE-DESCRIPTOR                          04060001
040700                                    PIC X(324)       VALUE SPACES.04070001
040800         10  PV-AI-AUTH-REQUEST-MESSAGE                           04080001
040900                                    PIC X(96)        VALUE SPACES.04090001
041000                                                                  04100001
041100*  encryption parameters                                          04110001
041200     05  PV-PIN                     PIC S9(04)       VALUE -1.    04120001
041300     05  PV-ENCRYPT                 PIC  9(04).                   04130001
041400     05  PV-ENCRYPT-NBR REDEFINES PV-ENCRYPT.                     04140001
041500         10  PV-ENCRYPT-1           PIC  9(01).                   04150001
041600         10  PV-ENCRYPT-2           PIC  9(01).                   04160001
041700         10  PV-ENCRYPT-3           PIC  9(01).                   04170001
041800         10  PV-ENCRYPT-4           PIC  9(01).                   04180001
041900     05  PV-DIGIT-1                 PIC  9(02)       VALUE 0.     04190001
042000     05  PV-DIGIT-2                 PIC  9(02)       VALUE 0.     04200001
042100     05  PV-DIGIT-3                 PIC  9(02)       VALUE 0.     04210001
042200     05  PV-DIGIT-4                 PIC  9(02)       VALUE 0.     04220001
042300     05  PV-PIN-NBR                 PIC  9(04).                   04230001
042400     05  PV-PIN-N REDEFINES PV-PIN-NBR.                           04240001
042500         10  PV-PIN-1               PIC  9(01).                   04250001
042600         10  PV-PIN-2               PIC  9(01).                   04260001
042700         10  PV-PIN-3               PIC  9(01).                   04270001
042800         10  PV-PIN-4               PIC  9(01).                   04280001
042900     05  PV-CARD-NBR                PIC  9(12).                   04290001
043000     05  PV-CARD REDEFINES PV-CARD-NBR.                           04300001
043100         10  PV-CARD-FIRST2         PIC  9(02).                   04310001
043200         10  PV-CARD-3              PIC  9(01).                   04320001
043300         10  PV-CARD-4              PIC  9(01).                   04330001
043400         10  PV-CARD-5              PIC  9(01).                   04340001
043500         10  PV-CARD-6              PIC  9(01).                   04350001
043600         10  PV-CARD-7              PIC  9(01).                   04360001
043700         10  PV-CARD-8              PIC  9(01).                   04370001
043800         10  PV-CARD-9              PIC  9(01).                   04380001
043900         10  PV-CARD-LAST3          PIC  9(03).                   04390001
044000* -            MQ SERIES VARIABLES.                               04400001
044100     05  PV-PUT-MESSAGE-BUFFER      PIC X(96)        VALUE SPACES.04410001
044200     05  PV-PUT-MSG-BUFFER-LENGTH   PIC S9(9) BINARY VALUE 96.    04420001
044300     05  PV-COMPLETION-CODE         PIC S9(9) BINARY VALUE 0.     04430001
044400     05  PV-REASON                  PIC S9(9) BINARY VALUE 0.     04440001
044500     05  PV-CONNECT-HANDLE          PIC S9(9) BINARY VALUE 0.     04450001
044600     05  PV-CONNECT-REASON          PIC S9(9) BINARY VALUE 0.     04460001
044700     05  PV-DISPLAY-REASON          PIC S9(9)        VALUE 0.     04470001
044800     05  PV-DISPLAY-COMP-CODE       PIC S9(9)        VALUE 0.     04480001
044900     05  PV-STORE-NBR               PIC S9(4)        VALUE 0.     04490001
045000     05  PV-STORE-NBR-X             PIC X(04)   VALUE SPACES.     04500001
045100                                                                  04510001
045200 01  PE-PROGRAM-ERROR-MESSAGES.                                   04520001
045300*                    MQ CALL ERROR EMSSAGES                       04530001
045400     05  PE-MQ-ERROR-NUMBER           PIC X(02) VALUE '01'.       04540001
045500     05  PE-MQ-ERROR-MESSAGE.                                     04550001
045600         10  FILLER                   PIC X(13) VALUE             04560001
045700                                               'MQ ERROR ON: '.   04570001
045800         10  PE-MQ-CALL-TYPE          PIC X(7)  VALUE SPACES.     04580001
045900             88  PE-MQ-CONNECT                  VALUE 'MQCONN '.  04590001
046000             88  PE-MQ-PUT1                     VALUE 'MQPUT1 '.  04600001
046100             88  PE-MQ-DISCONNECT               VALUE 'MQDISCN'.  04610001
046200         10  FILLER                   PIC X(02) VALUE SPACES.     04620001
046300         10  FILLER                   PIC X(11) VALUE             04630001
046400                                        'COMP CODE: '.            04640001
046500         10  PE-MQ-COMPLETION-CODE    PIC 9(04) VALUE ZEROS.      04650001
046600         10  FILLER                   PIC X(02) VALUE SPACES.     04660001
046700         10  FILLER                   PIC X(13) VALUE             04670001
046800                                      'REASON CODE: '.            04680001
046900         10  PE-MQ-REASON-CODE        PIC 9(04) VALUE ZEROS.      04690001
047000                                                                  04700001
047100 01  LM-LOG-MESSAGE.                                              04710001
047200     05  LM-MESSAGE-NUMBER            PIC X(02) VALUE '99'.       04720001
047300     05  LM-LOG-DISPLAY-MESSAGE.                                  04730001
047400         10  LM-DM-AUTH-TYPE          PIC X(3)  VALUE 'SV '.      04740001
047500         10  FILLER                   PIC X(3)  VALUE SPACES.     04750001
047600             88  LM-DM-REQ                      VALUE 'REQ'.      04760001
047700             88  LM-DM-RSP                      VALUE 'RSP'.      04770001
047800         10  FILLER                   PIC X(1)  VALUE SPACES.     04780001
047900         10  FILLER                   PIC X(3)  VALUE SPACES.     04790001
048000             88  LM-DM-BALINQ                   VALUE 'BAL'.      04800001
048100             88  LM-DM-TENDER                   VALUE 'TND'.      04810001
048200             88  LM-DM-ISSUE                    VALUE 'ISS'.      04820001
048300             88  LM-DM-UNKNOWN                  VALUE '???'.      04830001
048400             88  LM-DM-VOID-ISSUE               VALUE 'VIS'.      04840001
048500             88  LM-DM-VOID-TENDER              VALUE 'VTN'.      04850001
048600             88  LM-DM-REAUTH                   VALUE 'RAU'.      04860001
048700             88  LM-DM-REVERSAL-REAUTH          VALUE 'RRA'.      04870001
048800         10  FILLER                   PIC X(1)  VALUE SPACES.     04880001
048900         10  FILLER                   PIC X(3)  VALUE SPACES.     04890001
049000             88  LM-DM-KMRC-MSG                 VALUE 'KC '.      04900001
049100             88  LM-DM-GC-MSG                   VALUE 'GC '.      04910001
049200             88  LM-DM-REQUEST-MSG              VALUE SPACES.     04920001
049300         10  FILLER                   PIC X(3)  VALUE SPACES.     04930001
049400             88  LM-DM-RC-DISPLAY               VALUE 'RC:'.      04940001
049500         10  LM-DM-RESP-CD            PIC X(1)  VALUE SPACES.     04950001
049600         10  FILLER                   PIC X(1)  VALUE SPACES.     04960001
049700         10  LM-DM-STORE-NBR          PIC X(4)  VALUE SPACES.     04970001
049800         10  FILLER                   PIC X(1)  VALUE '/'.        04980001
049900         10  LM-DM-TERM-NBR           PIC X(4)  VALUE SPACES.     04990001
050000         10  FILLER                   PIC X(1)  VALUE '/'.        05000001
050100         10  LM-DM-TRAN-NBR           PIC X(4)  VALUE SPACES.     05010001
050200         10  FILLER                   PIC X(1)  VALUE SPACES.     05020001
050300         10  LM-DM-ACCOUNT-NBR        PIC X(12) VALUE SPACES.     05030001
050400         10  FILLER                   PIC X(8)  VALUE             05040001
050500                                                ' TRNAMT='.       05050001
050600         10  LM-DM-TRAN-AMOUNT       PIC -Z(3)9.99 VALUE ZERO.    05060001
050700         10  FILLER                   PIC X(10)  VALUE            05070001
050800                                                ' APRVAMT='.      05080001
050900         10  LM-DM-APPROVE-AMOUNT    PIC -Z(3)9.99 VALUE ZERO.    05090001
051000         10  FILLER                   PIC X(5)  VALUE             05100001
051100                                                ' BAL='.          05110001
051200         10  LM-DM-BALANCE           PIC -Z(3)9.99 VALUE ZERO.    05120001
051300         10  LM-DM-DECLINE-MSG.                                   05130001
051400             15  LM-DM-RSN-LIT       PIC  X(5)  VALUE SPACES.     05140001
051500             15  LM-DM-DECLINE-RSN   PIC  X(6)  VALUE SPACES.     05150001
051600                                                                  05160001
051700 01  FW-FIELD-WORK-AREA.                                          05170021
051800     05  FW-FIELD-LENGTH         PIC S9(3)    VALUE ZERO          05180021
051900                                 COMP-3.                          05190021
052000     05  FILLER                  REDEFINES FW-FIELD-LENGTH.       05200021
052100         10  FW-FIELD-LENGTH-1   PIC X(1).                        05210021
052200         10  FW-FIELD-LENGTH-2   PIC X(1).                        05220021
052300     05  FW-FIELD-CODE           PIC X(2)     VALUE SPACES.       05230021
052400         88  FW-KMC-AMOUNT-FIELD              VALUE '03'.         05240021
052500         88  FW-DRIVER-LICENSE-FIELD          VALUE '04'.         05250021
052600         88  FW-TENDER-TYPE-FIELD             VALUE '05'.         05260021
052700         88  FW-PIN-FIELD                     VALUE '19'.         05270021
052800         88  FW-OPERATOR-ID-FIELD             VALUE '25'.         05280021
052900         88  FW-KMC-ID-FIELD                  VALUE '28'.         05290021
053000         88  FW-REQUEST-TYPE-FIELD            VALUE '31'.         05300021
053100         88  FW-CRD-TYP-CDE-FIELD             VALUE '46'.         05310021
053200     05  FILLER                  REDEFINES FW-FIELD-CODE.         05320021
053300         10  FW-FIELD-CODE-1     PIC X(1).                        05330021
053400         10  FW-FIELD-CODE-2     PIC X(1).                        05340021
053500     05  FW-VARIABLE-FIELD       PIC X(40)    VALUE SPACES.       05350024
053600     05  FILLER                  REDEFINES FW-VARIABLE-FIELD.     05360021
053610         10  FILLER               PIC X(19).                      05361029
053700         10  FW-FIELD-BYTE       OCCURS 21 TIMES                  05370029
053800                                 INDEXED BY FW-BYTE-INDEX         05380021
053900                                            FW-LEFT-INDEX         05390021
054000                                 PIC X(1).                        05400021
054100     05  FILLER                  REDEFINES FW-VARIABLE-FIELD.     05410024
054200         10 FILLER               PIC X(19).                       05420024
054300         10 FW-DRIVERS-LICENSE-NUMBER                             05430024
054400                                 PIC X(21).                       05440024
054500     05  FILLER                  REDEFINES FW-VARIABLE-FIELD.     05450021
054510         10  FILLER              PIC X(19).                       05451029
054600         10  FW-KMC-DIGIT        OCCURS 20 TIMES                  05460029
054700                                 INDEXED BY FW-DIGIT-INDEX        05470021
054800                                 PIC 9(1).                        05480021
054900         10  FW-CHECK-DIGIT      PIC 9(1).                        05490021
055000     05  FILLER                  REDEFINES FW-VARIABLE-FIELD.     05500021
055100         10 FILLER               PIC X(28).                       05510024
055200         10 FW-KMC-ID            PIC 9(12).                       05520021
055300     05  FILLER                  REDEFINES FW-VARIABLE-FIELD.     05530021
055400         10  FILLER              PIC X(28).                       05540024
055500         10  FW-KMC-AMOUNT       PIC 9(10)V99.                    05550024
055600     05  FILLER                  REDEFINES FW-VARIABLE-FIELD.     05560021
055700         10  FILLER              PIC X(36).                       05570024
055800         10  FW-TENDER-TYPE      PIC X(04).                       05580021
055900     05  FILLER                  REDEFINES FW-VARIABLE-FIELD.     05590021
056000         10 FILLER               PIC X(38).                       05600024
056100         10 FW-REVERSAL-IND      PIC X(01).                       05610021
056200         10 FW-REQUEST-TYPE      PIC X(01).                       05620021
056210     05  FILLER                  REDEFINES FW-VARIABLE-FIELD.     05621029
056300         10 FW-OPERATOR-ID       PIC X(40).                       05630029
056400     05 FILLER                   REDEFINES FW-VARIABLE-FIELD.     05640021
056500         10 FILLER               PIC X(38).                       05650024
056600         10 FW-CRD-TYP-CDE       PIC X(02).                       05660021
056700     05 FILLER                   REDEFINES FW-VARIABLE-FIELD.     05670021
056800         10 FILLER               PIC X(36).                       05680024
056900         10 FW-PIN               PIC X(04).                       05690021
057100                                                                  05710001
057200 01  CD-CURRENT-DATE-AREA.                                        05720001
057300     05  CD-CURRENT-DATE-YYYYMMDD-X.                              05730001
057400         10  CD-CURRENT-YEAR     PIC 9(4)     VALUE ZERO.         05740001
057500         10  CD-CURRENT-MONTH    PIC 9(2)     VALUE ZERO.         05750001
057600         10  CD-CURRENT-DAY      PIC 9(2)     VALUE ZERO.         05760001
057700     05  CD-DB2-DATE-FORMAT.                                      05770001
057800         10  CD-YYYY             PIC 9(4)     VALUE ZEROS.        05780001
057900         10  FILLER              PIC X(1)     VALUE '-'.          05790001
058000         10  CD-MM               PIC 9(2)     VALUE ZEROS.        05800001
058100         10  FILLER              PIC X(1)     VALUE '-'.          05810001
058200         10  CD-DD               PIC 9(2)     VALUE ZEROS.        05820001
058300                                                                  05830001
058400                                                                  05840001
058500 01  CS-CICS-SYSLOG-MESSAGE-AREA.                                 05850001
058600     05  CS-QUEUE-NAME           PIC X(4)     VALUE 'CSSL'.       05860001
058700     05  CS-MESSAGE-LENGTH       PIC S9(4)    VALUE +128          05870001
058800                                 COMP SYNC.                       05880001
058900     05  CS-ERROR                PIC  X(08)   VALUE               05890001
059000                                              '*ERROR* '.         05900001
059100     05  CS-SEND                 PIC  X(08)   VALUE               05910001
059200                                              '*SEND*  '.         05920001
059300     05  CS-RCVD                 PIC  X(08)   VALUE               05930001
059400                                              '*RCVD*  '.         05940001
059500     05  CS-CICS-SYSLOG-ERROR-MESSAGE.                            05950001
059600         10  CS-MSG-TYPE         PIC X(08)    VALUE SPACES.       05960001
059700         10  CS-CURRENT-PROGRAM-NAME                              05970001
059800                                 PIC X(8)     VALUE SPACES.       05980001
059900         10  FILLER              PIC X(1)     VALUE SPACES.       05990001
060000         10  CS-CURRENT-NETNAME  PIC X(8)     VALUE SPACES.       06000001
060100         10  FILLER              PIC X(1)     VALUE '-'.          06010001
060200         10  CS-KMC-PROCESSOR-ERROR-MSG                           06020001
060300                                 PIC X(102)   VALUE SPACES.       06030001
060400                                                                  06040001
060500 01  SE-SYSTEM-ERROR-MESSAGE.                                     06050001
060600     05  FILLER                  PIC X(11)    VALUE               06060001
060700         'EIBRESP = ('.                                           06070001
060800     05  SE-CICS-RESPONSE        PIC ZZZ9     VALUE ZERO.         06080001
060900     05  FILLER                  PIC X(17)    VALUE               06090001
061000         ')  ATTEMPTING TO '.                                     06100001
061100     05  SE-ATTEMPTED-ACTION     PIC X(45)    VALUE SPACES.       06110001
061200                                                                  06120001
061300 01  AM-AUTH-MESSAGE-ERROR-MESSAGE.                               06130001
061400     05  FILLER                  PIC X(21)    VALUE               06140001
061500         'AUTHORIZATION MSG = ('.                                 06150001
061600     05  AM-POS-INQ-REMOTE-AUTH-MSG                               06160001
061700                                 PIC X(96)    VALUE SPACES.       06170001
061800     05  FILLER                  PIC X(1)     VALUE ')'.          06180001
061900                                                                  06190001
062000 01  DE-DB2-ERROR-MESSAGE.                                        06200001
062100     05  FILLER                  PIC X(11)    VALUE               06210001
062200         'SQLCODE = ('.                                           06220001
062300     05  DE-SQLCODE              PIC Z(8)9-   VALUE ZERO.         06230001
062400     05  FILLER                  PIC X(21)    VALUE               06240001
062500         ')  ROWS PROCESSED = ('.                                 06250001
062600     05  DE-ROWS-PROCESSED       PIC Z(8)9-   VALUE ZERO.         06260001
062700     05  FILLER                  PIC X(25)    VALUE ')'.          06270001
062800                                                                  06280001
062900 01  DW-DB2-WARNING-MESSAGE.                                      06290001
063000     05  FILLER                  PIC X(11)    VALUE               06300001
063100         'SQLCODE = ('.                                           06310001
063200     05  DW-SQLCODE              PIC Z(8)9-   VALUE ZERO.         06320001
063300     05  FILLER                  PIC X(21)    VALUE               06330001
063400         ')  ROWS PROCESSED = ('.                                 06340001
063500     05  DW-ROWS-PROCESSED       PIC Z(8)9-   VALUE ZERO.         06350001
063600     05  FILLER                  PIC X(14)    VALUE               06360001
063700         ')  SQLWARN = ('.                                        06370001
063800     05  DW-SQLWARN              PIC X(8)     VALUE ZERO.         06380001
063900     05  FILLER                  PIC X(3)     VALUE ')'.          06390001
064000                                                                  06400001
064100 01  DS-DB2-SQLERRMC-MESSAGE.                                     06410001
064200     05  FILLER                  PIC X(11)    VALUE               06420001
064300         'SQLERRMC = '.                                           06430001
064400     05  DS-SQLERRMC             PIC X(66)    VALUE SPACES.       06440001
064500                                                                  06450001
064600 01  AA-ATTEMPTED-ACTION-MESSAGE.                                 06460001
064700     05  FILLER                  PIC X(14)    VALUE               06470001
064800         'ATTEMPTING TO '.                                        06480001
064900     05  AA-ATTEMPTED-ACTION     PIC X(90)    VALUE SPACES.       06490001
065000                                                                  06500001
065100 01  CI-COMMUNICATIONS-INPUT-AREA.                                06510001
065200     05  CI-TRANSID              PIC X(4)     VALUE SPACES.       06520001
065300     05  CI-POS-INQ-REMOTE-AUTH-MSG                               06530001
065400                                 PIC X(96)    VALUE SPACES.       06540001
065500                                                                  06550001
065600 01  CO-COMMUNICATIONS-OUTPUT-AREA.                               06560001
065700     05  CO-STORE-NUMBER         PIC 9(4)     VALUE ZERO.         06570001
065800     05  CO-FUNCTION-CODE        PIC X(1)     VALUE LOW-VALUES.   06580001
065900     05  CO-POS-INQ-REMOTE-AUTH-MSG                               06590001
066000                                 PIC X(44)    VALUE SPACES.       06600001
066100                                                                  06610001
066200 01  PI-POS-INQ-REMOTE-AUTH-MSG.                                  06620001
066300     05  PI-STANDARD-TCOS-HEADER.                                 06630001
066400         10  PI-DESTINATION-SYSTEM-ID                             06640001
066500                                 PIC X(3)     VALUE LOW-VALUES.   06650001
066600         10  PI-SOURCE-SYSTEM-ID PIC X(3)     VALUE LOW-VALUES.   06660001
066700         10  PI-FUNCTION-CODE    PIC X(1)     VALUE LOW-VALUES.   06670001
066800         10  PI-STATUS-CODE      PIC X(1)     VALUE LOW-VALUES.   06680001
066900         10  PI-MESSAGE-LENGTH-IND                                06690001
067000                                 PIC S9(4)    VALUE ZERO          06700001
067100                                 COMP.                            06710001
067200         10  PI-MESSAGE-TYPE-CODE                                 06720001
067300                                 PIC X(2)     VALUE LOW-VALUES.   06730001
067400     05  PI-FIXED-MESSAGE-FIELDS.                                 06740001
067500         10  PI-SEQUENTIAL-BUFFER-NUMBER                          06750001
067600                                 PIC X(4)     VALUE LOW-VALUES.   06760001
067700         10  PI-SYSTEM-ID-NUMBER PIC X(2)     VALUE LOW-VALUES.   06770001
067800         10  PI-STORE-NUMBER     PIC X(4)     VALUE LOW-VALUES.   06780001
067900         10  PI-TERMINAL-NUMBER  PIC X(2)     VALUE LOW-VALUES.   06790001
068000         10  PI-MODEL-ID         PIC X(2)     VALUE LOW-VALUES.   06800001
068100         10  PI-TERMINAL-TYPE    PIC X(1)     VALUE LOW-VALUES.   06810001
068200         10  PI-TRANSACTION-CLASS                                 06820001
068300                                 PIC X(1)     VALUE LOW-VALUES.   06830001
068400         10  PI-TRANSACTION-NUMBER                                06840001
068500                                 PIC X(4)     VALUE LOW-VALUES.   06850001
068600         10  PI-TRANSACTION-TYPE PIC X(2)     VALUE LOW-VALUES.   06860001
068700     05  PI-VARIABLE-MESSAGE-AREA                                 06870001
068800                                 PIC X(62)    VALUE SPACES.       06880001
068900*----                                                             06890001
069000*                                                                 06900001
069100 01  TM-POS-INQ-REMOTE-AUTH-MSG.                                  06910001
069200     05  TM-STANDARD-TCOS-HEADER.                                 06920001
069300         10  TM-DESTINATION-SYSTEM-ID                             06930001
069400                                 PIC X(3)     VALUE '   '.        06940001
069500         10  TM-SOURCE-SYSTEM-ID PIC X(3)     VALUE '  '.        06950001
069600         10  TM-FUNCTION-CODE    PIC X(1)     VALUE ' '.          06960001
069700         10  TM-STATUS-CODE      PIC X(1)     VALUE ' '.          06970001
069800         10  TM-MESSAGE-LENGTH-IND                                06980001
069900                                 PIC S9(4)    VALUE 0             06990001
070000                                 COMP.                            07000001
070100         10  TM-MESSAGE-TYPE-CODE                                 07010001
070200                                 PIC X(2)     VALUE 'b '.         07020001
070300     05  TM-FIXED-MESSAGE-FIELDS.                                 07030001
070400         10  TM-SEQUENTIAL-BUFFER-NUMBER                          07040001
070500                                 PIC X(4)     VALUE '    '.       07050001
070600         10  TM-SYSTEM-ID-NUMBER PIC X(2)     VALUE ''.         07060001
070700         10  TM-STORE-NUMBER     PIC X(4)     VALUE '   '.       07070001
070800         10  TM-TERMINAL-NUMBER  PIC X(2)     VALUE ''.         07080001
070900         10  TM-MODEL-ID         PIC X(2)     VALUE '  '.         07090001
071000         10  TM-TERMINAL-TYPE    PIC X(1)     VALUE ''.          07100001
071100         10  TM-TRANSACTION-CLASS                                 07110001
071200                                 PIC X(1)     VALUE ' '.          07120001
071300         10  TM-TRANSACTION-NUMBER                                07130001
071400                                 PIC X(4)     VALUE '  hh'.       07140001
071500         10  TM-TRANSACTION-TYPE PIC X(2)     VALUE ' '.         07150001
071600     05  TM-VARIABLE-MESSAGE-AREA.                                07160001
071700         10  TM-TENDER-TYPE      PIC X(04)    VALUE '	'.       07170001
071800         10  TM-OPERATOR-ID      PIC X(05)    VALUE '	
'.      07180001
071900         10  TM-KMC-ID           PIC X(07)    VALUE '   '.    07190001
072000         10  TM-DRIVERS-LICENSE  PIC X(12)  VALUE ''. 07200001
072100         10  TM-REQUEST-TYPE     PIC X(03)  VALUE ''.          07210001
072200         10  TM-AMOUNT           PIC X(12)  VALUE '       '. 07220001
072300                                                                  07230001
072400 01  TEST-FIXED-MESSAGE-FIELDS.                                   07240001
072500     05  TM1-STORE-NUMBER        PIC X(4)     VALUE '  '.       07250001
072600     05  TM1-TERMINAL-NUMBER     PIC X(2)     VALUE ''.         07260001
072700     05  TM1-TRANSACTION-NUMBER  PIC X(4)     VALUE '  '.       07270001
072800     05  TM2-STORE-NUMBER        PIC X(4)     VALUE '   '.       07280001
072900     05  TM2-TERMINAL-NUMBER     PIC X(2)     VALUE ''.         07290001
073000     05  TM2-TRANSACTION-NUMBER  PIC X(4)     VALUE '  '.       07300001
073100     05  TM3-STORE-NUMBER        PIC X(4)     VALUE '   '.       07310001
073200     05  TM3-TERMINAL-NUMBER     PIC X(2)     VALUE 'g'.         07320001
073300     05  TM3-TRANSACTION-NUMBER  PIC X(4)     VALUE '  '.       07330001
073400                                                                  07340001
073500 01  TEST-VAR-MSG-AREAS.                                          07350001
073600     05  TEST-VAR-MSG-AREA-ISSUE1.                                07360001
073700         10  TM1-TENDER-TYPE     PIC X(04)    VALUE '	'.       07370001
073800         10  TM1-OPERATOR-ID     PIC X(05)    VALUE '	
'.      07380001
073900         10  TM1-KMC-ID          PIC X(07)    VALUE '  '.    07390001
074000         10  TM1-DRIVERS-LICENSE PIC X(12)  VALUE '   -'. 07400001
074100         10  TM1-REQUEST-TYPE    PIC X(03)  VALUE ''.          07410001
074200         10  TM1-AMOUNT          PIC X(12)  VALUE '       c'. 07420001
074300     05  TEST-VAR-MSG-AREA-TENDER2.                               07430001
074400         10  TM2-TENDER-TYPE     PIC X(04)    VALUE '	'.       07440001
074500         10  TM2-OPERATOR-ID     PIC X(05)    VALUE '	
'.      07450001
074600         10  TM2-KMC-ID          PIC X(07)    VALUE '  '.    07460001
074700         10  TM2-DRIVERS-LICENSE PIC X(12)  VALUE '          '. 07470001
074800         10  TM2-REQUEST-TYPE    PIC X(03)  VALUE ''.          07480001
074900         10  TM2-AMOUNT          PIC X(12)  VALUE '        '. 07490001
075000     05  TEST-VAR-MSG-AREA-INQUIRY3.                              07500001
075100         10  TM3-TENDER-TYPE     PIC X(04)    VALUE '	'.       07510001
075200         10  TM3-OPERATOR-ID     PIC X(05)    VALUE '	
 '.      07520001
075300         10  TM3-KMC-ID          PIC X(07)    VALUE '  '.    07530001
075400         10  TM3-DRIVERS-LICENSE PIC X(12)  VALUE '          '. 07540001
075500         10  TM3-REQUEST-TYPE    PIC X(03)  VALUE ' '.          07550001
075600         10  TM3-AMOUNT          PIC X(12)  VALUE '          '. 07560001
075700                                                                  07570001
075800*----                                                             07580001
075900                                                                  07590001
076000 01  UA-UNPACKED-AUTHORIZATION-MSG.                               07600001
076100     05  UA-AUTHORIZATION-HEADER.                                 07610001
076200         10  UA-MESSAGE-TYPE-CODE                                 07620001
076300                                 PIC X(4)     VALUE SPACES.       07630001
076400         10  FILLER              PIC X(16)    VALUE SPACES.       07640001
076500         10  UA-STORE-NUMBER-X   PIC X(4)     VALUE SPACES.       07650001
076600         10  UA-STORE-NUMBER     REDEFINES UA-STORE-NUMBER-X      07660001
076700                                 PIC 9(4).                        07670001
076800         10  UA-TERMINAL-NUMBER  PIC X(4)     VALUE SPACES.       07680001
076900             88  UA-TRAINING-REGISTER         VALUE '0196',       07690001
077000                                                    '0197',       07700001
077100                                                    '0198',       07710001
077200                                                    '0199'.       07720001
077300         10  FILLER              PIC X(12)    VALUE SPACES.       07730001
077400         10  UA-TRANSACTION-NUMBER                                07740001
077500                                 PIC X(4)     VALUE SPACES.       07750001
077600         10  FILLER              PIC X(2)     VALUE SPACES.       07760001
077700         10  UA-TRANSACTION-TYPE PIC X(2)     VALUE SPACES.       07770001
077800             88  UA-BALANCE-INQUIRY           VALUE '00'.         07780001
077900             88  UA-ISSUANCE-AS-KMRC          VALUE '01'.         07790001
078000             88  UA-ISSUANCE-AS-GIFT-CARD     VALUE '02'.         07800001
078100             88  UA-TENDER                    VALUE '03'.         07810001
078200             88  UA-VALID-KMC-TENDER-TRANS    VALUE '00', '01',   07820001
078300                                                    '03'.         07830001
078400     05  UA-AUTHORIZATION-DETAIL PIC X(100)   VALUE SPACES.       07840001
078500     05  FILLER                  REDEFINES                        07850001
078600                                     UA-AUTHORIZATION-DETAIL.     07860001
078700         10  UA-AUTH-DETAIL-BYTE-ENTRY                            07870001
078800                                 OCCURS 100 TIMES                 07880001
078900                                 INDEXED BY UA-BYTE-INDEX         07890001
079000                                            UA-START-INDEX        07900001
079100                                            UA-END-INDEX.         07910001
079200             15  UA-AUTH-DETAIL-BYTE                              07920001
079300                                 PIC X(1).                        07930001
079400                 88  UA-END-OF-FIELD          VALUE '/'.          07940001
079500                 88  UA-END-OF-MESSAGE        VALUE '#'.          07950001
079600                                                                  07960001
079700*                                                                 07970001
079800*  STORED VALUE CONTROL TABLE                                     07980001
079900*                                                                 07990001
080000                                                                  08000001
080100     EXEC SQL                                                     08010001
080200         INCLUDE SVT00000                                         08020001
080300     END-EXEC.                                                    08030001
080400                                                                  08040001
080500*                                                                 08050001
080600*  STORED VALUE CARD TABLE                                        08060001
080700*                                                                 08070001
080800                                                                  08080001
080900     EXEC SQL                                                     08090001
081000         INCLUDE SVT00001                                         08100001
081100     END-EXEC.                                                    08110001
081200*                                                                 08120001
081300*  SQL AND COBOL DECLARATIONS FOR THE STORED VALUE ACTIVITY TABLE 08130001
081400*                                                                 08140001
081500                                                                  08150001
081600     EXEC SQL                                                     08160001
081700         INCLUDE SVT00002                                         08170001
081800     END-EXEC.                                                    08180001
081900                                                                  08190001
082000*                                                                 08200001
082100*  STORED VALUE LOCK TABLE                                        08210001
082200*                                                                 08220001
082300                                                                  08230001
082400     EXEC SQL                                                     08240001
082500         INCLUDE SVT00004                                         08250001
082600     END-EXEC.                                                    08260001
082700*                                                                 08270001
082800*  STORED VALUE card stock denomination table                     08280001
082900*                                                                 08290001
083000                                                                  08300001
083100     EXEC SQL                                                     08310001
083200         INCLUDE SVT00008                                         08320001
083300     END-EXEC.                                                    08330001
083400*  STANDARD LAYOUT FOR THE SQL COMMUNICATION AREA.                08340001
083500                                                                  08350001
083600     EXEC SQL                                                     08360001
083700         INCLUDE SQLCA                                            08370001
083800     END-EXEC.                                                    08380001
083900                                                                  08390001
084000                                                                  08400001
084100* DATA AREA USED BY SV005-A100-MAINLINE.                          08410001
084200     COPY SVWS005.                                                08420001
084300                                                                  08430001
084400* DATA AREA USED BY SV006-A100-MAINLINE.                          08440001
084500     COPY SVWS006.                                                08450001
084600* DATA AREA USED BY THE CHECK DIGIT ROUTINE.                      08460001
084700     COPY DPWS036.                                                08470017
084800                                                                  08480001
084900*----------------------------------------------------------------*08490001
085000 LINKAGE SECTION.                                                 08500001
085100*----------------------------------------------------------------*08510001
085200                                                                  08520001
085300******************************************************************08530001
085400 PROCEDURE DIVISION.                                              08540001
085500******************************************************************08550001
085600                                                                  08560001
085700 0000-MAINLINE.                                                   08570001
085800                                                                  08580001
085900     PERFORM 1000-INITIALIZE.                                     08590001
086000*                                                                 08600001
086100*  AUTHORIZE THE KMC TRANSACTION.                                 08610001
086200*                                                                 08620001
086300                                                                  08630001
086400     EVALUATE TRUE                                                08640001
086500       WHEN (NOT PV-SUCCESSFUL-AUTHORIZATION)                     08650001
086600           MOVE PV-REFERRAL-CODE-NUMBER                           08660001
086700                                     TO SV005-RESPONSE-CODE       08670001
086800           MOVE ZEROS                TO SV005-APPROVED-TENDER-AMT 08680001
086900           MOVE PV-KMC-AMOUNT        TO SV005-TRANS-AMT           08690001
087000* FOR TESTING PURPOSES FOR REFERRAL                               08700001
087100*                                                                 08710001
087200*               MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                08720005
087210*                         AM-POS-INQ-REMOTE-AUTH-MSG              08721005
087220*               MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER         08722005
087230*               MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                08723005
087240*                   TO  EP000-MD-SYSTEM-LOG-MESSAGE               08724005
087250*                           (EP000-MESSAGE-LINE-COUNTER)          08725005
087260*               ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER          08726005
087270*               MOVE PV-REQUEST-TYPE TO PV-REQUEST-TYPE1          08727005
087280*               MOVE PV-REVERSAL-IND TO PV-REVERSAL-IND1          08728005
087290*               STRING                                            08729005
087291*                   'CD-DB2-DATE '                                08729105
087292*                    CD-DB2-DATE-FORMAT                           08729205
087293*                   'SV005-POS-DATE '                             08729305
087294*                    SV005-POS-DATE                               08729405
087295*                   'PV-REVERSAL-IND ' PV-REVERSAL-IND1           08729505
087296*                   'PV-REQUEST-TYPE ' PV-REQUEST-TYPE1           08729605
087297*                  DELIMITED BY SIZE                              08729705
087298*                  INTO EP000-MD-SYSTEM-LOG-MESSAGE               08729805
087299*                           (EP000-MESSAGE-LINE-COUNTER)          08729905
087300*               END-STRING                                        08730005
087301*               PERFORM EP000-1000-POST-MESSAGE                   08730105
087302                                                                  08730201
087303       WHEN OTHER                                                 08730301
087304           PERFORM 2000-AUTHORIZE-KMC                             08730401
087305           IF (PV-TEST-KMRC-ACCOUNTS                              08730501
087306           OR  PV-TEST-GIFT-CARD-ACCOUNTS                         08730601
087307           OR  PV-TRAINING-KMRC-ACCOUNTS                          08730701
087308           OR  PV-TRAINING-GIFT-CARD-ACCOUNTS)                    08730801
087309              CONTINUE                                            08730901
087310           ELSE                                                   08731001
087320             EVALUATE TRUE                                        08732001
087330              WHEN SV005-PGM-ABEND                                08733001
087340                   SET PS-AUTH-MESSAGE-ERROR                      08734001
087350                       EP000-SL-ERROR TO TRUE                     08735001
087360                   MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO             08736001
087370                                      AM-POS-INQ-REMOTE-AUTH-MSG  08737001
087380                   MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER      08738001
087390                   MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE             08739001
087400                       TO  EP000-MD-SYSTEM-LOG-MESSAGE            08740001
087500                               (EP000-MESSAGE-LINE-COUNTER)       08750001
087600                   IF SV005-MESSAGE-1 = SPACE AND                 08760001
087700                       SV005-MESSAGE-2 = SPACE                    08770001
087800                       ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER   08780001
087900                       MOVE 'UNEXPECTED ABEND IN SVPD005 '        08790001
088000                           TO  EP000-MD-SYSTEM-LOG-MESSAGE        08800001
088100                                   (EP000-MESSAGE-LINE-COUNTER)   08810001
088200                   ELSE                                           08820001
088300                       ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER   08830001
088400                       MOVE SV005-MESSAGE-1                       08840001
088500                           TO  EP000-MD-SYSTEM-LOG-MESSAGE        08850001
088600                                   (EP000-MESSAGE-LINE-COUNTER)   08860001
088700                       ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER   08870001
088800                       MOVE SV005-MESSAGE-2                       08880001
088900                           TO  EP000-MD-SYSTEM-LOG-MESSAGE        08890001
089000                                   (EP000-MESSAGE-LINE-COUNTER)   08900001
089100                   END-IF                                         08910001
089200                   PERFORM EP000-1000-POST-MESSAGE                08920001
089300                                                                  08930001
089400              WHEN SV005-DUPLICATE                                08940001
089500              WHEN SV005-INQUIRE                                  08950001
089600              WHEN SV005-HARD-DECLINE                             08960001
089700              WHEN SV005-REFERRAL                                 08970001
089800*                 IF SV005-PS-TENDER-W-NO-ISSUE                   08980001
089900*                     MOVE 9 TO SV005-RESPONSE-CODE               08990001
090000*                 END-IF                                          09000001
090100                  MOVE SV005-RESPONSE-CODE TO                     09010001
090200                                      PV-REFERRAL-CODE-NUMBER     09020001
090300* FOR TESTING PURPOSES OR REFERRAL                                09030001
090400*                                                                 09040001
090500*               MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                09050004
090600*                         AM-POS-INQ-REMOTE-AUTH-MSG              09060004
090700*               MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER         09070004
090800*               MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                09080004
090900*                   TO  EP000-MD-SYSTEM-LOG-MESSAGE               09090004
091000*                           (EP000-MESSAGE-LINE-COUNTER)          09100004
091100*               ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER          09110004
091200*               MOVE PV-REQUEST-TYPE TO PV-REQUEST-TYPE1          09120004
091300*               MOVE PV-REVERSAL-IND TO PV-REVERSAL-IND1          09130004
091400*               STRING                                            09140004
091500*                   'CD-DB2-DATE1 '                               09150004
091600*                    CD-DB2-DATE-FORMAT                           09160004
091700*                   'SV005-POS-DATE '                             09170004
091800*                    SV005-POS-DATE                               09180004
091810*                   'PV-REVERSAL-IND ' PV-REVERSAL-IND1           09181004
091820*                   'PV-REQUEST-TYPE ' PV-REQUEST-TYPE1           09182004
091830*                  DELIMITED BY SIZE                              09183004
091840*                  INTO EP000-MD-SYSTEM-LOG-MESSAGE               09184004
091850*                           (EP000-MESSAGE-LINE-COUNTER)          09185004
091860*               END-STRING                                        09186004
091870*               PERFORM EP000-1000-POST-MESSAGE                   09187004
091880                                                                  09188001
091890              WHEN SV005-APPROVE                                  09189001
091900                  IF PV-CRD-TYP-CDE = SV005-CARD-TYPE             09190001
092000                       PERFORM 3000-SET-COLUMNS                   09200001
092100                       IF PV-REVERSAL OR PV-REVERSAL-REAUTH       09210001
092200                           INITIALIZE PV-RETRY-COUNT              09220001
092300                           PERFORM 4005-UPDATE-KMC-ACTIVITY-TABLE 09230001
092400                              WITH TEST AFTER                     09240001
092500                              UNTIL ((SQLCODE = ZERO) OR          09250001
092600                                     (PV-RETRY-COUNT >            09260001
092700                                      PC-MAXIMUM-RETRY-COUNT))    09270001
092800                           IF ((SQLCODE = -904) OR                09280001
092900                                (SQLCODE = -913))                 09290001
093000                                MOVE                              09300001
093100                               'UPDATE A ROW (SVT00002)'          09310001
093200                                      TO  AA-ATTEMPTED-ACTION     09320001
093300                               PERFORM 9100-DB2-ERROR             09330001
093400                               PERFORM 9999-RETURN-TO-NATIVE-CICS 09340001
093500                           END-IF                                 09350001
093600                           IF PV-REVERSAL                         09360001
093700                             SET SV005-REVERSAL TO TRUE           09370001
093710                           ELSE                                   09371001
093711                             IF PV-REVERSAL-REAUTH                09371101
093712                               SET SV005-REVERSAL-REAUTH TO TRUE  09371201
093713                             END-IF                               09371301
093714                           END-IF                                 09371401
093715                           IF SV005-REAUTH OR SV005-NORMAL        09371501
093716                             MOVE '0' TO SVT00002-TRN-RVRSL-CDE   09371601
093717                           ELSE                                   09371701
093718                             IF SV005-REVERSAL-REAUTH OR          09371801
093719                                SV005-REVERSAL                    09371901
093720                                MOVE '1' TO SVT00002-TRN-RVRSL-CDE09372001
093730                             END-IF                               09373001
093740                           END-IF                                 09374001
093770                           MOVE SV004-VOID-TRANS                  09377001
093780                                        TO SVT00002-TRN-VOID-IND  09378001
093790                           MOVE SV005-REVERSAL-AMT                09379001
093800                                        TO SVT00002-APP-AUTH-AMT  09380001
093900                                           SVT00002-ORIG-AUTH-AMT 09390001
094000                       END-IF                                     09400001
094100                       INITIALIZE PV-RETRY-COUNT                  09410001
094200                       PERFORM 4000-INSERT-KMC-ACTIVITY-TABLE     09420001
094300                                                                  09430001
094400                          WITH TEST AFTER                         09440001
094500                          UNTIL ((SQLCODE = ZERO) OR              09450001
094600                                 (PV-RETRY-COUNT >                09460001
094700                                  PC-MAXIMUM-RETRY-COUNT))        09470001
094800                       IF ((SQLCODE = -904) OR                    09480001
094900                            (SQLCODE = -913))                     09490001
095000                            MOVE                                  09500001
095100                           'INSERT A ROW (SVT00002)'              09510001
095200                                      TO  AA-ATTEMPTED-ACTION     09520001
095300                          PERFORM 9100-DB2-ERROR                  09530001
095400                          PERFORM 9999-RETURN-TO-NATIVE-CICS      09540001
095500                       END-IF                                     09550001
095600                  ELSE                                            09560001
095700                      SET PS-AUTH-MESSAGE-ERROR                   09570001
095800                          PV-EDIT-ERROR                           09580001
095900                          EP000-SL-ERROR                          09590001
096000                          PV-AUTH-RESP-SRC-NOT-INTENDED TO TRUE   09600001
096100                      MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO          09610001
096200                           AM-POS-INQ-REMOTE-AUTH-MSG             09620001
096300                      MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER   09630001
096400                      MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE          09640001
096500                          TO  EP000-MD-SYSTEM-LOG-MESSAGE         09650001
096600                                  (EP000-MESSAGE-LINE-COUNTER)    09660001
096700                      ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER    09670001
096800                      MOVE SV005-CARD-TYPE TO PV-CARD-TYPE        09680001
096900                      STRING                                      09690001
097000                       'A CARD IS BEING SENT AS AN INCORRECT CARD'09700001
097100                       ' TYPE' PV-CRD-TYP-CDE PV-CARD-TYPE        09710001
097200                       DELIMITED BY SIZE                          09720001
097300                       INTO  EP000-MD-SYSTEM-LOG-MESSAGE          09730001
097400                                  (EP000-MESSAGE-LINE-COUNTER)    09740001
097500                      END-STRING                                  09750001
097600                      PERFORM EP000-1000-POST-MESSAGE             09760001
097700                      MOVE PV-REFERRAL-CODE-NUMBER                09770001
097800                                     TO SV005-RESPONSE-CODE       09780001
097900                      MOVE ZEROS     TO SV005-APPROVED-TENDER-AMT 09790001
098000                      MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT      09800001
098100                  END-IF                                          09810001
098200            END-EVALUATE                                          09820001
098300         END-IF                                                   09830001
098400     END-EVALUATE.                                                09840001
098500                                                                  09850001
098600                                                                  09860001
098700*                                                                 09870001
098800*  FORMAT AND SEND AN AUTHORIZATION RESPONSE TO THE ISP.          09880001
098900*                                                                 09890001
099000                                                                  09900001
099100     PERFORM 5000-FORMAT-AUTHORIZATION-RESP.                      09910001
099200                                                                  09920001
099300*                                                                 09930001
099400*  AT END OF THE TRANSACTION (WHETHER IT COMPLETES SUCCESSFULLY   09940001
099500*  OR NOT), THE SVT_CRD_ACCT_LCK ROW MUST STILL BE DELETED        09950001
099600*                                                                 09960001
099700                                                                  09970001
099800     IF SV005-KMC-ID > 0                                          09980001
099900         PERFORM 4050-DELETE-KMC-LOCK-TABLE                       09990001
100000     END-IF.                                                      10000001
100100                                                                  10010001
100200*                                                                 10020001
100300*  IF THE AUTHORIZATION REQUEST WAS ISSUED AT A TRAINING REGISTER,10030001
100400*  TERMINATE THE TRANSACTION AFTER SENDING THE AUTHORIZATION      10040001
100500*  RESPONSE.  SINCE ALL ACTIVITY GENERATED IS FICTITIOUS, NO      10050001
100600*  REFERRALS OR APPROVALS FROM THESE REGISTERS SHOULD BE POSTED   10060001
100700*  TO THE PRODUCTION TABLES.                                      10070001
100800*                                                                 10080001
100900                                                                  10090001
101000     IF UA-TRAINING-REGISTER                                      10100001
101100         PERFORM 9999-RETURN-TO-NATIVE-CICS                       10110001
101200     END-IF.                                                      10120001
101300                                                                  10130001
101400                                                                  10140001
101500*                                                                 10150001
101600*  COMMIT ALL CHANGES PERFORM TERMINATING THE TRANSACTION.        10160001
101700*                                                                 10170001
101800                                                                  10180001
101900     EXEC CICS                                                    10190001
102000         SYNCPOINT                                                10200001
102100     END-EXEC.                                                    10210001
102200     SET LM-DM-RSP TO TRUE.                                       10220001
102300     PERFORM 1500-MESSAGE-MONITORING.                             10230001
102400                                                                  10240001
102500     GOBACK.                                                      10250001
102600                                                                  10260001
102700*0000-EXIT.                                                       10270001
102800                                                                  10280001
102900*----------------------------------------------------------------*10290001
103000*                                                                *10300001
103100*----------------------------------------------------------------*10310001
103200 1000-INITIALIZE.                                                 10320001
103300                                                                  10330001
103400     PERFORM EP000-0000-INITIALIZE.                               10340001
103500                                                                  10350001
103600     MOVE EP000-DT-CURR-DATE-YYYYMMDD                             10360001
103700         TO CD-CURRENT-DATE-YYYYMMDD-X.                           10370001
103800     MOVE CD-CURRENT-YEAR   TO  CD-YYYY.                          10380001
103900     MOVE CD-CURRENT-MONTH  TO  CD-MM.                            10390001
104000     MOVE CD-CURRENT-DAY    TO  CD-DD.                            10400001
104100                                                                  10410001
104200     IF EP000-DT-CURRENT-TIME < 030000                            10420001
104300         PERFORM 1010-USE-YESTERDAY-DATE                          10430001
104400     END-IF.                                                      10440001
104500                                                                  10450001
104600     IF EP000-PV-KOHLS-PROD-SYSTEM                                10460001
104700         SET PC-PROD-QMGR-NAME  TO  TRUE                          10470001
104800     ELSE                                                         10480001
104900        IF EP000-PV-KOHLS-QA-SYSTEM                               10490001
105000            SET PC-QA-QMGR-NAME  TO  TRUE                         10500001
105100        ELSE                                                      10510001
105200            SET PC-TEST-QMGR-NAME  TO  TRUE                       10520001
105300        END-IF                                                    10530001
105400     END-IF.                                                      10540001
105500                                                                  10550001
105600     MOVE PC-CURRENT-PROGRAM-NAME TO CS-CURRENT-PROGRAM-NAME.     10560001
105700     SET PS-DO-THE-SEND           TO TRUE.                        10570001
105800                                                                  10580001
105900     SET SV005-PS-TENDER-W-ISSUE TO TRUE.                         10590001
106000                                                                  10600001
106100     PERFORM 7000-RETRIEVE-AUTH-REQUEST.                          10610001
106200                                                                  10620001
106300     MOVE CI-POS-INQ-REMOTE-AUTH-MSG TO                           10630001
106400               PI-POS-INQ-REMOTE-AUTH-MSG.                        10640001
106500                                                                  10650001
106600     IF PC-COMMUNICATIONS-IN-LENGTH  NOT = 6                      10660001
106700       CALL 'CRKUT002' USING PI-POS-INQ-REMOTE-AUTH-MSG           10670001
106800                             UA-AUTHORIZATION-HEADER              10680001
106900                             UA-AUTHORIZATION-DETAIL              10690001
107000     ELSE                                                         10700001
107100       CALL 'CRKUT002' USING TM-POS-INQ-REMOTE-AUTH-MSG           10710001
107200                             UA-AUTHORIZATION-HEADER              10720001
107300                             UA-AUTHORIZATION-DETAIL              10730001
107400     END-IF.                                                      10740001
107500     IF ((UA-AUTHORIZATION-HEADER = SPACES)                       10750001
107600             OR (UA-AUTHORIZATION-DETAIL = SPACES)                10760001
107700             OR (UA-STORE-NUMBER-X NOT NUMERIC)                   10770001
107800             OR (UA-TERMINAL-NUMBER NOT NUMERIC)                  10780001
107900             OR (UA-TRANSACTION-NUMBER NOT NUMERIC)               10790001
108000             OR (UA-TRANSACTION-TYPE NOT NUMERIC))                10800001
108100         SET PS-SYSTEM-ERROR-DETECTED                             10810001
108200             PV-SYSTEM-ERROR-REFERRAL-CODE                        10820001
108300             PV-AUTH-RESP-SRC-NOT-INTENDED                        10830001
108400             EP000-SL-ERROR                                       10840001
108500             PS-AUTH-MESSAGE-ERROR  TO TRUE                       10850001
108600         MOVE PI-POS-INQ-REMOTE-AUTH-MSG                          10860001
108700                                    TO AM-POS-INQ-REMOTE-AUTH-MSG 10870001
108800         MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                10880001
108900         MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                       10890001
109000             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      10900001
109100                     (EP000-MESSAGE-LINE-COUNTER)                 10910001
109200         ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER                 10920001
109300         MOVE 'NON-NUMERIC OR MISSING AUTHORIZATION REQUEST HEADER10930001
109400-                  ' FIELDS'   TO EP000-MD-SYSTEM-LOG-MESSAGE     10940001
109500                                     (EP000-MESSAGE-LINE-COUNTER) 10950001
109600         PERFORM EP000-1000-POST-MESSAGE                          10960001
109700     END-IF.                                                      10970001
109800                                                                  10980001
109900     IF PV-SUCCESSFUL-AUTHORIZATION                               10990001
110000         MOVE UA-STORE-NUMBER   TO XST00001-LOC-NBR               11000001
110100         PERFORM 4100-DETERMINE-IF-VALID-STR                      11010001
110200     END-IF.                                                      11020001
110300*                                                                 11030001
110400*  AUTHORIZATION REQUEST DETAIL FIELDS ARE VARIABLE IN            11040001
110500*  LENGTH, AND WILL BE UNSTRUNG FIELD BY FIELD.  TENDER TYPE      11050001
110600*  MUST BE EQUAL TO 02, REQUEST TYPE MUST BE EITHER 0 OR 1,       11060001
110700*  KMC ID MUST BE PRESENT IN THE MESSAGE.                         11070001
110800*                                                                 11080001
110900*                                                                 11090001
111000     IF PV-SUCCESSFUL-AUTHORIZATION                               11100001
111100         SET UA-BYTE-INDEX                                        11110001
111200             FW-BYTE-INDEX TO 1                                   11120001
111300         MOVE -1 TO PV-PIN                                        11130001
111400         MOVE PC-INVALID-REQ-CD TO PV-REVERSAL-IND                11140001
111500         MOVE PC-INVALID-REQ-CD TO PV-REQUEST-TYPE                11150001
111600         MOVE 0                 TO PV-KMC-ID                      11160001
111700                                   SV005-KMC-ID                   11170001
111800                                                                  11180001
111900         PERFORM 1100-UNSTRING-AUTH-DETAIL                        11190001
112000             UNTIL ((UA-BYTE-INDEX >                              11200001
112100                                  PC-MAXIMUM-VARIABLE-AUTH-BYTES) 11210001
112200                   OR (UA-END-OF-MESSAGE (UA-BYTE-INDEX)))        11220001
112300                                                                  11230001
112400*             SET CARD TYPE BASED ON THE TENDER TYPE PASSED IN    11240001
112500*             FIELD 05.  IF THE TENDER TYPE IS NOT KMRC OR G.C.   11250001
112600*             THEN SET CARD TYPE TO SPACES (ERROR CONDITION).     11260001
112700         EVALUATE TRUE                                            11270001
112800             WHEN (PV-GIFT-CARD-TENDER-TYPE)                      11280001
112900                 SET  PV-GIFT-CRD-TYP-CDE  TO  TRUE               11290001
113000             WHEN (PV-KMRC-CARD-TENDER-TYPE)                      11300001
113100                 SET  PV-KMRC-CRD-TYP-CDE  TO  TRUE               11310001
113200             WHEN OTHER                                           11320001
113300                 MOVE SPACES  TO  PV-CRD-TYP-CDE-FULL             11330001
113400         END-EVALUATE                                             11340001
113500                                                                  11350001
113510         INITIALIZE PV-SPACE-COUNT                                11351025
113520         INSPECT FUNCTION REVERSE(PV-OPERATOR-ID)                 11352025
113530             TALLYING PV-SPACE-COUNT FOR LEADING SPACES           11353025
113540         INITIALIZE PV-ZERO-COUNT                                 11354025
113550         INSPECT PV-OPERATOR-ID                                   11355025
113560           TALLYING PV-ZERO-COUNT FOR LEADING ZEROES              11356025
113570         COMPUTE PV-OPRT-ID-LEN = LENGTH OF PV-OPERATOR-ID        11357025
113580                               - (PV-ZERO-COUNT + PV-SPACE-COUNT) 11358025
113590                                                                  11359025
113600         PERFORM 1200-CHECK-REQUEST                               11360001
113700     END-IF.                                                      11370001
113800                                                                  11380001
113900*1000-EXIT.                                                       11390001
114000                                                                  11400001
114100*----------------------------------------------------------------*11410001
114200*1010-USE-YESTERDAY-DATE.                                        *11420001
114300*     WHEN THE TIME IS BETWEEN MIDNIGHT AND 3:00 AM, THE POS DATE*11430001
114400*     SHOULD BE SET TO YESTERDAY.  THIS OCCURS DURING THE        *11440001
114500*     CHRISTMAS HOLIDAY WHEN THE STORES ARE OPEN UNTIL MIDNIGHT. *11450001
114600*----------------------------------------------------------------*11460001
114700 1010-USE-YESTERDAY-DATE.                                         11470001
114800                                                                  11480001
114900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              11490001
115000                                                                  11500001
115100     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      11510001
115200     SET DPG51-DECREMENT-DATE       TO TRUE.                      11520001
115300     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    11530001
115400                                                                  11540001
115500     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      11550001
115600     MOVE CD-DB2-DATE-FORMAT        TO DPG52-LK-DATE-INPUT.       11560001
115700                                                                  11570001
115800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          11580001
115900                                DPG53 DPG54                       11590001
116000                                DPG55 DPG56.                      11600001
116100                                                                  11610001
116200     EVALUATE TRUE                                                11620001
116300         WHEN DPG54-SEVERE-ERROR                                  11630001
116400         WHEN DPG54-DATE-INVALID                                  11640001
116500                                                                  11650001
116600         SET PS-SYSTEM-ERROR-DETECTED                             11660001
116700             PV-SYSTEM-ERROR-REFERRAL-CODE                        11670001
116800             PV-AUTH-RESP-SRC-NOT-INTENDED                        11680001
116900             EP000-SL-ERROR                                       11690001
117000             PS-AUTH-MESSAGE-ERROR  TO TRUE                       11700001
117100         MOVE PI-POS-INQ-REMOTE-AUTH-MSG                          11710001
117200                                    TO AM-POS-INQ-REMOTE-AUTH-MSG 11720001
117300         MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                11730001
117400         MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                       11740001
117500             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      11750001
117600                     (EP000-MESSAGE-LINE-COUNTER)                 11760001
117700         ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER                 11770001
117800         MOVE 'CALENDAR DATE ROUTINE ERROR'                       11780001
117900                               TO EP000-MD-SYSTEM-LOG-MESSAGE     11790001
118000                                     (EP000-MESSAGE-LINE-COUNTER) 11800001
118100         PERFORM EP000-1000-POST-MESSAGE                          11810001
118200     END-EVALUATE.                                                11820001
118300                                                                  11830001
118400     IF PS-SYSTEM-ERROR-DETECTED                                  11840001
118500         CONTINUE                                                 11850001
118600     ELSE                                                         11860001
118700         MOVE DPG55-DB2-ISO-DATE-FMT  TO CD-DB2-DATE-FORMAT       11870001
118800     END-IF.                                                      11880001
118900                                                                  11890001
119000*----------------------------------------------------------------*11900001
119100*                                                                *11910001
119200*----------------------------------------------------------------*11920001
119300 1100-UNSTRING-AUTH-DETAIL.                                       11930001
119400     INITIALIZE FW-FIELD-WORK-AREA.                               11940001
119500                                                                  11950001
119600     MOVE UA-AUTH-DETAIL-BYTE (UA-BYTE-INDEX) TO                  11960001
119700               FW-FIELD-LENGTH-1.                                 11970001
119800     SET UA-BYTE-INDEX UP BY 1.                                   11980001
119900     MOVE UA-AUTH-DETAIL-BYTE (UA-BYTE-INDEX) TO                  11990001
120000               FW-FIELD-LENGTH-2.                                 12000001
120100     SET UA-BYTE-INDEX UP BY 1.                                   12010001
120200     MOVE UA-AUTH-DETAIL-BYTE (UA-BYTE-INDEX) TO                  12020001
120300               FW-FIELD-CODE-1.                                   12030001
120400     SET UA-BYTE-INDEX UP BY 1.                                   12040001
120500     MOVE UA-AUTH-DETAIL-BYTE (UA-BYTE-INDEX) TO                  12050001
120600               FW-FIELD-CODE-2.                                   12060001
120700     SET UA-BYTE-INDEX UP BY 1.                                   12070001
120800                                                                  12080001
120900     SET UA-START-INDEX TO UA-BYTE-INDEX.                         12090001
121000                                                                  12100001
121100     PERFORM                                                      12110001
121200             UNTIL ((UA-BYTE-INDEX >                              12120001
121300                                 PC-MAXIMUM-VARIABLE-AUTH-BYTES)  12130001
121400                     OR (UA-END-OF-FIELD (UA-BYTE-INDEX))         12140001
121500                     OR (UA-END-OF-MESSAGE (UA-BYTE-INDEX)))      12150001
121600         SET UA-BYTE-INDEX UP BY 1                                12160001
121700     END-PERFORM.                                                 12170001
121800                                                                  12180001
121900     SET UA-END-INDEX TO UA-BYTE-INDEX.                           12190001
122000     SET UA-BYTE-INDEX DOWN BY 1.                                 12200001
122100     SET FW-BYTE-INDEX TO PC-MAXIMUM-FIELD-WORK-BYTES.            12210001
122200                                                                  12220001
122300     PERFORM                                                      12230001
122400             UNTIL ((UA-BYTE-INDEX < UA-START-INDEX)              12240001
122500                     OR (FW-BYTE-INDEX < 1))                      12250001
122600         MOVE UA-AUTH-DETAIL-BYTE (UA-BYTE-INDEX) TO              12260001
122700                   FW-FIELD-BYTE (FW-BYTE-INDEX)                  12270001
122800         SET UA-BYTE-INDEX                                        12280001
122900             FW-BYTE-INDEX DOWN BY 1                              12290001
123000     END-PERFORM.                                                 12300001
123001                                                                  12300130
123200     INSPECT FW-VARIABLE-FIELD                                    12320001
123300         REPLACING LEADING SPACES BY ZEROS.                       12330001
123400                                                                  12340001
123500     SET UA-BYTE-INDEX TO UA-END-INDEX.                           12350001
123600                                                                  12360001
123700     EVALUATE TRUE                                                12370001
123800         WHEN (UA-BYTE-INDEX > PC-MAXIMUM-VARIABLE-AUTH-BYTES)    12380001
123900             SET UA-BYTE-INDEX DOWN BY 1                          12390001
124000             SET UA-END-OF-MESSAGE (UA-BYTE-INDEX) TO TRUE        12400001
124100         WHEN FW-KMC-ID-FIELD                                     12410001
124200* FOR TESTING PURPOSES                                            12420001
124300*            MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                   12430001
124400*                         AM-POS-INQ-REMOTE-AUTH-MSG              12440001
124500*            MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER            12450001
124600*            MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                   12460001
124700*                   TO  EP000-MD-SYSTEM-LOG-MESSAGE               12470001
124800*                           (EP000-MESSAGE-LINE-COUNTER)          12480001
124900*            ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER             12490001
125000*            STRING                                               12500001
125100*                   'ACCOUNT '                                    12510001
125200*                    FW-VARIABLE-FIELD                            12520001
125300*                    FW-KMC-ID                                    12530001
125400*                  DELIMITED BY SIZE                              12540001
125500*                  INTO EP000-MD-SYSTEM-LOG-MESSAGE               12550001
125600*                           (EP000-MESSAGE-LINE-COUNTER)          12560001
125700*            END-STRING                                           12570001
125800*            PERFORM EP000-1000-POST-MESSAGE                      12580001
125900             PERFORM 1110-COMPUTE-CHECK-DIGIT                     12590001
126000             IF PV-CHECK-DIGIT = FW-CHECK-DIGIT                   12600001
126100                MOVE FW-KMC-ID  TO  PV-KMC-ID                     12610001
126200             ELSE                                                 12620001
126300                SET PS-AUTH-MESSAGE-ERROR                         12630001
126400                    PV-EDIT-ERROR                                 12640001
126500                    EP000-SL-ERROR                                12650001
126600                    PV-AUTH-RESP-SRC-NOT-INTENDED TO TRUE         12660001
126700                MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                12670001
126800                          AM-POS-INQ-REMOTE-AUTH-MSG              12680001
126900                MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER         12690001
127000                MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                12700001
127100                    TO  EP000-MD-SYSTEM-LOG-MESSAGE               12710001
127200                            (EP000-MESSAGE-LINE-COUNTER)          12720001
127300                ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER          12730001
127400                STRING                                            12740001
127500                    'ACCOUNT '                                    12750001
127600                     FW-KMC-ID                                    12760001
127700                     ' IS INVALID '                               12770001
127800                   DELIMITED BY SIZE                              12780001
127900                   INTO EP000-MD-SYSTEM-LOG-MESSAGE               12790001
128000                            (EP000-MESSAGE-LINE-COUNTER)          12800001
128100                END-STRING                                        12810001
128200                PERFORM EP000-1000-POST-MESSAGE                   12820001
128300             END-IF                                               12830001
128400         WHEN FW-KMC-AMOUNT-FIELD                                 12840001
128500             MOVE FW-KMC-AMOUNT TO PV-KMC-AMOUNT                  12850001
128600         WHEN FW-DRIVER-LICENSE-FIELD                             12860001
128700             PERFORM 1120-PROCESS-DRIVERS-LICENSE                 12870001
128800         WHEN FW-TENDER-TYPE-FIELD                                12880001
128900             MOVE FW-TENDER-TYPE  TO PV-FIELD-CODE-FIVE           12890001
129000         WHEN FW-CRD-TYP-CDE-FIELD                                12900001
129100             MOVE FW-CRD-TYP-CDE  TO PV-CRD-TYP-CDE-FULL          12910001
129200         WHEN FW-OPERATOR-ID-FIELD                                12920001
129300             INSPECT FW-OPERATOR-ID                               12930001
129400                REPLACING ALL PC-F-FILL BY ZEROS                  12940001
129500             MOVE FW-OPERATOR-ID TO PV-OPERATOR-ID                12950001
129600         WHEN FW-REQUEST-TYPE-FIELD                               12960001
129700            IF FW-REVERSAL-IND IS NUMERIC                         12970001
129800                MOVE FW-REVERSAL-IND   TO PV-REVERSAL-IND         12980001
129900            ELSE                                                  12990001
130000                MOVE PC-INVALID-REQ-CD TO PV-REVERSAL-IND         13000001
130100            END-IF                                                13010001
130200            IF FW-REQUEST-TYPE IS NUMERIC                         13020001
130300               MOVE FW-REQUEST-TYPE   TO PV-REQUEST-TYPE          13030001
130400            ELSE                                                  13040001
130500               MOVE PC-INVALID-REQ-CD TO PV-REQUEST-TYPE          13050001
130600            END-IF                                                13060001
130700         WHEN FW-PIN-FIELD                                        13070001
130800            IF FW-PIN = SPACES                                    13080001
130900                MOVE -2 TO PV-PIN                                 13090001
131000            ELSE                                                  13100001
131100                MOVE FW-PIN TO PV-PIN                             13110001
131200* FOR TESTING PURPOSES                                            13120001
131300*               MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                13130001
131400*                         AM-POS-INQ-REMOTE-AUTH-MSG              13140001
131500*               MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER         13150001
131600*               MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                13160001
131700*                   TO  EP000-MD-SYSTEM-LOG-MESSAGE               13170001
131800*                           (EP000-MESSAGE-LINE-COUNTER)          13180001
131900*               ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER          13190001
132000*               STRING                                            13200001
132100*                   'BEFORE PIN '                                 13210001
132200*                    PV-PIN                                       13220001
132300*                   'BEFORE PV-KMC-ID '                           13230001
132400*                    PV-KMC-ID                                    13240001
132500*                  DELIMITED BY SIZE                              13250001
132600*                  INTO EP000-MD-SYSTEM-LOG-MESSAGE               13260001
132700*                           (EP000-MESSAGE-LINE-COUNTER)          13270001
132800*               END-STRING                                        13280001
132900*               PERFORM EP000-1000-POST-MESSAGE                   13290001
133000*               IF EP000-PV-KOHLS-PROD-SYSTEM                     13300001
133100                    PERFORM 1130-ENCRYPT-PIN                      13310001
133200*               END-IF                                            13320001
133300* FOR TESTING PURPOSES                                            13330001
133400*               MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                13340001
133500*                         AM-POS-INQ-REMOTE-AUTH-MSG              13350001
133600*               MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER         13360001
133700*               MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                13370001
133800*                   TO  EP000-MD-SYSTEM-LOG-MESSAGE               13380001
133900*                           (EP000-MESSAGE-LINE-COUNTER)          13390001
134000*               ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER          13400001
134100*               STRING                                            13410001
134200*                   'AFTER PIN '                                  13420001
134300*                    PV-PIN                                       13430001
134400*                  DELIMITED BY SIZE                              13440001
134500*                  INTO EP000-MD-SYSTEM-LOG-MESSAGE               13450001
134600*                           (EP000-MESSAGE-LINE-COUNTER)          13460001
134700*               END-STRING                                        13470001
134800*               PERFORM EP000-1000-POST-MESSAGE                   13480001
134900            END-IF                                                13490001
135000     END-EVALUATE.                                                13500001
135100                                                                  13510001
135200     IF UA-END-OF-FIELD (UA-BYTE-INDEX)                           13520001
135300         SET UA-BYTE-INDEX UP BY 1                                13530001
135400     END-IF.                                                      13540001
135500*1100-EXIT.                                                       13550001
135600                                                                  13560001
135700******************************************************************13570001
135800*  COMPUTE A MOD 10 CHECK DIGIT ON THE CURRENT ID NUMBER         *13580001
135900*  PRESENTED AT THE POINT-OF-SALE.  ALL KOHL'S CHARGE ACCOUNT    *13590001
136000*  NUMBERS WILL HAVE A VALID MOD 10 CHECK DIGIT.                 *13600001
136100******************************************************************13610001
136200 1110-COMPUTE-CHECK-DIGIT.                                        13620001
136300     SET PS-MULTIPLY-DIGIT-BY-1 TO TRUE.                          13630001
136400     INITIALIZE PV-MOD-10-DIGIT-SUM.                              13640001
136500                                                                  13650001
136600     PERFORM                                                      13660001
136700             VARYING FW-DIGIT-INDEX                               13670001
136800             FROM 1 BY 1                                          13680001
136900             UNTIL FW-DIGIT-INDEX = PC-MAXIMUM-FIELD-WORK-BYTES   13690001
137000         IF PS-MULTIPLY-DIGIT-BY-2                                13700001
137100             COMPUTE PV-ACCOUNT-DIGIT-MOD-10 =                    13710001
137200                       (FW-KMC-DIGIT (FW-DIGIT-INDEX) * 2)        13720001
137300             IF PV-ACCOUNT-DIGIT-MOD-10 > PC-MAXIMUM-DIGIT-AMOUNT 13730001
137400                 SUBTRACT PC-MAXIMUM-DIGIT-AMOUNT FROM            13740001
137500                           PV-ACCOUNT-DIGIT-MOD-10                13750001
137600             END-IF                                               13760001
137700             ADD PV-ACCOUNT-DIGIT-MOD-10 TO PV-MOD-10-DIGIT-SUM   13770001
137800             SET PS-MULTIPLY-DIGIT-BY-1 TO TRUE                   13780001
137900         ELSE                                                     13790001
138000             ADD FW-KMC-DIGIT (FW-DIGIT-INDEX) TO                 13800001
138100                       PV-MOD-10-DIGIT-SUM                        13810001
138200             SET PS-MULTIPLY-DIGIT-BY-2 TO TRUE                   13820001
138300         END-IF                                                   13830001
138400     END-PERFORM.                                                 13840001
138500                                                                  13850001
138600     COMPUTE PV-CHECK-DIGIT = (PC-MOD-10 - PV-MOD-10-DIGIT-SUM).  13860001
138700*1110-EXIT.                                                       13870001
138800                                                                  13880001
138900******************************************************************13890001
139000*  LEFT JUSTIFY THE DRIVERS LICENSE NUMBER AT THE FIRST          *13900001
139100*  SIGNIFICANT, NON-ZERO DIGIT.  FIND THE FIRST SIGNIFICANT      *13910001
139200*  DIGIT.  MOVE ALL DIGITS FROM THAT POSITION TO THE END OF THE  *13920001
139300*  WORK AREA TO A LEFT JUSTIFIED POSITION IN THE WORK AREA.      *13930001
139400*  INITIALIZE ALL REMAINING, TRAILING POSITIONS IN THE JUSTIFIED *13940001
139500*  WORK AREA TO SPACES.                                          *13950001
139600******************************************************************13960001
139700 1120-PROCESS-DRIVERS-LICENSE.                                    13970001
139800     PERFORM                                                      13980001
139900             VARYING FW-LEFT-INDEX                                13990001
140000             FROM 1 BY 1                                          14000001
140100             UNTIL ((FW-LEFT-INDEX > PC-MAXIMUM-FIELD-WORK-BYTES) 14010001
140200                     OR (FW-FIELD-BYTE (FW-LEFT-INDEX) NOT =      14020001
140300                                                           ZERO)) 14030001
140400     END-PERFORM.                                                 14040001
140500                                                                  14050001
140600     SET FW-BYTE-INDEX TO 1.                                      14060001
140700                                                                  14070001
140800     PERFORM                                                      14080001
140900             UNTIL (FW-LEFT-INDEX >                               14090001
141000                     PC-MAXIMUM-FIELD-WORK-BYTES)                 14100001
141100         MOVE FW-FIELD-BYTE (FW-LEFT-INDEX) TO                    14110001
141200                   FW-FIELD-BYTE (FW-BYTE-INDEX)                  14120001
141300         SET FW-LEFT-INDEX                                        14130001
141400             FW-BYTE-INDEX UP BY 1                                14140001
141500     END-PERFORM.                                                 14150001
141600                                                                  14160001
141700     PERFORM                                                      14170001
141800             UNTIL (FW-BYTE-INDEX > PC-MAXIMUM-FIELD-WORK-BYTES)  14180001
141900         INITIALIZE FW-FIELD-BYTE (FW-BYTE-INDEX)                 14190001
142000         SET FW-BYTE-INDEX UP BY 1                                14200001
142100     END-PERFORM.                                                 14210001
142200                                                                  14220001
142300     MOVE FW-DRIVERS-LICENSE-NUMBER TO PV-DRIVERS-LICENSE-NBR.    14230001
142400*1120-EXIT.                                                       14240001
142500                                                                  14250001
142600******************************************************************14260001
142700*  ENCRYPT THE PIN THAT CAME IN THE AUTH TO BE VALIDATED         *14270001
142800*  AGAINST THE ENCRYPTED PIN IN THE TABLE.                       *14280001
142900******************************************************************14290001
143000 1130-ENCRYPT-PIN.                                                14300001
143100                                                                  14310001
143200     MOVE PV-PIN TO PV-PIN-NBR.                                   14320001
143300     MOVE PV-KMC-ID TO PV-CARD-NBR.                               14330001
143400                                                                  14340001
143500     ADD PV-PIN-4 TO PV-CARD-3 GIVING PV-DIGIT-1.                 14350001
143600     ADD PV-PIN-3 TO PV-CARD-5 GIVING PV-DIGIT-2.                 14360001
143700     ADD PV-PIN-2 TO PV-CARD-7 GIVING PV-DIGIT-3.                 14370001
143800     ADD PV-PIN-1 TO PV-CARD-9 GIVING PV-DIGIT-4.                 14380001
143900                                                                  14390001
144000     IF PV-DIGIT-1 >= 10                                          14400001
144100         SUBTRACT 10 FROM PV-DIGIT-1                              14410001
144200     END-IF.                                                      14420001
144300                                                                  14430001
144400     IF PV-DIGIT-2 >= 10                                          14440001
144500         SUBTRACT 10 FROM PV-DIGIT-2                              14450001
144600     END-IF.                                                      14460001
144700                                                                  14470001
144800     IF PV-DIGIT-3 >= 10                                          14480001
144900         SUBTRACT 10 FROM PV-DIGIT-3                              14490001
145000     END-IF.                                                      14500001
145100                                                                  14510001
145200     IF PV-DIGIT-4 >= 10                                          14520001
145300         SUBTRACT 10 FROM PV-DIGIT-4                              14530001
145400     END-IF.                                                      14540001
145500                                                                  14550001
145600     MOVE PV-DIGIT-1 TO PV-ENCRYPT-1.                             14560001
145700     MOVE PV-DIGIT-2 TO PV-ENCRYPT-2.                             14570001
145800     MOVE PV-DIGIT-3 TO PV-ENCRYPT-3.                             14580001
145900     MOVE PV-DIGIT-4 TO PV-ENCRYPT-4.                             14590001
146000     MOVE PV-ENCRYPT TO PV-PIN.                                   14600001
146100                                                                  14610001
146200*----------------------------------------------------------------*14620001
146300*  ERROR CHECKING ON THE CARD AND TRANSACTION AMOUNT             *14630001
146400*----------------------------------------------------------------*14640001
146500 1200-CHECK-REQUEST.                                              14650001
146600     IF (NOT (PV-BALANCE-INQUIRY       OR                         14660001
146700              PV-ISSUANCE-AS-KMRC      OR                         14670001
146800              PV-ISSUANCE-AS-GIFT-CARD OR                         14680001
146900              PV-TENDER ))                                        14690001
147000       OR    (NOT (PV-NORMAL OR PV-REVERSAL OR PV-REAUTH          14700001
147100                             OR PV-REVERSAL-REAUTH))              14710001
147200       OR    (NOT (PV-VALID-TENDER-TYPE))                         14720001
147300          SET PS-SYSTEM-ERROR-DETECTED                            14730001
147400              PV-EDIT-ERROR                                       14740001
147500              EP000-SL-ERROR                                      14750001
147600              PV-AUTH-RESP-SRC-NOT-INTENDED                       14760001
147700              PS-AUTH-MESSAGE-ERROR TO TRUE                       14770001
147800          MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                      14780001
147900                        AM-POS-INQ-REMOTE-AUTH-MSG                14790001
148000          MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER               14800001
148100          MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                      14810001
148200              TO  EP000-MD-SYSTEM-LOG-MESSAGE                     14820001
148300                      (EP000-MESSAGE-LINE-COUNTER)                14830001
148400          ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER                14840001
148500          MOVE 'INVALID REQUEST TYPE'                             14850001
148600              TO  EP000-MD-SYSTEM-LOG-MESSAGE                     14860001
148700                      (EP000-MESSAGE-LINE-COUNTER)                14870001
148800          PERFORM EP000-1000-POST-MESSAGE                         14880001
148900     ELSE                                                         14890001
149000         EVALUATE TRUE                                            14900001
149100            WHEN  PV-ISSUANCE-AS-KMRC                             14910001
149200                IF (( (PV-DRIVERS-LICENSE-NBR = SPACES)           14920001
149300                        OR (PV-KMC-ID = ZEROS)                    14930001
149400                        OR (PV-KMC-AMOUNT NOT > ZERO)             14940001
149500                        OR (PV-OPRT-ID-LEN = 0)                   14950025
149600                        OR (PV-CRD-TYP-CDE = SPACES) ))           14960001
149700                    SET PS-SYSTEM-ERROR-DETECTED                  14970001
149800                        PV-EDIT-ERROR                             14980001
149900                        EP000-SL-ERROR                            14990001
150000                        PV-AUTH-RESP-SRC-NOT-INTENDED             15000001
150100                        PS-AUTH-MESSAGE-ERROR TO TRUE             15010001
150200                    MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO            15020001
150300                              AM-POS-INQ-REMOTE-AUTH-MSG          15030001
150400                    MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER     15040001
150500                    MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE            15050001
150600                        TO  EP000-MD-SYSTEM-LOG-MESSAGE           15060001
150700                                (EP000-MESSAGE-LINE-COUNTER)      15070001
150800                    ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER      15080001
150900                    MOVE 'NO KMC ID, KMC AMOUNT, OPERATOR ID, OR D15090001
151000-                  'RIVERS LICENSE DETECTED IN THE '              15100001
151100                        TO  EP000-MD-SYSTEM-LOG-MESSAGE           15110001
151200                                (EP000-MESSAGE-LINE-COUNTER)      15120001
151300                    ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER      15130001
151400                    MOVE 'AUTHORIZATION REQUEST MESSAGE'          15140001
151500                        TO  EP000-MD-SYSTEM-LOG-MESSAGE           15150001
151600                                (EP000-MESSAGE-LINE-COUNTER)      15160001
151700                    PERFORM EP000-1000-POST-MESSAGE               15170001
151800                END-IF                                            15180001
151900            WHEN  PV-ISSUANCE-AS-GIFT-CARD                        15190001
152000                IF (( (PV-KMC-ID = ZEROS)                         15200001
152100                   OR (PV-KMC-AMOUNT NOT > ZERO)                  15210001
152200                   OR (PV-OPRT-ID-LEN = 0)                        15220025
152300                   OR (PV-CRD-TYP-CDE = SPACES) ))                15230001
152400                    SET PS-SYSTEM-ERROR-DETECTED                  15240001
152500                        PV-EDIT-ERROR                             15250001
152600                        EP000-SL-ERROR                            15260001
152700                        PV-AUTH-RESP-SRC-NOT-INTENDED             15270001
152800                        PS-AUTH-MESSAGE-ERROR TO TRUE             15280001
152900                    MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO            15290001
153000                              AM-POS-INQ-REMOTE-AUTH-MSG          15300001
153100                    MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER     15310001
153200                    MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE            15320001
153300                        TO  EP000-MD-SYSTEM-LOG-MESSAGE           15330001
153400                                (EP000-MESSAGE-LINE-COUNTER)      15340001
153500                    ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER      15350001
153600                    MOVE 'NO KMC ID, OR OPERATOR ID DETECTED IN ' 15360001
153700                        TO  EP000-MD-SYSTEM-LOG-MESSAGE           15370001
153800                                (EP000-MESSAGE-LINE-COUNTER)      15380001
153900                    ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER      15390001
154000                    MOVE 'THE AUTHORIZATION REQUEST MESSAGE'      15400001
154100                        TO  EP000-MD-SYSTEM-LOG-MESSAGE           15410001
154200                                (EP000-MESSAGE-LINE-COUNTER)      15420001
154300                    PERFORM EP000-1000-POST-MESSAGE               15430001
154400                END-IF                                            15440001
154500            WHEN PV-TENDER                                        15450001
154600                IF   ( (   (PV-OPRT-ID-LEN = 0)                   15460025
154700                        OR (PV-KMC-ID = ZEROS )                   15470001
154800                        OR (PV-KMC-AMOUNT NOT > ZERO)             15480001
154900                        OR (PV-CRD-TYP-CDE = SPACES) ))           15490001
155000                    SET PS-SYSTEM-ERROR-DETECTED                  15500001
155100                        PV-EDIT-ERROR                             15510001
155200                        EP000-SL-ERROR                            15520001
155300                        PV-AUTH-RESP-SRC-NOT-INTENDED             15530001
155400                        PS-AUTH-MESSAGE-ERROR TO TRUE             15540001
155500                    MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO            15550001
155600                              AM-POS-INQ-REMOTE-AUTH-MSG          15560001
155700                    MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER     15570001
155800                    MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE            15580001
155900                        TO  EP000-MD-SYSTEM-LOG-MESSAGE           15590001
156000                                (EP000-MESSAGE-LINE-COUNTER)      15600001
156100                    ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER      15610001
156200                    MOVE 'NO KMC ID, KMC AMOUNT, OR OPERATOR ID DE15620001
156300-                       ' TECTED IN THE AUTHORIZATION MESSAGE'    15630001
156400                          TO  EP000-MD-SYSTEM-LOG-MESSAGE         15640001
156500                                  (EP000-MESSAGE-LINE-COUNTER)    15650001
156600                    PERFORM EP000-1000-POST-MESSAGE               15660001
156700                END-IF                                            15670001
156800            WHEN PV-BALANCE-INQUIRY                               15680001
156900                IF (PV-KMC-ID = ZEROS )                           15690001
157000                    SET PS-SYSTEM-ERROR-DETECTED                  15700001
157100                        PV-EDIT-ERROR                             15710001
157200                        EP000-SL-ERROR                            15720001
157300                        PV-AUTH-RESP-SRC-NOT-INTENDED             15730001
157400                        PS-AUTH-MESSAGE-ERROR TO TRUE             15740001
157500                    MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO            15750001
157600                              AM-POS-INQ-REMOTE-AUTH-MSG          15760001
157700                    MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER     15770001
157800                    MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE            15780001
157900                        TO  EP000-MD-SYSTEM-LOG-MESSAGE           15790001
158000                                (EP000-MESSAGE-LINE-COUNTER)      15800001
158100                    ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER      15810001
158200                    MOVE 'NO KMC ID IS DETECTED IN THE AUTHORIZATI15820001
158300-                     'ION MESSAGE'                               15830001
158400                          TO  EP000-MD-SYSTEM-LOG-MESSAGE         15840001
158500                                  (EP000-MESSAGE-LINE-COUNTER)    15850001
158600                    PERFORM EP000-1000-POST-MESSAGE               15860001
158700                END-IF                                            15870001
158800         END-EVALUATE                                             15880001
158900     END-IF.                                                      15890001
159000*1200-EXIT.                                                       15900001
159100                                                                  15910001
159200*----------------------------------------------------------------*15920001
159300*                                                                *15930001
159400*----------------------------------------------------------------*15940001
159500 1500-MESSAGE-MONITORING.                                         15950001
159600                                                                  15960001
159700     SET EP000-SL-INFORMATION TO  TRUE.                           15970001
159800     MOVE LM-MESSAGE-NUMBER  TO  EP000-SL-PI-MESSAGE-NUMBER.      15980001
159900     IF ( PV-KMRC-CARD-TENDER-TYPE )                              15990001
160000         SET  LM-DM-KMRC-MSG  TO  TRUE                            16000001
160100     ELSE                                                         16010001
160200         SET  LM-DM-GC-MSG  TO  TRUE                              16020001
160300     END-IF.                                                      16030001
160400     EVALUATE TRUE                                                16040001
160500       WHEN PV-BALANCE-INQUIRY                                    16050001
160600         SET LM-DM-BALINQ             TO TRUE                     16060001
160700       WHEN PV-ISSUANCE-AS-KMRC OR                                16070001
160800            PV-ISSUANCE-AS-GIFT-CARD                              16080001
160900          IF PV-REVERSAL                                          16090001
161000            SET LM-DM-VOID-ISSUE      TO TRUE                     16100001
161100          ELSE                                                    16110001
161200            SET LM-DM-ISSUE           TO TRUE                     16120001
161300          END-IF                                                  16130001
161400       WHEN PV-TENDER                                             16140001
161500         IF PV-REVERSAL                                           16150001
161600           SET LM-DM-VOID-TENDER      TO TRUE                     16160001
161700         ELSE                                                     16170001
161800           IF PV-REAUTH                                           16180001
161900             SET LM-DM-REAUTH         TO TRUE                     16190001
162000           ELSE                                                   16200001
162100             IF PV-REVERSAL-REAUTH                                16210001
162200                SET LM-DM-REVERSAL-REAUTH TO TRUE                 16220001
162201             ELSE                                                 16220101
162202                SET LM-DM-TENDER         TO TRUE                  16220201
162203             END-IF                                               16220301
162204           END-IF                                                 16220401
162205         END-IF                                                   16220501
162206       WHEN OTHER                                                 16220601
162207         SET LM-DM-UNKNOWN            TO TRUE                     16220701
162208     END-EVALUATE.                                                16220801
162209     MOVE UA-STORE-NUMBER-X      TO  LM-DM-STORE-NBR.             16220901
162210     MOVE UA-TERMINAL-NUMBER     TO  LM-DM-TERM-NBR.              16221001
162220     MOVE UA-TRANSACTION-NUMBER  TO  LM-DM-TRAN-NBR.              16222001
162230     MOVE PV-KMC-AMOUNT          TO  LM-DM-TRAN-AMOUNT.           16223001
162240     MOVE PV-KMC-ID              TO  LM-DM-ACCOUNT-NBR.           16224001
162250     MOVE ZERO TO LM-DM-APPROVE-AMOUNT.                           16225001
162260     MOVE ZERO TO LM-DM-BALANCE.                                  16226001
162270     IF LM-DM-RSP                                                 16227001
162280         SET LM-DM-RC-DISPLAY TO TRUE                             16228001
162290         IF PV-EDIT-ERROR                                         16229001
162300             MOVE PV-REFERRAL-CODE-NUMBER TO LM-DM-RESP-CD        16230001
162400         ELSE                                                     16240001
162500             MOVE SV005-RESPONSE-CODE  TO  LM-DM-RESP-CD          16250001
162600             MOVE SV005-APPROVED-TENDER-AMT                       16260001
162700                                       TO LM-DM-APPROVE-AMOUNT    16270001
162800             MOVE SV005-KMC-REMAINING-BALANCE TO LM-DM-BALANCE    16280001
162900         END-IF                                                   16290001
163000         IF SV005-HARD-DECLINE                                    16300001
163100             MOVE ' RSN:'              TO LM-DM-RSN-LIT           16310001
163200             MOVE SV005-DECLINE-REASON TO LM-DM-DECLINE-RSN       16320001
163300         ELSE                                                     16330001
163400             MOVE SPACES               TO LM-DM-DECLINE-MSG       16340001
163500         END-IF                                                   16350001
163600     END-IF.                                                      16360001
163700                                                                  16370001
163800     MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER.                   16380001
163900     MOVE LM-LOG-DISPLAY-MESSAGE                                  16390001
164000             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      16400001
164100                     (EP000-MESSAGE-LINE-COUNTER).                16410001
164200     PERFORM EP000-1000-POST-MESSAGE.                             16420001
164300                                                                  16430001
164400*----------------------------------------------------------------*16440001
164500* MAKE DECISIONS ON AUTHORIZATION.                               *16450001
164600*----------------------------------------------------------------*16460001
164700 2000-AUTHORIZE-KMC.                                              16470001
164800                                                                  16480001
164900        INITIALIZE SV005-KMC-AUTH-PARAMETERS.                     16490001
165000                                                                  16500001
165100        MOVE UA-STORE-NUMBER        TO SV005-STORE-NBR            16510001
165200        MOVE UA-TERMINAL-NUMBER     TO SV005-TERMINAL-NBR         16520001
165300        MOVE UA-TRANSACTION-NUMBER  TO SV005-TRANSACTION-NBR      16530001
165400        MOVE PV-KMC-ID              TO SV005-KMC-ID               16540001
165500        MOVE PV-REQUEST-TYPE        TO SV005-ACTIVITY-TYPE        16550001
165600        MOVE PV-REVERSAL-IND        TO SV005-REVERSAL-CODE        16560001
165700        MOVE CD-DB2-DATE-FORMAT     TO SV005-POS-DATE             16570001
165800        MOVE PV-KMC-AMOUNT          TO SV005-TRANS-AMT            16580001
165900                                                                  16590001
166000       IF SV005-REVERSAL OR SV005-REVERSAL-REAUTH                 16600001
166100           SET SV005-VOID TO TRUE                                 16610001
166200       ELSE                                                       16620001
166300           SET SV005-NOT-VOID TO TRUE                             16630001
166400       END-IF.                                                    16640001
166500                                                                  16650001
166600        IF PV-CRD-TYP-CDE = SV004-GIFT-CRD-TYP                    16660001
166700            SET SV005-GIFT-CRD      TO TRUE                       16670001
166800        ELSE                                                      16680001
166900            SET SV005-KMRC-CRD      TO TRUE                       16690001
167000        END-IF.                                                   16700001
167100                                                                  16710001
167200        MOVE PV-PIN TO SV005-PIN.                                 16720001
167300        MOVE PV-SCAN-SOURCE-CODE TO SV005-SCAN-SOURCE-CODE.       16730001
167400                                                                  16740001
167500        SET SV005-PV-FROM-EPKCS209 TO TRUE.                       16750001
167600                                                                  16760001
167700        IF (PV-TEST-KMRC-ACCOUNTS                                 16770001
167800        OR  PV-TEST-GIFT-CARD-ACCOUNTS                            16780001
167900        OR  PV-TRAINING-KMRC-ACCOUNTS                             16790001
168000        OR  PV-TRAINING-GIFT-CARD-ACCOUNTS)                       16800001
168100        AND NOT EP000-PV-KOHLS-PROD-SYSTEM                        16810001
168200           PERFORM 2100-TEST-ACCOUNTS                             16820001
168300        ELSE                                                      16830001
168400           PERFORM SV005-A100-MAINLINE                            16840001
168500* FOR TESTING PURPOSES FOR REFERRAL                               16850001
168600*                                                                 16860001
168700*          MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                     16870003
168800*                         AM-POS-INQ-REMOTE-AUTH-MSG              16880003
168900*          MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER              16890003
169000*          MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                     16900003
169100*                   TO  EP000-MD-SYSTEM-LOG-MESSAGE               16910003
169200*                           (EP000-MESSAGE-LINE-COUNTER)          16920003
169300*          ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER               16930003
169400*          STRING                                                 16940003
169500*          'AFTER SV005-A100-MAINLINE PARAGRAPH'                  16950003
169600*          'SV005-PS-DECLINE-SW = ' SV005-PS-DECLINE-SW           16960003
169700*                  DELIMITED BY SIZE                              16970003
169710*                  INTO EP000-MD-SYSTEM-LOG-MESSAGE               16971003
169720*                           (EP000-MESSAGE-LINE-COUNTER)          16972003
169730*          END-STRING                                             16973003
169740*          PERFORM EP000-1000-POST-MESSAGE                        16974003
169750                                                                  16975001
169760        END-IF.                                                   16976001
169770                                                                  16977001
169780*2000-EXIT.                                                       16978001
169790                                                                  16979001
169800*----------------------------------------------------------------*16980001
169900*                                                                *16990001
170000*----------------------------------------------------------------*17000001
170100 2100-TEST-ACCOUNTS.                                              17010001
170200                                                                  17020001
170300     EVALUATE TRUE                                                17030001
170400         WHEN  PV-BALANCE-INQUIRY                                 17040001
170500             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000008              17050001
170600                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000073          17060001
170700                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000446          17070001
170800                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000164          17080001
170900                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000248          17090001
171000                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000321          17100001
171100                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000479          17110001
171200*TDH001          OR  PV-KMC-ID = PC-TEST-GIFT-1000000289          17120001
171300                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000006        17130001
171400                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000071        17140001
171500                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000444        17150001
171600                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000162        17160001
171700                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000246        17170001
171800                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000329        17180001
171900                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000477)       17190001
172000*TDH001          OR  PV-KMC-ID = PC-TEST-GIFT-101000000287)       17200001
172100                    MOVE 0      TO SV005-RESPONSE-CODE            17210001
172200                    MOVE 10.00  TO SV005-TRANS-AMT                17220001
172300             END-IF                                               17230001
172400*TDH001 - START                                                   17240001
172500             IF (PV-KMC-ID = PC-TEST-GIFT-1000000289              17250001
172600                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000287        17260001
172700                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000297          17270001
172800                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000295        17280001
172900                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000305          17290001
173000                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000303)       17300001
173100                    MOVE 8      TO SV005-RESPONSE-CODE            17310001
173200                    MOVE 0.00   TO SV005-TRANS-AMT                17320001
173300             END-IF                                               17330001
173400             IF (PV-KMC-ID = PC-TEST-GIFT-1000000313              17340001
173500                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000311)       17350001
173600                    MOVE 0      TO SV005-RESPONSE-CODE            17360001
173700                    MOVE 0.00   TO SV005-TRANS-AMT                17370001
173800             END-IF                                               17380001
173900             IF (PV-KMC-ID = PC-TEST-GIFT-1999123456              17390001
174000                 OR  PV-KMC-ID = PC-TEST-KMRC-1999123456          17400001
174100                 OR  PV-KMC-ID = PC-TEST-GIFT-101999123454        17410001
174200                 OR  PV-KMC-ID = PC-TEST-KMRC-101999123454)       17420001
174300                   MOVE 0             TO SV005-RESPONSE-CODE      17430001
174400                   MOVE 10.00         TO SV005-TRANS-AMT          17440001
174500             END-IF                                               17450001
174600*TDH001 - END                                                     17460001
174700                                                                  17470001
174800             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000016              17480001
174900                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000586          17490001
175000                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000081          17500001
175100                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000014        17510001
175200                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000584        17520001
175300                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000089)       17530001
175400                    MOVE 0      TO SV005-RESPONSE-CODE            17540001
175500                    MOVE 15.00  TO SV005-TRANS-AMT                17550001
175600             END-IF                                               17560001
175700             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000024              17570001
175800                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000453          17580001
175900                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000537          17590001
176000                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000099          17600001
176100                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000022        17610001
176200                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000451        17620001
176300                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000535        17630001
176400                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000097)       17640001
176500                    MOVE 0      TO SV005-RESPONSE-CODE            17650001
176600                    MOVE 20.00  TO SV005-TRANS-AMT                17660001
176700             END-IF                                               17670001
176800             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000149              17680001
176900                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000156          17690001
177000                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000511          17700001
177100                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000172          17710001
177200                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000255          17720001
177300                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000339          17730001
177400                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000461          17740001
177500                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000545          17750001
177600*TDH001          OR  PV-KMC-ID = PC-TEST-GIFT-1000000297          17760001
177700                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000147        17770001
177800                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000154        17780001
177900                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000519        17790001
178000                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000170        17800001
178100                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000253        17810001
178200                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000337        17820001
178300                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000469        17830001
178400                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000543)       17840001
178500*TDH001          OR  PV-KMC-ID = PC-TEST-GIFT-101000000295)       17850001
178600                    MOVE 0      TO SV005-RESPONSE-CODE            17860001
178700                    MOVE 25.00  TO SV005-TRANS-AMT                17870001
178800             END-IF                                               17880001
178900             IF (PV-KMC-ID = PC-TEST-KMRC-1000000578              17890001
179000              OR PV-KMC-ID = PC-TEST-KMRC-101000000576)           17900001
179100                    MOVE 0      TO SV005-RESPONSE-CODE            17910001
179200                    MOVE 30.00  TO SV005-TRANS-AMT                17920001
179300             END-IF                                               17930001
179400             IF (PV-KMC-ID = PC-TRNG-GIFT-1000000180              17940001
179500                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000263          17950001
179600                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000347          17960001
179700                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000487          17970001
179800                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000552          17980001
179900*TDH001          OR  PV-KMC-ID = PC-TEST-GIFT-1000000305          17990001
180000                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000188        18000001
180100                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000261        18010001
180200                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000345        18020001
180300                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000485        18030001
180400                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000550)       18040001
180500*TDH001          OR  PV-KMC-ID = PC-TEST-GIFT-101000000303)       18050001
180600                    MOVE 0      TO SV005-RESPONSE-CODE            18060001
180700                    MOVE 50.00  TO SV005-TRANS-AMT                18070001
180800             END-IF                                               18080001
180900             IF (PV-KMC-ID = PC-TEST-KMRC-1000000495              18090001
181000             OR  PV-KMC-ID = PC-TEST-KMRC-101000000493)           18100001
181100                    MOVE 0      TO SV005-RESPONSE-CODE            18110001
181200                    MOVE 75.00  TO SV005-TRANS-AMT                18120001
181300             END-IF                                               18130001
181400             IF (PV-KMC-ID = PC-TEST-KMRC-1000000560              18140001
181500             OR  PV-KMC-ID = PC-TEST-KMRC-101000000568)           18150001
181600                    MOVE 0      TO SV005-RESPONSE-CODE            18160001
181700                    MOVE 85.00  TO SV005-TRANS-AMT                18170001
181800             END-IF                                               18180001
181900             IF (PV-KMC-ID = PC-TRNG-GIFT-1000000198              18190001
182000                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000271          18200001
182100                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000354          18210001
182200*TDH001          OR  PV-KMC-ID = PC-TEST-GIFT-1000000313          18220001
182300                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000196        18230001
182400                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000279        18240001
182500                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000352)       18250001
182600*TDH001          OR  PV-KMC-ID = PC-TEST-GIFT-101000000311)       18260001
182700                    MOVE 0      TO SV005-RESPONSE-CODE            18270001
182800                    MOVE 100.00  TO SV005-TRANS-AMT               18280001
182900             END-IF                                               18290001
183000             IF (PV-KMC-ID = PC-TEST-KMRC-1000000529              18300001
183100             OR  PV-KMC-ID = PC-TEST-KMRC-101000000527)           18310001
183200                    MOVE 0      TO SV005-RESPONSE-CODE            18320001
183300                    MOVE 117.00 TO SV005-TRANS-AMT                18330001
183400             END-IF                                               18340001
183500             IF (PV-KMC-ID = PC-TEST-KMRC-1000000503              18350001
183600             OR  PV-KMC-ID = PC-TEST-KMRC-101000000501)           18360001
183700                    MOVE 0      TO SV005-RESPONSE-CODE            18370001
183800                    MOVE 187.00 TO SV005-TRANS-AMT                18380001
183900             END-IF                                               18390001
184000         WHEN  PV-ISSUANCE-AS-KMRC                                18400001
184100             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000008              18410001
184200                 OR  PV-KMC-ID = PC-TRNG-KMRC-1000000016          18420001
184300                 OR  PV-KMC-ID = PC-TRNG-KMRC-1000000024          18430001
184400                 OR  PV-KMC-ID = PC-TRNG-KMRC-1000000149          18440001
184500                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000073          18450001
184600                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000081          18460001
184700                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000099          18470001
184800                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000446          18480001
184900                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000453          18490001
185000                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000487          18500001
185100                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000495          18510001
185200                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000503          18520001
185300                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000511          18530001
185400                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000529          18540001
185500                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000537          18550001
185600                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000560          18560001
185700                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000578          18570001
185800                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000156          18580001
185900                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000006        18590001
186000                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000014        18600001
186100                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000022        18610001
186200                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000147        18620001
186300                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000071        18630001
186400                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000089        18640001
186500                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000097        18650001
186600                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000444        18660001
186700                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000451        18670001
186800                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000485        18680001
186900                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000493        18690001
187000                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000501        18700001
187100                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000519        18710001
187200                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000527        18720001
187300                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000535        18730001
187400                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000568        18740001
187500                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000576        18750001
187600                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000154)       18760001
187700                    MOVE 0              TO SV005-RESPONSE-CODE    18770001
187800                    MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT        18780001
187900             END-IF                                               18790001
188000             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000420              18800001
188100                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000404          18810001
188200                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000428        18820001
188300                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000402)       18830001
188400                     MOVE 0             TO SV005-RESPONSE-CODE    18840001
188500                     COMPUTE SV005-TRANS-AMT = PV-KMC-AMOUNT      18850001
188600                                             + 10.00              18860001
188700             END-IF                                               18870001
188800         WHEN  PV-ISSUANCE-AS-GIFT-CARD                           18880001
188900             IF (PV-KMC-ID = PC-TEST-GIFT-1000000321              18890001
189000                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000339          18900001
189100                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000347          18910001
189200                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000354          18920001
189300                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000479          18930001
189400                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000164          18940001
189500                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000172          18950001
189600                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000180          18960001
189700                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000198          18970001
189800                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000329        18980001
189900                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000337        18990001
190000                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000345        19000001
190100                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000352        19010001
190200                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000477        19020001
190300                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000162        19030001
190400                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000170        19040001
190500                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000188        19050001
190600                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000196)       19060001
190700                    MOVE 0              TO SV005-RESPONSE-CODE    19070001
190800                    MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT        19080001
190900             END-IF                                               19090001
191000             IF (PV-KMC-ID = PC-TRNG-GIFT-1000000248              19100001
191100                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000289          19110001
191200                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000246        19120001
191300                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000287)       19130001
191400                    MOVE 0      TO SV005-RESPONSE-CODE            19140001
191500                    MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT        19150001
191600             END-IF                                               19160001
191700             IF (PV-KMC-ID = PC-TEST-GIFT-1000000586              19170001
191800             OR  PV-KMC-ID = PC-TEST-GIFT-101000000584)           19180001
191900                    MOVE 0      TO SV005-RESPONSE-CODE            19190001
192000                    MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT        19200001
192100             END-IF                                               19210001
192200             IF (PV-KMC-ID = PC-TRNG-GIFT-1000000255              19220001
192300                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000297          19230001
192400                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000545          19240001
192500                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000461          19250001
192600                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000253        19260001
192700                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000295        19270001
192800                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000543        19280001
192900                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000469)       19290001
193000                    MOVE 0      TO SV005-RESPONSE-CODE            19300001
193100                    MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT        19310001
193200             END-IF                                               19320001
193300             IF (PV-KMC-ID = PC-TRNG-GIFT-1000000263              19330001
193400                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000552          19340001
193500                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000305          19350001
193600                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000261        19360001
193700                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000550        19370001
193800                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000303)       19380001
193900                    MOVE 0      TO SV005-RESPONSE-CODE            19390001
194000                    MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT        19400001
194100             END-IF                                               19410001
194200             IF (PV-KMC-ID = PC-TRNG-GIFT-1000000271              19420001
194300                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000313          19430001
194400                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000279        19440001
194500                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000311)       19450001
194600                    MOVE 0      TO SV005-RESPONSE-CODE            19460001
194700                    MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT        19470001
194800             END-IF                                               19480001
194900             IF (PV-KMC-ID = PC-TRNG-GIFT-1000000438              19490001
195000                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000412          19500001
195100                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000436        19510001
195200                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000410)       19520001
195300                     MOVE 0             TO SV005-RESPONSE-CODE    19530001
195400                     COMPUTE SV005-TRANS-AMT = PV-KMC-AMOUNT      19540001
195500                                             + 10.00              19550001
195600             END-IF                                               19560001
195700                                                                  19570001
195800             IF PV-KMC-ID = PC-TEST-GIFT-5555555555               19580001
195900             OR PV-KMC-ID = PC-TEST-GIFT-105555555553             19590001
196000                 MOVE 7      TO SV005-RESPONSE-CODE               19600001
196100                 MOVE 0      TO SV005-TRANS-AMT                   19610001
196200                 SET SV005-CARD-ID-INVALID-ISSUE TO TRUE          19620001
196300                 MOVE SV005-DECLINE-REASON TO PV-DECLINE-X        19630001
196400                 COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9  19640001
196500                                                  * 10            19650001
196600                 MOVE PV-DECLINE-REASON-BCD                       19660001
196700                                           TO PV-APPROVAL-NBR     19670001
196800             END-IF                                               19680001
196900                                                                  19690001
197000             IF PV-KMC-ID = PC-TEST-GIFT-6500290298               19700001
197100             OR PV-KMC-ID = PC-TEST-GIFT-106500290296             19710001
197200                 MOVE 7      TO SV005-RESPONSE-CODE               19720001
197300                 MOVE 0      TO SV005-TRANS-AMT                   19730001
197400                 SET SV005-CARD-STAT-INV-ISSUE TO TRUE            19740001
197500                 MOVE SV005-DECLINE-REASON TO PV-DECLINE-X        19750001
197600                 COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9  19760001
197700                                                  * 10            19770001
197800                 MOVE PV-DECLINE-REASON-BCD                       19780001
197900                                           TO PV-APPROVAL-NBR     19790001
198000             END-IF                                               19800001
198100                                                                  19810001
198200             IF PV-KMC-ID = PC-TEST-GIFT-7962525544               19820001
198300             OR PV-KMC-ID = PC-TEST-GIFT-107962525542             19830001
198400                 MOVE 7      TO SV005-RESPONSE-CODE               19840001
198500                 MOVE 0      TO SV005-TRANS-AMT                   19850001
198600                 SET SV005-CARD-STAT-INV-ADD-ON TO TRUE           19860001
198700                 MOVE SV005-DECLINE-REASON TO PV-DECLINE-X        19870001
198800                 COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9  19880001
198900                                                  * 10            19890001
199000                 MOVE PV-DECLINE-REASON-BCD                       19900001
199100                                           TO PV-APPROVAL-NBR     19910001
199200             END-IF                                               19920001
199300                                                                  19930001
199400             IF PV-KMC-ID = PC-TEST-GIFT-5401000400               19940001
199500             OR PV-KMC-ID = PC-TEST-GIFT-105401000408             19950001
199600                 MOVE 7      TO SV005-RESPONSE-CODE               19960001
199700                 MOVE 0      TO SV005-TRANS-AMT                   19970001
199800                 SET SV005-CARD-STOCK-INV-ADD-ON TO TRUE          19980001
199900                 MOVE SV005-DECLINE-REASON TO PV-DECLINE-X        19990001
200000                 COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9  20000001
200100                                                  * 10            20010001
200200                 MOVE PV-DECLINE-REASON-BCD                       20020001
200300                                           TO PV-APPROVAL-NBR     20030001
200400             END-IF                                               20040001
200500                                                                  20050001
200600             IF PV-KMC-ID = PC-TEST-GIFT-6713247606               20060001
200700             OR PV-KMC-ID = PC-TEST-GIFT-106713247604             20070001
200800                 MOVE 7      TO SV005-RESPONSE-CODE               20080001
200900                 MOVE 0      TO SV005-TRANS-AMT                   20090001
201000                 SET SV005-CARD-PRE-DENOM-ADD-ON TO TRUE          20100001
201100                 MOVE SV005-DECLINE-REASON TO PV-DECLINE-X        20110001
201200                 COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9  20120001
201300                                                  * 10            20130001
201400                 MOVE PV-DECLINE-REASON-BCD                       20140001
201500                                           TO PV-APPROVAL-NBR     20150001
201600             END-IF                                               20160001
201700                                                                  20170001
201800             IF PV-KMC-ID = PC-TEST-GIFT-5432100013               20180001
201900             OR PV-KMC-ID = PC-TEST-GIFT-105432100012             20190001
202000                 MOVE 7      TO SV005-RESPONSE-CODE               20200001
202100                 MOVE 0      TO SV005-TRANS-AMT                   20210001
202200                 SET SV005-CARD-NO-PIN-ADD-ON TO TRUE             20220001
202300                 MOVE SV005-DECLINE-REASON TO PV-DECLINE-X        20230001
202400                 COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9  20240001
202500                                                  * 10            20250001
202600                 MOVE PV-DECLINE-REASON-BCD                       20260001
202700                                           TO PV-APPROVAL-NBR     20270001
202800             END-IF                                               20280001
202900                                                                  20290001
203000             IF PV-KMC-ID = PC-TEST-GIFT-6200750757               20300001
203100             OR PV-KMC-ID = PC-TEST-GIFT-106200750755             20310001
203200                 MOVE 7      TO SV005-RESPONSE-CODE               20320001
203300                 MOVE 0      TO SV005-TRANS-AMT                   20330001
203400                 SET SV005-CARD-BAL-OVER-LIM-ADD-ON TO TRUE       20340001
203500                 MOVE SV005-DECLINE-REASON TO PV-DECLINE-X        20350001
203600                 COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9  20360001
203700                                                  * 10            20370001
203800                 MOVE PV-DECLINE-REASON-BCD                       20380001
203900                                           TO PV-APPROVAL-NBR     20390001
204000             END-IF                                               20400001
204100                                                                  20410001
204200             IF PV-KMC-ID = PC-TEST-GIFT-7670782676               20420001
204300             OR PV-KMC-ID = PC-TEST-GIFT-107670782674             20430001
204400                 MOVE 7      TO SV005-RESPONSE-CODE               20440001
204500                 MOVE 0      TO SV005-TRANS-AMT                   20450001
204600                 SET SV005-TRAN-DAY-OVER-LIM-ADD-ON TO TRUE       20460001
204700                 MOVE SV005-DECLINE-REASON TO PV-DECLINE-X        20470001
204800                 COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9  20480001
204900                                                  * 10            20490001
205000                 MOVE PV-DECLINE-REASON-BCD                       20500001
205100                                           TO PV-APPROVAL-NBR     20510001
205200             END-IF                                               20520001
205300                                                                  20530001
205400         WHEN  PV-TENDER                                          20540001
205500             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000008              20550001
205600                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000073          20560001
205700                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000248          20570001
205800                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000164          20580001
205900                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000321          20590001
206000                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000289          20600001
206100                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000006        20610001
206200                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000071        20620001
206300                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000246        20630001
206400                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000162        20640001
206500                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000329        20650001
206600                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000287)       20660001
206700*  BALANCE = TRANSACTION AMOUNT - always $2                       20670001
206800                 IF PV-KMC-AMOUNT <= PC-TWO-DOLLARS               20680001
206900                        MOVE 1  TO SV005-RESPONSE-CODE            20690001
207000                        MOVE 0  TO SV005-TRANS-AMT                20700001
207100                 ELSE                                             20710001
207200                        MOVE 0  TO SV005-RESPONSE-CODE            20720001
207300                        SUBTRACT PC-TWO-DOLLARS                   20730001
207400                           FROM PV-KMC-AMOUNT                     20740001
207500                           GIVING SV005-TRANS-AMT                 20750001
207600                 END-IF                                           20760001
207700             END-IF                                               20770001
207800             IF (PV-KMC-ID = PC-TEST-KMRC-1000000446              20780001
207900                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000479          20790001
208000                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000444        20800001
208100                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000477)       20810001
208200*  BALANCE = TRANSACTION AMOUNT - always $10                      20820001
208300                 IF PV-KMC-AMOUNT <= 10                           20830001
208400                     MOVE 1  TO SV005-RESPONSE-CODE               20840001
208500                     MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT       20850001
208600                 ELSE                                             20860001
208700*  NO REMAINING BALANCE                                           20870001
208800                     MOVE 0  TO SV005-RESPONSE-CODE               20880001
208900                     MOVE 10 TO SV005-TRANS-AMT                   20890001
209000                 END-IF                                           20900001
209100             END-IF                                               20910001
209200             IF (PV-KMC-ID = PC-TEST-GIFT-1000000586              20920001
209300             OR  PV-KMC-ID = PC-TEST-GIFT-101000000584)           20930001
209400*  BALANCE = TRANSACTION AMOUNT - ALWAYS $15                      20940001
209500                 IF PV-KMC-AMOUNT <= 15                           20950001
209600                     MOVE 1  TO SV005-RESPONSE-CODE               20960001
209700                     MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT       20970001
209800                 ELSE                                             20980001
209900*  NO REMAINING BALANCE                                           20990001
210000                     MOVE 0  TO SV005-RESPONSE-CODE               21000001
210100                     MOVE 15 TO SV005-TRANS-AMT                   21010001
210200                 END-IF                                           21020001
210300             END-IF                                               21030001
210400             IF (PV-KMC-ID = PC-TEST-KMRC-1000000453              21040001
210500              OR PV-KMC-ID = PC-TEST-KMRC-1000000537              21050001
210600              OR PV-KMC-ID = PC-TEST-KMRC-101000000451            21060001
210700              OR PV-KMC-ID = PC-TEST-KMRC-101000000535)           21070001
210800*  BALANCE = TRANSACTION AMOUNT - always $20                      21080001
210900                 IF PV-KMC-AMOUNT <= 20                           21090001
211000                     MOVE 1  TO SV005-RESPONSE-CODE               21100001
211100                     MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT       21110001
211200                 ELSE                                             21120001
211300*  NO REMAINING BALANCE                                           21130001
211400                     MOVE 0  TO SV005-RESPONSE-CODE               21140001
211500                     MOVE 20 TO SV005-TRANS-AMT                   21150001
211600                 END-IF                                           21160001
211700             END-IF                                               21170001
211800             IF (PV-KMC-ID = PC-TEST-GIFT-1000000461              21180001
211900              OR PV-KMC-ID = PC-TEST-KMRC-1000000511              21190001
212000              OR PV-KMC-ID = PC-TEST-GIFT-1000000545              21200001
212100              OR PV-KMC-ID = PC-TEST-GIFT-101000000469            21210001
212200              OR PV-KMC-ID = PC-TEST-KMRC-101000000519            21220001
212300              OR PV-KMC-ID = PC-TEST-GIFT-101000000543)           21230001
212400*  BALANCE = TRANSACTION AMOUNT - always $25                      21240001
212500                 IF PV-KMC-AMOUNT <= 25                           21250001
212600                        MOVE 1  TO SV005-RESPONSE-CODE            21260001
212700                        MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT    21270001
212800                 ELSE                                             21280001
212900*  NO REMAINING BALANCE                                           21290001
213000                        MOVE 0  TO SV005-RESPONSE-CODE            21300001
213100                        MOVE 25 TO SV005-TRANS-AMT                21310001
213200                 END-IF                                           21320001
213300             END-IF                                               21330001
213400             IF (PV-KMC-ID = PC-TEST-KMRC-1000000578              21340001
213500             OR  PV-KMC-ID = PC-TEST-KMRC-101000000576)           21350001
213600*  BALANCE = TRANSACTION AMOUNT - ALWAYS $30                      21360001
213700                 IF PV-KMC-AMOUNT <= 30                           21370001
213800                        MOVE 1  TO SV005-RESPONSE-CODE            21380001
213900                        MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT    21390001
214000                 ELSE                                             21400001
214100*  NO REMAINING BALANCE                                           21410001
214200                        MOVE 0  TO SV005-RESPONSE-CODE            21420001
214300                        MOVE 30 TO SV005-TRANS-AMT                21430001
214400                 END-IF                                           21440001
214500             END-IF                                               21450001
214600             IF (PV-KMC-ID = PC-TEST-GIFT-1000000552              21460001
214700              OR PV-KMC-ID = PC-TEST-KMRC-1000000487              21470001
214800              OR PV-KMC-ID = PC-TEST-GIFT-101000000550            21480001
214900              OR PV-KMC-ID = PC-TEST-KMRC-101000000485)           21490001
215000*  BALANCE = TRANSACTION AMOUNT - ALWAYS $50                      21500001
215100                 IF PV-KMC-AMOUNT <= 50                           21510001
215200                        MOVE 1  TO SV005-RESPONSE-CODE            21520001
215300                        MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT    21530001
215400                 ELSE                                             21540001
215500*  NO REMAINING BALANCE                                           21550001
215600                        MOVE 0  TO SV005-RESPONSE-CODE            21560001
215700                        MOVE 50 TO SV005-TRANS-AMT                21570001
215800                 END-IF                                           21580001
215900             END-IF                                               21590001
216000             IF (PV-KMC-ID = PC-TEST-KMRC-1000000495              21600001
216100             OR  PV-KMC-ID = PC-TEST-KMRC-101000000493)           21610001
216200*  BALANCE = TRANSACTION AMOUNT - ALWAYS $75                      21620001
216300                 IF PV-KMC-AMOUNT <= 75                           21630001
216400                        MOVE 1  TO SV005-RESPONSE-CODE            21640001
216500                        MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT    21650001
216600                 ELSE                                             21660001
216700*  NO REMAINING BALANCE                                           21670001
216800                        MOVE 0  TO SV005-RESPONSE-CODE            21680001
216900                        MOVE 75 TO SV005-TRANS-AMT                21690001
217000                 END-IF                                           21700001
217100             END-IF                                               21710001
217200             IF (PV-KMC-ID = PC-TEST-KMRC-1000000560              21720001
217300             OR  PV-KMC-ID = PC-TEST-KMRC-101000000568)           21730001
217400*  BALANCE = TRANSACTION AMOUNT - ALWAYS $85                      21740001
217500                 IF PV-KMC-AMOUNT <= 85                           21750001
217600                        MOVE 1  TO SV005-RESPONSE-CODE            21760001
217700                        MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT    21770001
217800                 ELSE                                             21780001
217900*  NO REMAINING BALANCE                                           21790001
218000                        MOVE 0  TO SV005-RESPONSE-CODE            21800001
218100                        MOVE 85 TO SV005-TRANS-AMT                21810001
218200                 END-IF                                           21820001
218300             END-IF                                               21830001
218400             IF (PV-KMC-ID = PC-TEST-KMRC-1000000529              21840001
218500             OR  PV-KMC-ID = PC-TEST-KMRC-101000000527)           21850001
218600*  BALANCE = TRANSACTION AMOUNT - ALWAYS $117                     21860001
218700                 IF PV-KMC-AMOUNT <= 117                          21870001
218800                        MOVE 1  TO SV005-RESPONSE-CODE            21880001
218900                        MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT    21890001
219000                 ELSE                                             21900001
219100*  NO REMAINING BALANCE                                           21910001
219200                        MOVE 0   TO SV005-RESPONSE-CODE           21920001
219300                        MOVE 117 TO SV005-TRANS-AMT               21930001
219400                 END-IF                                           21940001
219500             END-IF                                               21950001
219600             IF (PV-KMC-ID = PC-TEST-KMRC-1000000503              21960001
219700             OR  PV-KMC-ID = PC-TEST-KMRC-101000000501)           21970001
219800*  BALANCE = TRANSACTION AMOUNT - ALWAYS $187                     21980001
219900                 IF PV-KMC-AMOUNT <= 187                          21990001
220000                        MOVE 1  TO SV005-RESPONSE-CODE            22000001
220100                        MOVE PV-KMC-AMOUNT  TO SV005-TRANS-AMT    22010001
220200                 ELSE                                             22020001
220300*  NO REMAINING BALANCE                                           22030001
220400                        MOVE 0   TO SV005-RESPONSE-CODE           22040001
220500                        MOVE 187 TO SV005-TRANS-AMT               22050001
220600                 END-IF                                           22060001
220700             END-IF                                               22070001
220800             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000149              22080001
220900                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000156          22090001
221000                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000271          22100001
221100                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000198          22110001
221200                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000354          22120001
221300                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000313          22130001
221400                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000147        22140001
221500                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000154        22150001
221600                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000279        22160001
221700                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000196        22170001
221800                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000352        22180001
221900                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000311)       22190001
222000*  BALANCE WITHIN $3 OF TRANSACTION AMOUNT                        22200001
222100                    MOVE 0      TO SV005-RESPONSE-CODE            22210001
222200                    COMPUTE SV005-TRANS-AMT =                     22220001
222300                        PC-TWO-DOLLARS + PV-KMC-AMOUNT            22230001
222400             END-IF                                               22240001
222500             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000016              22250001
222600                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000081          22260001
222700                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000255          22270001
222800                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000172          22280001
222900                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000339          22290001
223000                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000297          22300001
223100                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000014        22310001
223200                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000089        22320001
223300                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000253        22330001
223400                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000170        22340001
223500                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000337        22350001
223600                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000295)       22360001
223700*  BALANCE = TRANSACTION AMOUNT                                   22370001
223800                    MOVE 1      TO SV005-RESPONSE-CODE            22380001
223900                    MOVE 0      TO SV005-TRANS-AMT                22390001
224000             END-IF                                               22400001
224100             IF (PV-KMC-ID = PC-TRNG-KMRC-1000000024              22410001
224200                 OR  PV-KMC-ID = PC-TEST-KMRC-1000000099          22420001
224300                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000263          22430001
224400                 OR  PV-KMC-ID = PC-TRNG-GIFT-1000000180          22440001
224500                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000347          22450001
224600                 OR  PV-KMC-ID = PC-TEST-GIFT-1000000305          22460001
224700                 OR  PV-KMC-ID = PC-TRNG-KMRC-101000000022        22470001
224800                 OR  PV-KMC-ID = PC-TEST-KMRC-101000000097        22480001
224900                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000261        22490001
225000                 OR  PV-KMC-ID = PC-TRNG-GIFT-101000000188        22500001
225100                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000345        22510001
225200                 OR  PV-KMC-ID = PC-TEST-GIFT-101000000303)       22520001
225300*  REMAINING BALANCE IS $5                                        22530001
225400                    MOVE 1      TO SV005-RESPONSE-CODE            22540001
225500                    MOVE 5.00   TO SV005-TRANS-AMT                22550001
225600             END-IF                                               22560001
225700     END-EVALUATE.                                                22570001
225800                                                                  22580001
225900*TDH001                                                           22590001
226000*    IF PV-KMC-ID = PC-TEST-GIFT-1999123456                       22600001
226100*      OR PV-KMC-ID = PC-TEST-KMRC-1999123456                     22610001
226200     IF (PV-KMC-ID = PC-TEST-GIFT-1999123456                      22620001
226300       OR PV-KMC-ID = PC-TEST-KMRC-1999123456)                    22630001
226400          AND NOT PV-BALANCE-INQUIRY                              22640001
226500         IF PV-PIN = 5234                                         22650001
226600             MOVE 0             TO SV005-RESPONSE-CODE            22660001
226700             MOVE PV-KMC-AMOUNT TO SV005-TRANS-AMT                22670001
226800         ELSE                                                     22680001
226900             MOVE 6             TO SV005-RESPONSE-CODE            22690001
227000             MOVE 0             TO SV005-TRANS-AMT                22700001
227100         END-IF                                                   22710001
227200     END-IF.                                                      22720001
227300                                                                  22730001
227400*TDH001                                                           22740001
227500*    IF PV-KMC-ID = PC-TEST-GIFT-101999123454                     22750001
227600*      OR PV-KMC-ID = PC-TEST-KMRC-101999123454                   22760001
227700     IF (PV-KMC-ID = PC-TEST-GIFT-101999123454                    22770001
227800       OR PV-KMC-ID = PC-TEST-KMRC-101999123454)                  22780001
227900          AND NOT PV-BALANCE-INQUIRY                              22790001
228000         IF PV-PIN = 5234                                         22800001
228100             MOVE 0             TO SV005-RESPONSE-CODE            22810001
228200             MOVE PV-KMC-AMOUNT TO SV005-TRANS-AMT                22820001
228300         ELSE                                                     22830001
228400             MOVE 6             TO SV005-RESPONSE-CODE            22840001
228500             MOVE 0             TO SV005-TRANS-AMT                22850001
228600         END-IF                                                   22860001
228700     END-IF.                                                      22870001
228800                                                                  22880001
228900     IF PV-KMC-ID = PC-TEST-GIFT-2008123453                       22890001
229000       OR PV-KMC-ID = PC-TEST-KMRC-2008123453                     22900001
229100*        IF PV-PIN = 1234                                         22910001
229200         IF PV-PIN = 6334                                         22920001
229300             MOVE 1             TO SV005-RESPONSE-CODE            22930001
229400             MOVE 15.00         TO SV005-TRANS-AMT                22940001
229500         ELSE                                                     22950001
229600             MOVE 6             TO SV005-RESPONSE-CODE            22960001
229700             MOVE 0             TO SV005-TRANS-AMT                22970001
229800         END-IF                                                   22980001
229900     END-IF.                                                      22990001
230000     IF PV-KMC-ID = PC-TEST-GIFT-102008123451                     23000001
230100       OR PV-KMC-ID = PC-TEST-KMRC-102008123451                   23010001
230200         IF PV-PIN = 6334                                         23020001
230300             MOVE 1             TO SV005-RESPONSE-CODE            23030001
230400             MOVE 15.00         TO SV005-TRANS-AMT                23040001
230500         ELSE                                                     23050001
230600             MOVE 6             TO SV005-RESPONSE-CODE            23060001
230700             MOVE 0             TO SV005-TRANS-AMT                23070001
230800         END-IF                                                   23080001
230900     END-IF.                                                      23090001
231000                                                                  23100001
231100     IF (PV-KMC-ID = PC-TRNG-KMRC-1000000032                      23110001
231200            OR  PV-KMC-ID = PC-TEST-KMRC-1000000107               23120001
231300            OR  PV-KMC-ID = PC-TRNG-GIFT-1000000206               23130001
231400            OR  PV-KMC-ID = PC-TEST-GIFT-1000000362               23140001
231500            OR  PV-KMC-ID = PC-TRNG-KMRC-101000000030             23150001
231600            OR  PV-KMC-ID = PC-TEST-KMRC-101000000105             23160001
231700            OR  PV-KMC-ID = PC-TRNG-GIFT-101000000204             23170001
231800            OR  PV-KMC-ID = PC-TEST-GIFT-101000000360)            23180001
231900               MOVE 7      TO SV005-RESPONSE-CODE                 23190001
232000               MOVE 0      TO SV005-TRANS-AMT                     23200001
232100     END-IF.                                                      23210001
232200                                                                  23220001
232300     IF (PV-KMC-ID = PC-TRNG-KMRC-1000000040                      23230001
232400            OR  PV-KMC-ID = PC-TEST-KMRC-1000000115               23240001
232500            OR  PV-KMC-ID = PC-TRNG-GIFT-1000000214               23250001
232600            OR  PV-KMC-ID = PC-TEST-GIFT-1000000370               23260001
232700            OR  PV-KMC-ID = PC-TRNG-KMRC-101000000048             23270001
232800            OR  PV-KMC-ID = PC-TEST-KMRC-101000000113             23280001
232900            OR  PV-KMC-ID = PC-TRNG-GIFT-101000000212             23290001
233000            OR  PV-KMC-ID = PC-TEST-GIFT-101000000378)            23300001
233100               MOVE 8      TO SV005-RESPONSE-CODE                 23310001
233200               MOVE 0      TO SV005-TRANS-AMT                     23320001
233300     END-IF.                                                      23330001
233400                                                                  23340001
233500     IF (PV-KMC-ID = PC-TRNG-KMRC-1000000057                      23350001
233600            OR  PV-KMC-ID = PC-TEST-KMRC-1000000123               23360001
233700            OR  PV-KMC-ID = PC-TRNG-GIFT-1000000222               23370001
233800            OR  PV-KMC-ID = PC-TEST-GIFT-1000000388               23380001
233900            OR  PV-KMC-ID = PC-TRNG-KMRC-101000000055             23390001
234000            OR  PV-KMC-ID = PC-TEST-KMRC-101000000121             23400001
234100            OR  PV-KMC-ID = PC-TRNG-GIFT-101000000220             23410001
234200            OR  PV-KMC-ID = PC-TEST-GIFT-101000000386)            23420001
234300               MOVE 9      TO SV005-RESPONSE-CODE                 23430001
234400               MOVE 0      TO SV005-TRANS-AMT                     23440001
234500     END-IF.                                                      23450001
234600                                                                  23460001
234700     IF (PV-KMC-ID = PC-TRNG-KMRC-1000000065                      23470001
234800            OR  PV-KMC-ID = PC-TEST-KMRC-1000000131               23480001
234900            OR  PV-KMC-ID = PC-TRNG-GIFT-1000000230               23490001
235000            OR  PV-KMC-ID = PC-TEST-GIFT-1000000396               23500001
235100            OR  PV-KMC-ID = PC-TRNG-KMRC-101000000063             23510001
235200            OR  PV-KMC-ID = PC-TEST-KMRC-101000000139             23520001
235300            OR  PV-KMC-ID = PC-TRNG-GIFT-101000000238             23530001
235400            OR  PV-KMC-ID = PC-TEST-GIFT-101000000394)            23540001
235500               MOVE 2      TO SV005-RESPONSE-CODE                 23550001
235600               MOVE 0      TO SV005-TRANS-AMT                     23560001
235700     END-IF.                                                      23570001
235800                                                                  23580001
235900*2100-EXIT.                                                       23590001
236000                                                                  23600001
236100*----------------------------------------------------------------*23610001
236200*  POPULATE FIELDS TO BE INSERTED TO TRANSACTION TABLE           *23620001
236300*----------------------------------------------------------------*23630001
236400 3000-SET-COLUMNS.                                                23640001
236500         MOVE SV005-KMC-ID            TO SVT00002-CRD-NBR.        23650001
236600         MOVE PV-DRIVERS-LICENSE-NBR  TO SVT00002-DRV-LIC-NBR.    23660001
236700         IF SV005-REAUTH OR SV005-NORMAL                          23670001
236800           MOVE '0' TO SVT00002-TRN-RVRSL-CDE                     23680001
236900         ELSE                                                     23690001
237000           IF SV005-REVERSAL-REAUTH OR                            23700001
237100              SV005-REVERSAL                                      23710001
237110              MOVE '1' TO SVT00002-TRN-RVRSL-CDE                  23711001
237120           END-IF                                                 23712001
237130         END-IF                                                   23713001
237150         MOVE 'N'                     TO SVT00002-TRN-VOID-IND.   23715001
237160         MOVE SV005-ACTIVITY-TYPE     TO SVT00002-ACTVY-TYP-CDE.  23716001
237170         MOVE SV005-POS-DATE          TO SVT00002-POS-DTE.        23717001
237180         MOVE SV005-STORE-NBR         TO SVT00002-STR-NBR.        23718001
237190         MOVE SV005-TERMINAL-NBR      TO SVT00002-POS-TRMNL-NBR.  23719001
237200         MOVE SV005-TRANSACTION-NBR   TO SVT00002-POS-TRN-NBR.    23720001
237300         MOVE SV004-DEFAULT-TIMESTAMP TO SVT00002-TRN-PSTD-TMST.  23730001
237400         EVALUATE TRUE                                            23740001
237500             WHEN SV005-NORMAL                                    23750001
237600             WHEN SV005-REAUTH                                    23760001
237700               IF PV-TENDER                                       23770001
237800                  MULTIPLY PC-MINUS-ONE BY                        23780001
237900                           SV005-APPROVED-TENDER-AMT              23790001
238000               END-IF                                             23800001
238100             WHEN PV-REVERSAL                                     23810001
238200               IF PV-ISSUANCE-AS-KMRC                             23820001
238300               OR PV-ISSUANCE-AS-GIFT-CARD                        23830001
238400                  MULTIPLY PC-MINUS-ONE BY                        23840001
238500                           SV005-APPROVED-TENDER-AMT              23850001
238600               END-IF                                             23860001
238700         END-EVALUATE                                             23870001
238800         MOVE SV005-APPROVED-TENDER-AMT TO SVT00002-APP-AUTH-AMT  23880001
238900                                           SVT00002-ORIG-AUTH-AMT.23890001
239019         IF PV-OPRT-ID-LEN > PV-7-N                               23901925
239029           ADD +1 TO PV-ZERO-COUNT                                23902922
239030           MOVE PV-OPRT-ID-LEN TO SVT00002-ORD-NBR-LEN            23903025
239031           MOVE PV-OPERATOR-ID(PV-ZERO-COUNT:SVT00002-ORD-NBR-LEN)23903122
239032                                        TO SVT00002-ORD-NBR-TEXT  23903222
239035           MOVE ZERO                    TO SVT00002-POS-OPRT-ID   23903522
239036           MOVE ZERO                    TO PV-ORD-NBR-NULL-IND    23903622
239040         ELSE                                                     23904012
239050           UNSTRING PV-OPERATOR-ID                                23905013
239051             DELIMITED BY ' '                                     23905113
239052             INTO PV-POS-OPRT-ID-11-N                             23905214
239054           END-UNSTRING                                           23905414
239070           MOVE PV-POS-OPRT-ID-11-N     TO SVT00002-POS-OPRT-ID   23907014
239071           MOVE -1                      TO PV-ORD-NBR-NULL-IND    23907114
239080         END-IF.                                                  23908012
239100         MOVE SPACE                     TO SVT00002-APVL-USR-ID.  23910001
239200         MOVE SV004-STAT-AUTH-RECEIVED-CD                         23920001
239300                                      TO SVT00002-ACTVY-STAT-CDE. 23930001
239400         IF SV005-APPROVED-TENDER-AMT < ZERO                      23940001
239500             MULTIPLY PC-MINUS-ONE BY                             23950001
239600                 SV005-APPROVED-TENDER-AMT                        23960001
239700         END-IF.                                                  23970001
239800                                                                  23980001
239900*3000-EXIT.                                                       23990001
240000                                                                  24000001
240100*----------------------------------------------------------------*24010001
240200*  INSERT INPUT TRANSACTION TO TABLE                             *24020001
240300*----------------------------------------------------------------*24030001
240400 4000-INSERT-KMC-ACTIVITY-TABLE.                                  24040001
240500                                                                  24050001
240600     IF SVT00002-ACTVY-TYP-CDE = SV004-ISSUE-KMRC-ACT-TYP         24060001
240700         CONTINUE                                                 24070001
240800     ELSE                                                         24080001
240900         MOVE SPACES               TO SVT00002-DRV-LIC-NBR        24090001
241000     END-IF.                                                      24100001
241100     MOVE SVT00002-APP-AUTH-AMT    TO SVT00002-ORIG-AUTH-AMT.     24110001
241200                                                                  24120001
241300     EXEC SQL INSERT                                              24130001
241400              INTO SVT_KOHLS_CRD_TXN                              24140001
241500                  (CRD_NBR                                        24150001
241600                  ,DRV_LIC_NBR                                    24160001
241700                  ,TRN_RVRSL_CDE                                  24170001
241800                  ,TRN_VOID_IND                                   24180001
241900                  ,ACTVY_TYP_CDE                                  24190001
242000                  ,POS_DTE                                        24200001
242100                  ,STR_NBR                                        24210001
242200                  ,POS_TRMNL_NBR                                  24220001
242300                  ,POS_TRN_NBR                                    24230001
242400                  ,TRN_PSTD_TMST                                  24240001
242500                  ,APP_AUTH_AMT                                   24250001
242600                  ,POS_OPRT_ID                                    24260001
242700                  ,APVL_USR_ID                                    24270001
242800                  ,ACTVY_STAT_CDE                                 24280001
242900                  ,ORIG_AUTH_AMT                                  24290001
243000                  ,ST_CDE                                         24300007
243010                  ,ORD_NBR)                                       24301007
243100           VALUES                                                 24310001
243200              (:SVT00002-CRD-NBR                                  24320001
243300              ,:SVT00002-DRV-LIC-NBR                              24330001
243400              ,:SVT00002-TRN-RVRSL-CDE                            24340001
243500              ,:SVT00002-TRN-VOID-IND                             24350001
243600              ,:SVT00002-ACTVY-TYP-CDE                            24360001
243700              ,:SVT00002-POS-DTE                                  24370001
243800              ,:SVT00002-STR-NBR                                  24380001
243900              ,:SVT00002-POS-TRMNL-NBR                            24390001
244000              ,:SVT00002-POS-TRN-NBR                              24400001
244100              ,:SVT00002-TRN-PSTD-TMST                            24410001
244200              ,:SVT00002-APP-AUTH-AMT                             24420001
244300              ,:SVT00002-POS-OPRT-ID                              24430001
244400              ,:SVT00002-APVL-USR-ID                              24440001
244500              ,:SVT00002-ACTVY-STAT-CDE                           24450001
244600              ,:SVT00002-ORIG-AUTH-AMT                            24460001
244700              ,:SVT00002-ST-CDE                                   24470007
244710              ,:SVT00002-ORD-NBR :PV-ORD-NBR-NULL-IND)            24471007
244800      END-EXEC.                                                   24480001
244900                                                                  24490001
245000      EVALUATE TRUE                                               24500001
245100               WHEN SQLCODE = -904                                24510001
245200               WHEN SQLCODE = -913                                24520001
245300                    ADD 1 TO PV-RETRY-COUNT                       24530001
245400               WHEN SQLCODE < 0                                   24540001
245500                    MOVE 'INSERT KMC ACTIVITY ROW (SVT00002)'     24550001
245600                                 TO AA-ATTEMPTED-ACTION           24560001
245700                    PERFORM 9100-DB2-ERROR                        24570001
245800                    PERFORM 9999-RETURN-TO-NATIVE-CICS            24580001
245900               WHEN SQLCODE > 0                                   24590001
246000               WHEN SQLWARN0 NOT = SPACES                         24600001
246100                    MOVE 'INSERT KMC ACTIVITY ROW (SVT00002)'     24610001
246200                                 TO AA-ATTEMPTED-ACTION           24620001
246300                    PERFORM 9200-DB2-WARNING                      24630001
246400                    PERFORM 9999-RETURN-TO-NATIVE-CICS            24640001
246500               WHEN OTHER                                         24650001
246600                    CONTINUE                                      24660001
246700      END-EVALUATE.                                               24670001
246800*4000-EXIT.                                                       24680001
246900                                                                  24690001
247000*----------------------------------------------------------------*24700001
247100* UPDATE TRANSACTION IN TABLE FOR VOID                           *24710001
247200*----------------------------------------------------------------*24720001
247300 4005-UPDATE-KMC-ACTIVITY-TABLE.                                  24730001
247400                                                                  24740001
247500         SET SV005-NORMAL TO TRUE                                 24750001
247700         IF SV005-REAUTH OR SV005-NORMAL                          24770001
247800           MOVE '0' TO SVT00002-TRN-RVRSL-CDE                     24780001
247900         ELSE                                                     24790001
247910           IF SV005-REVERSAL-REAUTH OR                            24791001
247920              SV005-REVERSAL                                      24792001
247930              MOVE '1' TO SVT00002-TRN-RVRSL-CDE                  24793001
247940           END-IF                                                 24794001
247950         END-IF.                                                  24795001
247960         COMPUTE SVT00002-APP-AUTH-AMT = SVT00002-APP-AUTH-AMT    24796001
247970                                       * -1.                      24797001
247980                                                                  24798001
247990     EXEC SQL                                                     24799001
248000         UPDATE SVT_KOHLS_CRD_TXN                                 24800001
248100           SET TRN_VOID_IND  = :SV004-VOID-TRANS                  24810001
248200         WHERE CRD_NBR       = :SVT00002-CRD-NBR                  24820001
248300           AND TRN_RVRSL_CDE = :SVT00002-TRN-RVRSL-CDE            24830001
248400           AND TRN_VOID_IND  = :SV004-NOT-VOID-TRANS              24840001
248500           AND ACTVY_TYP_CDE = :SVT00002-ACTVY-TYP-CDE            24850001
248600           AND POS_DTE       = :SVT00002-POS-DTE                  24860001
248700           AND STR_NBR       = :SVT00002-STR-NBR                  24870001
248800           AND POS_TRMNL_NBR = :SVT00002-POS-TRMNL-NBR            24880001
248900           AND POS_TRN_NBR   = :SVT00002-POS-TRN-NBR              24890001
249000           AND APP_AUTH_AMT  = :SVT00002-APP-AUTH-AMT             24900001
249100      END-EXEC.                                                   24910001
249200                                                                  24920001
249300     EVALUATE TRUE                                                24930001
249400              WHEN SQLCODE = -904                                 24940001
249500              WHEN SQLCODE = -913                                 24950001
249600                   ADD 1 TO PV-RETRY-COUNT                        24960001
250099              WHEN SQLCODE < 0                                    25009901
250100                    MOVE 'UPDATE KMC ACTIVITY ROW (SVT00002)'     25010001
250200                                 TO AA-ATTEMPTED-ACTION           25020001
250300                    PERFORM 9100-DB2-ERROR                        25030001
250400                    PERFORM 9999-RETURN-TO-NATIVE-CICS            25040001
250500               WHEN SQLCODE > 0                                   25050001
250600               WHEN SQLWARN0 NOT = SPACES                         25060001
250700                    MOVE 'UPDATE KMC ACTIVITY ROW (SVT00002)'     25070001
250800                                 TO AA-ATTEMPTED-ACTION           25080001
250900                    PERFORM 9200-DB2-WARNING                      25090001
251000                    PERFORM 9999-RETURN-TO-NATIVE-CICS            25100001
251100               WHEN OTHER                                         25110001
251200                    CONTINUE                                      25120001
251300      END-EVALUATE.                                               25130001
251400*4005-EXIT.                                                       25140001
251500                                                                  25150001
251600*----------------------------------------------------------------*25160001
251700*  DELETE ROW FROM LOCK TABLE AT END OF TRANSACTION              *25170001
251800*----------------------------------------------------------------*25180001
251900 4050-DELETE-KMC-LOCK-TABLE.                                      25190001
252000                                                                  25200001
252100     EXEC SQL DELETE                                              25210001
252200              FROM SVT_CRD_ACCT_LCK                               25220001
252300         WHERE CRD_NBR       = :SV005-KMC-ID                      25230001
252400     END-EXEC.                                                    25240001
252500                                                                  25250001
252600     EVALUATE TRUE                                                25260001
252700              WHEN SQLCODE = 0                                    25270001
252800              WHEN SQLCODE = +100                                 25280001
252900              WHEN SQLCODE = -310                                 25290001
253000              WHEN SQLCODE = -904                                 25300001
253100              WHEN SQLCODE = -913                                 25310001
253200                  CONTINUE                                        25320001
253300              WHEN SQLCODE < 0                                    25330001
253400                   MOVE 'DELETE KMC LOCK ROW (SVT00004)'          25340001
253500                                TO AA-ATTEMPTED-ACTION            25350001
253600                   PERFORM 9100-DB2-ERROR                         25360001
253700                   PERFORM 9999-RETURN-TO-NATIVE-CICS             25370001
253800              WHEN SQLCODE > 0                                    25380001
253900              WHEN SQLWARN0 NOT = SPACES                          25390001
254000                   MOVE 'DELETE KMC LOCK ROW (SVT00004)'          25400001
254100                                TO AA-ATTEMPTED-ACTION            25410001
254200                   PERFORM 9200-DB2-WARNING                       25420001
254300                   PERFORM 9999-RETURN-TO-NATIVE-CICS             25430001
254400              WHEN OTHER                                          25440001
254500                   CONTINUE                                       25450001
254600     END-EVALUATE.                                                25460001
254700*4050-EXIT.                                                       25470001
254800                                                                  25480001
254900*----------------------------------------------------------------*25490001
255000*  CHECK IF VALID STORE IN TRANSACTION                           *25500001
255100*----------------------------------------------------------------*25510001
255200 4100-DETERMINE-IF-VALID-STR.                                     25520001
255300     EXEC SQL                                                     25530001
255400         SELECT   POS_CAP_LVL_ID                                  25540001
255500                , ST_CDE                                          25550001
255600           INTO  :XST00025-POS-CAP-LVL-ID                         25560001
255700               , :SVT00002-ST-CDE                                 25570001
255800           FROM  XST_LOC A                                        25580001
255900                ,XST_LOC_ATTR B                                   25590001
256000          WHERE A.LOC_NBR = B.LOC_NBR                             25600001
256100            AND A.LOC_NBR = :XST00001-LOC-NBR                     25610001
256200     END-EXEC.                                                    25620001
256300     EVALUATE TRUE                                                25630001
256400         WHEN SQLCODE = ZERO                                      25640001
256500             CONTINUE                                             25650001
256600         WHEN SQLCODE = +100                                      25660001
256700             SET PS-AUTH-MESSAGE-ERROR                            25670001
256800                 PV-EDIT-ERROR                                    25680001
256900                 EP000-SL-ERROR                                   25690001
257000                 PV-AUTH-RESP-SRC-NOT-INTENDED TO TRUE            25700001
257100             MOVE PI-POS-INQ-REMOTE-AUTH-MSG                      25710001
257200                                   TO AM-POS-INQ-REMOTE-AUTH-MSG  25720001
257300             MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER            25730001
257400             MOVE AM-AUTH-MESSAGE-ERROR-MESSAGE                   25740001
257500                 TO  EP000-MD-SYSTEM-LOG-MESSAGE                  25750001
257600                         (EP000-MESSAGE-LINE-COUNTER)             25760001
257700             ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER             25770001
257800             MOVE XST00001-LOC-NBR TO PV-STORE-NBR                25780001
257900             MOVE PV-STORE-NBR TO PV-STORE-NBR-X                  25790001
258000             STRING 'A REGISTER HAS AN INCORRECT STORE NUMBER'    25800001
258100                       ' PROGRAMMED '                             25810001
258200                     UA-STORE-NUMBER-X '  '  PV-STORE-NBR-X       25820001
258300                       DELIMITED BY SIZE                          25830001
258400                       INTO  EP000-MD-SYSTEM-LOG-MESSAGE          25840001
258500                                 (EP000-MESSAGE-LINE-COUNTER)     25850001
258600             END-STRING                                           25860001
258700             PERFORM EP000-1000-POST-MESSAGE                      25870001
258800         WHEN OTHER                                               25880001
258900             MOVE 'READ STORE TABLE FOR STORE'                    25890001
259000                                 TO AA-ATTEMPTED-ACTION           25900001
259100             PERFORM 9100-DB2-ERROR                               25910001
259200             PERFORM 9999-RETURN-TO-NATIVE-CICS                   25920001
259300      END-EVALUATE.                                               25930001
259400*4100-EXIT.                                                       25940001
259500                                                                  25950001
259600******************************************************************25960001
259700*  FORMAT THE TCOS STORES IV AUTHORIZATION RESPONSE MESSAGE,     *25970001
259800*  BASED ON THE REFERRAL CODE.  FORMAT AND SEND THE REQUIRED     *25980001
259900*  RESPONSE MESSAGE BACK TO THE ISP, OF WHICH THE TCOS MESSAGE   *25990001
260000*  IS A PART.                                                    *26000001
260100******************************************************************26010001
260200 5000-FORMAT-AUTHORIZATION-RESP.                                  26020001
260300     INITIALIZE CO-STORE-NUMBER.                                  26030001
260400     MOVE PC-STORES-IV-RESPONSE-FORMAT TO CO-FUNCTION-CODE.       26040001
260500                                                                  26050001
260600     IF (NOT PV-TEST-KMRC-ACCOUNTS                                26060001
260700     AND NOT PV-TEST-GIFT-CARD-ACCOUNTS                           26070001
260800     AND NOT PV-TRAINING-KMRC-ACCOUNTS                            26080001
260900     AND NOT PV-TRAINING-GIFT-CARD-ACCOUNTS)                      26090001
261000       IF PV-SUCCESSFUL-AUTHORIZATION                             26100001
261100           INITIALIZE PV-APPROVAL-NBR-PACKED                      26110001
261200                      PV-APPROVAL-NBR                             26120001
261300                      PV-RESPONSE-CODE                            26130001
261400           IF SV005-TENDER                                        26140001
261500             IF PV-REVERSAL OR PV-REVERSAL-REAUTH                 26150001
261600               MOVE 1              TO SV005-RESPONSE-CODE         26160001
261700               MULTIPLY SV005-KMC-REMAINING-BALANCE BY 1000       26170001
261800                                   GIVING PV-APPROVAL-NBR-PACKED  26180001
261900             ELSE                                                 26190001
262000               IF SV005-APPROVED-TENDER-AMT > SV005-TRANS-AMT     26200001
262100                 MOVE 0            TO SV005-RESPONSE-CODE         26210001
262200                 MULTIPLY SV005-APPROVED-TENDER-AMT BY 1000       26220001
262300                                   GIVING PV-APPROVAL-NBR-PACKED  26230001
262400               ELSE                                               26240001
262500                 IF SV005-KMC-ORIGINAL-BALANCE < SV005-TRANS-AMT  26250001
262600                    MULTIPLY SV005-APPROVED-TENDER-AMT BY 1000    26260001
262700                                   GIVING PV-APPROVAL-NBR-PACKED  26270001
262800                 END-IF                                           26280001
262900                 IF SV005-KMC-ORIGINAL-BALANCE > SV005-TRANS-AMT  26290001
263000                 OR SV005-KMC-ORIGINAL-BALANCE = SV005-TRANS-AMT  26300001
263100                    MULTIPLY SV005-KMC-REMAINING-BALANCE BY 1000  26310001
263200                                   GIVING PV-APPROVAL-NBR-PACKED  26320001
263300                    MOVE PC-RESP-CODE-1 TO SV005-RESPONSE-CODE    26330001
263400                 END-IF                                           26340001
263500               END-IF                                             26350001
263600             END-IF                                               26360001
263700           END-IF                                                 26370001
263800           IF (SV005-ISSUE                                        26380001
263900           OR  SV005-ISSUE-GIFT-CRD)                              26390001
264000             IF PV-REVERSAL OR PV-REVERSAL-REAUTH                 26400001
264100               MULTIPLY SV005-TRANS-AMT BY 1000                   26410001
264200                                    GIVING PV-APPROVAL-NBR-PACKED 26420001
264300             ELSE                                                 26430001
264400               MULTIPLY SV005-KMC-REMAINING-BALANCE BY 1000       26440001
264500                                    GIVING PV-APPROVAL-NBR-PACKED 26450001
264600             END-IF                                               26460001
264700           END-IF                                                 26470001
264800           IF SV005-INQUIRE                                       26480001
264900               MULTIPLY SV005-KMC-REMAINING-BALANCE BY 1000       26490001
265000                                    GIVING PV-APPROVAL-NBR-PACKED 26500001
265100           END-IF                                                 26510001
265200           MOVE PV-APPROVAL-NBR-BCD    TO PV-APPROVAL-NBR         26520001
265300           MOVE SV005-RESPONSE-CODE    TO PV-RESPONSE-CODE        26530001
265400       ELSE                                                       26540001
265500           MOVE SV005-DECLINE-REASON TO PV-DECLINE-X              26550001
265600           IF PV-DECLINE-X = SPACES                               26560001
265700             OR PV-DECLINE-X NOT NUMERIC                          26570001
265800               MOVE ZEROS TO PV-APPROVAL-NBR-PACKED               26580001
265900               MOVE PV-APPROVAL-NBR-BCD TO PV-APPROVAL-NBR        26590001
266000               MOVE SV005-RESPONSE-CODE TO PV-RESPONSE-CODE       26600001
266100           ELSE                                                   26610001
266200               COMPUTE PV-DECLINE-REASON-PACKED = PV-DECLINE-9    26620001
266300                                                * 10              26630001
266400               MOVE PV-DECLINE-REASON-BCD TO PV-APPROVAL-NBR      26640001
266500               MOVE SV005-RESPONSE-CODE TO PV-RESPONSE-CODE       26650001
266600           END-IF                                                 26660001
266700       END-IF                                                     26670001
266800     ELSE                                                         26680001
266900         IF PV-DECLINE-X = SPACES                                 26690001
267000           OR PV-DECLINE-X NOT NUMERIC                            26700001
267100             MOVE SV005-DECLINE-REASON TO PV-DECLINE-X            26710001
267200             MULTIPLY SV005-TRANS-AMT BY 1000                     26720001
267300                                GIVING PV-APPROVAL-NBR-PACKED     26730001
267400             MOVE PV-APPROVAL-NBR-BCD      TO PV-APPROVAL-NBR     26740001
267500             MOVE SV005-RESPONSE-CODE      TO PV-RESPONSE-CODE    26750001
267600         ELSE                                                     26760001
267700             MOVE SV005-RESPONSE-CODE      TO PV-RESPONSE-CODE    26770001
267800         END-IF                                                   26780001
267900     END-IF.                                                      26790001
268000                                                                  26800001
268100     MOVE PV-AUTHORIZATION-RESPONSE TO                            26810001
268200               PI-VARIABLE-MESSAGE-AREA.                          26820001
268300     MOVE PC-MODEL-ID               TO                            26830001
268400               PI-MODEL-ID.                                       26840001
268500     MOVE PC-REMOTE-AUTH-RESP-MSG-LENGTH TO                       26850001
268600               PI-MESSAGE-LENGTH-IND.                             26860001
268700     MOVE PC-HEX-AUTH-RESP-MSG-TYPE-8201 TO                       26870001
268800               PV-REMOTE-AUTH-RESP-MSG-TYPE-C.                    26880001
268900     MOVE PV-REMOTE-AUTH-RESP-MSG-TYPE TO                         26890001
269000               PI-MESSAGE-TYPE-CODE.                              26900001
269100     MOVE PI-POS-INQ-REMOTE-AUTH-MSG TO                           26910001
269200               CO-POS-INQ-REMOTE-AUTH-MSG.                        26920001
269300                                                                  26930001
269400                                                                  26940001
269500*    IF NOT EP000-PV-KOHLS-PROD-SYSTEM                            26950001
269600*        MOVE '**SEND**'        TO CS-MSG-TYPE                    26960001
269700*        MOVE SV005-TRANS-AMT TO PV-DISPLAY-TRANS-AMT             26970001
269800*        IF PV-APPROVAL-NBR-PACKED = 0                            26980001
269900*            MOVE 0 TO PV-DISPLAY-APPROVAL-AMT                    26990001
270000*        ELSE                                                     27000001
270100*            DIVIDE PV-APPROVAL-NBR-PACKED BY 1000                27010001
270200*            GIVING PV-DISPLAY-APPROVAL-AMT                       27020001
270300*        END-IF                                                   27030001
270400*        SET EP000-SL-INFORMATION TO TRUE                         27040001
270500*        MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                27050001
270600*        STRING 'RESPONSE CODE = ' SV005-RESPONSE-CODE            27060001
270700*           ' TRANSACTION AMOUNT = ' PV-DISPLAY-TRANS-AMT         27070001
270800*           ' APPROVED AMOUNT = ' PV-DISPLAY-APPROVAL-AMT         27080001
270900*            DELIMITED BY SIZE INTO  EP000-MD-SYSTEM-LOG-MESSAGE  27090001
271000*                                    (EP000-MESSAGE-LINE-COUNTER) 27100001
271100*        END-STRING                                               27110001
271200*        PERFORM EP000-1000-POST-MESSAGE                          27120001
271300*    END-IF.                                                      27130001
271400                                                                  27140001
271500*-  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  -*27150001
271600*   THE MESSAGE WILL ONLY BE SENT IF IT IS NOT COMING FROM A     *27160001
271700*   TEST TRANSACTION KEYED DIRECTLY INTO CICS USING TESTS        *27170001
271800*   S20901 - S20903.                                             *27180001
271900*-  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  -*27190001
272000     IF PS-DO-THE-SEND                                            27200001
272100         PERFORM 9300-CONNECT-TO-Q-MNGR                           27210001
272200         PERFORM 9400-MQPUT1-AUTH-RESPONSE                        27220001
272300         PERFORM 9500-DISCONNECT-FROM-Q-MNGR                      27230001
272400     END-IF.                                                      27240001
272500                                                                  27250001
272600*    IF NOT EP000-PV-KOHLS-PROD-SYSTEM                            27260001
272700*        MOVE CS-SEND            TO CS-MSG-TYPE                   27270001
272800*        SET EP000-SL-INFORMATION TO TRUE                         27280001
272900*        MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                27290001
273000*        MOVE CO-COMMUNICATIONS-OUTPUT-AREA                       27300001
273100*            TO  EP000-MD-SYSTEM-LOG-MESSAGE                      27310001
273200*                    (EP000-MESSAGE-LINE-COUNTER)                 27320001
273300*        PERFORM EP000-1000-POST-MESSAGE                          27330001
273400*    END-IF.                                                      27340001
273500*5000-EXIT.                                                       27350001
273600                                                                  27360001
273700******************************************************************27370001
273800*  RETRIEVE THE AUTHORIZATION REQUEST FROM THE "GET" PROGRAM.    *27380001
273900*  IF THE D IN THIS AREA.  IF A CONDITION OTHER THAN             *27390001
274000*  END-OF-DATA (RECEIVED DATA WAS LESS THAN THE EXPLICITLY       *27400001
274100*  STATED LENGTH), AN ERROR WILL BE POSTED, AND THE TRANSACTION  *27410001
274200*  WILL BE TERMINATED, WITHOUT RESPONSE TO THE ISP.  OFF-LINE    *27420001
274300*  FLOOR LIMITS WILL THEN BE USED BY THE ISP, AFTER THE REQUEST  *27430001
274400*  TIMES OUT.                                                    *27440001
274500******************************************************************27450001
274600 7000-RETRIEVE-AUTH-REQUEST.                                      27460001
274700                                                                  27470001
274800     EXEC CICS                                                    27480001
274900         RETRIEVE                                                 27490001
275000             INTO    (PV-AUTH-INQ-MESSAGE-AREA)                   27500001
275100             LENGTH  (PC-COMMUNICATIONS-IN-LENGTH)                27510001
275200             RESP    (PV-CICS-RESPONSE)                           27520001
275300     END-EXEC.                                                    27530001
275400                                                                  27540001
275500     EVALUATE TRUE                                                27550001
275600         WHEN ((PV-CICS-RESPONSE NOT = DFHRESP(NORMAL))           27560001
275700                      AND (PV-CICS-RESPONSE NOT = DFHRESP(EOC)))  27570001
275800             SET EP000-SL-ERROR TO TRUE                           27580001
275900             MOVE PV-CICS-RESPONSE TO PV-CICS-RESPONSE-DISP       27590001
276000             MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER            27600001
276100             STRING 'ERROR RETRIEVING RESPONSE MESSAGE '          27610001
276200                                         DELIMITED BY SIZE        27620001
276300                ' - CICS RESPONSE = '    DELIMITED BY SIZE        27630001
276400                PV-CICS-RESPONSE-DISP    DELIMITED BY SIZE        27640001
276500                 INTO  EP000-MD-SYSTEM-LOG-MESSAGE                27650001
276600                           (EP000-MESSAGE-LINE-COUNTER)           27660001
276700             PERFORM EP000-1000-POST-MESSAGE                      27670001
276800             PERFORM 9999-RETURN-TO-NATIVE-CICS                   27680001
276900     END-EVALUATE.                                                27690001
277000                                                                  27700001
277100     MOVE PV-AI-AUTH-REQUEST-MESSAGE                              27710001
277200         TO  CI-POS-INQ-REMOTE-AUTH-MSG.                          27720001
277300     MOVE PV-AI-MQ-MESSAGE-DESCRIPTOR                             27730001
277400         TO  MQM-MESSAGE-DESCRIPTOR.                              27740001
277500                                                                  27750001
277600     EVALUATE TRUE                                                27760001
277700         WHEN  PC-COMMUNICATIONS-IN-LENGTH  NOT = 6               27770001
277800             CONTINUE                                             27780001
277900         WHEN  CI-COMMUNICATIONS-INPUT-AREA (5:2) = '01'          27790001
278000             SET PS-DONT-DO-THE-SEND     TO TRUE                  27800001
278100             MOVE TM1-STORE-NUMBER       TO TM-STORE-NUMBER       27810001
278200             MOVE TM1-TERMINAL-NUMBER    TO TM-TERMINAL-NUMBER    27820001
278300             MOVE TM1-TRANSACTION-NUMBER TO TM-TRANSACTION-NUMBER 27830001
278400             MOVE PC-RECV-AUTH-MSG-LENGTH                         27840001
278500                       TO TM-MESSAGE-LENGTH-IND                   27850001
278600             MOVE TEST-VAR-MSG-AREA-ISSUE1                        27860001
278700                       TO TM-VARIABLE-MESSAGE-AREA                27870001
278800             MOVE TM-POS-INQ-REMOTE-AUTH-MSG TO                   27880001
278900                      CI-POS-INQ-REMOTE-AUTH-MSG                  27890001
279000         WHEN  CI-COMMUNICATIONS-INPUT-AREA (5:2) = '02'          27900001
279100             SET PS-DONT-DO-THE-SEND     TO TRUE                  27910001
279200             MOVE TM2-STORE-NUMBER       TO TM-STORE-NUMBER       27920001
279300             MOVE TM2-TERMINAL-NUMBER    TO TM-TERMINAL-NUMBER    27930001
279400             MOVE TM2-TRANSACTION-NUMBER TO TM-TRANSACTION-NUMBER 27940001
279500             MOVE PC-RECV-AUTH-MSG-LENGTH                         27950001
279600                       TO TM-MESSAGE-LENGTH-IND                   27960001
279700             MOVE TEST-VAR-MSG-AREA-TENDER2                       27970001
279800                       TO TM-VARIABLE-MESSAGE-AREA                27980001
279900             MOVE TM-POS-INQ-REMOTE-AUTH-MSG TO                   27990001
280000                      CI-POS-INQ-REMOTE-AUTH-MSG                  28000001
280100         WHEN  CI-COMMUNICATIONS-INPUT-AREA (5:2) = '03'          28010001
280200             SET PS-DONT-DO-THE-SEND     TO TRUE                  28020001
280300             MOVE TM3-STORE-NUMBER       TO TM-STORE-NUMBER       28030001
280400             MOVE TM3-TERMINAL-NUMBER    TO TM-TERMINAL-NUMBER    28040001
280500             MOVE TM3-TRANSACTION-NUMBER TO TM-TRANSACTION-NUMBER 28050001
280600             MOVE PC-RECV-AUTH-MSG-LENGTH                         28060001
280700                       TO TM-MESSAGE-LENGTH-IND                   28070001
280800             MOVE TEST-VAR-MSG-AREA-INQUIRY3                      28080001
280900                       TO TM-VARIABLE-MESSAGE-AREA                28090001
281000             MOVE TM-POS-INQ-REMOTE-AUTH-MSG TO                   28100001
281100                      CI-POS-INQ-REMOTE-AUTH-MSG                  28110001
281200     END-EVALUATE.                                                28120001
281300                                                                  28130001
281400*7000-EXIT.                                                       28140001
281500                                                                  28150001
281600******************************************************************28160001
281700*  FORMAT AND POST INFORMATION RELATIVE TO A DB2 ERROR.  ROLL    *28170001
281800*  BACK ALL RESOURCES.                                           *28180001
281900******************************************************************28190001
282000                                                                  28200001
282100 9100-DB2-ERROR.                                                  28210001
282200     SET PS-DB2-ERROR                                             28220001
282300         EP000-SL-ERROR TO TRUE.                                  28230001
282400                                                                  28240001
282500     MOVE SQLCODE TO DE-SQLCODE.                                  28250001
282600     MOVE SQLERRD(3) TO DE-ROWS-PROCESSED.                        28260001
282700     MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                    28270001
282800     MOVE DE-DB2-ERROR-MESSAGE                                    28280001
282900         TO  EP000-MD-SYSTEM-LOG-MESSAGE                          28290001
283000                 (EP000-MESSAGE-LINE-COUNTER).                    28300001
283100                                                                  28310001
283200     MOVE SQLERRMC TO DS-SQLERRMC.                                28320001
283300     ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER                     28330001
283400     MOVE DS-DB2-SQLERRMC-MESSAGE                                 28340001
283500         TO  EP000-MD-SYSTEM-LOG-MESSAGE                          28350001
283600                 (EP000-MESSAGE-LINE-COUNTER).                    28360001
283700                                                                  28370001
283800     ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER                     28380001
283900     MOVE AA-ATTEMPTED-ACTION-MESSAGE                             28390001
284000         TO  EP000-MD-SYSTEM-LOG-MESSAGE                          28400001
284100                 (EP000-MESSAGE-LINE-COUNTER).                    28410001
284200                                                                  28420001
284300     PERFORM EP000-1000-POST-MESSAGE.                             28430001
284400                                                                  28440001
284500     EXEC CICS                                                    28450001
284600         SYNCPOINT                                                28460001
284700             ROLLBACK                                             28470001
284800     END-EXEC.                                                    28480001
284900 9100-EXIT.     EXIT.                                             28490001
285000                                                                  28500001
285100******************************************************************28510001
285200*  FORMAT AND POST INFORMATION RELATIVE TO A DB2 WARNING.  ROLL  *28520001
285300*  BACK ALL RESOURCES.                                           *28530001
285400******************************************************************28540001
285500                                                                  28550001
285600 9200-DB2-WARNING.                                                28560001
285700     SET PS-DB2-ERROR                                             28570001
285800         EP000-SL-ERROR TO TRUE.                                  28580001
285900                                                                  28590001
286000     MOVE SQLCODE TO DW-SQLCODE.                                  28600001
286100     MOVE SQLERRD(3) TO DW-ROWS-PROCESSED.                        28610001
286200     MOVE SQLWARN TO DW-SQLWARN.                                  28620001
286300     MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                    28630001
286400     MOVE DW-DB2-WARNING-MESSAGE                                  28640001
286500         TO  EP000-MD-SYSTEM-LOG-MESSAGE                          28650001
286600                 (EP000-MESSAGE-LINE-COUNTER)                     28660001
286700                                                                  28670001
286800     MOVE SQLERRMC TO DS-SQLERRMC.                                28680001
286900     ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER                     28690001
287000     MOVE DS-DB2-SQLERRMC-MESSAGE                                 28700001
287100         TO  EP000-MD-SYSTEM-LOG-MESSAGE                          28710001
287200                 (EP000-MESSAGE-LINE-COUNTER)                     28720001
287300                                                                  28730001
287400     ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER                     28740001
287500     MOVE AA-ATTEMPTED-ACTION-MESSAGE                             28750001
287600         TO  EP000-MD-SYSTEM-LOG-MESSAGE                          28760001
287700                 (EP000-MESSAGE-LINE-COUNTER)                     28770001
287800                                                                  28780001
287900     PERFORM EP000-1000-POST-MESSAGE.                             28790001
288000                                                                  28800001
288100     EXEC CICS                                                    28810001
288200         SYNCPOINT                                                28820001
288300             ROLLBACK                                             28830001
288400     END-EXEC.                                                    28840001
288500 9200-EXIT.   EXIT.                                               28850001
288600                                                                  28860001
288700* -------------------------------------------------------------- *28870001
288800*    CONNECT TO THE QUEUE MANAGER                                 28880001
288900* -------------------------------------------------------------- *28890001
289000 9300-CONNECT-TO-Q-MNGR.                                          28900001
289100                                                                  28910001
289200     CALL PC-MQCONN USING PC-QMGR-NAME                            28920001
289300                         PV-CONNECT-HANDLE                        28930001
289400                         PV-COMPLETION-CODE                       28940001
289500                         PV-REASON.                               28950001
289600*                                                                 28960001
289700*    IF CONNECTION FAILS DISPLAY ERROR MESSAGE AND EXIT.          28970001
289800*                                                                 28980001
289900     MOVE PV-REASON TO PV-CONNECT-REASON.                         28990001
290000     IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   29000001
290100         SET PE-MQ-CONNECT                                        29010001
290200             EP000-SL-ERROR TO TRUE                               29020001
290300         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE          29030001
290400         MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE       29040001
290500         MOVE PV-REASON TO PV-DISPLAY-REASON                      29050001
290600         MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE              29060001
290700                                                                  29070001
290800         MOVE PE-MQ-ERROR-NUMBER TO EP000-SL-PI-MESSAGE-NUMBER    29080001
290900         MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                29090001
291000         MOVE PE-MQ-ERROR-MESSAGE                                 29100001
291100             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      29110001
291200                     (EP000-MESSAGE-LINE-COUNTER)                 29120001
291300                                                                  29130001
291400         PERFORM EP000-1000-POST-MESSAGE                          29140001
291500         PERFORM 9999-RETURN-TO-NATIVE-CICS                       29150001
291600     END-IF.                                                      29160001
291700                                                                  29170001
291800* -------------------------------------------------------------- *29180001
291900*    MQ PUT ONE RESPONSE MESSAGE TO THE REQUESTING STORES         29190001
292000*    EP.AUTH.Q                                                    29200001
292100* -------------------------------------------------------------- *29210001
292200 9400-MQPUT1-AUTH-RESPONSE.                                       29220001
292300*                                                                 29230001
292400*    SETUP MQMD - MESSAGE DESCRIPTOR                              29240001
292500*                                                                 29250001
292600     MOVE PC-CURRENT-PROGRAM-NAME  TO  MQMD-USERIDENTIFIER.       29260001
292700*                                                                 29270001
292800*    SETUP MQOD - OBJECT DESCRIPTOR                               29280001
292900*                                                                 29290001
293000     MOVE MQOT-Q  TO  MQOD-OBJECTTYPE.                            29300001
293100     MOVE PC-AUTH-Q-NAME  TO  MQOD-OBJECTNAME.                    29310001
293200                                                                  29320001
293300     MOVE LOW-VALUES  TO  PV-PUT-MESSAGE-BUFFER.                  29330001
293400     MOVE CO-POS-INQ-REMOTE-AUTH-MSG  TO  PV-PUT-MESSAGE-BUFFER.  29340001
293500     MOVE PI-MESSAGE-LENGTH-IND   TO   PV-PUT-MSG-BUFFER-LENGTH.  29350001
293600     ADD PC-TCOS-HDR-LENGTH  TO  PV-PUT-MSG-BUFFER-LENGTH.        29360001
293700                                                                  29370001
293800     MOVE MQMD-REPLYTOQMGR  TO  MQOD-OBJECTQMGRNAME.              29380001
293900                                                                  29390001
294000*                                                                 29400001
294100*    SETUP MQPMO-OPTIONS                                          29410001
294200*                                                                 29420001
294300     COMPUTE MQPMO-OPTIONS = MQPMO-NO-SYNCPOINT                   29430001
294400                           + MQPMO-SET-IDENTITY-CONTEXT           29440001
294500                           + MQPMO-FAIL-IF-QUIESCING.             29450001
294600                                                                  29460001
294700     CALL PC-MQPUT1 USING PV-CONNECT-HANDLE                       29470001
294800                          MQM-OBJECT-DESCRIPTOR                   29480001
294900                          MQM-MESSAGE-DESCRIPTOR                  29490001
295000                          MQM-PUT-MESSAGE-OPTIONS                 29500001
295100                          PV-PUT-MSG-BUFFER-LENGTH                29510001
295200                          PV-PUT-MESSAGE-BUFFER                   29520001
295300                          PV-COMPLETION-CODE                      29530001
295400                          PV-REASON.                              29540001
295500*                                                                 29550001
295600*        IF GET FAILED, DISPLAY THE ERROR MESSAGE                 29560001
295700*        AND TERMINATE THE PROGRAM.                               29570001
295800*                                                                 29580001
295900     IF (PV-COMPLETION-CODE = MQCC-FAILED)                        29590001
296000         IF (PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)               29600001
296100             SET PE-MQ-PUT1 TO TRUE                               29610001
296200             MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE      29620001
296300             MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE   29630001
296400             MOVE PV-REASON TO PV-DISPLAY-REASON                  29640001
296500             MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE          29650001
296600                                                                  29660001
296700             MOVE PE-MQ-ERROR-NUMBER TO EP000-SL-PI-MESSAGE-NUMBER29670001
296800             SET EP000-SL-ERROR  TO  TRUE                         29680001
296900             MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER            29690001
297000             MOVE PE-MQ-ERROR-MESSAGE                             29700001
297100                 TO  EP000-MD-SYSTEM-LOG-MESSAGE                  29710001
297200                         (EP000-MESSAGE-LINE-COUNTER)             29720001
297300             PERFORM EP000-1000-POST-MESSAGE                      29730001
297400         END-IF                                                   29740001
297500         PERFORM 9500-DISCONNECT-FROM-Q-MNGR                      29750001
297600         PERFORM 9999-RETURN-TO-NATIVE-CICS                       29760001
297700     END-IF.                                                      29770001
297800                                                                  29780001
297900*----------------------------------------------------------------*29790001
298000*  DISCONNECT FROM THE MQ MANAGER                                *29800001
298100*----------------------------------------------------------------*29810001
298200 9500-DISCONNECT-FROM-Q-MNGR.                                     29820001
298300                                                                  29830001
298400*    DISCONNECT FROM THE QUEUE MANAGER                            29840001
298500                                                                  29850001
298600     IF PV-CONNECT-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED  29860001
298700         CALL PC-MQDISC USING PV-CONNECT-HANDLE                   29870001
298800                              PV-COMPLETION-CODE                  29880001
298900                              PV-REASON                           29890001
299000         IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN               29900001
299100             SET PE-MQ-DISCONNECT TO TRUE                         29910001
299200             MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE      29920001
299300             MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE   29930001
299400             MOVE PV-REASON TO PV-DISPLAY-REASON                  29940001
299500             MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE          29950001
299600                                                                  29960001
299700             MOVE PE-MQ-ERROR-NUMBER TO EP000-SL-PI-MESSAGE-NUMBER29970001
299800             SET EP000-SL-ERROR  TO  TRUE                         29980001
299900             MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER            29990001
300000             MOVE PE-MQ-ERROR-MESSAGE                             30000001
300100                 TO  EP000-MD-SYSTEM-LOG-MESSAGE                  30010001
300200                         (EP000-MESSAGE-LINE-COUNTER)             30020001
300300             PERFORM EP000-1000-POST-MESSAGE                      30030001
300400             PERFORM 9999-RETURN-TO-NATIVE-CICS                   30040001
300500         END-IF                                                   30050001
300600     END-IF.                                                      30060001
300700                                                                  30070001
300800******************************************************************30080001
300900*  TERMINATE THE TRANSACTION.                                    *30090001
301000******************************************************************30100001
301100                                                                  30110001
301200 9999-RETURN-TO-NATIVE-CICS.                                      30120001
301300     EXEC CICS                                                    30130001
301400         RETURN                                                   30140001
301500     END-EXEC.                                                    30150001
301600 9999-EXIT.    EXIT.                                              30160001
301700                                                                  30170001
301800*----------------------------------------------------------------*30180001
301900     COPY SVPD005.                                                30190001
302000                                                                  30200001
302100*----------------------------------------------------------------*30210001
302200*  POST ALERT/ERROR ROUTINE.                                      30220001
302300*                                                                 30230001
302400     COPY EPPD000.                                                30240001
302500                                                                  30250001
