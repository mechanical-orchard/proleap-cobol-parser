000100*-----------------------*                                         00010016
000200 IDENTIFICATION DIVISION.                                         00020016
000300*-----------------------*                                         00030016
000400 PROGRAM-ID.    RCKCS219.                                         00040016
000500 AUTHOR.        LOUIE CRISOSTOMO.                                 00050016
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060016
000700 DATE-WRITTEN.  03-15-94.                                         00070016
000800 DATE-COMPILED.                                                   00080016
000900*----------------------------------------------------------------*00090016
001000*    E219 - VERIFIED COUNT CRITERIA SPECIFICATION                *00100016
001100*                                                                *00110016
001200*    THIS PROGRAM REQUIRES THE PURCHASE ORDER NUMBER, RECEIVER   *00120016
001300*    SEQUENCE NUMBER AND THE PURCHASE ORDER LINE NUMBER FOR THE  *00130016
001400*    STORE ADJUSTMENT.  OTHERWISE, FOR VERIFY LIST, ALL THE      *00140016
001500*    MENTIONED FIELDS ARE OPTIONAL.                              *00150016
001600*----------------------------------------------------------------*00160016
001700                                                                  00170016
001800**---------------------------------------------------------------*00180016
001900** 913 PROB - BY H. KIM  9/14/95                                 *00190016
002000**            IF SQL CODE = 904, 911, 913 PUT THE MESSAGE        *00200016
002100**            INSTEAD OF ABENDING THE TRANSACTION.               *00210016
002200**---------------------------------------------------------------*00220016
002210* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00221059
002220* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00222060
002230* MAKING THE CALL DYNAMIC VS STATIC.                              00223060
002240*---------------------------------------------------------------* 00224060
002300                                                                  00230016
002400 ENVIRONMENT DIVISION.                                            00240016
002500                                                                  00250016
002600                                                                  00260016
002700                                                                  00270016
002800 DATA DIVISION.                                                   00280016
002900                                                                  00290016
003000                                                                  00300016
003100 WORKING-STORAGE SECTION.                                         00310016
003200                                                                  00320016
003300 01  DK-DB2-KEYS.                                                 00330016
003400     05  DK-DEPT-NBR                    PIC X(03)   VALUE SPACES. 00340016
003500     05  DK-PO-NBR                      PIC S9(09)  COMP VALUE +0.00350016
003600     05  DK-RCVR-NBR                    PIC S9(09)  COMP VALUE +0.00360016
003610     05  DK-LINE-NBR                    PIC S9(09)  COMP VALUE +0.00361054
003620     05  DK-STR-NBR                      PIC  S9(4) COMP VALUE +0.00362054
003700     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00370016
003800                                                    COMP.         00380016
003900     05  DK-FCLTY-ID                    PIC S9(04)  VALUE ZERO    00390016
004000                                                    COMP.         00400016
004100     05  DK-AGRMT-TYP-ID                PIC  X(01)  VALUE SPACE.  00410016
004200     05  DK-TYP-CDE                     PIC S9(04)  VALUE ZERO    00420016
004300                                                         COMP.    00430016
004400                                                                  00440016
004500 01  PC-PROGRAM-CONSTANTS.                                        00450016
004600     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'RC219A  '. 00460016
004700     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'RCKM219 '. 00470016
004800     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'RCKCS219'. 00480016
004801                                                                  00480153
004810* 00005      INVALID VALUE                                        00481053
004820* 00007      REQUIRED ENTRY                                       00482053
004830* 00008      MUST BE NUMERIC                                      00483053
004840* 00083      PURCHASE ORDER DOES NOT EXIST                        00484053
004850* 00148      DATA DOES NOT EXIST                                  00485053
004860* 00051      RECEIVER SEQUENCE NOT FOUND                          00486053
004870* 00551      WAIT 15 SECONDS;RETRY FUNCTION AGAIN                 00487053
004880* 01057      RECEIVER IS IN PRE-RECEIVER STATUS                   00488053
004890* 01058      FREIGHT BILL IS MISSING ON THE RECEIVER              00489053
004891* 03055      RECEIVER IS PRE-PACK.  USE THE F17/F24 KEYS          00489153
004892* 03056      RECEIVER IS NOT PRE-PACK.  USE THE F22/F23 KEYS      00489253
004893* 03074      PRE-PACK PRIOR TO NEW PACK SCREENS - USE F22/F23     00489353
004894* 03797      LINE/STORE COMBINATINO NO VALID FOR THIS RCVR        00489453
004895* 03798      STORE IS NOT VALID FOR THIS RECEIVER                 00489553
004900     05  PC-TSYMSG-NUMBERS.                                       00490016
005000         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00500016
005200         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00520016
005400         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00540016
005600         10  PC-TSYMSG-00083       PIC  9(05)  VALUE  00083.      00560016
005800         10  PC-TSYMSG-00148       PIC  9(05)  VALUE  00083.      00580016
006000         10  PC-TSYMSG-00954       PIC  9(05)  VALUE  00954.      00600040
006010         10  PC-TSYMSG-00551       PIC  9(05)  VALUE  00551.      00601040
006300         10  PC-TSYMSG-01057       PIC  9(05)  VALUE  01057.      00630016
006500         10  PC-TSYMSG-01058       PIC  9(05)  VALUE  01058.      00650016
006700         10  PC-TSYMSG-03055       PIC  9(05)  VALUE  03055.      00670018
007000         10  PC-TSYMSG-03056       PIC  9(05)  VALUE  03056.      00700018
007300         10  PC-TSYMSG-03074       PIC  9(05)  VALUE  03074.      00730037
007310         10  PC-TSYMSG-03797       PIC  9(05)  VALUE  03797.      00731053
007320         10  PC-TSYMSG-03798       PIC  9(05)  VALUE  03798.      00732053
007400                                                                  00740053
007600     05  PC-ACTIVE                 PIC  X(01)  VALUE  'A'.        00760016
007700     05  PC-X                      PIC  X(01)  VALUE  'X'.        00770016
007800     05  PC-AC                     PIC  X(02)  VALUE  'AC'.       00780016
007900     05  PC-CM                     PIC  X(02)  VALUE  'CM'.       00790016
008000     05  PC-IN                     PIC  X(02)  VALUE  'IN'.       00800016
008100     05  PC-IP                     PIC  X(02)  VALUE  'IP'.       00810016
008200     05  PC-SPACES                 PIC  X(22)  VALUE  SPACES.     00820016
008300     05  PC-MAX-RETRIES            PIC S9(03)  VALUE  +3          00830016
008400                                               COMP-3.            00840016
008500     05  PC-1                      PIC S9(04)  VALUE  +1          00850016
008600                                               COMP.              00860016
008700     05  PC-DEFAULT-TMST           PIC  X(26)  VALUE              00870016
008800                                  '9999-09-09-09.09.09.999999'.   00880016
008900     05  PC-LOW-TMST               PIC  X(26)  VALUE              00890034
009000                                  '0001-01-01-01.01.01.111111'.   00900034
009100                                                                  00910016
009200 01  PS-PROGRAM-SWITCHES.                                         00920016
009300     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00930016
009400         88  PS-ERROR                          VALUE  'Y'.        00940016
009500         88  PS-NO-ERROR                       VALUE  'N'.        00950016
009600                                                                  00960016
009700 01  PS-PROGRAM-VARIABLES.                                        00970016
009800     05  PV-RETRY-COUNTER          PIC S9(04)  VALUE +0           00980016
009900                                               COMP SYNC.         00990016
010000     05  PV-OPER-UNT-ID.                                          01000016
010100         10  FILLER                PIC X(01)   VALUE ZEROES.      01010016
010200         10  PV-LOCATION           PIC X(03)   VALUE ZEROES.      01020016
010300     05  PV-OPER-UNT-ID-N  REDEFINES  PV-OPER-UNT-ID              01030016
010400                                   PIC 9(04).                     01040016
010500     05  PV-DB2-COUNT              PIC S9(9)   VALUE +0           01050016
010600                                               COMP-3.            01060016
010700     05  PV-NULL-IND               PIC S9(04)  VALUE +0           01070016
010800                                               COMP SYNC.         01080016
010900     05  PV-DISP-PO-NBR                 PIC  9(09).               01090030
011000     05  PV-DISP-OPER-UNT-ID            PIC  9(04).               01100030
011100     05  PV-DISP-FCLTY-ID               PIC  9(04).               01110030
011200     05  PV-DISP-REC-SEQ-NBR            PIC  9(09).               01120030
011210     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01121046
011220                                                     COMP SYNC.   01122046
011230     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01123046
011240     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01124046
011250     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROES 01125046
011260                                            COMP SYNC.            01126046
011270     05  PV-DISP-PO                     PIC  9(09).               01127056
011280     05  PV-DISP-RCVR                   PIC  9(04).               01128056
011290     05  PV-DISP-LINE                   PIC  9(04).               01129056
011291     05  PV-DISP-STR                    PIC  9(04).               01129156
011300                                                                  01130016
011400*----------------------------------------------------------------*01140016
011500*    MAP LAYOUT                                                  *01150016
011600*----------------------------------------------------------------*01160016
011700                                                                  01170016
011800     COPY RCKM219.                                                01180016
011900     EJECT                                                        01190016
012000*----------------------------------------------------------------*01200016
012100*    ATTRIBUTE SETTINGS COPYBOOK.                                *01210016
012200*----------------------------------------------------------------*01220016
012300                                                                  01230016
012400     COPY DPWS015.                                                01240042
012500                                                                  01250016
012600*----------------------------------------------------------------*01260016
012700*    FUNCTION KEYS COPYBOOK                                      *01270016
012800*----------------------------------------------------------------*01280016
012900                                                                  01290016
013000     COPY DPWS016.                                                01300042
013100/                                                                 01310016
013200******************************************************************01320016
013300** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01330016
013400** SUB-ROUTINE (DPKUT100).                                      **01340016
013500******************************************************************01350016
013600     COPY DPWS010I.                                               01360042
013700/                                                                 01370016
013800******************************************************************01380016
013900** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **01390060
014000** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01400016
014100******************************************************************01410016
014200     COPY DPWS030.                                                01420042
014210     COPY DPWS930.                                                01421060
014300/                                                                 01430016
014310******************************************************************01431045
014320* COMMAREA FOR XLKUT071 - LOCATION MODULE                         01432045
014330******************************************************************01433045
014340     COPY XLWS071.                                                01434045
014350/                                                                 01435045
014400***************************************************************** 01440016
014500*    STANDARD COMMAREA.                                           01450016
014600***************************************************************** 01460016
014700                                                                  01470016
014800     COPY DPWS020.                                                01480042
014900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01490016
015000                                                                  01500016
015100***************************************************************** 01510016
015200*    INTER-APPLICATION COMMAREA.                                  01520016
015300***************************************************************** 01530016
015400                                                                  01540016
015500         10  INTER-APPL-COMM-AREA     PIC X(200).                 01550043
015600     COPY RCWS012.                                                01560042
015610     COPY RCWS017.                                                01561043
015700***************************************************************** 01570016
015800*    SPECIFIC COMMMAREA FOR RCKCS219.                             01580016
015900***************************************************************** 01590016
016000         10  ASC-SPECIFIC-COMMAREA.                               01600016
016100             15  ASC-OPER-UNT-ID.                                 01610016
016200                 20  ASC-OPER-UNT-ID-N       PIC  9(04).          01620016
016300             15  ASC-FACILITY-NAME           PIC  X(30).          01630016
016400             15  ASC-FCLTY-ID.                                    01640016
016500                 20  ASC-FCLTY-ID-N          PIC  9(04).          01650016
016600             15  ASC-FCLTY-NME               PIC  X(30).          01660016
016700             15  ASC-PO-NBR.                                      01670016
016800                 20  ASC-PO-NBR-N            PIC  9(08).          01680016
016900             15  ASC-REC-SEQ-NBR.                                 01690016
017000                 20  ASC-REC-SEQ-NBR-N       PIC  9(04).          01700016
017100             15  ASC-PO-LINE-NBR.                                 01710016
017200                 20  ASC-PO-LINE-NBR-N       PIC  9(04).          01720016
017300             15  ASC-STORE-NBR.                                   01730016
017400                 20  ASC-STORE-NBR-N         PIC  9(04).          01740045
017500             15  ASC-PACKAGE-TYP-IND         PIC  X(03).          01750018
017600                 88  ASC-PACK-BY-STORE         VALUE 'PBS'.       01760019
017700                 88  ASC-BULK                  VALUE 'BLK'.       01770019
017800                 88  ASC-PREPACK               VALUE 'PRE'.       01780019
017900             15  ASC-PREPACK-B4-CONVERSION   PIC  X(01).          01790026
018000                 88  ASC-OLD-PREPACK           VALUE 'O'.         01800026
018100                 88  ASC-NEW-PREPACK           VALUE 'N'.         01810026
018200             15  ASC-HOLD-INTER-APPL         PIC  X(200).         01820016
018300         10  FILLER                          PIC  X(2573).        01830045
018400/                                                                 01840016
018500*----------------------------------------------------------------*01850016
018600*    ABEND PROCESSING COPYBOOK.                                  *01860016
018700*----------------------------------------------------------------*01870016
018800                                                                  01880016
018900     COPY DPWS013.                                                01890042
019000                                                                  01900016
019100*---------------------------------------------------------------* 01910016
019200*    DB2 AREA FOR RECEIPT HEADER TABLE                          * 01920016
019300*---------------------------------------------------------------* 01930016
019400     EXEC SQL                                                     01940016
019500          INCLUDE TRECEIV                                         01950016
019600     END-EXEC.                                                    01960016
019700*---------------------------------------------------------------* 01970029
019800*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 01980029
019900*---------------------------------------------------------------* 01990029
020000     EXEC SQL                                                     02000029
020100          INCLUDE TRECITM                                         02010029
020200     END-EXEC.                                                    02020029
020210*---------------------------------------------------------------* 02021055
020220*    DB2 AREA FOR RECEIPT ITEM STORE DISTRIBUTION               * 02022055
020230*---------------------------------------------------------------* 02023055
020240     EXEC SQL                                                     02024055
020250          INCLUDE TRECDIS                                         02025055
020260     END-EXEC.                                                    02026055
020300*---------------------------------------------------------------* 02030016
020400*    DB2 AREA FOR SHIPMENT TABLE                                * 02040016
020500*---------------------------------------------------------------* 02050016
020600     EXEC SQL                                                     02060016
020700          INCLUDE TSHIPMT                                         02070016
020800     END-EXEC.                                                    02080016
020900*---------------------------------------------------------------* 02090016
021000*    DB2 AREA FOR SHIPMENT PO TABLE                             * 02100016
021100*---------------------------------------------------------------* 02110016
021200     EXEC SQL                                                     02120016
021300          INCLUDE TSHPTPO                                         02130016
021400     END-EXEC.                                                    02140016
022200*---------------------------------------------------------------* 02220016
022300*    DB2 AREA FOR PO AGREEMENT TABLE                            * 02230016
022400*---------------------------------------------------------------* 02240016
022500     EXEC SQL                                                     02250016
022600          INCLUDE TPOAGMT                                         02260016
022700     END-EXEC.                                                    02270016
022800                                                                  02280016
022900******************************************************************02290026
023000*  SQL AND COBOL DECLARATIONS FOR THE KOHLS/RETEK PARMS (TKRPRPM) 02300026
023100******************************************************************02310026
023200     EXEC SQL                                                     02320026
023300          INCLUDE TKRPRPM                                         02330026
023400     END-EXEC.                                                    02340026
023500                                                                  02350026
023600*----------------------------------------------------------------*02360016
023700*    DB2 AREA FOR COMMUNICATIONS                                 *02370016
023800*----------------------------------------------------------------*02380016
023900                                                                  02390016
024000     EXEC SQL                                                     02400016
024100         INCLUDE SQLCA                                            02410016
024200     END-EXEC.                                                    02420016
024300                                                                  02430016
024400                                                                  02440016
024500 EJECT                                                            02450016
024600 LINKAGE SECTION.                                                 02460016
024700                                                                  02470016
024800 01  DFHCOMMAREA.                                                 02480016
024900     05  FILLER                         OCCURS  1 TO 4072 TIMES   02490016
025000                                        DEPENDING ON EIBCALEN.    02500016
025100         10  FILLER                     PIC X.                    02510016
025200                                                                  02520016
025300                                                                  02530016
025400 PROCEDURE DIVISION.                                              02540016
025500***************************************************************** 02550016
025600** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02560016
025700** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02570016
025800** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02580016
025900**                                                             ** 02590016
026000** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02600016
026100** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02610016
026200***************************************************************** 02620016
026300                                                                  02630016
026400 0000-MAIN-MODULE.                                                02640016
026500                                                                  02650016
026600     INITIALIZE DP030-CICS-API-FIELDS.                            02660016
026700                                                                  02670016
026800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02680016
026900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02690016
027000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02700016
027100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02710016
027200     MOVE LENGTH OF RC219AI        TO DP030-MAP-LENGTH (1).       02720016
027300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02730016
027400     PERFORM 0001-CALL-CICS-ARCH-API.                             02740016
027500                                                                  02750016
027600     PERFORM 1000-CONTROL-PROCESSING                              02760016
027700                                                                  02770016
027800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02780016
027900     PERFORM 0001-CALL-CICS-ARCH-API.                             02790016
028000                                                                  02800016
028100 0001-CALL-CICS-ARCH-API.                                         02810016
028200                                                                  02820016
028310     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02831060
028400                                    DFHCOMMAREA                   02840060
028500                                    DP030-CICS-API-FIELDS         02850060
028600                                    DP020-STANDARD-COMMAREA       02860060
028700                                    RC219AI.                      02870060
028800                                                                  02880016
028900     IF  DP030-RC-CALL-SUCCESSFUL                                 02890016
029000         CONTINUE                                                 02900016
029100     ELSE                                                         02910016
029200         SET DP013-NO-ROLLBACK                                    02920016
029300             DP013-XCTL-DISPLAY-RESTART                           02930016
029400             DP013-CICS-ABEND      TO TRUE                        02940016
029500         MOVE 'BEFORE 0000-MAIN-MODULE'                           02950016
029600                                   TO DP013-PARAGRAPH             02960016
029610         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O02961060
029620-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02962060
029900         MOVE DP030-RETURN-CODE                                   02990016
030000                                   TO DP013-MESSAGE-TEXT (3)      03000016
030100         PERFORM DP013-0000-PROCESS-ABEND                         03010016
030200     END-IF.                                                      03020016
030300 EJECT                                                            03030016
030400*----------------------------------------------------------------*03040016
030500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03050016
030600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03060016
030700*----------------------------------------------------------------*03070016
030800                                                                  03080016
030900 1000-CONTROL-PROCESSING.                                         03090016
031000                                                                  03100016
031100     EVALUATE TRUE                                                03110016
031200         WHEN DP020-NEXT-ACT-INITIAL                              03120016
031300              MOVE SPACES         TO  ASC-SPECIFIC-COMMAREA       03130016
031400              PERFORM 4000-BUILD-INITIAL-PANEL                    03140016
031500                                                                  03150016
031600         WHEN DP020-NEXT-ACT-READ-MAP                             03160016
031700              PERFORM 2000-PROCESS-PANEL                          03170016
031800                                                                  03180016
031900         WHEN DP020-NEXT-ACT-RETURN                               03190016
032000         MOVE ASC-HOLD-INTER-APPL                                 03200016
032100                     TO INTER-APPL-COMM-AREA                      03210016
032200         IF ASC-PO-LINE-NBR = SPACES AND ASC-STORE-NBR = SPACES   03220016
032300             MOVE SPACES              TO ASC-PO-NBR               03230016
032400                                         ASC-REC-SEQ-NBR          03240016
032500         END-IF                                                   03250016
032600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     03260016
032700         SET DP030-SET-CURSOR-APPL-1   TO  TRUE                   03270016
032800         MOVE -1                       TO APONBRL                 03280016
032900                                                                  03290016
033000                                                                  03300016
033100         WHEN OTHER                                               03310016
033200             SET DP013-LOGIC-ABEND                                03320016
033300                 DP013-NO-ROLLBACK TO TRUE                        03330016
033400             MOVE '1000-CONTROL-PROCESSING'                       03340016
033500                                   TO  DP013-PARAGRAPH            03350016
033600             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03360016
033700                                   TO  DP013-MESSAGE-TEXT(1)      03370016
033800             MOVE DP020-NEXT-APPL-ACTIVITY                        03380016
033900                                   TO DP013-MESSAGE-TEXT(2)       03390016
034000             PERFORM DP013-0000-PROCESS-ABEND                     03400016
034100     END-EVALUATE.                                                03410016
034200                                                                  03420016
034300*----------------------------------------------------------------*03430016
034400* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03440016
034500* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03450016
034600* EDITS.                                                         *03460016
034700*----------------------------------------------------------------*03470016
034800                                                                  03480016
034900 2000-PROCESS-PANEL.                                              03490016
035000                                                                  03500016
035100     MOVE ASC-HOLD-INTER-APPL      TO  INTER-APPL-COMM-AREA.      03510016
035200     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      03520016
035300                                                                  03530016
035400     EVALUATE TRUE                                                03540016
035500                                                                  03550016
035600         WHEN DP020-SRC-AID = DP016-CLEAR                         03560016
035700              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  03570016
035800              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03580016
035900                                                                  03590016
036000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03600016
036100              MOVE SPACES          TO  ASC-SPECIFIC-COMMAREA      03610016
036200              PERFORM 4000-BUILD-INITIAL-PANEL                    03620016
036300              PERFORM 3200-RESET-ATTRIBUTES                       03630016
036400                                                                  03640016
036500         WHEN OTHER                                               03650016
036600              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                03660016
036700              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  03670016
036800              IF  PS-NO-ERROR                                     03680016
036900                  SET DP030-CONTINUE-GO                           03690016
037000                                   TO  TRUE                       03700016
037100                  PERFORM 2100-CHECK-FUNCTION-KEY                 03710016
037200              ELSE                                                03720016
037300                  SET DP030-OVERRIDE-GO                           03730016
037400                                   TO  TRUE                       03740016
037500             END-IF                                               03750016
037600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03760016
037700     END-EVALUATE.                                                03770016
037800*----------------------------------------------------------------*03780016
037900*  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED      *03790016
038000*  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED  *03800016
038100*  FROM THE CICS ARCHITECTURE API.                               *03810016
038200*----------------------------------------------------------------*03820016
038300                                                                  03830016
038400 2100-CHECK-FUNCTION-KEY.                                         03840016
038500                                                                  03850016
038600     EVALUATE TRUE                                                03860016
038800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              03880017
038900         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03890017
038910         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              03891042
038920         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              03892042
038930         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              03893042
039000              PERFORM 2110-PREPARE-INTER-APPL-COMM                03900016
039100              MOVE INTER-APPL-COMM-AREA                           03910016
039200                                   TO  ASC-HOLD-INTER-APPL        03920016
039300              IF  PS-ERROR                                        03930016
039400                  SET DP030-OVERRIDE-GO                           03940016
039500                                   TO  TRUE                       03950016
039600              END-IF                                              03960016
039700                                                                  03970017
039800                                                                  03980016
039900         WHEN DP020-SRC-AID = DP016-ENTER                         03990016
040000              CONTINUE                                            04000016
040100                                                                  04010016
040200         WHEN OTHER                                               04020016
040300              SET DP013-NO-ROLLBACK                               04030016
040400                  DP013-XCTL-DISPLAY-RESTART                      04040016
040500                  DP013-CICS-ABEND TO  TRUE                       04050016
040600              MOVE '2100-CHECK-FUNCTION-KEY'                      04060016
040700                                   TO  DP013-PARAGRAPH            04070016
040800              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     04080016
040900                                   TO  DP013-MESSAGE-TEXT (1)     04090016
041000              PERFORM DP013-0000-PROCESS-ABEND                    04100016
041100     END-EVALUATE.                                                04110016
041200                                                                  04120016
041300*----------------------------------------------------------------*04130016
041400*  MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE    *04140016
041500*  INTER-APPLICATION COMMAREA.                                   *04150016
041600*----------------------------------------------------------------*04160016
041700                                                                  04170016
041800 2110-PREPARE-INTER-APPL-COMM.                                    04180016
041900                                                                  04190016
042000     MOVE ASC-PO-NBR-N         TO DK-PO-NBR.                      04200029
042100     MOVE ASC-REC-SEQ-NBR-N    TO DK-RCVR-NBR.                    04210029
042200     MOVE ASC-OPER-UNT-ID-N    TO DK-OPER-UNT-ID.                 04220029
042300     MOVE ASC-FCLTY-ID-N       TO DK-FCLTY-ID.                    04230029
042400                                                                  04240033
042500     PERFORM 2160-SELECT-MIN-TRECITM.                             04250030
042600     PERFORM 3120-SELECT-PREPACK-DATE.                            04260029
042700                                                                  04270029
042800     IF  DP020-SRC-AID EQUAL DP016-PF23 OR                        04280025
042900         DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                   04290025
043000         IF  ASC-STORE-NBR-N   NOT GREATER THAN ZERO              04300016
043100             SET PS-ERROR                                         04310016
043200                 DP020-MSG-FATAL   TO TRUE                        04320016
043300             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            04330016
043400             MOVE DP015-UNP-NUM-BRT-OFF                           04340016
043500                                   TO ASTRNBRA                    04350016
043600             MOVE DP015-RED        TO ASTRNBRC                    04360016
043700             MOVE DP015-REVERSE    TO ASTRNBRH                    04370016
043800             MOVE -1               TO ASTRNBRL                    04380016
043900             MOVE ZERO             TO AOPERL                      04390016
044000         END-IF                                                   04400016
044100                                                                  04410016
044200*        IF  ASC-PO-LINE-NBR-N NOT GREATER THAN ZERO              04420016
044300*            SET PS-ERROR                                         04430016
044400*                DP020-MSG-FATAL   TO TRUE                        04440016
044500*            MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            04450016
044600*            MOVE DP015-UNP-NUM-BRT-OFF                           04460016
044700*                                  TO APOLNBRA                    04470016
044800*            MOVE DP015-RED        TO APOLNBRC                    04480016
044900*            MOVE DP015-REVERSE    TO APOLNBRH                    04490016
045000*            MOVE -1               TO APOLNBRL                    04500016
045100*            MOVE ZERO             TO AOPERL                      04510016
045200*        END-IF                                                   04520016
045300     END-IF.                                                      04530016
045400                                                                  04540016
045500     IF  DP020-SRC-AID EQUAL DP016-PF22 OR                        04550016
045600         DP020-SRC-AID EQUAL DP016-PF23 OR                        04560017
045700         DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR                04570017
045800         DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                   04580018
045900         MOVE ZERO TO PV-DB2-COUNT                                04590016
046000         MOVE ASC-PO-NBR-N         TO DK-PO-NBR                   04600016
046100         MOVE ASC-REC-SEQ-NBR-N    TO DK-RCVR-NBR                 04610016
046200         MOVE ASC-OPER-UNT-ID-N    TO DK-OPER-UNT-ID              04620016
046300         MOVE ASC-FCLTY-ID-N       TO DK-FCLTY-ID                 04630016
046400                                                                  04640016
046500         MOVE ASC-REC-SEQ-NBR-N    TO RC012-REC-SEQ-NBR           04650043
046510                                      RC017-REC-SEQ-NBR           04651043
046600         PERFORM 2150-SELECT-TRECEIV                              04660016
046700         IF PV-DB2-COUNT > ZERO                                   04670016
046800             SET PS-ERROR                                         04680016
046900                 DP020-MSG-FATAL   TO TRUE                        04690016
047000             MOVE PC-TSYMSG-01057  TO DP020-MSG-NUMBER            04700016
047100             MOVE DP015-UNP-NUM-BRT-OFF                           04710016
047200                                   TO ARCNBRA                     04720016
047300             MOVE DP015-RED        TO ARCNBRC                     04730016
047400             MOVE DP015-REVERSE    TO ARCNBRH                     04740016
047500             MOVE -1               TO ARCNBRL                     04750016
047600         ELSE                                                     04760016
047700             MOVE ZERO TO PV-DB2-COUNT                            04770016
047800             PERFORM 2170-SELECT-TSHIPMT                          04780016
047900             IF PV-DB2-COUNT > ZERO                               04790016
048000                 SET PS-ERROR                                     04800016
048100                     DP020-MSG-FATAL   TO TRUE                    04810016
048200                 MOVE PC-TSYMSG-01058  TO DP020-MSG-NUMBER        04820016
048300                 MOVE DP015-UNP-NUM-BRT-OFF                       04830016
048400                                       TO ARCNBRA                 04840016
048500                 MOVE DP015-RED        TO ARCNBRC                 04850016
048600                 MOVE DP015-REVERSE    TO ARCNBRH                 04860016
048700                 MOVE -1               TO ARCNBRL                 04870016
048800             END-IF                                               04880016
048900         END-IF                                                   04890016
049000     END-IF.                                                      04900016
049100                                                                  04910016
049210     IF (DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID) OR                04921042
049220         DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID) )                 04922042
049300         IF ASC-PREPACK AND                                       04930036
049400            ASC-NEW-PREPACK                                       04940036
049500             SET PS-ERROR                                         04950026
049600                 DP020-MSG-FATAL   TO TRUE                        04960026
049700             MOVE PC-TSYMSG-03055  TO DP020-MSG-NUMBER            04970038
049800             MOVE DP015-UNP-NUM-BRT-OFF                           04980026
049900                                   TO ASTRNBRA                    04990026
050000             MOVE DP015-RED        TO ASTRNBRC                    05000026
050100             MOVE DP015-REVERSE    TO ASTRNBRH                    05010026
050200             MOVE -1               TO ASTRNBRL                    05020026
050300             MOVE ZERO             TO AOPERL                      05030026
050400         END-IF                                                   05040037
050500     END-IF.                                                      05050026
050600                                                                  05060026
050700     IF (DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) OR                05070026
050800         DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID) )                 05080037
050900         IF ASC-PREPACK AND                                       05090037
051000            ASC-OLD-PREPACK                                       05100038
051100             SET PS-ERROR                                         05110037
051200                 DP020-MSG-FATAL   TO TRUE                        05120037
051300             MOVE PC-TSYMSG-03074  TO DP020-MSG-NUMBER            05130038
051400             MOVE DP015-UNP-NUM-BRT-OFF                           05140037
051500                                   TO ASTRNBRA                    05150037
051600             MOVE DP015-RED        TO ASTRNBRC                    05160037
051700             MOVE DP015-REVERSE    TO ASTRNBRH                    05170037
051800             MOVE -1               TO ASTRNBRL                    05180037
051900             MOVE ZERO             TO AOPERL                      05190037
052000         ELSE                                                     05200038
052100             IF NOT ASC-PREPACK                                   05210038
052200                 SET PS-ERROR                                     05220038
052300                     DP020-MSG-FATAL   TO TRUE                    05230038
052400                 MOVE PC-TSYMSG-03056  TO DP020-MSG-NUMBER        05240038
052500                 MOVE DP015-UNP-NUM-BRT-OFF                       05250038
052600                                       TO ASTRNBRA                05260038
052700                 MOVE DP015-RED        TO ASTRNBRC                05270038
052800                 MOVE DP015-REVERSE    TO ASTRNBRH                05280038
052900                 MOVE -1               TO ASTRNBRL                05290038
053000                 MOVE ZERO             TO AOPERL                  05300038
053100             END-IF                                               05310038
053200         END-IF                                                   05320038
053300     END-IF.                                                      05330038
053400                                                                  05340018
053500     MOVE ASC-OPER-UNT-ID-N        TO  RC012-OPER-UNT-ID          05350043
053510                                       RC017-OPER-UNT-ID.         05351043
053600     MOVE ASC-FCLTY-ID-N           TO  RC012-FCLTY-ID             05360043
053610                                       RC017-FCLTY-ID.            05361043
053700     MOVE ASC-FACILITY-NAME        TO  RC012-FCLTY-NME            05370043
053710                                       RC017-FCLTY-NME.           05371043
053800     MOVE ASC-PO-NBR-N             TO  RC012-PO-NBR               05380043
053900                                       RC017-PO-NBR.              05390043
054000     MOVE ASC-REC-SEQ-NBR-N        TO  RC012-REC-SEQ-NBR          05400043
054010                                       RC017-REC-SEQ-NBR.         05401043
054100     MOVE ASC-PO-LINE-NBR-N        TO  RC012-PO-LNE-NBR           05410043
054110                                       RC017-PO-LNE-NBR.          05411043
054200     MOVE ASC-STORE-NBR-N          TO  RC012-STR-NBR              05420043
054210                                       RC017-STR-NBR.             05421043
054300                                                                  05430016
054400 2150-SELECT-TRECEIV.                                             05440016
054500                                                                  05450016
054600         EXEC SQL                                                 05460016
054700              SELECT COUNT(*)                                     05470016
054800                INTO :PV-DB2-COUNT :PV-NULL-IND                   05480016
054900                FROM TRECEIV                                      05490016
055000               WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID             05500016
055100                 AND FCLTY_ID       = :DK-FCLTY-ID                05510016
055200                 AND ORD_NBR        = :DK-PO-NBR                  05520016
055300                 AND REC_SEQ_NBR    = :DK-RCVR-NBR                05530016
055400                 AND VER_STATUS_CDE = 'A'                         05540016
055500                 AND REC_TMST       = :PC-DEFAULT-TMST            05550016
055600         END-EXEC.                                                05560016
055700                                                                  05570016
055800         EVALUATE TRUE                                            05580016
055900             WHEN SQLCODE = +0                                    05590016
056000             WHEN SQLCODE = +100                                  05600016
056100                  CONTINUE                                        05610016
056200             WHEN SQLCODE = -904                                  05620016
056300             WHEN SQLCODE = -911                                  05630016
056400             WHEN SQLCODE = -913                                  05640016
056500                  PERFORM 9900-SOFT-ABORT                         05650016
056600                                                                  05660016
056700             WHEN SQLWARN0 NOT = SPACES                           05670016
056800             WHEN SQLCODE < +0                                    05680016
056900             WHEN SQLCODE > +0                                    05690016
057000                  MOVE '2150-SELECT-TRECEIV'                      05700016
057100                                  TO DP013-PARAGRAPH              05710016
057200                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         05720016
057300                                  TO DP013-MESSAGE-TEXT (1)       05730016
057400                  MOVE SQLCA      TO DP013-SQLCA                  05740016
057500                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     05750016
057600                  SET DP013-DB2-ABEND                             05760016
057700                      DP013-XCTL-DISPLAY-RESTART                  05770016
057800                                  TO TRUE                         05780016
057900                  PERFORM DP013-0000-PROCESS-ABEND                05790016
058000         END-EVALUATE.                                            05800016
058100                                                                  05810029
058200 2160-SELECT-MIN-TRECITM.                                         05820030
058300                                                                  05830029
058400     EXEC SQL                                                     05840029
058500          SELECT DISTINCT                                         05850029
058600                MIN (LAST_TRSCP_TMST)                             05860029
058700          INTO                                                    05870029
058800                :RECITM-LAST-TRSCP-TMST                           05880029
058900          FROM                                                    05890029
059000                TRECITM                                           05900029
059100          WHERE                                                   05910029
059200                ORD_NBR            =  :DK-PO-NBR                  05920029
059300          AND   REC_SEQ_NBR        =  :DK-RCVR-NBR                05930029
059400          AND   OPER_UNT_ID        =  :DK-OPER-UNT-ID             05940029
059500          AND   FCLTY_ID           =  :DK-FCLTY-ID                05950029
059600          AND   VER_STATUS_CDE     =  'A'                         05960029
059700     END-EXEC.                                                    05970029
059800                                                                  05980029
059900     EVALUATE TRUE                                                05990029
060000         WHEN SQLCODE = ZERO                                      06000029
060100         WHEN SQLCODE = +100                                      06010029
060200              CONTINUE                                            06020029
060300         WHEN SQLCODE = -305                                      06030034
060400             MOVE PC-LOW-TMST         TO RECITM-LAST-TRSCP-TMST   06040034
060500         WHEN SQLCODE = -904                                      06050034
060600         WHEN SQLCODE = -911                                      06060029
060700         WHEN SQLCODE = -913                                      06070029
060800              PERFORM 9900-SOFT-ABORT                             06080029
060900         WHEN SQLWARN0 NOT = SPACE                                06090029
061000         WHEN SQLCODE NOT = ZERO                                  06100029
061100              MOVE '2160-SELECT-MIN-TRECITM'                      06110031
061200                               TO DP013-PARAGRAPH                 06120029
061300              MOVE 'SELECT MAX LAST-TRSCP-TMST ROW'               06130029
061400                               TO DP013-MESSAGE-TEXT (1)          06140029
061500              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             06150029
061600              MOVE DK-RCVR-NBR      TO PV-DISP-REC-SEQ-NBR        06160030
061700              MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID        06170029
061800              MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID           06180029
061900              STRING ' PO = '                                     06190029
062000                     PV-DISP-PO-NBR                               06200029
062100                     ' RECV ='                                    06210029
062200                     PV-DISP-REC-SEQ-NBR                          06220029
062300                     ' OPER ='                                    06230029
062400                     PV-DISP-OPER-UNT-ID                          06240029
062500                     ' FCLTY ='                                   06250029
062600                     PV-DISP-FCLTY-ID                             06260029
062700                                         DELIMITED BY SIZE        06270029
062800                              INTO DP013-MESSAGE-TEXT (2)         06280029
062900              MOVE SQLCA        TO DP013-SQLCA                    06290029
063000              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        06300029
063100              MOVE SQLCA       TO DP013-SQLCA                     06310029
063200              SET DP013-DB2-ABEND                                 06320029
063300                               TO TRUE                            06330029
063400              PERFORM DP013-0000-PROCESS-ABEND                    06340029
063500     END-EVALUATE.                                                06350029
063600/                                                                 06360016
063700                                                                  06370016
063800*----------------------------------------------------------------*06380016
063900*    COUNT THE NUMBER OF SHIPMENTS WITH PRO= SPACES              *06390016
064000*----------------------------------------------------------------*06400016
064100 2170-SELECT-TSHIPMT.                                             06410016
064200                                                                  06420016
064300**   PERFORM                                                      06430016
064400**       WITH TEST AFTER                                          06440016
064500**       VARYING PV-RETRY-COUNTER                                 06450016
064600**       FROM 1 BY 1                                              06460016
064700**       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06470016
064800**           OR (SQLCODE = +0)                                    06480016
064900**           OR (SQLCODE = +100))                                 06490016
065000                                                                  06500016
065100         EXEC SQL                                                 06510016
065200              SELECT COUNT(*)                                     06520016
065300                INTO :PV-DB2-COUNT                                06530016
065400                FROM TSHIPMT A,                                   06540016
065500                     TSHPTPO B                                    06550016
065600               WHERE B.PO_NBR      = :DK-PO-NBR                   06560016
065700                 AND B.REC_SEQ_NBR = :DK-RCVR-NBR                 06570016
065800                 AND A.SHIPT_ID    = B.SHIPT_ID                   06580016
065900                 AND A.PRO_NBR     = :PC-SPACES                   06590016
066000         END-EXEC                                                 06600016
066100                                                                  06610016
066200         EVALUATE TRUE                                            06620016
066300             WHEN SQLCODE = +0                                    06630016
066400             WHEN SQLCODE = +100                                  06640016
066500                  CONTINUE                                        06650016
066600             WHEN SQLCODE = -904                                  06660016
066700             WHEN SQLCODE = -911                                  06670016
066800             WHEN SQLCODE = -913                                  06680016
066900                  PERFORM 9900-SOFT-ABORT                         06690016
067000                                                                  06700016
067100             WHEN SQLWARN0 NOT = SPACES                           06710016
067200             WHEN SQLCODE < +0                                    06720016
067300             WHEN SQLCODE > +0                                    06730016
067400                  MOVE '2170-SELECT-TSHIPMT'                      06740016
067500                                  TO DP013-PARAGRAPH              06750016
067600                  MOVE 'UNSUCCESSFUL COUNT OF TSHIPMT TABLE'      06760016
067700                                  TO DP013-MESSAGE-TEXT (1)       06770016
067800                  MOVE SQLCA      TO DP013-SQLCA                  06780016
067900                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     06790016
068000                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (2)     06800016
068100                  SET DP013-DB2-ABEND                             06810016
068200                      DP013-XCTL-DISPLAY-RESTART                  06820016
068300                                  TO TRUE                         06830016
068400                  PERFORM DP013-0000-PROCESS-ABEND                06840016
068500         END-EVALUATE.                                            06850016
068600**   END-PERFORM.                                                 06860016
068700                                                                  06870016
068800**   IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06880016
068900**       MOVE '2170-SELECT-TSHIPMT'                               06890016
069000**                                TO DP013-PARAGRAPH              06900016
069100**       MOVE 'MAX RETRIES EXCEEDED ON COUNT TSHIPMT TABLE'       06910016
069200**                                TO DP013-MESSAGE-TEXT (1)       06920016
069300**       MOVE SQLCA               TO DP013-SQLCA                  06930016
069400**       MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     06940016
069500**       MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (2)     06950016
069600**       SET DP013-DB2-ABEND                                      06960016
069700**           DP013-XCTL-DISPLAY-RESTART                           06970016
069800**                                TO TRUE                         06980016
069900**       PERFORM DP013-0000-PROCESS-ABEND                         06990016
070000**   END-IF.                                                      07000016
070100                                                                  07010016
070200/                                                                 07020016
070300*----------------------------------------------------------------*07030016
070400* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*07040016
070500* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *07050016
070600* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *07060016
070700*----------------------------------------------------------------*07070016
070800                                                                  07080016
070900 2200-MOVE-SCREEN-TO-COMMAREA.                                    07090016
071000                                                                  07100016
071100     IF  AOPERL > ZERO                                            07110016
071200         MOVE AOPERI               TO ASC-OPER-UNT-ID             07120016
071300     ELSE                                                         07130016
071400         IF  AOPERF = DP015-ERASE-EOF                             07140016
071500             MOVE SPACES           TO ASC-OPER-UNT-ID             07150016
071600         END-IF                                                   07160016
071700     END-IF.                                                      07170016
071800                                                                  07180016
072700     IF  APONBRL > ZERO                                           07270016
072800         MOVE APONBRI              TO  ASC-PO-NBR                 07280016
072900     ELSE                                                         07290016
073000         IF  APONBRF = DP015-ERASE-EOF                            07300016
073100             MOVE SPACES           TO  ASC-PO-NBR                 07310016
073200         END-IF                                                   07320016
073300     END-IF.                                                      07330016
073400                                                                  07340016
073500     IF  ARCNBRL  > ZERO                                          07350016
073600         MOVE ARCNBRI              TO ASC-REC-SEQ-NBR             07360016
073700     ELSE                                                         07370016
073800         IF  ARCNBRF  = DP015-ERASE-EOF                           07380016
073900             MOVE SPACES           TO ASC-REC-SEQ-NBR             07390016
074000         END-IF                                                   07400016
074100     END-IF.                                                      07410016
074200                                                                  07420016
074300     IF  APOLNBRL > ZERO                                          07430016
074400         MOVE APOLNBRI             TO ASC-PO-LINE-NBR             07440016
074500     ELSE                                                         07450016
074600         IF  APOLNBRF = DP015-ERASE-EOF                           07460016
074700             MOVE SPACES           TO ASC-PO-LINE-NBR             07470016
074800         END-IF                                                   07480016
074900     END-IF.                                                      07490016
075000                                                                  07500016
075100     IF  ASTRNBRL > ZERO                                          07510016
075200         MOVE ASTRNBRI             TO ASC-STORE-NBR               07520016
075300     ELSE                                                         07530016
075400         IF  ASTRNBRF = DP015-ERASE-EOF                           07540016
075500             MOVE SPACES           TO ASC-STORE-NBR               07550016
075600         END-IF                                                   07560016
075700     END-IF.                                                      07570016
075800                                                                  07580016
075900*----------------------------------------------------------------*07590016
076000* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *07600016
076100* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *07610016
076200* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*07620016
076300* IN THE DESTINATION PROGRAM, NOT HERE.                          *07630016
076400*----------------------------------------------------------------*07640016
076500                                                                  07650016
076600 3000-EDIT-DATA-IN-COMMAREA.                                      07660016
076700                                                                  07670016
076800     PERFORM 3200-RESET-ATTRIBUTES.                               07680016
076900     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07690016
077000                                                                  07700016
077100     IF  ASC-STORE-NBR GREATER THAN SPACES                        07710016
077200         MOVE ASC-STORE-NBR        TO DP010I-UNEDITED-FIELD       07720016
077300         MOVE LENGTH OF ASC-STORE-NBR                             07730016
077400                                   TO DP010I-MAXIMUM-DIGITS       07740016
077500         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07750016
077600         SET DP010I-NEGATIVE-NOT-ALLOWED                          07760016
077700                                   TO TRUE                        07770016
077800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07780060
077810              USING DP010I-NUMERIC-EDIT-AREA                      07781060
077900                                                                  07790016
078000         IF  DP010I-ERROR-DETECTED                                07800016
078100             SET PS-ERROR                                         07810016
078200                 DP020-MSG-FATAL   TO TRUE                        07820016
078300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07830016
078400             MOVE DP015-UNP-NUM-BRT-OFF                           07840016
078500                                   TO ASTRNBRA                    07850016
078600             MOVE DP015-RED        TO ASTRNBRC                    07860016
078700             MOVE DP015-REVERSE    TO ASTRNBRH                    07870016
078800             MOVE -1               TO ASTRNBRL                    07880016
078900         ELSE                                                     07890016
079000             MOVE DP010I-NUMERIC-FIELD                            07900016
079100                                   TO ASC-STORE-NBR-N             07910016
079200         END-IF                                                   07920016
079300     END-IF.                                                      07930016
079400                                                                  07940016
079500     IF  ASC-PO-LINE-NBR GREATER THAN SPACES                      07950016
079600         MOVE ASC-PO-LINE-NBR      TO DP010I-UNEDITED-FIELD       07960016
079700         MOVE LENGTH OF ASC-PO-LINE-NBR                           07970016
079800                                   TO DP010I-MAXIMUM-DIGITS       07980016
079900         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07990016
080000         SET DP010I-NEGATIVE-NOT-ALLOWED                          08000016
080100                                   TO TRUE                        08010016
080200         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08020060
080210              USING DP010I-NUMERIC-EDIT-AREA                      08021060
080300                                                                  08030016
080400         IF  DP010I-ERROR-DETECTED                                08040016
080500             SET PS-ERROR                                         08050016
080600                 DP020-MSG-FATAL   TO TRUE                        08060016
080700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08070016
080800             MOVE DP015-UNP-NUM-BRT-OFF                           08080016
080900                                   TO APOLNBRA                    08090016
081000             MOVE DP015-RED        TO APOLNBRC                    08100016
081100             MOVE DP015-REVERSE    TO APOLNBRH                    08110016
081200             MOVE -1               TO APOLNBRL                    08120016
081300         ELSE                                                     08130016
081400             MOVE DP010I-NUMERIC-FIELD                            08140016
081500                                   TO ASC-PO-LINE-NBR-N           08150016
081600         END-IF                                                   08160016
081700     END-IF.                                                      08170016
081800                                                                  08180016
081900     IF  ASC-REC-SEQ-NBR > SPACES                                 08190016
082000         MOVE ASC-REC-SEQ-NBR      TO DP010I-UNEDITED-FIELD       08200016
082100         MOVE LENGTH OF ASC-REC-SEQ-NBR                           08210016
082200                                   TO DP010I-MAXIMUM-DIGITS       08220016
082300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08230016
082400         SET DP010I-NEGATIVE-NOT-ALLOWED                          08240016
082500                                   TO TRUE                        08250016
082600         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08260060
082610              USING DP010I-NUMERIC-EDIT-AREA                      08261060
082700                                                                  08270016
082800         IF  DP010I-ERROR-DETECTED                                08280016
082900             SET PS-ERROR                                         08290016
083000                 DP020-MSG-FATAL   TO TRUE                        08300016
083100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08310016
083200             MOVE DP015-UNP-NUM-BRT-OFF                           08320016
083300                                   TO ARCNBRA                     08330016
083400             MOVE DP015-RED        TO ARCNBRC                     08340016
083500             MOVE DP015-REVERSE    TO ARCNBRH                     08350016
083600             MOVE -1               TO ARCNBRL                     08360016
083700         ELSE                                                     08370016
083800             MOVE DP010I-NUMERIC-FIELD                            08380016
083900                                   TO ASC-REC-SEQ-NBR-N           08390016
084000         END-IF                                                   08400016
084100     ELSE                                                         08410016
084200         SET PS-ERROR                                             08420016
084300             DP020-MSG-FATAL       TO TRUE                        08430016
084400         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            08440016
084500         MOVE DP015-UNP-NUM-BRT-OFF                               08450016
084600                                   TO ARCNBRA                     08460016
084700         MOVE DP015-RED            TO ARCNBRC                     08470016
084800         MOVE DP015-REVERSE        TO ARCNBRH                     08480016
084900         MOVE -1                   TO ARCNBRL                     08490016
085000     END-IF.                                                      08500016
085100                                                                  08510016
085200     IF  ASC-PO-NBR > SPACES                                      08520016
085300         MOVE ASC-PO-NBR           TO DP010I-UNEDITED-FIELD       08530016
085400         MOVE LENGTH OF ASC-PO-NBR TO DP010I-MAXIMUM-DIGITS       08540016
085500         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08550016
085600         SET DP010I-NEGATIVE-NOT-ALLOWED                          08560016
085700                                   TO TRUE                        08570016
085800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08580060
085810              USING DP010I-NUMERIC-EDIT-AREA                      08581060
085900                                                                  08590016
086000         IF  DP010I-ERROR-DETECTED                                08600016
086100             SET PS-ERROR                                         08610016
086200                 DP020-MSG-FATAL   TO TRUE                        08620016
086300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08630016
086400             MOVE DP015-UNP-NUM-BRT-OFF                           08640016
086500                                   TO APONBRA                     08650016
086600             MOVE DP015-RED        TO APONBRC                     08660016
086700             MOVE DP015-REVERSE    TO APONBRH                     08670016
086800             MOVE -1               TO APONBRL                     08680016
086900         ELSE                                                     08690016
087000             MOVE DP010I-NUMERIC-FIELD                            08700016
087100                                   TO ASC-PO-NBR-N                08710016
087200         END-IF                                                   08720016
087300     ELSE                                                         08730016
087400         SET PS-ERROR                                             08740016
087500         DP020-MSG-FATAL           TO TRUE                        08750016
087600         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            08760016
087700         MOVE DP015-UNP-NUM-BRT-OFF                               08770016
087800                                   TO APONBRA                     08780016
087900         MOVE DP015-RED            TO APONBRC                     08790016
088000         MOVE DP015-REVERSE        TO APONBRH                     08800016
088100         MOVE -1                   TO APONBRL                     08810016
088200     END-IF.                                                      08820016
088300                                                                  08830016
091800                                                                  09180016
091900     IF  ASC-OPER-UNT-ID > SPACES                                 09190016
092000         MOVE ASC-OPER-UNT-ID      TO DP010I-UNEDITED-FIELD       09200016
092100         MOVE LENGTH OF ASC-OPER-UNT-ID                           09210016
092200                                   TO DP010I-MAXIMUM-DIGITS       09220016
092300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     09230016
092400         SET DP010I-NEGATIVE-NOT-ALLOWED                          09240016
092500                                   TO TRUE                        09250016
092600         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09260060
092610              USING DP010I-NUMERIC-EDIT-AREA                      09261060
092700                                                                  09270016
092800         IF  DP010I-ERROR-DETECTED                                09280016
092900             SET PS-ERROR                                         09290016
093000                 DP020-MSG-FATAL   TO TRUE                        09300016
093100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09310016
093200             MOVE DP015-UNP-NUM-BRT-OFF                           09320016
093300                                   TO AOPERA                      09330016
093400             MOVE DP015-RED        TO AOPERC                      09340016
093500             MOVE DP015-REVERSE    TO AOPERH                      09350016
093600             MOVE -1               TO AOPERL                      09360016
093700             SET DP030-SET-CURSOR-APPL-1                          09370016
093800                                   TO TRUE                        09380016
093900         ELSE                                                     09390016
094000             MOVE DP010I-NUMERIC-FIELD                            09400016
094100                                   TO ASC-OPER-UNT-ID-N           09410016
094200         END-IF                                                   09420016
094300     ELSE                                                         09430016
094400         SET PS-ERROR                                             09440016
094500             DP020-MSG-FATAL       TO TRUE                        09450016
094600         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            09460016
094700         MOVE DP015-UNP-NUM-BRT-OFF                               09470016
094800                                   TO AOPERA                      09480016
094900         MOVE DP015-RED            TO AOPERC                      09490016
095000         MOVE DP015-REVERSE        TO AOPERH                      09500016
095100         MOVE -1                   TO AOPERL                      09510016
095200     END-IF.                                                      09520016
095300                                                                  09530016
095400     IF (AOPERC  EQUAL DP015-RED)                                 09540047
095600         CONTINUE                                                 09560016
095700     ELSE                                                         09570016
095800         PERFORM 3100-VALIDATE-OPER-FCLTY                         09580016
095900     END-IF.                                                      09590016
096000                                                                  09600016
096100     IF  PS-NO-ERROR                                              09610016
096200         MOVE -1                   TO APONBRL                     09620016
096300     END-IF.                                                      09630016
096400                                                                  09640016
096500     IF  PS-NO-ERROR                                              09650016
096600         MOVE ASC-PO-NBR-N TO DK-PO-NBR                           09660016
096700         INITIALIZE PV-DB2-COUNT                                  09670016
096800         MOVE 4              TO DK-AGRMT-TYP-ID                   09680016
096900         MOVE 4              TO DK-TYP-CDE                        09690016
097000         PERFORM 3110-CHECK-FOR-PACK-BY-STORE                     09700016
097100         IF PV-DB2-COUNT > +0                                     09710016
097200             SET             RC012-PACK-BY-STORE TO TRUE          09720016
097201             SET             RC017-PACK-BY-STORE TO TRUE          09720144
097300         ELSE                                                     09730016
097400             SET             RC012-NOT-PACK-BY-STORE TO TRUE      09740016
097410             SET             RC017-NOT-PACK-BY-STORE TO TRUE      09741044
097500         END-IF                                                   09750016
097600     END-IF.                                                      09760016
097700     IF  PS-NO-ERROR                                              09770017
097800         MOVE ASC-PO-NBR-N         TO DK-PO-NBR                   09780017
097900         MOVE ASC-REC-SEQ-NBR-N    TO DK-RCVR-NBR                 09790017
098000         MOVE ASC-OPER-UNT-ID-N    TO DK-OPER-UNT-ID              09800017
098100         MOVE ASC-FCLTY-ID-N       TO DK-FCLTY-ID                 09810017
098200                                                                  09820017
098300         PERFORM 3050-SELECT-TRECEIV                              09830017
098400         IF SQLCODE = +100                                        09840017
098500             MOVE SPACES           TO APKGTYPO                    09850017
098510             SET PS-ERROR                                         09851039
098520                 DP020-MSG-FATAL   TO TRUE                        09852039
098530             MOVE PC-TSYMSG-00954  TO DP020-MSG-NUMBER            09853039
098540             MOVE DP015-UNP-NUM-BRT-OFF                           09854039
098550                                   TO APONBRA                     09855039
098551                                      ARCNBRA                     09855139
098560             MOVE DP015-RED        TO APONBRC                     09856039
098561                                      ARCNBRC                     09856139
098570             MOVE DP015-REVERSE    TO APONBRH                     09857039
098571                                      ARCNBRH                     09857139
098580             MOVE -1               TO APONBRL                     09858039
098600         ELSE                                                     09860017
098700             IF RECEIV-PACK-BY-ST-IND = 'Y'                       09870017
098800                 MOVE '(PBS)'          TO APKGTYPO                09880018
098900                 SET ASC-PACK-BY-STORE TO TRUE                    09890018
099000             ELSE                                                 09900017
099100             IF RECEIV-PKGNG-CDE = 'M'                            09910041
099200                 MOVE '(MULTI) '       TO APKGTYPO                09920041
099300                 SET ASC-PREPACK TO TRUE                          09930041
099310             ELSE                                                 09931041
099320             IF RECEIV-PKGNG-CDE = 'I'                            09932041
099330                 MOVE '(INNER)'       TO APKGTYPO                 09933041
099340                 SET ASC-PREPACK TO TRUE                          09934041
099350             ELSE                                                 09935041
099360             IF RECEIV-PKGNG-CDE = 'B'                            09936041
099370                 MOVE '(BULK)'        TO APKGTYPO                 09937041
099380                 SET ASC-BULK    TO TRUE                          09938041
099390             ELSE                                                 09939041
099391             IF RECEIV-PKGNG-CDE = 'C'                            09939141
099392                 MOVE '(CASE)'        TO APKGTYPO                 09939241
099393                 SET ASC-BULK    TO TRUE                          09939341
099394             ELSE                                                 09939441
099395             IF RECEIV-PKGNG-CDE = 'S'                            09939541
099396                 MOVE '(SINGLE)'      TO APKGTYPO                 09939641
099397                 SET ASC-BULK    TO TRUE                          09939741
099400             ELSE                                                 09940041
099500                 MOVE '(BULK)'         TO APKGTYPO                09950041
099600                 SET ASC-BULK    TO TRUE                          09960041
099700             END-IF                                               09970041
099800             END-IF                                               09980026
099810             END-IF                                               09981041
099820             END-IF                                               09982041
099830             END-IF                                               09983041
099840             END-IF                                               09984041
099900         END-IF                                                   09990026
100000     END-IF.                                                      10000026
100100                                                                  10010026
100110* DMH 08/23/17 BEGIN                                              10011054
100111     IF  PS-NO-ERROR                                              10011154
100112         IF  DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)               10011254
100114             IF  ASC-PO-NBR-N       >  0  AND                     10011454
100116                 ASC-REC-SEQ-NBR-N  >  0  AND                     10011654
100118                 ASC-PO-LINE-NBR-N  >  0  AND                     10011854
100120                 ASC-STORE-NBR-N    >  0                          10012054
100121                 PERFORM 3060-VALIDATE-PO-RCVR-LINE-STR           10012154
100122             ELSE                                                 10012254
100123                 IF  ASC-PO-NBR-N       >  0  AND                 10012354
100124                     ASC-REC-SEQ-NBR-N  >  0  AND                 10012454
100126                     ASC-STORE-NBR-N    >  0                      10012654
100127                     PERFORM 3070-VALIDATE-PO-RCVR-STR            10012754
100128                 END-IF                                           10012854
100129             END-IF                                               10012954
100130         END-IF                                                   10013054
100131     END-IF.                                                      10013154
100133                                                                  10013354
100134* DMH 08/23/17 END                                                10013454
100140                                                                  10014054
100150                                                                  10015054
100200 3050-SELECT-TRECEIV.                                             10020017
100300                                                                  10030017
100400         EXEC SQL                                                 10040017
100500              SELECT PKGNG_CDE                                    10050017
100600                   , PACK_BY_ST_IND                               10060017
100700                INTO :RECEIV-PKGNG-CDE                            10070017
100800                   , :RECEIV-PACK-BY-ST-IND                       10080017
100900                FROM TRECEIV                                      10090017
101000               WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID             10100017
101100                 AND FCLTY_ID       = :DK-FCLTY-ID                10110017
101200                 AND ORD_NBR        = :DK-PO-NBR                  10120017
101300                 AND REC_SEQ_NBR    = :DK-RCVR-NBR                10130017
101400                 AND VER_STATUS_CDE = 'A'                         10140017
101500         END-EXEC.                                                10150017
101600                                                                  10160017
101700         EVALUATE TRUE                                            10170017
101800             WHEN SQLCODE = +0                                    10180017
101900             WHEN SQLCODE = +100                                  10190017
102000                  CONTINUE                                        10200017
102100             WHEN SQLCODE = -904                                  10210017
102200             WHEN SQLCODE = -911                                  10220017
102300             WHEN SQLCODE = -913                                  10230017
102400                  PERFORM 9900-SOFT-ABORT                         10240017
102500                                                                  10250017
102600             WHEN SQLWARN0 NOT = SPACES                           10260017
102700             WHEN SQLCODE < +0                                    10270017
102800             WHEN SQLCODE > +0                                    10280017
102900                  MOVE '3050-SELECT-TRECEIV'                      10290017
103000                                  TO DP013-PARAGRAPH              10300017
103100                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         10310017
103200                                  TO DP013-MESSAGE-TEXT (1)       10320017
103300                  MOVE SQLCA      TO DP013-SQLCA                  10330017
103400                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     10340017
103500                  SET DP013-DB2-ABEND                             10350017
103600                      DP013-XCTL-DISPLAY-RESTART                  10360017
103700                                  TO TRUE                         10370017
103800                  PERFORM DP013-0000-PROCESS-ABEND                10380017
103900         END-EVALUATE.                                            10390017
104000                                                                  10400017
104001                                                                  10400154
104002*----------------------------------------------------------------*10400254
104003* VALIDATE THAT THE PO-RCVR-LINE-STR ARE A VALID COMBINATION     *10400354
104004* DMH 8/23/2017                                                  *10400454
104005*----------------------------------------------------------------*10400554
104010 3060-VALIDATE-PO-RCVR-LINE-STR.                                  10401054
104011                                                                  10401154
104012     MOVE ASC-PO-NBR-N       TO  DK-PO-NBR                        10401254
104013     MOVE ASC-REC-SEQ-NBR-N  TO  DK-RCVR-NBR                      10401354
104014     MOVE ASC-PO-LINE-NBR-N  TO  DK-LINE-NBR                      10401454
104015     MOVE ASC-STORE-NBR-N    TO  DK-STR-NBR                       10401554
104016                                                                  10401654
104017     EXEC SQL                                                     10401754
104018          SELECT  C.STR_NBR                                       10401854
104019            INTO :RECDIS-STR-NBR                                  10401954
104020            FROM TRECEIV A                                        10402054
104021               , TRECITM B                                        10402154
104022               , TRECDIS C                                        10402254
104023           WHERE A.ORD_NBR         = :DK-PO-NBR                   10402354
104024             AND A.REC_SEQ_NBR     = :DK-RCVR-NBR                 10402454
104025             AND A.VER_STATUS_CDE  = 'A'                          10402554
104026             AND A.ORD_NBR         =  B.ORD_NBR                   10402654
104027             AND A.REC_SEQ_NBR     =  B.REC_SEQ_NBR               10402754
104028             AND B.VER_STATUS_CDE  = 'A'                          10402854
104029             AND B.ORD_LNE_NBR     = :DK-LINE-NBR                 10402954
104030             AND B.ORD_NBR         =  C.ORD_NBR                   10403054
104031             AND B.ORD_LNE_NBR     =  C.ORD_LNE_NBR               10403154
104032             AND B.REC_SEQ_NBR     =  C.REC_SEQ_NBR               10403254
104034             AND C.STR_NBR         = :DK-STR-NBR                  10403454
104037     END-EXEC.                                                    10403754
104038                                                                  10403854
104039         EVALUATE TRUE                                            10403954
104040             WHEN SQLCODE = +0                                    10404054
104041                  CONTINUE                                        10404154
104042             WHEN SQLCODE = +100                                  10404254
104044                  SET PS-ERROR                                    10404454
104045                      DP020-MSG-FATAL   TO TRUE                   10404554
104046                  MOVE PC-TSYMSG-03797  TO DP020-MSG-NUMBER       10404654
104047                  MOVE DP015-UNP-NUM-BRT-OFF                      10404754
104050                                        TO APOLNBRA               10405057
104051                                           ASTRNBRA               10405154
104052                  MOVE DP015-RED                                  10405257
104054                                        TO APOLNBRC               10405457
104055                                           ASTRNBRC               10405554
104056                  MOVE DP015-REVERSE                              10405657
104058                                        TO APOLNBRH               10405857
104059                                           ASTRNBRH               10405954
104060                  MOVE -1               TO ASTRNBRL               10406054
104061                                                                  10406154
104062             WHEN SQLCODE = -904                                  10406254
104063             WHEN SQLCODE = -911                                  10406354
104064             WHEN SQLCODE = -913                                  10406454
104065                  PERFORM 9900-SOFT-ABORT                         10406554
104066                                                                  10406654
104067             WHEN SQLWARN0 NOT = SPACES                           10406754
104068             WHEN SQLCODE < +0                                    10406854
104069             WHEN SQLCODE > +0                                    10406954
104070                  MOVE '3060-VALIDATE-PO-RCVR-LINE-STR'           10407054
104071                                  TO DP013-PARAGRAPH              10407154
104072                  MOVE DK-PO-NBR    TO  PV-DISP-PO                10407254
104073                  MOVE DK-RCVR-NBR  TO  PV-DISP-RCVR              10407354
104074                  MOVE DK-LINE-NBR  TO  PV-DISP-LINE              10407454
104075                  MOVE DK-STR-NBR   TO  PV-DISP-STR               10407554
104076                  STRING  PV-DISP-PO   '-'                        10407654
104077                          PV-DISP-RCVR '-'                        10407754
104078                          PV-DISP-LINE '-'                        10407854
104079                          PV-DISP-STR  DELIMITED BY SIZE          10407954
104080                                INTO DP013-MESSAGE-TEXT (1)       10408054
104081                  MOVE SQLCA      TO DP013-SQLCA                  10408154
104082                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     10408254
104083                  MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (2)     10408354
104084                  MOVE 'TRECDIS ' TO DP013-DB2-TABLE-NAME (3)     10408454
104085                  SET DP013-DB2-ABEND                             10408554
104086                      DP013-XCTL-DISPLAY-RESTART                  10408654
104087                                  TO TRUE                         10408754
104088                  PERFORM DP013-0000-PROCESS-ABEND                10408854
104089         END-EVALUATE.                                            10408954
104090                                                                  10409054
104091                                                                  10409154
104094*----------------------------------------------------------------*10409454
104095* VALIDATE THAT THE PO-RCVR-STR ARE A VALID COMBINATION          *10409554
104096* DMH 8/23/2017                                                  *10409654
104097*----------------------------------------------------------------*10409754
104100 3070-VALIDATE-PO-RCVR-STR.                                       10410054
104101                                                                  10410154
104102     MOVE ASC-PO-NBR-N       TO  DK-PO-NBR                        10410254
104103     MOVE ASC-REC-SEQ-NBR-N  TO  DK-RCVR-NBR                      10410354
104105     MOVE ASC-STORE-NBR-N    TO  DK-STR-NBR                       10410554
104106                                                                  10410654
104107     EXEC SQL                                                     10410754
104108          SELECT  C.STR_NBR                                       10410854
104109            INTO :RECDIS-STR-NBR                                  10410954
104110            FROM TRECEIV A                                        10411054
104111               , TRECITM B                                        10411154
104112               , TRECDIS C                                        10411254
104113           WHERE A.ORD_NBR         = :DK-PO-NBR                   10411354
104114             AND A.REC_SEQ_NBR     = :DK-RCVR-NBR                 10411454
104115             AND A.VER_STATUS_CDE  = 'A'                          10411554
104116             AND A.ORD_NBR         =  B.ORD_NBR                   10411654
104117             AND A.REC_SEQ_NBR     =  B.REC_SEQ_NBR               10411754
104118             AND B.VER_STATUS_CDE  = 'A'                          10411854
104120             AND B.ORD_NBR         =  C.ORD_NBR                   10412054
104121             AND B.ORD_LNE_NBR     =  C.ORD_LNE_NBR               10412154
104122             AND B.REC_SEQ_NBR     =  C.REC_SEQ_NBR               10412254
104124             AND C.STR_NBR         = :DK-STR-NBR                  10412454
104125     END-EXEC.                                                    10412554
104126                                                                  10412654
104127         EVALUATE TRUE                                            10412754
104128             WHEN SQLCODE = +0                                    10412854
104129             WHEN SQLCODE = -811                                  10412958
104130                  CONTINUE                                        10413058
104131             WHEN SQLCODE = +100                                  10413158
104132                  SET PS-ERROR                                    10413258
104133                      DP020-MSG-FATAL   TO TRUE                   10413358
104134                  MOVE PC-TSYMSG-03798  TO DP020-MSG-NUMBER       10413458
104135                  MOVE DP015-UNP-NUM-BRT-OFF                      10413558
104138                                        TO ASTRNBRA               10413857
104139                  MOVE DP015-RED                                  10413957
104142                                        TO ASTRNBRC               10414257
104143                  MOVE DP015-REVERSE                              10414357
104146                                        TO ASTRNBRH               10414657
104147                  MOVE -1               TO ASTRNBRL               10414754
104148                                                                  10414854
104149             WHEN SQLCODE = -904                                  10414954
104150             WHEN SQLCODE = -911                                  10415054
104151             WHEN SQLCODE = -913                                  10415154
104152                  PERFORM 9900-SOFT-ABORT                         10415254
104153                                                                  10415354
104154             WHEN SQLWARN0 NOT = SPACES                           10415454
104155             WHEN SQLCODE < +0                                    10415554
104156             WHEN SQLCODE > +0                                    10415654
104157                  MOVE '3070-VALIDATE-PO-RCVR-STR'                10415754
104158                                  TO DP013-PARAGRAPH              10415854
104159                  MOVE DK-PO-NBR    TO  PV-DISP-PO                10415954
104160                  MOVE DK-RCVR-NBR  TO  PV-DISP-RCVR              10416054
104161                  MOVE DK-LINE-NBR  TO  PV-DISP-LINE              10416154
104162                  MOVE DK-STR-NBR   TO  PV-DISP-STR               10416254
104163                  STRING  PV-DISP-PO   '-'                        10416354
104164                          PV-DISP-RCVR                            10416454
104165                          ' STORE:'                               10416554
104166                          PV-DISP-STR  DELIMITED BY SIZE          10416654
104167                                INTO DP013-MESSAGE-TEXT (1)       10416754
104168                  MOVE SQLCA      TO DP013-SQLCA                  10416854
104169                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     10416954
104170                  MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (2)     10417054
104171                  MOVE 'TRECDIS ' TO DP013-DB2-TABLE-NAME (3)     10417154
104172                  SET DP013-DB2-ABEND                             10417254
104173                      DP013-XCTL-DISPLAY-RESTART                  10417354
104174                                  TO TRUE                         10417454
104175                  PERFORM DP013-0000-PROCESS-ABEND                10417554
104176         END-EVALUATE.                                            10417654
104179                                                                  10417954
104180                                                                  10418054
104190*----------------------------------------------------------------*10419054
104200*    ENSURE THE OPER ID AND FACILITY ARE VALID.                  *10420016
104300*----------------------------------------------------------------*10430016
104500 3100-VALIDATE-OPER-FCLTY.                                        10450016
104600                                                                  10460016
104610     INITIALIZE XL071-COMMAREA-REC.                               10461045
104620     MOVE ASC-OPER-UNT-ID-N          TO XL071-LOCATION-NUMBER.    10462045
104630                                                                  10463045
104640     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  10464045
104650                                        XL071-COMMAREA            10465045
104660                                        XL071-COMMAREA-REC.       10466045
104680                                                                  10468045
104681* * THERE IS LEGITIMATELY NO ROW ON XLT_DC_LOC_ASGMT              10468150
104682* * FOR CORPORATE                                                 10468250
104683     IF XL071-LOCATION-NUMBER =  90                               10468350
104684       AND XL071-DC-ASGMT-NOT-FND                                 10468450
104685         SET XL071-NO-ERRORS          TO TRUE                     10468550
104686     END-IF.                                                      10468650
104687                                                                  10468750
104690     EVALUATE TRUE                                                10469045
104691         WHEN XL071-NO-ERRORS                                     10469145
104692            MOVE  XL071-LOC-NM     TO ASC-FACILITY-NAME           10469246
104693         WHEN XL071-LOC-NOT-FOUND                                 10469345
104694            MOVE 'STORE NAME NOT FOUND' TO ASC-FACILITY-NAME      10469451
104695                                                                  10469551
104704         WHEN OTHER                                               10470445
104705            MOVE '3100-VALIDATE-OPER-FCLTY'                       10470546
104706                                   TO DP013-PARAGRAPH             10470645
104707            INITIALIZE PV-CICS-MSG-AREA                           10470745
104708            STRING ' RCKCS219 - CALL XLKUT071 -'                  10470845
104709                   ' SQLCODE=' XL071-SQLCODE                      10470945
104710                   ' TABLE='   XL071-DB2-TABLE                    10471045
104711                                            DELIMITED BY SIZE     10471145
104712                                       INTO PV-CICS-MSG-AREA      10471245
104713            PERFORM 9800-WRITE-CICS-LOG                           10471345
104714                                                                  10471445
104719     END-EVALUATE.                                                10471945
104720/                                                                 10472045
109400*----------------------------------------------------------------*10940016
109500*    CHECK FOR PACK BY STORE ORDER                               *10950016
109600*----------------------------------------------------------------*10960016
109700 3110-CHECK-FOR-PACK-BY-STORE.                                    10970016
109800                                                                  10980016
109900         EXEC SQL                                                 10990016
110000              SELECT COUNT(*)                                     11000016
110100                INTO :PV-DB2-COUNT                                11010016
110200                FROM TPOAGMT                                      11020016
110300               WHERE PO_NBR         = :DK-PO-NBR                  11030016
110400                 AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID            11040016
110500                 AND VER_STATUS_CDE = 'A'                         11050016
110600                 AND TYP_CDE        = :DK-TYP-CDE                 11060016
110700         END-EXEC                                                 11070016
110800                                                                  11080016
110900                                                                  11090016
111000     EVALUATE TRUE                                                11100016
111100         WHEN SQLCODE = ZERO                                      11110016
111200              CONTINUE                                            11120016
111300         WHEN SQLCODE = +100                                      11130016
111400              CONTINUE                                            11140016
111500         WHEN SQLCODE = -904                                      11150016
111600         WHEN SQLCODE = -913                                      11160016
111700              PERFORM 9900-SOFT-ABORT                             11170016
111800         WHEN SQLWARN0 NOT = SPACES                               11180016
111900         WHEN SQLCODE NOT EQUAL ZERO                              11190016
112000              MOVE '3110-CHECK-FOR-PACK-BY-STORE'                 11200016
112100                                   TO DP013-PARAGRAPH             11210016
112200              MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'       11220016
112300                                   TO DP013-MESSAGE-TEXT (1)      11230016
112400              MOVE SQLCA           TO DP013-SQLCA                 11240016
112500              MOVE 'TPOAGMT'       TO DP013-DB2-TABLE-NAME (1)    11250016
112600              SET DP013-DB2-ABEND                                 11260016
112700                 DP013-XCTL-DISPLAY-RESTART                       11270016
112800                                   TO TRUE                        11280016
112900              PERFORM DP013-0000-PROCESS-ABEND                    11290016
113000     END-EVALUATE.                                                11300016
113100                                                                  11310016
113200                                                                  11320026
113300***************************************************************** 11330026
113400 3120-SELECT-PREPACK-DATE.                                        11340026
113500                                                                  11350026
113600     EXEC SQL                                                     11360026
113700         SELECT FUNC_BEG_TMST                                     11370026
113800           INTO :KRPRPM-FUNC-BEG-TMST                             11380026
113900           FROM TKRPRPM                                           11390026
114000          WHERE SYS_PRC_FUNC_CDE  = 'PRPKDT'                      11400026
114100            AND LOC_ID            = 90                            11410026
114200            AND INTFC_SYS_CDE     = 'KHL'                         11420026
114300            AND FUNC_PRC_STAT_CDE = 'AC'                          11430026
114400     END-EXEC.                                                    11440026
114500                                                                  11450026
114600     EVALUATE SQLCODE                                             11460026
114700         WHEN ZERO                                                11470026
114800             IF RECITM-LAST-TRSCP-TMST                            11480029
114900                                   < KRPRPM-FUNC-BEG-TMST         11490029
115000                 SET ASC-OLD-PREPACK TO TRUE                      11500026
115100             ELSE                                                 11510026
115200                 SET ASC-NEW-PREPACK TO TRUE                      11520026
115300             END-IF                                               11530026
115400         WHEN OTHER                                               11540026
115500              MOVE '3120-SELECT-PREPACK-DATE'                     11550026
115600                               TO DP013-PARAGRAPH                 11560026
115700              MOVE 'SELECT CARTON BUILD IND'                      11570026
115800                               TO DP013-MESSAGE-TEXT (1)          11580026
115900              MOVE SQLCA       TO DP013-SQLCA                     11590026
116000              SET DP013-DB2-ABEND                                 11600026
116100                      DP013-XCTL-DISPLAY-RESTART                  11610028
116200                               TO TRUE                            11620026
116300              PERFORM DP013-0000-PROCESS-ABEND                    11630028
116400     END-EVALUATE.                                                11640026
116500                                                                  11650026
116600                                                                  11660026
116700*----------------------------------------------------------------*11670016
116800*  MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE  *11680016
116900*  MAP.                                                          *11690016
117000*----------------------------------------------------------------*11700016
117100                                                                  11710016
117200 3200-RESET-ATTRIBUTES.                                           11720016
117300                                                                  11730016
117400     MOVE DP015-UNP-NUM-NOR-OFF   TO  AOPERA                      11740016
117600                                      APONBRA                     11760016
117700                                      ARCNBRA                     11770016
117800                                      APOLNBRA                    11780016
117900                                      ASTRNBRA.                   11790016
118000                                                                  11800016
118100     MOVE DP015-GREEN             TO  AOPERC                      11810016
118300                                      APONBRC                     11830016
118400                                      ARCNBRC                     11840016
118500                                      APOLNBRC                    11850016
118600                                      ASTRNBRC.                   11860016
118700                                                                  11870016
118800     MOVE DP015-UNDERLINE         TO  AOPERH                      11880016
119000                                      APONBRH                     11900016
119100                                      ARCNBRH                     11910016
119200                                      APOLNBRH                    11920016
119300                                      ASTRNBRH.                   11930016
119400*----------------------------------------------------------------*11940016
119500*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *11950016
119600*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *11960016
119700*  IT HERE.                                                      *11970016
119800*----------------------------------------------------------------*11980016
119900                                                                  11990016
120000 4000-BUILD-INITIAL-PANEL.                                        12000016
120100                                                                  12010016
120200     MOVE DP020-LOCATION-NBR       TO  PV-OPER-UNT-ID-N           12020048
120300     MOVE PV-OPER-UNT-ID-N         TO  ASC-OPER-UNT-ID-N          12030016
120400                                       AOPERO.                    12040016
120500     MOVE 1                        TO  ASC-FCLTY-ID-N.            12050046
120700     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      12070016
120800     MOVE -1                       TO  APONBRL.                   12080016
120900                                                                  12090016
121000*----------------------------------------------------------------*12100016
121100*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *12110016
121200*----------------------------------------------------------------*12120016
121300                                                                  12130016
121400 4400-MOVE-COMMAREA-TO-SCREEN.                                    12140016
121500                                                                  12150016
121600     MOVE ASC-OPER-UNT-ID          TO  AOPERO.                    12160016
121800     MOVE ASC-FACILITY-NAME        TO  AOPNAMEO.                  12180016
121900                                                                  12190016
122000     MOVE ASC-PO-NBR-N             TO  APONBRO.                   12200016
122100     MOVE ASC-REC-SEQ-NBR          TO  ARCNBRO.                   12210016
122200     MOVE ASC-PO-LINE-NBR          TO  APOLNBRO.                  12220016
122300     MOVE ASC-STORE-NBR            TO  ASTRNBRO.                  12230016
122400/                                                                 12240016
122410*----------------------------------------------------------------*12241046
122420 9800-WRITE-CICS-LOG.                                             12242046
122430                                                                  12243046
122440     MOVE LENGTH OF PV-CICS-MSG-AREA                              12244046
122450          TO PV-COMMAREA-LENGTH                                   12245046
122460                                                                  12246046
122470     EXEC CICS                                                    12247046
122480         WRITEQ TD                                                12248046
122490             QUEUE  ('CSSL')                                      12249046
122491             FROM   (PV-CICS-MSG-AREA)                            12249146
122492             LENGTH (PV-COMMAREA-LENGTH)                          12249246
122493             RESP   (PV-CICS-RESPONSE)                            12249346
122494     END-EXEC.                                                    12249446
122495                                                                  12249546
122496     MOVE SPACES TO PV-CICS-MSG-AREA.                             12249646
122497*                                                                 12249746
122500*----------------------------------------------------------------*12250016
122600*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *12260016
122700*    AND THE ERROR SWITCHES.                                     *12270016
122800*----------------------------------------------------------------*12280016
122900 9900-SOFT-ABORT.                                                 12290016
123000     SET PS-ERROR         TO TRUE.                                12300016
123100     SET DP020-MSG-FATAL  TO TRUE.                                12310016
123200     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    12320016
123300     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       12330016
123400     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          12340016
123500     PERFORM 0001-CALL-CICS-ARCH-API.                             12350016
123600*----------------------------------------------------------------*12360016
123700*    ABEND PROCESSOR MODULE                                      *12370016
123800*----------------------------------------------------------------*12380016
123900                                                                  12390016
124000     COPY DPPD013.                                                12400042
