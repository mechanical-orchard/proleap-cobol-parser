000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS563.                                         00040000
000500 AUTHOR.        DEANNA BRANTNER.                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  JULY, 2001.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900*---------------------------------------------------------------* 00090000
001000*    S563 - SHIPPING DOOR STATUS  - TRAILER SEAL LIST           * 00100000
001100*---------------------------------------------------------------* 00110000
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00112015
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00113015
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00114015
001130*                                                                 00114116
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00114216
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00114316
263968*---------------------------------------------------------------* 00115015
001200 ENVIRONMENT DIVISION.                                            00120000
001300 DATA DIVISION.                                                   00130000
001400                                                                  00140000
001500 WORKING-STORAGE SECTION.                                         00150000
001600 01  DK-DB2-KEYS.                                                 00160000
001700     05  DK-FROM-TMST                   PIC  X(26)  VALUE SPACES. 00170000
001800     05  DK-TO-TMST                     PIC  X(26)  VALUE SPACES. 00180000
001900     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00190000
002000                                                    COMP.         00200000
002100     05  DK-STORE-NUMBER                PIC S9(04)  VALUE ZERO    00210000
002200                                                    COMP.         00220000
002300     05  DK-TRLR-SRL-NBR                PIC S9(09)  VALUE ZERO    00230000
002400                                                    COMP.         00240000
002500     05  DK-TRIP-ID                     PIC S9(09)  VALUE ZERO    00250000
002600                                                    COMP.         00260000
002700     05  DK-TRLR-SEAL-NBR               PIC  X(20)  VALUE SPACES. 00270000
002800                                                                  00280000
002900 01  PC-PROGRAM-CONSTANTS.                                        00290000
003000     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'SU563A  '.  00300013
003100     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'SUKM563'.   00310000
003200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'SUKCS563'.  00320000
003210     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE 'XLKUT071'.  00321014
003300     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00330000
003400     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00340000
003500     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00350000
003600     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00360000
003700     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00370000
003800                                               COMP SYNC.         00380000
003900     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00390000
004000                                               COMP SYNC.         00400000
004100     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00410000
004200                                               COMP-3.            00420000
004300     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00430000
004400                                               COMP SYNC.         00440000
004500     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00450000
004600                                               COMP-3.            00460000
004700     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00470000
004800     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00480000
004900     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00490000
005000     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00500000
005100     05  PC-NEW                    PIC  X(02)  VALUE 'NW'.        00510000
005200     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00520000
005300     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00530000
005400                                               COMP.              00540000
005500     05  PC-01                     PIC  X(02)  VALUE '01'.        00550000
005600     05  PC-A                      PIC  X(01)  VALUE 'A'.         00560000
005700*                                                                 00570000
005800*                                                                 00580000
005900*----------------------------------------------------------------*00590000
006000*  SYSTEM MESSAGES                                               *00600000
006100*----------------------------------------------------------------*00610000
006200*   00005 = INVALID VALUE                                        *00620000
006300*   00008 = MUST BE NUMERIC                                      *00630000
006400*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00640000
006500*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00650000
006600*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00660000
006700*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00670000
006800*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00680000
006900*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00690000
007000*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00700000
007100*   00069 - TOP OF LIST                                          *00710000
007200*   00070 - BOTTOM OF LIST                                       *00720000
007300*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00730000
007400*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00740000
007500*   00279 - MORE ITEMS TO DISPLAY                                *00750000
007600*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00760000
007700*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *00770000
007800*   99901 = INVALID COMMAND WAS ENTERED                          *00780000
007900*----------------------------------------------------------------*00790000
008000     05  PC-TSYMSG-NUMBERS.                                       00800000
008100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00810000
008200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00820000
008300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00830000
008400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00840000
008500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00850000
008600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00860000
008700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00870000
008800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00880000
008900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00890000
009000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00900000
009100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00910000
009200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00920000
009300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00930000
009400         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00940000
009500         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  00950000
009600         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  00960000
009700         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  00970000
009800         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  00980000
009900         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00990000
010000*                                                                 01000000
010100 01  PS-PROGRAM-SWITCHES.                                         01010000
010200     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01020000
010300         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01030000
010400         88  PS-BLOCK-ERROR                         VALUE 'N'.    01040000
010500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01050000
010600         88  PS-NO-ERROR                            VALUE 'Y'.    01060000
010700         88  PS-ERROR                               VALUE 'N'.    01070000
010800     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01080000
010900         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01090000
011000         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01100000
011100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01110000
011200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01120000
011300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01130000
011400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01140000
011500         88  PS-DONE                                VALUE 'Y'.    01150000
011600         88  PS-NOT-DONE                            VALUE 'N'.    01160000
011700     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01170000
011800         88  PS-LIST-END                            VALUE  'Y'.   01180000
011900         88  PS-NO-LIST-END                         VALUE  'N'.   01190000
012000     05  PS-CURSOR-SW                   PIC  X(01)  VALUE  ' '.   01200000
012100         88  PS-TRLR-SRL-NBR-CSR                    VALUE  'A'.   01210000
012200         88  PS-TRIP-ID-CSR                         VALUE  'B'.   01220000
012300         88  PS-TRLR-SEAL-ID-CSR                    VALUE  'C'.   01230000
012400*                                                                 01240000
012500 01  PV-PROGRAM-VARIABLES.                                        01250000
012600     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01260000
012700                                                     COMP SYNC.   01270000
012800     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01280000
012900     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01290000
013000     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01300000
013100                                        COMP SYNC.                01310000
013200     05  PV-SUB                         PIC S9(04)  VALUE +0      01320000
013300                                                    COMP SYNC.    01330000
013400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01340000
013500                                                    COMP SYNC.    01350000
013600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01360000
013700                                                    COMP-3.       01370000
013800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01380000
013900                                                    COMP-3.       01390000
014000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01400000
014100                                                    COMP-3.       01410000
014200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01420000
014300                                                    COMP-3.       01430000
014400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01440000
014500                                                    COMP-3.       01450000
014600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01460000
014700                                                    COMP-3.       01470000
014800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01480000
014900                                                    COMP-3.       01490000
015000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01500000
015100                                                    COMP SYNC.    01510000
015200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01520000
015300                                                    COMP SYNC.    01530000
015400     05  PV-ITEM                        PIC S9(04)  VALUE +0      01540000
015500                                                    COMP SYNC.    01550000
015600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01560000
015700                                                    COMP SYNC.    01570000
015800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01580000
015900                                                    COMP SYNC.    01590000
016000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01600000
016100                                                    COMP SYNC.    01610000
016200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01620000
016300                                                    COMP SYNC.    01630000
016400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01640000
016500                                                    COMP SYNC.    01650000
016600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01660000
016700                                                    COMP SYNC.    01670000
016800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01680000
016900                                                    COMP SYNC.    01690000
017000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01700000
017100                                                    COMP SYNC.    01710000
017200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01720000
017300                                                    COMP SYNC.    01730000
017400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01740000
017500                                                    COMP SYNC.    01750000
017600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01760000
017700                                                    COMP SYNC.    01770000
017800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01780000
017900                                                    COMP SYNC.    01790000
018000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01800000
018100                                                    COMP SYNC.    01810000
018200     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      01820000
018300                                                    COMP.         01830000
018400     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      01840000
018500                                                    COMP.         01850000
018600     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      01860000
018700                                                    COMP.         01870000
018800     05  PV-SOFT-ABORT-MSG.                                       01880000
018900         10  FILLER            PIC X(12) VALUE ' SUKCS563 - '.    01890000
019000         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01900000
019100         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01910000
019200         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01920000
019300         10  PV-SOFT-PARAGRAPH PIC X(30).                         01930000
019400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01940000
019500                                                     COMP SYNC.   01950000
019600     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01960000
019700     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01970000
019800     05  PV-CICS-MSG-HOLD.                                        01980000
019900         10  FILLER                      PIC  X(01)  VALUE SPACE. 01990000
020000         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02000000
020100     05  PV-CICS-MSG-HOLD2.                                       02010000
020200         10  FILLER                      PIC  X(01)  VALUE SPACE. 02020000
020300         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02030000
020400                                                                  02040000
020500     05  PV-TMST                 PIC X(26)   VALUE SPACES.        02050000
020600     05  PV-TMST-R REDEFINES  PV-TMST.                            02060000
020700         10   PV-TMST-MM                PIC X(02).                02070000
020800         10   PV-TMST-DD                PIC X(02).                02080000
020900         10   PV-TMST-YY                PIC X(04).                02090000
021000         10   FILLER                    PIC X(03).                02100000
021100         10   PV-TMST-HRS               PIC X(02).                02110000
021200         10   FILLER                    PIC X(01).                02120000
021300         10   PV-TMST-MIN               PIC X(02).                02130000
021400         10   FILLER                    PIC X(01).                02140000
021500         10   PV-TMST-SEC               PIC X(02).                02150000
021600         10   FILLER                    PIC X(07).                02160000
021700     05  PV-DATE-TIME-DISPLAY.                                    02170000
021800         10   PV-DISPLAY-MM             PIC X(02)   VALUE SPACES. 02180000
021900         10   PV-SLASH-1                PIC X(01)   VALUE SPACES. 02190000
022000         10   PV-DISPLAY-DD             PIC X(02)   VALUE SPACES. 02200000
022100         10   PV-SLASH-2                PIC X(01)   VALUE SPACES. 02210000
022200         10   PV-DISPLAY-CCYY           PIC X(04)   VALUE SPACES. 02220000
022300         10   PV-AT                     PIC X(03)   VALUE SPACES. 02230000
022400         10   PV-DISPLAY-HRS            PIC X(02)   VALUE SPACES. 02240000
022500         10   PV-SEMICOLON-1            PIC X(01)   VALUE SPACES. 02250000
022600         10   PV-DISPLAY-MIN            PIC X(02)   VALUE SPACES. 02260000
022700         10   PV-SEMICOLON-2            PIC X(01)   VALUE SPACES. 02270000
022800         10   PV-DISPLAY-SEC            PIC X(02)   VALUE SPACES. 02280000
022900     05  PV-CREATE-DATE                  PIC  X(08) VALUE SPACES. 02290000
022910     05  PV-USA-DATE                     PIC  X(10) VALUE SPACES. 02291003
022920     05  PV-SELECT-LIST-SEQ              PIC  X(01) VALUE SPACES. 02292003
022930     05  PV-NBR-ITEMS                    PIC  9(05) VALUE ZEROES. 02293003
022940     05  PV-SEL-TERM-ID                  PIC  X(04).              02294003
022950     05  PV-SEL-TASK-NUMBER              PIC  9(05).              02295003
022960     05  PV-SEL-SEQ                      PIC  9(01).              02296003
022970                                                                  02297003
022980******************************************************************02298003
022990**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02299003
023000**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02300003
023100**  APPLICATION-SPECIFIC COMMAREA.                              **02310003
023200******************************************************************02320003
023300 01  LQW-LIST-QUEUE-WORK-AREA.                                    02330003
023400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02340003
023500     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           02350003
023600                                        INDEXED BY LQW-IDX.       02360003
023700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02370003
023800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02380003
023900         10  LQW-SELECTED-SW            PIC  X(01).               02390003
024000             88  LQW-SELECT                         VALUE 'S'.    02400003
024100             88  LQW-DESELECT                       VALUE ' '.    02410003
024200         10  LQW-ACTION                 PIC  X(03).               02420003
024300             88  LQW-DEL                            VALUE 'DEL'.  02430003
024400             88  LQW-INQ                            VALUE 'INQ'.  02440003
024500             88  LQW-UPD                            VALUE 'UPD'.  02450003
024600             88  LQW-ERR                            VALUE 'ERR'.  02460003
024700         10  LQW-TRLR-SRL-NBR           PIC  9(09).               02470003
024800         10  LQW-TRIP-ID                PIC  9(09).               02480003
024900         10  LQW-DEST-NBR               PIC  9(04).               02490003
025000         10  LQW-TRLR-SEAL-ID           PIC  X(20).               02500003
025100         10  LQW-TRIP-STATUS            PIC  X(07).               02510003
025200         10  LQW-STAT-DATE              PIC  X(10).               02520003
025300         10  LQW-USER-ID                PIC  X(08).               02530003
025400                                                                  02540003
025500*---------------------------------------------------------------* 02550003
025600* SELECTON QUEUE LAYOUT                                         * 02560003
025700*---------------------------------------------------------------* 02570003
025800     COPY SUWS010.                                                02580003
025900                                                                  02590003
026000*---------------------------------------------------------------* 02600003
026100*    MAP LAYOUT                                                 * 02610003
026200*---------------------------------------------------------------* 02620003
026300     COPY SUKM563.                                                02630003
026400*                                                                 02640003
026500 01  MR-OCCURS-LAYOUT                   REDEFINES  SU563AO.       02650003
026600     05  FILLER                         PIC X(125).               02660003
026700     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02670003
026800         10  MR-SELECTL                 PIC S9(04) COMP.          02680003
026900         10  MR-SELECTA                 PIC  X(01).               02690003
027000         10  MR-SELECTC                 PIC  X(01).               02700003
027100         10  MR-SELECTH                 PIC  X(01).               02710003
027200         10  MR-SELECTI                 PIC  X(01).               02720003
027300                                                                  02730003
027400         10  MR-ACTIONL                 PIC S9(04) COMP.          02740003
027500         10  MR-ACTIONA                 PIC  X(01).               02750003
027600         10  MR-ACTIONC                 PIC  X(01).               02760003
027700         10  MR-ACTIONH                 PIC  X(01).               02770003
027800         10  MR-ACTION                  PIC  X(03).               02780003
027900                                                                  02790003
028000         10  MR-TRLR-SRL-NBRL           PIC S9(04) COMP.          02800003
028100         10  MR-TRLR-SRL-NBRA           PIC  X(01).               02810003
028200         10  MR-TRLR-SRL-NBRC           PIC  X(01).               02820003
028300         10  MR-TRLR-SRL-NBRH           PIC  X(01).               02830003
028400         10  MR-TRLR-SRL-NBR            PIC  X(09).               02840003
028500                                                                  02850003
028600         10  MR-TRIP-IDL                PIC S9(04) COMP.          02860003
028700         10  MR-TRIP-IDA                PIC  X(01).               02870003
028800         10  MR-TRIP-IDC                PIC  X(01).               02880003
028900         10  MR-TRIP-IDH                PIC  X(01).               02890003
029000         10  MR-TRIP-ID                 PIC  X(09).               02900003
029100                                                                  02910003
029200         10  MR-DEST-NBRL               PIC S9(04) COMP.          02920003
029300         10  MR-DEST-NBRA               PIC  X(01).               02930003
029400         10  MR-DEST-NBRC               PIC  X(01).               02940003
029500         10  MR-DEST-NBRH               PIC  X(01).               02950003
029600         10  MR-DEST-NBR                PIC  X(04).               02960003
029700                                                                  02970003
029800         10  MR-TRLR-SEAL-IDL           PIC S9(04) COMP.          02980003
029900         10  MR-TRLR-SEAL-IDA           PIC  X(01).               02990003
030000         10  MR-TRLR-SEAL-IDC           PIC  X(01).               03000003
030100         10  MR-TRLR-SEAL-IDH           PIC  X(01).               03010003
030200         10  MR-TRLR-SEAL-ID            PIC  X(20).               03020003
030300                                                                  03030003
030400         10  MR-TRIP-STATUSL            PIC S9(04) COMP.          03040003
030500         10  MR-TRIP-STATUSA            PIC  X(01).               03050003
030600         10  MR-TRIP-STATUSC            PIC  X(01).               03060003
030700         10  MR-TRIP-STATUSH            PIC  X(01).               03070003
030800         10  MR-TRIP-STATUS             PIC  X(07).               03080003
030900                                                                  03090003
031000         10  MR-STAT-DATEL              PIC S9(04) COMP.          03100003
031100         10  MR-STAT-DATEA              PIC  X(01).               03110003
031200         10  MR-STAT-DATEC              PIC  X(01).               03120003
031300         10  MR-STAT-DATEH              PIC  X(01).               03130003
031400         10  MR-STAT-DATE               PIC  X(10).               03140003
031500                                                                  03150003
031600         10  MR-USER-IDL                PIC S9(04) COMP.          03160003
031700         10  MR-USER-IDA                PIC  X(01).               03170003
031800         10  MR-USER-IDC                PIC  X(01).               03180003
031900         10  MR-USER-IDH                PIC  X(01).               03190003
032000         10  MR-USER-ID                 PIC  X(08).               03200003
032100                                                                  03210003
032110*    ITEM COMMAREA FOR XLKUT071                                   03211014
032120     COPY XLWS071.                                                03212011
032130                                                                  03213011
032200*---------------------------------------------------------------* 03220003
032300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03230003
032400*---------------------------------------------------------------* 03240003
032500     COPY DPWS015.                                                03250011
032600                                                                  03260003
032700*---------------------------------------------------------------* 03270003
032800*    FUNCTION KEYS COPYBOOK.                                    * 03280003
032900*---------------------------------------------------------------* 03290003
033000     COPY DPWS016.                                                03300011
033100                                                                  03310003
033200*---------------------------------------------------------------* 03320003
033300*    NUMERIC EDIT LAYOUT.                                       * 03330003
033400*---------------------------------------------------------------* 03340003
033500     COPY DPWS010I.                                               03350011
033600                                                                  03360003
033700*---------------------------------------------------------------* 03370003
033800*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 03380016
033900*---------------------------------------------------------------* 03390003
034000     COPY DPWS030.                                                03400011
034000     COPY DPWS930.                                                03401016
034100                                                                  03410003
034200*---------------------------------------------------------------* 03420003
034300*    STANDARD COMMAREA.                                         * 03430003
034400*---------------------------------------------------------------* 03440003
034500     COPY DPWS020.                                                03450011
034600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03460003
034700                                                                  03470003
034800*---------------------------------------------------------------* 03480003
034900* INTER-APPLICATION COMMAREA.                                   * 03490003
035000*   SUWS008 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03500003
035100*             SPEC SCREEN.                                      * 03510003
035200*   SUWS009 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03520003
035300*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03530003
035400*---------------------------------------------------------------* 03540003
035500                                                                  03550003
035600         10  INTER-APPL-COMM-AREA       PIC X(200).               03560003
035700     COPY SUWS008.                                                03570011
035800     COPY SUWS009.                                                03580011
035900*---------------------------------------------------------------* 03590003
036000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03600003
036100*---------------------------------------------------------------* 03610003
036200         10  ASC-SPECIFIC-COMMAREA.                               03620003
036300             15  ASC-OPER-UNT-ID             PIC  X(04).          03630003
036400             15  ASC-OPER-UNT-ID-N REDEFINES                      03640003
036500                     ASC-OPER-UNT-ID         PIC  9(04).          03650003
036600             15  ASC-OPER-UNT-NAME           PIC  X(25).          03660003
036700             15  ASC-TRLR-SRL-NMBR           PIC  9(09).          03670003
036800             15  ASC-SCAC                    PIC  X(04).          03680003
036900             15  ASC-SCAC-DESC               PIC  X(30).          03690003
037000             15  ASC-TRLR-ID                 PIC  X(12).          03700003
037100             15  ASC-TRIP-STATUS             PIC  X(07).          03710003
037200             15  ASC-STR-NBR-X               PIC  X(04).          03720003
037300             15  ASC-STR-NBR-N REDEFINES ASC-STR-NBR-X.           03730003
037400                 20  ASC-STR-NBR             PIC  9(04).          03740003
037500             15  ASC-OUTBOUND-TRIP-ID        PIC  9(09).          03750003
037600             15  ASC-TRLR-SEAL               PIC  X(20).          03760003
037700             15  ASC-TRIP-STAT-CDE           PIC  X(20).          03770003
037800             15  ASC-STATUS-DATE             PIC  X(10).          03780003
037900             15  ASC-USER-ID                 PIC  X(08).          03790003
038000             15  FILLER                      PIC  X(021).         03800003
038100*-----------------------------------------------------------------03810003
038200             15  ASC-BLK-SUB                  PIC S9(04) COMP     03820003
038300                                                         SYNC.    03830003
038400             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03840003
038500                                                         SYNC.    03850003
038600             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03860003
038700             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03870003
038800             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03880003
038900             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03890003
039000             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03900003
039100             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03910003
039200                                                         SYNC.    03920003
039300             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03930003
039400             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03940003
039500             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03950003
039600                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03960003
039700                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03970003
039800             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03980003
039900                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03990003
040000                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04000003
040100             15  ASC-LIST-QUEUE-NAME.                             04010003
040200                 20  ASC-LIST-TERM-ID         PIC  X(04).         04020003
040300                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  04030003
040400                 20  ASC-LIST-SEQ             PIC  9(01).         04040003
040500                                                                  04050003
040600             15  ASC-START-ITEM-REQUEST.                          04060003
040700                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         04070003
040800                                                                  04080003
040900             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04090003
041000             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04100003
041100             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04110003
041200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04120003
041300             15  ASC-SEL-QUEUE-NAME-IN.                           04130003
041400                 20  ASC-SEL-TERM-ID-IN       PIC  X(04).         04140003
041500                 20  ASC-SEL-TASK-NUMBER-IN   PIC S9(05) COMP-3.  04150003
041600                 20  ASC-SEL-SEQ-IN           PIC  9(01).         04160003
041700             15  ASC-SEL-QUEUE-NAME-OUT.                          04170003
041800                 20  ASC-SEL-TERM-ID-OUT      PIC  X(04).         04180003
041900                 20  ASC-SEL-TASK-NUMBER-OUT  PIC S9(05) COMP-3.  04190003
042000                 20  ASC-SEL-SEQ-OUT          PIC  9(01).         04200003
042100             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04210003
042200                                                                  04220003
042300*-----------------------------------------------------------------04230003
042400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04240003
042500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04250003
042600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04260003
042700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04270003
042800                                                                  04280003
042900                 20  ASC-ITEM-ARRAY.                              04290003
043000                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        04300003
043100                         30  ASC-LIST-ITEM-NUMBER                 04310003
043200                                                     PIC S9(09)   04320003
043300                                                     COMP-3.      04330003
043400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04340003
043500                             88  ASC-VALID-SELECT    VALUE ' '    04350003
043600                                                           'S'    04360003
043700                                                           'B'    04370003
043800                                                           'E'.   04380003
043900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04390003
044000                             88  ASC-TEMP-SELECT     VALUE 'S'.   04400003
044100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04410003
044200                             88  ASC-TEMP-END        VALUE 'E'.   04420003
044300                         30  ASC-SELECTED-SW         PIC  X(01).  04430003
044400                             88  ASC-NO-SELECT       VALUE ' '.   04440003
044500                             88  ASC-SELECT          VALUE 'S'.   04450003
044600                             88  ASC-BEGIN           VALUE 'B'.   04460003
044700                             88  ASC-END             VALUE 'E'.   04470003
044800                         30  ASC-ACTION              PIC  X(03).  04480003
044900                         30  ASC-TRLR-SRL-NBR        PIC  9(09).  04490003
045000                         30  ASC-TRIP-ID             PIC  9(09).  04500003
045100                         30  ASC-DEST-NBR            PIC  9(04).  04510003
045200                         30  ASC-TRLR-SEAL-ID        PIC  X(20).  04520003
045300                         30  ASC-TRIP-STAT           PIC  X(07).  04530003
045400                         30  ASC-STAT-DATE           PIC  X(10).  04540003
045500                         30  ASC-USERID              PIC  X(08).  04550003
045600                                                                  04560003
045700*---------------------------------------------------------------* 04570003
045800*    ABEND PROCESSING COPYBOOK.                                 * 04580003
045900*---------------------------------------------------------------* 04590003
046000     COPY DPWS013.                                                04600011
046100                                                                  04610003
046200*---------------------------------------------------------------* 04620003
046300*    TCNTRID - TRAILER ID TABLE                                 * 04630007
046400*---------------------------------------------------------------* 04640003
046500     EXEC SQL                                                     04650003
046600          INCLUDE TCNTRID                                         04660007
046700     END-EXEC.                                                    04670003
046800                                                                  04680003
046810*---------------------------------------------------------------* 04681007
046820*    TSUOBTR - OUTBOUND TRAILER TRIP                            * 04682007
046830*---------------------------------------------------------------* 04683007
046840     EXEC SQL                                                     04684007
046850          INCLUDE TSUOBTR                                         04685007
046860     END-EXEC.                                                    04686007
046870                                                                  04687007
046900*---------------------------------------------------------------* 04690003
047000*    TSUOBTS - OUTBOUND TRAILER TRIP STATUS                     * 04700003
047100*---------------------------------------------------------------* 04710003
047200     EXEC SQL                                                     04720003
047300          INCLUDE TSUOBTS                                         04730003
047400     END-EXEC.                                                    04740003
047500                                                                  04750003
048300     EXEC SQL                                                     04830003
048400          INCLUDE TEXTENT                                         04840003
048500     END-EXEC.                                                    04850003
048600                                                                  04860003
048610     EXEC SQL                                                     04861003
048620          INCLUDE TENTNME                                         04862003
048630     END-EXEC.                                                    04863003
048640                                                                  04864003
048650*---------------------------------------------------------------* 04865003
048660*    DB2 AREA FOR COMMUNICATIONS                                * 04866003
048670*---------------------------------------------------------------* 04867003
048680     EXEC SQL                                                     04868003
048690          INCLUDE SQLCA                                           04869003
048700     END-EXEC.                                                    04870003
048800                                                                  04880003
048900*---------------------------------------------------------------* 04890003
049000*    TRAILER SERIAL NUMBER CURSOR                                 04900003
049100*---------------------------------------------------------------* 04910003
049200      EXEC SQL                                                    04920003
049300          DECLARE TRLR-SRL-NBR-CSR CURSOR FOR                     04930003
049400                 SELECT  A.TRLR_SRL_NBR                           04940003
049500                        ,A.OTBND_TRIP_ID                          04950003
049600                        ,A.DEST_OPER_UNT_ID                       04960003
049700                        ,B.TRLR_SEAL_ID                           04970003
049800                        ,CHAR(DATE(B.OTBND_STAT_TMST),USA)        04980003
049900                        ,B.OTBND_STAT_USR_ID                      04990003
050000                        ,B.TRIP_STAT_CDE                          05000003
050200                   FROM  TSUOBTR A                                05020003
050300                        ,TSUOBTS B                                05030003
050400                  WHERE  A.TRLR_SRL_NBR      = :DK-TRLR-SRL-NBR   05040003
050500                    AND  A.TRIP_ACTV_CDE     = 'A'                05050003
050600                    AND  A.ORGN_OPER_UNT_ID  = :DK-OPER-UNT-ID    05060003
050700                    AND  A.OTBND_TRIP_ID     = B.OTBND_TRIP_ID    05070003
050800                  ORDER BY B.OTBND_STAT_TMST DESC                 05080014
050900         END-EXEC.                                                05090003
051000                                                                  05100003
051100*---------------------------------------------------------------* 05110003
051200*    TRIP ID CURSOR                                               05120003
051300*---------------------------------------------------------------* 05130003
051400      EXEC SQL                                                    05140003
051500          DECLARE TRIP-ID-CSR CURSOR FOR                          05150003
051600                 SELECT  A.TRLR_SRL_NBR                           05160003
051700                        ,A.OTBND_TRIP_ID                          05170003
051800                        ,A.DEST_OPER_UNT_ID                       05180003
051900                        ,B.TRLR_SEAL_ID                           05190003
052000                        ,CHAR(DATE(B.OTBND_STAT_TMST),USA)        05200003
052100                        ,B.OTBND_STAT_USR_ID                      05210003
052200                        ,B.TRIP_STAT_CDE                          05220003
052400                   FROM  TSUOBTR A                                05240003
052500                        ,TSUOBTS B                                05250003
052600                  WHERE  A.OTBND_TRIP_ID     = :DK-TRIP-ID        05260003
052700                    AND  A.TRIP_ACTV_CDE     = 'A'                05270003
052800                    AND  A.ORGN_OPER_UNT_ID  = :DK-OPER-UNT-ID    05280003
052900                    AND  A.OTBND_TRIP_ID     = B.OTBND_TRIP_ID    05290003
053000                  ORDER BY B.OTBND_STAT_TMST DESC                 05300014
053100         END-EXEC.                                                05310003
053200                                                                  05320003
053300*---------------------------------------------------------------* 05330003
053400*    TRAILER SEAL ID CURSOR                                       05340003
053500*---------------------------------------------------------------* 05350003
053600      EXEC SQL                                                    05360003
053700          DECLARE TRLR-SEAL-ID-CSR CURSOR FOR                     05370003
053800                 SELECT  A.TRLR_SRL_NBR                           05380003
053900                        ,A.OTBND_TRIP_ID                          05390003
054000                        ,A.DEST_OPER_UNT_ID                       05400003
054100                        ,B.TRLR_SEAL_ID                           05410003
054200                        ,CHAR(DATE(B.OTBND_STAT_TMST),USA)        05420003
054300                        ,B.OTBND_STAT_USR_ID                      05430003
054400                        ,B.TRIP_STAT_CDE                          05440003
054600                   FROM  TSUOBTR A                                05460003
054700                        ,TSUOBTS B                                05470003
054800                  WHERE  B.TRLR_SEAL_ID     = :DK-TRLR-SEAL-NBR   05480003
054900                    AND  A.ORGN_OPER_UNT_ID = :DK-OPER-UNT-ID     05490003
055000                    AND  A.OTBND_TRIP_ID    = B.OTBND_TRIP_ID     05500003
055100                  ORDER BY B.OTBND_STAT_TMST DESC                 05510014
055200         END-EXEC.                                                05520003
055300                                                                  05530003
055400*-----------------------------------------------------------------05540003
055500 LINKAGE SECTION.                                                 05550003
055600                                                                  05560003
055700 01  DFHCOMMAREA.                                                 05570003
055800     05  FILLER                         OCCURS  1 TO 4072 TIMES   05580003
055900                                        DEPENDING ON EIBCALEN.    05590003
056000         10  FILLER                     PIC X.                    05600003
056100                                                                  05610003
056200                                                                  05620003
056300 PROCEDURE DIVISION.                                              05630003
056400******************************************************************05640003
056500**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05650003
056600**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05660003
056700**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05670003
056800******************************************************************05680003
056900 0000-MAIN-MODULE.                                                05690003
057000     INITIALIZE DP030-CICS-API-FIELDS.                            05700003
057100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05710003
057200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05720003
057300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05730003
057400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05740003
057500     MOVE LENGTH OF SU563AI        TO DP030-MAP-LENGTH (1).       05750003
057600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05760003
057700     PERFORM 0001-CALL-CICS-ARCH-API.                             05770003
057800*                                                                 05780003
057900     PERFORM 1000-CONTROL-PROCESSING                              05790003
058000*                                                                 05800003
058100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05810003
058200     PERFORM 0001-CALL-CICS-ARCH-API.                             05820003
058300                                                                  05830003
058400******************************************************************05840003
058500**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05850003
058600**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05860003
058700******************************************************************05870003
058800 0001-CALL-CICS-ARCH-API.                                         05880003
058900*    CALL 'DPKCS030' USING DFHEIBLK                               05890016
058900     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05891016
059000                           DFHCOMMAREA                            05900003
059100                           DP030-CICS-API-FIELDS                  05910003
059200                           DP020-STANDARD-COMMAREA                05920003
059300                           SU563AI.                               05930003
059400*                                                                 05940003
059500     IF  DP030-RC-CALL-SUCCESSFUL                                 05950003
059600         CONTINUE                                                 05960003
059700     ELSE                                                         05970003
059800         SET DP013-NO-ROLLBACK                                    05980003
059900             DP013-XCTL-DISPLAY-RESTART                           05990003
060000             DP013-CICS-ABEND      TO TRUE                        06000003
060100         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        06010003
060200*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06020016
060300*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06030016
060200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O06031016
060300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06032016
060400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06040003
060500         PERFORM DP013-0000-PROCESS-ABEND                         06050003
060600     END-IF.                                                      06060003
060700                                                                  06070003
060800*----------------------------------------------------------------*06080003
060900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06090003
061000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06100003
061100*                                                                *06110003
061200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06120003
061300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06130003
061400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06140003
061500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06150003
061600*----------------------------------------------------------------*06160003
061700 1000-CONTROL-PROCESSING.                                         06170003
061800                                                                  06180003
061900     EVALUATE TRUE                                                06190003
062000         WHEN DP020-NEXT-ACT-INITIAL                              06200003
062100             INITIALIZE ASC-SPECIFIC-COMMAREA                     06210003
062200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06220003
062300                                      ASC-SEL-TERM-ID-OUT         06230003
062400             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   06240003
062500                                          ASC-SEL-TASK-NUMBER-OUT 06250003
062600             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              06260003
062700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             06270003
062800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06280003
062900             PERFORM 4000-BUILD-INITIAL-PANEL                     06290003
063000                                                                  06300003
063100         WHEN DP020-NEXT-ACT-READ-MAP                             06310003
063200             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06320003
063300             PERFORM 2000-PROCESS-PANEL                           06330003
063400                                                                  06340003
063500         WHEN DP020-NEXT-ACT-RETURN                               06350003
063600             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06360003
063700             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               06370003
063800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06380003
063900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06390003
064000                                                                  06400003
064100         WHEN OTHER                                               06410003
064200             SET DP013-LOGIC-ABEND TO TRUE                        06420003
064300             SET DP013-NO-ROLLBACK TO TRUE                        06430003
064400             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    06440003
064500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06450003
064600                                   TO DP013-MESSAGE-TEXT(1)       06460003
064700             PERFORM DP013-0000-PROCESS-ABEND                     06470003
064800     END-EVALUATE.                                                06480003
064900                                                                  06490003
065000*----------------------------------------------------------------*06500003
065100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06510003
065200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06520003
065300*----------------------------------------------------------------*06530003
065400 1100-PROCESS-INTER-APPL-COMM.                                    06540003
065500                                                                  06550003
065600     SET PS-COMMAREA-VALID         TO TRUE.                       06560003
065700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06570003
065800                                                                  06580003
065900     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          06590003
066000         MOVE SU008-OPER-UNT-ID       TO ASC-OPER-UNT-ID-N        06600003
066100                                         DK-OPER-UNT-ID           06610003
066200         MOVE SU008-TRLR-SRL-NBR      TO ASC-TRLR-SRL-NMBR        06620003
066300                                         DK-TRLR-SRL-NBR          06630003
066400         MOVE SU008-TRIP-STATUS       TO ASC-TRIP-STATUS          06640003
066500         MOVE SU008-DEST-STR-NBR      TO ASC-STR-NBR              06650003
066600         MOVE SU008-TRIP-ID           TO ASC-OUTBOUND-TRIP-ID     06660003
066700         MOVE SU008-TRLR-SEAL-NBR     TO ASC-TRLR-SEAL            06670003
066800     ELSE                                                         06680003
066900         SET ASC-USE-SELECTION-QUEUE TO TRUE                      06690003
067000         MOVE SU009-NUMBER-OF-SELECTED-ITEMS TO                   06700003
067100                                      ASC-NUMBER-OF-SELECTED-ITEMS06710003
067200         MOVE SU009-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  06720003
067300         MOVE SU009-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN   06730003
067400         MOVE SU009-OPER-UNT-ID       TO ASC-OPER-UNT-ID-N        06740003
067500                                         DK-OPER-UNT-ID           06750003
067600         MOVE SU009-TRLR-SRL-NBR      TO ASC-TRLR-SRL-NMBR        06760003
067700                                         DK-TRLR-SRL-NBR          06770003
067800         PERFORM 1120-PREPARE-LIST-ENTRY                          06780003
067900     END-IF.                                                      06790003
068000                                                                  06800003
068100*-----------------------------------------------------------------06810003
068200 1120-PREPARE-LIST-ENTRY.                                         06820003
068300                                                                  06830003
068400     MOVE SU010-MAX-ITEMS          TO ASC-SEL-SUB.                06840003
068500     MOVE ZERO                     TO ASC-SEL-ITEM.               06850003
068600     PERFORM 1130-GET-NEXT-RECORD.                                06860003
068700                                                                  06870003
068800*-----------------------------------------------------------------06880003
068900*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*06890003
069000*-----------------------------------------------------------------06900003
069100 1130-GET-NEXT-RECORD.                                            06910003
069200                                                                  06920003
069300     ADD +1                       TO ASC-SEL-SUB.                 06930003
069400                                                                  06940003
069500     IF  ASC-SEL-SUB > SU010-MAX-ITEMS                            06950003
069600         ADD +1                   TO ASC-SEL-ITEM                 06960003
069700         MOVE +1                  TO ASC-SEL-SUB                  06970003
069800     END-IF.                                                      06980003
069900                                                                  06990003
070000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07000003
070100         PERFORM 9100-READ-SEL-QUEUE                              07010003
070200         IF  SU010-ITEM (ASC-SEL-SUB) > ZERO                      07020003
070300             MOVE SU010-TRLR-SRL-NBR (ASC-SEL-SUB)                07030003
070400                                       TO ASC-TRLR-SRL-NMBR       07040003
070500             MOVE SU010-TRIP-ID (ASC-SEL-SUB)                     07050003
070600                                       TO ASC-OUTBOUND-TRIP-ID    07060003
070700             MOVE SU010-DEST-NBR (ASC-SEL-SUB)                    07070003
070800                                       TO ASC-STR-NBR             07080003
070900             MOVE SU010-TRLR-SEAL-ID (ASC-SEL-SUB)                07090003
071000                                       TO ASC-TRLR-SEAL           07100003
071100             MOVE SU010-TRIP-STATUS (ASC-SEL-SUB)                 07110003
071200                                       TO ASC-TRIP-STATUS         07120003
071300             MOVE SU010-STAT-DATE (ASC-SEL-SUB)                   07130003
071400                                       TO ASC-STATUS-DATE         07140003
071500             MOVE SU010-USER-ID (ASC-SEL-SUB) TO ASC-USER-ID      07150003
071600             SET SU010-INQ (ASC-SEL-SUB) TO TRUE                  07160003
071700             PERFORM 9200-REWRITE-SEL-QUEUE                       07170003
071800         ELSE                                                     07180003
071900             SUBTRACT +1 FROM ASC-SEL-SUB                         07190003
072000             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07200003
072100             SET DP020-MSG-INFORMATIONAL                          07210003
072200                 PS-LIST-END             TO TRUE                  07220003
072300         END-IF                                                   07230003
072400     ELSE                                                         07240003
072500         SUBTRACT +1 FROM ASC-SEL-ITEM                            07250003
072600         MOVE SU010-MAX-ITEMS     TO ASC-SEL-SUB                  07260003
072700         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07270003
072800         SET DP020-MSG-INFORMATIONAL                              07280003
072900             PS-LIST-END             TO TRUE                      07290003
073000     END-IF.                                                      07300003
073100                                                                  07310003
073200*-----------------------------------------------------------------07320003
073300*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07330003
073400*    PROCESSED.                                                  *07340003
073500*-----------------------------------------------------------------07350003
073600 1140-GET-PREV-RECORD.                                            07360003
073700                                                                  07370003
073800     SUBTRACT +1 FROM ASC-SEL-SUB.                                07380003
073900                                                                  07390003
074000     IF  ASC-SEL-SUB < +1                                         07400003
074100         SUBTRACT +1 FROM ASC-SEL-ITEM                            07410003
074200         MOVE SU010-MAX-ITEMS     TO ASC-SEL-SUB                  07420003
074300     END-IF.                                                      07430003
074400                                                                  07440003
074500     IF  ASC-SEL-ITEM > ZERO                                      07450003
074600         PERFORM 9100-READ-SEL-QUEUE                              07460003
074700         MOVE SU010-TRLR-SRL-NBR (ASC-SEL-SUB)                    07470003
074800                                       TO ASC-TRLR-SRL-NMBR       07480003
074900         MOVE SU010-TRIP-ID (ASC-SEL-SUB)                         07490003
075000                                       TO ASC-OUTBOUND-TRIP-ID    07500003
075100         MOVE SU010-DEST-NBR (ASC-SEL-SUB)                        07510003
075200                                       TO ASC-STR-NBR             07520003
075300         MOVE SU010-TRLR-SEAL-ID (ASC-SEL-SUB)                    07530003
075400                                       TO ASC-TRLR-SEAL           07540003
075500         MOVE SU010-TRIP-STATUS (ASC-SEL-SUB)                     07550003
075600                                       TO ASC-TRIP-STATUS         07560003
075700         MOVE SU010-STAT-DATE (ASC-SEL-SUB)                       07570003
075800                                       TO ASC-STATUS-DATE         07580003
075900         MOVE SU010-USER-ID (ASC-SEL-SUB)  TO ASC-USER-ID         07590003
076000         SET SU010-INQ (ASC-SEL-SUB) TO TRUE                      07600003
076100         PERFORM 9200-REWRITE-SEL-QUEUE                           07610003
076200     ELSE                                                         07620003
076300         MOVE +1                  TO ASC-SEL-ITEM                 07630003
076400                                     ASC-SEL-SUB                  07640003
076500         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             07650003
076600         SET DP020-MSG-INFORMATIONAL                              07660003
076700             PS-LIST-END             TO TRUE                      07670003
076800     END-IF.                                                      07680003
076900                                                                  07690003
077000*----------------------------------------------------------------*07700003
077100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07710003
077200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07720003
077300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07730003
077400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07740003
077500* FUNCTION KEYS CAN GET THIS FAR.                                *07750003
077600*----------------------------------------------------------------*07760003
077700 2000-PROCESS-PANEL.                                              07770003
077800     EVALUATE TRUE                                                07780003
077900         WHEN DP020-SRC-AID = DP016-CLEAR                         07790003
078000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07800003
078100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07810003
078200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07820003
078300                                                                  07830003
078400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07840003
078500             PERFORM 2050-DELETE-LIST-QUEUE                       07850003
078600             PERFORM 4000-BUILD-INITIAL-PANEL                     07860003
078700                                                                  07870003
078800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07880003
078900             PERFORM 2140-DESELECT-ALL-ITEMS                      07890003
079000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07900003
079100                                                                  07910003
079200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07920003
079300             PERFORM 2150-SELECT-ALL-ITEMS                        07930003
079400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07940003
079500                                                                  07950003
079600         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07960003
079700             IF  ASC-USE-SELECTION-QUEUE                          07970003
079800                 PERFORM 1130-GET-NEXT-RECORD                     07980003
079900                 IF PS-LIST-END                                   07990003
080000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08000003
080100                     SET PS-NO-LIST-END TO TRUE                   08010003
080200                 ELSE                                             08020003
080300                     PERFORM 2050-DELETE-LIST-QUEUE               08030003
080400                     PERFORM 3200-RESET-ATTRIBUTES                08040003
080500                     PERFORM 4000-BUILD-INITIAL-PANEL             08050003
080600                 END-IF                                           08060003
080700              ELSE                                                08070003
080800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08080003
080900*                --- BOTTOM OF LIST ---                           08090003
081000                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         08100003
081100                 SET DP020-MSG-INFORMATIONAL TO TRUE              08110003
081200             END-IF                                               08120003
081300                                                                  08130003
081400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08140003
081500             IF  ASC-USE-SELECTION-QUEUE                          08150003
081600                 PERFORM 1140-GET-PREV-RECORD                     08160003
081700                 IF PS-LIST-END                                   08170003
081800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08180003
081900                     SET PS-NO-LIST-END TO TRUE                   08190003
082000                 ELSE                                             08200003
082100                     PERFORM 2050-DELETE-LIST-QUEUE               08210003
082200                     PERFORM 3200-RESET-ATTRIBUTES                08220003
082300                     PERFORM 4000-BUILD-INITIAL-PANEL             08230003
082400                 END-IF                                           08240003
082500             ELSE                                                 08250003
082600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08260003
082700                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         08270003
082800                 SET DP020-MSG-INFORMATIONAL TO TRUE              08280003
082900             END-IF                                               08290003
083000                                                                  08300003
083100         WHEN OTHER                                               08310003
083200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08320003
083300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08330003
083400                                                                  08340003
083500             IF  PS-NO-ERROR                                      08350003
083600                 SET DP030-CONTINUE-GO TO TRUE                    08360003
083700                 PERFORM 2100-CHECK-FUNCTION-KEY                  08370003
083800             ELSE                                                 08380003
083900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08390003
084000                 SET DP030-OVERRIDE-GO TO TRUE                    08400003
084100             END-IF                                               08410003
084200     END-EVALUATE.                                                08420003
084300                                                                  08430003
084400*----------------------------------------------------------------*08440003
084500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08450003
084600*----------------------------------------------------------------*08460003
084700 2050-DELETE-LIST-QUEUE.                                          08470003
084800                                                                  08480003
084900     EXEC CICS                                                    08490003
085000         DELETEQ TS                                               08500003
085100             QUEUE (ASC-LIST-QUEUE-NAME)                          08510003
085200             RESP  (PV-CICS-RESP)                                 08520003
085300     END-EXEC.                                                    08530003
085400                                                                  08540003
085500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08550003
085600        (PV-CICS-RESP = DFHRESP(QIDERR))                          08560003
085700         CONTINUE                                                 08570003
085800     ELSE                                                         08580003
085900         SET DP013-CICS-ABEND      TO TRUE                        08590003
086000         SET DP013-NO-ROLLBACK     TO TRUE                        08600003
086100                                                                  08610003
086200         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         08620003
086300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08630003
086400                                   TO DP013-MESSAGE-TEXT (1)      08640003
086500         PERFORM DP013-0000-PROCESS-ABEND                         08650003
086600     END-IF.                                                      08660003
086700                                                                  08670003
086800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08680003
086900                                                                  08690003
087000*----------------------------------------------------------------*08700003
087100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08710003
087200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08720003
087300* CICS ARCHITECTURE API.                                         *08730003
087400*----------------------------------------------------------------*08740003
087500 2100-CHECK-FUNCTION-KEY.                                         08750003
087600                                                                  08760003
087700     EVALUATE TRUE                                                08770003
087800*                                                                 08780003
087900* F17 - TRAILER HISTORY                                           08790003
088000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08800003
088100             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08810003
088200                 SET ASC-USE-SELECTION-QUEUE TO TRUE              08820003
088300                 INITIALIZE SU009-INTER-APPL-COMMAREA             08830003
088400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08840003
088500                                TO SU009-NUMBER-OF-SELECTED-ITEMS 08850003
088600                 MOVE ASC-NUMBER-OF-TS-ITEMS                      08860003
088700                                      TO SU009-NUMBER-OF-TS-ITEMS 08870003
088800                 MOVE ASC-SEL-QUEUE-NAME-OUT                      08880003
088900                                           TO SU009-SEL-QUEUE-NAME08890003
089000                 MOVE ASC-OPER-UNT-ID-N    TO SU009-OPER-UNT-ID   08900003
089010                 MOVE ASC-SCAC             TO SU009-SCAC-CDE      08901006
089100                 PERFORM 5000-PREPARE-SEL-QUEUE                   08910003
089200             ELSE                                                 08920003
089300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08930003
089400                 SET DP030-OVERRIDE-GO TO TRUE                    08940003
089500                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         08950003
089600                 SET DP020-MSG-WARNING TO TRUE                    08960003
089700             END-IF                                               08970003
089800*                                                                 08980003
089900* F22 - ASSOCIATE LIST                                            08990003
090000         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09000003
090100             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              09010003
090200                 SET ASC-USE-SELECTION-QUEUE TO TRUE              09020003
090300                 INITIALIZE SU009-INTER-APPL-COMMAREA             09030003
090400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09040003
090500                                TO SU009-NUMBER-OF-SELECTED-ITEMS 09050003
090600                 MOVE ASC-NUMBER-OF-TS-ITEMS                      09060003
090700                                      TO SU009-NUMBER-OF-TS-ITEMS 09070003
090800                 MOVE ASC-SEL-QUEUE-NAME-OUT                      09080003
090900                                           TO SU009-SEL-QUEUE-NAME09090003
091000                 MOVE ASC-OPER-UNT-ID-N    TO SU009-OPER-UNT-ID   09100003
091010                 MOVE ASC-SCAC             TO SU009-SCAC-CDE      09101006
091100                 PERFORM 5000-PREPARE-SEL-QUEUE                   09110003
091200             ELSE                                                 09120003
091300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09130003
091400                 SET DP030-OVERRIDE-GO TO TRUE                    09140003
091500                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         09150003
091600                 SET DP020-MSG-WARNING TO TRUE                    09160003
091700             END-IF                                               09170003
091800*                                                                 09180003
091900* F6 - FIRST PAGE                                                 09190003
092000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09200003
092100             MOVE +1               TO PV-TOP-ITEM                 09210003
092200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09220003
092300*                                                                 09230003
092400* F7 - PREVIOUS PAGE                                              09240003
092500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09250003
092600             PERFORM 2110-BROWSE-BACKWARD                         09260003
092700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09270003
092800*                                                                 09280003
092900* F8 - NEXT PAGE                                                  09290003
093000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09300003
093100             PERFORM 2120-BROWSE-FORWARD                          09310003
093200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09320003
093300*                                                                 09330003
093400* ENTER KEY                                                       09340003
093500         WHEN DP020-SRC-AID = DP016-ENTER                         09350003
093600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09360003
093700             IF  PS-ERROR                                         09370003
093800                 CONTINUE                                         09380003
093900             ELSE                                                 09390003
094000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09400003
094100             END-IF                                               09410003
094200                                                                  09420003
094300         WHEN OTHER                                               09430003
094400             SET DP013-NO-ROLLBACK                                09440003
094500                 DP013-XCTL-DISPLAY-RESTART                       09450003
094600                 DP013-CICS-ABEND  TO TRUE                        09460003
094700             MOVE '2100-CHECK-FUNCTION-KEY'                       09470003
094800                                   TO DP013-PARAGRAPH             09480003
094900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09490003
095000                                   TO DP013-MESSAGE-TEXT (1)      09500003
095100             PERFORM DP013-0000-PROCESS-ABEND                     09510003
095200     END-EVALUATE.                                                09520003
095300*                                                                 09530003
095400*----------------------------------------------------------------*09540003
095500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09550003
095600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09560003
095700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09570003
095800*    MESSAGE.                                                    *09580003
095900*----------------------------------------------------------------*09590003
096000 2110-BROWSE-BACKWARD.                                            09600003
096100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09610003
096200         GIVING PV-TOP-ITEM.                                      09620003
096300*                                                                 09630003
096400     IF  ((PV-TOP-ITEM < +1)                                      09640003
096500       OR (PV-TOP-ITEM = +1))                                     09650003
096600         MOVE +1                   TO PV-TOP-ITEM                 09660003
096700*        -- TOP OF LIST --                                        09670003
096800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09680003
096900         SET DP020-MSG-INFORMATIONAL TO TRUE                      09690003
097000     END-IF.                                                      09700003
097100                                                                  09710003
097200*----------------------------------------------------------------*09720003
097300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09730003
097400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09740003
097500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09750003
097600*----------------------------------------------------------------*09760003
097700 2120-BROWSE-FORWARD.                                             09770003
097800                                                                  09780003
097900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09790003
098000         GIVING PV-TOP-ITEM.                                      09800003
098100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09810003
098200         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             09820003
098300*        -- BOTTOM OF LIST --                                     09830003
098400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09840003
098500         SET DP020-MSG-INFORMATIONAL  TO TRUE                     09850003
098600     ELSE                                                         09860003
098700         COMPUTE PV-BOTTOM-ITEM =                                 09870003
098800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09880003
098900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09890003
099000*            -- BOTTOM OF LIST --                                 09900003
099100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09910003
099200             SET DP020-MSG-INFORMATIONAL TO TRUE                  09920003
099300         END-IF                                                   09930003
099400     END-IF.                                                      09940003
099500                                                                  09950003
099600*----------------------------------------------------------------*09960003
099700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09970003
099800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09980003
099900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09990003
100000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10000003
100100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10010003
100200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10020003
100300*----------------------------------------------------------------*10030003
100400 2130-CHECK-FOR-JUMP-BROWSE.                                      10040003
100500     SET PS-NO-ERROR               TO TRUE.                       10050003
100600     IF (ASC-START-ITEM-REQUEST = SPACE)                          10060003
100700         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             10070003
100800     ELSE                                                         10080003
100900         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     10090003
101000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10100003
101100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10110003
101200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  10120003
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10131015
263968              USING DP010I-NUMERIC-EDIT-AREA                      10132015
101400                                                                  10140003
101500         IF  NOT DP010I-ERROR-DETECTED                            10150003
101600             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N10160003
101700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10170003
101800                 IF  ASC-START-ITEM-REQUEST-N >                   10180003
101900                                          ASC-NUMBER-OF-ITEMS-READ10190003
102000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10200003
102100                     COMPUTE PV-TOP-ITEM =                        10210003
102200                             ASC-NUMBER-OF-ITEMS-READ             10220003
102300                             - PC-ITEMS-PER-PANEL + 1             10230003
102400                     IF  PV-TOP-ITEM < +1                         10240003
102500                         MOVE +1   TO PV-TOP-ITEM                 10250003
102600                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 10260003
102700                         SET DP020-MSG-INFORMATIONAL TO TRUE      10270003
102800                     END-IF                                       10280003
102900                 ELSE                                             10290003
103000                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 10300003
103100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10310003
103200                     COMPUTE PV-BOTTOM-ITEM =                     10320003
103300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10330003
103400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10340003
103500*                        -- BOTTOM OF LIST --                     10350003
103600                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 10360003
103700                         SET DP020-MSG-INFORMATIONAL TO TRUE      10370003
103800                     END-IF                                       10380003
103900                 END-IF                                           10390003
104000             ELSE                                                 10400003
104100*                --- VALUE OUT OF RANGE ----                      10410003
104200                 MOVE PC-TSYMSG-00101  TO DP020-MSG-NUMBER        10420003
104300                 MOVE -1           TO ASTRTITL                    10430003
104400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              10440003
104500                 MOVE DP015-REVERSE TO ASTRTITH                   10450003
104600                 MOVE DP015-RED    TO ASTRTITC                    10460003
104700                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           10470003
104800                 SET DP020-MSG-FATAL                              10480003
104900                     PS-ERROR        TO TRUE                      10490003
105000             END-IF                                               10500003
105100                                                                  10510003
105200         ELSE                                                     10520003
105300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10530003
105400             MOVE -1               TO ASTRTITL                    10540003
105500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10550003
105600             MOVE DP015-REVERSE    TO ASTRTITH                    10560003
105700             MOVE DP015-RED        TO ASTRTITC                    10570003
105800             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               10580003
105900             SET DP020-MSG-FATAL   TO TRUE                        10590003
106000             SET PS-ERROR          TO TRUE                        10600003
106100         END-IF                                                   10610003
106200     END-IF.                                                      10620003
106300                                                                  10630003
106400*----------------------------------------------------------------*10640003
106500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10650003
106600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10660003
106700*----------------------------------------------------------------*10670003
106800 2140-DESELECT-ALL-ITEMS.                                         10680003
106900     MOVE +1                       TO ASC-BLK-SUB.                10690003
107000                                                                  10700003
107100     PERFORM 2141-CLEAR-SELECTED-INDS                             10710003
107200         VARYING ASC-ITEM-SUB                                     10720003
107300         FROM 1 BY 1                                              10730003
107400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10740003
107500                                                                  10750003
107600     ADD +1                        TO ASC-BLK-SUB.                10760003
107700                                                                  10770003
107800     PERFORM 2141-CLEAR-SELECTED-INDS                             10780003
107900         VARYING ASC-ITEM-SUB                                     10790003
108000         FROM 1 BY 1                                              10800003
108100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10810003
108200                                                                  10820003
108300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10830003
108400                                   TO PV-LIST-ITEM-NUMBER.        10840003
108500                                                                  10850003
108600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10860003
108700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10870003
108800                                                                  10880003
108900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10890003
109000        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10900003
109100         MOVE +1                   TO ASC-BLK-SUB                 10910003
109200                                                                  10920003
109300         PERFORM 5100-WRITE-TEMP-STORAGE                          10930003
109400         MOVE +2                   TO ASC-BLK-SUB                 10940003
109500         PERFORM 5100-WRITE-TEMP-STORAGE                          10950003
109600         MOVE +1                   TO ASC-BLK-SUB                 10960003
109700                                                                  10970003
109800         MOVE +1                   TO PV-BLOCK-NUMBER             10980003
109900                                                                  10990003
110000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11000003
110100             PV-FIRST-BLOCK-IN-ARRAY - 1                          11010003
110200                                                                  11020003
110300         PERFORM                                                  11030003
110400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11040003
110500                                                                  11050003
110600             PERFORM 4410-READ-TEMP-STORAGE                       11060003
110700                                                                  11070003
110800             PERFORM 2141-CLEAR-SELECTED-INDS                     11080003
110900                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11090003
111000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11100003
111100                                                                  11110003
111200             PERFORM 5100-WRITE-TEMP-STORAGE                      11120003
111300                                                                  11130003
111400             ADD +1                TO PV-BLOCK-NUMBER             11140003
111500                                                                  11150003
111600         END-PERFORM                                              11160003
111700                                                                  11170003
111800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11180003
111900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11190003
112000                                                                  11200003
112100         PERFORM                                                  11210003
112200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11220003
112300                   ASC-HIGHEST-BLOCK-WRITTEN                      11230003
112400                                                                  11240003
112500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11250003
112600                                   TO PV-BLOCK-NUMBER             11260003
112700                                                                  11270003
112800             PERFORM 4410-READ-TEMP-STORAGE                       11280003
112900                                                                  11290003
113000             PERFORM 2141-CLEAR-SELECTED-INDS                     11300003
113100                 VARYING ASC-ITEM-SUB                             11310003
113200                 FROM 1 BY 1                                      11320003
113300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11330003
113400                                                                  11340003
113500             PERFORM 5100-WRITE-TEMP-STORAGE                      11350003
113600                                                                  11360003
113700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11370003
113800                                                                  11380003
113900         END-PERFORM                                              11390003
114000                                                                  11400003
114100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11410003
114200                                   TO PV-BLOCK-NUMBER             11420003
114300                                                                  11430003
114400         PERFORM 4410-READ-TEMP-STORAGE                           11440003
114500     END-IF.                                                      11450003
114600                                                                  11460003
114700                                                                  11470003
114800     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11480003
114900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11490003
115000     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11500003
115100                                                                  11510003
115200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11520003
115300                                                                  11530003
115400*----------------------------------------------------------------*11540003
115500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11550003
115600*----------------------------------------------------------------*11560003
115700 2141-CLEAR-SELECTED-INDS.                                        11570003
115800                                                                  11580003
115900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11590003
116000             NOT EQUAL ZERO                                       11600003
116100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11610003
116200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11620003
116300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11630003
116400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11640003
116500                                   TO TRUE                        11650003
116600         END-IF                                                   11660003
116700     END-IF.                                                      11670003
116800                                                                  11680003
116900*----------------------------------------------------------------*11690003
117000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11700003
117100*  FOR ALL ITEMS.                                                *11710003
117200*----------------------------------------------------------------*11720003
117300 2150-SELECT-ALL-ITEMS.                                           11730003
117400                                                                  11740003
117500     MOVE +1                       TO ASC-BLK-SUB.                11750003
117600                                                                  11760003
117700     PERFORM 2151-SET-SELECTED-INDS                               11770003
117800         VARYING ASC-ITEM-SUB                                     11780003
117900         FROM 1 BY 1                                              11790003
118000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11800003
118100                                                                  11810003
118200     ADD +1                        TO ASC-BLK-SUB.                11820003
118300                                                                  11830003
118400     PERFORM 2151-SET-SELECTED-INDS                               11840003
118500         VARYING ASC-ITEM-SUB                                     11850003
118600         FROM 1 BY 1                                              11860003
118700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11870003
118800                                                                  11880003
118900     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       11890003
119000                                                                  11900003
119100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11910003
119200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11920003
119300                                                                  11930003
119400     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            11940003
119500         MOVE +1                   TO ASC-BLK-SUB                 11950003
119600                                                                  11960003
119700         PERFORM 5100-WRITE-TEMP-STORAGE                          11970003
119800         MOVE +2                   TO ASC-BLK-SUB                 11980003
119900         PERFORM 5100-WRITE-TEMP-STORAGE                          11990003
120000         MOVE +1                   TO ASC-BLK-SUB                 12000003
120100         MOVE +1                   TO PV-BLOCK-NUMBER             12010003
120200     END-IF.                                                      12020003
120300*                                                                 12030003
120400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12040003
120500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12050003
120600         MOVE +1                   TO ASC-BLK-SUB                 12060003
120700                                                                  12070003
120800         PERFORM 5100-WRITE-TEMP-STORAGE                          12080003
120900         MOVE +2                   TO ASC-BLK-SUB                 12090003
121000         PERFORM 5100-WRITE-TEMP-STORAGE                          12100003
121100         MOVE +1                   TO ASC-BLK-SUB                 12110003
121200         MOVE +1                   TO PV-BLOCK-NUMBER             12120003
121300                                                                  12130003
121400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12140003
121500             PV-FIRST-BLOCK-IN-ARRAY - 1                          12150003
121600                                                                  12160003
121700         PERFORM                                                  12170003
121800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12180003
121900                                                                  12190003
122000             PERFORM 4410-READ-TEMP-STORAGE                       12200003
122100                                                                  12210003
122200             PERFORM 2151-SET-SELECTED-INDS                       12220003
122300                 VARYING ASC-ITEM-SUB                             12230003
122400                 FROM 1 BY 1                                      12240003
122500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12250003
122600                                                                  12260003
122700             PERFORM 5100-WRITE-TEMP-STORAGE                      12270003
122800                                                                  12280003
122900             ADD +1                TO PV-BLOCK-NUMBER             12290003
123000                                                                  12300003
123100         END-PERFORM                                              12310003
123200                                                                  12320003
123300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12330003
123400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12340003
123500                                                                  12350003
123600         PERFORM                                                  12360003
123700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12370003
123800                   ASC-HIGHEST-BLOCK-WRITTEN                      12380003
123900                                                                  12390003
124000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12400003
124100                                   TO PV-BLOCK-NUMBER             12410003
124200                                                                  12420003
124300             PERFORM 4410-READ-TEMP-STORAGE                       12430003
124400                                                                  12440003
124500             PERFORM 2151-SET-SELECTED-INDS                       12450003
124600                 VARYING ASC-ITEM-SUB                             12460003
124700                 FROM 1 BY 1                                      12470003
124800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12480003
124900                                                                  12490003
125000             PERFORM 5100-WRITE-TEMP-STORAGE                      12500003
125100                                                                  12510003
125200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12520003
125300                                                                  12530003
125400         END-PERFORM                                              12540003
125500                                                                  12550003
125600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12560003
125700                                   TO PV-BLOCK-NUMBER             12570003
125800                                                                  12580003
125900         PERFORM 4410-READ-TEMP-STORAGE                           12590003
126000     END-IF.                                                      12600003
126100                                                                  12610003
126200                                                                  12620003
126300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12630003
126400                       ASC-NUMBER-OF-SELECTED-ITEMS.              12640003
126500                                                                  12650003
126600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12660003
126700                                                                  12670003
126800*----------------------------------------------------------------*12680003
126900*    MARK EACH ITEM AS BEING SELECTED.                           *12690003
127000*----------------------------------------------------------------*12700003
127100 2151-SET-SELECTED-INDS.                                          12710003
127200                                                                  12720003
127300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12730003
127400             NOT EQUAL ZERO                                       12740003
127500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12750003
127600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12760003
127700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12770003
127800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12780003
127900                               TO  TRUE                           12790003
128000         END-IF                                                   12800003
128100     END-IF.                                                      12810003
128200                                                                  12820003
128300******************************************************************12830003
128400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12840003
128500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12850003
128600******************************************************************12860003
128700 2200-MOVE-SCREEN-TO-COMMAREA.                                    12870003
128800                                                                  12880003
128900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12890003
129000     MOVE +1                       TO PV-SUB.                     12900003
129100*                                                                 12910003
129200     PERFORM 3100-SET-SUBSCRIPTS.                                 12920003
129300     IF  ASTRTITL > ZERO                                          12930003
129400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12940003
129500     ELSE                                                         12950003
129600         IF  ASTRTITF = DP015-ERASE-EOF                           12960003
129700             INITIALIZE ASC-START-ITEM-REQUEST                    12970003
129800         END-IF                                                   12980003
129900     END-IF.                                                      12990003
130000                                                                  13000003
130100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13010003
130200         VARYING PV-SUB                                           13020003
130300         FROM 1 BY 1                                              13030003
130400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13040003
130500******************************************************************13050003
130600** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**13060003
130700******************************************************************13070003
130800 2210-MOVE-LINES-TO-COMMAREA.                                     13080003
130900     IF  MR-SELECTL (PV-SUB) > ZERO                               13090003
131000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13100003
131100         MOVE MR-SELECTI (PV-SUB)                                 13110003
131200                                   TO ASC-TEMP-SELECTED-SW        13120003
131300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13130003
131400     ELSE                                                         13140003
131500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13150003
131600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13160003
131700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13170003
131800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13180003
131900         END-IF                                                   13190003
132000     END-IF.                                                      13200003
132100     ADD +1                        TO ASC-ITEM-SUB.               13210003
132200                                                                  13220003
132300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13230003
132400         ADD +1                    TO ASC-BLK-SUB                 13240003
132500         MOVE +1                   TO ASC-ITEM-SUB                13250003
132600     END-IF.                                                      13260003
132700******************************************************************13270003
132800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13280003
132900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13290003
133000******************************************************************13300003
133100 3000-EDIT-DATA-IN-COMMAREA.                                      13310003
133200     SET PS-NO-ERROR               TO TRUE.                       13320003
133300     PERFORM 3200-RESET-ATTRIBUTES.                               13330003
133400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13340003
133500                                                                  13350003
133600**                                                                13360003
133700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13370003
133800* EDITTING IS DONE FROM THE BOTTOM UP.                            13380003
133900**                                                                13390003
134000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13400003
134100         ASC-ITEMS-DISPLAYED - 1.                                 13410003
134200     PERFORM 3100-SET-SUBSCRIPTS.                                 13420003
134300*                                                                 13430003
134400     IF  PS-NO-ERROR                                              13440003
134500         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        13450003
134600     END-IF.                                                      13460003
134700                                                                  13470003
134800     IF  PS-NO-ERROR                                              13480003
134900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13490003
135000     END-IF.                                                      13500003
135100*                                                                 13510003
135200     IF  ((PS-NO-ERROR)                                           13520003
135300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13530003
135400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13540003
135500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13550003
135600     END-IF.                                                      13560003
135700                                                                  13570003
135800*----------------------------------------------------------------*13580003
135900*   3005-EDIT-COMMAREA-BLOCKS                                    *13590003
136000*----------------------------------------------------------------*13600003
136100 3005-EDIT-COMMAREA-BLOCKS.                                       13610003
136200     MOVE +1                       TO PV-BLOCK-NUMBER.            13620003
136300     MOVE +1                       TO ASC-BLK-SUB.                13630003
136400     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               13640003
136500                                                                  13650003
136600     COMPUTE PV-BLOCK-NUMBER  =                                   13660003
136700        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 13670003
136800            PC-ITEMS-PER-PANEL.                                   13680003
136900                                                                  13690003
137000     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          13700003
137100                                                                  13710003
137200     PERFORM                                                      13720003
137300       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          13730003
137400          OR PS-ERROR                                             13740003
137500          OR PS-BLOCK-ERROR                                       13750003
137600                                                                  13760003
137700             COMPUTE PV-ITEMS-HOLD  =                             13770003
137800                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        13780003
137900                     PC-ITEMS-PER-PANEL - 1                       13790003
138000                                                                  13800003
138100             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       13810003
138200                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               13820003
138300                     FROM  PV-ITEMS-HOLD                          13830003
138400                   GIVING  PV-ITEMS-DIFF                          13840003
138500                 SUBTRACT  PV-ITEMS-DIFF                          13850003
138600                     FROM  PC-ITEMS-PER-PANEL                     13860003
138700                   GIVING  PV-ITEMS-HOLD                          13870003
138800                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              13880003
138900                                              ASC-ITEM-SUB        13890003
139000                                              ASC-ITEMS-DISPLAYED 13900003
139100             ELSE                                                 13910003
139200                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              13920003
139300                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        13930003
139400             END-IF                                               13940003
139500                                                                  13950003
139600             PERFORM 3300-EDIT-SELECTIONS                         13960003
139700                     VARYING PV-SUB                               13970003
139800                        FROM PV-SUB BY -1                         13980003
139900                       UNTIL PV-SUB < +1                          13990003
140000                                                                  14000003
140100             MOVE +1               TO ASC-BLK-SUB                 14010003
140200                                                                  14020003
140300             PERFORM 5105-REWRITE-ASC-LISTQ                       14030003
140400                                                                  14040003
140500             MOVE +1                TO ASC-BLK-SUB                14050003
140600                                                                  14060003
140700             IF  PS-BLOCK-ERROR                                   14070003
140800                 SET  PS-ERROR     TO TRUE                        14080003
140900                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        14090003
141000                                   TO PV-TOP-ITEM                 14100003
141100             ELSE                                                 14110003
141200                 ADD  +1           TO PV-BLOCK-NUMBER             14120003
141300                 IF  PV-BLOCK-NUMBER >                            14130003
141400                     ASC-HIGHEST-BLOCK-WRITTEN                    14140003
141500                     MOVE +2       TO ASC-BLK-SUB                 14150003
141600                     PERFORM 4410-READ-TEMP-STORAGE               14160003
141700                     MOVE +1       TO ASC-BLK-SUB                 14170003
141800                 ELSE                                             14180003
141900                     PERFORM 4410-READ-TEMP-STORAGE               14190003
142000                     ADD  +1        TO PV-BLOCK-NUMBER            14200003
142100                     MOVE +2        TO ASC-BLK-SUB                14210003
142200                     PERFORM 4410-READ-TEMP-STORAGE               14220003
142300                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            14230003
142400                     MOVE +1        TO ASC-BLK-SUB                14240003
142500                 END-IF                                           14250003
142600             END-IF                                               14260003
142700     END-PERFORM.                                                 14270003
142800                                                                  14280003
142900     IF  PV-ORIGINAL-BLOCK  = +1    OR                            14290003
143000         PS-ERROR                   OR                            14300003
143100         PS-BLOCK-ERROR                                           14310003
143200         CONTINUE                                                 14320003
143300     ELSE                                                         14330003
143400         MOVE +1                 TO PV-BLOCK-NUMBER               14340003
143500         MOVE +1                 TO ASC-BLK-SUB                   14350003
143600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  14360003
143700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           14370003
143800         PERFORM 4410-READ-TEMP-STORAGE                           14380003
143900                                                                  14390003
144000         PERFORM                                                  14400003
144100           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              14410003
144200              OR PS-ERROR                                         14420003
144300              OR PS-BLOCK-ERROR                                   14430003
144400                                                                  14440003
144500                 COMPUTE PV-ITEMS-HOLD  =                         14450003
144600                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    14460003
144700                         PC-ITEMS-PER-PANEL - 1                   14470003
144800                                                                  14480003
144900                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     14490003
145000                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           14500003
145100                         FROM  PV-ITEMS-HOLD                      14510003
145200                       GIVING  PV-ITEMS-DIFF                      14520003
145300                     SUBTRACT  PV-ITEMS-DIFF                      14530003
145400                         FROM  PC-ITEMS-PER-PANEL                 14540003
145500                       GIVING  PV-ITEMS-HOLD                      14550003
145600                         MOVE  PV-ITEMS-HOLD TO PV-SUB            14560003
145700                                                ASC-ITEM-SUB      14570003
145800                                               ASC-ITEMS-DISPLAYED14580003
145900                 ELSE                                             14590003
146000                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          14600003
146100                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    14610003
146200                 END-IF                                           14620003
146300                                                                  14630003
146400                 PERFORM 3300-EDIT-SELECTIONS                     14640003
146500                         VARYING PV-SUB                           14650003
146600                            FROM PV-SUB BY -1                     14660003
146700                           UNTIL PV-SUB < +1                      14670003
146800                                                                  14680003
146900                 MOVE +1               TO ASC-BLK-SUB             14690003
147000                                                                  14700003
147100                 PERFORM 5105-REWRITE-ASC-LISTQ                   14710003
147200                                                                  14720003
147300                 MOVE +1                TO ASC-BLK-SUB            14730003
147400                                                                  14740003
147500                 IF  PS-BLOCK-ERROR                               14750003
147600                     SET  PS-ERROR     TO TRUE                    14760003
147700                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    14770003
147800                                       TO PV-TOP-ITEM             14780003
147900                 ELSE                                             14790003
148000                     ADD  +1            TO PV-BLOCK-NUMBER        14800003
148100                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      14810003
148200                         MOVE +2        TO ASC-BLK-SUB            14820003
148300                         PERFORM 4410-READ-TEMP-STORAGE           14830003
148400                         MOVE +1        TO ASC-BLK-SUB            14840003
148500                     ELSE                                         14850003
148600                         PERFORM 4410-READ-TEMP-STORAGE           14860003
148700                         ADD  +1        TO PV-BLOCK-NUMBER        14870003
148800                         MOVE +2        TO ASC-BLK-SUB            14880003
148900                         PERFORM 4410-READ-TEMP-STORAGE           14890003
149000                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        14900003
149100                         MOVE +1        TO ASC-BLK-SUB            14910003
149200                     END-IF                                       14920003
149300                 END-IF                                           14930003
149400     END-PERFORM.                                                 14940003
149500                                                                  14950003
149600*----------------------------------------------------------------*14960003
149700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14970003
149800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14980003
149900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14990003
150000*                                                                *15000003
150100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *15010003
150200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *15020003
150300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *15030003
150400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *15040003
150500*----------------------------------------------------------------*15050003
150600 3100-SET-SUBSCRIPTS.                                             15060003
150700                                                                  15070003
150800     COMPUTE ASC-ITEM-SUB =                                       15080003
150900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15090003
151000                                                                  15100003
151100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15110003
151200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15120003
151300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15130003
151400     ELSE                                                         15140003
151500         MOVE +1                     TO ASC-BLK-SUB               15150003
151600     END-IF.                                                      15160003
151700******************************************************************15170003
151800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **15180003
151900******************************************************************15190003
152000 3200-RESET-ATTRIBUTES.                                           15200003
152100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   15210003
152200     MOVE DP015-GREEN              TO ASTRTITC.                   15220003
152300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15230003
152400                                                                  15240003
152500     PERFORM                                                      15250003
152600         VARYING PV-SUB                                           15260003
152700         FROM 1 BY 1                                              15270003
152800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15280003
152900             MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)    15290003
153000             MOVE DP015-GREEN         TO MR-SELECTC (PV-SUB)      15300003
153100             MOVE DP015-UNDERLINE     TO MR-SELECTH (PV-SUB)      15310003
153200     END-PERFORM.                                                 15320003
153300                                                                  15330003
153400******************************************************************15340003
153500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **15350003
153600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **15360003
153700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **15370003
153800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **15380003
153900******************************************************************15390003
154000 3300-EDIT-SELECTIONS.                                            15400003
154100     EVALUATE TRUE                                                15410003
154200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15420003
154300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15430003
154400                 CONTINUE                                         15440003
154500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15450003
154600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15460003
154700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   15470003
154800                 MOVE ASC-TEMP-SELECTED-SW                        15480003
154900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15490003
155000                                TO ASC-SELECTED-SW                15500003
155100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15510003
155200             END-IF                                               15520003
155300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15530003
155400                 = SPACE                                          15540003
155500             EVALUATE TRUE                                        15550003
155600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15560003
155700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15570003
155800                     MOVE SPACE TO ASC-SELECTED-SW                15580003
155900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15590003
156000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15600003
156100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15610003
156200                     MOVE SPACE TO ASC-SELECTED-SW                15620003
156300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15630003
156400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15640003
156500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15650003
156600                     MOVE SPACE TO ASC-SELECTED-SW                15660003
156700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15670003
156800             END-EVALUATE                                         15680003
156900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           15690003
157000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15700003
157100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15710003
157200             END-IF                                               15720003
157300             PERFORM 3310-EDIT-RANGE                              15730003
157400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15740003
157500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15750003
157600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15760003
157700             END-IF                                               15770003
157800             PERFORM 3310-EDIT-RANGE                              15780003
157900         WHEN OTHER                                               15790003
158000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15800003
158100             SET DP020-MSG-FATAL    TO TRUE                       15810003
158200             MOVE -1                TO MR-SELECTL (PV-SUB)        15820003
158300             SET DP030-SET-CURSOR-APPL-1                          15830003
158400                                    TO TRUE                       15840003
158500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15850003
158600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15860003
158700             SET PS-ERROR TO TRUE                                 15870003
158800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15880003
158900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15890003
159000                 MOVE SPACE         TO ASC-SELECTED-SW            15900003
159100                                        (ASC-BLK-SUB ASC-ITEM-SUB)15910003
159200             END-IF                                               15920003
159300     END-EVALUATE.                                                15930003
159400                                                                  15940003
159500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 15950003
159600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15960003
159700     IF  ASC-ITEM-SUB < 1                                         15970003
159800         SUBTRACT +1 FROM ASC-BLK-SUB                             15980003
159900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15990003
160000     END-IF.                                                      16000003
160100                                                                  16010003
160200******************************************************************16020003
160300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **16030003
160400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **16040003
160500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**16050003
160600** THE ENDING.                                                  **16060003
160700******************************************************************16070003
160800 3310-EDIT-RANGE.                                                 16080003
160900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16090003
161000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16100003
161100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16110003
161200                                   TO ASC-SELECTED-SW             16120003
161300                                        (ASC-BLK-SUB ASC-ITEM-SUB)16130003
161400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16140003
161500         ELSE                                                     16150003
161600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16160003
161700                 CONTINUE                                         16170003
161800             ELSE                                                 16180003
161900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16190003
162000                 MOVE PC-TSYMSG-00054                             16200003
162100                                       TO DP020-MSG-NUMBER        16210003
162200                 MOVE -1               TO MR-SELECTL (PV-SUB)     16220003
162300                 MOVE DP015-RED        TO MR-SELECTC (PV-SUB)     16230003
162400                 MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)     16240003
162500                 SET DP020-MSG-FATAL                              16250003
162600                     DP030-SET-CURSOR-APPL-1                      16260003
162700                     PS-ERROR          TO TRUE                    16270003
162800             END-IF                                               16280003
162900         END-IF                                                   16290003
163000     ELSE                                                         16300003
163100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16310003
163200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16320003
163300                                   TO ASC-SELECTED-SW             16330003
163400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16340003
163500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16350003
163600         ELSE                                                     16360003
163700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16370003
163800                 CONTINUE                                         16380003
163900             ELSE                                                 16390003
164000*                -- ONLY ONE END-OF-RANGE ALLOWED --              16400003
164100                 MOVE PC-TSYMSG-00055                             16410003
164200                                        TO DP020-MSG-NUMBER       16420003
164300                 MOVE -1                TO MR-SELECTL (PV-SUB)    16430003
164400                 SET DP020-MSG-FATAL                              16440003
164500                     DP030-SET-CURSOR-APPL-1                      16450003
164600                     PS-ERROR           TO TRUE                   16460003
164700             END-IF                                               16470003
164800         END-IF                                                   16480003
164900     END-IF.                                                      16490003
165000*                                                                 16500003
165100******************************************************************16510003
165200** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **16520003
165300** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **16530003
165400******************************************************************16540003
165500 3400-CHECK-RANGE-SEQUENCE.                                       16550003
165600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16560003
165700       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      16570003
165800       AND  ASC-START-OF-SELECTED-RANGE >                         16580003
165900                                         ASC-END-OF-SELECTED-RANGE16590003
166000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                16600003
166100         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 16610003
166200         SET DP020-MSG-FATAL TO TRUE                              16620003
166300         SET PS-ERROR TO TRUE                                     16630003
166400         PERFORM 3410-POSITION-AT-ERROR                           16640003
166500     END-IF.                                                      16650003
166600******************************************************************16660003
166700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **16670003
166800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **16680003
166900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **16690003
167000******************************************************************16700003
167100 3410-POSITION-AT-ERROR.                                          16710003
167200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       16720003
167300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16730003
167400                    - PV-TOP-ITEM + 1.                            16740003
167500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16750003
167600         CONTINUE                                                 16760003
167700     ELSE                                                         16770003
167800         MOVE -1                   TO MR-SELECTL (PV-SUB)         16780003
167900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16790003
168000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16800003
168100     END-IF.                                                      16810003
168200*                                                                 16820003
168300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16830003
168400                    - PV-TOP-ITEM + 1.                            16840003
168500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16850003
168600         CONTINUE                                                 16860003
168700     ELSE                                                         16870003
168800         MOVE -1                   TO MR-SELECTL (PV-SUB)         16880003
168900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16890003
169000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16900003
169100     END-IF.                                                      16910003
169200                                                                  16920003
169300*----------------------------------------------------------------*16930003
169400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16940003
169500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16950003
169600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16960003
169700*----------------------------------------------------------------*16970003
169800 3500-MARK-RANGE-AS-SELECTED.                                     16980003
169900     MOVE +1                       TO  ASC-BLK-SUB.               16990003
170000     PERFORM 3510-MARK-SELECTED-INDS                              17000003
170100         VARYING ASC-ITEM-SUB                                     17010003
170200         FROM 1 BY 1                                              17020003
170300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17030003
170400                                                                  17040003
170500     ADD +1                        TO ASC-BLK-SUB.                17050003
170600     PERFORM 3510-MARK-SELECTED-INDS                              17060003
170700         VARYING ASC-ITEM-SUB                                     17070003
170800         FROM 1 BY 1                                              17080003
170900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17090003
171000                                                                  17100003
171100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17110003
171200                                   TO  PV-LIST-ITEM-NUMBER.       17120003
171300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17130003
171400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17140003
171500               PC-ITEMS-PER-PANEL).                               17150003
171600                                                                  17160003
171700     MOVE ASC-START-OF-SELECTED-RANGE                             17170003
171800                                   TO PV-START-OF-SELECTED-RANGE. 17180003
171900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17190003
172000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17200003
172100               PC-ITEMS-PER-PANEL).                               17210003
172200                                                                  17220003
172300     MOVE ASC-END-OF-SELECTED-RANGE                               17230003
172400                                   TO  PV-END-OF-SELECTED-RANGE.  17240003
172500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17250003
172600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17260003
172700               PC-ITEMS-PER-PANEL).                               17270003
172800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17280003
172900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17290003
173000                                                                  17300003
173100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17310003
173200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17320003
173300         MOVE +1                   TO ASC-BLK-SUB                 17330003
173400         PERFORM 5100-WRITE-TEMP-STORAGE                          17340003
173500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17350003
173600             PV-FIRST-BLOCK-IN-ARRAY - 1                          17360003
173700                                                                  17370003
173800         PERFORM                                                  17380003
173900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17390003
174000                   PV-PREV-BLOCK-IN-ARRAY                         17400003
174100             MOVE PV-FIRST-BLOCK-IN-RANGE                         17410003
174200                                   TO PV-BLOCK-NUMBER             17420003
174300             PERFORM 4410-READ-TEMP-STORAGE                       17430003
174400             PERFORM 3510-MARK-SELECTED-INDS                      17440003
174500                 VARYING ASC-ITEM-SUB                             17450003
174600                 FROM 1 BY 1                                      17460003
174700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17470003
174800             PERFORM 5100-WRITE-TEMP-STORAGE                      17480003
174900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     17490003
175000         END-PERFORM                                              17500003
175100                                                                  17510003
175200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17520003
175300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17530003
175400         PERFORM                                                  17540003
175500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17550003
175600                   PV-LAST-BLOCK-IN-RANGE                         17560003
175700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17570003
175800                                   TO PV-BLOCK-NUMBER             17580003
175900             PERFORM 4410-READ-TEMP-STORAGE                       17590003
176000             PERFORM 3510-MARK-SELECTED-INDS                      17600003
176100                 VARYING ASC-ITEM-SUB                             17610003
176200                 FROM 1 BY 1                                      17620003
176300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17630003
176400             PERFORM 5100-WRITE-TEMP-STORAGE                      17640003
176500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17650003
176600         END-PERFORM                                              17660003
176700                                                                  17670003
176800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17680003
176900                                   TO PV-BLOCK-NUMBER             17690003
177000         PERFORM 4410-READ-TEMP-STORAGE                           17700003
177100     END-IF.                                                      17710003
177200                                                                  17720003
177300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17730003
177400                                      ASC-END-OF-SELECTED-RANGE.  17740003
177500                                                                  17750003
177600*----------------------------------------------------------------*17760003
177700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17770003
177800*----------------------------------------------------------------*17780003
177900 3510-MARK-SELECTED-INDS.                                         17790003
178000                                                                  17800003
178100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17810003
178200                                ASC-ITEM-SUB) >                   17820003
178300         ASC-START-OF-SELECTED-RANGE)                             17830003
178400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17840003
178500                                ASC-ITEM-SUB) =                   17850003
178600         ASC-START-OF-SELECTED-RANGE)                             17860003
178700                                                                  17870003
178800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17880003
178900                                    ASC-ITEM-SUB) <               17890003
179000             ASC-END-OF-SELECTED-RANGE)                           17900003
179100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17910003
179200                                    ASC-ITEM-SUB) =               17920003
179300             ASC-END-OF-SELECTED-RANGE)                           17930003
179400                                                                  17940003
179500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17950003
179600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17960003
179700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17970003
179800                               TO TRUE                            17980003
179900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17990003
180000                               TO TRUE                            18000003
180100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    18010003
180200             END-IF                                               18020003
180300         END-IF                                                   18030003
180400     END-IF.                                                      18040003
180500                                                                  18050003
180600*----------------------------------------------------------------*18060003
180700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18070003
180800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18080003
180900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18090003
181000*    DISPLAY THE PANEL TO USER.                                  *18100003
181100*----------------------------------------------------------------*18110003
181200 4000-BUILD-INITIAL-PANEL.                                        18120003
181300                                                                  18130003
181400     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            18140003
181500                                 ASC-BLOCK-ENTRIES (2).           18150003
181600     MOVE +1                 TO ASC-BLK-SUB.                      18160003
181700     SET ASC-ITEMS-LEFT-ON-DB                                     18170003
181800                             TO TRUE.                             18180003
181900                                                                  18190003
182000     MOVE +0                 TO ASC-ITEM-SUB                      18200003
182100                                ASC-NUMBER-OF-ITEMS-READ          18210003
182200                                ASC-NUMBER-OF-SELECTED-ITEMS      18220003
182300                                ASC-HIGHEST-BLOCK-WRITTEN         18230003
182400                                ASC-START-OF-SELECTED-RANGE       18240003
182500                                ASC-END-OF-SELECTED-RANGE         18250003
182600                                ASC-ITEM-AT-TOP-OF-PANEL.         18260003
182700                                                                  18270003
182800     MOVE ASC-OPER-UNT-ID      TO  DK-OPER-UNT-ID.                18280011
182900     MOVE ASC-TRLR-SRL-NMBR    TO  DK-TRLR-SRL-NBR.               18290011
183000     MOVE ASC-OUTBOUND-TRIP-ID TO  DK-TRIP-ID.                    18300011
183100                                                                  18310003
183140     INITIALIZE XL071-COMMAREA-REC.                               18314011
183150     MOVE DK-OPER-UNT-ID  TO XL071-LOCATION-NUMBER.               18315011
183160                                                                  18316011
183170     CALL PC-LOCATION-MODULE  USING DFHEIBLK                      18317011
183180                                    XL071-COMMAREA                18318011
183190                                    XL071-COMMAREA-REC.           18319011
183191                                                                  18319111
183192     IF XL071-NO-ERRORS                                           18319211
183193         MOVE XL071-LOC-NM  TO  ASC-OPER-UNT-NAME                 18319311
183195     ELSE                                                         18319511
183196         MOVE SPACES        TO  ASC-OPER-UNT-NAME                 18319611
183230     END-IF.                                                      18323011
184500                                                                  18450003
184600     PERFORM 4100-PREPARE-CURSOR.                                 18460003
184700     PERFORM 4050-SELECT-SCAC-DESC.                               18470003
184800     PERFORM 4010-OPEN-CURSOR.                                    18480003
184900     PERFORM 4300-READ-ITEMS-FROM-DB.                             18490003
185000     PERFORM 4020-CLOSE-CURSOR.                                   18500003
185100                                                                  18510003
185200     MOVE +1                   TO  PV-TOP-ITEM.                   18520003
185300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          18530003
185400         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    18540003
185500         SET DP020-MSG-FATAL   TO  TRUE                           18550003
185600         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               18560003
185700     ELSE                                                         18570003
185800         MOVE -1               TO MR-SELECTL (1)                  18580003
185900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      18590003
186000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     18600003
186100     END-IF.                                                      18610003
186200                                                                  18620003
186300*----------------------------------------------------------------*18630003
186400* OPEN THE CURSOR                                                 18640003
186500*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *18650003
186600*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *18660003
186700*   USER.                                                        *18670003
186800*----------------------------------------------------------------*18680003
186900 4010-OPEN-CURSOR.                                                18690003
187000     PERFORM                                                      18700003
187100         WITH TEST AFTER                                          18710003
187200         VARYING PV-RETRY-COUNTER                                 18720003
187300         FROM 1 BY 1                                              18730003
187400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18740003
187500                   OR (SQLCODE = ZERO))                           18750003
187600                                                                  18760003
187700         EVALUATE TRUE                                            18770003
187800             WHEN PS-TRLR-SRL-NBR-CSR                             18780003
187900                 EXEC SQL                                         18790003
188000                      OPEN TRLR-SRL-NBR-CSR                       18800003
188100                 END-EXEC                                         18810003
188200                                                                  18820003
188300             WHEN PS-TRIP-ID-CSR                                  18830003
188400                 EXEC SQL                                         18840003
188500                      OPEN TRIP-ID-CSR                            18850003
188600                 END-EXEC                                         18860003
188700                                                                  18870003
188800             WHEN PS-TRLR-SEAL-ID-CSR                             18880003
188900                 EXEC SQL                                         18890003
189000                      OPEN TRLR-SEAL-ID-CSR                       18900003
189100                 END-EXEC                                         18910003
189200                                                                  18920003
189300         END-EVALUATE                                             18930003
189400                                                                  18940003
189500         EVALUATE TRUE                                            18950003
189600             WHEN SQLCODE = ZERO                                  18960003
189700             WHEN SQLCODE = -904                                  18970003
189800             WHEN SQLCODE = -913                                  18980003
189900                 CONTINUE                                         18990003
190000             WHEN SQLWARN0 NOT = SPACES                           19000003
190100             WHEN SQLCODE < ZERO                                  19010003
190200             WHEN SQLCODE > ZERO                                  19020003
190300                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       19030003
190400                 MOVE 'OPEN CURSOR PROBLEM    - '                 19040003
190500                                   TO DP013-MESSAGE-TEXT (1)      19050003
190600                 MOVE SQLCA        TO DP013-SQLCA                 19060003
190700                 MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (1)    19070003
190800                 SET DP013-DB2-ABEND                              19080003
190900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19090003
191000                 PERFORM DP013-0000-PROCESS-ABEND                 19100003
191100         END-EVALUATE                                             19110003
191200     END-PERFORM.                                                 19120003
191300*                                                                 19130003
191400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19140003
191500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             19150003
191600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   19160003
191700                                   TO DP013-MESSAGE-TEXT (1)      19170003
191800         MOVE SQLCA                TO DP013-SQLCA                 19180003
191900         MOVE 'TSUOBTR '           TO DP013-DB2-TABLE-NAME (1)    19190003
192000         SET DP013-DB2-ABEND                                      19200003
192100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   19210003
192200         PERFORM DP013-0000-PROCESS-ABEND                         19220003
192300     END-IF.                                                      19230003
192400                                                                  19240003
192500*----------------------------------------------------------------*19250003
192600* CLOSE THE CURSOR.                                               19260003
192700*   IN THIS PARTICULAR APPLICATION ONE OF 5 DIFFERENT CURSORS    *19270003
192800*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *19280003
192900*   USER.                                                        *19290003
193000*----------------------------------------------------------------*19300003
193100 4020-CLOSE-CURSOR.                                               19310003
193200                                                                  19320003
193300     EVALUATE TRUE                                                19330003
193400         WHEN PS-TRLR-SRL-NBR-CSR                                 19340003
193500             EXEC SQL                                             19350003
193600                  CLOSE TRLR-SRL-NBR-CSR                          19360003
193700             END-EXEC                                             19370003
193800                                                                  19380003
193900         WHEN PS-TRIP-ID-CSR                                      19390003
194000             EXEC SQL                                             19400003
194100                  CLOSE TRIP-ID-CSR                               19410003
194200             END-EXEC                                             19420003
194300                                                                  19430003
194400         WHEN PS-TRLR-SEAL-ID-CSR                                 19440003
194500             EXEC SQL                                             19450003
194600                  CLOSE TRLR-SEAL-ID-CSR                          19460003
194700             END-EXEC                                             19470003
194800     END-EVALUATE.                                                19480003
194900                                                                  19490003
195000     EVALUATE TRUE                                                19500003
195100         WHEN SQLCODE = ZERO                                      19510003
195200         WHEN SQLCODE = +100                                      19520003
195300             CONTINUE                                             19530003
195400         WHEN SQLWARN0 NOT = SPACES                               19540003
195500         WHEN SQLCODE < ZERO                                      19550003
195600         WHEN SQLCODE > ZERO                                      19560003
195700             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          19570003
195800             MOVE 'CLOSE CURSOR PROBLEM   '                       19580003
195900                               TO DP013-MESSAGE-TEXT (1)          19590003
196000             MOVE SQLCA        TO DP013-SQLCA                     19600003
196100             MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (1)        19610003
196200             SET DP013-DB2-ABEND                                  19620003
196300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19630003
196400             PERFORM DP013-0000-PROCESS-ABEND                     19640003
196500     END-EVALUATE.                                                19650003
196600                                                                  19660003
196700 4050-SELECT-SCAC-DESC.                                           19670003
196800     PERFORM                                                      19680003
196900         WITH TEST AFTER                                          19690003
197000         VARYING PV-RETRY-COUNTER                                 19700003
197100         FROM 1 BY 1                                              19710003
197200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19720003
197300                   OR (SQLCODE = ZERO)                            19730003
197310                   OR (SQLCODE = +100))                           19731003
197320                                                                  19732003
197330         EVALUATE TRUE                                            19733003
197340             WHEN PS-TRLR-SRL-NBR-CSR                             19734003
197350               EXEC SQL                                           19735003
197360                 SELECT  B.SCAC_CDE                               19736008
197371                      ,  D.ENT_NAME_DESC                          19737108
197372                   INTO  :CNTRID-SCAC-CDE                         19737208
197373                      ,  :ENTNME-ENT-NAME-DESC                    19737308
197380*                  FROM  TSUOBTR A                                19738010
197390                   FROM  TCNTRID B                                19739010
197400                      ,  TEXTENT C                                19740003
197500                      ,  TENTNME D                                19750003
197600*                 WHERE  A.TRLR_SRL_NBR     = :DK-TRLR-SRL-NBR    19760010
197700*                   AND  A.TRIP_ACTV_CDE    = 'A'                 19770010
197800*                   AND  A.ORGN_OPER_UNT_ID = :DK-OPER-UNT-ID     19780010
197900*                   AND  A.TRLR_SRL_NBR     = B.TRLR_SRL_NBR      19790010
197910                  WHERE  B.TRLR_SRL_NBR     = :DK-TRLR-SRL-NBR    19791010
198000                    AND  B.SCAC_CDE         = C.SCAC_CDE          19800007
198100                    AND  C.CARRIER_IND      = 'Y'                 19810003
198200                    AND  C.ENT_ID           = D.ENT_ID            19820003
198300                    AND  C.STATUS_CDE       = 'A'                 19830003
198400                    AND  D.TYPE_CDE         = '01'                19840003
198500                  WITH UR                                         19850013
199000                 END-EXEC                                         19900003
199100                                                                  19910003
199200             WHEN PS-TRIP-ID-CSR                                  19920003
199300               EXEC SQL                                           19930003
199310                 SELECT  B.SCAC_CDE                               19931008
199320                      ,  D.ENT_NAME_DESC                          19932008
199330                   INTO  :CNTRID-SCAC-CDE                         19933008
199340                      ,  :ENTNME-ENT-NAME-DESC                    19934008
199600                   FROM  TSUOBTR A                                19960003
199700                      ,  TCNTRID B                                19970007
199800                      ,  TEXTENT C                                19980003
199900                      ,  TENTNME D                                19990003
200000                  WHERE  A.OTBND_TRIP_ID     = :DK-TRIP-ID        20000003
200100                    AND  A.TRIP_ACTV_CDE     = 'A'                20010003
200200                    AND  A.ORGN_OPER_UNT_ID  = :DK-OPER-UNT-ID    20020003
200300                    AND  A.TRLR_SRL_NBR      = B.TRLR_SRL_NBR     20030007
200400                    AND  B.SCAC_CDE          = C.SCAC_CDE         20040007
200500                    AND  C.CARRIER_IND       = 'Y'                20050007
200600                    AND  C.ENT_ID            = D.ENT_ID           20060007
200700                    AND  C.STATUS_CDE        = 'A'                20070007
200800                    AND  D.TYPE_CDE          = '01'               20080007
200900                  WITH UR                                         20090013
201300                 END-EXEC                                         20130003
201400                                                                  20140003
201500             WHEN PS-TRLR-SEAL-ID-CSR                             20150003
201600               EXEC SQL                                           20160003
201610                 SELECT  RID.SCAC_CDE                             20161009
201620                      ,  NME.ENT_NAME_DESC                        20162009
201630                   INTO  :CNTRID-SCAC-CDE                         20163008
201640                      ,  :ENTNME-ENT-NAME-DESC                    20164008
201900                   FROM  TSUOBTR BTR                              20190003
202000                      ,  TSUOBTS BTS                              20200007
202010                      ,  TCNTRID RID                              20201007
202100                      ,  TEXTENT ENT                              20210003
202200                      ,  TENTNME NME                              20220003
202300                  WHERE  BTR.OTBND_TRIP_ID    = BTS.OTBND_TRIP_ID 20230007
202310                    AND  BTR.TRLR_SRL_NBR     = RID.TRLR_SRL_NBR  20231007
202400                    AND  RID.SCAC_CDE         = ENT.SCAC_CDE      20240007
202500                    AND  ENT.ENT_ID           = NME.ENT_ID        20250003
202700                    AND  BTR.ORGN_OPER_UNT_ID = :DK-OPER-UNT-ID   20270003
202900                    AND  BTS.TRLR_SEAL_ID     = :DK-TRLR-SEAL-NBR 20290003
203000                    AND  BTS.TRIP_STAT_CDE    = 'DC'              20300003
203200                    AND  ENT.CARRIER_IND      = 'Y'               20320003
203300                    AND  ENT.STATUS_CDE       = 'A'               20330003
203500                    AND  NME.TYPE_CDE         = '01'              20350003
203510                  WITH UR                                         20351013
203600                 END-EXEC                                         20360003
203700                                                                  20370003
203800         END-EVALUATE                                             20380003
203900                                                                  20390003
204000         EVALUATE TRUE                                            20400003
204100             WHEN SQLCODE = ZERO                                  20410003
204200             WHEN SQLCODE = -811                                  20420003
204300                 MOVE CNTRID-SCAC-CDE         TO ASC-SCAC         20430008
204310                 MOVE ENTNME-ENT-NAME-DESC    TO ASC-SCAC-DESC    20431008
204400             WHEN SQLCODE = +100                                  20440003
204500                 MOVE SPACES                  TO ASC-SCAC         20450008
204510                                                 ASC-SCAC-DESC    20451008
204600             WHEN SQLCODE = -904                                  20460003
204700             WHEN SQLCODE = -913                                  20470003
204800                 CONTINUE                                         20480003
204900             WHEN SQLWARN0 NOT = SPACES                           20490003
205000             WHEN SQLCODE < ZERO                                  20500003
205100             WHEN SQLCODE > ZERO                                  20510003
205200                 MOVE '4050-SELECT-SCAC-DESC' TO DP013-PARAGRAPH  20520003
205300                 MOVE 'SELECT SCAC AND DESC   - '                 20530003
205400                                   TO DP013-MESSAGE-TEXT (1)      20540003
205500                 MOVE SQLCA        TO DP013-SQLCA                 20550003
205600                 MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (1)    20560003
205700                 MOVE 'TSUOBTS '   TO DP013-DB2-TABLE-NAME (2)    20570003
205800                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (3)    20580003
205900                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (4)    20590003
206000                 SET DP013-DB2-ABEND                              20600003
206100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20610003
206200                 PERFORM DP013-0000-PROCESS-ABEND                 20620003
206300         END-EVALUATE                                             20630003
206400     END-PERFORM.                                                 20640003
206500*                                                                 20650003
206600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20660003
206700         MOVE '4050-SELECT-SCAC-DESC' TO DP013-PARAGRAPH          20670003
206800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO GET SCAC'   20680003
206900                                   TO DP013-MESSAGE-TEXT (1)      20690003
207000         MOVE SQLCA                TO DP013-SQLCA                 20700003
207100         MOVE 'TSUOBTR '           TO DP013-DB2-TABLE-NAME (1)    20710003
207200         MOVE 'TSUOBTS '           TO DP013-DB2-TABLE-NAME (2)    20720003
207300         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (3)    20730003
207400         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (4)    20740003
207500         SET DP013-DB2-ABEND                                      20750003
207600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20760003
207700         PERFORM DP013-0000-PROCESS-ABEND                         20770003
207800     END-IF.                                                      20780003
207900                                                                  20790003
208000*----------------------------------------------------------------*20800003
208100*    SET UP THE HOST VARIABLES.                                  *20810003
208200*----------------------------------------------------------------*20820003
208300 4100-PREPARE-CURSOR.                                             20830003
208400     MOVE SPACE TO PS-CURSOR-SW.                                  20840003
208500     IF ASC-TRLR-SRL-NMBR > ZERO                                  20850003
208600         SET PS-TRLR-SRL-NBR-CSR TO TRUE                          20860003
208700     ELSE                                                         20870003
208800         IF ASC-OUTBOUND-TRIP-ID > ZERO                           20880003
208900             SET PS-TRIP-ID-CSR TO TRUE                           20890003
209000         ELSE                                                     20900003
209100             IF ASC-TRLR-SEAL > SPACE                             20910003
209200                 SET PS-TRLR-SEAL-ID-CSR TO TRUE                  20920003
209300                 MOVE SPACES        TO DK-TRLR-SEAL-NBR           20930003
209400                 MOVE ASC-TRLR-SEAL TO DK-TRLR-SEAL-NBR           20940003
209500             END-IF                                               20950003
209600         END-IF                                                   20960003
209700     END-IF.                                                      20970003
209800                                                                  20980003
209900*----------------------------------------------------------------*20990003
210000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *21000003
210100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *21010003
210200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *21020003
210300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *21030003
210400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *21040003
210500*                                                                *21050003
210600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *21060003
210700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *21070003
210800*    UPON INITIALIZATION.                                        *21080003
210900*----------------------------------------------------------------*21090003
211000 4300-READ-ITEMS-FROM-DB.                                         21100003
211100                                                                  21110003
211200     PERFORM                                                      21120003
211300         VARYING PV-READ-COUNT                                    21130003
211400         FROM 1 BY 1                                              21140003
211500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    21150003
211600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21160003
211700                                                                  21170003
211800         PERFORM 4310-FETCH                                       21180003
211900                                                                  21190003
212000         IF  ASC-ITEMS-LEFT-ON-DB                                 21200003
212100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                21210003
212200                 ADD +1            TO ASC-ITEM-SUB                21220003
212300             ELSE                                                 21230003
212400                 ADD +1            TO ASC-BLK-SUB                 21240003
212500                 MOVE +1           TO ASC-ITEM-SUB                21250003
212600                                                                  21260003
212700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         21270003
212800                     MOVE +1       TO ASC-BLK-SUB                 21280003
212900                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           21290003
213000                     PERFORM 5100-WRITE-TEMP-STORAGE              21300003
213100                     MOVE ASC-BLOCK-ENTRIES                       21310003
213200                                   (PC-MAX-BLOCKS-IN-ARRAY)       21320003
213300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21330003
213400                     ADD +1        TO ASC-BLK-SUB                 21340003
213500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   21350003
213600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      21360003
213700                                                          TO TRUE 21370003
213800                 END-IF                                           21380003
213900             END-IF                                               21390003
214000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    21400003
214100             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          21410003
214200             MOVE ASC-NUMBER-OF-ITEMS-READ                        21420003
214300                                   TO ASC-LIST-ITEM-NUMBER        21430003
214400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21440003
214600             MOVE SUOBTR-TRLR-SRL-NBR                             21460003
214700                   TO ASC-TRLR-SRL-NBR (ASC-BLK-SUB ASC-ITEM-SUB) 21470003
214800             MOVE SUOBTR-OTBND-TRIP-ID                            21480003
214900                        TO ASC-TRIP-ID (ASC-BLK-SUB ASC-ITEM-SUB) 21490003
215000             MOVE SUOBTR-DEST-OPER-UNT-ID                         21500003
215100                       TO ASC-DEST-NBR (ASC-BLK-SUB ASC-ITEM-SUB) 21510003
215200             MOVE SUOBTS-TRLR-SEAL-ID                             21520003
215300                   TO ASC-TRLR-SEAL-ID (ASC-BLK-SUB ASC-ITEM-SUB) 21530003
215400             MOVE PV-USA-DATE                                     21540003
215500                      TO ASC-STAT-DATE (ASC-BLK-SUB ASC-ITEM-SUB) 21550003
215600             MOVE ASC-TRIP-STATUS                                 21560003
215700                      TO ASC-TRIP-STAT (ASC-BLK-SUB ASC-ITEM-SUB) 21570003
215800             MOVE SUOBTS-OTBND-STAT-USR-ID                        21580003
215900                         TO ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB) 21590003
216000         END-IF                                                   21600003
216100     END-PERFORM.                                                 21610003
216200                                                                  21620003
216300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          21630003
216400         MOVE +1               TO ASC-BLK-SUB                     21640003
216500         PERFORM 5100-WRITE-TEMP-STORAGE                          21650003
216600         ADD +1                TO ASC-BLK-SUB                     21660003
216700         PERFORM 5100-WRITE-TEMP-STORAGE                          21670003
216800                                                                  21680003
216900         MOVE 1                TO ASC-BLK-SUB                     21690003
217000                                  PV-BLOCK-NUMBER                 21700003
217100         PERFORM 4410-READ-TEMP-STORAGE                           21710003
217200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             21720003
217300             MOVE 2            TO ASC-BLK-SUB                     21730003
217400                                  PV-BLOCK-NUMBER                 21740003
217500             PERFORM 4410-READ-TEMP-STORAGE                       21750003
217600         END-IF                                                   21760003
217700     END-IF.                                                      21770003
217800                                                                  21780003
217900*----------------------------------------------------------------*21790003
218000*    FETCH THE CURSOR                                             21800003
218100*----------------------------------------------------------------*21810003
218200 4310-FETCH.                                                      21820003
218300     EVALUATE TRUE                                                21830003
218400         WHEN PS-TRLR-SRL-NBR-CSR                                 21840003
218500             EXEC SQL                                             21850003
218600                  FETCH TRLR-SRL-NBR-CSR                          21860003
218700                  INTO  :SUOBTR-TRLR-SRL-NBR                      21870003
218800                       ,:SUOBTR-OTBND-TRIP-ID                     21880003
218900                       ,:SUOBTR-DEST-OPER-UNT-ID                  21890003
219000                       ,:SUOBTS-TRLR-SEAL-ID                      21900003
219100                       ,:PV-USA-DATE                              21910003
219200                       ,:SUOBTS-OTBND-STAT-USR-ID                 21920003
219300                       ,:SUOBTS-TRIP-STAT-CDE                     21930003
219500             END-EXEC                                             21950003
219600                                                                  21960003
219700         WHEN PS-TRIP-ID-CSR                                      21970003
219800             EXEC SQL                                             21980003
219900                  FETCH TRIP-ID-CSR                               21990003
220000                  INTO  :SUOBTR-TRLR-SRL-NBR                      22000003
220100                       ,:SUOBTR-OTBND-TRIP-ID                     22010003
220200                       ,:SUOBTR-DEST-OPER-UNT-ID                  22020003
220300                       ,:SUOBTS-TRLR-SEAL-ID                      22030003
220400                       ,:PV-USA-DATE                              22040003
220500                       ,:SUOBTS-OTBND-STAT-USR-ID                 22050003
220600                       ,:SUOBTS-TRIP-STAT-CDE                     22060003
220800             END-EXEC                                             22080003
220900                                                                  22090003
221000         WHEN PS-TRLR-SEAL-ID-CSR                                 22100003
221100             EXEC SQL                                             22110003
221200                  FETCH TRLR-SEAL-ID-CSR                          22120003
221300                  INTO  :SUOBTR-TRLR-SRL-NBR                      22130003
221400                       ,:SUOBTR-OTBND-TRIP-ID                     22140003
221500                       ,:SUOBTR-DEST-OPER-UNT-ID                  22150003
221600                       ,:SUOBTS-TRLR-SEAL-ID                      22160003
221700                       ,:PV-USA-DATE                              22170003
221800                       ,:SUOBTS-OTBND-STAT-USR-ID                 22180003
221900                       ,:SUOBTS-TRIP-STAT-CDE                     22190003
222100             END-EXEC                                             22210003
222200                                                                  22220003
222300     END-EVALUATE.                                                22230003
222400                                                                  22240003
222500     EVALUATE TRUE                                                22250003
222600         WHEN SQLCODE = ZERO                                      22260003
222700             EVALUATE SUOBTS-TRIP-STAT-CDE                        22270003
222800                 WHEN 'DO'                                        22280003
222900                     MOVE 'OPEN@DC' TO ASC-TRIP-STATUS            22290003
223000                 WHEN 'DC'                                        22300003
223100                     MOVE 'CLOS@DC' TO ASC-TRIP-STATUS            22310003
223200                 WHEN 'DS'                                        22320003
223300                     MOVE 'DCSHIPD' TO ASC-TRIP-STATUS            22330003
223400                 WHEN 'SO'                                        22340003
223500                     MOVE 'OPEN@ST' TO ASC-TRIP-STATUS            22350003
223600                 WHEN 'SU'                                        22360003
223700                     MOVE 'UNLD@ST' TO ASC-TRIP-STATUS            22370003
223800                 WHEN 'AO'                                        22380003
223900                     MOVE 'AUDT OP' TO ASC-TRIP-STATUS            22390003
224000                 WHEN 'AK'                                        22400003
224100                     MOVE 'AUDTCLK' TO ASC-TRIP-STATUS            22410003
224200                 WHEN 'AR'                                        22420003
224300                     MOVE 'AUDTCLR' TO ASC-TRIP-STATUS            22430003
224400                 WHEN OTHER                                       22440003
224500                     MOVE SPACES    TO ASC-TRIP-STATUS            22450003
224600             END-EVALUATE                                         22460003
224700         WHEN SQLCODE = +100                                      22470003
224800              CONTINUE                                            22480003
224900         WHEN SQLWARN0 NOT = SPACE                                22490003
225000         WHEN SQLCODE NOT = ZERO                                  22500003
225100              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         22510003
225200              MOVE 'FETCH CURSOR PROBLEM '                        22520003
225300                               TO DP013-MESSAGE-TEXT (1)          22530003
225400              MOVE SQLCA       TO DP013-SQLCA                     22540003
225500              MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (1)       22550003
225600              SET DP013-DB2-ABEND TO TRUE                         22560003
225700              PERFORM DP013-0000-PROCESS-ABEND                    22570003
225800     END-EVALUATE.                                                22580003
225900                                                                  22590003
226000     IF  SQLCODE EQUAL +100                                       22600003
226100         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      22610003
226200     END-IF.                                                      22620003
226300                                                                  22630003
226400*----------------------------------------------------------------*22640003
226500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22650003
226600*----------------------------------------------------------------*22660003
226700 4400-MOVE-COMMAREA-TO-SCREEN.                                    22670003
226800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22680003
226900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22690003
227000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22700003
227100             MOVE +1    TO ASC-BLK-SUB                            22710003
227200             PERFORM 5100-WRITE-TEMP-STORAGE                      22720003
227300             ADD +1     TO ASC-BLK-SUB                            22730003
227400             PERFORM 5100-WRITE-TEMP-STORAGE                      22740003
227500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22750003
227600                 GIVING PV-BLOCK-NUMBER                           22760003
227700                 REMAINDER PV-REMAINDER                           22770003
227800             IF  PV-REMAINDER > ZERO                              22780003
227900                 ADD +1 TO PV-BLOCK-NUMBER                        22790003
228000             END-IF                                               22800003
228100             MOVE +1    TO ASC-BLK-SUB                            22810003
228200             PERFORM 4410-READ-TEMP-STORAGE                       22820003
228300             ADD +1     TO ASC-BLK-SUB                            22830003
228400                           PV-BLOCK-NUMBER                        22840003
228500             PERFORM 4410-READ-TEMP-STORAGE                       22850003
228600     END-IF.                                                      22860003
228700     MOVE +1            TO ASC-BLK-SUB.                           22870003
228800     COMPUTE ASC-ITEM-SUB =                                       22880003
228900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22890003
229000         + PC-ITEMS-PER-PANEL).                                   22900003
229100*                                                                 22910003
229200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22920003
229300         ADD +1         TO ASC-BLK-SUB                            22930003
229400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22940003
229500     END-IF.                                                      22950003
229600*                                                                 22960003
229700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22970003
229800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22980003
229900     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22990003
230000     PERFORM 4420-FORMAT-LIST-LINES                               23000003
230100         VARYING PV-SUB                                           23010003
230200         FROM PC-ITEMS-PER-PANEL BY -1                            23020003
230300         UNTIL PV-SUB < +1.                                       23030003
230400*                                                                 23040003
230500     COMPUTE ASC-ITEMS-DISPLAYED =                                23050003
230600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23060003
230700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23070003
230800                                      ASTRTITO.                   23080003
230900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    23090003
231000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    23100003
231100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23110003
231200                                   TO ASELITO.                    23120003
231300                                                                  23130003
231400     MOVE ASC-OPER-UNT-ID            TO AOPERO.                   23140003
231500     MOVE ASC-OPER-UNT-NAME          TO AOPRNMEO.                 23150003
231600     MOVE ASC-SCAC                   TO ASCACO.                   23160003
231700     MOVE ASC-SCAC-DESC              TO ASCACDSO.                 23170003
231800                                                                  23180003
231900     IF  DP020-MSG-NUMBER-X = SPACE                               23190003
232000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  23200003
232100*            --- MORE ITEMS TO DISPLAY ----                       23210003
232200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23220003
232300             SET DP020-MSG-INFORMATIONAL TO TRUE                  23230003
232400         END-IF                                                   23240003
232500     END-IF.                                                      23250003
232600                                                                  23260003
232700*----------------------------------------------------------------*23270003
232800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23280003
232900*----------------------------------------------------------------*23290003
233000 4410-READ-TEMP-STORAGE.                                          23300003
233100                                                                  23310003
233200     EXEC CICS                                                    23320003
233300         READQ TS                                                 23330003
233400             QUEUE (ASC-LIST-QUEUE-NAME)                          23340003
233500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23350003
233600             ITEM  (PV-BLOCK-NUMBER)                              23360003
233700             RESP  (PV-CICS-RESP)                                 23370003
233800     END-EXEC.                                                    23380003
233900                                                                  23390003
234000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23400003
234100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23410003
234200         CONTINUE                                                 23420003
234300     ELSE                                                         23430003
234400         SET DP013-CICS-ABEND     TO TRUE                         23440003
234500         SET DP013-NO-ROLLBACK    TO TRUE                         23450003
234600         MOVE '4410-READ-TEMP-STORAGE'                            23460003
234700                                  TO DP013-PARAGRAPH              23470003
234800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23480003
234900                                  TO DP013-MESSAGE-TEXT(1)        23490003
235000         PERFORM DP013-0000-PROCESS-ABEND                         23500003
235100     END-IF.                                                      23510003
235200                                                                  23520003
235300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23530003
235400*                                                                 23540003
235500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23550003
235600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23560003
235700     END-IF.                                                      23570003
235800                                                                  23580003
235900*----------------------------------------------------------------*23590003
236000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23600003
236100*----------------------------------------------------------------*23610003
236200 4420-FORMAT-LIST-LINES.                                          23620003
236300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23630003
236400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23640003
236500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           23650003
236600         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           23660003
236700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           23670003
236800                                    MR-ACTION (PV-SUB)            23680003
236900                                    MR-TRLR-SRL-NBR (PV-SUB)      23690003
237000                                    MR-TRIP-ID (PV-SUB)           23700003
237100                                    MR-DEST-NBR (PV-SUB)          23710003
237200                                    MR-TRLR-SEAL-ID (PV-SUB)      23720003
237300                                    MR-TRIP-STATUS (PV-SUB)       23730003
237400                                    MR-STAT-DATE (PV-SUB)         23740003
237500                                    MR-USER-ID (PV-SUB)           23750003
237600     ELSE                                                         23760003
237700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23770003
237800                                                   > SPACE        23780003
237900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23790003
238000                                 TO MR-SELECTI (PV-SUB)           23800003
238100         ELSE                                                     23810003
238200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23820003
238300                                 TO MR-SELECTI (PV-SUB)           23830003
238400         END-IF                                                   23840003
238500         IF  DP030-SET-CURSOR-TRAILER                             23850003
238600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)23860003
238700                 > SPACE)                                         23870003
238800               OR (PV-SUB = 1))                                   23880003
238900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23890003
239000                MOVE -1               TO MR-SELECTL (PV-SUB)      23900003
239100             END-IF                                               23910003
239200         END-IF                                                   23920003
239300*                                                                 23930003
239400         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               23940003
239500                                            TO MR-ACTION (PV-SUB) 23950003
239600         MOVE ASC-TRLR-SRL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         23960003
239700                                      TO MR-TRLR-SRL-NBR (PV-SUB) 23970003
239800         MOVE ASC-TRIP-ID (ASC-BLK-SUB ASC-ITEM-SUB)              23980003
239900                                           TO MR-TRIP-ID (PV-SUB) 23990003
240000         MOVE ASC-DEST-NBR (ASC-BLK-SUB ASC-ITEM-SUB)             24000003
240100                                          TO MR-DEST-NBR (PV-SUB) 24010003
240200         MOVE ASC-TRLR-SEAL-ID (ASC-BLK-SUB ASC-ITEM-SUB)         24020003
240300                                      TO MR-TRLR-SEAL-ID (PV-SUB) 24030003
240400         MOVE ASC-TRIP-STAT (ASC-BLK-SUB ASC-ITEM-SUB)            24040003
240500                                       TO MR-TRIP-STATUS (PV-SUB) 24050003
240600         MOVE ASC-STAT-DATE (ASC-BLK-SUB ASC-ITEM-SUB)            24060003
240700                                         TO MR-STAT-DATE (PV-SUB) 24070003
240800         MOVE ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB)               24080003
240900                                           TO MR-USER-ID (PV-SUB) 24090003
241000     END-IF.                                                      24100003
241100     SUBTRACT +1 FROM ASC-ITEM-SUB                                24110003
241200     IF  ASC-ITEM-SUB < + 1                                       24120003
241300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24130003
241400         MOVE +1                 TO ASC-BLK-SUB                   24140003
241500     END-IF.                                                      24150003
241600                                                                  24160003
241700******************************************************************24170003
241800** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **24180003
241900** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **24190003
242000** ISSUE A WARNING.                                             **24200003
242100******************************************************************24210003
242200 4430-CHECK-FOR-BEGIN-AND-END.                                    24220003
242300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24230003
242400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24240003
242500*            -- NO END-OF-RANGE SPECFIED ---                      24250003
242600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24260003
242700             SET DP020-MSG-WARNING TO TRUE                        24270003
242800             PERFORM 4431-POSITION-AT-WARNING                     24280003
242900         END-IF                                                   24290003
243000     ELSE                                                         24300003
243100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24310003
243200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24320003
243300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24330003
243400             SET DP020-MSG-WARNING TO TRUE                        24340003
243500             PERFORM 4431-POSITION-AT-WARNING                     24350003
243600         END-IF                                                   24360003
243700     END-IF.                                                      24370003
243800******************************************************************24380003
243900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **24390003
244000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **24400003
244100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **24410003
244200** POSITION THE CURSOR THERE.                                   **24420003
244300******************************************************************24430003
244400 4431-POSITION-AT-WARNING.                                        24440003
244500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24450003
244600                    - PV-TOP-ITEM + 1.                            24460003
244700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24470003
244800         CONTINUE                                                 24480003
244900     ELSE                                                         24490003
245000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      24500003
245100         MOVE -1                   TO MR-SELECTL (PV-SUB)         24510003
245200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24520003
245300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24530003
245400     END-IF.                                                      24540003
245500*                                                                 24550003
245600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24560003
245700                    - PV-TOP-ITEM + 1.                            24570003
245800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24580003
245900         CONTINUE                                                 24590003
246000     ELSE                                                         24600003
246100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      24610003
246200         MOVE -1                   TO MR-SELECTL (PV-SUB)         24620003
246300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24630003
246400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24640003
246500     END-IF.                                                      24650003
246600                                                                  24660003
246700*----------------------------------------------------------------*24670003
246800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *24680003
246900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *24690003
247000* FOR THE SELECTED ITEMS QUEUE.                                  *24700003
247100*                                                                *24710003
247200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *24720003
247300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *24730003
247400* THE ARRAY IS FULL.                                             *24740003
247500*----------------------------------------------------------------*24750003
247600 5000-PREPARE-SEL-QUEUE.                                          24760003
247700                                                                  24770003
247800     MOVE +1                   TO  ASC-BLK-SUB.                   24780003
247900     PERFORM 5100-WRITE-TEMP-STORAGE.                             24790003
248000     ADD +1                    TO  ASC-BLK-SUB.                   24800003
248100     PERFORM 5100-WRITE-TEMP-STORAGE.                             24810003
248200                                                                  24820003
248300     MOVE ASC-SEL-QUEUE-NAME-OUT   TO  SU009-SEL-QUEUE-NAME.      24830003
248400     PERFORM 6010-DELETE-SEL-QUEUE.                               24840003
248500                                                                  24850003
248600     SET ASC-UPDATE-TSQ        TO  TRUE.                          24860003
248700                                                                  24870003
248800     SET SU010-IDX             TO  1.                             24880003
248900     MOVE ZERO                 TO SU009-NUMBER-OF-TS-ITEMS.       24890003
249000     INITIALIZE SU010-SELECTED-ITEM-ARRAY.                        24900003
249100                                                                  24910003
249200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24920003
249300             VARYING PV-ITEM                                      24930003
249400             FROM 1 BY 1                                          24940003
249500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     24950003
249600                                                                  24960003
249700     IF  SU010-IDX > 1                                            24970003
249800         PERFORM 5205-WRITE-SEL-QUEUE                             24980003
249900         ADD +1                TO SU009-NUMBER-OF-TS-ITEMS        24990003
250000     END-IF.                                                      25000003
250100*----------------------------------------------------------------*25010003
250200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25020003
250300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25030003
250400*----------------------------------------------------------------*25040003
250500 5100-WRITE-TEMP-STORAGE.                                         25050003
250600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25060003
250700                                   TO PV-LIST-ITEM-NUMBER.        25070003
250800     COMPUTE PV-BLOCK-NUMBER =                                    25080003
250900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25090003
251000                                                                  25100003
251100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25110003
251200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25120003
251300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25130003
251400             PERFORM 5105-REWRITE-ASC-LISTQ                       25140003
251500         END-IF                                                   25150003
251600     ELSE                                                         25160003
251700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25170003
251800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25180003
251900         PERFORM 5110-WRITE-ASC-LISTQ                             25190003
252000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25200003
252100     END-IF.                                                      25210003
252200                                                                  25220003
252300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25230003
252400                                                                  25240003
252500******************************************************************25250003
252600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **25260003
252700** SPECIFIC COMMAREA.                                           **25270003
252800******************************************************************25280003
252900 5105-REWRITE-ASC-LISTQ.                                          25290003
253000     EXEC CICS                                                    25300003
253100         WRITEQ TS                                                25310003
253200             QUEUE (ASC-LIST-QUEUE-NAME)                          25320003
253300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25330003
253400             ITEM  (PV-BLOCK-NUMBER)                              25340003
253500             REWRITE                                              25350003
253600             RESP  (PV-CICS-RESP)                                 25360003
253700     END-EXEC.                                                    25370003
253800                                                                  25380003
253900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25390003
254000         CONTINUE                                                 25400003
254100     ELSE                                                         25410003
254200         SET DP013-CICS-ABEND            TO TRUE                  25420003
254300         SET DP013-NO-ROLLBACK           TO TRUE                  25430003
254400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25440003
254500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25450003
254600                                         TO DP013-MESSAGE-TEXT(1) 25460003
254700         PERFORM DP013-0000-PROCESS-ABEND                         25470003
254800     END-IF.                                                      25480003
254900                                                                  25490003
255000******************************************************************25500003
255100** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **25510003
255200** SPECIFIC COMMAREA.                                           **25520003
255300******************************************************************25530003
255400 5110-WRITE-ASC-LISTQ.                                            25540003
255500     EXEC CICS                                                    25550003
255600         WRITEQ TS                                                25560003
255700             QUEUE (ASC-LIST-QUEUE-NAME)                          25570003
255800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25580003
255900             ITEM  (PV-BLOCK-NUMBER)                              25590003
256000             RESP  (PV-CICS-RESP)                                 25600003
256100     END-EXEC.                                                    25610003
256200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25620003
256300         SET DP013-CICS-ABEND      TO TRUE                        25630003
256400         SET DP013-NO-ROLLBACK     TO TRUE                        25640003
256500         MOVE '5110-WRITE-ASC-LISTQ'                              25650003
256600                                   TO DP013-PARAGRAPH             25660003
256700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25670003
256800                                   TO DP013-MESSAGE-TEXT(1)       25680003
256900         PERFORM DP013-0000-PROCESS-ABEND                         25690003
257000     END-IF.                                                      25700003
257100                                                                  25710003
257200*----------------------------------------------------------------*25720003
257300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25730003
257400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25740003
257500*----------------------------------------------------------------*25750003
257600 5200-FILL-SEL-QUEUE-RECORD.                                      25760003
257700                                                                  25770003
257800     PERFORM 6112-READ-LIST-QUEUE.                                25780003
257900                                                                  25790003
258000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25800003
258100         PERFORM                                                  25810003
258200         VARYING LQW-IDX                                          25820003
258300         FROM 1 BY 1                                              25830003
258400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            25840003
258500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          25850003
258600                                                                  25860003
258700             IF  LQW-SELECT (LQW-IDX)                             25870003
258800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              25880003
258900                                   TO SU010-ITEM (SU010-IDX)      25890003
259000                 MOVE SPACE        TO SU010-ACTION-SW (SU010-IDX) 25900003
259100                                                                  25910003
259200                 MOVE LQW-TRLR-SRL-NBR (LQW-IDX)                  25920003
259300                                TO SU010-TRLR-SRL-NBR (SU010-IDX) 25930003
259400                 MOVE LQW-TRIP-ID (LQW-IDX)                       25940003
259500                                     TO SU010-TRIP-ID (SU010-IDX) 25950003
259600                 MOVE LQW-DEST-NBR (LQW-IDX)                      25960003
259700                                    TO SU010-DEST-NBR (SU010-IDX) 25970003
259800                 MOVE LQW-STAT-DATE (LQW-IDX)                     25980003
259900                                   TO SU010-STAT-DATE (SU010-IDX) 25990003
260000                                                                  26000003
260100                 SET SU010-IDX UP BY 1                            26010003
260200                 IF  SU010-IDX > SU010-MAX-ITEMS                  26020003
260300                     PERFORM 5205-WRITE-SEL-QUEUE                 26030003
260400                     ADD +1        TO SU009-NUMBER-OF-TS-ITEMS    26040003
260500                     INITIALIZE SU010-SELECTED-ITEM-ARRAY         26050003
260600                     SET SU010-IDX TO  1                          26060003
260700                 END-IF                                           26070003
260800             END-IF                                               26080003
260900         END-PERFORM                                              26090003
261000     END-IF.                                                      26100003
261100                                                                  26110003
261200*----------------------------------------------------------------*26120003
261300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26130003
261400*----------------------------------------------------------------*26140003
261500 5205-WRITE-SEL-QUEUE.                                            26150003
261600                                                                  26160003
261700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26170003
261800                                   TO SU010-SELECTED-ITEMS.       26180003
261900                                                                  26190003
262000     EXEC CICS                                                    26200003
262100          WRITEQ TS                                               26210003
262200              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      26220003
262300              FROM  (SU010-SELECT-RECORD)                         26230003
262400              ITEM  (PV-SEL-QUEUE-ITEM)                           26240003
262500              RESP  (PV-CICS-RESP)                                26250003
262600     END-EXEC.                                                    26260003
262700                                                                  26270003
262800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26280003
262900         CONTINUE                                                 26290003
263000     ELSE                                                         26300003
263100         SET DP013-CICS-ABEND      TO TRUE                        26310003
263200         SET DP013-NO-ROLLBACK     TO TRUE                        26320003
263300         MOVE '5205-WRITE-SEL-QUEUE'                              26330003
263400                                   TO DP013-PARAGRAPH             26340003
263500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26350003
263600                                   TO DP013-MESSAGE-TEXT(1)       26360003
263700         PERFORM DP013-0000-PROCESS-ABEND                         26370003
263800     END-IF.                                                      26380003
263900******************************************************************26390003
264000** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **26400003
264100** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **26410003
264200** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **26420003
264300** THE USER.                                                    **26430003
264400******************************************************************26440003
264500 6000-REFRESH-PANEL-FROM-TEMP.                                    26450003
264600     IF  ASC-UPDATE-TSQ                                           26460003
264700         SET ASC-NO-TSQ-UPDATE TO TRUE                            26470003
264800         MOVE ZERO                 TO PV-SAVE-ITEM                26480003
264900                                      PV-SEL-QUEUE-ITEM           26490003
265000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        26500003
265100                                   TO PV-HOLD-SELECTED-ITEMS      26510003
265200         MOVE +1                   TO PV-ITEMS-PROCESSED          26520003
265300         PERFORM 6100-UPDATE-TSQ                                  26530003
265400             UNTIL PV-ITEMS-PROCESSED >                           26540003
265500                                     PV-HOLD-SELECTED-ITEMS       26550003
265600         PERFORM 6010-DELETE-SEL-QUEUE                            26560003
265700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26570003
265800                    ASC-BLOCK-ENTRIES (2)                         26580003
265900     END-IF.                                                      26590003
266000                                                                  26600003
266100*----------------------------------------------------------------*26610003
266200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *26620003
266300*----------------------------------------------------------------*26630003
266400 6010-DELETE-SEL-QUEUE.                                           26640003
266500                                                                  26650003
266600     EXEC CICS                                                    26660003
266700         DELETEQ TS                                               26670003
266800             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       26680003
266900             RESP  (PV-CICS-RESP)                                 26690003
267000     END-EXEC.                                                    26700003
267100*                                                                 26710003
267200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26720003
267300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         26730003
267400         CONTINUE                                                 26740003
267500     ELSE                                                         26750003
267600         SET DP013-CICS-ABEND TO TRUE                             26760003
267700         SET DP013-NO-ROLLBACK TO TRUE                            26770003
267800         MOVE '6010-DELETE-SEL-QUEUE'                             26780003
267900                        TO DP013-PARAGRAPH                        26790003
268000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         26800003
268100                        TO DP013-MESSAGE-TEXT (1)                 26810003
268200         PERFORM DP013-0000-PROCESS-ABEND                         26820003
268300     END-IF.                                                      26830003
268400                                                                  26840003
268500*----------------------------------------------------------------*26850003
268600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *26860003
268700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *26870003
268800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *26880003
268900*    THE TEMP QUEUE.                                             *26890003
269000*----------------------------------------------------------------*26900003
269100 6100-UPDATE-TSQ.                                                 26910003
269200                                                                  26920003
269300     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             26930003
269400     PERFORM 6150-READ-SEL-QUEUE.                                 26940003
269500     PERFORM                                                      26950003
269600         VARYING SU010-IDX                                        26960003
269700         FROM 1 BY 1                                              26970003
269800         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     26980003
269900         OR (SU010-IDX GREATER THAN SU010-MAX-ITEMS))             26990003
270000         IF  SU010-ACTION-SW (SU010-IDX) > SPACE                  27000003
270100             PERFORM 6110-PROCESS-ITEMS                           27010003
270200         END-IF                                                   27020003
270300         ADD +1                TO PV-ITEMS-PROCESSED              27030003
270400     END-PERFORM.                                                 27040003
270500     PERFORM 6111-WRITE-LIST-QUEUE.                               27050003
270600                                                                  27060003
270700*----------------------------------------------------------------*27070003
270800*    READ THE LIST QUEUE RECORD.                                 *27080003
270900*----------------------------------------------------------------*27090003
271000 6150-READ-SEL-QUEUE.                                             27100003
271100                                                                  27110003
271200     EXEC CICS                                                    27120003
271300          READQ TS                                                27130003
271400              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      27140003
271500              INTO  (SU010-SELECT-RECORD)                         27150003
271600              ITEM  (PV-SEL-QUEUE-ITEM)                           27160003
271700              RESP  (PV-CICS-RESP)                                27170003
271800     END-EXEC.                                                    27180003
271900*                                                                 27190003
272000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27200003
272100         CONTINUE                                                 27210003
272200     ELSE                                                         27220003
272300         SET DP013-CICS-ABEND      TO  TRUE                       27230003
272400         SET DP013-NO-ROLLBACK     TO  TRUE                       27240003
272500         MOVE '6150-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           27250003
272600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27260003
272700                                   TO  DP013-MESSAGE-TEXT(1)      27270003
272800         PERFORM DP013-0000-PROCESS-ABEND                         27280003
272900     END-IF.                                                      27290003
273000                                                                  27300003
273100*----------------------------------------------------------------*27310003
273200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*27320003
273300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*27330003
273400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *27340003
273500*----------------------------------------------------------------*27350003
273600 6110-PROCESS-ITEMS.                                              27360003
273700                                                                  27370003
273800     COMPUTE PV-ITEM = 1 + ((SU010-ITEM (SU010-IDX) - 1)          27380003
273900                     / PC-ITEMS-PER-PANEL).                       27390003
274000                                                                  27400003
274100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           27410003
274200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          27420003
274300             PERFORM 6111-WRITE-LIST-QUEUE                        27430003
274400         END-IF                                                   27440003
274500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    27450003
274600                                                                  27460003
274700         PERFORM 6112-READ-LIST-QUEUE                             27470003
274800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               27480003
274900             CONTINUE                                             27490003
275000         END-IF                                                   27500003
275100     END-IF.                                                      27510003
275200                                                                  27520003
275300     COMPUTE PV-SUB = (SU010-ITEM (SU010-IDX)                     27530003
275400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              27540003
275500     SET LQW-DESELECT (PV-SUB) TO    TRUE                         27550003
275600     MOVE LQW-SELECTED-SW (PV-SUB)                                27560003
275700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  27570003
275800                                                                  27580003
275900     EVALUATE TRUE                                                27590003
276000         WHEN SU010-INQ (SU010-IDX)                               27600003
276100              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             27610003
276200                                                                  27620003
276300         WHEN SU010-UPD (SU010-IDX)                               27630003
276400              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             27640003
276500                                                                  27650003
276600         WHEN SU010-DEL (SU010-IDX)                               27660003
276700              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             27670003
276800                                                                  27680003
276900         WHEN SU010-ERR (SU010-IDX)                               27690003
277000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             27700003
277100     END-EVALUATE.                                                27710003
277200                                                                  27720003
277300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                27730003
277400                                                                  27740003
277500*----------------------------------------------------------------*27750003
277600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *27760003
277700*----------------------------------------------------------------*27770003
277800 6111-WRITE-LIST-QUEUE.                                           27780003
277900                                                                  27790003
278000     EXEC CICS                                                    27800003
278100         WRITEQ TS                                                27810003
278200             QUEUE (ASC-LIST-QUEUE-NAME)                          27820003
278300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     27830003
278400             ITEM  (PV-SAVE-ITEM)                                 27840003
278500             REWRITE                                              27850003
278600             RESP  (PV-CICS-RESP)                                 27860003
278700     END-EXEC.                                                    27870003
278800*                                                                 27880003
278900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27890003
279000         CONTINUE                                                 27900003
279100     ELSE                                                         27910003
279200         SET DP013-CICS-ABEND  TO  TRUE                           27920003
279300         SET DP013-NO-ROLLBACK TO  TRUE                           27930003
279400         MOVE '6111-WRITE-LIST-QUEUE'                             27940003
279500                               TO  DP013-PARAGRAPH                27950003
279600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  27960003
279700                               TO  DP013-MESSAGE-TEXT(1)          27970003
279800         PERFORM DP013-0000-PROCESS-ABEND                         27980003
279900     END-IF.                                                      27990003
280000                                                                  28000003
280100*----------------------------------------------------------------*28010003
280200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28020003
280300*----------------------------------------------------------------*28030003
280400 6112-READ-LIST-QUEUE.                                            28040003
280500                                                                  28050003
280600     EXEC CICS                                                    28060003
280700         READQ TS                                                 28070003
280800             QUEUE (ASC-LIST-QUEUE-NAME)                          28080003
280900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28090003
281000             ITEM  (PV-ITEM)                                      28100003
281100             RESP  (PV-CICS-RESP)                                 28110003
281200     END-EXEC.                                                    28120003
281300*                                                                 28130003
281400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28140003
281500         CONTINUE                                                 28150003
281600     ELSE                                                         28160003
281700         SET DP013-CICS-ABEND        TO TRUE                      28170003
281800         SET DP013-NO-ROLLBACK       TO TRUE                      28180003
281900         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           28190003
282000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28200003
282100                                     TO DP013-MESSAGE-TEXT(1)     28210003
282200         PERFORM DP013-0000-PROCESS-ABEND                         28220003
282300     END-IF.                                                      28230003
282400                                                                  28240003
282500*-----------------------------------------------------------------28250003
282600*  READ THE LIST QUEUE RECORD                                     28260003
282700*-----------------------------------------------------------------28270003
282800 9100-READ-SEL-QUEUE.                                             28280003
282900                                                                  28290003
283000     EXEC CICS                                                    28300003
283100         READQ TS                                                 28310003
283200             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        28320003
283300             INTO  (SU010-SELECT-RECORD)                          28330003
283400             ITEM  (ASC-SEL-ITEM)                                 28340003
283500             RESP  (PV-CICS-RESP)                                 28350003
283600     END-EXEC.                                                    28360003
283700     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        28370003
283800         CONTINUE                                                 28380003
283900     ELSE                                                         28390003
284000         SET DP013-LOGIC-ABEND                                    28400003
284100             DP013-NO-ROLLBACK   TO   TRUE                        28410003
284200         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          28420003
284300         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   28430003
284400                                 TO   DP013-MESSAGE-TEXT (1)      28440003
284500         PERFORM DP013-0000-PROCESS-ABEND                         28450003
284600     END-IF.                                                      28460003
284700                                                                  28470003
284800*-----------------------------------------------------------------28480003
284900* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *28490003
285000*-----------------------------------------------------------------28500003
285100 9200-REWRITE-SEL-QUEUE.                                          28510003
285200                                                                  28520003
285300     EXEC CICS                                                    28530003
285400          WRITEQ TS                                               28540003
285500              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      28550003
285600              FROM   (SU010-SELECT-RECORD)                        28560003
285700              ITEM   (ASC-SEL-ITEM)                               28570003
285800              RESP   (PV-CICS-RESP)                               28580003
285900              REWRITE                                             28590003
286000     END-EXEC.                                                    28600003
286100                                                                  28610003
286200     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   28620003
286300         SET DP013-CICS-ABEND                                     28630003
286400             DP013-NO-ROLLBACK     TO TRUE                        28640003
286500         MOVE '9200-REWRITE-SEL-QUEUE'                            28650003
286600                                   TO DP013-PARAGRAPH             28660003
286700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   28670003
286800                                   TO DP013-MESSAGE-TEXT (1)      28680003
286900         PERFORM DP013-0000-PROCESS-ABEND                         28690003
287000     END-IF.                                                      28700003
287100                                                                  28710003
287200*----------------------------------------------------------------*28720003
287300*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *28730003
287400*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *28740003
287500*----------------------------------------------------------------*28750003
287600 9900-SOFT-ABORT.                                                 28760003
287700                                                                  28770003
287800     EXEC CICS SYNCPOINT                                          28780003
287900          ROLLBACK                                                28790003
288000     END-EXEC.                                                    28800003
288100                                                                  28810003
288200     SET  PS-ERROR                                                28820003
288300          PS-SOFT-ABORT-ERROR                                     28830003
288400          DP020-MSG-FATAL       TO  TRUE.                         28840003
288500                                                                  28850003
288600*----------------------------------------------------------------*28860003
288700*    ABEND PROCESSOR MODULE                                      *28870003
288800*----------------------------------------------------------------*28880003
288900                                                                  28890003
289000     COPY DPPD013.                                                28900011
