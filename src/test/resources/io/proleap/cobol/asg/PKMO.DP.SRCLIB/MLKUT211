       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.     MLKUT211.                                        00020007
       INSTALLATION.   KOHLS DEPARTMENT STORES.                         00030000
       DATE-WRITTEN.   08/22/2005.                                      00040000
       DATE-COMPILED.                                                   00050000
                                                                        00060000
      ******************************************************************00070000
R28582*PURPOSE:  TO CAPTURE THE BRAND VENDOR RELATIONSHIP FROM THE LOW  00080012
R28582*          LEVEL KEY. TO BE USED BY THE LEVEL I DATA SMOOTHING    00081012
R28582*          PROCESS WHEN WE SMOOTH TO THE DEPT/BRAND/VENDOR LEVEL  00082012
R28582*          FOR NON-SMOOTHING CANDIDATES.                          00083012
R28582*                                                                 00090012
B28582*          TO DETERMINE IF THE DKEY IS CONSIDERED UNKNOWN/UNKNOWN 00090122
B28582*          AT THE DEPT/BRAND/VENDOR LEVEL.                        00090222
B28582*                                                                 00090322
R28582*          FURTHER DOWNSTREAM OF THIS MODULE, THE INFORMATION IS  00091012
R28582*          MERGED WITH THE CUM MKUP PCT OVERRIDE TABLE TO CREATE  00091112
R28582*          ELEMENTS USED BY LEVEL I SMOOTHING. (MLK201)           00091212
      *                                                                 00092012
      *CHG ID/                                                          00100000
      *WR/PROJ DATE       PGMR        DESCRIPTION                       00110000
      *------- ---------- ----------- ----------------------------------00120000
      * W28582 08-22-2005 ROD JANSSEN CREATION......                    00130012
R28582* W28582 11-21-2006 ROD JANSSEN ADD ICA1, ICA2, EIC1, AND EIC2 TO 00131012
R28582*                               SMOOTH F_CALC FROM THE WEEKLY     00132012
R28582*                               DETAIL LEDGER DATA SMOOTH PROCESS 00133012
B28582* W28582 01-03-2007 ROD JANSSEN MARGIN $ RULE CHANGE              00134018
      ******************************************************************00140000
                                                                        00150000
       ENVIRONMENT DIVISION.                                            00160000
       CONFIGURATION SECTION.                                           00170000
       INPUT-OUTPUT SECTION.                                            00180000
       FILE-CONTROL.                                                    00190000
                                                                        00200000
           SELECT INPUT-FILE                                            00210000
               ASSIGN TO INP01.                                         00220000
                                                                        00230000
           SELECT OUTPUT-FILE                                           00231005
               ASSIGN TO OUT01.                                         00232002
                                                                        00233000
       DATA DIVISION.                                                   00240000
       FILE SECTION.                                                    00250000
                                                                        00260000
       FD  INPUT-FILE                                                   00270000
           RECORDING MODE IS F                                          00280000
           LABEL RECORDS ARE STANDARD                                   00290000
           BLOCK CONTAINS 0 RECORDS.                                    00300000
B28582     COPY MLRD036 REPLACING ML036 BY INPUT.                       00300120
                                                                        00390000
       FD  OUTPUT-FILE                                                  00390105
           LABEL RECORDS ARE OMITTED                                    00390200
           RECORDING MODE IS F                                          00390300
           BLOCK CONTAINS 0 RECORDS.                                    00390400
B28582     COPY MLRD036.                                                00390519
                                                                        00398000
      /*****************************************************************00400000
       WORKING-STORAGE SECTION.                                         00410000
      ******************************************************************00420000
                                                                        00430000
       01  PA-PROGRAM-ACCUMULATORS.                                     00440000
           05  PA-READ-COUNT           PIC 9(09) VALUE ZEROES.          00450000
           05  PA-UPDATE-COUNT         PIC 9(09) VALUE ZEROES.          00470000
                                                                        00510000
       01  PC-PROGRAM-CONSTANTS-AREA.                                   00520000
           05  PC-PROGRAM-NAME         PIC X(08)  VALUE 'MLKUT211'.     00530007
           05  PC-JOB-NAME             PIC X(08)  VALUE 'MLK199  '.     00540000
R28582     05  PC-MAX-RETRIES          PIC S9(04) VALUE +3 COMP SYNC.   00550012
                                                                        03539712
       01  PV-PROGRAM-VARIABLES-AREA.                                   03539812
           05  PV-RETRY-COUNT          PIC S9(04) COMP VALUE ZEROS.     03539912
           05  PV-WORK-PERCENT         PIC S9(4)V9(7) COMP-3 VALUE +0.  03540012
           05  PV-PARAGRAPH-NAME       PIC X(30)  VALUE SPACES.         03540112
R28582     05  PV-OPER-ATTEMPTED       PIC X(25)  VALUE SPACES.         03540212
           05  PV-ABEND-MESSAGE        PIC X(75)  VALUE SPACES.         03540312
           05  PV-OPERATION-ATTEMPTED     PIC X(30)  VALUE SPACES.      03540412
R28582     05  PV-SAVE-INPUT-RECORD.                                    03540512
B28582         10 PV-SV-DEPT-NBR           PIC  S9(4)V COMP-3.          03540620
B28582         10 PV-SV-LBL-SEQ-NBR        PIC  S9(4) COMP.             03540720
B28582         10 PV-SV-ENT-ID             PIC  S9(9) COMP.             03540820
B28582         10 PV-SV-ML-LO-MDSE-LVL-ID  PIC  S9(9) COMP.             03540920
B28582         10 PV-SV-EFF-BEG-DTE        PIC   X(10).                 03541020
B28582         10 PV-SV-OVRID-CUM-MKUP-PCT PIC  S9(4)V9(7) COMP-3.      03541120
B28582         10 PV-SV-EFF-END-DTE        PIC   X(10).                 03541220
B28582         10 PV-SV-DBV-UNKNWN-IND     PIC   X(01) VALUE 'N'.       03541320
                                                                        03541512
       01  PS-SWITCHES-AREA.                                            03541612
           05  PS-END-OF-INPUT            PIC X(01) VALUE 'N'.          03541712
               88  END-OF-INPUT                     VALUE 'Y'.          03541812
                                                                        03541912
       01  ABEND-CODE                     PIC S9(04) VALUE ZEROES       03542012
                                                     COMP SYNC.         03542112
           88  ABEND-4004                 VALUE +4004.                  03542212
           88  ABEND-4013                 VALUE +4013.                  03542312
                                                                        03542412
R28582******************************************************************03542512
R28582* COPYBOOK -                                                      03542612
R28582*    DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA      03542712
R28582* MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS.     03542812
R28582******************************************************************03542912
R28582     COPY DPWS004.                                                03543012
R28582                                                                  03543112
R28582******************************************************************03543212
R28582     EXEC SQL                                                     03543312
R28582         INCLUDE SQLCA                                            03543412
R28582     END-EXEC.                                                    03543512
R28582                                                                  03543612
R28582******************************************************************03543712
R28582* DB2 - MLV_BRND_VND.                                             03543812
R28582******************************************************************03543912
R28582     EXEC SQL                                                     03544012
R28582         INCLUDE MLV00000                                         03544112
R28582     END-EXEC.                                                    03544212
R28582                                                                  03544312
R28582******************************************************************03544412
R28582*FLOW:     TO CAPTURE THE BRAND VENDOR RELATIONSHIP FROM THE LOW  03544912
R28582*          LEVEL KEY. TO BE USED BY THE LEVEL I DATA SMOOTHING    03545012
R28582*          PROCESS WHEN WE SMOOTH TO THE DEPT/BRAND/VENDOR LEVEL  03545112
R28582*          FOR NON-SMOOTHING CANDIDATES.                          03545212
R28582*                                                                 03545312
B28582*          TO DETERMINE IF THE DKEY IS CONSIDERED UNKNOWN/UNKNOWN 03545418
B28582*          AT THE DEPT/BRAND/VENDOR LEVEL.                        03545518
B28582*                                                                 03545718
R28582*          FURTHER DOWNSTREAM OF THIS MODULE, THE INFORMATION IS  03545817
R28582*          MERGED WITH THE CUM MKUP PCT OVERRIDE TABLE TO CREATE  03545917
R28582*          ELEMENTS USED BY LEVEL I DATA SMOOTHING. (MLK201)      03546017
R28582*                                                                 03546117
      ******************************************************************03546212
      ******************************************************************03546312
       PROCEDURE DIVISION.                                              03546412
      ******************************************************************03546512
       0000-MAINLINE-DRIVER-SECTION.                                    03546612
                                                                        03546712
           PERFORM 1000-INITIALIZATION.                                 03546812
                                                                        03546912
           PERFORM 2000-PROCESS-MAIN-LOOP                               03547012
               UNTIL END-OF-INPUT.                                      03547112
                                                                        03547212
           PERFORM 9000-END-OF-JOB-TASKS.                               03547312
                                                                        03547412
       9999-EXIT-PROGRAM.                                               03547512
           STOP RUN.                                                    03547612
                                                                        03547712
      /*****************************************************************03547812
      * 1000-INITIALIZATION.                                            03547912
      ******************************************************************03548012
       1000-INITIALIZATION.                                             03548112
                                                                        03548212
           OPEN  INPUT INPUT-FILE                                       03548312
                OUTPUT OUTPUT-FILE.                                     03548412
                                                                        03548512
R28582     INITIALIZE INPUT-RECORD.                                     03548612
R28582     INITIALIZE PV-SAVE-INPUT-RECORD.                             03548712
R28582                                                                  03548812
R28582     MOVE 'N'            TO PS-END-OF-INPUT.                      03548912
R28582                                                                  03549012
           PERFORM 8000-READ-INPUT.                                     03549112
                                                                        03549212
      /*****************************************************************03549312
      * 2000-PROCESS-MAIN-LOOP.                                         03549412
      ******************************************************************03549512
       2000-PROCESS-MAIN-LOOP.                                          03549612
                                                                        03549712
           ADD 1               TO PA-READ-COUNT.                        03549812
                                                                        03549912
R28582     IF INPUT-ML-LO-MDSE-LVL-ID                                   03550012
R28582                         IS NOT EQUAL TO PV-SV-ML-LO-MDSE-LVL-ID  03550112
R28582         PERFORM 3000-GET-BVR-INFO                                03550212
R28582         MOVE INPUT-RECORD         TO PV-SAVE-INPUT-RECORD        03550312
R28582     END-IF.                                                      03550412
R28582                                                                  03550512
           MOVE INPUT-DEPT-NBR           TO ML036-DEPT-NBR              03550612
R28582     MOVE MLV00000-LBL-SEQ-NBR     TO ML036-LBL-SEQ-NBR           03550712
R28582     MOVE MLV00000-ENT-ID          TO ML036-ENT-ID                03550812
           MOVE INPUT-ML-LO-MDSE-LVL-ID  TO ML036-ML-LO-MDSE-LVL-ID     03550912
           MOVE INPUT-EFF-BEG-DTE        TO ML036-EFF-BEG-DTE           03551012
R28582     MOVE INPUT-OVRID-CUM-MKUP-PCT TO ML036-OVRID-CUM-MKUP-PCT    03551121
           MOVE INPUT-EFF-END-DTE        TO ML036-EFF-END-DTE           03551212
                                                                        03551312
B28582     IF MLV00000-LBL-SEQ-NBR IS EQUAL TO 2230                     03551418
B28582       IF MLV00000-ENT-ID IS EQUAL TO 5161                        03551518
B28582         MOVE 'Y'                  TO ML036-DBV-UNKNWN-IND        03551618
B28582       ELSE                                                       03551718
B28582         MOVE 'N'                  TO ML036-DBV-UNKNWN-IND        03551818
B28582       END-IF                                                     03551918
B28582     ELSE                                                         03552018
B28582       MOVE 'N'                    TO ML036-DBV-UNKNWN-IND        03552118
B28582     END-IF.                                                      03552218
B28582                                                                  03552318
           PERFORM 8100-WRITE-OUTPUT.                                   03552412
                                                                        03552512
           PERFORM 8000-READ-INPUT.                                     03552612
                                                                        03552712
R28582/*****************************************************************03552812
R28582* 3000-GET-BVR-INFO.                                              03552912
R28582*    USING THE F_CALC DATALESS KEY, GET BRAND VENDOR RELATIONSHIP 03553012
R28582* TABLE INFOMATION FROM DATAVIEW MLV_BRND_VEND......              03553112
R28582******************************************************************03553212
R28582 3000-GET-BVR-INFO.                                               03553312
R28582                                                                  03553412
R28582     MOVE INPUT-ML-LO-MDSE-LVL-ID TO MLV00000-ML-LO-MDSE-LVL-ID.  03553512
R28582                                                                  03553612
R28582     PERFORM                                                      03553712
R28582         WITH TEST AFTER                                          03553812
R28582         VARYING PV-RETRY-COUNT FROM 1 BY 1                       03553912
R28582         UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  03554012
R28582             OR (SQLCODE = 0)                                     03554112
R28582             OR (SQLCODE = +100)                                  03554212
R28582                                                                  03554312
R28582         EXEC SQL                                                 03554412
R28582             SELECT ML_LO_MDSE_LVL_ID                             03554512
R28582                   ,DEPT_NBR                                      03554612
R28582                   ,LBL_SEQ_NBR                                   03554712
R28582                   ,ENT_ID                                        03554812
R28582                   ,EFF_BEG_DTE                                   03554912
R28582                   ,VALUE(EFF_END_DTE,DATE('9999-12-31'))         03555013
R28582             INTO :MLV00000-ML-LO-MDSE-LVL-ID                     03555112
R28582                 ,:MLV00000-DEPT-NBR                              03555212
R28582                 ,:MLV00000-LBL-SEQ-NBR                           03555312
R28582                 ,:MLV00000-ENT-ID                                03555412
R28582                 ,:MLV00000-EFF-BEG-DTE                           03555512
R28582                 ,:MLV00000-EFF-END-DTE                           03555612
R28582             FROM MLV_BRND_VND                                    03555712
R28582             WHERE ML_LO_MDSE_LVL_ID                              03555812
R28582                              = :MLV00000-ML-LO-MDSE-LVL-ID       03555912
R28582             WITH UR                                              03556012
R28582         END-EXEC                                                 03556112
R28582                                                                  03556212
R28582         EVALUATE TRUE                                            03556312
R28582         WHEN SQLCODE = 0                                         03556412
R28582             CONTINUE                                             03556517
R28582         WHEN SQLCODE = +100                                      03556612
R28582             MOVE ZEROS       TO MLV00000-LBL-SEQ-NBR             03556712
R28582             MOVE ZEROS       TO MLV00000-ENT-ID                  03556812
R28582         WHEN SQLCODE = -913                                      03556912
R28582         WHEN SQLCODE = -904                                      03557012
R28582         WHEN SQLCODE = -911                                      03557112
R28582             DISPLAY '** PARAGRAPH - 3000-GET-BVR-INFO **'        03557212
R28582             DISPLAY ' DKEY   :     ' INPUT-ML-LO-MDSE-LVL-ID     03557312
R28582             PERFORM 9900-SQL-ERROR                               03557412
R28582         WHEN SQLWARN NOT = SPACE                                 03557512
R28582         WHEN SQLCODE NOT = ZERO                                  03557612
R28582             DISPLAY '** PARAGRAPH - 3000-GET-BVR-INFO **'        03557712
R28582             DISPLAY ' DKEY   :     ' INPUT-ML-LO-MDSE-LVL-ID     03557812
R28582             PERFORM 9900-SQL-ERROR                               03557912
R28582         END-EVALUATE                                             03558012
R28582     END-PERFORM.                                                 03558112
R28582                                                                  03558212
R28582     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          03558312
R28582         DISPLAY '** MAX RETRIES - 3000-GET-BVR-INFO **'          03558412
R28582         DISPLAY ' DKEY   :     ' INPUT-ML-LO-MDSE-LVL-ID         03558512
R28582         PERFORM 9900-SQL-ERROR                                   03558612
R28582     END-IF.                                                      03559012
R28582                                                                  03560012
      /*****************************************************************05640012
      * 8000-READ-INPUT.                                                05650000
      ******************************************************************05670000
       8000-READ-INPUT.                                                 05680000
                                                                        05690000
           READ INPUT-FILE NEXT                                         05700000
               AT END  SET END-OF-INPUT TO TRUE.                        05710000
                                                                        05720000
      ******************************************************************05721000
      * 8100-WRITE-OUTPUT.                                              05722000
      ******************************************************************05724000
       8100-WRITE-OUTPUT.                                               05725000
                                                                        05726000
           WRITE ML036-RECORD.                                          05727005
           ADD 1       TO PA-UPDATE-COUNT.                              05728000
                                                                        05729000
      /*****************************************************************05730000
      * 9000-END-OF-JOB-TASKS.                                          05740000
      ******************************************************************05750000
       9000-END-OF-JOB-TASKS.                                           05760000
                                                                        05770000
      *** FINAL TOTALS.....                                             05840000
           DISPLAY '***********************'.                           05850000
           DISPLAY '* ' PC-PROGRAM-NAME ' SUMMARY    *'.                05860000
           DISPLAY '***********************'.                           05870000
           DISPLAY ' '.                                                 05880000
           DISPLAY 'RECORDS READ ' PA-READ-COUNT.                       05940000
           DISPLAY 'UPDATES      ', PA-UPDATE-COUNT.                    05950000
           DISPLAY '                                             '.     06010000
           DISPLAY '***********************'.                           06020000
                                                                        06030000
           CLOSE INPUT-FILE                                             06040000
                 OUTPUT-FILE.                                           06041005
                                                                        06050000
R28582******************************************************************06060012
R28582* 9900-SQL-ERROR.                                                 06070012
R28582******************************************************************06080012
R28582 9900-SQL-ERROR.                                                  06090012
R28582                                                                  06100012
R28582     SET ABEND-4013            TO TRUE.                           06110012
R28582     DISPLAY '**  ABEND     **'.                                  06120012
R28582     DISPLAY '**  PROGRAM   **  =  ' PC-PROGRAM-NAME              06130012
R28582     DISPLAY '**  OPERATION **  = '  PV-OPER-ATTEMPTED            06140012
R28582                                                                  06150012
R28582*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         06160012
R28582*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        06170012
R28582                                                                  06180012
R28582     COPY DPPD004.                                                06190012
R28582                                                                  06200012
R28582     PERFORM 9990-ABEND.                                          06210012
R28582                                                                  06220012
R28582 9990-ABEND.                                                      06230012
R28582                                                                  06240012
R28582     DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              06250012
R28582     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            06260012
R28582     CALL 'ILBOABN0'  USING ABEND-CODE.                           06270012
R28582                                                                  06280012
