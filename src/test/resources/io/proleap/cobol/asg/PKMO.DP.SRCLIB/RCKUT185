000100 TITLE 'CREATE REPORT DATE CONTROL CARD'.                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    RCKUT185.                                         00030000
000400 AUTHOR.        DENISE HAHN.                                      00040000
000500 DATE-WRITTEN.  SEPT 2021.                                        00050000
000600 ENVIRONMENT DIVISION.                                            00060000
000700 INPUT-OUTPUT SECTION.                                            00070000
000800                                                                  00080000
000900*----------------------------------------------------------------*00090000
000901* GENERATE CONTROL CARD USED BY RCKRP092                         *00090100
000903*----------------------------------------------------------------*00090300
000910 FILE-CONTROL.                                                    00091000
001000     SELECT OLD-CONTROL-FILE        ASSIGN TO INP01.              00100000
001100     SELECT NEW-CONTROL-FILE        ASSIGN TO OUT01.              00110000
001200                                                                  00120000
001300 DATA DIVISION.                                                   00130000
001400 FILE SECTION.                                                    00140000
001500                                                                  00150000
001600 FD  OLD-CONTROL-FILE                                             00160000
001700     RECORDING MODE IS F                                          00170000
001800     LABEL RECORDS ARE STANDARD                                   00180000
001900     RECORD CONTAINS 080                                          00190000
002000     BLOCK CONTAINS 0 RECORDS                                     00200000
002100     DATA RECORD IS OLD-CONTROL-RECORD.                           00210000
002200 01  OLD-CONTROL-RECORD               PIC X(080).                 00220000
002300                                                                  00230000
002400 FD  NEW-CONTROL-FILE                                             00240000
002500     RECORDING MODE IS F                                          00250000
002600     LABEL RECORDS ARE STANDARD                                   00260000
002700     RECORD CONTAINS 080                                          00270000
002800     BLOCK CONTAINS 0 RECORDS                                     00280000
002900     DATA RECORD IS NEW-CONTROL-RECORD.                           00290000
003000 01  NEW-CONTROL-RECORD               PIC X(080).                 00300000
003100                                                                  00310000
003200 WORKING-STORAGE SECTION.                                         00320000
003300                                                                  00330000
003400 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     00340000
003500                                                   COMP SYNC.     00350000
003600                                                                  00360000
003700 01  PS-PROGRAM-SWITCHES.                                         00370000
003800     05  PS-END-EXTRACT-SW            PIC X(1)   VALUE 'N'.       00380000
003900         88  PS-END-EXTRACT                      VALUE 'Y'.       00390000
004000                                                                  00400000
004100                                                                  00410000
004200 01  PV-PROGRAM-VARIABLES.                                        00420000
004300     05  PV-RETRY-COUNT               PIC S9(04)  VALUE ZERO      00430000
004400                                                  COMP SYNC.      00440000
004500     05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACES.   00450000
004600     05  PV-ERROR-MESSAGE-1           PIC X(60)   VALUE SPACES.   00460000
004700     05  PV-ERROR-MESSAGE-2           PIC X(60)   VALUE SPACES.   00470000
004800     05  PV-SQLCODE                   PIC 9(9)    VALUE ZERO.     00480000
004900     05  PV-CURR-YEAR                 PIC S9(09) COMP VALUE ZERO. 00490000
005000     05  PV-DISP-YEAR                 PIC 9(04) VALUE ZERO.       00500000
005100     05  PV-READ-COUNT                PIC S9(9) COMP-3            00510000
005200                                                   VALUE ZERO.    00520000
005300     05  PV-WRITE-COUNT               PIC S9(9) COMP-3            00530000
005400                                                   VALUE ZERO.    00540000
005500     05  PV-DISP-NBR                  PIC Z(8)9.                  00550000
005600                                                                  00560000
005700 01  PC-PROGRAM-CONSTANTS.                                        00570000
005800     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'RCKUT185'.00580000
005900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00590000
006000                                                 COMP SYNC.       00600000
006100 01  PV-ABEND-FIELDS.                                             00610000
006200     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'RCKUT185'.00620000
006300     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00630000
006400     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00640000
006500     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    00650000
006600     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    00660000
006700     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    00670000
006800     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    00680000
006900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00690000
007000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00700000
007100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00710000
007200     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00720000
007300                                                                  00730000
007400/                                                                 00740000
007500*    DATE CONTROL CARD                                            00750000
007600     COPY RCRD111.                                                00760000
007700/                                                                 00770000
007800* COMPANY CONTROL TABLE                                           00780003
007900     EXEC SQL                                                     00790000
008000         INCLUDE TCOCNTL                                          00800000
008100     END-EXEC                                                     00810000
008200                                                                  00820000
008210*    DATE ATTRIBUTES                                              00821003
008300     EXEC SQL                                                     00830000
008400         INCLUDE TDTATTR                                          00840000
008500     END-EXEC                                                     00850000
008600/                                                                 00860000
008700*  USED FOR DB2 ERROR MESSAGE BUILDING                            00870000
008800     COPY DPWS004.                                                00880000
008900                                                                  00890000
009000*   DB2 SQL COMMUNICATION AREA                                    00900000
009100     EXEC SQL                                                     00910000
009200          INCLUDE SQLCA                                           00920000
009300     END-EXEC.                                                    00930000
009400/                                                                 00940000
009500 PROCEDURE DIVISION.                                              00950000
009600                                                                  00960000
009610     DISPLAY ' '.                                                 00961002
009620     DISPLAY ' RCKUT185 - START'                                  00962002
009630                                                                  00963002
009700     PERFORM 1000-INIT.                                           00970000
009800                                                                  00980000
009900     PERFORM 2000-PROCESS                                         00990000
010000                                                                  01000000
010100     PERFORM 9000-TERMINATE.                                      01010000
010200                                                                  01020000
010300     GOBACK.                                                      01030000
010400                                                                  01040000
010500 1000-INIT.                                                       01050000
010600                                                                  01060000
010700     OPEN INPUT  OLD-CONTROL-FILE                                 01070000
010800          OUTPUT NEW-CONTROL-FILE.                                01080000
010900                                                                  01090000
011000     PERFORM 8000-READ-CONTROL-REC.                               01100000
011100                                                                  01110000
011200 2000-PROCESS.                                                    01120000
011300                                                                  01130000
011600     PERFORM 3000-GET-DATES.                                      01160000
011800                                                                  01180000
011900     PERFORM 8100-WRITE-CONTROL-REC.                              01190000
012000                                                                  01200000
012100/                                                                 01210000
012200 3000-GET-DATES.                                                  01220000
012300                                                                  01230000
012400     PERFORM 7000-GET-FISCAL-INFO.                                01240000
012600                                                                  01260000
012700     EVALUATE RC111-RPT-TYPE                                      01270000
012701                                                                  01270100
012710* D - DAILY                                                       01271000
012800     WHEN 'D'                                                     01280000
012900         MOVE COCNTL-BTCH-PRC-DTE     TO RC111-REPORT-DATE        01290000
013000         MOVE DTATTR-FSCL-MN-END-DTE  TO RC111-MONTH-END-DATE     01300000
013010                                                                  01301000
013100* M - FISCAL MONTH                                                01310000
014200     WHEN 'M'                                                     01420000
014400         MOVE DTATTR-FSCL-MN-END-DTE  TO RC111-REPORT-DATE        01440000
014500                                         RC111-MONTH-END-DATE     01450000
014501                                                                  01450100
014510* W - CURRENT WEEK                                                01451000
014590     WHEN 'W'                                                     01459000
014700         MOVE DTATTR-FSCL-WK-END-DTE  TO  RC111-REPORT-DATE       01470001
014800         MOVE DTATTR-FSCL-MN-END-DTE  TO RC111-MONTH-END-DATE     01480000
014900                                                                  01490000
015300     WHEN OTHER                                                   01530000
015400         MOVE '3000-GET-DATES'        TO PV-PARAGRAPH-NAME        01540000
015500         MOVE 'INVALID RPT TYPE'      TO PV-ERROR-MESSAGE-1       01550000
015600         MOVE SPACES                  TO PV-ERROR-MESSAGE-2       01560000
015700         PERFORM 9200-ABEND                                       01570000
015800     END-EVALUATE.                                                01580000
015900                                                                  01590000
015910                                                                  01591000
016000 7000-GET-FISCAL-INFO.                                            01600000
016100                                                                  01610000
016200     EXEC SQL                                                     01620000
016300         SELECT                                                   01630000
016400             CTL.BTCH_PRC_DTE                                     01640000
016700         ,   DTE.FSCL_MN_END_DTE                                  01670000
017100         ,   DTE.FSCL_WK_END_DTE                                  01710000
017400         INTO                                                     01740000
017500             :COCNTL-BTCH-PRC-DTE                                 01750000
017800         ,   :DTATTR-FSCL-MN-END-DTE                              01780000
018200         ,   :DTATTR-FSCL-WK-END-DTE                              01820000
018500         FROM                                                     01850000
018600             TCOCNTL CTL                                          01860000
018700           , TDTATTR DTE                                          01870000
018800         WHERE                                                    01880000
018910             CTL.BTCH_PRC_DTE = DTE.KY_DTE                        01891005
019000         AND OPER_UNT_ID = 90                                     01900000
019100         WITH UR                                                  01910000
019200     END-EXEC.                                                    01920000
019300                                                                  01930000
019400     EVALUATE TRUE                                                01940000
019500         WHEN SQLCODE = ZERO                                      01950000
019600         WHEN SQLCODE = -904                                      01960000
019700         WHEN SQLCODE = -911                                      01970000
019800         WHEN SQLCODE = -913                                      01980000
019900             CONTINUE                                             01990000
020000         WHEN SQLWARN0 NOT = SPACE                                02000000
020100         WHEN SQLCODE  NOT = ZERO                                 02010000
020200             MOVE '7000-GET-FISCAL-INFO'                          02020000
020300                                       TO PV-ABEND-PARAGRAPH      02030000
020400             MOVE 'SELECT'                                        02040000
020500                                       TO PV-ABEND-OPERATION      02050000
020600             MOVE 'TCOCNTL' TO PV-ABEND-STRUCTURE-1               02060000
020700             MOVE 'TDTATTR' TO PV-ABEND-STRUCTURE-2               02070000
020800             PERFORM 9900-DB2-ABEND                               02080000
020900     END-EVALUATE.                                                02090000
021000                                                                  02100000
021100 8000-READ-CONTROL-REC.                                           02110000
021200                                                                  02120000
021300     READ OLD-CONTROL-FILE INTO                                   02130000
021400           RC111-DATE-CONTROL-REC                                 02140000
021500     AT END                                                       02150000
021600         SET PS-END-EXTRACT           TO TRUE                     02160000
021700     NOT AT END                                                   02170000
021800         ADD 1                        TO PV-READ-COUNT            02180000
021900         DISPLAY 'ORIGINAL CONTROL CARD:'                         02190000
022000         DISPLAY RC111-DATE-CONTROL-REC                           02200000
022100         DISPLAY SPACES                                           02210000
022200     END-READ.                                                    02220000
022300                                                                  02230000
022400 8100-WRITE-CONTROL-REC.                                          02240000
022500                                                                  02250000
022600     ADD 1                         TO PV-WRITE-COUNT              02260000
022700     WRITE NEW-CONTROL-RECORD FROM                                02270000
022800           RC111-DATE-CONTROL-REC.                                02280000
022900/                                                                 02290000
023000 9000-TERMINATE.                                                  02300000
023100                                                                  02310000
023200     CLOSE OLD-CONTROL-FILE                                       02320000
023300           NEW-CONTROL-FILE.                                      02330002
023400                                                                  02340000
023500     DISPLAY '************************'.                          02350000
023600     DISPLAY '******* RCKUT185 *******'.                          02360000
023700     DISPLAY '************************'.                          02370000
023800     DISPLAY SPACES                                               02380000
023900                                                                  02390000
024000     DISPLAY 'GENERATED CONTROL CARD:'                            02400000
024100     DISPLAY RC111-DATE-CONTROL-REC                               02410000
024200     DISPLAY SPACES                                               02420000
024300                                                                  02430000
024400     DISPLAY 'BATCH CONTROL DATE = ' COCNTL-BTCH-PRC-DTE          02440000
024500                                                                  02450000
024600     MOVE PV-READ-COUNT               TO PV-DISP-NBR              02460000
024700     DISPLAY 'CONTROL CARDS READ         = ' PV-DISP-NBR          02470000
024800                                                                  02480000
024900     MOVE PV-WRITE-COUNT              TO PV-DISP-NBR              02490000
025000     DISPLAY 'CONTROL CARDS WRITTEN      = ' PV-DISP-NBR          02500000
025100     DISPLAY SPACES                                               02510000
025200     DISPLAY '************************'.                          02520000
025300                                                                  02530000
025400 9900-DB2-ABEND.                                                  02540000
025500                                                                  02550000
025600     MOVE SQLCODE TO PV-SQLCODE.                                  02560000
025700     DISPLAY '*** DB2 ERROR '.                                    02570000
025800     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02580000
025900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02590000
026000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02600000
026100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02610000
026200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02620000
026300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02630000
026400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02640000
026500     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             02650000
026600                                                                  02660000
026700     IF PV-ABEND-STRUCTURE-2 > SPACES                             02670000
026800         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          02680000
026900     END-IF.                                                      02690000
027000                                                                  02700000
027100                                                                  02710000
027200     COPY DPPD004.                                                02720000
027300                                                                  02730000
027400     MOVE +4013                  TO PV-ABEND-CODE.                02740000
027500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02750000
027600                                                                  02760000
027700 9200-ABEND.                                                      02770000
027800******************************************************************02780000
027900*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       02790000
028000******************************************************************02800000
028100     DISPLAY '***************************'.                       02810000
028200     DISPLAY '**       ABEND           **'.                       02820000
028300     DISPLAY '**  IN PROGRAM RCKUT185  **'.                       02830000
028400     DISPLAY '***************************'.                       02840000
028500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02850000
028600     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       02860000
028700     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       02870000
028800                                                                  02880000
028900     MOVE +4014                  TO PV-ABEND-CODE.                02890000
029000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02900000
029100                                                                  02910000
