000001 IDENTIFICATION DIVISION.                                         00010000
000002 PROGRAM-ID.    POKCS070.                                         00020000
000003 AUTHOR.        STEVE FLUNKER.                                    00030000
000004 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000005 DATE-WRITTEN.  03-25-95.                                         00050000
000006 DATE-COMPILED.                                                   00060000
000007                                                                  00070000
000008*---------------------------------------------------------------* 00080000
000009*    W070 - EDI TRANSPORTATION TRACKING INQUIRY                 * 00090000
000010*                                                               * 00100000
000011*    THIS PROGRAM LISTS ALL TRANSPORTATION INFORMATION RELEVANT * 00110000
000012*    TO A GIVEN PURCHASE ORDER.                                 * 00120000
000013*                                                               * 00130000
000014* UPDATE: 5/24/95 STEVE FLUNKER                                 * 00140000
000015* - ADDED LOGIC TO DISPLAY USER CARTON COUNT IF CARRIER IS ZERO * 00150000
000016* - FIXED A SCROLLING PROBLEM WITH THE 14TH RECORD              * 00160000
000017* UPDATE: 6/12/95 STEVE FLUNKER                                 * 00170000
000018* - ADDED LOGIC TO DISPLAY RECEIVED LOCATION CITY/STATE         * 00180000
000019* - FOR DC STATUS, IF USER CARTON COUNT IS ZERO, USE CARRIER    * 00190000
000020* - FOR CARRIER STATUS, USE TSHIPMT.VEH_NBR NOT TVEHICL         * 00200000
C98147*----------------------------------------------------------------*00210099
C98147* 11/21/14  LINDA FRIESS                    - CHG0098147          00220099
C98147*   - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA          00230099
C98147*   - REMOVED UNUSED FIELDS & LOGIC FROM PARAGRAPH 4000           00240099
000021*---------------------------------------------------------------* 00250000
076319* DATE  10/27/2021                                                00251099
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00252099
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00253099
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00254099
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00255099
076312*                                                               * 00256099
076318*---------------------------------------------------------------* 00257099
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00258099
CICS  *                                                               * 00259099
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00259199
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00259299
CICS  *---------------------------------------------------------------* 00259399
000022                                                                  00260000
000023 ENVIRONMENT DIVISION.                                            00270000
000024                                                                  00280000
000025 DATA DIVISION.                                                   00290000
000026                                                                  00300000
000027 WORKING-STORAGE SECTION.                                         00310000
000028                                                                  00320000
000029 01  DK-DB2-KEYS.                                                 00330000
000030     05  DK-BOL-NBR                  PIC X(30)  VALUE SPACES.     00340000
000031     05  DK-VEH-TYP                  PIC X(02)  VALUE SPACES.     00350000
000032                                                                  00360000
000033 01  PC-PROGRAM-CONSTANTS.                                        00370000
000034     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00380000
000035                                                    'PO070A  '.   00390000
000036     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00400000
000037                                                    'POKM070 '.   00410000
000038     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00420000
000039                                                    'POKCS070'.   00430000
000040     05  PC-DATE-MODULE                 PIC  X(08)  VALUE         00440000
000041                                                    'DPKUT500'.   00450000
000042     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00460000
000043     05  PC-A                           PIC  X(01)  VALUE 'A'.    00470099
000044     05  PC-I                           PIC  X(01)  VALUE 'I'.    00480099
000045     05  PC-N                           PIC  X(01)  VALUE 'N'.    00490099
000046     05  PC-T                           PIC  X(01)  VALUE 'T'.    00500099
000047     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    00510099
000048     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    00520099
000049     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE SPACE.  00530099
000050     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +05     00540099
000051                                                    COMP SYNC.    00550099
000052     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00560099
000053                                                    COMP SYNC.    00570099
000054     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00580099
000055                                                    +1000000      00590099
000056                                                    COMP-3.       00600099
000057     05  PC-MAX-IDX                     PIC S9(09)  VALUE         00610099
000058                                                    +100          00620099
000059                                                    COMP-3.       00630099
000060     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00640099
000061                                                    COMP SYNC.    00650099
000062     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00660099
000063                                                    COMP-3.       00670099
000064 01  PC-TSYMSG-NUMBERS.                                           00680099
000065     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00690099
000066     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00700099
000067     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00710099
000068     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00720099
000069     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00730099
000070     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  00740099
000071     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00750099
000072     05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.  00760099
000073     05  PC-TSYMSG-00984                PIC 9(5)    VALUE 00984.  00770099
000074                                                                  00780099
000075 01  PS-PROGRAM-SUBSCRIPTS.                                       00790099
000076     05  PS-SUB                         PIC S9(04)   VALUE +0     00800099
000077                                                     COMP SYNC.   00810099
000078                                                                  00820099
000079 01  PS-PROGRAM-SWITCHES.                                         00830099
000080     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00840099
000081         88  PS-NO-ERROR                             VALUE 'Y'.   00850099
000082         88  PS-ERROR                                VALUE 'N'.   00860099
000083     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00870099
000084         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00880099
000085         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00890099
000086     05  PS-SORT-DONE-SWITCH            PIC  X(01).               00900099
000087         88  PS-SORT-DONE                            VALUE 'Y'.   00910099
000088         88  PS-SORT-NOT-DONE                        VALUE 'N'.   00920099
000089     05  PS-SET-IDX-SWITCH              PIC  X(01).               00930099
000090         88  PS-SET-IDX-DOWN                         VALUE 'Y'.   00940099
000091         88  PS-DIDNT-SET-IDX-DOWN                   VALUE 'N'.   00950099
000092     EJECT                                                        00960099
000093                                                                  00970099
000094 01  PV-PROGRAM-VARIABLES.                                        00980099
000095     05  PV-SHIPST-ETA-DATE             PIC  X(10).               00990099
000096     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01000099
000097                                                    COMP SYNC.    01010099
000098     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     01020099
000099                                                     COMP SYNC.   01030099
000100     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     01040099
000101                                                     COMP-3.      01050099
000102     05  PV-READ-COUNTER                PIC S9(09)   VALUE +0     01060099
000103                                                     COMP-3.      01070099
000104     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01080099
000105                                                     COMP-3.      01090099
000106     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01100099
000107                                                     COMP-3.      01110099
000108     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01120099
000109                                                     COMP SYNC.   01130099
000110     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01140099
000111                                                     COMP SYNC.   01150099
000112     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01160099
000113                                                     COMP SYNC.   01170099
000114     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01180099
000115                                                     COMP SYNC.   01190099
000116     05  PV-SQL-SUB                     PIC S9(4)    COMP.        01200099
000117     05  PV-DB2-STATUS-CDE              PIC X(02)    VALUE SPACES.01210099
000120     05  PV-TMST-NULL                   PIC S9(04)  VALUE +0      01220099
000121                                                    COMP SYNC.    01230099
000124     05  PV-PRE-CONV-DATE               PIC X(10).                01240099
000125                                                                  01250099
000126     05  PV-SHIPT-ID                    PIC S9(9) COMP            01260099
000127                                            VALUE ZERO.           01270099
000128     05  PV-SHIPT-ID2                   PIC S9(9) COMP            01280099
000129                                            VALUE ZERO.           01290099
000130     05  PV-TRIP-ID                     PIC  S9(9) COMP           01300099
000131                                            VALUE ZERO.           01310099
000136     05  PV-DATE-10.                                              01320099
000137         10  PV-CENTURY-10              PIC 9(02).                01330099
000138         10  PV-YEAR-10                 PIC 9(02).                01340099
000139         10  FILLER                     PIC X(01)    VALUE SPACES.01350099
000140         10  PV-MONTH-10                PIC 9(02).                01360099
000141         10  FILLER                     PIC X(01)    VALUE SPACES.01370099
000142         10  PV-DAY-10                  PIC 9(02).                01380099
000143     05  PV-STATUS-DTE                  PIC X(10)    VALUE SPACES.01390099
000144                                                                  01400099
000145     05  PV-DATE-8.                                               01410099
000146         10  PV-MONTH-8                 PIC X(02).                01420099
000147         10  FILLER                     PIC X(01)    VALUE '/'.   01430099
000148         10  PV-DAY-8                   PIC X(02).                01440099
000149         10  FILLER                     PIC X(01)    VALUE '/'.   01450099
000150         10  PV-YEAR-8                  PIC X(02).                01460099
000151                                                                  01470099
000152     05  PV-TIME-5.                                               01480099
000153         10 PV-HOUR-5                   PIC 9(02).                01490099
000154         10 PV-COLON                    PIC X(01).                01500099
000155         10 PV-MINUTE-5                 PIC 9(02).                01510099
000156                                                                  01520099
000157     05  PV-TIME-8.                                               01530099
000158         10 PV-HOUR-8                   PIC 9(02).                01540099
000159         10 FILLER                      PIC X(01).                01550099
000160         10 PV-MINUTE-8                 PIC 9(02).                01560099
000161         10 FILLER                      PIC X(01).                01570099
000162         10 PV-SECOND-8                 PIC 9(02).                01580099
000163                                                                  01590099
000170     05  PV-ENT-NAME-DESC.                                        01600099
000171         10 PV-CARRIER-NME              PIC X(10).                01610099
000172         10 FILLER                      PIC X(20).                01620099
000173                                                                  01630099
000170     05  PV-CITY-NAME.                                            01640099
000171         10 PV-CITY-NAME-15             PIC X(15).                01650099
000172         10 FILLER                      PIC X(05).                01660099
000173                                                                  01670099
000174     05  PV-TEMP-BOL          PIC X(30).                          01680099
000175     05  PV-TRIP-STATUS-CDE   PIC X(02) VALUE SPACES.             01690099
000176     05  PV-TEMP-DTE          PIC X(10).                          01700099
000177     05  PV-TEMP-TME          PIC X(08).                          01710099
000178     05  PV-TEMP-TME2         PIC X(08).                          01720099
000179     05  PV-TEMP-VTYP         PIC X(02).                          01730099
000180     05  PV-TEMP-TRIP         PIC S9(9) COMP.                     01740099
000181     05  PV-TEMP-SHIP         PIC S9(9) COMP.                     01750099
000182     05  PV-TEMP-VNBR         PIC X(10).                          01760099
000183     05  PV-TEMP-PRO          PIC X(22).                          01770099
000184     05  PV-HOLD-BOL          PIC X(30).                          01780099
000185     05  PV-HOLD-DTE          PIC X(10).                          01790099
000186     05  PV-HOLD-TME          PIC X(08).                          01800099
000187     05  PV-HOLD-VTYP         PIC X(02).                          01810099
000188     05  PV-HOLD-TRIP         PIC S9(9) COMP.                     01820099
000189     05  PV-HOLD-SHIP         PIC S9(9) COMP.                     01830099
000190     05  PV-HOLD-VNBR         PIC X(10).                          01840099
000191     05  PV-HOLD-PRO          PIC X(22).                          01850099
000192     05  PV-EXPTED-CART-CNT   PIC S9(9) COMP.                     01860099
000194     05  PV-ACTL-CART-CNT     PIC S9(9) COMP.                     01870099
000195     05  PV-DB2-TRBL-CNT      PIC S9(9) COMP-3 VALUE +0.          01880099
000197                                                                  01890099
000198 01  PV-SAVE-TABLE.                                               01900099
000199      05  PV-SAVE-OCC              OCCURS 100 TIMES               01910099
000200                                   INDEXED BY PV-SAVE-IDX.        01920099
000201          10  PV-SAVE-BOL          PIC X(30).                     01930099
000202          10  PV-SAVE-DTE          PIC X(10).                     01940099
000203          10  PV-SAVE-TME          PIC X(08).                     01950099
000204          10  PV-SAVE-VTYP         PIC X(02).                     01960099
000205          10  PV-SAVE-TRIP         PIC S9(9) COMP.                01970099
000206          10  PV-SAVE-SHIP         PIC S9(9) COMP.                01980099
000207          10  PV-SAVE-VNBR         PIC X(10).                     01990099
000208          10  PV-SAVE-PRO          PIC X(22).                     02000099
000209                                                                  02010099
000210 01  PV-SAVE-TABLE2.                                              02020099
000211      05  PV-SAVE2-OCC              OCCURS 100 TIMES              02030099
000212                                   INDEXED BY PV-SAVE2-IDX.       02040099
000213          10  PV-SAVE2-BOL          PIC X(30).                    02050099
000214          10  PV-SAVE2-DTE          PIC X(10).                    02060099
000215          10  PV-SAVE2-TME          PIC X(08).                    02070099
000216          10  PV-SAVE2-VTYP         PIC X(02).                    02080099
000217          10  PV-SAVE2-TRIP         PIC S9(9) COMP.               02090099
000218          10  PV-SAVE2-SHIP         PIC S9(9) COMP.               02100099
000219          10  PV-SAVE2-VNBR         PIC X(10).                    02110099
000220          10  PV-SAVE2-PRO          PIC X(22).                    02120099
000221                                                                  02130099
000222 01  PV-DB2-CRITERIA-AREA.                                        02140099
000223     15  PV-DB2-MESSAGE-NUMBER          PIC S9(05)  VALUE ZERO    02150099
000224                                                    COMP-3.       02160099
000225                                                                  02170099
000226 EJECT                                                            02180099
000227*---------------------------------------------------------------* 02190099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02200099
000229*---------------------------------------------------------------* 02210099
000230                                                                  02220099
000231     COPY DPWS030.                                                02230099
CICS       COPY DPWS930.                                                02231099
000232 EJECT                                                            02240099
000233*---------------------------------------------------------------* 02250099
000234*    STANDARD COMMAREA.                                         * 02260099
000235*---------------------------------------------------------------* 02270099
000236                                                                  02280099
000237     COPY DPWS020.                                                02290099
000238     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02300099
000239                                                                  02310099
000240*---------------------------------------------------------------* 02320099
000241*    INTER-APPLICATION COMMAREA.                                * 02330099
000242*---------------------------------------------------------------* 02340099
000243                                                                  02350099
000244         10  INTER-APPL-COMM-AREA       PIC X(200).               02360099
000245     COPY POWS017.                                                02370099
000246                                                                  02380099
000247*---------------------------------------------------------------* 02390099
000248*    SPECIFIC COMMMAREA FOR POKCS070.  (1902)                   * 02400099
000249*---------------------------------------------------------------* 02410099
000250         10  ASC-SPECIFIC-COMMAREA.                               02420099
000251             15  ASC-LIST-KEYS.                                   02430099
000252                 20  ASC-KEY-PO-NUMBER               PIC S9(09)   02440099
000253                                                         COMP.    02450099
C98147                 20  ASC-PO-NUMBER                   PIC 9(08).   02460099
000255                 20  ASC-ENT-NAME-DESC               PIC X(30).   02470099
000256                 20  ASC-TRBL-REASON                 PIC X(10).   02480099
000257                 20  ASC-MULTI-TRBL                  PIC X(01).   02490099
000258             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02500099
000259                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02510099
000260                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02520099
000261                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02530099
000262                 20  ASC-ITEM-ENTRIES OCCURS 05 TIMES.            02540099
000263                     25  ASC-LIST-ITEM-NUMBER        PIC S9(09)   02550099
000264                                                     COMP-3.      02560099
000265                     25  ASC-BOL-HDR                 PIC X(04).   02570099
000266                     25  ASC-BOL-NBR                 PIC X(30).   02580099
000267                     25  ASC-CARRIER-HDR             PIC X(10).   02590099
000268                     25  ASC-CARRIER-NME             PIC X(10).   02600099
000269                     25  ASC-TRAILER-HDR             PIC X(08).   02610099
000270                     25  ASC-TRAILER-NBR             PIC X(10).   02620099
000271                     25  ASC-VEHHDR-TYPE             PIC X(12).   02630099
000272                     25  ASC-VEHICLE-TYPE            PIC X(10).   02640099
000273                     25  ASC-VENDHD-QTY              PIC X(04).   02650099
000274                     25  ASC-VENDOR-QTY              PIC 9(07).   02660099
000275                     25  ASC-VENDOR-UOM              PIC X(03).   02670099
000276                     25  ASC-POE-HDR                 PIC X(05).   02680099
000277                     25  ASC-STATUS-CITY             PIC X(19).   02690099
000278                     25  ASC-STATUS-STATE            PIC X(02).   02700099
000279                     25  ASC-ETA-HDR                 PIC X(04).   02710099
000280                     25  ASC-ETA                     PIC X(08).   02720099
000281                     25  ASC-STATUS-HDR              PIC X(12).   02730099
000282                     25  ASC-STATUS-DTE              PIC X(08).   02740099
000283                     25  ASC-STATUS-TME              PIC X(05).   02750099
000284                     25  ASC-STATUS-TME-ZNE          PIC X(02).   02760099
000285                     25  ASC-STATUS-DESC             PIC X(22).   02770099
000286                     25  ASC-STATUS-DESC-C           PIC X(01).   02780099
000287                                                                  02790099
000288             15  ASC-BLK-SUB                         PIC S9(04)   02800099
000289                                                         COMP     02810099
000290                                                         SYNC.    02820099
000291             15  ASC-ITEM-SUB                        PIC S9(04)   02830099
000292                                                         COMP     02840099
000293                                                         SYNC.    02850099
000294             15  ASC-SEL-SUB                         PIC S9(04)   02860099
000295                                                         COMP.    02870099
000296             15  ASC-SEL-ITEM                        PIC S9(04)   02880099
000297                                                         COMP.    02890099
000298             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02900099
000299                                                         COMP-3.  02910099
000300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02920099
000301                                                         COMP-3.  02930099
000302             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   02940099
000303                                                         COMP-3.  02950099
000304             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02960099
000305                                                         COMP-3.  02970099
000306             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02980099
000307                                                         COMP-3.  02990099
000308             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03000099
000309                                                         COMP-3.  03010099
000310             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03020099
000311                                                         COMP     03030099
000312                                                         SYNC.    03040099
000313             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03050099
000314                                                         COMP-3.  03060099
000315             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03070099
000316                                                         COMP-3.  03080099
000317             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03090099
000318                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 03100099
000319                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 03110099
000320                 88  ASC-ITEMS-LEFT-ON-EDI             VALUE 'T'. 03120099
000321                 88  ASC-NO-ITEMS-LEFT-ON-EDI          VALUE 'F'. 03130099
000322             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  03140099
000323                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03150099
000324             15  ASC-DESC-LINE-IND                   PIC  X(01).  03160099
000325                 88  ASC-DESC-LINE-DONE                VALUE 'Y'. 03170099
000326             15  ASC-CORR-LINE-IND                   PIC  X(01).  03180099
000327                 88  ASC-CORR-LINE-DONE                VALUE 'Y'. 03190099
000328             15  ASC-LIST-QUEUE-NAME.                             03200099
000329                 20  ASC-LIST-TERM-ID                PIC  X(04).  03210099
000330                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03220099
000331                                                         COMP-3.  03230099
000332                 20  ASC-LIST-SEQ                    PIC  9(01).  03240099
000333             15  ASC-SEL-QUEUE-NAME.                              03250099
000334                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03260099
000335                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03270099
000336                                                          COMP-3. 03280099
000337                 20  ASC-SEL-SEQ                     PIC  9(01).  03290099
000338             15  ASC-DTL-QUEUE-NAME.                              03300099
000339                 20  ASC-DTL-TERM-ID                 PIC  X(04).  03310099
000340                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)   03320099
000341                                                         COMP-3.  03330099
000342                 20  ASC-DTL-SEQ                     PIC  9(01).  03340099
000343                                                                  03350099
000344             15  ASC-START-ITEM-REQUEST.                          03360099
000345                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03370099
000346                                                                  03380099
000347     EJECT                                                        03390099
000348                                                                  03400099
000349*---------------------------------------------------------------* 03410099
000350*    ABEND PROCESSING COPYBOOK.                                 * 03420099
000351*---------------------------------------------------------------* 03430099
000352                                                                  03440099
000353     COPY DPWS013.                                                03450099
000354                                                                  03460099
000355     EJECT                                                        03470099
000356*---------------------------------------------------------------* 03480099
000357*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03490099
000358*---------------------------------------------------------------* 03500099
000359                                                                  03510099
000360     COPY DPWS015.                                                03520099
000361                                                                  03530099
000362*---------------------------------------------------------------* 03540099
000363*    FUNCTION KEYS COPYBOOK.                                    * 03550099
000364*---------------------------------------------------------------* 03560099
000365                                                                  03570099
000366     COPY DPWS016.                                                03580099
000367                                                                  03590099
000368*---------------------------------------------------------------* 03600099
000369*    NUMERIC EDIT LAYOUT.                                       * 03610099
000370*---------------------------------------------------------------* 03620099
000371                                                                  03630099
000372     COPY DPWS010I.                                               03640099
000373                                                                  03650099
000374*---------------------------------------------------------------* 03660099
000375*    MAP LAYOUT                                                 * 03670099
000376*---------------------------------------------------------------* 03680099
000377                                                                  03690099
000378     COPY POKM070.                                                03700099
000379                                                                  03710099
000380 01  MR-OCCURS-LAYOUT           REDEFINES  PO070AO.               03720099
000381     05  FILLER                 PIC X(48).                        03730099
000382                                                                  03740099
000383     05  MR-PO-NBR-L            PIC S9(04) COMP.                  03750099
000384     05  MR-PO-NBR-A            PIC  X(01).                       03760099
000385     05  MR-PO-NBR-C            PIC  X(01).                       03770099
000386     05  MR-PO-NBR-H            PIC  X(01).                       03780099
C98147     05  MR-PO-NBR-X.                                             03790099
C98147         10  MR-PO-NBR          PIC  Z(08).                       03800099
000388                                                                  03810099
000389     05  MR-ENT-NAME-DESC-L     PIC S9(04) COMP.                  03820099
000390     05  MR-ENT-NAME-DESC-A     PIC  X(01).                       03830099
000391     05  MR-ENT-NAME-DESC-C     PIC  X(01).                       03840099
000392     05  MR-ENT-NAME-DESC-H     PIC  X(01).                       03850099
000393     05  MR-ENT-NAME-DESC       PIC  X(30).                       03860099
000394                                                                  03870099
000395     05  MR-TRBL-REASON-L       PIC S9(04) COMP.                  03880099
000396     05  MR-TRBL-REASON-A       PIC  X(01).                       03890099
000397     05  MR-TRBL-REASON-C       PIC  X(01).                       03900099
000398     05  MR-TRBL-REASON-H       PIC  X(01).                       03910099
000399     05  MR-TRBL-REASON         PIC  X(10).                       03920099
000400                                                                  03930099
000401     05  MR-MULTI-TRBL-L        PIC S9(04) COMP.                  03940099
000402     05  MR-MULTI-TRBL-A        PIC  X(01).                       03950099
000403     05  MR-MULTI-TRBL-C        PIC  X(01).                       03960099
000404     05  MR-MULTI-TRBL-H        PIC  X(01).                       03970099
000405     05  MR-MULTI-TRBL          PIC  X(01).                       03980099
000406                                                                  03990099
000407     05  MR-SCROLL-AREA OCCURS 5 TIMES.                           04000099
000408         10  MR-BOL-HDR-L       PIC S9(04) COMP.                  04010099
000409         10  MR-BOL-HDR-A       PIC  X(01).                       04020099
000410         10  MR-BOL-HDR-C       PIC  X(01).                       04030099
000411         10  MR-BOL-HDR-H       PIC  X(01).                       04040099
000412         10  MR-BOL-HDR         PIC  X(04).                       04050099
000413                                                                  04060099
000414         10  MR-BOL-NBR-L       PIC S9(04) COMP.                  04070099
000415         10  MR-BOL-NBR-A       PIC  X(01).                       04080099
000416         10  MR-BOL-NBR-C       PIC  X(01).                       04090099
000417         10  MR-BOL-NBR-H       PIC  X(01).                       04100099
000418         10  MR-BOL-NBR         PIC  X(30).                       04110099
000419                                                                  04120099
000420         10  MR-CARRIER-HDR-L   PIC S9(04) COMP.                  04130099
000421         10  MR-CARRIER-HDR-A   PIC  X(01).                       04140099
000422         10  MR-CARRIER-HDR-C   PIC  X(01).                       04150099
000423         10  MR-CARRIER-HDR-H   PIC  X(01).                       04160099
000424         10  MR-CARRIER-HDR     PIC  X(10).                       04170099
000425                                                                  04180099
000426         10  MR-CARRIER-NME-L   PIC S9(04) COMP.                  04190099
000427         10  MR-CARRIER-NME-A   PIC  X(01).                       04200099
000428         10  MR-CARRIER-NME-C   PIC  X(01).                       04210099
000429         10  MR-CARRIER-NME-H   PIC  X(01).                       04220099
000430         10  MR-CARRIER-NME     PIC  X(10).                       04230099
000431                                                                  04240099
000432         10  MR-TRAILER-HDR-L   PIC S9(04) COMP.                  04250099
000433         10  MR-TRAILER-HDR-A   PIC  X(01).                       04260099
000434         10  MR-TRAILER-HDR-C   PIC  X(01).                       04270099
000435         10  MR-TRAILER-HDR-H   PIC  X(01).                       04280099
000436         10  MR-TRAILER-HDR     PIC  X(08).                       04290099
000437                                                                  04300099
000438         10  MR-TRAILER-NBR-L   PIC S9(04) COMP.                  04310099
000439         10  MR-TRAILER-NBR-A   PIC  X(01).                       04320099
000440         10  MR-TRAILER-NBR-C   PIC  X(01).                       04330099
000441         10  MR-TRAILER-NBR-H   PIC  X(01).                       04340099
000442         10  MR-TRAILER-NBR     PIC  X(10).                       04350099
000443                                                                  04360099
000444         10  MR-VEHHDR-TYPE-L  PIC S9(04) COMP.                   04370099
000445         10  MR-VEHHDR-TYPE-A  PIC  X(01).                        04380099
000446         10  MR-VEHHDR-TYPE-C  PIC  X(01).                        04390099
000447         10  MR-VEHHDR-TYPE-H  PIC  X(01).                        04400099
000448         10  MR-VEHHDR-TYPE    PIC  X(12).                        04410099
000449                                                                  04420099
000450         10  MR-VEHICLE-TYPE-L  PIC S9(04) COMP.                  04430099
000451         10  MR-VEHICLE-TYPE-A  PIC  X(01).                       04440099
000452         10  MR-VEHICLE-TYPE-C  PIC  X(01).                       04450099
000453         10  MR-VEHICLE-TYPE-H  PIC  X(01).                       04460099
000454         10  MR-VEHICLE-TYPE    PIC  X(10).                       04470099
000455                                                                  04480099
000456         10  MR-VENDHD-QTY-L    PIC S9(04) COMP.                  04490099
000457         10  MR-VENDHD-QTY-A    PIC  X(01).                       04500099
000458         10  MR-VENDHD-QTY-C    PIC  X(01).                       04510099
000459         10  MR-VENDHD-QTY-H    PIC  X(01).                       04520099
000460         10  MR-VENDHD-QTY      PIC  X(4).                        04530099
000461                                                                  04540099
000462         10  MR-VENDOR-QTY-L    PIC S9(04) COMP.                  04550099
000463         10  MR-VENDOR-QTY-A    PIC  X(01).                       04560099
000464         10  MR-VENDOR-QTY-C    PIC  X(01).                       04570099
000465         10  MR-VENDOR-QTY-H    PIC  X(01).                       04580099
000466         10  MR-VENDOR-QTY      PIC  ZZZZZZZ.                     04590099
000467                                                                  04600099
000468         10  MR-VENDOR-UOM-L    PIC S9(04) COMP.                  04610099
000469         10  MR-VENDOR-UOM-A    PIC  X(01).                       04620099
000470         10  MR-VENDOR-UOM-C    PIC  X(01).                       04630099
000471         10  MR-VENDOR-UOM-H    PIC  X(01).                       04640099
000472         10  MR-VENDOR-UOM      PIC  X(03).                       04650099
000473                                                                  04660099
000474         10  MR-POE-HDR-L       PIC S9(04) COMP.                  04670099
000475         10  MR-POE-HDR-A       PIC  X(01).                       04680099
000476         10  MR-POE-HDR-C       PIC  X(01).                       04690099
000477         10  MR-POE-HDR-H       PIC  X(01).                       04700099
000478         10  MR-POE-HDR         PIC  X(05).                       04710099
000479                                                                  04720099
000480         10  MR-STATUS-CITY-L   PIC S9(04) COMP.                  04730099
000481         10  MR-STATUS-CITY-A   PIC  X(01).                       04740099
000482         10  MR-STATUS-CITY-C   PIC  X(01).                       04750099
000483         10  MR-STATUS-CITY-H   PIC  X(01).                       04760099
000484         10  MR-STATUS-CITY     PIC  X(19).                       04770099
000485                                                                  04780099
000486         10  MR-STATUS-STATE-L  PIC S9(04) COMP.                  04790099
000487         10  MR-STATUS-STATE-A  PIC  X(01).                       04800099
000488         10  MR-STATUS-STATE-C  PIC  X(01).                       04810099
000489         10  MR-STATUS-STATE-H  PIC  X(01).                       04820099
000490         10  MR-STATUS-STATE    PIC  X(02).                       04830099
000491                                                                  04840099
000492         10  MR-ETA-HDR-L       PIC S9(04) COMP.                  04850099
000493         10  MR-ETA-HDR-A       PIC  X(01).                       04860099
000494         10  MR-ETA-HDR-C       PIC  X(01).                       04870099
000495         10  MR-ETA-HDR-H       PIC  X(01).                       04880099
000496         10  MR-ETA-HDR         PIC  X(04).                       04890099
000497                                                                  04900099
000498         10  MR-ETA-L           PIC S9(04) COMP.                  04910099
000499         10  MR-ETA-A           PIC  X(01).                       04920099
000500         10  MR-ETA-C           PIC  X(01).                       04930099
000501         10  MR-ETA-H           PIC  X(01).                       04940099
000502         10  MR-ETA             PIC  X(08).                       04950099
000503                                                                  04960099
000504         10  MR-STATUS-HDR-L PIC S9(04) COMP.                     04970099
000505         10  MR-STATUS-HDR-A PIC     X(01).                       04980099
000506         10  MR-STATUS-HDR-C PIC     X(01).                       04990099
000507         10  MR-STATUS-HDR-H PIC     X(01).                       05000099
000508         10  MR-STATUS-HDR      PIC  X(12).                       05010099
000509                                                                  05020099
000510         10  MR-STATUS-DTE-L PIC S9(04) COMP.                     05030099
000511         10  MR-STATUS-DTE-A PIC     X(01).                       05040099
000512         10  MR-STATUS-DTE-C PIC     X(01).                       05050099
000513         10  MR-STATUS-DTE-H PIC     X(01).                       05060099
000514         10  MR-STATUS-DTE      PIC  X(08).                       05070099
000515                                                                  05080099
000516         10  MR-STATUS-TME-L PIC S9(04) COMP.                     05090099
000517         10  MR-STATUS-TME-A PIC     X(01).                       05100099
000518         10  MR-STATUS-TME-C PIC     X(01).                       05110099
000519         10  MR-STATUS-TME-H PIC     X(01).                       05120099
000520         10  MR-STATUS-TME      PIC  X(05).                       05130099
000521                                                                  05140099
000522         10  MR-STATUS-TME-ZNE-L PIC S9(04) COMP.                 05150099
000523         10  MR-STATUS-TME-ZNE-A PIC X(01).                       05160099
000524         10  MR-STATUS-TME-ZNE-C PIC X(01).                       05170099
000525         10  MR-STATUS-TME-ZNE-H PIC X(01).                       05180099
000526         10  MR-STATUS-TME-ZNE  PIC  X(02).                       05190099
000527                                                                  05200099
000528         10  MR-STATUS-DESC-L PIC S9(04) COMP.                    05210099
000529         10  MR-STATUS-DESC-A PIC    X(01).                       05220099
000530         10  MR-STATUS-DESC-C PIC    X(01).                       05230099
000531         10  MR-STATUS-DESC-H PIC    X(01).                       05240099
000532         10  MR-STATUS-DESC     PIC  X(22).                       05250099
000533                                                                  05260099
000534 EJECT                                                            05270099
000535*---------------------------------------------------------------* 05280099
000536*    DB2 AREA FOR TSHIPMT TABLE                                 * 05290099
000537*---------------------------------------------------------------* 05300099
000538     EXEC SQL                                                     05310099
000539          INCLUDE TSHIPMT                                         05320099
000540     END-EXEC.                                                    05330099
000541*---------------------------------------------------------------* 05340099
000542*    DB2 AREA FOR TPLNSHP TABLE                                 * 05350099
000543*---------------------------------------------------------------* 05360099
000544     EXEC SQL                                                     05370099
000545          INCLUDE TPLNSHP                                         05380099
000546     END-EXEC.                                                    05390099
000547*---------------------------------------------------------------* 05400099
000548*    DB2 AREA FOR TIMPOE  TABLE                                 * 05410099
000549*---------------------------------------------------------------* 05420099
000550     EXEC SQL                                                     05430099
000551          INCLUDE TIMPOE                                          05440099
000552     END-EXEC.                                                    05450099
000553*---------------------------------------------------------------* 05460099
000554*    DB2 AREA FOR TVHTRIP TABLE                                 * 05470099
000555*---------------------------------------------------------------* 05480099
000556     EXEC SQL                                                     05490099
000557          INCLUDE TVHTRIP                                         05500099
000558     END-EXEC.                                                    05510099
000559*---------------------------------------------------------------* 05520099
000560*    DB2 AREA FOR TVEHICL TABLE                                 * 05530099
000561*---------------------------------------------------------------* 05540099
000562     EXEC SQL                                                     05550099
000563          INCLUDE TVEHICL                                         05560099
000564     END-EXEC.                                                    05570099
000565*---------------------------------------------------------------* 05580099
000566*    DB2 AREA FOR TSHPTPO TABLE                                 * 05590099
000567*---------------------------------------------------------------* 05600099
000568     EXEC SQL                                                     05610099
000569          INCLUDE TSHPTPO                                         05620099
000570     END-EXEC.                                                    05630099
000571*---------------------------------------------------------------* 05640099
000572*    DB2 AREA FOR TSHSTYP TABLE                                 * 05650099
000573*---------------------------------------------------------------* 05660099
000574     EXEC SQL                                                     05670099
000575          INCLUDE TSHSTYP                                         05680099
000576     END-EXEC.                                                    05690099
000577*---------------------------------------------------------------* 05700099
000578*    DB2 AREA FOR TEXTENT TABLE                                 * 05710099
000579*---------------------------------------------------------------* 05720099
000580     EXEC SQL                                                     05730099
000581          INCLUDE TEXTENT                                         05740099
000582     END-EXEC.                                                    05750099
000583*---------------------------------------------------------------* 05760099
000584*    DB2 AREA FOR TENTNME TABLE                                 * 05770099
000585*---------------------------------------------------------------* 05780099
000586     EXEC SQL                                                     05790099
000587          INCLUDE TENTNME                                         05800099
000588     END-EXEC.                                                    05810099
000589*---------------------------------------------------------------* 05820099
000590*    DB2 AREA FOR TSHIPST TABLE                                 * 05830099
000591*---------------------------------------------------------------* 05840099
000592     EXEC SQL                                                     05850099
000593          INCLUDE TSHIPST                                         05860099
000594     END-EXEC.                                                    05870099
000595*---------------------------------------------------------------* 05880099
000596*    DB2 AREA FOR TTRIPST TABLE                                 * 05890099
000597*---------------------------------------------------------------* 05900099
000598     EXEC SQL                                                     05910099
000599          INCLUDE TTRIPST                                         05920099
000600     END-EXEC.                                                    05930099
000601*---------------------------------------------------------------* 05940099
000602*    DB2 AREA FOR XMT_LOC TABLE                                 * 05950099
000603*---------------------------------------------------------------* 05960099
000604     EXEC SQL                                                     05970099
000605          INCLUDE XMT00001                                        05980099
000606     END-EXEC.                                                    05990099
000607*---------------------------------------------------------------* 06000099
000608*    DB2 AREA FOR TPURCHS TABLE                                 * 06010099
000609*---------------------------------------------------------------* 06020099
000610     EXEC SQL                                                     06030099
000611          INCLUDE TPURCHS                                         06040099
000612     END-EXEC.                                                    06050099
000613*---------------------------------------------------------------* 06060099
000614*    DB2 AREA FOR TTRBNTF TABLE (TROUBLE NOTIFICATION)          * 06070099
000615*---------------------------------------------------------------* 06080099
000616     EXEC SQL                                                     06090099
000617          INCLUDE TTRBNTF                                         06100099
000618     END-EXEC.                                                    06110099
000619*---------------------------------------------------------------* 06120099
000620*    DB2 AREA FOR TTRBRSN TABLE (TROUBLE REASON)                * 06130099
000621*---------------------------------------------------------------* 06140099
000622     EXEC SQL                                                     06150099
000623          INCLUDE TTRBRSN                                         06160099
000624     END-EXEC.                                                    06170099
000625*---------------------------------------------------------------* 06180099
000626*    DB2 AREA FOR COMMUNICATIONS                                * 06190099
000627*---------------------------------------------------------------* 06200099
000628     EXEC SQL                                                     06210099
000629          INCLUDE SQLCA                                           06220099
000630     END-EXEC.                                                    06230099
000631                                                                  06240099
000632     EXEC SQL                                                     06250099
000633          DECLARE BOL-CSR CURSOR FOR                              06260099
000634          SELECT DISTINCT A.COMPLETE_BOL_NBR                      06270099
000635                         ,MIN(C.STATUS_DTE)                       06280099
000636                         ,C.SHIPT_ID                              06290099
000637                         ,A.TRIP_ID                               06300099
000638                         ,A.PRO_NBR                               06310099
000639          FROM TSHIPMT A,                                         06320099
000640               TSHPTPO B,                                         06330099
000641               TSHIPST C                                          06340099
000642          WHERE B.PO_NBR      = :ASC-KEY-PO-NUMBER                06350099
000643            AND A.SHIPT_ID    = B.SHIPT_ID                        06360099
000644            AND A.SHIPT_ID    = C.SHIPT_ID                        06370099
000645          GROUP BY A.COMPLETE_BOL_NBR, C.SHIPT_ID, A.TRIP_ID,     06380099
000646                   A.PRO_NBR                                      06390099
000647          ORDER BY 2 DESC, 1 DESC                                 06400099
000648     END-EXEC.                                                    06410099
000649                                                                  06420099
000650                                                                  06430099
000651     EXEC SQL                                                     06440099
000652          DECLARE EDI-CSR CURSOR FOR                              06450099
000653          SELECT DISTINCT A.SHIPT_ID,                             06460099
000654                          A.EXPTED_PKG_QTY,                       06470099
000655                          A.CARR_CART_CT,                         06480099
000656                          A.PKG_TYP_CDE,                          06490099
000657                          A.VEH_NBR,                              06500099
000658                          D.ENT_NAME_DESC,                        06510099
000659                          E.CITY_NAME,                            06520099
000660                          E.STATE_CDE,                            06530099
000661                          E.STATUS_DTE,                           06540099
000662                          E.STATUS_TME,                           06550099
000663                          E.TIME_ZONE_CDE,                        06560099
000664                          E.SHIPT_STATUS_CDE,                     06570099
000665                          E.CARR_STATUS_CDE,                      06580099
000666                          B.EXPTED_CART_CNT,                      06590099
000667                          B.ACTL_CART_CNT                         06600099
000668          FROM TSHIPMT A,                                         06610099
000669               TSHPTPO B,                                         06620099
000670               TEXTENT C,                                         06630099
000671               TENTNME D,                                         06640099
000672               TSHIPST E                                          06650099
000673          WHERE B.PO_NBR      = :ASC-KEY-PO-NUMBER                06660099
000674            AND A.COMPLETE_BOL_NBR =:DK-BOL-NBR                   06670099
000675            AND A.TRIP_ID     =:PV-TRIP-ID                        06680099
000676            AND A.SHIPT_ID    = B.SHIPT_ID                        06690099
000677            AND A.SHIPT_ID    = E.SHIPT_ID                        06700099
000678            AND A.PRO_SCAC_ID = C.SCAC_CDE                        06710099
000679            AND C.PRTNR_TYP_CDE                                   06720099
000680                              = 'CR'                              06730099
000681            AND C.ENT_ID      = D.ENT_ID                          06740099
000682            AND D.TYPE_CDE    = '04'                              06750099
000683          ORDER BY E.STATUS_DTE DESC, E.STATUS_TME DESC,          06760099
000684                   A.SHIPT_ID                                     06770099
000685     END-EXEC.                                                    06780099
000686                                                                  06790099
000687                                                                  06800099
000688     EXEC SQL                                                     06810099
000689          DECLARE EDI-CSR2 CURSOR FOR                             06820099
000690          SELECT      MIN(E.SHIPT_ID),                            06830099
000710                          A.PKG_TYP_CDE,                          06840000
000720                          A.VEH_NBR,                              06850000
000721                          D.ENT_NAME_DESC,                        06860000
000722                          E.CITY_NAME,                            06870000
000723                          E.STATE_CDE,                            06880000
000724                      MIN(E.STATUS_DTE),                          06890000
000725                      MIN(E.STATUS_TME),                          06900000
000726                          E.TIME_ZONE_CDE,                        06910000
000727                          E.SHIPT_STATUS_CDE,                     06920000
000728                          E.CARR_STATUS_CDE,                      06930000
000730                      SUM(B.EXPTED_CART_CNT),                     06940000
000731                      SUM(B.ACTL_CART_CNT)                        06950000
000732          FROM TSHIPMT A,                                         06960000
000733               TSHPTPO B,                                         06970000
000734               TEXTENT C,                                         06980000
000735               TENTNME D,                                         06990000
000736               TSHIPST E                                          07000000
000737          WHERE B.PO_NBR      = :ASC-KEY-PO-NUMBER                07010000
000738            AND A.COMPLETE_BOL_NBR =:DK-BOL-NBR                   07020000
000739            AND A.TRIP_ID     =:PV-TRIP-ID                        07030000
000740            AND A.SHIPT_ID    = B.SHIPT_ID                        07040000
000741            AND A.SHIPT_ID    = E.SHIPT_ID                        07050000
000742            AND A.PRO_SCAC_ID = C.SCAC_CDE                        07060000
000750            AND C.PRTNR_TYP_CDE                                   07070099
000751                              = 'CR'                              07080099
000752            AND C.ENT_ID      = D.ENT_ID                          07090000
000753            AND D.TYPE_CDE    = '04'                              07100000
000754          GROUP BY E.SHIPT_STATUS_CDE,E.CITY_NAME, E.STATE_CDE,   07110099
000755                   E.TIME_ZONE_CDE,E.CARR_STATUS_CDE,A.PKG_TYP_CDE07120099
000756                   ,A.VEH_NBR,D.ENT_NAME_DESC                     07130099
000758     END-EXEC.                                                    07140000
000759                                                                  07150000
000760 EJECT                                                            07160000
000762*---------------------------------------------------------------* 07170099
000763*    CURSOR DECLARATION FOR SELECTING POE CODE CITY AND STATE   * 07180099
000764*---------------------------------------------------------------* 07190099
000765                                                                  07200099
000766     EXEC SQL                                                     07210099
000767          DECLARE  POE-CSR CURSOR                                 07220099
000768              FOR  SELECT DISTINCT                                07230099
000769                   B.POE_CTY_NM,                                  07240099
000770                   B.POE_ST_CDE                                   07250099
000772             FROM  TPLNSHP A                                      07260099
000773                  ,TIMPOE  B                                      07270099
000774            WHERE  A.PO_NBR            = :ASC-KEY-PO-NUMBER       07280099
000775              AND  A.VER_STATUS_CDE    = :PC-A                    07290099
000776              AND  A.POE_CDE           = B.POE_CDE                07300099
000777              AND  B.PO_ASGMT_ALWD_IND = :PC-Y                    07310099
000778     END-EXEC.                                                    07320099
000786                                                                  07330099
000787 EJECT                                                            07340099
000788 LINKAGE SECTION.                                                 07350099
000789                                                                  07360099
000790 01  DFHCOMMAREA.                                                 07370099
000791     05  FILLER                         OCCURS  1 TO 4072 TIMES   07380099
000792                                        DEPENDING ON EIBCALEN.    07390099
000793         10  FILLER                     PIC X.                    07400099
000794                                                                  07410099
000795 EJECT                                                            07420099
000796 PROCEDURE DIVISION.                                              07430099
000797                                                                  07440099
000798***************************************************************** 07450099
000799** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 07460099
000800** THE SETUP AND PERFORM OF PARAGRAPH 9000-CALL-CICS-ARCH-API  ** 07470099
000801** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 07480099
000802**                                                             ** 07490099
000803** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 07500099
000804** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 07510099
000805***************************************************************** 07520099
000806 0000-MAIN-MODULE.                                                07530099
000807                                                                  07540099
000808     INITIALIZE DP030-CICS-API-FIELDS.                            07550099
000809                                                                  07560099
000810     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        07570099
000811     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           07580099
000812     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          07590099
000813                                                                  07600099
000814     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        07610099
000815                                                                  07620099
000816     MOVE LENGTH OF PO070AI       TO DP030-MAP-LENGTH (1).        07630099
000817     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      07640099
000818                                                                  07650099
000819     PERFORM 9000-CALL-CICS-ARCH-API.                             07660099
000820     PERFORM 1000-CONTROL-PROCESSING.                             07670099
000821                                                                  07680099
000822     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      07690099
000823     PERFORM 9000-CALL-CICS-ARCH-API.                             07700099
000824                                                                  07710099
000825*----------------------------------------------------------------*07720099
000826*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *07730099
000827*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *07740099
000828*----------------------------------------------------------------*07750099
000829                                                                  07760099
000830 1000-CONTROL-PROCESSING.                                         07770099
000831                                                                  07780099
000832     EVALUATE TRUE                                                07790099
000833         WHEN DP020-NEXT-ACT-INITIAL                              07800099
000834             INITIALIZE ASC-SPECIFIC-COMMAREA                     07810099
000835             MOVE SPACE             TO ASC-START-ITEM-REQUEST     07820099
000836             MOVE EIBTRMID          TO ASC-DTL-TERM-ID            07830099
000837             MOVE DP020-SRC-TASK-NUMBER                           07840099
000838                                    TO ASC-DTL-TASK-NUMBER        07850099
000839             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                07860099
000840             MOVE PO017-PO-NBR TO ASC-KEY-PO-NUMBER               07870099
000841             PERFORM 2050-DELETE-DETAIL-QUEUE                     07880099
000842             PERFORM 4000-BUILD-INITIAL-PANEL                     07890099
000843                                                                  07900099
000844                                                                  07910099
000845         WHEN DP020-NEXT-ACT-READ-MAP                             07920099
000846             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07930099
000847                               TO PV-TOP-ITEM                     07940099
000848             PERFORM 2000-PROCESS-PANEL                           07950099
000849                                                                  07960099
000850         WHEN DP020-NEXT-ACT-RETURN                               07970099
000851             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07980099
000852                               TO PV-TOP-ITEM                     07990099
000853             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL        08000099
000854             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08010099
000855                                                                  08020099
000856         WHEN OTHER                                               08030099
000857             SET DP013-LOGIC-ABEND TO TRUE                        08040099
000858             SET DP013-NO-ROLLBACK TO TRUE                        08050099
000859             MOVE '1000-CONTROL-PROCESSING'                       08060099
000860                               TO  DP013-PARAGRAPH                08070099
000861             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08080099
000862                               TO  DP013-MESSAGE-TEXT(1)          08090099
000863             PERFORM DP013-0000-PROCESS-ABEND                     08100099
000864     END-EVALUATE.                                                08110099
000865                                                                  08120099
000866 EJECT                                                            08130099
000867                                                                  08140099
000868*----------------------------------------------------------------*08150099
000869*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *08160099
000870*    ON WHAT FUNCTION KEY WAS SELECTED.                          *08170099
000871*----------------------------------------------------------------*08180099
000872                                                                  08190099
000873 2000-PROCESS-PANEL.                                              08200099
000874                                                                  08210099
000875     EVALUATE TRUE                                                08220099
000876         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08230099
000877             INITIALIZE PO017-INTER-APPL-COMMAREA                 08240099
000878             MOVE ASC-KEY-PO-NUMBER TO PO017-PO-NBR               08250099
000879                                                                  08260099
000880         WHEN DP020-SRC-AID = DP016-CLEAR                         08270099
000881             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                08280099
000882             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08290099
000883             PERFORM 3200-RESET-ATTRIBUTES                        08300099
000884                                                                  08310099
000885         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08320099
000886             PERFORM 2050-DELETE-DETAIL-QUEUE                     08330099
000887             PERFORM 4000-BUILD-INITIAL-PANEL                     08340099
000888             PERFORM 3200-RESET-ATTRIBUTES                        08350099
000889                                                                  08360099
000890         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08370099
000891             MOVE +1 TO PV-TOP-ITEM                               08380099
000892             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08390099
000893             PERFORM 3200-RESET-ATTRIBUTES                        08400099
000894                                                                  08410099
000895         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08420099
000896             PERFORM 2110-BROWSE-BACKWARD                         08430099
000897             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08440099
000898             PERFORM 3200-RESET-ATTRIBUTES                        08450099
000899                                                                  08460099
000900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08470099
000901             PERFORM 2120-BROWSE-FORWARD                          08480099
000902             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08490099
000903             PERFORM 3200-RESET-ATTRIBUTES                        08500099
000904                                                                  08510099
000905         WHEN DP020-SRC-AID = DP016-ENTER                         08520099
000906             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08530099
000907             IF  PS-ERROR                                         08540099
000908                 CONTINUE                                         08550099
000909             ELSE                                                 08560099
000910                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08570099
000911                 PERFORM 3200-RESET-ATTRIBUTES                    08580099
000912             END-IF                                               08590099
000913                                                                  08600099
000914         WHEN OTHER                                               08610099
000915             SET DP013-NO-ROLLBACK TO TRUE                        08620099
000916             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               08630099
000917             SET DP013-CICS-ABEND TO TRUE                         08640099
000918             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    08650099
000919             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08660099
000920                                   TO DP013-MESSAGE-TEXT (1)      08670099
000921             PERFORM DP013-0000-PROCESS-ABEND                     08680099
000922                                                                  08690099
000923     END-EVALUATE.                                                08700099
000924 EJECT                                                            08710099
000925*----------------------------------------------------------------*08720099
000926*    DELETE THE TEMPORARY STORAGE QUEUE.                         *08730099
000927*----------------------------------------------------------------*08740099
000928                                                                  08750099
000929 2050-DELETE-DETAIL-QUEUE.                                        08760099
000930                                                                  08770099
000931     EXEC CICS                                                    08780099
000932         DELETEQ TS                                               08790099
000933             QUEUE (ASC-DTL-QUEUE-NAME)                           08800099
000934             RESP  (PV-CICS-RESP)                                 08810099
000935     END-EXEC.                                                    08820099
000936                                                                  08830099
000937     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08840099
000938        (PV-CICS-RESP = DFHRESP(QIDERR))                          08850099
000939         CONTINUE                                                 08860099
000940     ELSE                                                         08870099
000941         SET DP013-CICS-ABEND TO TRUE                             08880099
000942         SET DP013-NO-ROLLBACK TO TRUE                            08890099
000943                                                                  08900099
000944         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH       08910099
000945         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  08920099
000946                        TO DP013-MESSAGE-TEXT (1)                 08930099
000947         PERFORM DP013-0000-PROCESS-ABEND                         08940099
000948     END-IF.                                                      08950099
000949                                                                  08960099
000950     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        08970099
000951 EJECT                                                            08980099
000952*----------------------------------------------------------------*08990099
000953*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09000099
000954*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09010099
000955*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09020099
000956*    MESSAGE.                                                    *09030099
000957*----------------------------------------------------------------*09040099
000958                                                                  09050099
000959 2110-BROWSE-BACKWARD.                                            09060099
000960                                                                  09070099
000961     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09080099
000962         GIVING PV-TOP-ITEM.                                      09090099
000963                                                                  09100099
000964     IF  PV-TOP-ITEM < +1                                         09110099
000965         MOVE +1              TO PV-TOP-ITEM                      09120099
000966*        -- TOP OF LIST --                                        09130099
000967         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 09140099
000968         SET DP020-MSG-INFORMATIONAL TO TRUE                      09150099
000969     END-IF.                                                      09160099
000970                                                                  09170099
000971 EJECT                                                            09180099
000972                                                                  09190099
000973*----------------------------------------------------------------*09200099
000974*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09210099
000975*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09220099
000976*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09230099
000977*----------------------------------------------------------------*09240099
000978                                                                  09250099
000979 2120-BROWSE-FORWARD.                                             09260099
000980                                                                  09270099
000981     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09280099
000982         GIVING PV-TOP-ITEM.                                      09290099
000983     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09300099
000984         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09310099
000985                                   TO PV-TOP-ITEM                 09320099
000986*        -- BOTTOM OF LIST --                                     09330099
000987         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09340099
000988         SET DP020-MSG-INFORMATIONAL                              09350099
000989                                   TO TRUE                        09360099
000990     ELSE                                                         09370099
000991         COMPUTE PV-BOTTOM-ITEM =                                 09380099
000992             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09390099
000993         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09400099
000994*            -- BOTTOM OF LIST --                                 09410099
000995             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09420099
000996             SET DP020-MSG-INFORMATIONAL                          09430099
000997                                   TO TRUE                        09440099
000998         END-IF                                                   09450099
000999     END-IF.                                                      09460099
001000 EJECT                                                            09470099
001001*----------------------------------------------------------------*09480099
001002*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09490099
001003*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09500099
001004*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09510099
001005*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *09520099
001006*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09530099
001007*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09540099
001008*----------------------------------------------------------------*09550099
001009                                                                  09560099
001010 2130-CHECK-FOR-JUMP-BROWSE.                                      09570099
001011                                                                  09580099
001012     IF ASTRTITL > ZERO                                           09590099
001013         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      09600099
001014     ELSE                                                         09610099
001015         IF ASTRTITF = DP015-ERASE-EOF                            09620099
001016             INITIALIZE ASC-START-ITEM-REQUEST                    09630099
001017         END-IF                                                   09640099
001018     END-IF.                                                      09650099
001019                                                                  09660099
001020     SET PS-NO-ERROR               TO TRUE.                       09670099
001021     IF (ASC-START-ITEM-REQUEST = SPACE)                          09680099
001022         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09690099
001023                                   TO PV-TOP-ITEM                 09700099
001024     ELSE                                                         09710099
001025         MOVE ASC-START-ITEM-REQUEST                              09720099
001026                                   TO DP010I-UNEDITED-FIELD       09730099
001027         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09740099
001028         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09750099
001029         SET DP010I-NEGATIVE-NOT-ALLOWED                          09760099
001030                                   TO TRUE                        09770099
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09781099
264230                         USING DP010I-NUMERIC-EDIT-AREA           09782099
001032                                                                  09790099
001033         IF  NOT DP010I-ERROR-DETECTED                            09800099
001034             MOVE DP010I-NUMERIC-FIELD                            09810099
001035                                   TO  ASC-START-ITEM-REQUEST-N   09820099
001036             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09830099
001037                 IF  ASC-START-ITEM-REQUEST-N >                   09840099
001038                                          ASC-NUMBER-OF-ITEMS-READ09850099
001039                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09860099
001040                     COMPUTE PV-TOP-ITEM =                        09870099
001041                             ASC-NUMBER-OF-ITEMS-READ             09880099
001042                             - PC-ITEMS-PER-PANEL + 1             09890099
001043                     IF  PV-TOP-ITEM < +1                         09900099
001044                         MOVE +1   TO PV-TOP-ITEM                 09910099
001045                         MOVE PC-TSYMSG-00070                     09920099
001046                                   TO DP020-MSG-NUMBER            09930099
001047                         SET DP020-MSG-INFORMATIONAL              09940099
001048                                   TO TRUE                        09950099
001049                     END-IF                                       09960099
001050                 ELSE                                             09970099
001051                     MOVE ASC-START-ITEM-REQUEST-N                09980099
001052                                   TO PV-TOP-ITEM                 09990099
001053                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10000099
001054                     COMPUTE PV-BOTTOM-ITEM =                     10010099
001055                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10020099
001056                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10030099
001057*                        -- BOTTOM OF LIST --                     10040099
001058                         MOVE PC-TSYMSG-00070                     10050099
001059                                   TO DP020-MSG-NUMBER            10060099
001060                         SET DP020-MSG-INFORMATIONAL              10070099
001061                                   TO TRUE                        10080099
001062                     END-IF                                       10090099
001063                 END-IF                                           10100099
001064             ELSE                                                 10110099
001065*                --- VALUE OUT OF RANGE ----                      10120099
001066                 MOVE PC-TSYMSG-00101                             10130099
001067                                   TO DP020-MSG-NUMBER            10140099
001068                 MOVE -1           TO ASTRTITL                    10150099
001069                 SET DP030-SET-CURSOR-APPL-1                      10160099
001070                                   TO TRUE                        10170099
001071                 MOVE DP015-REVERSE                               10180099
001072                                   TO ASTRTITH                    10190099
001073                 MOVE DP015-RED    TO ASTRTITC                    10200099
001074                 MOVE DP015-UNP-NUM-BRT-MDT                       10210099
001075                                   TO ASTRTITA                    10220099
001076                 SET DP020-MSG-FATAL                              10230099
001077                                   TO TRUE                        10240099
001078                 SET PS-ERROR      TO TRUE                        10250099
001079             END-IF                                               10260099
001080                                                                  10270099
001081         ELSE                                                     10280099
001082             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10290099
001083             MOVE -1               TO ASTRTITL                    10300099
001084             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10310099
001085             MOVE DP015-REVERSE    TO ASTRTITH                    10320099
001086             MOVE DP015-RED        TO ASTRTITC                    10330099
001087             MOVE DP015-UNP-NUM-BRT-MDT                           10340099
001088                                   TO ASTRTITA                    10350099
001089             SET DP020-MSG-FATAL   TO TRUE                        10360099
001090             SET PS-ERROR          TO TRUE                        10370099
001091         END-IF                                                   10380099
001092     END-IF.                                                      10390099
001100 EJECT                                                            10400099
001118                                                                  10410099
001119*----------------------------------------------------------------*10420099
001120*    RESET ATTRIBUTES.                                           *10430099
001121*----------------------------------------------------------------*10440099
001122                                                                  10450099
001123 3200-RESET-ATTRIBUTES.                                           10460099
001124                                                                  10470099
001125     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10480099
001126     MOVE DP015-GREEN              TO ASTRTITC.                   10490099
001127     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10500099
001128     MOVE -1                       TO ASTRTITL.                   10510099
001129     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       10520099
001130                                                                  10530099
001131 EJECT                                                            10540099
001132                                                                  10550099
001133*----------------------------------------------------------------*10560099
001134*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *10570099
001135*    INITIALIZE ALL COUNTERS AND FLAGS.                          *10580099
001136*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *10590099
001137*    DISPLAY THE PANEL TO USER.                                  *10600099
001138*----------------------------------------------------------------*10610099
001139                                                                  10620099
001140 4000-BUILD-INITIAL-PANEL.                                        10630099
001141                                                                  10640099
001142     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            10650099
001143                                 ASC-BLOCK-ENTRIES (2).           10660099
001144     MOVE +1                 TO  ASC-BLK-SUB.                     10670099
001145     SET ASC-ITEMS-LEFT-ON-DB                                     10680099
001146                             TO  TRUE.                            10690099
001147                                                                  10700099
001148     MOVE +0                 TO  ASC-ITEM-SUB                     10710099
001149                                 ASC-NUMBER-OF-ITEMS-READ         10720099
001150                                 ASC-NUMBER-OF-SELECTED-ITEMS     10730099
001151                                 ASC-HIGHEST-BLOCK-WRITTEN        10740099
001152                                 ASC-START-OF-SELECTED-RANGE      10750099
001153                                 ASC-END-OF-SELECTED-RANGE        10760099
001154                                 ASC-ITEM-AT-TOP-OF-PANEL.        10770099
001155                                                                  10780099
001156     MOVE SPACE              TO  ASC-DESC-LINE-IND                10790099
001157                                 ASC-CORR-LINE-IND                10800099
001158                                 ASC-MULTI-TRBL.                  10810099
001159                                                                  10820099
C98147     MOVE ASC-KEY-PO-NUMBER  TO ASC-PO-NUMBER.                    10830099
001174                                                                  10840099
001175     PERFORM 4350-FILL-TROUBLE-FIELDS.                            10850099
001176                                                                  10860099
001177     PERFORM 4200-OPEN-BOL-CURSOR.                                10870099
001178     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            10880099
001179     INITIALIZE PV-SAVE-TABLE.                                    10890099
001180     INITIALIZE PV-SAVE-TABLE2.                                   10900099
001181     MOVE +0 TO PV-READ-COUNTER.                                  10910099
001182     PERFORM                                                      10920099
001183         VARYING PV-SAVE-IDX                                      10930099
001184         FROM 1 BY 1                                              10940099
001185         UNTIL ((PV-SAVE-IDX > PC-MAX-IDX)                        10950099
001186            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         10960099
001187              PERFORM 4220-FETCH-BOL-CURSOR                       10970099
001188           IF ASC-ITEMS-LEFT-ON-DB                                10980099
001189              ADD +1 TO PV-READ-COUNTER                           10990099
001190              MOVE DK-BOL-NBR TO PV-SAVE-BOL (PV-SAVE-IDX)        11000099
001191                                 PV-SAVE2-BOL (PV-SAVE-IDX)       11010099
001192              MOVE SHIPST-STATUS-DTE TO PV-SAVE-DTE (PV-SAVE-IDX) 11020099
001193                                        PV-SAVE2-DTE (PV-SAVE-IDX)11030099
001194              MOVE SHIPMT-TRIP-ID TO PV-SAVE-TRIP (PV-SAVE-IDX)   11040099
001195                                     PV-SAVE2-TRIP (PV-SAVE-IDX)  11050099
001196              MOVE SHIPST-SHIPT-ID TO PV-SAVE-SHIP (PV-SAVE-IDX)  11060099
001197                                     PV-SAVE2-SHIP (PV-SAVE-IDX)  11070099
001198              MOVE SHIPMT-PRO-NBR  TO PV-SAVE-PRO  (PV-SAVE-IDX)  11080099
001199                                     PV-SAVE2-PRO  (PV-SAVE-IDX)  11090099
001200              PERFORM 4310-GET-MIN-STATUS-TME                     11100099
001201              MOVE SHIPST-STATUS-TME TO PV-SAVE-TME (PV-SAVE-IDX) 11110099
001202                                        PV-SAVE2-TME (PV-SAVE-IDX)11120099
001203           END-IF                                                 11130099
001204      END-PERFORM.                                                11140099
001205     PERFORM 4300-CLOSE-BOL-CURSOR.                               11150099
001206     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            11160099
001207                                                                  11170099
001208      PERFORM 4235-GET-BOL-VEH-TYP-CDE                            11180099
001209         VARYING PV-SAVE-IDX                                      11190099
001210         FROM 1 BY 1                                              11200099
001211         UNTIL (PV-SAVE-IDX > PV-READ-COUNTER).                   11210099
001212* CLEAR OUT ANY DUPLICATE BOL NUMBERS IN THE TABLE BEFORE USING IT11220099
001213                                                                  11230099
001214       PERFORM                                                    11240099
001215         VARYING PV-SAVE-IDX                                      11250099
001216         FROM 1 BY 1                                              11260099
001217         UNTIL (PV-SAVE-IDX > PV-READ-COUNTER)                    11270099
001218           MOVE PV-SAVE-BOL(PV-SAVE-IDX) TO PV-HOLD-BOL           11280099
001219           MOVE PV-SAVE-TRIP(PV-SAVE-IDX) TO PV-TRIP-ID           11290099
001220           MOVE PV-SAVE-DTE(PV-SAVE-IDX) TO PV-HOLD-DTE           11300099
001221           SET PS-SORT-NOT-DONE TO TRUE                           11310099
001222             PERFORM                                              11320099
001223              VARYING PV-SAVE2-IDX                                11330099
001224              FROM 1 BY 1                                         11340099
001225              UNTIL (PV-SAVE2-IDX > PC-MAX-IDX OR PS-SORT-DONE)   11350099
001226                 IF (PV-HOLD-BOL = PV-SAVE-BOL(PV-SAVE2-IDX)      11360099
001227                    AND NOT PV-SAVE-IDX = PV-SAVE2-IDX            11370099
001228                    AND (PV-SAVE-TRIP(PV-SAVE2-IDX) = PV-TRIP-ID  11380099
001229                    AND PV-SAVE-VTYP(PV-SAVE-IDX) = 'VS'          11390099
001230                    OR PV-SAVE-VTYP (PV-SAVE-IDX) = 'AV'))        11400099
001231                      IF PV-HOLD-DTE > PV-SAVE-DTE(PV-SAVE2-IDX)  11410099
001232                         IF PV-SAVE-VNBR(PV-SAVE2-IDX) =          11420099
001233                             PV-SAVE-VNBR(PV-SAVE-IDX)            11430099
001234                             MOVE HIGH-VALUES TO PV-SAVE-BOL      11440099
001235                                               (PV-SAVE-IDX)      11450099
001236                          ELSE                                    11460099
001237                            IF PV-SAVE-VNBR(PV-SAVE-IDX) <= SPACES11470099
001238                               MOVE HIGH-VALUES TO PV-SAVE-BOL    11480099
001239                                                   (PV-SAVE-IDX)  11490099
001240                            ELSE                                  11500099
001241                               MOVE HIGH-VALUES TO PV-SAVE-BOL    11510099
001242                                                   (PV-SAVE2-IDX) 11520099
001243                            END-IF                                11530099
001244                         END-IF                                   11540099
001245                      ELSE                                        11550099
001246                        IF PV-HOLD-DTE = PV-SAVE-DTE(PV-SAVE2-IDX)11560099
001247                         IF PV-SAVE-BOL(PV-SAVE-IDX) = HIGH-VALUES11570099
001248                           MOVE LOW-VALUES TO PV-TEMP-TME         11580099
001249                         ELSE                                     11590099
001250                           MOVE PV-HOLD-BOL TO DK-BOL-NBR         11600099
001251                           MOVE PV-HOLD-DTE TO PV-STATUS-DTE      11610099
001252                           MOVE PV-SAVE-SHIP(PV-SAVE-IDX)         11620099
001253                                                  TO PV-SHIPT-ID2 11630099
001254                           PERFORM 4310-GET-MIN-STATUS-TME        11640099
001255                           MOVE SHIPST-STATUS-TME TO PV-TEMP-TME  11650099
001256                         END-IF                                   11660099
001257                        IF PV-SAVE-BOL(PV-SAVE2-IDX) = HIGH-VALUES11670099
001258                           MOVE LOW-VALUES TO PV-TEMP-TME2        11680099
001259                        ELSE                                      11690099
001260                           MOVE PV-SAVE-SHIP(PV-SAVE2-IDX)        11700099
001261                                                  TO PV-SHIPT-ID2 11710099
001262                           PERFORM 4310-GET-MIN-STATUS-TME        11720099
001263                           MOVE SHIPST-STATUS-TME TO PV-TEMP-TME2 11730099
001264                        END-IF                                    11740099
001265                               IF PV-TEMP-TME2 > PV-TEMP-TME      11750099
001266                                      MOVE HIGH-VALUES            11760099
001267                                      TO PV-SAVE-BOL(PV-SAVE2-IDX)11770099
001268                               ELSE                               11780099
001269                                      MOVE HIGH-VALUES            11790099
001270                                      TO PV-SAVE-BOL(PV-SAVE-IDX) 11800099
001271                               END-IF                             11810099
001272                            SET PS-SORT-DONE TO TRUE              11820099
001273                      END-IF                                      11830099
001274                     END-IF                                       11840099
001275             ELSE                                                 11850099
001276                    IF (PV-HOLD-BOL = PV-SAVE-BOL(PV-SAVE2-IDX)   11860099
001277                        AND NOT PV-SAVE-IDX = PV-SAVE2-IDX        11870099
001278                        AND NOT PV-SAVE-VTYP(PV-SAVE2-IDX) = 'VS' 11880099
001279                        AND NOT PV-SAVE-VTYP(PV-SAVE2-IDX) = 'AV' 11890099
001280                        AND NOT PV-SAVE-VTYP(PV-SAVE-IDX)  = 'VS' 11900099
001281                        AND NOT PV-SAVE-VTYP(PV-SAVE-IDX)  = 'AV' 11910099
001282                        AND NOT PV-SAVE-TRIP(PV-SAVE2-IDX) = 0    11920099
001283                        AND PV-SAVE-PRO(PV-SAVE-IDX) =            11930099
001284                            PV-SAVE-PRO(PV-SAVE2-IDX)             11940099
001285                        AND ((PV-SAVE-VNBR(PV-SAVE-IDX) <= SPACES 11950099
001286                        AND NOT PV-SAVE-VNBR(PV-SAVE2-IDX)        11960099
001287                                                  = SPACES)       11970099
001288                       OR (NOT PV-SAVE-VNBR(PV-SAVE-IDX) = SPACES 11980099
001289                           AND PV-SAVE-VNBR(PV-SAVE2-IDX) <=      11990099
001290                                                     SPACES)))    12000099
001291                       IF PV-HOLD-DTE > PV-SAVE-DTE(PV-SAVE2-IDX) 12010099
001292                         IF PV-SAVE-VNBR(PV-SAVE2-IDX) =          12020099
001293                             PV-SAVE-VNBR(PV-SAVE-IDX)            12030099
001294                             MOVE HIGH-VALUES TO PV-SAVE-BOL      12040099
001295                                               (PV-SAVE-IDX)      12050099
001296                          ELSE                                    12060099
001297                            IF PV-SAVE-VNBR(PV-SAVE-IDX) <= SPACES12070099
001298                               MOVE HIGH-VALUES TO PV-SAVE-BOL    12080099
001299                                                   (PV-SAVE-IDX)  12090099
001300                            ELSE                                  12100099
001301                               MOVE HIGH-VALUES TO PV-SAVE-BOL    12110099
001302                                                   (PV-SAVE2-IDX) 12120099
001303                            END-IF                                12130099
001304                         END-IF                                   12140099
001305                       ELSE                                       12150099
001306                        IF PV-HOLD-DTE = PV-SAVE-DTE(PV-SAVE2-IDX)12160099
001307                         IF PV-SAVE-BOL(PV-SAVE-IDX) = HIGH-VALUES12170099
001308                           MOVE LOW-VALUES TO PV-TEMP-TME         12180099
001309                         ELSE                                     12190099
001310                           MOVE PV-HOLD-BOL TO DK-BOL-NBR         12200099
001311                           MOVE PV-HOLD-DTE TO PV-STATUS-DTE      12210099
001312                           MOVE PV-SAVE-SHIP(PV-SAVE-IDX)         12220099
001313                                                  TO PV-SHIPT-ID2 12230099
001314                           PERFORM 4310-GET-MIN-STATUS-TME        12240099
001315                           MOVE SHIPST-STATUS-TME TO PV-TEMP-TME  12250099
001316                         END-IF                                   12260099
001317                        IF PV-SAVE-BOL(PV-SAVE2-IDX) = HIGH-VALUES12270099
001318                           MOVE LOW-VALUES TO PV-TEMP-TME2        12280099
001319                        ELSE                                      12290099
001320                           MOVE PV-SAVE-SHIP(PV-SAVE2-IDX)        12300099
001321                                                  TO PV-SHIPT-ID2 12310099
001322                           PERFORM 4310-GET-MIN-STATUS-TME        12320099
001323                           MOVE SHIPST-STATUS-TME TO PV-TEMP-TME2 12330099
001324                        END-IF                                    12340099
001325                               IF PV-TEMP-TME2 > PV-TEMP-TME      12350099
001326                                  IF PV-SAVE-VNBR(PV-SAVE2-IDX)   12360099
001327                                         <= SPACES                12370099
001328                                     MOVE HIGH-VALUES TO          12380099
001329                                        PV-SAVE-BOL(PV-SAVE2-IDX) 12390099
001330                                   ELSE                           12400099
001331                                     MOVE HIGH-VALUES TO          12410099
001332                                        PV-SAVE-BOL(PV-SAVE-IDX)  12420099
001333                                   END-IF                         12430099
001334                               ELSE                               12440099
001335                                  IF PV-SAVE-VNBR(PV-SAVE-IDX)    12450099
001336                                         <= SPACES                12460099
001337                                     MOVE HIGH-VALUES TO          12470099
001338                                        PV-SAVE-BOL(PV-SAVE-IDX)  12480099
001339                                  ELSE                            12490099
001340                                     MOVE HIGH-VALUES TO          12500099
001341                                        PV-SAVE-BOL(PV-SAVE2-IDX) 12510099
001342                                  END-IF                          12520099
001343                               END-IF                             12530099
001344                       END-IF                                     12540099
001345                       SET PS-SORT-DONE TO TRUE                   12550099
001346                    END-IF                                        12560099
001347                 END-IF                                           12570099
001348             END-IF                                               12580099
001349          END-PERFORM                                             12590099
001350       END-PERFORM.                                               12600099
001351* SORT THE TABLE BY STATUS DATE (DESCENDING ORDER)                12610099
001352                                                                  12620099
001353     SET PS-SORT-NOT-DONE TO TRUE.                                12630099
001354     SET PV-SAVE-IDX TO 1.                                        12640099
001355     PERFORM                                                      12650099
001356         VARYING PV-SAVE2-IDX                                     12660099
001357         FROM 1 BY 1                                              12670099
001358         UNTIL ((PV-SAVE2-IDX > PC-MAX-IDX) OR PS-SORT-DONE)      12680099
001359       IF NOT PV-SAVE-BOL(PV-SAVE-IDX) = HIGH-VALUES              12690099
001360            MOVE PV-SAVE-BOL(PV-SAVE-IDX) TO PV-HOLD-BOL          12700099
001361            MOVE PV-SAVE-DTE(PV-SAVE-IDX) TO PV-HOLD-DTE          12710099
001362            MOVE PV-SAVE-TME(PV-SAVE-IDX) TO PV-HOLD-TME          12720099
001363            MOVE PV-SAVE-VTYP(PV-SAVE-IDX) TO PV-HOLD-VTYP        12730099
001364            MOVE PV-SAVE-TRIP(PV-SAVE-IDX) TO PV-HOLD-TRIP        12740099
001365            MOVE PV-SAVE-SHIP(PV-SAVE-IDX) TO PV-HOLD-SHIP        12750099
001366            MOVE PV-SAVE-VNBR(PV-SAVE-IDX) TO PV-HOLD-VNBR        12760099
001367            MOVE PV-SAVE-PRO(PV-SAVE-IDX)  TO PV-HOLD-PRO         12770099
001368            SET PV-SAVE-IDX UP BY +1                              12780099
001369         IF PS-SORT-NOT-DONE                                      12790099
001370            IF (PV-HOLD-DTE < PV-SAVE-DTE(PV-SAVE-IDX)) OR        12800099
001371               (PV-HOLD-DTE = PV-SAVE-DTE(PV-SAVE-IDX) AND        12810099
001372               PV-HOLD-TME <  PV-SAVE-TME(PV-SAVE-IDX))           12820099
001373                  MOVE PV-SAVE-BOL(PV-SAVE-IDX) TO PV-TEMP-BOL    12830099
001374                  MOVE PV-SAVE-DTE(PV-SAVE-IDX) TO PV-TEMP-DTE    12840099
001375                  MOVE PV-SAVE-TME(PV-SAVE-IDX) TO PV-TEMP-TME    12850099
001376                  MOVE PV-SAVE-VTYP(PV-SAVE-IDX) TO PV-TEMP-VTYP  12860099
001377                  MOVE PV-SAVE-TRIP(PV-SAVE-IDX) TO PV-TEMP-TRIP  12870099
001378                  MOVE PV-SAVE-SHIP(PV-SAVE-IDX) TO PV-TEMP-SHIP  12880099
001379                  MOVE PV-SAVE-VNBR(PV-SAVE-IDX) TO PV-TEMP-VNBR  12890099
001380                  MOVE PV-SAVE-PRO(PV-SAVE-IDX)  TO PV-TEMP-PRO   12900099
001381                  MOVE PV-HOLD-BOL  TO PV-SAVE-BOL(PV-SAVE-IDX)   12910099
001382                  MOVE PV-HOLD-DTE  TO PV-SAVE-DTE(PV-SAVE-IDX)   12920099
001383                  MOVE PV-HOLD-TME  TO PV-SAVE-TME(PV-SAVE-IDX)   12930099
001384                  MOVE PV-HOLD-VTYP TO PV-SAVE-VTYP(PV-SAVE-IDX)  12940099
001385                  MOVE PV-HOLD-TRIP TO PV-SAVE-TRIP(PV-SAVE-IDX)  12950099
001386                  MOVE PV-HOLD-SHIP TO PV-SAVE-SHIP(PV-SAVE-IDX)  12960099
001387                  MOVE PV-HOLD-VNBR TO PV-SAVE-VNBR(PV-SAVE-IDX)  12970099
001388                  MOVE PV-HOLD-PRO  TO PV-SAVE-PRO(PV-SAVE-IDX)   12980099
001389                  SET PV-SAVE-IDX DOWN BY +1                      12990099
001390                  SET PS-SET-IDX-DOWN TO TRUE                     13000099
001391                  MOVE PV-TEMP-BOL  TO PV-SAVE-BOL(PV-SAVE-IDX)   13010099
001392                  MOVE PV-TEMP-DTE  TO PV-SAVE-DTE(PV-SAVE-IDX)   13020099
001393                  MOVE PV-TEMP-TME  TO PV-SAVE-TME(PV-SAVE-IDX)   13030099
001394                  MOVE PV-TEMP-VTYP TO PV-SAVE-VTYP(PV-SAVE-IDX)  13040099
001395                  MOVE PV-TEMP-TRIP TO PV-SAVE-TRIP(PV-SAVE-IDX)  13050099
001396                  MOVE PV-TEMP-SHIP TO PV-SAVE-SHIP(PV-SAVE-IDX)  13060099
001397                  MOVE PV-TEMP-VNBR TO PV-SAVE-VNBR(PV-SAVE-IDX)  13070099
001398                  MOVE PV-TEMP-PRO  TO PV-SAVE-PRO(PV-SAVE-IDX)   13080099
001399            END-IF                                                13090099
001400          ELSE                                                    13100099
001401           SET PS-SORT-DONE TO TRUE                               13110099
001402          END-IF                                                  13120099
001403          IF PS-SET-IDX-DOWN                                      13130099
001404           CONTINUE                                               13140099
001405          ELSE                                                    13150099
001406             SET PV-SAVE-IDX DOWN BY +1                           13160099
001407          END-IF                                                  13170099
001408       END-IF                                                     13180099
001409                                                                  13190099
001410* NOW LOOP THRU THE SAVE TABLE TO SEE IF ORDER IS CORRECT         13200099
001411          SET PS-SORT-DONE TO TRUE                                13210099
001412          PERFORM                                                 13220099
001413            VARYING PV-SAVE-IDX                                   13230099
001414            FROM 1 BY 1                                           13240099
001415            UNTIL ((PV-SAVE-IDX > PC-MAX-IDX) OR PS-SORT-NOT-DONE 13250099
001416               OR PV-SAVE-DTE(PV-SAVE-IDX) = SPACES)              13260099
001417            IF NOT PV-SAVE-BOL(PV-SAVE-IDX) = HIGH-VALUES         13270099
001418               MOVE PV-SAVE-BOL(PV-SAVE-IDX) TO PV-HOLD-BOL       13280099
001419               MOVE PV-SAVE-DTE(PV-SAVE-IDX) TO PV-HOLD-DTE       13290099
001420               MOVE PV-SAVE-TME(PV-SAVE-IDX) TO PV-HOLD-TME       13300099
001421               SET PV-SAVE-IDX UP BY +1                           13310099
001422            IF (PV-HOLD-DTE < PV-SAVE-DTE(PV-SAVE-IDX)) OR        13320099
001423               (PV-HOLD-DTE = PV-SAVE-DTE(PV-SAVE-IDX) AND        13330099
001424               PV-HOLD-TME <  PV-SAVE-TME(PV-SAVE-IDX))           13340099
001425                 SET PS-SORT-NOT-DONE TO TRUE                     13350099
001426            END-IF                                                13360099
001427            SET PV-SAVE-IDX DOWN BY +1                            13370099
001428      END-IF                                                      13380099
001429          END-PERFORM                                             13390099
001430      IF PV-SAVE-IDX > PV-READ-COUNTER                            13400099
001431         SET PV-SAVE-IDX TO +1                                    13410099
001432       ELSE                                                       13420099
001433         SET PV-SAVE-IDX DOWN BY +1                               13430099
001434      END-IF                                                      13440099
001435      END-PERFORM.                                                13450099
001436* END OF SORT                                                     13460099
001437                                                                  13470099
001438                                                                  13480099
001439     PERFORM 4210-READ-ITEMS-FROM-DB.                             13490099
001440                                                                  13500099
001441     MOVE +1                 TO  PV-TOP-ITEM.                     13510099
001442     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          13520099
001443         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    13530099
001444         SET DP020-MSG-FATAL   TO  TRUE                           13540099
001445         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               13550099
001446     ELSE                                                         13560099
001447         MOVE -1             TO ASTRTITL                          13570099
001448         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      13580099
001449         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     13590099
001450     END-IF.                                                      13600099
001451 EJECT                                                            13610099
001452                                                                  13620099
001453*----------------------------------------------------------------*13630099
001454*    SELECT ROW FROM TSHSTYP TABLE. THIS WILL RETURN THE         *13640099
001455*    APPROPRIATE DESCRIPTION FOR THE CURRENT STATUS OF A SHIPMENT*13650099
001456*----------------------------------------------------------------*13660099
001457 4100-SELECT-TSHSTYP.                                             13670099
001458                                                                  13680099
001459     EXEC SQL                                                     13690099
001460          SELECT DESC, PRTY_CDE                                   13700099
001461          INTO :SHSTYP-DESC, :SHSTYP-PRTY-CDE                     13710099
001462          FROM TSHSTYP                                            13720099
001463          WHERE SHIPT_STATUS_CDE = :PV-DB2-STATUS-CDE             13730099
001464     END-EXEC                                                     13740099
001465                                                                  13750099
001466     EVALUATE TRUE                                                13760099
001467         WHEN SQLCODE = +0                                        13770099
001468         WHEN SQLCODE = +100                                      13780099
001469              CONTINUE                                            13790099
001470         WHEN SQLCODE = -904                                      13800099
001471         WHEN SQLCODE = -911                                      13810099
001472         WHEN SQLCODE = -913                                      13820099
001473              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       13830099
001474              SET PS-ERROR                                        13840099
001475                  DP020-NEXT-ACT-APPL-ERROR                       13850099
001476                  DP020-MSG-FATAL                                 13860099
001477                      TO TRUE                                     13870099
001478              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 13880099
001479              PERFORM 9000-CALL-CICS-ARCH-API                     13890099
001480                                                                  13900099
001481         WHEN SQLWARN0 NOT = SPACES                               13910099
001482         WHEN SQLCODE < +0                                        13920099
001483         WHEN SQLCODE > +0                                        13930099
001484              MOVE '4100-SELECT-TSHSTYP'                          13940099
001485                              TO DP013-PARAGRAPH                  13950099
001486              MOVE 'UNSUCCESSFUL SELECT ON TSHSTYP'               13960099
001487                              TO DP013-MESSAGE-TEXT (1)           13970099
001488              MOVE SQLCA      TO DP013-SQLCA                      13980099
001489              MOVE 'TSHSTYP ' TO DP013-DB2-TABLE-NAME (1)         13990099
001490              SET DP013-DB2-ABEND                                 14000099
001491                  DP013-XCTL-DISPLAY-RESTART                      14010099
001492                              TO TRUE                             14020099
001493              PERFORM DP013-0000-PROCESS-ABEND                    14030099
001494     END-EVALUATE.                                                14040099
001495                                                                  14050099
001496*----------------------------------------------------------------*14060099
001497*    SELECT ROW FROM TTRIPST TABLE. THIS WILL RETURN THE         *14070099
001498*    FACILITY THAT THE SHIPMT WENT TO FOR INTERNAL STATUSES.     *14080099
001499*----------------------------------------------------------------*14090099
001500 4160-SELECT-TTRIPST.                                             14100099
001501                                                                  14110099
001502     EXEC SQL                                                     14120099
001503          SELECT OPER_UNT_ID                                      14130099
001504          INTO :TRIPST-OPER-UNT-ID                                14140099
001505          FROM TTRIPST                                            14150099
001506          WHERE TRIP_ID = :SHIPMT-TRIP-ID                         14160099
001507            AND TRIP_STATUS_CDE =:PV-TRIP-STATUS-CDE              14170099
001508     END-EXEC                                                     14180099
001509                                                                  14190099
001510     EVALUATE TRUE                                                14200099
001511         WHEN SQLCODE = +100                                      14210099
001512         WHEN SQLCODE = +0                                        14220099
001513              CONTINUE                                            14230099
001514         WHEN SQLCODE = -904                                      14240099
001515         WHEN SQLCODE = -911                                      14250099
001516         WHEN SQLCODE = -913                                      14260099
001517              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       14270099
001518              SET PS-ERROR                                        14280099
001519                  DP020-NEXT-ACT-APPL-ERROR                       14290099
001520                  DP020-MSG-FATAL                                 14300099
001521                      TO TRUE                                     14310099
001522              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 14320099
001523              PERFORM 9000-CALL-CICS-ARCH-API                     14330099
001524                                                                  14340099
001525         WHEN SQLWARN0 NOT = SPACES                               14350099
001526         WHEN SQLCODE < +0                                        14360099
001527         WHEN SQLCODE > +0                                        14370099
001528              MOVE '4160-SELECT-TTRIPST'                          14380099
001529                              TO DP013-PARAGRAPH                  14390099
001530              MOVE 'UNSUCCESSFUL SELECT ON TTRIPST'               14400099
001531                              TO DP013-MESSAGE-TEXT (1)           14410099
001532              MOVE SQLCA      TO DP013-SQLCA                      14420099
001533              MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (1)         14430099
001534              SET DP013-DB2-ABEND                                 14440099
001535                  DP013-XCTL-DISPLAY-RESTART                      14450099
001536                              TO TRUE                             14460099
001537              PERFORM DP013-0000-PROCESS-ABEND                    14470099
001538     END-EVALUATE.                                                14480099
001539*                                                                 14490099
001540*----------------------------------------------------------------*14500099
001541*    SELECT ROW FROM XMT_LOC TABLE. THIS WILL RETURN THE         *14510099
001542*    FACILITY THAT THE SHIPMT WENT TO FOR INTERNAL STATUSES.     *14520099
001543*----------------------------------------------------------------*14530099
001544 4170-SELECT-XMT-LOC.                                             14540099
001545*                                                                 14550099
001546     EXEC SQL                                                     14560099
001547          SELECT CTY_NM,ST_CDE                                    14570099
001548          INTO :PV-CITY-NAME,                                     14580099
001549               :XMT00001-ST-CDE                                   14590099
001550          FROM XMT_LOC                                            14600099
001551          WHERE LOC_NBR = :TRIPST-OPER-UNT-ID                     14610099
001553     END-EXEC                                                     14620099
001554                                                                  14630099
001555     EVALUATE TRUE                                                14640099
001556         WHEN SQLCODE = +100                                      14650099
001557         WHEN SQLCODE = +0                                        14660099
001558              CONTINUE                                            14670099
001559         WHEN SQLCODE = -904                                      14680099
001560         WHEN SQLCODE = -911                                      14690099
001561         WHEN SQLCODE = -913                                      14700099
001562              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       14710099
001563              SET PS-ERROR                                        14720099
001564                  DP020-NEXT-ACT-APPL-ERROR                       14730099
001565                  DP020-MSG-FATAL                                 14740099
001566                      TO TRUE                                     14750099
001567              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 14760099
001568              PERFORM 9000-CALL-CICS-ARCH-API                     14770099
001569                                                                  14780099
001570         WHEN SQLWARN0 NOT = SPACES                               14790099
001571         WHEN SQLCODE < +0                                        14800099
001572         WHEN SQLCODE > +0                                        14810099
001573              MOVE '4170-SELECT-XMT-LOC'                          14820099
001574                              TO DP013-PARAGRAPH                  14830099
001575              MOVE 'UNSUCCESSFUL SELECT ON XMT_LOC'               14840099
001576                              TO DP013-MESSAGE-TEXT (1)           14850099
001577              MOVE SQLCA      TO DP013-SQLCA                      14860099
001578              MOVE 'XMT_LOC ' TO DP013-DB2-TABLE-NAME (1)         14870099
001579              SET DP013-DB2-ABEND                                 14880099
001580                  DP013-XCTL-DISPLAY-RESTART                      14890099
001581                              TO TRUE                             14900099
001582              PERFORM DP013-0000-PROCESS-ABEND                    14910099
001583     END-EVALUATE.                                                14920099
001584                                                                  14930099
001585*----------------------------------------------------------------*14940099
001586*    OPEN BOL CURSOR.                                             14950099
001587*----------------------------------------------------------------*14960099
001588 4200-OPEN-BOL-CURSOR.                                            14970099
001589                                                                  14980099
001590     EXEC SQL                                                     14990099
001591          OPEN BOL-CSR                                            15000099
001592     END-EXEC                                                     15010099
001593                                                                  15020099
001594     EVALUATE TRUE                                                15030099
001595         WHEN SQLCODE = ZERO                                      15040099
001596                 CONTINUE                                         15050099
001597                                                                  15060099
001598         WHEN SQLCODE = -904                                      15070099
001599         WHEN SQLCODE = -911                                      15080099
001600         WHEN SQLCODE = -913                                      15090099
001601              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       15100099
001602              SET PS-ERROR                                        15110099
001603                  DP020-NEXT-ACT-APPL-ERROR                       15120099
001604                  DP020-MSG-FATAL                                 15130099
001605                      TO TRUE                                     15140099
001606              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 15150099
001607              PERFORM 9000-CALL-CICS-ARCH-API                     15160099
001608                                                                  15170099
001609         WHEN SQLWARN0 NOT = SPACES                               15180099
001610         WHEN SQLCODE < ZERO                                      15190099
001611         WHEN SQLCODE > ZERO                                      15200099
001612             MOVE '4200-OPEN-BOL-CURSOR'                          15210099
001613                               TO DP013-PARAGRAPH                 15220099
001614             MOVE 'OPEN BOL CURSOR - '                            15230099
001615                               TO DP013-MESSAGE-TEXT (1)          15240099
001616             MOVE SQLCA        TO DP013-SQLCA                     15250099
001617             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        15260099
001618             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)        15270099
001619             MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (3)        15280099
001620             SET DP013-DB2-ABEND                                  15290099
001621                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15300099
001622             PERFORM DP013-0000-PROCESS-ABEND                     15310099
001623     END-EVALUATE.                                                15320099
001624*----------------------------------------------------------------*15330099
001625*    OPEN EDI CURSOR.                                             15340099
001626*----------------------------------------------------------------*15350099
001627 4205-OPEN-EDI-CURSOR.                                            15360099
001628                                                                  15370099
001629     EXEC SQL                                                     15380099
001630          OPEN EDI-CSR                                            15390099
001631     END-EXEC                                                     15400099
001632                                                                  15410099
001633     EVALUATE TRUE                                                15420099
001634         WHEN SQLCODE = ZERO                                      15430099
001635                 CONTINUE                                         15440099
001636                                                                  15450099
001637         WHEN SQLCODE = -904                                      15460099
001638         WHEN SQLCODE = -911                                      15470099
001639         WHEN SQLCODE = -913                                      15480099
001640              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       15490099
001641              SET PS-ERROR                                        15500099
001642                  DP020-NEXT-ACT-APPL-ERROR                       15510099
001643                  DP020-MSG-FATAL                                 15520099
001644                      TO TRUE                                     15530099
001645              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 15540099
001646              PERFORM 9000-CALL-CICS-ARCH-API                     15550099
001647                                                                  15560099
001648         WHEN SQLWARN0 NOT = SPACES                               15570099
001649         WHEN SQLCODE < ZERO                                      15580099
001650         WHEN SQLCODE > ZERO                                      15590099
001651             MOVE '4205-OPEN-EDI-CURSOR'                          15600099
001652                               TO DP013-PARAGRAPH                 15610099
001653             MOVE 'OPEN EDI CURSOR - '                            15620099
001654                               TO DP013-MESSAGE-TEXT (1)          15630099
001655             MOVE SQLCA        TO DP013-SQLCA                     15640099
001656             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        15650099
001657             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)        15660099
001658             MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (3)        15670099
001659             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (4)        15680099
001660             MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (5)        15690099
001661             SET DP013-DB2-ABEND                                  15700099
001662                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15710099
001663             PERFORM DP013-0000-PROCESS-ABEND                     15720099
001664     END-EVALUATE.                                                15730099
001665*----------------------------------------------------------------*15740099
001666*    OPEN EDI2 CURSOR.                                            15750099
001667*----------------------------------------------------------------*15760099
001668 4206-OPEN-EDI2-CURSOR.                                           15770099
001669                                                                  15780099
001670     EXEC SQL                                                     15790099
001671          OPEN EDI-CSR2                                           15800099
001672     END-EXEC                                                     15810099
001673                                                                  15820099
001674     EVALUATE TRUE                                                15830099
001675         WHEN SQLCODE = ZERO                                      15840099
001676                 CONTINUE                                         15850099
001677                                                                  15860099
001678         WHEN SQLCODE = -904                                      15870099
001679         WHEN SQLCODE = -911                                      15880099
001680         WHEN SQLCODE = -913                                      15890099
001681              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       15900099
001682              SET PS-ERROR                                        15910099
001683                  DP020-NEXT-ACT-APPL-ERROR                       15920099
001684                  DP020-MSG-FATAL                                 15930099
001685                      TO TRUE                                     15940099
001686              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 15950099
001687              PERFORM 9000-CALL-CICS-ARCH-API                     15960099
001688                                                                  15970099
001689         WHEN SQLWARN0 NOT = SPACES                               15980099
001690         WHEN SQLCODE < ZERO                                      15990099
001691         WHEN SQLCODE > ZERO                                      16000099
001692             MOVE '4206-OPEN-EDI2-CURSOR'                         16010099
001693                               TO DP013-PARAGRAPH                 16020099
001694             MOVE 'OPEN EDI2 CURSOR - '                           16030099
001695                               TO DP013-MESSAGE-TEXT (1)          16040099
001696             MOVE SQLCA        TO DP013-SQLCA                     16050099
001697             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        16060099
001698             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)        16070099
001699             MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (3)        16080099
001700             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (4)        16090099
001701             MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (5)        16100099
001702             SET DP013-DB2-ABEND                                  16110099
001703                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16120099
001704             PERFORM DP013-0000-PROCESS-ABEND                     16130099
001705     END-EVALUATE.                                                16140099
001706                                                                  16150099
001707*----------------------------------------------------------------*16160099
001708*    THIS PARAGRAPH FETCHES ALL ROWS FROM THE BOL-CURSOR AND      16170099
001709*    WRITES THEM OUT TO THE SCREEN.                               16180099
001710*----------------------------------------------------------------*16190099
001711 4210-READ-ITEMS-FROM-DB.                                         16200099
001712                                                                  16210099
001713     PERFORM                                                      16220099
001714         VARYING PV-SAVE-IDX                                      16230099
001715         FROM 1 BY 1                                              16240099
001716         UNTIL ((PV-SAVE-IDX > PC-MAX-IDX)                        16250099
001717            OR (PV-SAVE-IDX > PV-READ-COUNTER))                   16260099
001718                                                                  16270099
001719        IF NOT PV-SAVE-BOL(PV-SAVE-IDX) = HIGH-VALUES             16280099
001720          MOVE PV-SAVE-BOL (PV-SAVE-IDX) TO DK-BOL-NBR            16290099
001721          MOVE PV-SAVE-VTYP (PV-SAVE-IDX) TO DK-VEH-TYP           16300099
001722                                                                  16310099
001723          MOVE PV-SAVE-TRIP (PV-SAVE-IDX) TO PV-TRIP-ID           16320099
001724          IF DK-VEH-TYP = 'VS' OR DK-VEH-TYP = 'AV'               16330099
001725            PERFORM 4206-OPEN-EDI2-CURSOR                         16340099
001726          ELSE                                                    16350099
001727            PERFORM 4205-OPEN-EDI-CURSOR                          16360099
001728          END-IF                                                  16370099
001729                                                                  16380099
001730          SET ASC-ITEMS-LEFT-ON-EDI TO TRUE                       16390099
001731          PERFORM 4320-PROCESS-EDI-CURSOR                         16400099
001732            VARYING PV-READ-COUNT                                 16410099
001733            FROM 1 BY 1                                           16420099
001734            UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                 16430099
001735            OR (ASC-NO-ITEMS-LEFT-ON-EDI))                        16440099
001736                                                                  16450099
001737             IF DK-VEH-TYP = 'VS' OR DK-VEH-TYP = 'AV'            16460099
001738               PERFORM 4311-CLOSE-EDI2-CURSOR                     16470099
001739             ELSE                                                 16480099
001740               PERFORM 4310-CLOSE-EDI-CURSOR                      16490099
001741             END-IF                                               16500099
001742          END-IF                                                  16510099
001743          END-PERFORM.                                            16520099
001744                                                                  16530099
001745     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16540099
001746         MOVE +1               TO ASC-BLK-SUB                     16550099
001747         PERFORM 5100-WRITE-TEMP-STORAGE                          16560099
001748         ADD +1                TO ASC-BLK-SUB                     16570099
001749         PERFORM 5100-WRITE-TEMP-STORAGE                          16580099
001750                                                                  16590099
001751         MOVE 1                TO ASC-BLK-SUB                     16600099
001752                                  PV-BLOCK-NUMBER                 16610099
001753         PERFORM 4410-READ-TEMP-STORAGE                           16620099
001754         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16630099
001755             MOVE 2            TO ASC-BLK-SUB                     16640099
001756                                  PV-BLOCK-NUMBER                 16650099
001757             PERFORM 4410-READ-TEMP-STORAGE                       16660099
001758         END-IF                                                   16670099
001759     END-IF.                                                      16680099
001760 EJECT                                                            16690099
001761                                                                  16700099
001762*----------------------------------------------------------------*16710099
001763*    THIS PARAGRAPH CREATES ONE BLANK LINE IN TEMP STORAGE FOR A  16720099
001764*    BREAK BETWEEN BILL OF LADING NUMBERS.                        16730099
001765*----------------------------------------------------------------*16740099
001766 4215-CREATE-ONE-BLANK-LINE.                                      16750099
001767                                                                  16760099
001768      ADD +1 TO PV-READ-COUNT.                                    16770099
001769      ADD +1 TO ASC-NUMBER-OF-ITEMS-READ.                         16780099
001770      MOVE ASC-NUMBER-OF-ITEMS-READ                               16790099
001771                            TO ASC-LIST-ITEM-NUMBER               16800099
001772                               (ASC-BLK-SUB ASC-ITEM-SUB).        16810099
001773      MOVE SPACES                                                 16820099
001774        TO ASC-BOL-NBR           (ASC-BLK-SUB ASC-ITEM-SUB)       16830099
001775           ASC-BOL-HDR           (ASC-BLK-SUB ASC-ITEM-SUB)       16840099
001776           ASC-VENDHD-QTY        (ASC-BLK-SUB ASC-ITEM-SUB)       16850099
001777           ASC-ETA-HDR           (ASC-BLK-SUB ASC-ITEM-SUB)       16860099
001778           ASC-VEHHDR-TYPE       (ASC-BLK-SUB ASC-ITEM-SUB)       16870099
001779           ASC-CARRIER-HDR       (ASC-BLK-SUB ASC-ITEM-SUB)       16880099
001780           ASC-CARRIER-NME       (ASC-BLK-SUB ASC-ITEM-SUB)       16890099
001781           ASC-TRAILER-NBR       (ASC-BLK-SUB ASC-ITEM-SUB)       16900099
001782           ASC-TRAILER-HDR       (ASC-BLK-SUB ASC-ITEM-SUB)       16910099
001783           ASC-VENDOR-UOM        (ASC-BLK-SUB ASC-ITEM-SUB)       16920099
001784           ASC-STATUS-CITY       (ASC-BLK-SUB ASC-ITEM-SUB)       16930099
001785           ASC-STATUS-STATE      (ASC-BLK-SUB ASC-ITEM-SUB)       16940099
001786           ASC-STATUS-HDR        (ASC-BLK-SUB ASC-ITEM-SUB)       16950099
001787           ASC-STATUS-DTE        (ASC-BLK-SUB ASC-ITEM-SUB)       16960099
001788           ASC-STATUS-TME        (ASC-BLK-SUB ASC-ITEM-SUB)       16970099
001789           ASC-STATUS-TME-ZNE    (ASC-BLK-SUB ASC-ITEM-SUB)       16980099
001790           ASC-STATUS-DESC       (ASC-BLK-SUB ASC-ITEM-SUB).      16990099
001791      MOVE DP015-BLUE                                             17000099
001792           TO ASC-STATUS-DESC-C (ASC-BLK-SUB ASC-ITEM-SUB).       17010099
001793      MOVE ZEROES TO ASC-VENDOR-QTY  (ASC-BLK-SUB ASC-ITEM-SUB).  17020099
001794                                                                  17030099
001795                                                                  17040099
001796     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        17050099
001797         ADD +1            TO ASC-ITEM-SUB                        17060099
001798     ELSE                                                         17070099
001799         ADD +1            TO ASC-BLK-SUB                         17080099
001800         MOVE +1           TO ASC-ITEM-SUB                        17090099
001801                                                                  17100099
001802         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 17110099
001803             MOVE +1       TO ASC-BLK-SUB                         17120099
001804             SET ASC-BLOCK-MODIFIED (1)                           17130099
001805                           TO TRUE                                17140099
001806             PERFORM 5100-WRITE-TEMP-STORAGE                      17150099
001807             MOVE ASC-BLOCK-ENTRIES                               17160099
001808                       (PC-MAX-BLOCKS-IN-ARRAY)                   17170099
001809                        TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)         17180099
001810             ADD +1        TO ASC-BLK-SUB                         17190099
001811             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           17200099
001812             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              17210099
001813                           TO TRUE                                17220099
001814         END-IF                                                   17230099
001815     END-IF.                                                      17240099
001816                                                                  17250099
001817*----------------------------------------------------------------*17260099
001818*    FETCH BOL CURSOR.                                            17270099
001819*----------------------------------------------------------------*17280099
001820 4220-FETCH-BOL-CURSOR.                                           17290099
001821                                                                  17300099
001822     EXEC SQL                                                     17310099
001823         FETCH BOL-CSR                                            17320099
001824          INTO :DK-BOL-NBR,                                       17330099
001825               :SHIPST-STATUS-DTE                                 17340099
001826              ,:SHIPST-SHIPT-ID                                   17350099
001827              ,:SHIPMT-TRIP-ID                                    17360099
001828              ,:SHIPMT-PRO-NBR                                    17370099
001829     END-EXEC.                                                    17380099
001830                                                                  17390099
001831     EVALUATE TRUE                                                17400099
001832         WHEN SQLCODE = ZERO                                      17410099
001833              MOVE SHIPST-STATUS-DTE      TO PV-STATUS-DTE        17420099
001834              MOVE SHIPST-SHIPT-ID        TO PV-SHIPT-ID2         17430099
001835              MOVE SHIPMT-TRIP-ID         TO PV-TRIP-ID           17440099
001836         WHEN SQLCODE = +100                                      17450099
001837              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 17460099
001838         WHEN SQLCODE = -904                                      17470099
001839         WHEN SQLCODE = -911                                      17480099
001840         WHEN SQLCODE = -913                                      17490099
001841              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       17500099
001842              SET PS-ERROR                                        17510099
001843                  DP020-NEXT-ACT-APPL-ERROR                       17520099
001844                  DP020-MSG-FATAL                                 17530099
001845                      TO TRUE                                     17540099
001846              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 17550099
001847              PERFORM 9000-CALL-CICS-ARCH-API                     17560099
001848                                                                  17570099
001849         WHEN SQLWARN0 NOT = SPACE                                17580099
001850         WHEN SQLCODE NOT = ZERO                                  17590099
001851              MOVE '4220-FETCH-BOL-CURSOR'                        17600099
001852                                   TO DP013-PARAGRAPH             17610099
001853              MOVE 'FETCH BOL CURSOR'                             17620099
001854                                   TO DP013-MESSAGE-TEXT (1)      17630099
001855              MOVE SQLCA           TO DP013-SQLCA                 17640099
001856              SET DP013-DB2-ABEND                                 17650099
001857                                   TO TRUE                        17660099
001858              PERFORM DP013-0000-PROCESS-ABEND                    17670099
001859     END-EVALUATE.                                                17680099
001860                                                                  17690099
001861*----------------------------------------------------------------*17700099
001862*    FETCH EDI CURSOR.                                            17710099
001863*----------------------------------------------------------------*17720099
001864 4225-FETCH-EDI-CURSOR.                                           17730099
001865                                                                  17740099
001866     EXEC SQL                                                     17750099
001867         FETCH EDI-CSR                                            17760099
001868          INTO :SHIPMT-SHIPT-ID,                                  17770099
001869               :SHIPMT-EXPTED-PKG-QTY,                            17780099
001870               :SHIPMT-CARR-CART-CT,                              17790099
001871               :SHIPMT-PKG-TYP-CDE,                               17800099
001872               :SHIPMT-VEH-NBR,                                   17810099
001873               :ENTNME-ENT-NAME-DESC,                             17820099
001874               :SHIPST-CITY-NAME,                                 17830099
001875               :SHIPST-STATE-CDE,                                 17840099
001876               :SHIPST-STATUS-DTE,                                17850099
001877               :SHIPST-STATUS-TME,                                17860099
001878               :SHIPST-TIME-ZONE-CDE,                             17870099
001879               :SHIPST-SHIPT-STATUS-CDE,                          17880099
001880               :SHIPST-CARR-STATUS-CDE,                           17890099
001881               :PV-EXPTED-CART-CNT,                               17900099
001882               :PV-ACTL-CART-CNT                                  17910099
001883     END-EXEC.                                                    17920099
001884                                                                  17930099
001885     EVALUATE TRUE                                                17940099
001886         WHEN SQLCODE = +100                                      17950099
001887              SET ASC-NO-ITEMS-LEFT-ON-EDI TO TRUE                17960099
001888         WHEN SQLCODE = ZERO                                      17970099
001889              CONTINUE                                            17980099
001890         WHEN SQLCODE = -904                                      17990099
001891         WHEN SQLCODE = -911                                      18000099
001892         WHEN SQLCODE = -913                                      18010099
001893              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       18020099
001894              SET PS-ERROR                                        18030099
001895                  DP020-NEXT-ACT-APPL-ERROR                       18040099
001896                  DP020-MSG-FATAL                                 18050099
001897                      TO TRUE                                     18060099
001898              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 18070099
001899              PERFORM 9000-CALL-CICS-ARCH-API                     18080099
001900                                                                  18090099
001901         WHEN SQLWARN0 NOT = SPACE                                18100099
001902         WHEN SQLCODE NOT = ZERO                                  18110099
001903              MOVE '4225-FETCH-EDI-CURSOR'                        18120099
001904                                   TO DP013-PARAGRAPH             18130099
001905              MOVE 'FETCH EDI CURSOR'                             18140099
001906                                   TO DP013-MESSAGE-TEXT (1)      18150099
001907              MOVE SQLCA           TO DP013-SQLCA                 18160099
001908              SET DP013-DB2-ABEND                                 18170099
001909                                   TO TRUE                        18180099
001910              PERFORM DP013-0000-PROCESS-ABEND                    18190099
001911     END-EVALUATE.                                                18200099
001912                                                                  18210099
001913*----------------------------------------------------------------*18220099
001914*    FETCH EDI2 CURSOR.                                           18230099
001915*----------------------------------------------------------------*18240099
001916 4226-FETCH-EDI2-CURSOR.                                          18250099
001917                                                                  18260099
001918     EXEC SQL                                                     18270099
001919         FETCH EDI-CSR2                                           18280099
001920          INTO :SHIPMT-SHIPT-ID,                                  18290099
001921               :SHIPMT-PKG-TYP-CDE,                               18300099
001922               :SHIPMT-VEH-NBR,                                   18310099
001923               :ENTNME-ENT-NAME-DESC,                             18320099
001924               :SHIPST-CITY-NAME,                                 18330099
001925               :SHIPST-STATE-CDE,                                 18340099
001926               :SHIPST-STATUS-DTE,                                18350099
001927               :SHIPST-STATUS-TME,                                18360099
001928               :SHIPST-TIME-ZONE-CDE,                             18370099
001929               :SHIPST-SHIPT-STATUS-CDE,                          18380099
001930               :SHIPST-CARR-STATUS-CDE,                           18390099
001931               :PV-EXPTED-CART-CNT,                               18400099
001932               :PV-ACTL-CART-CNT                                  18410099
001933     END-EXEC.                                                    18420099
001934                                                                  18430099
001935     EVALUATE TRUE                                                18440099
001936         WHEN SQLCODE = +100                                      18450099
001937              SET ASC-NO-ITEMS-LEFT-ON-EDI TO TRUE                18460099
001938         WHEN SQLCODE = ZERO                                      18470099
001939              CONTINUE                                            18480099
001940         WHEN SQLCODE = -904                                      18490099
001941         WHEN SQLCODE = -911                                      18500099
001942         WHEN SQLCODE = -913                                      18510099
001943              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       18520099
001944              SET PS-ERROR                                        18530099
001945                  DP020-NEXT-ACT-APPL-ERROR                       18540099
001946                  DP020-MSG-FATAL                                 18550099
001947                      TO TRUE                                     18560099
001948              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 18570099
001949              PERFORM 9000-CALL-CICS-ARCH-API                     18580099
001950                                                                  18590099
001951         WHEN SQLWARN0 NOT = SPACE                                18600099
001952         WHEN SQLCODE NOT = ZERO                                  18610099
001953              MOVE '4226-FETCH-EDI2-CURSOR'                       18620099
001954                                   TO DP013-PARAGRAPH             18630099
001955              MOVE 'FETCH EDI2 CURSOR'                            18640099
001956                                   TO DP013-MESSAGE-TEXT (1)      18650099
001957              MOVE SQLCA           TO DP013-SQLCA                 18660099
001958              SET DP013-DB2-ABEND                                 18670099
001959                                   TO TRUE                        18680099
001960              PERFORM DP013-0000-PROCESS-ABEND                    18690099
001961     END-EVALUATE.                                                18700099
001962                                                                  18710099
001963*----------------------------------------------------------------*18720099
001964*    THIS PARAGRAPH CONVERTS DB2 TIME AND DATES INTO NEEDED       18730099
001965*    FORMATS.                                                     18740099
001966*----------------------------------------------------------------*18750099
001967 4230-OUTPUT-DATE-TIME.                                           18760099
001968     PERFORM 4244-GET-ETA-SHIPST.                                 18770099
001969*    PERFORM 4245-GET-ETA-DATE-AND-TIME.                          18780099
001970     PERFORM 4247-GET-VEHICLE-DATA.                               18790099
001971     MOVE SHIPST-STATUS-TME      TO PV-TIME-8.                    18800099
001972     MOVE ':'                    TO PV-COLON.                     18810099
001973     MOVE PV-HOUR-8   TO PV-HOUR-5.                               18820099
001974     MOVE PV-MINUTE-8 TO PV-MINUTE-5.                             18830099
001975     MOVE PV-TIME-5                                               18840099
001976       TO ASC-STATUS-TME  (ASC-BLK-SUB ASC-ITEM-SUB).             18850099
001977                                                                  18860099
001978     MOVE SHIPST-STATUS-DTE      TO PV-DATE-10.                   18870099
001979     MOVE PV-YEAR-10  TO PV-YEAR-8.                               18880099
001980     MOVE PV-MONTH-10 TO PV-MONTH-8.                              18890099
001981     MOVE PV-DAY-10   TO PV-DAY-8.                                18900099
001982     MOVE PV-DATE-8                                               18910099
001983       TO ASC-STATUS-DTE  (ASC-BLK-SUB ASC-ITEM-SUB).             18920099
001984                                                                  18930099
001985     IF PURCHS-PO-TYP-CDE NOT = ('IM' AND 'IE' AND 'IF')          18940099
001986         IF VEHICL-VEH-TYP-CDE = 'VS' OR                          18950099
001987            VEHICL-VEH-TYP-CDE = 'AV'                             18960099
001988             MOVE SPACES TO ASC-STATUS-TME-ZNE (ASC-BLK-SUB       18970099
001989                                                ASC-ITEM-SUB)     18980099
001990         ELSE                                                     18990099
001991             MOVE SHIPST-TIME-ZONE-CDE                            19000099
001992               TO ASC-STATUS-TME-ZNE (ASC-BLK-SUB ASC-ITEM-SUB)   19010099
001993         END-IF                                                   19020099
001994     END-IF.                                                      19030099
001995                                                                  19040099
001996*-----------------------------------------------------------      19050099
001997* GET VEH_TYPE_CDE FROM TVEHICL                                   19060099
001998*-----------------------------------------------------------      19070099
001999 4235-GET-BOL-VEH-TYP-CDE.                                        19080099
002000                                                                  19090099
002001           MOVE PV-SAVE-BOL (PV-SAVE-IDX) TO DK-BOL-NBR.          19100099
002002           MOVE PV-SAVE-TRIP(PV-SAVE-IDX) TO PV-TRIP-ID.          19110099
002003           PERFORM                                                19120099
002004               WITH TEST AFTER                                    19130099
002005               VARYING PV-RETRY-COUNTER                           19140099
002006               FROM 1 BY 1                                        19150099
002007               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)         19160099
002008                   OR (SQLCODE = ZERO) OR (SQLCODE = +100))       19170099
002009                   EXEC SQL                                       19180099
002010                SELECT DISTINCT  E.VEH_TYP_CDE, D.VEH_NBR         19190099
002011                INTO :VEHICL-VEH-TYP-CDE, :VHTRIP-VEH-NBR         19200099
002012*               FROM TSHIPMT A, TSHPTPO B, TSHIPST C,             19210099
002013               FROM  TVHTRIP D, TVEHICL E                         19220099
002014*               WHERE  B.PO_NBR     =:ASC-KEY-PO-NUMBER           19230099
002015                WHERE D.TRIP_ID     =:PV-TRIP-ID                  19240099
002016*                 AND A.SHIPT_ID    = B.SHIPT_ID                  19250099
002017*                 AND A.SHIPT_ID    = C.SHIPT_ID                  19260099
002018*                 AND A.COMPLETE_BOL_NBR     =:DK-BOL-NBR         19270099
002019*                 AND A.TRIP_ID     = D.TRIP_ID                   19280099
002020                  AND D.OWNER_SCAC_ID = E.OWNER_SCAC_ID           19290099
002021                  AND D.VEH_NBR = E.VEH_NBR                       19300099
002022                END-EXEC                                          19310099
002023               EVALUATE TRUE                                      19320099
002024                   WHEN SQLCODE = +100                            19330099
002025                     MOVE SPACES TO PV-SAVE-VTYP (PV-SAVE-IDX)    19340099
002026                   WHEN SQLCODE = ZERO                            19350099
002027                     MOVE VEHICL-VEH-TYP-CDE TO                   19360099
002028                             PV-SAVE-VTYP (PV-SAVE-IDX)           19370099
002029                     MOVE VHTRIP-VEH-NBR TO                       19380099
002030                             PV-SAVE-VNBR (PV-SAVE-IDX)           19390099
002031                   WHEN SQLCODE = -904                            19400099
002032                   WHEN SQLCODE = -913                            19410099
002033                       CONTINUE                                   19420099
002034                   WHEN SQLWARN0 NOT = SPACES                     19430099
002035                   WHEN SQLCODE < ZERO                            19440099
002036                   WHEN SQLCODE > ZERO                            19450099
002037                       MOVE '4235-GET-BOL-VEH-TYP-CDE'            19460099
002038                                         TO DP013-PARAGRAPH       19470099
002039                       MOVE 'SQL ERROR SELECTING VEH-TYP'         19480099
002040                                         TO DP013-MESSAGE-TEXT (1)19490099
002041                       MOVE SQLCA        TO DP013-SQLCA           19500099
002042                     MOVE 'TVEHICL '   TO DP013-DB2-TABLE-NAME (1)19510099
002043                       SET DP013-DB2-ABEND                        19520099
002044                           DP013-XCTL-DISPLAY-RESTART TO TRUE     19530099
002045                       PERFORM DP013-0000-PROCESS-ABEND           19540099
002046               END-EVALUATE                                       19550099
002047           END-PERFORM.                                           19560099
002048*                                                                 19570099
002049       IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                      19580099
002050         MOVE '4235-GET-BOL-VEH-TYP-CDE'                          19590099
002051                                    TO DP013-PARAGRAPH            19600099
002052         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VTYP'19610099
002053                                    TO DP013-MESSAGE-TEXT (1)     19620099
002054         MOVE SQLCA                TO DP013-SQLCA                 19630099
002055         MOVE 'TVEHICL '           TO DP013-DB2-TABLE-NAME (1)    19640099
002056         SET DP013-DB2-ABEND                                      19650099
002057             DP013-XCTL-DISPLAY-RESTART                           19660099
002058                                      TO TRUE                     19670099
002059         PERFORM DP013-0000-PROCESS-ABEND                         19680099
002060       END-IF.                                                    19690099
002061*-----------------------------------------------------------      19700099
002062* GET PO_TYPE_CDE FROM TPURCHS                                    19710099
002063*-----------------------------------------------------------      19720099
002064 4240-GET-PURCHS-FIELDS.                                          19730099
002065                                                                  19740099
002066           PERFORM                                                19750099
002067               WITH TEST AFTER                                    19760099
002068               VARYING PV-RETRY-COUNTER                           19770099
002069               FROM 1 BY 1                                        19780099
002070               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)         19790099
002071                   OR (SQLCODE = ZERO))                           19800099
002072                   EXEC SQL                                       19810099
002073                      SELECT  PO_TYP_CDE                          19820099
002074                       INTO :PURCHS-PO-TYP-CDE                    19830099
002075                       FROM TPURCHS                               19840099
002076                       WHERE PO_NBR = :ASC-KEY-PO-NUMBER          19850099
002077                       AND   VER_STATUS_CDE = 'A'                 19860099
002078                   END-EXEC                                       19870099
002079               EVALUATE TRUE                                      19880099
002080                   WHEN SQLCODE = ZERO                            19890099
002081                   WHEN SQLCODE = -904                            19900099
002082                   WHEN SQLCODE = -913                            19910099
002083                       CONTINUE                                   19920099
002084                   WHEN SQLWARN0 NOT = SPACES                     19930099
002085                   WHEN SQLCODE < ZERO                            19940099
002086                   WHEN SQLCODE > ZERO                            19950099
002087                       MOVE '4240-GET-PURCHS-FIELDS'              19960099
002088                                         TO DP013-PARAGRAPH       19970099
002089                       MOVE 'SQL ERROR SELECTING PO'              19980099
002090                                         TO DP013-MESSAGE-TEXT (1)19990099
002091                       MOVE SQLCA        TO DP013-SQLCA           20000099
002092                     MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)20010099
002093                       SET DP013-DB2-ABEND                        20020099
002094                           DP013-XCTL-DISPLAY-RESTART TO TRUE     20030099
002095                       PERFORM DP013-0000-PROCESS-ABEND           20040099
002096               END-EVALUATE                                       20050099
002097           END-PERFORM.                                           20060099
002098*                                                                 20070099
002099       IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                      20080099
002100         MOVE '4240-GET-PURCHS-FIELDS'                            20090099
002101                                    TO DP013-PARAGRAPH            20100099
002102         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  20110099
002103                                    TO DP013-MESSAGE-TEXT (1)     20120099
002104         MOVE SQLCA                TO DP013-SQLCA                 20130099
002105         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    20140099
002106         SET DP013-DB2-ABEND                                      20150099
002107             DP013-XCTL-DISPLAY-RESTART                           20160099
002108                                      TO TRUE                     20170099
002109         PERFORM DP013-0000-PROCESS-ABEND                         20180099
002110       END-IF.                                                    20190099
002111*-----------------------------------------------------------      20200099
002112* GET ETA DATE AND TIME FROM TSHIPST                              20210099
002113*-----------------------------------------------------------      20220099
002114 4244-GET-ETA-SHIPST.                                             20230099
002115      MOVE PV-SAVE-SHIP(PV-SAVE-IDX) TO SHIPST-SHIPT-ID.          20240099
002116       PERFORM                                                    20250099
002117         WITH TEST AFTER                                          20260099
002118         VARYING PV-RETRY-COUNTER                                 20270099
002119          FROM 1 BY 1                                             20280099
002120            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            20290099
002121                OR (SQLCODE = ZERO) OR (SQLCODE = +100))          20300099
002122         EXEC SQL                                                 20310099
002123           SELECT STATUS_DTE                                      20320099
002124           INTO   :PV-SHIPST-ETA-DATE:PV-TMST-NULL                20330099
002127           FROM   TSHIPST                                         20340099
002128           WHERE  SHIPT_ID =:SHIPST-SHIPT-ID                      20350099
002129             AND  SHIPT_STATUS_CDE = 'AG'                         20360099
002131         END-EXEC                                                 20370099
002132       EVALUATE TRUE                                              20380099
002133           WHEN SQLCODE = +100                                    20390099
002136             PERFORM 4245-GET-ETA-DATE-AND-TIME                   20400099
002137           WHEN SQLCODE = ZERO                                    20410099
002138             MOVE PV-SHIPST-ETA-DATE TO PV-DATE-10                20420099
002141             MOVE PV-YEAR-10  TO PV-YEAR-8                        20430099
002142             MOVE PV-MONTH-10 TO PV-MONTH-8                       20440099
002143             MOVE PV-DAY-10   TO PV-DAY-8                         20450099
002144             MOVE PV-DATE-8                                       20460099
002145               TO ASC-ETA  (ASC-BLK-SUB ASC-ITEM-SUB)             20470099
002146           WHEN SQLWARN0 NOT = SPACES                             20480099
002147           WHEN SQLCODE < ZERO                                    20490099
002148           WHEN SQLCODE > ZERO                                    20500099
002149             MOVE '4244-GET-ETA-SHIPST'                           20510099
002150                        TO DP013-PARAGRAPH                        20520099
002151             MOVE 'SQL ERROR SELECTING ETA'                       20530099
002152                        TO DP013-MESSAGE-TEXT (1)                 20540099
002153             MOVE SQLCA        TO DP013-SQLCA                     20550099
002154             MOVE 'SHIPST '    TO DP013-DB2-TABLE-NAME (1)        20560099
002156             SET DP013-DB2-ABEND                                  20570099
002157                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20580099
002158             PERFORM DP013-0000-PROCESS-ABEND                     20590099
002159           END-EVALUATE                                           20600099
002160          END-PERFORM.                                            20610099
002161*                                                                 20620099
002162        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     20630099
002163          MOVE '4244-GET-ETA-SHIPST'                              20640099
002164                                    TO DP013-PARAGRAPH            20650099
002165          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT ETA'20660099
002166                                    TO DP013-MESSAGE-TEXT (1)     20670099
002167          MOVE SQLCA                TO DP013-SQLCA                20680099
002168          MOVE 'TSHIPST '           TO DP013-DB2-TABLE-NAME (1)   20690099
002170          SET DP013-DB2-ABEND                                     20700099
002171               DP013-XCTL-DISPLAY-RESTART TO TRUE                 20710099
002172          PERFORM DP013-0000-PROCESS-ABEND                        20720099
002173        END-IF.                                                   20730099
002174        EJECT                                                     20740099
002175                                                                  20750099
002176*-----------------------------------------------------------      20760099
002177* GET ETA DATE AND TIME FROM TVHTRIP AND TVEHICL                  20770099
002178*-----------------------------------------------------------      20780099
002179 4245-GET-ETA-DATE-AND-TIME.                                      20790099
002180      MOVE PV-SAVE-TRIP(PV-SAVE-IDX) TO SHIPMT-TRIP-ID.           20800099
002181       PERFORM                                                    20810099
002182         WITH TEST AFTER                                          20820099
002183         VARYING PV-RETRY-COUNTER                                 20830099
002184          FROM 1 BY 1                                             20840099
002185            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            20850099
002186                OR (SQLCODE = ZERO) OR (SQLCODE = +100))          20860099
002187         EXEC SQL                                                 20870099
002188           SELECT  A.EST_AR_TMST                                  20880099
002190           INTO   :VHTRIP-EST-AR-TMST:PV-TMST-NULL                20890099
002192           FROM   TVHTRIP A, TVEHICL B                            20900099
002193           WHERE  A.TRIP_ID =:SHIPMT-TRIP-ID                      20910099
002194           AND    A.OWNER_SCAC_ID = B.OWNER_SCAC_ID               20920099
002195           AND    A.VEH_NBR = B.VEH_NBR                           20930099
002196         END-EXEC                                                 20940099
002197       EVALUATE TRUE                                              20950099
002198           WHEN SQLCODE = +100                                    20960099
002201             PERFORM 4246-GET-SHIPMT-ETA-DATE                     20970099
002202           WHEN SQLCODE = ZERO                                    20980099
002203             STRING VHTRIP-EST-AR-TMST (1:10)                     20990099
002204             DELIMITED BY SIZE INTO PV-DATE-10                    21000099
002205             MOVE PV-YEAR-10  TO PV-YEAR-8                        21010099
002206             MOVE PV-MONTH-10 TO PV-MONTH-8                       21020099
002207             MOVE PV-DAY-10   TO PV-DAY-8                         21030099
002208             MOVE PV-DATE-8                                       21040099
002209               TO ASC-ETA  (ASC-BLK-SUB ASC-ITEM-SUB)             21050099
002210           WHEN SQLWARN0 NOT = SPACES                             21060099
002211           WHEN SQLCODE < ZERO                                    21070099
002212           WHEN SQLCODE > ZERO                                    21080099
002213             MOVE '4245-GET-ETA-DATE-AND-TIME'                    21090099
002214                        TO DP013-PARAGRAPH                        21100099
002215             MOVE 'SQL ERROR SELECTING PO'                        21110099
002216                        TO DP013-MESSAGE-TEXT (1)                 21120099
002217             MOVE SQLCA        TO DP013-SQLCA                     21130099
002218             MOVE 'TVHTRIP '   TO DP013-DB2-TABLE-NAME (1)        21140099
002219             MOVE 'TVEHICL '   TO DP013-DB2-TABLE-NAME (2)        21150099
002220             SET DP013-DB2-ABEND                                  21160099
002221                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21170099
002222             PERFORM DP013-0000-PROCESS-ABEND                     21180099
002223           END-EVALUATE                                           21190099
002224          END-PERFORM.                                            21200099
002225*                                                                 21210099
002226        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     21220099
002227          MOVE '4245-GET-ETA-DATE-AND-TIME'                       21230099
002228                                    TO DP013-PARAGRAPH            21240099
002229          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT ETA'21250099
002230                                    TO DP013-MESSAGE-TEXT (1)     21260099
002231          MOVE SQLCA                TO DP013-SQLCA                21270099
002232          MOVE 'TVHTRIP '           TO DP013-DB2-TABLE-NAME (1)   21280099
002233          MOVE 'TVEHICL '           TO DP013-DB2-TABLE-NAME (2)   21290099
002234          SET DP013-DB2-ABEND                                     21300099
002235               DP013-XCTL-DISPLAY-RESTART TO TRUE                 21310099
002236          PERFORM DP013-0000-PROCESS-ABEND                        21320099
002237        END-IF.                                                   21330099
002238        EJECT                                                     21340099
002239                                                                  21350099
002240*-----------------------------------------------------------      21360099
002241* GET ETA DATE AND TIME FROM TSHIPMT                              21370099
002242*-----------------------------------------------------------      21380099
002243 4246-GET-SHIPMT-ETA-DATE.                                        21390099
002244                                                                  21400099
002245       PERFORM                                                    21410099
002246         WITH TEST AFTER                                          21420099
002247         VARYING PV-RETRY-COUNTER                                 21430099
002248          FROM 1 BY 1                                             21440099
002249            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            21450099
002250                OR (SQLCODE = ZERO) OR (SQLCODE = +100))          21460099
002251         EXEC SQL                                                 21470099
002252           SELECT EST_AR_TMST                                     21480099
002253           INTO   :SHIPMT-EST-AR-TMST:PV-TMST-NULL                21490099
002254           FROM   TSHIPMT A                                       21500099
002255           WHERE  A.SHIPT_ID =:SHIPMT-SHIPT-ID                    21510099
002256         END-EXEC                                                 21520099
002257       EVALUATE TRUE                                              21530099
002258           WHEN SQLCODE = +100                                    21540099
002259             MOVE SPACES TO ASC-ETA (ASC-BLK-SUB ASC-ITEM-SUB)    21550099
002260           WHEN SQLCODE = ZERO                                    21560099
002261             STRING SHIPMT-EST-AR-TMST (1:10)                     21570099
002262             DELIMITED BY SIZE INTO PV-DATE-10                    21580099
002263             MOVE PV-YEAR-10  TO PV-YEAR-8                        21590099
002264             MOVE PV-MONTH-10 TO PV-MONTH-8                       21600099
002265             MOVE PV-DAY-10   TO PV-DAY-8                         21610099
002266             MOVE PV-DATE-8                                       21620099
002267               TO ASC-ETA  (ASC-BLK-SUB ASC-ITEM-SUB)             21630099
002268                                                                  21640099
002269           WHEN SQLWARN0 NOT = SPACES                             21650099
002270           WHEN SQLCODE < ZERO                                    21660099
002271           WHEN SQLCODE > ZERO                                    21670099
002272             MOVE '4246-GET-SHIPMT-ETA-DATE'                      21680099
002273                        TO DP013-PARAGRAPH                        21690099
002274             MOVE 'SQL ERROR SELECTING PO'                        21700099
002275                        TO DP013-MESSAGE-TEXT (1)                 21710099
002276             MOVE SQLCA        TO DP013-SQLCA                     21720099
002277             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        21730099
002278             MOVE 'TVEHICL '   TO DP013-DB2-TABLE-NAME (2)        21740099
002279             SET DP013-DB2-ABEND                                  21750099
002280                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21760099
002281             PERFORM DP013-0000-PROCESS-ABEND                     21770099
002282           END-EVALUATE                                           21780099
002283          END-PERFORM.                                            21790099
002284*                                                                 21800099
002285        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     21810099
002286          MOVE '4246-GET-SHIPMT-ETA-DATE'                         21820099
002287                                    TO DP013-PARAGRAPH            21830099
002288          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT ETA'21840099
002289                                    TO DP013-MESSAGE-TEXT (1)     21850099
002290          MOVE SQLCA                TO DP013-SQLCA                21860099
002291          MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)   21870099
002292          MOVE 'TVEHICL '           TO DP013-DB2-TABLE-NAME (2)   21880099
002293          SET DP013-DB2-ABEND                                     21890099
002294               DP013-XCTL-DISPLAY-RESTART TO TRUE                 21900099
002295          PERFORM DP013-0000-PROCESS-ABEND                        21910099
002296        END-IF.                                                   21920099
002297        EJECT                                                     21930099
002298                                                                  21940099
002299*-----------------------------------------------------------      21950099
002300* GET VEHICLE NBR AND TYPE FROM TVHTRIP AND TVEHICL               21960099
002301*-----------------------------------------------------------      21970099
002302 4247-GET-VEHICLE-DATA.                                           21980099
002303      MOVE PV-SAVE-TRIP(PV-SAVE-IDX) TO SHIPMT-TRIP-ID.           21990099
002304       PERFORM                                                    22000099
002305         WITH TEST AFTER                                          22010099
002306         VARYING PV-RETRY-COUNTER                                 22020099
002307          FROM 1 BY 1                                             22030099
002308            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            22040099
002309                OR (SQLCODE = ZERO) OR (SQLCODE = +100))          22050099
002310         EXEC SQL                                                 22060099
002311           SELECT A.VEH_NBR, B.VEH_TYP_CDE                        22070099
002312           INTO   :VHTRIP-VEH-NBR,                                22080099
002314                  :VEHICL-VEH-TYP-CDE                             22090099
002315           FROM   TVHTRIP A, TVEHICL B                            22100099
002316           WHERE  A.TRIP_ID =:SHIPMT-TRIP-ID                      22110099
002317           AND    A.OWNER_SCAC_ID = B.OWNER_SCAC_ID               22120099
002318           AND    A.VEH_NBR = B.VEH_NBR                           22130099
002319         END-EXEC                                                 22140099
002320       EVALUATE TRUE                                              22150099
002321           WHEN SQLCODE = +100                                    22160099
002322             MOVE SPACES TO VHTRIP-VEH-NBR                        22170099
002323                            VEHICL-VEH-TYP-CDE                    22180099
002325           WHEN SQLCODE = ZERO                                    22190099
002326               CONTINUE                                           22200099
002333           WHEN SQLWARN0 NOT = SPACES                             22210099
002334           WHEN SQLCODE < ZERO                                    22220099
002335           WHEN SQLCODE > ZERO                                    22230099
002336             MOVE '4247-GET-VEHICLE-DATA'                         22240099
002337                        TO DP013-PARAGRAPH                        22250099
002338             MOVE 'SQL ERROR SELECTING VH'                        22260099
002339                        TO DP013-MESSAGE-TEXT (1)                 22270099
002340             MOVE SQLCA        TO DP013-SQLCA                     22280099
002341             MOVE 'TVHTRIP '   TO DP013-DB2-TABLE-NAME (1)        22290099
002342             MOVE 'TVEHICL '   TO DP013-DB2-TABLE-NAME (2)        22300099
002343             SET DP013-DB2-ABEND                                  22310099
002344                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22320099
002345             PERFORM DP013-0000-PROCESS-ABEND                     22330099
002346           END-EVALUATE                                           22340099
002347          END-PERFORM.                                            22350099
002348*                                                                 22360099
002349        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     22370099
002350          MOVE '4247-GET-VEHICLE-DATA'                            22380099
002351                                    TO DP013-PARAGRAPH            22390099
002352          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT VEH'22400099
002353                                    TO DP013-MESSAGE-TEXT (1)     22410099
002354          MOVE SQLCA                TO DP013-SQLCA                22420099
002355          MOVE 'TVHTRIP '           TO DP013-DB2-TABLE-NAME (1)   22430099
002356          MOVE 'TVEHICL '           TO DP013-DB2-TABLE-NAME (2)   22440099
002357          SET DP013-DB2-ABEND                                     22450099
002358               DP013-XCTL-DISPLAY-RESTART TO TRUE                 22460099
002359          PERFORM DP013-0000-PROCESS-ABEND                        22470099
002360        END-IF.                                                   22480099
002361        EJECT                                                     22490099
002362                                                                  22500099
002363*----------------------------------------------------------------*22510099
002364*    THIS PARAGRAPH GETS THE CORRECT STATUS DESC DEPENDING ON WHAT22520099
002365*    IS AVAILABLE IN THE TSHIPST TABLE.                           22530099
002366*----------------------------------------------------------------*22540099
002367 4250-OUTPUT-STATUS-DESC.                                         22550099
002368                                                                  22560099
002369     MOVE SPACES TO PV-DB2-STATUS-CDE.                            22570099
002370                                                                  22580099
002371     IF ((SHIPST-SHIPT-STATUS-CDE NOT = 'EN') OR                  22590099
002372         ((SHIPST-SHIPT-STATUS-CDE = 'EN') AND                    22600099
002373          (SHIPST-CARR-STATUS-CDE <= SPACES)))                    22610099
002374        MOVE SHIPST-SHIPT-STATUS-CDE TO PV-DB2-STATUS-CDE         22620099
002375     ELSE                                                         22630099
002376        MOVE SHIPST-CARR-STATUS-CDE TO PV-DB2-STATUS-CDE.         22640099
002377                                                                  22650099
002378     PERFORM 4100-SELECT-TSHSTYP.                                 22660099
002379     MOVE SHSTYP-DESC                                             22670099
002380               TO ASC-STATUS-DESC  (ASC-BLK-SUB ASC-ITEM-SUB).    22680099
002437*----------------------------------------------------------------*22690099
002438*   OPEN THE POE CODE CURSOR                                     *22700099
002439*----------------------------------------------------------------*22710099
002440 4260-OPEN-POE-CURSOR.                                            22720099
002441                                                                  22730099
002442     PERFORM                                                      22740099
002443         WITH TEST AFTER                                          22750099
002444         VARYING PV-RETRY-COUNTER                                 22760099
002445         FROM 1 BY 1                                              22770099
002446         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22780099
002447                   OR (SQLCODE = ZERO))                           22790099
002448                                                                  22800099
002449         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)    22810099
002450                                                                  22820099
002451         EXEC SQL                                                 22830099
002452              OPEN POE-CSR                                        22840099
002453         END-EXEC                                                 22850099
002454                                                                  22860099
002455         EVALUATE TRUE                                            22870099
002456             WHEN SQLCODE = ZERO                                  22880099
002457             WHEN SQLCODE = -904                                  22890099
002458             WHEN SQLCODE = -913                                  22900099
002459                 CONTINUE                                         22910099
002460             WHEN SQLWARN0 NOT = SPACES                           22920099
002461             WHEN SQLCODE < ZERO                                  22930099
002462             WHEN SQLCODE > ZERO                                  22940099
002463                 MOVE '4260-OPEN-POE-CURSOR'                      22950099
002464                                   TO DP013-PARAGRAPH             22960099
002465                 MOVE 'OPEN POE CURSOR - '                        22970099
002466                                   TO DP013-MESSAGE-TEXT (1)      22980099
002467                 MOVE SQLCA        TO DP013-SQLCA                 22990099
002468                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)    23000099
002469                 SET DP013-DB2-ABEND                              23010099
002470                     DP013-XCTL-DISPLAY-RESTART TO TRUE           23020099
002471                 PERFORM DP013-0000-PROCESS-ABEND                 23030099
002472         END-EVALUATE                                             23040099
002473     END-PERFORM.                                                 23050099
002474*                                                                 23060099
002475     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23070099
002476         MOVE '4260-OPEN-POE-CURSOR' TO DP013-PARAGRAPH           23080099
002477         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   23090099
002478                                   TO DP013-MESSAGE-TEXT (1)      23100099
002479         MOVE SQLCA                TO DP013-SQLCA                 23110099
002480         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)    23120099
002481         SET DP013-DB2-ABEND                                      23130099
002482             DP013-XCTL-DISPLAY-RESTART                           23140099
002483                                   TO TRUE                        23150099
002484         PERFORM DP013-0000-PROCESS-ABEND                         23160099
002485     END-IF.                                                      23170099
002486                                                                  23180099
002487 EJECT                                                            23190099
002488*----------------------------------------------------------------*23200099
002489*   CLOSE THE POE CODE CURSOR                                    *23210099
002490*----------------------------------------------------------------*23220099
002491 4270-CLOSE-POE-CURSOR.                                           23230099
002492                                                                  23240099
002493     EXEC SQL                                                     23250099
002494          CLOSE POE-CSR                                           23260099
002495     END-EXEC.                                                    23270099
002496                                                                  23280099
002497     EVALUATE TRUE                                                23290099
002498         WHEN SQLCODE = ZERO                                      23300099
002499             CONTINUE                                             23310099
002500         WHEN SQLWARN0 NOT = SPACES                               23320099
002501         WHEN SQLCODE < ZERO                                      23330099
002502         WHEN SQLCODE > ZERO                                      23340099
002503             MOVE '4270-CLOSE-POE-CURSOR'                         23350099
002504                               TO DP013-PARAGRAPH                 23360099
002505             MOVE 'CLOSE POE CURSOR '                             23370099
002506                               TO DP013-MESSAGE-TEXT (1)          23380099
002507             MOVE SQLCA        TO DP013-SQLCA                     23390099
002508             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)        23400099
002509             SET DP013-DB2-ABEND                                  23410099
002510                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23420099
002511             PERFORM DP013-0000-PROCESS-ABEND                     23430099
002512     END-EVALUATE.                                                23440099
002513                                                                  23450099
002514 EJECT                                                            23460099
002515*----------------------------------------------------------------*23470099
002516*    FETCH THE POE CODE CURSOR                                   *23480099
002517*----------------------------------------------------------------*23490099
002518 4280-FETCH-POE-CURSOR.                                           23500099
002519                                                                  23510099
002520     EXEC SQL                                                     23520099
002521          FETCH POE-CSR                                           23530099
002522          INTO  :IMPOE-POE-CTY-NM,                                23540099
002523                :IMPOE-POE-ST-CDE                                 23550099
002524     END-EXEC.                                                    23560099
002525                                                                  23570099
002526     EVALUATE TRUE                                                23580099
002527         WHEN SQLCODE = ZERO                                      23590099
002528         WHEN SQLCODE = -811                                      23600099
002529              CONTINUE                                            23610099
002530         WHEN SQLCODE = +100                                      23620099
002531             MOVE 'NOT KNOWN' TO IMPOE-POE-NM                     23630099
002532             MOVE SPACES      TO IMPOE-POE-ST-CDE                 23640099
002535         WHEN SQLWARN0 NOT = SPACE                                23650099
002536         WHEN SQLCODE NOT = ZERO                                  23660099
002537              MOVE '4280-FETCH-POE-CURSOR'                        23670099
002538                               TO DP013-PARAGRAPH                 23680099
002539              MOVE 'FETCH POE CURSOR'                             23690099
002540                               TO DP013-MESSAGE-TEXT (1)          23700099
002541              MOVE SQLCA       TO DP013-SQLCA                     23710099
002542              SET DP013-DB2-ABEND                                 23720099
002543                               TO TRUE                            23730099
002544              PERFORM DP013-0000-PROCESS-ABEND                    23740099
002547     END-EVALUATE.                                                23750099
002548                                                                  23760099
002549 EJECT                                                            23770099
002550*----------------------------------------------------------------*23780099
002551*    CLOSE BOL CURSOR.                                            23790099
002552*----------------------------------------------------------------*23800099
002553 4300-CLOSE-BOL-CURSOR.                                           23810099
002554                                                                  23820099
002555     EXEC SQL                                                     23830099
002556         CLOSE BOL-CSR                                            23840099
002557     END-EXEC.                                                    23850099
002558                                                                  23860099
002559     EVALUATE TRUE                                                23870099
002560         WHEN SQLCODE = ZERO                                      23880099
002561             CONTINUE                                             23890099
002562         WHEN SQLCODE = -904                                      23900099
002563         WHEN SQLCODE = -911                                      23910099
002564         WHEN SQLCODE = -913                                      23920099
002565              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       23930099
002566              SET PS-ERROR                                        23940099
002567                  DP020-NEXT-ACT-APPL-ERROR                       23950099
002568                  DP020-MSG-FATAL                                 23960099
002569                      TO TRUE                                     23970099
002570              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 23980099
002571              PERFORM 9000-CALL-CICS-ARCH-API                     23990099
002572                                                                  24000099
002573         WHEN SQLWARN0 NOT = SPACES                               24010099
002574         WHEN SQLCODE < ZERO                                      24020099
002575         WHEN SQLCODE > ZERO                                      24030099
002576             MOVE '4300-CLOSE-BOL-CURSOR'                         24040099
002577                                   TO DP013-PARAGRAPH             24050099
002578             MOVE 'CLOSE BOL CURSOR '                             24060099
002579                                   TO DP013-MESSAGE-TEXT (1)      24070099
002580             MOVE SQLCA            TO DP013-SQLCA                 24080099
002581             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        24090099
002582             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)        24100099
002583             MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (3)        24110099
002584             SET DP013-DB2-ABEND                                  24120099
002585                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24130099
002586             PERFORM DP013-0000-PROCESS-ABEND                     24140099
002587     END-EVALUATE.                                                24150099
002588                                                                  24160099
002589*----------------------------------------------------------------*24170099
002590*    CLOSE EDI CURSOR.                                            24180099
002591*----------------------------------------------------------------*24190099
002592 4310-CLOSE-EDI-CURSOR.                                           24200099
002593                                                                  24210099
002594     EXEC SQL                                                     24220099
002595         CLOSE EDI-CSR                                            24230099
002596     END-EXEC.                                                    24240099
002597                                                                  24250099
002598     EVALUATE TRUE                                                24260099
002599         WHEN SQLCODE = ZERO                                      24270099
002600             CONTINUE                                             24280099
002601         WHEN SQLCODE = -904                                      24290099
002602         WHEN SQLCODE = -911                                      24300099
002603         WHEN SQLCODE = -913                                      24310099
002604              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       24320099
002605              SET PS-ERROR                                        24330099
002606                  DP020-NEXT-ACT-APPL-ERROR                       24340099
002607                  DP020-MSG-FATAL                                 24350099
002608                      TO TRUE                                     24360099
002609              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 24370099
002610              PERFORM 9000-CALL-CICS-ARCH-API                     24380099
002611                                                                  24390099
002612         WHEN SQLWARN0 NOT = SPACES                               24400099
002613         WHEN SQLCODE < ZERO                                      24410099
002614         WHEN SQLCODE > ZERO                                      24420099
002615             MOVE '4310-CLOSE-EDI-CURSOR'                         24430099
002616                                   TO DP013-PARAGRAPH             24440099
002617             MOVE 'CLOSE EDI CURSOR '                             24450099
002618                                   TO DP013-MESSAGE-TEXT (1)      24460099
002619             MOVE SQLCA            TO DP013-SQLCA                 24470099
002620             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        24480099
002621             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)        24490099
002622             MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (3)        24500099
002623             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (4)        24510099
002624             MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (5)        24520099
002625             SET DP013-DB2-ABEND                                  24530099
002626                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24540099
002627             PERFORM DP013-0000-PROCESS-ABEND                     24550099
002628     END-EVALUATE.                                                24560099
002629                                                                  24570099
002630*----------------------------------------------------------------*24580099
002631*    CLOSE EDI CURSOR.                                            24590099
002632*----------------------------------------------------------------*24600099
002633 4311-CLOSE-EDI2-CURSOR.                                          24610099
002634                                                                  24620099
002635     EXEC SQL                                                     24630099
002636         CLOSE EDI-CSR2                                           24640099
002637     END-EXEC.                                                    24650099
002638                                                                  24660099
002639     EVALUATE TRUE                                                24670099
002640         WHEN SQLCODE = ZERO                                      24680099
002641             CONTINUE                                             24690099
002642         WHEN SQLCODE = -904                                      24700099
002643         WHEN SQLCODE = -911                                      24710099
002644         WHEN SQLCODE = -913                                      24720099
002645              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       24730099
002646              SET PS-ERROR                                        24740099
002647                  DP020-NEXT-ACT-APPL-ERROR                       24750099
002648                  DP020-MSG-FATAL                                 24760099
002649                      TO TRUE                                     24770099
002650              MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1) 24780099
002651              PERFORM 9000-CALL-CICS-ARCH-API                     24790099
002652                                                                  24800099
002653         WHEN SQLWARN0 NOT = SPACES                               24810099
002654         WHEN SQLCODE < ZERO                                      24820099
002655         WHEN SQLCODE > ZERO                                      24830099
002656             MOVE '4311-CLOSE-EDI2-CURSOR'                        24840099
002657                                   TO DP013-PARAGRAPH             24850099
002658             MOVE 'CLOSE EDI2 CURSOR '                            24860099
002659                                   TO DP013-MESSAGE-TEXT (1)      24870099
002660             MOVE SQLCA            TO DP013-SQLCA                 24880099
002661             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        24890099
002662             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)        24900099
002663             MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (3)        24910099
002664             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (4)        24920099
002665             MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (5)        24930099
002666             SET DP013-DB2-ABEND                                  24940099
002667                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24950099
002668             PERFORM DP013-0000-PROCESS-ABEND                     24960099
002669     END-EVALUATE.                                                24970099
002670                                                                  24980099
002671 4310-GET-MIN-STATUS-TME.                                         24990099
002672       PERFORM                                                    25000099
002673         WITH TEST AFTER                                          25010099
002674         VARYING PV-RETRY-COUNTER                                 25020099
002675          FROM 1 BY 1                                             25030099
002676            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            25040099
002677                OR (SQLCODE = ZERO))                              25050099
002678         EXEC SQL                                                 25060099
002679           SELECT  MIN(C.STATUS_TME)                              25070099
002680           INTO   :SHIPST-STATUS-TME                              25080099
002681           FROM TSHIPMT A, TSHPTPO B, TSHIPST C                   25090099
002682           WHERE B.PO_NBR     = :ASC-KEY-PO-NUMBER                25100099
002683             AND A.COMPLETE_BOL_NBR    = :DK-BOL-NBR              25110099
002684             AND C.STATUS_DTE = :PV-STATUS-DTE                    25120099
002685             AND A.SHIPT_ID   = B.SHIPT_ID                        25130099
002686             AND A.SHIPT_ID   = C.SHIPT_ID                        25140099
002687             AND C.SHIPT_ID   =:PV-SHIPT-ID2                      25150099
002688         END-EXEC                                                 25160099
002689       EVALUATE TRUE                                              25170099
002690           WHEN SQLCODE = ZERO                                    25180099
002691             CONTINUE                                             25190099
002692           WHEN SQLWARN0 NOT = SPACES                             25200099
002693           WHEN SQLCODE < ZERO                                    25210099
002694           WHEN SQLCODE > ZERO                                    25220099
002695             MOVE '4310-GET-MIN-STATUS-TME'                       25230099
002696                        TO DP013-PARAGRAPH                        25240099
002697             MOVE 'SQL ERROR SELECTING STATUS TIME'               25250099
002698                        TO DP013-MESSAGE-TEXT (1)                 25260099
002699             MOVE SQLCA        TO DP013-SQLCA                     25270099
002700             MOVE 'TSHIPMT '   TO DP013-DB2-TABLE-NAME (1)        25280099
002701             MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (2)        25290099
002702             MOVE 'TSHIPST '   TO DP013-DB2-TABLE-NAME (2)        25300099
002703             SET DP013-DB2-ABEND                                  25310099
002704                 DP013-XCTL-DISPLAY-RESTART TO TRUE               25320099
002705             PERFORM DP013-0000-PROCESS-ABEND                     25330099
002706           END-EVALUATE                                           25340099
002707          END-PERFORM.                                            25350099
002708*                                                                 25360099
002709        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     25370099
002710          MOVE '4310-GET-MIN-STATUS-TME'                          25380099
002711                                    TO DP013-PARAGRAPH            25390099
002712          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT TME'25400099
002713                                    TO DP013-MESSAGE-TEXT (1)     25410099
002714          MOVE SQLCA                TO DP013-SQLCA                25420099
002715          MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)   25430099
002716          MOVE 'TSHPTPO '           TO DP013-DB2-TABLE-NAME (2)   25440099
002717          MOVE 'TSHIPST '           TO DP013-DB2-TABLE-NAME (2)   25450099
002718          SET DP013-DB2-ABEND                                     25460099
002719               DP013-XCTL-DISPLAY-RESTART TO TRUE                 25470099
002720          PERFORM DP013-0000-PROCESS-ABEND                        25480099
002721        END-IF.                                                   25490099
002722        EJECT                                                     25500099
002723                                                                  25510099
002724                                                                  25520099
002725*----------------------------------------------------------------*25530099
002726*    PROCESS THE EDI CURSOR.                                      25540099
002727*----------------------------------------------------------------*25550099
002728 4320-PROCESS-EDI-CURSOR.                                         25560099
002729                                                                  25570099
002730        MOVE +0 TO PV-EXPTED-CART-CNT                             25580099
002731                   PV-ACTL-CART-CNT.                              25590099
002732        IF DK-VEH-TYP = 'VS' OR DK-VEH-TYP = 'AV'                 25600099
002733         PERFORM 4226-FETCH-EDI2-CURSOR                           25610099
002734        ELSE                                                      25620099
002735         PERFORM 4225-FETCH-EDI-CURSOR                            25630099
002736        END-IF.                                                   25640099
002737                                                                  25650099
002738         IF ASC-ITEMS-LEFT-ON-EDI                                 25660099
002739             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                25670099
002740                 ADD +1            TO ASC-ITEM-SUB                25680099
002741             ELSE                                                 25690099
002742                 ADD +1            TO ASC-BLK-SUB                 25700099
002743                 MOVE +1           TO ASC-ITEM-SUB                25710099
002744                                                                  25720099
002745                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         25730099
002746                     MOVE +1       TO ASC-BLK-SUB                 25740099
002747                     SET ASC-BLOCK-MODIFIED (1)                   25750099
002748                                   TO TRUE                        25760099
002749                     PERFORM 5100-WRITE-TEMP-STORAGE              25770099
002750                     MOVE ASC-BLOCK-ENTRIES                       25780099
002751                               (PC-MAX-BLOCKS-IN-ARRAY)           25790099
002752                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 25800099
002753                     ADD +1        TO ASC-BLK-SUB                 25810099
002754                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   25820099
002755                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      25830099
002756                                   TO TRUE                        25840099
002757                 END-IF                                           25850099
002758             END-IF                                               25860099
002759             IF (SHIPMT-SHIPT-ID  NOT = PV-SHIPT-ID) AND          25870099
002760                (ASC-ITEM-SUB NOT = 1)                            25880099
002761                PERFORM 4215-CREATE-ONE-BLANK-LINE                25890099
002762             END-IF                                               25900099
002763             MOVE SHIPMT-SHIPT-ID TO PV-SHIPT-ID                  25910099
002764                                                                  25920099
002765             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    25930099
002766             MOVE ASC-NUMBER-OF-ITEMS-READ                        25940099
002767                                   TO ASC-LIST-ITEM-NUMBER        25950099
002768                                      (ASC-BLK-SUB ASC-ITEM-SUB)  25960099
002769            MOVE 'BOL:' TO ASC-BOL-HDR (ASC-BLK-SUB ASC-ITEM-SUB) 25970099
002770             MOVE 'CARR NAME:' TO ASC-CARRIER-HDR                 25980099
002771                                   (ASC-BLK-SUB ASC-ITEM-SUB)     25990099
002772             MOVE 'QTY:' TO ASC-VENDHD-QTY                        26000099
002773                                   (ASC-BLK-SUB ASC-ITEM-SUB)     26010099
002774             MOVE 'VEH TYPE...:' TO ASC-VEHHDR-TYPE               26020099
002775                                   (ASC-BLK-SUB ASC-ITEM-SUB)     26030099
002776             MOVE 'ETA:' TO ASC-ETA-HDR                           26040099
002777                                   (ASC-BLK-SUB ASC-ITEM-SUB)     26050099
002778             MOVE 'STATUS DATE:' TO ASC-STATUS-HDR                26060099
002779                                   (ASC-BLK-SUB ASC-ITEM-SUB)     26070099
002780*                                                                 26080099
002781             MOVE PV-SAVE-BOL (PV-SAVE-IDX)                       26090099
002782              TO ASC-BOL-NBR           (ASC-BLK-SUB ASC-ITEM-SUB) 26100099
002783             MOVE ENTNME-ENT-NAME-DESC TO PV-ENT-NAME-DESC        26110099
002784             MOVE PV-CARRIER-NME                                  26120099
002785              TO ASC-CARRIER-NME       (ASC-BLK-SUB ASC-ITEM-SUB) 26130099
002786*                                                                 26140099
002787             PERFORM 4240-GET-PURCHS-FIELDS                       26150099
002788             PERFORM 4230-OUTPUT-DATE-TIME                        26160099
002789                                                                  26170099
002790             IF DK-VEH-TYP = 'VS' OR DK-VEH-TYP = 'AV'            26180099
002791                 MOVE 'VESSEL.:' TO ASC-TRAILER-HDR               26190099
002792                                   (ASC-BLK-SUB ASC-ITEM-SUB)     26200099
002793                 IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')    26210099
002794                    MOVE VHTRIP-VEH-NBR                           26220099
002795                     TO ASC-TRAILER-NBR (ASC-BLK-SUB ASC-ITEM-SUB)26230099
002796                 ELSE                                             26240099
002797                     MOVE 'LANDED' TO ASC-TRAILER-NBR             26250099
002798                                     (ASC-BLK-SUB ASC-ITEM-SUB)   26260099
002799                 END-IF                                           26270099
002800             ELSE                                                 26280099
002801                 MOVE 'TRAILER:' TO ASC-TRAILER-HDR               26290099
002802                                   (ASC-BLK-SUB ASC-ITEM-SUB)     26300099
002803                 IF VHTRIP-VEH-NBR > SPACES                       26310099
002804                     MOVE VHTRIP-VEH-NBR                          26320099
002805                     TO ASC-TRAILER-NBR (ASC-BLK-SUB ASC-ITEM-SUB)26330099
002806                 ELSE                                             26340099
002807                     MOVE 'NOT KNOWN' TO ASC-TRAILER-NBR          26350099
002808                                        (ASC-BLK-SUB ASC-ITEM-SUB)26360099
002809                 END-IF                                           26370099
002810             END-IF                                               26380099
002811                                                                  26390099
002812             EVALUATE DK-VEH-TYP                                  26400099
002813                 WHEN 'VS'                                        26410099
002814                     MOVE 'VESSEL' TO ASC-VEHICLE-TYPE            26420099
002815                                     (ASC-BLK-SUB ASC-ITEM-SUB)   26430099
002816                 WHEN 'AV'                                        26440099
002817                     MOVE 'IMPORT AIR' TO ASC-VEHICLE-TYPE        26450099
002818                                        (ASC-BLK-SUB ASC-ITEM-SUB)26460099
002819                 WHEN OTHER                                       26470099
002820                     MOVE 'TRAILER' TO ASC-VEHICLE-TYPE           26480099
002821                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26490099
002822             END-EVALUATE                                         26500099
002823                                                                  26510099
002824             PERFORM 4250-OUTPUT-STATUS-DESC                      26520099
002825                                                                  26530099
002826             IF DK-VEH-TYP = 'VS' OR DK-VEH-TYP = 'AV'            26540099
002827                 MOVE 'POE:' TO ASC-POE-HDR                       26550099
002828                                        (ASC-BLK-SUB ASC-ITEM-SUB)26560099
002829                 IF PURCHS-PO-TYP-CDE = ('IM' OR 'IE' OR 'IF')    26570099
002831                     PERFORM 4260-OPEN-POE-CURSOR                 26580099
002832                     PERFORM 4280-FETCH-POE-CURSOR                26590099
002833                     PERFORM 4270-CLOSE-POE-CURSOR                26600099
002834                     MOVE IMPOE-POE-NM TO ASC-STATUS-CITY         26610099
002835                                        (ASC-BLK-SUB ASC-ITEM-SUB)26620099
002836                     MOVE SPACES TO ASC-STATUS-STATE              26630099
002837                                        (ASC-BLK-SUB ASC-ITEM-SUB)26640099
002838                 ELSE                                             26650099
002839* THIS WOULD MEAN LANDED (THERE'S NO POE)                         26660099
002840                     MOVE SPACES TO ASC-STATUS-STATE              26670099
002841                                        (ASC-BLK-SUB ASC-ITEM-SUB)26680099
002842                                    ASC-STATUS-CITY               26690099
002843                                        (ASC-BLK-SUB ASC-ITEM-SUB)26700099
002844                 END-IF                                           26710099
002845             ELSE                                                 26720099
002846                 MOVE 'DEST:' TO ASC-POE-HDR (ASC-BLK-SUB         26730099
002847                                              ASC-ITEM-SUB)       26740099
002848                                                                  26750099
002849                 IF SHSTYP-PRTY-CDE > 49                          26760099
002850                     MOVE 'AR' TO PV-TRIP-STATUS-CDE              26770099
002851                     PERFORM 4160-SELECT-TTRIPST                  26780099
002852                     IF SQLCODE = +000                            26790099
002855                         PERFORM 4170-SELECT-XMT-LOC              26800099
002856                         IF SQLCODE = +000                        26810099
002857                             MOVE PV-CITY-NAME-15                 26820099
002858                               TO ASC-STATUS-CITY                 26830099
002859                                        (ASC-BLK-SUB ASC-ITEM-SUB)26840099
002860                             MOVE XMT00001-ST-CDE                 26850099
002861                               TO ASC-STATUS-STATE                26860099
002862                                        (ASC-BLK-SUB ASC-ITEM-SUB)26870099
002863                         ELSE                                     26880099
002864                             MOVE SHIPST-CITY-NAME                26890099
002865                               TO ASC-STATUS-CITY                 26900099
002866                                        (ASC-BLK-SUB ASC-ITEM-SUB)26910099
002867                             MOVE SHIPST-STATE-CDE                26920099
002868                               TO ASC-STATUS-STATE                26930099
002869                                        (ASC-BLK-SUB ASC-ITEM-SUB)26940099
002870                         END-IF                                   26950099
002871                     ELSE                                         26960099
002872*  THE CITY AND STATE WEREN'T FOUND ON TRIPST                     26970099
002873*                        MOVE SHIPST-CITY-NAME TO ASC-STATUS-CITY 26980099
002874*                                       (ASC-BLK-SUB ASC-ITEM-SUB)26990099
002875*                        MOVE SHIPST-STATE-CDE TO ASC-STATUS-STATE27000099
002876*                                       (ASC-BLK-SUB ASC-ITEM-SUB)27010099
002877                     MOVE 'EN' TO PV-TRIP-STATUS-CDE              27020099
002878                     PERFORM 4160-SELECT-TTRIPST                  27030099
002879                     IF SQLCODE = +000                            27040099
002882                         PERFORM 4170-SELECT-XMT-LOC              27050099
002883                         IF SQLCODE = +000                        27060099
002884                             MOVE PV-CITY-NAME-15                 27070099
002885                               TO ASC-STATUS-CITY                 27080099
002886                                        (ASC-BLK-SUB ASC-ITEM-SUB)27090099
002887                             MOVE XMT00001-ST-CDE                 27100099
002888                               TO ASC-STATUS-STATE                27110099
002889                                        (ASC-BLK-SUB ASC-ITEM-SUB)27120099
002890                         ELSE                                     27130099
002891                             MOVE SPACES                          27140099
002892                               TO ASC-STATUS-CITY                 27150099
002893                                        (ASC-BLK-SUB ASC-ITEM-SUB)27160099
002894                             MOVE SPACES                          27170099
002895                               TO ASC-STATUS-STATE                27180099
002896                                        (ASC-BLK-SUB ASC-ITEM-SUB)27190099
002897                         END-IF                                   27200099
002898                     END-IF                                       27210099
002899                     END-IF                                       27220099
002900                 ELSE                                             27230099
002901* IT HAS NOT ARRIVED YET                                          27240099
002902                   IF SHIPST-CITY-NAME <= SPACES                  27250099
002903                     MOVE PV-DB2-STATUS-CDE TO PV-TRIP-STATUS-CDE 27260099
002904                     PERFORM 4160-SELECT-TTRIPST                  27270099
002905                     IF SQLCODE = +000                            27280099
002908                         PERFORM 4170-SELECT-XMT-LOC              27290099
002909                         IF SQLCODE = +000                        27300099
002910                             MOVE PV-CITY-NAME-15                 27310099
002911                               TO ASC-STATUS-CITY                 27320099
002912                                        (ASC-BLK-SUB ASC-ITEM-SUB)27330099
002913                             MOVE XMT00001-ST-CDE                 27340099
002914                               TO ASC-STATUS-STATE                27350099
002915                                        (ASC-BLK-SUB ASC-ITEM-SUB)27360099
002916                         ELSE                                     27370099
002917                             MOVE SPACES                          27380099
002918                               TO ASC-STATUS-CITY                 27390099
002919                                        (ASC-BLK-SUB ASC-ITEM-SUB)27400099
002920                             MOVE SPACES                          27410099
002921                               TO ASC-STATUS-STATE                27420099
002922                                        (ASC-BLK-SUB ASC-ITEM-SUB)27430099
002923                         END-IF                                   27440099
002924                     ELSE                                         27450099
002925* DIDN'T FIND CITY ON TRIPST                                      27460099
002926*                        MOVE SHIPST-CITY-NAME TO ASC-STATUS-CITY 27470099
002927*                                       (ASC-BLK-SUB ASC-ITEM-SUB)27480099
002928*                        MOVE SHIPST-STATE-CDE TO ASC-STATUS-STATE27490099
002929*                                       (ASC-BLK-SUB ASC-ITEM-SUB)27500099
002930                     MOVE 'EN' TO PV-TRIP-STATUS-CDE              27510099
002931                     PERFORM 4160-SELECT-TTRIPST                  27520099
002932                     IF SQLCODE = +000                            27530099
002935                         PERFORM 4170-SELECT-XMT-LOC              27540099
002936                         IF SQLCODE = +000                        27550099
002937                             MOVE PV-CITY-NAME-15                 27560099
002938                               TO ASC-STATUS-CITY                 27570099
002939                                        (ASC-BLK-SUB ASC-ITEM-SUB)27580099
002940                             MOVE XMT00001-ST-CDE                 27590099
002941                               TO ASC-STATUS-STATE                27600099
002942                                        (ASC-BLK-SUB ASC-ITEM-SUB)27610099
002943                         ELSE                                     27620099
002944                             MOVE SPACES                          27630099
002945                               TO ASC-STATUS-CITY                 27640099
002946                                        (ASC-BLK-SUB ASC-ITEM-SUB)27650099
002947                             MOVE SPACES                          27660099
002948                               TO ASC-STATUS-STATE                27670099
002949                                        (ASC-BLK-SUB ASC-ITEM-SUB)27680099
002950                         END-IF                                   27690099
002951                     END-IF                                       27700099
002952                  ELSE                                            27710099
002953* THERE WAS A CITY ON SHIPST TO BEGIN WITH                        27720099
002954                      MOVE SHIPST-CITY-NAME TO ASC-STATUS-CITY    27730099
002955                                     (ASC-BLK-SUB ASC-ITEM-SUB)   27740099
002956                      MOVE SHIPST-STATE-CDE TO ASC-STATUS-STATE   27750099
002957                                     (ASC-BLK-SUB ASC-ITEM-SUB)   27760099
002958                 END-IF                                           27770099
002959             END-IF                                               27780099
002960           END-IF                                                 27790099
002961*                                                                 27800099
002962             IF SHSTYP-PRTY-CDE > 49                              27810099
002963                 MOVE DP015-YELLOW                                27820099
002964                   TO ASC-STATUS-DESC-C (ASC-BLK-SUB ASC-ITEM-SUB)27830099
002965             ELSE                                                 27840099
002966                 MOVE DP015-BLUE                                  27850099
002967                   TO ASC-STATUS-DESC-C (ASC-BLK-SUB ASC-ITEM-SUB)27860099
002968             END-IF                                               27870099
002969                                                                  27880099
002970             IF DK-VEH-TYP = 'VS' OR DK-VEH-TYP = 'AV'            27890099
002971                 IF PV-ACTL-CART-CNT > ZERO                       27900099
002972                     MOVE PV-ACTL-CART-CNT                        27910099
002973                       TO ASC-VENDOR-QTY                          27920099
002974                                        (ASC-BLK-SUB ASC-ITEM-SUB)27930099
002975                 ELSE                                             27940099
002976                     MOVE PV-EXPTED-CART-CNT                      27950099
002977                       TO ASC-VENDOR-QTY                          27960099
002978                                        (ASC-BLK-SUB ASC-ITEM-SUB)27970099
002979                 END-IF                                           27980099
002980                 MOVE 'CTN'                                       27990099
002981                   TO ASC-VENDOR-UOM    (ASC-BLK-SUB ASC-ITEM-SUB)28000099
002982             ELSE                                                 28010099
002983                 IF SHSTYP-PRTY-CDE > 49                          28020099
002984                     IF SHIPMT-EXPTED-PKG-QTY = 0                 28030099
002985                         MOVE SHIPMT-CARR-CART-CT                 28040099
002986                           TO ASC-VENDOR-QTY                      28050099
002987                                        (ASC-BLK-SUB ASC-ITEM-SUB)28060099
002988                     ELSE                                         28070099
002989                         MOVE SHIPMT-EXPTED-PKG-QTY               28080099
002990                           TO ASC-VENDOR-QTY                      28090099
002991                                        (ASC-BLK-SUB ASC-ITEM-SUB)28100099
002992                     END-IF                                       28110099
002993                 ELSE                                             28120099
002994                     IF SHIPMT-CARR-CART-CT = 0                   28130099
002995                         MOVE SHIPMT-EXPTED-PKG-QTY               28140099
002996                           TO ASC-VENDOR-QTY                      28150099
002997                                        (ASC-BLK-SUB ASC-ITEM-SUB)28160099
002998                     ELSE                                         28170099
002999                         MOVE SHIPMT-CARR-CART-CT                 28180099
003000                           TO ASC-VENDOR-QTY                      28190099
003001                                        (ASC-BLK-SUB ASC-ITEM-SUB)28200099
003002                     END-IF                                       28210099
003003                 END-IF                                           28220099
003004                 MOVE SHIPMT-PKG-TYP-CDE                          28230099
003005                   TO ASC-VENDOR-UOM    (ASC-BLK-SUB ASC-ITEM-SUB)28240099
003006             END-IF                                               28250099
003007        END-IF.                                                   28260099
003008                                                                  28270099
003009*----------------------------------------------------------------*28280099
003010*    FILL TROUBLE FIELDS.                                         28290099
003011*----------------------------------------------------------------*28300099
003012 4350-FILL-TROUBLE-FIELDS.                                        28310099
003013     PERFORM 4360-CHECK-FOR-UNRESOLVED.                           28320099
003014     EVALUATE PV-DB2-TRBL-CNT                                     28330099
003015     WHEN ZERO                                                    28340099
003016         MOVE SPACES          TO ASC-TRBL-REASON                  28350099
003017                                 ASC-MULTI-TRBL                   28360099
003018     WHEN 1                                                       28370099
003019         PERFORM 4370-TROUBLE-DESC                                28380099
003020     WHEN OTHER                                                   28390099
003021         PERFORM 4370-TROUBLE-DESC                                28400099
003022         MOVE '*'             TO ASC-MULTI-TRBL                   28410099
003023     END-EVALUATE.                                                28420099
003024                                                                  28430099
003025 4360-CHECK-FOR-UNRESOLVED.                                       28440099
003026                                                                  28450099
003027     PERFORM                                                      28460099
003028         WITH TEST AFTER                                          28470099
003029         VARYING PV-RETRY-COUNTER                                 28480099
003030         FROM 1 BY 1                                              28490099
003031         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28500099
003032            OR (SQLCODE = +0)                                     28510099
003033            OR (SQLCODE = +100))                                  28520099
003034                                                                  28530099
003035         EXEC SQL                                                 28540099
003036             SELECT COUNT(*)                                      28550099
003037              INTO :PV-DB2-TRBL-CNT                               28560099
003038              FROM  TTRBNTF A                                     28570099
003039                   ,TTRBRSN B                                     28580099
003040             WHERE A.PO_NBR        = :ASC-KEY-PO-NUMBER           28590099
003041               AND A.RESOLVED_IND  IN (:PC-N, :PC-I)              28600099
003042               AND A.TRBL_RSN_CDE  =  B.TRBL_RSN_CDE              28610099
003043               AND B.TRBL_INITR_CDE   <> :PC-T                    28620099
003044         END-EXEC                                                 28630099
003045                                                                  28640099
003046         EVALUATE TRUE                                            28650099
003047             WHEN SQLCODE = +0                                    28660099
003048             WHEN SQLCODE = +100                                  28670099
003049             WHEN SQLCODE = -904                                  28680099
003050             WHEN SQLCODE = -913                                  28690099
003051                 CONTINUE                                         28700099
003052                                                                  28710099
003053             WHEN SQLWARN0 NOT = SPACE                            28720099
003054             WHEN SQLCODE < +0                                    28730099
003055             WHEN SQLCODE > +0                                    28740099
003056                 MOVE '4360-CHECK-FOR-UNRESOLVED'                 28750099
003057                                 TO DP013-PARAGRAPH               28760099
003058                 MOVE 'COUNT ON TTRBNTF'                          28770099
003059                                 TO DP013-MESSAGE-TEXT (1)        28780099
003060                 MOVE SQLCA      TO DP013-SQLCA                   28790099
003061                 MOVE 'TTRBNTF'  TO DP013-DB2-TABLE-NAME (1)      28800099
003062                 SET DP013-DB2-ABEND                              28810099
003063                                 TO TRUE                          28820099
003064                 SET DP013-XCTL-DISPLAY-RESTART                   28830099
003065                                 TO TRUE                          28840099
003066                 PERFORM DP013-0000-PROCESS-ABEND                 28850099
003067         END-EVALUATE                                             28860099
003068     END-PERFORM.                                                 28870099
003069                                                                  28880099
003070     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28890099
003071             AND (SQLCODE = -904 OR -913)                         28900099
003072         MOVE '4360-CHECK-FOR-UNRESOLVED'                         28910099
003073                                 TO DP013-PARAGRAPH               28920099
003074         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     28930099
003075                                 TO DP013-MESSAGE-TEXT (1)        28940099
003076         MOVE 'ON TTRBNTF'       TO DP013-MESSAGE-TEXT (2)        28950099
003077         MOVE SQLCA              TO DP013-SQLCA                   28960099
003078         MOVE 'TTRBNTF'          TO DP013-DB2-TABLE-NAME (1)      28970099
003079         SET DP013-DB2-ABEND     TO TRUE                          28980099
003080         SET DP013-XCTL-DISPLAY-RESTART                           28990099
003081                                 TO TRUE                          29000099
003082         PERFORM DP013-0000-PROCESS-ABEND                         29010099
003083     END-IF.                                                      29020099
003084                                                                  29030099
003085 4370-TROUBLE-DESC.                                               29040099
003086                                                                  29050099
003087     PERFORM                                                      29060099
003088         WITH TEST AFTER                                          29070099
003089         VARYING PV-RETRY-COUNTER                                 29080099
003090         FROM 1 BY 1                                              29090099
003091         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29100099
003092            OR (SQLCODE = +0 OR +100 OR -811))                    29110099
003093                                                                  29120099
003094         EXEC SQL                                                 29130099
003095             SELECT C.TRBL_SHT_DESC, C.TRBL_RSN_CDE               29140099
003096             INTO :TRBRSN-TRBL-SHT-DESC                           29150099
003097                , :TRBRSN-TRBL-RSN-CDE                            29160099
003098             FROM  TTRBRSN C                                      29170099
003099             WHERE                                                29180099
003100                   C.TRBL_RSN_CDE =                               29190099
003101                (SELECT MAX(B.TRBL_RSN_CDE)                       29200099
003102                  FROM  TTRBNTF A                                 29210099
003103                       ,TTRBRSN B                                 29220099
003104                  WHERE A.PO_NBR    = :ASC-KEY-PO-NUMBER          29230099
003105                      AND A.RESOLVED_IND IN (:PC-N, :PC-I)        29240099
003106                      AND A.TRBL_RSN_CDE = B.TRBL_RSN_CDE         29250099
003107                      AND B.TRBL_INITR_CDE   <> :PC-T)            29260099
003108         END-EXEC                                                 29270099
003109                                                                  29280099
003110         EVALUATE TRUE                                            29290099
003111             WHEN SQLCODE = +0                                    29300099
003112                 MOVE TRBRSN-TRBL-SHT-DESC TO ASC-TRBL-REASON     29310099
003113             WHEN SQLCODE = +100                                  29320099
003114                 MOVE SPACES               TO ASC-TRBL-REASON     29330099
003115             WHEN SQLCODE = -904                                  29340099
003116             WHEN SQLCODE = -913                                  29350099
003117                 CONTINUE                                         29360099
003118                                                                  29370099
003119             WHEN SQLWARN0 NOT = SPACE                            29380099
003120             WHEN SQLCODE < ZERO                                  29390099
003121             WHEN SQLCODE > ZERO                                  29400099
003122                 MOVE '4370-TROUBLE-DESC'                         29410099
003123                                 TO DP013-PARAGRAPH               29420099
003124                 MOVE 'SELECT ON TTRBNTF/TTRBRSN'                 29430099
003125                                 TO DP013-MESSAGE-TEXT (1)        29440099
003126                 MOVE SQLCA      TO DP013-SQLCA                   29450099
003127                 MOVE 'TTRBNTF'  TO DP013-DB2-TABLE-NAME (1)      29460099
003128                 MOVE 'TTRBRSN'  TO DP013-DB2-TABLE-NAME (2)      29470099
003129                 SET DP013-DB2-ABEND                              29480099
003130                                 TO TRUE                          29490099
003131                 SET DP013-XCTL-DISPLAY-RESTART                   29500099
003132                                 TO TRUE                          29510099
003133                 PERFORM DP013-0000-PROCESS-ABEND                 29520099
003134         END-EVALUATE                                             29530099
003135     END-PERFORM.                                                 29540099
003136                                                                  29550099
003137     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29560099
003138             AND (SQLCODE = -904 OR -913)                         29570099
003139         MOVE '4370-TROUBLE-DESC'                                 29580099
003140                                 TO DP013-PARAGRAPH               29590099
003141         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     29600099
003142                                 TO DP013-MESSAGE-TEXT (1)        29610099
003143         MOVE 'ON TTRBNTF'       TO DP013-MESSAGE-TEXT (2)        29620099
003144         MOVE SQLCA              TO DP013-SQLCA                   29630099
003145         MOVE 'TTRBNTF'          TO DP013-DB2-TABLE-NAME (1)      29640099
003146         MOVE 'TTRBRSN'          TO DP013-DB2-TABLE-NAME (2)      29650099
003147         SET DP013-DB2-ABEND     TO TRUE                          29660099
003148         SET DP013-XCTL-DISPLAY-RESTART                           29670099
003149                                 TO TRUE                          29680099
003150         PERFORM DP013-0000-PROCESS-ABEND                         29690099
003151     END-IF.                                                      29700099
003152                                                                  29710099
003153*----------------------------------------------------------------*29720099
003154*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *29730099
003155*----------------------------------------------------------------*29740099
003156                                                                  29750099
003157 4400-MOVE-COMMAREA-TO-SCREEN.                                    29760099
003158                                                                  29770099
003159     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             29780099
003160         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          29790099
003161         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          29800099
003162             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             29810099
003163                 GIVING PV-BLOCK-NUMBER                           29820099
003164                 REMAINDER PV-REMAINDER                           29830099
003165             IF  PV-REMAINDER > ZERO                              29840099
003166                 ADD +1 TO PV-BLOCK-NUMBER                        29850099
003167             END-IF                                               29860099
003168             MOVE +1    TO ASC-BLK-SUB                            29870099
003169             PERFORM 4410-READ-TEMP-STORAGE                       29880099
003170             ADD +1     TO ASC-BLK-SUB                            29890099
003171                           PV-BLOCK-NUMBER                        29900099
003172             PERFORM 4410-READ-TEMP-STORAGE                       29910099
003173     END-IF.                                                      29920099
003174     MOVE +1                       TO ASC-BLK-SUB.                29930099
003175     COMPUTE ASC-ITEM-SUB =                                       29940099
003176         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              29950099
003177         + PC-ITEMS-PER-PANEL).                                   29960099
003178                                                                  29970099
003179     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        29980099
003180         ADD +1   TO ASC-BLK-SUB                                  29990099
003181         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            30000099
003182     END-IF.                                                      30010099
003183                                                                  30020099
003184     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           30030099
003185         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                30040099
003186     PERFORM 4415-FORMAT-HEADING-LIST-LINES.                      30050099
003187     PERFORM 4420-FORMAT-LIST-LINES                               30060099
003188         VARYING PS-SUB                                           30070099
003189         FROM PC-ITEMS-PER-PANEL BY -1                            30080099
003190         UNTIL PS-SUB < +1.                                       30090099
003191                                                                  30100099
003192     COMPUTE ASC-ITEMS-DISPLAYED =                                30110099
003193         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          30120099
003194     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    30130099
003195                                      ASTRTITO.                   30140099
003196     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    30150099
003197     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    30160099
003198                                                                  30170099
003199     IF  DP020-MSG-NUMBER-X = SPACE                               30180099
003200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  30190099
003201*            --- MORE ITEMS TO DISPLAY ----                       30200099
003202             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            30210099
003203             SET DP020-MSG-INFORMATIONAL TO TRUE                  30220099
003204         END-IF                                                   30230099
003205     END-IF.                                                      30240099
003206                                                                  30250099
003207*----------------------------------------------------------------*30260099
003208*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *30270099
003209*----------------------------------------------------------------*30280099
003210                                                                  30290099
003211 4410-READ-TEMP-STORAGE.                                          30300099
003212                                                                  30310099
003213     EXEC CICS                                                    30320099
003214         READQ TS                                                 30330099
003215             QUEUE (ASC-DTL-QUEUE-NAME)                           30340099
003216             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30350099
003217             ITEM  (PV-BLOCK-NUMBER)                              30360099
003218             RESP  (PV-CICS-RESP)                                 30370099
003219     END-EXEC.                                                    30380099
003220                                                                  30390099
003221     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       30400099
003222       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     30410099
003223         CONTINUE                                                 30420099
003224     ELSE                                                         30430099
003225         SET DP013-CICS-ABEND TO  TRUE                            30440099
003226         SET DP013-NO-ROLLBACK TO  TRUE                           30450099
003227         MOVE '4410-READ-TEMP-STORAGE'                            30460099
003228                               TO  DP013-PARAGRAPH                30470099
003229         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      30480099
003230                               TO  DP013-MESSAGE-TEXT(1)          30490099
003231         PERFORM DP013-0000-PROCESS-ABEND                         30500099
003232     END-IF.                                                      30510099
003233                                                                  30520099
003234     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         30530099
003235         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               30540099
003236     END-IF.                                                      30550099
003237 EJECT                                                            30560099
003238                                                                  30570099
003239*----------------------------------------------------------------*30580099
003240*    WRITES HEADING INFORMATION (NON-SCROLLABLE) TO THE SCREEN.  *30590099
003241*----------------------------------------------------------------*30600099
003242                                                                  30610099
003243 4415-FORMAT-HEADING-LIST-LINES.                                  30620099
003244                                                                  30630099
003245     MOVE PO017-ENT-NAME-DESC   TO MR-ENT-NAME-DESC.              30640099
003246     MOVE ASC-PO-NUMBER         TO MR-PO-NBR.                     30650099
003247     MOVE ASC-TRBL-REASON       TO MR-TRBL-REASON.                30660099
003248     MOVE ASC-MULTI-TRBL        TO MR-MULTI-TRBL.                 30670099
003249                                                                  30680099
003250     IF MR-TRBL-REASON > SPACES                                   30690099
003251         MOVE DP015-YELLOW TO MR-TRBL-REASON-C                    30700099
003252     END-IF.                                                      30710099
003253                                                                  30720099
003254     IF MR-MULTI-TRBL  > SPACES                                   30730099
003255         MOVE DP015-YELLOW TO MR-MULTI-TRBL-C                     30740099
003256     END-IF.                                                      30750099
003257                                                                  30760099
003258                                                                  30770099
003259*----------------------------------------------------------------*30780099
003260*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *30790099
003261*----------------------------------------------------------------*30800099
003262                                                                  30810099
003263 4420-FORMAT-LIST-LINES.                                          30820099
003264                                                                  30830099
003265     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      30840099
003266         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                30850099
003267         MOVE SPACE             TO MR-BOL-NBR        (PS-SUB)     30860099
003268                                   MR-BOL-HDR        (PS-SUB)     30870099
003269                                   MR-CARRIER-HDR    (PS-SUB)     30880099
003270                                   MR-CARRIER-NME    (PS-SUB)     30890099
003271                                   MR-TRAILER-HDR    (PS-SUB)     30900099
003272                                   MR-TRAILER-NBR    (PS-SUB)     30910099
003273                                   MR-VENDOR-UOM     (PS-SUB)     30920099
003274                                   MR-POE-HDR        (PS-SUB)     30930099
003275                                   MR-STATUS-CITY    (PS-SUB)     30940099
003276                                   MR-VEHICLE-TYPE   (PS-SUB)     30950099
003277                                   MR-VEHHDR-TYPE   (PS-SUB)      30960099
003278                                   MR-VENDHD-QTY    (PS-SUB)      30970099
003279                                   MR-STATUS-STATE   (PS-SUB)     30980099
003280                                   MR-ETA-HDR        (PS-SUB)     30990099
003281                                   MR-ETA            (PS-SUB)     31000099
003282                                   MR-STATUS-DTE     (PS-SUB)     31010099
003283                                   MR-STATUS-HDR     (PS-SUB)     31020099
003284                                   MR-STATUS-TME     (PS-SUB)     31030099
003285                                   MR-STATUS-TME-ZNE (PS-SUB)     31040099
003286                                   MR-STATUS-DESC    (PS-SUB)     31050099
003287         MOVE ZEROES            TO MR-VENDOR-QTY     (PS-SUB)     31060099
003288     ELSE                                                         31070099
003289         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           31080099
003290             IF ASC-BOL-NBR(ASC-BLK-SUB ASC-ITEM-SUB) = LOW-VALUES31090099
003291                 MOVE SPACES TO ASC-STATUS-CITY(ASC-BLK-SUB       31100099
003292                                                ASC-ITEM-SUB)     31110099
003293             END-IF                                               31120099
003294             MOVE ASC-BOL-NBR           (ASC-BLK-SUB ASC-ITEM-SUB)31130099
003295               TO MR-BOL-NBR            (PS-SUB)                  31140099
003296             MOVE ASC-BOL-HDR  (ASC-BLK-SUB ASC-ITEM-SUB)         31150099
003297                TO MR-BOL-HDR (PS-SUB)                            31160099
003298             MOVE ASC-CARRIER-NME       (ASC-BLK-SUB ASC-ITEM-SUB)31170099
003299               TO MR-CARRIER-NME        (PS-SUB)                  31180099
003300             MOVE ASC-CARRIER-HDR (ASC-BLK-SUB ASC-ITEM-SUB)      31190099
003301               TO MR-CARRIER-HDR (PS-SUB)                         31200099
003302             IF ASC-TRAILER-NBR(ASC-BLK-SUB ASC-ITEM-SUB) =       31210099
003303                    LOW-VALUES                                    31220099
003304                 MOVE SPACES TO ASC-TRAILER-NBR(ASC-BLK-SUB       31230099
003305                                                ASC-ITEM-SUB)     31240099
003306             END-IF                                               31250099
003307             MOVE ASC-TRAILER-NBR       (ASC-BLK-SUB ASC-ITEM-SUB)31260099
003308               TO MR-TRAILER-NBR        (PS-SUB)                  31270099
003309             MOVE ASC-TRAILER-HDR       (ASC-BLK-SUB ASC-ITEM-SUB)31280099
003310               TO MR-TRAILER-HDR        (PS-SUB)                  31290099
003311             MOVE ASC-VENDOR-QTY        (ASC-BLK-SUB ASC-ITEM-SUB)31300099
003312               TO MR-VENDOR-QTY         (PS-SUB)                  31310099
003313             MOVE ASC-VENDHD-QTY        (ASC-BLK-SUB ASC-ITEM-SUB)31320099
003314               TO MR-VENDHD-QTY (PS-SUB)                          31330099
003315             IF ASC-VEHICLE-TYPE(ASC-BLK-SUB ASC-ITEM-SUB) =      31340099
003316               LOW-VALUES                                         31350099
003317                 MOVE SPACES TO ASC-VEHICLE-TYPE(ASC-BLK-SUB      31360099
003318                                                ASC-ITEM-SUB)     31370099
003319             END-IF                                               31380099
003320             MOVE ASC-VEHICLE-TYPE      (ASC-BLK-SUB ASC-ITEM-SUB)31390099
003321               TO MR-VEHICLE-TYPE       (PS-SUB)                  31400099
003322             MOVE ASC-VEHHDR-TYPE       (ASC-BLK-SUB ASC-ITEM-SUB)31410099
003323               TO MR-VEHHDR-TYPE (PS-SUB)                         31420099
003324             IF ASC-VENDOR-UOM(ASC-BLK-SUB ASC-ITEM-SUB) =        31430099
003325               LOW-VALUES                                         31440099
003326                 MOVE SPACES TO ASC-VENDOR-UOM(ASC-BLK-SUB        31450099
003327                                                ASC-ITEM-SUB)     31460099
003328             END-IF                                               31470099
003329             MOVE ASC-VENDOR-UOM        (ASC-BLK-SUB ASC-ITEM-SUB)31480099
003330               TO MR-VENDOR-UOM         (PS-SUB)                  31490099
003331             IF ASC-STATUS-CITY(ASC-BLK-SUB ASC-ITEM-SUB) =       31500099
003332               LOW-VALUES                                         31510099
003333                 MOVE SPACES TO ASC-STATUS-CITY(ASC-BLK-SUB       31520099
003334                                                ASC-ITEM-SUB)     31530099
003335             END-IF                                               31540099
003336             MOVE ASC-STATUS-CITY       (ASC-BLK-SUB ASC-ITEM-SUB)31550099
003337               TO MR-STATUS-CITY        (PS-SUB)                  31560099
003338             MOVE ASC-POE-HDR           (ASC-BLK-SUB ASC-ITEM-SUB)31570099
003339               TO MR-POE-HDR            (PS-SUB)                  31580099
003340             MOVE ASC-ETA-HDR           (ASC-BLK-SUB ASC-ITEM-SUB)31590099
003341               TO MR-ETA-HDR            (PS-SUB)                  31600099
003342             IF ASC-STATUS-STATE(ASC-BLK-SUB ASC-ITEM-SUB) =      31610099
003343               LOW-VALUES                                         31620099
003344                 MOVE SPACES TO ASC-STATUS-STATE(ASC-BLK-SUB      31630099
003345                                                ASC-ITEM-SUB)     31640099
003346             END-IF                                               31650099
003347             MOVE ASC-STATUS-STATE      (ASC-BLK-SUB ASC-ITEM-SUB)31660099
003348               TO MR-STATUS-STATE       (PS-SUB)                  31670099
003349             IF ASC-ETA(ASC-BLK-SUB ASC-ITEM-SUB) = LOW-VALUES    31680099
003350                 MOVE SPACES TO ASC-ETA(ASC-BLK-SUB ASC-ITEM-SUB) 31690099
003351             END-IF                                               31700099
003352             MOVE ASC-ETA               (ASC-BLK-SUB ASC-ITEM-SUB)31710099
003353               TO MR-ETA                (PS-SUB)                  31720099
003354             MOVE DP015-YELLOW                                    31730099
003355                   TO MR-ETA-C          (PS-SUB)                  31740099
003356             MOVE ASC-STATUS-DTE        (ASC-BLK-SUB ASC-ITEM-SUB)31750099
003357               TO MR-STATUS-DTE         (PS-SUB)                  31760099
003358             MOVE  ASC-STATUS-HDR       (ASC-BLK-SUB ASC-ITEM-SUB)31770099
003359                TO MR-STATUS-HDR        (PS-SUB)                  31780099
003360             MOVE ASC-STATUS-TME        (ASC-BLK-SUB ASC-ITEM-SUB)31790099
003361               TO MR-STATUS-TME         (PS-SUB)                  31800099
003362             IF ASC-STATUS-TME-ZNE(ASC-BLK-SUB ASC-ITEM-SUB) =    31810099
003363                 LOW-VALUES                                       31820099
003364                 MOVE SPACES TO ASC-STATUS-TME-ZNE(ASC-BLK-SUB    31830099
003365                                           ASC-ITEM-SUB)          31840099
003366             END-IF                                               31850099
003367             MOVE ASC-STATUS-TME-ZNE    (ASC-BLK-SUB ASC-ITEM-SUB)31860099
003368               TO MR-STATUS-TME-ZNE     (PS-SUB)                  31870099
003369             IF ASC-STATUS-DESC(ASC-BLK-SUB ASC-ITEM-SUB) =       31880099
003370                 LOW-VALUES                                       31890099
003371                 MOVE SPACES TO ASC-STATUS-DESC(ASC-BLK-SUB       31900099
003372                                           ASC-ITEM-SUB)          31910099
003373             END-IF                                               31920099
003374             MOVE ASC-STATUS-DESC       (ASC-BLK-SUB ASC-ITEM-SUB)31930099
003375               TO MR-STATUS-DESC        (PS-SUB)                  31940099
003376             MOVE ASC-STATUS-DESC-C (ASC-BLK-SUB ASC-ITEM-SUB)    31950099
003377               TO MR-STATUS-DESC-C      (PS-SUB)                  31960099
003378         END-IF                                                   31970099
003379     END-IF.                                                      31980099
003380     SUBTRACT +1 FROM ASC-ITEM-SUB.                               31990099
003381     IF  ASC-ITEM-SUB < + 1                                       32000099
003382         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  32010099
003383         MOVE +1                 TO ASC-BLK-SUB                   32020099
003384     END-IF.                                                      32030099
003385                                                                  32040099
003386                                                                  32050099
003387*----------------------------------------------------------------*32060099
003388*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *32070099
003389*----------------------------------------------------------------*32080099
003390                                                                  32090099
003391 5100-WRITE-TEMP-STORAGE.                                         32100099
003392                                                                  32110099
003393     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     32120099
003394                               TO  PV-LIST-ITEM-NUMBER.           32130099
003395     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           32140099
003396         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           32150099
003397                                                                  32160099
003398     EXEC CICS                                                    32170099
003399         WRITEQ TS                                                32180099
003400             QUEUE (ASC-DTL-QUEUE-NAME)                           32190099
003401             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               32200099
003402             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     32210099
003403             RESP  (PV-CICS-RESP)                                 32220099
003404     END-EXEC.                                                    32230099
003405                                                                  32240099
003406     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      32250099
003407         SET DP013-CICS-ABEND                                     32260099
003408                       TO  TRUE                                   32270099
003409         SET DP013-NO-ROLLBACK                                    32280099
003410                       TO  TRUE                                   32290099
003411         MOVE '5100-WRITE-TEMP-STORAGE'                           32300099
003412                       TO  DP013-PARAGRAPH                        32310099
003413         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       32320099
003414                       TO  DP013-MESSAGE-TEXT(1)                  32330099
003415         PERFORM DP013-0000-PROCESS-ABEND                         32340099
003416     END-IF.                                                      32350099
003417     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.             32360099
003418                                                                  32370099
003419 EJECT                                                            32380099
003420                                                                  32390099
003421*----------------------------------------------------------------*32400099
003422*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *32410099
003423*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *32420099
003424*----------------------------------------------------------------*32430099
003425                                                                  32440099
003426 9000-CALL-CICS-ARCH-API.                                         32450099
003427                                                                  32460099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      32470099
003429                                    DFHCOMMAREA                   32480099
003430                                    DP030-CICS-API-FIELDS         32490099
003431                                    DP020-STANDARD-COMMAREA       32500099
003432                                    PO070AI.                      32510099
003433                                                                  32520099
003434     IF  DP030-RC-CALL-SUCCESSFUL                                 32530099
003435         CONTINUE                                                 32540099
003436     ELSE                                                         32550099
003437         SET DP013-NO-ROLLBACK TO TRUE                            32560099
003438         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   32570099
003439         SET DP013-CICS-ABEND TO TRUE                             32580099
003440         MOVE '9000-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        32590099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O32600099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      32610099
003443         MOVE DP030-RETURN-CODE                                   32620099
003444                               TO DP013-MESSAGE-TEXT (3)          32630099
003445         PERFORM DP013-0000-PROCESS-ABEND                         32640099
003446     END-IF.                                                      32650099
003447                                                                  32660099
003448*----------------------------------------------------------------*32670099
003449*    ABEND PROCESSOR MODULE                                      *32680099
003450*----------------------------------------------------------------*32690099
003460                                                                  32700099
003500     COPY DPPD013.                                                32710099
