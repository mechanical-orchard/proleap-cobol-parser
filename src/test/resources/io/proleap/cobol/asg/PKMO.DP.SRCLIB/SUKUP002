000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300******************************************************************00030004
000400                                                                  00040004
000500 PROGRAM-ID.    SUKUP002.                                         00050004
000600 AUTHOR.        STEPHANIE HERON                                   00060004
000700 INSTALLATION.  KOHLS.                                            00070004
000800 DATE-WRITTEN   NOVEMBER, 1997.                                   00080004
000900 DATE-COMPILED.                                                   00090004
001000                                                                  00100004
001100******************************************************************00110004
001200*  THIS PROGRAM WILL INACTIVE CARTONS ON TSHPUNT BASED ON THE INPU00120004
001300*  FILE (TSHPUNT FORMAT).                                         00130004
001400******************************************************************00140004
001500                                                                  00150004
001600******************************************************************00160004
001700 ENVIRONMENT DIVISION.                                            00170004
001800******************************************************************00180004
001900                                                                  00190004
002000 CONFIGURATION SECTION.                                           00200004
002100                                                                  00210004
002200 SOURCE-COMPUTER.        IBM-3090.                                00220004
002300 OBJECT-COMPUTER.        IBM-3090.                                00230004
002400                                                                  00240004
002500 INPUT-OUTPUT SECTION.                                            00250004
002600                                                                  00260004
002700 FILE-CONTROL.                                                    00270004
002800                                                                  00280004
002900                                                                  00290004
003000     SELECT SHIPUNIT-INACTIVE-FILE                                00300004
003100         ASSIGN TO IN01.                                          00310004
003200                                                                  00320004
003300******************************************************************00330004
003400 DATA DIVISION.                                                   00340004
003500******************************************************************00350004
003600                                                                  00360004
003700 FILE SECTION.                                                    00370004
003800                                                                  00380004
003900*                                                                 00390004
004000 FD  SHIPUNIT-INACTIVE-FILE                                       00400004
004100     RECORDING MODE IS F                                          00410004
004200     LABEL RECORDS ARE STANDARD                                   00420004
004300     BLOCK CONTAINS 0 RECORDS.                                    00430004
004400                                                                  00440004
004500 01  SHIPUNIT-INACTIVE-RECORD   PIC  X(077).                      00450004
004600*                                                                 00460004
004700*                                                                 00470004
004800******************************************************************00480004
004900 WORKING-STORAGE SECTION.                                         00490004
005000******************************************************************00500004
005100*                                                                 00510004
005200******************************************************************00520004
005300*  DB2 FORMATTED MESSAGE AREA                                     00530004
005400******************************************************************00540004
005500     COPY DPWS004.                                                00550012
005600*                                                                 00560004
005700*                                                                 00570004
005800*                                                                 00580004
005900******************************************************************00590004
006000*  COMMUNICATIONS AREA FOR DB2                                    00600004
006100******************************************************************00610004
006200     EXEC SQL                                                     00620004
006300          INCLUDE SQLCA                                           00630004
006400     END-EXEC.                                                    00640004
006500*                                                                 00650004
006600*                                                                 00660004
006700******************************************************************00670004
006800*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      00680004
006900*  TABLE                                                          00690004
007000******************************************************************00700004
007100     EXEC SQL                                                     00710004
007200          INCLUDE TSHPUNT                                         00720004
007300     END-EXEC.                                                    00730004
007310******************************************************************00731006
007320*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SHIPMENT UNIT      00732006
007330*  CROSS REFERENCE TABLE                                          00733006
007340******************************************************************00734006
007350     EXEC SQL                                                     00735006
007360          INCLUDE TSULBXF                                         00736006
007370     END-EXEC.                                                    00737006
007400*                                                                 00740004
007500 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00750004
007600                                                   COMP SYNC.     00760004
007700                                                                  00770004
007800 01  PS-PROGRAM-SWITCHES.                                         00780004
007900     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00790004
008000         88  PS-END-OF-FILE                        VALUE 'Y'.     00800004
008100         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00810004
008200                                                                  00820004
008300                                                                  00830004
008400 01  PC-PROGRAM-CONSTANTS.                                        00840004
008500     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00850004
008600                                                   COMP SYNC.     00860004
008700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00870004
008800         'SUKUP002'.                                              00880004
008900     05  PC-CURRENT-OPERATING-COMPANY                             00890004
009000                                     PIC  X(02)    VALUE '03'.    00900004
009100     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00910004
009200                                                   COMP SYNC.     00920004
009300     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  00930004
009400                                                                  00940004
009500 01  PV-PROGRAM-VARIABLES.                                        00950004
009600     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    00960004
009700     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00970004
009800     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00980004
009900     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     00990004
010000                                                   COMP SYNC.     01000004
010100     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     01010004
010200                                                   COMP SYNC.     01020004
010300     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01030004
010400                                                   COMP SYNC.     01040004
010500     05  PV-READ-COUNTER             PIC S9(09)    VALUE ZERO     01050004
010600                                                   COMP SYNC.     01060004
010700     05  PV-UPDATE-COUNTER           PIC S9(09)    VALUE ZERO     01070004
010800                                                   COMP SYNC.     01080004
010900     05  PV-UPDATE-COUNTER-2         PIC S9(09)    VALUE ZERO     01090004
011000                                                   COMP SYNC.     01100004
011100     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01110004
011200                                                                  01120004
011300     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01130004
011400                                                   COMP-3.        01140004
011500                                                                  01150004
011600                                                                  01160004
011700 01  SD-SYSTEM-DATE.                                              01170004
011800     05  SD-SYSTEM-DATE-YY           PIC  9(02)      VALUE ZERO.  01180004
011900     05  SD-SYSTEM-DATE-MM           PIC  9(02)      VALUE ZERO.  01190004
012000     05  SD-SYSTEM-DATE-DD           PIC  9(02)      VALUE ZERO.  01200004
012100                                                                  01210004
012200                                                                  01220004
012300******************************************************************01230004
012400 PROCEDURE DIVISION.                                              01240004
012500******************************************************************01250004
012600                                                                  01260004
012700 0000-PROGRAM-MAINLINE.                                           01270004
012800******************************************************************01280004
012900* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01290004
013000*      PROGRAM.                                                   01300004
013100******************************************************************01310004
013200                                                                  01320004
013300     PERFORM 1000-INITIALIZE.                                     01330004
013400     IF PS-NOT-END-OF-FILE                                        01340004
013500         PERFORM 2000-PROCESS-SHIPMENT-UNITS                      01350004
013600            UNTIL PS-END-OF-FILE                                  01360004
013700     END-IF.                                                      01370004
013800     PERFORM 9000-EOJ-ROUTINE.                                    01380004
013900                                                                  01390004
014000     STOP RUN.                                                    01400004
014100                                                                  01410004
014200 1000-INITIALIZE.                                                 01420004
014300******************************************************************01430004
014400*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01440004
014500*    -- OPEN OUTPUT FILE                                          01450004
014600*    -- OPEN CURSOR                                               01460004
014700*    -- FETCH CURSOR                                              01470004
014800******************************************************************01480004
014900                                                                  01490004
015000     OPEN INPUT  SHIPUNIT-INACTIVE-FILE.                          01500004
015100                                                                  01510004
015200     PERFORM 7000-READ-INACTIVE-FILE.                             01520004
015300                                                                  01530004
015400 2000-PROCESS-SHIPMENT-UNITS.                                     01540004
015500******************************************************************01550004
015600*  PROCESS THE CERTIFICATION REQUESTS (LOOP THROUGH THE RESULTS   01560004
015700*  TABLE).  FORMAT THE OUTPUT RECORD.  WRITE THE RECORDS THAT     01570004
015800*  MEET THE CRITERIA.                                             01580004
015900******************************************************************01590004
016000                                                                  01600004
016100     PERFORM 8000-UPDATE-TSHPUNT.                                 01610004
016110     PERFORM 8100-UPDATE-TSULBXF.                                 01611005
016200                                                                  01620004
016300     IF  PV-UPDATE-COUNTER-2  > 1000                              01630004
016400         EXEC SQL                                                 01640004
016500              COMMIT                                              01650004
016600         END-EXEC                                                 01660004
016700         MOVE  ZEROES  TO  PV-UPDATE-COUNTER-2                    01670004
016800     END-IF.                                                      01680004
016900                                                                  01690004
017000     PERFORM 7000-READ-INACTIVE-FILE.                             01700004
017100                                                                  01710004
017200 7000-READ-INACTIVE-FILE.                                         01720004
017300******************************************************************01730004
017400*  READ INPUT FILE.                                               01740004
017500******************************************************************01750004
017600      INITIALIZE DCLTSHPUNT.                                      01760004
017700                                                                  01770004
017800      READ SHIPUNIT-INACTIVE-FILE INTO                            01780004
017900          DCLTSHPUNT                                              01790004
018000          AT END SET PS-END-OF-FILE TO TRUE.                      01800004
018100                                                                  01810004
018200      IF PS-END-OF-FILE                                           01820004
018300         CONTINUE                                                 01830004
018400      ELSE                                                        01840004
018500         ADD +1 TO PV-READ-COUNTER                                01850004
018600      END-IF.                                                     01860004
018700                                                                  01870004
018800 8000-UPDATE-TSHPUNT.                                             01880004
018900******************************************************************01890004
019000*  UPDATE THE STATUS CODE ON TSHPUNT TO 'I'.                      01900004
019100******************************************************************01910004
019200     EXEC SQL                                                     01920004
019300          UPDATE TSHPUNT                                          01930004
019400             SET ACTV_IND = 'I'                                   01940004
019500           WHERE SHIPT_UNT_ID = :SHPUNT-SHIPT-UNT-ID              01950004
019600     END-EXEC.                                                    01960004
019700                                                                  01970004
019800     EVALUATE TRUE                                                01980004
019900         WHEN SQLCODE = ZERO                                      01990004
020000             ADD +1 TO PV-UPDATE-COUNTER                          02000004
020100             ADD +1 TO PV-UPDATE-COUNTER-2                        02010004
020200         WHEN SQLWARN0 NOT = SPACES                               02020004
020300         WHEN SQLCODE < ZERO                                      02030004
020400         WHEN SQLCODE > ZERO                                      02040004
020500             MOVE '8000-UPDATE-TSHPUNT '                          02050004
020600                                 TO PV-PARAGRAPH-NAME             02060004
020700             MOVE 'UPDATE TSHPUNT '                               02070004
020800                                 TO PV-DB2-OPERATION-ATTEMPTED    02080004
020900             DISPLAY 'SHIPT UNIT ID BEING PROCESSED IS '          02090004
021000                     SHPUNT-SHIPT-UNT-ID                          02100004
021100             PERFORM 9100-SQL-ABEND                               02110004
021200     END-EVALUATE.                                                02120004
021300                                                                  02130004
021310                                                                  02131005
021320 8100-UPDATE-TSULBXF.                                             02132005
021330******************************************************************02133005
021340*  UPDATE THE STATUS CODE ON TSULBXF TO 'I'.                      02134005
021350******************************************************************02135005
021360     EXEC SQL                                                     02136005
021370          UPDATE TSULBXF                                          02137007
021380             SET STAT_CDE = 'I'                                   02138005
021390           WHERE SHIPT_UNT_ID = :SHPUNT-SHIPT-UNT-ID              02139005
021391             AND STAT_CDE = 'A'                                   02139110
021392     END-EXEC.                                                    02139205
021393                                                                  02139305
021394     EVALUATE TRUE                                                02139405
021395         WHEN SQLCODE = ZERO                                      02139505
021396             ADD +1 TO PV-UPDATE-COUNTER-2                        02139608
021397         WHEN SQLCODE = +100                                      02139708
021398             CONTINUE                                             02139808
021399         WHEN SQLWARN0 NOT = SPACES                               02139905
021400         WHEN SQLCODE < ZERO                                      02140005
021401         WHEN SQLCODE > ZERO                                      02140105
021402             MOVE '8100-UPDATE-TSULBXF '                          02140205
021403                                 TO PV-PARAGRAPH-NAME             02140305
021404             MOVE 'UPDATE TSULBXF '                               02140405
021405                                 TO PV-DB2-OPERATION-ATTEMPTED    02140505
021406             DISPLAY 'CROSS REFERENCE BEING PROCESSED IS '        02140605
021407                     SHPUNT-SHIPT-UNT-ID                          02140709
021408             PERFORM 9100-SQL-ABEND                               02140805
021409     END-EVALUATE.                                                02140905
021410                                                                  02141005
021420                                                                  02142005
021500                                                                  02150004
021600 9000-EOJ-ROUTINE.                                                02160004
021700******************************************************************02170004
021800*  CLOSE INPUT FILE.  DISPLAY COUNTERS.                           02180004
021900******************************************************************02190004
022000     CLOSE SHIPUNIT-INACTIVE-FILE.                                02200004
022100                                                                  02210004
022200     MOVE PV-READ-COUNTER TO PV-DISPLAY-COUNT.                    02220004
022300     DISPLAY 'TOTAL RECORDS READ ' PV-DISPLAY-COUNT.              02230004
022400     MOVE PV-UPDATE-COUNTER TO PV-DISPLAY-COUNT.                  02240004
022500     DISPLAY 'TOTAL TSHPUNT UPDATED '    PV-DISPLAY-COUNT.        02250004
022600                                                                  02260004
022700                                                                  02270004
022800 9100-SQL-ABEND.                                                  02280004
022900******************************************************************02290004
023000*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    02300004
023100*  ERROR OR WARNING CODE OCCURS.                                  02310004
023200******************************************************************02320004
023300     DISPLAY '9100-SQL-ABEND'.                                    02330004
023400     DISPLAY '** ABEND     **'.                                   02340004
023500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02350004
023600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02360004
023700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     02370004
023800                                                                  02380004
023900******************************************************************02390004
024000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02400004
024100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02410004
024200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02420004
024300* FORMAT.                                                         02430004
024400******************************************************************02440004
024500     COPY DPPD004.                                                02450004
024600                                                                  02460004
024700     MOVE +4013                  TO ABEND-CODE.                   02470004
024800     CALL 'ILBOABN0' USING ABEND-CODE.                            02480004
