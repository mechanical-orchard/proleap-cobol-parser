000100 ID DIVISION.                                                     00010000
W34517 PROGRAM-ID.      VAKUT402.                                       00020000
000300 AUTHOR.          B. GRAHAM - STRATAGEM.                          00030000
000400 DATE-WRITTEN     AUGUST 23, 2006.                                00040000
000500 DATE-COMPILED.                                                   00050000
W34517****IMPORTANT*****************************************************00051000
W34517* THIS IS A CLONE OF THE INKUT402 CREATED FOR THE VA PROJECT     *00052000
W34517* THE MAJOR CHANGES ARE .....                                    *00053000
W34517******************************************************************00054000
000600******************************************************************00055000
W34517*    VAKUT402                                                    *00056000
000800*  - READ SHORTAGE EXTRACT RECORDS                               *00057000
000900*  - DETERMINE WHICH SHOULD HAVE BEEN INVENTORIED USING          *00058000
001000*  - STORE/DEPARTMENT FILTER INFORMATION FROM INT_INV_PARMS_MDSE *00059000
001100*    TABLE. STORE WIDE INVENTORY, ALL DEPARTMENTS ARE INCLUDED.  *00060000
001200*    FOR DEPARTMENT INVENTORY, DEFAULT DEPARTMENTS               *00070000
001300*    FOR ALL STORES IN THE CYCLE OR SPECIFIC DEPARTMENTS FOR     *00080000
001400*    SPECIFIC STORES IN THE INVENTORY CYCLE.                     *00090000
001500*    WRITE OUT THOSE THAT APPLY TO THE TYPE OF INVENTORY AND     *00100000
001600*    ASSOCIATED DEPARTMENT. FOR THOSE THAT SHOULD NOT HAVE       *00110000
001700*    BEEN COUNTED, WRITE TO A SEPARATE FILE.                     *00120000
001800*    THIS PROGRAM IS BEING USED TO FILTER BOTH BOOK VALUE        *00130000
001900*    AND PHYSICAL COUNT SHORTAGE EXTRACT RECORDS                 *00140000
002000******************************************************************00150000
002100*  CHANGE LOG                                                     00160000
002200*  DATE     CHANGED BY      DESC                                  00170000
002300*  ---------- ------------- --------------------------------------00180000
002400*  08-10-2006 B. GRAHAM     ORIGINAL CODE                         00190000
002500* W28545                    ADD LOGIC  FOR DEPARTMENT LEVEL       00200000
002600*                           INVENTORY PROCESS.                    00210000
002700*                           B. GRAHAM - STRATAGEM                 00220000
W34517* W34517  10-14-2008 IN-VA INVENTORY STREAM SPLIT                 00230000
W33304*  09-17-2008  VIGNESH/     HOLDING INVENTORY LEDGER OPEN (HILO). 00232001
W33304*  W33304      INFOSYS                                            00233001
002800*                                                                 00240000
002900******************************************************************00250000
003000                                                                  00260000
003100 ENVIRONMENT DIVISION.                                            00270000
003200 CONFIGURATION SECTION.                                           00280000
003300 SOURCE-COMPUTER.        IBM-3090.                                00290000
003400 OBJECT-COMPUTER.        IBM-3090.                                00300000
003500 INPUT-OUTPUT SECTION.                                            00310000
003600 FILE-CONTROL.                                                    00320000
003700                                                                  00330000
003800     SELECT  IN-SHORTAGE-EXT-FILE ASSIGN TO INP01.                00340000
003900                                                                  00350000
004000     SELECT  OUT-SHORTAGE-EXT-FILE ASSIGN TO OUT01.               00360000
004100                                                                  00370000
004200     SELECT  OUT-SHORTAGE-FILTER-FILE ASSIGN TO OUT02.            00380000
004300                                                                  00390000
004400 DATA DIVISION.                                                   00400000
004500                                                                  00410000
004600 FILE SECTION.                                                    00420000
004700                                                                  00430000
004800 FD  IN-SHORTAGE-EXT-FILE                                         00440000
004900     RECORDING MODE F                                             00450000
005000     LABEL RECORDS ARE STANDARD                                   00460000
005100     BLOCK CONTAINS  0 RECORDS                                    00470000
W33304     RECORD CONTAINS 170 CHARACTERS                               00480001
005300     DATA RECORD IS IN-SHORTAGE-EXT-RECORD.                       00490000
005400                                                                  00500000
W33304 01  IN-SHORTAGE-EXT-RECORD    PIC X(170).                        00510001
005600                                                                  00520000
005700 FD  OUT-SHORTAGE-EXT-FILE                                        00530000
005800     RECORDING MODE F                                             00540000
005900     LABEL RECORDS ARE STANDARD                                   00550000
006000     BLOCK CONTAINS  0 RECORDS                                    00560000
W33304     RECORD CONTAINS 170 CHARACTERS                               00570001
006200     DATA RECORD IS OUT-SHORTAGE-EXT-RECORD.                      00580000
006300                                                                  00590000
W33304 01  OUT-SHORTAGE-EXT-RECORD   PIC X(170).                        00600001
006500                                                                  00610000
006600 FD  OUT-SHORTAGE-FILTER-FILE                                     00620000
006700     RECORDING MODE F                                             00630000
006800     LABEL RECORDS ARE STANDARD                                   00640000
006900     BLOCK CONTAINS  0 RECORDS                                    00650000
W33304     RECORD CONTAINS 170 CHARACTERS                               00660001
W33304     DATA RECORD IS OUT-SHORTAGE-FILTER-RECORD.                   00670001
007200                                                                  00680000
W33304 01  OUT-SHORTAGE-FILTER-RECORD PIC X(170).                       00690001
007400                                                                  00700000
007500 WORKING-STORAGE SECTION.                                         00710000
007600                                                                  00720000
007700 01  PA-PROGRAM-ACCUMULATORS.                                     00730000
007800     05  PA-INPUT-RECORD-COUNT     PIC S9(9) COMP-3 VALUE +0.     00740000
007900     05  PA-OUTPUT-VALID-COUNT     PIC S9(9) COMP-3 VALUE +0.     00750000
008000     05  PA-OUTPUT-FILTER-COUNT    PIC S9(9) COMP-3 VALUE +0.     00760000
008100     05  PA-WORK-RECORD-COUNT                                     00770000
008200                                   PIC S9(9) COMP-3 VALUE +0.     00780000
008300                                                                  00790000
008400 01  PC-PROGRAM-CONSTANTS.                                        00800000
008500     05  PC-MAX-RETRIES        PIC S9(04)    COMP SYNC VALUE +2.  00810000
W34517     05  PC-PROGRAM-ID         PIC X(08)     VALUE 'VAKUT402'.    00820000
008700     05  PC-NINETY-NINE          PIC 9(03)      VALUE 099.        00830000
008800     05  PC-9990                 PIC S9(04)     VALUE 9990 COMP-3.00840000
008900     05  PC-FOUR-THOUSAND        PIC 9(04)      VALUE 4000.       00850000
009000                                                                  00860000
009100 01  PV-PROGRAM-VARIABLES.                                        00870000
009200     05  PV-HOLD-STORE-NBR       PIC 9(04)  VALUE ZERO.           00880000
009300     05  PV-HOLD-DEPT-NBR        PIC 9(04)  VALUE ZERO.           00890000
009400     05  PV-PREV-STORE-NBR       PIC 9(04)  VALUE ZERO.           00900000
009500     05  PV-STORE-0000-COUNT     PIC S9(09) VALUE +0  COMP SYNC.  00910000
009600     05  PV-STORE-XXXX-COUNT     PIC S9(09) VALUE +0  COMP SYNC.  00920000
009700     05  PV-STORE-SUB            PIC S9(05) VALUE ZERO COMP-3.    00930000
009800     05  PV-II-TBL-SUB           PIC S9(03) VALUE ZERO COMP-3.    00940000
009900     05  PV-IIPM-TBL-SUB         PIC S9(05) VALUE ZERO COMP-3.    00950000
010000     05  PV-RETRY-COUNT        PIC S9(04)   COMP SYNC   VALUE +0. 00960000
010100     05  PV-DB2-OPER-ATTEMPTED PIC  X(30)          VALUE SPACES.  00970000
010200     05  PV-MAX-RETRIES        PIC S9(05)   COMP-3 VALUE +3.      00980000
010300     05  PV-PARAGRAPH-NAME     PIC  X(30)          VALUE SPACES.  00990000
010400                                                                  01000000
010500 01  PS-PROGRAM-SWITCHES.                                         01010000
010600     05  PS-INPUT-AT-END-SW         PIC X(01)    VALUE 'N'.       01020000
010700         88  PS-INPUT-AT-END-NO                  VALUE 'N'.       01030000
010800         88  PS-INPUT-AT-END-YES                 VALUE 'Y'.       01040000
010900     05  PS-INV-ID-FOUND-SW         PIC X(01)    VALUE 'N'.       01050000
011000         88  PS-INV-ID-FOUND-NO                  VALUE 'N'.       01060000
011100         88  PS-INV-ID-FOUND-YES                 VALUE 'Y'.       01070000
011200     05  PS-IIPM-LOADED-SW          PIC X(01)    VALUE 'N'.       01080000
011300         88  PS-IIPM-LOADED-NO                   VALUE 'N'.       01090000
011400         88  PS-IIPM-LOADED-YES                  VALUE 'Y'.       01100000
011500     05  PS-QUALIFIES-FOR-INVENTORY-SW                            01110000
011600                                    PIC X(01)    VALUE 'N'.       01120000
011700         88  PS-QUALIFIES-FOR-INVENTORY-NO       VALUE 'N'.       01130000
011800         88  PS-QUALIFIES-FOR-INVENTORY-YES      VALUE 'Y'.       01140000
011900                                                                  01150000
012000     05  PS-TINVPAR-DONE-SW         PIC X(01)    VALUE 'N'.       01160000
012100         88  PS-TINVPAR-DONE-NO                  VALUE 'N'.       01170000
012200         88  PS-TINVPAR-DONE-YES                 VALUE 'Y'.       01180000
012300                                                                  01190000
012400                                                                  01200000
012500* PT TINVPAR TABLE IS SUBSCRIPTED BY STORE NUMBER AND             01210000
012600* HOLDS A POINTER (SUBSCRIPT) INTO THE PT-INV-ID-TABLE            01220000
012700* THIS ASSOCIATES THE STORE TO THE INVENTORY CYCLE AND            01230000
012800* ITS TYPE.                                                       01240000
012900                                                                  01250000
013000 01  PT-TINVPAR-TABLE.                                            01260000
013100     05  PT-TINVPAR-TABLE-ELEMENTS   OCCURS 9990 TIMES.           01270000
013200         10  PT-INV-ID-SUB    PIC 9(03)  VALUE ZEROS.             01280000
013300                                                                  01290000
013400* THE PT-INT-INV-PARM-MDSE-TABLE TABLE HOLDS ALL OF THE           01300000
013500* DEPARTMENTS ASSOCIATED WITH ONE STORE. ORIGINALLY IT WAS        01310000
013600* INTENDED TO HOLD BOTH DEPARTMENT AND MAJOR CLASS CODE           01320000
013700* (HENCE THE SIZE OF 4000). TAKING INVENTORY AT THE MAJOR         01330000
013800* CLASS WITHIN A DEPARTMENT HAS BEEN REMOVED AS A REQUIREMENT     01340000
013900 01  PT-INT-INV-PARM-MDSE-TABLE.                                  01350000
014000     05  PT-PV-IIPM-OCC-CTR   PIC S9(04) VALUE ZEROS COMP-3.      01360000
014100     05  PT-IIPM-TABLE-ELEMENTS      OCCURS 4000 TIMES.           01370000
014200         10  PT-IIPM-DEPT-NBR PIC 9(04)  VALUE ZEROS.             01380000
014300                                                                  01390000
014400                                                                  01400000
014500* THE PT-INV-ID-TABLE IDENTIFIES EACH INVENTORY ID AND            01410000
014600* THE TYPE OF INVENTORY TO BE DONE (STORE WIDE OR DEPARTMENT)     01420000
014700                                                                  01430000
014800 01  PT-INV-ID-TABLE.                                             01440000
014900     05  PT-PV-INV-ID-OCC-CTR PIC S9(03) VALUE ZEROS COMP-3.      01450000
015000     05  PT-INV-ID-TABLE-ELEMENTS    OCCURS 99 TIMES.             01460000
015100         10  PT-INV-ID        PIC S9(09) VALUE ZEROS COMP.        01470000
015200         10  PT-INV-TYPE      PIC X(01)  VALUE SPACE.             01480000
015300         88  PT-INV-TYPE-STORE           VALUE 'S'.               01490000
015400         88  PT-INV-TYPE-DEPT            VALUE 'D'.               01500000
015500                                                                  01510000
015600                                                                  01520000
015700 01  ABEND-CODE                PIC S9(04)    VALUE +0 COMP SYNC.  01530000
015800     88  ABEND-4013-DB2-ERROR                VALUE +4013.         01540000
015900                                                                  01550000
016000                                                                  01560000
016100*************************************************************     01570000
016200*    COPYBOOK FOR INVENTORY EXTRACT FILE                          01580000
016300*************************************************************     01590000
016400     COPY INRD014.                                                01600000
016500                                                                  01610000
016600***************************************************************** 01620000
016700* TINCNTL DCLGEN                                                  01630000
016800***************************************************************** 01640000
016900     EXEC SQL                                                     01650000
017000         INCLUDE TINCNTL                                          01660000
017100     END-EXEC.                                                    01670000
017200                                                                  01680000
017300***************************************************************** 01690000
017400* TINVPAR DCLGEN                                                  01700000
017500***************************************************************** 01710000
017600     EXEC SQL                                                     01720000
017700         INCLUDE TINVPAR                                          01730000
017800     END-EXEC.                                                    01740000
017900                                                                  01750000
018000******************************************************************01760000
018100* TINVPAR CURSOR.                                                 01770000
018200******************************************************************01780000
018300     EXEC SQL                                                     01790000
018400       DECLARE TINVPAR_CURSOR CURSOR FOR                          01800000
018500         SELECT A.LOC_NBR,                                        01810000
018600                A.INV_ID                                          01820000
018700         FROM TINVPAR A                                           01830000
018800             ,TINCNTL B                                           01840000
018900              WHERE A.ACTL_FIN_BK_DTE = '9999-09-09'              01850000
019000                AND A.INV_ID = B.INV_ID                           01860000
019100                AND B.ACTV_IND = 'Y'                              01870000
W33304                AND A.LOC_INV_STAT_CDE = 'IN'                     01871001
019200         FOR FETCH ONLY                                           01880000
019300     END-EXEC.                                                    01890000
019400                                                                  01900000
019500***************************************************************** 01910000
019600* INT_INV_PARM_MDSE  INT00004                                     01920000
019700***************************************************************** 01930000
019800     EXEC SQL                                                     01940000
019900         INCLUDE INT00004                                         01950000
020000     END-EXEC.                                                    01960000
020100                                                                  01970000
020200     EXEC SQL                                                     01980000
020300       DECLARE INT00004_DEPT_CSR CURSOR FOR                       01990000
020400         SELECT DISTINCT A.DEPT_NBR                               02000000
020500         FROM INT_INV_PARM_MDSE A                                 02010000
020600              WHERE A.INV_ID  = :INT00004-INV-ID                  02020000
020700                AND A.LOC_NBR = :INT00004-LOC-NBR                 02030000
020800         FOR FETCH ONLY                                           02040000
020900     END-EXEC.                                                    02050000
021000*                                                                 02060000
021100***************************************************************** 02070000
021200                                                                  02080000
021300                                                                  02090000
021400***************************************************************** 02100000
021500* ERROR MESSAGE AREA FOR DB2                                      02110000
021600***************************************************************** 02120000
021700     COPY DPWS004.                                                02130000
021800                                                                  02140000
021900*************************************************************     02150000
022000*    DB2 COMMUNICATION AREA                                 *     02160000
022100*************************************************************     02170000
022200     EXEC SQL                                                     02180000
022300         INCLUDE SQLCA                                            02190000
022400     END-EXEC.                                                    02200000
022500                                                                  02210000
022600 PROCEDURE DIVISION.                                              02220000
022700                                                                  02230000
022800*************************************************************     02240000
022900* MAIN PROCESSING PARAGRAPH                                 *     02250000
023000*************************************************************     02260000
023100 1000-MAINLINE.                                                   02270000
023200                                                                  02280000
023300      PERFORM 2000-INITIALIZATION.                                02290000
023400                                                                  02300000
023500      PERFORM 3000-PROCESS-INPUT                                  02310000
023600         UNTIL PS-INPUT-AT-END-YES.                               02320000
023700                                                                  02330000
023800      PERFORM 4000-END-PROCESSING.                                02340000
023900                                                                  02350000
024000      STOP RUN.                                                   02360000
024100                                                                  02370000
024200***************************************************************   02380000
024300* OPEN FILES AND LOAD PT-STORE TABLE WITH INVENTORY INFO          02390000
024400***************************************************************   02400000
024500 2000-INITIALIZATION.                                             02410000
024600                                                                  02420000
024700      OPEN INPUT IN-SHORTAGE-EXT-FILE                             02430000
024800          OUTPUT OUT-SHORTAGE-EXT-FILE                            02440000
024900          OUTPUT OUT-SHORTAGE-FILTER-FILE.                        02450000
025000                                                                  02460000
025100                                                                  02470000
025200                                                                  02480000
025300*** LOAD THE TINVPAR TABLE....                                    02490000
025400     INITIALIZE PT-TINVPAR-TABLE.                                 02500000
025500     MOVE ZEROS             TO PV-STORE-SUB.                      02510000
025600     SET PS-TINVPAR-DONE-NO TO TRUE.                              02520000
025700     PERFORM 8200-OPEN-TINVPAR.                                   02530000
025800     PERFORM 8300-LOAD-TINVPAR-TABLE                              02540000
025900         UNTIL PS-TINVPAR-DONE-YES       OR                       02550000
026000               PV-STORE-SUB IS GREATER THAN PC-9990.              02560000
026100     PERFORM 8400-CLOSE-TINVPAR.                                  02570000
026200                                                                  02580000
026300***************************************************************   02590000
026400*     PROCESS INPUT                                           *   02600000
026500*     DETERMINE IF RECORD IS PART OF THE INVENTORY CYCLE      *   02610000
026600*     IF YES, WRITE IT OUT                                    *   02620000
026700***************************************************************   02630000
026800 3000-PROCESS-INPUT.                                              02640000
026900                                                                  02650000
027000     PERFORM 3100-READ-INPUT.                                     02660000
027100                                                                  02670000
027200     IF PS-INPUT-AT-END-NO                                        02680000
027300         SET PS-QUALIFIES-FOR-INVENTORY-NO                        02690000
027400                                 TO TRUE                          02700000
027500         MOVE IN014-STR-NBR      TO PV-HOLD-STORE-NBR             02710000
027600         MOVE IN014-DEPT-NBR     TO PV-HOLD-DEPT-NBR              02720000
027700         PERFORM 7000-CHECK-BY-INV-TYPE                           02730000
027800         PERFORM 3200-WRITE-OUTPUT-BY-TYPE                        02740000
027900     END-IF.                                                      02750000
028000                                                                  02760000
028100 3100-READ-INPUT.                                                 02770000
028200                                                                  02780000
028300     READ IN-SHORTAGE-EXT-FILE INTO IN014-SHORTAGE-EXTR-REC       02790000
028400         AT END                                                   02800000
028500            SET PS-INPUT-AT-END-YES TO TRUE.                      02810000
028600                                                                  02820000
028700     IF PS-INPUT-AT-END-NO                                        02830000
028800         ADD +1 TO PA-INPUT-RECORD-COUNT.                         02840000
028900                                                                  02850000
029000                                                                  02860000
029100 3200-WRITE-OUTPUT-BY-TYPE.                                       02870000
029200                                                                  02880000
029300     IF PS-QUALIFIES-FOR-INVENTORY-YES                            02890000
029400         WRITE OUT-SHORTAGE-EXT-RECORD                            02900000
029500                               FROM IN014-SHORTAGE-EXTR-REC       02910000
029600         ADD +1 TO PA-OUTPUT-VALID-COUNT                          02920000
029700     ELSE                                                         02930000
029800         WRITE OUT-SHORTAGE-FILTER-RECORD                         02940000
029900                               FROM IN014-SHORTAGE-EXTR-REC       02950000
030000         ADD +1 TO PA-OUTPUT-FILTER-COUNT                         02960000
030100     END-IF.                                                      02970000
030200                                                                  02980000
030300 4000-END-PROCESSING.                                             02990000
030400                                                                  03000000
030500     CLOSE IN-SHORTAGE-EXT-FILE                                   03010000
030600            OUT-SHORTAGE-EXT-FILE                                 03020000
030700            OUT-SHORTAGE-FILTER-FILE.                             03030000
030800                                                                  03040000
030900     DISPLAY '*** TOTAL NBR OF SHORTAGE RECS READ  '              03050000
031000          PA-INPUT-RECORD-COUNT.                                  03060000
031100     DISPLAY '*** TOTAL NBR OF VALID SHORTAGE RECS WRITTEN '      03070000
031200          PA-OUTPUT-VALID-COUNT.                                  03080000
031300     DISPLAY '*** TOTAL NBR OF FILTERED SHORTAGE RECS WRITTEN '   03090000
031400          PA-OUTPUT-FILTER-COUNT.                                 03100000
031500     DISPLAY ' '.                                                 03110000
031600     COMPUTE PA-WORK-RECORD-COUNT = PA-OUTPUT-VALID-COUNT         03120000
031700                                  + PA-OUTPUT-FILTER-COUNT.       03130000
031800                                                                  03140000
031900     IF PA-WORK-RECORD-COUNT = PA-INPUT-RECORD-COUNT              03150000
032000           DISPLAY ' JOB IN BALANCE '                             03160000
032100     ELSE                                                         03170000
032200           DISPLAY ' JOB OUT OF BALANCE '.                        03180000
032300                                                                  03190000
032400******************************************************************03200000
032500*7000-CHECK-BY-INV-TYPE.                                          03210000
032600* THE 7000 SERIES LOGIC WILL DETERMINE IF THE INVENTORY IS BEING  03220000
032700* DONE FOR THE WHOLE STORE OR SPECIFIC DEPARTMENTS IN ONE OR MORE 03230000
032800* STORES. FOR A STORE WIDE INVENTORY, ALL RECORDS ARE INCLUDED.   03240000
032900* FOR A DEPARTMENT INVENTORY, ONLY THOSE RECORDS IN THE THE       03250000
033000* DEPARTMENT(S) WILL BE INCLUDED.                                 03260000
033100* THE INFORMATION FOR THIS DECISION IS CARRIED IN THE             03270000
033200* INT_INV_PARM_MDSE TABLE. THIS INFORMATION WILL BE               03280000
033300* LOADED INTO MEMORY ONCE PER STORE.                              03290000
033400******************************************************************03300000
033500                                                                  03310000
033600 7000-CHECK-BY-INV-TYPE.                                          03320000
033700                                                                  03330000
033800     MOVE PT-INV-ID-SUB (PV-HOLD-STORE-NBR)                       03340000
033900                            TO PV-II-TBL-SUB.                     03350000
034000                                                                  03360000
034100     IF PT-INV-ID-SUB (PV-HOLD-STORE-NBR) = ZEROS                 03370000
034200         CONTINUE                                                 03380000
034300     ELSE                                                         03390000
034400         IF PT-INV-TYPE-STORE (PV-II-TBL-SUB)                     03400000
034500             SET PS-QUALIFIES-FOR-INVENTORY-YES TO TRUE           03410000
034600             MOVE PV-HOLD-STORE-NBR TO PV-PREV-STORE-NBR          03420000
034700     ELSE                                                         03430000
034800         PERFORM 7005-CHECK-BY-DEPT                               03440000
034900     END-IF.                                                      03450000
035000                                                                  03460000
035100                                                                  03470000
035200 7005-CHECK-BY-DEPT.                                              03480000
035300                                                                  03490000
035400* WHEN STORE NUMBERS ARE NOT EQUAL, A NEW STORE IS BEING          03500000
035500* PROCESSED AND THE DEPT DATA MUST BE LOADED INTO WS FROM DB2     03510000
035600                                                                  03520000
035700     IF PV-HOLD-STORE-NBR NOT EQUAL PV-PREV-STORE-NBR             03530000
035800         MOVE ZEROS TO PV-STORE-XXXX-COUNT                        03540000
035900         PERFORM 7010-COUNT-STORE-SPECIFIC                        03550000
036000             IF PV-STORE-XXXX-COUNT > ZEROS                       03560000
036100                 PERFORM 7025-LOAD-STORE-SPECIFIC                 03570000
036200             ELSE                                                 03580000
036300                 PERFORM 7075-LOAD-DEFAULTS                       03590000
036400             END-IF                                               03600000
036500         MOVE PV-HOLD-STORE-NBR TO PV-PREV-STORE-NBR              03610000
036600     END-IF.                                                      03620000
036700                                                                  03630000
036800     PERFORM                                                      03640000
036900         VARYING PV-IIPM-TBL-SUB FROM 1 BY 1                      03650000
037000         UNTIL   PV-IIPM-TBL-SUB > PT-PV-IIPM-OCC-CTR OR          03660000
037100                 PS-QUALIFIES-FOR-INVENTORY-YES                   03670000
037200                                                                  03680000
037300             IF PV-HOLD-DEPT-NBR = PT-IIPM-DEPT-NBR               03690000
037400                                           (PV-IIPM-TBL-SUB)      03700000
037500                 SET PS-QUALIFIES-FOR-INVENTORY-YES TO TRUE       03710000
037600             END-IF                                               03720000
037700     END-PERFORM.                                                 03730000
037800                                                                  03740000
037900                                                                  03750000
038000 7010-COUNT-STORE-SPECIFIC.                                       03760000
038100                                                                  03770000
038200     MOVE PT-INV-ID (PV-II-TBL-SUB) TO INT00004-INV-ID.           03780000
038300     MOVE PV-HOLD-STORE-NBR         TO INT00004-LOC-NBR.          03790000
038400                                                                  03800000
038500     EXEC SQL                                                     03810000
038600         SELECT COUNT (DISTINCT DEPT_NBR)                         03820000
038700              INTO :PV-STORE-XXXX-COUNT                           03830000
038800              FROM INT_INV_PARM_MDSE                              03840000
038900              WHERE INV_ID   = :INT00004-INV-ID                   03850000
039000                AND LOC_NBR  = :INT00004-LOC-NBR                  03860000
039100     END-EXEC.                                                    03870000
039200                                                                  03880000
039300     EVALUATE TRUE                                                03890000
039400         WHEN SQLCODE = ZERO                                      03900000
039500         WHEN SQLCODE = +100                                      03910000
039600             CONTINUE                                             03920000
039700         WHEN SQLWARN IS NOT EQUAL TO SPACES                      03930000
039800         WHEN SQLCODE IS NOT EQUAL TO ZERO                        03940000
039900         MOVE '7010-COUNT-STORE-SPECIFIC' TO PV-PARAGRAPH-NAME    03950000
040000         MOVE 'COUNT     '        TO PV-DB2-OPER-ATTEMPTED        03960000
040100         PERFORM 9000-SQL-ABEND                                   03970000
040200     END-EVALUATE.                                                03980000
040300                                                                  03990000
040400                                                                  04000000
040500 7025-LOAD-STORE-SPECIFIC.                                        04010000
040600                                                                  04020000
040700     INITIALIZE PT-INT-INV-PARM-MDSE-TABLE.                       04030000
040800                                                                  04040000
040900     PERFORM 7100-OPEN-CUR.                                       04050000
041000                                                                  04060000
041100     SET PS-IIPM-LOADED-NO TO TRUE.                               04070000
041200                                                                  04080000
041300     PERFORM 7130-LOAD-ENTRIES                                    04090000
041400         UNTIL PS-IIPM-LOADED-YES.                                04100000
041500                                                                  04110000
041600     PERFORM 7110-CLOSE-CUR.                                      04120000
041700                                                                  04130000
041800                                                                  04140000
041900 7075-LOAD-DEFAULTS.                                              04150000
042000                                                                  04160000
042100     MOVE PT-INV-ID (PV-II-TBL-SUB) TO INT00004-INV-ID.           04170000
042200     MOVE ZEROS                     TO INT00004-LOC-NBR.          04180000
042300                                                                  04190000
042400     INITIALIZE PT-INT-INV-PARM-MDSE-TABLE.                       04200000
042500                                                                  04210000
042600     PERFORM 7100-OPEN-CUR.                                       04220000
042700                                                                  04230000
042800     SET PS-IIPM-LOADED-NO TO TRUE.                               04240000
042900                                                                  04250000
043000     PERFORM 7130-LOAD-ENTRIES                                    04260000
043100         UNTIL PS-IIPM-LOADED-YES.                                04270000
043200                                                                  04280000
043300     PERFORM 7110-CLOSE-CUR.                                      04290000
043400                                                                  04300000
043500                                                                  04310000
043600 7100-OPEN-CUR.                                                   04320000
043700*                                                                 04330000
043800     EXEC SQL                                                     04340000
043900         OPEN INT00004_DEPT_CSR                                   04350000
044000     END-EXEC.                                                    04360000
044100                                                                  04370000
044200     EVALUATE TRUE                                                04380000
044300       WHEN SQLCODE IS EQUAL TO ZERO                              04390000
044400         CONTINUE                                                 04400000
044500       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04410000
044600       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04420000
044700        MOVE '7100-OPEN-CUR    ' TO PV-PARAGRAPH-NAME             04430000
044800        MOVE 'OPEN CURSOR'       TO PV-DB2-OPER-ATTEMPTED         04440000
044900        PERFORM 9000-SQL-ABEND                                    04450000
045000     END-EVALUATE.                                                04460000
045100                                                                  04470000
045200                                                                  04480000
045300 7110-CLOSE-CUR.                                                  04490000
045400*                                                                 04500000
045500     EXEC SQL                                                     04510000
045600         CLOSE INT00004_DEPT_CSR                                  04520000
045700     END-EXEC.                                                    04530000
045800*                                                                 04540000
045900     EVALUATE TRUE                                                04550000
046000       WHEN SQLCODE IS EQUAL TO ZERO                              04560000
046100         CONTINUE                                                 04570000
046200       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04580000
046300       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04590000
046400        MOVE '7110-CLOSE-CUR    ' TO PV-PARAGRAPH-NAME            04600000
046500        MOVE 'CLOSE CURSOR'       TO PV-DB2-OPER-ATTEMPTED        04610000
046600        PERFORM 9000-SQL-ABEND                                    04620000
046700     END-EVALUATE.                                                04630000
046800                                                                  04640000
046900 7130-LOAD-ENTRIES.                                               04650000
047000                                                                  04660000
047100     PERFORM 7140-FETCH-INT-INV-CUR.                              04670000
047200                                                                  04680000
047300     IF PS-IIPM-LOADED-NO                                         04690000
047400         PERFORM 7145-LOAD-IIPM-TO-TBL.                           04700000
047500                                                                  04710000
047600                                                                  04720000
047700 7140-FETCH-INT-INV-CUR.                                          04730000
047800*                                                                 04740000
047900     EXEC SQL                                                     04750000
048000         FETCH INT00004_DEPT_CSR                                  04760000
048100         INTO :INT00004-DEPT-NBR,                                 04770000
048200              :INT00004-MAJ-CL-NBR                                04780000
048300     END-EXEC.                                                    04790000
048400     EVALUATE TRUE                                                04800000
048500       WHEN SQLCODE IS EQUAL TO ZERO                              04810000
048600           CONTINUE                                               04820000
048700       WHEN SQLCODE IS EQUAL TO +100                              04830000
048800         SET  PS-IIPM-LOADED-YES TO TRUE                          04840000
048900       WHEN SQLWARN IS NOT EQUAL TO SPACES                        04850000
049000       WHEN SQLCODE IS NOT EQUAL TO ZERO                          04860000
049100         MOVE '7140-FETCH-INT-INV-CUR' TO PV-PARAGRAPH-NAME       04870000
049200         MOVE 'LOAD TABLE'        TO PV-DB2-OPER-ATTEMPTED        04880000
049300         PERFORM 9000-SQL-ABEND                                   04890000
049400     END-EVALUATE.                                                04900000
049500                                                                  04910000
049600                                                                  04920000
049700 7145-LOAD-IIPM-TO-TBL.                                           04930000
049800                                                                  04940000
049900     ADD 1 TO PT-PV-IIPM-OCC-CTR.                                 04950000
050000                                                                  04960000
050100     IF PT-PV-IIPM-OCC-CTR > PC-FOUR-THOUSAND                     04970000
050200         MOVE '7145-LOAD-IIPM-TO-TBL      '                       04980000
050300                                  TO PV-PARAGRAPH-NAME            04990000
050400         MOVE 'MAX ENTRIES EXCEEDED'  TO PV-DB2-OPER-ATTEMPTED    05000000
050500         DISPLAY 'WS-INT-INV-PARM-MDSE-TABLE '                    05010000
050600         DISPLAY 'PT-PV-IIPM-OCC-CTR > PC-FOUR-THOUSAND '         05020000
050700                                       PT-PV-IIPM-OCC-CTR         05030000
050800         DISPLAY 'INV STORE: ', IN014-STR-NBR                     05040000
050900         PERFORM 9000-SQL-ABEND                                   05050000
051000     ELSE                                                         05060000
051100         MOVE INT00004-DEPT-NBR TO PT-IIPM-DEPT-NBR               05070000
051200                                    (PT-PV-IIPM-OCC-CTR)          05080000
051300     END-IF.                                                      05090000
051400                                                                  05100000
051500                                                                  05110000
051600                                                                  05120000
051700***************************************************************** 05130000
051800* 8200-OPEN-TINVPAR.                                              05140000
051900***************************************************************** 05150000
052000 8200-OPEN-TINVPAR.                                               05160000
052100*                                                                 05170000
052200     EXEC SQL                                                     05180000
052300         OPEN TINVPAR_CURSOR                                      05190000
052400     END-EXEC.                                                    05200000
052500                                                                  05210000
052600     EVALUATE TRUE                                                05220000
052700       WHEN SQLCODE IS EQUAL TO ZERO                              05230000
052800         CONTINUE                                                 05240000
052900       WHEN SQLWARN IS NOT EQUAL TO SPACES                        05250000
053000       WHEN SQLCODE IS NOT EQUAL TO ZERO                          05260000
053100        MOVE '8200-OPEN-TINVPAR' TO PV-PARAGRAPH-NAME             05270000
053200        MOVE 'OPEN CURSOR'       TO PV-DB2-OPER-ATTEMPTED         05280000
053300        SET PS-TINVPAR-DONE-YES  TO TRUE                          05290000
053400        PERFORM 9000-SQL-ABEND                                    05300000
053500     END-EVALUATE.                                                05310000
053600*                                                                 05320000
053700***************************************************************** 05330000
053800* 8300-LOAD-TINVPAR-TABLE.                                        05340000
053900***************************************************************** 05350000
054000 8300-LOAD-TINVPAR-TABLE.                                         05360000
054100*                                                                 05370000
054200     EXEC SQL                                                     05380000
054300         FETCH TINVPAR_CURSOR                                     05390000
054400         INTO :INVPAR-LOC-NBR,                                    05400000
054500              :INVPAR-INV-ID                                      05410000
054600     END-EXEC.                                                    05420000
054700                                                                  05430000
054800     EVALUATE TRUE                                                05440000
054900       WHEN SQLCODE IS EQUAL TO ZERO                              05450000
055000         MOVE INVPAR-LOC-NBR      TO PV-STORE-SUB                 05460000
055100         PERFORM 8325-LOAD-INV-ID-TABLE                           05470000
055200       WHEN SQLCODE IS EQUAL TO +100                              05480000
055300         SET PS-TINVPAR-DONE-YES  TO TRUE                         05490000
055400       WHEN SQLWARN IS NOT EQUAL TO SPACES                        05500000
055500       WHEN SQLCODE IS NOT EQUAL TO ZERO                          05510000
055600         MOVE '8300-LOAD-TINVPAR-TABLE' TO PV-PARAGRAPH-NAME      05520000
055700         MOVE 'LOAD TABLE'        TO PV-DB2-OPER-ATTEMPTED        05530000
055800         SET PS-TINVPAR-DONE-YES  TO TRUE                         05540000
055900         PERFORM 9000-SQL-ABEND                                   05550000
056000     END-EVALUATE.                                                05560000
056100                                                                  05570000
056200                                                                  05580000
056300 8325-LOAD-INV-ID-TABLE.                                          05590000
056400                                                                  05600000
056500     SET PS-INV-ID-FOUND-NO TO TRUE.                              05610000
056600                                                                  05620000
056700     PERFORM                                                      05630000
056800        VARYING PV-II-TBL-SUB FROM 1 BY 1                         05640000
056900        UNTIL   PV-II-TBL-SUB > PT-PV-INV-ID-OCC-CTR OR           05650000
057000                PS-INV-ID-FOUND-YES                               05660000
057100            IF INVPAR-INV-ID = PT-INV-ID (PV-II-TBL-SUB)          05670000
057200                MOVE PV-II-TBL-SUB TO PT-INV-ID-SUB               05680000
057300                                        (PV-STORE-SUB)            05690000
057400                SET PS-INV-ID-FOUND-YES TO TRUE                   05700000
057500            END-IF                                                05710000
057600     END-PERFORM.                                                 05720000
057700                                                                  05730000
057800     IF PS-INV-ID-FOUND-NO                                        05740000
057900         ADD 1 TO PT-PV-INV-ID-OCC-CTR                            05750000
058000         IF PT-PV-INV-ID-OCC-CTR > PC-NINETY-NINE                 05760000
058100             PERFORM 8330-OUT-OF-ROOM                             05770000
058200         ELSE                                                     05780000
058300             MOVE INVPAR-INV-ID    TO PT-INV-ID                   05790000
058400                                        (PT-PV-INV-ID-OCC-CTR)    05800000
058500             MOVE PT-PV-INV-ID-OCC-CTR TO PT-INV-ID-SUB           05810000
058600                                        (PV-STORE-SUB)            05820000
058700             PERFORM 8335-COUNT-DEFAULT-ROWS                      05830000
058800         END-IF                                                   05840000
058900     END-IF.                                                      05850000
059000                                                                  05860000
059100 8330-OUT-OF-ROOM.                                                05870000
059200                                                                  05880000
059300     MOVE '8330-OUT-OF-ROOM           '                           05890000
059400                                  TO PV-PARAGRAPH-NAME.           05900000
059500     MOVE 'MAX ENTRIES EXCEEDED'  TO PV-DB2-OPER-ATTEMPTED.       05910000
059600     DISPLAY 'WS-INV-ID-TABLE EXCEEDED '.                         05920000
059700     DISPLAY 'PT-PV-INV-ID-OCC-CTR > PC-NINETY-NINE '             05930000
059800                                       PT-PV-INV-ID-OCC-CTR.      05940000
059900     DISPLAY 'INV STORE: ', IN014-STR-NBR.                        05950000
060000     PERFORM 9000-SQL-ABEND.                                      05960000
060100                                                                  05970000
060200                                                                  05980000
060300 8335-COUNT-DEFAULT-ROWS.                                         05990000
060400     MOVE INVPAR-INV-ID TO INT00004-INV-ID.                       06000000
060500     MOVE ZEROS         TO INT00004-LOC-NBR                       06010000
060600                           PV-STORE-0000-COUNT.                   06020000
060700                                                                  06030000
060800     EXEC SQL                                                     06040000
060900         SELECT COUNT (DISTINCT DEPT_NBR)                         06050000
061000              INTO :PV-STORE-0000-COUNT                           06060000
061100              FROM INT_INV_PARM_MDSE                              06070000
061200              WHERE INV_ID   = :INT00004-INV-ID                   06080000
061300                AND LOC_NBR  = :INT00004-LOC-NBR                  06090000
061400     END-EXEC.                                                    06100000
061500                                                                  06110000
061600     EVALUATE TRUE                                                06120000
061700         WHEN SQLCODE = ZERO                                      06130000
061800         WHEN SQLCODE = +100                                      06140000
061900             PERFORM 8340-SET-INV-TYPE                            06150000
062000         WHEN SQLWARN IS NOT EQUAL TO SPACES                      06160000
062100         WHEN SQLCODE IS NOT EQUAL TO ZERO                        06170000
062200         MOVE '8335-COUNT-DEFAULT-ROWS' TO PV-PARAGRAPH-NAME      06180000
062300         MOVE 'COUNT     '        TO PV-DB2-OPER-ATTEMPTED        06190000
062400         PERFORM 9000-SQL-ABEND                                   06200000
062500     END-EVALUATE.                                                06210000
062600                                                                  06220000
062700 8340-SET-INV-TYPE.                                               06230000
062800                                                                  06240000
062900     IF PV-STORE-0000-COUNT = ZEROS                               06250000
063000         SET PT-INV-TYPE-STORE (PT-PV-INV-ID-OCC-CTR) TO TRUE     06260000
063100     ELSE                                                         06270000
063200         SET PT-INV-TYPE-DEPT  (PT-PV-INV-ID-OCC-CTR) TO TRUE     06280000
063300     END-IF.                                                      06290000
063400                                                                  06300000
063500*                                                                 06310000
063600***************************************************************** 06320000
063700* 8400-CLOSE-TINVPAR.                                             06330000
063800***************************************************************** 06340000
063900 8400-CLOSE-TINVPAR.                                              06350000
064000*                                                                 06360000
064100     EXEC SQL                                                     06370000
064200         CLOSE TINVPAR_CURSOR                                     06380000
064300     END-EXEC.                                                    06390000
064400*                                                                 06400000
064500     EVALUATE TRUE                                                06410000
064600       WHEN SQLCODE IS EQUAL TO ZERO                              06420000
064700         CONTINUE                                                 06430000
064800       WHEN SQLWARN IS NOT EQUAL TO SPACES                        06440000
064900       WHEN SQLCODE IS NOT EQUAL TO ZERO                          06450000
065000        MOVE '8400-CLOSE-TINVPAR' TO PV-PARAGRAPH-NAME            06460000
065100        MOVE 'CLOSE CURSOR'       TO PV-DB2-OPER-ATTEMPTED        06470000
065200        SET PS-TINVPAR-DONE-YES   TO TRUE                         06480000
065300        PERFORM 9000-SQL-ABEND                                    06490000
065400     END-EVALUATE.                                                06500000
065500*                                                                 06510000
065600                                                                  06520000
065700***************************************************************   06530000
065800*    SQL ABEND PROCESSING                                     *   06540000
065900***************************************************************   06550000
066000 9000-SQL-ABEND.                                                  06560000
066100                                                                  06570000
066200     DISPLAY '** ABEND     **'.                                   06580000
066300     DISPLAY '** PROGRAM   = ' PC-PROGRAM-ID.                     06590000
066400     DISPLAY '** PARAGRAPH = ' PV-PARAGRAPH-NAME.                 06600000
066500     DISPLAY '** OPERATION = ' PV-DB2-OPER-ATTEMPTED.             06610000
066600                                                                  06620000
066700     COPY DPPD004.                                                06630000
066800                                                                  06640000
066900     CALL 'ILBOABN0'  USING ABEND-CODE.                           06650000
067000                                                                  06660000
