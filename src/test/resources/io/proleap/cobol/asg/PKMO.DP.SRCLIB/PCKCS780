000400 IDENTIFICATION DIVISION.                                         00040001
000500 PROGRAM-ID.    PCKCS780.                                         00050001
000600 AUTHOR.        GERMAN BANDA.                                     00060001
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070001
000800 DATE-WRITTEN.  APRIL 2004.                                       00080001
000900 DATE-COMPILED.                                                   00090001
001000******************************************************************00100001
001100******************************************************************00110001
001200*    TRANSACTION - E780   COMMAREA - RCWS289 COPYBOOK            *00120001
001210*    NOTE:  THERE IS A TRAN ID FOR EACH DC FOR THIS PROGRAM.     *00121001
001220*           CHECK PARM AVPBST FOR VALUES FOR EACH DC.            *00122001
001300**                                                               *00130001
001400*    STARTED BY PCKCS200.                                        *00140001
001500*                                                                *00150001
001600*  PCKCS780 THIS IS A NON-TERMINALLY ATTACHED PROGRAM THAT       *00160001
001700*  WILL BE USED TO VERIFY PACK BY STORE ORDERS.                   00170001
001800*                                                                 00180001
001900*                                                                *00190001
002000* TABLES:  TDISTHD  -  TRANSACTION HEADER TABLE                  *00200001
002100*          TRECDIS  -  RECEIPT ITEM DISTRIBUTION TABLE           *00210001
002200*          TRECITM  -  RECEIPT ITEM TABLE                        *00220001
002300*          TRECEIV  -  RECEIVER TABLE                            *00230001
002400*          TPURCHS  -  PURCHASE ORDER TABLE                      *00240001
002500*          TPURITM  -  PURCHASE ORDER ITEM TABLE                 *00250001
002700*                                                                *00270001
002800******************************************************************00280001
002900*                                                                 00290001
003000 ENVIRONMENT DIVISION.                                            00300001
003100*                                                                 00310001
003200 CONFIGURATION SECTION.                                           00320001
003300*                                                                 00330001
003400 SOURCE-COMPUTER.        IBM-3090.                                00340001
003500 OBJECT-COMPUTER.        IBM-3090.                                00350001
003600*                                                                 00360001
003700******************************************************************00370001
003800 DATA DIVISION.                                                   00380001
003900******************************************************************00390001
004000*                                                                 00400001
004100******************************************************************00410001
004200 WORKING-STORAGE SECTION.                                         00420001
004300******************************************************************00430001
004400                                                                  00440001
004500 01  DK-DB2-KEYS.                                                 00450001
004600     05  DK-ORD-NBR              PIC S9(9) VALUE ZERO COMP SYNC.  00460001
004700     05  DK-REC-SEQ-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00470001
004800     05  DK-ORD-LNE-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00480001
004900                                                                  00490001
005000******************************************************************00500001
005100* PS PROGRAM SWITCHES                                            *00510001
005200******************************************************************00520001
005300 01  PS-PROGRAM-SWITCHES.                                         00530001
005400     05  PS-AUTO-VE-SW                  PIC  X(01)  VALUE 'Y'.    00540001
005500         88  PS-AUTO-VE-YES                         VALUE 'Y'.    00550001
005600         88  PS-AUTO-VE-NO                          VALUE 'N'.    00560001
005700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00570001
005800         88  PS-NO-ERROR                            VALUE 'Y'.    00580001
005900         88  PS-ERROR                               VALUE 'N'.    00590001
006000     05  PS-DATA-OK-SW                  PIC  X(01)  VALUE 'Y'.    00600001
006100         88  PS-DATA-OK                             VALUE 'Y'.    00610001
006200         88  PS-DATA-NOT-OK                         VALUE 'N'.    00620001
006300     05  PS-UPDATE-SW                   PIC  X(01)   VALUE 'N'.   00630001
006400         88  PS-NO-UPDATES-DONE                      VALUE 'N'.   00640001
006500         88  PS-UPDATES-DONE                         VALUE 'Y'.   00650001
006600     05  PS-INV-ERR-SW                  PIC  X(01)   VALUE 'N'.   00660001
006700         88  PS-NO-INV-ERR                           VALUE 'N'.   00670001
006800         88  PS-INV-ERR                              VALUE 'Y'.   00680001
006900     05  PS-INV-CYC-SW                  PIC  X(01)   VALUE 'N'.   00690001
007000         88  PS-INV-CYC-NOT-FOUND                    VALUE 'N'.   00700001
007100         88  PS-INV-CYC-FOUND                        VALUE 'Y'.   00710001
007200     05  PS-DATA-ON-TDISTHD-SW           PIC X(01)   VALUE 'Y'.   00720001
007300         88  PS-DATA-LEFT-ON-TDISTHD                 VALUE 'Y'.   00730001
007400         88  PS-NO-DATA-LEFT-ON-TDISTHD              VALUE 'N'.   00740001
007500     05  PS-DATA-LEFT-TO-PROCESS-IND     PIC X(01)   VALUE 'Y'.   00750001
007600         88  PS-DATA-LEFT-TO-PROCESS                 VALUE 'Y'.   00760001
007700         88  PS-NO-DATA-LEFT-TO-PROCESS              VALUE 'N'.   00770001
007800     05  PS-TRANSACTION-HEADER-SWITCH    PIC X(01)   VALUE 'Y'.   00780001
007900         88  PS-NO-R-RECORD                          VALUE 'N'.   00790001
008000         88  PS-HEADER-RECORD-OK                     VALUE 'Y'.   00800001
008100     05  PS-END-OF-VRFY-ITM-CSR-SW  PIC  X(01)  VALUE 'N'.        00810001
008200         88  PS-END-OF-VRFY-ITM-CSR             VALUE 'Y'.        00820001
008300         88  PS-NOT-END-OF-VRFY-ITM-CSR         VALUE 'N'.        00830001
008400     05  PS-FIRST-VRFY-ITM-FETCH-SW PIC  X(01)  VALUE 'N'.        00840001
008500         88  PS-FIRST-VRFY-ITM-FETCH            VALUE 'Y'.        00850001
008600         88  PS-NOT-FIRST-VRFY-ITM-FETCH        VALUE 'N'.        00860001
008700******************************************************************00870001
008800* COMMAREA PASSED TO THE PROGRAM FROM PCKS107 AND RCKCS291       *00880001
008900******************************************************************00890001
009000                                                                  00900001
009100     COPY RCWS289.                                                00910001
009200                                                                  00920001
009300***************************************************************** 00930001
009400*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 00940001
009500*             AUTOVERIFY (AUTOVE) ELIGIBILITY MODULE (RCKUT127).* 00950001
009600***************************************************************** 00960001
009700     COPY RCWS040.                                                00970001
009800                                                                  00980001
009900***************************************************************** 00990001
010000*   RCWS040 - COPYBOOK IS USED FOR THE MODULE TO CALCULATE UNIT * 01000001
010100*             QUANTITIES AND CARTON COUNTS (RCKUT128)          .* 01010001
010200***************************************************************** 01020001
010300     COPY RCWS074.                                                01030001
010400                                                                  01040001
010500***************************************************************** 01050001
010600*   RCWS071 - COPYBOOK IS USED FOR THE MODULE TO TRACK DC ASSOC * 01060001
010700*             FUNCTIONS                                        .* 01070001
010800***************************************************************** 01080001
010900     COPY RCWS071.                                                01090001
011000                                                                  01100001
011100*---------------------------------------------------------------* 01110001
011200*  RECORD LAYOUTS FOR THE FREE ASTRAY HANDLER MODULE              01120001
011300*---------------------------------------------------------------* 01130001
011400     COPY SUWS044.                                                01140001
011500                                                                  01150001
011600******************************************************************01160001
011700* PV PROGRAM VARIABLES                                           *01170001
011800******************************************************************01180001
011900 01  PV-PROGRAM-VARIABLES.                                        01190001
012000     05  PV-RETRY-COUNTER                PIC S9(4) VALUE ZERO     01200001
012100                                                    COMP SYNC.    01210001
012200     05  PV-AUDIT-RTN-LENGTH             PIC S9(04) VALUE ZERO    01220001
012300                                                    COMP SYNC.    01230001
012400     05  PV-PRT-LST-TRANID               PIC  X(04)  VALUE '    '.01240001
012500     05  PV-PRT-ERROR-TRANID             PIC  X(04)  VALUE '    '.01250001
012600     05  PV-CURRENT-TMST                 PIC X(26).               01260001
012700     05  PV-CURR-DATE                    PIC  X(10)  VALUE ZEROS. 01270001
012800     05  PV-CURRENT-DATE                 PIC  X(10)  VALUE ZEROS. 01280001
012900     05  FILLER   REDEFINES PV-CURRENT-DATE.                      01290001
013000         10  PV-CURRENT-CC               PIC  X(02).              01300001
013100         10  PV-CURRENT-YY               PIC  X(02).              01310001
013200         10  FILLER                      PIC  X(01).              01320001
013300         10  PV-CURRENT-MM               PIC  X(02).              01330001
013400         10  FILLER                      PIC  X(01).              01340001
013500         10  PV-CURRENT-DD               PIC  X(02).              01350001
013600     05  PV-HOLD-CURR-DATE.                                       01360001
013700         10  PV-HOLD-CURR-CC             PIC  9(02).              01370001
013800         10  PV-HOLD-CURR-YY             PIC  9(02).              01380001
013900         10  PV-HOLD-CURR-MM             PIC  9(02).              01390001
014000         10  PV-HOLD-CURR-DD             PIC  9(02).              01400001
014100*                                                                 01410001
014200     05  PV-TOTAL-ACTL-LINE-QTY          PIC S9(09)  COMP         01420001
014300                                                     VALUE +0.    01430001
014400     05  PV-PREV-ORD-LNE-NBR             PIC S9(9) COMP.          01440001
014500     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01450001
014600                                                     COMP SYNC.   01460001
014700     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +12    01470001
014800                                                     COMP SYNC.   01480001
014900     05  PV-WRK-ORD-SEQ-NBR              PIC  S9(4)  COMP         01490001
015000                                                     VALUE ZEROS. 01500001
015100     05  PV-FCLTY-ID                     PIC  S9(4)  COMP         01510001
015200                                                     VALUE +1.    01520001
015300     05  PV-CLENG                        PIC   9(4)  COMP         01530001
015400                                                     VALUE ZEROS. 01540001
015500     05  PV-TOTAL-ALLOC-QTY              PIC  S9(9)  COMP         01550001
015600                                                     VALUE ZEROS. 01560001
015700     05  PV-TOTAL-ALLOC-QTY-ALL          PIC  S9(9)  COMP         01570001
015800                                                     VALUE ZEROS. 01580001
015900     05  PV-TASK-X.                                               01590001
016000         10  PV-TASK                     PIC   9(7)  VALUE ZERO.  01600001
016100     05  PV-STATUS-CDE                   PIC   X(02)              01610001
016200                                                     VALUE SPACES.01620001
016300     05  PV-AUDIT-STATUS-CDE             PIC   X(02)              01630001
016400                                                     VALUE SPACES.01640001
016500     05  PV-COUNT-STATUS-CDE             PIC   X(02)              01650001
016600                                                     VALUE SPACES.01660001
016700     05  PV-RCPT-DISTR-UPD-CDE           PIC   X(01)              01670001
016800                                                     VALUE SPACES.01680001
016900     05  PV-PREV-DISTR-UPD-CDE           PIC   X(01)              01690001
017000                                                     VALUE SPACES.01700001
017100     05  PV-VRFD-USR-ID                  PIC   X(08)              01710001
017200                                                     VALUE SPACES.01720001
017300     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACES.01730001
017400     05  PV-CICS-MSG-AREA                PIC  X(95)  VALUE SPACE. 01740001
017500                                                                  01750001
017600     05  PV-ORD-NBR-DISPLAY              PIC  9(08)  VALUE ZEROES.01760001
017700     05  PV-REC-SEQ-NBR-DISPLAY          PIC  9(04)  VALUE ZEROES.01770001
017800     05  PV-ORD-LNE-NBR-DISPLAY          PIC  9(04)  VALUE ZEROES.01780001
017900     05  PV-OPER-UNT-ID-DISPLAY          PIC  9(04)  VALUE ZEROES.01790001
018000     05  PV-STORE-NBR-DISPLAY            PIC  9(04)  VALUE ZEROES.01800001
018100     05  PV-FCLTY-ID-DISPLAY             PIC  9(04)  VALUE ZEROES.01810001
018200     05  PV-ID-NBR-DISPLAY               PIC  X(04)  VALUE SPACES.01820001
018300     05  PV-DEPT-NBR-PIC9                PIC  9(03)  VALUE ZEROES.01830001
018400                                                                  01840001
018500     05  PV-NULL-IND                     PIC S9(04)  VALUE +0     01850001
018600                                                     COMP SYNC.   01860001
018700     05  PV-ERROR-ORD-NBR                PIC  9(08)  VALUE ZEROS. 01870001
018800     05  PV-ERROR-RCVR-SEQ-NBR           PIC  9(04)  VALUE ZEROS. 01880001
018900     05  PV-ERROR-ORD-LNE-NBR            PIC  9(04)  VALUE ZEROS. 01890001
019000     05  PV-ERROR-STR-NBR                PIC  9(04)  VALUE ZEROS. 01900001
019100     05  PV-ERROR-OPER-UNT-ID            PIC  9(04)  VALUE ZEROS. 01910001
019200     05  PV-ERROR-STATUS                 PIC  X(01)  VALUE SPACE. 01920001
019300     05  PV-ERROR-SOURCE                 PIC  X(02)  VALUE SPACE. 01930001
019400                                                                  01940001
019500                                                                  01950001
019600 01  ST-SYSTEM-TIME-AREA.                                         01960001
019700     05  ST-ABSTIME                      PIC S9(16)  VALUE +0     01970001
019800                                                     COMP SYNC.   01980001
019900     05  ST-TIME-EDIT.                                            01990001
020000         10  ST-TIME-HHMM                PIC  X(05)  VALUE SPACE. 02000001
020100         10  FILLER                      PIC  X(03)  VALUE SPACE. 02010001
020200                                                                  02020001
020300******************************************************************02030001
020400* PC PROGRAM CONSTANTS                                           *02040001
020500******************************************************************02050001
020600 01  PC-PROGRAM-CONSTANTS.                                        02060001
020700     05  PC-FA-HANDLER-PGM          PIC  X(08)  VALUE 'SUKUT705'. 02070001
020800     05  PC-ZERO                      PIC S9(09) VALUE ZERO       02080001
020900                                                    COMP.         02090001
021000     05  PV-DB2-COUNT                 PIC S9(9)  VALUE +0         02100001
021100                                                    COMP-3.       02110001
021200     05  PV-COUNT-DISPLAY             PIC  9(9)  VALUE ZERO.      02120001
021300     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +1        02130001
021400                                                    COMP.         02140001
021500     05  PC-ROW-ALREADY-PRESENT       PIC S9(04) VALUE -803       02150001
021600                                                    COMP SYNC.    02160001
021700     05  PC-SQL-904                   PIC S9(04) VALUE -904       02170001
021800                                                    COMP SYNC.    02180001
021900     05  PC-PBS                       PIC  X(03) VALUE 'PBS'.     02190001
022000     05  PC-RECV                      PIC  X(04) VALUE 'RECV'.    02200001
022100     05  PC-AP                        PIC  X(02) VALUE 'AP'.      02210001
022200     05  PC-IP                        PIC  X(02) VALUE 'IP'.      02220001
022300     05  PC-VE                        PIC  X(02) VALUE 'VE'.      02230001
022400     05  PC-CM                        PIC  X(02) VALUE 'CM'.      02240001
022500     05  PC-CB                        PIC  X(02) VALUE 'CB'.      02250001
022600     05  PC-CASE                      PIC  X(04) VALUE 'CASE'.    02260001
022700     05  PC-I                         PIC  X(01) VALUE 'I'.       02270001
022800     05  PC-CA                        PIC  X(02) VALUE 'CA'.      02280001
022900     05  PC-AC                        PIC  X(02) VALUE 'AC'.      02290001
023000     05  PC-P2                        PIC  X(02) VALUE 'P2'.      02300001
023100     05  PC-CP                        PIC  X(02) VALUE 'CP'.      02310001
023200     05  PC-A                         PIC  X     VALUE 'A'.       02320001
023300     05  PC-V                         PIC  X(01) VALUE 'V'.       02330001
023400     05  PC-W                         PIC  X(01) VALUE 'W'.       02340001
023500     05  PC-ERROR-STATUS              PIC  X(01) VALUE 'E'.       02350001
023600     05  PC-INV-CYC-STATUS            PIC  X(01) VALUE 'I'.       02360001
023700     05  PC-NO-PRO-STATUS             PIC  X(01) VALUE 'F'.       02370001
023800     05  PC-READY-TO-VERIFY           PIC  X(01) VALUE 'R'.       02380001
023900     05  PC-POSTED-STATUS             PIC  X(01) VALUE 'P'.       02390001
024000     05  PC-CHECK-IN                  PIC  X(08) VALUE            02400001
024100                                            'CHECK IN'.           02410001
024200     05  PC-TRLRUNLD                  PIC  X(08) VALUE            02420001
024300                                            'TRLRUNLD'.           02430001
024400     05  PC-WO-HOTCM                  PIC  X(08) VALUE            02440001
024500                                            'WO HOTCM'.           02450001
024600     05  PC-SWEEPER                   PIC  X(08) VALUE            02460001
024700                                            'SWEEPER '.           02470001
024710     05  PC-P2L                       PIC  X(08) VALUE            02471006
024720                                            'P2L     '.           02472005
024800     05  PC-DPKUT038                  PIC  X(08) VALUE            02480001
024900         'DPKUT038'.                                              02490001
025000     05  PC-DEFAULT-TMST           PIC X(26)  VALUE               02500001
025100                                  '9999-09-09-09.09.09.999999'.   02510001
025200     05  PC-DEFAULT-DATE            PIC X(10)  VALUE '9999-09-09'.02520001
025300     05  PC-DEFAULT-TIME              PIC X(08)  VALUE '01.01.01'.02530001
025400     05  PC-AUDIT-RTN                 PIC  X(08) VALUE 'RCKCS290'.02540001
025500     05  PC-CURRENT-JOB-NAME          PIC  X(04) VALUE            02550001
025600         'CICS'.                                                  02560001
025700     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE 'PCKCS780'.02570001
025800     05  PC-UNTS-WRKD-PGRM-NAME       PIC  X(08) VALUE 'PCKCS756'.02580001
025900     05  PC-UNAVAILABLE-RESOURCES     PIC S9(04)  VALUE -904.     02590001
026000     05  PC-DEADLOCK                  PIC S9(04)  VALUE -913.     02600001
026100     05  PC-ROW-NOT-FOUND             PIC S9(04)  VALUE +100.     02610001
026200     05  PC-CURRENT-OPERATING-COMPANY PIC  X(02)  VALUE '03'.     02620001
026300     05  PC-SYSTEM-CODE               PIC  X(02)  VALUE 'PC'.     02630001
026400     05  PC-DISPLAY-PO                PIC  9(8)   VALUE ZEROS.    02640001
026500     05  PC-DISPLAY-RCVR              PIC  9(8)   VALUE ZEROS.    02650001
026600     05  PC-DISPLAY-LINE              PIC  9(8)   VALUE ZEROS.    02660001
026700     05  PC-DISPLAY-OPER              PIC  9(4)   VALUE ZEROS.    02670001
026800     05  PC-DISPLAY-SQL-CODE          PIC  9999-  VALUE ZEROS.    02680001
026900     05  PC-DISPLAY-CICS-RESP         PIC  999999999-             02690001
027000                                                  VALUE ZEROS.    02700001
027100*                                                                 02710001
027200*  LAYOUT FOR THE DATE ROUTINE DPKUT500                           02720001
027300*                                                                 02730001
027400     COPY DPWS500.                                                02740001
027500     EJECT                                                        02750001
027600*                                                                 02760001
027700*  LAYOUT FOR THE ABEND COMMUNICATIONS AREA                       02770001
027800     COPY DPWS013.                                                02780001
027900     EJECT                                                        02790001
028000*                                                                 02800001
028100*  AUDIT MODULE LAYOUT                                            02810001
028200     COPY RCWS031.                                                02820001
028300                                                                  02830001
028400* COPY BOOK FOR CALLED MODULE PCKCS756                            02840001
028500     COPY PCWS238.                                                02850001
028600/                                                                 02860001
028610     EXEC SQL                                                     02861003
028620          INCLUDE TKRPRPM                                         02862003
028630     END-EXEC.                                                    02863003
028700*---------------------------------------------------------------* 02870001
028800*    DB2 AREA FOR RECEIPT HEADER TABLE                          * 02880001
028900*---------------------------------------------------------------* 02890001
029000     EXEC SQL                                                     02900001
029100          INCLUDE TRECEIV                                         02910001
029200     END-EXEC.                                                    02920001
029300     EJECT                                                        02930001
029400*---------------------------------------------------------------* 02940001
029500*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 02950001
029600*---------------------------------------------------------------* 02960001
029700     EXEC SQL                                                     02970001
029800          INCLUDE TRECITM                                         02980001
029900     END-EXEC.                                                    02990001
030000     EJECT                                                        03000001
030100*---------------------------------------------------------------* 03010001
030200*    DB2 AREA FOR RECEIPT DISTRIBUTION TABLE                    * 03020001
030300*---------------------------------------------------------------* 03030001
030400     EXEC SQL                                                     03040001
030500          INCLUDE TRECDIS                                         03050001
030600     END-EXEC.                                                    03060001
030700     EJECT                                                        03070001
030800*---------------------------------------------------------------* 03080001
030900*    DB2 AREA FOR RECEIPT VERIFICATION SOURCE TABLE             * 03090001
031000*---------------------------------------------------------------* 03100001
031100     EXEC SQL                                                     03110001
031200          INCLUDE TRECDVS                                         03120001
031300     END-EXEC.                                                    03130001
031400     EJECT                                                        03140001
031500*---------------------------------------------------------------* 03150001
031600*    DB2 AREA FOR THE TRANSACTION HEADER TABLE                  * 03160001
031700*---------------------------------------------------------------* 03170001
031800      EXEC SQL                                                    03180001
031900          INCLUDE TDISTHD                                         03190001
032000      END-EXEC.                                                   03200001
032100 EJECT                                                            03210001
032200*                                                                 03220001
032300*---------------------------------------------------------------* 03230001
032400*    DB2 AREA FOR THE PURCHASE ORDER HEADER TABLE               * 03240001
032500*---------------------------------------------------------------* 03250001
032600     EXEC SQL                                                     03260001
032700          INCLUDE TPURCHS                                         03270001
032800     END-EXEC.                                                    03280001
032900                                                                  03290001
033000 EJECT                                                            03300001
033100*---------------------------------------------------------------* 03310001
033200*    DB2 AREA FOR THE PURCHASE ORDER LINE TABLE                 * 03320001
033300*---------------------------------------------------------------* 03330001
033400     EXEC SQL                                                     03340001
033500          INCLUDE TPURITM                                         03350001
033600     END-EXEC.                                                    03360001
033700                                                                  03370001
033800 EJECT                                                            03380001
034700                                                                  03470001
034800*   DB2 COMMUNICATIONS AREA                                       03480001
034900*                                                                 03490001
035000      EXEC SQL                                                    03500001
035100          INCLUDE SQLCA                                           03510001
035200      END-EXEC.                                                   03520001
035300*                                                                 03530001
035400*   DB2 COMMUNICATIONS AREA2                                      03540001
035500*                                                                 03550001
035600     COPY SQLCA2.                                                 03560001
035700 EJECT                                                            03570001
035800                                                                  03580001
035900***************************************************************** 03590001
036000*    RECITM CURSOR TO RETURN THE UNVERIFIED LINES                 03600001
036100***************************************************************** 03610001
036200     EXEC SQL                                                     03620001
036300          DECLARE VRFY-ITM-CURSOR CURSOR WITH HOLD FOR            03630001
036400           SELECT                                                 03640001
036500                 B.STR_NBR                                        03650001
036600                ,B.VERIFY_ITM_QTY                                 03660001
036700                ,B.ORD_LNE_NBR                                    03670001
036800                ,A.RCPT_DISTR_UPD_CDE                             03680001
036900             FROM                                                 03690001
037000                  TRECITM A                                       03700001
037100               ,  TRECDIS B                                       03710001
037200             WHERE                                                03720001
037300                 A.ORD_NBR       = :DK-ORD-NBR                    03730001
037400             AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                03740001
037500             AND A.ORD_NBR       = B.ORD_NBR                      03750001
037600             AND A.REC_SEQ_NBR   = B.REC_SEQ_NBR                  03760001
037700             AND A.ORD_LNE_NBR   = B.ORD_LNE_NBR                  03770001
037800             AND A.STATUS_CDE  NOT IN ('VE','DE')                 03780001
037900             AND A.VER_STATUS_CDE     = 'A'                       03790001
038100          ORDER BY B.ORD_LNE_NBR ,B.STR_NBR                       03810001
038200     END-EXEC.                                                    03820001
038300 EJECT                                                            03830001
038400 LINKAGE SECTION.                                                 03840001
038500                                                                  03850001
038600     EJECT                                                        03860001
038700                                                                  03870001
038800******************************************************************03880001
038900 PROCEDURE DIVISION.                                              03890001
039000******************************************************************03900001
039100*                                                                 03910001
039200******************************************************************03920001
039300* 0000-MAIN-MODULE  - HIGHEST LEVEL CONTROL ROUTINE.             *03930001
039400******************************************************************03940001
039500 0000-MAIN-MODULE.                                                03950001
039600                                                                  03960001
039700     MOVE EIBTASKN               TO PV-TASK                       03970001
040200     EXEC SQL                                                     04020001
040300         SET :PV-CURR-DATE = CURRENT_DATE                         04030001
040400     END-EXEC.                                                    04040001
040500                                                                  04050001
040600     MOVE PV-CURR-DATE     TO PV-CURRENT-DATE.                    04060001
040700     MOVE PV-CURRENT-CC    TO PV-HOLD-CURR-CC.                    04070001
040800     MOVE PV-CURRENT-YY    TO PV-HOLD-CURR-YY.                    04080001
040900     MOVE PV-CURRENT-MM    TO PV-HOLD-CURR-MM.                    04090001
041000     MOVE PV-CURRENT-DD    TO PV-HOLD-CURR-DD.                    04100001
041100                                                                  04110001
041200                                                                  04120001
041300                                                                  04130001
041400     MOVE LENGTH RC289-COMMAREA-FOR-E200 TO                       04140001
041500                                     PV-COMMAREA-LENGTH.          04150001
041600                                                                  04160001
041700     EXEC CICS                                                    04170001
041800         RETRIEVE                                                 04180001
041900         INTO(RC289-COMMAREA-FOR-E200)                            04190001
042000         LENGTH(PV-COMMAREA-LENGTH)                               04200001
042100         RESP(PV-CICS-RESPONSE)                                   04210001
042200     END-EXEC.                                                    04220001
042201                                                                  04220103
042300                                                                  04230001
042400     IF PV-CICS-RESPONSE = DFHRESP(NORMAL)                        04240001
042500           MOVE RC289-ORD-NBR        TO DK-ORD-NBR                04250001
042600                                        PC238-PO-NBR              04260001
042700           MOVE RC289-RCVR-SEQ-NBR   TO DK-REC-SEQ-NBR            04270001
042800                                        PC238-RCVR-SEQ-NBR        04280001
042900           PERFORM 2500-GET-TRECEIV-OPER-UNT-ID                   04290001
043000           MOVE RECEIV-CURR-OPER-UNT-ID TO PC238-WRKD-OPER-UNT-ID 04300001
043100           PERFORM 3000-PROCESS-VRFY-ITM-CSR                      04310001
043200           MOVE DK-ORD-NBR     TO PV-ORD-NBR-DISPLAY              04320001
043300           MOVE DK-REC-SEQ-NBR TO PV-REC-SEQ-NBR-DISPLAY          04330001
043400           MOVE DK-ORD-LNE-NBR TO PV-ORD-LNE-NBR-DISPLAY          04340001
043500           MOVE RECEIV-CURR-OPER-UNT-ID                           04350001
043600                               TO PV-OPER-UNT-ID-DISPLAY          04360001
043700           MOVE PV-FCLTY-ID    TO PV-FCLTY-ID-DISPLAY             04370001
043800           MOVE EIBTRNID       TO PV-ID-NBR-DISPLAY               04380001
043810           PERFORM 9300-CHECK-LOGGING                             04381003
043811           STRING ' PCKCS780 STARTED - TASK = ' PV-TASK-X         04381103
043812                      '  '                                        04381207
043813                      PV-OPER-UNT-ID-DISPLAY                      04381307
043814                      '-'                                         04381407
043815                      PV-ORD-NBR-DISPLAY                          04381507
043816                      '-'                                         04381607
043817                      PV-REC-SEQ-NBR-DISPLAY                      04381707
043818                      '-'                                         04381807
043819                      PV-ORD-LNE-NBR-DISPLAY                      04381907
043820             DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              04382003
043893           PERFORM 9995-WRITE-CICS-FOR-DEBUG                      04389303
043894           PERFORM 9990-WRITE-CICS                                04389407
043895                                                                  04389507
043900           IF PS-DATA-OK                                          04390001
044000               STRING ' PCKCS780'                                 04400007
044100                      '   '                                       04410007
044110                      PV-OPER-UNT-ID-DISPLAY                      04411007
044120                      '-'                                         04412007
044200                      PV-ORD-NBR-DISPLAY                          04420007
044300                      '-'                                         04430007
044400                      PV-REC-SEQ-NBR-DISPLAY                      04440001
044600                      '-'                                         04460007
044700                      PV-ORD-LNE-NBR-DISPLAY                      04470001
045400                      '  SUCCESSFUL VERIFICATION'                 04540001
045500                                          DELIMITED BY SIZE       04550001
045600                             INTO PV-CICS-MSG-AREA                04560001
045610              PERFORM 9995-WRITE-CICS-FOR-DEBUG                   04561003
045620              PERFORM 9990-WRITE-CICS                             04562007
045800              PERFORM 6500-CALL-PO-RCVR-TRKING-MOD                04580001
045900     END-IF.                                                      04590001
046000                                                                  04600001
046100     STRING ' PCKCS780 ENDED - TASK = ' PV-TASK-X                 04610001
046200         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 04620001
046210     PERFORM 9995-WRITE-CICS-FOR-DEBUG.                           04621003
046220     PERFORM 9990-WRITE-CICS.                                     04622007
046400                                                                  04640001
046500     EXEC CICS                                                    04650001
046600         RETURN                                                   04660001
046700     END-EXEC.                                                    04670001
046800                                                                  04680001
046900     GOBACK.                                                      04690001
047000     EJECT                                                        04700001
047100*                                                                 04710001
047200*                                                                 04720001
047300*----------------------------------------------------------------*04730001
047400*    FETCH THE OPERATING UNIT ID THAT IS ASSOCIATED WITH THE     *04740001
047500*    RECEIVER AND LINE NUMBER THAT WE ARE ATTEMPTING TO VERIFY.  *04750001
047600*----------------------------------------------------------------*04760001
047700 2500-GET-TRECEIV-OPER-UNT-ID.                                    04770001
047800     INITIALIZE DCLTRECEIV.                                       04780001
047900                                                                  04790001
048000         EXEC SQL                                                 04800001
048100              SELECT                                              04810001
048200                 OPER_UNT_ID                                      04820001
048300                ,CURR_OPER_UNT_ID                                 04830001
048400                ,CURRENT TIMESTAMP                                04840001
048500            INTO                                                  04850001
048600                 :RECEIV-OPER-UNT-ID                              04860001
048700                ,:RECEIV-CURR-OPER-UNT-ID                         04870001
048800                ,:PV-CURRENT-TIMESTAMP                            04880001
048900              FROM  TRECEIV                                       04890001
049000              WHERE                                               04900001
049100                     ORD_NBR          =  :DK-ORD-NBR              04910001
049200              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          04920001
049300              AND    VER_STATUS_CDE   =  :PC-A                    04930001
049400              WITH UR                                             04940001
049500         END-EXEC                                                 04950001
049600                                                                  04960001
049700         EVALUATE TRUE                                            04970001
049800             WHEN SQLCODE = ZERO                                  04980001
049900                  SET PS-DATA-OK    TO  TRUE                      04990001
050000             WHEN SQLCODE = +100                                  05000001
050100                  SET PS-DATA-NOT-OK  TO  TRUE                    05010001
050200             WHEN SQLWARN0 NOT = SPACE                            05020001
050300             WHEN SQLCODE NOT = ZERO                              05030001
050400                  MOVE '2500-GET-TRECEIV-OPER-UNT-ID'             05040001
050500                                   TO DP013-PARAGRAPH             05050001
050600                  MOVE 'SELECT TRECEIV'                           05060001
050700                                   TO DP013-MESSAGE-TEXT (1)      05070001
050800                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          05080001
050900                  MOVE DK-REC-SEQ-NBR                             05090001
051000                                   TO PV-ERROR-RCVR-SEQ-NBR       05100001
051100                  STRING ' RCVR: '            DELIMITED BY SIZE   05110001
051200                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   05120001
051300                       '-'                    DELIMITED BY SIZE   05130001
051400                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   05140001
051500                                 INTO DP013-MESSAGE-TEXT (2)      05150001
051600                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    05160001
051700                  MOVE SQLCA       TO DP013-SQLCA                 05170001
051800                  SET DP013-DB2-ABEND                             05180001
051900                                   TO TRUE                        05190001
052000                  PERFORM Z999-ABEND                              05200001
052100         END-EVALUATE.                                            05210001
052200/                                                                 05220001
052300 3000-PROCESS-VRFY-ITM-CSR.                                       05230001
052400      SET PS-FIRST-VRFY-ITM-FETCH                                 05240001
052500          PS-NOT-END-OF-VRFY-ITM-CSR  TO TRUE                     05250001
052600      MOVE ZEROES TO PV-TOTAL-ACTL-LINE-QTY                       05260001
052700                                                                  05270001
052800      PERFORM 3100-OPEN-VRFY-ITM-CURSOR                           05280001
052900      PERFORM 3200-PROCESS-VRFY-ITM-CSR                           05290001
053000          UNTIL ((PS-END-OF-VRFY-ITM-CSR) OR                      05300001
053100                 (PS-DATA-NOT-OK))                                05310001
053200      PERFORM 3300-CLOSE-VRFY-ITM-CURSOR                          05320001
053300      PERFORM 5300-COUNT-TRECITM-ROWS.                            05330001
053400      IF PV-DB2-COUNT  = 0                                        05340001
053500         PERFORM 4700-UPDATE-TRECEIV-AUDIT                        05350001
053600         PERFORM 5200-UPDATE-TRECEIV                              05360001
053700* CALL UNITS MODULE AT A PO/RCVR LEVEL TO RETURN TOTAL UNITS FOR  05370001
053800* THE RECEIVER                                                    05380001
053900         MOVE ZEROES                  TO RC074-LINE-NBR           05390001
054000                                         RC074-STR-NBR            05400001
054100         PERFORM 4000-CALL-RCKUT128                               05410001
054200         MOVE RECEIV-CURR-OPER-UNT-ID TO                          05420001
054300                              PC238-WRKD-OPER-UNT-ID              05430001
054400         MOVE RC074-TOTAL-ACTL-ITM-QTY TO                         05440001
054500                              PC238-WRKD-UNT-QTY                  05450001
054600         MOVE DK-ORD-NBR              TO PC238-PO-NBR             05460001
054700         MOVE DK-REC-SEQ-NBR          TO PC238-RCVR-SEQ-NBR       05470001
054800         MOVE RECEIV-CURR-OPER-UNT-ID TO PC238-WRKD-OPER-UNT-ID   05480001
054900         MOVE ZEROES                  TO PC238-PO-LNE-NBR         05490001
055000         MOVE PC-W TO PC238-TRANS-TYPE-CDE                        05500001
055100         PERFORM 6000-UPDATE-UNITS-WRKD                           05510001
055200         PERFORM 4800-UPDATE-DISTHD                               05520001
055300         PERFORM 6200-LINK-TO-FRASTY-HANDLER                      05530001
055400      END-IF.                                                     05540001
055500                                                                  05550001
055600                                                                  05560001
055700******************************************************************05570001
055800* 3100-OPEN-VRFY-ITM-CURSOR                                      *05580001
055900*    OPEN THE DETAIL TRANSACTION CURSOR                          *05590001
056000******************************************************************05600001
056100 3100-OPEN-VRFY-ITM-CURSOR.                                       05610001
056200                                                                  05620001
056300         EXEC SQL                                                 05630001
056400              OPEN VRFY-ITM-CURSOR                                05640001
056500         END-EXEC                                                 05650001
056600                                                                  05660001
056700         EVALUATE TRUE                                            05670001
056800             WHEN SQLCODE NOT EQUAL ZERO                          05680001
056900                  MOVE '3100-OPEN-VRFY-ITM-CURSOR'                05690001
057000                                   TO  DP013-PARAGRAPH            05700001
057100                  MOVE 'OPEN VRFY-ITM-CURSOR'                     05710001
057200                                   TO  DP013-MESSAGE-TEXT (1)     05720001
057300                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          05730001
057400                  MOVE DK-REC-SEQ-NBR                             05740001
057500                                   TO  PV-ERROR-RCVR-SEQ-NBR      05750001
057600                  STRING ' RCVR: '            DELIMITED BY SIZE   05760001
057700                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   05770001
057800                       '-'                    DELIMITED BY SIZE   05780001
057900                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   05790001
058000                                 INTO DP013-MESSAGE-TEXT (2)      05800001
058100                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    05810001
058200                  MOVE SQLCA       TO  DP013-SQLCA                05820001
058300                  SET DP013-DB2-ABEND                             05830001
058400                                   TO  TRUE                       05840001
058500                  PERFORM Z999-ABEND                              05850001
058600         END-EVALUATE.                                            05860001
058700                                                                  05870001
058800******************************************************************05880001
058900* 3200-PROCESS-VRFY-ITM-CSR                                       05890001
059000*  DOES A FETCH ON THE TRECITM AND CALLS THE MODULE               05900001
059100*  USED TO ACQUIRE EXPECTED/ACTUAL/VERIFIED UNIT QUANTITIES       05910001
059200*  AND CARTON COUNTS (RCKUT128)                                   05920001
059300******************************************************************05930001
059400                                                                  05940001
059500 3200-PROCESS-VRFY-ITM-CSR.                                       05950001
059600      PERFORM 3250-FETCH-VRFY-ITM-CSR                             05960001
059700      IF PS-NOT-END-OF-VRFY-ITM-CSR                               05970001
059800*CALL TO GET TOTAL UNITS FOR STORE                                05980001
059900           PERFORM 4000-CALL-RCKUT128                             05990001
060000           IF PS-DATA-OK                                          06000001
060100              IF RC074-TOTAL-ACTL-ITM-QTY NOT =                   06010012
060110                                            RECDIS-VERIFY-ITM-QTY 06011012
060120                  PERFORM 4500-ADD-TO-RECD-AUDIT                  06012012
060400              END-IF                                              06040001
060600              PERFORM 5000-UPDATE-TRECDIS                         06060001
060700              IF RECDIS-ORD-LNE-NBR = PV-PREV-ORD-LNE-NBR         06070001
060800                 COMPUTE PV-TOTAL-ACTL-LINE-QTY =                 06080001
060900                                PV-TOTAL-ACTL-LINE-QTY +          06090001
061000                                RC074-TOTAL-ACTL-ITM-QTY          06100001
061100                 MOVE PV-PREV-ORD-LNE-NBR TO PC238-PO-LNE-NBR     06110001
061200              ELSE                                                06120001
061300                 PERFORM 4600-AUDIT-TRECITM                       06130001
061400                 PERFORM 5100-UPDATE-TRECITM-ACTUAL               06140001
061500                 PERFORM 5400-PURITM-UPD-CHECK                    06150001
061600                 SET PC238-TRANS-LINE-VERIFY TO TRUE              06160001
061700                 MOVE PV-TOTAL-ACTL-LINE-QTY TO                   06170001
061800                                           PC238-WRKD-UNT-QTY     06180001
061900                 MOVE ZEROES   TO PV-TOTAL-ACTL-LINE-QTY          06190001
062000                 COMPUTE PV-TOTAL-ACTL-LINE-QTY =                 06200001
062100                                PV-TOTAL-ACTL-LINE-QTY +          06210001
062200                                RC074-TOTAL-ACTL-ITM-QTY          06220001
062300                 MOVE PV-PREV-ORD-LNE-NBR TO PC238-PO-LNE-NBR     06230001
062400                 PERFORM 6000-UPDATE-UNITS-WRKD                   06240001
062500                 PERFORM 9100-SYNCPOINT                           06250001
062600                 MOVE RECDIS-ORD-LNE-NBR TO PV-PREV-ORD-LNE-NBR   06260001
062700                 MOVE RECITM-RCPT-DISTR-UPD-CDE TO                06270001
062800                                        PV-PREV-DISTR-UPD-CDE     06280001
062900              END-IF                                              06290001
063000           END-IF                                                 06300001
063100      END-IF.                                                     06310001
063200                                                                  06320001
063300      IF PS-END-OF-VRFY-ITM-CSR AND PS-NOT-FIRST-VRFY-ITM-FETCH   06330011
063400         PERFORM 4600-AUDIT-TRECITM                               06340001
063500         PERFORM 5100-UPDATE-TRECITM-ACTUAL                       06350001
063600         PERFORM 5400-PURITM-UPD-CHECK                            06360001
063610         MOVE PV-PREV-ORD-LNE-NBR TO PC238-PO-LNE-NBR             06361008
063700         SET PC238-TRANS-LINE-VERIFY TO TRUE                      06370001
063800         MOVE PV-TOTAL-ACTL-LINE-QTY  TO PC238-WRKD-UNT-QTY       06380001
063900         PERFORM 6000-UPDATE-UNITS-WRKD                           06390001
064000         PERFORM 9100-SYNCPOINT                                   06400001
064100      END-IF.                                                     06410001
064200                                                                  06420001
064300                                                                  06430001
064400******************************************************************06440001
064500*                                                                *06450001
064600*                                                                *06460001
064700******************************************************************06470001
064800 3250-FETCH-VRFY-ITM-CSR.                                         06480001
064900                                                                  06490001
065000     INITIALIZE DCLTRECDIS.                                       06500001
065100                                                                  06510001
065200     EXEC SQL                                                     06520001
065300          FETCH VRFY-ITM-CURSOR                                   06530001
065400                                                                  06540001
065500          INTO                                                    06550001
065600               :RECDIS-STR-NBR                                    06560001
065700             , :RECDIS-VERIFY-ITM-QTY                             06570001
065800             , :RECDIS-ORD-LNE-NBR                                06580001
065900             , :RECITM-RCPT-DISTR-UPD-CDE                         06590001
066000     END-EXEC.                                                    06600001
066100                                                                  06610001
066200     EVALUATE TRUE                                                06620001
066300         WHEN SQLCODE = ZERO                                      06630001
066400              MOVE RECDIS-ORD-LNE-NBR TO DK-ORD-LNE-NBR           06640001
066500              IF PS-FIRST-VRFY-ITM-FETCH                          06650001
066600                 SET PS-NOT-FIRST-VRFY-ITM-FETCH                  06660001
066700                     PC238-NO-PRCG-AREA-CDE      TO TRUE          06670001
066800                 MOVE RECDIS-ORD-LNE-NBR TO PV-PREV-ORD-LNE-NBR   06680001
066900                 MOVE RECITM-RCPT-DISTR-UPD-CDE                   06690001
067000                                 TO PV-PREV-DISTR-UPD-CDE         06700001
067100              END-IF                                              06710001
067200         WHEN SQLCODE = +100                                      06720001
067300              SET PS-END-OF-VRFY-ITM-CSR TO TRUE                  06730001
067400         WHEN SQLWARN0 NOT EQUAL SPACE                            06740001
067500         WHEN SQLCODE NOT EQUAL ZERO                              06750001
067600              MOVE '3250-FETCH-VRFY-ITM-CSR '                     06760001
067700                               TO  DP013-PARAGRAPH                06770001
067800              MOVE 'FETCH TRECDIS CURSOR'                         06780001
067900                               TO  DP013-MESSAGE-TEXT (1)         06790001
068000              MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR                 06800001
068100              MOVE DK-REC-SEQ-NBR                                 06810001
068200                               TO PV-ERROR-RCVR-SEQ-NBR           06820001
068300              MOVE DK-ORD-LNE-NBR                                 06830001
068400                               TO PV-ERROR-ORD-LNE-NBR            06840001
068500              STRING ' RCVR: '            DELIMITED BY SIZE       06850001
068600                   PV-ERROR-ORD-NBR       DELIMITED BY SIZE       06860001
068700                   '-'                    DELIMITED BY SIZE       06870001
068800                   PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE       06880001
068900                   '  LINE: '             DELIMITED BY SIZE       06890001
069000                   PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE       06900001
069100                             INTO DP013-MESSAGE-TEXT (2)          06910001
069200              MOVE 'TRECDIS'   TO  DP013-DB2-TABLE-NAME (1)       06920001
069300              MOVE SQLCA       TO  DP013-SQLCA                    06930001
069400              SET DP013-DB2-ABEND                                 06940001
069500                               TO  TRUE                           06950001
069600              PERFORM Z999-ABEND                                  06960001
069700     END-EVALUATE.                                                06970001
069800/                                                                 06980001
069900******************************************************************06990001
070000* 3300-CLOSE-VRFY-ITM-CURSOR.                                     07000001
070100******************************************************************07010001
070200 3300-CLOSE-VRFY-ITM-CURSOR.                                      07020001
070300                                                                  07030001
070400     EXEC SQL                                                     07040001
070500         CLOSE VRFY-ITM-CURSOR                                    07050001
070600     END-EXEC.                                                    07060001
070700                                                                  07070001
070800     EVALUATE TRUE                                                07080001
070900         WHEN SQLWARN0 NOT EQUAL SPACE                            07090001
071000         WHEN SQLCODE NOT EQUAL ZERO                              07100001
071100              MOVE '3300-CLOSE-VRFY-ITM-CURSOR  '                 07110001
071200                               TO  DP013-PARAGRAPH                07120001
071300              MOVE 'CLOSE TRECITM CURSOR'                         07130001
071400                               TO  DP013-MESSAGE-TEXT (1)         07140001
071500              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        07150001
071600              MOVE SQLCA       TO  DP013-SQLCA                    07160001
071700              SET DP013-DB2-ABEND                                 07170001
071800                               TO  TRUE                           07180001
071900              PERFORM Z999-ABEND                                  07190001
072000     END-EVALUATE.                                                07200001
072100                                                                  07210001
072200                                                                  07220001
072300 4000-CALL-RCKUT128.                                              07230001
072400     INITIALIZE RC074-FIELDS.                                     07240001
072500     MOVE RECEIV-CURR-OPER-UNT-ID TO RC074-OPER-UNT-ID.           07250001
072600     MOVE PV-FCLTY-ID         TO RC074-FCLTY-ID.                  07260001
072700     MOVE DK-ORD-NBR          TO RC074-PO-NBR.                    07270001
072800     MOVE DK-REC-SEQ-NBR      TO RC074-RCVR-SEQ-NBR.              07280001
072900     MOVE RECDIS-ORD-LNE-NBR  TO RC074-LINE-NBR.                  07290001
073000     MOVE RECDIS-STR-NBR      TO RC074-STR-NBR.                   07300001
073100     SET RC074-UNIT-QTY-YES   TO TRUE.                            07310001
073200                                                                  07320001
073300                                                                  07330001
073400     CALL RC074-UNIT-CRTN-CNT-PGM USING  DFHEIBLK                 07340001
073500                                         RC074-COMMAREA           07350001
073600                                         RC074-FIELDS.            07360001
073700                                                                  07370001
073800     EVALUATE TRUE                                                07380001
073900         WHEN RC074-SUCCESSFUL                                    07390001
074000             CONTINUE                                             07400001
074100         WHEN OTHER                                               07410001
074200             SET PS-DATA-NOT-OK  TO TRUE                          07420001
074300             MOVE '4000-CALL-RCKUT128 '                           07430001
074400                                     TO DP013-PARAGRAPH           07440001
074500             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          07450001
074600             MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR    07460001
074700             MOVE RECEIV-CURR-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID 07470001
074800             MOVE RECDIS-ORD-LNE-NBR TO PV-ORD-LNE-NBR-DISPLAY    07480001
074900             MOVE DISTHD-OPER-UNT-ID TO PV-OPER-UNT-ID-DISPLAY    07490001
075000             MOVE RECDIS-STR-NBR     TO PV-STORE-NBR-DISPLAY      07500001
075100             STRING ' PCKCS780-RC128'   DELIMITED BY SIZE         07510001
075200                    ' RCVR: '           DELIMITED BY SIZE         07520001
075300                    PV-ERROR-ORD-NBR    DELIMITED BY SIZE         07530001
075400                    '-'                 DELIMITED BY SIZE         07540001
075500                    PV-ERROR-RCVR-SEQ-NBR                         07550001
075600                                        DELIMITED BY SIZE         07560001
075700                    '  LINE: '          DELIMITED BY SIZE         07570001
075800                    PV-ORD-LNE-NBR-DISPLAY                        07580001
075900                                        DELIMITED BY SIZE         07590001
076000                    '  FCLTY: '         DELIMITED BY SIZE         07600001
076100                    PV-OPER-UNT-ID-DISPLAY                        07610001
076200                    '  FCLTY: '         DELIMITED BY SIZE         07620001
076300                    PV-STORE-NBR-DISPLAY                          07630001
076400                                        DELIMITED BY SIZE         07640001
076500                           INTO PV-CICS-MSG-AREA                  07650001
076600             PERFORM 9990-WRITE-CICS                              07660001
076700             STRING ' OPER: '            DELIMITED BY SIZE        07670001
076800                  PV-ERROR-OPER-UNT-ID   DELIMITED BY SIZE        07680001
076900                    ' RCVR: '            DELIMITED BY SIZE        07690001
077000                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        07700001
077100                  '-'                    DELIMITED BY SIZE        07710001
077200                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        07720001
077300                  ' IND: '               DELIMITED BY SIZE        07730001
077400                  RC074-SUCCESS-IND      DELIMITED BY SIZE        07740001
077500                                   INTO DP013-MESSAGE-TEXT (1)    07750001
077600             SET DP013-XCTL-DISPLAY-RESTART                       07760001
077700                 DP013-DB2-ABEND     TO TRUE                      07770001
077800                                                                  07780001
077900             PERFORM Z999-ABEND                                   07790001
078000     END-EVALUATE.                                                07800001
078100*----------------------------------------------------------------*07810001
078200/                                                                 07820001
078300                                                                  07830001
078400******************************************************************07840001
078500 4500-ADD-TO-RECD-AUDIT.                                          07850001
078600     MOVE DK-ORD-NBR     TO RC031-PO-NBR.                         07860001
078700     MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR.                    07870001
078800     MOVE RECDIS-ORD-LNE-NBR TO RC031-PO-LNE-NBR.                 07880001
078900     MOVE RECEIV-OPER-UNT-ID                                      07890001
079000                         TO RC031-OPER-UNT-ID.                    07900001
079100     MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID.                       07910001
079200     MOVE RECDIS-STR-NBR TO RC031-STR-NBR.                        07920001
079300     MOVE PC-CURRENT-PROGRAM-NAME                                 07930001
079400                         TO RC031-UPD-PGM-ID                      07940001
079500                            RC031-UPD-UID.                        07950001
079600     MOVE PV-CURRENT-TIMESTAMP                                    07960001
079700                         TO RC031-UPD-TMST.                       07970001
079800     MOVE LENGTH OF RC031-FIELDS                                  07980001
079900                         TO PV-AUDIT-RTN-LENGTH.                  07990001
080000*                                                                 08000001
080100     SET  RC031-AUDIT-TRECDIS                                     08010001
080200          RC031-BEFORE                                            08020001
080300          RC031-UPDATE   TO TRUE.                                 08030001
080400*                                                                 08040001
080500     EXEC CICS                                                    08050001
080600          LINK PROGRAM  (PC-AUDIT-RTN)                            08060001
080700          COMMAREA      (RC031-FIELDS)                            08070001
080800          LENGTH        (PV-AUDIT-RTN-LENGTH)                     08080001
080900     END-EXEC.                                                    08090001
081000*                                                                 08100001
081100     IF  RC031-CALL-SUCCESSFUL                                    08110001
081200         CONTINUE                                                 08120001
081300     ELSE                                                         08130001
081400         MOVE '4500-ADD-TO-RECD-AUDIT'                            08140001
081500                                 TO DP013-PARAGRAPH               08150001
081600         MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECDIS'        08160001
081700                                 TO DP013-MESSAGE-TEXT (1)        08170001
081800         MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR              08180001
081900         MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR             08190001
082000         MOVE RECDIS-ORD-LNE-NBR TO PV-ERROR-ORD-LNE-NBR          08200001
082100         MOVE RECDIS-STR-NBR     TO PV-ERROR-STR-NBR              08210001
082200         STRING ' RCVR: '            DELIMITED BY SIZE            08220001
082300              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            08230001
082400              '-'                    DELIMITED BY SIZE            08240001
082500              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            08250001
082600              '  LINE: '             DELIMITED BY SIZE            08260001
082700              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            08270001
082800              '  STORE: '            DELIMITED BY SIZE            08280001
082900              PV-ERROR-STR-NBR       DELIMITED BY SIZE            08290001
083000                               INTO DP013-MESSAGE-TEXT (2)        08300001
083100         STRING RC031-RETURN-CODE    DELIMITED BY SIZE            08310001
083200              '-'                    DELIMITED BY SIZE            08320001
083300              RC031-RETURN-DESC      DELIMITED BY SIZE            08330001
083400              '  SQL CODE: '         DELIMITED BY SIZE            08340001
083500              RC031-SQLCODE          DELIMITED BY SIZE            08350001
083600                               INTO DP013-MESSAGE-TEXT (3)        08360001
083700         MOVE RC031-SQLCA        TO DP013-SQLCA                   08370001
083800         MOVE 'TAURECD '         TO DP013-DB2-TABLE-NAME (1)      08380001
083900         SET DP013-DB2-ABEND     TO TRUE                          08390001
084000                                                                  08400001
084100         PERFORM Z999-ABEND                                       08410001
084200     END-IF.                                                      08420001
084300                                                                  08430001
084400                                                                  08440001
084500*----------------------------------------------------------------*08450001
084600*    TO UPDATE A ROW, THE CURRENT ROW IS ADDED TO THE            *08460001
084700*    AUDIT FILE AS THE 'BEFORE' ROW.  THE ROW IS THEN UPDATED    *08470001
084800*    ON RECITM AND THIS ROW AS ADDED TO THE AUDIT TABLE AS       *08480001
084900*    THE AFTER ROW.                                              *08490001
085000*----------------------------------------------------------------*08500001
085100 4600-AUDIT-TRECITM.                                              08510001
085200                                                                  08520001
085300     IF  PS-DATA-OK AND PV-PREV-ORD-LNE-NBR > 0                   08530011
085400         MOVE DK-ORD-NBR     TO RC031-PO-NBR                      08540001
085500         MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR                 08550001
085600         MOVE PV-PREV-ORD-LNE-NBR TO RC031-PO-LNE-NBR             08560001
085700         MOVE RECEIV-OPER-UNT-ID                                  08570001
085800                             TO RC031-OPER-UNT-ID                 08580001
085900         MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID                    08590001
086000         MOVE PC-CURRENT-PROGRAM-NAME                             08600001
086100                             TO RC031-UPD-PGM-ID                  08610001
086200                                RC031-UPD-UID                     08620001
086300         MOVE PV-CURRENT-TIMESTAMP                                08630001
086400                             TO RC031-UPD-TMST                    08640001
086500         MOVE LENGTH OF RC031-FIELDS                              08650001
086600                             TO PV-AUDIT-RTN-LENGTH               08660001
086700*                                                                 08670001
086800         SET  RC031-AUDIT-TRECITM                                 08680001
086900              RC031-BEFORE                                        08690001
087000              RC031-UPDATE   TO TRUE                              08700001
087100*                                                                 08710001
087200         EXEC CICS                                                08720001
087300              LINK PROGRAM  (PC-AUDIT-RTN)                        08730001
087400              COMMAREA      (RC031-FIELDS)                        08740001
087500              LENGTH        (PV-AUDIT-RTN-LENGTH)                 08750001
087600         END-EXEC                                                 08760001
087700*                                                                 08770001
087800         IF  RC031-CALL-SUCCESSFUL                                08780001
087900             CONTINUE                                             08790001
088000         ELSE                                                     08800001
088100             MOVE '4600-UPDATE-TRECITM'                           08810001
088200                                     TO DP013-PARAGRAPH           08820001
088300             MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECITM'    08830001
088400                                     TO DP013-MESSAGE-TEXT (1)    08840001
088500             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          08850001
088600             MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR         08860001
088700             MOVE DK-ORD-LNE-NBR     TO PV-ERROR-ORD-LNE-NBR      08870001
088800             STRING ' RCVR: '            DELIMITED BY SIZE        08880001
088900                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        08890001
089000                  '-'                    DELIMITED BY SIZE        08900001
089100                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        08910001
089200                  '  LINE: '             DELIMITED BY SIZE        08920001
089300                  PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE        08930001
089400                                   INTO DP013-MESSAGE-TEXT (2)    08940001
089500             STRING RC031-RETURN-CODE    DELIMITED BY SIZE        08950001
089600                  '-'                    DELIMITED BY SIZE        08960001
089700                  RC031-RETURN-DESC      DELIMITED BY SIZE        08970001
089800                  '  SQL CODE: '         DELIMITED BY SIZE        08980001
089900                  RC031-SQLCODE          DELIMITED BY SIZE        08990001
090000                                   INTO DP013-MESSAGE-TEXT (3)    09000001
090100             MOVE RC031-SQLCA        TO DP013-SQLCA               09010001
090200             MOVE 'TAURECI '         TO DP013-DB2-TABLE-NAME (1)  09020001
090300             SET DP013-DB2-ABEND     TO TRUE                      09030001
090400                                                                  09040001
090500             PERFORM Z999-ABEND                                   09050001
090600         END-IF.                                                  09060001
090700                                                                  09070001
090800/                                                                 09080001
090900******************************************************************09090001
091000*----------------------------------------------------------------*09100001
091100*    GET THE DATA.                                               *09110001
091200*     INSERT THE BEFORE ROW OF THE TRECEIV TABLE INTO THE        *09120001
091300*     RECEIV AUDIT TABLE.                                        *09130001
091400*     UPDATE THE CURRENT ROW                                     *09140001
091500*----------------------------------------------------------------*09150001
091600                                                                  09160001
091700 4700-UPDATE-TRECEIV-AUDIT.                                       09170001
091800                                                                  09180001
091900     IF PS-DATA-OK                                                09190001
092000         MOVE DK-ORD-NBR     TO RC031-PO-NBR                      09200001
092100         MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR                 09210001
092200         MOVE RECEIV-OPER-UNT-ID                                  09220001
092300                             TO RC031-OPER-UNT-ID                 09230001
092400         MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID                    09240001
092500         MOVE PC-CURRENT-PROGRAM-NAME                             09250001
092600                             TO RC031-UPD-PGM-ID                  09260001
092700                                RC031-UPD-UID                     09270001
092800         MOVE PV-CURRENT-TIMESTAMP                                09280001
092900                             TO RC031-UPD-TMST                    09290001
093000         MOVE LENGTH OF RC031-FIELDS                              09300001
093100                             TO PV-AUDIT-RTN-LENGTH               09310001
093200*                                                                 09320001
093300         SET  RC031-AUDIT-TRECEIV                                 09330001
093400              RC031-BEFORE                                        09340001
093500              RC031-UPDATE   TO TRUE                              09350001
093600*                                                                 09360001
093700         EXEC CICS                                                09370001
093800              LINK PROGRAM  (PC-AUDIT-RTN)                        09380001
093900              COMMAREA      (RC031-FIELDS)                        09390001
094000              LENGTH        (PV-AUDIT-RTN-LENGTH)                 09400001
094100         END-EXEC                                                 09410001
094200*                                                                 09420001
094300         IF  RC031-CALL-SUCCESSFUL                                09430001
094400             CONTINUE                                             09440001
094500         ELSE                                                     09450001
094600             MOVE '4700-UPDATE-TRECEIV-AUDIT'                     09460001
094700                                     TO DP013-PARAGRAPH           09470001
094800             MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECEIV'    09480001
094900                                     TO DP013-MESSAGE-TEXT (1)    09490001
095000             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          09500001
095100             MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR         09510001
095200             STRING ' RCVR: '            DELIMITED BY SIZE        09520001
095300                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        09530001
095400                  '-'                    DELIMITED BY SIZE        09540001
095500                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        09550001
095600                                   INTO DP013-MESSAGE-TEXT (2)    09560001
095700             STRING RC031-RETURN-CODE    DELIMITED BY SIZE        09570001
095800                  '-'                    DELIMITED BY SIZE        09580001
095900                  RC031-RETURN-DESC      DELIMITED BY SIZE        09590001
096000                  '  SQL CODE: '         DELIMITED BY SIZE        09600001
096100                  RC031-SQLCODE          DELIMITED BY SIZE        09610001
096200                                   INTO DP013-MESSAGE-TEXT (3)    09620001
096300             MOVE RC031-SQLCA        TO DP013-SQLCA               09630001
096400             MOVE 'TAURECV '         TO DP013-DB2-TABLE-NAME (1)  09640001
096500             SET DP013-DB2-ABEND     TO TRUE                      09650001
096600                                                                  09660001
096700             PERFORM Z999-ABEND                                   09670001
096800         END-IF                                                   09680001
096900     END-IF.                                                      09690001
097000                                                                  09700001
097100 4800-UPDATE-DISTHD.                                              09710001
097200                                                                  09720001
097300         EXEC SQL                                                 09730001
097400              UPDATE TDISTHD                                      09740001
097500              SET    PRCG_STAT_CDE  =  :PC-V                      09750001
097600                    ,VRFD_TMST      =   CURRENT TIMESTAMP         09760001
097700              WHERE                                               09770001
097800                     ORD_NBR          =  :DK-ORD-NBR              09780001
097900              AND    ORD_LNE_NBR      =  0                        09790001
098000              AND    RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR          09800001
098100         END-EXEC                                                 09810001
098200                                                                  09820001
098300         EVALUATE TRUE                                            09830001
098400             WHEN SQLCODE = ZERO                                  09840001
098500             WHEN SQLCODE = +100                                  09850001
098600                  CONTINUE                                        09860001
098700             WHEN SQLWARN0 NOT = SPACE                            09870001
098800             WHEN SQLCODE NOT = ZERO                              09880001
098900                  MOVE '4800-UPDATE-DISTHD'                       09890001
099000                                   TO DP013-PARAGRAPH             09900001
099100                  MOVE 'UPDATE TRANSACTION HEADER TABLE'          09910001
099200                                   TO DP013-MESSAGE-TEXT (1)      09920001
099300                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          09930001
099400                  MOVE DK-REC-SEQ-NBR                             09940001
099500                                   TO PV-ERROR-RCVR-SEQ-NBR       09950001
099600                  MOVE DK-ORD-LNE-NBR                             09960001
099700                                   TO PV-ERROR-ORD-LNE-NBR        09970001
099800                  STRING ' RCVR: '            DELIMITED BY SIZE   09980001
099900                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   09990001
100000                       '-'                    DELIMITED BY SIZE   10000001
100100                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   10010001
100200                       '  LINE: '             DELIMITED BY SIZE   10020001
100300                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   10030001
100400                                 INTO DP013-MESSAGE-TEXT (2)      10040001
100500                  MOVE 'TDISTHD '  TO DP013-DB2-TABLE-NAME (1)    10050001
100600                  MOVE SQLCA       TO DP013-SQLCA                 10060001
100700                  SET DP013-DB2-ABEND                             10070001
100800                                   TO TRUE                        10080001
100900                  PERFORM Z999-ABEND                              10090001
101000         END-EVALUATE.                                            10100001
101100 5000-UPDATE-TRECDIS.                                             10110001
101200         EXEC SQL                                                 10120001
101300              UPDATE TRECDIS                                      10130001
101400              SET    AP_VERIFY_ITM_QTY = :RC074-TOTAL-ACTL-ITM-QTY10140001
101500                    ,VERIFY_ITM_QTY    = :RC074-TOTAL-ACTL-ITM-QTY10150001
101600              WHERE                                               10160001
101700                     ORD_NBR          =  :DK-ORD-NBR              10170001
101800              AND    ORD_LNE_NBR      =  :RECDIS-ORD-LNE-NBR      10180001
101900              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          10190001
102100              AND    STR_NBR          =  :RECDIS-STR-NBR          10210001
102200         END-EXEC                                                 10220001
102300                                                                  10230001
102400         EVALUATE TRUE                                            10240001
102500             WHEN SQLCODE = ZERO                                  10250001
102600                  CONTINUE                                        10260001
102700             WHEN SQLWARN0 NOT = SPACE                            10270001
102800             WHEN SQLCODE NOT = ZERO                              10280001
102900                  MOVE '5000-UPDATE-TRECDIS'                      10290001
103000                                   TO DP013-PARAGRAPH             10300001
103100                  MOVE 'UPDATE RECEIPT DISTRIBUTION TABLE'        10310001
103200                                   TO DP013-MESSAGE-TEXT (1)      10320001
103300                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             10330001
103400                  MOVE DK-REC-SEQ-NBR                             10340001
103500                                   TO PV-ERROR-RCVR-SEQ-NBR       10350001
103600                  MOVE RECDIS-ORD-LNE-NBR                         10360001
103700                                   TO PV-ERROR-ORD-LNE-NBR        10370001
103800                  MOVE RECDIS-STR-NBR                             10380001
103900                                   TO PV-ERROR-STR-NBR            10390001
104000                  STRING ' RCVR: '            DELIMITED BY SIZE   10400001
104100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   10410001
104200                       '-'                    DELIMITED BY SIZE   10420001
104300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   10430001
104400                       '  LINE: '             DELIMITED BY SIZE   10440001
104500                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   10450001
104600                       '  STORE: '            DELIMITED BY SIZE   10460001
104700                       PV-ERROR-STR-NBR       DELIMITED BY SIZE   10470001
104800                                 INTO DP013-MESSAGE-TEXT (2)      10480001
104900                  MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (1)    10490001
105000                  MOVE SQLCA       TO DP013-SQLCA                 10500001
105100                  SET DP013-DB2-ABEND                             10510001
105200                                   TO TRUE                        10520001
105300                  PERFORM Z999-ABEND                              10530001
105400         END-EVALUATE.                                            10540001
105500                                                                  10550001
105600                                                                  10560001
105700 5100-UPDATE-TRECITM-ACTUAL.                                      10570001
105800                                                                  10580001
105900         EVALUATE TRUE                                            10590001
106000           WHEN RC289-VERIF-CHECK-IN                              10600001
106100                MOVE PC-CHECK-IN  TO PV-VRFD-USR-ID               10610001
106200           WHEN RC289-VERIF-TRLR-UNLOAD                           10620001
106210           WHEN RC289-VERIF-TRLR-UNLOAD-AT-0                      10621005
106300                MOVE PC-TRLRUNLD  TO PV-VRFD-USR-ID               10630001
106400           WHEN RC289-VERIF-HOT-COMPLETE                          10640001
106410           WHEN RC289-VERIF-HOT-COMPLETE-0                        10641005
106500                MOVE PC-WO-HOTCM  TO PV-VRFD-USR-ID               10650001
106600           WHEN RC289-VERIF-SWEEPER                               10660001
106700                MOVE PC-SWEEPER   TO PV-VRFD-USR-ID               10670001
106701           WHEN RC289-VERIF-P2L                                   10670105
106702                MOVE PC-P2L       TO PV-VRFD-USR-ID               10670205
106710           WHEN OTHER                                             10671004
106720                MOVE RC289-USER-ID TO PV-VRFD-USR-ID              10672004
106800         END-EVALUATE                                             10680001
106900                                                                  10690001
107000                                                                  10700001
107100         EXEC SQL                                                 10710001
107200              UPDATE                                              10720001
107300                    TRECITM                                       10730001
107400              SET   STATUS_CDE        =  :PC-VE                   10740001
107500                   ,VERFYD_TMST       =   CURRENT TIMESTAMP       10750001
107600                   ,RCPT_DISTR_UPD_CDE = :PV-PREV-DISTR-UPD-CDE   10760001
107700                   ,VRFD_USR_ID        = :PV-VRFD-USR-ID          10770001
107800              WHERE                                               10780001
107900                     ORD_NBR          =  :DK-ORD-NBR              10790001
108000              AND    ORD_LNE_NBR      =  :PV-PREV-ORD-LNE-NBR     10800001
108100              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          10810001
108200              AND    VER_STATUS_CDE   =  :PC-A                    10820001
108300         END-EXEC                                                 10830001
108400                                                                  10840001
108500         EVALUATE TRUE                                            10850001
108600             WHEN SQLCODE = ZERO                                  10860001
108700                  CONTINUE                                        10870001
108800             WHEN SQLWARN0 NOT = SPACE                            10880001
108900             WHEN SQLCODE NOT = ZERO                              10890001
109000                  MOVE '5100-UPDATE-TRECITM-ACTUAL'               10900001
109100                                   TO DP013-PARAGRAPH             10910001
109200                  MOVE 'UPDATE TRECITM STATUS CODE'               10920001
109300                                   TO DP013-MESSAGE-TEXT (1)      10930001
109400                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             10940001
109500                  MOVE DK-REC-SEQ-NBR                             10950001
109600                                   TO PV-ERROR-RCVR-SEQ-NBR       10960001
109700                  MOVE DK-ORD-LNE-NBR                             10970001
109800                                   TO PV-ERROR-ORD-LNE-NBR        10980001
109900                  STRING ' RCVR: '            DELIMITED BY SIZE   10990001
110000                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   11000001
110100                       '-'                    DELIMITED BY SIZE   11010001
110200                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   11020001
110300                       '  LINE: '             DELIMITED BY SIZE   11030001
110400                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   11040001
110500                                 INTO DP013-MESSAGE-TEXT (2)      11050001
110600                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    11060001
110700                  MOVE SQLCA       TO DP013-SQLCA                 11070001
110800                  SET DP013-DB2-ABEND                             11080001
110900                                   TO TRUE                        11090001
111000                  PERFORM Z999-ABEND                              11100001
111100         END-EVALUATE.                                            11110001
111200                                                                  11120001
111300 5200-UPDATE-TRECEIV.                                             11130001
111400                                                                  11140001
111500         EVALUATE TRUE                                            11150001
111600           WHEN RC289-VERIF-CHECK-IN                              11160001
111700                MOVE PC-CHECK-IN  TO PV-VRFD-USR-ID               11170001
111800           WHEN RC289-VERIF-TRLR-UNLOAD                           11180001
111810           WHEN RC289-VERIF-TRLR-UNLOAD-AT-0                      11181005
111900                MOVE PC-TRLRUNLD  TO PV-VRFD-USR-ID               11190001
112000           WHEN RC289-VERIF-HOT-COMPLETE                          11200001
112010           WHEN RC289-VERIF-HOT-COMPLETE-0                        11201005
112100                MOVE PC-WO-HOTCM  TO PV-VRFD-USR-ID               11210001
112200           WHEN RC289-VERIF-SWEEPER                               11220001
112300                MOVE PC-SWEEPER   TO PV-VRFD-USR-ID               11230001
112301           WHEN RC289-VERIF-P2L                                   11230106
112302                MOVE PC-P2L       TO PV-VRFD-USR-ID               11230205
112310           WHEN OTHER                                             11231004
112320                MOVE RC289-USER-ID TO PV-VRFD-USR-ID              11232004
112400         END-EVALUATE                                             11240001
112500                                                                  11250001
112600                                                                  11260001
112700         EXEC SQL                                                 11270001
112800              UPDATE                                              11280001
112900                    TRECEIV                                       11290001
113000              SET   STATUS_CDE    =  :PC-VE                       11300001
113100                   ,VERFYD_TMST   =   CURRENT TIMESTAMP           11310001
113200                   ,UPD_TMST      =   CURRENT TIMESTAMP           11320001
113300                   ,UPD_PGM_ID    =  :PC-CURRENT-PROGRAM-NAME     11330001
113400                   ,VRFD_USR_ID   =  :PV-VRFD-USR-ID              11340001
113500              WHERE                                               11350001
113600                     ORD_NBR      =  :DK-ORD-NBR                  11360001
113700              AND    REC_SEQ_NBR  =  :DK-REC-SEQ-NBR              11370001
113800              AND    VER_STATUS_CDE   =  :PC-A                    11380001
113900         END-EXEC                                                 11390001
114000                                                                  11400001
114100         EVALUATE TRUE                                            11410001
114200             WHEN SQLCODE = ZERO                                  11420001
114300                  CONTINUE                                        11430001
114400             WHEN SQLCODE NOT = ZERO                              11440001
114500                  MOVE '5200-UPDATE-TRECEIV'                      11450001
114600                                   TO DP013-PARAGRAPH             11460001
114700                  MOVE 'UPDATE TRECEIV STATUS CODE'               11470001
114800                                   TO DP013-MESSAGE-TEXT (1)      11480001
114900                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             11490001
115000                  MOVE DK-REC-SEQ-NBR                             11500001
115100                                   TO PV-ERROR-RCVR-SEQ-NBR       11510001
115200                  STRING ' RCVR: '            DELIMITED BY SIZE   11520001
115300                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   11530001
115400                       '-'                    DELIMITED BY SIZE   11540001
115500                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   11550001
115600                                 INTO DP013-MESSAGE-TEXT (2)      11560001
115700                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    11570001
115800                  MOVE SQLCA       TO DP013-SQLCA                 11580001
115900                  SET DP013-DB2-ABEND                             11590001
116000                                   TO TRUE                        11600001
116100                  PERFORM Z999-ABEND                              11610001
116200         END-EVALUATE.                                            11620001
116300                                                                  11630001
116400*                                                                 11640001
116500 EJECT                                                            11650001
116600*----------------------------------------------------------------*11660001
116700*    FIRST, SEE IF THERE ARE ANY ROWS LEFT THAT ARE NOT          *11670001
116800*    'VE' STATUS CODE.                                           *11680001
116900*----------------------------------------------------------------*11690001
117000 5300-COUNT-TRECITM-ROWS.                                         11700001
117100                                                                  11710001
117200     MOVE ZERO            TO  PV-DB2-COUNT.                       11720001
117300         EXEC SQL                                                 11730001
117400              SELECT                                              11740001
117500                    COUNT(*)                                      11750001
117600              INTO                                                11760001
117700                    :PV-DB2-COUNT :PV-NULL-IND                    11770001
117800              FROM                                                11780001
117900                    TRECITM                                       11790001
118000              WHERE                                               11800001
118100                    ORD_NBR            =  :DK-ORD-NBR             11810001
118200              AND   REC_SEQ_NBR        =  :DK-REC-SEQ-NBR         11820001
118300              AND   STATUS_CDE     NOT IN ('VE', 'DE')            11830001
118400              AND   VER_STATUS_CDE     =  :PC-A                   11840001
118500         END-EXEC                                                 11850001
118600                                                                  11860001
118700         EVALUATE TRUE                                            11870001
118800             WHEN SQLCODE = ZERO                                  11880001
118900             WHEN SQLCODE = +100                                  11890001
119000                  CONTINUE                                        11900001
119100             WHEN SQLWARN0 NOT = SPACE                            11910001
119200             WHEN SQLCODE NOT = ZERO                              11920001
119300                  MOVE '5300-COUNT-TRECITM-ROWS'                  11930001
119400                                   TO DP013-PARAGRAPH             11940001
119500                  MOVE 'COUNT NUMBER OF "VE" STATUS RECITM ROWS'  11950001
119600                                   TO DP013-MESSAGE-TEXT (1)      11960001
119700                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          11970001
119800                  MOVE DK-REC-SEQ-NBR                             11980001
119900                                   TO PV-ERROR-RCVR-SEQ-NBR       11990001
120000                  STRING ' RCVR: '            DELIMITED BY SIZE   12000001
120100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   12010001
120200                       '-'                    DELIMITED BY SIZE   12020001
120300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   12030001
120400                                 INTO DP013-MESSAGE-TEXT (2)      12040001
120500                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    12050001
120600                  MOVE SQLCA       TO DP013-SQLCA                 12060001
120700                  SET DP013-DB2-ABEND                             12070001
120800                                   TO TRUE                        12080001
120900                  PERFORM Z999-ABEND                              12090001
121000         END-EVALUATE.                                            12100001
121100*----------------------------------------------------------------*12110001
121200*    UPDATE THE STATUS ON THE PURITM ROW.                        *12120001
121300*----------------------------------------------------------------*12130001
121400                                                                  12140001
121500 5400-PURITM-UPD-CHECK.                                           12150001
121600                                                                  12160001
121700     MOVE ZERO                  TO  PURITM-UNT-QTY.               12170001
121800     PERFORM 5450-GET-PO-UNT-QTY.                                 12180001
121900     IF  PURITM-UNT-QTY GREATER THAN ZERO                         12190001
122000         MOVE ZERO              TO  RECDIS-AP-VERIFY-ITM-QTY      12200001
122100         PERFORM 5600-GET-RECDIS-QTY                              12210001
122200         IF  PURITM-UNT-QTY NOT GREATER RECDIS-AP-VERIFY-ITM-QTY  12220001
122300             PERFORM 5700-UPDATE-PURITM-PROCESS                   12230001
122400     END-IF.                                                      12240001
122500/                                                                 12250001
122600 5450-GET-PO-UNT-QTY.                                             12260001
122700                                                                  12270001
122800       EXEC SQL                                                   12280001
122900            SELECT                                                12290001
123000                   B.UNT_QTY                                      12300001
123100             INTO                                                 12310001
123200                   :PURITM-UNT-QTY                                12320001
123300             FROM                                                 12330001
123400                   TPURCHS A                                      12340001
123500                 , TPURITM B                                      12350001
123600            WHERE                                                 12360001
123700                   A.PO_NBR            =  :DK-ORD-NBR             12370001
123800             AND   A.PO_NBR            =  B.PO_NBR                12380001
123900             AND   B.APP_PO_LNE_NBR    =  :DK-ORD-LNE-NBR         12390001
124000             AND   A.VER_STATUS_CDE    =  :PC-A                   12400001
124100             AND   B.VER_STATUS_CDE    =  :PC-A                   12410001
124200       END-EXEC                                                   12420001
124300                                                                  12430001
124400       EVALUATE TRUE                                              12440001
124500           WHEN SQLCODE = ZERO                                    12450001
124600           WHEN SQLCODE = +100                                    12460001
124700                CONTINUE                                          12470001
124800           WHEN SQLCODE = -904                                    12480001
124900           WHEN SQLCODE = -911                                    12490001
125000           WHEN SQLCODE = -913                                    12500001
125100                CONTINUE                                          12510001
125200           WHEN SQLWARN0 NOT = SPACE                              12520001
125300           WHEN SQLCODE NOT = ZERO                                12530001
125400                MOVE '5450-GET-PO-UNT-QTY'                        12540001
125500                                 TO DP013-PARAGRAPH               12550001
125600                MOVE 'GET PO LINE UNIT QUANTITY'                  12560001
125700                                 TO DP013-MESSAGE-TEXT (1)        12570001
125800                MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR               12580001
125900                MOVE DK-ORD-LNE-NBR                               12590001
126000                                 TO PV-ERROR-ORD-LNE-NBR          12600001
126100                STRING ' PO: '              DELIMITED BY SIZE     12610001
126200                     PV-ERROR-ORD-NBR       DELIMITED BY SIZE     12620001
126300                     '  LINE: '             DELIMITED BY SIZE     12630001
126400                     PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE     12640001
126500                               INTO DP013-MESSAGE-TEXT (2)        12650001
126600                MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)      12660001
126700                MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (2)      12670001
126800                MOVE SQLCA       TO DP013-SQLCA                   12680001
126900                SET DP013-DB2-ABEND                               12690001
127000                                 TO TRUE                          12700001
127100                PERFORM Z999-ABEND                                12710001
127200       END-EVALUATE.                                              12720001
127300******************************************************************12730001
127400******************************************************************12740001
127500 5600-GET-RECDIS-QTY.                                             12750001
127600                                                                  12760001
127700       EXEC SQL                                                   12770001
127800            SELECT                                                12780001
127900                   SUM(C.AP_VERIFY_ITM_QTY)                       12790001
128000             INTO                                                 12800001
128100                   :RECDIS-AP-VERIFY-ITM-QTY :PV-NULL-IND         12810001
128200             FROM                                                 12820001
128300                   TRECEIV A                                      12830001
128400                 , TRECITM B                                      12840001
128500                 , TRECDIS C                                      12850001
128600             WHERE                                                12860001
128700                   A.ORD_NBR         =  :DK-ORD-NBR               12870001
128800              AND  A.ORD_NBR         =  B.ORD_NBR                 12880001
128900              AND  A.ORD_NBR         =  C.ORD_NBR                 12890001
129000              AND  B.ORD_LNE_NBR     =  :DK-ORD-LNE-NBR           12900001
129100              AND  B.ORD_LNE_NBR     =  C.ORD_LNE_NBR             12910001
129200              AND  A.VER_STATUS_CDE  =  :PC-A                     12920001
129300              AND  B.VER_STATUS_CDE  =  :PC-A                     12930001
129500              AND  B.STATUS_CDE      =  :PC-VE                    12950001
129600              AND  A.REC_SEQ_NBR     =  B.REC_SEQ_NBR             12960001
129700              AND  A.REC_SEQ_NBR     =  C.REC_SEQ_NBR             12970001
129800       END-EXEC                                                   12980001
129900                                                                  12990001
130000       EVALUATE TRUE                                              13000001
130100           WHEN SQLCODE = ZERO                                    13010001
130200           WHEN SQLCODE = +100                                    13020001
130300                CONTINUE                                          13030001
130400           WHEN SQLWARN0 NOT = SPACE                              13040001
130500           WHEN SQLCODE NOT = ZERO                                13050001
130600                MOVE '5600-GET-RECDIS-QTY'                        13060001
130700                                 TO DP013-PARAGRAPH               13070001
130800                MOVE 'SUM RECDIS VERIFY QUANTITY'                 13080001
130900                                 TO DP013-MESSAGE-TEXT (1)        13090001
131000                MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR               13100001
131100                MOVE DK-ORD-LNE-NBR                               13110001
131200                                 TO PV-ERROR-ORD-LNE-NBR          13120001
131300                STRING ' PO: '              DELIMITED BY SIZE     13130001
131400                     PV-ERROR-ORD-NBR       DELIMITED BY SIZE     13140001
131500                     '  LINE: '             DELIMITED BY SIZE     13150001
131600                     PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE     13160001
131700                               INTO DP013-MESSAGE-TEXT (2)        13170001
131800                MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)      13180001
131900                MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (2)      13190001
132000                MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (3)      13200001
132100                MOVE SQLCA       TO DP013-SQLCA                   13210001
132200                SET DP013-DB2-ABEND                               13220001
132300                                 TO TRUE                          13230001
132400                PERFORM Z999-ABEND                                13240001
132500       END-EVALUATE.                                              13250001
132600*----------------------------------------------------------------*13260001
132700*    UPDATE THE STATUS ON THE PURCHASE ITEM ROW                  *13270001
132800*----------------------------------------------------------------*13280001
132900                                                                  13290001
133000 5700-UPDATE-PURITM-PROCESS.                                      13300001
133100                                                                  13310001
133200     PERFORM 5750-GET-PURITM.                                     13320001
133300     IF  SQLCODE EQUAL ZERO                                       13330001
133400             IF PURITM-STATUS-CDE = PC-AC OR PC-AP                13340001
133500                 PERFORM 5800-UPDATE-PURITM-VERIFY                13350001
133600             END-IF                                               13360001
133700     END-IF.                                                      13370001
133800                                                                  13380001
133900*----------------------------------------------------------------*13390001
134000*    HERE, WE CHECK IF ALL PURCHASE ITEM LINES ARE EQUAL TO      *13400001
134100*    'CM' 'CB' OR 'CA' AND THE PURCHASE ORDER HEADER IS EQUAL    *13410001
134200*    TO 'AP' OR 'AC'.  IF SO, UPDATE THE PURCHASE ORDER HEADER   *13420001
134300*    TO A STATUS OF 'CM'.                                        *13430001
134400*----------------------------------------------------------------*13440001
134500                                                                  13450001
134600 5750-GET-PURITM.                                                 13460001
134700                                                                  13470001
134800     INITIALIZE DCLTPURITM.                                       13480001
134900                                                                  13490001
135000         EXEC SQL                                                 13500001
135100              SELECT                                              13510001
135200                      STATUS_CDE                                  13520001
135300               INTO                                               13530001
135400                      :PURITM-STATUS-CDE                          13540001
135500               FROM                                               13550001
135600                      TPURITM                                     13560001
135700              WHERE                                               13570001
135800                      PO_NBR             =  :DK-ORD-NBR           13580001
135900               AND    APP_PO_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   13590001
136000               AND    VER_STATUS_CDE     =  :PC-A                 13600001
136100         END-EXEC                                                 13610001
136200                                                                  13620001
136300         EVALUATE TRUE                                            13630001
136400             WHEN SQLCODE = ZERO                                  13640001
136500             WHEN SQLCODE = +100                                  13650001
136600                  CONTINUE                                        13660001
136700             WHEN SQLWARN0 NOT = SPACE                            13670001
136800             WHEN SQLCODE NOT = ZERO                              13680001
136900                  MOVE '5750-GET-PURITM'                          13690001
137000                                   TO DP013-PARAGRAPH             13700001
137100                  MOVE 'SELECT TPURITM            '               13710001
137200                                   TO DP013-MESSAGE-TEXT (1)      13720001
137300                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             13730001
137400                  MOVE RECDIS-ORD-LNE-NBR                         13740001
137500                                   TO PV-ERROR-ORD-LNE-NBR        13750001
137600                  STRING ' PO: '              DELIMITED BY SIZE   13760001
137700                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   13770001
137800                       '  LINE: '             DELIMITED BY SIZE   13780001
137900                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   13790001
138000                                 INTO DP013-MESSAGE-TEXT (2)      13800001
138100                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    13810001
138200                  MOVE SQLCA       TO DP013-SQLCA                 13820001
138300                  SET DP013-DB2-ABEND                             13830001
138400                                   TO TRUE                        13840001
138500                  PERFORM Z999-ABEND                              13850001
138600         END-EVALUATE.                                            13860001
138700/                                                                 13870001
138800 5800-UPDATE-PURITM-VERIFY.                                       13880001
138900                                                                  13890001
139000         EXEC SQL                                                 13900001
139100              UPDATE                                              13910001
139200                     TPURITM                                      13920001
139300              SET    STATUS_CDE   =  :PC-CM                       13930001
139400                   , STAT_TMST    =  CURRENT TIMESTAMP            13940001
139500              WHERE                                               13950001
139600                     PO_NBR           =  :DK-ORD-NBR              13960001
139700              AND    APP_PO_LNE_NBR   =  :RECDIS-ORD-LNE-NBR      13970001
139800              AND    VER_STATUS_CDE   =  :PC-A                    13980001
139900         END-EXEC                                                 13990001
140000                                                                  14000001
140100         EVALUATE TRUE                                            14010001
140200             WHEN SQLCODE = ZERO                                  14020001
140300                  CONTINUE                                        14030001
140400             WHEN SQLWARN0 NOT = SPACE                            14040001
140500             WHEN SQLCODE NOT = ZERO                              14050001
140600                  MOVE '5800-UPDATE-PURITM-VERIFY'                14060001
140700                                   TO DP013-PARAGRAPH             14070001
140800                  MOVE 'SET STATUS TO "CM" COMPLETE'              14080001
140900                                   TO DP013-MESSAGE-TEXT (1)      14090001
141000                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             14100001
141100                  MOVE RECDIS-ORD-LNE-NBR                         14110001
141200                                   TO PV-ERROR-ORD-LNE-NBR        14120001
141300                  STRING ' PO: '              DELIMITED BY SIZE   14130001
141400                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   14140001
141500                       '  LINE: '             DELIMITED BY SIZE   14150001
141600                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   14160001
141700                                 INTO DP013-MESSAGE-TEXT (2)      14170001
141800                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    14180001
141900                  MOVE SQLCA       TO DP013-SQLCA                 14190001
142000                  SET DP013-DB2-ABEND                             14200001
142100                                   TO TRUE                        14210001
142200                  PERFORM Z999-ABEND                              14220001
142300         END-EVALUATE.                                            14230001
142400/                                                                 14240001
142500                                                                  14250001
142600 6000-UPDATE-UNITS-WRKD.                                          14260001
142700* THIS WILL CALL PCKCS756 WHICH WILL UPDATE THE TABLES FOR UNITS  14270001
142800* WORKED OR VERIFIED                                              14280001
142900     EXEC SQL                                                     14290001
143000         SET :PV-CURRENT-TMST =  CURRENT_TIMESTAMP                14300001
143100     END-EXEC.                                                    14310001
143200                                                                  14320001
143300     MOVE PV-CURRENT-TMST             TO PC238-WRKD-TMST.         14330001
143400     MOVE PC-A                        TO PC238-VERIFY-TYPE-CDE.   14340001
143500     MOVE LENGTH OF PC238-COMM-AREA   TO PV-COMMAREA-LENGTH.      14350001
143600                                                                  14360001
143700     EXEC CICS                                                    14370001
143800         LINK                                                     14380001
143900             PROGRAM   (PC-UNTS-WRKD-PGRM-NAME)                   14390001
144000             COMMAREA  (PC238-COMM-AREA)                          14400001
144100             LENGTH    (PV-COMMAREA-LENGTH)                       14410001
144200             RESP      (PV-CICS-RESPONSE)                         14420001
144300     END-EXEC.                                                    14430001
144400                                                                  14440001
144500     EVALUATE TRUE                                                14450001
144600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 14460001
144700              EVALUATE TRUE                                       14470001
144800                  WHEN PC238-MOD-SUCCESSFUL                       14480001
144900                       CONTINUE                                   14490001
145000                 WHEN PC238-MOD-UNSUCCESSFUL                      14500001
145100                     PERFORM 6100-MOD-UNSUCCESSFUL                14510001
145200             END-EVALUATE                                         14520001
145300                                                                  14530001
145400         WHEN OTHER                                               14540001
145500             STRING ' PCKCS780 - '      DELIMITED BY SIZE         14550001
145600                    ' 6000-UPDATE-UNITS-WRKD '                    14560001
145700                                        DELIMITED BY SIZE         14570001
145800                    ' KEY INFO - '      DELIMITED BY SIZE         14580001
145900                    PC-DISPLAY-PO       DELIMITED BY SIZE         14590001
146000                    ' - '               DELIMITED BY SIZE         14600001
146100                    PC-DISPLAY-RCVR     DELIMITED BY SIZE         14610001
146200                    ' - '               DELIMITED BY SIZE         14620001
146300                    PC-DISPLAY-LINE     DELIMITED BY SIZE         14630001
146400                                  INTO PV-CICS-MSG-AREA           14640001
146500             MOVE LENGTH OF PV-CICS-MSG-AREA                      14650001
146600                                   TO PV-COMMAREA-LENGTH          14660001
146700             PERFORM 9990-WRITE-CICS                              14670001
146800             PERFORM Z900-SOFT-ABORT                              14680001
146900     END-EVALUATE.                                                14690001
147000/                                                                 14700001
147100/                                                                 14710001
147200 6100-MOD-UNSUCCESSFUL.                                           14720001
147300                                                                  14730001
147400     MOVE PC238-PO-NBR              TO PC-DISPLAY-PO.             14740001
147500     MOVE PC238-RCVR-SEQ-NBR        TO PC-DISPLAY-RCVR.           14750001
147600     MOVE PC238-PO-LNE-NBR          TO PC-DISPLAY-LINE.           14760001
147700     MOVE PC238-WRKD-OPER-UNT-ID    TO PC-DISPLAY-OPER.           14770001
147800     MOVE PC238-BAD-SQL-CDE         TO PC-DISPLAY-SQL-CODE        14780001
147900                                       SQLCODE.                   14790001
148000      SET PS-UPDATES-DONE           TO TRUE.                      14800001
148100                                                                  14810001
148200     IF  PC238-MOD-BAD-TMST                                       14820001
148300         STRING ' PCKCS780 - '      DELIMITED BY SIZE             14830001
148400                ' 6000-UPDATE-UNITS-WRKD '                        14840001
148500                                    DELIMITED BY SIZE             14850001
148600                ' BAD TIMESTAMP '   DELIMITED BY SIZE             14860001
148700                PC238-WRKD-TMST     DELIMITED BY SIZE             14870001
148800                             INTO PV-CICS-MSG-AREA                14880001
148900         MOVE LENGTH OF PV-CICS-MSG-AREA                          14890001
149000                               TO PV-COMMAREA-LENGTH              14900001
149100         PERFORM 9990-WRITE-CICS                                  14910001
149200         STRING ' PCKCS780 - '      DELIMITED BY SIZE             14920001
149300                ' 6000-UPDATE-UNITS-WRKD '                        14930001
149400                                    DELIMITED BY SIZE             14940001
149500                ' KEY INFO - '      DELIMITED BY SIZE             14950001
149600                PC-DISPLAY-PO       DELIMITED BY SIZE             14960001
149700                ' - '               DELIMITED BY SIZE             14970001
149800                PC-DISPLAY-RCVR     DELIMITED BY SIZE             14980001
149900                ' - '               DELIMITED BY SIZE             14990001
150000                PC-DISPLAY-LINE     DELIMITED BY SIZE             15000001
150100                             INTO PV-CICS-MSG-AREA                15010001
150200         MOVE LENGTH OF PV-CICS-MSG-AREA                          15020001
150300                               TO PV-COMMAREA-LENGTH              15030001
150400         PERFORM 9990-WRITE-CICS                                  15040001
150500         PERFORM Z900-SOFT-ABORT                                  15050001
150600     ELSE                                                         15060001
150700     IF  PC238-MOD-BAD-OPER                                       15070001
150800         STRING ' PCKCS780 - '      DELIMITED BY SIZE             15080001
150900                ' 6000-UPDATE-UNITS-WRKD '                        15090001
151000                                    DELIMITED BY SIZE             15100001
151100                ' BAD OPER UNIT '   DELIMITED BY SIZE             15110001
151200                PC-DISPLAY-OPER     DELIMITED BY SIZE             15120001
151300                             INTO PV-CICS-MSG-AREA                15130001
151400         MOVE LENGTH OF PV-CICS-MSG-AREA                          15140001
151500                               TO PV-COMMAREA-LENGTH              15150001
151600         PERFORM 9990-WRITE-CICS                                  15160001
151700         STRING ' PCKCS780 - '      DELIMITED BY SIZE             15170001
151800                ' 6000-UPDATE-UNITS-WRKD '                        15180001
151900                                    DELIMITED BY SIZE             15190001
152000                ' KEY INFO - '      DELIMITED BY SIZE             15200001
152100                PC-DISPLAY-PO       DELIMITED BY SIZE             15210001
152200                ' - '               DELIMITED BY SIZE             15220001
152300                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15230001
152400                ' - '               DELIMITED BY SIZE             15240001
152500                PC-DISPLAY-LINE     DELIMITED BY SIZE             15250001
152600                             INTO PV-CICS-MSG-AREA                15260001
152700         MOVE LENGTH OF PV-CICS-MSG-AREA                          15270001
152800                               TO PV-COMMAREA-LENGTH              15280001
152900         PERFORM 9990-WRITE-CICS                                  15290001
153000         PERFORM Z900-SOFT-ABORT                                  15300001
153100     ELSE                                                         15310001
153200     IF  PC238-MOD-BAD-TRANS-TYPE                                 15320001
153300         STRING ' PCKCS780 - '      DELIMITED BY SIZE             15330001
153400                ' 6000-UPDATE-UNITS-WRKD '                        15340001
153500                                    DELIMITED BY SIZE             15350001
153600                ' BAD TRAN TYPE '   DELIMITED BY SIZE             15360001
153700                PC238-TRANS-TYPE-CDE                              15370001
153800                                    DELIMITED BY SIZE             15380001
153900                             INTO PV-CICS-MSG-AREA                15390001
154000         MOVE LENGTH OF PV-CICS-MSG-AREA                          15400001
154100                               TO PV-COMMAREA-LENGTH              15410001
154200         PERFORM 9990-WRITE-CICS                                  15420001
154300         STRING ' PCKCS780 - '      DELIMITED BY SIZE             15430001
154400                ' 6000-UPDATE-UNITS-WRKD '                        15440001
154500                                    DELIMITED BY SIZE             15450001
154600                ' KEY INFO - '      DELIMITED BY SIZE             15460001
154700                PC-DISPLAY-PO       DELIMITED BY SIZE             15470001
154800                ' - '               DELIMITED BY SIZE             15480001
154900                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15490001
155000                ' - '               DELIMITED BY SIZE             15500001
155100                PC-DISPLAY-LINE     DELIMITED BY SIZE             15510001
155200                             INTO PV-CICS-MSG-AREA                15520001
155300         MOVE LENGTH OF PV-CICS-MSG-AREA                          15530001
155400                               TO PV-COMMAREA-LENGTH              15540001
155500         PERFORM 9990-WRITE-CICS                                  15550001
155600         PERFORM Z900-SOFT-ABORT                                  15560001
155700     ELSE                                                         15570001
155800     IF  PC238-MOD-BAD-PO                                         15580001
155900         STRING ' PCKCS780 - '      DELIMITED BY SIZE             15590001
156000                ' 6000-UPDATE-UNITS-WRKD '                        15600001
156100                                    DELIMITED BY SIZE             15610001
156200                ' BAD PO NUMBER '   DELIMITED BY SIZE             15620001
156300                PC-DISPLAY-PO       DELIMITED BY SIZE             15630001
156400                             INTO PV-CICS-MSG-AREA                15640001
156500         MOVE LENGTH OF PV-CICS-MSG-AREA                          15650001
156600                               TO PV-COMMAREA-LENGTH              15660001
156700         PERFORM 9990-WRITE-CICS                                  15670001
156800         STRING ' PCKCS780 - '      DELIMITED BY SIZE             15680001
156900                ' 6000-UPDATE-UNITS-WRKD '                        15690001
157000                                    DELIMITED BY SIZE             15700001
157100                ' KEY INFO - '      DELIMITED BY SIZE             15710001
157200                PC-DISPLAY-PO       DELIMITED BY SIZE             15720001
157300                ' - '               DELIMITED BY SIZE             15730001
157400                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15740001
157500                ' - '               DELIMITED BY SIZE             15750001
157600                PC-DISPLAY-LINE     DELIMITED BY SIZE             15760001
157700                             INTO PV-CICS-MSG-AREA                15770001
157800         MOVE LENGTH OF PV-CICS-MSG-AREA                          15780001
157900                               TO PV-COMMAREA-LENGTH              15790001
158000         PERFORM 9990-WRITE-CICS                                  15800001
158100         PERFORM Z900-SOFT-ABORT                                  15810001
158200     ELSE                                                         15820001
158300     IF  PC238-MOD-BAD-RCVR                                       15830001
158400         STRING ' PCKCS780 - '      DELIMITED BY SIZE             15840001
158500                ' 6000-UPDATE-UNITS-WRKD '                        15850001
158600                                    DELIMITED BY SIZE             15860001
158700                ' BAD RCVR NBR  '   DELIMITED BY SIZE             15870001
158800                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15880001
158900                             INTO PV-CICS-MSG-AREA                15890001
159000         MOVE LENGTH OF PV-CICS-MSG-AREA                          15900001
159100                               TO PV-COMMAREA-LENGTH              15910001
159200         PERFORM 9990-WRITE-CICS                                  15920001
159300         STRING ' PCKCS780 - '      DELIMITED BY SIZE             15930001
159400                ' 6000-UPDATE-UNITS-WRKD '                        15940001
159500                                    DELIMITED BY SIZE             15950001
159600                ' KEY INFO - '      DELIMITED BY SIZE             15960001
159700                PC-DISPLAY-PO       DELIMITED BY SIZE             15970001
159800                ' - '               DELIMITED BY SIZE             15980001
159900                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15990001
160000                ' - '               DELIMITED BY SIZE             16000001
160100                PC-DISPLAY-LINE     DELIMITED BY SIZE             16010001
160200                             INTO PV-CICS-MSG-AREA                16020001
160300         MOVE LENGTH OF PV-CICS-MSG-AREA                          16030001
160400                               TO PV-COMMAREA-LENGTH              16040001
160500         PERFORM 9990-WRITE-CICS                                  16050001
160600         PERFORM Z900-SOFT-ABORT                                  16060001
160700     ELSE                                                         16070001
160800     IF  PC238-MOD-BAD-LINE                                       16080001
160900         STRING ' PCKCS780 - '      DELIMITED BY SIZE             16090001
161000                ' 6000-UPDATE-UNITS-WRKD '                        16100001
161100                                    DELIMITED BY SIZE             16110001
161200                ' BAD LINE NBR  '   DELIMITED BY SIZE             16120001
161300                PC-DISPLAY-LINE     DELIMITED BY SIZE             16130001
161400                             INTO PV-CICS-MSG-AREA                16140001
161500         MOVE LENGTH OF PV-CICS-MSG-AREA                          16150001
161600                               TO PV-COMMAREA-LENGTH              16160001
161700         PERFORM 9990-WRITE-CICS                                  16170001
161800         STRING ' PCKCS780 - '      DELIMITED BY SIZE             16180001
161900                ' 6000-UPDATE-UNITS-WRKD '                        16190001
162000                                    DELIMITED BY SIZE             16200001
162100                ' KEY INFO - '      DELIMITED BY SIZE             16210001
162200                PC-DISPLAY-PO       DELIMITED BY SIZE             16220001
162300                ' - '               DELIMITED BY SIZE             16230001
162400                PC-DISPLAY-RCVR     DELIMITED BY SIZE             16240001
162500                ' - '               DELIMITED BY SIZE             16250001
162600                PC-DISPLAY-LINE     DELIMITED BY SIZE             16260001
162700                             INTO PV-CICS-MSG-AREA                16270001
162800         MOVE LENGTH OF PV-CICS-MSG-AREA                          16280001
162900                               TO PV-COMMAREA-LENGTH              16290001
163000         PERFORM 9990-WRITE-CICS                                  16300001
163100         PERFORM Z900-SOFT-ABORT                                  16310001
163200     ELSE                                                         16320001
163300     IF  PC238-MOD-BAD-NO-SHIFT                                   16330001
163400         STRING ' PCKCS780 - '      DELIMITED BY SIZE             16340001
163500                ' 6000-UPDATE-UNITS-WRKD '                        16350001
163600                                    DELIMITED BY SIZE             16360001
163700                ' SHIFT NOT FOUND ' DELIMITED BY SIZE             16370001
163800                PC238-WRKD-TMST     DELIMITED BY SIZE             16380001
163900                ' FOR OPER '        DELIMITED BY SIZE             16390001
164000                PC-DISPLAY-OPER     DELIMITED BY SIZE             16400001
164100                             INTO PV-CICS-MSG-AREA                16410001
164200         MOVE LENGTH OF PV-CICS-MSG-AREA                          16420001
164300                               TO PV-COMMAREA-LENGTH              16430001
164400         PERFORM 9990-WRITE-CICS                                  16440001
164500         STRING ' PCKCS780 - '      DELIMITED BY SIZE             16450001
164600                ' 6000-UPDATE-UNITS-WRKD '                        16460001
164700                                    DELIMITED BY SIZE             16470001
164800                ' KEY INFO - '      DELIMITED BY SIZE             16480001
164900                PC-DISPLAY-PO       DELIMITED BY SIZE             16490001
165000                ' - '               DELIMITED BY SIZE             16500001
165100                PC-DISPLAY-RCVR     DELIMITED BY SIZE             16510001
165200                ' - '               DELIMITED BY SIZE             16520001
165300                PC-DISPLAY-LINE     DELIMITED BY SIZE             16530001
165400                             INTO PV-CICS-MSG-AREA                16540001
165500         MOVE LENGTH OF PV-CICS-MSG-AREA                          16550001
165600                               TO PV-COMMAREA-LENGTH              16560001
165700         PERFORM 9990-WRITE-CICS                                  16570001
165800         PERFORM Z900-SOFT-ABORT                                  16580001
165900     ELSE                                                         16590001
166000         STRING ' PCKCS780 - '      DELIMITED BY SIZE             16600001
166100                ' 6000-UPDATE-UNITS-WRKD '                        16610001
166200                                    DELIMITED BY SIZE             16620001
166300                ' DB ERROR - SQL CODE '                           16630001
166400                                    DELIMITED BY SIZE             16640001
166500                PC-DISPLAY-SQL-CODE DELIMITED BY SIZE             16650001
166600                ' FUNC: '           DELIMITED BY SIZE             16660001
166700                PC238-BAD-TABLE-FUNCTION                          16670001
166800                                    DELIMITED BY SIZE             16680001
166900                ' TABLE: '          DELIMITED BY SIZE             16690001
167000                PC238-BAD-TABLE-NAME                              16700001
167100                                    DELIMITED BY SIZE             16710001
167200                             INTO PV-CICS-MSG-AREA                16720001
167300         MOVE LENGTH OF PV-CICS-MSG-AREA                          16730001
167400                               TO PV-COMMAREA-LENGTH              16740001
167500         PERFORM 9990-WRITE-CICS                                  16750001
167600         STRING ' PCKCS780 - '      DELIMITED BY SIZE             16760001
167700                ' 6000-UPDATE-UNITS-WRKD '                        16770001
167800                                    DELIMITED BY SIZE             16780001
167900                ' KEY INFO - '      DELIMITED BY SIZE             16790001
168000                PC-DISPLAY-PO       DELIMITED BY SIZE             16800001
168100                ' - '               DELIMITED BY SIZE             16810001
168200                PC-DISPLAY-RCVR     DELIMITED BY SIZE             16820001
168300                ' - '               DELIMITED BY SIZE             16830001
168400                PC-DISPLAY-LINE     DELIMITED BY SIZE             16840001
168500                             INTO PV-CICS-MSG-AREA                16850001
168600         MOVE LENGTH OF PV-CICS-MSG-AREA                          16860001
168700                               TO PV-COMMAREA-LENGTH              16870001
168800         PERFORM 9990-WRITE-CICS                                  16880001
168900         PERFORM Z900-SOFT-ABORT                                  16890001
169000     END-IF                                                       16900001
169100     END-IF                                                       16910001
169200     END-IF                                                       16920001
169300     END-IF                                                       16930001
169400     END-IF                                                       16940001
169500     END-IF                                                       16950001
169600     END-IF.                                                      16960001
169700                                                                  16970001
169800 6200-LINK-TO-FRASTY-HANDLER.                                     16980001
169900                                                                  16990001
170000     INITIALIZE SU044-COMM-AREA.                                  17000001
170100     MOVE DK-ORD-NBR               TO SU044-PO.                   17010001
170200     MOVE DK-REC-SEQ-NBR           TO SU044-ORIG-REC-SEQ-NBR.     17020001
170300     MOVE RECEIV-CURR-OPER-UNT-ID  TO SU044-OPER-UNT-ID.          17030001
170400     MOVE 1                        TO SU044-FCLTY-ID.             17040001
170500     MOVE PC-CURRENT-PROGRAM-NAME  TO SU044-PROGRAM-NAME.         17050001
170600     SET  SU044-SRC-VERIFICATION   TO TRUE.                       17060001
170700     SET SU044-RCVR-PBS         TO TRUE                           17070001
170800     MOVE RECDIS-STR-NBR        TO SU044-DEST-STR-NBR             17080001
170900                                                                  17090001
171000     MOVE LENGTH OF SU044-COMM-AREA TO  PV-COMMAREA-LENGTH.       17100001
171100                                                                  17110001
171200     EXEC CICS                                                    17120001
171300         LINK PROGRAM  (PC-FA-HANDLER-PGM)                        17130001
171400              COMMAREA (SU044-COMM-AREA)                          17140001
171500              LENGTH   (PV-COMMAREA-LENGTH)                       17150001
171600     END-EXEC.                                                    17160001
171700                                                                  17170001
171800                                                                  17180001
171900     EVALUATE TRUE                                                17190001
172000         WHEN SU044-SUCCESSFUL                                    17200001
172100              CONTINUE                                            17210001
172200                                                                  17220001
172300         WHEN OTHER                                               17230001
172400             MOVE '6200-LINK-TO-FRASTY-HANDLER'                   17240001
172500                                  TO DP013-PARAGRAPH              17250001
172600             STRING ' SUCCESS IND = '                             17260001
172700                    SU044-SUCCESS-IND                             17270001
172800                         DELIMITED BY SIZE                        17280001
172900                                INTO DP013-MESSAGE-TEXT (1)       17290001
173000             MOVE SQLCA           TO DP013-SQLCA                  17300001
173100             SET DP013-DB2-ABEND     TO TRUE                      17310001
173200                                                                  17320001
173300             PERFORM Z999-ABEND                                   17330001
173400     END-EVALUATE.                                                17340001
173500                                                                  17350001
173600 6500-CALL-PO-RCVR-TRKING-MOD.                                    17360001
173700                                                                  17370001
173800     INITIALIZE RC071-FIELDS.                                     17380001
173900     MOVE RC289-ORD-NBR             TO RC071-PO-NBR               17390001
174000     MOVE RC289-RCVR-SEQ-NBR        TO RC071-PO-RCVR              17400001
174100     MOVE ZEROES                    TO RC071-PO-LINE              17410001
174200                                       RC071-PREPK-ID.            17420001
174300                                                                  17430001
174400     MOVE RECEIV-CURR-OPER-UNT-ID   TO RC071-SIGNON-LOCATION      17440001
174500     MOVE RC289-USER-ID             TO RC071-USER-ID              17450001
174600     MOVE RC289-CALLING-PROGRAM     TO RC071-CALLING-PROGRAM      17460001
174700     MOVE RC289-DC-FUNCTION-CODE    TO RC071-DC-FUNCTION-CODE     17470001
174800     IF RC074-TOTAL-ACTL-ITM-QTY = 0                              17480001
174900        EVALUATE TRUE                                             17490001
175000          WHEN RC071-VERIF-TRLR-UNLOAD                            17500001
175100            SET RC071-VERIF-TRLR-UNLOAD-AT-0 TO TRUE              17510001
175200          WHEN RC071-VERIF-HOT-COMPLETE                           17520001
175300            SET RC071-VERIF-HOT-COMPLETE-0   TO TRUE              17530001
175400        END-EVALUATE                                              17540001
175500     END-IF                                                       17550001
175600                                                                  17560001
175700     MOVE LENGTH OF RC071-FIELDS    TO PV-COMMAREA-LENGTH.        17570001
175800                                                                  17580001
175900     CALL RC071-PO-RCVR-TRACKING USING  DFHEIBLK                  17590001
176000                                        RC071-COMMAREA            17600001
176100                                        RC071-FIELDS.             17610001
176200                                                                  17620001
176300     EVALUATE TRUE                                                17630001
176400       WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                   17640001
176500          IF RC071-SUCCESSFUL                                     17650001
176600             CONTINUE                                             17660001
176700          ELSE                                                    17670001
176800             MOVE '6500-CALL-PO-RCVR-TRKING-MOD'                  17680001
176900                                     TO DP013-PARAGRAPH           17690001
177000             MOVE RC289-ORD-NBR      TO PV-ERROR-ORD-NBR          17700001
177100             MOVE RC289-RCVR-SEQ-NBR  TO PV-ERROR-RCVR-SEQ-NBR    17710001
177200             MOVE RECEIV-CURR-OPER-UNT-ID  TO                     17720001
177300                                        PV-ERROR-OPER-UNT-ID      17730001
177400                                        PV-OPER-UNT-ID-DISPLAY    17740001
177500             MOVE DK-ORD-LNE-NBR     TO PV-ORD-LNE-NBR-DISPLAY    17750001
177600             STRING ' PCKCS760-RC137'   DELIMITED BY SIZE         17760001
177700                    ' RCVR: '           DELIMITED BY SIZE         17770001
177800                    PV-ERROR-ORD-NBR    DELIMITED BY SIZE         17780001
177900                    '-'                 DELIMITED BY SIZE         17790001
178000                    PV-ERROR-RCVR-SEQ-NBR                         17800001
178100                                        DELIMITED BY SIZE         17810001
178200                    '  LINE: '          DELIMITED BY SIZE         17820001
178300                    PV-ORD-LNE-NBR-DISPLAY                        17830001
178400                                        DELIMITED BY SIZE         17840001
178500                    '  FCLTY: '         DELIMITED BY SIZE         17850001
178600                    PV-OPER-UNT-ID-DISPLAY                        17860001
178700                                        DELIMITED BY SIZE         17870001
178800                           INTO PV-CICS-MSG-AREA                  17880001
178900             PERFORM 9990-WRITE-CICS                              17890001
179000             STRING ' OPER: '            DELIMITED BY SIZE        17900001
179100                  PV-ERROR-OPER-UNT-ID   DELIMITED BY SIZE        17910001
179200                    ' RCVR: '            DELIMITED BY SIZE        17920001
179300                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        17930001
179400                  '-'                    DELIMITED BY SIZE        17940001
179500                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        17950001
179600                  ' IND: '               DELIMITED BY SIZE        17960001
179700                  RC071-SUCCESS-IND      DELIMITED BY SIZE        17970001
179800                                   INTO DP013-MESSAGE-TEXT (1)    17980001
179900             SET DP013-XCTL-DISPLAY-RESTART                       17990001
180000                 DP013-DB2-ABEND     TO TRUE                      18000001
180100                                                                  18010001
180200             PERFORM Z999-ABEND                                   18020001
180300          END-IF                                                  18030001
180400     END-EVALUATE.                                                18040001
180500                                                                  18050001
180510                                                                  18051003
180520 9300-CHECK-LOGGING.                                              18052003
180530     EXEC SQL                                                     18053003
180540         SELECT FUNC_TXT                                          18054003
180550           INTO :KRPRPM-FUNC-TXT                                  18055003
180560           FROM TKRPRPM                                           18056003
180570          WHERE SYS_PRC_FUNC_CDE  = 'PC780D'                      18057003
180580            AND LOC_ID            = 90                            18058003
180590            AND INTFC_SYS_CDE     = 'KHL'                         18059003
180591            AND FUNC_PRC_STAT_CDE = 'AC'                          18059103
180592     END-EXEC.                                                    18059203
180593                                                                  18059303
180594     EVALUATE TRUE                                                18059403
180595         WHEN SQLCODE = ZERO                                      18059503
180596           CONTINUE                                               18059603
180597         WHEN OTHER                                               18059703
180598           MOVE SPACES TO PV-CICS-MSG-AREA                        18059803
180599     END-EVALUATE.                                                18059903
180600                                                                  18060003
180610                                                                  18061001
180700                                                                  18070001
180800/                                                                 18080001
180900 9990-WRITE-CICS.                                                 18090001
181000*!                                                                18100001
181100     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-CLENG.                 18110001
181200*!                                                                18120001
181300     EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA)     18130001
181400          LENGTH(PV-CLENG) NOHANDLE                               18140001
181500     END-EXEC.                                                    18150001
181600                                                                  18160001
181700     MOVE SPACES TO PV-CICS-MSG-AREA.                             18170001
181800*                                                                 18180001
181810                                                                  18181003
181820 9995-WRITE-CICS-FOR-DEBUG.                                       18182003
181830     IF KRPRPM-FUNC-TXT = 'Y'                                     18183003
181840         MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-CLENG              18184003
181850         EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA) 18185003
181860              LENGTH(PV-CLENG) NOHANDLE                           18186003
181870         END-EXEC                                                 18187003
181880         MOVE SPACES TO PV-CICS-MSG-AREA                          18188003
181890     END-IF.                                                      18189003
181891*                                                                 18189103
181900 9100-SYNCPOINT.                                                  18190001
182000                                                                  18200001
182100     EXEC CICS                                                    18210001
182200         SYNCPOINT                                                18220001
182300     END-EXEC.                                                    18230001
182400                                                                  18240001
182500******************************************************************18250001
182600*   STANDARD ABEND ROUTINE                                        18260001
182700* ==> PROCESSES:                                                  18270001
182800*   - ISSUES THE ABEND.                                           18280001
182900******************************************************************18290001
183000 Z999-ABEND.                                                      18300001
183100     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           18310001
183200     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          18320001
183300     INITIALIZE DP013-SRC-TASK-NUMBER                             18330001
183400                DP013-STACK.                                      18340001
183500     SET DP013-LINK-RETURN TO TRUE.                               18350001
183600     SET DP013-ROLLBACK    TO TRUE.                               18360001
183700                                                                  18370001
183800     EXEC CICS                                                    18380001
183900         LINK                                                     18390001
184000             PROGRAM  (DP013-NAME)                                18400001
184100             COMMAREA (DP013-PARAMETERS)                          18410001
184200             LENGTH   (DP013-LENGTH)                              18420001
184300     END-EXEC.                                                    18430001
184400                                                                  18440001
184500                                                                  18450001
184600     EXEC CICS                                                    18460001
184700         RETURN                                                   18470001
184800     END-EXEC.                                                    18480001
184900                                                                  18490001
185000******************************************************************18500001
185100*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *18510001
185200*    AND THE ERROR SWITCHES.                                     *18520001
185300******************************************************************18530001
185400 Z900-SOFT-ABORT.                                                 18540001
185500     SET PS-ERROR         TO TRUE.                                18550001
185600     IF PS-UPDATES-DONE AND SQLCODE = -913                        18560001
185700        PERFORM Z901-BACKUP                                       18570001
185800     END-IF.                                                      18580001
185900                                                                  18590001
186000     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          18600001
186100                                                                  18610001
186200 Z901-BACKUP.                                                     18620001
186300     EXEC CICS SYNCPOINT                                          18630001
186400          ROLLBACK                                                18640001
186500     END-EXEC.                                                    18650001
186600                                                                  18660001
