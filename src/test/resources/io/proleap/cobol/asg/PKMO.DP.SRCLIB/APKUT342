000100*------------------------*                                        00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*------------------------*                                        00030002
000400 PROGRAM-ID.     APKUT342.                                        00040019
000500 AUTHOR.         KEVIN CATLIN.                                    00050002
000600 DATE-WRITTEN.   DECEMBER, 2008.                                  00060002
000700*----------------------------------------------------------------*00070028
000800*    CHECK EDI 210 AUDIT FILE FOR INVOICES WITH DUPLICATE        *00080028
000900*    PO/CONTAINER.  CREATE SEPARATE OUTPUT FILES FOR RECORDS     *00090028
001000*    THAT PASS THE AUDIT AND FOR RECORDS THAT ARE DUPLICATES.    *00100028
001100*----------------------------------------------------------------*00110028
001200*    COBOL 2                                                     *00120028
001300*----------------------------------------------------------------*00130028
001400*    PROGRAM OVERVIEW:                                           *00140028
001500*    CHECK EDI 210 AUDIT FILE FOR INVOICES WITH DUPLICATE        *00150028
001600*    PO/CONTAINER.  CREATE SEPARATE OUTPUT FILES FOR RECORDS     *00160028
001700*    THAT PASS THE AUDIT AND FOR RECORDS THAT ARE DUPLICATES.    *00170028
001800*                                                                *00180028
001900*----------------------------------------------------------------*00190028
002000* INPUT:                                                         *00200028
002100* 1. EDI IMPORT EXPENSE INVOICE RECORD    (APRD019)              *00210028
002200*                                                                *00220028
002300* OUTPUT:                                                        *00230028
002400* 1. IMPORT EXPENSE INVOICES TO AUDIT     (APRD019)              *00240028
002500* 2. REJECTED EDI INVOICES TO REPORT      (APRD018)              *00250028
002600*                                                                *00260028
002700*--------------------------------------------------------------- *00270028
002800* CHANGE LOG:                                                    *00280028
002900*   DATE  03/17/2009                                             *00290028
003000*       CHANGE MADE: RENAME OF APKUT322 PROGRAM.                 *00300028
003100*       MADE BY: KEVIN CATLIN       WR/IR #: INC000000739121     *00310028
003110*                                                                *00311028
003200*   DATE  10/20/2009                                             *00320028
003210*       CHANGE MADE:  RECOMPILE FOR 310 EDI PROJECT.             *00321028
003271*       COPYBOOK APRD018 WENT FROM 475 TO 750 BYTES.             *00327128
003272*       MADE BY: PAUL STROEDE            WR/IR #: WR23145        *00327228
003273*                                                                *00327328
003274*   DATE  05/25/2010                                             *00327428
003275*       CHANGE MADE:  RECOMPILE FOR CHANGES TO APWS010 COPYBOOK  *00327528
003276*       MADE BY: PAUL STROEDE           WR/IR #: PKE000000003991 *00327628
003277*                                                                *00327728
003278*   DATE  08/24/2015                                             *00327828
003279*       CHANGE MADE:  RECOMPILE FOR CHANGES TO APWS010 COPYBOOK  *00327928
003280*       MADE BY: MEENAKSHI MITTAL        WR/IR #: CHG0112172     *00328028
003281*                                                                *00328128
003290*   DATE  10/21/2015                                             *00329028
003291*       CHANGE MADE:  RECOMPILE FOR CHANGES TO APRD018 COPYBOOK  *00329128
003292*       MADE BY: MEENAKSHI MITTAL        WR/IR #: CHG0126130     *00329228
003293*                                                                *00329328
003294* DATE  11/02/2020                                               *00329428
003295*    CHANGE MADE: RECOMPILED TO INCLUDE CHANGES TO COPYBOOK      *00329528
003296*    APWS010.                                                    *00329628
003297*    MADE BY: NANCY EILBES            WR/IR #: CHG0250510        *00329728
007010*                                                               * 00329829
007020* DATE  05/10/2023                                              * 00329930
007030*    CHANGE MADE: RECOMPILED FOR CHANGES TO COPYBOOK APWS010    * 00330029
007050*    MADE BY: JEAN KURK               WR/IR #: CHG0288104       * 00331030
003300*----------------------------------------------------------------*00340028
003600 ENVIRONMENT DIVISION.                                            00360002
003800 CONFIGURATION SECTION.                                           00380002
003900 SOURCE-COMPUTER.    IBM-3090.                                    00390002
004000 OBJECT-COMPUTER.    IBM-3090.                                    00400002
004100                                                                  00410000
004200 INPUT-OUTPUT SECTION.                                            00420000
004300 FILE-CONTROL.                                                    00430000
004400                                                                  00440000
004500     SELECT EDI-INPUT-FILE    ASSIGN TO INP01.                    00450000
004600     SELECT AUDIT-EDI-FILE    ASSIGN TO OUT01.                    00460000
004700     SELECT REJECT-EDI-FILE   ASSIGN TO OUT02.                    00470000
004800                                                                  00480000
005000 DATA DIVISION.                                                   00500002
005200 FILE SECTION.                                                    00520000
005300                                                                  00530000
005400 FD  EDI-INPUT-FILE                                               00540000
005500     RECORDING MODE IS  F                                         00550000
005600     LABEL RECORDS  ARE STANDARD                                  00560000
005700     DATA RECORD    IS  EDI-INPUT-RECORD.                         00570000
005800 01  EDI-INPUT-RECORD              PIC X(360).                    00580000
005900                                                                  00590000
006000 FD  AUDIT-EDI-FILE                                               00600000
006100     RECORDING MODE IS  F                                         00610000
006200     LABEL RECORDS  ARE STANDARD                                  00620000
006300     DATA RECORD    IS  AUDIT-EDI-RECORD.                         00630000
006400 01  AUDIT-EDI-RECORD              PIC X(360).                    00640000
006500                                                                  00650000
006600 FD  REJECT-EDI-FILE                                              00660000
006700     RECORDING MODE IS  F                                         00670000
006800     LABEL RECORDS  ARE STANDARD                                  00680000
006900     DATA RECORD    IS  REJECT-EDI-RECORD.                        00690000
007000 01  REJECT-EDI-RECORD             PIC X(750).                    00700020
007100                                                                  00710000
007200 WORKING-STORAGE SECTION.                                         00720000
007300                                                                  00730000
007400 01  FILLER                          PIC X(27) VALUE              00740008
007500           '** START OF GLKUT084 W/S **'.                         00750006
007600                                                                  00760000
007700 01  ABEND-CODE                      PIC S9(4) COMP SYNC          00770000
007800                                               VALUE ZEROS.       00780000
007900     88 AC-TABLE-FULL                VALUE +4004.                 00790000
008000     88 AC-EMPTY-FILE                VALUE +4005.                 00800000
008100                                                                  00810000
008200 01  ABEND-AREAS.                                                 00820000
008300     05  AA-ABEND-LIT              PIC  X(40)   VALUE             00830000
008400             '*****       ABEND'.                                 00840000
008500     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             00850000
008600             '*****   PROGRAM: GLKUT084'.                         00860000
008700     05  AA-PARAGRAPH-LIT.                                        00870000
008800         10  FILLER                PIC  X(17)   VALUE             00880000
008900             '***** PARAGRAPH: '.                                 00890000
009000         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     00900000
009100     05  AA-MESSAGE-LINE-1.                                       00910000
009200         10  FILLER                PIC  X(06)   VALUE '*****'.    00920000
009300         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     00930000
009400     05  AA-MESSAGE-LINE-2.                                       00940000
009500         10  FILLER                PIC  X(06)   VALUE '*****'.    00950000
009600         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     00960000
009700                                                                  00970000
009800 01  WS-HOLD-AREA.                                                00980001
009900     05  WS-HOLD-PO-NBR              PIC X(09)     VALUE SPACES.  00990005
010000     05  WS-HOLD-CONTAINER-ID        PIC X(12)     VALUE SPACES.  01000005
010100                                                                  01010000
010200 01  PV-PROGRAM-VARIABLES.                                        01020004
010300     05  PV-EDIIN-REC-CNT            PIC 9(9)      VALUE ZEROS.   01030004
010400     05  PV-AUDIT-REC-CNT            PIC 9(9)      VALUE ZEROS.   01040004
010500     05  PV-REJECT-REC-CNT           PIC 9(9)      VALUE ZEROS.   01050004
010600                                                                  01060000
010700 01  PS-PROGRAM-SWITCHES.                                         01070004
010800     05  PS-RECORD-SW                PIC X(01)     VALUE 'N'.     01080004
010900         88  ACCEPT-RECORD                         VALUE 'Y'.     01090004
011000         88  REJECT-RECORD                         VALUE 'N'.     01100004
011100     05  END-OF-EDIIN-SW             PIC X(01)     VALUE ' '.     01110000
011200         88  END-OF-EDIIN                          VALUE 'Y'.     01120000
011300                                                                  01130005
011400*----------------------------------------------------------------*01140000
011500*  IMPORT EXPENSE INVOICE AUDIT OUTPUT FILE.                      01150000
011600*----------------------------------------------------------------*01160000
011700     COPY APRD019.                                                01170000
011800*----------------------------------------------------------------*01180000
011900*  EDI IMPORT INVOICE REJECTION OUTPUT FILE.                      01190000
012000*----------------------------------------------------------------*01200000
012100     COPY APRD018.                                                01210000
012200*----------------------------------------------------------------*01220000
012300*  EDI IMPORT LANDED COST INVOICE EDIT CODES.                     01230000
012400*----------------------------------------------------------------*01240000
012500 01  WS-EDIT-CODES.                                               01250000
012600     COPY APWS010.                                                01260000
012700                                                                  01270000
012800 01  FILLER                        PIC X(25) VALUE                01280000
012900          '** END OF APKUT342 W/S **'.                            01290019
013100 PROCEDURE DIVISION.                                              01310002
013300 A100-MAINLINE.                                                   01330000
013400                                                                  01340000
013500     PERFORM B100-INITIALIZE.                                     01350000
013600                                                                  01360000
013700     PERFORM B200-PROCESS-EDI-AUDIT-FILE UNTIL END-OF-EDIIN.      01370005
013800                                                                  01380000
013900     PERFORM B300-END-OF-PROGRAM.                                 01390005
014000                                                                  01400000
014100     GOBACK.                                                      01410000
014200                                                                  01420000
014300*--------------------------------------------------------------- *01430028
014400* OPEN FILES, INITIALIZE RECORD LAYOUTS, AND PERFORM INITIAL      01440006
014500* READ OF INPUT FILE.                                             01450006
014600*--------------------------------------------------------------- *01460028
014700 B100-INITIALIZE.                                                 01470000
014800                                                                  01480000
014900     DISPLAY '****-----------------------------------------****'. 01490017
015000     DISPLAY '**----    START OF APKUT342 PROCESSING!    ----**'. 01500019
015100     DISPLAY '****-----------------------------------------****'. 01510017
015200                                                                  01520000
015300     OPEN  INPUT   EDI-INPUT-FILE.                                01530000
015400     OPEN  OUTPUT  AUDIT-EDI-FILE                                 01540000
015500                   REJECT-EDI-FILE.                               01550000
015600                                                                  01560000
015700     INITIALIZE AP018-REJECT-IMPORT-INVOICE                       01570000
015800                AP019-IMPORT-EXP-AUDIT-RECORD                     01580004
015900                PV-PROGRAM-VARIABLES                              01590004
016000                WS-HOLD-AREA                                      01600004
016100                PS-PROGRAM-SWITCHES.                              01610004
016200                                                                  01620000
016300     PERFORM R100-READ-EDI-INPUT.                                 01630000
016400                                                                  01640000
016500     IF END-OF-EDIIN                                              01650000
016600        DISPLAY '***************************************'         01660000
016700        DISPLAY '* INPUT FILE IS EMPTY.  NO INVOICES   *'         01670000
016800        DISPLAY '* TO PROCESS.                         *'         01680000
016900        DISPLAY '***************************************'         01690000
017000     END-IF.                                                      01700000
017100                                                                  01710000
017200*--------------------------------------------------------------- *01720028
017300* PROCESS EDI 210 AUDIT FILE.                                     01730005
017400*--------------------------------------------------------------- *01740028
017500 B200-PROCESS-EDI-AUDIT-FILE.                                     01750005
017600                                                                  01760000
017700     IF AP019-CONTAINER-ID NOT EQUAL SPACES                       01770014
017800        IF AP019-PO-NBR = WS-HOLD-PO-NBR                          01780014
017900        AND AP019-CONTAINER-ID = WS-HOLD-CONTAINER-ID             01790014
018000            SET PO-CONTNR-DUP-FILE-ERR TO TRUE                    01800014
018100            SET REJECT-RECORD TO TRUE                             01810014
018200        ELSE                                                      01820014
018300            SET ACCEPT-RECORD TO TRUE                             01830014
018400        END-IF                                                    01840015
018500     ELSE                                                         01850014
018600         SET ACCEPT-RECORD TO TRUE                                01860014
018700     END-IF.                                                      01870000
018800                                                                  01880000
018900     IF ACCEPT-RECORD                                             01890000
019000        PERFORM W100-WRITE-AUDIT-RECORD                           01900001
019100     ELSE                                                         01910000
019200        PERFORM C100-FORMAT-REJECT                                01920001
019300        PERFORM W200-WRITE-REJECT-RECORD                          01930001
019400     END-IF.                                                      01940000
019500                                                                  01950000
019600     PERFORM R100-READ-EDI-INPUT.                                 01960004
019700                                                                  01970004
019800*--------------------------------------------------------------- *01980028
019900* CLOSE FILES AND DISPLAY COUNTER TOTALS.                         01990005
020000*--------------------------------------------------------------- *02000028
020100 B300-END-OF-PROGRAM.                                             02010005
020200                                                                  02020000
020300     DISPLAY '****-----------------------------------------****'. 02030017
020400     DISPLAY 'TOTAL INVOICE RECORDS READ     = ' PV-EDIIN-REC-CNT 02040008
020500     DISPLAY 'TOTAL INVOICES TO AUDIT FILE   = ' PV-AUDIT-REC-CNT 02050008
020600     DISPLAY 'TOTAL INVOICES TO REJECT FILE  = ' PV-REJECT-REC-CNT02060008
020700     DISPLAY '****-----------------------------------------****'. 02070017
020800     DISPLAY '****-----------------------------------------****'. 02080017
020900     DISPLAY '**----     END OF APKUT342 PROCESSING!     ----**'. 02090019
021000     DISPLAY '****-----------------------------------------****'. 02100017
021100                                                                  02110000
021200     CLOSE EDI-INPUT-FILE                                         02120011
021300           AUDIT-EDI-FILE                                         02130011
021400           REJECT-EDI-FILE.                                       02140011
021500                                                                  02150011
021600*--------------------------------------------------------------- *02160028
021700* PROCESS A VENDOR/INVOICE THAT HAS AN ERROR AND WRITE IT OUT TO  02170001
021800* THE REJECT FILE.  THERE WILL BE ONE RECORD FOR EACH VENDOR/IN-  02180000
021900* VOICE THAT HAS AN ERROR.                                        02190001
022000*--------------------------------------------------------------- *02200028
022100 C100-FORMAT-REJECT.                                              02210001
022200                                                                  02220000
022300     SET AP018-REJECT-REPORT TO TRUE.                             02230002
022400                                                                  02240002
022500     SET CHRG-IDX TO 1.                                           02250002
022600     PERFORM F200-MOVE-CHARGES                                    02260002
022700     VARYING AP019-IDX FROM 1 BY 1                                02270002
022800       UNTIL AP019-IDX > 20 OR                                    02280002
022900             AP019-CHARGE-CDE(AP019-IDX) = SPACE.                 02290002
023000                                                                  02300002
023100     SET AP018-IDX                   TO 1.                        02310002
023200     MOVE WS010-ERROR-CODES          TO AP018-ERR-CDE(AP018-IDX). 02320002
023300     MOVE AP019-PO-NBR               TO AP018-PO-NBR.             02330002
023400     MOVE AP019-INVOICE-NBR          TO AP018-INVOICE-NBR.        02340002
023500     MOVE AP019-VENDOR-NBR           TO AP018-VENDOR-NBR.         02350002
023600     MOVE AP019-INVC-DTE             TO AP018-INVC-DTE.           02360002
023700     MOVE AP019-NET-INVC-AMT         TO AP018-NET-INVC-AMT.       02370002
023800     MOVE AP019-VENDOR-NAME          TO AP018-VENDOR-NAME.        02380002
023900     MOVE AP019-PO-QTY               TO AP018-PO-QTY.             02390002
024000     MOVE AP019-PO-WEIGHT            TO AP018-PO-WEIGHT.          02400002
024100     MOVE AP019-PO-UOM-CDE           TO AP018-PO-UOM-CDE.         02410002
024200     MOVE AP019-TOTAL-DRAYAGE-AMT    TO AP018-TOTAL-DRAYAGE-AMT.  02420002
024300     MOVE AP019-TOTAL-DECONSOL-AMT   TO AP018-TOTAL-DECONSOL-AMT. 02430002
024400                                                                  02440002
024500     EVALUATE TRUE                                                02450002
024600         WHEN AP019-CONTAINER-ID NOT EQUAL TO SPACES              02460007
024700              MOVE AP019-CONTAINER-ID TO AP018-REFERENCE-ID-NBR   02470007
024800              SET  AP018-CONTAINER-ID TO TRUE                     02480007
024900         WHEN AP019-ENTRY-NBR NOT EQUAL TO SPACES                 02490002
025000              MOVE AP019-ENTRY-NBR TO AP018-REFERENCE-ID-NBR      02500002
025100              SET  AP018-ENTRY-NBR TO TRUE                        02510002
025200         WHEN AP019-BOL-ID NOT EQUAL TO SPACES                    02520002
025300              MOVE AP019-BOL-ID TO AP018-REFERENCE-ID-NBR         02530002
025400              SET  AP018-BOL-NBR TO TRUE                          02540002
025500     END-EVALUATE.                                                02550002
025600                                                                  02560002
025700*----------------------------------------------------------------*02570002
025800*    MOVE CHARGES FROM THE AUDIT RECORD TO THE REJECT RECORD     *02580002
025900*----------------------------------------------------------------*02590002
026000 F200-MOVE-CHARGES.                                               02600002
026100                                                                  02610002
026200     MOVE AP019-CHARGE-AMT(AP019-IDX)                             02620002
026300                                    TO AP018-CHARGE-AMT(CHRG-IDX) 02630002
026400     MOVE AP019-CHARGE-CDE(AP019-IDX)                             02640002
026500                                    TO AP018-CHARGE-CDE(CHRG-IDX).02650002
026600     SET CHRG-IDX UP BY 1.                                        02660002
026700                                                                  02670002
026800*--------------------------------------------------------------- *02680028
026900* READ THE EDI 210 INVOICE FILE.                                  02690000
027000*--------------------------------------------------------------- *02700028
027100 R100-READ-EDI-INPUT.                                             02710000
027200                                                                  02720000
027300     READ EDI-INPUT-FILE INTO AP019-IMPORT-EXP-AUDIT-RECORD       02730009
027400        AT END                                                    02740000
027500           SET END-OF-EDIIN TO TRUE                               02750000
027600        NOT AT END                                                02760000
027700           ADD +1 TO PV-EDIIN-REC-CNT                             02770004
027800     END-READ.                                                    02780000
027900                                                                  02790000
028000*--------------------------------------------------------------- *02800028
028100* WRITE OUT A RECORD TO THE AUDIT FILE.                           02810000
028200*--------------------------------------------------------------- *02820028
028300 W100-WRITE-AUDIT-RECORD.                                         02830000
028400                                                                  02840000
028500     WRITE AUDIT-EDI-RECORD FROM AP019-IMPORT-EXP-AUDIT-RECORD.   02850000
028600                                                                  02860001
028700     ADD 1 TO PV-AUDIT-REC-CNT.                                   02870004
028800                                                                  02880004
028900     IF AP019-CONTAINER-ID NOT EQUAL SPACES                       02890014
029000        MOVE AP019-PO-NBR       TO WS-HOLD-PO-NBR                 02900016
029100        MOVE AP019-CONTAINER-ID TO WS-HOLD-CONTAINER-ID           02910016
029200     END-IF.                                                      02920014
029300                                                                  02930001
029400     INITIALIZE AP019-IMPORT-EXP-AUDIT-RECORD.                    02940000
029500                                                                  02950000
029600*--------------------------------------------------------------- *02960028
029700* WRITE OUT A RECORD TO THE REJECT FILE.                          02970000
029800*--------------------------------------------------------------- *02980028
029900 W200-WRITE-REJECT-RECORD.                                        02990000
030000                                                                  03000000
030100     WRITE REJECT-EDI-RECORD FROM AP018-REJECT-IMPORT-INVOICE.    03010000
030200                                                                  03020006
030300     ADD 1 TO PV-REJECT-REC-CNT.                                  03030006
030400                                                                  03040006
030500     INITIALIZE AP018-REJECT-IMPORT-INVOICE.                      03050000
030600                                                                  03060000
