000100****************************************************************  00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300****************************************************************  00030000
000400 PROGRAM-ID.    TMKUT021.                                         00040036
000500 AUTHOR.        THERESE RAMSEYER.                                 00050001
000600 DATE-WRITTEN.  DECEMBER, 2004.                                   00060001
000700                                                                  00070000
000800****************************************************************  00080000
000900*   THIS PROGRAM EXTRACTS PO/RECEIVER INFORMATION FOR THE         00090001
001000*   AUTOACKNOWLEDGE PROCESS. THIS INFORMATION WILL BE             00100001
001100*   USED TO CREATE THE "FLOWBACK ORDERS ALLOCATED" REPORT.        00110001
001200****************************************************************  00120000
      * CHANGE LOG:                                                     00121098
      *  09/26/2022  JEAN KURK  RECOMPILE FOR COBOL UPGRADE             00122098
      *                                CHG0274597                       00123098
001200****************************************************************  00124098
001300                                                                  00130000
001400****************************************************************  00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600****************************************************************  00160000
001700                                                                  00170000
001800****************************************************************  00180000
001900 INPUT-OUTPUT SECTION.                                            00190000
002000****************************************************************  00200000
002100                                                                  00210000
002200****************************************************************  00220000
002300 FILE-CONTROL.                                                    00230000
002400****************************************************************  00240000
002500     SELECT EXTRACT-FILE                                          00250000
002600         ASSIGN TO OUT01.                                         00260000
002601                                                                  00260159
002610     SELECT TIMESTAMP-FILE                                        00261059
002620         ASSIGN TO INP01.                                         00262059
002700                                                                  00270000
002800****************************************************************  00280000
002900 DATA DIVISION.                                                   00290000
003000****************************************************************  00300000
003100                                                                  00310000
003200****************************************************************  00320000
003300 FILE SECTION.                                                    00330000
003400****************************************************************  00340000
003500                                                                  00350000
003600 FD  EXTRACT-FILE                                                 00360000
003700     RECORDING MODE IS F                                          00370000
003800     LABEL RECORDS ARE STANDARD                                   00380000
003900     RECORD CONTAINS 200                                          00390033
004000     BLOCK CONTAINS 0 RECORDS                                     00400000
004100     DATA RECORD IS EXTRACT-RECORD.                               00410000
004200 01  EXTRACT-RECORD                      PIC  X(200).             00420033
004210                                                                  00421059
004220 FD  TIMESTAMP-FILE                                               00422059
004230     RECORDING MODE IS F                                          00423059
004240     LABEL RECORDS ARE STANDARD                                   00424059
004250     RECORD CONTAINS 26                                           00425059
004260     BLOCK CONTAINS 0 RECORDS                                     00426059
004270     DATA RECORD IS EXTRACT-RECORD.                               00427059
004280 01  TIMESTAMP-RECORD                    PIC  X(26).              00428059
004300                                                                  00430000
004400/                                                                 00440000
004500 WORKING-STORAGE SECTION.                                         00450000
004600                                                                  00460000
004700 01  ABEND-CODE                          PIC S9(04)  VALUE ZERO   00470000
004800                                                     COMP SYNC.   00480000
004900 01  PA-PROGRAM-ACCUMULATORS.                                     00490005
005000     05  PA-PKSL-ITM-QTY                PIC S9(09)   VALUE ZERO   00500005
005100                                                     COMP SYNC.   00510000
005200     05  PA-COUNT                       PIC S9(09)   VALUE +0     00520005
005300                                                     COMP SYNC.   00530005
005400     05  PA-TOT-TRBLS-READ              PIC S9(09)   VALUE +0     00540010
005500                                                     COMP-3.      00550005
005600     05  PA-TOT-RECS-WRITTEN            PIC S9(09)   VALUE +0     00560010
005700                                                     COMP-3.      00570005
005800                                                                  00580005
005900 01  PV-PROGRAM-VARIABLES.                                        00590005
006000     05  PV-RECEIV-REC-DATE              PIC  X(10)  VALUE SPACE. 00600005
006100     05  PV-ABEND-PARAGRAPH              PIC  X(30)  VALUE SPACE. 00610000
006200     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 00620000
006210     05  PV-DISPLAY-COUNT                PIC  ZZZ,ZZZ,ZZ9.        00621010
006220     05  PV-TIME-UNIT                    PIC  S9(06) COMP-3.      00622041
006221     05  PV-START-TIMESTAMP              PIC  X(26)  VALUE SPACES.00622160
006222     05  PV-END-TIMESTAMP                PIC  X(26)  VALUE SPACES.00622260
006223     05  PV-CURR-TIMESTAMP               PIC  X(26)  VALUE SPACES.00622361
006224     05  PV-PBS-STORE-COUNT              PIC  S9(9)  VALUE 0 COMP.00622489
006225                                                                  00622588
006230 01  DK-DB2-KEYS.                                                 00623045
006240     05  DK-ORD-NBR                      PIC S9(09)  VALUE ZEROS  00624045
006250                                                     COMP.        00625045
006260     05  DK-REC-SEQ-NBR                  PIC S9(09)  VALUE ZEROS  00626045
006270                                                     COMP.        00627045
006280     05  DK-ORD-LNE-NBR                  PIC S9(09)  VALUE ZEROS  00628045
006290                                                     COMP.        00629045
006294     05  DK-OPER-UNT-ID                  PIC S9(4)   VALUE 0      00629490
006295                                                     COMP.        00629590
006300                                                                  00630000
006400 01  CC-CONTROL-CARD.                                             00640000
006500     05  CC-TIME-UNIT                PIC  9(06)      VALUE 0.     00650041
006600     05  FILLER                      PIC  X(74)      VALUE SPACE. 00660041
006700                                                                  00670000
006800 01  PC-PROGRAM-CONSTANTS.                                        00680000
006900     05  PC-N                            PIC  X(01)  VALUE 'N'.   00690000
007000     05  PC-Y                            PIC  X(01)  VALUE 'Y'.   00700000
007100     05  PC-A                            PIC  X(01)  VALUE 'A'.   00710002
007200     05  PC-IP                           PIC  X(02)  VALUE 'IP'.  00720000
007300     05  PC-CM                           PIC  X(02)  VALUE 'CM'.  00730000
007400     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00740000
007500         'TMKUT021'.                                              00750036
007600     05  PC-PGM-DPKUT500                 PIC  X(08)  VALUE        00760000
007700         'DPKUT500'.                                              00770000
007800     05  PC-INIT-DATE                    PIC  X(10)  VALUE        00780000
007900         '9999-09-09'.                                            00790000
008000     05  PC-DEFAULT-DATE                 PIC  X(26)  VALUE        00800000
008100         '9999-00-00-00.00.00.000000'.                            00810000
008200     05  PC-DEFAULT                      PIC  X(10)  VALUE        00820074
008300         '09/09/9999'.                                            00830075
008310     05  PC-DEFAULT-TMST                 PIC  X(26)  VALUE        00831077
008320         '9999-09-09-09.09.09.999999'.                            00832077
008400                                                                  00840000
008500 01  PS-PROGRAM-SWITCHES.                                         00850000
008600     05  PS-END-TRBL-CSR-SW              PIC X(01)  VALUE 'N'.    00860005
008700         88  PS-END-OF-TRBL-CSR                     VALUE 'Y'.    00870005
008800         88  PS-END-OF-TRBL-CSR-NO                  VALUE 'N'.    00880005
008900     05  PS-TRBL-FOUND-SW                PIC  X(01) VALUE 'N'.    00890005
009000         88  PS-TRBL-FOUND                          VALUE 'Y'.    00900005
009100         88  PS-TRBL-FOUND-NO                       VALUE 'N'.    00910005
009200     05  PS-END-OF-RECITM-CSR-SW         PIC  X(01) VALUE 'N'.    00920010
009300         88  PS-END-OF-RECITM-CSR                   VALUE 'Y'.    00930010
009400         88  PS-END-OF-RECITM-CSR-NO                VALUE 'N'.    00940005
009410     05  PS-TWKORIN-CURSOR-SW            PIC  X(01)  VALUE 'N'.   00941044
009420         88  PS-EOF-TWKORIN-CSR                      VALUE 'Y'.   00942044
009470     05  PS-TWKORIN-ZERO-SW              PIC  X(01)  VALUE 'N'.   00947044
009480         88  PS-EOF-TWKORIN-ZERO                     VALUE 'Y'.   00948044
009490     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00949065
009491         88  PS-THERE-IS-AN-ERROR                    VALUE 'Y'.   00949165
009492         88  PS-NO-ERRORS                            VALUE 'N'.   00949265
009493     05  PS-PO-SW                        PIC  X(01)  VALUE 'N'.   00949369
009494         88  PS-PO-FOUND                             VALUE 'Y'.   00949469
009495         88  PS-PO-NOT-FOUND                         VALUE 'N'.   00949569
009500                                                                  00950000
009600*                                                                 00960000
009700*  DCLGEN FOR THE DB2 WORK ORDER INSTRUCTION TABLE                00970000
009800*                                                                 00980000
009900     EXEC SQL                                                     00990000
010000          INCLUDE TWKORIN                                         01000000
010100     END-EXEC.                                                    01010000
010200                                                                  01020000
010300*                                                                 01030006
010400*  DCLGEN FOR THE DB2 AUTO ACKNOWLEDGE TROUBLE TABLE              01040006
010500*  RCT_AUTOACKNL_TRBL                                             01050009
010510*                                                                 01051009
010600     EXEC SQL                                                     01060006
010700          INCLUDE RCT00020                                        01070009
010800     END-EXEC.                                                    01080006
010900                                                                  01090006
010910*                                                                 01091054
010920*  DCLGEN FOR TSHPTPO                                             01092054
010940*                                                                 01094054
010950     EXEC SQL                                                     01095054
010960          INCLUDE TSHPTPO                                         01096054
010970     END-EXEC.                                                    01097054
010980                                                                  01098054
010990*                                                                 01099090
010991*  DCLGEN FOR TALLPLN                                             01099190
010992*                                                                 01099290
010993     EXEC SQL                                                     01099390
010994          INCLUDE TALLPLN                                         01099490
010995     END-EXEC.                                                    01099590
010996                                                                  01099690
010997*                                                                 01099790
010998*  DCLGEN FOR TMESTDS                                             01099890
010999*                                                                 01099990
011000     EXEC SQL                                                     01100090
011001          INCLUDE TMESTDS                                         01100190
011002     END-EXEC.                                                    01100290
011003                                                                  01100390
011010*                                                                 01101090
011100*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       01110000
011200*                                                                 01120000
011300     COPY DPWS004.                                                01130000
011400                                                                  01140000
011500*  COPY BOOK FOR THE RECEIVER EXTRACT FILE                        01150000
011600*                                                                 01160000
011700     COPY TMRD008.                                                01170057
011800                                                                  01180000
011900*                                                                 01190000
012000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PURCHASE ORDER     01200000
012100*  HEADER TABLE                                                   01210000
012200*                                                                 01220000
012300     EXEC SQL                                                     01230000
012400          INCLUDE TPURCHS                                         01240000
012500     END-EXEC.                                                    01250000
012600                                                                  01260000
012700*                                                                 01270000
012800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE ENTERPRIZE NAME    01280000
012900*  TABLE.                                                         01290000
013000*                                                                 01300000
013100     EXEC SQL                                                     01310000
013200          INCLUDE TENTNME                                         01320000
013300     END-EXEC.                                                    01330000
013400                                                                  01340000
013500*                                                                 01350000
013600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIVER TABLE     01360000
013700*                                                                 01370000
013800     EXEC SQL                                                     01380000
013900          INCLUDE TRECEIV                                         01390000
014000     END-EXEC.                                                    01400000
014100                                                                  01410000
014200*                                                                 01420000
014300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIPT ITEM TABLE 01430000
014400*                                                                 01440000
014500     EXEC SQL                                                     01450000
014600          INCLUDE TRECITM                                         01460000
014700     END-EXEC.                                                    01470000
014800                                                                  01480000
014900*                                                                 01490000
015000* DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TROUBLE NOTIFICATION01500005
015100*                                                                 01510000
015200     EXEC SQL                                                     01520000
015300          INCLUDE TTRBNTF                                         01530000
015400     END-EXEC.                                                    01540000
015500                                                                  01550000
015600*                                                                 01560000
015700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TROUBLE REASON CODE01570000
015800*  TABLE.                                                         01580000
015900*                                                                 01590000
016000     EXEC SQL                                                     01600000
016100          INCLUDE TTRBRSN                                         01610000
016200     END-EXEC.                                                    01620000
016210*                                                                 01621085
016220*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TROUBLE PROGRAM    01622085
016230*  TABLE.                                                         01623085
016240*                                                                 01624085
016250     EXEC SQL                                                     01625085
016260          INCLUDE TTRBRCN                                         01626085
016270     END-EXEC.                                                    01627085
016300                                                                  01630000
016400*                                                                 01640000
016500*                                                                 01650000
016600*  COMMUNICATION AREAS FOR DB2                                    01660000
016700*                                                                 01670000
016800     EXEC SQL                                                     01680000
016900         INCLUDE SQLCA                                            01690000
017000     END-EXEC.                                                    01700000
017100                                                                  01710000
017200*                                                                 01720000
017300******************************************************************01730000
017400*  TRBL CURSOR                                                   *01740002
017500******************************************************************01750000
017600     EXEC SQL                                                     01760000
017700          DECLARE TRBL-CSR CURSOR FOR                             01770002
017800          SELECT A.NOTIF_NBR                                      01780012
017900                ,OPER_UNT_ID                                      01790002
018000                ,DEPT_NBR                                         01800002
018100                ,ENT_ID                                           01810013
018200                ,PO_NBR                                           01820002
018300                ,PO_LNE_NBR                                       01830002
018400                ,REC_SEQ_NBR                                      01840002
018500                ,B.TRBL_RSN_CDE                                   01850087
018510                ,AUTOACKNL_END_TMST                               01851059
018600          FROM   RCT_AUTOACKNL_TRBL A                             01860002
018700                ,TTRBNTF            B                             01870002
018800          WHERE  A.AUTOACKNL_END_TMST >                           01880069
018820                         :PV-START-TIMESTAMP                      01882059
018830          AND    A.AUTOACKNL_END_TMST <> :PC-DEFAULT-TMST         01883077
019000          AND    A.AUTOACKNL_STAT_CDE  =  'CMPLT'                 01900014
019100          AND    A.NOTIF_NBR           =  B.NOTIF_NBR             01910014
019110          ORDER BY AUTOACKNL_END_TMST                             01911071
019200     END-EXEC.                                                    01920000
019300                                                                  01930000
019400******************************************************************01940000
019500*  TRECITM CURSOR                                                *01950000
019600******************************************************************01960000
019700     EXEC SQL                                                     01970000
019800          DECLARE RECITM-CSR CURSOR FOR                           01980022
019900           SELECT ORD_LNE_NBR                                     01990000
020000                , PKSL_ITM_QTY                                    02000000
020100                , DTL_CK_ITM_QTY                                  02010000
020200             FROM TRECITM                                         02020000
020300            WHERE ORD_NBR          =  :RECEIV-ORD-NBR             02030000
020400              AND REC_SEQ_NBR      =  :RECEIV-REC-SEQ-NBR         02040000
020500              AND STATUS_CDE        IN (:PC-IP, :PC-CM)           02050000
020600              AND VER_STATUS_CDE   = 'A'                          02060000
020700            WITH UR                                               02070000
020800     END-EXEC.                                                    02080000
020810******************************************************************02081044
020820*  TWKORIN CURSOR                                                *02082044
020830******************************************************************02083044
020831     EXEC SQL                                                     02083145
020850          DECLARE TWKORIN_CSR CURSOR FOR                          02085044
020860             SELECT  STRT_TMST,                                   02086044
020870                     STOP_TMST,                                   02087044
020880                     PRC_FCLTY_AREA_ID,                           02088044
020890                     SCREEN_SEQ_NBR,                              02089044
020891                     LNE_LOC_CDE                                  02089144
020892               FROM  TWKORIN                                      02089244
020893              WHERE  (ORD_NBR            =  :RECEIV-ORD-NBR       02089345
020894                AND   RCVR_SEQ_NBR       =  :RECEIV-REC-SEQ-NBR   02089445
020895                AND   ORD_LNE_NBR        =  :DK-ORD-LNE-NBR       02089545
020896                AND   WORK_ORD_SEQ_NBR   =  1                     02089644
020897                AND   OPER_UNT_ID        =  :RECEIV-OPER-UNT-ID   02089744
020898                AND   FCLTY_ID           =  :RECEIV-FCLTY-ID      02089844
020899                AND   VER_STATUS_CDE     =  'A')                  02089944
020900           ORDER BY  SCREEN_SEQ_NBR                               02090044
020901           WITH UR                                                02090144
020902     END-EXEC.                                                    02090244
020903                                                                  02090344
020904******************************************************************02090444
020905*  TWKORIN CURSOR - FOR LINE NUMBER = ZERO                       *02090544
020906******************************************************************02090644
020907     EXEC SQL                                                     02090744
020908          DECLARE WKORIN0_CSR CURSOR FOR                          02090844
020909             SELECT  STRT_TMST,                                   02090944
020910                     STOP_TMST,                                   02091044
020911                     PRC_FCLTY_AREA_ID,                           02091144
020912                     SCREEN_SEQ_NBR,                              02091244
020913                     LNE_LOC_CDE                                  02091344
020914               FROM  TWKORIN                                      02091444
020915              WHERE  (ORD_NBR            =  :RECEIV-ORD-NBR       02091545
020916                AND   RCVR_SEQ_NBR       =  :RECEIV-REC-SEQ-NBR   02091645
020917                AND   ORD_LNE_NBR        =  0                     02091744
020918                AND   WORK_ORD_SEQ_NBR   =  1                     02091844
020919                AND   OPER_UNT_ID        =  :RECEIV-OPER-UNT-ID   02091944
020920                AND   FCLTY_ID           =  :RECEIV-FCLTY-ID      02092044
020921                AND   VER_STATUS_CDE     = 'A')                   02092144
020922           ORDER BY  SCREEN_SEQ_NBR                               02092244
020923           WITH UR                                                02092344
020924     END-EXEC.                                                    02092444
020930                                                                  02093005
021000******************************************************************02100000
021100 PROCEDURE DIVISION.                                              02110000
021200******************************************************************02120000
021300                                                                  02130000
021400 0000-MAINLINE.                                                   02140000
021500                                                                  02150001
021600     PERFORM 1000-INITIALIZATION.                                 02160001
021700                                                                  02170001
021800     PERFORM 2000-PROCESS-TRBL-CSR                                02180005
021900       UNTIL PS-END-OF-TRBL-CSR.                                  02190005
022000                                                                  02200001
022100     PERFORM 2400-CLOSE-TRBL-CSR.                                 02210005
022200                                                                  02220005
022300     PERFORM 9000-TERMINATE.                                      02230001
022400                                                                  02240001
022410     IF PS-THERE-IS-AN-ERROR                                      02241065
022420        MOVE 4 TO RETURN-CODE                                     02242063
022430     END-IF.                                                      02243063
022440                                                                  02244063
022500     STOP RUN.                                                    02250001
022600                                                                  02260001
022700******************************************************************02270002
022800** INITIALIZE: OPEN OUTPUT, GET PARM FROM CONTROL CARD, INIT,     02280005
022900**             OPEN DRIVING CURSOR, PRIME FETCH                   02290002
023000******************************************************************02300002
023100 1000-INITIALIZATION.                                             02310001
023200                                                                  02320001
023300     OPEN OUTPUT EXTRACT-FILE.                                    02330059
023310     OPEN I-O    TIMESTAMP-FILE.                                  02331059
023400                                                                  02340000
023500     INITIALIZE TM008-RECEIVER-EXT-RECORD                         02350057
023600                PA-PROGRAM-ACCUMULATORS.                          02360005
023700                                                                  02370061
024210     READ TIMESTAMP-FILE INTO PV-START-TIMESTAMP.                 02421059
024220                                                                  02422061
024221     MOVE PV-START-TIMESTAMP TO PV-END-TIMESTAMP.                 02422168
024222                                                                  02422268
024230     SET PS-NO-ERRORS TO TRUE.                                    02423065
024240                                                                  02424063
024300     PERFORM 1200-OPEN-TRBL-CSR.                                  02430001
024400                                                                  02440001
024500     PERFORM 2200-FETCH-TRBL-CSR.                                 02450005
024600                                                                  02460001
024700******************************************************************02470002
024800*  OPEN THE TRBL-CSR (DRIVER).                                    02480002
024900******************************************************************02490002
025000 1200-OPEN-TRBL-CSR.                                              02500002
025100                                                                  02510002
025200     MOVE '1200-OPEN-TRBL-CSR'                                    02520002
025300         TO PV-ABEND-PARAGRAPH.                                   02530002
025400     MOVE 'OPEN TTRBNTF CURSOR'                                   02540002
025500         TO PV-DB2-OPERATION-ATTEMPTED.                           02550002
025600                                                                  02560002
025700     EXEC SQL                                                     02570002
025800          OPEN TRBL-CSR                                           02580002
025900     END-EXEC.                                                    02590002
026000                                                                  02600002
026100     EVALUATE TRUE                                                02610002
026200         WHEN SQLCODE = ZERO                                      02620002
026300             CONTINUE                                             02630002
026400         WHEN SQLWARN0 NOT = SPACES                               02640002
026500         WHEN SQLCODE < ZERO                                      02650002
026600         WHEN SQLCODE > ZERO                                      02660002
026700             PERFORM 9100-SQL-ABEND                               02670002
026800     END-EVALUATE.                                                02680002
026900                                                                  02690002
027000******************************************************************02700002
027100** PROCESS: RETRIEVE FIELDS FROM OTHER DB2 TABLES TO BUILD        02710002
027200**          THE EXTRACT RECORD, WRITE OUTPUT, FETCH NEXT RECORD   02720002
027300******************************************************************02730002
027400 2000-PROCESS-TRBL-CSR.                                           02740005
027500                                                                  02750002
027600     IF PS-TRBL-FOUND                                             02760002
027700                                                                  02770002
027800        PERFORM 3000-GET-TPURCHS                                  02780002
027801                                                                  02780169
027810        IF PS-PO-FOUND                                            02781069
027900           PERFORM 3020-GET-TENTNME                               02790069
028000           PERFORM 3040-GET-TRECEIV                               02800069
028200           PERFORM 3080-OPEN-RECITM-CSR                           02820069
028300           PERFORM 4020-FETCH-RECITM-CSR                          02830069
028400           PERFORM 4000-PROCESS-RECITM-CSR                        02840069
028500             UNTIL PS-END-OF-RECITM-CSR                           02850069
028600           PERFORM 4040-CLOSE-RECITM-CSR                          02860069
028610           PERFORM 5500-GET-PROCESSING-AREA                       02861069
028700           PERFORM 7000-DETERMINE-TROUBLES                        02870069
028800           PERFORM 7500-FORMAT-OUTREC                             02880069
028900           PERFORM 8000-WRITE-OUTREC                              02890069
029010        END-IF                                                    02901069
029020        PERFORM 2200-FETCH-TRBL-CSR                               02902070
029100                                                                  02910005
029200     END-IF.                                                      02920002
029300                                                                  02930002
029400******************************************************************02940005
029500*  FETCH THE TRBL-CSR (DRIVER).                                   02950005
029600******************************************************************02960005
029700 2200-FETCH-TRBL-CSR.                                             02970005
029800                                                                  02980005
029900     MOVE '2200-FETCH-TRBL-CSR'                                   02990005
030000         TO PV-ABEND-PARAGRAPH.                                   03000005
030100     MOVE 'FETCH THE TRBL-CSR'                                    03010005
030200         TO PV-DB2-OPERATION-ATTEMPTED.                           03020005
030300                                                                  03030005
030400     INITIALIZE DCLTTRBNTF.                                       03040005
030500                                                                  03050005
030600     EXEC SQL                                                     03060005
030700         FETCH  TRBL-CSR                                          03070005
030800          INTO  :TRBNTF-NOTIF-NBR                                 03080005
030900               ,:TRBNTF-OPER-UNT-ID                               03090005
031000               ,:TRBNTF-DEPT-NBR                                  03100005
031010               ,:TRBNTF-ENT-ID                                    03101019
031100               ,:TRBNTF-PO-NBR                                    03110005
031300               ,:TRBNTF-PO-LNE-NBR                                03130005
031400               ,:TRBNTF-REC-SEQ-NBR                               03140005
031500               ,:TRBNTF-TRBL-RSN-CDE                              03150005
031510               ,:RCT00020-AUTOACKNL-END-TMST                      03151059
031600     END-EXEC.                                                    03160005
031700                                                                  03170005
031800     EVALUATE TRUE                                                03180005
031900         WHEN SQLCODE = ZERO                                      03190005
032000             SET PS-TRBL-FOUND       TO  TRUE                     03200005
032100             ADD +1                  TO PA-TOT-TRBLS-READ         03210011
032110             MOVE RCT00020-AUTOACKNL-END-TMST                     03211059
032120                                     TO PV-END-TIMESTAMP          03212059
032200         WHEN SQLCODE = +100                                      03220005
032300             SET PS-END-OF-TRBL-CSR                               03230005
032400                 PS-TRBL-FOUND-NO    TO  TRUE                     03240005
032500         WHEN SQLWARN0 NOT = SPACE                                03250005
032600         WHEN SQLCODE < ZERO                                      03260005
032700         WHEN SQLCODE > ZERO                                      03270005
032800             PERFORM 9100-SQL-ABEND                               03280005
032900     END-EVALUATE.                                                03290005
033000                                                                  03300005
033100******************************************************************03310005
033200*  CLOSE THE TRBL-CSR CURSOR.                                     03320005
033300******************************************************************03330005
033400 2400-CLOSE-TRBL-CSR.                                             03340005
033500                                                                  03350005
033600     MOVE '2400-CLOSE-TRBL-CSR'                                   03360005
033700         TO PV-ABEND-PARAGRAPH.                                   03370005
033800     MOVE 'CLOSE THE TRBL CURSOR'                                 03380005
033900         TO PV-DB2-OPERATION-ATTEMPTED.                           03390005
034000                                                                  03400005
034100     EXEC SQL                                                     03410005
034200          CLOSE TRBL-CSR                                          03420005
034300     END-EXEC.                                                    03430005
034400                                                                  03440005
034500     EVALUATE TRUE                                                03450005
034600         WHEN SQLCODE = ZERO                                      03460005
034700             CONTINUE                                             03470005
034800         WHEN SQLWARN0 NOT = SPACES                               03480005
034900         WHEN SQLCODE < ZERO                                      03490005
035000         WHEN SQLCODE > ZERO                                      03500005
035100             PERFORM 9100-SQL-ABEND                               03510005
035200     END-EVALUATE.                                                03520005
035300                                                                  03530005
035400******************************************************************03540002
035500**   SELECT TPURCHS FOR SEASONAL SET SHORT NAME                   03550002
035600******************************************************************03560002
035700 3000-GET-TPURCHS.                                                03570002
035800                                                                  03580002
035900     MOVE '3000-GET-TPURCHS'                                      03590002
036000         TO PV-ABEND-PARAGRAPH.                                   03600000
036100     MOVE 'SELECT TPURCHS'                                        03610002
036200         TO PV-DB2-OPERATION-ATTEMPTED.                           03620000
036300                                                                  03630000
036400     INITIALIZE DCLTPURCHS.                                       03640002
036401                                                                  03640169
036410     SET PS-PO-FOUND TO TRUE.                                     03641069
036500                                                                  03650000
036600     EXEC SQL                                                     03660002
036700         SELECT  SEASET_SHRT_NM                                   03670002
036800               , DEPT_NBR                                         03680005
036900         INTO   :PURCHS-SEASET-SHRT-NM                            03690005
037000               ,:PURCHS-DEPT-NBR                                  03700005
037100         FROM    TPURCHS                                          03710005
037200         WHERE  PO_NBR          =  :TRBNTF-PO-NBR                 03720005
037300         AND    VER_STATUS_CDE  =  :PC-A                          03730005
037400         AND    PO_TYP_CDE      IN ('FB', 'IF')                   03740076
037500     END-EXEC.                                                    03750002
037600                                                                  03760002
037700     EVALUATE TRUE                                                03770000
037800         WHEN SQLCODE = ZERO                                      03780000
038010              CONTINUE                                            03801040
038020         WHEN SQLCODE = +100                                      03802062
038030            SET PS-PO-NOT-FOUND TO TRUE                           03803069
038100         WHEN SQLWARN0 NOT = SPACE                                03810000
038200         WHEN SQLCODE < ZERO                                      03820000
038300         WHEN SQLCODE > ZERO                                      03830000
038400             DISPLAY '*****************************'              03840002
038500             DISPLAY 'MISSING DATA FROM TPURCHS FOR'              03850002
038600             DISPLAY 'PO NBR      : ' TRBNTF-PO-NBR               03860003
038700             DISPLAY 'REC SEQ NBR : ' TRBNTF-REC-SEQ-NBR          03870003
038800             DISPLAY 'NOTIF NBR   : ' TRBNTF-NOTIF-NBR            03880003
038900             DISPLAY '*****************************'              03890002
039000             PERFORM 9100-SQL-ABEND                               03900000
039100     END-EVALUATE.                                                03910000
039200                                                                  03920000
039300******************************************************************03930002
039400**   SELECT TENTNME FOR ENTITY NAME DESCRIPTION                   03940002
039500******************************************************************03950002
039600 3020-GET-TENTNME.                                                03960002
039700                                                                  03970002
039800     MOVE '3020-GET-TENTNME'                                      03980002
039900         TO PV-ABEND-PARAGRAPH.                                   03990002
040000     MOVE 'SELECT TENTNME'                                        04000002
040100         TO PV-DB2-OPERATION-ATTEMPTED.                           04010002
040200                                                                  04020002
040300     INITIALIZE DCLTENTNME.                                       04030002
040400                                                                  04040002
040500     EXEC SQL                                                     04050002
040600         SELECT  ENT_NAME_DESC                                    04060002
040700           INTO  :ENTNME-ENT-NAME-DESC                            04070002
040800           FROM  TENTNME                                          04080002
040900          WHERE  ENT_ID          =  :TRBNTF-ENT-ID                04090002
041000            AND  TYPE_CDE        =  '01'                          04100007
041100     END-EXEC.                                                    04110002
041200                                                                  04120002
041300     EVALUATE TRUE                                                04130002
041400         WHEN SQLCODE = ZERO                                      04140002
041500              CONTINUE                                            04150002
041600         WHEN SQLCODE = +100                                      04160002
041610            SET PS-THERE-IS-AN-ERROR TO TRUE                      04161065
041620             DISPLAY '*****************************'              04162066
041630             DISPLAY 'MISSING DATA FROM TENTNME FOR'              04163066
041640             DISPLAY 'PO NBR      : ' TRBNTF-PO-NBR               04164066
041650             DISPLAY 'REC SEQ NBR : ' TRBNTF-REC-SEQ-NBR          04165066
041660             DISPLAY 'NOTIF NBR   : ' TRBNTF-NOTIF-NBR            04166066
041670             DISPLAY '*****************************'              04167066
041700         WHEN SQLWARN0 NOT = SPACE                                04170002
041800         WHEN SQLCODE < ZERO                                      04180002
041900         WHEN SQLCODE > ZERO                                      04190002
042000             DISPLAY '*****************************'              04200002
042100             DISPLAY 'MISSING DATA FROM TENTNME FOR'              04210002
042200             DISPLAY 'PO NBR      : ' TRBNTF-PO-NBR               04220003
042300             DISPLAY 'REC SEQ NBR : ' TRBNTF-REC-SEQ-NBR          04230003
042400             DISPLAY 'NOTIF NBR   : ' TRBNTF-NOTIF-NBR            04240003
042500             DISPLAY '*****************************'              04250002
042600             PERFORM 9100-SQL-ABEND                               04260002
042700     END-EVALUATE.                                                04270002
042800                                                                  04280002
042900******************************************************************04290003
043000**   SELECT TRECEIV FOR RECEIPT AND FACILITY DATA                 04300003
043100******************************************************************04310003
043200 3040-GET-TRECEIV.                                                04320003
043300                                                                  04330003
043400     MOVE '3040-GET-TRECEIV'                                      04340003
043500         TO PV-ABEND-PARAGRAPH.                                   04350003
043600     MOVE 'SELECT TRECEIV'                                        04360003
043700         TO PV-DB2-OPERATION-ATTEMPTED.                           04370003
043800                                                                  04380003
043900     INITIALIZE DCLTRECEIV.                                       04390003
044000                                                                  04400003
044100     EXEC SQL                                                     04410003
044200          SELECT ORD_NBR                                          04420003
044300               , REC_SEQ_NBR                                      04430005
044400               , PO_VER_NBR                                       04440005
044500               , PACK_BY_ST_IND                                   04450005
044600               , CHAR(DATE(REC_TMST),USA)                         04460031
044700               , EXPTED_CART_CNT                                  04470005
044800               , ACTL_CART_CNT                                    04480005
044900               , OPER_UNT_ID                                      04490005
045000               , FCLTY_ID                                         04500005
045100               , CURR_OPER_UNT_ID                                 04510005
045200               , CURR_FCLTY_ID                                    04520005
045210               , PKGNG_CDE                                        04521032
045220               , STATUS_CDE                                       04522038
045300          INTO  :RECEIV-ORD-NBR                                   04530005
045400               ,:RECEIV-REC-SEQ-NBR                               04540005
045500               ,:RECEIV-PO-VER-NBR                                04550005
045600               ,:RECEIV-PACK-BY-ST-IND                            04560005
045700               ,:PV-RECEIV-REC-DATE                               04570005
045800               ,:RECEIV-EXPTED-CART-CNT                           04580005
045900               ,:RECEIV-ACTL-CART-CNT                             04590005
046000               ,:RECEIV-OPER-UNT-ID                               04600005
046100               ,:RECEIV-FCLTY-ID                                  04610005
046200               ,:RECEIV-CURR-OPER-UNT-ID                          04620005
046300               ,:RECEIV-CURR-FCLTY-ID                             04630005
046310               ,:RECEIV-PKGNG-CDE                                 04631032
046320               ,:RECEIV-STATUS-CDE                                04632038
046400           FROM  TRECEIV                                          04640003
046600          WHERE  VER_STATUS_CDE     =  'A'                        04660095
046700            AND  ORD_NBR            =  :TRBNTF-PO-NBR             04670003
046800            AND  REC_SEQ_NBR        =  :TRBNTF-REC-SEQ-NBR        04680003
046900     END-EXEC.                                                    04690003
047000                                                                  04700003
047100     EVALUATE TRUE                                                04710003
047200         WHEN SQLCODE = ZERO                                      04720003
047300            CONTINUE                                              04730047
047400         WHEN SQLCODE = +100                                      04740003
047410            SET PS-THERE-IS-AN-ERROR TO TRUE                      04741065
047420             DISPLAY '*****************************'              04742066
047430             DISPLAY 'MISSING DATA FROM TRECEIV FOR'              04743066
047440             DISPLAY 'PO NBR      : ' TRBNTF-PO-NBR               04744066
047450             DISPLAY 'REC SEQ NBR : ' TRBNTF-REC-SEQ-NBR          04745066
047460             DISPLAY 'NOTIF NBR   : ' TRBNTF-NOTIF-NBR            04746066
047470             DISPLAY '*****************************'              04747066
047500         WHEN SQLWARN0 NOT = SPACE                                04750003
047600         WHEN SQLCODE < ZERO                                      04760003
047700         WHEN SQLCODE > ZERO                                      04770003
047800             DISPLAY '*****************************'              04780003
047900             DISPLAY 'MISSING DATA FROM TRECEIV FOR'              04790003
048000             DISPLAY 'PO NBR      : ' TRBNTF-PO-NBR               04800003
048100             DISPLAY 'REC SEQ NBR : ' TRBNTF-REC-SEQ-NBR          04810003
048200             DISPLAY 'NOTIF NBR   : ' TRBNTF-NOTIF-NBR            04820003
048300             DISPLAY '*****************************'              04830003
048400             PERFORM 9100-SQL-ABEND                               04840003
048500     END-EVALUATE.                                                04850003
048600                                                                  04860003
048700******************************************************************04870005
048800*  OPEN THE RECITM-CSR CURSOR.                                    04880022
048900******************************************************************04890005
049000 3080-OPEN-RECITM-CSR.                                            04900010
049100                                                                  04910005
049200     MOVE '3080-OPEN-RECITM-CSR'                                  04920010
049300         TO PV-ABEND-PARAGRAPH.                                   04930005
049400     MOVE 'OPEN TRECITM CURSOR'                                   04940005
049500         TO PV-DB2-OPERATION-ATTEMPTED.                           04950005
049600                                                                  04960005
049700     EXEC SQL                                                     04970005
049800          OPEN RECITM-CSR                                         04980022
049900     END-EXEC.                                                    04990005
050000                                                                  05000005
050100     EVALUATE TRUE                                                05010005
050200         WHEN SQLCODE = ZERO                                      05020005
050300             CONTINUE                                             05030005
050400         WHEN SQLWARN0 NOT = SPACES                               05040005
050500         WHEN SQLCODE < ZERO                                      05050005
050600         WHEN SQLCODE > ZERO                                      05060005
050700             PERFORM 9100-SQL-ABEND                               05070005
050800     END-EVALUATE.                                                05080005
050900                                                                  05090005
051000******************************************************************05100005
051100*  PROCESS THE RECITM-CSR CURSOR.                                 05110022
051200******************************************************************05120005
051300 4000-PROCESS-RECITM-CSR.                                         05130010
051400                                                                  05140005
051500     IF  RECITM-DTL-CK-ITM-QTY > 0                                05150005
051600         ADD RECITM-DTL-CK-ITM-QTY TO PA-PKSL-ITM-QTY             05160005
051700     ELSE                                                         05170005
051800         ADD RECITM-PKSL-ITM-QTY   TO PA-PKSL-ITM-QTY             05180005
051900     END-IF.                                                      05190005
052000                                                                  05200005
052100     PERFORM 4020-FETCH-RECITM-CSR.                               05210010
052200                                                                  05220005
052300******************************************************************05230005
052400*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.        *05240005
052500******************************************************************05250005
052600 4020-FETCH-RECITM-CSR.                                           05260010
052700                                                                  05270005
052800     MOVE '4020-FETCH-RECITM-CSR'                                 05280010
052900         TO PV-ABEND-PARAGRAPH.                                   05290005
053000     MOVE 'FETCH A ROW FROM THE TRECITM CURSOR'                   05300005
053100         TO PV-DB2-OPERATION-ATTEMPTED.                           05310005
053200                                                                  05320005
053300     INITIALIZE DCLTRECITM.                                       05330005
053400                                                                  05340005
053500     EXEC SQL                                                     05350005
053600          FETCH RECITM-CSR                                        05360022
053700           INTO :RECITM-ORD-LNE-NBR                               05370005
053800              , :RECITM-PKSL-ITM-QTY                              05380005
053900              , :RECITM-DTL-CK-ITM-QTY                            05390005
054000     END-EXEC.                                                    05400005
054100                                                                  05410005
054200     EVALUATE TRUE                                                05420005
054300         WHEN SQLCODE = ZERO                                      05430005
054400             SET PS-END-OF-RECITM-CSR-NO                          05440010
054500                                 TO TRUE                          05450005
054600         WHEN SQLCODE = +100                                      05460005
054700             SET PS-END-OF-RECITM-CSR                             05470010
054800                                 TO TRUE                          05480005
054900         WHEN SQLWARN0 NOT = SPACES                               05490005
055000         WHEN SQLCODE < ZERO                                      05500005
055100         WHEN SQLCODE > ZERO                                      05510005
055200             PERFORM 9100-SQL-ABEND                               05520005
055300     END-EVALUATE.                                                05530005
055400                                                                  05540005
055500******************************************************************05550005
055600*  CLOSE THE RECITM-CSR CURSOR.                                   05560022
055700******************************************************************05570005
055800 4040-CLOSE-RECITM-CSR.                                           05580010
055900                                                                  05590005
056000     MOVE '4040-CLOSE-RECITM-CSR'                                 05600010
056100         TO PV-ABEND-PARAGRAPH.                                   05610005
056200     MOVE 'CLOSE THE TRECITM CURSOR'                              05620005
056300         TO PV-DB2-OPERATION-ATTEMPTED.                           05630005
056400                                                                  05640005
056500     EXEC SQL                                                     05650005
056600          CLOSE RECITM-CSR                                        05660022
056700     END-EXEC.                                                    05670005
056800                                                                  05680005
056900     EVALUATE TRUE                                                05690005
057000         WHEN SQLCODE = ZERO                                      05700005
057100             CONTINUE                                             05710005
057200         WHEN SQLWARN0 NOT = SPACES                               05720005
057300         WHEN SQLCODE < ZERO                                      05730005
057400         WHEN SQLCODE > ZERO                                      05740005
057500             PERFORM 9100-SQL-ABEND                               05750005
057600     END-EVALUATE.                                                05760005
057700                                                                  05770005
057800******************************************************************05780006
057900**   SELECT TWKORIN FOR PROCESS FACILITY AREA ID                  05790006
058000******************************************************************05800006
058100 4060-GET-TWKORIN.                                                05810006
058200                                                                  05820006
058300     MOVE '4060-GET-TWKORIN'                                      05830006
058400         TO PV-ABEND-PARAGRAPH.                                   05840006
058500     MOVE 'SELECT TWKORIN'                                        05850006
058600         TO PV-DB2-OPERATION-ATTEMPTED.                           05860006
058700                                                                  05870006
058800     INITIALIZE DCLTWKORIN.                                       05880006
058900                                                                  05890006
059000     EXEC SQL                                                     05900006
059100         SELECT  PRC_FCLTY_AREA_ID                                05910006
059200               , LNE_LOC_CDE                                      05920006
059300           INTO :WKORIN-PRC-FCLTY-AREA-ID                         05930006
059400               ,:WKORIN-LNE-LOC-CDE                               05940006
059500           FROM  TWKORIN                                          05950006
059600         WHERE   ORD_NBR            =  :RECEIV-ORD-NBR            05960006
059700           AND   RCVR_SEQ_NBR       =  :RECEIV-REC-SEQ-NBR        05970006
059710           AND   ORD_LNE_NBR        =  :RECITM-ORD-LNE-NBR        05971008
059800           AND   WORK_ORD_SEQ_NBR   =  1                          05980006
059900           AND   OPER_UNT_ID        =  :RECEIV-OPER-UNT-ID        05990006
060000           AND   FCLTY_ID           =  :RECEIV-FCLTY-ID           06000006
060100           AND   VER_STATUS_CDE     =  'A'                        06010006
060200     END-EXEC.                                                    06020006
060300                                                                  06030006
060400     EVALUATE TRUE                                                06040006
060500         WHEN SQLCODE = ZERO                                      06050006
060600              CONTINUE                                            06060006
060700         WHEN SQLCODE = +100                                      06070006
060800         WHEN SQLWARN0 NOT = SPACE                                06080006
060900         WHEN SQLCODE < ZERO                                      06090006
061000         WHEN SQLCODE > ZERO                                      06100006
061100             DISPLAY '*****************************'              06110006
061200             DISPLAY 'MISSING DATA FROM TWKORIN FOR'              06120020
061300             DISPLAY 'PO NBR      : ' TRBNTF-PO-NBR               06130006
061400             DISPLAY 'REC SEQ NBR : ' TRBNTF-REC-SEQ-NBR          06140006
061410             DISPLAY 'ORD LNE NBR : ' RECITM-ORD-LNE-NBR          06141021
061500             DISPLAY 'NOTIF NBR   : ' TRBNTF-NOTIF-NBR            06150006
061510             DISPLAY 'OPER UNT    : ' RECEIV-OPER-UNT-ID          06151020
061520             DISPLAY 'FCLTY ID    : ' RECEIV-FCLTY-ID             06152020
061600             DISPLAY '*****************************'              06160006
061700             PERFORM 9100-SQL-ABEND                               06170006
061800     END-EVALUATE.                                                06180006
061810 5500-GET-PROCESSING-AREA.                                        06181044
061820     PERFORM 5550-OPEN-TWKORIN.                                   06182044
061830     PERFORM 5600-FETCH-TWKORIN-LOOP.                             06183044
061840                                                                  06184044
061850 5550-OPEN-TWKORIN.                                               06185044
061860     MOVE '4550-OPEN-TWKORIN'                                     06186044
061870         TO PV-ABEND-PARAGRAPH.                                   06187044
061880     MOVE 'OPEN THE TWORIN_CSR'                                   06188044
061890         TO PV-DB2-OPERATION-ATTEMPTED.                           06189044
061891                                                                  06189144
061892     EXEC SQL                                                     06189244
061893         OPEN TWKORIN_CSR                                         06189344
061894     END-EXEC.                                                    06189444
061895                                                                  06189544
061896     EVALUATE TRUE                                                06189644
061897         WHEN SQLWARN0 NOT = SPACE                                06189744
061898         WHEN SQLCODE < ZERO                                      06189844
061899         WHEN SQLCODE > ZERO                                      06189944
061900             PERFORM 9100-SQL-ABEND                               06190044
061901         WHEN SQLCODE = ZEROS                                     06190144
061902              CONTINUE                                            06190244
061903     END-EVALUATE.                                                06190344
061904                                                                  06190444
061905 5575-CLOSE-TWKORIN.                                              06190544
061906     MOVE '5575-CLOSE-TWKORIN'                                    06190648
061907         TO PV-ABEND-PARAGRAPH.                                   06190744
061908     MOVE 'CLOSE THE TWORIN_CSR'                                  06190844
061909         TO PV-DB2-OPERATION-ATTEMPTED.                           06190944
061910                                                                  06191044
061911     EXEC SQL                                                     06191144
061912         CLOSE TWKORIN_CSR                                        06191244
061913     END-EXEC.                                                    06191344
061914                                                                  06191444
061915     EVALUATE TRUE                                                06191544
061916         WHEN SQLWARN0 NOT = SPACE                                06191644
061917         WHEN SQLCODE < ZERO                                      06191744
061918         WHEN SQLCODE > ZERO                                      06191844
061919             PERFORM 9100-SQL-ABEND                               06191944
061920         WHEN SQLCODE = ZEROS                                     06192044
061921             CONTINUE                                             06192144
061922     END-EVALUATE.                                                06192244
061923                                                                  06192344
061924 5600-FETCH-TWKORIN-LOOP.                                         06192444
061925     MOVE 'N' TO PS-TWKORIN-CURSOR-SW.                            06192544
061926     MOVE 'N' TO PS-TWKORIN-ZERO-SW.                              06192644
061927     PERFORM 5650-FETCH-TWKORIN.                                  06192748
061928     IF  PS-EOF-TWKORIN-CSR                                       06192844
061929       OR WKORIN-STRT-TMST > PC-DEFAULT-DATE                      06192944
061930         PERFORM 5575-CLOSE-TWKORIN                               06193048
061931         PERFORM 5800-OPEN-WKORIN0-CURSOR                         06193148
061932         PERFORM 5850-FETCH-TWKORIN-ZERO                          06193248
061933         IF  WKORIN-STRT-TMST > PC-DEFAULT-DATE                   06193344
061934             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     06193444
061935                      TM008-PROCESS-AREA                          06193557
061936             MOVE WKORIN-LNE-LOC-CDE TO                           06193644
061937                      TM008-LNE-LOC-CDE                           06193757
061938             MOVE 'N' TO PS-TWKORIN-CURSOR-SW                     06193844
061939             PERFORM 5805-CLOSE-WKORIN0                           06193948
061940         ELSE                                                     06194044
061941             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     06194144
061942                      TM008-PROCESS-AREA                          06194257
061943             MOVE WKORIN-LNE-LOC-CDE TO                           06194344
061944                      TM008-LNE-LOC-CDE                           06194457
061945             PERFORM 5850-FETCH-TWKORIN-ZERO                      06194548
061946                 UNTIL PS-EOF-TWKORIN-CSR                         06194644
061947             PERFORM 5805-CLOSE-WKORIN0                           06194748
061948         END-IF                                                   06194844
061949     ELSE                                                         06194944
061950         MOVE WKORIN-PRC-FCLTY-AREA-ID TO TM008-PROCESS-AREA      06195057
061951         MOVE WKORIN-LNE-LOC-CDE TO                               06195144
061952                  TM008-LNE-LOC-CDE                               06195257
061953         PERFORM 5650-FETCH-TWKORIN                               06195348
061954             UNTIL PS-EOF-TWKORIN-CSR                             06195444
061955         PERFORM 5575-CLOSE-TWKORIN                               06195548
061956     END-IF.                                                      06195644
061957                                                                  06195744
061958 5650-FETCH-TWKORIN.                                              06195844
061959     MOVE '5650-FETCH-TWKORIN'                                    06195948
061960         TO PV-ABEND-PARAGRAPH.                                   06196044
061961     MOVE 'FETCH THE TWORIN_CSR'                                  06196144
061962         TO PV-DB2-OPERATION-ATTEMPTED.                           06196244
061963                                                                  06196344
061964     EXEC SQL                                                     06196444
061965          FETCH TWKORIN_CSR                                       06196544
061966             INTO  :WKORIN-STRT-TMST,                             06196644
061967                   :WKORIN-STOP-TMST,                             06196744
061968                   :WKORIN-PRC-FCLTY-AREA-ID,                     06196844
061969                   :WKORIN-SCREEN-SEQ-NBR,                        06196944
061970                   :WKORIN-LNE-LOC-CDE                            06197044
061971     END-EXEC.                                                    06197144
061972                                                                  06197244
061973     EVALUATE TRUE                                                06197344
061974         WHEN SQLCODE = +0                                        06197444
061975              PERFORM 5675-CHECK-DATES                            06197548
061976         WHEN SQLCODE = +100                                      06197644
061977              SET PS-EOF-TWKORIN-CSR TO TRUE                      06197744
061978         WHEN SQLWARN0 NOT = SPACE                                06197844
061979         WHEN SQLCODE < ZERO                                      06197944
061980         WHEN SQLCODE > ZERO                                      06198044
061981             PERFORM 9100-SQL-ABEND                               06198144
061982     END-EVALUATE.                                                06198244
061983                                                                  06198344
061984 5675-CHECK-DATES.                                                06198444
061985     IF  WKORIN-STRT-TMST LESS THAN PC-DEFAULT-DATE               06198544
061986         IF  WKORIN-STOP-TMST LESS THAN PC-DEFAULT-DATE           06198644
061987             MOVE WKORIN-LNE-LOC-CDE TO                           06198744
061988                      TM008-LNE-LOC-CDE                           06198857
061989             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     06198944
061990                        TM008-PROCESS-AREA                        06199057
061991         ELSE                                                     06199144
061992             MOVE WKORIN-LNE-LOC-CDE TO                           06199244
061993                      TM008-LNE-LOC-CDE                           06199357
061994             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     06199444
061995                        TM008-PROCESS-AREA                        06199557
061996             SET PS-EOF-TWKORIN-CSR TO TRUE                       06199644
061997         END-IF                                                   06199744
061998     ELSE                                                         06199844
061999         SET PS-EOF-TWKORIN-CSR TO TRUE                           06199944
062000     END-IF.                                                      06200044
062001                                                                  06200144
062002 5800-OPEN-WKORIN0-CURSOR.                                        06200244
062003     MOVE '5800-OPEN-WKORIN0-CURSOR'                              06200348
062004         TO PV-ABEND-PARAGRAPH.                                   06200444
062005     MOVE 'OPEN THE WKORIN0_CSR'                                  06200544
062006         TO PV-DB2-OPERATION-ATTEMPTED.                           06200644
062007                                                                  06200744
062008     EXEC SQL                                                     06200844
062009         OPEN WKORIN0_CSR                                         06200944
062010     END-EXEC.                                                    06201044
062011                                                                  06201144
062012     EVALUATE TRUE                                                06201244
062013         WHEN SQLWARN0 NOT = SPACE                                06201344
062014         WHEN SQLCODE < ZERO                                      06201444
062015         WHEN SQLCODE > ZERO                                      06201544
062016             PERFORM 9100-SQL-ABEND                               06201644
062017         WHEN SQLCODE = ZERO                                      06201744
062018             CONTINUE                                             06201844
062019     END-EVALUATE.                                                06201944
062020                                                                  06202044
062021 5805-CLOSE-WKORIN0.                                              06202144
062022     MOVE '5805-CLOSE-WKORIN0'                                    06202248
062023         TO PV-ABEND-PARAGRAPH.                                   06202344
062024     MOVE 'CLOSE THE WKORIN0_CSR'                                 06202444
062025         TO PV-DB2-OPERATION-ATTEMPTED.                           06202544
062026                                                                  06202644
062027     EXEC SQL                                                     06202744
062028         CLOSE WKORIN0_CSR                                        06202844
062029     END-EXEC.                                                    06202944
062030                                                                  06203044
062031      EVALUATE TRUE                                               06203144
062032          WHEN SQLWARN0 NOT = SPACE                               06203244
062033          WHEN SQLCODE < ZERO                                     06203344
062034          WHEN SQLCODE > ZERO                                     06203444
062035             PERFORM 9100-SQL-ABEND                               06203544
062036          WHEN SQLCODE = 0                                        06203644
062037              CONTINUE                                            06203744
062038      END-EVALUATE.                                               06203844
062039                                                                  06203944
062040 5850-FETCH-TWKORIN-ZERO.                                         06204044
062041     MOVE '5850-FETCH-TWKORIN-ZERO'                               06204148
062042         TO PV-ABEND-PARAGRAPH.                                   06204244
062043     MOVE 'FETCH THE WKORIN0_CSR'                                 06204344
062044         TO PV-DB2-OPERATION-ATTEMPTED.                           06204444
062045                                                                  06204544
062046     EXEC SQL                                                     06204644
062047          FETCH WKORIN0_CSR                                       06204744
062048             INTO  :WKORIN-STRT-TMST,                             06204844
062049                   :WKORIN-STOP-TMST,                             06204944
062050                   :WKORIN-PRC-FCLTY-AREA-ID,                     06205044
062051                   :WKORIN-SCREEN-SEQ-NBR,                        06205144
062052                   :WKORIN-LNE-LOC-CDE                            06205244
062053     END-EXEC.                                                    06205344
062054                                                                  06205444
062055     EVALUATE TRUE                                                06205544
062056         WHEN SQLCODE = +0                                        06205644
062057              PERFORM 5860-CHECK-DATES                            06205748
062058         WHEN SQLCODE = +100                                      06205844
062059              SET PS-EOF-TWKORIN-CSR TO TRUE                      06205944
062060         WHEN SQLWARN0 NOT = SPACE                                06206044
062061         WHEN SQLCODE < ZERO                                      06206144
062062         WHEN SQLCODE > ZERO                                      06206244
062063             PERFORM 9100-SQL-ABEND                               06206344
062064     END-EVALUATE.                                                06206444
062065                                                                  06206544
062066 5860-CHECK-DATES.                                                06206644
062067     IF  WKORIN-STRT-TMST LESS THAN PC-DEFAULT-DATE               06206744
062068         IF  WKORIN-STOP-TMST LESS THAN PC-DEFAULT-DATE           06206844
062069             MOVE WKORIN-LNE-LOC-CDE TO                           06206944
062070                      TM008-LNE-LOC-CDE                           06207057
062071             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     06207144
062072                        TM008-PROCESS-AREA                        06207257
062073         ELSE                                                     06207344
062074             MOVE WKORIN-LNE-LOC-CDE TO                           06207444
062075                      TM008-LNE-LOC-CDE                           06207557
062076             MOVE WKORIN-PRC-FCLTY-AREA-ID TO                     06207644
062077                        TM008-PROCESS-AREA                        06207757
062078             SET PS-EOF-TWKORIN-CSR TO TRUE                       06207844
062079         END-IF                                                   06207944
062080     ELSE                                                         06208044
062081             MOVE WKORIN-LNE-LOC-CDE TO                           06208144
062082                      TM008-LNE-LOC-CDE                           06208257
062083         MOVE WKORIN-PRC-FCLTY-AREA-ID TO                         06208344
062084                    TM008-PROCESS-AREA                            06208457
062085         SET PS-EOF-TWKORIN-CSR TO TRUE                           06208544
062086     END-IF.                                                      06208644
062087*----------------------------------------------------------------*06208794
062088* DETERMINE IF THIS PO/RECEIVER IS A CANDIDATE TO BE CHANGED      06208894
062089* FROM A BULK TO A PBS.                                           06208994
062090* IT WILL BE DONE AUTOMATICALLY WHEN THE ALL FOLLOWING CONDITIONS 06209094
062091* ARE MET:                                                        06209194
062092*        1. RECEIVER PACKAGING CODE IS A "B"                      06209294
062093*        2. PO_TYP_CDE = 'FB' OR 'IF'                             06209394
062094*        3. SEASONAL SHORT NAME STARTS WITH 'FBP__'               06209494
062095*        4. FOR ALL OF THE LINES, THE STORE NMBR IS THE SAME      06209594
062096*           FOR ALL LINES.                                        06209694
062097*        5. ALSO, YOU CAN ONLY HAVE ONE ACTIVE PACKSLIP WHEN      06209794
062098*           DOING THIS FOR A PBS.                                 06209894
062099* WHEN THE CONDITIONS ABOVE ARE MET, THE RECEIVING PACKAGING CODE 06209994
062100* WILL BE CHANGED TO A PBS (SPACES) AND PACK-BY-STR-IND = "Y" ON  06210094
062101* TRECEIV, AND THE PACKSLIP HEADER(S) THAT ARE ACTIVE WILL BE     06210194
062102* UPDATED TO HAVE THE STORE NUMBER IN IT.                         06210294
062103* IF THERE IS MORE THAN ONE STORE NUMBER, THE PROCESS WILL        06210394
062104* CONTINUE TO PROCESS THE PO/RECEIVER AS A BULK.  IT WILL NOT     06210494
062105* CREATE NEW PACKSLIPS FOR MULTIPLE STORES.                       06210594
062106* IN ADDITION TO THE ABOVE, ALL OF THE LINE LEVEL TROUBLE WILL    06210694
062107* BE DELETED NOW THAT THIS IS A PBS BEFORE RUNNING THE TMKCS508   06210794
062108* PROGRAM TO CREATE JUST PBS TROUBLE.                             06210894
062109* ALSO SINCE THE LINE LEVEL TROUBLE IS DELETED, FOR THIS INSTANT  06210994
062110* ONLY, WE WILL NEED TO LOOK AT THE TROUBLE 426 - STOP AUTO VE    06211094
062111* FLOWBACK TROUBLE TO USE THAT NOTIF NUMBER TO PUT INTO THE       06211194
062112* RCT_AUTOACKNL_TRBL AND SET THAT TO COMPLETE SO THAT THE         06211294
062113* REPORT WILL PICK UP THIS PO/RECEIVER AS BEING COMPLETED.        06211394
062114*----------------------------------------------------------------*06211494
062115                                                                  06211506
062116 6000-CHECK-FLOWBACK-AUTO-PBS.                                    06211688
062117                                                                  06211788
062118     MOVE '6000-CHECK-FLOWBACK-AUTO-PBS' TO                       06211892
062119        PV-ABEND-PARAGRAPH.                                       06211992
062120     MOVE 0                     TO PV-PBS-STORE-COUNT.            06212090
062121     MOVE TRBNTF-OPER-UNT-ID    TO DK-OPER-UNT-ID.                06212190
062122     MOVE TRBNTF-PO-NBR         TO DK-ORD-NBR.                    06212290
062123                                                                  06212388
062124*CHECK THAT THERE IS ONLY ONE STORE FOR THE ALLOCATION            06212491
062125                                                                  06212588
062126     EXEC SQL                                                     06212688
062127        SELECT COUNT (*) AS TOT2                                  06212788
062128        INTO  :PV-PBS-STORE-COUNT                                 06212888
062129        FROM (SELECT COUNT (*)                                    06212988
062130               FROM TALLPLN A                                     06213088
062131                   ,TMESTDS B                                     06213188
062132              WHERE A.PO_NBR    = :DK-ORD-NBR                     06213290
062133               AND DEST_NBR     = :DK-OPER-UNT-ID                 06213388
062134               AND A.PO_NBR     = B.PO_NBR                        06213488
062135               AND A.PO_LNE_NBR = B.PO_LNE_NBR                    06213588
062136               AND A.PLAN_NBR   = B.PLAN_NBR                      06213688
062137              GROUP BY                                            06213788
062138                    STR_NBR) TOT1                                 06213888
062139     END-EXEC.                                                    06213988
062140                                                                  06214091
062141     EVALUATE TRUE                                                06214191
062142         WHEN SQLCODE = ZERO                                      06214291
062143              CONTINUE                                            06214391
062144         WHEN OTHER                                               06214491
062145             PERFORM 9100-SQL-ABEND                               06214591
062146     END-EVALUATE.                                                06214691
062147******************************************************************06214705
062150*  DETERMINE IF NUMBER OF TROUBLES AND DESCRIPTION OF LATEST TRBL 06215005
062200***************************************************************** 06220005
062300**** THE PROCESS FOR LOOKING AT TROUBLE IS CHANGING SLIGHTLY.     06230005
062400**** THE NEW PROCESS WILL COUNT ALL THE UNRESOLVED TROUBLE        06240005
062500**** FIRST.  IF THERE IS ONLY ONE, THEN THE DESCRIPTION WILL BE   06250005
062600**** MOVED TO THE TM008-LATEST-TROUBLE FIELD. IF THERE IS MORE    06260057
062700**** THAN ONE UNRESOLVED TROUBLE, A 'Y' WILL BE MOVED TO THE      06270005
062800**** TM008-MULTI-TROUBLE FIELD AND A DESCRIPTION WILL BE MOVED    06280057
062900**** TO THE TM008-LATEST-TROUBLE FIELD.  NEXT, A COUNT OF RESOLVED06290057
063000**** BUT NOT APPROVED TROUBLE WILL BE DONE.  IF THERE IS ONE OR   06300005
063100**** MORE, THEN AN '*' WILL BE MOVED TO THE TM008-UNRESOLVED-     06310057
063200**** TROUBLE FIELD.                                               06320005
063300******************************************************************06330005
063400 7000-DETERMINE-TROUBLES.                                         06340005
063500                                                                  06350005
063510     INITIALIZE TM008-RECEIVER-EXT-RECORD.                        06351078
063600* THE FOLLOWING CODE WAS DIRECTLY TAKEN FROM PCKUT001             06360005
063700     PERFORM 7044-CALL-UNRESOLVED-TROUBLE.                        06370005
063800     IF PA-COUNT GREATER THAN ZERO                                06380005
063900         PERFORM 7046-CALL-LATEST-TROUBLE                         06390005
064000         MOVE TRBRSN-TRBL-SHT-DESC TO TM008-LATEST-TROUBLE        06400057
064100         IF PA-COUNT GREATER THAN 1                               06410005
064200             MOVE 'Y' TO TM008-MULTI-TROUBLE                      06420057
064300         ELSE                                                     06430005
064400             MOVE SPACES TO TM008-MULTI-TROUBLE                   06440057
064500         END-IF                                                   06450005
064600     ELSE                                                         06460005
064700         MOVE SPACES TO TM008-LATEST-TROUBLE                      06470057
064800     END-IF.                                                      06480005
064900                                                                  06490005
065000     PERFORM 7042-CALL-RESOLVED-TROUBLE.                          06500005
065100     IF PA-COUNT GREATER THAN ZERO                                06510005
065200         MOVE '*' TO TM008-UNRESOLVED-TROUBLE                     06520057
065300     ELSE                                                         06530005
065400         MOVE SPACES TO TM008-UNRESOLVED-TROUBLE                  06540057
065500     END-IF.                                                      06550005
065600                                                                  06560005
065700******************************************************************06570005
065800* COUNT RESOLVED TROUBLES                                         06580005
065900******************************************************************06590005
066000 7042-CALL-RESOLVED-TROUBLE.                                      06600005
066100     MOVE '7042-CALL-ALL-TROUBLE'                                 06610005
066200         TO PV-ABEND-PARAGRAPH.                                   06620005
066300     EXEC SQL                                                     06630005
066400               SELECT  COUNT(*)                                   06640005
066500               INTO  :PA-COUNT                                    06650005
066600               FROM  TTRBNTF TRB                                  06660005
066700               WHERE TRB.PO_NBR       =  :RECEIV-ORD-NBR          06670005
066800                 AND TRB.REC_SEQ_NBR  =  :RECEIV-REC-SEQ-NBR      06680005
066900                 AND TRB.RESOLVED_IND = 'R'                       06690005
067000               WITH UR                                            06700005
067100     END-EXEC.                                                    06710005
067200                                                                  06720005
067300     EVALUATE TRUE                                                06730005
067400         WHEN SQLCODE = ZERO                                      06740005
067500         WHEN SQLCODE = +100                                      06750005
067600              CONTINUE                                            06760005
067700         WHEN SQLWARN0 NOT = SPACE                                06770005
067800         WHEN SQLCODE < ZERO                                      06780005
067900         WHEN SQLCODE > ZERO                                      06790005
068000             PERFORM 9100-SQL-ABEND                               06800005
068100     END-EVALUATE.                                                06810005
068200                                                                  06820005
068300******************************************************************06830005
068400* COUNT UNRESOLVED TROUBLES                                       06840005
068500******************************************************************06850005
068600 7044-CALL-UNRESOLVED-TROUBLE.                                    06860005
068700     MOVE '7044-CALL-UNRESOLVED-TROUBLE'                          06870005
068800         TO PV-ABEND-PARAGRAPH.                                   06880005
068900                                                                  06890005
069000     EXEC SQL                                                     06900005
069100               SELECT  COUNT(*)                                   06910005
069200               INTO  :PA-COUNT                                    06920005
069300               FROM   TTRBNTF TRB                                 06930005
069400               WHERE  TRB.PO_NBR      =  :RECEIV-ORD-NBR          06940005
069500                 AND TRB.REC_SEQ_NBR =  :RECEIV-REC-SEQ-NBR       06950005
069600                 AND TRB.RESOLVED_IND IN('N','I')                 06960005
069700               WITH UR                                            06970005
069800     END-EXEC.                                                    06980005
069900                                                                  06990005
070000     EVALUATE TRUE                                                07000005
070100         WHEN SQLCODE = ZERO                                      07010005
070200         WHEN SQLCODE = +100                                      07020005
070300              CONTINUE                                            07030005
070400         WHEN SQLWARN0 NOT = SPACE                                07040005
070500         WHEN SQLCODE < ZERO                                      07050005
070600         WHEN SQLCODE > ZERO                                      07060005
070700             PERFORM 9100-SQL-ABEND                               07070005
070800     END-EVALUATE.                                                07080005
070900                                                                  07090005
071000******************************************************************07100005
071100* COUNT LATEST TROUBLES                                           07110005
071200******************************************************************07120005
071300 7046-CALL-LATEST-TROUBLE.                                        07130005
071400     MOVE '7046-CALL-LATEST-TROUBLE'                              07140005
071500         TO PV-ABEND-PARAGRAPH.                                   07150005
071600                                                                  07160005
071700     EXEC SQL                                                     07170083
071800         SELECT RSN.TRBL_SHT_DESC                                 07180083
071900         INTO  :TRBRSN-TRBL-SHT-DESC                              07190083
072000         FROM  TTRBNTF TRB                                        07200083
072100             , TTRBRSN RSN                                        07210083
072200         WHERE  TRB.PO_NBR              = :RECEIV-ORD-NBR         07220083
072300            AND TRB.REC_SEQ_NBR         = :RECEIV-REC-SEQ-NBR     07230083
072400            AND TRB.TRBL_RSN_CDE        = RSN.TRBL_RSN_CDE        07240083
072500            AND TRB.NOTIF_TMST          =                         07250083
072600                (SELECT MAX(A.NOTIF_TMST)                         07260083
072700                    FROM TTRBNTF A                                07270083
072800                 WHERE                                            07280083
072900                        A.PO_NBR        = :RECEIV-ORD-NBR         07290083
073000                    AND A.REC_SEQ_NBR   = :RECEIV-REC-SEQ-NBR     07300083
073100                    AND A.RESOLVED_IND IN ('N','I')               07310083
073200                    AND NOT EXISTS                                07320083
073300                    (SELECT C.TRBL_RSN_CDE                        07330083
073310                       FROM TTRBRCN C                             07331083
073320                      WHERE C.RPT_PGM_NM  = 'PCKUT001'            07332086
073330                        AND A.TRBL_RSN_CDE  =  C.TRBL_RSN_CDE))   07333084
073350         WITH UR                                                  07335083
073360     END-EXEC.                                                    07336083
073400                                                                  07340005
073500     EVALUATE TRUE                                                07350005
073600         WHEN SQLCODE = ZERO                                      07360005
073800              CONTINUE                                            07380005
073810         WHEN SQLCODE = +100                                      07381080
073820              PERFORM 7047-CALL-LATEST-TROUBLE                    07382080
073900         WHEN SQLCODE = -811                                      07390005
074000              CONTINUE                                            07400005
074100         WHEN SQLWARN0 NOT = SPACE                                07410005
074200         WHEN SQLCODE < ZERO                                      07420005
074300         WHEN SQLCODE > ZERO                                      07430005
074400             PERFORM 9100-SQL-ABEND                               07440005
074500     END-EVALUATE.                                                07450005
074501                                                                  07450181
074510 7047-CALL-LATEST-TROUBLE.                                        07451081
074520     MOVE '7047-CALL-LATEST-TROUBLE'                              07452081
074530         TO PV-ABEND-PARAGRAPH.                                   07453081
074540                                                                  07454081
074550     EXEC SQL                                                     07455081
074560         SELECT RSN.TRBL_SHT_DESC                                 07456081
074570         INTO  :TRBRSN-TRBL-SHT-DESC                              07457081
074580         FROM  TTRBNTF TRB                                        07458081
074590             , TTRBRSN RSN                                        07459081
074591         WHERE  TRB.PO_NBR              = :RECEIV-ORD-NBR         07459181
074592            AND TRB.REC_SEQ_NBR         = :RECEIV-REC-SEQ-NBR     07459281
074593            AND TRB.TRBL_RSN_CDE        = RSN.TRBL_RSN_CDE        07459381
074594            AND TRB.NOTIF_TMST          =                         07459481
074595                (SELECT MAX(A.NOTIF_TMST)                         07459581
074596                    FROM TTRBNTF A                                07459681
074597                 WHERE                                            07459781
074598                        A.PO_NBR        = :RECEIV-ORD-NBR         07459881
074599                    AND A.REC_SEQ_NBR   = :RECEIV-REC-SEQ-NBR     07459981
074600                    AND A.RESOLVED_IND IN ('N','I'))              07460081
074610         WITH UR                                                  07461081
074620     END-EXEC.                                                    07462081
074630                                                                  07463081
074640     EVALUATE TRUE                                                07464081
074650         WHEN SQLCODE = ZERO                                      07465081
074660         WHEN SQLCODE = +100                                      07466081
074670         WHEN SQLCODE = -811                                      07467081
074680              CONTINUE                                            07468081
074690         WHEN SQLWARN0 NOT = SPACE                                07469081
074691         WHEN SQLCODE < ZERO                                      07469181
074692         WHEN SQLCODE > ZERO                                      07469281
074693             PERFORM 9100-SQL-ABEND                               07469381
074694     END-EVALUATE.                                                07469481
074700                                                                  07470005
074800******************************************************************07480005
074900*  ASSEMBLE THE OUTREC FROM VARIOUS DCLGEN FIELDS                 07490005
075000******************************************************************07500005
075100 7500-FORMAT-OUTREC.                                              07510010
075200                                                                  07520005
075400                                                                  07540005
075410     MOVE RECEIV-STATUS-CDE        TO TM008-STATUS-CDE.           07541057
075500     MOVE RECEIV-CURR-OPER-UNT-ID  TO TM008-CURRENT-OPER.         07550057
075600     MOVE WKORIN-PRC-FCLTY-AREA-ID TO TM008-PROCESS-AREA.         07560057
075700     MOVE PV-RECEIV-REC-DATE       TO TM008-REC-DATE.             07570057
075800     MOVE RECEIV-OPER-UNT-ID       TO TM008-LOGICAL-OPER.         07580057
075900     MOVE RECEIV-ORD-NBR           TO TM008-PO-NBR.               07590057
076000     MOVE RECEIV-REC-SEQ-NBR       TO TM008-REC-SEQ-NBR.          07600057
076100     MOVE WKORIN-LNE-LOC-CDE       TO TM008-LNE-LOC-CDE.          07610057
076200     MOVE ENTNME-ENT-NAME-DESC     TO TM008-VNDR-NME.             07620057
076300     MOVE PURCHS-DEPT-NBR          TO TM008-DEPT-NBR.             07630057
076400     MOVE PURCHS-SEASET-SHRT-NM    TO TM008-SEASET-NM.            07640057
076500***  }                             TO TM008-UNRESOLVED-TROUBLE.   07650057
076600***  } SEE LOGIC IN PARA 7000      TO TM008-LATEST-TROUBLE.       07660057
076700***  }                             TO TM008-MULTI-TROUBLE.        07670057
076800     IF RECEIV-ACTL-CART-CNT > ZERO                               07680005
076900         MOVE RECEIV-ACTL-CART-CNT     TO  TM008-CART-CNT         07690057
077000     ELSE                                                         07700005
077100         MOVE RECEIV-EXPTED-CART-CNT   TO  TM008-CART-CNT         07710057
077200     END-IF.                                                      07720005
077300     MOVE PA-PKSL-ITM-QTY          TO TM008-PKSL-ITM-QTY.         07730057
077400     IF RECEIV-PACK-BY-ST-IND = 'Y'                               07740005
077500         MOVE 'A'                  TO TM008-PROCESS-IND           07750057
077600     ELSE                                                         07760005
077700         MOVE 'N'                  TO TM008-PROCESS-IND           07770057
077800     END-IF.                                                      07780005
077810     MOVE RECEIV-PKGNG-CDE         TO TM008-PKGNG-CDE.            07781057
077811     IF RECEIV-PKGNG-CDE = 'M'                                    07781150
077812        MOVE 'MULTI' TO TM008-PACK-TYPE                           07781257
077813     END-IF.                                                      07781351
077814     IF RECEIV-PKGNG-CDE = 'I'                                    07781451
077815        MOVE 'INNER' TO TM008-PACK-TYPE                           07781557
077816     END-IF.                                                      07781650
077817     IF RECEIV-PKGNG-CDE = 'S'                                    07781772
077818        MOVE 'SNGLE' TO TM008-PACK-TYPE                           07781872
077819     END-IF.                                                      07781972
077820     IF RECEIV-PKGNG-CDE = 'C'                                    07782072
077821        MOVE 'CASPK' TO TM008-PACK-TYPE                           07782172
077822     END-IF.                                                      07782272
077823     SET TM008-STORE-COUNT-NOT-ONE TO TRUE.                       07782393
077824     IF RECEIV-PKGNG-CDE = 'B'                                    07782472
077825        MOVE 'BULK ' TO TM008-PACK-TYPE                           07782572
077826        IF PURCHS-SEASET-SHRT-NM(1:3) = 'FBP'                     07782690
077827           PERFORM 6000-CHECK-FLOWBACK-AUTO-PBS                   07782790
077828           IF PV-PBS-STORE-COUNT = 1                              07782890
077829              SET TM008-STORE-COUNT-ONE TO TRUE                   07782990
077830           ELSE                                                   07783090
077831              SET TM008-STORE-COUNT-NOT-ONE TO TRUE               07783190
077832           END-IF                                                 07783290
077833        END-IF                                                    07783390
077834     END-IF.                                                      07783472
077835     IF RECEIV-PKGNG-CDE = ' '                                    07783572
077836        MOVE 'PBS  ' TO TM008-PACK-TYPE                           07783672
077837     END-IF.                                                      07783772
077838     SET TM008-DETAIL-RECORD       TO TRUE.                       07783857
077839     SET TM008-NO-TRAILER-TOTAL     TO TRUE.                      07783957
077840     IF PV-RECEIV-REC-DATE = PC-DEFAULT                           07784074
077841         SET TM008-PRE-RECEIVED    TO  TRUE                       07784157
077842     ELSE                                                         07784255
077843         SET TM008-NOT-PRE-RECEIVED TO TRUE                       07784357
077844     END-IF.                                                      07784455
077845     IF RECEIV-STATUS-CDE = 'IP'                                  07784553
077846        PERFORM 7900-GET-PACKSLIP-IND                             07784656
077850     END-IF.                                                      07785053
077918                                                                  07791853
077919******************************************************************07791953
077920*  GET PACKSLIP INDICATOR                                         07792053
077921******************************************************************07792153
077922 7900-GET-PACKSLIP-IND.                                           07792253
077923     MOVE '7900-GET-PACKSLIP-IND'                                 07792353
077930         TO PV-ABEND-PARAGRAPH.                                   07793053
077940     MOVE 'GET PACKSLIP INDICATOR FROM TSHPTPO'                   07794053
077950         TO PV-DB2-OPERATION-ATTEMPTED.                           07795053
077960                                                                  07796053
077970     INITIALIZE DCLTSHPTPO.                                       07797053
077980                                                                  07798053
077990     EXEC SQL                                                     07799053
077991         SELECT  PKSL_IND                                         07799153
077992           INTO  :SHPTPO-PKSL-IND                                 07799253
077993           FROM  TSHPTPO                                          07799353
077994          WHERE  PO_NBR          =  :RECEIV-ORD-NBR               07799453
077995            AND  REC_SEQ_NBR     =  :RECEIV-REC-SEQ-NBR           07799553
077996            AND  PRIM_SHIPT_IND  =  'Y'                           07799653
077997          WITH UR                                                 07799753
077998     END-EXEC.                                                    07799853
077999                                                                  07799953
078000     EVALUATE TRUE                                                07800053
078001         WHEN SQLCODE = ZERO                                      07800153
078002              MOVE SHPTPO-PKSL-IND       TO TM008-PACKSLIP-IND    07800257
078003         WHEN SQLCODE = +100                                      07800353
078004              MOVE PC-N                  TO TM008-PACKSLIP-IND    07800457
078005         WHEN SQLCODE = -811                                      07800553
078006              MOVE SHPTPO-PKSL-IND       TO TM008-PACKSLIP-IND    07800657
078007              DISPLAY 'ORD NUM ' RECEIV-ORD-NBR                   07800753
078008              ' RCVR ' RECEIV-REC-SEQ-NBR                         07800853
078009         WHEN SQLWARN0 NOT = SPACE                                07800953
078010         WHEN SQLCODE < ZERO                                      07801053
078011         WHEN SQLCODE > ZERO                                      07801153
078012             PERFORM 9100-SQL-ABEND                               07801253
078013     END-EVALUATE.                                                07801353
078020******************************************************************07802005
078100* WRITE OUTREC AND DO SOME INITIALIZATIONS                        07810005
078200******************************************************************07820005
078300 8000-WRITE-OUTREC.                                               07830010
078400                                                                  07840005
078500     WRITE EXTRACT-RECORD FROM TM008-RECEIVER-EXT-RECORD.         07850057
078600                                                                  07860005
078700     ADD +1   TO PA-TOT-RECS-WRITTEN.                             07870005
078800                                                                  07880005
078900     INITIALIZE PA-PKSL-ITM-QTY                                   07890005
079000                PV-RECEIV-REC-DATE.                               07900005
079100                                                                  07910005
079200******************************************************************07920005
079300*  CLOSE OUTPUT FILE.  DISPLAY RECORD COUNTS                      07930005
079400******************************************************************07940005
079500 9000-TERMINATE.                                                  07950005
079600                                                                  07960005
079700     CLOSE EXTRACT-FILE.                                          07970005
079701                                                                  07970159
079703     REWRITE TIMESTAMP-RECORD FROM PV-END-TIMESTAMP.              07970368
079710     CLOSE TIMESTAMP-FILE.                                        07971059
079800                                                                  07980005
079900     DISPLAY SPACE.                                               07990005
080000     DISPLAY '****************************************'.          08000005
080100     DISPLAY '**    TMKUT021  SUMMARY STATISTICS    **'.          08010036
080200     DISPLAY '****************************************'.          08020005
080300     MOVE PA-TOT-TRBLS-READ       TO PV-DISPLAY-COUNT.            08030005
080400     DISPLAY 'TOTAL TROUBLE RECS READ       : '  PV-DISPLAY-COUNT.08040005
080500                                                                  08050005
080600     MOVE PA-TOT-RECS-WRITTEN     TO PV-DISPLAY-COUNT.            08060005
080700     DISPLAY 'TOTAL EXTRACT RECS WRITTEN    : '  PV-DISPLAY-COUNT.08070025
080800     DISPLAY 'START TIMESTAMP               : '                   08080059
080801                                          PV-START-TIMESTAMP.     08080159
080810     DISPLAY 'END TIMESTAMP                 : '  PV-END-TIMESTAMP.08081059
080900     DISPLAY '****************************************'.          08090005
081000                                                                  08100005
081100******************************************************************08110000
081200*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    08120000
081300*  ERROR OR WARNING CODE OCCURS.                                  08130000
081400******************************************************************08140000
081500 9100-SQL-ABEND.                                                  08150000
081600     DISPLAY '9100-SQL-ABEND'.                                    08160000
081700     DISPLAY '** ABEND     **'.                                   08170000
081800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        08180000
081900     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             08190000
082000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     08200000
082100                                                                  08210000
082200******************************************************************08220000
082300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    08230000
082400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         08240000
082500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     08250000
082600* FORMAT.                                                         08260000
082700******************************************************************08270000
082800     COPY DPPD004.                                                08280000
082900                                                                  08290000
083000     MOVE +4013                  TO ABEND-CODE.                   08300000
083100     CALL 'ILBOABN0' USING ABEND-CODE.                            08310000
083200*9100-EXIT.                                                       08320000
