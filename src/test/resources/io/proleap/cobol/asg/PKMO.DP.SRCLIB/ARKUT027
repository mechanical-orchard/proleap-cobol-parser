000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             ARKUT027.                                00050000
000600 AUTHOR.                 TAMARA KOLTUN.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            12-12-95                                 00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*---------------------------------------------------------------* 00110000
001200* THIS PROGRAM WILL PRODUCE  A  REPORT DISPLAYING INFO ON       * 00120008
001300* ACCOUNTS THAT WERE ISSUED MORE THAN 1 CREDIT REFUND CHECK     * 00130000
001400* DURING 13 MONTHS PERIOD.                                      * 00140000
001500*---------------------------------------------------------------* 00150000
001600******************************************************************00151010
001700*    DATE  07/10/2011                                            *00152010
001800*    WRITTEN BY: JILL ZIMBAL             WR/IR #: 3231A          *00153010
001900* - MADE THE ACCOUNT TYPE FIELD A FILLER.  WITH THE FIRST DATA   *00154010
002000*   CONVERSION THE ACCOUNT TYPE FIELD WILL NO LONGER BE USED     *00155010
002001******************************************************************00156010
002002                                                                  00160000
002003******************************************************************00170000
002004 ENVIRONMENT DIVISION.                                            00180000
002005******************************************************************00190000
002006                                                                  00200000
002100 CONFIGURATION SECTION.                                           00210000
002200                                                                  00220000
002300 SOURCE-COMPUTER.        IBM-3090.                                00230000
002400 OBJECT-COMPUTER.        IBM-3090.                                00240000
002500                                                                  00250000
002600 INPUT-OUTPUT SECTION.                                            00260000
002700                                                                  00270000
002800 FILE-CONTROL.                                                    00280000
002900      SELECT CREDIT-BALANCE-INFO         ASSIGN TO INP01.         00290000
003000      SELECT CHECK-AUDIT-REPORT          ASSIGN TO OUT01.         00300000
003100******************************************************************00310000
003200 DATA DIVISION.                                                   00320000
003300******************************************************************00330000
003400                                                                  00340000
003500 FILE SECTION.                                                    00350000
003600 FD  CREDIT-BALANCE-INFO                                          00360000
003700     LABEL RECORDS ARE STANDARD                                   00370000
003800     BLOCK CONTAINS 0 RECORDS                                     00380000
003900     RECORDING MODE IS F                                          00390000
004000     RECORD CONTAINS 241 CHARACTERS                               00400009
004100     DATA RECORD IS CB-CREDIT-BALANCE-RECORD.                     00410000
004200                                                                  00420000
004300 01  CB-CREDIT-BALANCE-RECORD        PIC X(241).                  00430009
004400                                                                  00440000
004500 FD  CHECK-AUDIT-REPORT                                           00450000
004600     LABEL RECORDS ARE STANDARD                                   00460000
004700     BLOCK CONTAINS 0 RECORDS                                     00470000
004800     RECORDING MODE IS F                                          00480000
004900     RECORD CONTAINS 132 CHARACTERS                               00490000
005000     DATA RECORD IS CR-CHECK-AUDIT-RECORD.                        00500000
005100                                                                  00510000
005200 01  CR-CHECK-AUDIT-RECORD           PIC X(132).                  00520000
005300                                                                  00530000
005400*------------------------------------------------------*          00540000
005500 WORKING-STORAGE SECTION.                                         00550000
005600*------------------------------------------------------*          00560000
005700 01 PC-PROGRAM-CONSTANTS.                                         00570000
005800    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'ARKUT027'.  00580000
005900    05 PC-REG-REPORT-NBR             PIC 9(01) VALUE 1.           00590000
006200    05 PC-VOID-IND                   PIC X(01) VALUE 'V'.         00620000
006210    05 PC-ASTERISK                   PIC X(01) VALUE '*'.         00621001
006300 01  DK-DATABASE-KEYS.                                            00630000
006400    05 DK-ACCOUNT-NBR                PIC S9(12) VALUE 0 COMP-3.   00640010
006410    05 DK-ACCOUNT-W52                PIC S9(12) VALUE 0 COMP-3.   00641010
006500    05 DK-VOID-IND                   PIC X(01) VALUE SPACE.       00650000
006501 01  WS-MISC-VARIABLES.                                           00650110
006502    05 WS-TYPE-VALUE                 PIC X(02) VALUE '52'.        00651011
006600                                                                  00660000
006700 01 PV-PROGRAM-VARIABLES.                                         00670000
006701     05  PV-CURR-TMST-DETAIL.                                     00670108
006702         10  PV-CURR-TMST-CC          PIC  X(02).                 00670209
006703         10  PV-CURR-TMST-YY          PIC  X(02).                 00670309
006704         10  FILLER                   PIC  X(01).                 00670409
006705         10  PV-CURR-TMST-MM          PIC  X(02).                 00670509
006706         10  FILLER                   PIC  X(01).                 00670609
006707         10  PV-CURR-TMST-DD          PIC  X(02).                 00670709
006708         10  FILLER                   PIC  X(01).                 00670809
006709         10  PV-CURR-TMST-HOUR        PIC  X(02).                 00670909
006710         10  FILLER                   PIC  X(01).                 00671009
006711         10  PV-CURR-TMST-MIN         PIC  X(02).                 00671109
006712         10  FILLER                   PIC  X(01).                 00671209
006713         10  PV-CURR-TMST-SEC         PIC  X(02).                 00671309
006714         10  FILLER                   PIC  X(07).                 00671409
006715     05  PV-CURR-TMST  REDEFINES PV-CURR-TMST-DETAIL              00671509
006716                                      PIC  X(26).                 00671609
006900    05 PV-ABEND-CODE                 PIC  9(04) VALUE 0.          00690000
007000    05 PV-ACCOUNT-NBR                PIC S9(12) VALUE 0.          00700010
008300    05 PV-REG-LINE-COUNT             PIC S9(04)    VALUE 61       00830000
008400                                                   COMP.          00840000
008500    05 PV-REG-PAGE-COUNT             PIC S9(04)    VALUE 0        00850000
008600                                                   COMP.          00860000
008700    05 PV-DB-READS-COUNT             PIC S9(04)    VALUE 0        00870000
008800                                                   COMP.          00880000
008900    05 PV-REFUND-AMT-ACCUM           PIC S9(10)V99 VALUE 0        00890000
009000                                                   COMP.          00900000
009100    05 PV-TOT-REPORT-LINES           PIC S9(4)     VALUE 0        00910000
009200                                                   COMP-3.        00920000
009700    05 PV-REFORMAT-DATE.                                          00970000
009800       10 PV-REF-YEAR.                                            00980000
009900          15 PV-REF-CC               PIC  9(02)    VALUE 0.       00990000
010000          15 PV-REF-YY               PIC  9(02)    VALUE 0.       01000000
010100       10 FILLER                     PIC  X(01)    VALUE '-'.     01010000
010200       10 PV-REF-MM                  PIC  9(02)    VALUE 0.       01020000
010300       10 FILLER                     PIC  X(01)    VALUE '-'.     01030000
010400       10 PV-REF-DD                  PIC  9(02)    VALUE 0.       01040000
010500    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   01050000
010600    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   01060000
010700    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   01070000
010800    05 PV-SQLCODE                    PIC Z(8)9-.                  01080000
010900    05 PV-PARAGRAPH-NAME             PIC X(30)     VALUE SPACE.   01090000
011000    05 PV-CRRFND-INFO-HOLD-AREA.                                  01100000
011100       10 PV-CK-NBR-HOLD           PIC S9(9) COMP     VALUE 0.    01110000
011200       10 PV-CK-DTE-HOLD           PIC  X(10)         VALUE SPACE.01120000
011300       10 PV-ACCT-NBR-HOLD         PIC S9(12)V COMP-3 VALUE 0.    01130000
011400       10 PV-CUST-NAME-HOLD        PIC  X(30)         VALUE SPACE.01140000
011500       10 PV-CUST-ADR-LNE1-HOLD    PIC  X(30)         VALUE SPACE.01150000
011600       10 PV-CUST-ADR-LNE2-HOLD    PIC  X(30)         VALUE SPACE.01160000
011700       10 PV-CUST-ADR-LNE3-HOLD    PIC  X(30)         VALUE SPACE.01170000
011800       10 PV-RFND-AMT-HOLD         PIC S9(12)V9(2) COMP-3 VALUE 0.01180000
011810       10 PV-STAFF-IND             PIC X(01)          VALUE SPACE.01181000
011900                                                                  01190000
012000 01 PS-PROGRAM-SWITCHES.                                          01200000
012100    05 PS-END-OF-FILE                PIC  X(01)    VALUE ' '.     01210000
012200       88 PS-EOF                                   VALUE 'E'.     01220000
012300       88 PS-NOT-EOF                               VALUE ' '.     01230000
012400    05 PS-END-OF-TABLE               PIC  X(01)    VALUE ' '.     01240000
012500       88 PS-EOT                                   VALUE 'E'.     01250000
012600       88 PS-NOT-EOT                               VALUE ' '.     01260000
012700    05 PS-ALL-ACCOUNTS-PROCESSED-SW  PIC  X(01)    VALUE 'N'.     01270000
012800       88 PS-ALL-ACCOUNTS-PROCESSED                VALUE 'Y'.     01280000
012900       88 PS-NOT-ALL-ACCOUNTS-PROCESSED            VALUE 'N'.     01290000
013000                                                                  01300000
013100*** STANDARD HEADER LINE - 132 BYTES.                             01310000
013200     COPY DPWS132O.                                               01320003
013300                                                                  01330000
013400****                                                              01340000
013500 01 CR-CHECK-REPORT-AREA.                                         01350000
013600    05 CR-HEADER-LINE-2.                                          01360000
013700       10 FILLER                     PIC  X(52)      VALUE SPACE. 01370000
013800       10 FILLER                     PIC  X(27)      VALUE        01380000
013900       '     CHECK AUDIT REPORT    '.                             01390000
014000       10 FILLER                     PIC  X(53)      VALUE SPACE. 01400000
014100                                                                  01410000
014200    05 CR-HEADER-LINE-4.                                          01420000
014300       10 FILLER                     PIC  X(04) VALUE SPACE.      01430000
014400       10 FILLER                     PIC  X(07)      VALUE        01440000
014500                                          'ACCOUNT'.              01450000
014600       10 FILLER                     PIC  X(05)      VALUE SPACE. 01460000
014700       10 FILLER                     PIC  X(05)      VALUE        01470000
014800                                          'CHECK'.                01480000
014900       10 FILLER                     PIC  X(02)      VALUE SPACE. 01490000
015000       10 FILLER                     PIC  X(05)      VALUE        01500000
015100                                          'ISSUE'.                01510000
015200       10 FILLER                     PIC  X(06)      VALUE SPACE. 01520000
015300       10 FILLER                     PIC  X(05)      VALUE        01530000
015400                                          'CHECK'.                01540000
015500       10 FILLER                     PIC  X(03)      VALUE SPACE. 01550000
015600       10 FILLER                     PIC  X(14)      VALUE        01560000
015700                                          'CUSTOMER  NAME'.       01570000
015800       10 FILLER                     PIC  X(15)      VALUE SPACE. 01580000
015900       10 FILLER                     PIC  X(48)      VALUE        01590000
016000              'C  U  S  T  O  M  E  R       A  D  D  R  E  S  S'. 01600000
016100       10 FILLER                     PIC  X(13)      VALUE SPACE. 01610000
016200                                                                  01620000
016300    05 CR-HEADER-LINE-5.                                          01630000
016400       10 FILLER                     PIC  X(05) VALUE SPACE.      01640000
016500       10 FILLER                     PIC  X(03)      VALUE        01650000
016600                                          'NUM'.                  01660000
016700       10 FILLER                     PIC  X(09)      VALUE SPACE. 01670000
016800       10 FILLER                     PIC  X(03)      VALUE        01680000
016900                                          'NUM'.                  01690000
017000       10 FILLER                     PIC  X(04)      VALUE SPACE. 01700000
017100       10 FILLER                     PIC  X(04)      VALUE        01710000
017200                                          'DATE'.                 01720000
017300       10 FILLER                     PIC  X(07)      VALUE SPACE. 01730000
017400       10 FILLER                     PIC  X(03)      VALUE        01740000
017500                                          'AMT'.                  01750000
017600       10 FILLER                     PIC  X(92)      VALUE SPACE. 01760000
017700                                                                  01770000
017800                                                                  01780000
017900    05 CR-SPACE-LINE                 PIC X(132)   VALUE SPACE.    01790000
018000                                                                  01800000
018100    05 CR-DETAIL-LINE.                                            01810000
018200       10 FILLER                     PIC  X(01)    VALUE SPACE.   01820000
018210       10 CR-ASSOCIATE-IND           PIC  X(01)    VALUE SPACE.   01821000
018300       10 CR-ACCOUNT-NBR             PIC  X(12)    VALUE ZEROS.   01830000
018400       10 FILLER                     PIC  X(01)    VALUE SPACE.   01840000
018500       10 CR-CHECK-NUM               PIC  9(06)    VALUE ZEROS.   01850000
018600       10 FILLER                     PIC  X(01)    VALUE SPACE.   01860000
018700       10 CR-ISSUE-DATE              PIC  X(08)    VALUE SPACE.   01870000
018800       10 FILLER                     PIC  X(01)    VALUE SPACE.   01880000
018900       10 CR-REFUND-AMT              PIC  Z(05).99 VALUE ZEROS.   01890000
019000       10 FILLER                     PIC  X(02)    VALUE SPACE.   01900000
019100       10 CR-CUST-NAME               PIC  X(25)    VALUE ZEROS.   01910000
019200       10 FILLER                     PIC  X(02)    VALUE SPACE.   01920000
019300       10 CR-CUST-ADDRESS            PIC  X(64)    VALUE SPACE.   01930000
019400    05 CR-NO-INFO-LINE.                                           01940000
019500       10 FILLER                     PIC  X(01)    VALUE SPACE.   01950000
019600       10 FILLER                     PIC  X(69)    VALUE          01960000
019700       '*** NONE OF THE ACCOUNTS ISSUED CHECKS HAVE PRIOR CHECK HI01970000
019800-      'STORY ***'.                                               01980000
019900       10 FILLER                     PIC  X(62)    VALUE SPACE.   01990000
020000****                                                              02000000
020100     COPY ARWS051.                                                02010003
020200******* DB2 MESSAGE AREAS ********                                02020000
020300     COPY DPWS004.                                                02030003
020400                                                                  02040000
020500                                                                  02050000
020600     EXEC SQL                                                     02060000
020700          INCLUDE SQLCA                                           02070000
020800     END-EXEC.                                                    02080000
020900                                                                  02090000
021000     EXEC SQL                                                     02100000
021100          INCLUDE TCRRFND                                         02110000
021200     END-EXEC.                                                    02120000
021300                                                                  02130000
021400     EXEC SQL                                                     02140000
021500          DECLARE TCRRFND-READ-CRS CURSOR FOR                     02150000
021600               SELECT  CK_NBR                                     02160000
021700                      ,CK_DTE                                     02170000
021800                      ,VOID_IND                                   02180000
021900                      ,ACCT_NBR                                   02190000
022000                      ,RFND_AMT                                   02200000
022100                      ,CUST_NAME                                  02210000
022200                      ,CUST_ADR_LNE1                              02220000
022300                      ,CUST_ADR_LNE2                              02230000
022400                      ,CUST_ADR_LNE3                              02240000
022410                      ,STAFF_IND                                  02241000
022500                FROM TCRRFND                                      02250000
022600                WHERE ((ACCT_NBR   = :DK-ACCOUNT-W52  OR          02260010
022610                        ACCT_NBR   = :DK-ACCOUNT-NBR) AND         02261010
022700                        VOID_IND   = :DK-VOID-IND)                02270010
022800                ORDER BY CK_NBR                                   02280000
022900                FOR FETCH ONLY                                    02290000
023000     END-EXEC.                                                    02300000
023100********************************************************          02310000
023200 PROCEDURE DIVISION.                                              02320000
023300********************************************************          02330000
023400 0000-MAIN.                                                       02340000
023500     PERFORM 0001-INITIALIZATION       THRU 0001-EXIT.            02350000
023600     PERFORM 0300-MAIN-LOOP            THRU 0300-EXIT             02360000
023700        UNTIL PS-ALL-ACCOUNTS-PROCESSED.                          02370005
023800     IF PV-TOT-REPORT-LINES = 0                                   02380000
023900        PERFORM 0325-HEADERS            THRU 0325-EXIT            02390000
024000        WRITE CR-CHECK-AUDIT-RECORD     FROM                      02400000
024100                              CR-NO-INFO-LINE                     02410000
024200               AFTER ADVANCING 1 LINE                             02420000
024300     END-IF.                                                      02430000
024400                                                                  02440000
024500 0000-EXIT.  STOP RUN.                                            02450000
024600                                                                  02460000
024700 0001-INITIALIZATION.                                             02470000
024701       EXEC SQL                                                   02470109
024702          SET  :PV-CURR-TMST = CURRENT TIMESTAMP                  02470209
024703       END-EXEC                                                   02470309
024704       EVALUATE TRUE                                              02470409
024705           WHEN SQLCODE NOT = 0                                   02470509
024706           WHEN SQLWARN0    = 'W'                                 02470609
024707               MOVE '0100-INITIALIZE '  TO PV-ABEND-PARA-NAME     02470709
024708               MOVE 'GET CURRENT DATE'  TO PV-DB2-OPERATION-MSG-1 02470809
024709               MOVE '       '           TO PV-DB2-TABLE-NAME      02470909
024710               PERFORM 9998-SQL-ABEND   THRU 9998-EXIT            02471009
024711       END-EVALUATE.                                              02471109
024712                                                                  02471209
024713       MOVE PV-CURR-TMST-YY          TO DP132O-RUN-YEAR.          02471309
024714       MOVE PV-CURR-TMST-MM          TO DP132O-RUN-MONTH.         02471409
024715       MOVE PV-CURR-TMST-DD          TO DP132O-RUN-DAY.           02471509
024716                                                                  02471609
024717       MOVE PV-CURR-TMST-HOUR        TO DP132O-RUN-HOUR.          02471709
024718       MOVE PV-CURR-TMST-MIN         TO DP132O-RUN-MINUTE.        02471809
024719                                                                  02471909
026500       MOVE PC-PROGRAM-NAME          TO DP132O-PROGRAM-NAME.      02650003
026600                                                                  02660000
026700       OPEN INPUT CREDIT-BALANCE-INFO.                            02670000
026800       OPEN OUTPUT CHECK-AUDIT-REPORT.                            02680000
026900                                                                  02690000
027000       READ CREDIT-BALANCE-INFO INTO AR051-CREDIT-BALANCE-RECORD  02700000
027100       AT END                                                     02710000
027200           DISPLAY '***********************************'          02720000
027300           DISPLAY 'FROM ARKUT027: INPUT FILE IS EMPTY.'          02730000
027400           DISPLAY '***********************************'          02740000
027500           SET PS-EOF       TO TRUE                               02750000
027600       END-READ.                                                  02760000
027700 0001-EXIT.  EXIT.                                                02770000
027800                                                                  02780000
027900 0300-MAIN-LOOP.                                                  02790000
028100       MOVE 0                           TO PV-DB-READS-COUNT.     02810012
028200       MOVE AR051-ACCOUNT-10            TO PV-ACCOUNT-NBR.        02821012
028300       MOVE PV-ACCOUNT-NBR              TO DK-ACCOUNT-NBR.        02830012
028400                                                                  02830110
028500       STRING AR051-ACCOUNT-10          DELIMITED BY SIZE         02830210
028600              WS-TYPE-VALUE             DELIMITED BY SIZE         02830311
028700        INTO PV-ACCOUNT-NBR                                       02830412
028800       END-STRING.                                                02830512
028900       MOVE PV-ACCOUNT-NBR              TO DK-ACCOUNT-W52.        02830612
028901                                                                  02830710
028902       PERFORM 0305-OPEN-CURSOR         THRU 0305-EXIT.           02831005
028903       PERFORM 0310-FETCH-ROW           THRU 0310-EXIT            02840000
028904          UNTIL SQLCODE = 100.                                    02850005
028905       PERFORM 0327-CLOSE-CURSOR        THRU 0327-EXIT.           02860005
029000       PERFORM 0990-READ-INPUT-FILE     THRU 0990-EXIT.           02900005
029100                                                                  02910005
029110       IF PS-EOF                                                  02911005
029120          SET PS-ALL-ACCOUNTS-PROCESSED TO TRUE                   02912005
029140       END-IF.                                                    02914005
029200 0300-EXIT.  EXIT.                                                02920000
029300                                                                  02930000
029400 0305-OPEN-CURSOR.                                                02940000
029500       EXEC SQL                                                   02950000
029600            OPEN TCRRFND-READ-CRS                                 02960000
029700       END-EXEC.                                                  02970000
029800                                                                  02980000
029900       EVALUATE TRUE                                              02990000
030000          WHEN SQLCODE = ZERO                                     03000000
030100               CONTINUE                                           03010000
030200          WHEN OTHER                                              03020000
030300               MOVE '0305-OPEN-CURSOR'  TO PV-ABEND-PARA-NAME     03030000
030400               MOVE 'OPEN CURSOR'       TO PV-DB2-OPERATION-MSG-1 03040000
030500               MOVE 'TCRRFND'           TO PV-DB2-TABLE-NAME      03050000
030600               PERFORM 9998-SQL-ABEND   THRU 9998-EXIT            03060000
030700       END-EVALUATE.                                              03070000
030800 0305-EXIT.  EXIT.                                                03080000
030900                                                                  03090000
031000 0310-FETCH-ROW.                                                  03100000
031100       EXEC SQL                                                   03110000
031200           FETCH TCRRFND-READ-CRS                                 03120000
031300           INTO  :CRRFND-CK-NBR                                   03130000
031400                ,:CRRFND-CK-DTE                                   03140000
031500                ,:CRRFND-VOID-IND                                 03150000
031600                ,:CRRFND-ACCT-NBR                                 03160000
031700                ,:CRRFND-RFND-AMT                                 03170000
031800                ,:CRRFND-CUST-NAME                                03180000
031900                ,:CRRFND-CUST-ADR-LNE1                            03190000
032000                ,:CRRFND-CUST-ADR-LNE2                            03200000
032100                ,:CRRFND-CUST-ADR-LNE3                            03210000
032110                ,:CRRFND-STAFF-IND                                03211000
032200       END-EXEC.                                                  03220000
032300                                                                  03230000
032400       EVALUATE TRUE                                              03240000
032500           WHEN SQLCODE = ZERO                                    03250000
032600              ADD 1     TO PV-DB-READS-COUNT                      03260000
032700              IF PV-DB-READS-COUNT > 1                            03270000
032800                 PERFORM 0320-WRITE-CHECK-AUDIT-RPT THRU 0320-EXIT03280000
032900                 PERFORM 0315-SAVE-ACCT-INFO        THRU 0315-EXIT03290000
033000              ELSE                                                03300000
033100                 PERFORM 0315-SAVE-ACCT-INFO        THRU 0315-EXIT03310000
033200               END-IF                                             03320000
033300           WHEN SQLCODE = +100                                    03330000
033400              IF PV-DB-READS-COUNT > 1                            03340000
033500                 PERFORM 0320-WRITE-CHECK-AUDIT-RPT THRU 0320-EXIT03350000
033600                 WRITE CR-CHECK-AUDIT-RECORD   FROM  CR-SPACE-LINE03360000
033700                 INITIALIZE PV-CRRFND-INFO-HOLD-AREA              03370000
033800              END-IF                                              03380000
033900           WHEN OTHER                                             03390000
034000               MOVE '0310-FETCH-PROCESS-ROW' TO PV-ABEND-PARA-NAME03400000
034100               MOVE 'FETCH CRRFND-CRS'  TO PV-DB2-OPERATION-MSG-1 03410000
034200               MOVE 'TCRRFND'           TO PV-DB2-TABLE-NAME      03420000
034300               PERFORM 9998-SQL-ABEND   THRU 9998-EXIT            03430000
034400       END-EVALUATE.                                              03440000
034500                                                                  03450000
034600 0310-EXIT.  EXIT.                                                03460000
034700                                                                  03470000
034800 0315-SAVE-ACCT-INFO.                                             03480000
034900     MOVE CRRFND-CK-NBR         TO  PV-CK-NBR-HOLD.               03490000
035000     MOVE CRRFND-CK-DTE         TO  PV-CK-DTE-HOLD.               03500000
035100     MOVE CRRFND-ACCT-NBR       TO  PV-ACCT-NBR-HOLD.             03510000
035200     MOVE CRRFND-RFND-AMT       TO  PV-RFND-AMT-HOLD.             03520000
035300     MOVE CRRFND-CUST-NAME      TO  PV-CUST-NAME-HOLD.            03530000
035400     MOVE CRRFND-CUST-ADR-LNE1  TO  PV-CUST-ADR-LNE1-HOLD.        03540000
035500     MOVE CRRFND-CUST-ADR-LNE2  TO  PV-CUST-ADR-LNE2-HOLD.        03550000
035600     MOVE CRRFND-CUST-ADR-LNE3  TO  PV-CUST-ADR-LNE3-HOLD.        03560000
035610     MOVE CRRFND-STAFF-IND      TO  PV-STAFF-IND.                 03561000
035700 0315-EXIT.  EXIT.                                                03570000
035800                                                                  03580000
035900 0327-CLOSE-CURSOR.                                               03590000
036000       EXEC SQL                                                   03600000
036100           CLOSE TCRRFND-READ-CRS                                 03610000
036200       END-EXEC.                                                  03620000
036300 0327-EXIT.  EXIT.                                                03630000
036400                                                                  03640000
036500 0320-WRITE-CHECK-AUDIT-RPT.                                      03650000
036600      PERFORM 0325-HEADERS   THRU 0325-EXIT                       03660000
036700                                                                  03670000
036800      ADD 1                     TO PV-TOT-REPORT-LINES            03680000
036900      ADD 1                     TO PV-REG-LINE-COUNT              03690000
037000      MOVE PV-CK-NBR-HOLD       TO CR-CHECK-NUM                   03700000
037100      MOVE PV-CK-DTE-HOLD       TO PV-REFORMAT-DATE               03710000
037200      STRING PV-REF-MM                                            03720000
037300             '/'                                                  03730000
037400             PV-REF-DD                                            03740000
037500             '/'                                                  03750000
037600             PV-REF-YY                                            03760000
037700             DELIMITED BY SIZE                                    03770000
037800            INTO CR-ISSUE-DATE                                    03780000
037900      END-STRING                                                  03790000
038000      MOVE PV-RFND-AMT-HOLD     TO CR-REFUND-AMT                  03800000
038100      IF PV-DB-READS-COUNT > 2                                    03810000
038200         MOVE SPACE                TO CR-ACCOUNT-NBR              03820000
038300      ELSE                                                        03830000
038400         MOVE PV-ACCT-NBR-HOLD     TO CR-ACCOUNT-NBR              03840000
038500      END-IF                                                      03850000
038510      IF PV-STAFF-IND = SPACE                                     03851001
038520         MOVE SPACE                TO CR-ASSOCIATE-IND            03852002
038530      ELSE                                                        03853001
038540         MOVE PC-ASTERISK          TO CR-ASSOCIATE-IND            03854001
038550      END-IF                                                      03855001
038600      MOVE PV-CUST-NAME-HOLD       TO CR-CUST-NAME                03860000
038700      STRING                                                      03870000
038800         PV-CUST-ADR-LNE1-HOLD                                    03880000
038900         ' '                                                      03890000
039000         PV-CUST-ADR-LNE3-HOLD                                    03900000
039100        DELIMITED BY SIZE                                         03910000
039200        INTO CR-CUST-ADDRESS                                      03920000
039300      END-STRING                                                  03930000
039400                                                                  03940000
039500      WRITE CR-CHECK-AUDIT-RECORD      FROM  CR-DETAIL-LINE       03950000
039600             AFTER ADVANCING 1 LINE.                              03960000
039700 0320-EXIT.  EXIT.                                                03970000
039800                                                                  03980000
039900 0325-HEADERS.                                                    03990000
040000      IF PV-REG-LINE-COUNT > 60                                   04000000
040100         ADD  1                 TO PV-REG-PAGE-COUNT              04010000
040200         MOVE PV-REG-PAGE-COUNT                                   04020000
040300                                TO DP132O-PAGE-NUMBER             04030000
040400         MOVE 0                 TO PV-REG-LINE-COUNT              04040000
040500         MOVE PC-REG-REPORT-NBR TO DP132O-REPORT-NUMBER           04050000
040600         WRITE CR-CHECK-AUDIT-RECORD     FROM                     04060000
040700                              DP132O-STANDRD-HEADER-132-COLS      04070000
040800                AFTER ADVANCING PAGE                              04080000
040900         WRITE CR-CHECK-AUDIT-RECORD     FROM                     04090000
041000                               CR-HEADER-LINE-2                   04100000
041100                AFTER ADVANCING 1 LINE                            04110000
041200                                                                  04120000
041300         WRITE CR-CHECK-AUDIT-RECORD     FROM                     04130000
041400                               CR-HEADER-LINE-4                   04140000
041500                AFTER ADVANCING 3 LINES                           04150000
041600         WRITE CR-CHECK-AUDIT-RECORD     FROM                     04160000
041700                               CR-HEADER-LINE-5                   04170000
041800                AFTER ADVANCING 1 LINE                            04180000
041900         ADD  13                TO PV-REG-LINE-COUNT              04190000
042000      END-IF.                                                     04200000
042100 0325-EXIT.  EXIT.                                                04210000
042200                                                                  04220000
042300 0990-READ-INPUT-FILE.                                            04230000
042400       INITIALIZE AR051-CREDIT-BALANCE-RECORD.                    04240000
042500       READ CREDIT-BALANCE-INFO INTO AR051-CREDIT-BALANCE-RECORD  04250000
042600         AT END                                                   04260000
042700            SET PS-EOF    TO TRUE                                 04270000
042800       END-READ.                                                  04280000
042900 0990-EXIT.  EXIT.                                                04290000
043000                                                                  04300000
043100 9998-SQL-ABEND.                                                  04310000
043200     MOVE SQLCODE     TO PV-SQLCODE.                              04320000
043300     DISPLAY '** ABEND           ** = SQLABEND'.                  04330000
043400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          04340000
043500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        04350000
043600     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        04360000
043700     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   04370000
043800     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               04380000
043900     COPY DPPD004.                                                04390003
044000                                                                  04400000
044100     EXEC SQL                                                     04410000
044200          ROLLBACK                                                04420000
044300     END-EXEC.                                                    04430000
044400                                                                  04440000
044500     MOVE +4013                  TO PV-ABEND-CODE.                04450000
044600     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       04460014
044700 9998-EXIT.  EXIT.                                                04470000
