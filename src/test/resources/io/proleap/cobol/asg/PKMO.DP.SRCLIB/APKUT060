000100 IDENTIFICATION DIVISION.                                         00010022
000200 PROGRAM-ID.     APKUT060.                                        00020047
000300 AUTHOR.         COGNIZANT.                                       00030048
000400*DATE-WRITTEN.   MARCH 2019.                                      00040057
000500*DATE-COMPILED.                                                   00050023
000600*************************************************************     00060023
000700*    COBOL 2                                                *     00070023
000800*                                                           *     00080023
001010*    THE PURPOSE OF THIS PROGRAM IS TO CREATE THE ZERBAL    *     00101065
001020*    UPDATE FILE TO BE TRANSFERRED TO ORACLE.               *     00102065
001050*************************************************************     00105023
002700* DB2 TABLES:                              DCLGENS:              *00105152
002800*  1. AP-INVOICE TABLE                      TINVOIC              *00105252
001060*                                                           *     00106023
001070* INPUT:                                                    *     00107023
001080* 1.  AP-MER-INV-FILE                    (APRD040)          *     00108049
001090*                                                           *     00109023
001100* OUTPUT                                                    *     00110023
001200* 1.  AP-ZERBAL-FILE                     (APRD005)          *     00120051
001300* 2.  #RECS IN AP-REFMT-TRANS FILE                          *     00130023
      *-----------------------------------------------------------*     00141066
      * CHANGE LOG:                                               *     00142066
      *   DATE  03/13/2019                                        *     00143066
      *       CHANGE MADE: NEW PROGRAM                            *     00144066
      *       MADE BY: COGNIZANT           WR/IR #: CHG0220043    *     00145066
      *                                                           *     00146066
      *-----------------------------------------------------------*     00147066
001500                                                                  00150023
001600 ENVIRONMENT DIVISION.                                            00160023
001700                                                                  00170023
001800 INPUT-OUTPUT SECTION.                                            00180023
001900                                                                  00190023
002000 FILE-CONTROL.                                                    00200023
002100                                                                  00210023
002200     SELECT AP-MER-INV-FILE           ASSIGN TO INP01.            00220049
002300                                                                  00230023
002400     SELECT AP-ZERBAL-FILE            ASSIGN TO OUT01.            00240050
002700                                                                  00270023
002800 DATA DIVISION.                                                   00280023
002900                                                                  00290023
003000 FILE SECTION.                                                    00300023
003100                                                                  00310023
003200 FD  AP-MER-INV-FILE                                              00320049
003300     LABEL RECORDS  ARE STANDARD                                  00330023
003400     RECORDING MODE IS  F                                         00340023
           BLOCK CONTAINS 0 RECORDS                                     00341037
003500     DATA RECORD    IS  AP-MER-INV-RECORD.                        00350050
003600                                                                  00360023
003700 01  AP-MER-INV-RECORD             PIC X(500).                    00370050
003800                                                                  00380023
003900 FD  AP-ZERBAL-FILE                                               00390050
004000     RECORDING MODE IS F                                          00400023
004100     LABEL RECORDS ARE STANDARD                                   00410023
004200     BLOCK CONTAINS 0 RECORDS                                     00420023
004300     DATA RECORD IS AP-ZERBAL-RECORD.                             00430050
004400                                                                  00440023
004500 01  AP-ZERBAL-RECORD              PIC X(41).                     00450064
004600                                                                  00460023
005300 WORKING-STORAGE SECTION.                                         00530023
005400                                                                  00540023
005500 01  FILLER                        PIC X(25) VALUE                00550023
005600                             'WS FOR APKUT060 BEGINS==>'.         00560047
005700                                                                  00570023
005800 01  PV-PROGRAM-VARIABLES.                                        00580023
005900     05  PV-DISC-PCT                  PIC S9V9(4) VALUE ZEROES.   00590023
005900     05  PV-ONE                       PIC X(01)   VALUE SPACES.   00591052
006000     05  PV-TEMP-AMT                  PIC S9(9)V99                00600023
006100                                                  VALUE ZEROES.   00610023
006900*                                                                 00690023
007000 01  PV-PROGRAM-COUNTERS.                                         00700023
007100     05  PV-INPUT-COUNT               PIC 9(9)  VALUE ZEROS.      00710023
007200     05  PV-WRITTEN-OUT-REC-CNT       PIC 9(9) VALUE ZEROS.       00720023
007300                                                                  00730023
007400 01  PS-SWITCHES.                                                 00740023
007500     05  PS-END-OF-FILE-SW            PIC X(01) VALUE 'N'.        00750055
007600         88  END-OF-FILE                        VALUE 'Y'.        00760023
007700         88  NOT-END-OF-FILE                    VALUE 'N'.        00770023
016600     05  PS-INV-PROCESSED-SW    PIC  X          VALUE ' '.        00780055
016700         88  PS-INV-PROCESSED                   VALUE 'Y'.        00790055
016700         88  PS-INV-NOT-PROCESSED               VALUE 'N'.        00800056
008100                                                                  00810023
030700*----------------------------------------------------------------*00811055
030800*    ABEND DATA AREAS                                             00812055
030900*----------------------------------------------------------------*00813055
031000 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      00814055
031100                                   COMP         SYNC.             00815055
031200                                                                  00816055
031300     88  AC-ANY-ERROR                           VALUE  +4001      00817055
031400                                                THRU   +4019.     00818055
031500     88  AC-INVALID-KEY-WRITE                   VALUE  +4001.     00819055
031600     88  AC-INVALID-KEY-READ                    VALUE  +4002.     00819155
031700     88  AC-INVALID-CONTROL-CARD                VALUE  +4003.     00819255
031800     88  AC-OPEN-ERROR                          VALUE  +4005.     00819355
031900     88  AC-CLOSE-ERROR                         VALUE  +4006.     00819455
032000     88  AC-INVALID-DATA                        VALUE  +4008.     00819555
032100     88  AC-DB2-ERROR                           VALUE  +4013.     00819655
032200     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     00819755
032300     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     00819855
032400                                                                  00819955
032500 01  ABEND-AREAS.                                                 00820055
032600     05  AA-ABEND-LIT              PIC  X(40)   VALUE             00820155
032700             '*****       ABEND'.                                 00820255
032800     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             00820355
032900             '*****   PROGRAM: APKUT060'.                         00820455
033000     05  AA-PARAGRAPH-LIT.                                        00820555
033100         10  FILLER                PIC  X(17)   VALUE             00820655
033200             '***** PARAGRAPH: '.                                 00820755
033300         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     00820855
033400     05  AA-MESSAGE-LINE-1.                                       00820955
033500         10  FILLER                PIC  X(06)   VALUE '*****'.    00821055
033600         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     00821155
033700     05  AA-MESSAGE-LINE-2.                                       00821255
033800         10  FILLER                PIC  X(06)   VALUE '*****'.    00821355
033900         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     00821455
034000     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             00821555
034100             '*****    DB2 ERROR'.                                00821655
034200     05  AA-DB2-OPERATION-LIT.                                    00821755
034300         10  FILLER                PIC  X(17)   VALUE             00821855
034400             '***** OPERATION: '.                                 00821955
034500         10  AA-DB2-OPERATION.                                    00822055
034600             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     00822155
034700             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     00822255
034800     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     00822355
034900     05  AA-DB2-TABLE-2            PIC  X(08)   VALUE SPACES.     00822455
035000     05  AA-DB2-TABLE-3            PIC  X(08)   VALUE SPACES.     00822555
035100                                                                  00822655
008200*----------------------------------------------------------------*00823023
008300*  ACCOUNTS PAYABLE TRANSACTION COPYBOOK                         *00830023
008400*----------------------------------------------------------------*00840023
008500     COPY APRD040.                                                00850023
008600                                                                  00860023
008700*----------------------------------------------------------------*00870023
008800*  ACCOUNTS ACCOUNTS PAYABLE PAYMENT HOLD COPYBOOK               *00880037
008900*----------------------------------------------------------------*00890023
009000     COPY APRD005.                                                00900064
                                                                        00900152
027300*    SQL COMMUNICATIONS AREA DCLGEN                               00901052
027400*----------------------------------------------------------------*00902052
027500     EXEC SQL                                                     00903052
027600         INCLUDE SQLCA                                            00904052
027700     END-EXEC.                                                    00905052
027800                                                                  00906052
027900*----------------------------------------------------------------*00907052
028000*    AP-INVOICE TABLE                                             00908052
028100*----------------------------------------------------------------*00909052
028200     EXEC SQL                                                     00909152
028300         INCLUDE TINVOIC                                          00909252
028400     END-EXEC.                                                    00909352
                                                                        00909453
030000*----------------------------------------------------------------*00909553
030100*    DB2 AREA FOR SYSDUMMY1                                       00909653
030200*----------------------------------------------------------------*00909753
030300     EXEC SQL                                                     00909853
030400          INCLUDE SYSDUMMY                                        00909953
030500     END-EXEC.                                                    00910053
037800*---------------------------------------------------------------- 00910160
037900*  SQLCA FORMATTED MESSAGE AREA                                   00910260
038000*---------------------------------------------------------------- 00910360
038100     COPY DPWS004.                                                00910460
030600                                                                  00910953
009100                                                                  00911023
009200 PROCEDURE DIVISION.                                              00920023
009300                                                                  00930023
009400 A100-MAINLINE.                                                   00940023
009500                                                                  00950023
009600     PERFORM B100-INITIALIZATION.                                 00960023
009700                                                                  00970023
009800     PERFORM B200-PROCESSING                                      00980023
009900        UNTIL END-OF-FILE.                                        00990023
010000                                                                  01000023
010100     PERFORM B300-END-OF-JOB.                                     01010023
010200                                                                  01020023
010300     GOBACK.                                                      01030023
010400*---------------------------------------------------------------* 01040023
010500*    OPEN FILES AND PERFORM INITIAL READ                          01050023
010700*---------------------------------------------------------------* 01070023
010800 B100-INITIALIZATION.                                             01080023
010900                                                                  01090023
011000     DISPLAY '**********************************'                 01100023
011100     DISPLAY '*   STARTING PROGRAM APKUT060    *'                 01110047
011200     DISPLAY '**********************************'                 01120023
011300                                                                  01130023
011400     OPEN  INPUT AP-MER-INV-FILE                                  01140049
011500          OUTPUT AP-ZERBAL-FILE.                                  01150050
011700                                                                  01170023
011800     PERFORM R100-READ-AP-MER-INV-FILE.                           01180049
011900                                                                  01190023
012000     IF END-OF-FILE                                               01200023
012100        DISPLAY '**********************************'              01210023
012200        DISPLAY '* AP INVOICE FILE                *'              01220044
012300        DISPLAY '* INPUT FILE IS EMPTY.           *'              01230023
012400        DISPLAY '**********************************'              01240023
012500     END-IF.                                                      01250023
012600                                                                  01260023
012700*---------------------------------------------------------------* 01270023
012800*  PROCESS AP TRANS RECORDS AND CALCULATE DUE DATE AND          * 01280023
012900*  OTP DATES BASED ON THE RECEIVING DATE.                       * 01290023
013000*---------------------------------------------------------------* 01300023
013100 B200-PROCESSING.                                                 01310023
013200                                                                  01320023
                                                                        01371037
016700     INITIALIZE AP005-TEXT-FILE                                   01372046
016800                PV-PROGRAM-VARIABLES.                             01373042
016900                                                                  01374042
013300     MOVE AP040-PO-NBR              TO INVOIC-PO-NBR.             01375052
                                                                        01376042
013300     MOVE AP040-DOC-NBR             TO INVOIC-INVC-ID.            01377052
                                                                        01378042
                                                                        01379152
           PERFORM S100-SELECT-INVOICE-RI.                              01379254
                                                                        01379356
068000         IF PS-INV-PROCESSED                                      01379456
                  MOVE AP040-VND-NBR TO AP005-VND-NBR                   01379556
                  MOVE AP040-DOC-NBR TO AP005-INVC-NBR                  01379656
068100            STRING AP040-DOC-NBR DELIMITED BY SPACE               01379764
068200                   'SHTG'        DELIMITED BY SPACE               01379864
068300              INTO AP005-CM-INVC-NBR                              01379956
013800            PERFORM W100-WRITE-OUTPUT-REC                         01380056
               END-IF.                                                  01380156
                                                                        01381042
014200                                                                  01420023
014300     PERFORM R100-READ-AP-MER-INV-FILE.                           01430049
014400                                                                  01440023
014500 B300-END-OF-JOB.                                                 01450023
014600                                                                  01460023
014900     DISPLAY '*----------------------------------------------*'.  01490023
015000     DISPLAY 'PROGRAM APKUT060 RECORD COUNTS '                    01500047
015100     DISPLAY 'TOTAL AP TRANS RECORDS READ    = '                  01510023
015200              PV-INPUT-COUNT                                      01520023
015300     DISPLAY 'TOTAL AP REFORMATTED TRANS RECORDS WRITTEN   = '    01530023
015400              PV-WRITTEN-OUT-REC-CNT                              01540023
015500     DISPLAY '*----------------------------------------------*'.  01550023
015600     DISPLAY ' PROGRAM APKUT060 ENDS NORMALLY '.                  01560047
015700                                                                  01570023
015800     CLOSE AP-MER-INV-FILE                                        01580049
015900           AP-ZERBAL-FILE.                                        01590050
016100                                                                  01610023
024824*---------------------------------------------------------------* 02482423
024825*     READ THE AP INVOICE FILE                                  * 02482539
024826*---------------------------------------------------------------* 02482623
024827 R100-READ-AP-MER-INV-FILE.                                       02482749
024828                                                                  02482823
024829     READ AP-MER-INV-FILE INTO AP040-TRANSACTION-FILE             02482949
024830         AT END  SET END-OF-FILE TO TRUE.                         02483023
024840                                                                  02484023
024850     IF NOT-END-OF-FILE                                           02485023
024860        ADD 1 TO PV-INPUT-COUNT                                   02486023
024870     END-IF.                                                      02487023
024880                                                                  02488023
024890*---------------------------------------------------------------* 02489023
024900*  SELECT THE INVOICE USED FOR REPAYMENT                        * 02490054
025000*---------------------------------------------------------------* 02500023
025100 S100-SELECT-INVOICE-RI.                                          02510054
025200                                                                  02520023
119400     EXEC SQL                                                     02521054
119500         SELECT '1'                                               02522054
119600           INTO  :PV-ONE                                          02523054
119700           FROM SYSIBM.SYSDUMMY1 X                                02524054
119800          WHERE EXISTS                                            02525054
119900               (SELECT 1                                          02526054
120000                  FROM TINVOIC A                                  02527054
120100                 WHERE A.PO_NBR       = :INVOIC-PO-NBR            02528056
120200                   AND A.INVC_ID      = :INVOIC-INVC-ID           02529056
120300                   AND A.INVC_TYP_CDE = 'RI'                      02529154
                         AND X.IBMREQD      = X.IBMREQD)                02529256
120400     END-EXEC.                                                    02529356
120500                                                                  02529454
120600     EVALUATE TRUE                                                02529554
120700         WHEN SQLCODE = ZERO                                      02529654
120800            SET PS-INV-PROCESSED TO TRUE                          02529756
                                                                        02530856
121600         WHEN SQLCODE = +100                                      02530954
121700            SET PS-INV-NOT-PROCESSED TO TRUE                      02531056
121800                                                                  02531154
121900         WHEN SQLWARN0 NOT = SPACES                               02531254
122000         WHEN SQLCODE NOT  = ZERO                                 02531354
122100            MOVE 'S100-SELECT-INVOICE-RI'                         02531455
122200                                TO AA-PARAGRAPH-NAME              02531554
122300            MOVE 'UNSUCCESSFUL EXISTENCE CHECK'                   02531654
122400                                TO AA-DB2-OPERATION               02531754
122500            MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                 02531854
122600            MOVE SPACES         TO AA-DB2-TABLE-2                 02531954
122700            PERFORM Z999-DB2-ABEND                                02532054
122800     END-EVALUATE.                                                02532154
122900                                                                  02533054
024890*---------------------------------------------------------------* 02561054
024900*  WRITE THE UNJOUNRALIZED AGED RECORD TO THE OUTPUT FILE.      * 02562054
025000*---------------------------------------------------------------* 02563054
025100 W100-WRITE-OUTPUT-REC.                                           02564054
025200                                                                  02565054
025300     WRITE AP-ZERBAL-RECORD                                       02566054
025400         FROM AP005-TEXT-FILE.                                    02567054
025500                                                                  02568054
025600     ADD 1 TO PV-WRITTEN-OUT-REC-CNT.                             02569054
025700                                                                  02570023
139500*----------------------------------------------------------------*02580056
139600*    DB2 ABEND ROUTINE                                           *02590056
139700*----------------------------------------------------------------*02600056
139800 Z999-DB2-ABEND.                                                  02610056
139900                                                                  02620056
015800     CLOSE AP-MER-INV-FILE                                        02631056
015900           AP-ZERBAL-FILE.                                        02632056
140300                                                                  02660056
140400     DISPLAY 'VND_NBR = ' AP040-VND-NBR.                          02670058
140500     DISPLAY 'PO_NBR  = ' AP040-PO-NBR.                           02680058
140600     DISPLAY 'DOC_NBR = ' AP040-DOC-NBR.                          02690058
140700     DISPLAY AA-ABEND-LIT.                                        02700056
140800     DISPLAY AA-MESSAGE-LINE-1.                                   02710056
140900     DISPLAY AA-MESSAGE-LINE-2.                                   02720056
141000     DISPLAY AA-DB2-ERROR-LIT.                                    02730056
141100     DISPLAY AA-PROGRAM-LIT.                                      02740056
141200     DISPLAY AA-PARAGRAPH-LIT.                                    02750056
141300     DISPLAY AA-DB2-OPERATION-LIT.                                02760056
141400     DISPLAY AA-DB2-TABLE-1.                                      02770056
141500     DISPLAY AA-DB2-TABLE-2.                                      02780056
141600     DISPLAY AA-DB2-TABLE-3.                                      02790056
141700     SET AC-DB2-ERROR TO TRUE.                                    02800056
141800                                                                  02810056
141900     COPY DPPD004.                                                02820056
142000                                                                  02830056
142100     CALL 'ILBOABN0' USING ABEND-CODE.                            02840056
142200                                                                  02850056
