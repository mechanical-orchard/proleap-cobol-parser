000100******************************************************************04/11/95
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************   LV002
000400                                                                          
000500 PROGRAM-ID.                VLKCS519.                                     
000600 AUTHOR.                    MICHAEL WALTERS.                              
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.                      
000800 DATE-WRITTEN.              01-03-97.                                     
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200*  CICS PROGRAM - VLKCS519 - V519                                *        
001300*                                                                *        
001400*       VL TICKET FORMAT MAINTENANCE SCREEN                      *        
001500*                                                                *        
001600*  THIS SCREEN WILL CREATE, UPDATE AND DELETE TICKET FORMATS     *        
001700******************************************************************        
263627*---------------------------------------------------------------*         
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*---------------------------------------------------------------*         
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
001800 ENVIRONMENT DIVISION.                                                    
001900                                                                          
002000 DATA DIVISION.                                                           
002100                                                                          
002200 WORKING-STORAGE SECTION.                                                 
002300                                                                          
002400 01  DK-DB2-KEYS.                                                         
002500     15  DK-TKT-FMT-ID                  PIC  X(06) VALUE SPACE.           
002600     15  DK-PAPER-TYP-ID                PIC  X(06) VALUE SPACE.           
003200                                                                          
003300 01  PC-PROGRAM-CONSTANTS.                                                
004200     05  PC-PRETICKET-VSM-CODE          PIC S9(04)  COMP                  
004300                                                    VALUE +2.             
004301     05  PC-PRETICKET-FUNCTION-ID       PIC S9(04)  COMP                  
004302                                                    VALUE +5.             
004400     05  PC-PRETICKET-TYP-CDE           PIC S9(04)  COMP                  
004500                                                    VALUE +1.             
004600     05  PC-SERVICE-AGRMT-CDE           PIC  X(01)  VALUE '4'.            
004700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE                 
004800                                                    'VL519A  '.           
004900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE                 
005000                                                    'VLKM519 '.           
005100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE                 
005200                                                    'VLKCS519'.           
005500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.              
005600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.              
005700     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.            
005800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10             
005900                                                    COMP SYNC.            
006000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2              
006100                                                    COMP SYNC.            
006200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE                 
006300                                                    +1000000              
006400                                                    COMP-3.               
006500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5              
006600                                                    COMP SYNC.            
006700     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3               
006800                                                    COMP-3.               
006900     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.            
007000     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.          
007100     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.          
007200     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.          
007300     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.          
007310     05  PC-DUP-TKT-FMT-MSG             PIC  X(43)  VALUE                 
007320         'NNNNN-E-DUPLICATE TICKET FORMAT DESCRIPTION'.                   
007400*                                                                         
007500     05  PC-TSYMSG-NUMBERS.                                               
007600         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.          
007610         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
007700         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.          
007800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
007900         10  PC-TSYMSG-00034            PIC  9(05)  VALUE 00034.          
008000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.          
008010         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
008100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
008200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
008300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
008400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
008500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
008600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
008610         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.          
008700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
008800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
008900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
008901         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.          
008902         10  PC-TSYMSG-00116            PIC  9(05)  VALUE 00116.          
009000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
009010         10  PC-TSYMSG-00349            PIC  9(05)  VALUE 00349.          
009100         10  PC-TSYMSG-00874            PIC  9(05)  VALUE 00874.          
009110         10  PC-TSYMSG-01339            PIC  9(05)  VALUE 01339.          
009111*  TICKET FORMAT ALREADY EXISTS - CANNOT ADD                              
009120         10  PC-TSYMSG-01490            PIC  9(05)  VALUE 01490.          
009121*  'E' OR 'I' ENTRY REQUIRED                                              
009122         10  PC-TSYMSG-01624            PIC  9(05)  VALUE 01624.          
009123*  REQUIRED ENTRY FOR TICKET FORMAT TYPE CODE 'E'                         
009130         10  PC-TSYMSG-01625            PIC  9(05)  VALUE 01625.          
009140*  MUST BE AN 'N' FOR TICKET FORMAT TYPE CODE 'E'                         
009150         10  PC-TSYMSG-01626            PIC  9(05)  VALUE 01626.          
009160*  MUST BE A 'Y' FOR TICKET FORMAT TYPE CODE 'E'                          
009170         10  PC-TSYMSG-01628            PIC  9(05)  VALUE 01628.          
009180*  AT LEAST ONE TICKET OFFICE MUST BE SELECTED                            
009190         10  PC-TSYMSG-01670            PIC  9(05)  VALUE 01670.          
009200         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.          
009300*                                                                         
009400 01  PS-PROGRAM-SWITCHES.                                                 
009500     05  PS-SHIP-DEL-CURSOR-SW          PIC  X(01)  VALUE 'Y'.            
009600         88  PS-EOC-SHIP-DEL                        VALUE 'Y'.            
009700         88  PS-NOT-EOC-SHIP-DEL                    VALUE 'N'.            
009701     05  PS-SEL-RECORD-SW               PIC  X(01)  VALUE 'Y'.            
009702         88  PS-SEL-RECORD-FOUND                    VALUE 'Y'.            
009703         88  PS-SEL-RECORD-NOT-FOUND                VALUE 'N'.            
009800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.            
009900         88  PS-NO-ERROR                            VALUE 'Y'.            
010000         88  PS-ERROR                               VALUE 'N'.            
010100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.            
010200         88  PS-COMMAREA-VALID                      VALUE 'Y'.            
010300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.            
010400*                                                                         
010500 01  PV-PROGRAM-VARIABLES.                                                
012700                                                                          
012900     05  PV-DATE-ISO.                                                     
013000         10  PV-DATE-CC                 PIC  X(02).                       
013100         10  PV-DATE-YY                 PIC  X(02).                       
013200         10  PV-DATE-DASH1              PIC  X VALUE '-'.                 
013300         10  PV-DATE-MM                 PIC  X(02).                       
013400         10  PV-DATE-DASH2              PIC  X VALUE '-'.                 
013500         10  PV-DATE-DD                 PIC  X(02).                       
013600     05  PV-DATE-6BYTE.                                                   
013700         10  PV-DATE-YY                 PIC  X(02).                       
013800         10  PV-DATE-MM                 PIC  X(02).                       
013900         10  PV-DATE-DD                 PIC  X(02).                       
014000     05  PV-DATE-USA.                                                     
014100         10  PV-DATE-MM                 PIC  X(02).                       
014200         10  PV-DATE-SLASH1             PIC  X VALUE '/'.                 
014300         10  PV-DATE-DD                 PIC  X(02).                       
014400         10  PV-DATE-SLASH2             PIC  X VALUE '/'.                 
014500         10  PV-DATE-CC                 PIC  X(02).                       
014600         10  PV-DATE-YY                 PIC  X(02).                       
014700                                                                          
014800     05  PV-TIMESTAMP           PIC X(26).                                
014900     05  PV-TIMESTAMP-SPLIT.                                              
015000         10  PV-TMST-DATE       PIC X(10).                                
015010         10  FILLER             PIC X(04).                                
015100         10  PV-MINUTE          PIC X(02).                                
015200         10  FILLER             PIC X(02).                                
015300         10  PV-SECOND          PIC X(01).                                
015400         10  FILLER             PIC X(01).                                
015500         10  PV-NANOSEC-1-3     PIC X(03).                                
015600         10  PV-NANOSEC-4-6     PIC X(03).                                
015700                                                                          
015800     05  PV-RANDOM-KEY          PIC 9(09).                                
015900     05  FILLER REDEFINES PV-RANDOM-KEY.                                  
016000         10  PV-RND-NANOSEC-4-6 PIC X(03).                                
016100         10  PV-RND-NANOSEC-1-3 PIC X(03).                                
016200         10  PV-RND-MINUTE      PIC X(02).                                
016300         10  PV-RND-SECOND      PIC X(01).                                
016400                                                                          
016401     05  PV-DISPLAY-ABEND-MESSAGE       PIC  X(79) VALUE SPACES.          
016402     05  PV-DISPLAY-COMP1               PIC  9(09) VALUE ZERO.            
016403     05  PV-DISPLAY-COMP2               PIC  9(09) VALUE ZERO.            
016404     05  PV-WORK-DATE.                                                    
016405         10  PV-WORK-CC                 PIC XX.                           
016406         10  PV-WORK-YY                 PIC XX.                           
016407         10  FILLER                     PIC X.                            
016408         10  PV-DISPLAY-DATE.                                             
016409             15 PV-WORK-MM              PIC XX.                           
016410             15 FILLER                  PIC X.                            
016411             15 PV-WORK-DD              PIC XX.                           
016412     05  PV-STATUS-CODE                 PIC X.                            
016413     05  PV-REQUEST-TICKET-TOTAL        PIC S9(09)  VALUE +0              
016414                                                    COMP SYNC.            
016415     05  PV-REQUEST-LINE-COUNT          PIC S9(04)  VALUE +0              
016416                                                    COMP SYNC.            
016417     05  PV-READ-COUNT                  PIC S9(04)  VALUE +0              
016418                                                    COMP SYNC.            
016419     05  PV-SUB                         PIC S9(04)  VALUE +0              
016500                                                    COMP SYNC.            
016600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0              
016700                                                    COMP SYNC.            
017000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
017100                                                    COMP-3.               
017200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
017300                                                    COMP-3.               
017400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0              
017500                                                    COMP-3.               
017600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0              
017700                                                    COMP-3.               
017800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0              
017900                                                    COMP-3.               
018000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0              
018100                                                    COMP-3.               
018200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0              
018300                                                    COMP SYNC.            
018400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0              
018500                                                    COMP SYNC.            
018600     05  PV-ITEM                        PIC S9(04)  VALUE +0              
018700                                                    COMP SYNC.            
018701     05  PV-SHIP-ITEM                   PIC S9(04)  VALUE +0              
018702                                                    COMP SYNC.            
018703     05  PV-COMM-ITEM                   PIC S9(04)  VALUE +0              
018704                                                    COMP SYNC.            
018705     05  PV-SEL-ITEM                    PIC S9(04)  VALUE +0              
018706                                                    COMP SYNC.            
019000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0              
019100                                                    COMP SYNC.            
019200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0              
019300                                                    COMP SYNC.            
019400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0              
019500                                                    COMP SYNC.            
019600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
019700                                                    COMP SYNC.            
019800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
019900                                                    COMP SYNC.            
020000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
020100                                                    COMP SYNC.            
020200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
020300                                                    COMP SYNC.            
020400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
020500                                                    COMP SYNC.            
020600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
020700                                                    COMP SYNC.            
020800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
020900                                                    COMP SYNC.            
021000     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0              
021100                                                    COMP SYNC.            
021200     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0              
021300                                                    COMP SYNC.            
021310     05  PV-DB2-COUNT                   PIC S9(04)  VALUE +0              
021320                                                    COMP SYNC.            
021400******************************************************************        
021500**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **        
021600**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **        
021700**  APPLICATION-SPECIFIC COMMAREA.                              **        
021800******************************************************************        
021900 01  LQW-LIST-QUEUE-WORK-AREA.                                            
022000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.          
022100     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES                   
022200                                        INDEXED BY LQW-IDX.               
022300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.               
022400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               DPKCS036
022500         10  LQW-SELECTED-SW            PIC  X(01).               DPKCS036
022600             88  LQW-SELECT                         VALUE 'S'.    DPKCS036
022700             88  LQW-DESELECT                       VALUE ' '.    DPKCS036
032800         10  LQW-TKT-OFFICE             PIC  X(06).                       
032900         10  LQW-OPER-UNT-ID            PIC  9(04).                       
033000         10  LQW-FACILITY-ID            PIC  9(04).                       
033100         10  LQW-TKT-OFF-ADDRESS        PIC  X(08).                       
033101                                                                          
033102     EJECT                                                                
033103*---------------------------------------------------------------*         
033104*    MAP LAYOUT                                                 *         
033105*---------------------------------------------------------------*         
033106                                                                          
033107     COPY VLKM519.                                                        
033108*                                                                         
033109 01  MR-OCCURS-LAYOUT                   REDEFINES  VL519AO.               
033110     05  FILLER                         PIC X(42).                        
033120     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.                  
033130         10  MR-SELECTL                 PIC S9(04) COMP.          DPKCS036
033140         10  MR-SELECTA                 PIC  X(01).               DPKCS036
033150         10  MR-SELECTC                 PIC  X(01).               DPKCS036
033160         10  MR-SELECTH                 PIC  X(01).               DPKCS036
033161         10  MR-SELECT                  PIC  X(01).               DPKCS036
033162                                                                          
033163         10  MR-TKT-OFF-IDL             PIC S9(04) COMP.          DPKCS036
033164         10  MR-TKT-OFF-IDA             PIC  X(01).               DPKCS036
033165         10  MR-TKT-OFF-IDC             PIC  X(01).               DPKCS036
033166         10  MR-TKT-OFF-IDH             PIC  X(01).               DPKCS036
033167         10  MR-TKT-OFF-ID              PIC  X(06).               DPKCS036
033168                                                                          
033169         10  MR-OPER-UNT-IDL            PIC S9(04) COMP.          DPKCS036
033170         10  MR-OPER-UNT-IDA            PIC  X(01).               DPKCS036
033180         10  MR-OPER-UNT-IDC            PIC  X(01).               DPKCS036
033190         10  MR-OPER-UNT-IDH            PIC  X(01).               DPKCS036
033191         10  MR-OPER-UNT-ID             PIC  X(04).               DPKCS036
033192                                                                          
033193         10  MR-FCLTY-IDL               PIC S9(04) COMP.          DPKCS036
033194         10  MR-FCLTY-IDA               PIC  X(01).               DPKCS036
033195         10  MR-FCLTY-IDC               PIC  X(01).               DPKCS036
033196         10  MR-FCLTY-IDH               PIC  X(01).               DPKCS036
033197         10  MR-FCLTY-ID                PIC  X(04).               DPKCS036
033198                                                                          
033199         10  MR-TKT-OFF-ADR-IDL         PIC S9(04) COMP.          DPKCS036
033200         10  MR-TKT-OFF-ADR-IDA         PIC  X(01).               DPKCS036
033300         10  MR-TKT-OFF-ADR-IDC         PIC  X(01).               DPKCS036
033400         10  MR-TKT-OFF-ADR-IDH         PIC  X(01).               DPKCS036
033401         10  MR-TKT-OFF-ADR-ID          PIC  X(08).               DPKCS036
033402                                                                          
033403                                                                          
033404     EJECT                                                                
033405*---------------------------------------------------------------*         
033406*    ATTRIBUTE SETTINGS COPYBOOK.                               *         
033407*---------------------------------------------------------------*         
033408                                                                          
033409     COPY DPWS015.                                                        
033410                                                                          
033411*---------------------------------------------------------------*         
033412*    FUNCTION KEYS COPYBOOK.                                    *         
033413*---------------------------------------------------------------*         
033414                                                                          
033415     COPY DPWS016.                                                        
033416                                                                          
033417*---------------------------------------------------------------*         
033418*    NUMERIC EDIT LAYOUT.                                       *         
033419*---------------------------------------------------------------*         
033420                                                                          
033421     COPY DPWS010I.                                                       
033422*---------------------------------------------------------------*         
033423*    WORKING STORAGE LAYOUT FOR THE TS QUEUE (FROM THE TICKET   *         
033424*    FORMAT LIST SCREEN                                         *         
033425*---------------------------------------------------------------*         
033426                                                                          
033427     COPY VLWS014.                                                        
033428 EJECT                                                                    
033429*---------------------------------------------------------------*         
033430*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
033431*---------------------------------------------------------------*         
033432                                                                          
033433     COPY DPWS030.                                                        
CICS       COPY DPWS930.                                                        
033434 EJECT                                                                    
033435*---------------------------------------------------------------*         
033436*    STANDARD COMMAREA.                                         *         
033437*---------------------------------------------------------------*         
033438                                                                          
033439     COPY DPWS020.                                                        
033440     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
033441                                                                          
033442*---------------------------------------------------------------*         
033443* INTER-APPLICATION COMMAREA.                                   *         
033444*   VLWS013 - IS THE INPUT LAYOUT WHEN COMING FROM THE TICKET   *         
033445*             FORMAT LIST SCREEN, AND FOR OUTPUT TO THE TICKET  *         
033446*             OFFICE MAINTENANCE SCREEN                         *         
033447*---------------------------------------------------------------*         
033448                                                                          
033449         10  INTER-APPL-COMM-AREA       PIC X(200).                       
033450     COPY VLWS013.                                                        
033451*---------------------------------------------------------------*         
033452*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *         
033453*---------------------------------------------------------------*         
033454         10  ASC-SPECIFIC-COMMAREA.                                       
033455             15  ASC-LIST-KEYS.                                           
033456                 20  ASC-KEY-TKT-FMT-ID              PIC  X(06).          
033457             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                        
033458                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).          
033459                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.           
033460                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.           
033461                                                                          
033462                 20  ASC-ITEM-ARRAY.                                      
033463                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.                
033464                         30  ASC-LIST-ITEM-NUMBER                         
033465                                                     PIC S9(09)           
033466                                                     COMP-3.              
033467                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  DPKCS036
033468                             88  ASC-VALID-SELECT    VALUE ' '    DPKCS036
033469                                                           'S'    DPKCS036
033470                                                           'B'    DPKCS036
033480                                                           'E'.   DPKCS036
033490                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   DPKCS036
033500                             88  ASC-TEMP-SELECT     VALUE 'S'.   DPKCS036
033600                             88  ASC-TEMP-BEGIN      VALUE 'B'.   DPKCS036
033700                             88  ASC-TEMP-END        VALUE 'E'.   DPKCS036
033800                         30  ASC-SELECTED-SW         PIC  X(01).  DPKCS036
033900                             88  ASC-NO-SELECT       VALUE ' '.   DPKCS036
034000                             88  ASC-SELECT          VALUE 'S'.   DPKCS036
034100                             88  ASC-BEGIN           VALUE 'B'.   DPKCS036
034101                             88  ASC-END             VALUE 'E'.   DPKCS036
034102                         30  ASC-TKT-OFF-ID          PIC  X(06).          
034103                         30  ASC-OPER-UNT-ID         PIC  9(04).          
034104                         30  ASC-FCLTY-ID            PIC  9(04).          
034106                         30  ASC-TKT-OFF-ADR-ID      PIC  X(08).          
034107             15  ASC-SCREEN-FIELDS.                                       
034108                 20  ASC-TKT-FMT-DESC                PIC  X(20).          
034109                 20  ASC-TKT-FMT-DESC-OLD            PIC  X(20).          
034110                 20  ASC-PTICK-FMT-IND               PIC  X(01).          
034111                     88 ASC-PTICK-TKT-FMT            VALUE 'Y'.           
034112                     88 ASC-NOT-PTICK-TKT-FMT        VALUE 'N'.           
034113                 20  ASC-DISP-SIZE-IND               PIC  X(01).          
034114                 20  ASC-DISP-COLOR-IND              PIC  X(01).          
034115                 20  ASC-DISP-OPTBLK-TAG-IND         PIC  X(01).          
034116                 20  ASC-DISP-OPTBLK-LBL-IND         PIC  X(01).          
034117                 20  ASC-DISP-STKR-NBR-IND           PIC  X(01).          
034118                 20  ASC-PAPER-TYP-ID-OLD            PIC  X(06).          
034119                 20  ASC-PAPER-TYP-ID                PIC  X(06).          
034120                 20  ASC-NBR-XTRA-TIX.                                    
034121                     25  ASC-NBR-XTRA-TIX-N          PIC  9(04).          
034122                 20  ASC-PCT-XTRA-TIX.                                    
034123                     25  ASC-PCT-XTRA-TIX-N          PIC  9(04).          
034124                 20  ASC-TKT-FMT-TYP-CDE             PIC  X(01).          
034125                 20  ASC-TKT-FMT-NBR                 PIC  X(15).          
040800*            15  ASC-CURRENT-DATE                    PIC  X(10).          
040801             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).          
040802                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'.         
040803                 88  ASC-DONT-USE-SELECTION-QUEUE      VALUE 'N'.         
040900             15  ASC-BLK-SUB                         PIC S9(04)           
041000                                                          COMP            
041100                                                          SYNC.           
041200             15  ASC-ITEM-SUB                        PIC S9(04)           
041300                                                          COMP            
041400                                                          SYNC.           
041500             15  ASC-SEL-SUB                         PIC S9(04)      CL*41
041600                                                         COMP.       CL*41
041700             15  ASC-SEL-ITEM                        PIC S9(04)      CL*41
041701                                                         COMP.       CL*41
041702             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)           
041703                                                          COMP-3.         
041704             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)           
041800                                                          COMP-3.         
041900             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(09)           
042000                                                          COMP-3.         
042001             15  ASC-NUMBER-OF-SHIP-RECS             PIC S9(09)           
042002                                                          COMP-3.         
042003             15  ASC-NUMBER-OF-SHIP-TS-ITEMS         PIC S9(09)           
042004                                                          COMP-3.         
042005             15  ASC-NUMBER-OF-COMM-RECS             PIC S9(09)           
042006                                                          COMP-3.         
042007             15  ASC-NUMBER-OF-COMM-TS-ITEMS         PIC S9(09)           
042008                                                          COMP-3.         
042100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)           
042200                                                          COMP-3.         
042300             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)           
042400                                                          COMP-3.         
042500             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)           
042600                                                          COMP-3.         
042700             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)           
042800                                                          COMP            
042900                                                          SYNC.           
043000             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)           
043100                                                          COMP-3.         
043200             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)           
043300                                                          COMP-3.         
043400             15  ASC-FORMAT-INDICATOR                PIC X(01).           
043500                 88  ASC-TICKET-LIST-FORMAT      VALUE  '1',              
043510                                                        '2',              
043600                                                        '3'.              
043700                 88  ASC-CREATE-TKT-FMT-FORMAT   VALUE  '1'.              
043800                 88  ASC-UPDATE-TKT-FMT-FORMAT   VALUE  '2'.              
043801                 88  ASC-DELETE-TKT-FMT-FORMAT   VALUE  '3'.              
043802             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).          
043803                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.           
043804                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.           
043805             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).          
043806                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.           
043900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.           
044000             15  ASC-LIST-QUEUE-NAME.                                     
044100                 20  ASC-LIST-TERM-ID                PIC  X(04).          
044200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
044300                                                          COMP-3.         
044400                 20  ASC-LIST-SEQ                    PIC  9(01).          
044500             15  ASC-SEL-QUEUE-NAME-IN               PIC  X(08).          
044510             15  ASC-SEL-QUEUE-NAME.                                      
044600                 20  ASC-SEL-TERM-ID                 PIC  X(04).          
044700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)           
044800                                                          COMP-3.         
044900                 20  ASC-SEL-SEQ                     PIC  9(01).          
045700             15  ASC-ACTION-COMPLETE-SW              PIC X(01).           
045701                 88  ASC-ACTION-PENDING              VALUE ' '.           
045702                 88  ASC-DELETE-COMPLETE             VALUE 'D'.           
045703                 88  ASC-ADD-COMPLETE                VALUE 'A'.           
045704             15  ASC-START-ITEM-REQUEST.                                  
045800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).          
045900     EJECT                                                                
046000*---------------------------------------------------------------*         
046100*    ABEND PROCESSING COPYBOOK.                                 *         
046200*---------------------------------------------------------------*         
046300                                                                          
046400     COPY DPWS013.                                                        
046500                                                                          
046600 EJECT                                                                    
046700*---------------------------------------------------------------*         
046800*    DB2 AREA FOR THE TICKET FORMAT TABLE                       *         
046900*---------------------------------------------------------------*         
047000     EXEC SQL                                                             
047100          INCLUDE TTKTFMT                                                 
047200     END-EXEC.                                                            
047201*---------------------------------------------------------------*         
047202*    DB2 AREA FOR THE PRINT STOCK TABLE                         *         
047203*---------------------------------------------------------------*         
047204     EXEC SQL                                                             
047205          INCLUDE TPRTSTK                                                 
047206     END-EXEC.                                                            
047207*---------------------------------------------------------------*         
047208*    DB2 AREA FOR THE VSM CHARACTERISTIC VALUES TABLE           *         
047209*---------------------------------------------------------------*         
047210     EXEC SQL                                                             
047211          INCLUDE TVSCHVL                                                 
047212     END-EXEC.                                                            
047300*---------------------------------------------------------------*         
047400*    DB2 AREA FOR COMMUNICATIONS                                *         
047500*---------------------------------------------------------------*         
047600     EXEC SQL                                                             
047700          INCLUDE SQLCA                                                   
047800     END-EXEC.                                                            
047900                                                                          
052100                                                                          
052200*---------------------------------------------------------------*         
052300*    TICKET OFFICE CURSOR TO DISPLAY ALL THE POSSIBLE TICKET    *         
052310*    OFFICES.                                                   *         
052400*---------------------------------------------------------------*         
052500                                                                          
052600     EXEC SQL                                                             
052700          DECLARE TKT_OFFICE_CURSOR CURSOR FOR                          86
052800          SELECT                                                          
052900                 A.TKT_OFF_ID                                             
053000               , A.OPER_UNT_ID                                            
053100               , A.FCLTY_ID                                               
053200               , A.TKT_OFF_ADR_ID                                         
053300          FROM                                                            
053400                 TTKTFMT A                                                
053500          GROUP BY                                                        
053600                 A.TKT_OFF_ID                                             
053700               , A.OPER_UNT_ID                                            
053800               , A.FCLTY_ID                                               
053900               , A.TKT_OFF_ADR_ID                                         
054000          ORDER BY 1, 2                                                   
054100                                                                          
056500     END-EXEC.                                                            
056600                                                                          
056700 EJECT                                                                    
056800 LINKAGE SECTION.                                                         
056900                                                                          
057000 01  DFHCOMMAREA.                                                         
057100     05  FILLER                         OCCURS  1 TO 4072 TIMES           
057200                                        DEPENDING ON EIBCALEN.            
057300         10  FILLER                     PIC X.                            
057400                                                                          
057500 EJECT                                                                    
057600 PROCEDURE DIVISION.                                                      
057700******************************************************************        
057800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **        
057900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **        
058000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **        
058100******************************************************************        
058200 0000-MAIN-MODULE.                                                        
058300     INITIALIZE DP030-CICS-API-FIELDS.                                    
058400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
058500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
058600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
058700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
058800     MOVE LENGTH OF VL519AI        TO DP030-MAP-LENGTH (1).               
058900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
059000     PERFORM 0001-CALL-CICS-ARCH-API.                                     
059100*                                                                         
059200     PERFORM 1000-CONTROL-PROCESSING                                      
059300*                                                                         
059400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
059500     PERFORM 0001-CALL-CICS-ARCH-API.                                     
059600                                                                          
059700******************************************************************        
059800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **        
059900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **        
060000******************************************************************        
060100 0001-CALL-CICS-ARCH-API.                                                 
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
060300                                    DFHCOMMAREA                           
060400                                    DP030-CICS-API-FIELDS                 
060500                                    DP020-STANDARD-COMMAREA               
060600                                    VL519AI.                              
060700*                                                                         
060800     IF  DP030-RC-CALL-SUCCESSFUL                                         
060900         CONTINUE                                                         
061000     ELSE                                                                 
061100         SET DP013-NO-ROLLBACK                                            
061200             DP013-XCTL-DISPLAY-RESTART                                   
061300             DP013-CICS-ABEND      TO TRUE                                
061400         MOVE '0001-CALL-CICS-ARCH-API'                                   
061500                                   TO DP013-PARAGRAPH                     
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
061800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
061900         PERFORM DP013-0000-PROCESS-ABEND                                 
062000     END-IF.                                                              
062100*----------------------------------------------------------------*        
062200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *        
062300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *        
062400*                                                                *        
062500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *        
062600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *        
062700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *        
062800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *        
062900*----------------------------------------------------------------*        
063000                                                                          
063100 1000-CONTROL-PROCESSING.                                                 
063200                                                                          
063300     EVALUATE TRUE                                                        
063400         WHEN DP020-NEXT-ACT-INITIAL                                      
063500             INITIALIZE ASC-SPECIFIC-COMMAREA                             
063600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID                    
063700                                      ASC-SEL-TERM-ID                     
063800             MOVE DP020-SRC-TASK-NUMBER                                   
063900                                   TO ASC-LIST-TASK-NUMBER                
064000                                      ASC-SEL-TASK-NUMBER                 
064100             MOVE PC-LIST-QUEUE-SEQ                                       
064200                                   TO ASC-LIST-SEQ                        
064300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                         
064400             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
064500***-----$TEMPLATE NOTE$-------------------------------------------        
064600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,        
064700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO          
064800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.        
064900***---------------------------------------------------------------        
065000             IF  PS-COMMAREA-NOT-VALID                                    
065100***              MOVE PC-TSYMSG-99901                                     
065200***                                TO DP020-MSG-NUMBER                    
065300***              SET DP020-MSG-FATAL                                      
065400***                                TO TRUE                                
065500                 SET DP020-NEXT-ACT-APPL-ERROR                            
065600                                   TO TRUE                                
065700             ELSE                                                         
065800                 PERFORM 4000-BUILD-INITIAL-PANEL                         
065900                 PERFORM 3200-RESET-ATTRIBUTES                            
066000                 IF ASC-DELETE-TKT-FMT-FORMAT                             
066001                     MOVE PC-TSYMSG-00004                                 
066002                                   TO DP020-MSG-NUMBER                    
066003                     SET DP020-MSG-INFORMATIONAL                          
066004                                   TO TRUE                                
066005                 END-IF                                                   
066006             END-IF                                                       
066007                                                                          
066100         WHEN DP020-NEXT-ACT-READ-MAP                                     
066200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
066300                                   TO PV-TOP-ITEM                         
066400             PERFORM 2000-PROCESS-PANEL                                   
066500                                                                          
066600         WHEN DP020-NEXT-ACT-RETURN                                       
066700                                                                          
066800* UPON RETURN (FROM THE TICKET OFFICE SCREEN) REBUILD THE TICKET          
066900* OFFICE LIST QUEUE                                                       
071800             PERFORM 2050-DELETE-LIST-QUEUE                               
071900             MOVE ASC-KEY-TKT-FMT-ID TO   DK-TKT-FMT-ID           DPKCS036
072000                                                                          
072100             PERFORM 4320-OPEN-CURSOR                                     
270000             PERFORM 4300-READ-ITEMS-FROM-DB2                             
270100             PERFORM 4330-CLOSE-CURSOR                                    
270101                                                                          
270102             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
270103                                   TO PV-TOP-ITEM                         
270104             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
270105                                                                          
270106             PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**2
270107             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
270108                                                                          
270109         WHEN OTHER                                                       
270110             SET DP013-LOGIC-ABEND TO TRUE                                
270111             SET DP013-NO-ROLLBACK TO TRUE                                
270112             MOVE '1000-CONTROL-PROCESSING'                               
270113                                   TO DP013-PARAGRAPH                     
270114             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'            
270115                                   TO DP013-MESSAGE-TEXT(1)               
270116             PERFORM DP013-0000-PROCESS-ABEND                             
270117     END-EVALUATE.                                                        
270118                                                                          
270119 EJECT                                                                    
270120*----------------------------------------------------------------*        
270121* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *        
270122* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *        
270123*----------------------------------------------------------------*        
270124                                                                          
270125 1100-PROCESS-INTER-APPL-COMM.                                            
270126     SET PS-COMMAREA-VALID         TO TRUE.                               
270127     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.             
270128                                                                          
270129     MOVE DP020-INT-APPL-FORMAT-IND                                     36
270130                                   TO ASC-FORMAT-INDICATOR.               
270140     EVALUATE TRUE                                                        
270150         WHEN ASC-UPDATE-TKT-FMT-FORMAT                                   
270151         WHEN ASC-DELETE-TKT-FMT-FORMAT                                   
270152             SET ASC-USE-SELECTION-QUEUE                                  
270153                                   TO TRUE                                
270154             MOVE VL013-SEL-QUEUE-NAME                                    
270155                                   TO ASC-SEL-QUEUE-NAME-IN               
270156             MOVE VL013-NUMBER-OF-TS-ITEMS                                
270157                                   TO ASC-NUMBER-OF-TS-ITEMS              
270158             PERFORM 1120-PREPARE-LIST-ENTRY                         CL**4
270159                                                                          
270160         WHEN ASC-CREATE-TKT-FMT-FORMAT                                   
270161             SET  ASC-DONT-USE-SELECTION-QUEUE                            
270162                                   TO TRUE                                
270163             MOVE SPACES           TO ASC-KEY-TKT-FMT-ID                36
270164                                      DK-TKT-FMT-ID                     36
270165                                                                        *4
270166         WHEN OTHER                                                       
270167             SET PS-COMMAREA-NOT-VALID TO TRUE                            
270168     END-EVALUATE.                                                DPKCS036
270169                                                                  DPKCS036
270170                                                                     CL**8
270180*----------------------------------------------------------------*   CL*61
270190*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *   CL*61
270200*----------------------------------------------------------------*   CL*61
270300                                                                     CL*61
270400 1120-PREPARE-LIST-ENTRY.                                            CL**5
270500                                                                     CL**8
270600     MOVE VL014-MAX-ITEMS TO ASC-SEL-SUB.                            CL**5
270700     MOVE ZERO            TO ASC-SEL-ITEM.                           CL**5
270701     PERFORM 2140-GET-NEXT-TICKET-FORMAT.                            CL*38
270702 EJECT                                                                    
270703*----------------------------------------------------------------*        
270704* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *        
270705* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *        
270706* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *        
270707* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *        
270708* FUNCTION KEYS CAN GET THIS FAR.                                *        
270709*----------------------------------------------------------------*        
270710                                                                          
270711 2000-PROCESS-PANEL.                                                      
270712     EVALUATE TRUE                                                        
270713         WHEN DP020-SRC-AID = DP016-CLEAR                                 
270714             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
270715             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
270716             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
270717                                                                          
270718         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
270719             PERFORM 2050-DELETE-LIST-QUEUE                               
270720             MOVE ASC-KEY-TKT-FMT-ID TO   DK-TKT-FMT-ID           DPKCS036
270730             PERFORM 4000-BUILD-INITIAL-PANEL                             
270740             PERFORM 3200-RESET-ATTRIBUTES                                
270750                                                                          
270760             IF ASC-DELETE-TKT-FMT-FORMAT                                 
270770                 MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER            CL**5
270780                 SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**5
270790             END-IF                                                       
270800                                                                          
270900             IF ASC-DELETE-COMPLETE                                  CL**5
271000                 MOVE PC-TSYMSG-00116 TO DP020-MSG-NUMBER            CL**5
271100                 SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**5
271101             END-IF                                                       
271102                                                                          
271103         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)                     
271104             IF  ASC-USE-SELECTION-QUEUE                                  
271105                 PERFORM 2050-DELETE-LIST-QUEUE                           
271106                 PERFORM 2140-GET-NEXT-TICKET-FORMAT                      
271107                 PERFORM 4000-BUILD-INITIAL-PANEL                         
271108                 PERFORM 3200-RESET-ATTRIBUTES                            
271109             ELSE                                                         
271110*                --- BOTTOM OF LIST ---                                   
271111                 MOVE PC-TSYMSG-00070                                     
271112                                   TO DP020-MSG-NUMBER                    
271113                 SET DP020-MSG-INFORMATIONAL                              
271114                                   TO TRUE                                
271115             END-IF                                                       
271116                                                                          
271117         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)                     
271118             IF  ASC-USE-SELECTION-QUEUE                                  
271119                 PERFORM 2050-DELETE-LIST-QUEUE                           
271120                 PERFORM 2150-GET-PREV-TICKET-FORMAT                      
271121                 PERFORM 4000-BUILD-INITIAL-PANEL                         
271122                 PERFORM 3200-RESET-ATTRIBUTES                            
271123             ELSE                                                         
271124*                --- TOP OF LIST ---                                      
271125                 MOVE PC-TSYMSG-00069                                     
271126                                   TO DP020-MSG-NUMBER                    
271127                 SET DP020-MSG-INFORMATIONAL                              
271128                                   TO TRUE                                
271129             END-IF                                                       
271130                                                                          
271140         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    DPKCS036
271150             PERFORM 2160-DESELECT-ALL-ITEMS                      DPKCS036
271160             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
271170                                                                  DPKCS036
271180         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  DPKCS036
271190             PERFORM 2170-SELECT-ALL-ITEMS                        DPKCS036
271200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
271201                                                                  DPKCS036
271202         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                          
271203             MOVE +1               TO PV-TOP-ITEM                         
271204             PERFORM 3200-RESET-ATTRIBUTES                                
271205             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
271206                                                                          
271207         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                           
271208             PERFORM 2110-BROWSE-BACKWARD                                 
271209             PERFORM 3200-RESET-ATTRIBUTES                                
271210             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
271211                                                                          
271212         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                           
271213             PERFORM 2120-BROWSE-FORWARD                                  
271214             PERFORM 3200-RESET-ATTRIBUTES                                
271215             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
271216                                                                          
271217         WHEN OTHER                                                       
271218             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
271219             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
271220             IF  PS-NO-ERROR                                              
271221                 SET DP030-CONTINUE-GO                                    
271222                                 TO TRUE                                  
271223                 PERFORM 2100-CHECK-FUNCTION-KEY                          
271224             ELSE                                                         
271225                 SET DP030-OVERRIDE-GO                                    
271226                                 TO TRUE                                  
271227             END-IF                                                       
271228     END-EVALUATE.                                                        
271229 EJECT                                                                    
271230*----------------------------------------------------------------*        
271231*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *        
271232*----------------------------------------------------------------*        
271233 2050-DELETE-LIST-QUEUE.                                                  
271234                                                                          
271235     EXEC CICS                                                            
271236         DELETEQ TS                                                       
271237             QUEUE (ASC-LIST-QUEUE-NAME)                                  
271238             RESP  (PV-CICS-RESP)                                         
271239     END-EXEC.                                                            
271240                                                                          
271241     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                               
271242        (PV-CICS-RESP = DFHRESP(QIDERR))                                  
271243         CONTINUE                                                         
271244     ELSE                                                                 
271245         SET DP013-CICS-ABEND      TO TRUE                                
271246         SET DP013-NO-ROLLBACK     TO TRUE                                
271247                                                                          
271248         MOVE '2050-DELETE-LIST-QUEUE'                                    
271249                                   TO DP013-PARAGRAPH                     
271250         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'            
271251                                   TO DP013-MESSAGE-TEXT (1)              
271252         PERFORM DP013-0000-PROCESS-ABEND                                 
271253     END-IF.                                                              
271254                                                                          
271255     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.          
271256 EJECT                                                                    
271257*----------------------------------------------------------------*        
271258* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*        
271259* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *        
271260* CICS ARCHITECTURE API.                                         *        
271261*----------------------------------------------------------------*        
271262 2100-CHECK-FUNCTION-KEY.                                                 
271263     EVALUATE TRUE                                                        
271264                                                                          
271265*        WHEN "ADD" KEY IS PRESSED                                        
271266         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
271267             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              DPKCS036
271270                 MOVE PC-TSYMSG-01670                             DPKCS036
271271                                   TO DP020-MSG-NUMBER            DPKCS036
271273                 SET DP030-SET-CURSOR-APPL-1                              
271274                     DP020-MSG-FATAL                                      
271276                     PS-ERROR      TO TRUE                        DPKCS036
271277             ELSE                                                 DPKCS036
271278                 MOVE ASC-KEY-TKT-FMT-ID TO DK-TKT-FMT-ID                 
271279                 PERFORM 7000-ADD-TICKET-FORMAT                           
271280             END-IF                                                     36
271281*           IF THIS IS A PRETICKET FORMAT, ADD IT TO VENDOR STYLE         
271282*           MANAGEMENT.  IF THE FORMAT DESCRIPTION IS IN VSM AND          
271283*           IS INACTIVE, UPDATE THE ROW TO ACTIVE.  IF THE FORMAT         
271284*           DESCRIPTION IS IN VSM AND IS ACTIVE, SEND BACK AN             
271285*           ERROR MESSAGE.                                                
271286            IF (ASC-PTICK-TKT-FMT)  AND                                   
271287               (PS-NO-ERROR)                                              
271288                PERFORM 7025-CHECK-FOR-DUP-DESC                           
271289                IF VSCHVL-STAT-CDE = 'I'                                  
271290                    PERFORM 7027-UPDATE-TVSCHVL-TO-ACTIVE                 
271291                ELSE                                                      
271292                    IF VSCHVL-STAT-CDE = ' '                              
271293                        PERFORM 7030-INSERT-TVSCHVL                       
271294                    ELSE                                                  
271295                        MOVE PC-DUP-TKT-FMT-MSG                           
271296                                 TO DP020-MSG-MESSAGE                     
271297                        MOVE -1  TO ATFDESCL                              
271298                        MOVE DP015-REVERSE                                
271299                                 TO ATFDESCH                              
271300                        MOVE DP015-RED                                    
271301                                 TO ATFDESCC                              
271302                        MOVE DP015-UNP-ALP-BRT-OFF                        
271303                                 TO ATFDESCA                              
271304                        SET DP030-SET-CURSOR-APPL-1                       
271305                            DP020-MSG-FATAL                               
271306                            PS-ERROR                                      
271307                                 TO TRUE                                  
271308                        PERFORM 9102-ROLLBACK-CHANGES                     
271309                    END-IF                                                
271310                END-IF                                                    
271400            END-IF                                                        
422973                                                                          
422974            IF PS-NO-ERROR                                                
422975                MOVE PC-TSYMSG-00034    TO DP020-MSG-NUMBER               
422976                SET DP020-MSG-INFORMATIONAL                               
422977                                        TO TRUE                           
422978            END-IF                                                        
422979                                                                          
422980*        WHEN "UPDATE" KEY IS PRESSED                                     
422981         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
422982             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              DPKCS036
422983                 MOVE PC-TSYMSG-01670                             DPKCS036
422984                                   TO DP020-MSG-NUMBER            DPKCS036
422985                 MOVE -1           TO MR-SELECTL (1)                    36
422986                 SET DP030-SET-CURSOR-APPL-1                              
422987                     DP020-MSG-FATAL                                      
422988                     PS-ERROR      TO TRUE                        DPKCS036
422989             ELSE                                                 DPKCS036
422990                 MOVE ASC-KEY-TKT-FMT-ID TO DK-TKT-FMT-ID                 
422991                 PERFORM 7200-UPDATE-TICKET-FORMAT                        
422992             END-IF                                                     36
422993                                                                          
423000            IF PS-NO-ERROR                                                
423100                MOVE PC-TSYMSG-00059    TO DP020-MSG-NUMBER               
423200                SET DP020-MSG-INFORMATIONAL                               
423210                                        TO TRUE                           
423220            END-IF                                                        
423300                                                                          
423400            PERFORM 9100-READ-IN-SEL-QUEUE                                
423410            IF PS-NO-ERROR                                                
423500                SET VL014-UPD (ASC-SEL-SUB)                               
423501                                        TO TRUE                      C    
423502            ELSE                                                          
423503                SET VL014-ERR (ASC-SEL-SUB)                               
423504                                        TO TRUE                      C    
423510            END-IF                                                        
423600            PERFORM 9101-REWRITE-SEL-QUEUE                                
423700                                                                          
423701*        WHEN "DELETE" KEY IS PRESSED                                     
423702         WHEN DP020-FK-CONFIRM(DP020-SRC-AID)                             
423703            IF ASC-DELETE-COMPLETE                                        
423704                CONTINUE                                                  
423705            ELSE                                                          
423706                MOVE ASC-KEY-TKT-FMT-ID TO DK-TKT-FMT-ID                  
423707                PERFORM 7100-DELETE-TICKET-FORMAT                         
423708                                                                          
423709                PERFORM 9100-READ-IN-SEL-QUEUE                            
423710                SET VL014-DEL (ASC-SEL-SUB) TO TRUE                  CL**5
423720                PERFORM 9101-REWRITE-SEL-QUEUE                            
423730            END-IF                                                        
423740                                                                          
423750            MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER               
423760            SET DP020-MSG-INFORMATIONAL                                   
423770                ASC-DELETE-COMPLETE     TO TRUE                           
423780                                                                          
423781*                                                                         
423794         WHEN DP020-SRC-AID = DP016-ENTER                                 
423795             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                           
423796             IF  PS-ERROR                                                 
423797                 CONTINUE                                                 
423798             ELSE                                                         
423799                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
423800             END-IF                                                       
423801                                                                          
423814         WHEN OTHER                                                       
423815             SET DP013-NO-ROLLBACK                                        
423816                 DP013-XCTL-DISPLAY-RESTART                               
423817                 DP013-CICS-ABEND  TO TRUE                                
423818             MOVE '2100-CHECK-FUNCTION-KEY'                               
423819                                   TO DP013-PARAGRAPH                     
423820             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
423821                                   TO DP013-MESSAGE-TEXT (1)              
423822             PERFORM DP013-0000-PROCESS-ABEND                             
423823     END-EVALUATE.                                                        
423824*                                                                         
423825*----------------------------------------------------------------*        
423826*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *        
423827*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *        
423828*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *        
423829*    MESSAGE.                                                    *        
423830*----------------------------------------------------------------*        
423831                                                                          
423832 2110-BROWSE-BACKWARD.                                                    
423833     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL            
423834         GIVING PV-TOP-ITEM.                                              
423835*                                                                         
423836     IF  ((PV-TOP-ITEM < +1)                                              
423837       OR (PV-TOP-ITEM = +1))                                             
423838         MOVE +1                   TO PV-TOP-ITEM                         
423839*        -- TOP OF LIST --                                                
423840         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER                    
423841         SET DP020-MSG-INFORMATIONAL TO TRUE                              
423842     END-IF.                                                              
423843                                                                          
423844 EJECT                                                                    
423845*----------------------------------------------------------------*        
423846*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *        
423847*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *        
423848*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *        
423849*----------------------------------------------------------------*        
423850                                                                          
423851 2120-BROWSE-FORWARD.                                                     
423852                                                                          
423853     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                      
423854         GIVING PV-TOP-ITEM.                                              
423855     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                           
423856         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
423857                                   TO PV-TOP-ITEM                         
423858*        -- BOTTOM OF LIST --                                             
423859         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
423860         SET DP020-MSG-INFORMATIONAL                                      
423861                                   TO TRUE                                
423862     ELSE                                                                 
423863         COMPUTE PV-BOTTOM-ITEM =                                         
423864             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                         
423865         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                    
423866*            -- BOTTOM OF LIST --                                         
423867             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
423868             SET DP020-MSG-INFORMATIONAL                                  
423869                                   TO TRUE                                
423870         END-IF                                                           
423871     END-IF.                                                              
423872 EJECT                                                                    
423873*----------------------------------------------------------------*        
423874*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *        
423875*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *        
423876*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *        
423877*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *        
423878*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *        
423879*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *        
423880*----------------------------------------------------------------*        
423881                                                                          
423882 2130-CHECK-FOR-JUMP-BROWSE.                                              
423883     SET PS-NO-ERROR               TO TRUE.                               
423884     IF (ASC-START-ITEM-REQUEST = SPACE)                                  
423885         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
423886                                   TO PV-TOP-ITEM                         
423887     ELSE                                                                 
423888         MOVE ASC-START-ITEM-REQUEST                                      
423889                                   TO DP010I-UNEDITED-FIELD               
423890         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS               
423891         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS             
423892         SET DP010I-NEGATIVE-NOT-ALLOWED                                  
423893                                   TO TRUE                                
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
423895                                                                          
423896         IF  NOT DP010I-ERROR-DETECTED                                    
423897             MOVE DP010I-NUMERIC-FIELD                                    
423898                                   TO  ASC-START-ITEM-REQUEST-N           
423899             IF  ASC-START-ITEM-REQUEST-N > ZERO                          
423900                 IF  ASC-START-ITEM-REQUEST-N >                           
423901                                          ASC-NUMBER-OF-ITEMS-READ        
423902                     MOVE SPACE TO ASC-START-ITEM-REQUEST                 
423903                     COMPUTE PV-TOP-ITEM =                                
423904                             ASC-NUMBER-OF-ITEMS-READ                     
423905                             - PC-ITEMS-PER-PANEL + 1                     
423906                     IF  PV-TOP-ITEM < +1                                 
423907                         MOVE +1   TO PV-TOP-ITEM                         
423908                         MOVE PC-TSYMSG-00070                             
423909                                   TO DP020-MSG-NUMBER                    
423910                         SET DP020-MSG-INFORMATIONAL                      
423911                                   TO TRUE                                
423912                     END-IF                                               
423913                 ELSE                                                     
423914                     MOVE ASC-START-ITEM-REQUEST-N                        
423915                                   TO PV-TOP-ITEM                         
423916                     MOVE SPACE    TO ASC-START-ITEM-REQUEST              
423917                     COMPUTE PV-BOTTOM-ITEM =                             
423918                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1             
423919                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ        
423920*                        -- BOTTOM OF LIST --                             
423921                         MOVE PC-TSYMSG-00070                             
423922                                   TO DP020-MSG-NUMBER                    
423923                         SET DP020-MSG-INFORMATIONAL                      
423924                                   TO TRUE                                
423925                     END-IF                                               
423926                 END-IF                                                   
423927             ELSE                                                         
423928*                --- VALUE OUT OF RANGE ----                              
423929                 MOVE PC-TSYMSG-00101                                     
423930                                   TO DP020-MSG-NUMBER                    
423931                 MOVE -1           TO ASTRTITL                            
423932                 SET DP030-SET-CURSOR-APPL-1                              
423933                                   TO TRUE                                
423934                 MOVE DP015-REVERSE                                       
423935                                   TO ASTRTITH                            
423936                 MOVE DP015-RED    TO ASTRTITC                            
423937                 MOVE DP015-UNP-ALP-BRT-OFF                               
423938                                   TO ASTRTITA                            
423939                 SET DP020-MSG-FATAL                                      
423940                                   TO TRUE                                
423941                 SET PS-ERROR      TO TRUE                                
423942             END-IF                                                       
423943                                                                          
423944         ELSE                                                             
423945             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                    
423946             MOVE -1               TO ASTRTITL                            
423947             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
423948             MOVE DP015-REVERSE    TO ASTRTITH                            
423949             MOVE DP015-RED        TO ASTRTITC                            
423950             MOVE DP015-UNP-ALP-BRT-OFF                                   
423951                                   TO ASTRTITA                            
423952             SET DP020-MSG-FATAL   TO TRUE                                
423953             SET PS-ERROR          TO TRUE                                
423954         END-IF                                                           
423955     END-IF.                                                              
423956*----------------------------------------------------------------*   CL*61
423957*    GET THE NEXT TICKET FORMAT IF A LIST OF TICKET FORMATS IS   *   CL*61
423958*    BEING PROCESSED                                             *   CL*61
423959*----------------------------------------------------------------*   CL*61
423960                                                                     CL*61
423961 2140-GET-NEXT-TICKET-FORMAT.                                        CL**5
423962                                                                     CL**8
423963     ADD +1                       TO ASC-SEL-SUB.                    CL**5
423970     IF  ASC-SEL-SUB > VL014-MAX-ITEMS                               CL**5
423980         ADD +1                   TO ASC-SEL-ITEM                    CL**5
423990         MOVE +1                  TO ASC-SEL-SUB                     CL**5
424000     END-IF.                                                         CL**5
424100     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                   CL**5
424200         PERFORM 9100-READ-IN-SEL-QUEUE                              CL*49
424300         IF  VL014-ITEM (ASC-SEL-SUB) > ZERO                         CL**5
424400             SET ASC-ACTION-PENDING    TO TRUE                            
424500             MOVE VL014-TKT-FMT-ID (ASC-SEL-SUB)                     CL**5
424600                                       TO ASC-KEY-TKT-FMT-ID      DPKCS036
424700             IF ASC-DELETE-TKT-FMT-FORMAT                                 
424800                 MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER            CL**5
424900                 SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**5
425000             END-IF                                                       
425100                                                                          
425200             IF VL014-ACTION-SW (ASC-SEL-SUB) = SPACES                    
425300                 SET VL014-INQ (ASC-SEL-SUB) TO TRUE                 CL**5
425400                 PERFORM 9101-REWRITE-SEL-QUEUE                      CL*49
425500             ELSE                                                         
425600                 IF VL014-DEL (ASC-SEL-SUB)                          CL**5
425700                     SET ASC-DELETE-COMPLETE TO TRUE                      
425800                     MOVE PC-TSYMSG-00116 TO DP020-MSG-NUMBER        CL**5
425900                     SET DP020-MSG-INFORMATIONAL TO TRUE             CL**5
426000                 END-IF                                              CL**5
426100             END-IF                                                       
426200         ELSE                                                        CL**5
426300             SUBTRACT +1 FROM ASC-SEL-SUB                            CL**5
426400             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                CL**5
426500             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**5
426600         END-IF                                                      CL**5
426700     ELSE                                                            CL**5
426800         SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**5
426900         MOVE VL014-MAX-ITEMS     TO ASC-SEL-SUB                     CL**5
427000         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER                CL**5
427100         SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**5
427200     END-IF.                                                         CL**5
427201                                                                     CL**8
427202******************************************************************        
427203** GET THE TICKET FORMAT (KEY) OF THE PREVIOUS SELECTED         **        
427204** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **        
427205******************************************************************        
427206 2150-GET-PREV-TICKET-FORMAT.                                             
427207     SUBTRACT +1 FROM ASC-SEL-SUB.                                        
427208     IF  ASC-SEL-SUB < +1                                                 
427209         SUBTRACT +1 FROM ASC-SEL-ITEM                                    
427210         MOVE VL014-MAX-ITEMS      TO ASC-SEL-SUB                         
427211     END-IF.                                                              
427212*                                                                         
427213     IF  ASC-SEL-ITEM > ZERO                                              
427214         PERFORM 9100-READ-IN-SEL-QUEUE                                   
427215         SET ASC-ACTION-PENDING    TO TRUE                                
427216         MOVE VL014-TKT-FMT-ID (ASC-SEL-SUB)                              
427217                                   TO ASC-KEY-TKT-FMT-ID                  
427218         IF ASC-DELETE-TKT-FMT-FORMAT                                     
427219             MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER                CL**5
427220             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**5
427230         END-IF                                                           
427240                                                                          
427250         IF VL014-DEL (ASC-SEL-SUB)                                  CL**5
427260             SET ASC-DELETE-COMPLETE TO TRUE                              
427270             MOVE PC-TSYMSG-00116 TO DP020-MSG-NUMBER                CL**5
427280             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**5
427281         END-IF                                                           
427282     ELSE                                                                 
427283         MOVE +1                   TO ASC-SEL-ITEM                        
427284                                      ASC-SEL-SUB                         
427285*        --- TOP OF LIST ---                                              
427286         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER                    
427287         SET DP020-MSG-INFORMATIONAL                                      
427288                                   TO TRUE                                
427289     END-IF.                                                              
427290                                                                          
427300*----------------------------------------------------------------*DPKCS036
427400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *DPKCS036
427500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *DPKCS036
427600*----------------------------------------------------------------*DPKCS036
427700 2160-DESELECT-ALL-ITEMS.                                         DPKCS036
427800     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
427900                                                                  DPKCS036
428000     PERFORM 2161-CLEAR-SELECTED-INDS                             DPKCS036
428100         VARYING ASC-ITEM-SUB                                     DPKCS036
428200         FROM 1 BY 1                                              DPKCS036
428300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
428400                                                                  DPKCS036
428500     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
428600                                                                  DPKCS036
428700     PERFORM 2161-CLEAR-SELECTED-INDS                             DPKCS036
428800         VARYING ASC-ITEM-SUB                                     DPKCS036
428900         FROM 1 BY 1                                              DPKCS036
429000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
429100                                                                  DPKCS036
429200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
429300                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
429400                                                                  DPKCS036
429500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
429600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
429700                                                                  DPKCS036
429800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
429900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      DPKCS036
430000         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
430100                                                                  DPKCS036
430200         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
430300                                                                  DPKCS036
430400         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
430500                                                                  DPKCS036
430600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
430700             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
430800                                                                  DPKCS036
430900         PERFORM                                                  DPKCS036
431000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
431100                                                                  DPKCS036
431200             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
431300                                                                  DPKCS036
431400             PERFORM 2161-CLEAR-SELECTED-INDS                     DPKCS036
431500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 DPKCS036
431600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
431700                                                                  DPKCS036
431800             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
431900                                                                  DPKCS036
432000             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
432100                                                                  DPKCS036
432200         END-PERFORM                                              DPKCS036
432300                                                                  DPKCS036
432400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
432500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
432600                                                                  DPKCS036
432700         PERFORM                                                  DPKCS036
432800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
432900                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
433000                                                                  DPKCS036
433100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
433200                                   TO PV-BLOCK-NUMBER             DPKCS036
433300                                                                  DPKCS036
433400             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
433500                                                                  DPKCS036
433600             PERFORM 2161-CLEAR-SELECTED-INDS                     DPKCS036
433700                 VARYING ASC-ITEM-SUB                             DPKCS036
433800                 FROM 1 BY 1                                      DPKCS036
433900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
434000                                                                  DPKCS036
434100             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
434200                                                                  DPKCS036
434300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
434400                                                                  DPKCS036
434500         END-PERFORM                                              DPKCS036
434600                                                                  DPKCS036
434700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
434800                                   TO PV-BLOCK-NUMBER             DPKCS036
434900                                                                  DPKCS036
435000         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
435100     END-IF.                                                      DPKCS036
435200                                                                  DPKCS036
435300                                                                  DPKCS036
435400     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. DPKCS036
435500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.DPKCS036
435600     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  DPKCS036
435700                                                                  DPKCS036
435800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
435900                                                                  DPKCS036
436000 EJECT                                                            DPKCS036
436100*----------------------------------------------------------------*DPKCS036
436200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *DPKCS036
436300*----------------------------------------------------------------*DPKCS036
436400                                                                  DPKCS036
436500 2161-CLEAR-SELECTED-INDS.                                        DPKCS036
436600                                                                  DPKCS036
436700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
436800             NOT EQUAL ZERO                                       DPKCS036
436900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
437000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
437100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    DPKCS036
437200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
437300                                   TO TRUE                        DPKCS036
437400         END-IF                                                   DPKCS036
437500     END-IF.                                                      DPKCS036
437600                                                                  DPKCS036
437700 EJECT                                                            DPKCS036
437800*----------------------------------------------------------------*DPKCS036
437900*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *DPKCS036
438000*  FOR ALL ITEMS.                                                *DPKCS036
438100*----------------------------------------------------------------*DPKCS036
438200                                                                  DPKCS036
438300 2170-SELECT-ALL-ITEMS.                                           DPKCS036
438400                                                                  DPKCS036
438500     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
438600                                                                  DPKCS036
438700     PERFORM 2171-SET-SELECTED-INDS                               DPKCS036
438800         VARYING ASC-ITEM-SUB                                     DPKCS036
438900         FROM 1 BY 1                                              DPKCS036
439000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
439100                                                                  DPKCS036
439200     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
439300                                                                  DPKCS036
439400     PERFORM 2171-SET-SELECTED-INDS                               DPKCS036
439500         VARYING ASC-ITEM-SUB                                     DPKCS036
439600         FROM 1 BY 1                                              DPKCS036
439700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
439800                                                                  DPKCS036
439900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
440000                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
440100                                                                  DPKCS036
440200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
440300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
440400                                                                  DPKCS036
440500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
440600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    DPKCS036
440700         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
440800                                                                  DPKCS036
440900         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
441000                                                                  DPKCS036
441100         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
441200                                                                  DPKCS036
441300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
441400             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
441500                                                                  DPKCS036
441600         PERFORM                                                  DPKCS036
441700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
441800                                                                  DPKCS036
441900             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
442000                                                                  DPKCS036
442100             PERFORM 2171-SET-SELECTED-INDS                       DPKCS036
442200                 VARYING ASC-ITEM-SUB                             DPKCS036
442300                 FROM 1 BY 1                                      DPKCS036
442400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
442500                                                                  DPKCS036
442600             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
442700                                                                  DPKCS036
442800             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
442900                                                                  DPKCS036
443000         END-PERFORM                                              DPKCS036
443100                                                                  DPKCS036
443200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
443300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
443400                                                                  DPKCS036
443500         PERFORM                                                  DPKCS036
443600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
443700                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
443800                                                                  DPKCS036
443900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
444000                                   TO PV-BLOCK-NUMBER             DPKCS036
444100                                                                  DPKCS036
444200             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
444300                                                                  DPKCS036
444400             PERFORM 2171-SET-SELECTED-INDS                       DPKCS036
444500                 VARYING ASC-ITEM-SUB                             DPKCS036
444600                 FROM 1 BY 1                                      DPKCS036
444700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
444800                                                                  DPKCS036
444900             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
445000                                                                  DPKCS036
445100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
445200                                                                  DPKCS036
445300         END-PERFORM                                              DPKCS036
445400                                                                  DPKCS036
445500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
445600                                   TO PV-BLOCK-NUMBER             DPKCS036
445700                                                                  DPKCS036
445800         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
445900     END-IF.                                                      DPKCS036
446000                                                                  DPKCS036
446100                                                                  DPKCS036
446200     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             DPKCS036
446300                       ASC-NUMBER-OF-SELECTED-ITEMS.              DPKCS036
446400                                                                  DPKCS036
446500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
446600                                                                  DPKCS036
446700 EJECT                                                            DPKCS036
446800*----------------------------------------------------------------*DPKCS036
446900*    MARK EACH ITEM AS BEING SELECTED.                           *DPKCS036
447000*----------------------------------------------------------------*DPKCS036
447100                                                                  DPKCS036
447200 2171-SET-SELECTED-INDS.                                          DPKCS036
447300                                                                  DPKCS036
447400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
447500             NOT EQUAL ZERO                                       DPKCS036
447600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
447700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
447800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
447900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
448000                               TO  TRUE                           DPKCS036
448100         END-IF                                                   DPKCS036
448101     END-IF.                                                      DPKCS036
448102 EJECT                                                                    
448103******************************************************************        
448104** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **        
448105** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **        
448106******************************************************************        
448107 2200-MOVE-SCREEN-TO-COMMAREA.                                            
448108                                                                          
448109     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.                     
448110     MOVE +1                       TO PV-SUB.                             
448111*                                                                         
448112     PERFORM 3100-SET-SUBSCRIPTS.                                         
448113*                                                                         
448114     IF  ASTRTITL > ZERO                                                  
448115         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST                  
448116     ELSE                                                                 
448117         IF  ASTRTITF = DP015-ERASE-EOF                                   
448118             INITIALIZE ASC-START-ITEM-REQUEST                            
448119         END-IF                                                           
448120     END-IF.                                                              
448121*                                                                         
448122     IF  ATFIDL > ZERO                                                    
448123         MOVE ATFIDI           TO ASC-KEY-TKT-FMT-ID                      
448124     ELSE                                                                 
448125         IF  ATFIDF = DP015-ERASE-EOF                                     
448126             INITIALIZE ASC-KEY-TKT-FMT-ID                                
448127         END-IF                                                           
448128     END-IF.                                                              
448129*                                                                         
448130     IF  ATFDESCL > ZERO                                                  
448131         MOVE ATFDESCI         TO ASC-TKT-FMT-DESC                        
448132     ELSE                                                                 
448133         IF  ATFDESCF = DP015-ERASE-EOF                                   
448134             INITIALIZE ASC-TKT-FMT-DESC                                  
448135         END-IF                                                           
448136     END-IF.                                                              
448137*                                                                         
448138     IF  APTICKL > ZERO                                                   
448139         MOVE APTICKI          TO ASC-PTICK-FMT-IND                       
448140     ELSE                                                                 
448141         IF  APTICKF = DP015-ERASE-EOF                                    
448142             INITIALIZE ASC-PTICK-FMT-IND                                 
448143         END-IF                                                           
448144     END-IF.                                                              
448145*                                                                         
448146     IF  ASIZEL > ZERO                                                    
448147         MOVE ASIZEI           TO ASC-DISP-SIZE-IND                       
448148     ELSE                                                                 
448149         IF  ASIZEF = DP015-ERASE-EOF                                     
448150             INITIALIZE ASC-DISP-SIZE-IND                                 
448151         END-IF                                                           
448152     END-IF.                                                              
448153*                                                                         
448154     IF  ACOLORL > ZERO                                                   
448155         MOVE ACOLORI          TO ASC-DISP-COLOR-IND                      
448156     ELSE                                                                 
448157         IF  ACOLORF = DP015-ERASE-EOF                                    
448158             INITIALIZE ASC-DISP-COLOR-IND                                
448159         END-IF                                                           
448160     END-IF.                                                              
448161*                                                                         
448162     IF  AOPBLTGL > ZERO                                                  
448163         MOVE AOPBLTGI         TO ASC-DISP-OPTBLK-TAG-IND                 
448164     ELSE                                                                 
448165         IF  AOPBLTGF = DP015-ERASE-EOF                                   
448166             INITIALIZE ASC-DISP-OPTBLK-TAG-IND                           
448167         END-IF                                                           
448168     END-IF.                                                              
448169*                                                                         
448170     IF  AOPBLLBL > ZERO                                                  
448171         MOVE AOPBLLBI         TO ASC-DISP-OPTBLK-LBL-IND                 
448172     ELSE                                                                 
448173         IF  AOPBLLBF = DP015-ERASE-EOF                                   
448174             INITIALIZE ASC-DISP-OPTBLK-TAG-IND                           
448175         END-IF                                                           
448176     END-IF.                                                              
448177*                                                                         
448178     IF  ASTRNBRL > ZERO                                                  
448179         MOVE ASTRNBRI         TO ASC-DISP-STKR-NBR-IND                   
448180     ELSE                                                                 
448181         IF  ASTRNBRF = DP015-ERASE-EOF                                   
448182             INITIALIZE ASC-DISP-STKR-NBR-IND                             
448183         END-IF                                                           
448184     END-IF.                                                              
448185*                                                                         
448186     IF  AFTYCDEL > ZERO                                                  
448187         MOVE AFTYCDEI         TO ASC-TKT-FMT-TYP-CDE                     
448188     ELSE                                                                 
448189         IF  AFTYCDEF = DP015-ERASE-EOF                                   
448190             INITIALIZE ASC-TKT-FMT-TYP-CDE                               
448191         END-IF                                                           
448192     END-IF.                                                              
448193*                                                                         
448194     IF  AFMTNBRL > ZERO                                                  
448195         MOVE AFMTNBRI         TO ASC-TKT-FMT-NBR                         
448196     ELSE                                                                 
448197         IF  AFMTNBRF = DP015-ERASE-EOF                                   
448198             INITIALIZE ASC-TKT-FMT-NBR                                   
448199         END-IF                                                           
448200     END-IF.                                                              
448201*                                                                         
448202     IF  APAPERL > ZERO                                                   
448203         MOVE APAPERI          TO ASC-PAPER-TYP-ID                        
448204     ELSE                                                                 
448205         IF  APAPERF = DP015-ERASE-EOF                                    
448206             INITIALIZE ASC-PAPER-TYP-ID                                  
448207         END-IF                                                           
448208     END-IF.                                                              
448209*                                                                         
448210     IF  AXTKTNBL > ZERO                                                  
448211         MOVE AXTKTNBI         TO ASC-NBR-XTRA-TIX                        
448212     ELSE                                                                 
448213         IF  AXTKTNBF = DP015-ERASE-EOF                                   
448214             INITIALIZE ASC-NBR-XTRA-TIX                                  
448215         END-IF                                                           
448216     END-IF.                                                              
448217*                                                                         
448218     IF  AXTKTPTL > ZERO                                                  
448219         MOVE AXTKTPTI         TO ASC-PCT-XTRA-TIX                        
448220     ELSE                                                                 
448221         IF  AXTKTPTF = DP015-ERASE-EOF                                   
448222             INITIALIZE ASC-PCT-XTRA-TIX                                  
448223         END-IF                                                           
448230     END-IF.                                                              
448300*                                                                         
448400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          DPKCS036
448500         VARYING PV-SUB                                           DPKCS036
448600         FROM 1 BY 1                                              DPKCS036
448700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      DPKCS036
448800******************************************************************DPKCS036
448900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**DPKCS036
449000******************************************************************DPKCS036
449100 2210-MOVE-LINES-TO-COMMAREA.                                     DPKCS036
449200     IF  MR-SELECTL (PV-SUB) > ZERO                               DPKCS036
449300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             DPKCS036
449400         MOVE MR-SELECT (PV-SUB)                                  DPKCS036
449500                                   TO ASC-TEMP-SELECTED-SW        DPKCS036
449600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
449700     ELSE                                                         DPKCS036
449800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                DPKCS036
449900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     DPKCS036
450000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        DPKCS036
450100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
450200         END-IF                                                   DPKCS036
450300     END-IF.                                                      DPKCS036
450400     ADD +1                        TO ASC-ITEM-SUB.               DPKCS036
450500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
450600         ADD +1                    TO ASC-BLK-SUB                 DPKCS036
450700         MOVE +1                   TO ASC-ITEM-SUB                DPKCS036
450701     END-IF.                                                      DPKCS036
450702******************************************************************        
450703** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **        
450704** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **        
450705******************************************************************        
450706 3000-EDIT-DATA-IN-COMMAREA.                                              
450707     SET PS-NO-ERROR                     TO TRUE.                         
450708     PERFORM 3200-RESET-ATTRIBUTES.                                       
450709                                                                          
450710     MOVE ASC-ITEMS-DISPLAYED            TO PV-SUB.                       
450711**                                                                        
450712* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.                      
450713* EDITTING IS DONE FROM THE BOTTOM UP.                                    
450714**                                                                        
450715     IF ASC-PCT-XTRA-TIX-N  = ZERO                                        
450716     OR ASC-PCT-XTRA-TIX    = SPACES                                      
450717        CONTINUE                                                          
450718     ELSE                                                                 
450719         MOVE ASC-PCT-XTRA-TIX          TO DP010I-UNEDITED-FIELD          
450720         MOVE +4                        TO DP010I-MAXIMUM-DIGITS          
450721         MOVE +0                        TO DP010I-MAXIMUM-DECIMALS        
450722         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                          
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
450724                                                                          
450725         IF  NOT DP010I-ERROR-DETECTED                                    
450726             MOVE DP010I-NUMERIC-FIELD   TO  ASC-PCT-XTRA-TIX-N           
450727         ELSE                                                             
450728             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER              
450729             MOVE -1                     TO AXTKTPTL                      
450730             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
450731             MOVE DP015-REVERSE          TO AXTKTPTH                      
450732             MOVE DP015-RED              TO AXTKTPTC                      
450733             MOVE DP015-UNP-ALP-BRT-OFF  TO AXTKTPTA                      
450734             SET DP020-MSG-FATAL         TO TRUE                          
450735             SET PS-ERROR                TO TRUE                          
450736         END-IF                                                           
450737     END-IF.                                                              
450738*                                                                         
450739     IF ASC-NBR-XTRA-TIX-N  = ZERO                                        
450740     OR ASC-NBR-XTRA-TIX    = SPACES                                      
450741        CONTINUE                                                          
450742     ELSE                                                                 
450743         MOVE ASC-NBR-XTRA-TIX          TO DP010I-UNEDITED-FIELD          
450744         MOVE +4                        TO DP010I-MAXIMUM-DIGITS          
450745         MOVE +0                        TO DP010I-MAXIMUM-DECIMALS        
450746         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                          
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
450748                                                                          
450749         IF  NOT DP010I-ERROR-DETECTED                                    
450750             MOVE DP010I-NUMERIC-FIELD   TO ASC-NBR-XTRA-TIX-N            
450751         ELSE                                                             
450752             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER              
450753             MOVE -1                     TO AXTKTNBL                      
450754             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
450755             MOVE DP015-REVERSE          TO AXTKTNBH                      
450756             MOVE DP015-RED              TO AXTKTNBC                      
450757             MOVE DP015-UNP-ALP-BRT-OFF  TO AXTKTNBA                      
450758             SET DP020-MSG-FATAL         TO TRUE                          
450759             SET PS-ERROR                TO TRUE                          
450760         END-IF                                                           
450770     END-IF.                                                              
450771                                                                          
450771*****  CODE IN BETWEEN   COMMENTED OUT ON 9/11/2000 **************        
450771**** NO LONGER CHECKING THAT EITHER A NUMBER OR PERCENT FOR ******        
450771**** EXTRA TICKETS IS ENTERED FOR A TYPE CODE OF 'I'        ******        
450771**** CHANGE MADE FOR ECOMM TICKET TYPE -- DON'T WANT EXTRA  ******        
450771**** TICKETS TO BE REQUIRED                                 ******        
450772* EITHER XTRA PERCENTAGE OR XTRA NUMBER OF TICKETS MUST BE ENTERED        
450773* FOR TICKETS WITH A TYPE CODE OF 'I' (CREATED BY KOHL'S)                 
450774* THIS IS NOT REQUIRED FOR TICKETS WITH A TYPE CODE OF 'E'                
450775* WHICH ARE CREATED BY AN OUTSIDE VENDOR.                                 
450776*9/11IF ((ASC-PCT-XTRA-TIX-N = ZERO OR ASC-PCT-XTRA-TIX = SPACES)         
450777*9/11AND (ASC-NBR-XTRA-TIX-N = ZERO OR ASC-NBR-XTRA-TIX = SPACES))        
450778*9/11OR ( ASC-PCT-XTRA-TIX-N > ZERO AND ASC-NBR-XTRA-TIX-N > ZERO)        
450779*9/11    IF ASC-TKT-FMT-TYP-CDE = 'I'                                     
450780**9/11       NEW MESSAGE (ONE OR THE OTHER MUST BE ENTERED)               
450781*9/11        MOVE PC-TSYMSG-00874        TO DP020-MSG-NUMBER              
450782*9/11        MOVE -1                     TO AXTKTNBL                      
450783*9/11        SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
450784*9/11        MOVE DP015-REVERSE          TO AXTKTNBH                      
450785*9/11                                       AXTKTPTH                      
450786*9/11        MOVE DP015-RED              TO AXTKTNBC                      
450787*9/11                                       AXTKTPTC                      
450788*9/11        MOVE DP015-UNP-ALP-BRT-OFF  TO AXTKTNBA                      
450789*9/11                                       AXTKTPTA                      
450790*9/11        SET DP020-MSG-FATAL         TO TRUE                          
450791*9/11        SET PS-ERROR                TO TRUE                          
450792*9/11    END-IF                                                           
450793*9/11END-IF.                                                              
450771*****  CODE IN BETWEEN   COMMENTED OUT ON 9/11/2000 **************        
450794                                                                          
450795     IF ASC-PAPER-TYP-ID = SPACES                                         
450796         IF ASC-TKT-FMT-TYP-CDE = 'I'                                     
450797             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER              
450798             MOVE -1                     TO APAPERL                       
450799             MOVE DP015-REVERSE          TO APAPERH                       
450800             MOVE DP015-RED              TO APAPERC                       
450801             MOVE DP015-UNP-ALP-BRT-OFF  TO APAPERA                       
450802             SET DP030-SET-CURSOR-APPL-1                                  
450803                 DP020-MSG-FATAL                                          
450804                 PS-ERROR                TO TRUE                          
450805         END-IF                                                           
450806     END-IF.                                                              
450810                                                                          
450820* TICKET FORMAT NUMBER IS ONLY REQUIRED FOR TICKETS WITH A TYPE           
450830* CODE OF 'E' WHICH ARE CREATED BY AN OUTSIDE VENDOR.  DO NOT             
450840* ALLOW ENTRY OF DATA INTO THIS FIELD FOR TICKETS WITH A TYPE             
450850* CODE OF 'I' WHICH ARE CREATED INTERNALLY AT KOHL'S.                     
450900     IF ASC-TKT-FMT-TYP-CDE = 'E' OR 'I'                                  
451000         IF (ASC-TKT-FMT-NBR = SPACES AND                                 
451001             ASC-TKT-FMT-TYP-CDE = 'E')                                   
451002             MOVE PC-TSYMSG-01625        TO DP020-MSG-NUMBER              
451003             MOVE -1                     TO AFMTNBRL                      
451004             MOVE DP015-REVERSE          TO AFMTNBRH                      
451005             MOVE DP015-RED              TO AFMTNBRC                      
451006             MOVE DP015-UNP-ALP-BRT-OFF  TO AFMTNBRA                      
451007             SET DP030-SET-CURSOR-APPL-1                                  
451008                 DP020-MSG-FATAL                                          
451009                 PS-ERROR                TO TRUE                          
451010         END-IF                                                           
451011         IF (ASC-TKT-FMT-NBR NOT = SPACES AND                             
451012             ASC-TKT-FMT-TYP-CDE = 'I')                                   
451013             MOVE PC-TSYMSG-01625        TO DP020-MSG-NUMBER              
451014             MOVE -1                     TO AFMTNBRL                      
451015             MOVE DP015-REVERSE          TO AFMTNBRH                      
451016             MOVE DP015-RED              TO AFMTNBRC                      
451017             MOVE DP015-UNP-ALP-BRT-OFF  TO AFMTNBRA                      
451018             SET DP030-SET-CURSOR-APPL-1                                  
451019                 DP020-MSG-FATAL                                          
451020                 PS-ERROR                TO TRUE                          
451021         END-IF                                                           
451022     ELSE                                                                 
451023         MOVE PC-TSYMSG-01624            TO DP020-MSG-NUMBER              
451025         MOVE -1                         TO AFTYCDEL                      
451026         MOVE DP015-REVERSE              TO AFTYCDEH                      
451027         MOVE DP015-RED                  TO AFTYCDEC                      
451028         MOVE DP015-UNP-ALP-BRT-OFF      TO AFTYCDEA                      
451029         SET DP030-SET-CURSOR-APPL-1                                      
451030             DP020-MSG-FATAL                                              
451031             PS-ERROR                    TO TRUE                          
451032     END-IF.                                                              
451033                                                                          
451034*                                                                         
451035     IF ASC-DISP-STKR-NBR-IND = 'Y' OR 'N'                                
451036         IF (ASC-TKT-FMT-TYP-CDE = 'E') AND                               
451037            (ASC-DISP-STKR-NBR-IND = 'Y')                                 
451038             MOVE PC-TSYMSG-01626        TO DP020-MSG-NUMBER              
451039             MOVE -1                     TO ASTRNBRL                      
451040             MOVE DP015-REVERSE          TO ASTRNBRH                      
451041             MOVE DP015-RED              TO ASTRNBRC                      
451042             MOVE DP015-UNP-ALP-BRT-OFF  TO ASTRNBRA                      
451043             SET DP030-SET-CURSOR-APPL-1                                  
451044                 DP020-MSG-FATAL                                          
451045                 PS-ERROR                TO TRUE                          
451046         END-IF                                                           
451047     ELSE                                                                 
451048         MOVE PC-TSYMSG-00349            TO DP020-MSG-NUMBER              
451049         MOVE -1                         TO ASTRNBRL                      
451050         MOVE DP015-REVERSE              TO ASTRNBRH                      
451051         MOVE DP015-RED                  TO ASTRNBRC                      
451052         MOVE DP015-UNP-ALP-BRT-OFF      TO ASTRNBRA                      
451053         SET DP030-SET-CURSOR-APPL-1                                      
451054             DP020-MSG-FATAL                                              
451055             PS-ERROR                    TO TRUE                          
451056     END-IF.                                                              
451057                                                                          
451058*                                                                         
451059     IF ASC-DISP-OPTBLK-LBL-IND = 'Y' OR 'N'                              
451060         IF (ASC-TKT-FMT-TYP-CDE = 'E') AND                               
451061            (ASC-DISP-OPTBLK-LBL-IND = 'Y')                               
451062             MOVE PC-TSYMSG-01626        TO DP020-MSG-NUMBER              
451063             MOVE -1                     TO AOPBLLBL                      
451064             MOVE DP015-REVERSE          TO AOPBLLBH                      
451065             MOVE DP015-RED              TO AOPBLLBC                      
451066             MOVE DP015-UNP-ALP-BRT-OFF  TO AOPBLLBA                      
451067             SET DP030-SET-CURSOR-APPL-1                                  
451068                 DP020-MSG-FATAL                                          
451069                 PS-ERROR                TO TRUE                          
451070         END-IF                                                           
451071     ELSE                                                                 
451072         MOVE PC-TSYMSG-00349            TO DP020-MSG-NUMBER              
451073         MOVE -1                         TO AOPBLLBL                      
451074         MOVE DP015-REVERSE              TO AOPBLLBH                      
451075         MOVE DP015-RED                  TO AOPBLLBC                      
451076         MOVE DP015-UNP-ALP-BRT-OFF      TO AOPBLLBA                      
451077         SET DP030-SET-CURSOR-APPL-1                                      
451078             DP020-MSG-FATAL                                              
451079             PS-ERROR                    TO TRUE                          
451080     END-IF.                                                              
451081                                                                          
451082*                                                                         
451083     IF ASC-DISP-OPTBLK-TAG-IND = 'Y' OR 'N'                              
451084         IF (ASC-TKT-FMT-TYP-CDE = 'E') AND                               
451085            (ASC-DISP-OPTBLK-TAG-IND = 'Y')                               
451086             MOVE PC-TSYMSG-01626        TO DP020-MSG-NUMBER              
451087             MOVE -1                     TO AOPBLTGL                      
451088             MOVE DP015-REVERSE          TO AOPBLTGH                      
451089             MOVE DP015-RED              TO AOPBLTGC                      
451090             MOVE DP015-UNP-ALP-BRT-OFF  TO AOPBLTGA                      
451091             SET DP030-SET-CURSOR-APPL-1                                  
451092                 DP020-MSG-FATAL                                          
451093                 PS-ERROR                TO TRUE                          
451094         END-IF                                                           
451095     ELSE                                                                 
451096         MOVE PC-TSYMSG-00349            TO DP020-MSG-NUMBER              
451097         MOVE -1                         TO AOPBLTGL                      
451098         MOVE DP015-REVERSE              TO AOPBLTGH                      
451099         MOVE DP015-RED                  TO AOPBLTGC                      
451100         MOVE DP015-UNP-ALP-BRT-OFF      TO AOPBLTGA                      
451101         SET DP030-SET-CURSOR-APPL-1                                      
451102             DP020-MSG-FATAL                                              
451103             PS-ERROR                    TO TRUE                          
451104     END-IF.                                                              
451105                                                                          
451106*                                                                         
451107     IF ASC-DISP-COLOR-IND = 'Y' OR 'N'                                   
451108         IF (ASC-TKT-FMT-TYP-CDE = 'E') AND                               
451109            (ASC-DISP-COLOR-IND = 'Y')                                    
451110             MOVE PC-TSYMSG-01626        TO DP020-MSG-NUMBER              
451111             MOVE -1                     TO ACOLORL                       
451112             MOVE DP015-REVERSE          TO ACOLORH                       
451113             MOVE DP015-RED              TO ACOLORC                       
451114             MOVE DP015-UNP-ALP-BRT-OFF  TO ACOLORA                       
451115             SET DP030-SET-CURSOR-APPL-1                                  
451116                 DP020-MSG-FATAL                                          
451117                 PS-ERROR                TO TRUE                          
451118         END-IF                                                           
451119     ELSE                                                                 
451120         MOVE PC-TSYMSG-00349            TO DP020-MSG-NUMBER              
451121         MOVE -1                         TO ACOLORL                       
451122         MOVE DP015-REVERSE              TO ACOLORH                       
451123         MOVE DP015-RED                  TO ACOLORC                       
451124         MOVE DP015-UNP-ALP-BRT-OFF      TO ACOLORA                       
451125         SET DP030-SET-CURSOR-APPL-1                                      
451126             DP020-MSG-FATAL                                              
451127             PS-ERROR                    TO TRUE                          
451128     END-IF.                                                              
451129                                                                          
451130*                                                                         
451131     IF ASC-DISP-SIZE-IND = 'Y' OR 'N'                                    
451132         IF (ASC-TKT-FMT-TYP-CDE = 'E') AND                               
451133            (ASC-DISP-SIZE-IND = 'Y')                                     
451134             MOVE PC-TSYMSG-01626        TO DP020-MSG-NUMBER              
451135             MOVE -1                     TO ASIZEL                        
451136             MOVE DP015-REVERSE          TO ASIZEH                        
451137             MOVE DP015-RED              TO ASIZEC                        
451138             MOVE DP015-UNP-ALP-BRT-OFF  TO ASIZEA                        
451139             SET DP030-SET-CURSOR-APPL-1                                  
451140                 DP020-MSG-FATAL                                          
451141                 PS-ERROR                TO TRUE                          
451142         END-IF                                                           
451143     ELSE                                                                 
451144         MOVE PC-TSYMSG-00349            TO DP020-MSG-NUMBER              
451145         MOVE -1                         TO ASIZEL                        
451146         MOVE DP015-REVERSE              TO ASIZEH                        
451147         MOVE DP015-RED                  TO ASIZEC                        
451148         MOVE DP015-UNP-ALP-BRT-OFF      TO ASIZEA                        
451149         SET DP030-SET-CURSOR-APPL-1                                      
451150             DP020-MSG-FATAL                                              
451151             PS-ERROR                    TO TRUE                          
451152     END-IF.                                                              
451153                                                                          
451154*                                                                         
451155     IF ASC-PTICK-FMT-IND = 'Y' OR 'N'                                    
451156         IF (ASC-TKT-FMT-TYP-CDE = 'E') AND                               
451157            (ASC-PTICK-FMT-IND = 'N')                                     
451158             MOVE PC-TSYMSG-01628        TO DP020-MSG-NUMBER              
451159             MOVE -1                     TO APTICKL                       
451160             MOVE DP015-REVERSE          TO APTICKH                       
451161             MOVE DP015-RED              TO APTICKC                       
451162             MOVE DP015-UNP-ALP-BRT-OFF  TO APTICKA                       
451163             SET DP030-SET-CURSOR-APPL-1                                  
451164                 DP020-MSG-FATAL                                          
451165                 PS-ERROR                TO TRUE                          
451166         END-IF                                                           
451167     ELSE                                                                 
451168         MOVE PC-TSYMSG-00349            TO DP020-MSG-NUMBER              
451169         MOVE -1                         TO APTICKL                       
451170         MOVE DP015-REVERSE              TO APTICKH                       
451171         MOVE DP015-RED                  TO APTICKC                       
451172         MOVE DP015-UNP-ALP-BRT-OFF      TO APTICKA                       
451173         SET DP030-SET-CURSOR-APPL-1                                      
451174             DP020-MSG-FATAL                                              
451175             PS-ERROR                    TO TRUE                          
451176     END-IF.                                                              
451177                                                                          
451180*                                                                         
451200     IF ASC-TKT-FMT-DESC > SPACES                                         
451300         CONTINUE                                                         
451301     ELSE                                                                 
451302         MOVE PC-TSYMSG-00007            TO DP020-MSG-NUMBER              
451303         MOVE -1                         TO ATFDESCL                      
451304         MOVE DP015-REVERSE              TO ATFDESCH                      
451305         MOVE DP015-RED                  TO ATFDESCC                      
451306         MOVE DP015-UNP-ALP-BRT-OFF      TO ATFDESCA                      
451307         SET DP030-SET-CURSOR-APPL-1                                      
451308             DP020-MSG-FATAL                                              
451309             PS-ERROR                    TO TRUE                          
451310     END-IF.                                                              
451311                                                                          
451312*                                                                         
451313     IF ASC-KEY-TKT-FMT-ID > SPACES                                       
451314         CONTINUE                                                         
451315     ELSE                                                                 
451316         MOVE PC-TSYMSG-00007            TO DP020-MSG-NUMBER              
451317         MOVE -1                         TO ATFIDL                        
451318         MOVE DP015-REVERSE              TO ATFIDH                        
451319         MOVE DP015-RED                  TO ATFIDC                        
451320         MOVE DP015-UNP-ALP-BRT-OFF      TO ATFIDA                        
451321         SET DP030-SET-CURSOR-APPL-1                                      
451322             DP020-MSG-FATAL                                              
451323             PS-ERROR                    TO TRUE                          
451324     END-IF.                                                              
451325*                                                                         
451326     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                               
451327         ASC-ITEMS-DISPLAYED - 1.                                         
451329     PERFORM 3100-SET-SUBSCRIPTS.                                         
451330*                                                                 DPKCS036
451331     PERFORM 3300-EDIT-SELECTIONS                                 DPKCS036
451332         VARYING PV-SUB                                           DPKCS036
451333         FROM PV-SUB BY -1                                        DPKCS036
451334         UNTIL PV-SUB < +1.                                       DPKCS036
451336*                                                                 DPKCS036
451337 EJECT                                                                    
451338*----------------------------------------------------------------*        
451339*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *        
451340*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*        
451341*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *        
451342*                                                                *        
451343*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *        
451344*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *        
451345*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *        
451346*    US IN THE 2ND BLOCK OF THE ARRAY.                           *        
451347*----------------------------------------------------------------*        
451348                                                                          
451349 3100-SET-SUBSCRIPTS.                                                     
451350                                                                          
451351     COMPUTE ASC-ITEM-SUB =                                               
451352         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.                
451353                                                                          
451354     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                 
451355         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
451356                                                                          
451357         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB                       
451358     ELSE                                                                 
451359         MOVE +1                     TO ASC-BLK-SUB                       
451360     END-IF.                                                              
451361******************************************************************        
451362** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **        
451363******************************************************************        
451364                                                                          
451365 3200-RESET-ATTRIBUTES.                                                   
451366     EVALUATE TRUE                                                        
451367                                                                          
451370*    WHEN IN "DELETE MODE" - PROTECT ALL FIELDS                           
451371     WHEN ASC-DELETE-TKT-FMT-FORMAT                                       
451372         MOVE DP015-ASK-NOR-OFF    TO ASTRTITA                            
451373                                      ATFIDA                              
451374                                      ATFDESCA                            
451375                                      APTICKA                             
451376                                      ASIZEA                              
451377                                      ACOLORA                             
451378                                      AOPBLLBA                            
451379                                      AOPBLTGA                            
451380                                      ASTRNBRA                            
451381                                      AFTYCDEA                            
451382                                      AFMTNBRA                            
451390                                      APAPERA                             
451400                                      AXTKTNBA                            
451401                                      AXTKTPTA                            
451402         MOVE DP015-BLUE           TO ASTRTITC                            
451403                                      ATFIDC                              
451404                                      ATFDESCC                            
451405                                      APTICKC                             
451406                                      ASIZEC                              
451407                                      ACOLORC                             
451408                                      AOPBLLBC                            
451409                                      AOPBLTGC                            
451410                                      ASTRNBRC                            
451411                                      AFTYCDEC                            
451412                                      AFMTNBRC                            
451420                                      APAPERC                             
451430                                      AXTKTNBC                            
451431                                      AXTKTPTC                            
451432         MOVE DP015-HL-OFF         TO ASTRTITH                            
451433                                      ATFIDH                              
451434                                      ATFDESCH                            
451435                                      APTICKH                             
451436                                      ASIZEH                              
451437                                      ACOLORH                             
451438                                      AOPBLLBH                            
451439                                      AOPBLTGH                            
451440                                      ASTRNBRH                            
451441                                      AFTYCDEH                            
451442                                      AFMTNBRH                            
451450                                      APAPERH                             
451460                                      AXTKTNBH                            
451470                                      AXTKTPTH                            
451480*                                                                 DPKCS036
451490*    WHEN IN "UPDATE MODE" - PROTECT THE TICKET FORMAT ID, BUT ALLOW      
451500*    UPDATING TO ALL OTHER FIELDS                                         
451501*                                                                         
451502*    08/20/97 -- PROTECT THE PAPER STOCK ID FIELD FOR EXTERNALLY          
451503*    CREATED TICKET FORMATS (TYPE CODE 'E') ONLY!!!                       
451504     WHEN ASC-UPDATE-TKT-FMT-FORMAT                                       
451505         MOVE DP015-ASK-NOR-OFF    TO ATFIDA                              
451506         MOVE DP015-UNP-ALP-NOR-OFF                                       
451507                                   TO ASTRTITA                            
451508                                      ATFDESCA                            
451509                                      APTICKA                             
451510                                      ASIZEA                              
451511                                      ACOLORA                             
451512                                      AOPBLLBA                            
451513                                      AOPBLTGA                            
451520                                      ASTRNBRA                            
451530                                      AFTYCDEA                            
451531                                      AFMTNBRA                            
451532                                      APAPERA                             
451540                                      AXTKTNBA                            
451541                                      AXTKTPTA                            
451542         MOVE DP015-BLUE           TO ATFIDC                              
451543         MOVE DP015-GREEN          TO ASTRTITC                            
451544                                      ATFDESCC                            
451545                                      APTICKC                             
451546                                      ASIZEC                              
451547                                      ACOLORC                             
451548                                      AOPBLLBC                            
451549                                      AOPBLTGC                            
451550                                      ASTRNBRC                            
451551                                      AFTYCDEC                            
451552                                      AFMTNBRC                            
451560                                      APAPERC                             
451570                                      AXTKTNBC                            
451571                                      AXTKTPTC                            
451572         MOVE DP015-HL-OFF         TO ATFIDH                              
451573         MOVE DP015-UNDERLINE      TO ASTRTITH                            
451574                                      ATFDESCH                            
451575                                      APTICKH                             
451576                                      ASIZEH                              
451577                                      ACOLORH                             
451578                                      AOPBLLBH                            
451579                                      AOPBLTGH                            
451580                                      ASTRNBRH                            
451581                                      AFTYCDEH                            
451582                                      AFMTNBRH                            
451590                                      APAPERH                             
451600                                      AXTKTNBH                            
451700                                      AXTKTPTH                            
451701     IF  ASC-TKT-FMT-TYP-CDE = 'E'                                        
451710         MOVE DP015-ASK-NOR-OFF    TO APAPERA                             
451720         MOVE DP015-BLUE           TO APAPERC                             
451730         MOVE DP015-HL-OFF         TO APAPERH                             
451740     END-IF                                                               
451800                                                                          
451900*    WHEN IN "CREATE MODE" - ALLOW UPDATE TO ALL FIELDS                   
452000     WHEN ASC-CREATE-TKT-FMT-FORMAT                                       
452001         MOVE DP015-UNP-ALP-NOR-OFF                                       
452002                                   TO ASTRTITA                            
452003                                      ATFIDA                              
452004                                      ATFDESCA                            
452005                                      APTICKA                             
452006                                      ASIZEA                              
452007                                      ACOLORA                             
452008                                      AOPBLLBA                            
452009                                      AOPBLTGA                            
452010                                      ASTRNBRA                            
452011                                      AFTYCDEA                            
452012                                      AFMTNBRA                            
452020                                      APAPERA                             
452030                                      AXTKTNBA                            
452031                                      AXTKTPTA                            
452032         MOVE DP015-GREEN          TO ASTRTITC                            
452033                                      ATFIDC                              
452034                                      ATFDESCC                            
452035                                      APTICKC                             
452036                                      ASIZEC                              
452037                                      ACOLORC                             
452038                                      AOPBLLBC                            
452039                                      AOPBLTGC                            
452040                                      ASTRNBRC                            
452041                                      AFTYCDEC                            
452042                                      AFMTNBRC                            
452050                                      APAPERC                             
452060                                      AXTKTNBC                            
452061                                      AXTKTPTC                            
452062         MOVE DP015-UNDERLINE      TO ASTRTITH                            
452063                                      ATFIDH                              
452064                                      ATFDESCH                            
452065                                      APTICKH                             
452066                                      ASIZEH                              
452067                                      ACOLORH                             
452068                                      AOPBLLBH                            
452069                                      AOPBLTGH                            
452070                                      ASTRNBRH                            
452071                                      AFTYCDEH                            
452072                                      AFMTNBRH                            
452080                                      APAPERH                             
452090                                      AXTKTNBH                            
452091                                      AXTKTPTH                            
452092     END-EVALUATE.                                                        
452093*                                                                         
452094     IF  ASC-DELETE-TKT-FMT-FORMAT                                        
452095         PERFORM                                                      DPKC
452096             VARYING PV-SUB                                           DPKC
452097             FROM 1 BY 1                                              DPKC
452098             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        DPKC
452099             MOVE DP015-ASK-NOR-OFF                                       
452100                                   TO MR-SELECTA (PV-SUB)             DPKC
452101             MOVE DP015-BLUE       TO MR-SELECTC (PV-SUB)             DPKC
452110             MOVE DP015-HL-OFF     TO MR-SELECTH (PV-SUB)             DPKC
452200         END-PERFORM                                                  DPKC
452201     ELSE                                                                 
452202         PERFORM                                                      DPKC
452203             VARYING PV-SUB                                           DPKC
452204             FROM 1 BY 1                                              DPKC
452205             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        DPKC
452206             MOVE DP015-UNP-ALP-NOR-OFF                                   
452207                                   TO MR-SELECTA (PV-SUB)             DPKC
452208             MOVE DP015-GREEN      TO MR-SELECTC (PV-SUB)             DPKC
452209             MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)             DPKC
452210         END-PERFORM                                                  DPKC
452211     END-IF.                                                              
452212                                                                          
452213*                                                                         
452214 EJECT                                                            DPKCS036
452215******************************************************************PCKCS123
452216** EDIT THE SELECTED TICKET OFFICES.  TICKET FORMATS WITH A     **PCKCS123
452217** TYPE CODE OF 'E' CAN ONLY BE CREATED FOR CERTAIN TICKET      **PCKCS123
452218** OFFICES.  TICKET FORMATS WITH A TYPE CODE OF 'I' CAN BE      **PCKCS123
452219** CREATED FOR ALL OF THE OTHER TICKET OFFICES.                 **PCKCS123
452220**                                                              **PCKCS123
452221** ** NOTE ** NOTE ** NOTE ** NOTE ** NOTE ** NOTE ** NOTE **   **PCKCS123
452222** THIS CODE IS COMMENTED OUT FOR NOW.  WE WILL BE ADDING THESE **PCKCS123
452223** NEW EXTERNAL HANG TAG TICKET TYPES ALL TICKET OFFICES FOR    **PCKCS123
452224** NOW.  DAN H. - 8/20/97                                       **PCKCS123
452225** ** NOTE ** NOTE ** NOTE ** NOTE ** NOTE ** NOTE ** NOTE **   **PCKCS123
452226******************************************************************PCKCS123
452227*                                                                       23
452228*3300-EDIT-SELECTIONS.                                            PCKCS123
452229*    IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    PCKCS123
452230*        IF ASC-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB) = 'I' AND            23
452231*           ASC-TKT-FMT-TYP-CDE = 'E'                                   23
452232*            SET PS-ERROR                                               23
452233*                DP020-MSG-FATAL         TO TRUE                        23
452234*            MOVE PC-TYPE-CODE-E-MESSAGE TO DP020-MSG-MESSAGE           23
452235*            MOVE DP015-UNP-ALP-BRT-OFF  TO MR-SELECTA (PV-SUB)         23
452236*            MOVE DP015-RED              TO MR-SELECTC (PV-SUB)         23
452237*            MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)         23
452238*            MOVE -1                     TO MR-SELECTL (PV-SUB)         23
452239*            SET DP030-SET-CURSOR-APPL-1 TO TRUE                        23
452240*        END-IF                                                         23
452241*        IF ASC-TYP-CDE (ASC-BLK-SUB ASC-ITEM-SUB) = 'E' AND            23
452242*           ASC-TKT-FMT-TYP-CDE = 'I'                                   23
452243*            SET PS-ERROR                                               23
452244*                DP020-MSG-FATAL         TO TRUE                        23
452245*            MOVE PC-TYPE-CODE-I-MESSAGE TO DP020-MSG-MESSAGE           23
452246*            MOVE DP015-UNP-ALP-BRT-OFF  TO MR-SELECTA (PV-SUB)         23
452247*            MOVE DP015-RED              TO MR-SELECTC (PV-SUB)         23
452248*            MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)         23
452249*            MOVE -1                     TO MR-SELECTL (PV-SUB)         23
452250*            SET DP030-SET-CURSOR-APPL-1 TO TRUE                        23
452260*        END-IF                                                         23
452319*    END-IF.                                                      PCKCS123
452320*                                                                 PCKCS123
452323*    SUBTRACT +1             FROM PV-ITEM-IN-USE.                 PCKCS123
452324*    SUBTRACT +1             FROM ASC-ITEM-SUB.                   PCKCS123
452325*                                                                 PCKCS123
452326*    IF  ASC-ITEM-SUB < 1                                         PCKCS123
452327*        SUBTRACT +1 FROM ASC-BLK-SUB                             PCKCS123
452328*        MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                PCKCS123
452329*    END-IF.                                                      PCKCS123
452330*                                                                 PCKCS123
452331*                                                                 PCKCS123
452332******************************************************************        
452333** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **        
452334** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **        
452335** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **        
452336** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **        
452337******************************************************************        
452338 3300-EDIT-SELECTIONS.                                                    
452339     EVALUATE TRUE                                                        
452340         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
452341             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)                 
452342                 CONTINUE                                                 
452343         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)                 
452344             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                
452345                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS           
452346                 MOVE ASC-TEMP-SELECTED-SW                                
452347                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
452348                                TO ASC-SELECTED-SW                        
452349                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
452350             END-IF                                                       
452351         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
452352                 = SPACE                                                  
452353             EVALUATE TRUE                                                
452354                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               
452355                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        
452356                     MOVE SPACE TO ASC-SELECTED-SW                        
452357                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
452358                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                
452359                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE            
452360                     MOVE SPACE TO ASC-SELECTED-SW                        
452361                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
452362                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)                  
452363                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE              
452364                     MOVE SPACE TO ASC-SELECTED-SW                        
452365                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
452366             END-EVALUATE                                                 
452367         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                   
452368             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
452369                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
452370             END-IF                                                       
452371             PERFORM 3310-EDIT-RANGE                                      
452372         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)                     
452373             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
452374                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
452375             END-IF                                                       
452376             PERFORM 3310-EDIT-RANGE                                      
452377         WHEN OTHER                                                       
452378             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER                   
452379             SET DP020-MSG-FATAL    TO TRUE                               
452380             MOVE -1                TO MR-SELECTL (PV-SUB)                
452381             SET DP030-SET-CURSOR-APPL-1                                  
452382                                    TO TRUE                               
452383             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)                
452384             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)                
452385             SET PS-ERROR TO TRUE                                         
452386             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
452387                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS             
452388                 MOVE SPACE         TO ASC-SELECTED-SW                    
452389                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
452390             END-IF                                                       
452391     END-EVALUATE.                                                        
452392                                                                          
452393     SUBTRACT +1             FROM PV-ITEM-IN-USE.                         
452394     SUBTRACT +1 FROM ASC-ITEM-SUB.                                       
452395     IF  ASC-ITEM-SUB < 1                                                 
452396         SUBTRACT +1 FROM ASC-BLK-SUB                                     
452397         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                        
452398     END-IF.                                                              
452399                                                                          
452400                                                                          
452401******************************************************************        
452402** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **        
452403** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **        
452404** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**        
452405** THE ENDING.                                                  **        
452406******************************************************************        
452407 3310-EDIT-RANGE.                                                         
452408     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                        
452409         IF  ASC-START-OF-SELECTED-RANGE = ZERO                           
452410             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)        
452411                                   TO ASC-SELECTED-SW                     
452412                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
452413             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE         
452414         ELSE                                                             
452415             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE             
452416                 CONTINUE                                                 
452417             ELSE                                                         
452418*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --                
452419                 MOVE PC-TSYMSG-00054                                     
452420                                   TO DP020-MSG-NUMBER                    
452421                 SET DP020-MSG-FATAL                                      
452422                                   TO TRUE                                
452423                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
452424                 SET DP030-SET-CURSOR-APPL-1                              
452425                                   TO TRUE                                
452426                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)                 
452427                 MOVE DP015-UNDERLINE                                     
452428                                   TO MR-SELECTH (PV-SUB)                 
452429                 SET PS-ERROR      TO TRUE                                
452430             END-IF                                                       
452431         END-IF                                                           
452432     ELSE                                                                 
452433         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
452434             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         
452435                                   TO ASC-SELECTED-SW                     
452436                                     (ASC-BLK-SUB ASC-ITEM-SUB)           
452437             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE           
452438         ELSE                                                             
452439             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE               
452440                 CONTINUE                                                 
452441             ELSE                                                         
452442*                -- ONLY ONE END-OF-RANGE ALLOWED --                      
452443                 MOVE PC-TSYMSG-00055                                     
452444                                   TO DP020-MSG-NUMBER                    
452445                 SET DP020-MSG-FATAL                                      
452446                                   TO TRUE                                
452447                 MOVE -1           TO MR-SELECTL (PV-SUB)                 
452448                 SET DP030-SET-CURSOR-APPL-1                              
452449                                   TO TRUE                                
452450                 SET PS-ERROR      TO TRUE                                
452451             END-IF                                                       
452452         END-IF                                                           
452453     END-IF.                                                              
452454*                                                                         
452455*----------------------------------------------------------------*        
452456*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *        
452457*    INITIALIZE ALL COUNTERS AND FLAGS.                          *        
452458*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *        
452459*    DISPLAY THE PANEL TO USER.                                  *        
452460*----------------------------------------------------------------*        
452461                                                                          
452462 4000-BUILD-INITIAL-PANEL.                                                
452463                                                                          
452464     INITIALIZE                  ASC-BLOCK-ENTRIES (1)                    
452465                                 ASC-BLOCK-ENTRIES (2).                   
452466     MOVE +1                  TO ASC-BLK-SUB.                             
452467     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                                    
452468                                                                          
452469     MOVE +0                  TO ASC-ITEM-SUB                             
452470                                 ASC-NUMBER-OF-ITEMS-READ                 
452471                                 ASC-NUMBER-OF-SELECTED-ITEMS             
452472                                 ASC-HIGHEST-BLOCK-WRITTEN                
452473                                 ASC-START-OF-SELECTED-RANGE              
452474                                 ASC-END-OF-SELECTED-RANGE                
452475                                 ASC-ITEM-AT-TOP-OF-PANEL.                
452476     MOVE ASC-KEY-TKT-FMT-ID  TO DK-TKT-FMT-ID.                           
452477                                                                          
452478*    PERFORM 4100-GET-CURRENT-DATE.                                       
452479                                                                          
452480     EVALUATE TRUE                                                        
452481     WHEN ASC-DELETE-COMPLETE                                             
452482         MOVE SPACES                   TO ASC-TKT-FMT-DESC                
452483                                          ASC-TKT-FMT-DESC-OLD            
452484                                          ASC-PAPER-TYP-ID                
452485                                          ASC-PAPER-TYP-ID-OLD            
452486                                          ASC-PCT-XTRA-TIX                
452487                                          ASC-DISP-OPTBLK-TAG-IND         
452488                                          ASC-DISP-OPTBLK-LBL-IND         
452490                                          ASC-DISP-SIZE-IND               
452500                                          ASC-DISP-COLOR-IND              
452600                                          ASC-DISP-STKR-NBR-IND           
452700                                          ASC-PTICK-FMT-IND               
452701                                          ASC-NBR-XTRA-TIX                
452702                                          ASC-TKT-FMT-TYP-CDE             
452703                                          ASC-TKT-FMT-NBR                 
452704         MOVE -1               TO ATFIDL                                  
452705         SET DP030-SET-CURSOR-APPL-1                                      
452706                               TO TRUE                                    
452707         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                             
452708                                                                          
452709     WHEN ASC-KEY-TKT-FMT-ID = SPACES                                     
452710         MOVE SPACES                   TO ASC-TKT-FMT-DESC                
452711                                          ASC-TKT-FMT-DESC-OLD            
452712                                          ASC-PAPER-TYP-ID                
452720                                          ASC-PAPER-TYP-ID-OLD            
452730                                          ASC-PCT-XTRA-TIX                
452731                                          ASC-TKT-FMT-TYP-CDE             
452732                                          ASC-TKT-FMT-NBR                 
452740         MOVE 'N'                      TO ASC-DISP-OPTBLK-TAG-IND         
452750                                          ASC-DISP-OPTBLK-LBL-IND         
452760                                          ASC-DISP-STKR-NBR-IND           
452770         MOVE 'Y'                      TO ASC-DISP-SIZE-IND               
452780                                          ASC-DISP-COLOR-IND              
452790                                          ASC-PTICK-FMT-IND               
452800         MOVE 10                      TO ASC-NBR-XTRA-TIX-N               
452900                                                                          
452901         PERFORM 4320-OPEN-CURSOR                                         
452902         PERFORM 4300-READ-ITEMS-FROM-DB2                                 
452903         PERFORM 4330-CLOSE-CURSOR                                        
452904                                                                          
452905         MOVE +1 TO PV-TOP-ITEM                                           
452906                                                                          
452907         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                              
452908             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                        
452909             SET DP020-MSG-FATAL   TO  TRUE                               
452910             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                   
452911         ELSE                                                             
452912             MOVE -1               TO ATFIDL                              
452913             SET DP030-SET-CURSOR-APPL-1                                  
452914                                   TO TRUE                                
452915             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
452916         END-IF                                                           
452917                                                                          
452918     WHEN OTHER                                                           
452919         PERFORM 4200-GET-TICKET-INFO                                     
452920                                                                          
452930         MOVE TKTFMT-TKT-FMT-DESC      TO ASC-TKT-FMT-DESC                
452940                                          ASC-TKT-FMT-DESC-OLD            
452941         MOVE TKTFMT-TYP-CDE           TO ASC-TKT-FMT-TYP-CDE             
452950         MOVE TKTFMT-OPT-BLK-TAGS-IND  TO ASC-DISP-OPTBLK-TAG-IND         
452960         MOVE TKTFMT-OPT-BLK-LBLS-IND  TO ASC-DISP-OPTBLK-LBL-IND         
452970         MOVE TKTFMT-PRT-SIZE-IND      TO ASC-DISP-SIZE-IND               
452980         MOVE TKTFMT-PRT-COLOR-IND     TO ASC-DISP-COLOR-IND              
452990         MOVE TKTFMT-STKR-NBR-REQ-IND  TO ASC-DISP-STKR-NBR-IND           
453000         MOVE TKTFMT-PAPER-TYP-ID      TO ASC-PAPER-TYP-ID                
453100                                          ASC-PAPER-TYP-ID-OLD            
453110         MOVE TKTFMT-TKT-FMT-NBR       TO ASC-TKT-FMT-NBR                 
453200         MOVE PRTSTK-EXTRA-TKTS-PCT    TO ASC-PCT-XTRA-TIX-N              
453300         MOVE PRTSTK-EXTRA-TKTS-NBR    TO ASC-NBR-XTRA-TIX-N              
453301                                                                          
453302         PERFORM 4210-GET-PRETICKET-INFO                                  
453303                                                                          
453401         IF VSCHVL-STAT-CDE = 'A'                                         
453402             MOVE 'Y'                  TO ASC-PTICK-FMT-IND               
453403         ELSE                                                             
453404             MOVE 'N'                  TO ASC-PTICK-FMT-IND               
453410         END-IF                                                           
453500                                                                          
454001         PERFORM 4320-OPEN-CURSOR                                         
454002         PERFORM 4300-READ-ITEMS-FROM-DB2                                 
454003         PERFORM 4330-CLOSE-CURSOR                                        
454004                                                                          
454005         MOVE +1 TO PV-TOP-ITEM                                           
454006                                                                          
454007         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                              
454008             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                        
454009             SET DP020-MSG-FATAL   TO  TRUE                               
454010             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                   
454011         ELSE                                                             
454012             MOVE -1               TO ATFDESCL                            
454013             SET DP030-SET-CURSOR-APPL-1                                  
454014                                   TO TRUE                                
454015             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
454016         END-IF                                                           
454017     END-EVALUATE.                                                        
454018                                                                          
454019 EJECT                                                                    
454020*----------------------------------------------------------------*        
454021*    GET THE CURRENT DATE.                                       *        
454022*----------------------------------------------------------------*        
454023                                                                          
454024*4100-GET-CURRENT-DATE.                                                   
454025*                                                                         
454026*    EXEC SQL                                                             
454027*        SET :ASC-CURRENT-DATE = CURRENT DATE                             
454028*    END-EXEC.                                                            
454029*                                                                         
454030*    IF SQLCODE = +0                                                      
454031*        CONTINUE                                                         
454032*    ELSE                                                                 
454033*        MOVE '4100-GET-CURRENT-DATE'                                     
454034*                          TO DP013-PARAGRAPH                             
454035*        MOVE 'SET CURRENT DATE'                                          
454036*                          TO DP013-MESSAGE-TEXT (1)                      
454037*        MOVE SQLCA        TO DP013-SQLCA                                 
454038*        SET DP013-DB2-ABEND                                              
454039*            DP013-XCTL-DISPLAY-RESTART TO TRUE                           
454040*        PERFORM DP013-0000-PROCESS-ABEND                                 
454041*    END-IF.                                                              
454042                                                                          
454043*----------------------------------------------------------------*        
454044*    GET ALL THE TICKET INFORMATION FROM THE TICKET FORMAT TABLE *        
454045*----------------------------------------------------------------*        
454046                                                                          
454047 4200-GET-TICKET-INFO.                                                    
454048                                                                          
454049     INITIALIZE DCLTPRTSTK                                                
454050                DCLTTKTFMT.                                               
454052                                                                          
454053     EXEC SQL                                                             
454054         SELECT  DISTINCT                                                 
454055                 B.TKT_FMT_DESC                                           
454056               , B.TYP_CDE                                                
454057               , B.OPT_BLK_TAGS_IND                                       
454058               , B.OPT_BLK_LBLS_IND                                       
454059               , B.PRT_SIZE_IND                                           
454060               , B.PRT_COLOR_IND                                          
454061               , B.STKR_NBR_REQ_IND                                       
454062               , B.PAPER_TYP_ID                                           
454063               , B.TKT_FMT_NBR                                            
454064               , A.EXTRA_TKTS_PCT                                         
454065               , A.EXTRA_TKTS_NBR                                         
454067         INTO                                                             
454068                 :TKTFMT-TKT-FMT-DESC                                     
454069               , :TKTFMT-TYP-CDE                                          
454070               , :TKTFMT-OPT-BLK-TAGS-IND                                 
454071               , :TKTFMT-OPT-BLK-LBLS-IND                                 
454072               , :TKTFMT-PRT-SIZE-IND                                     
454073               , :TKTFMT-PRT-COLOR-IND                                    
454074               , :TKTFMT-STKR-NBR-REQ-IND                                 
454075               , :TKTFMT-PAPER-TYP-ID                                     
454076               , :TKTFMT-TKT-FMT-NBR                                      
454077               , :PRTSTK-EXTRA-TKTS-PCT                                   
454078               , :PRTSTK-EXTRA-TKTS-NBR                                   
454080         FROM                                                             
454081                 TPRTSTK A                                                
454082               , TTKTFMT B                                                
454084         WHERE                                                            
454085               B.TKT_FMT_ID = :DK-TKT-FMT-ID                              
454090           AND B.PAPER_TYP_ID = A.PAPER_TYPE_ID                           
454592     END-EXEC.                                                            
454593                                                                          
454594     IF SQLCODE = +0                                                      
454595         CONTINUE                                                         
454596     ELSE                                                                 
454597         MOVE '4200-GET-TICKET-INFO'                                      
454598                           TO DP013-PARAGRAPH                             
454599         MOVE 'SELECT TICKET INFORMATION'                                 
454600                           TO DP013-MESSAGE-TEXT (1)                      
454601         MOVE DK-TKT-FMT-ID                                               
454602                           TO DP013-MESSAGE-TEXT (2)                      
454603         MOVE 'TTKTFMT '   TO DP013-DB2-TABLE-NAME (1)                    
454604         MOVE 'TPRTSTK '   TO DP013-DB2-TABLE-NAME (2)                    
454606         MOVE SQLCA        TO DP013-SQLCA                                 
454607         SET DP013-DB2-ABEND                                              
454608             DP013-XCTL-DISPLAY-RESTART TO TRUE                           
454609         PERFORM DP013-0000-PROCESS-ABEND                                 
454610     END-IF.                                                              
454611                                                                          
454612 EJECT                                                                    
454613*----------------------------------------------------------------*        
454614*    DETERMINE IF THE TICKET FORMAT IS PRETICKET TYPE            *        
454615*----------------------------------------------------------------*        
454617 4210-GET-PRETICKET-INFO.                                                 
454618                                                                          
454619     INITIALIZE DCLTVSCHVL.                                               
454620                                                                          
454621     EXEC SQL                                                             
454623         SELECT                                                           
454624                 STAT_CDE                                                 
454625         INTO                                                             
454626                 :VSCHVL-STAT-CDE                                         
454627         FROM                                                             
454628                 TVSCHVL                                                  
454629         WHERE                                                            
454630               CHARTC_CDE      = :PC-PRETICKET-VSM-CODE                   
454631           AND CHARTC_VAL_DESC = :TKTFMT-TKT-FMT-DESC                     
454632           AND STAT_CDE        = 'A'                                      
454633     END-EXEC.                                                            
454634                                                                          
454635     EVALUATE TRUE                                                DPKCS036
454636         WHEN SQLCODE = ZERO                                      DPKCS036
454637         WHEN SQLCODE = +100                                      DPKCS036
454638              CONTINUE                                            DPKCS036
454639         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
454640         WHEN SQLCODE NOT = ZERO                                  DPKCS036
454641              MOVE '4210-GET-PRETICKET-INFO'                      DPKCS036
454642                               TO DP013-PARAGRAPH                 DPKCS036
454643              MOVE 'FETCH PRETICKET INFORMATION'                  DPKCS036
454644                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
454645              MOVE TKTFMT-TKT-FMT-DESC                                    
454646                               TO DP013-MESSAGE-TEXT (2)                  
454647              MOVE 'TVSCHVL '  TO DP013-DB2-TABLE-NAME (1)                
454648              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
454649              SET DP013-DB2-ABEND                                 DPKCS036
454650                               TO TRUE                            DPKCS036
454651              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
454652     END-EVALUATE.                                                DPKCS036
454653                                                                          
454660 EJECT                                                                    
454674*----------------------------------------------------------------*        
454675*    IF CONTROL OF THE PROGRAM CAME FROM THE SHIPMENT CRIT SPEC  *        
454676*    SCREEN, OR THE SHIPMENT LIST SCREEN, THE PROGRAM IN IS      *        
454677*    "UPDATE" MODE, AND ALL THE DATA MUST BE READ FROM DB2.      *        
454678*                                                                *        
454679*    READ THE ITEMS FROM THE DATABASE, AND MOVE TO THE           *        
454680*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *        
454681*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *        
454682*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *        
454683*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *        
454684*                                                                *        
454685*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *        
454686*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *        
454687*    UPON INITIALIZATION.                                        *        
454688*----------------------------------------------------------------*        
454689                                                                          
454690 4300-READ-ITEMS-FROM-DB2.                                                
454691                                                                          
454692     PERFORM                                                              
454693         VARYING PV-READ-COUNT                                            
454694         FROM 1 BY 1                                                      
454695         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                            
454696            OR (ASC-NO-ITEMS-LEFT-ON-DB))                                 
454697                                                                          
454698         PERFORM 4310-FETCH-CURSOR                                        
454699                                                                          
454700         IF ASC-ITEMS-LEFT-ON-DB                                          
454701             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        
454702                 ADD +1            TO ASC-ITEM-SUB                        
454703             ELSE                                                         
454704                 ADD +1            TO ASC-BLK-SUB                         
454705                 MOVE +1           TO ASC-ITEM-SUB                        
454706                                                                          
454707                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 
454708                     MOVE +1       TO ASC-BLK-SUB                         
454709                     SET ASC-BLOCK-MODIFIED (1)                           
454710                                   TO TRUE                                
454711                     PERFORM 5100-WRITE-TEMP-STORAGE                      
454712                     MOVE ASC-BLOCK-ENTRIES                               
454713                               (PC-MAX-BLOCKS-IN-ARRAY)                   
454714                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)         
454715                     ADD +1        TO ASC-BLK-SUB                         
454716                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           
454717                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              
454718                                   TO TRUE                                
454719                 END-IF                                                   
454720             END-IF                                                       
454721                                                                          
454722             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ            
454723             MOVE ASC-NUMBER-OF-ITEMS-READ                                
454724                                   TO ASC-LIST-ITEM-NUMBER                
454725                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
454726                                                                          
454727             MOVE TKTFMT-TKT-OFF-ID                                       
454728                                   TO ASC-TKT-OFF-ID                      
454729                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
454730             MOVE TKTFMT-OPER-UNT-ID                                      
454731                                   TO ASC-OPER-UNT-ID                     
454732                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
454733             MOVE TKTFMT-FCLTY-ID  TO ASC-FCLTY-ID                        
454734                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
454735             MOVE TKTFMT-TKT-OFF-ADR-ID                                   
454736                                   TO ASC-TKT-OFF-ADR-ID                  
454738                                      (ASC-BLK-SUB ASC-ITEM-SUB)        86
454739             IF  ASC-CREATE-TKT-FMT-FORMAT                                
454740                 SET ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                
454741                     ASC-TEMP-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)           
454750                                   TO TRUE                                
454751                 ADD +1 TO ASC-NUMBER-OF-SELECTED-ITEMS                   
454752             ELSE                                                         
454753                 PERFORM 4340-COUNT-TTKTFMT                               
454754                 IF  PV-DB2-COUNT > 0                                     
454755                     SET ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            
454756                         ASC-TEMP-SELECT                                  
454757                                    (ASC-BLK-SUB ASC-ITEM-SUB)            
454758                                   TO TRUE                                
454759                     ADD +1 TO ASC-NUMBER-OF-SELECTED-ITEMS               
454760                 END-IF                                                   
454761             END-IF                                                       
454762         END-IF                                                           
454763     END-PERFORM.                                                         
454764                                                                          
454765     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                                  
454766         MOVE +1               TO ASC-BLK-SUB                             
454767         PERFORM 5100-WRITE-TEMP-STORAGE                                  
454768         ADD +1                TO ASC-BLK-SUB                             
454769         PERFORM 5100-WRITE-TEMP-STORAGE                                  
454770                                                                          
454771         MOVE 1                TO ASC-BLK-SUB                             
454772                                  PV-BLOCK-NUMBER                         
454773         PERFORM 4410-READ-TEMP-STORAGE                                   
454774         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
454775             MOVE 2            TO ASC-BLK-SUB                             
454776                                  PV-BLOCK-NUMBER                         
454777             PERFORM 4410-READ-TEMP-STORAGE                               
454778         END-IF                                                           
454779     END-IF.                                                              
454780 EJECT                                                                    
454781*----------------------------------------------------------------*        
454782*    FETCH THE MESSAGE CURSOR.                                   *        
454783*----------------------------------------------------------------*        
454784                                                                          
454785 4310-FETCH-CURSOR.                                                       
454786                                                                          
454787     INITIALIZE DCLTTKTFMT.                                               
454788                                                                          
454789     EXEC SQL                                                             
454790          FETCH TKT_OFFICE_CURSOR                                         
454791          INTO                                                            
454792                 :TKTFMT-TKT-OFF-ID                                       
454793               , :TKTFMT-OPER-UNT-ID                                      
454800               , :TKTFMT-FCLTY-ID                                         
454802               , :TKTFMT-TKT-OFF-ADR-ID                                   
454803     END-EXEC.                                                            
454804                                                                          
454805     EVALUATE TRUE                                                        
454806         WHEN SQLCODE = ZERO                                              
454807         WHEN SQLCODE = +100                                              
454808              CONTINUE                                                    
454809         WHEN SQLWARN0 NOT = SPACE                                        
454810         WHEN SQLCODE NOT = ZERO                                          
454811              MOVE '4310-FETCH-CURSOR'                                    
454812                               TO DP013-PARAGRAPH                         
454813              MOVE 'FETCH TKT_OFFICE_CURSOR'                              
454814                               TO DP013-MESSAGE-TEXT (1)                  
454815              MOVE DK-TKT-FMT-ID                                          
454816                               TO DP013-MESSAGE-TEXT (2)                  
454817              MOVE SQLCA       TO DP013-SQLCA                             
454818              SET DP013-DB2-ABEND                                         
454819                               TO TRUE                                    
454820              PERFORM DP013-0000-PROCESS-ABEND                            
454821     END-EVALUATE.                                                        
454822                                                                          
454823     IF  SQLCODE EQUAL +100                                               
454824         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                              
454825     END-IF.                                                              
454826                                                                          
454827 EJECT                                                                    
454828*----------------------------------------------------------------*        
454829*    OPEN THE LIST DETAIL CUSOR FOR SHIPPING UPDATE              *        
454830*----------------------------------------------------------------*        
454831                                                                          
454832 4320-OPEN-CURSOR.                                                        
454833     EXEC SQL                                                             
454834          OPEN TKT_OFFICE_CURSOR                                          
454835     END-EXEC.                                                            
454836                                                                          
454837     EVALUATE TRUE                                                        
454838         WHEN SQLCODE = ZERO                                              
454839              CONTINUE                                                    
454840         WHEN SQLWARN0 NOT = SPACE                                        
454841         WHEN SQLCODE NOT = ZERO                                          
454842              MOVE '4320-OPEN-CURSOR'                                     
454843                               TO DP013-PARAGRAPH                         
454844              MOVE 'OPEN TKT_OFFICE_CURSOR'                               
454845                               TO DP013-MESSAGE-TEXT (1)                  
454846              MOVE SQLCA       TO DP013-SQLCA                             
454847              SET DP013-DB2-ABEND                                         
454848                               TO TRUE                                    
454849              PERFORM DP013-0000-PROCESS-ABEND                            
454850     END-EVALUATE.                                                        
454851                                                                          
454852*----------------------------------------------------------------*        
454853*   CLOSE THE LIST DETAIL CUSOR FOR SHIPPING UPDATE              *        
454854*----------------------------------------------------------------*        
454855                                                                          
454856 4330-CLOSE-CURSOR.                                                       
454857     EXEC SQL                                                             
454858         CLOSE TKT_OFFICE_CURSOR                                          
454859     END-EXEC.                                                            
454860                                                                          
454861     EVALUATE TRUE                                                        
454862         WHEN SQLCODE = ZERO                                              
454863              CONTINUE                                                    
454864         WHEN SQLWARN0 NOT = SPACE                                        
454865         WHEN SQLCODE NOT = ZERO                                          
454866              MOVE '4330-CLOSE-CURSOR'                                    
454867                               TO DP013-PARAGRAPH                         
454868              MOVE 'CLOSE TKT_OFFICE_CURSOR'                              
454869                               TO DP013-MESSAGE-TEXT (1)                  
454870              MOVE SQLCA       TO DP013-SQLCA                             
454871              SET DP013-DB2-ABEND                                         
454872                               TO TRUE                                    
454873              PERFORM DP013-0000-PROCESS-ABEND                            
454874     END-EVALUATE.                                                        
454875                                                                          
454876 EJECT                                                                    
454877*----------------------------------------------------------------*        
454878*    CHECK IF THE TICKET FORMAT IS SET UP FOR THE SPECIFIED      *        
454879*    TICKET OFFICE.  IN AN UPDATE OR DELETE MODE, WE WILL        *        
454880*    DISPLAY ALL TICKET OFFICES, BUT SELECT ONLY THOSE THAT THE  *        
454881*    TICKET FORMAT IS SET UP FOR.                                *        
454882*----------------------------------------------------------------*        
454883                                                                          
454884 4340-COUNT-TTKTFMT.                                                      
454885                                                                          
454886     INITIALIZE PV-DB2-COUNT.                                             
454887                                                                          
454888     EXEC SQL                                                             
454889          SELECT                                                          
454890                 COUNT(*)                                                 
454891          INTO                                                            
454892                 :PV-DB2-COUNT                                            
454893          FROM                                                            
454894                 TTKTFMT                                                  
454895          WHERE                                                           
454896                 OPER_UNT_ID = :TKTFMT-OPER-UNT-ID                        
454897            AND  FCLTY_ID    = :TKTFMT-FCLTY-ID                           
454898            AND  TKT_FMT_ID  = :DK-TKT-FMT-ID                             
454899            AND  TKT_OFF_ID  = :TKTFMT-TKT-OFF-ID                         
454900     END-EXEC.                                                            
454901                                                                          
454902     EVALUATE TRUE                                                        
454903         WHEN SQLCODE = ZERO                                              
454904         WHEN SQLCODE = +100                                              
454905              CONTINUE                                                    
454906         WHEN SQLWARN0 NOT = SPACE                                        
454907         WHEN SQLCODE NOT = ZERO                                          
454908              MOVE '4340-COUNT-TTKTFMT'                                   
454909                               TO DP013-PARAGRAPH                         
454910              MOVE 'ERROR COUNTING TTKTFMT ROWS'                          
454911                               TO DP013-MESSAGE-TEXT (1)                  
454912              MOVE DK-TKT-FMT-ID                                          
454913                               TO DP013-MESSAGE-TEXT (2)                  
454914              MOVE TKTFMT-TKT-OFF-ID                                      
454915                               TO DP013-MESSAGE-TEXT (3)                  
454916              MOVE 'TTKTFMT'   TO DP013-DB2-TABLE-NAME (1)                
454917              MOVE SQLCA       TO DP013-SQLCA                             
454918              SET DP013-DB2-ABEND                                         
454919                               TO TRUE                                    
454920              PERFORM DP013-0000-PROCESS-ABEND                            
454921     END-EVALUATE.                                                        
454922                                                                          
454923     IF  SQLCODE EQUAL +100                                               
454924         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                              
454925     END-IF.                                                              
454926                                                                          
454927 EJECT                                                                    
454928*----------------------------------------------------------------*        
454929* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *        
454930*----------------------------------------------------------------*        
454931                                                                          
454932 4400-MOVE-COMMAREA-TO-SCREEN.                                            
454933     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                     
454934         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))                  
454935         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))                  
454936             MOVE +1    TO ASC-BLK-SUB                                    
454937             PERFORM 5100-WRITE-TEMP-STORAGE                              
454938             ADD +1     TO ASC-BLK-SUB                                    
454939             PERFORM 5100-WRITE-TEMP-STORAGE                              
454940             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     
454941                 GIVING PV-BLOCK-NUMBER                                   
454942                 REMAINDER PV-REMAINDER                                   
454943             IF  PV-REMAINDER > ZERO                                      
454944                 ADD +1 TO PV-BLOCK-NUMBER                                
454945             END-IF                                                       
454946             MOVE +1    TO ASC-BLK-SUB                                    
454947             PERFORM 4410-READ-TEMP-STORAGE                               
454948             ADD +1     TO ASC-BLK-SUB                                    
454949                           PV-BLOCK-NUMBER                                
454950             PERFORM 4410-READ-TEMP-STORAGE                               
454951     END-IF.                                                              
454952                                                                          
454953     MOVE +1            TO ASC-BLK-SUB.                                   
454954                                                                          
454955     COMPUTE ASC-ITEM-SUB =                                               
454956         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                      
454957         + PC-ITEMS-PER-PANEL).                                           
454958*                                                                         
454959     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
454960         ADD +1         TO ASC-BLK-SUB                                    
454961         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
454962     END-IF.                                                              
454963*                                                                         
454964     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                                   
454965         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                        
454966     PERFORM 4420-FORMAT-LIST-LINES                                       
454967         VARYING PV-SUB                                                   
454968         FROM PC-ITEMS-PER-PANEL BY -1                                    
454969         UNTIL PV-SUB < +1.                                               
454970*                                                                         
454971     COMPUTE ASC-ITEMS-DISPLAYED =                                        
454972         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).                  
454973     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL            
454974                                      ASTRTITO.                           
454975     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                            
454976     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                            
454977     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
454978                                   TO ATOTSELO.                           
454979                                                                          
454980     MOVE  ASC-KEY-TKT-FMT-ID      TO ATFIDO.                             
454981     MOVE  ASC-TKT-FMT-DESC        TO ATFDESCO.                           
454982     MOVE  ASC-TKT-FMT-TYP-CDE     TO AFTYCDEO.                           
454983     MOVE  ASC-PTICK-FMT-IND       TO APTICKO.                            
454984     MOVE  ASC-DISP-SIZE-IND       TO ASIZEO.                             
454985     MOVE  ASC-DISP-COLOR-IND      TO ACOLORO.                            
454986     MOVE  ASC-DISP-OPTBLK-TAG-IND TO AOPBLTGO.                           
454987     MOVE  ASC-DISP-OPTBLK-LBL-IND TO AOPBLLBO.                           
454988     MOVE  ASC-DISP-STKR-NBR-IND   TO ASTRNBRO.                           
454989     MOVE  ASC-PAPER-TYP-ID        TO APAPERO.                            
454990     MOVE  ASC-TKT-FMT-NBR         TO AFMTNBRO.                           
454991     MOVE  ASC-NBR-XTRA-TIX-N      TO AXTKTNBO.                           
454992     MOVE  ASC-PCT-XTRA-TIX-N      TO AXTKTPTO.                           
454993                                                                          
454994     IF  DP020-MSG-NUMBER-X = SPACE                                       
454995         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ          
454996*            --- MORE ITEMS TO DISPLAY ----                               
454997             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER                    
454998             SET DP020-MSG-INFORMATIONAL TO TRUE                          
454999         END-IF                                                           
455000     END-IF.                                                              
455001*----------------------------------------------------------------*        
455002*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *        
455003*----------------------------------------------------------------*        
455004                                                                          
455005 4410-READ-TEMP-STORAGE.                                                  
455006                                                                          
455007     EXEC CICS                                                            
455008         READQ TS                                                         
455009             QUEUE (ASC-LIST-QUEUE-NAME)                                  
455010             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
455011             ITEM  (PV-BLOCK-NUMBER)                                      
455012             RESP  (PV-CICS-RESP)                                         
455013     END-EXEC.                                                            
455014                                                                          
455015     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                               
455016       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                             
455017         CONTINUE                                                         
455018     ELSE                                                                 
455019         SET DP013-CICS-ABEND     TO TRUE                                 
455020         SET DP013-NO-ROLLBACK    TO TRUE                                 
455021         MOVE '4410-READ-TEMP-STORAGE'                                    
455022                                  TO DP013-PARAGRAPH                      
455023         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'              
455024                                  TO DP013-MESSAGE-TEXT(1)                
455025         PERFORM DP013-0000-PROCESS-ABEND                                 
455026     END-IF.                                                              
455027                                                                          
455028     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
455029*                                                                         
455030     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                                 
455031         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                       
455032     END-IF.                                                              
455033 EJECT                                                                    
455034*----------------------------------------------------------------*        
455035*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *        
455036*----------------------------------------------------------------*        
455037                                                                          
455038 4420-FORMAT-LIST-LINES.                                                  
455039     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ              
455040         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
455041         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           DPKCS036
455042         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           DPKCS036
455043         MOVE SPACE              TO MR-SELECT (PV-SUB)            DPKCS036
455044                                    MR-TKT-OFF-ID (PV-SUB)        DPKCS036
455050                                    MR-OPER-UNT-ID (PV-SUB)       DPKCS036
455100                                    MR-FCLTY-ID (PV-SUB)          DPKCS036
455101                                    MR-TKT-OFF-ADR-ID (PV-SUB)    DPKCS036
455102     ELSE                                                                 
455103         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
455104                                                   > SPACE        DPKCS036
455105             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
455106                                 TO MR-SELECT (PV-SUB)            DPKCS036
455107         ELSE                                                     DPKCS036
455108             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
455109                                 TO MR-SELECT (PV-SUB)            DPKCS036
455110         END-IF                                                   DPKCS036
455120*                                                                 DPKCS036
455130         IF  DP030-SET-CURSOR-TRAILER                             DPKCS036
455140             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
455150                 > SPACE)                                         DPKCS036
455160               OR (PV-SUB = 1))                                   DPKCS036
455170                SET DP030-SET-CURSOR-APPL-1 TO TRUE               DPKCS036
455180                MOVE -1          TO MR-SELECTL (PV-SUB)           DPKCS036
455190             END-IF                                               DPKCS036
455200         END-IF                                                   DPKCS036
455201*                                                                 DPKCS036
455202         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
455203             MOVE ASC-TKT-OFF-ID (ASC-BLK-SUB ASC-ITEM-SUB)       DPKCS036
455204                                 TO MR-TKT-OFF-ID (PV-SUB)        DPKCS036
455205             MOVE ASC-OPER-UNT-ID (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
455206                                 TO MR-OPER-UNT-ID (PV-SUB)       DPKCS036
455207             MOVE ASC-FCLTY-ID (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
455208                                 TO MR-FCLTY-ID (PV-SUB)          DPKCS036
455209             MOVE ASC-TKT-OFF-ADR-ID (ASC-BLK-SUB ASC-ITEM-SUB)   DPKCS036
455210                                 TO MR-TKT-OFF-ADR-ID (PV-SUB)    DPKCS036
455211         END-IF                                                           
455212     END-IF.                                                              
455213     SUBTRACT +1 FROM ASC-ITEM-SUB                                        
455214     IF  ASC-ITEM-SUB < + 1                                               
455215         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
455216         MOVE +1                 TO ASC-BLK-SUB                           
455217     END-IF.                                                              
455218 EJECT                                                                    
455219                                                                          
455220 EJECT                                                            DPKCS036
455230*----------------------------------------------------------------*DPKCS036
455240*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *DPKCS036
455250*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *DPKCS036
455260*----------------------------------------------------------------*DPKCS036
455270                                                                  DPKCS036
455280 5100-WRITE-TEMP-STORAGE.                                         DPKCS036
455290     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     DPKCS036
455300                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
455400     COMPUTE PV-BLOCK-NUMBER =                                    DPKCS036
455500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
455600                                                                  DPKCS036
455700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
455800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
455900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      DPKCS036
456000             PERFORM 5105-REWRITE-ASC-LISTQ                       DPKCS036
456100         END-IF                                                   DPKCS036
456200     ELSE                                                         DPKCS036
456300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       DPKCS036
456400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            DPKCS036
456500         PERFORM 5110-WRITE-ASC-LISTQ                             DPKCS036
456600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   DPKCS036
456700     END-IF.                                                      DPKCS036
456800                                                                  DPKCS036
456900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
457000******************************************************************DPKCS036
457100** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **DPKCS036
457200** SPECIFIC COMMAREA.                                           **DPKCS036
457300******************************************************************DPKCS036
457400 5105-REWRITE-ASC-LISTQ.                                          DPKCS036
457500     EXEC CICS                                                    DPKCS036
457600         WRITEQ TS                                                DPKCS036
457700             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
457800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
457900             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
458000             REWRITE                                              DPKCS036
458100             RESP  (PV-CICS-RESP)                                 DPKCS036
458200     END-EXEC.                                                    DPKCS036
458300                                                                  DPKCS036
458400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           DPKCS036
458500         CONTINUE                                                 DPKCS036
458600     ELSE                                                         DPKCS036
458700         SET DP013-CICS-ABEND            TO TRUE                  DPKCS036
458800         SET DP013-NO-ROLLBACK           TO TRUE                  DPKCS036
458900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       DPKCS036
459000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     DPKCS036
459100                                         TO DP013-MESSAGE-TEXT(1) DPKCS036
459200         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
459300     END-IF.                                                      DPKCS036
459400                                                                  DPKCS036
459500******************************************************************DPKCS036
459600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **DPKCS036
459700** SPECIFIC COMMAREA.                                           **DPKCS036
459800******************************************************************DPKCS036
459900 5110-WRITE-ASC-LISTQ.                                            DPKCS036
460000     EXEC CICS                                                    DPKCS036
460100         WRITEQ TS                                                DPKCS036
460200             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
460300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
460400             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
460500             RESP  (PV-CICS-RESP)                                 DPKCS036
460600     END-EXEC.                                                    DPKCS036
460700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      DPKCS036
460800         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
460900         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
461000         MOVE '5110-WRITE-ASC-LISTQ'                              DPKCS036
461100                                   TO DP013-PARAGRAPH             DPKCS036
461200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           DPKCS036
461300                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
461400         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
461500     END-IF.                                                      DPKCS036
461501 EJECT                                                            DPKCS036
461502*----------------------------------------------------------------*        
461503*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*        
461504*----------------------------------------------------------------*        
461505                                                                          
461506 6112-READ-LIST-QUEUE.                                                    
461507                                                                          
461508     EXEC CICS                                                            
461509         READQ TS                                                         
461510             QUEUE (ASC-LIST-QUEUE-NAME)                                  
461511             INTO  (LQW-LIST-QUEUE-WORK-AREA)                             
461512             ITEM  (PV-ITEM)                                              
461513             RESP  (PV-CICS-RESP)                                         
461514     END-EXEC.                                                            
461515*                                                                         
461516     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
461517         CONTINUE                                                         
461518     ELSE                                                                 
461519         SET DP013-CICS-ABEND        TO TRUE                              
461520         SET DP013-NO-ROLLBACK       TO TRUE                              
461521         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH                   
461522         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                            
461523                                     TO DP013-MESSAGE-TEXT(1)             
461524         PERFORM DP013-0000-PROCESS-ABEND                                 
461525     END-IF.                                                              
461526                                                                          
461527*--------------------------------------------------------------------*    
461528*  ADD ALL THE TICKET FORMAT INFORMATION TO THE TICKET FORMAT TABLES *    
461529*--------------------------------------------------------------------*    
461530                                                                          
461540 7000-ADD-TICKET-FORMAT.                                                  
461541                                                                          
461542     MOVE +1    TO ASC-BLK-SUB.                                           
461543     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
461544     ADD +1     TO ASC-BLK-SUB.                                           
461545     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
461546                                                                          
461548     INITIALIZE DCLTPRTSTK.                                               
461549     IF  ASC-TKT-FMT-TYP-CDE = 'E'                                        
461550         MOVE 'VENDOR'           TO PRTSTK-PAPER-TYPE-ID                  
461551                                    ASC-PAPER-TYP-ID-OLD                  
461552     ELSE                                                                 
461553         MOVE ASC-PAPER-TYP-ID   TO PRTSTK-PAPER-TYPE-ID                  
461554                                    ASC-PAPER-TYP-ID-OLD                  
461555     END-IF.                                                              
461556     MOVE ASC-PCT-XTRA-TIX-N     TO PRTSTK-EXTRA-TKTS-PCT.                
461560     MOVE ASC-NBR-XTRA-TIX-N     TO PRTSTK-EXTRA-TKTS-NBR.                
461570     MOVE 'L'                    TO PRTSTK-EXTRA-TKTS-PRT-CDE.            
461571     PERFORM 7010-INSERT-TPRTSTK                                          
461573                                                                          
461574     INITIALIZE DCLTTKTFMT.                                               
461575     MOVE ASC-KEY-TKT-FMT-ID     TO TKTFMT-TKT-FMT-ID.                    
461576     MOVE SPACES                 TO TKTFMT-TKT-OFF-DESC.                  
461577     MOVE ASC-TKT-FMT-DESC       TO TKTFMT-TKT-FMT-DESC.                  
461578     MOVE ASC-TKT-FMT-TYP-CDE    TO TKTFMT-TYP-CDE.                       
461579     MOVE ASC-DISP-OPTBLK-TAG-IND TO TKTFMT-OPT-BLK-TAGS-IND.             
461580     MOVE ASC-DISP-SIZE-IND      TO TKTFMT-PRT-SIZE-IND.                  
461581     MOVE ASC-DISP-COLOR-IND     TO TKTFMT-PRT-COLOR-IND.                 
461590     MOVE ' '                    TO TKTFMT-PRT-GP-PR-IND.                 
461600     MOVE +0                     TO TKTFMT-CMPANON-OP-UNT-ID              
461700                                    TKTFMT-CMPANON-FCLTY-ID.              
461800     MOVE SPACES                 TO TKTFMT-CMPANON-TKT-ID.                
461900     IF  ASC-TKT-FMT-TYP-CDE = 'E'                                        
461901         MOVE 'VENDOR'           TO TKTFMT-PAPER-TYP-ID                   
461902     ELSE                                                                 
461903         MOVE ASC-PAPER-TYP-ID   TO TKTFMT-PAPER-TYP-ID                   
461904     END-IF.                                                              
461910     MOVE ASC-TKT-FMT-NBR        TO TKTFMT-TKT-FMT-NBR.                   
462000     MOVE ASC-DISP-OPTBLK-LBL-IND TO TKTFMT-OPT-BLK-LBLS-IND.             
462100     MOVE ASC-DISP-STKR-NBR-IND  TO TKTFMT-STKR-NBR-REQ-IND.              
462200                                                                          
462210     SET PS-NO-ERROR             TO TRUE.                                 
462220                                                                          
462300     PERFORM 7020-INSERT-TTKTFMT                                          
462400         VARYING PV-ITEM                                          DPKCS036
462500         FROM 1 BY 1                                              DPKCS036
462600         UNTIL (PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN)              36
462601            OR (PS-ERROR).                                              36
462602                                                                          
462603*----------------------------------------------------------------*        
462604* INSERT THE PRINT STOCK ROW TO DB2.                             *        
462605*----------------------------------------------------------------*        
462606                                                                          
462607 7010-INSERT-TPRTSTK.                                                     
462608                                                                          
462609     EXEC SQL                                                             
462610         INSERT INTO TPRTSTK                                              
462611             ( PAPER_TYPE_ID                                              
462620              ,EXTRA_TKTS_PRT_CDE                                         
462630              ,EXTRA_TKTS_PCT                                             
462640              ,EXTRA_TKTS_NBR                                             
462650             )                                                            
462660         VALUES                                                           
462670             ( :PRTSTK-PAPER-TYPE-ID                                      
462680              ,:PRTSTK-EXTRA-TKTS-PRT-CDE                                 
462690              ,:PRTSTK-EXTRA-TKTS-PCT                                     
462700              ,:PRTSTK-EXTRA-TKTS-NBR      )                              
462800     END-EXEC.                                                            
462801                                                                          
462802     EVALUATE TRUE                                                        
462803         WHEN SQLCODE = ZERO                                              
462804              CONTINUE                                                    
462805         WHEN SQLCODE = -803                                              
462806              PERFORM 7011-UPDATE-TPRTSTK                                 
462807         WHEN SQLWARN0 NOT = SPACE                                        
462808         WHEN SQLCODE NOT = ZERO                                          
462809              MOVE '7010-INSERT-TPRTSTK'                                  
462810                               TO DP013-PARAGRAPH                         
462811              MOVE 'INSERT PRINT STOCK ROW'                               
462812                               TO DP013-MESSAGE-TEXT (1)                  
462813              MOVE PRTSTK-PAPER-TYPE-ID                                   
462814                               TO DP013-MESSAGE-TEXT (2)                  
462815              MOVE SQLCA       TO DP013-SQLCA                             
462816              SET DP013-DB2-ABEND                                         
462817                               TO TRUE                                    
462818              PERFORM DP013-0000-PROCESS-ABEND                            
462819     END-EVALUATE.                                                        
462820                                                                          
462821*----------------------------------------------------------------*        
462822* UPDATE THE PRINT STOCK ROW IS IT ALREADY EXISTS.               *        
462823*----------------------------------------------------------------*        
462824                                                                          
462825 7011-UPDATE-TPRTSTK.                                                     
462826                                                                          
462827     EXEC SQL                                                             
462828         UPDATE TPRTSTK                                                   
462829         SET EXTRA_TKTS_PRT_CDE = :PRTSTK-EXTRA-TKTS-PRT-CDE              
462830           , EXTRA_TKTS_PCT     = :PRTSTK-EXTRA-TKTS-PCT                  
462840           , EXTRA_TKTS_NBR     = :PRTSTK-EXTRA-TKTS-NBR                  
462850         WHERE                                                            
462860             ( PAPER_TYPE_ID    = :PRTSTK-PAPER-TYPE-ID)                  
462870     END-EXEC.                                                            
462871                                                                          
462872     EVALUATE TRUE                                                        
462873         WHEN SQLCODE = ZERO                                              
462874              CONTINUE                                                    
462875         WHEN SQLWARN0 NOT = SPACE                                        
462876         WHEN SQLCODE NOT = ZERO                                          
462877              MOVE '7011-UPDATE-TPRTSTK'                                  
462878                               TO DP013-PARAGRAPH                         
462879              MOVE 'UPDATE PRINT STOCK ROW'                               
462880                               TO DP013-MESSAGE-TEXT (1)                  
462881              MOVE PRTSTK-PAPER-TYPE-ID                                   
462882                               TO DP013-MESSAGE-TEXT (2)                  
462883              MOVE SQLCA       TO DP013-SQLCA                             
462884              SET DP013-DB2-ABEND                                         
462885                               TO TRUE                                    
462886              PERFORM DP013-0000-PROCESS-ABEND                            
462887     END-EVALUATE.                                                        
462888                                                                          
462889                                                                          
462890*----------------------------------------------------------------*        
462891* FOR EACH TICKET OFFICE SELECTED, ADD A ROWS TO DB2             *        
462892*----------------------------------------------------------------*        
462893                                                                          
462894 7020-INSERT-TTKTFMT.                                                     
462895                                                                          
462896     PERFORM 6112-READ-LIST-QUEUE.                                DPKCS036
462897                                                                  DPKCS036
462898     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       DPKCS036
462899         PERFORM                                                  DPKCS036
462900         VARYING LQW-IDX                                          DPKCS036
463000         FROM 1 BY 1                                              DPKCS036
463100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            DPKCS036
463200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          DPKCS036
463300                                                                  DPKCS036
463400             IF  LQW-SELECT (LQW-IDX)                             DPKCS036
463500                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                           
463600                                 TO TKTFMT-OPER-UNT-ID                    
463700                 MOVE LQW-FACILITY-ID (LQW-IDX)                           
463800                                 TO TKTFMT-FCLTY-ID                       
463900                 MOVE LQW-TKT-OFFICE (LQW-IDX)                            
464000                                 TO TKTFMT-TKT-OFF-ID                     
464100                 MOVE LQW-TKT-OFF-ADDRESS (LQW-IDX)                       
464200                                 TO TKTFMT-TKT-OFF-ADR-ID                 
464300                 PERFORM 7021-INSERT-TTKTFMT-ROW                          
464400             END-IF                                               DPKCS036
464500         END-PERFORM                                              DPKCS036
464600     END-IF.                                                      DPKCS036
464601                                                                  DPKCS036
464602*----------------------------------------------------------------*        
464603* INSERT THE TICKET FORMAT ROW TO DB2.                           *        
464604*----------------------------------------------------------------*        
464605                                                                          
464606 7021-INSERT-TTKTFMT-ROW.                                                 
464607                                                                          
464608     EXEC SQL                                                             
464609         INSERT INTO TTKTFMT                                              
464610             ( OPER_UNT_ID                                                
464620              ,FCLTY_ID                                                   
464630              ,TKT_OFF_ID                                                 
464640              ,TKT_FMT_ID                                                 
464650              ,TKT_OFF_DESC                                               
464660              ,TKT_FMT_DESC                                               
464670              ,TYP_CDE                                                    
464680              ,OPT_BLK_TAGS_IND                                           
464690              ,PRT_SIZE_IND                                               
464700              ,PRT_COLOR_IND                                              
464800              ,PRT_GP_PR_IND                                              
464900              ,CMPANON_OP_UNT_ID                                          
465000              ,CMPANON_FCLTY_ID                                           
465100              ,CMPANON_TKT_ID                                             
465200              ,PAPER_TYP_ID                                               
465300              ,OPT_BLK_LBLS_IND                                           
465400              ,STKR_NBR_REQ_IND                                           
465500              ,TKT_OFF_ADR_ID                                             
465510              ,TKT_FMT_NBR                                                
465600             )                                                            
465700         VALUES                                                           
465800             (                                                            
465900               :TKTFMT-OPER-UNT-ID                                        
466000             , :TKTFMT-FCLTY-ID                                           
466100             , :TKTFMT-TKT-OFF-ID                                         
466200             , :TKTFMT-TKT-FMT-ID                                         
466300             , :TKTFMT-TKT-OFF-DESC                                       
466400             , :TKTFMT-TKT-FMT-DESC                                       
466500             , :TKTFMT-TYP-CDE                                            
466600             , :TKTFMT-OPT-BLK-TAGS-IND                                   
466700             , :TKTFMT-PRT-SIZE-IND                                       
466800             , :TKTFMT-PRT-COLOR-IND                                      
466900             , :TKTFMT-PRT-GP-PR-IND                                      
467000             , :TKTFMT-CMPANON-OP-UNT-ID                                  
467100             , :TKTFMT-CMPANON-FCLTY-ID                                   
467200             , :TKTFMT-CMPANON-TKT-ID                                     
467300             , :TKTFMT-PAPER-TYP-ID                                       
467400             , :TKTFMT-OPT-BLK-LBLS-IND                                   
467500             , :TKTFMT-STKR-NBR-REQ-IND                                   
467600             , :TKTFMT-TKT-OFF-ADR-ID                                     
467610             , :TKTFMT-TKT-FMT-NBR                                        
467700             )                                                            
467800     END-EXEC.                                                            
467801                                                                          
467802     EVALUATE TRUE                                                        
467803         WHEN SQLCODE = ZERO                                              
467804              CONTINUE                                                    
467805         WHEN SQLCODE = -803                                              
467806              MOVE PC-TSYMSG-01490                                        
467807                               TO DP020-MSG-NUMBER                        
467808              MOVE -1          TO ATFIDL                                  
467809              MOVE DP015-REVERSE                                          
467810                               TO ATFIDH                                  
467811              MOVE DP015-RED   TO ATFIDC                                  
467812              MOVE DP015-UNP-ALP-BRT-OFF                                  
467813                               TO ATFIDA                                  
467814              SET DP030-SET-CURSOR-APPL-1                                 
467815                  DP020-MSG-FATAL                                         
467816                  PS-ERROR     TO TRUE                                    
467817              PERFORM 9102-ROLLBACK-CHANGES                               
467818         WHEN SQLWARN0 NOT = SPACE                                        
467819         WHEN SQLCODE NOT = ZERO                                          
467820              MOVE '7021-INSERT-TTKTFMT-ROW'                              
467821                               TO DP013-PARAGRAPH                         
467822              MOVE 'INSERT TICKET FORMAT ROW'                             
467823                               TO DP013-MESSAGE-TEXT (1)                  
467824              MOVE TKTFMT-OPER-UNT-ID                                     
467825                               TO PV-DISPLAY-COMP1                        
467826              MOVE TKTFMT-OPER-UNT-ID                                     
467827                               TO PV-DISPLAY-COMP2                        
467828              STRING PV-DISPLAY-COMP1   DELIMITED BY SIZE                 
467829              ,      ' - '              DELIMITED BY SIZE                 
467830              ,      PV-DISPLAY-COMP2   DELIMITED BY SIZE                 
467831              ,      ' - '              DELIMITED BY SIZE                 
467832              ,      TKTFMT-TKT-OFF-ID  DELIMITED BY SIZE                 
467833              ,      ' - '              DELIMITED BY SIZE                 
467834              ,      TKTFMT-TKT-FMT-ID  DELIMITED BY SIZE                 
467835                             INTO DP013-MESSAGE-TEXT (2)                  
467836              MOVE SQLCA       TO DP013-SQLCA                             
467837              SET DP013-DB2-ABEND                                         
467838                               TO TRUE                                    
467839              PERFORM DP013-0000-PROCESS-ABEND                            
467840     END-EVALUATE.                                                        
467841                                                                          
467842*----------------------------------------------------------------*        
467843* CHECK IF THE THE TICKET FORMAT THAT IS BEING ADDED IS A        *        
467844* DUPLICATE IN VENDOR STYLE MANAGEMENT (VSM).  MULTIPLE TICKET   *        
467845* FORMATS THAT ARE ACTIVE AND HAVE THE SAME DESCRIPTION SHOULD   *        
467846* NOT EXIST IN VSM.                                              *        
467847*----------------------------------------------------------------*        
467848                                                                          
467849 7025-CHECK-FOR-DUP-DESC.                                                 
467850                                                                          
467851     INITIALIZE DCLTVSCHVL.                                               
467860                                                                          
467870     EXEC SQL                                                             
467880         SELECT STAT_CDE                                                  
467890           INTO :VSCHVL-STAT-CDE                                          
467900           FROM TVSCHVL                                                   
468000          WHERE CHARTC_CDE      = :PC-PRETICKET-VSM-CODE                  
468100            AND CHARTC_VAL_DESC = :ASC-TKT-FMT-DESC                       
469000     END-EXEC.                                                            
469001                                                                          
469002     EVALUATE TRUE                                                        
469003         WHEN SQLCODE = ZERO                                              
469004         WHEN SQLCODE = +100                                              
469005              CONTINUE                                                    
469006         WHEN SQLWARN0 NOT = SPACE                                        
469007         WHEN SQLCODE NOT = ZERO                                          
469008              MOVE '7025-CHECK-FOR-DUP-DESC'                              
469009                               TO DP013-PARAGRAPH                         
469010              MOVE 'CHECKING TVSCHVL FOR DUPLICATE DESCRIPTION'           
469020                               TO DP013-MESSAGE-TEXT (1)                  
469021              MOVE ASC-TKT-FMT-DESC                                       
469022                               TO DP013-MESSAGE-TEXT (2)                  
469023              MOVE 'TVSCHVL '  TO DP013-DB2-TABLE-NAME (1)                
469024              MOVE SQLCA       TO DP013-SQLCA                             
469025              SET DP013-DB2-ABEND                                         
469026                               TO TRUE                                    
469027              PERFORM DP013-0000-PROCESS-ABEND                            
469028     END-EVALUATE.                                                        
469029                                                                          
469030*----------------------------------------------------------------*        
469031*    UPDATE THE TICKET TYPE CHARACTERISTIC VALUE                 *        
469032*----------------------------------------------------------------*        
469033 7027-UPDATE-TVSCHVL-TO-ACTIVE.                                           
469034                                                                          
469035     EXEC SQL                                                             
469036         UPDATE TVSCHVL                                                   
469037         SET   CHARTC_VAL_DESC = :ASC-TKT-FMT-DESC                        
469038           ,   STAT_CDE        = 'A'                                      
469039         WHERE CHARTC_CDE      = :PC-PRETICKET-VSM-CODE                   
469040           AND CHARTC_VAL_DESC = :ASC-TKT-FMT-DESC                        
469041     END-EXEC.                                                            
469042                                                                          
469043     EVALUATE TRUE                                                        
469044     WHEN  SQLCODE = +0                                                   
469047         CONTINUE                                                         
469048     WHEN OTHER                                                           
469049         MOVE '7027-UPDATE-TVSCHVL-TO-ACTIVE'                             
469050                           TO DP013-PARAGRAPH                             
469051         MOVE 'UPDATE THE THE VSM CHARACTERISTIC VALUE ROW'               
469052                           TO DP013-MESSAGE-TEXT (1)                      
469053         MOVE ASC-TKT-FMT-DESC                                            
469054                           TO DP013-MESSAGE-TEXT (2)                      
469057         MOVE 'TVSCHVL '   TO DP013-DB2-TABLE-NAME (1)                    
469058         MOVE SQLCA        TO DP013-SQLCA                                 
469059         SET DP013-DB2-ABEND                                              
469060             DP013-XCTL-DISPLAY-RESTART TO TRUE                           
469061         PERFORM DP013-0000-PROCESS-ABEND                                 
469062     END-EVALUATE.                                                        
469063                                                                          
469064 EJECT                                                                    
469065*----------------------------------------------------------------*        
469066* INSERT THE TICKET FORMAT ROW TO DB2.                           *        
469067*----------------------------------------------------------------*        
469068                                                                          
469069 7030-INSERT-TVSCHVL.                                                     
469070                                                                          
469071     INITIALIZE DCLTVSCHVL.                                               
469072                                                                          
469073     MOVE PC-PRETICKET-VSM-CODE                                           
469074                             TO VSCHVL-CHARTC-CDE.                        
469075     PERFORM 7031-GET-NEXT-SEQ-NBR                                        
469076     MOVE ASC-TKT-FMT-DESC   TO VSCHVL-CHARTC-VAL-DESC.                   
469077     MOVE 'A'                TO VSCHVL-STAT-CDE.                          
469078                                                                          
469079     EXEC SQL                                                             
469080         INSERT INTO TVSCHVL                                              
469081             ( CHARTC_CDE                                                 
469082              ,CHARTC_SEQ_NBR                                             
469083              ,CHARTC_VAL_DESC                                            
469084              ,STAT_CDE                                                   
469085             )                                                            
469086         VALUES                                                           
469087             (                                                            
469088              :VSCHVL-CHARTC-CDE                                          
469089            , :VSCHVL-CHARTC-SEQ-NBR                                      
469090            , :VSCHVL-CHARTC-VAL-DESC                                     
469091            , :VSCHVL-STAT-CDE                                            
469092             )                                                            
469093     END-EXEC.                                                            
469094                                                                          
469095     EVALUATE TRUE                                                        
469096         WHEN SQLCODE = ZERO                                              
469097         WHEN SQLCODE = -803                                              
469098              CONTINUE                                                    
469099         WHEN SQLWARN0 NOT = SPACE                                        
469100         WHEN SQLCODE NOT = ZERO                                          
469101              MOVE '7030-INSERT-TVSCHVL'                                  
469102                               TO DP013-PARAGRAPH                         
469103              MOVE 'INSERT VSM CHARACTERISTIC VALUE ROW'                  
469104                               TO DP013-MESSAGE-TEXT (1)                  
469105              MOVE VSCHVL-CHARTC-VAL-DESC                                 
469106                               TO DP013-MESSAGE-TEXT (2)                  
469107              MOVE SQLCA       TO DP013-SQLCA                             
469108              SET DP013-DB2-ABEND                                         
469109                               TO TRUE                                    
469110              PERFORM DP013-0000-PROCESS-ABEND                            
469111     END-EVALUATE.                                                        
469112                                                                          
469113*----------------------------------------------------------------*        
469114* SELECT THE MAX SEQ NUMBER AND ADD +1 TO GET THE NEXT ONE.      *        
469115*----------------------------------------------------------------*        
469116                                                                          
469117 7031-GET-NEXT-SEQ-NBR.                                                   
469118                                                                          
469119     EXEC SQL                                                             
469120         SELECT                                                           
469121               MAX(CHARTC_SEQ_NBR)                                        
469122         INTO                                                             
469123              :VSCHVL-CHARTC-SEQ-NBR                                      
469124         FROM                                                             
469125               TVSCHVL                                                    
469126         WHERE                                                            
469127               CHARTC_CDE = :PC-PRETICKET-VSM-CODE                        
469128     END-EXEC.                                                            
469129                                                                          
469130     EVALUATE TRUE                                                        
469131         WHEN SQLCODE = ZERO                                              
469132              ADD +1 TO VSCHVL-CHARTC-SEQ-NBR                             
469133         WHEN SQLWARN0 NOT = SPACE                                        
469134         WHEN SQLCODE NOT = ZERO                                          
469135              MOVE '7031-GET-NEXT-SEQ-NBR'                                
469136                               TO DP013-PARAGRAPH                         
469137              MOVE 'SELECT MAX SEQ NBR FOR FROM TVSCHVL'                  
469138                               TO DP013-MESSAGE-TEXT (1)                  
469139              MOVE SQLCA       TO DP013-SQLCA                             
469140              SET DP013-DB2-ABEND                                         
469141                               TO TRUE                                    
469142              PERFORM DP013-0000-PROCESS-ABEND                            
469143     END-EVALUATE.                                                        
469144                                                                          
469145*----------------------------------------------------------------*        
469146* DELETE ALL THE TICKET FORMAT INFORMATION                       *        
469147*----------------------------------------------------------------*        
469150                                                                          
469200 7100-DELETE-TICKET-FORMAT.                                               
469300                                                                          
469400     MOVE ASC-PAPER-TYP-ID-OLD   TO DK-PAPER-TYP-ID.                      
469500                                                                          
469501     PERFORM 7120-DELETE-TTKTFMT.                                         
469502                                                                          
469503     PERFORM 7110-DELETE-TPRTSTK.                                         
469504                                                                          
469505     PERFORM 7130-INACTIVATE-TVSCHVL.                                     
469506                                                                          
469507*----------------------------------------------------------------*        
469508*    DELETE THE PRINT STOCK ROWS FIRST                           *        
469509*----------------------------------------------------------------*        
469510                                                                          
469520 7110-DELETE-TPRTSTK.                                                     
469521                                                                          
469522     EXEC SQL                                                             
469523         DELETE FROM TPRTSTK                                              
469524         WHERE PAPER_TYPE_ID = :ASC-PAPER-TYP-ID-OLD                      
469525     END-EXEC.                                                            
469526                                                                          
469527     IF SQLCODE = +0                                                      
469528     OR SQLCODE = +100                                                    
469529     OR SQLCODE = -532                                                    
469530         CONTINUE                                                         
469531     ELSE                                                                 
469532         MOVE '7110-DELETE-TPRTSTK'                                       
469533                           TO DP013-PARAGRAPH                             
469534         MOVE 'DELETE THE PRINT STOCK INFORMATION'                        
469535                           TO DP013-MESSAGE-TEXT (1)                      
469536         MOVE 'TPRTSTK '   TO DP013-DB2-TABLE-NAME (1)                    
469537         MOVE SQLCA        TO DP013-SQLCA                                 
469538         SET DP013-DB2-ABEND                                              
469539             DP013-XCTL-DISPLAY-RESTART TO TRUE                           
469540         PERFORM DP013-0000-PROCESS-ABEND                                 
469541     END-IF.                                                              
469542                                                                          
469543*----------------------------------------------------------------*        
469544*    DELETE THE TICKET FORMAT ROWS                               *        
469545*----------------------------------------------------------------*        
469546                                                                          
469547 7120-DELETE-TTKTFMT.                                                     
469548                                                                          
469549     EXEC SQL                                                             
469550         DELETE FROM TTKTFMT                                              
469551         WHERE TKT_FMT_ID = :DK-TKT-FMT-ID                                
469552     END-EXEC.                                                            
469553                                                                          
469554     IF SQLCODE = +0                                                      
469555     OR SQLCODE = +100                                                    
469556         CONTINUE                                                         
469557     ELSE                                                                 
469558         MOVE '7120-DELETE-TTKTFMT'                                       
469559                           TO DP013-PARAGRAPH                             
469560         MOVE 'DELETE THE TICKET FORMAT INFORMATION'                      
469561                           TO DP013-MESSAGE-TEXT (1)                      
469562         MOVE DK-TKT-FMT-ID                                               
469563                           TO DP013-MESSAGE-TEXT (2)                      
469564         MOVE 'TTKTFMT '   TO DP013-DB2-TABLE-NAME (1)                    
469565         MOVE SQLCA        TO DP013-SQLCA                                 
469566         SET DP013-DB2-ABEND                                              
469567             DP013-XCTL-DISPLAY-RESTART TO TRUE                           
469568         PERFORM DP013-0000-PROCESS-ABEND                                 
469569     END-IF.                                                              
469570                                                                          
469571*------------------------------------------------------------------*      
469572*    DELETE THE VSM CHARACTERISTIC VALUE TABLE BY INACTIVATING IT  *      
469573*------------------------------------------------------------------*      
469574 7130-INACTIVATE-TVSCHVL.                                                 
469575                                                                          
469576     EXEC SQL                                                             
469577         UPDATE TVSCHVL                                                   
469578         SET   STAT_CDE = 'I'                                             
469579         WHERE CHARTC_CDE = :PC-PRETICKET-VSM-CODE                        
469580           AND CHARTC_VAL_DESC = :ASC-TKT-FMT-DESC-OLD                    
469581           AND STAT_CDE        = 'A'                                      
469582     END-EXEC.                                                            
469583                                                                          
469584     IF SQLCODE = +0                                                      
469585     OR SQLCODE = +100                                                    
469586         CONTINUE                                                         
469587     ELSE                                                                 
469588         MOVE '7130-INACTIVATE-TVSCHVL'                                   
469589                           TO DP013-PARAGRAPH                             
469590         MOVE 'INACTIVATE THE VSM CHARACTERISTIC VALUE ROW'               
469591                           TO DP013-MESSAGE-TEXT (1)                      
469592         MOVE ASC-TKT-FMT-DESC-OLD                                        
469593                           TO DP013-MESSAGE-TEXT (2)                      
469594         MOVE 'TVSCHVL '   TO DP013-DB2-TABLE-NAME (1)                    
469595         MOVE SQLCA        TO DP013-SQLCA                                 
469596         SET DP013-DB2-ABEND                                              
469597             DP013-XCTL-DISPLAY-RESTART TO TRUE                           
469598         PERFORM DP013-0000-PROCESS-ABEND                                 
469599     END-IF.                                                              
469600                                                                          
469601*----------------------------------------------------------------*        
469602* UPDATE THE TICKET FORMAT INFORMATION (FIRST DELETE ALL INFO,   *        
469603* THEN RE-INSERT PRINT STOCK ROW, AND ALL TICKET FORMAT ROWS.    *        
469604*----------------------------------------------------------------*        
469605                                                                          
469606 7200-UPDATE-TICKET-FORMAT.                                               
469607                                                                          
469608     PERFORM 7100-DELETE-TICKET-FORMAT.                                   
469609                                                                          
469610     PERFORM 7000-ADD-TICKET-FORMAT.                                      
469611                                                                          
469620     IF (ASC-PTICK-TKT-FMT) AND                                           
469621        (PS-NO-ERROR)                                                     
469622         PERFORM 7205-CHECK-FOR-DUP-DESC-UPD                              
469623         IF VSCHVL-STAT-CDE = 'I' OR ' '                                  
469630             PERFORM 7210-UPDATE-TVSCHVL                                  
469631         ELSE                                                             
469642             MOVE PC-DUP-TKT-FMT-MSG    TO DP020-MSG-MESSAGE              
469643             MOVE -1                    TO ATFDESCL                       
469645             MOVE DP015-REVERSE         TO ATFDESCH                       
469647             MOVE DP015-RED             TO ATFDESCC                       
469649             MOVE DP015-UNP-ALP-BRT-OFF TO ATFDESCA                       
469650             SET  DP030-SET-CURSOR-APPL-1                                 
469651                  DP020-MSG-FATAL                                         
469653                  PS-ERROR              TO TRUE                           
469654             PERFORM 9102-ROLLBACK-CHANGES                                
469655         END-IF                                                           
469656     END-IF.                                                              
469660                                                                          
469661*----------------------------------------------------------------*        
469662* CHECK IF THE THE TICKET FORMAT DESCRIPTION THAT IS BEING       *        
469663* UPDATED IS A DUPLICATE IN VENDOR STYLE MANAGEMENT (VSM).       *        
469664* MULTIPLE TICKET FORMAT DESCRIPTIONS THAT ARE ACTIVE SHOULD NOT *        
469665* NOT EXIST IN VSM.                                              *        
469666*----------------------------------------------------------------*        
469667                                                                          
469668 7205-CHECK-FOR-DUP-DESC-UPD.                                             
469669                                                                          
469670     INITIALIZE DCLTVSCHVL.                                               
469671                                                                          
469672     EXEC SQL                                                             
469673         SELECT STAT_CDE                                                  
469674           INTO :VSCHVL-STAT-CDE                                          
469675           FROM TVSCHVL                                                   
469676          WHERE CHARTC_CDE      = :PC-PRETICKET-VSM-CODE                  
469677            AND CHARTC_VAL_DESC = :ASC-TKT-FMT-DESC                       
469678     END-EXEC.                                                            
469679                                                                          
469680     EVALUATE TRUE                                                        
469681         WHEN SQLCODE = ZERO                                              
469682         WHEN SQLCODE = +100                                              
469683              CONTINUE                                                    
469684         WHEN SQLWARN0 NOT = SPACE                                        
469685         WHEN SQLCODE NOT = ZERO                                          
469686              MOVE '7205-CHECK-FOR-DUP-DESC-UPD'                          
469687                               TO DP013-PARAGRAPH                         
469688              MOVE 'CHECKING TVSCHVL FOR DUPLICATE DESCRIPTION'           
469689                               TO DP013-MESSAGE-TEXT (1)                  
469690              MOVE ASC-TKT-FMT-DESC                                       
469691                               TO DP013-MESSAGE-TEXT (2)                  
469692              MOVE 'TVSCHVL '  TO DP013-DB2-TABLE-NAME (1)                
469693              MOVE SQLCA       TO DP013-SQLCA                             
469694              SET DP013-DB2-ABEND                                         
469695                               TO TRUE                                    
469696              PERFORM DP013-0000-PROCESS-ABEND                            
469697     END-EVALUATE.                                                        
469698                                                                          
469699*----------------------------------------------------------------*        
469700*    UPDATE THE TICKET TYPE CHARACTERISTIC VALUE                 *        
469701*----------------------------------------------------------------*        
469702 7210-UPDATE-TVSCHVL.                                                     
469703                                                                          
469704     EXEC SQL                                                             
469705         UPDATE TVSCHVL                                                   
469706         SET   CHARTC_VAL_DESC = :ASC-TKT-FMT-DESC                        
469707           ,   STAT_CDE        = 'A'                                      
469708         WHERE CHARTC_CDE = :PC-PRETICKET-VSM-CODE                        
469709           AND CHARTC_VAL_DESC = :ASC-TKT-FMT-DESC-OLD                    
469710     END-EXEC.                                                            
469711                                                                          
469712     EVALUATE TRUE                                                        
469713     WHEN  SQLCODE = +0                                                   
469714         MOVE ASC-TKT-FMT-DESC TO ASC-TKT-FMT-DESC-OLD                    
469715     WHEN  SQLCODE = +100                                                 
469716         PERFORM 7030-INSERT-TVSCHVL                                      
469717     WHEN OTHER                                                           
469718         MOVE '7210-UPDATE-TVSCHVL'                                       
469719                           TO DP013-PARAGRAPH                             
469720         MOVE 'UPDATE THE THE VSM CHARACTERISTIC VALUE ROW'               
469721                           TO DP013-MESSAGE-TEXT (1)                      
469722         MOVE ASC-TKT-FMT-DESC-OLD                                        
469723                           TO DP013-MESSAGE-TEXT (2)                      
469724         MOVE ASC-TKT-FMT-DESC                                            
469725                           TO DP013-MESSAGE-TEXT (3)                      
469726         MOVE 'TVSCHVL '   TO DP013-DB2-TABLE-NAME (1)                    
469727         MOVE SQLCA        TO DP013-SQLCA                                 
469728         SET DP013-DB2-ABEND                                              
469729             DP013-XCTL-DISPLAY-RESTART TO TRUE                           
469730         PERFORM DP013-0000-PROCESS-ABEND                                 
469731     END-EVALUATE.                                                        
469732                                                                          
469733 EJECT                                                                    
469734*----------------------------------------------------------------*        
469735*    READ THE SELECTION QUEUE CREATED IN VLKCS518                *        
469736*----------------------------------------------------------------*        
469737                                                                          
469738 9100-READ-IN-SEL-QUEUE.                                                  
469739                                                                          
469740     EXEC CICS                                                            
469741          READQ TS                                                        
469742              QUEUE (ASC-SEL-QUEUE-NAME-IN)                               
469743              INTO  (VL014-TKT-FMT-SEL-REC)                               
469744              ITEM  (ASC-SEL-ITEM)                                        
469745              RESP  (PV-CICS-RESP)                                        
469746     END-EXEC.                                                            
469747*                                                                         
469748     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
469749         CONTINUE                                                         
469750     ELSE                                                                 
469751         SET DP013-CICS-ABEND      TO  TRUE                               
469752         SET DP013-NO-ROLLBACK     TO  TRUE                               
469753         MOVE '9100-READ-IN-SEL-QUEUE'                                    
469754                                   TO  DP013-PARAGRAPH                    
469755         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'                   
469756                                   TO  DP013-MESSAGE-TEXT(1)              
469757         PERFORM DP013-0000-PROCESS-ABEND                                 
469758     END-IF.                                                              
469759 EJECT                                                                    
469760                                                                          
469761*----------------------------------------------------------------*        
469762*  REWRITE THE SELECTION QUEUE CREATED IN VLKCS518               *        
469763*----------------------------------------------------------------*        
469764                                                                          
469765 9101-REWRITE-SEL-QUEUE.                                                  
469766                                                                          
469767     EXEC CICS                                                            
469768        WRITEQ TS                                                         
469769              QUEUE (ASC-SEL-QUEUE-NAME-IN)                               
469770              FROM  (VL014-TKT-FMT-SEL-REC)                               
469771              ITEM  (ASC-SEL-ITEM)                                        
469772              REWRITE                                                     
469773              RESP  (PV-CICS-RESP)                                        
469774     END-EXEC.                                                            
469775*                                                                         
469776     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
469777         CONTINUE                                                         
469778     ELSE                                                                 
469779         SET DP013-CICS-ABEND      TO  TRUE                               
469780         SET DP013-NO-ROLLBACK     TO  TRUE                               
469781         MOVE '9101-REWRITE-SEL-QUEUE'                                    
469782                                   TO  DP013-PARAGRAPH                    
469783         MOVE 'ATTEMPTING TO REWRITE THE SEL QUEUE'                       
469784                                   TO  DP013-MESSAGE-TEXT(1)              
469785         PERFORM DP013-0000-PROCESS-ABEND                                 
469786     END-IF.                                                              
469787 EJECT                                                                    
469788                                                                          
469789*----------------------------------------------------------------*        
469790*  ROLLBACK CHANGES IN THE CASE OF AN ERROR                      *        
469791*----------------------------------------------------------------*        
469792                                                                          
469793 9102-ROLLBACK-CHANGES.                                                   
469794                                                                          
469795     EXEC CICS                                                            
469796        SYNCPOINT ROLLBACK                                                
469797     END-EXEC.                                                            
469798*                                                                         
469799 EJECT                                                                    
469800                                                                          
469801*----------------------------------------------------------------*        
469802*    ABEND PROCESSOR MODULE                                      *        
469803*----------------------------------------------------------------*        
469810                                                                          
469900     COPY DPPD013.                                                        
