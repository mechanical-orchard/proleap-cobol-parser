      *----------------------------------------------------------       00010000
       IDENTIFICATION DIVISION.                                         00020000
      *----------------------------------------------------------       00030000
       PROGRAM-ID.    EIKUT004.                                         00040005
       AUTHOR.        KARI HAAK.                                        00050000
       DATE-WRITTEN.  MARCH 2011.                                       00060000
                                                                        00070000
      *----------------------------------------------------------       00080000
      *                                                                 00181000
      *----------------------------------------------------------       00220000
       ENVIRONMENT DIVISION.                                            00230000
      *----------------------------------------------------------       00240000
       CONFIGURATION SECTION.                                           00250000
       SOURCE-COMPUTER. IBM-3090.                                       00260000
       OBJECT-COMPUTER. IBM-3090.                                       00270000
                                                                        00280000
       INPUT-OUTPUT SECTION.                                            00290000
                                                                        00300000
       FILE-CONTROL.                                                    00310000
                                                                        00320000
           SELECT MW-YEAR-CONTROL-CARD                                  00486901
             ASSIGN TO INP01.                                           00488000
                                                                        00489000
           SELECT MW-POS-WAREHOUSE-FILE                                 00489101
             ASSIGN TO INP02.                                           00489201
                                                                        00489301
           SELECT MW-POS-WAREHSE-HISTORY                                00489401
             ASSIGN TO OUT01.                                           00489501
                                                                        00489601
      *----------------------------------------------------------       00490000
       DATA DIVISION.                                                   00500000
      *----------------------------------------------------------       00510000
       FILE SECTION.                                                    00520000
                                                                        00660000
       FD  MW-YEAR-CONTROL-CARD                                         00694001
           RECORDING MODE IS F                                          00695000
           BLOCK CONTAINS 0 RECORDS                                     00696000
           LABEL RECORDS ARE STANDARD.                                  00697000
       01  MW-YEAR-CONTROL-CARD-REC               PIC  X(80).           00698001
                                                                        00699000
       FD  MW-POS-WAREHOUSE-FILE                                        00699101
           RECORDING MODE IS F                                          00699201
           BLOCK CONTAINS 0 RECORDS                                     00699301
           LABEL RECORDS ARE STANDARD.                                  00699401
       01  MW-POS-WAREHOUSE-REC                   PIC  X(200).          00699501
                                                                        00699601
       FD  MW-POS-WAREHSE-HISTORY                                       00699701
           RECORDING MODE IS F                                          00699801
           BLOCK CONTAINS 0 RECORDS                                     00699901
           LABEL RECORDS ARE STANDARD.                                  00700001
       01  MW-POS-WAREHSE-HISTORY-REC             PIC  X(200).          00700101
                                                                        00700201
      *----------------------------------------------------------       00701000
       WORKING-STORAGE SECTION.                                         00710000
      *----------------------------------------------------------       00720000
       01  ABEND-CODE                             PIC S9(004)           00730000
                                                   VALUE +0             00740000
                                                   COMP.                00750000
                                                                        00850200
      *---------------------------------------------                    00854500
      * CC- CONTROL CARD                                                00854601
      *---------------------------------------------                    00854700
       01  CC-CONTROL-CARD.                                             00854901
           05  CC-CONTROL-CURR-YEAR          PIC X(04) VALUE SPACES.    00855001
           05  FILLER                        PIC X(01) VALUE SPACES.    00855101
           05  CC-CONTROL-LAST-YEAR          PIC X(04) VALUE SPACES.    00855201
           05  FILLER                        PIC X(01) VALUE SPACES.    00855301
           05  CC-CONTROL-CURR-MONTH         PIC X(02) VALUE SPACES.    00855401
           05  FILLER                        PIC X(01) VALUE SPACES.    00855501
           05  CC-CONTROL-PREV-MONTH         PIC X(02) VALUE SPACES.    00855601
           05  FILLER                        PIC X(65) VALUE SPACES.    00855701
                                                                        00855801
      *---------------------------------------------                    00855901
      * PA- PROGRAM ACCUMULATORS                                        00856001
      *---------------------------------------------                    00856101
       01  PA-PROGRAM-ACCUMULATORS.                                     00856201
           05  PA-INPUT-RECORDS-READ         PIC 9(10) VALUE ZEROES.    00856301
           05  PA-RECORD-COUNT               PIC 9(10) VALUE ZEROES.    00856401
           05  PA-OUTPUT-RECORDS-WRITTEN     PIC 9(10) VALUE ZEROES.    00856501
           05  PA-OLD-PRIC-AMT               PIC 9(10)V99.              00856601
           05  PA-NEW-PRIC-AMT               PIC 9(10)V99.              00856701
           05  PA-QTY                        PIC 9(10).                 00856801
           05  PA-DIFFER-AMT                 PIC S9(10)V99.             00856901
           05  PA-TOT-OLD-PRIC-AMT           PIC 9(10)V99.              00857001
           05  PA-TOT-NEW-PRIC-AMT           PIC 9(10)V99.              00857101
           05  PA-TOT-QTY                    PIC 9(10).                 00857201
           05  PA-TOT-DIFFER-AMT             PIC S9(10)V99.             00857301
                                                                        00857401
      *---------------------------------------------                    00857501
      * PC- PROGRAM CONSTANTS                                           00857601
      *---------------------------------------------                    00857701
       01  PC-PROGRAM-CONSTANTS.                                        00857801
         05  PC-PROGRAM-NAME                      PIC  X(008)           00857901
              VALUE 'EIKUT004'.                                         00858005
                                                                        00858100
      *---------------------------------------------                    00858200
      * PS- PROGRAM SWITCHES                                            00858300
      *---------------------------------------------                    00858400
       01  PS-PROGRAM-SWITCHES.                                         00858500
           05  PS-END-OF-FILE-SW               PIC X(1) VALUE 'N'.      00858600
               88 PS-END-OF-FILE               VALUE 'Y'.               00858700
               88 PS-NOT-END-OF-FILE           VALUE 'N'.               00858800
006900     05  PS-END-OF-CARDIN1-SWITCH     PIC  X(01) VALUE 'N'.       00858901
007000         88  PS-END-OF-CARDIN1                   VALUE 'Y'.       00859001
007100         88  PS-NOT-END-OF-CARDIN1               VALUE 'N'.       00859101
                                                                        00859200
      *---------------------------------------------                    00859300
      * PV- PROGRAM WORKING VARIABLES                                   00859400
      *---------------------------------------------                    00859500
       01  PV-PROGRAM-VARIABLES.                                        00859600
           05  PV-DATE.                                                 00859700
               10  PV-YEAR                     PIC X(4) VALUE SPACES.   00859800
               10  FILLER                      PIC X(1) VALUE '-'.      00859900
               10  PV-MONTH                    PIC X(2) VALUE SPACES.   00860000
               10  FILLER                      PIC X(1) VALUE '-'.      00860100
               10  PV-DAY                      PIC X(2) VALUE SPACES.   00861000
                                                                        00870000
      *---------------------------------------------                    00882600
      * MERCHANDISE LEDGER MARKDOWN/MARKON RECORD                       00882700
      * LAYOUT (ADDED FIELDS)                                           00882800
      *---------------------------------------------                    00882900
           COPY MLRD044.                                                00883000
                                                                        00884000
      *----------------------------------------------------------       00940000
       PROCEDURE DIVISION.                                              00950000
      *----------------------------------------------------------       00960000
       0000-MAINLINE.                                                   00970000
                                                                        00980000
           PERFORM 1000-INITIALIZE.                                     00990000
                                                                        01000000
           PERFORM 2000-ADD-YEAR                                        01010001
             UNTIL PS-END-OF-FILE                                       01020001
                OR PS-END-OF-CARDIN1.                                   01030001
                                                                        01032000
           PERFORM 9999-CLOSE-FILES.                                    01040000
                                                                        01050000
           GOBACK.                                                      01060000
                                                                        01070000
      *----------------------------------------------------------       01110000
      * 1000-INITIALIZE.                                                01120000
      *----------------------------------------------------------       01130000
       1000-INITIALIZE.                                                 01140000
                                                                        01150000
           OPEN INPUT  MW-YEAR-CONTROL-CARD.                            01160001
           OPEN INPUT  MW-POS-WAREHOUSE-FILE.                           01161001
           OPEN OUTPUT MW-POS-WAREHSE-HISTORY.                          01170003
                                                                        02760000
           PERFORM 1100-READ-CARDIN1.                                   02761001
           PERFORM 8010-READ-MKDN-FILE.                                 02790000
                                                                        02820000
      ******************************************************************02830001
      * READ INPUT CURRENT DATE CONTROL FILE.                           02840001
      ******************************************************************02850001
       1100-READ-CARDIN1.                                               02860001
                                                                        02870001
           READ MW-YEAR-CONTROL-CARD INTO CC-CONTROL-CARD               02880001
              AT END SET PS-END-OF-CARDIN1 TO TRUE                      02890001
           END-READ.                                                    02900001
                                                                        02910001
           IF PS-END-OF-CARDIN1                                         02920001
              DISPLAY 'CONTROL CARD IS EMPTY END OF FILE'               02930001
           END-IF.                                                      02990001
                                                                        03000001
      *----------------------------------------------------------       03330000
      * 2000-ADD-YEAR.                                                  03340001
      *----------------------------------------------------------       03350000
       2000-ADD-YEAR.                                                   03361001
                                                                        03370802
           IF CC-CONTROL-CURR-MONTH = '01' AND                          03370902
              ML044-PC-DTE-MM = '12'                                    03371004
               MOVE CC-CONTROL-LAST-YEAR TO ML044-PC-DTE-YEAR           03371102
           ELSE                                                         03371202
               MOVE CC-CONTROL-CURR-YEAR TO ML044-PC-DTE-YEAR           03371303
           END-IF.                                                      03371502
                                                                        03372001
           PERFORM 8030-WRITE-WAREHOUSE-REC                             03384301
           PERFORM 8010-READ-MKDN-FILE.                                 03520000
                                                                        03560000
      *----------------------------------------------------------       04509500
      * 8010-READ-MKDN-FILE.                                            04509600
      *----------------------------------------------------------       04509700
       8010-READ-MKDN-FILE.                                             04509800
                                                                        04509900
           READ MW-POS-WAREHOUSE-FILE INTO ML044-PRICE-CHANGE-RECORD    04511300
             AT END                                                     04511500
                 SET PS-END-OF-FILE TO TRUE                             04511600
           END-READ.                                                    04511800
                                                                        04512800
           IF PS-NOT-END-OF-FILE                                        04512900
               ADD +1 TO PA-INPUT-RECORDS-READ                          04513100
      *        DISPLAY 'READ RECORD:  ' PA-INPUT-RECORDS-READ           04513200
                                                                        04514000
      *    DISPLAY 'MM:'  ML044-PC-DTE-MM ' ' PV-HOLD-DTE-MM            04514100
      *    DISPLAY 'DD:'  ML044-PC-DTE-DD ' ' PV-HOLD-DTE-DD            04514200
      *    DISPLAY 'YR:'  ML044-PC-DTE-YEAR ' ' PV-HOLD-DTE-YEAR        04514300
      *    DISPLAY 'CT:'  ML044-PC-CATEG-CDE ' ' PV-HOLD-CATEG-CDE      04514400
      *    DISPLAY 'TYP'  ML044-PC-TYP-CDE ' ' PV-HOLD-TYP-CDE          04514500
      *    DISPLAY 'BTC'  ML044-PC-BATCH-NBR ' ' PV-HOLD-BATCH-NBR      04514600
      *    DISPLAY 'RSN' ML044-PC-MKDN-MKUP-RSN-CDE ' '                 04514700
      *                            TO PV-HOLD-MKDN-MKUP-RSN-CDE         04514800
           END-IF.                                                      04514900
                                                                        04515000
      *----------------------------------------------------------       04516800
      * 8030-WRITE-WAREHOUSE-REC.                                       04516900
      *----------------------------------------------------------       04517100
       8030-WRITE-WAREHOUSE-REC.                                        04517200
                                                                        04517300
             WRITE MW-POS-WAREHSE-HISTORY-REC                           04520403
                 FROM ML044-PRICE-CHANGE-RECORD.                        04520601
                                                                        04520800
             ADD +1 TO PA-OUTPUT-RECORDS-WRITTEN.                       04520900
                                                                        04521000
      *----------------------------------------------------------       04550300
      * 9999-CLOSE-FILES.                                               04550400
      *----------------------------------------------------------       04550500
       9999-CLOSE-FILES.                                                04550600
                                                                        04550700
           CLOSE MW-YEAR-CONTROL-CARD.                                  04550801
           CLOSE MW-POS-WAREHOUSE-FILE.                                 04550901
           CLOSE MW-POS-WAREHSE-HISTORY.                                04551003
                                                                        04552000
           DISPLAY '********************************************'.      04552100
           DISPLAY 'RECORDS READ:  '    PA-INPUT-RECORDS-READ.          04552200
           DISPLAY 'RECORDS WRITTEN:  ' PA-OUTPUT-RECORDS-WRITTEN.      04552300
           DISPLAY '********************************************'.      04552400
                                                                        04552600
