000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.      XLKUP086.                                       00020001
000300 AUTHOR.          LYNN MCADAMS.                                   00030001
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040001
000500 DATE-WRITTEN.    NOVEMBER, 2004.                                 00050001
000600 DATE-COMPILED.                                                   00060001
000700******************************************************************00070001
000800**XL DOMAIN TABLE UPDATE - UPDATE FOR TABLES:                     00080001
000900**                         XLT_PRCHG                              00090001
001000**                         XLT_STR_GP_PRCHG                       00100001
001100**                         XLT_PRCHG_MDSE                         00110001
001200******************************************************************00120001
001300**THIS PROGRAM USES THE PERMANENT PRICE CHANGE EXTRACTS           00130001
001400**TO UPDATE THE XL DOMAIN TABLES.                                 00140001
001500******************************************************************00150001
      * LOG                                                             00160021
      *     DAVE WELLER - 7/24/2012                                     00170021
      *                                                                 00180021
001500******************************************************************00190001
001600 ENVIRONMENT DIVISION.                                            00200001
001700 CONFIGURATION SECTION.                                           00210001
001800 SOURCE-COMPUTER.        IBM-3090.                                00220001
001900 OBJECT-COMPUTER.        IBM-3090.                                00230001
002000 INPUT-OUTPUT SECTION.                                            00240001
002100 FILE-CONTROL.                                                    00250001
002200                                                                  00260001
002300     SELECT INPUT-FILE                                            00270001
002400            ASSIGN TO INP01.                                      00280001
002500                                                                  00290001
      *PRB0060860-START                                                 00300021
002300     SELECT OUTPUT-FILE                                           00310001
002400            ASSIGN TO OUT01.                                      00320001
      *PRB0060860-END                                                   00330021
002600 DATA DIVISION.                                                   00340001
002700 FILE SECTION.                                                    00350001
002800                                                                  00360001
002900 FD  INPUT-FILE                                                   00370001
003000     RECORDING MODE F                                             00380001
003100     BLOCK CONTAINS 0 RECORDS                                     00390001
003200     LABEL RECORDS ARE OMITTED                                    00400001
003300     DATA RECORD IS INPUT-RECORD.                                 00410001
003400 01  INPUT-RECORD                    PIC X(110).                  00420001
      *PRB0060860-START                                                 00430021
002900 FD  OUTPUT-FILE                                                  00440001
003000     RECORDING MODE F                                             00450001
003100     BLOCK CONTAINS 0 RECORDS                                     00460001
003200     LABEL RECORDS ARE OMITTED                                    00470001
003300     DATA RECORD IS OUTPUT-RECORD.                                00480001
003400 01  OUTPUT-RECORD                   PIC X(110).                  00490001
      *PRB0060860-END                                                   00500021
003500                                                                  00510001
003600 WORKING-STORAGE SECTION.                                         00520001
003700******************************************************************00530001
003800**SWITCHES                                                        00540001
003900******************************************************************00550001
004000 01  PS-PROGRAM-SWITCHES.                                         00560001
004100     05  PS-END-OF-INPUT-FILE-SW         PIC X(01)   VALUE 'N'.   00570001
004200         88  PS-END-OF-INPUT-FILE                    VALUE 'Y'.   00580001
004300         88  PS-NOT-END-OF-INPUT-FILE                VALUE 'N'.   00590001
004400     05  PS-PRCHG-UPD-NF-SW              PIC X(01)   VALUE 'N'.   00600001
004500         88  PS-PRCHG-UPD-NF-YES                     VALUE 'Y'.   00610001
004600         88  PS-PRCHG-UPD-NF-NO                      VALUE 'N'.   00620001
004700     05  PS-STRGP-UPD-NF-SW              PIC X(01)   VALUE 'N'.   00630001
004800         88  PS-STRGP-UPD-NF-YES                     VALUE 'Y'.   00640001
004900         88  PS-STRGP-UPD-NF-NO                      VALUE 'N'.   00650001
005000     05  PS-MDSE-UPD-NF-SW               PIC X(01)   VALUE 'N'.   00660001
005100         88  PS-MDSE-UPD-NF-YES                      VALUE 'Y'.   00670001
005200         88  PS-MDSE-UPD-NF-NO                       VALUE 'N'.   00680001
005300                                                                  00690001
005400 01  DN-NULL-INDICATORS.                                          00700001
005500     05  DN-PRCHG-DESC                PIC S9(04) COMP VALUE +0.   00710001
005600     05  DN-DEPT-NBR                  PIC S9(04) COMP VALUE +0.   00720001
005700     05  DN-ALL-RMNG-STR-IND          PIC S9(04) COMP VALUE +0.   00730001
005800     05  DN-SUBMTD-BY-USR-ID          PIC S9(04) COMP VALUE +0.   00740001
005900     05  DN-SUBMTD-TMST               PIC S9(04) COMP VALUE +0.   00750001
006000     05  DN-APP-BY-USR-ID             PIC S9(04) COMP VALUE +0.   00760001
006100     05  DN-APP-TMST                  PIC S9(04) COMP VALUE +0.   00770001
006200     05  DN-MAJ-CL-NBR                PIC S9(04) COMP VALUE +0.   00780001
006300     05  DN-SUB-CL-NBR                PIC S9(04) COMP VALUE +0.   00790001
006400     05  DN-STYL-ID                   PIC S9(04) COMP VALUE +0.   00800001
006500     05  DN-SKU-NBR                   PIC S9(04) COMP VALUE +0.   00810001
006600     05  DN-UNT-RTL-AMT               PIC S9(04) COMP VALUE +0.   00820001
006700     05  DN-GP-PRIC-ID                PIC S9(04) COMP VALUE +0.   00830001
006800     05  DN-GP-RTL-QTY                PIC S9(04) COMP VALUE +0.   00840001
006900     05  DN-GP-RTL-AMT                PIC S9(04) COMP VALUE +0.   00850001
007000     05  DN-CLR-TYP-CDE               PIC S9(04) COMP VALUE +0.   00860001
007100     05  DN-PRICG-GRID-ID             PIC S9(04) COMP VALUE +0.   00870001
006600     05  DN-PREV-UNT-RTL-AMT          PIC S9(04) COMP VALUE +0.   00880001
007200                                                                  00890001
007300 01  PC-PROGRAM-CONSTANTS.                                        00900001
007400     05  PC-CURRENT-PROGRAM-NAME         PIC X(08)                00910001
007500                                        VALUE 'XLKUP086'.         00920001
007600     05  PC-TABLE-NAME-1                 PIC X(18)                00930001
007700                                        VALUE 'XLT_PRCHG'.        00940001
007800     05  PC-TABLE-NAME-2                 PIC X(18)                00950001
007900                                        VALUE 'XLT_STR_GP_PRCHG'. 00960001
008000     05  PC-TABLE-NAME-3                 PIC X(18)                00970001
008100                                        VALUE 'XLT_PRCHG_MDSE'.   00980001
008200 01  PA-PROGRAM-COUNTERS COMP-3.                                  00990003
008300     05  PA-INPUT-RECS-READ              PIC S9(11) VALUE ZEROS.  01000003
008400                                                                  01010001
008500     05  PA-PRCHG-RECS-INSERTED          PIC S9(11) VALUE ZEROS.  01020002
008600     05  PA-STRGP-RECS-INSERTED          PIC S9(11) VALUE ZEROS.  01030002
008700     05  PA-MDSE-RECS-INSERTED           PIC S9(11) VALUE ZEROS.  01040002
008800                                                                  01050001
008900     05  PA-PRCHG-RECS-UPDATED           PIC S9(11) VALUE ZEROS.  01060002
009000     05  PA-STRGP-RECS-UPDATED           PIC S9(11) VALUE ZEROS.  01070002
009100     05  PA-MDSE-RECS-UPDATED            PIC S9(11) VALUE ZEROS.  01080003
009200                                                                  01090001
009300     05  PA-PRCHG-RECS-DELETED           PIC S9(11) VALUE ZEROS.  01100003
009400     05  PA-STRGP-RECS-DELETED           PIC S9(11) VALUE ZEROS.  01110003
009500     05  PA-MDSE-RECS-DELETED            PIC S9(11) VALUE ZEROS.  01120003
009600                                                                  01130001
009700     05  PA-DEL-RECS-PRCHG-COUNT         PIC S9(11) VALUE ZEROS.  01140003
009800     05  PA-DEL-RECS-STRGP-COUNT         PIC S9(11) VALUE ZEROS.  01150003
009900     05  PA-DEL-RECS-MDSE-COUNT          PIC S9(11) VALUE ZEROS.  01160003
010000                                                                  01170001
010100     05  PA-COMMIT-COUNTER               PIC S9(11) VALUE ZEROS.  01180003
010200                                                                  01190001
010300     05  PA-UPD-PRCHG-NF-RECS            PIC S9(11) VALUE ZEROS.  01200003
010400     05  PA-UPD-STRGP-NF-RECS            PIC S9(11) VALUE ZEROS.  01210003
010500     05  PA-UPD-MDSE-NF-RECS             PIC S9(11) VALUE ZEROS.  01220003
010600                                                                  01230001
010700     05  PA-DEL-PRCHG-NF-RECS            PIC S9(11) VALUE ZEROS.  01240003
010800     05  PA-DEL-STRGP-NF-RECS            PIC S9(11) VALUE ZEROS.  01250003
010900     05  PA-DEL-MDSE-NF-RECS             PIC S9(11) VALUE ZEROS.  01260003
011000                                                                  01270001
011100     05  PA-PRCHG-DUP-RECS               PIC S9(11) VALUE ZEROS.  01280003
011200     05  PA-STRGP-DUP-RECS               PIC S9(11) VALUE ZEROS.  01290003
011300     05  PA-MDSE-DUP-RECS                PIC S9(11) VALUE ZEROS.  01300003
011400                                                                  01310001
011500     05  PA-532-RECS                     PIC S9(11) VALUE ZEROS.  01320003
011600                                                                  01330003
011700                                                                  01340003
011800***INPUT FILE LAYOUT - XL UPDATE FILE FORMAT                      01350001
011900     COPY XLRD054.                                                01360001
012000***VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        01370001
012100     COPY DPWS004.                                                01380001
012200***DB2 ABEND COPYBOOK                                             01390001
012300     COPY DPWS900.                                                01400001
012400***DB2 MESSAGE AREA                                               01410001
012500     COPY SQLCA2.                                                 01420001
012600***KOHLS CALENDAR ROUTINE                                         01430001
012700*    COPY DPWS500.                                                01440003
012800                                                                  01450003
012900***DB2 COMMUNICATIONS AREA                                        01460001
013000     EXEC SQL                                                     01470001
013100          INCLUDE SQLCA                                           01480001
013200     END-EXEC.                                                    01490001
013300***TABLE XLT_PRCHG                                                01500001
013400     EXEC SQL                                                     01510001
013500          INCLUDE XLT00032                                        01520001
013600     END-EXEC.                                                    01530001
013700***TABLE XLT_STR_GP_PRCHG                                         01540001
013800     EXEC SQL                                                     01550001
013900          INCLUDE XLT00033                                        01560001
014000     END-EXEC.                                                    01570001
014100***TABLE XLT_PRCHG_MDSE                                           01580001
014200     EXEC SQL                                                     01590001
014300          INCLUDE XLT00034                                        01600001
014400     END-EXEC.                                                    01610001
014500******************************************************************01620001
014600**ERROR HANDLING                                                  01630001
014700******************************************************************01640001
014800 01  PV-MISC-ABEND-FIELDS.                                        01650001
014900     05  PV-PARAGRAPH-NAME               PIC X(30) VALUE SPACE.   01660001
015000     05  PV-OPERATION-MSG-1              PIC X(40) VALUE SPACE.   01670001
015100     05  PV-OPERATION-MSG-2              PIC X(40) VALUE SPACE.   01680001
015200     05  PV-OPERATION-MSG-3              PIC X(40) VALUE SPACE.   01690001
015300     05  PV-OPERATION-MSG-4              PIC X(40) VALUE SPACE.   01700001
015400     05  PV-DB2-OPERATION                PIC X(30) VALUE SPACE.   01710001
015500                                                                  01720001
015600     05  PV-DISPLAY-PRCHG-ID            PIC  9(09) VALUE ZEROES.  01730001
015700     05  PV-DISPLAY-STR-GP-TYP-CDE      PIC  9(04) VALUE ZEROES.  01740001
015800     05  PV-DISPLAY-STR-GP-ID           PIC  9(04) VALUE ZEROES.  01750001
015900     05  PV-DISPLAY-PRCHG-MDSE-ID       PIC  9(09) VALUE ZEROES.  01760001
016000                                                                  01770001
016100 01  PV-STUFF.                                                    01780003
016200     05 SD-TIMESTAMP                     PIC  X(26)  VALUE SPACES.01790003
016300     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZZ,ZZ9.        01800021
016400     05  PV-PRCHG-COUNT               PIC S9(09) COMP VALUE ZERO. 01810021
016500     05  PV-STR-GP-COUNT              PIC S9(09) COMP VALUE ZERO. 01820021
016600     05  PV-PRCHG-MDSE-COUNT          PIC S9(09) COMP VALUE ZERO. 01830021
016700                                                                  01840003
016800 01  ABEND-CODE                          PIC S9(4) VALUE ZEROS    01850001
016900                                                   COMP SYNC.     01860001
017000     88  ABEND-4001-WRITE-ERROR            VALUE +4001.           01870001
017100     88  ABEND-4002-READ-ERROR             VALUE +4002.           01880001
017200     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           01890001
017300     88  ABEND-4004-TABLE-ERROR            VALUE +4004.           01900001
017400     88  ABEND-4005-OPEN-ERROR             VALUE +4005.           01910001
017500     88  ABEND-4006-CLOSE-ERROR            VALUE +4006.           01920001
017600     88  ABEND-4007-SEQUENCE-ERROR         VALUE +4007.           01930001
017700     88  ABEND-4008-DATA-ERROR             VALUE +4008.           01940001
017800     88  ABEND-4009-KEY-DATA-ERROR         VALUE +4009.           01950001
017900     88  ABEND-4013-DB2-ERROR              VALUE +4013.           01960001
018000     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           01970001
018100     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           01980001
018200                                                                  01990001
018300 PROCEDURE DIVISION.                                              02000001
018400                                                                  02010001
018500     PERFORM 1000-INITIALIZATION.                                 02020001
018600     PERFORM 2000-PROCESS-RECORDS                                 02030001
018700             UNTIL PS-END-OF-INPUT-FILE.                          02040001
018800     PERFORM 9999-WRAPUP.                                         02050001
018900     GOBACK.                                                      02060001
019000                                                                  02070001
019100 EJECT.                                                           02080001
019200                                                                  02090001
019300******************************************************************02100001
019400**INITIALIZATION AREA                                             02110001
019500******************************************************************02120001
019600 1000-INITIALIZATION.                                             02130001
019700                                                                  02140001
019800     MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME.             02150001
019900                                                                  02160001
020000     OPEN INPUT INPUT-FILE.                                       02170001
      *PRB0060860-START                                                 02180021
020000     OPEN OUTPUT OUTPUT-FILE.                                     02190001
      *PRB0060860-END                                                   02200021
020100                                                                  02210001
020200     PERFORM 1100-SELECT-DB2-TIME.                                02220001
020300                                                                  02230001
020400     PERFORM 8000-READ-INPUT-FILE.                                02240001
020500                                                                  02250001
020600 EJECT.                                                           02260001
020700                                                                  02270001
020800******************************************************************02280001
020900**RETRIEVE TIME FROM DB2                                          02290001
021000******************************************************************02300001
021100 1100-SELECT-DB2-TIME.                                            02310001
021200                                                                  02320001
021300     MOVE '1100-SELECT-DB2-TIME' TO PV-PARAGRAPH-NAME.            02330001
021400                                                                  02340001
021500     EXEC SQL                                                     02350001
021600          SELECT CURRENT TIMESTAMP                                02360001
021700          INTO  :SD-TIMESTAMP                                     02370001
021800          FROM   SYSIBM.SYSDUMMY1                                 02380001
021900     END-EXEC.                                                    02390001
022000                                                                  02400001
022100     IF  SQLCODE NOT EQUAL ZERO                                   02410001
022200         PERFORM 9999-ABEND-ROUTINE                               02420001
022300     END-IF.                                                      02430001
022400                                                                  02440001
022500 EJECT.                                                           02450001
022600                                                                  02460001
022700******************************************************************02470001
022800**PROCESSES INPUT FILE                                            02480001
022900******************************************************************02490001
023000 2000-PROCESS-RECORDS.                                            02500001
023100                                                                  02510001
023200     MOVE '2000-PROCESS-RECORDS' TO PV-PARAGRAPH-NAME.            02520001
023300                                                                  02530001
023400*    EVALUATE TRUE                                                02540001
023500*    WHEN XL054-PRCH                                              02550001
023600*       PERFORM 2500-MOVE-PRCHG-DATA                              02560001
023700*                                                                 02570001
023800*       EVALUATE TRUE                                             02580001
023900*       WHEN XL054-INSERT                                         02590001
024000*        AND XL054-SORT-SEQUENCE = '01'                           02600001
024100*            PERFORM 2100-INSERT-PRCHG-ROW                        02610001
024200*       WHEN XL054-UPDATE                                         02620001
024300*        AND XL054-SORT-SEQUENCE = '04'                           02630001
024400*            PERFORM 2200-UPDATE-PRCHG-ROW                        02640001
024500*       WHEN XL054-DELETE                                         02650001
024600*        AND XL054-SORT-SEQUENCE = '09'                           02660001
024700*            PERFORM 2300-DELETE-PRCHG-ROW                        02670001
024800*       END-EVALUATE                                              02680001
024900*                                                                 02690001
025000*    WHEN XL054-STR-GP-PRCHG                                      02700001
025100*       PERFORM 3500-MOVE-STRGP-DATA                              02710001
025200*                                                                 02720001
025300*       EVALUATE TRUE                                             02730001
025400*       WHEN XL054-INSERT                                         02740001
025500*        AND XL054-SORT-SEQUENCE = '02'                           02750001
025600*            PERFORM 3100-INSERT-STRGP-ROW                        02760001
025700*       WHEN XL054-UPDATE                                         02770001
025800*        AND XL054-SORT-SEQUENCE = '05'                           02780001
025900*            PERFORM 3200-UPDATE-STRGP-ROW                        02790001
026000*       WHEN XL054-DELETE                                         02800001
026100*        AND XL054-SORT-SEQUENCE = '08'                           02810001
026200*            PERFORM 3300-DELETE-STRGP-ROW                        02820001
026300*       END-EVALUATE                                              02830001
026400*                                                                 02840001
026500*    WHEN XL054-PRCH-MDSE                                         02850001
026600*       PERFORM 4500-MOVE-MDSE-DATA                               02860001
026700*                                                                 02870001
026800*       EVALUATE TRUE                                             02880001
026900*       WHEN XL054-INSERT                                         02890001
027000*        AND XL054-SORT-SEQUENCE = '03'                           02900001
027100*            PERFORM 4100-INSERT-MDSE-ROW                         02910001
027200*       WHEN XL054-UPDATE                                         02920001
027300*        AND XL054-SORT-SEQUENCE = '06'                           02930001
027400*            PERFORM 4200-UPDATE-MDSE-ROW                         02940001
027500*       WHEN XL054-DELETE                                         02950001
027600*        AND XL054-SORT-SEQUENCE = '07'                           02960001
027700*            PERFORM 4300-DELETE-MDSE-ROW                         02970001
027800*       END-EVALUATE                                              02980001
027900*                                                                 02990001
028000*    WHEN OTHER                                                   03000001
028100*       PERFORM 9999-DISPLAY-STATISTICS                           03010001
028200*       PERFORM 9999-ABEND-ROUTINE                                03020001
028300*    END-EVALUATE.                                                03030001
028400                                                                  03040001
028500     EVALUATE TRUE                                                03050001
028600*        XLT_PRCHG                                                03060021
028700         WHEN XL054-SORT-SEQUENCE = '01'                          03070001
028800             PERFORM 2500-MOVE-PRCHG-DATA                         03080001
028900             PERFORM 2100-INSERT-PRCHG-ROW                        03090001
029000         WHEN XL054-SORT-SEQUENCE = '04'                          03100001
029100             PERFORM 2500-MOVE-PRCHG-DATA                         03110001
029200             PERFORM 2200-UPDATE-PRCHG-ROW                        03120001
029300         WHEN XL054-SORT-SEQUENCE = '09'                          03130001
029400             PERFORM 2500-MOVE-PRCHG-DATA                         03140001
029500             PERFORM 2300-DELETE-PRCHG-ROW                        03150001
029600                                                                  03160001
029700                                                                  03170001
029800*        XLT_STR_GP_PRCHG                                         03180021
029900         WHEN XL054-SORT-SEQUENCE = '02'                          03190001
030000             PERFORM 3500-MOVE-STRGP-DATA                         03200001
030100             PERFORM 3100-INSERT-STRGP-ROW                        03210001
030200         WHEN XL054-SORT-SEQUENCE = '05'                          03220001
030300             PERFORM 3500-MOVE-STRGP-DATA                         03230001
030400             PERFORM 3200-UPDATE-STRGP-ROW                        03240001
030500         WHEN XL054-SORT-SEQUENCE = '08'                          03250001
030600             PERFORM 3500-MOVE-STRGP-DATA                         03260001
030700             PERFORM 3300-DELETE-STRGP-ROW                        03270001
030800                                                                  03280001
030900*        XLT_PRCHG_MDSE                                           03290021
031000         WHEN XL054-SORT-SEQUENCE = '03'                          03300001
031100             PERFORM 4500-MOVE-MDSE-DATA                          03310001
031200             PERFORM 4100-INSERT-MDSE-ROW                         03320001
031300         WHEN XL054-SORT-SEQUENCE = '06'                          03330001
031400             PERFORM 4500-MOVE-MDSE-DATA                          03340001
031500             PERFORM 4200-UPDATE-MDSE-ROW                         03350001
031600         WHEN XL054-SORT-SEQUENCE = '07'                          03360001
031700             PERFORM 4500-MOVE-MDSE-DATA                          03370001
031800             PERFORM 4300-DELETE-MDSE-ROW                         03380001
031900                                                                  03390001
032000         WHEN OTHER                                               03400001
032100             PERFORM 9999-DISPLAY-STATISTICS                      03410001
032200             PERFORM 9999-ABEND-ROUTINE                           03420001
032300     END-EVALUATE.                                                03430001
032400                                                                  03440001
032500     IF  PA-COMMIT-COUNTER >= 5000                                03450003
032600         PERFORM 9999-COMMIT-DATA                                 03460001
032700         INITIALIZE PA-COMMIT-COUNTER                             03470003
032800     END-IF.                                                      03480001
032900                                                                  03490001
033000     PERFORM 8000-READ-INPUT-FILE.                                03500001
033100/                                                                 03510021
033200                                                                  03520001
033300***************************************************************** 03530001
033400**INSERT ROW INTO TABLE XLT_PRCHG                                 03540001
033500***************************************************************** 03550001
033600 2100-INSERT-PRCHG-ROW.                                           03560001
033700                                                                  03570001
033800     MOVE '2100-INSERT-PRCHG-ROW' TO PV-PARAGRAPH-NAME.           03580001
033900                                                                  03590001
034000     EXEC SQL                                                     03600001
034100       INSERT INTO XLT_PRCHG         (PRCHG_ID                    03610001
034200                                     ,PRCHG_ST_CDE                03620001
                                           ,PRCHG_TYP_CDE               03630021
034300                                     ,LAST_UPD_TMST               03640001
034400                                     ,LAST_ACTN_CDE)              03650001
034500                             VALUES (:XLT00032-PRCHG-ID           03660001
034600                                    ,:XLT00032-PRCHG-ST-CDE       03670001
                                          ,:XLT00032-PRCHG-TYP-CDE      03680021
034700                                    ,:XLT00032-LAST-UPD-TMST      03690001
034800                                    ,:XLT00032-LAST-ACTN-CDE)     03700001
034900     END-EXEC.                                                    03710001
035000                                                                  03720001
035100     EVALUATE TRUE                                                03730001
035200        WHEN SQLCODE = ZERO                                       03740001
035300*            DISPLAY 'INSERT ' XLT00032-PRCHG-ID                  03750001
035400             ADD +1                TO PA-PRCHG-RECS-INSERTED      03760002
035500             ADD +1                TO PA-COMMIT-COUNTER           03770003
035600        WHEN SQLCODE = -803                                       03780001
035700             ADD +1                TO PA-PRCHG-DUP-RECS           03790003
      *PRB0060860-START                                                 03800021
                   PERFORM 9000-WRITE-OUTPUT-RECORD                     03810021
      *PRB0060860-END                                                   03820021
035800        WHEN OTHER                                                03830001
035900             MOVE XLT00032-PRCHG-ID TO PV-DISPLAY-PRCHG-ID        03840001
036000             DISPLAY 'TRYING TO INSERT XLT_PRCHG '                03850001
036100             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  03860001
036200                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  03870001
036300                                      INTO PV-OPERATION-MSG-1     03880001
036400             PERFORM 9999-DISPLAY-STATISTICS                      03890001
036500             PERFORM 9999-ABEND-ROUTINE                           03900001
036600     END-EVALUATE.                                                03910001
036700                                                                  03920001
036800 EJECT.                                                           03930001
036900                                                                  03940001
037000***************************************************************** 03950001
037100**UPDATE ROW INTO TABLE XLT_PRCHG                                 03960001
037200***************************************************************** 03970001
037300 2200-UPDATE-PRCHG-ROW.                                           03980001
037400                                                                  03990001
037500     MOVE '2200-UPDATE-PRCHG-ROW' TO PV-PARAGRAPH-NAME.           04000001
037600                                                                  04010001
037700     EXEC SQL                                                     04020001
037800          UPDATE XLT_PRCHG                                        04030001
037900             SET                                                  04040000
038000              PRCHG_ST_CDE       = :XLT00032-PRCHG-ST-CDE         04050000
                   ,PRCHG_TYP_CDE      = :XLT00032-PRCHG-TYP-CDE        04060021
038100             ,LAST_UPD_TMST      = :XLT00032-LAST-UPD-TMST        04070001
038200             ,LAST_ACTN_CDE      = :XLT00032-LAST-ACTN-CDE        04080001
038300          WHERE  PRCHG_ID = :XLT00032-PRCHG-ID                    04090001
038400     END-EXEC.                                                    04100001
038500                                                                  04110001
038600     EVALUATE TRUE                                                04120001
038700        WHEN SQLCODE = ZERO                                       04130001
038800*            DISPLAY 'UPDATE ' XLT00032-PRCHG-ID                  04140001
038900             ADD +1                   TO PA-PRCHG-RECS-UPDATED    04150002
039000             ADD +1                   TO PA-COMMIT-COUNTER        04160003
039100        WHEN SQLCODE = +100                                       04170001
039200             SET PS-PRCHG-UPD-NF-YES        TO TRUE               04180001
039300             ADD +1                   TO PA-UPD-PRCHG-NF-RECS     04190003
039400             DISPLAY 'UPDATE OF XLT_PRCHG NOT FOUND '             04200001
039500             DISPLAY 'PRCHG ID ' XLT00032-PRCHG-ID                04210001
039600        WHEN SQLCODE = -803                                       04220001
039700             ADD +1                   TO PA-PRCHG-DUP-RECS        04230003
      *PRB0060860-START                                                 04240021
                   PERFORM 9000-WRITE-OUTPUT-RECORD                     04250021
      *PRB0060860-END                                                   04260021
039800        WHEN OTHER                                                04270001
039900             MOVE XLT00032-PRCHG-ID TO PV-DISPLAY-PRCHG-ID        04280001
040000             DISPLAY 'TRYING TO UPDATE XLT_PRCHG '                04290001
040100             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  04300001
040200                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  04310001
040300                                      INTO PV-OPERATION-MSG-1     04320001
040400             PERFORM 9999-DISPLAY-STATISTICS                      04330001
040500             PERFORM 9999-ABEND-ROUTINE                           04340001
040600     END-EVALUATE.                                                04350001
040700                                                                  04360001
040800 EJECT.                                                           04370001
040900                                                                  04380001
041000***************************************************************** 04390001
041100**DELETE ROW INTO TABLE XLT_PRCHG                                 04400001
041200***************************************************************** 04410001
041300 2300-DELETE-PRCHG-ROW.                                           04420001
041400                                                                  04430001
041500     MOVE '2300-DELETE-PRCHG-ROW' TO PV-PARAGRAPH-NAME.           04440001
041600                                                                  04450001
041700     EXEC SQL                                                     04460001
041800          DELETE FROM XLT_PRCHG                                   04470001
041900          WHERE  PRCHG_ID = :XLT00032-PRCHG-ID                    04480001
042000     END-EXEC.                                                    04490001
042100                                                                  04500001
042200     EVALUATE TRUE                                                04510001
042300        WHEN SQLCODE = ZERO                                       04520001
042400*            DISPLAY 'DELETE ' XLT00032-PRCHG-ID                  04530001
042500             ADD +1                   TO PA-PRCHG-RECS-DELETED    04540003
042600             ADD +1                   TO PA-COMMIT-COUNTER        04550003
042700        WHEN SQLCODE = +100                                       04560001
042800             ADD +1                   TO PA-DEL-PRCHG-NF-RECS     04570003
042900        WHEN SQLCODE = -532                                       04580001
043000             ADD +1                   TO PA-532-RECS              04590003
043100        WHEN OTHER                                                04600001
043200             MOVE XLT00032-PRCHG-ID TO PV-DISPLAY-PRCHG-ID        04610001
043300             DISPLAY 'TRYING TO DELETE XLT_PRCHG '                04620001
043400             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  04630001
043500                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  04640001
043600                                      INTO PV-OPERATION-MSG-1     04650001
043700             PERFORM 9999-DISPLAY-STATISTICS                      04660001
043800             PERFORM 9999-ABEND-ROUTINE                           04670001
043900     END-EVALUATE.                                                04680001
044000                                                                  04690001
044100 EJECT.                                                           04700001
044200                                                                  04710001
044300******************************************************************04720001
044400**PROCESSES INPUT FILE                                            04730001
044500******************************************************************04740001
044600 2500-MOVE-PRCHG-DATA.                                            04750001
044700                                                                  04760001
044800     MOVE XL054-PRCH-PRCHG-ID      TO XLT00032-PRCHG-ID.          04770001
044900     MOVE XL054-PRCH-PRCHG-ST-CDE  TO XLT00032-PRCHG-ST-CDE.      04780001
           MOVE XL054-PRCH-TYP-CDE       TO XLT00032-PRCHG-TYP-CDE.     04790021
045000     MOVE XL054-PRCH-LAST-UPD-TMST TO XLT00032-LAST-UPD-TMST.     04800001
045100     MOVE XL054-PRCH-LAST-ACTN-CDE TO XLT00032-LAST-ACTN-CDE.     04810001
045200                                                                  04820001
045300 EJECT.                                                           04830001
045400                                                                  04840001
045500***************************************************************** 04850001
045600**INSERT ROW INTO TABLE XLT_STR_GP_PRCHG                          04860001
045700***************************************************************** 04870001
045800 3100-INSERT-STRGP-ROW.                                           04880001
045900                                                                  04890001
046000     MOVE '3100-INSERT-STRGP-ROW' TO PV-PARAGRAPH-NAME.           04900001
046100                                                                  04910001
046200     EXEC SQL                                                     04920001
046300       INSERT INTO XLT_STR_GP_PRCHG  (STR_GP_TYP_CDE              04930001
046400                                     ,STR_GP_ID                   04940001
046500                                     ,PRCHG_ID                    04950001
046600                                     ,PRCHG_EFF_DTE               04960001
                                           ,SOR_CRE_TMST                04970021
046700                                     ,LAST_UPD_TMST               04980001
046800                                     ,LAST_ACTN_CDE)              04990001
046900                             VALUES (:XLT00033-STR-GP-TYP-CDE     05000001
047000                                    ,:XLT00033-STR-GP-ID          05010001
047100                                    ,:XLT00033-PRCHG-ID           05020001
047200                                    ,:XLT00033-PRCHG-EFF-DTE      05030001
                                          ,:XLT00033-SOR-CRE-TMST       05040021
047300                                    ,:XLT00033-LAST-UPD-TMST      05050001
047400                                    ,:XLT00033-LAST-ACTN-CDE)     05060001
047500     END-EXEC.                                                    05070001
047600                                                                  05080001
047700     EVALUATE TRUE                                                05090001
047800        WHEN SQLCODE = ZERO                                       05100001
047900             ADD +1                 TO PA-STRGP-RECS-INSERTED     05110002
048000             ADD +1                 TO PA-COMMIT-COUNTER          05120003
048100        WHEN SQLCODE = -803                                       05130001
048200             ADD +1                 TO PA-STRGP-DUP-RECS          05140003
      *PRB0060860-START                                                 05150021
                   PERFORM 9000-WRITE-OUTPUT-RECORD                     05160021
      *PRB0060860-END                                                   05170021
048300        WHEN OTHER                                                05180001
048400             MOVE XLT00033-STR-GP-TYP-CDE                         05190001
048500                                    TO PV-DISPLAY-STR-GP-TYP-CDE  05200001
048600             MOVE XLT00033-STR-GP-ID                              05210001
048700                                    TO PV-DISPLAY-STR-GP-ID       05220001
048800             MOVE XLT00033-PRCHG-ID                               05230001
048900                                    TO PV-DISPLAY-PRCHG-ID        05240001
049000             DISPLAY 'TRYING TO INSERT XLT_STR_GP_PRCHG '         05250001
049100             STRING  ' STR-GP-TYP-CDE-'        DELIMITED BY SIZE  05260001
049200                     PV-DISPLAY-STR-GP-TYP-CDE DELIMITED BY SIZE  05270001
049300                                      INTO PV-OPERATION-MSG-1     05280001
049400             STRING  ' STR-GP-ID-'             DELIMITED BY SIZE  05290001
049500                     PV-DISPLAY-STR-GP-ID      DELIMITED BY SIZE  05300001
049600                                      INTO PV-OPERATION-MSG-2     05310001
049700             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  05320001
049800                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  05330001
049900                                      INTO PV-OPERATION-MSG-3     05340001
050000             PERFORM 9999-DISPLAY-STATISTICS                      05350001
050100             PERFORM 9999-ABEND-ROUTINE                           05360001
050200     END-EVALUATE.                                                05370001
050300                                                                  05380001
050400 EJECT.                                                           05390001
050500                                                                  05400001
050600***************************************************************** 05410001
050700**UPDATE ROW INTO TABLE XLT_STR_GP_PRCHG                          05420001
050800***************************************************************** 05430001
050900 3200-UPDATE-STRGP-ROW.                                           05440001
051000                                                                  05450001
051100     MOVE '3200-UPDATE-STRGP-ROW' TO PV-PARAGRAPH-NAME.           05460001
051200                                                                  05470001
051300     EXEC SQL                                                     05480001
051400          UPDATE XLT_STR_GP_PRCHG                                 05490001
051500          SET PRCHG_EFF_DTE      = :XLT00033-PRCHG-EFF-DTE        05500001
051600*            ,SOR_CRE_TMST       = :XLT00033-SOR-CRE-TMST         05510001
051600             ,LAST_UPD_TMST      = :XLT00033-LAST-UPD-TMST        05520001
051700             ,LAST_ACTN_CDE      = :XLT00033-LAST-ACTN-CDE        05530001
051800          WHERE  STR_GP_TYP_CDE  = :XLT00033-STR-GP-TYP-CDE       05540001
051900            AND  STR_GP_ID       = :XLT00033-STR-GP-ID            05550001
052000            AND  PRCHG_ID        = :XLT00033-PRCHG-ID             05560001
052100     END-EXEC.                                                    05570001
052200                                                                  05580001
052300     EVALUATE TRUE                                                05590001
052400        WHEN SQLCODE = ZERO                                       05600001
052500             ADD +1                  TO PA-STRGP-RECS-UPDATED     05610002
052600             ADD +1                  TO PA-COMMIT-COUNTER         05620003
052700        WHEN SQLCODE = +100                                       05630001
052800             SET PS-STRGP-UPD-NF-YES        TO TRUE               05640001
052900             ADD +1                  TO PA-UPD-STRGP-NF-RECS      05650003
053000             DISPLAY 'UPDATE OF XLT_STR_GP_PRCHG NOT FOUND '      05660001
053100             DISPLAY 'STR GP TYP CDE' XLT00033-STR-GP-TYP-CDE     05670001
053200             DISPLAY 'STR GP ID     ' XLT00033-STR-GP-ID          05680001
053300             DISPLAY 'PRCHG ID      ' XLT00033-PRCHG-ID           05690001
053400        WHEN SQLCODE = -803                                       05700001
053500             ADD +1                  TO PA-STRGP-DUP-RECS         05710003
      *PRB0060860-START                                                 05720021
                   PERFORM 9000-WRITE-OUTPUT-RECORD                     05730021
      *PRB0060860-END                                                   05740021
053600        WHEN OTHER                                                05750001
053700             MOVE XLT00033-STR-GP-TYP-CDE                         05760001
053800                                    TO PV-DISPLAY-STR-GP-TYP-CDE  05770001
053900             MOVE XLT00033-STR-GP-ID                              05780001
054000                                    TO PV-DISPLAY-STR-GP-ID       05790001
054100             MOVE XLT00033-PRCHG-ID                               05800001
054200                                    TO PV-DISPLAY-PRCHG-ID        05810001
054300             DISPLAY 'TRYING TO UPDATE XLT_STR_GP_PRCHG '         05820001
054400             STRING  ' STR-GP-TYP-CDE-'        DELIMITED BY SIZE  05830001
054500                     PV-DISPLAY-STR-GP-TYP-CDE DELIMITED BY SIZE  05840001
054600                                      INTO PV-OPERATION-MSG-1     05850001
054700             STRING  ' STR-GP-ID-'             DELIMITED BY SIZE  05860001
054800                     PV-DISPLAY-STR-GP-ID      DELIMITED BY SIZE  05870001
054900                                      INTO PV-OPERATION-MSG-2     05880001
055000             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  05890001
055100                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  05900001
055200                                      INTO PV-OPERATION-MSG-3     05910001
055300             PERFORM 9999-DISPLAY-STATISTICS                      05920001
055400             PERFORM 9999-ABEND-ROUTINE                           05930001
055500     END-EVALUATE.                                                05940001
055600                                                                  05950001
055700 EJECT.                                                           05960001
055800                                                                  05970001
055900***************************************************************** 05980001
056000**DELETE ROW INTO TABLE XLT_STR_GP_PRCHG                          05990001
056100***************************************************************** 06000001
056200 3300-DELETE-STRGP-ROW.                                           06010001
056300                                                                  06020001
056400     MOVE '3300-DELETE-STRGP-ROW' TO PV-PARAGRAPH-NAME.           06030001
056500                                                                  06040001
056600     EXEC SQL                                                     06050001
056700          DELETE FROM XLT_STR_GP_PRCHG                            06060001
056800          WHERE  STR_GP_TYP_CDE = :XLT00033-STR-GP-TYP-CDE        06070001
056900            AND  STR_GP_ID      = :XLT00033-STR-GP-ID             06080001
057000            AND  PRCHG_ID       = :XLT00033-PRCHG-ID              06090001
057100     END-EXEC.                                                    06100001
057200                                                                  06110001
057300     EVALUATE TRUE                                                06120001
057400        WHEN SQLCODE = ZERO                                       06130001
057500             ADD +1                  TO PA-STRGP-RECS-DELETED     06140003
057600             ADD +1                  TO PA-COMMIT-COUNTER         06150003
057700        WHEN SQLCODE = +100                                       06160001
057800             ADD +1                  TO PA-DEL-STRGP-NF-RECS      06170003
057900        WHEN SQLCODE = -532                                       06180001
058000             ADD +1                  TO PA-532-RECS               06190003
058100        WHEN OTHER                                                06200001
058200             MOVE XLT00033-STR-GP-TYP-CDE                         06210001
058300                                    TO PV-DISPLAY-STR-GP-TYP-CDE  06220001
058400             MOVE XLT00033-STR-GP-ID                              06230001
058500                                    TO PV-DISPLAY-STR-GP-ID       06240001
058600             MOVE XLT00033-PRCHG-ID                               06250001
058700                                    TO PV-DISPLAY-PRCHG-ID        06260001
058800             DISPLAY 'TRYING TO DELETE XLT_STR_GP_PRCHG '         06270001
058900             STRING  ' STR-GP-TYP-CDE-'        DELIMITED BY SIZE  06280001
059000                     PV-DISPLAY-STR-GP-TYP-CDE DELIMITED BY SIZE  06290001
059100                                      INTO PV-OPERATION-MSG-1     06300001
059200             STRING  ' STR-GP-ID-'             DELIMITED BY SIZE  06310001
059300                     PV-DISPLAY-STR-GP-ID      DELIMITED BY SIZE  06320001
059400                                      INTO PV-OPERATION-MSG-2     06330001
059500             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  06340001
059600                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  06350001
059700                                      INTO PV-OPERATION-MSG-3     06360001
059800             PERFORM 9999-DISPLAY-STATISTICS                      06370001
059900             PERFORM 9999-ABEND-ROUTINE                           06380001
060000     END-EVALUATE.                                                06390001
060100                                                                  06400001
060200 EJECT.                                                           06410001
060300                                                                  06420001
060400******************************************************************06430001
060500**PROCESSES INPUT FILE                                            06440001
060600******************************************************************06450001
060700 3500-MOVE-STRGP-DATA.                                            06460001
060800                                                                  06470001
060900     MOVE XL054-STGP-STR-GP-TYP-CDE                               06480001
061000                              TO XLT00033-STR-GP-TYP-CDE.         06490001
061100     MOVE XL054-STGP-STR-GP-ID       TO XLT00033-STR-GP-ID.       06500001
061200     MOVE XL054-STGP-PRCHG-ID        TO XLT00033-PRCHG-ID.        06510001
061300     MOVE XL054-STGP-PRCHG-EFF-DTE   TO XLT00033-PRCHG-EFF-DTE.   06520001
           MOVE XL054-STGP-SOR-CRE-TMST    TO XLT00033-SOR-CRE-TMST.    06530021
061400     MOVE XL054-STGP-LAST-UPD-TMST   TO XLT00033-LAST-UPD-TMST.   06540001
061500     MOVE XL054-STGP-LAST-ACTN-CDE   TO XLT00033-LAST-ACTN-CDE.   06550001
061600                                                                  06560001
061700 EJECT.                                                           06570001
061800                                                                  06580001
061900***************************************************************** 06590001
062000**INSERT ROW INTO TABLE XLT_PRCHG_MDSE                            06600001
062100***************************************************************** 06610001
062200 4100-INSERT-MDSE-ROW.                                            06620001
062300                                                                  06630001
062400     MOVE '4100-INSERT-MDSE-ROW' TO PV-PARAGRAPH-NAME.            06640001
062500                                                                  06650001
062600     EXEC SQL                                                     06660001
062700       INSERT INTO XLT_PRCHG_MDSE    (STR_GP_TYP_CDE              06670001
062800                                     ,STR_GP_ID                   06680001
062900                                     ,PRCHG_ID                    06690001
063000                                     ,PRCHG_MDSE_ID               06700001
063100                                     ,SKU_NBR                     06710001
063200                                     ,UNT_RTL_AMT                 06720001
063200                                     ,PREV_UNT_RTL_AMT            06730001
063300                                     ,LAST_UPD_TMST               06740001
063400                                     ,LAST_ACTN_CDE)              06750001
063500                             VALUES (:XLT00034-STR-GP-TYP-CDE     06760001
063600                                    ,:XLT00034-STR-GP-ID          06770001
063700                                    ,:XLT00034-PRCHG-ID           06780001
063800                                    ,:XLT00034-PRCHG-MDSE-ID      06790001
063900                                    ,:XLT00034-SKU-NBR            06800001
064000                                         :DN-SKU-NBR              06810001
064100                                    ,:XLT00034-UNT-RTL-AMT        06820021
064200                                         :DN-UNT-RTL-AMT          06830021
064100                                    ,:XLT00034-PREV-UNT-RTL-AMT   06840021
064200                                         :DN-PREV-UNT-RTL-AMT     06850021
064300                                    ,:XLT00034-LAST-UPD-TMST      06860001
064400                                    ,:XLT00034-LAST-ACTN-CDE)     06870001
064500     END-EXEC.                                                    06880001
064600                                                                  06890001
064700     EVALUATE TRUE                                                06900001
064800        WHEN SQLCODE = ZERO                                       06910001
064900             ADD +1                 TO PA-MDSE-RECS-INSERTED      06920002
065000             ADD +1                 TO PA-COMMIT-COUNTER          06930003
065100        WHEN SQLCODE = -803                                       06940001
065200             ADD +1                 TO PA-MDSE-DUP-RECS           06950003
      *PRB0060860-START                                                 06960021
                   PERFORM 9000-WRITE-OUTPUT-RECORD                     06970021
      *PRB0060860-END                                                   06980021
065300        WHEN OTHER                                                06990001
065400             MOVE XLT00034-STR-GP-TYP-CDE                         07000001
065500                                    TO PV-DISPLAY-STR-GP-TYP-CDE  07010001
065600             MOVE XLT00034-STR-GP-ID                              07020001
065700                                    TO PV-DISPLAY-STR-GP-ID       07030001
065800             MOVE XLT00034-PRCHG-ID                               07040001
065900                                    TO PV-DISPLAY-PRCHG-ID        07050001
066000             MOVE XLT00034-PRCHG-MDSE-ID                          07060001
066100                                    TO PV-DISPLAY-PRCHG-MDSE-ID   07070001
066200             DISPLAY 'TRYING TO INSERT XLT_PRCHG_MDSE '           07080001
066300             STRING  ' STR-GP-TYP-CDE-'        DELIMITED BY SIZE  07090001
066400                     PV-DISPLAY-STR-GP-TYP-CDE DELIMITED BY SIZE  07100001
066500                                      INTO PV-OPERATION-MSG-1     07110001
066600             STRING  ' STR-GP-ID-'             DELIMITED BY SIZE  07120001
066700                     PV-DISPLAY-STR-GP-ID      DELIMITED BY SIZE  07130001
066800                                      INTO PV-OPERATION-MSG-2     07140001
066900             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  07150001
067000                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  07160001
067100                                      INTO PV-OPERATION-MSG-3     07170001
067200             STRING  ' PRCHG MDSE ID-'         DELIMITED BY SIZE  07180001
067300                     PV-DISPLAY-PRCHG-MDSE-ID  DELIMITED BY SIZE  07190001
067400                                      INTO PV-OPERATION-MSG-4     07200001
067500             PERFORM 9999-DISPLAY-STATISTICS                      07210001
067600             PERFORM 9999-ABEND-ROUTINE                           07220001
067700     END-EVALUATE.                                                07230001
067800                                                                  07240001
067900 EJECT.                                                           07250001
068000                                                                  07260001
068100***************************************************************** 07270001
068200**UPDATE ROW INTO TABLE XLT_PRCHG_MDSE                            07280001
068300***************************************************************** 07290001
068400 4200-UPDATE-MDSE-ROW.                                            07300001
068500                                                                  07310001
068600     MOVE '4200-UPDATE-MDSE-ROW' TO PV-PARAGRAPH-NAME.            07320001
068700                                                                  07330001
068800     EXEC SQL                                                     07340001
068900          UPDATE XLT_PRCHG_MDSE                                   07350001
069000          SET                                                     07360000
069100              SKU_NBR            = :XLT00034-SKU-NBR              07370000
069200                                       :DN-SKU-NBR                07380001
069300             ,UNT_RTL_AMT        = :XLT00034-UNT-RTL-AMT          07390021
069400                                       :DN-UNT-RTL-AMT            07400021
069300             ,PREV_UNT_RTL_AMT   = :XLT00034-PREV-UNT-RTL-AMT     07410021
069400                                       :DN-PREV-UNT-RTL-AMT       07420021
069500             ,LAST_UPD_TMST      = :XLT00034-LAST-UPD-TMST        07430001
069600             ,LAST_ACTN_CDE      = :XLT00034-LAST-ACTN-CDE        07440001
069700          WHERE  STR_GP_TYP_CDE  = :XLT00034-STR-GP-TYP-CDE       07450001
069800            AND  STR_GP_ID       = :XLT00034-STR-GP-ID            07460001
069900            AND  PRCHG_ID        = :XLT00034-PRCHG-ID             07470001
070000            AND  PRCHG_MDSE_ID   = :XLT00034-PRCHG-MDSE-ID        07480001
070100     END-EXEC.                                                    07490001
070200                                                                  07500001
070300     EVALUATE TRUE                                                07510001
070400        WHEN SQLCODE = ZERO                                       07520001
070500             ADD +1                  TO PA-MDSE-RECS-UPDATED      07530003
070600             ADD +1                  TO PA-COMMIT-COUNTER         07540003
070700        WHEN SQLCODE = +100                                       07550001
070800             SET PS-MDSE-UPD-NF-YES        TO TRUE                07560001
070900             ADD +1                  TO PA-UPD-MDSE-NF-RECS       07570003
071000             DISPLAY 'UPDATE OF XLT_PRCHG_MDSE NOT FOUND '        07580001
071100             DISPLAY 'STR GP TYP CDE  ' XLT00034-STR-GP-TYP-CDE   07590001
071200             DISPLAY 'STR GP ID       ' XLT00034-STR-GP-ID        07600001
071300             DISPLAY 'PRCHG ID        ' XLT00034-PRCHG-ID         07610001
071400             DISPLAY 'PRCHG MDSE ID   ' XLT00034-PRCHG-MDSE-ID    07620001
071500        WHEN SQLCODE = -803                                       07630001
071600             ADD +1                  TO PA-MDSE-DUP-RECS          07640003
      *PRB0060860-START                                                 07650021
                   PERFORM 9000-WRITE-OUTPUT-RECORD                     07660021
      *PRB0060860-END                                                   07670021
071700        WHEN OTHER                                                07680001
071800             MOVE XLT00034-STR-GP-TYP-CDE                         07690001
071900                                    TO PV-DISPLAY-STR-GP-TYP-CDE  07700001
072000             MOVE XLT00034-STR-GP-ID                              07710001
072100                                    TO PV-DISPLAY-STR-GP-ID       07720001
072200             MOVE XLT00034-PRCHG-ID                               07730001
072300                                    TO PV-DISPLAY-PRCHG-ID        07740001
072400             MOVE XLT00034-PRCHG-MDSE-ID                          07750001
072500                                    TO PV-DISPLAY-PRCHG-MDSE-ID   07760001
072600             DISPLAY 'TRYING TO UPDATE XLT_PRCHG_MDSE '           07770001
072700             STRING  ' STR-GP-TYP-CDE-'        DELIMITED BY SIZE  07780001
072800                     PV-DISPLAY-STR-GP-TYP-CDE DELIMITED BY SIZE  07790001
072900                                      INTO PV-OPERATION-MSG-1     07800001
073000             STRING  ' STR-GP-ID-'             DELIMITED BY SIZE  07810001
073100                     PV-DISPLAY-STR-GP-ID      DELIMITED BY SIZE  07820001
073200                                      INTO PV-OPERATION-MSG-2     07830001
073300             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  07840001
073400                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  07850001
073500                                      INTO PV-OPERATION-MSG-3     07860001
073600             STRING  ' PRCHG MDSE ID-'         DELIMITED BY SIZE  07870001
073700                     PV-DISPLAY-PRCHG-MDSE-ID  DELIMITED BY SIZE  07880001
073800                                      INTO PV-OPERATION-MSG-4     07890001
073900             PERFORM 9999-DISPLAY-STATISTICS                      07900001
074000             PERFORM 9999-ABEND-ROUTINE                           07910001
074100     END-EVALUATE.                                                07920001
074200                                                                  07930001
074300 EJECT.                                                           07940001
074400                                                                  07950001
074500***************************************************************** 07960001
074600**DELETE ROW INTO TABLE XLT_PRCHG_MDSE                            07970001
074700***************************************************************** 07980001
074800 4300-DELETE-MDSE-ROW.                                            07990001
074900                                                                  08000001
075000     MOVE '4300-DELETE-MDSE-ROW' TO PV-PARAGRAPH-NAME.            08010001
075100                                                                  08020001
075200     EXEC SQL                                                     08030001
075300          DELETE FROM XLT_PRCHG_MDSE                              08040001
075400          WHERE  STR_GP_TYP_CDE = :XLT00034-STR-GP-TYP-CDE        08050001
075500            AND  STR_GP_ID      = :XLT00034-STR-GP-ID             08060001
075600            AND  PRCHG_ID       = :XLT00034-PRCHG-ID              08070001
075700            AND  PRCHG_MDSE_ID  = :XLT00034-PRCHG-MDSE-ID         08080001
075800     END-EXEC.                                                    08090001
075900                                                                  08100001
076000     EVALUATE TRUE                                                08110001
076100        WHEN SQLCODE = ZERO                                       08120001
076200             ADD +1                  TO PA-MDSE-RECS-DELETED      08130003
076300             ADD +1                  TO PA-COMMIT-COUNTER         08140003
076400        WHEN SQLCODE = +100                                       08150001
076500             ADD +1                  TO PA-DEL-MDSE-NF-RECS       08160003
076600        WHEN SQLCODE = -532                                       08170001
076700             ADD +1                  TO PA-532-RECS               08180003
076800        WHEN OTHER                                                08190001
076900             MOVE XLT00034-STR-GP-TYP-CDE                         08200001
077000                                    TO PV-DISPLAY-STR-GP-TYP-CDE  08210001
077100             MOVE XLT00034-STR-GP-ID                              08220001
077200                                    TO PV-DISPLAY-STR-GP-ID       08230001
077300             MOVE XLT00034-PRCHG-ID                               08240001
077400                                    TO PV-DISPLAY-PRCHG-ID        08250001
077500             MOVE XLT00034-PRCHG-MDSE-ID                          08260001
077600                                    TO PV-DISPLAY-PRCHG-MDSE-ID   08270001
077700             DISPLAY 'TRYING TO DELETE XLT_PRCHG_MDSE '           08280001
077800             STRING  ' STR-GP-TYP-CDE-'        DELIMITED BY SIZE  08290001
077900                     PV-DISPLAY-STR-GP-TYP-CDE DELIMITED BY SIZE  08300001
078000                                      INTO PV-OPERATION-MSG-1     08310001
078100             STRING  ' STR-GP-ID-'             DELIMITED BY SIZE  08320001
078200                     PV-DISPLAY-STR-GP-ID      DELIMITED BY SIZE  08330001
078300                                      INTO PV-OPERATION-MSG-2     08340001
078400             STRING  ' PRCHG ID-'              DELIMITED BY SIZE  08350001
078500                     PV-DISPLAY-PRCHG-ID       DELIMITED BY SIZE  08360001
078600                                      INTO PV-OPERATION-MSG-3     08370001
078700             STRING  ' PRCHG MDSE ID-'         DELIMITED BY SIZE  08380001
078800                     PV-DISPLAY-PRCHG-MDSE-ID  DELIMITED BY SIZE  08390001
078900                                      INTO PV-OPERATION-MSG-4     08400001
079000             PERFORM 9999-DISPLAY-STATISTICS                      08410001
079100             PERFORM 9999-ABEND-ROUTINE                           08420001
079200     END-EVALUATE.                                                08430001
079300                                                                  08440001
079400 EJECT.                                                           08450001
079500                                                                  08460001
079600******************************************************************08470001
079700**PROCESSES INPUT FILE                                            08480001
079800******************************************************************08490001
079900 4500-MOVE-MDSE-DATA.                                             08500001
080000                                                                  08510001
080100     MOVE XL054-MDSE-STR-GP-TYP-CDE                               08520001
080200                              TO XLT00034-STR-GP-TYP-CDE.         08530001
080300     MOVE XL054-MDSE-STR-GP-ID       TO XLT00034-STR-GP-ID.       08540001
080400     MOVE XL054-MDSE-PRCHG-ID        TO XLT00034-PRCHG-ID.        08550001
080500     MOVE XL054-MDSE-PRCHG-MDSE-ID   TO XLT00034-PRCHG-MDSE-ID.   08560001
080600                                                                  08570001
080700                                                                  08580001
080800*****   CHECK FOR NULLS ****                                      08590001
080900     IF XL054-MDSE-SKU-NBR-NI                                     08600001
081000         MOVE -1                     TO DN-SKU-NBR                08610001
081100         MOVE ZEROES                 TO XLT00034-SKU-NBR          08620001
081200     ELSE                                                         08630001
081300         MOVE 0                      TO DN-SKU-NBR                08640001
081400         MOVE XL054-MDSE-SKU-NBR     TO XLT00034-SKU-NBR          08650001
081500     END-IF                                                       08660001
081600                                                                  08670001
081700     IF XL054-MDSE-UNT-RTL-AMT-NI                                 08680021
081800         MOVE -1                     TO DN-UNT-RTL-AMT            08690021
081900         MOVE ZEROES                 TO XLT00034-UNT-RTL-AMT      08700021
082000     ELSE                                                         08710021
082100         MOVE 0                      TO DN-UNT-RTL-AMT            08720021
082200         MOVE XL054-MDSE-UNT-RTL-AMT TO XLT00034-UNT-RTL-AMT      08730021
082300     END-IF                                                       08740021
082400                                                                  08750021
081700     IF XL054-PREV-MDSE-RTL-AMT-NI                                08760021
081800         MOVE -1                     TO DN-PREV-UNT-RTL-AMT       08770021
081900         MOVE ZEROES                 TO XLT00034-PREV-UNT-RTL-AMT 08780021
082000     ELSE                                                         08790021
082100         MOVE 0                      TO DN-PREV-UNT-RTL-AMT       08800021
082200         MOVE XL054-PREV-MDSE-RTL-AMT                             08810021
082200             TO XLT00034-PREV-UNT-RTL-AMT                         08820021
082300     END-IF                                                       08830021
082400                                                                  08840021
082500     MOVE XL054-MDSE-LAST-UPD-TMST   TO XLT00034-LAST-UPD-TMST.   08850001
082600     MOVE XL054-MDSE-LAST-ACTN-CDE   TO XLT00034-LAST-ACTN-CDE.   08860001
082700                                                                  08870001
082800 EJECT.                                                           08880001
082900                                                                  08890001
083000 7000-COUNT-PRCHG.                                                08900001
083100     EXEC SQL                                                     08910001
083200     SELECT                                                       08920021
083300         COUNT (*)                                                08930001
083400         INTO :PV-PRCHG-COUNT                                     08940021
083500         FROM XLT_PRCHG                                           08950021
083600     END-EXEC.                                                    08960001
083700                                                                  08970001
083800                                                                  08980001
083900 7010-COUNT-STR-GP.                                               08990001
084000     EXEC SQL                                                     09000001
084100     SELECT                                                       09010021
084200         COUNT (*)                                                09020001
084300         INTO :PV-STR-GP-COUNT                                    09030021
084400         FROM XLT_STR_GP_PRCHG                                    09040021
084500     END-EXEC.                                                    09050001
084600                                                                  09060001
084700 7020-COUNT-PRCHG-MDSE.                                           09070001
084800     EXEC SQL                                                     09080001
084900     SELECT                                                       09090021
085000         COUNT (*)                                                09100001
085100         INTO :PV-PRCHG-MDSE-COUNT                                09110021
085200         FROM XLT_PRCHG_MDSE                                      09120021
085300     END-EXEC.                                                    09130001
085400                                                                  09140001
085500                                                                  09150001
085600***************************************************************** 09160001
085700**READ INPUT FILE                                                 09170001
085800***************************************************************** 09180001
085900 8000-READ-INPUT-FILE.                                            09190001
086000                                                                  09200001
086100     READ INPUT-FILE INTO XL054-TRANS-REC                         09210001
086200          AT END SET PS-END-OF-INPUT-FILE TO TRUE                 09220001
086300     END-READ.                                                    09230001
086400                                                                  09240001
086500     IF  PS-NOT-END-OF-INPUT-FILE                                 09250001
086600         ADD +1 TO PA-INPUT-RECS-READ                             09260003
086700     END-IF.                                                      09270001
086800                                                                  09280001
086900 EJECT.                                                           09290001
087000                                                                  09300001
      *PRB0060860-START                                                 09310021
085600***************************************************************** 09320001
085700**WRITE OUTPUT FILE                                               09330001
085800***************************************************************** 09340001
121000 9000-WRITE-OUTPUT-RECORD.                                        09350021
124000                                                                  09360021
124100     WRITE OUTPUT-RECORD  FROM XL054-TRANS-REC.                   09370021
124200                                                                  09380021
      *PRB0060860-END                                                   09390021
087100****************************************************************  09400001
087200*END OF PROGRAM ROUTINE                                           09410001
087300****************************************************************  09420001
087400 9999-WRAPUP.                                                     09430001
087500                                                                  09440001
087600     PERFORM 9999-COMMIT-DATA.                                    09450001
087700                                                                  09460001
087800     IF PS-PRCHG-UPD-NF-YES                                       09470001
087900         MOVE 4093        TO RETURN-CODE                          09480001
088000     END-IF.                                                      09490001
088100                                                                  09500001
088200     IF PS-STRGP-UPD-NF-YES                                       09510001
088300         MOVE 4093        TO RETURN-CODE                          09520001
088400     END-IF.                                                      09530001
088500                                                                  09540001
088600     IF PS-MDSE-UPD-NF-YES                                        09550001
088700         MOVE 4093        TO RETURN-CODE                          09560001
088800     END-IF.                                                      09570001
088900                                                                  09580001
089000     CLOSE INPUT-FILE.                                            09590001
      *PRB0060860-START                                                 09600021
089000     CLOSE OUTPUT-FILE.                                           09610001
      *PRB0060860-END                                                   09620021
089100                                                                  09630001
089200     PERFORM 7000-COUNT-PRCHG.                                    09640001
089300     PERFORM 7010-COUNT-STR-GP.                                   09650001
089400     PERFORM 7020-COUNT-PRCHG-MDSE.                               09660001
089500                                                                  09670001
089600     PERFORM 9999-DISPLAY-STATISTICS.                             09680001
089700                                                                  09690001
089800 EJECT.                                                           09700001
089900                                                                  09710001
090000****************************************************************  09720001
090100*COMMIT DATA TO DATABASE                                          09730001
090200****************************************************************  09740001
090300 9999-COMMIT-DATA.                                                09750001
090400                                                                  09760001
090500     MOVE '9999-COMMIT-DATA' TO PV-PARAGRAPH-NAME.                09770001
090600                                                                  09780001
090700     EXEC SQL                                                     09790001
090800          COMMIT                                                  09800001
090900     END-EXEC.                                                    09810001
091000                                                                  09820001
091100     EVALUATE TRUE                                                09830001
091200        WHEN SQLCODE = ZERO                                       09840001
091300             CONTINUE                                             09850001
091400        WHEN OTHER                                                09860001
091500             PERFORM 9999-DISPLAY-STATISTICS                      09870001
091600             PERFORM 9999-ABEND-ROUTINE                           09880001
091700     END-EVALUATE.                                                09890001
091800                                                                  09900001
091900 EJECT.                                                           09910001
092000                                                                  09920001
092100****************************************************************  09930001
092200*DISPLAY PROGRAM STATISTICS                                       09940001
092300****************************************************************  09950001
092400 9999-DISPLAY-STATISTICS.                                         09960001
092500                                                                  09970001
092600     DISPLAY '*************************************************'. 09980001
092700     DISPLAY '* PROGRAM...............: ' PC-CURRENT-PROGRAM-NAME.09990001
092800     DISPLAY '* TABLE.................: ' PC-TABLE-NAME-1.        10000001
092900     DISPLAY '* TABLE.................: ' PC-TABLE-NAME-2.        10010001
093000     DISPLAY '* TABLE.................: ' PC-TABLE-NAME-3.        10020001
093100     DISPLAY '* TIMESTAMP.............: ' SD-TIMESTAMP.           10030001
093200     DISPLAY '*************************************************'. 10040001
093300     DISPLAY '* DATE/TIMESTAMP........: ' SD-TIMESTAMP.           10050001
093400                                                                  10060021
093500     MOVE PA-INPUT-RECS-READ          TO PV-DISP-NBR              10070021
093600     DISPLAY '* TOTAL RECS READ.....: ' PV-DISP-NBR               10080003
093700     DISPLAY SPACES.                                              10090001
093800                                                                  10100021
093900     MOVE PA-PRCHG-RECS-INSERTED      TO PV-DISP-NBR              10110021
094000     DISPLAY '* TOTAL PRCHG INSERTED: ' PV-DISP-NBR               10120002
094100                                                                  10130021
094200     MOVE PA-STRGP-RECS-INSERTED      TO PV-DISP-NBR              10140021
094300     DISPLAY '* TOTAL STRGP INSERTED: ' PV-DISP-NBR               10150002
094400                                                                  10160021
094500     MOVE PA-MDSE-RECS-INSERTED       TO PV-DISP-NBR              10170021
094600     DISPLAY '* TOTAL MDSE INSERTED:  ' PV-DISP-NBR               10180002
094700     DISPLAY SPACES                                               10190001
094800                                                                  10200021
094900     MOVE PA-PRCHG-RECS-UPDATED       TO PV-DISP-NBR              10210021
095000     DISPLAY '* TOTAL PRCHG UPDATED.: ' PV-DISP-NBR               10220002
095100                                                                  10230021
095200     MOVE PA-STRGP-RECS-UPDATED       TO PV-DISP-NBR              10240021
095300     DISPLAY '* TOTAL STRGP UPDATED.: ' PV-DISP-NBR               10250002
095400                                                                  10260021
095500     MOVE PA-MDSE-RECS-UPDATED        TO PV-DISP-NBR              10270021
095600     DISPLAY '* TOTAL MDSE UPDATED.:  ' PV-DISP-NBR               10280003
095700     DISPLAY SPACES                                               10290001
095800                                                                  10300021
095900     MOVE PA-PRCHG-RECS-DELETED       TO PV-DISP-NBR              10310021
096000     DISPLAY '* TOTAL PRCHG DELETED.: ' PV-DISP-NBR               10320003
096100                                                                  10330021
096200     MOVE PA-STRGP-RECS-DELETED       TO PV-DISP-NBR              10340021
096300     DISPLAY '* TOTAL STRGP DELETED.: ' PV-DISP-NBR               10350003
096400                                                                  10360021
096500     MOVE PA-MDSE-RECS-DELETED        TO PV-DISP-NBR              10370021
096600     DISPLAY '* TOTAL MDSE DELETED.:  ' PV-DISP-NBR               10380003
096700     DISPLAY SPACES.                                              10390001
096800                                                                  10400021
096900     MOVE PA-PRCHG-DUP-RECS           TO PV-DISP-NBR              10410021
097000     DISPLAY '* DUP PRCHG REC IGNORED.: ' PV-DISP-NBR             10420003
097100                                                                  10430021
097200     MOVE PA-STRGP-DUP-RECS           TO PV-DISP-NBR              10440021
097300     DISPLAY '* DUP STRGP REC IGNORED.: ' PV-DISP-NBR             10450003
097400                                                                  10460021
097500     MOVE PA-MDSE-DUP-RECS            TO PV-DISP-NBR              10470021
097600     DISPLAY '* DUP MDSE REC IGNORED.:  ' PV-DISP-NBR             10480003
097700     DISPLAY SPACES                                               10490001
097800                                                                  10500021
097900     MOVE PA-DEL-PRCHG-NF-RECS        TO PV-DISP-NBR              10510021
098000     DISPLAY '* PRCHG NOT FND FOR DEL.: ' PV-DISP-NBR             10520003
098100                                                                  10530021
098200     MOVE PA-DEL-STRGP-NF-RECS        TO PV-DISP-NBR              10540021
098300     DISPLAY '* STRGP NOT FND FOR DEL.: ' PV-DISP-NBR             10550003
098400                                                                  10560021
098500     MOVE PA-DEL-MDSE-NF-RECS         TO PV-DISP-NBR              10570021
098600     DISPLAY '* MDSE NOT FND FOR DEL.:  ' PV-DISP-NBR             10580003
098700     DISPLAY SPACES                                               10590001
098800                                                                  10600021
098900     MOVE PA-UPD-PRCHG-NF-RECS        TO PV-DISP-NBR              10610021
099000     DISPLAY '* PRCHG NOT FND FOR UPD.: ' PV-DISP-NBR             10620003
099100                                                                  10630021
099200     MOVE PA-UPD-STRGP-NF-RECS        TO PV-DISP-NBR              10640021
099300     DISPLAY '* STRGP NOT FND FOR UPD.: ' PV-DISP-NBR             10650003
099400                                                                  10660021
099500     MOVE PA-UPD-MDSE-NF-RECS         TO PV-DISP-NBR              10670021
099600     DISPLAY '* MDSE NOT FND FOR UPD.:  ' PV-DISP-NBR             10680003
099700     DISPLAY SPACES                                               10690001
099800                                                                  10700021
099900     MOVE PA-532-RECS                 TO PV-DISP-NBR              10710021
100000     DISPLAY '* REC DELETE RESTRICTED.: ' PV-DISP-NBR.            10720003
100100     DISPLAY SPACES                                               10730001
100200                                                                  10740021
100300     DISPLAY '* FINAL EOJ ROWS COUNTS*  '                         10750003
100400     MOVE PV-PRCHG-COUNT              TO PV-DISP-NBR              10760021
100500     DISPLAY '* PRCHG ROW COUNT       :  ' PV-DISP-NBR            10770003
100600     DISPLAY SPACES                                               10780001
100700                                                                  10790021
100800     MOVE PV-STR-GP-COUNT             TO PV-DISP-NBR              10800021
100900     DISPLAY '* STR-GP ROW COUNT      :  ' PV-DISP-NBR            10810003
101000     DISPLAY SPACES                                               10820001
101100                                                                  10830021
101200     MOVE PV-PRCHG-MDSE-COUNT         TO PV-DISP-NBR              10840021
101300     DISPLAY '* MDSE ROW COUNT        :  ' PV-DISP-NBR            10850003
101400     DISPLAY SPACES                                               10860001
101500                                                                  10870021
101600     DISPLAY '*************************************************'. 10880001
101700/                                                                 10890001
101800******************************************************************10900001
101900**SQL ABEND ROUTINE                                               10910001
102000******************************************************************10920001
102100 9999-ABEND-ROUTINE.                                              10930001
102200                                                                  10940001
102300     DISPLAY '** ABEND     **'.                                   10950001
102400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10960001
102500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              10970001
102600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               10980001
102700     DISPLAY '** MSG 1     ** = ' PV-OPERATION-MSG-1.             10990001
102800     DISPLAY '** MSG 2     ** = ' PV-OPERATION-MSG-2.             11000001
102900     DISPLAY '** MSG 3     ** = ' PV-OPERATION-MSG-3.             11010001
103000     DISPLAY '** MSG 4     ** = ' PV-OPERATION-MSG-4.             11020001
103100 EJECT.                                                           11030001
103200                                                                  11040001
103300******************************************************************11050001
103400* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     11060001
103500* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      11070001
103600******************************************************************11080001
103700     COPY DPPD004.                                                11090001
103800     SET ABEND-4013-DB2-ERROR TO TRUE.                            11100001
103900     CALL 'ILBOABN0' USING ABEND-CODE.                            11110001
104000                                                                  11120001
104100 EJECT.                                                           11130001
