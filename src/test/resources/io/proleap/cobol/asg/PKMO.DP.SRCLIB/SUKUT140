000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    SUKUT140.                                         00050000
000600 AUTHOR.        DAN HINTZ.                                        00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   MAY 2009.                                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM CHECKS FOR CONVEYOR DIVERT INFORMATION BEING     *00120000
001300*  SENT FROM THE DC'S.  IT WILL SEND OUT AN E-MAIL NOTIFICATION  *00130000
001400*  WHEN THERE IS NOT ANY CONVEYOR DIVERT INFORMATION BEING SENT  *00140000
001500*  FOR A DC.                                                     *00150000
001600******************************************************************00160000
001700                                                                  00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000******************************************************************00200000
002100                                                                  00210000
002200 CONFIGURATION SECTION.                                           00220000
002300                                                                  00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800                                                                  00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT SU-CNVYR-CNTL-FILE                                    00310000
003200         ASSIGN TO INP01.                                         00320000
003300                                                                  00330000
003400     SELECT ERROR-OUT-FILE                                        00340000
003500         ASSIGN TO OUT01.                                         00350000
003600                                                                  00360000
003700******************************************************************00370000
003800 DATA DIVISION.                                                   00380000
003900******************************************************************00390000
004000                                                                  00400000
004100 FILE SECTION.                                                    00410000
004200*                                                                 00420000
004300 FD  SU-CNVYR-CNTL-FILE                                           00430000
004400     RECORDING MODE IS F                                          00440000
004500     LABEL RECORDS ARE STANDARD                                   00450000
004600     BLOCK CONTAINS 0 RECORDS.                                    00460000
004700 01  SU-CNVYR-CNTL-FILE-RECORD        PIC  X(75).                 00470000
004800*                                                                 00480000
004900*                                                                 00490000
005000 FD  ERROR-OUT-FILE                                               00500000
005100     RECORDING MODE IS F                                          00510000
005200     BLOCK CONTAINS 0 RECORDS                                     00520000
005300     LABEL RECORDS ARE STANDARD.                                  00530000
005400                                                                  00540000
005500 01  ERROR-OUT-RECORD             PIC X(80).                      00550000
005600                                                                  00560000
005700                                                                  00570000
005800******************************************************************00580000
005900 WORKING-STORAGE SECTION.                                         00590000
006000******************************************************************00600000
006100*                                                                 00610000
006200*                                                                 00620000
006300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00630000
006400                                                   COMP SYNC.     00640000
006500                                                                  00650000
006600***************************************************************** 00660000
006700*    INPUT CONTROL CARD                                           00670000
006800***************************************************************** 00680000
006900 01  CC-CONTROL-CARD.                                             00690000
007000     05  CC-OPER-UNT-ID              PIC 9(04)     VALUE ZERO.    00700000
007100     05  FILLER                      PIC X(03)     VALUE SPACES.  00710000
007200     05  CC-FCLTY-NAME               PIC X(20)     VALUE SPACES.  00720000
007210     05  FILLER                      PIC X(03)     VALUE SPACES.  00721000
007220     05  CC-PERIOD                   PIC X(08)     VALUE SPACES.  00722000
007230     05  CC-PERIOD-R7 REDEFINES CC-PERIOD.                        00723000
007240         10  CC-PERIOD-7             PIC X(07).                   00724000
007250         10  FILLER                  PIC X(01).                   00725000
007260     05  CC-PERIOD-R6 REDEFINES CC-PERIOD.                        00726000
007270         10  CC-PERIOD-6             PIC X(06).                   00727000
007280         10  FILLER                  PIC X(02).                   00728000
007290     05  CC-PERIOD-R5 REDEFINES CC-PERIOD.                        00729000
007291         10  CC-PERIOD-5             PIC X(05).                   00729100
007292         10  FILLER                  PIC X(03).                   00729200
007293     05  CC-PERIOD-R4 REDEFINES CC-PERIOD.                        00729300
007294         10  CC-PERIOD-4             PIC X(04).                   00729400
007295         10  FILLER                  PIC X(04).                   00729500
007296     05  CC-PERIOD-R3 REDEFINES CC-PERIOD.                        00729600
007297         10  CC-PERIOD-3             PIC X(03).                   00729700
007298         10  FILLER                  PIC X(05).                   00729800
007299                                                                  00729900
007300 01  DK-DB2-KEYS.                                                 00730000
007400     05  DK-OPER-UNT-ID              PIC S9(04)    VALUE +0       00740000
007500                                                   COMP SYNC.     00750000
007600     05  DK-LOC-ID                   PIC S9(04)    VALUE +0       00760000
007700                                                   COMP SYNC.     00770000
007800 01  HEADING-OUT.                                                 00780000
007900     05  HEAD-REC                    PIC X(80)     VALUE SPACES.  00790000
008000                                                                  00800000
008100 01  PC-PROGRAM-CONSTANTS.                                        00810000
008200     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00820000
008300         'SUKUT140'.                                              00830000
008400     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00840000
008500                                                   COMP SYNC.     00850000
008600 01  PS-PROGRAM-SWITCHES.                                         00860000
008700     05  PS-EOF-CNTL-FILE-SW         PIC  X(01)    VALUE 'N'.     00870000
008800         88  PS-EOF-CNTL-FILE                      VALUE 'Y'.     00880000
008900         88  PS-NOT-EOF-CNTL-FILE                  VALUE 'N'.     00890000
009000     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     00900000
009100         88  PS-END-OF-CURSOR                      VALUE 'Y'.     00910000
009200         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     00920000
009300     05  PS-CONVEYOR-VENDORS-SW      PIC  X(01)    VALUE 'S'.     00930000
009400         88  PS-SINGLE-CONVEYOR-VENDOR             VALUE 'S'.     00940000
009500         88  PS-MULTI-CONVEYOR-VENDORS             VALUE 'M'.     00950000
009510         88  PS-SORTER-CONVEYOR-CHECK              VALUE 'C'.     00951007
009600     05  PS-ADDITIONAL-CHECK-SW      PIC  X(01)    VALUE 'N'.     00960000
009700         88  PS-ADDITIONAL-CHECK-NEEDED            VALUE 'Y'.     00970000
009800         88  PS-NO-ADDITIONAL-CHECK-NEEDED         VALUE 'N'.     00980000
009900     05  PS-CONVEYOR-DIVERTS-SW      PIC  X(01)    VALUE 'Y'.     00990000
010000         88  PS-CONVEYOR-DIVERTS                   VALUE 'Y'.     01000000
010100         88  PS-NO-CONVEYOR-DIVERTS                VALUE 'N'.     01010000
010200*                                                                 01020000
010201* ADDED ASSGMT CSR SW - 4/9/13                                    01020100
010202     05  PS-EOF-ASGMT-CSR-SW         PIC  X(01)    VALUE 'N'.     01020200
010203         88  PS-EOF-ASGMT-CSR                      VALUE 'Y'.     01020300
010204         88  PS-NOT-EOF-ASGMT-CSR                  VALUE 'N'.     01020400
010205                                                                  01020500
010206 01  PV-PROGRAM-VARIABLES.                                        01020600
010207     05  PV-COUNTER                  PIC S9(04)    VALUE ZERO     01020700
010208                                                   COMP SYNC.     01020800
010209     05  PV-PARM-MINUTES             PIC S9(09)    VALUE ZERO     01020900
010210                                                   COMP SYNC.     01021000
010220     05  PV-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01022000
010230     05  PV-CALC-TIMESTAMP           PIC  X(26)    VALUE SPACES.  01023000
010240     05  PV-MAX-DIVERT-TIMESTAMP     PIC  X(26)    VALUE SPACES.  01024000
010250     05  PV-MAX-DIVERT-TIMESTAMP-R REDEFINES                      01025000
010260                                   PV-MAX-DIVERT-TIMESTAMP.       01026000
010270         10  PV-MAX-TMST-DATE-CST    PIC  X(10).                  01027000
010280         10  FILLER                  PIC  X(01).                  01028000
010290         10  PV-MAX-TMST-HHMM-CST    PIC  X(05).                  01029000
010300         10  FILLER                  PIC  X(10).                  01030000
010400                                                                  01040000
010500     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01050000
010600                                                                  01060000
010700     05  PV-OPEN-ASGMT-COUNT         PIC S9(09)    VALUE ZERO     01070000
010800                                                   COMP-3.        01080000
010900     05  PV-CLOSED-ASGMT-COUNT       PIC S9(09)    VALUE ZERO     01090000
011000                                                   COMP-3.        01100000
011100     05  PV-PARM-SEQ-NBR             PIC S9(09)    VALUE ZERO     01110000
011200                                                   COMP-3.        01120000
011300     05  PV-SINGLE-CNVYR-VENDOR      PIC  X(01)    VALUE SPACES.  01130000
011400     05  PV-CNVY-VENDOR              PIC  X(20)    VALUE SPACES.  01140000
011500     05  PV-BEGIN-RANGE              PIC  X(50)    VALUE SPACES.  01150000
011600     05  PV-END-RANGE                PIC  X(50)    VALUE SPACES.  01160000
011700     05  PV-ADDL-DOOR                PIC  X(50)    VALUE SPACES.  01170000
011800     05  PV-DC-NBR                   PIC S9(10)V9(5) VALUE ZERO   01180000
011900                                                     COMP-3.      01190000
011910     05  PV-SORTER-NAME              PIC  X(20)    VALUE SPACES.  01191009
012000     05  PV-OPER-UNT-ID-DISP.                                     01200000
012100         10  PV-OPER-UNT-ID-N        PIC 9(04)     VALUE ZERO.    01210000
012200                                                                  01220000
012300*                                                                 01230000
012400** ADDED DMH 4/9/13 BEGIN                                         01240000
012500     05  PV-ASGMT-COUNT         PIC S9(09) VALUE ZERO COMP.       01250000
012600     05  PV-EVENT-SUM           PIC S9(09) VALUE ZERO COMP.       01260000
012610                                                                  01261000
012620     05  PV-ASGMT-MSG-1         PIC  X(80) VALUE                  01262000
012621         '*** ACTIVE LABOR ASSIGNMENT SHOWN BELOW ***'.           01262100
012622     05  PV-ASGMT-MSG-FLAT.                                       01262200
012623         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01262300
012624         10  FILLER             PIC  X(12) VALUE 'FLAT........'.  01262400
012625         10  FILLER             PIC  X(04) VALUE SPACES.          01262500
012626         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01262600
012627         10  PV-MSG-FLAT-CNT    PIC  ZZZ,ZZZ,ZZ9.                 01262700
012628         10  FILLER             PIC  X(04) VALUE SPACES.          01262800
012629         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01262900
012630         10  PV-MSG-FLAT-SUM    PIC  ZZZ,ZZZ,ZZ9.                 01263000
012631         10  FILLER             PIC  X(31) VALUE SPACES.          01263100
012632     05  PV-ASGMT-MSG-RECV.                                       01263200
012633         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01263300
012634         10  FILLER             PIC  X(11) VALUE 'RECV.......'.   01263400
012635         10  FILLER             PIC  X(03) VALUE SPACES.          01263500
012636         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01263600
012637         10  PV-MSG-RECV-CNT    PIC  ZZZ,ZZZ,ZZ9.                 01263700
012638         10  FILLER             PIC  X(04) VALUE SPACES.          01263800
012639         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01263900
012640         10  PV-MSG-RECV-SUM    PIC  ZZZ,ZZZ,ZZ9.                 01264000
012641         10  FILLER             PIC  X(32) VALUE SPACES.          01264100
012642     05  PV-ASGMT-MSG-RLABL.                                      01264200
012643         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01264300
012644         10  FILLER             PIC  X(11) VALUE 'RLABL......'.   01264400
012645         10  FILLER             PIC  X(03) VALUE SPACES.          01264500
012646         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01264600
012647         10  PV-MSG-RLABL-CNT   PIC  ZZZ,ZZZ,ZZ9.                 01264700
012648         10  FILLER             PIC  X(04) VALUE SPACES.          01264800
012649         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01264900
012650         10  PV-MSG-RLABL-SUM   PIC  ZZZ,ZZZ,ZZ9.                 01265000
012651         10  FILLER             PIC  X(32) VALUE SPACES.          01265100
012652     05  PV-ASGMT-MSG-SHIP.                                       01265200
012653         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01265300
012654         10  FILLER             PIC  X(12) VALUE 'SHIP........'.  01265400
012655         10  FILLER             PIC  X(04) VALUE SPACES.          01265500
012656         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01265600
012657         10  PV-MSG-SHIP-CNT    PIC  ZZZ,ZZZ,ZZ9.                 01265700
012658         10  FILLER             PIC  X(04) VALUE SPACES.          01265800
012659         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01265900
012660         10  PV-MSG-SHIP-SUM    PIC  ZZZ,ZZZ,ZZ9.                 01266000
012661         10  FILLER             PIC  X(32) VALUE SPACES.          01266100
012662     05  PV-ASGMT-MSG-P2L.                                        01266200
012663         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01266300
012664         10  FILLER             PIC  X(14) VALUE 'P2L...........'.01266400
012665         10  FILLER             PIC  X(02) VALUE SPACES.          01266500
012666         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01266600
012667         10  PV-MSG-P2L-CNT     PIC  ZZZ,ZZZ,ZZ9.                 01266700
012668         10  FILLER             PIC  X(04) VALUE SPACES.          01266800
012669         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01266900
012670         10  PV-MSG-P2L-SUM     PIC  ZZZ,ZZZ,ZZ9.                 01267000
012671         10  FILLER             PIC  X(32) VALUE SPACES.          01267100
012672     05  PV-ASGMT-MSG-MASTCON.                                    01267200
012673         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01267300
012674         10  FILLER             PIC  X(08) VALUE 'MASTCON'.       01267400
012675         10  FILLER             PIC  X(02) VALUE SPACES.          01267500
012676         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01267600
012677         10  PV-MSG-MAST-CNT    PIC  ZZZ,ZZZ,ZZ9.                 01267700
012678         10  FILLER             PIC  X(04) VALUE SPACES.          01267800
012679         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01267900
012680         10  PV-MSG-MAST-SUM    PIC  ZZZ,ZZZ,ZZ9.                 01268000
012681         10  FILLER             PIC  X(31) VALUE SPACES.          01268100
012682     05  PV-ASGMT-MSG-OTHER.                                      01268200
012683         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01268300
012684         10  PV-MSG-OTHER       PIC  X(10) VALUE SPACES.          01268400
012685         10  FILLER             PIC  X(04) VALUE SPACES.          01268500
012686         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01268600
012687         10  PV-MSG-OTH-CNT     PIC  ZZZ,ZZZ,ZZ9.                 01268700
012688         10  FILLER             PIC  X(04) VALUE SPACES.          01268800
012689         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01268900
012690         10  PV-MSG-OTH-SUM     PIC  ZZZ,ZZZ,ZZ9.                 01269000
012691         10  FILLER             PIC  X(31) VALUE SPACES.          01269100
012692** ADDED DMH 4/9/13 END                                           01269200
012693*                                                                 01269300
012694* DMH 10/11/2016 BEGIN                                            01269415
012695         10  PV-NBR-DAYS-BACK      PIC S9(9) COMP.                01269515
012696         10  PV-DISP-NBR-DAYS      PIC  Z(9).                     01269615
012697         10  PV-DIVERT-BEGIN-TMST  PIC  X(26).                    01269715
012698* DMH 10/11/2016 END                                              01269815
012699                                                                  01269900
012700 01  PV-ABEND-VARIABLES.                                          01270000
012701     05  PV-SQLCODE                  PIC S9(9).                   01270100
012702     05  PV-DISPLAY-SQLCODE          PIC -------999.              01270200
012703     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT140'.  01270300
012704     05  PV-ABEND-PARAGRAPH          PIC X(30) VALUE SPACES.      01270400
012710     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      01271000
012800     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      01280000
012900     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      01290000
013000     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      01300000
013100     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      01310000
013200     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      01320000
013300     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      01330000
013400     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      01340000
013500*                                                                 01350000
013600*                                                                 01360000
013700******************************************************************01370000
013800** DIVERT MONITORING CONTROL CARD LAYOUT COPYBOOK               **01380000
013900******************************************************************01390000
014000     COPY SURD096.                                                01400000
014100*                                                                 01410000
014200*                                                                 01420000
014300******************************************************************01430000
014400** DB2 FORMATTED MESSAGE AREA                                   **01440000
014500******************************************************************01450000
014600     COPY DPWS004.                                                01460000
014700*                                                                 01470000
014800*                                                                 01480000
014900******************************************************************01490000
015000** COMMUNICATIONS AREA FOR DB2                                  **01500000
015100******************************************************************01510000
015200     EXEC SQL                                                     01520000
015300          INCLUDE SQLCA                                           01530000
015400     END-EXEC.                                                    01540000
015500*                                                                 01550000
015600*                                                                 01560000
015700******************************************************************01570000
015800** COBOL DECLARATION AND DCLGEN MEMBER FOR THE KOHLS PROCESSING **01580000
015900** PARAMETER TABLE                                              **01590000
016000******************************************************************01600000
016100     EXEC SQL                                                     01610000
016200          INCLUDE TKRPRPM                                         01620000
016300     END-EXEC.                                                    01630000
016400*                                                                 01640000
016500*                                                                 01650000
016600******************************************************************01660000
016700** COBOL DECLARATION AND DCLGEN MEMBER FOR THE KOHLS CARTON     **01670000
016800** DIVERT TABLE                                                 **01680000
016900******************************************************************01690000
017000     EXEC SQL                                                     01700000
017100          INCLUDE TSUCRDV                                         01710000
017200     END-EXEC.                                                    01720000
017300*                                                                 01730000
017400*                                                                 01740000
017500******************************************************************01750000
017600*  DB2 DECLARATION - WMOS INTEGRATION TYPE                        01760000
017700*      TABLE (WST_INTGRTN_TYP)                                    01770000
017800******************************************************************01780000
017900     EXEC SQL                                                     01790000
018000         INCLUDE WST00008                                         01800000
018100     END-EXEC.                                                    01810000
018200                                                                  01820000
018300******************************************************************01830000
018400*  DB2 DECLARATION - WMOS ATTRIBUTE DEFINITION                    01840000
018500*      TABLE (WST_ATTR_DEFN)                                      01850000
018600******************************************************************01860000
018700     EXEC SQL                                                     01870000
018800         INCLUDE WST00009                                         01880000
018900     END-EXEC.                                                    01890000
019000                                                                  01900000
019100******************************************************************01910000
019200*  DB2 DECLARATION - WMOS ATTRIBUTE ELEMENTS                      01920000
019300*      TABLE (WST_ATTR_ELEM)                                      01930000
019400******************************************************************01940000
019500     EXEC SQL                                                     01950000
019600         INCLUDE WST00010                                         01960000
019700     END-EXEC.                                                    01970000
019800                                                                  01980000
019900******************************************************************01990000
020000*  DB2 DECLARATION - LABOR ASSIGNMENT TABLE (DLT_ASGMT)           02000000
020100******************************************************************02010000
020200     EXEC SQL                                                     02020000
020300         INCLUDE DLT00004                                         02030000
020400     END-EXEC.                                                    02040000
020500*                                                                 02050000
020600******************************************************************02060000
020700*  DB2 CURSOR DECLARATION - MULTIPLE CONVEYOR VENDORS             02070000
020800******************************************************************02080000
020900     EXEC SQL                                                     02090000
021000          DECLARE CNVYR-VEND-CSR CURSOR FOR                       02100000
021100           SELECT   C.ATTR_ELEM_SEQ_NBR                           02110000
021200                  , C.ATTR_ELEM_NBR  AS  DC_NBR                   02120000
021300                  , D.ATTR_ELEM_TXT  AS  CNVY_VENDOR              02130000
021400                  , E.ATTR_ELEM_TXT  AS  BEGIN_RANGE              02140000
021500                  , F.ATTR_ELEM_TXT  AS  END_RANGE                02150000
021600                  , G.ATTR_ELEM_TXT  AS  ADDL_DOOR                02160000
021700                  , H.OPER_UNT_ID                                 02170000
021800                  , MAX(H.DIVERT_TMST)                            02180000
021900             FROM   WST_INTGRTN_TYP A                             02190000
022000                  , WST_ATTR_DEFN   B                             02200000
022100                  , WST_ATTR_ELEM   C                             02210000
022200                  , WST_ATTR_ELEM   D                             02220000
022300                  , WST_ATTR_ELEM   E                             02230000
022400                  , WST_ATTR_ELEM   F                             02240000
022500                  , WST_ATTR_ELEM   G                             02250000
022600                  , TSUCRDV         H                             02260000
022700            WHERE   A.INTGRTN_TYP_CDE     =  'DCCNVYVNDR'         02270000
022800              AND   A.INTGRTN_TYP_CDE     =  B.INTGRTN_TYP_CDE    02280000
022900              AND   B.INTGRTN_TYP_CDE     =  C.INTGRTN_TYP_CDE    02290000
023000              AND   B.INTGRTN_TYP_CDE     =  D.INTGRTN_TYP_CDE    02300000
023100              AND   B.INTGRTN_TYP_CDE     =  E.INTGRTN_TYP_CDE    02310000
023200              AND   B.INTGRTN_TYP_CDE     =  F.INTGRTN_TYP_CDE    02320000
023300              AND   B.INTGRTN_TYP_CDE     =  G.INTGRTN_TYP_CDE    02330000
023400              AND   B.ATTR_DEFN_SEQ_NBR   =  1                    02340000
023500              AND   C.ATTR_DEFN_SEQ_NBR   =  1                    02350000
023600              AND   D.ATTR_DEFN_SEQ_NBR   =  2                    02360000
023700              AND   E.ATTR_DEFN_SEQ_NBR   =  3                    02370000
023800              AND   F.ATTR_DEFN_SEQ_NBR   =  4                    02380000
023900              AND   G.ATTR_DEFN_SEQ_NBR   =  5                    02390000
024000              AND   C.ATTR_ELEM_SEQ_NBR   =  D.ATTR_ELEM_SEQ_NBR  02400000
024100              AND   C.ATTR_ELEM_SEQ_NBR   =  E.ATTR_ELEM_SEQ_NBR  02410000
024200              AND   C.ATTR_ELEM_SEQ_NBR   =  F.ATTR_ELEM_SEQ_NBR  02420000
024300              AND   C.ATTR_ELEM_SEQ_NBR   =  G.ATTR_ELEM_SEQ_NBR  02430000
024400                                                                  02440000
024500              AND C.ATTR_ELEM_NBR         =  :DK-OPER-UNT-ID      02450000
024600              AND C.ATTR_ELEM_NBR         =  H.OPER_UNT_ID        02460000
024700              AND (                                               02470000
024800                 (H.DOOR_ID              >= E.ATTR_ELEM_TXT  AND  02480000
024900                  H.DOOR_ID              <= F.ATTR_ELEM_TXT)      02490000
025000               OR                                                 02500000
025100                 (H.DOOR_ID               = G.ATTR_ELEM_TXT)      02510000
025200                  )                                               02520000
025300              AND H.DIVERT_TMST          <= :SU096-CURR-TMST      02530000
025301*                                                                 02530117
025302*** DMH 10/11/2016 BEGIN                                          02530217
025310              AND H.DIVERT_TMST          >= :PV-DIVERT-BEGIN-TMST 02531017
025330*** DMH 10/11/2016 BEGIN                                          02533017
025340*                                                                 02534017
025400                                                                  02540000
025500         GROUP BY  C.ATTR_ELEM_SEQ_NBR                            02550000
025600                 , C.ATTR_ELEM_NBR                                02560000
025700                 , D.ATTR_ELEM_TXT                                02570000
025800                 , E.ATTR_ELEM_TXT                                02580000
025900                 , F.ATTR_ELEM_TXT                                02590000
026000                 , G.ATTR_ELEM_TXT                                02600000
026100                 , H.OPER_UNT_ID                                  02610000
026200     END-EXEC.                                                    02620000
026300                                                                  02630000
026400                                                                  02640000
026500******************************************************************02650000
026600*  CURSOR TO BE USED TO DISPLAY THE OPEN LABOR ASSIGNMENTS        02660000
026700*  ADDED OPEN LABOR ASSIGNMENT CURSOR 4/8/13                      02670000
026800******************************************************************02680000
026810     EXEC SQL                                                     02681000
026820          DECLARE LABOR-ASGMT-CSR CURSOR FOR                      02682000
026830           SELECT A.WK_TYP_DESC                                   02683000
026840                , COUNT(*)                                        02684000
026850                , SUM(A.LAST_USD_SEQ_NBR)                         02685000
026860             FROM DLT_ASGMT A                                     02686000
026870            WHERE A.DC_NBR  =  :DK-OPER-UNT-ID                    02687000
026880              AND A.ASGMT_STP_TMST  IS NULL                       02688000
026890            GROUP BY A.WK_TYP_DESC                                02689000
026891            ORDER BY A.WK_TYP_DESC                                02689100
026892             WITH UR                                              02689200
026893     END-EXEC.                                                    02689300
026894                                                                  02689400
026895******************************************************************02689508
026896*  DB2 CURSOR DECLARATION - CONVEYOR CHECK BY SORTER              02689608
026897******************************************************************02689708
026898     EXEC SQL                                                     02689808
026899          DECLARE CNVYR-SORTER-CSR CURSOR FOR                     02689908
026901          SELECT   C.ATTR_ELEM_NBR     AS  SORTER_OPER            02690109
026902               ,   D.ATTR_ELEM_TXT     AS  SORTER_NAME            02690209
026903               ,   MAX(F.DIVERT_TMST)                             02690309
026904            FROM                                                  02690409
026905                  WST_INTGRTN_TYP  A                              02690509
026906               ,  WST_ATTR_DEFN    B                              02690609
026907               ,  WST_ATTR_ELEM    C                              02690709
026908               ,  WST_ATTR_ELEM    D                              02690809
026909               ,  WST_ATTR_ELEM    E                              02690909
026910               ,  TSUCRDV          F                              02691009
026911            WHERE                                                 02691109
026912                  A.INTGRTN_TYP_CDE   = 'DCCNVYSORT'              02691209
026913              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         02691309
026914              AND B.ATTR_DEFN_SEQ_NBR = 1                         02691409
026915              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         02691509
026916              AND C.ATTR_DEFN_SEQ_NBR = 1                         02691609
026917              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         02691709
026918              AND D.ATTR_DEFN_SEQ_NBR = 2                         02691809
026919              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         02691909
026920              AND E.ATTR_DEFN_SEQ_NBR = 3                         02692009
026921              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       02692109
026922              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       02692209
026923              AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID           02692309
026924                                                                  02692409
026925              AND C.ATTR_ELEM_NBR     =  F.OPER_UNT_ID            02692509
026926              AND E.ATTR_ELEM_TXT     =  F.DOOR_ID                02692609
026927              AND F.DIVERT_TMST      <= :SU096-CURR-TMST          02692709
026928*                                                                 02692817
026929*** DMH 10/11/2016 BEGIN                                          02692917
026930              AND F.DIVERT_TMST          >= :PV-DIVERT-BEGIN-TMST 02693017
026931*** DMH 10/11/2016 BEGIN                                          02693117
026932*                                                                 02693217
026933            GROUP BY                                              02693309
026934                   C.ATTR_ELEM_NBR                                02693409
026935               ,   D.ATTR_ELEM_TXT                                02693509
026936     END-EXEC.                                                    02693609
026937                                                                  02693709
026938******************************************************************02693809
026939 PROCEDURE DIVISION.                                              02693909
026940******************************************************************02694009
026941                                                                  02694109
026950******************************************************************02695009
027000* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02700008
027100*      PROGRAM.                                                   02710008
027200******************************************************************02720008
027300 0000-PROGRAM-MAINLINE.                                           02730008
027400                                                                  02740008
027500     PERFORM 1000-INITIALIZE.                                     02750008
027600                                                                  02760008
027700     PERFORM 1100-CHECK-NBR-CNVYR-VNDRS.                          02770008
027701                                                                  02770115
027702* DMH 10/11/16 BEGIN                                              02770215
027710     PERFORM 1200-CALC-BEGIN-DATE-BOOKEND.                        02771015
027711     MOVE  PV-NBR-DAYS-BACK      TO PV-DISP-NBR-DAYS              02771116
027713     DISPLAY 'CNVY CHECK DAYS==>  ' PV-DISP-NBR-DAYS              02771315
027714     DISPLAY '      FROM TMST==>  ' PV-DIVERT-BEGIN-TMST.         02771418
027720* DMH 10/11/16 END                                                02772015
027800                                                                  02780008
027900     IF  PS-MULTI-CONVEYOR-VENDORS                                02790008
028000         DISPLAY 'DC HAS MULTIPLE CONVEYOR VENDORS'               02800008
028100         PERFORM 2000-PROCESS-MULT-CNVYR-VNDRS                    02810008
028200     ELSE                                                         02820008
028201*                                                                 02820108
028202* DMH 8/15/16 - BEGIN                                             02820208
028203     IF  PS-SORTER-CONVEYOR-CHECK                                 02820308
028204         DISPLAY 'DC CHECK BASED ON SORTERS'                      02820414
028205         PERFORM 2700-PROCESS-CHECK-BY-SORTER                     02820508
028210     ELSE                                                         02821008
028220* DMH 8/15/16 - END                                               02822008
028230*                                                                 02823008
028300         DISPLAY 'DC HAS A SINGLE CONVEYOR VENDOR '               02830008
028400         PERFORM 2200-PROCESS-SNGL-CNVYR-VNDR                     02840008
028500     END-IF                                                       02850011
028510     END-IF.                                                      02851008
028600                                                                  02860008
028700*                                                                 02870008
028800*** DMH ADDED 4/9/13 - BEGIN                                      02880008
028900*                                                                 02890008
029000     IF  PS-NO-CONVEYOR-DIVERTS                                   02900008
029010         PERFORM 3000-CHECK-OPEN-ASGMTS                           02901008
029020     END-IF.                                                      02902008
029021*                                                                 02902108
029022*** DMH ADDED 4/9/13 - END                                        02902208
029023*                                                                 02902308
029024     MOVE   SPACES                      TO HEAD-REC.              02902408
029025     DISPLAY HEAD-REC.                                            02902508
029026     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02902608
029027                                                                  02902708
029028     STRING  'FROM DATE - '     SU096-BACK-TMST                   02902808
029029             '    SUKUT140'                                       02902908
029030                  DELIMITED BY SIZE                               02903008
029031                                      INTO HEAD-REC.              02903108
029032     DISPLAY HEAD-REC.                                            02903208
029033     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02903308
029034                                                                  02903408
029035     MOVE   SPACES                      TO HEAD-REC.              02903508
029036     DISPLAY HEAD-REC.                                            02903608
029037     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02903708
029038                                                                  02903808
029039     STRING  'TO DATE   - '     SU096-CURR-TMST                   02903908
029040             '    SUKUT140'                                       02904008
029041                  DELIMITED BY SIZE                               02904108
029042                                      INTO HEAD-REC.              02904208
029043     DISPLAY HEAD-REC.                                            02904308
029044     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02904408
029045                                                                  02904508
029046     MOVE '*****************************************'             02904608
029047                                        TO HEAD-REC.              02904708
029048     DISPLAY HEAD-REC.                                            02904808
029049     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02904908
029050                                                                  02905008
029051                                                                  02905108
029052     CLOSE SU-CNVYR-CNTL-FILE                                     02905208
029053           ERROR-OUT-FILE.                                        02905308
029054                                                                  02905408
029055*    IF THERE WERE NOT ANY CONVEYOR DIVERTS RECEIVED, SET THE     02905508
029056*    RETURN CODE SO THAT THE EMAIL WILL GET SENT OUT IN THE       02905608
029057*    NEXT STEP.                                                   02905708
029058     IF PS-NO-CONVEYOR-DIVERTS                                    02905808
029059         MOVE 4095 TO RETURN-CODE                                 02905908
029060     END-IF.                                                      02906008
029070                                                                  02907008
029080     STOP RUN.                                                    02908008
029090*                                                                 02909008
029100*0000-EXIT.                                                       02910008
029200*                                                                 02920008
029300*                                                                 02930008
029400***************************************************************** 02940008
029500*  INITIALIZATION PARAGRAPH                                       02950008
029600***************************************************************** 02960008
029700 1000-INITIALIZE.                                                 02970008
029800                                                                  02980008
029900     OPEN INPUT SU-CNVYR-CNTL-FILE                                02990008
030000         OUTPUT ERROR-OUT-FILE.                                   03000008
030100                                                                  03010008
030200     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           03020008
030300                                                                  03030008
030400     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD.              03040008
030500                                                                  03050008
030600     MOVE CC-OPER-UNT-ID       TO DK-OPER-UNT-ID                  03060008
030700                                  DK-LOC-ID.                      03070008
030800     SET PS-CONVEYOR-DIVERTS   TO TRUE.                           03080008
030900                                                                  03090008
031000     PERFORM 7000-READ-CNVYR-CNTL-REC.                            03100008
031100*                                                                 03110008
031200*1000-EXIT.                                                       03120008
031300*                                                                 03130008
031400*                                                                 03140008
031500******************************************************************03150008
031600*  FETCH A PARAMETER FROM THE TKRPRPM TABLE THAT INDICATES        03160008
031700*  THE NUMBER OF CONVEYOR VENDORS AT A DC.  SET THE SINGLE        03170008
031800*  VENDOR OR MULTIPLE VENDOR SWITCH ACCORDINGLY.                  03180008
031900******************************************************************03190008
032000 1100-CHECK-NBR-CNVYR-VNDRS.                                      03200008
032100                                                                  03210008
032200     INITIALIZE PV-SINGLE-CNVYR-VENDOR.                           03220008
032300                                                                  03230008
032400     PERFORM WITH TEST AFTER                                      03240008
032500       VARYING PV-COUNTER FROM 1 BY 1                             03250008
032600         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       03260008
032700                OR                                                03270008
032800                SQLCODE = ZERO)                                   03280008
032900                                                                  03290008
033000         EXEC SQL                                                 03300008
033100             SELECT FUNC_TXT AS SINGLE_CNVYR_VENDOR               03310008
033200               INTO :PV-SINGLE-CNVYR-VENDOR                       03320008
033300               FROM TKRPRPM                                       03330008
033400              WHERE LOC_ID            = :DK-LOC-ID                03340008
033500                AND SYS_PRC_FUNC_CDE  = 'CNVYCK'                  03350008
033600                AND INTFC_SYS_CDE     = 'KHL'                     03360008
033700                AND FUNC_PRC_STAT_CDE  = 'AC'                     03370008
033800                AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP        03380008
033900                AND FUNC_END_TMST     >= CURRENT TIMESTAMP        03390008
034000         END-EXEC                                                 03400008
034100                                                                  03410008
034200         EVALUATE TRUE                                            03420008
034300             WHEN SQLCODE = -904                                  03430008
034400             WHEN SQLCODE = -911                                  03440008
034500                 CONTINUE                                         03450008
034600             WHEN SQLCODE = ZERO                                  03460008
034700                 IF  PV-SINGLE-CNVYR-VENDOR = 'Y'                 03470008
034800                     SET PS-SINGLE-CONVEYOR-VENDOR                03480008
034900                                 TO TRUE                          03490008
035000                 ELSE                                             03500008
035001*                                                                 03500108
035002* DMH 8/15/16 - BEGIN                                             03500208
035010                 IF  PV-SINGLE-CNVYR-VENDOR = 'C'                 03501008
035100                     SET PS-SORTER-CONVEYOR-CHECK                 03510008
035200                                 TO TRUE                          03520008
035210                 ELSE                                             03521008
035211* DMH 8/15/16 - END                                               03521108
035212*                                                                 03521208
035220                     SET PS-MULTI-CONVEYOR-VENDORS                03522008
035230                                 TO TRUE                          03523008
035300                 END-IF                                           03530008
035310                 END-IF                                           03531008
035400             WHEN SQLWARN0 NOT = SPACES                           03540008
035500             WHEN SQLCODE < ZERO                                  03550008
035600             WHEN SQLCODE > ZERO                                  03560008
035700                 MOVE '1100-CHECK-NBR-CNVYR-VNDRS     '           03570008
035800                                 TO PV-ABEND-PARAGRAPH            03580008
035900                 MOVE 'FETCH DATA FROM TKRPRPM TABLE  '           03590008
036000                                 TO PV-ABEND-OPER-MESSAGE-1       03600008
036100                 MOVE 'TKRPRPM'  TO PV-ABEND-TABLE-1              03610008
036200                 PERFORM 9100-SQL-ABEND                           03620008
036300             WHEN SQLCODE = ZERO                                  03630008
036400                 CONTINUE                                         03640008
036500         END-EVALUATE                                             03650008
036600     END-PERFORM.                                                 03660008
036700                                                                  03670008
036800     IF PV-COUNTER > PC-MAX-RETRIES                               03680008
036900         MOVE '1100-CHECK-NBR-CNVYR-VNDRS  '                      03690008
037000                                 TO PV-ABEND-PARAGRAPH            03700008
037100         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'03710008
037200                                 TO PV-ABEND-OPER-MESSAGE-1       03720008
037300         MOVE 'TKRPRPM'          TO PV-ABEND-TABLE-1              03730008
037400         PERFORM 9100-SQL-ABEND                                   03740008
037500     END-IF.                                                      03750008
037501                                                                  03750115
037502                                                                  03750215
037510******************************************************************03751015
037520*  FETCH A PARAMETER FROM THE TKRPRPM TABLE THAT INDICATES        03752015
037530*  THE NUMBER OF DAYS PRIOR TO THE CURRENT DATE - THIS WILL SETN  03753015
037540*  THE BEGIN DATE BOOKEND FOR THE DIVERT CHECK.                   03754015
037541*  10/11/2016 - DMH                                               03754115
037550******************************************************************03755015
037560 1200-CALC-BEGIN-DATE-BOOKEND.                                    03756015
037570                                                                  03757015
037580     MOVE ZEROES  TO  PV-NBR-DAYS-BACK.                           03758015
037590                                                                  03759015
037591     PERFORM WITH TEST AFTER                                      03759115
037592       VARYING PV-COUNTER FROM 1 BY 1                             03759215
037593         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       03759315
037594                OR                                                03759415
037595                SQLCODE = ZERO)                                   03759515
037596                                                                  03759615
037597         EXEC SQL                                                 03759715
037598             SELECT FUNC_QTY                                      03759815
037599                  , CURRENT TIMESTAMP - FUNC_QTY DAYS             03759919
037600               INTO :PV-NBR-DAYS-BACK                             03760015
037601                  , :PV-DIVERT-BEGIN-TMST                         03760115
037602               FROM TKRPRPM                                       03760215
037603              WHERE LOC_ID            = :DK-LOC-ID                03760315
037604                AND SYS_PRC_FUNC_CDE  = 'CNVYDY'                  03760415
037605                AND INTFC_SYS_CDE     = 'KHL'                     03760515
037606                AND FUNC_PRC_STAT_CDE  = 'AC'                     03760615
037607                AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP        03760715
037608                AND FUNC_END_TMST     >= CURRENT TIMESTAMP        03760815
037609         END-EXEC                                                 03760915
037610                                                                  03761015
037611         EVALUATE TRUE                                            03761115
037612             WHEN SQLCODE = -904                                  03761215
037613             WHEN SQLCODE = -911                                  03761315
037614                 CONTINUE                                         03761415
037615             WHEN SQLCODE = ZERO                                  03761515
037616                 CONTINUE                                         03761615
037632             WHEN SQLWARN0 NOT = SPACES                           03763215
037633             WHEN SQLCODE < ZERO                                  03763315
037634             WHEN SQLCODE > ZERO                                  03763415
037635                 MOVE '1200-CALC-BEGIN-DATE-BOOKEND   '           03763515
037636                                 TO PV-ABEND-PARAGRAPH            03763615
037637                 MOVE 'FETCH DATA FROM TKRPRPM TABLE  '           03763715
037638                                 TO PV-ABEND-OPER-MESSAGE-1       03763815
037639                 MOVE 'TKRPRPM'  TO PV-ABEND-TABLE-1              03763915
037640                 PERFORM 9100-SQL-ABEND                           03764015
037641             WHEN SQLCODE = ZERO                                  03764115
037642                 CONTINUE                                         03764215
037643         END-EVALUATE                                             03764315
037644     END-PERFORM.                                                 03764415
037645                                                                  03764515
037646     IF PV-COUNTER > PC-MAX-RETRIES                               03764615
037647         MOVE '1200-CALC-BEGIN-DATE-BOOKEND'                      03764715
037648                                 TO PV-ABEND-PARAGRAPH            03764815
037649         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'03764915
037650                                 TO PV-ABEND-OPER-MESSAGE-1       03765015
037651         MOVE 'TKRPRPM'          TO PV-ABEND-TABLE-1              03765115
037652         PERFORM 9100-SQL-ABEND                                   03765215
037653     END-IF.                                                      03765315
037660                                                                  03766015
037700                                                                  03770015
038000******************************************************************03800008
038100*  THIS IS THE PROCESS WHERE THERE ARE MULTIPLE CONVEYOR VENDORS  03810008
038200*  AT A FACILITY.  FOR EACH CONVEYOR VENDOR, FETCH THE TIMESTAMP  03820008
038300*  OF THE LAST DIVERT.  IF THIS TIMESTAMP IS LATER THAN THE       03830008
038400*  CALCULATED TIMESTAMP, THIS MEANS THAT WE ARE RECEIVING DIVERTS 03840008
038500*  FROM THE DC.  IF THIS TIMESTAMP IS EARLIER THAN THE CALCULATED 03850008
038600*  TIMESTAMP, THIS MEANS THAT WE HAVE NOT RECEIVED DIVERTS FOR A  03860008
038700*  SPECIFIED PERIOD OF TIME, BASED ON THE CALCULATED TIMESTAMP.   03870008
038800*  ADDITIONAL CHECKING MUST BE DONE TO SEE IF AN ISSUE EXISTS.    03880008
038900******************************************************************03890008
039000 2000-PROCESS-MULT-CNVYR-VNDRS.                                   03900008
039100                                                                  03910008
039200     PERFORM 2050-OPEN-CNVYR-VEND-CSR.                            03920008
039300                                                                  03930008
039400     PERFORM 2060-FETCH-CNVYR-VEND-CSR.                           03940008
039500                                                                  03950008
040100     PERFORM 2100-PROCESS-CNVYR-VEND-CSR                          04010008
040200         UNTIL PS-END-OF-CURSOR.                                  04020008
040300                                                                  04030008
040400     PERFORM 2070-CLOSE-CNVYR-VEND-CSR.                           04040008
040500                                                                  04050008
040600*                                                                 04060008
040700*2000-EXIT.                                                       04070008
040800*                                                                 04080008
040900*                                                                 04090008
041000******************************************************************04100008
041100* OPEN THE CONVEYOR VENDOR CURSOR                                 04110008
041200******************************************************************04120008
041300 2050-OPEN-CNVYR-VEND-CSR.                                        04130008
041400                                                                  04140008
041500     PERFORM WITH TEST AFTER                                      04150008
041600       VARYING PV-COUNTER FROM 1 BY 1                             04160008
041700         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       04170008
041800                OR                                                04180008
041900                SQLCODE = ZERO)                                   04190008
042000                                                                  04200008
042100         EXEC SQL                                                 04210008
042200              OPEN CNVYR-VEND-CSR                                 04220008
042300         END-EXEC                                                 04230008
042400                                                                  04240008
042500         EVALUATE TRUE                                            04250008
042600             WHEN SQLCODE = +0                                    04260008
042700             WHEN SQLCODE = -904                                  04270008
042800             WHEN SQLCODE = -911                                  04280008
042900             WHEN SQLCODE = -913                                  04290008
043000                 CONTINUE                                         04300008
043100             WHEN SQLWARN0 NOT EQUAL SPACE                        04310008
043200             WHEN SQLCODE NOT EQUAL ZERO                          04320008
043300                 MOVE '2050-OPEN-CNVYR-VEND-CSR'                  04330008
043400                                      TO PV-ABEND-PARAGRAPH       04340008
043500                 MOVE 'ERROR OPENING CONVEYOR VENDOR CURSOR'      04350008
043600                                      TO PV-ABEND-OPER-MESSAGE-1  04360008
043700                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         04370008
043800                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        04380008
043900                         PV-OPER-UNT-ID-DISP                      04390008
044000                                         DELIMITED BY SIZE        04400008
044100                                   INTO PV-ABEND-OPER-MESSAGE-2   04410008
044200                 MOVE 'WST_INTGRTN_TYP'                           04420008
044300                                      TO PV-ABEND-TABLE-1         04430008
044400                 MOVE 'WST_ATTR_DEFN' TO PV-ABEND-TABLE-2         04440008
044500                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-3         04450008
044600                 MOVE 'TSUCRDV'       TO PV-ABEND-TABLE-4         04460008
044700                 PERFORM 9100-SQL-ABEND                           04470008
044800         END-EVALUATE                                             04480008
044900     END-PERFORM.                                                 04490008
045000                                                                  04500008
045100     IF  PV-COUNTER > PC-MAX-RETRIES                              04510008
045200         MOVE '2050-OPEN-CNVYR-VEND-CSR'                          04520008
045300                                      TO PV-ABEND-PARAGRAPH       04530008
045400         MOVE 'MAX RETRIES ERROR OPENING CONVEYOR VENDOR CURSOR'  04540008
045500                                      TO PV-ABEND-OPER-MESSAGE-1  04550008
045600         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         04560008
045700         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                04570008
045800                 PV-OPER-UNT-ID-DISP                              04580008
045900                                 DELIMITED BY SIZE                04590008
046000                                    INTO PV-ABEND-OPER-MESSAGE-2  04600008
046100         MOVE 'WST_INTGRTN_TYP'       TO PV-ABEND-TABLE-1         04610008
046200         MOVE 'WST_ATTR_DEFN'         TO PV-ABEND-TABLE-2         04620008
046300         MOVE 'WST_ATTR_ELEM'         TO PV-ABEND-TABLE-3         04630008
046400         MOVE 'TSUCRDV'               TO PV-ABEND-TABLE-4         04640008
046500         PERFORM 9100-SQL-ABEND                                   04650008
046600     END-IF.                                                      04660008
046700                                                                  04670008
046800                                                                  04680008
046900******************************************************************04690008
047000* FETCH A ROW FROM THE AUDIT CONTROL GROUP CURSOR.               *04700008
047100******************************************************************04710008
047200 2060-FETCH-CNVYR-VEND-CSR.                                       04720008
047300                                                                  04730008
047400     EXEC SQL                                                     04740008
047500          FETCH CNVYR-VEND-CSR                                    04750008
047600           INTO :WST00010-ATTR-ELEM-SEQ-NBR                       04760008
047700               ,:PV-DC-NBR                                        04770008
047800               ,:PV-CNVY-VENDOR                                   04780008
047900               ,:PV-BEGIN-RANGE                                   04790008
048000               ,:PV-END-RANGE                                     04800008
048100               ,:PV-ADDL-DOOR                                     04810008
048200               ,:SUCRDV-OPER-UNT-ID                               04820008
048300               ,:PV-MAX-DIVERT-TIMESTAMP                          04830008
048400     END-EXEC.                                                    04840008
048500                                                                  04850008
048600     EVALUATE TRUE                                                04860008
048700       WHEN SQLCODE = ZERO                                        04870008
048800          DISPLAY 'CONVEYOR VENDOR       ' PV-CNVY-VENDOR         04880008
048900          DISPLAY 'LAST DIVERT TIMESTAMP - '                      04890008
049000                   PV-MAX-DIVERT-TIMESTAMP                        04900008
049100           IF  PV-MAX-DIVERT-TIMESTAMP < SU096-BACK-TMST          04910008
049200               SET PS-ADDITIONAL-CHECK-NEEDED                     04920008
049300                                     TO TRUE                      04930008
049400           ELSE                                                   04940008
049500               SET PS-NO-ADDITIONAL-CHECK-NEEDED                  04950008
049600                                     TO TRUE                      04960008
049700           END-IF                                                 04970008
049800                                                                  04980008
049900       WHEN SQLCODE = +100                                        04990008
050000           SET PS-END-OF-CURSOR      TO TRUE                      05000008
050100       WHEN SQLWARN0 NOT EQUAL SPACE                              05010008
050200       WHEN SQLCODE NOT EQUAL ZERO                                05020008
050300           MOVE '2060-FETCH-CNVYR-VEND-CSR'                       05030008
050400                                     TO PV-ABEND-PARAGRAPH        05040008
050500           MOVE 'FETCH CONVEYOR VENDOR CURSOR ROW'                05050008
050600                                     TO PV-ABEND-OPER-MESSAGE-1   05060008
050700           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          05070008
050800           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              05080008
050900                   PV-OPER-UNT-ID-DISP                            05090008
051000                                   DELIMITED BY SIZE              05100008
051100                                   INTO PV-ABEND-OPER-MESSAGE-2   05110008
051200           MOVE 'WST_INTGRTN_TYP'    TO PV-ABEND-TABLE-1          05120008
051300           MOVE 'WST_ATTR_DEFN'      TO PV-ABEND-TABLE-2          05130008
051400           MOVE 'WST_ATTR_ELEM'      TO PV-ABEND-TABLE-3          05140008
051500           MOVE 'TSUCRDV'            TO PV-ABEND-TABLE-4          05150008
051600           PERFORM 9100-SQL-ABEND                                 05160008
051700     END-EVALUATE.                                                05170008
051800                                                                  05180008
051900                                                                  05190008
052000******************************************************************05200008
052100* CLOSE THE CONVEYOR VENDOR CURSOR                                05210008
052200******************************************************************05220008
052300 2070-CLOSE-CNVYR-VEND-CSR.                                       05230008
052400                                                                  05240008
052500     PERFORM                                                      05250008
052600         WITH TEST AFTER                                          05260008
052700         VARYING PV-COUNTER                                       05270008
052800         FROM 1 BY 1                                              05280008
052900         UNTIL ((PV-COUNTER > PC-MAX-RETRIES)                     05290008
053000                   OR (SQLCODE = ZERO))                           05300008
053100         EXEC SQL                                                 05310008
053200             CLOSE CNVYR-VEND-CSR                                 05320008
053300         END-EXEC                                                 05330008
053400                                                                  05340008
053500         EVALUATE TRUE                                            05350008
053600             WHEN SQLCODE = +0                                    05360008
053700             WHEN SQLCODE = -904                                  05370008
053800             WHEN SQLCODE = -911                                  05380008
053900             WHEN SQLCODE = -913                                  05390008
054000                 CONTINUE                                         05400008
054100             WHEN SQLWARN0 NOT EQUAL SPACE                        05410008
054200             WHEN SQLCODE NOT EQUAL ZERO                          05420008
054300                 MOVE '2070-CLOSE-CNVYR-VEND-CSR'                 05430008
054400                                      TO PV-ABEND-PARAGRAPH       05440008
054500                 MOVE 'ERROR CLOSING CONVEYOR VENDOR CURSOR'      05450008
054600                                      TO PV-ABEND-OPER-MESSAGE-1  05460008
054700                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         05470008
054800                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        05480008
054900                         PV-OPER-UNT-ID-DISP                      05490008
055000                                         DELIMITED BY SIZE        05500008
055100                                    INTO PV-ABEND-OPER-MESSAGE-2  05510008
055200                 MOVE 'WST_INTGRTN_TYP'                           05520008
055300                                      TO PV-ABEND-TABLE-1         05530008
055400                 MOVE 'WST_ATTR_DEFN' TO PV-ABEND-TABLE-2         05540008
055500                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-3         05550008
055600                 MOVE 'TSUCRDV'       TO PV-ABEND-TABLE-4         05560008
055700                 PERFORM 9100-SQL-ABEND                           05570008
055800         END-EVALUATE                                             05580008
055900     END-PERFORM.                                                 05590008
056000                                                                  05600008
056100     IF  PV-COUNTER > PC-MAX-RETRIES                              05610008
056200         MOVE '2070-CLOSE-CNVYR-VEND-CSR'                         05620008
056300                                      TO PV-ABEND-PARAGRAPH       05630008
056400         MOVE 'MAX RETRIES ERROR CLOSING AUDIT CNTL GROUP CURSOR' 05640008
056500                                      TO PV-ABEND-OPER-MESSAGE-1  05650008
056600         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         05660008
056700         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        05670008
056800                 PV-OPER-UNT-ID-DISP                              05680008
056900                                         DELIMITED BY SIZE        05690008
057000                                    INTO PV-ABEND-OPER-MESSAGE-2  05700008
057100         MOVE 'WST_INTGRTN_TYP'       TO PV-ABEND-TABLE-1         05710008
057200         MOVE 'WST_ATTR_DEFN'         TO PV-ABEND-TABLE-2         05720008
057300         MOVE 'WST_ATTR_ELEM'         TO PV-ABEND-TABLE-3         05730008
057400         MOVE 'TSUCRDV'               TO PV-ABEND-TABLE-4         05740008
057500         PERFORM 9100-SQL-ABEND                                   05750008
057600     END-IF.                                                      05760008
057700                                                                  05770008
057800                                                                  05780008
057900******************************************************************05790008
058000*  THIS CODE WILL PROCESS THE TIMESTAMP OF THE LAST DIVERT FOR    05800008
058100*  EACH CONVEYOR VENDOR.  IF THIS TIMESTAMP IS LATER THAN THE     05810008
058200*  CALCULATED TIMESTAMP, THIS MEANS THAT WE ARE RECEIVING DIVERTS 05820008
058300*  FROM THE SORTER FOR THE DC.  IF THIS TIMESTAMP IS EARLIER THAN 05830008
058400*  THE CALCULATED TIMESTAMP, THIS MEANS THAT WE HAVE NOT RECEIVED 05840008
058500*  DIVERTS FOR A SPECIFIED PERIOD OF TIME, BASED ON THE CALCULATED05850008
058600*  TIMESTAMP.  ADDITIONAL CHECKING MUST BE DONE TO SEE IF AN ISSUE05860008
058700*  EXISTS.                                                        05870008
058800******************************************************************05880008
058900 2100-PROCESS-CNVYR-VEND-CSR.                                     05890008
058910****                                                              05891008
058920**** FOR TEST ONLY                                                05892008
058930****             SET  PS-ADDITIONAL-CHECK-NEEDED TO TRUE          05893008
058940****                                                              05894008
058950****                                                              05895008
059000                                                                  05900008
059100     IF  PS-ADDITIONAL-CHECK-NEEDED                               05910008
059200         PERFORM 2350-FETCH-SEQ-NBR-PARM                          05920008
059300         PERFORM 2400-CHECK-OPEN-ASSIGNMENTS                      05930008
059400         IF  PV-OPEN-ASGMT-COUNT > 0                              05940008
059500             PERFORM 2500-CHECK-CLOSED-ASSIGNMENTS                05950008
059600             IF  PV-CLOSED-ASGMT-COUNT > 0                        05960008
059700                 SET PS-NO-CONVEYOR-DIVERTS TO TRUE               05970008
059800                 PERFORM 2600-SETUP-ERROR-REC                     05980008
059900             END-IF                                               05990008
060000         END-IF                                                   06000008
060100     END-IF.                                                      06010008
060200                                                                  06020008
060300     PERFORM 2060-FETCH-CNVYR-VEND-CSR.                           06030008
060400*                                                                 06040008
060500*2100-EXIT.                                                       06050008
060600*                                                                 06060008
060700*                                                                 06070008
060800******************************************************************06080008
060900*  THIS IS THE PROCESS WHERE THERE IS ONE CONVEYOR VENDOR AT A    06090008
061000*  FACILITY.  START BY FETCHING THE TIMESTAMP OF THE LAST DIVERT. 06100008
061100*  IF THIS TIMESTAMP IS LATER THAN THE CALCULATED TIMESTAMP, THIS 06110008
061200*  MEANS THAT WE ARE RECEIVING DIVERTS FROM THE SORTER FOR THE    06120008
061300*  DC.  IF THIS TIMESTAMP IS EARLIER THAN THE CALCULATED TIMESTAMP06130008
061400*  THIS MEANS THAT WE HAVE NOT RECEIVED DIVERTS FOR A SPECIFIED   06140008
061500*  PERIOD OF TIME, BASED ON THE CALCULATED TIMESTAMP.  ADDITIONAL 06150008
061600*  CHECKING MUST BE DONE TO SEE IF AN ISSUE EXISTS.               06160008
061700******************************************************************06170008
061800 2200-PROCESS-SNGL-CNVYR-VNDR.                                    06180008
061900                                                                  06190008
062000     PERFORM 2300-FETCH-LAST-DIVERT-TMST.                         06200008
062100                                                                  06210008
062200     IF  PS-ADDITIONAL-CHECK-NEEDED                               06220008
062300         PERFORM 2350-FETCH-SEQ-NBR-PARM                          06230008
062400         PERFORM 2400-CHECK-OPEN-ASSIGNMENTS                      06240008
062500         IF  PV-OPEN-ASGMT-COUNT > 0                              06250008
062600             PERFORM 2500-CHECK-CLOSED-ASSIGNMENTS                06260008
062700             IF  PV-CLOSED-ASGMT-COUNT > 0                        06270008
062800                 SET PS-NO-CONVEYOR-DIVERTS TO TRUE               06280008
062900                 PERFORM 2600-SETUP-ERROR-REC                     06290008
063000             END-IF                                               06300008
063100         END-IF                                                   06310008
063200     END-IF.                                                      06320008
063300*                                                                 06330008
063400*2200-EXIT.                                                       06340008
063500*                                                                 06350008
063600*                                                                 06360008
063700******************************************************************06370008
063800*  FETCH THE LAST DIVERT TIMESTAMP FROM THE CONTAINER DIVERT      06380008
063900*  TABLE (TSUCRDV).                                               06390008
064000******************************************************************06400008
064100 2300-FETCH-LAST-DIVERT-TMST.                                     06410008
064200                                                                  06420008
064300     INITIALIZE PV-MAX-DIVERT-TIMESTAMP.                          06430008
064400                                                                  06440008
064500     PERFORM WITH TEST AFTER                                      06450008
064600       VARYING PV-COUNTER FROM 1 BY 1                             06460008
064700         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       06470008
064800                OR                                                06480008
064900                SQLCODE = ZERO)                                   06490008
065000                                                                  06500008
065100         EXEC SQL                                                 06510008
065200             SELECT OPER_UNT_ID                                   06520008
065300                  , MAX(DIVERT_TMST)                              06530008
065400               INTO :SUCRDV-OPER-UNT-ID                           06540008
065500                  , :PV-MAX-DIVERT-TIMESTAMP                      06550008
065600               FROM TSUCRDV                                       06560008
065700              WHERE OPER_UNT_ID  = :DK-OPER-UNT-ID                06570008
065800                AND DIVERT_TMST <= :SU096-CURR-TMST               06580008
065810*                                                                 06581017
065820*** DMH 10/11/2016 BEGIN                                          06582017
065830              AND DIVERT_TMST          >= :PV-DIVERT-BEGIN-TMST   06583017
065840*** DMH 10/11/2016 BEGIN                                          06584017
065850*                                                                 06585017
065900           GROUP BY OPER_UNT_ID                                   06590008
066000         END-EXEC                                                 06600008
066100                                                                  06610008
066200         EVALUATE TRUE                                            06620008
066300             WHEN SQLCODE = -904                                  06630008
066400             WHEN SQLCODE = -911                                  06640008
066500                 CONTINUE                                         06650008
066510                                                                  06651020
066600             WHEN SQLCODE = +100                                  06660020
066601                 PERFORM 2310-FETCH-LAST-DIVERT-TMST              06660120
066602                                                                  06660220
066610             WHEN SQLCODE = ZERO                                  06661020
066700                 DISPLAY 'LAST DIVERT TIMESTAMP - '               06670008
066710                          PV-MAX-DIVERT-TIMESTAMP                 06671008
066720                 IF  PV-MAX-DIVERT-TIMESTAMP < SU096-BACK-TMST    06672008
066730                     SET PS-ADDITIONAL-CHECK-NEEDED               06673008
066740                                 TO TRUE                          06674008
066750                 ELSE                                             06675008
066760                     SET PS-NO-ADDITIONAL-CHECK-NEEDED            06676008
066770                                 TO TRUE                          06677008
066780                 END-IF                                           06678008
066790****                                                              06679008
066800**** FOR TEST ONLY                                                06680008
066900****             SET  PS-ADDITIONAL-CHECK-NEEDED TO TRUE          06690008
067000****                                                              06700008
067100****                                                              06710008
067200             WHEN SQLWARN0 NOT = SPACES                           06720008
067300             WHEN SQLCODE < ZERO                                  06730008
067400             WHEN SQLCODE > ZERO                                  06740008
067500                 MOVE '2300-FETCH-LAST-DIVERT-TMST    '           06750008
067600                                 TO PV-ABEND-PARAGRAPH            06760008
067700                 MOVE 'FETCH MAX DIVERT TIMESTAMP'                06770008
067800                                 TO PV-ABEND-OPER-MESSAGE-1       06780008
067900                 MOVE 'TSUCRDV'  TO PV-ABEND-TABLE-1              06790008
068000                 PERFORM 9100-SQL-ABEND                           06800008
068100             WHEN SQLCODE = ZERO                                  06810008
068200                 CONTINUE                                         06820008
068300         END-EVALUATE                                             06830008
068400     END-PERFORM.                                                 06840008
068500                                                                  06850008
068600     IF PV-COUNTER > PC-MAX-RETRIES                               06860008
068700         MOVE '2300-FETCH-LAST-DIVERT-TMST '                      06870008
068800                                 TO PV-ABEND-PARAGRAPH            06880008
068900         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF MAX DIVERT TMST'  06890008
069000                                 TO PV-ABEND-OPER-MESSAGE-1       06900008
069100         MOVE 'TSUCRDV'          TO PV-ABEND-TABLE-1              06910008
069200         PERFORM 9100-SQL-ABEND                                   06920008
069300     END-IF.                                                      06930008
069400*                                                                 06940008
069500*2300-EXIT.                                                       06950008
069600*                                                                 06960008
069700*                                                                 06970008
069710******************************************************************06971020
069720*  FETCH THE LAST DIVERT TIMESTAMP FROM THE CONTAINER DIVERT      06972020
069730*  TABLE (TSUCRDV).                                               06973020
069731*  THIS IS THE SAME SQL AS 2300-FETCH-LAST-DIVERT-TMST BUT        06973120
069732*  WITHOUT THE DAYS RESTRICTION.  THIS WAS PUT IN BECAUSE THE DC'S06973220
069733*  WERE CLOSED DUE TO THE COVID-19 VIRUS, DC'S WERE CLOSED        06973320
069740******************************************************************06974020
069750 2310-FETCH-LAST-DIVERT-TMST.                                     06975020
069760                                                                  06976020
069770     INITIALIZE PV-MAX-DIVERT-TIMESTAMP.                          06977020
069780                                                                  06978020
069790     PERFORM WITH TEST AFTER                                      06979020
069791       VARYING PV-COUNTER FROM 1 BY 1                             06979120
069792         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       06979220
069793                OR                                                06979320
069794                SQLCODE = ZERO)                                   06979420
069795                                                                  06979520
069796         EXEC SQL                                                 06979620
069797             SELECT OPER_UNT_ID                                   06979720
069798                  , MAX(DIVERT_TMST)                              06979820
069799               INTO :SUCRDV-OPER-UNT-ID                           06979920
069800                  , :PV-MAX-DIVERT-TIMESTAMP                      06980020
069801               FROM TSUCRDV                                       06980120
069802              WHERE OPER_UNT_ID  = :DK-OPER-UNT-ID                06980220
069803                AND DIVERT_TMST <= :SU096-CURR-TMST               06980320
069809           GROUP BY OPER_UNT_ID                                   06980920
069810         END-EXEC                                                 06981020
069811                                                                  06981120
069812         EVALUATE TRUE                                            06981220
069813             WHEN SQLCODE = -904                                  06981320
069814             WHEN SQLCODE = -911                                  06981420
069815                 CONTINUE                                         06981520
069816             WHEN SQLCODE = ZERO                                  06981620
069817                 DISPLAY 'LAST DIVERT TIMESTAMP - '               06981720
069818                          PV-MAX-DIVERT-TIMESTAMP                 06981820
069819                 IF  PV-MAX-DIVERT-TIMESTAMP < SU096-BACK-TMST    06981920
069820                     SET PS-ADDITIONAL-CHECK-NEEDED               06982020
069821                                 TO TRUE                          06982120
069822                 ELSE                                             06982220
069823                     SET PS-NO-ADDITIONAL-CHECK-NEEDED            06982320
069824                                 TO TRUE                          06982420
069825                 END-IF                                           06982520
069826                                                                  06982620
069831             WHEN SQLWARN0 NOT = SPACES                           06983120
069832             WHEN SQLCODE < ZERO                                  06983220
069833             WHEN SQLCODE > ZERO                                  06983320
069834                 MOVE '2310-FETCH-LAST-DIVERT-TMST    '           06983420
069835                                 TO PV-ABEND-PARAGRAPH            06983520
069836                 MOVE 'FETCH MAX DIVERT TIMESTAMP'                06983620
069837                                 TO PV-ABEND-OPER-MESSAGE-1       06983720
069838                 MOVE 'TSUCRDV'  TO PV-ABEND-TABLE-1              06983820
069839                 PERFORM 9100-SQL-ABEND                           06983920
069840             WHEN SQLCODE = ZERO                                  06984020
069841                 CONTINUE                                         06984120
069842         END-EVALUATE                                             06984220
069843     END-PERFORM.                                                 06984320
069844                                                                  06984420
069845     IF PV-COUNTER > PC-MAX-RETRIES                               06984520
069846         MOVE '2310-FETCH-LAST-DIVERT-TMST '                      06984620
069847                                 TO PV-ABEND-PARAGRAPH            06984720
069848         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF MAX DIVERT TMST'  06984820
069849                                 TO PV-ABEND-OPER-MESSAGE-1       06984920
069850         MOVE 'TSUCRDV'          TO PV-ABEND-TABLE-1              06985020
069851         PERFORM 9100-SQL-ABEND                                   06985120
069852     END-IF.                                                      06985220
069853                                                                  06985320
069854                                                                  06985420
069860******************************************************************06986008
069900*  FETCH THE LAST USED SEQUENCE NUMBER PARAMETER.  THIS PARAMETER 06990008
070000*  WILL BE USED AS PART OF THE OPEN ASSIGNMENTS CHECK AND THE     07000008
070010*  CLOSED ASSIGNMENTS CHECK TO DETERMINE IF A DC IS OPEN FOR      07001008
070020*  PROCESSING.                                                    07002008
070030******************************************************************07003008
070040 2350-FETCH-SEQ-NBR-PARM.                                         07004008
070050                                                                  07005008
070060     INITIALIZE DCLTKRPRPM.                                       07006008
070070                                                                  07007008
070080     PERFORM WITH TEST AFTER                                      07008008
070090       VARYING PV-COUNTER FROM 1 BY 1                             07009008
070091         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       07009108
070092                OR                                                07009208
070093                SQLCODE = ZERO)                                   07009308
070094                                                                  07009408
070095         EXEC SQL                                                 07009508
070096             SELECT FUNC_QTY                  AS PARM_SEQ_NBR     07009608
070097               INTO :PV-PARM-SEQ-NBR                              07009708
070098               FROM TKRPRPM                                       07009808
070099              WHERE LOC_ID            = 90                        07009908
070100                AND SYS_PRC_FUNC_CDE  = 'CNVYSQ'                  07010008
070101                AND INTFC_SYS_CDE     = 'KHL'                     07010108
070102                AND FUNC_PRC_STAT_CDE  = 'AC'                     07010208
070103                AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP        07010308
070104                AND FUNC_END_TMST     >= CURRENT TIMESTAMP        07010408
070105         END-EXEC                                                 07010508
070106                                                                  07010608
070107         EVALUATE TRUE                                            07010708
070108             WHEN SQLCODE = -904                                  07010808
070109             WHEN SQLCODE = -911                                  07010908
070110                 CONTINUE                                         07011008
070111             WHEN SQLWARN0 NOT = SPACES                           07011108
070112             WHEN SQLCODE < ZERO                                  07011208
070113             WHEN SQLCODE > ZERO                                  07011308
070114                 MOVE '2350-FETCH-SEQ-NBR-PARM        '           07011408
070115                                 TO PV-ABEND-PARAGRAPH            07011508
070116                 MOVE 'FETCH DATA FROM TKRPRPM TABLE  '           07011608
070117                                 TO PV-ABEND-OPER-MESSAGE-1       07011708
070118                 MOVE 'TKRPRPM'  TO PV-ABEND-TABLE-1              07011808
070119                 PERFORM 9100-SQL-ABEND                           07011908
070120             WHEN SQLCODE = ZERO                                  07012008
070121                 MOVE  PV-PARM-SEQ-NBR                            07012108
070122                                 TO  PV-DISPLAY-COUNT             07012208
070123                 DISPLAY 'PARM SEQUENCE NUMBER -    '             07012308
070124                              PV-DISPLAY-COUNT                    07012408
070125         END-EVALUATE                                             07012508
070126     END-PERFORM.                                                 07012608
070127                                                                  07012708
070128     IF PV-COUNTER > PC-MAX-RETRIES                               07012808
070129         MOVE '2350-FETCH-SEQ-NBR-PARM     '                      07012908
070130                                 TO PV-ABEND-PARAGRAPH            07013008
070131         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'07013108
070132                                 TO PV-ABEND-OPER-MESSAGE-1       07013208
070133         MOVE 'TKRPRPM'          TO PV-ABEND-TABLE-1              07013308
070134         PERFORM 9100-SQL-ABEND                                   07013408
070135     END-IF.                                                      07013508
070136*                                                                 07013608
070137*2350-EXIT.                                                       07013708
070138*                                                                 07013808
070139*                                                                 07013908
070140******************************************************************07014008
070150*  CHECK IF THERE ARE ANY OPEN ASSIGNMENTS FOR THE SPECIFIED DC.  07015008
070160******************************************************************07016008
070170 2400-CHECK-OPEN-ASSIGNMENTS.                                     07017008
070180                                                                  07018008
070190     INITIALIZE DCLDLT00004                                       07019008
070200                PV-OPEN-ASGMT-COUNT                               07020008
070300                                                                  07030008
070400     PERFORM WITH TEST AFTER                                      07040008
070500       VARYING PV-COUNTER FROM 1 BY 1                             07050008
070600         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       07060008
070700                OR                                                07070008
070800                SQLCODE = ZERO                                    07080008
070900                OR                                                07090008
071000                SQLCODE = +100)                                   07100008
071100                                                                  07110008
071200**       EXEC SQL                                                 07120008
071300**           SELECT A.DC_NBR                                      07130008
071400**                , COUNT(*) AS OPEN_ASGMT_COUNT                  07140008
071500**             INTO :DLT00004-DC-NBR                              07150008
071600**                , :PV-OPEN-ASGMT-COUNT                          07160008
071700**             FROM DLT_ASGMT A                                   07170008
071800**            WHERE A.DC_NBR         = :DK-LOC-ID                 07180008
071900**              AND (A.WK_TYP_DESC LIKE 'RECV%'                   07190008
072000**               OR  A.WK_TYP_DESC LIKE 'P2L%')                   07200008
072100**              AND A.ASGMT_STP_TMST IS NULL                      07210008
072200**              AND A.LAST_USD_SEQ_NBR > :PV-PARM-SEQ-NBR         07220008
072300**         GROUP BY A.DC_NBR                                      07230008
072400**       END-EXEC                                                 07240008
072500                                                                  07250008
072600         EXEC SQL                                                 07260008
072700             SELECT 1                                             07270008
072710               INTO :PV-OPEN-ASGMT-COUNT                          07271008
072720               FROM DLT_ASGMT A                                   07272008
072730              WHERE A.DC_NBR         = :DK-LOC-ID                 07273008
072740                AND (A.WK_TYP_DESC LIKE 'RECV%'                   07274008
072750                 OR  A.WK_TYP_DESC LIKE 'P2L%')                   07275008
072760                AND A.ASGMT_STP_TMST IS NULL                      07276008
072770                AND A.LAST_USD_SEQ_NBR > :PV-PARM-SEQ-NBR         07277008
072780           FETCH FIRST 1 ROW ONLY                                 07278008
072790         END-EXEC                                                 07279008
072791                                                                  07279108
072792         EVALUATE TRUE                                            07279208
072793             WHEN SQLCODE = ZERO                                  07279308
072794                  MOVE 1  TO  PV-OPEN-ASGMT-COUNT                 07279408
072795                  MOVE  PV-OPEN-ASGMT-COUNT                       07279508
072796                          TO  PV-DISPLAY-COUNT                    07279608
072797                  DISPLAY 'OPEN ASSIGNMENT COUNT -   '            07279708
072798                           PV-DISPLAY-COUNT                       07279808
072799                                                                  07279908
072800             WHEN SQLCODE = +100                                  07280008
072900             WHEN SQLCODE = -904                                  07290008
073000             WHEN SQLCODE = -911                                  07300008
073100                  MOVE  0  TO  PV-OPEN-ASGMT-COUNT                07310008
073200                  DISPLAY 'THERE WERE NOT ANY OPEN '              07320008
073210                          'ASSIGNMENTS FOUND FOR THIS DC'         07321008
073220                                                                  07322008
073230             WHEN SQLWARN0 NOT = SPACES                           07323008
073240             WHEN SQLCODE < ZERO                                  07324008
073250             WHEN SQLCODE > ZERO                                  07325008
073260                  MOVE  0  TO  PV-OPEN-ASGMT-COUNT                07326008
073270                 MOVE '2400-CHECK-OPEN-ASSIGNMENTS    '           07327008
073280                                 TO PV-ABEND-PARAGRAPH            07328008
073290                 MOVE 'CHECK FOR OPEN ASSIGNMENTS  '              07329008
073300                                 TO PV-ABEND-OPER-MESSAGE-1       07330008
073400                 MOVE 'DLT_ASGMT'                                 07340008
073500                                 TO PV-ABEND-TABLE-1              07350008
073600                 PERFORM 9100-SQL-ABEND                           07360008
073700         END-EVALUATE                                             07370008
073800     END-PERFORM.                                                 07380008
073900                                                                  07390008
074000     IF PV-COUNTER > PC-MAX-RETRIES                               07400008
074100         MOVE '2400-CHECK-OPEN-ASSIGNMENTS '                      07410008
074200                                 TO PV-ABEND-PARAGRAPH            07420008
074300         MOVE 'MAX RETRIES EXCEEDED CHECK FOR OPEN ASSIGNMENTS'   07430008
074400                                 TO PV-ABEND-OPER-MESSAGE-1       07440008
074500         MOVE 'DLT_ASGMT'        TO PV-ABEND-TABLE-1              07450008
074600         PERFORM 9100-SQL-ABEND                                   07460008
074700     END-IF.                                                      07470008
074800*                                                                 07480008
074900*2400-EXIT.                                                       07490008
075000*                                                                 07500008
075100*                                                                 07510008
075200******************************************************************07520008
075300*  CHECK IF THERE ARE ANY CLOSED ASSIGNMENTS FOR THE SPECIFIED    07530008
075400*  DC.                                                            07540008
075500******************************************************************07550008
075600 2500-CHECK-CLOSED-ASSIGNMENTS.                                   07560008
075700                                                                  07570008
075800     INITIALIZE DCLDLT00004                                       07580008
075900                PV-CLOSED-ASGMT-COUNT                             07590008
076000                                                                  07600008
076100     PERFORM WITH TEST AFTER                                      07610008
076200       VARYING PV-COUNTER FROM 1 BY 1                             07620008
076300         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       07630008
076400                OR                                                07640008
076500                SQLCODE = ZERO                                    07650008
076600                OR                                                07660008
076700                SQLCODE = +100)                                   07670008
076800                                                                  07680008
076900**       EXEC SQL                                                 07690008
077000**           SELECT A.DC_NBR                                      07700008
077100**                , COUNT(*) AS CLOSED_ASGMT_COUNT                07710008
077200**             INTO :DLT00004-DC-NBR                              07720008
077300**                , :PV-CLOSED-ASGMT-COUNT                        07730008
077400**             FROM DLT_ASGMT A                                   07740008
077500**            WHERE A.DC_NBR          = :DK-LOC-ID                07750008
077600**              AND (A.WK_TYP_DESC LIKE 'RECV%'                   07760008
077700**               OR  A.WK_TYP_DESC LIKE 'P2L%')                   07770008
077800**              AND A.ASGMT_STP_TMST >= :SU096-BACK-TMST          07780008
077900**              AND A.LAST_USD_SEQ_NBR > :PV-PARM-SEQ-NBR         07790008
078000**         GROUP BY A.DC_NBR                                      07800008
078100**       END-EXEC                                                 07810008
078200                                                                  07820008
078300         EXEC SQL                                                 07830008
078400             SELECT  1                                            07840008
078500               INTO :PV-CLOSED-ASGMT-COUNT                        07850008
078600               FROM DLT_ASGMT A                                   07860008
078700              WHERE A.DC_NBR          = :DK-LOC-ID                07870008
078800                AND (A.WK_TYP_DESC LIKE 'RECV%'                   07880008
078810                 OR  A.WK_TYP_DESC LIKE 'P2L%')                   07881008
078820                AND A.ASGMT_STP_TMST >= :SU096-BACK-TMST          07882008
078830                AND A.LAST_USD_SEQ_NBR > :PV-PARM-SEQ-NBR         07883008
078840           FETCH FIRST 1 ROW ONLY                                 07884008
078850         END-EXEC                                                 07885008
078860                                                                  07886008
078870         EVALUATE TRUE                                            07887008
078880             WHEN SQLCODE = ZERO                                  07888008
078890                  MOVE  1  TO  PV-CLOSED-ASGMT-COUNT              07889008
078900                  MOVE  PV-CLOSED-ASGMT-COUNT                     07890008
079000                              TO  PV-DISPLAY-COUNT                07900008
079010                  DISPLAY 'CLOSED ASSIGNMENT COUNT - '            07901008
079020                           PV-DISPLAY-COUNT                       07902008
079030                                                                  07903008
079040             WHEN SQLCODE = +100                                  07904008
079050             WHEN SQLCODE = -904                                  07905008
079060             WHEN SQLCODE = -911                                  07906008
079070                  MOVE 0  TO  PV-CLOSED-ASGMT-COUNT               07907008
079080                  DISPLAY 'THERE WERE NOT ANY CLOSED '            07908008
079090                          'ASSIGNMENTS FOUND FOR THIS DC'         07909008
079100                                                                  07910008
079200             WHEN SQLWARN0 NOT = SPACES                           07920008
079300             WHEN SQLCODE < ZERO                                  07930008
079400             WHEN SQLCODE > ZERO                                  07940008
079500                 MOVE '2500-CHECK-CLOSED-ASSIGNMENTS  '           07950008
079600                                 TO PV-ABEND-PARAGRAPH            07960008
079700                 MOVE 'CHECK FOR CLOSED ASSIGNMENTS'              07970008
079800                                 TO PV-ABEND-OPER-MESSAGE-1       07980008
079900                 MOVE 'DLT_ASGMT'                                 07990008
080000                                 TO PV-ABEND-TABLE-1              08000008
080100                 PERFORM 9100-SQL-ABEND                           08010008
080200         END-EVALUATE                                             08020008
080300     END-PERFORM.                                                 08030008
080400                                                                  08040008
080500     IF PV-COUNTER > PC-MAX-RETRIES                               08050008
080600         MOVE '2500-CHECK-CLOSED-ASSIGNMENTS'                     08060008
080700                                 TO PV-ABEND-PARAGRAPH            08070008
080800         MOVE 'MAX RETRIES EXCEEDED CHECK FOR CLOSED ASSIGNMENTS' 08080008
080900                                 TO PV-ABEND-OPER-MESSAGE-1       08090008
081000         MOVE 'DLT_ASGMT'        TO PV-ABEND-TABLE-1              08100008
081100         PERFORM 9100-SQL-ABEND                                   08110008
081200     END-IF.                                                      08120008
081300*                                                                 08130008
081400*2500-EXIT.                                                       08140008
081500*                                                                 08150008
081600*                                                                 08160008
081700******************************************************************08170008
081800*  SET UP THE ERROR RECORD THAT WILL BE WRITTEN TO A FILE AND     08180008
081900*  ALSO DISPLAYED IN SYSOUT WHEN THERE HAVE NOT BEEN CONTAINER    08190008
082000*  DIVERTS RECEIVED FOR A DC AND THEY ARE OPEN FOR PROCESSING.    08200008
082100******************************************************************08210008
082200 2600-SETUP-ERROR-REC.                                            08220008
082300                                                                  08230008
082400     MOVE '*****************************************'             08240008
082500                                        TO HEAD-REC.              08250008
085110*                                                                 08511008
085120*** ADDED 4/10/13 - BEGIN                                         08512008
085130*                                                                 08513008
085131     MOVE SPACES                        TO HEAD-REC.              08513108
085132     DISPLAY HEAD-REC.                                            08513208
085133     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08513308
085134                                                                  08513408
085135     MOVE SPACES                        TO HEAD-REC.              08513508
085136     STRING  'THE MAINFRAME IS NOT CURRENTLY LOGGING '            08513608
085137             'CARTON DIVERTS'                                     08513708
085138                  DELIMITED BY SIZE                               08513808
085139                                      INTO HEAD-REC.              08513908
085140     DISPLAY HEAD-REC.                                            08514008
085141     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08514108
085142                                                                  08514208
085143     MOVE SPACES                        TO HEAD-REC.              08514308
085147     DISPLAY HEAD-REC.                                            08514708
085148     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08514808
085149                                                                  08514908
085150     MOVE SPACES                        TO HEAD-REC.              08515008
085151     STRING  'IS YOUR SHIPPING CONVEYOR RUNNING?'                 08515108
085152                  DELIMITED BY SIZE                               08515208
085153                                      INTO HEAD-REC.              08515308
085154     DISPLAY HEAD-REC.                                            08515408
085155     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08515508
085156                                                                  08515608
085157*                                                                 08515708
085158*** ADDED 4/10/13 - END                                           08515808
085160*                                                                 08516008
085200     MOVE SPACES                        TO HEAD-REC.              08520008
085300     DISPLAY HEAD-REC.                                            08530008
085400     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08540008
085500                                                                  08550008
085600     STRING  'CONVEYOR DIVERTS HAVE NOT BEEN RECEIVED FOR '       08560008
085700              CC-CONTROL-CARD                                     08570008
085800                  DELIMITED BY SIZE                               08580008
085900                                      INTO HEAD-REC.              08590008
086000     DISPLAY HEAD-REC.                                            08600008
086100     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08610008
086200                                                                  08620008
086300** ADDED 4/9/13 BEGIN                                             08630008
086400     MOVE SPACES                        TO HEAD-REC               08640008
086500     DISPLAY HEAD-REC.                                            08650008
086510     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08651008
086520** ADDED 4/9/13 END                                               08652008
086530                                                                  08653008
086540     IF  PS-MULTI-CONVEYOR-VENDORS                                08654008
086550         MOVE SPACES                    TO HEAD-REC               08655008
086560         STRING  'TIMESTAMP OF LAST DIVERT THAT WAS RECEIVED '    08656008
086570                      DELIMITED BY SIZE                           08657008
086580                 'FROM CONVEYOR VENDOR '                          08658008
086590                      DELIMITED BY SIZE                           08659008
086600                  PV-CNVY-VENDOR                                  08660008
086700                      DELIMITED BY '  '                           08670008
086800                  ':'                                             08680008
086900                      DELIMITED BY SIZE                           08690008
087000                                      INTO HEAD-REC               08700008
087100         DISPLAY HEAD-REC                                         08710008
087200         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08720008
087300         MOVE SPACES                    TO HEAD-REC               08730008
087400         STRING PV-MAX-TMST-DATE-CST                              08740008
087500                '  @  '                                           08750008
087600                PV-MAX-TMST-HHMM-CST                              08760008
087700                ' CENTRAL'                                        08770008
087800                                           DELIMITED BY SIZE      08780008
087900                                      INTO HEAD-REC               08790008
088000         DISPLAY HEAD-REC                                         08800008
088100         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08810008
088101*                                                                 08810109
088102* DMH 8/16/16 BEGIN                                               08810209
088103*                                                                 08810309
088104     ELSE                                                         08810413
088110     IF  PS-SORTER-CONVEYOR-CHECK                                 08811009
088120         MOVE SPACES                    TO HEAD-REC               08812009
088130         STRING  'TIMESTAMP OF LAST DIVERT THAT WAS RECEIVED '    08813009
088140                      DELIMITED BY SIZE                           08814009
088150                 'FROM CONVEYOR SORTER:'                          08815009
088170                  PV-SORTER-NAME                                  08817009
088180                      DELIMITED BY '  '                           08818009
088190                  ':'                                             08819009
088191                      DELIMITED BY SIZE                           08819109
088192                                      INTO HEAD-REC               08819209
088193         DISPLAY HEAD-REC                                         08819309
088194         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08819409
088195         MOVE SPACES                    TO HEAD-REC               08819509
088196         STRING PV-MAX-TMST-DATE-CST                              08819609
088197                '  @  '                                           08819709
088198                PV-MAX-TMST-HHMM-CST                              08819809
088199                ' CENTRAL'                                        08819909
088200                                           DELIMITED BY SIZE      08820009
088201                                      INTO HEAD-REC               08820109
088202         DISPLAY HEAD-REC                                         08820209
088203         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08820309
088204*                                                                 08820409
088205* DMH 8/16/16 END                                                 08820509
088206*                                                                 08820609
088210     ELSE                                                         08821008
088300         MOVE SPACES                    TO HEAD-REC               08830008
088400         STRING  'TIMESTAMP OF LAST DIVERT THAT WAS RECEIVED: '   08840008
088500                      DELIMITED BY SIZE                           08850008
088600                                      INTO HEAD-REC               08860008
088700         DISPLAY HEAD-REC                                         08870008
088800         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08880008
088900         MOVE SPACES                    TO HEAD-REC               08890008
089000         STRING PV-MAX-TMST-DATE-CST                              08900008
089100                '  @  '                                           08910008
089200                PV-MAX-TMST-HHMM-CST                              08920008
089300                ' CENTRAL'                                        08930008
089310                                           DELIMITED BY SIZE      08931008
089320                                      INTO HEAD-REC               08932008
089330         DISPLAY HEAD-REC                                         08933008
089340         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08934008
089350     END-IF                                                       08935009
089351     END-IF.                                                      08935109
089360                                                                  08936008
089370     MOVE SPACES                        TO HEAD-REC.              08937008
089380     DISPLAY HEAD-REC.                                            08938008
089390     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08939008
089400                                                                  08940008
089500     MOVE '*****************************************'             08950008
089600                                        TO HEAD-REC.              08960008
089700     DISPLAY HEAD-REC.                                            08970008
089800     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08980008
089900                                                                  08990008
090000     MOVE SPACES                        TO HEAD-REC.              09000008
090100     DISPLAY HEAD-REC.                                            09010008
090200     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09020008
090300                                                                  09030008
090400*2600-EXIT.                                                       09040008
090500*                                                                 09050008
090600*                                                                 09060008
090700******************************************************************09070008
090800*  ADD DISPLAY OF OPEN LABOR ASSIGNMENTS TO THE CONVEYOR E-MAIL   09080008
090900*  THIS WILL BE USED TO DETERMINE IF THE DC IS ACTUALLY WORKING   09090008
091000*  ADDED 4/9/13                                                   09100008
091100******************************************************************09110008
091200 2610-DISPLAY-OPEN-ASGMT.                                         09120008
091300                                                                  09130008
091400     EVALUATE TRUE                                                09140008
091500         WHEN DLT00004-WK-TYP-DESC  = 'FLAT        '              09150008
091600              INITIALIZE PV-ASGMT-MSG-FLAT                        09160008
091610              MOVE  PV-ASGMT-COUNT TO PV-MSG-FLAT-CNT             09161008
091611              MOVE  PV-EVENT-SUM   TO PV-MSG-FLAT-SUM             09161108
091612              MOVE PV-ASGMT-MSG-FLAT  TO HEAD-REC                 09161208
091613         WHEN DLT00004-WK-TYP-DESC  = 'SHIP        '              09161308
091614              INITIALIZE PV-ASGMT-MSG-SHIP                        09161408
091615              MOVE  PV-ASGMT-COUNT TO PV-MSG-SHIP-CNT             09161508
091616              MOVE  PV-EVENT-SUM   TO PV-MSG-SHIP-SUM             09161608
091617              MOVE PV-ASGMT-MSG-SHIP  TO HEAD-REC                 09161708
091618         WHEN DLT00004-WK-TYP-DESC  = 'P2L         '              09161808
091619              INITIALIZE PV-ASGMT-MSG-P2L                         09161908
091620              MOVE  PV-ASGMT-COUNT TO PV-MSG-P2L-CNT              09162008
091630              MOVE  PV-EVENT-SUM   TO PV-MSG-P2L-SUM              09163008
091631              MOVE PV-ASGMT-MSG-P2L  TO HEAD-REC                  09163108
091632         WHEN DLT00004-WK-TYP-DESC  = 'RECV        '              09163208
091633              INITIALIZE PV-ASGMT-MSG-RECV                        09163308
091634              MOVE  PV-ASGMT-COUNT TO PV-MSG-RECV-CNT             09163408
091635              MOVE  PV-EVENT-SUM   TO PV-MSG-RECV-SUM             09163508
091636              MOVE PV-ASGMT-MSG-RECV  TO HEAD-REC                 09163608
091637         WHEN DLT00004-WK-TYP-DESC  = 'RLABL       '              09163708
091638              INITIALIZE PV-ASGMT-MSG-RLABL                       09163808
091639              MOVE  PV-ASGMT-COUNT TO PV-MSG-RLABL-CNT            09163908
091640              MOVE  PV-EVENT-SUM   TO PV-MSG-RLABL-SUM            09164008
091650              MOVE PV-ASGMT-MSG-RLABL  TO HEAD-REC                09165008
091651         WHEN DLT00004-WK-TYP-DESC =  'MASTCON     '              09165108
091652              INITIALIZE PV-ASGMT-MSG-MASTCON                     09165208
091653              MOVE  PV-ASGMT-COUNT TO PV-MSG-MAST-CNT             09165308
091654              MOVE  PV-EVENT-SUM   TO PV-MSG-MAST-SUM             09165408
091655              MOVE PV-ASGMT-MSG-MASTCON  TO HEAD-REC              09165508
091656         WHEN OTHER                                               09165608
091657              INITIALIZE PV-ASGMT-MSG-OTHER                       09165708
091658              MOVE DLT00004-WK-TYP-DESC TO PV-MSG-OTHER           09165808
091659              MOVE PV-ASGMT-COUNT TO PV-MSG-OTH-CNT               09165908
091660              MOVE PV-EVENT-SUM   TO PV-MSG-OTH-SUM               09166008
091661              MOVE PV-ASGMT-MSG-OTHER  TO HEAD-REC                09166108
091662     END-EVALUATE.                                                09166208
091663                                                                  09166308
091664     DISPLAY HEAD-REC.                                            09166408
091665     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09166508
091666                                                                  09166608
091667                                                                  09166708
091668******************************************************************09166808
091669*  THIS IS THE PROCESS WHERE WE WILL BE CHECKING BY THE SORTERS   09166908
091670*  AT A FACILITY.  FOR EACH SORTER VENDOR, FETCH THE TIMESTAMP    09167008
091671*  OF THE LAST DIVERT.  IF THIS TIMESTAMP IS LATER THAN THE       09167108
091672*  CALCULATED TIMESTAMP, THIS MEANS THAT WE ARE RECEIVING DIVERTS 09167208
091673*  FROM THE DC.  IF THIS TIMESTAMP IS EARLIER THAN THE CALCULATED 09167308
091674*  TIMESTAMP, THIS MEANS THAT WE HAVE NOT RECEIVED DIVERTS FOR A  09167408
091675*  SPECIFIED PERIOD OF TIME, BASED ON THE CALCULATED TIMESTAMP.   09167508
091676*  ADDITIONAL CHECKING MUST BE DONE TO SEE IF AN ISSUE EXISTS.    09167608
091677*  DMH 8/15/16                                                    09167708
091678******************************************************************09167808
091679 2700-PROCESS-CHECK-BY-SORTER.                                    09167908
091680                                                                  09168008
091681     PERFORM 2710-OPEN-CNVYR-SORTER-CSR.                          09168108
091682                                                                  09168208
091683     PERFORM 2720-FETCH-CNVYR-SORTER-CSR.                         09168308
091684                                                                  09168408
091685     PERFORM 2730-PROCESS-CNVYR-SORTER-CSR                        09168508
091686         UNTIL PS-END-OF-CURSOR.                                  09168608
091687                                                                  09168708
091688     PERFORM 2740-CLOSE-CNVYR-SORTER-CSR.                         09168808
091689                                                                  09168908
091690                                                                  09169008
091710******************************************************************09171008
091711*                                                                 09171108
091712*  DMH 8/15/16                                                    09171208
091713******************************************************************09171308
091714 2710-OPEN-CNVYR-SORTER-CSR.                                      09171408
091715                                                                  09171508
091716     PERFORM                                                      09171608
091717         WITH TEST AFTER                                          09171708
091718         VARYING PV-COUNTER                                       09171808
091719         FROM 1 BY 1                                              09171908
091720         UNTIL ((PV-COUNTER > PC-MAX-RETRIES)                     09172008
091721                   OR (SQLCODE = ZERO))                           09172108
091722         EXEC SQL                                                 09172208
091723             OPEN  CNVYR-SORTER-CSR                               09172308
091724         END-EXEC                                                 09172408
091725                                                                  09172508
091726         EVALUATE TRUE                                            09172608
091727             WHEN SQLCODE = +0                                    09172708
091728             WHEN SQLCODE = -904                                  09172808
091729             WHEN SQLCODE = -911                                  09172908
091730             WHEN SQLCODE = -913                                  09173008
091731                 CONTINUE                                         09173108
091732             WHEN SQLWARN0 NOT EQUAL SPACE                        09173208
091733             WHEN SQLCODE NOT EQUAL ZERO                          09173308
091734                 MOVE '2710-OPEN-CNVYR-SORTER-CSR'                09173408
091735                                      TO PV-ABEND-PARAGRAPH       09173508
091736                 MOVE 'ERROR OPENING CONVEYOR SORTER CURSOR'      09173608
091737                                      TO PV-ABEND-OPER-MESSAGE-1  09173708
091738                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09173808
091739                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09173908
091740                         PV-OPER-UNT-ID-DISP                      09174008
091741                                         DELIMITED BY SIZE        09174108
091742                                    INTO PV-ABEND-OPER-MESSAGE-2  09174208
091743                 MOVE 'WST_INTGRTN_TYP'                           09174308
091744                                      TO PV-ABEND-TABLE-1         09174408
091745                 MOVE 'WST_ATTR_DEFN' TO PV-ABEND-TABLE-2         09174508
091746                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-3         09174608
091747                 PERFORM 9100-SQL-ABEND                           09174708
091748         END-EVALUATE                                             09174808
091749     END-PERFORM.                                                 09174908
091750                                                                  09175008
091751     IF  PV-COUNTER > PC-MAX-RETRIES                              09175108
091752         MOVE '2710-OPEN-CNVYR-SORTER-CSR'                        09175208
091753                                      TO PV-ABEND-PARAGRAPH       09175308
091754         MOVE 'MAX RETRIES ERROR OPENING CONVEYOR SORTER CURSOR'  09175408
091755                                      TO PV-ABEND-OPER-MESSAGE-1  09175508
091756         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09175608
091757         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        09175708
091758                 PV-OPER-UNT-ID-DISP                              09175808
091759                                         DELIMITED BY SIZE        09175908
091760                                    INTO PV-ABEND-OPER-MESSAGE-2  09176008
091761         MOVE 'WST_INTGRTN_TYP'       TO PV-ABEND-TABLE-1         09176108
091762         MOVE 'WST_ATTR_DEFN'         TO PV-ABEND-TABLE-2         09176208
091763         MOVE 'WST_ATTR_ELEM'         TO PV-ABEND-TABLE-3         09176308
091764         PERFORM 9100-SQL-ABEND                                   09176408
091765     END-IF.                                                      09176508
091766                                                                  09176608
091767                                                                  09176708
091768******************************************************************09176808
091769*                                                                 09176908
091770*  DMH 8/15/16                                                    09177008
091771******************************************************************09177108
091772 2720-FETCH-CNVYR-SORTER-CSR.                                     09177208
091774                                                                  09177409
091775     EXEC SQL                                                     09177509
091776          FETCH CNVYR-SORTER-CSR                                  09177609
091780           INTO :PV-DC-NBR                                        09178009
091781               ,:PV-SORTER-NAME                                   09178109
091787               ,:PV-MAX-DIVERT-TIMESTAMP                          09178709
091788     END-EXEC.                                                    09178809
091789                                                                  09178909
091790     EVALUATE TRUE                                                09179009
091791       WHEN SQLCODE = ZERO                                        09179109
091792          DISPLAY 'CONVEYOR VENDOR ' PV-SORTER-NAME               09179212
091793          DISPLAY 'LAST DIVERT TIMESTAMP - '                      09179309
091794                   PV-MAX-DIVERT-TIMESTAMP                        09179409
091795           IF  PV-MAX-DIVERT-TIMESTAMP < SU096-BACK-TMST          09179509
091796               SET PS-ADDITIONAL-CHECK-NEEDED                     09179609
091797                                     TO TRUE                      09179709
091798           ELSE                                                   09179809
091799               SET PS-NO-ADDITIONAL-CHECK-NEEDED                  09179909
091800                                     TO TRUE                      09180009
091801           END-IF                                                 09180109
091802                                                                  09180209
091803       WHEN SQLCODE = +100                                        09180309
091804           SET PS-END-OF-CURSOR      TO TRUE                      09180409
091805       WHEN SQLWARN0 NOT EQUAL SPACE                              09180509
091806       WHEN SQLCODE NOT EQUAL ZERO                                09180609
091807           MOVE '2720-FETCH-CNVYR-SORTER-CSR'                     09180709
091808                                     TO PV-ABEND-PARAGRAPH        09180809
091809           MOVE 'FETCH CONVEYOR SORTER CURSOR ROW'                09180909
091810                                     TO PV-ABEND-OPER-MESSAGE-1   09181009
091811           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          09181109
091812           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              09181209
091813                   PV-OPER-UNT-ID-DISP                            09181309
091814                                   DELIMITED BY SIZE              09181409
091815                                   INTO PV-ABEND-OPER-MESSAGE-2   09181509
091816           MOVE 'WST_INTGRTN_TYP'    TO PV-ABEND-TABLE-1          09181609
091817           MOVE 'WST_ATTR_DEFN'      TO PV-ABEND-TABLE-2          09181709
091818           MOVE 'WST_ATTR_ELEM'      TO PV-ABEND-TABLE-3          09181809
091819           MOVE 'TSUCRDV'            TO PV-ABEND-TABLE-4          09181909
091820           PERFORM 9100-SQL-ABEND                                 09182009
091830     END-EVALUATE.                                                09183009
091846                                                                  09184608
091847                                                                  09184708
091848******************************************************************09184808
091849*                                                                 09184908
091850*  DMH 8/15/16                                                    09185008
091851******************************************************************09185108
091852 2730-PROCESS-CNVYR-SORTER-CSR.                                   09185211
091853****                                                              09185309
091854**** FOR TEST ONLY                                                09185409
091855****             SET  PS-ADDITIONAL-CHECK-NEEDED TO TRUE          09185509
091856****                                                              09185609
091857****                                                              09185709
091858                                                                  09185809
091859     IF  PS-ADDITIONAL-CHECK-NEEDED                               09185909
091860         PERFORM 2350-FETCH-SEQ-NBR-PARM                          09186009
091861         PERFORM 2400-CHECK-OPEN-ASSIGNMENTS                      09186109
091862         IF  PV-OPEN-ASGMT-COUNT > 0                              09186209
091863             PERFORM 2500-CHECK-CLOSED-ASSIGNMENTS                09186309
091864             IF  PV-CLOSED-ASGMT-COUNT > 0                        09186409
091865                 SET PS-NO-CONVEYOR-DIVERTS TO TRUE               09186509
091866                 PERFORM 2600-SETUP-ERROR-REC                     09186609
091867             END-IF                                               09186709
091868         END-IF                                                   09186809
091869     END-IF.                                                      09186909
091870                                                                  09187009
091871     PERFORM 2720-FETCH-CNVYR-SORTER-CSR.                         09187109
091872                                                                  09187208
091873                                                                  09187308
091874******************************************************************09187408
091875*                                                                 09187508
091876*  DMH 8/15/16                                                    09187608
091877******************************************************************09187708
091878 2740-CLOSE-CNVYR-SORTER-CSR.                                     09187808
091879                                                                  09187908
091880     PERFORM                                                      09188008
091881         WITH TEST AFTER                                          09188108
091882         VARYING PV-COUNTER                                       09188208
091883         FROM 1 BY 1                                              09188308
091884         UNTIL ((PV-COUNTER > PC-MAX-RETRIES)                     09188408
091885                   OR (SQLCODE = ZERO))                           09188508
091886         EXEC SQL                                                 09188608
091887             CLOSE CNVYR-SORTER-CSR                               09188708
091888         END-EXEC                                                 09188808
091889                                                                  09188908
091890         EVALUATE TRUE                                            09189008
091891             WHEN SQLCODE = +0                                    09189108
091892             WHEN SQLCODE = -904                                  09189208
091893             WHEN SQLCODE = -911                                  09189308
091894             WHEN SQLCODE = -913                                  09189408
091895                 CONTINUE                                         09189508
091896             WHEN SQLWARN0 NOT EQUAL SPACE                        09189608
091897             WHEN SQLCODE NOT EQUAL ZERO                          09189708
091898                 MOVE '2740-CLOSE-CNVYR-SORTER-CSR'               09189808
091899                                      TO PV-ABEND-PARAGRAPH       09189908
091900                 MOVE 'ERROR CLOSING CONVEYOR SORTER CURSOR'      09190008
091901                                      TO PV-ABEND-OPER-MESSAGE-1  09190108
091902                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09190208
091903                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09190308
091904                         PV-OPER-UNT-ID-DISP                      09190408
091905                                         DELIMITED BY SIZE        09190508
091906                                    INTO PV-ABEND-OPER-MESSAGE-2  09190608
091907                 MOVE 'WST_INTGRTN_TYP'                           09190708
091908                                      TO PV-ABEND-TABLE-1         09190808
091909                 MOVE 'WST_ATTR_DEFN' TO PV-ABEND-TABLE-2         09190908
091910                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-3         09191008
091911                 PERFORM 9100-SQL-ABEND                           09191108
091912         END-EVALUATE                                             09191208
091913     END-PERFORM.                                                 09191308
091914                                                                  09191408
091915     IF  PV-COUNTER > PC-MAX-RETRIES                              09191508
091916         MOVE '2740-CLOSE-CNVYR-SORTER-CSR'                       09191608
091917                                      TO PV-ABEND-PARAGRAPH       09191708
091918         MOVE 'MAX RETRIES ERROR CLOSING CONVEYOR SORTER CURSOR'  09191808
091919                                      TO PV-ABEND-OPER-MESSAGE-1  09191908
091920         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09192008
091921         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        09192108
091922                 PV-OPER-UNT-ID-DISP                              09192208
091923                                         DELIMITED BY SIZE        09192308
091924                                    INTO PV-ABEND-OPER-MESSAGE-2  09192408
091925         MOVE 'WST_INTGRTN_TYP'       TO PV-ABEND-TABLE-1         09192508
091926         MOVE 'WST_ATTR_DEFN'         TO PV-ABEND-TABLE-2         09192608
091927         MOVE 'WST_ATTR_ELEM'         TO PV-ABEND-TABLE-3         09192708
091928         PERFORM 9100-SQL-ABEND                                   09192808
091929     END-IF.                                                      09192908
091930                                                                  09193008
091931                                                                  09193108
091932******************************************************************09193208
091933* PROCESS CURSOR TO DISPLAY ACTIVE ASSIGNMENT INFORMATION ON THE *09193308
091934* ERROR E-MAIL                                                   *09193408
091935* ADDED 4/9/13                                                   *09193508
091936******************************************************************09193608
091937 3000-CHECK-OPEN-ASGMTS.                                          09193708
091938                                                                  09193808
091939     SET  PS-NOT-EOF-ASGMT-CSR  TO  TRUE.                         09193908
091940     PERFORM 3005-OPEN-ASGMT-CSR.                                 09194008
091941                                                                  09194108
091942     MOVE  PV-ASGMT-MSG-1         TO  HEAD-REC.                   09194208
091943     DISPLAY HEAD-REC.                                            09194308
091944     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09194408
091945     MOVE   SPACES                      TO HEAD-REC.              09194508
091946     DISPLAY HEAD-REC.                                            09194608
091947     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09194708
091948                                                                  09194808
091949     PERFORM 3010-FETCH-ASGMT-CSR                                 09194908
091950       UNTIL PS-EOF-ASGMT-CSR.                                    09195008
091951                                                                  09195108
091952     PERFORM 3015-CLOSE-ASGMT-CSR.                                09195208
091953                                                                  09195308
091954     MOVE   SPACES                      TO HEAD-REC.              09195408
091955     DISPLAY HEAD-REC.                                            09195508
091956     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09195608
091957     MOVE '*****************************************'             09195708
091958                                        TO HEAD-REC.              09195808
091959     DISPLAY HEAD-REC.                                            09195908
091960     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09196008
091961                                                                  09196108
091962                                                                  09196208
091963******************************************************************09196308
091964* OPEN THE ACTIVE ASSIGNMENT CURSOR                               09196408
091965* ADDED 4/9/13                                                   *09196508
091966******************************************************************09196608
091967 3005-OPEN-ASGMT-CSR.                                             09196708
091968                                                                  09196808
091969     PERFORM WITH TEST AFTER                                      09196908
091970       VARYING PV-COUNTER FROM 1 BY 1                             09197008
091971         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    09197108
091972                SQLCODE = ZERO)                                   09197208
091973                                                                  09197308
091974         EXEC SQL                                                 09197408
091975              OPEN LABOR-ASGMT-CSR                                09197508
091976         END-EXEC                                                 09197608
091977                                                                  09197708
091978         EVALUATE TRUE                                            09197808
091979             WHEN SQLCODE = +0                                    09197908
091980             WHEN SQLCODE = -904                                  09198008
091981             WHEN SQLCODE = -911                                  09198108
091982             WHEN SQLCODE = -913                                  09198208
091983                 CONTINUE                                         09198308
091984             WHEN SQLWARN0 NOT EQUAL SPACE                        09198408
091985             WHEN SQLCODE NOT EQUAL ZERO                          09198508
091986                 MOVE '3005-OPEN-ASGMT-CSR'                       09198608
091987                                      TO PV-ABEND-PARAGRAPH       09198708
091988                 MOVE 'ERROR OPENING ASSIGNMENT CURSOR'           09198808
091989                                      TO PV-ABEND-OPER-MESSAGE-1  09198908
091990                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09199008
091991                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09199108
091992                         PV-OPER-UNT-ID-DISP                      09199208
091993                                         DELIMITED BY SIZE        09199308
091994                                   INTO PV-ABEND-OPER-MESSAGE-2   09199408
091995                 MOVE 'DLT_ASGMT'     TO PV-ABEND-TABLE-1         09199508
091996                 PERFORM 9100-SQL-ABEND                           09199608
091997         END-EVALUATE                                             09199708
091998     END-PERFORM.                                                 09199808
091999                                                                  09199908
092000     IF  PV-COUNTER > PC-MAX-RETRIES                              09200008
092001         MOVE '3005-OPEN-ASGMT-CSR'                               09200108
092002                                      TO PV-ABEND-PARAGRAPH       09200208
092003         MOVE 'MAX RETRIES ERROR OPENING ASSIGNMENT CURSOR'       09200308
092004                                      TO PV-ABEND-OPER-MESSAGE-1  09200408
092005         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09200508
092006         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                09200608
092007                 PV-OPER-UNT-ID-DISP                              09200708
092008                                 DELIMITED BY SIZE                09200808
092009                                    INTO PV-ABEND-OPER-MESSAGE-2  09200908
092010         MOVE 'DLT_ASGMT'             TO PV-ABEND-TABLE-1         09201008
092011         PERFORM 9100-SQL-ABEND                                   09201108
092012     END-IF.                                                      09201208
092013                                                                  09201308
092014                                                                  09201408
092015******************************************************************09201508
092016* FETCH A ROW FROM THE OPEN LABOR ASSIGNMENT CURSOR              *09201608
092017* ADDED 4/9/13                                                   *09201708
092018******************************************************************09201808
092019 3010-FETCH-ASGMT-CSR.                                            09201908
092020                                                                  09202008
092021     EXEC SQL                                                     09202108
092022          FETCH LABOR-ASGMT-CSR                                   09202208
092023           INTO :DLT00004-WK-TYP-DESC                             09202308
092024               ,:PV-ASGMT-COUNT                                   09202408
092025               ,:PV-EVENT-SUM                                     09202508
092026     END-EXEC.                                                    09202608
092027                                                                  09202708
092028     EVALUATE TRUE                                                09202808
092029       WHEN SQLCODE = ZERO                                        09202908
092030            PERFORM 2610-DISPLAY-OPEN-ASGMT                       09203008
092031                                                                  09203108
092032       WHEN SQLCODE = +100                                        09203208
092033           SET PS-EOF-ASGMT-CSR      TO TRUE                      09203308
092034       WHEN SQLWARN0 NOT EQUAL SPACE                              09203408
092035       WHEN SQLCODE NOT EQUAL ZERO                                09203508
092036           MOVE '3010-FETCH-ASGMT-CSR'                            09203608
092037                                     TO PV-ABEND-PARAGRAPH        09203708
092038           MOVE 'FETCH OPEN LABOR ASSIGNMENT CSR '                09203808
092039                                     TO PV-ABEND-OPER-MESSAGE-1   09203908
092040           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          09204008
092041           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              09204108
092042                   PV-OPER-UNT-ID-DISP                            09204208
092043                                   DELIMITED BY SIZE              09204308
092044                                   INTO PV-ABEND-OPER-MESSAGE-2   09204408
092045           MOVE 'DLT_ASGMT'          TO PV-ABEND-TABLE-1          09204508
092046           PERFORM 9100-SQL-ABEND                                 09204608
092047     END-EVALUATE.                                                09204708
092048                                                                  09204808
092049                                                                  09204908
092050******************************************************************09205008
092051* CLOSE THE CONVEYOR VENDOR CURSOR                                09205108
092052* ADDED 4/9/13                                                   *09205208
092053******************************************************************09205308
092054 3015-CLOSE-ASGMT-CSR.                                            09205408
092055                                                                  09205508
092056     PERFORM                                                      09205608
092057         WITH TEST AFTER                                          09205708
092058         VARYING PV-COUNTER                                       09205808
092059         FROM 1 BY 1                                              09205908
092060         UNTIL ((PV-COUNTER > PC-MAX-RETRIES) OR                  09206008
092061                (SQLCODE = ZERO))                                 09206108
092062         EXEC SQL                                                 09206208
092063             CLOSE LABOR-ASGMT-CSR                                09206308
092064         END-EXEC                                                 09206408
092065                                                                  09206508
092066         EVALUATE TRUE                                            09206608
092067             WHEN SQLCODE = +0                                    09206708
092068             WHEN SQLCODE = -904                                  09206808
092069             WHEN SQLCODE = -911                                  09206908
092070             WHEN SQLCODE = -913                                  09207008
092071                 CONTINUE                                         09207108
092072             WHEN SQLWARN0 NOT EQUAL SPACE                        09207208
092073             WHEN SQLCODE NOT EQUAL ZERO                          09207308
092074                 MOVE '3015-CLOSE-ASGMT-CSR'                      09207408
092075                                      TO PV-ABEND-PARAGRAPH       09207508
092076                 MOVE 'ERROR CLOSING ASSIGNMENT CURSOR     '      09207608
092077                                      TO PV-ABEND-OPER-MESSAGE-1  09207708
092078                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09207808
092079                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09207908
092080                         PV-OPER-UNT-ID-DISP                      09208008
092081                                         DELIMITED BY SIZE        09208108
092082                                    INTO PV-ABEND-OPER-MESSAGE-2  09208208
092083                 MOVE 'DLT_ASGMT'     TO PV-ABEND-TABLE-1         09208308
092084                 PERFORM 9100-SQL-ABEND                           09208408
092085         END-EVALUATE                                             09208508
092086     END-PERFORM.                                                 09208608
092087                                                                  09208708
092088     IF  PV-COUNTER > PC-MAX-RETRIES                              09208808
092089         MOVE '3015-CLOSE-ASGMT-CSR'                              09208908
092090                                      TO PV-ABEND-PARAGRAPH       09209008
092091         MOVE 'MAX RETRIES ERROR CLOSING LABOR ASSIGNMENT CURSOR' 09209108
092092                                      TO PV-ABEND-OPER-MESSAGE-1  09209208
092093         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09209308
092094         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        09209408
092095                 PV-OPER-UNT-ID-DISP                              09209508
092096                                         DELIMITED BY SIZE        09209608
092097                                    INTO PV-ABEND-OPER-MESSAGE-2  09209708
092098         MOVE 'DLT_ASGMT'             TO PV-ABEND-TABLE-1         09209808
092099         MOVE 'TSUCRDV'               TO PV-ABEND-TABLE-4         09209908
092100         PERFORM 9100-SQL-ABEND                                   09210008
092101     END-IF.                                                      09210108
092102                                                                  09210208
092103                                                                  09210308
092104******************************************************************09210408
092105*  READ THE CONVEYOR CONTROL RECORD                               09210508
092106******************************************************************09210608
092107 7000-READ-CNVYR-CNTL-REC.                                        09210708
092108     READ SU-CNVYR-CNTL-FILE                                      09210808
092109         INTO SU096-DATE-CONTROL-REC                              09210908
092110             AT END                                               09211008
092111                 SET PS-EOF-CNTL-FILE TO TRUE.                    09211108
092120                                                                  09212008
092200         DISPLAY '* * * * * * * * * * * * * * * * * * * * * *'.   09220008
092300         DISPLAY 'CURRENT TIMESTAMP - ' SU096-CURR-TMST.          09230008
092400         DISPLAY 'BACK TIMESTAMP    - ' SU096-BACK-TMST.          09240008
092410         DISPLAY 'MINUTES TO CHECK  - ' SU096-MIN-TO-CHECK.       09241008
092420         DISPLAY '* * * * * * * * * * * * * * * * * * * * * *'.   09242008
092430*                                                                 09243008
092440*7000-EXIT.                                                       09244008
092450*                                                                 09245008
092460*                                                                 09246008
092470 9100-SQL-ABEND.                                                  09247008
092480******************************************************************09248008
092490*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    09249008
092500*  ERROR OR WARNING CODE OCCURS.                                  09250008
092600******************************************************************09260008
092700     MOVE SQLCODE    TO PV-SQLCODE.                               09270008
092800     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       09280008
092900                                                                  09290008
093000     DISPLAY '9100-SQL-ABEND'.                                    09300008
093100     DISPLAY '** ABEND              **'.                          09310008
093200     DISPLAY '** SQLCODE            ** = ' PV-DISPLAY-SQLCODE.    09320008
093300     DISPLAY '** PROGRAM            ** = ' PC-CURRENT-PROGRAM-NAME09330008
093400     DISPLAY '** PARAGRAPH          ** = ' PV-ABEND-PARAGRAPH.    09340008
093500     DISPLAY '** TABLE(S) AFFECTED  ** = ' PV-ABEND-TABLE-1.      09350008
093600     DISPLAY '**                    ** = ' PV-ABEND-TABLE-2.      09360008
093700     DISPLAY '**                    ** = ' PV-ABEND-TABLE-3.      09370008
093800     DISPLAY '**                    ** = ' PV-ABEND-TABLE-4.      09380008
093900     DISPLAY '** OPERATION          ** = ' PV-ABEND-OPER-MESSAGE-109390008
094000     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-209400008
094100     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-309410008
094200     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-409420008
094300     DISPLAY '**                    ** = '                        09430008
094400                                                                  09440008
094500******************************************************************09450008
094600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09460008
094700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09470008
094800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09480008
094900* FORMAT.                                                         09490008
095000******************************************************************09500008
095100     COPY DPPD004.                                                09510008
095200                                                                  09520008
095300     MOVE +4013                  TO ABEND-CODE.                   09530008
095400     CALL 'ILBOABN0' USING ABEND-CODE.                            09540008
095500*9100-EXIT.                                                       09550008
