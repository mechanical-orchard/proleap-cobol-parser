000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.   RCKUP071.                                          00040000
000500 AUTHOR.       JOE LAROSA.                                        00050000
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060000
000700 DATE-WRITTEN. JULY 2002.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000*       DOWNLOAD TRANSACTION REPOSITORY PURGE PROGRAM             00100000
001100*                                                                 00110000
001200* THIS PROGRAM READS THE "COMPLETED" RECORDS FROM THE DB2 DOWNLOAD00120000
001300* REPOSITORY TABLES (WFT_DAT_CNTL & WFT_DAT_XFER) AND DELETES     00130000
001400* TRANSACTIONS RECORDS OLDER THAN 5 DAYS AFTER COMPLETION.        00140000
001500*                                                                 00150000
001600* THIS PROGRAM THEN MAKES A SECOND PASS OF THE REPOSITORY TABLE   00160000
001700* DELETING ALL TRANSACTIONS OVER 14 DAYS OLD, REGARDLESS OF THEIR 00170000
001800* STATUS.                                                         00180000
001810*                                                                 00181000
001820* GERMAN BANDA 10/02/20 PROGRAM RENAMED FROM  WMKUP040 TO RCKUP07100182000
001830*                       AS PART OF ARCHIVING WM APPLICATION       00183000
001900******************************************************************00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100******************************************************************00210000
002200 CONFIGURATION SECTION.                                           00220000
002300 SOURCE-COMPUTER.        IBM-3090.                                00230000
002400 OBJECT-COMPUTER.        IBM-3090.                                00240000
002500                                                                  00250000
002600 INPUT-OUTPUT SECTION.                                            00260000
002700 FILE-CONTROL.                                                    00270000
002800                                                                  00280000
002900******************************************************************00290000
003000 DATA DIVISION.                                                   00300000
003100******************************************************************00310000
003200 FILE SECTION.                                                    00320000
003300                                                                  00330000
003400 WORKING-STORAGE SECTION.                                         00340000
003500 01  PS-PROGRAM-SWITCHES.                                         00350000
003600     05  PS-END-OF-CNTL-CSR-SW       PIC X(01) VALUE 'N'.         00360000
003700         88  PS-END-OF-CNTL-CSR-YES            VALUE 'Y'.         00370000
003800         88  PS-END-OF-CNTL-CSR-NO             VALUE 'N'.         00380000
003900     05  PS-END-OF-CNTL14-CSR-SW     PIC X(01) VALUE 'N'.         00390000
004000         88  PS-END-OF-CNTL14-CSR-YES          VALUE 'Y'.         00400000
004100         88  PS-END-OF-CNTL14-CSR-NO           VALUE 'N'.         00410000
004200     05  PS-END-OF-XFER-CSR-SW       PIC X(01) VALUE 'N'.         00420000
004300         88  PS-END-OF-XFER-CSR-YES            VALUE 'Y'.         00430000
004400         88  PS-END-OF-XFER-CSR-NO             VALUE 'N'.         00440000
004500     05  PS-END-OF-XFER14-CSR-SW     PIC X(01) VALUE 'N'.         00450000
004600         88  PS-END-OF-XFER14-CSR-YES          VALUE 'Y'.         00460000
004700         88  PS-END-OF-XFER14-CSR-NO           VALUE 'N'.         00470000
004800     05  PS-DELETE-XFER-ROWS-SW      PIC X(01) VALUE 'N'.         00480000
004900         88  PS-DELETE-XFER-ROWS-YES           VALUE 'Y'.         00490000
005000         88  PS-DELETE-XFER-ROWS-NO            VALUE 'N'.         00500000
005100                                                                  00510000
005200 01  PC-PROGRAM-CONSTANTS.                                        00520000
005300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'RCKUP071'.  00530000
005400     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   00540000
005500                                                                  00550000
005600 01  PA-PROGRAM-ACCUMULATORS.                                     00560000
005700     05  PA-TOTALS.                                               00570000
005800         10  PA-TOTAL-CNTL-READ      PIC S9(7) VALUE +0 COMP-3.   00580000
005900         10  PA-TOTAL-CNTL14-READ    PIC S9(7) VALUE +0 COMP-3.   00590000
006000         10  PA-TOTAL-CNTL-DELETED   PIC S9(7) VALUE +0 COMP-3.   00600000
006100         10  PA-TOTAL-CNTL14-DELETED PIC S9(7) VALUE +0 COMP-3.   00610000
006200         10  PA-TOTAL-XFER-DELETED   PIC S9(7) VALUE +0 COMP-3.   00620000
006300         10  PA-TOTAL-XFER14-DELETED PIC S9(7) VALUE +0 COMP-3.   00630000
006400                                                                  00640000
006500 01  PV-PROGRAM-VARIABLES.                                        00650000
006600     05  PV-DISPLAY-RECORD           PIC Z,ZZZ,ZZ9-.              00660000
006700     05  PV-DB2-COUNT                PIC S9(9) VALUE +0 COMP-3.   00670000
006800     05  PV-COMMIT-COUNT-XFER        PIC 9(07) VALUE ZEROES.      00680000
006900                                                                  00690000
007000     05  PV-PRC-CNTL-TMST            PIC X(26) VALUE SPACE.       00700000
007100     05  FILLER REDEFINES PV-PRC-CNTL-TMST.                       00710000
007200         10  PV-TMST-DATE.                                        00720000
007300             15  PV-TMST-CCYY        PIC 9(04).                   00730000
007400             15  FILLER              PIC X(01).                   00740000
007500             15  PV-TMST-MONTH       PIC 9(02).                   00750000
007600             15  FILLER              PIC X(01).                   00760000
007700             15  PV-TMST-DAY         PIC 9(02).                   00770000
007800         10  FILLER                  PIC X(01).                   00780000
007900         10  PV-TMST-HOUR            PIC 9(02).                   00790000
008000         10  FILLER                  PIC X(01).                   00800000
008100         10  PV-TMST-MINUTE          PIC 9(02).                   00810000
008200         10  FILLER                  PIC X(01).                   00820000
008300         10  PV-TMST-SECOND          PIC 9(02).                   00830000
008400         10  FILLER                  PIC X(01).                   00840000
008500         10  PV-TMST-LAST6           PIC 9(06).                   00850000
008600                                                                  00860000
008700     05  PV-TMST-MINUS-FIVE-DAYS     PIC X(26) VALUE SPACE.       00870000
008800     05  FILLER REDEFINES PV-TMST-MINUS-FIVE-DAYS.                00880000
008900         10  PV-5D-DATE.                                          00890000
009000             15  PV-5D-CCYY          PIC 9(04).                   00900000
009100             15  FILLER              PIC X(01).                   00910000
009200             15  PV-5D-MONTH         PIC 9(02).                   00920000
009300             15  FILLER              PIC X(01).                   00930000
009400             15  PV-5D-DAY           PIC 9(02).                   00940000
009500         10  FILLER                  PIC X(16).                   00950000
009600     05  PV-TMST-MINUS-14-DAYS       PIC X(26) VALUE SPACE.       00960000
009700     05  FILLER REDEFINES PV-TMST-MINUS-14-DAYS.                  00970000
009800         10  PV-14D-DATE.                                         00980000
009900             15  PV-14D-CCYY         PIC 9(04).                   00990000
010000             15  FILLER              PIC X(01).                   01000000
010100             15  PV-14D-MONTH        PIC 9(02).                   01010000
010200             15  FILLER              PIC X(01).                   01020000
010300             15  PV-14D-DAY          PIC 9(02).                   01030000
010400         10  FILLER                  PIC X(16).                   01040000
010500                                                                  01050000
010600 01  PV-ABEND-VARIABLES.                                          01060000
010700     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.01070000
010800     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP.     01080000
010900     05  PV-SQLCODE                  PIC S9(9).                   01090000
011000     05  PV-DISPLAY-SQLCODE          PIC -------999.              01100000
011100     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'RCKUP071'.  01110000
011200     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      01120000
011300     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      01130000
011400     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01140000
011500     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01150000
011600                                                                  01160000
011700******************************************************************01170000
011800*  WORK AREA PASSED IN CALL TO DPKUT500                           01180000
011900******************************************************************01190000
012000     COPY DPWS500.                                                01200000
012100                                                                  01210000
012200******************************************************************01220000
012300*  DB2 FORMATTED MESSAGE AREA                                     01230000
012400******************************************************************01240000
012500     COPY DPWS004.                                                01250000
012600                                                                  01260000
012700******************************************************************01270000
012800*  COMMUNICATIONS AREA FOR DB2                                    01280000
012900******************************************************************01290000
013000     EXEC SQL                                                     01300000
013100         INCLUDE SQLCA                                            01310000
013200     END-EXEC.                                                    01320000
013300                                                                  01330000
013400******************************************************************01340000
013500*  DB2 TABLE DECLARATION - E-FULFILLMENT LOAD CONTROL             01350000
013600*      TABLE (WFT_DAT_CNTL)                                       01360000
013700******************************************************************01370000
013800     EXEC SQL                                                     01380000
013900         INCLUDE WFT00004                                         01390000
014000     END-EXEC.                                                    01400000
014100                                                                  01410000
014200******************************************************************01420000
014300*  DB2 TABLE DECLARATION - E-FULFILLMENT LOAD TRANSACTIONS        01430000
014400*      TABLE (WFT_DAT_XFER)                                       01440000
014500******************************************************************01450000
014600     EXEC SQL                                                     01460000
014700         INCLUDE WFT00005                                         01470000
014800     END-EXEC.                                                    01480000
014900                                                                  01490000
015000******************************************************************01500000
015100* COBOL CURSOR DELCARATION TO READ E-FULFILLMENT LOAD CONTROL    *01510000
015200******************************************************************01520000
015300     EXEC SQL                                                     01530000
015400       DECLARE CNTL-CSR CURSOR WITH HOLD FOR                      01540000
015500        SELECT PRC_CNTL_TMST                                      01550000
015600             , TRN_TYP_CDE                                        01560000
015700             , STAT_CDE                                           01570000
015800             , STR_NBR                                            01580000
015900          FROM WFT_DAT_CNTL                                       01590000
016000         WHERE PRC_CNTL_TMST < :PV-TMST-MINUS-FIVE-DAYS           01600000
016100           AND STAT_CDE      = 'CMPLTD'                           01610000
016200     END-EXEC.                                                    01620000
016300                                                                  01630000
016400     EXEC SQL                                                     01640000
016500       DECLARE CNTL14-CSR CURSOR WITH HOLD FOR                    01650000
016600        SELECT PRC_CNTL_TMST                                      01660000
016700             , TRN_TYP_CDE                                        01670000
016800             , STAT_CDE                                           01680000
016900             , STR_NBR                                            01690000
017000          FROM WFT_DAT_CNTL                                       01700000
017100         WHERE PRC_CNTL_TMST < :PV-TMST-MINUS-14-DAYS             01710000
017200     END-EXEC.                                                    01720000
017300                                                                  01730000
017400******************************************************************01740000
017500* COBOL CURSOR DELCARATION TO READ E-FULFILLMENT LOAD TRANSACTION*01750000
017600******************************************************************01760000
017700     EXEC SQL                                                     01770000
017800       DECLARE XFER-CSR CURSOR FOR                                01780000
017900        SELECT PRC_CNTL_TMST                                      01790000
018000             , TRN_TYP_CDE                                        01800000
018100             , PRC_LOD_SEQ_ID                                     01810000
018200             , LOD_DAT_TXT                                        01820000
018300          FROM WFT_DAT_XFER                                       01830000
018400         WHERE PRC_CNTL_TMST = :WFT00004-PRC-CNTL-TMST            01840000
018500           AND TRN_TYP_CDE   = :WFT00004-TRN-TYP-CDE              01850000
018600     END-EXEC.                                                    01860000
018700                                                                  01870000
018800     EXEC SQL                                                     01880000
018900       DECLARE XFER14-CSR CURSOR FOR                              01890000
019000        SELECT PRC_CNTL_TMST                                      01900000
019100             , TRN_TYP_CDE                                        01910000
019200             , PRC_LOD_SEQ_ID                                     01920000
019300             , LOD_DAT_TXT                                        01930000
019400          FROM WFT_DAT_XFER                                       01940000
019500         WHERE PRC_CNTL_TMST = :WFT00004-PRC-CNTL-TMST            01950000
019600***        AND TRN_TYP_CDE   = :WFT00004-TRN-TYP-CDE              01960000
019700     END-EXEC.                                                    01970000
019800                                                                  01980000
019900******************************************************************01990000
020000 LINKAGE SECTION.                                                 02000000
020100******************************************************************02010000
020200                                                                  02020000
020300                                                                  02030000
020400/*****************************************************************02040000
020500 PROCEDURE DIVISION.                                              02050000
020600******************************************************************02060000
020700 0000-PROGRAM-MAINLINE.                                           02070000
020800     DISPLAY '************ START OF RCKUP071 ***************'     02080000
020900                                                                  02090000
021000     PERFORM 1000-INITIALIZE.                                     02100000
021100                                                                  02110000
021200*PROCESS COMPLETED TRANSACTIONS.                                  02120000
021300     PERFORM 2000-PROCESS-CMPLTD-RECORDS.                         02130000
021400                                                                  02140000
021500*PROCESS TWO-WEEK OLD TRANSACTIONS.                               02150000
021600     PERFORM 4000-PROCESS-14DAY-RECORDS.                          02160000
021700                                                                  02170000
021800*EOJ ROUTINE.                                                     02180000
021900     PERFORM 9000-EOJ-ROUTINE.                                    02190000
022000                                                                  02200000
022100*STOP                                                             02210000
022200     DISPLAY ' '.                                                 02220000
022300     DISPLAY '************  END OF RCKUP071  ***************'     02230000
022400     STOP RUN.                                                    02240000
022500                                                                  02250000
022600******************************************************************02260000
022700*                                                                *02270000
022800*                I N I T I A L I Z A T I O N                     *02280000
022900*                                                                *02290000
023000******************************************************************02300000
023100 1000-INITIALIZE.                                                 02310000
023200                                                                  02320000
023300*INIT COUNTERS.                                                   02330000
023400     INITIALIZE PA-TOTAL-CNTL-READ                                02340000
023500                PA-TOTAL-CNTL14-READ                              02350000
023600                PA-TOTAL-CNTL-DELETED                             02360000
023700                PA-TOTAL-CNTL14-DELETED                           02370000
023800                PA-TOTAL-XFER-DELETED                             02380000
023900                PA-TOTAL-XFER14-DELETED                           02390000
024000                PV-COMMIT-COUNT-XFER.                             02400000
024100                                                                  02410000
024200*GET CURRENT TIMESTAMP.                                           02420000
024300     EXEC SQL                                                     02430000
024400         SET :PV-PRC-CNTL-TMST = CURRENT TIMESTAMP                02440000
024500     END-EXEC.                                                    02450000
024600                                                                  02460000
024700     EVALUATE TRUE                                                02470000
024800       WHEN SQLCODE = ZERO                                        02480000
024900           MOVE PV-PRC-CNTL-TMST TO PV-TMST-MINUS-FIVE-DAYS       02490000
025000                                    PV-TMST-MINUS-14-DAYS         02500000
025100           DISPLAY ' CURRENT TIMESTAMP      = ' PV-PRC-CNTL-TMST  02510000
025200                                                                  02520000
025300       WHEN OTHER                                                 02530000
025400           MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH       02540000
025500           MOVE 'GET DB2 TMST'        TO PV-ABEND-OPERATION       02550000
025600           PERFORM 9900-DB2-ABEND                                 02560000
025700         END-EVALUATE.                                            02570000
025800                                                                  02580000
025900*CALCULATE 10 DAYS AGO.                                           02590000
026000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02600000
026100     SET  DPG51-ACTUAL-CALENDAR-ONLY                              02610000
026200          DPG51-DECREMENT-DATE TO TRUE.                           02620000
026300     MOVE 5                    TO DPG51-INCR-DECR-DAYS-9.         02630000
026400     SET  DPG52-LK-DTE-ISO-FMT TO TRUE.                           02640000
026500*            'CCYY-MM-DD'                                         02650000
026600     MOVE PV-TMST-DATE TO DPG52-LK-DATE-INPUT.                    02660000
026700                                                                  02670000
026800     CALL DP500-KOHLS-CALENDAR-ROUTINE                            02680000
026900          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02690000
027000                                                                  02700000
027100     IF DPG54-DATE-INVALID                                        02710000
027200       OR DPG54-SEVERE-ERROR                                      02720000
027300         DISPLAY 'BAD RETURN FROM CALENDAR ROUTINE - '            02730000
027400                 DPG54-RETURN-FLAGS                               02740000
027500         MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH         02750000
027600         MOVE 'GET 10D TMST'        TO PV-ABEND-OPERATION         02760000
027700         PERFORM 9900-DB2-ABEND                                   02770000
027800     ELSE                                                         02780000
027900         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-5D-DATE                02790000
028000     END-IF.                                                      02800000
028100                                                                  02810000
028200     DISPLAY ' COMPLETED DATE CUT-OFF = ' PV-5D-DATE.             02820000
028300                                                                  02830000
028400*CALCULATE 14 DAYS AGO.                                           02840000
028500     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02850000
028600     SET  DPG51-ACTUAL-CALENDAR-ONLY                              02860000
028700          DPG51-DECREMENT-DATE TO TRUE.                           02870000
028800     MOVE 14                   TO DPG51-INCR-DECR-DAYS-9.         02880000
028900     SET  DPG52-LK-DTE-ISO-FMT TO TRUE.                           02890000
029000*            'CCYY-MM-DD'                                         02900000
029100     MOVE PV-TMST-DATE TO DPG52-LK-DATE-INPUT.                    02910000
029200                                                                  02920000
029300     CALL DP500-KOHLS-CALENDAR-ROUTINE                            02930000
029400          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02940000
029500                                                                  02950000
029600     IF DPG54-DATE-INVALID                                        02960000
029700       OR DPG54-SEVERE-ERROR                                      02970000
029800         DISPLAY 'BAD RETURN FROM CALENDAR ROUTINE - '            02980000
029900                 DPG54-RETURN-FLAGS                               02990000
030000         MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH         03000000
030100         MOVE 'GET 14D TMST'        TO PV-ABEND-OPERATION         03010000
030200         PERFORM 9900-DB2-ABEND                                   03020000
030300     ELSE                                                         03030000
030400         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-14D-DATE               03040000
030500     END-IF.                                                      03050000
030600                                                                  03060000
030700     DISPLAY ' 14 DAYS DATE CUT-OFF   = ' PV-14D-DATE.            03070000
030800     DISPLAY ' '.                                                 03080000
030900                                                                  03090000
031000******************************************************************03100000
031100*                                                                *03110000
031200*      P R O C E S S   C O M P L E T E D   R E C O R D S         *03120000
031300*                                                                *03130000
031400******************************************************************03140000
031500 2000-PROCESS-CMPLTD-RECORDS.                                     03150000
031600     DISPLAY '2000-PROCESS-CMPLTD-RECORDS'.                       03160000
031700                                                                  03170000
031800     PERFORM 2100-OPEN-CNTL-CURSOR.                               03180000
031900                                                                  03190000
032000     PERFORM 2200-FETCH-CNTL-CURSOR.                              03200000
032100                                                                  03210000
032200     IF PS-END-OF-CNTL-CSR-YES                                    03220000
032300         DISPLAY ' '                                              03230000
032400         DISPLAY '*************************************'          03240000
032500         DISPLAY '**    NO COMPLETED TRANSACTIONS    **'          03250000
032600         DISPLAY '**      FOUND ON WFT_DAT_CNTL      **'          03260000
032700         DISPLAY '*************************************'          03270000
032800         DISPLAY ' '                                              03280000
032900     END-IF.                                                      03290000
033000                                                                  03300000
033100*PROCESS COMPLETED TRANSACTIONS.                                  03310000
033200     PERFORM                                                      03320000
033300       UNTIL PS-END-OF-CNTL-CSR-YES                               03330000
033400                                                                  03340000
033500*INCREMENT COUNTER OF CNTL RECORDS READ.                          03350000
033600         ADD +1 TO PA-TOTAL-CNTL-READ                             03360000
033700                                                                  03370000
033800*CHECK THAT ALL CNTL ARE COMPLETE BEFORE DELETING XFER.           03380000
033900         SET PS-DELETE-XFER-ROWS-NO TO TRUE                       03390000
034000         PERFORM 2010-CHECK-CMPLTD-CNTL                           03400000
034100                                                                  03410000
034200*DELETE 'XFER' RECORDS ASSOCIATED WITH THE 'CNTL' RECORD.         03420000
034300         IF PS-DELETE-XFER-ROWS-YES                               03430000
034400             PERFORM 3000-DELETE-XFER-RECORDS                     03440000
034500         END-IF                                                   03450000
034600                                                                  03460000
034700*DELETE 'CNTL' RECORD.                                            03470000
034800         PERFORM 2400-DELETE-CNTL                                 03480000
034900         DISPLAY ' ROW(S) DELETED FOR ' WFT00004-PRC-CNTL-TMST    03490000
035000                                  ' / ' WFT00004-TRN-TYP-CDE      03500000
035100                                  ' / ' WFT00004-STR-NBR          03510000
035200                                                                  03520000
035300*COMMIT THE DATA.                                                 03530000
035400         PERFORM 2800-COMMIT                                      03540000
035500                                                                  03550000
035600*GET NEXT 'CNTL' RECORD.                                          03560000
035700         PERFORM 2200-FETCH-CNTL-CURSOR                           03570000
035800                                                                  03580000
035900     END-PERFORM.                                                 03590000
036000                                                                  03600000
036100*CLOSE THE 'CNTL' CURSOR.                                         03610000
036200     PERFORM 2500-CLOSE-CNTL-CURSOR.                              03620000
036300                                                                  03630000
036400******************************************************************03640000
036500 2010-CHECK-CMPLTD-CNTL.                                          03650000
036600                                                                  03660000
036700*COUNT CNTL RECORDS FOR STATUS OTHER THAN 'CMPLTD'.               03670000
036800     MOVE ZEROES TO PV-DB2-COUNT.                                 03680000
036900     EXEC SQL                                                     03690000
037000         SELECT COUNT (*)                                         03700000
037100           INTO  :PV-DB2-COUNT                                    03710000
037200           FROM  WFT_DAT_CNTL A                                   03720000
037300          WHERE  A.PRC_CNTL_TMST = :WFT00004-PRC-CNTL-TMST        03730000
037400            AND  A.TRN_TYP_CDE   = :WFT00004-TRN-TYP-CDE          03740000
037500            AND  A.STAT_CDE     <> 'CMPLTD'                       03750000
037600     END-EXEC.                                                    03760000
037700                                                                  03770000
037800     EVALUATE TRUE                                                03780000
037900       WHEN SQLCODE = ZERO                                        03790000
038000           CONTINUE                                               03800000
038100                                                                  03810000
038200       WHEN OTHER                                                 03820000
038300           MOVE '2010-CHECK-CMPLTD-CNTL' TO PV-ABEND-PARAGRAPH    03830000
038400           MOVE 'COUNT WFT_DAT_CNTL'     TO PV-ABEND-OPERATION    03840000
038500           PERFORM 9900-DB2-ABEND                                 03850000
038600     END-EVALUATE.                                                03860000
038700                                                                  03870000
038800*IF COUNT = 0, OK TO DELETE ASSOCIATED XFER ROWS.                 03880000
038900     IF PV-DB2-COUNT = ZEROES                                     03890000
039000         SET PS-DELETE-XFER-ROWS-YES TO TRUE                      03900000
039100***      DISPLAY '  OK TO DELETE XFER ROWS'                       03910000
039200     ELSE                                                         03920000
039300         DISPLAY '  DO NOT DELETE XFER ROWS'                      03930000
039400     END-IF.                                                      03940000
039500                                                                  03950000
039600******************************************************************03960000
039700 2100-OPEN-CNTL-CURSOR.                                           03970000
039800                                                                  03980000
039900     EXEC SQL                                                     03990000
040000         OPEN CNTL-CSR                                            04000000
040100     END-EXEC.                                                    04010000
040200                                                                  04020000
040300     EVALUATE TRUE                                                04030000
040400       WHEN SQLCODE = ZERO                                        04040000
040500           SET PS-END-OF-CNTL-CSR-NO TO TRUE                      04050000
040600                                                                  04060000
040700       WHEN OTHER                                                 04070000
040800           MOVE '2100-OPEN-CNTL-CURSOR'                           04080000
040900                                 TO PV-ABEND-PARAGRAPH            04090000
041000           MOVE 'OPEN CNTL-CSR ' TO PV-ABEND-OPERATION            04100000
041100           PERFORM 9900-DB2-ABEND                                 04110000
041200     END-EVALUATE.                                                04120000
041300                                                                  04130000
041400******************************************************************04140000
041500 2200-FETCH-CNTL-CURSOR.                                          04150000
041600                                                                  04160000
041700     EXEC SQL                                                     04170000
041800         FETCH CNTL-CSR                                           04180000
041900          INTO :WFT00004-PRC-CNTL-TMST                            04190000
042000             , :WFT00004-TRN-TYP-CDE                              04200000
042100             , :WFT00004-STAT-CDE                                 04210000
042200             , :WFT00004-STR-NBR                                  04220000
042300     END-EXEC.                                                    04230000
042400                                                                  04240000
042500     EVALUATE TRUE                                                04250000
042600       WHEN SQLCODE = +100                                        04260000
042700           SET PS-END-OF-CNTL-CSR-YES TO TRUE                     04270000
042800                                                                  04280000
042900       WHEN SQLCODE = ZERO                                        04290000
043000           CONTINUE                                               04300000
043100                                                                  04310000
043200       WHEN OTHER                                                 04320000
043300           MOVE '2200-FETCH-CNTL-CURSOR'                          04330000
043400                                  TO PV-ABEND-PARAGRAPH           04340000
043500           MOVE 'FETCH CNTL-CSR ' TO PV-ABEND-OPERATION           04350000
043600           PERFORM 9900-DB2-ABEND                                 04360000
043700     END-EVALUATE.                                                04370000
043800                                                                  04380000
043900******************************************************************04390000
044000 2400-DELETE-CNTL.                                                04400000
044100                                                                  04410000
044200     EXEC SQL                                                     04420000
044300         DELETE FROM WFT_DAT_CNTL                                 04430000
044400***      WHERE CURRENT OF CNTL-CSR                                04440000
044500          WHERE PRC_CNTL_TMST = :WFT00004-PRC-CNTL-TMST           04450000
044600            AND TRN_TYP_CDE   = :WFT00004-TRN-TYP-CDE             04460000
044700            AND STAT_CDE      = :WFT00004-STAT-CDE                04470000
044800            AND STR_NBR       = :WFT00004-STR-NBR                 04480000
044900     END-EXEC.                                                    04490000
045000                                                                  04500000
045100     EVALUATE TRUE                                                04510000
045200       WHEN SQLCODE = ZERO                                        04520000
045300           ADD +1 TO PA-TOTAL-CNTL-DELETED                        04530000
045400                                                                  04540000
045500       WHEN OTHER                                                 04550000
045600           MOVE '2400-DELETE-CNTL'    TO PV-ABEND-PARAGRAPH       04560000
045700           MOVE 'DELETE WFT_DAT_CNTL' TO PV-ABEND-OPERATION       04570000
045800           MOVE DCLWFT00004 TO PV-DB2-OPERATION-MESSAGE-1         04580000
045900           PERFORM 9900-DB2-ABEND                                 04590000
046000     END-EVALUATE.                                                04600000
046100                                                                  04610000
046200******************************************************************04620000
046300 2500-CLOSE-CNTL-CURSOR.                                          04630000
046400                                                                  04640000
046500     EXEC SQL                                                     04650000
046600         CLOSE CNTL-CSR                                           04660000
046700     END-EXEC.                                                    04670000
046800                                                                  04680000
046900     EVALUATE TRUE                                                04690000
047000       WHEN SQLCODE = ZERO                                        04700000
047100           CONTINUE                                               04710000
047200                                                                  04720000
047300       WHEN OTHER                                                 04730000
047400           MOVE '2500-CLOSE-CNTL-CURSOR'                          04740000
047500                                  TO PV-ABEND-PARAGRAPH           04750000
047600           MOVE 'CLOSE CNTL-CSR ' TO PV-ABEND-OPERATION           04760000
047700           PERFORM 9900-DB2-ABEND                                 04770000
047800     END-EVALUATE.                                                04780000
047900                                                                  04790000
048000******************************************************************04800000
048100 2800-COMMIT.                                                     04810000
048200                                                                  04820000
048300     EXEC SQL                                                     04830000
048400         COMMIT                                                   04840000
048500     END-EXEC.                                                    04850000
048600                                                                  04860000
048700     EVALUATE TRUE                                                04870000
048800       WHEN SQLCODE = ZERO                                        04880000
048900           CONTINUE                                               04890000
049000                                                                  04900000
049100       WHEN OTHER                                                 04910000
049200           MOVE '2800-COMMIT'        TO PV-ABEND-PARAGRAPH        04920000
049300           MOVE 'COMMIT LOAD TABLES' TO PV-ABEND-OPERATION        04930000
049400           PERFORM 9900-DB2-ABEND                                 04940000
049500     END-EVALUATE.                                                04950000
049600                                                                  04960000
049700******************************************************************04970000
049800******************************************************************04980000
049900 3000-DELETE-XFER-RECORDS.                                        04990000
050000                                                                  05000000
050100     PERFORM 3100-OPEN-XFER-CURSOR.                               05010000
050200                                                                  05020000
050300     PERFORM                                                      05030000
050400       UNTIL PS-END-OF-XFER-CSR-YES                               05040000
050500                                                                  05050000
050600          PERFORM 3200-PROCESS-XFER-ROWS                          05060000
050700                                                                  05070000
050800     END-PERFORM.                                                 05080000
050900                                                                  05090000
051000     PERFORM 3300-CLOSE-XFER-CURSOR.                              05100000
051100                                                                  05110000
051200******************************************************************05120000
051300 3100-OPEN-XFER-CURSOR.                                           05130000
051400                                                                  05140000
051500     EXEC SQL                                                     05150000
051600         OPEN XFER-CSR                                            05160000
051700     END-EXEC.                                                    05170000
051800                                                                  05180000
051900     EVALUATE TRUE                                                05190000
052000       WHEN SQLCODE = ZERO                                        05200000
052100           SET PS-END-OF-XFER-CSR-NO TO TRUE                      05210000
052200                                                                  05220000
052300       WHEN OTHER                                                 05230000
052400           MOVE '3100-OPEN-XFER-CURSOR'                           05240000
052500                                 TO PV-ABEND-PARAGRAPH            05250000
052600           MOVE 'OPEN XFER-CSR ' TO PV-ABEND-OPERATION            05260000
052700           PERFORM 9900-DB2-ABEND                                 05270000
052800     END-EVALUATE.                                                05280000
052900                                                                  05290000
053000******************************************************************05300000
053100 3200-PROCESS-XFER-ROWS.                                          05310000
053200                                                                  05320000
053300     EXEC SQL                                                     05330000
053400         FETCH XFER-CSR                                           05340000
053500          INTO :WFT00005-LOD-DAT-TXT                              05350000
053600     END-EXEC.                                                    05360000
053700                                                                  05370000
053800     EVALUATE TRUE                                                05380000
053900       WHEN SQLCODE = +100                                        05390000
054000           SET PS-END-OF-XFER-CSR-YES TO TRUE                     05400000
054100                                                                  05410000
054200       WHEN SQLCODE = ZERO                                        05420000
054300           PERFORM 3210-DELETE-XFER-ROW                           05430000
054400                                                                  05440000
054500       WHEN OTHER                                                 05450000
054600           MOVE '3200-PROCESS-XFER-ROWS' TO PV-ABEND-PARAGRAPH    05460000
054700           MOVE 'FETCH XFER ROW'         TO PV-ABEND-OPERATION    05470000
054800           PERFORM 9900-DB2-ABEND                                 05480000
054900     END-EVALUATE.                                                05490000
055000                                                                  05500000
055100******************************************************************05510000
055200 3210-DELETE-XFER-ROW.                                            05520000
055300                                                                  05530000
055400     INITIALIZE PV-RETRY-COUNTER.                                 05540000
055500                                                                  05550000
055600     PERFORM WITH TEST AFTER                                      05560000
055700       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     05570000
055800         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     05580000
055900                                                                  05590000
056000         EXEC SQL                                                 05600000
056100             DELETE FROM WFT_DAT_XFER                             05610000
056200             WHERE CURRENT OF XFER-CSR                            05620000
056300         END-EXEC                                                 05630000
056400                                                                  05640000
056500         EVALUATE TRUE                                            05650000
056600           WHEN SQLCODE = ZERO                                    05660000
056700               ADD +1 TO PA-TOTAL-XFER-DELETED                    05670000
056800                         PV-COMMIT-COUNT-XFER                     05680000
056900               IF PV-COMMIT-COUNT-XFER > 999                      05690000
057000                   DISPLAY '  3210-COMMIT-XFER = '                05700000
057100                            PV-COMMIT-COUNT-XFER                  05710000
057200                   PERFORM 2800-COMMIT                            05720000
057300                   PERFORM 3100-OPEN-XFER-CURSOR                  05730000
057400                   MOVE ZEROES TO PV-COMMIT-COUNT-XFER            05740000
057500               END-IF                                             05750000
057600                                                                  05760000
057700           WHEN SQLCODE = -911                                    05770000
057800           WHEN SQLCODE = -913                                    05780000
057900               ADD +1 TO PV-RETRY-COUNTER                         05790000
058000                                                                  05800000
058100           WHEN OTHER                                             05810000
058200               MOVE '3210-DELETE-XFER-ROW' TO PV-ABEND-PARAGRAPH  05820000
058300               MOVE 'DELETE WFT_DAT_XFER'  TO PV-ABEND-OPERATION  05830000
058400               MOVE DCLWFT00004    TO PV-DB2-OPERATION-MESSAGE-1  05840000
058500               PERFORM 9900-DB2-ABEND                             05850000
058600         END-EVALUATE                                             05860000
058700     END-PERFORM.                                                 05870000
058800                                                                  05880000
058900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05890000
059000         MOVE '3210-DELETE-XFER-ROW' TO PV-ABEND-PARAGRAPH        05900000
059100         MOVE 'DELETE WFT_DAT_XFER'  TO PV-ABEND-OPERATION        05910000
059200         MOVE DCLWFT00004            TO PV-DB2-OPERATION-MESSAGE-105920000
059300         PERFORM 9900-DB2-ABEND                                   05930000
059400     END-IF.                                                      05940000
059500                                                                  05950000
059600******************************************************************05960000
059700 3300-CLOSE-XFER-CURSOR.                                          05970000
059800                                                                  05980000
059900     EXEC SQL                                                     05990000
060000         CLOSE XFER-CSR                                           06000000
060100     END-EXEC.                                                    06010000
060200                                                                  06020000
060300     EVALUATE TRUE                                                06030000
060400       WHEN SQLCODE = ZERO                                        06040000
060500           CONTINUE                                               06050000
060600                                                                  06060000
060700       WHEN OTHER                                                 06070000
060800           MOVE '3300-CLOSE-XFER-CURSOR'                          06080000
060900                                  TO PV-ABEND-PARAGRAPH           06090000
061000           MOVE 'CLOSE XFER-CSR ' TO PV-ABEND-OPERATION           06100000
061100           PERFORM 9900-DB2-ABEND                                 06110000
061200     END-EVALUATE.                                                06120000
061300                                                                  06130000
061400******************************************************************06140000
061500*                                                                *06150000
061600*      P R O C E S S   2 W E E K   O L D   R E C O R D S         *06160000
061700*                                                                *06170000
061800******************************************************************06180000
061900 4000-PROCESS-14DAY-RECORDS.                                      06190000
062000     DISPLAY '4000-PROCESS-14DAY-RECORDS'.                        06200000
062100                                                                  06210000
062200     PERFORM 4100-OPEN-CNTL14-CURSOR.                             06220000
062300                                                                  06230000
062400     PERFORM 4200-FETCH-CNTL14-CURSOR.                            06240000
062500                                                                  06250000
062600     IF PS-END-OF-CNTL14-CSR-YES                                  06260000
062700         DISPLAY ' '                                              06270000
062800         DISPLAY '*************************************'          06280000
062900         DISPLAY '**    NO MONTH OLD TRANSACTIONS    **'          06290000
063000         DISPLAY '**      FOUND ON WFT_DAT_CNTL      **'          06300000
063100         DISPLAY '*************************************'          06310000
063200         DISPLAY ' '                                              06320000
063300     END-IF.                                                      06330000
063400                                                                  06340000
063500*PROCESS MONTH OLD TRANSACTIONS.                                  06350000
063600     PERFORM                                                      06360000
063700       UNTIL PS-END-OF-CNTL14-CSR-YES                             06370000
063800                                                                  06380000
063900*DELETE 'XFER' RECORDS ASSOCIATED WITH THE 'CNTL' RECORD.         06390000
064000         PERFORM 5000-DELETE-XFER14-RECORDS                       06400000
064100                                                                  06410000
064200*DELETE 'CNTL' RECORD.                                            06420000
064300         PERFORM 4400-DELETE-CNTL14                               06430000
064400         DISPLAY ' ROW(S) DELETED FOR ' WFT00004-PRC-CNTL-TMST    06440000
064500                                  ' / ' WFT00004-TRN-TYP-CDE      06450000
064600                                  ' / ' WFT00004-STR-NBR          06460000
064700                                                                  06470000
064800*COMMIT THE DATA.                                                 06480000
064900         PERFORM 2800-COMMIT                                      06490000
065000                                                                  06500000
065100*GET NEXT 'CNTL' RECORD.                                          06510000
065200         PERFORM 4200-FETCH-CNTL14-CURSOR                         06520000
065300                                                                  06530000
065400     END-PERFORM.                                                 06540000
065500                                                                  06550000
065600*CLOSE THE 'CNTL' CURSOR.                                         06560000
065700     PERFORM 4300-CLOSE-CNTL14-CURSOR.                            06570000
065800                                                                  06580000
065900******************************************************************06590000
066000 4100-OPEN-CNTL14-CURSOR.                                         06600000
066100                                                                  06610000
066200     EXEC SQL                                                     06620000
066300         OPEN CNTL14-CSR                                          06630000
066400     END-EXEC.                                                    06640000
066500                                                                  06650000
066600     EVALUATE TRUE                                                06660000
066700       WHEN SQLCODE = ZERO                                        06670000
066800           SET PS-END-OF-CNTL14-CSR-NO TO TRUE                    06680000
066900                                                                  06690000
067000       WHEN OTHER                                                 06700000
067100           MOVE '4100-OPEN-CNTL14-CURSOR'                         06710000
067200                                   TO PV-ABEND-PARAGRAPH          06720000
067300           MOVE 'OPEN CNTL14-CSR ' TO PV-ABEND-OPERATION          06730000
067400           PERFORM 9900-DB2-ABEND                                 06740000
067500     END-EVALUATE.                                                06750000
067600                                                                  06760000
067700******************************************************************06770000
067800 4200-FETCH-CNTL14-CURSOR.                                        06780000
067900                                                                  06790000
068000     EXEC SQL                                                     06800000
068100         FETCH CNTL14-CSR                                         06810000
068200          INTO :WFT00004-PRC-CNTL-TMST                            06820000
068300             , :WFT00004-TRN-TYP-CDE                              06830000
068400             , :WFT00004-STAT-CDE                                 06840000
068500             , :WFT00004-STR-NBR                                  06850000
068600     END-EXEC.                                                    06860000
068700                                                                  06870000
068800     EVALUATE TRUE                                                06880000
068900       WHEN SQLCODE = +100                                        06890000
069000           SET PS-END-OF-CNTL14-CSR-YES TO TRUE                   06900000
069100                                                                  06910000
069200       WHEN SQLCODE = ZERO                                        06920000
069300           CONTINUE                                               06930000
069400                                                                  06940000
069500       WHEN OTHER                                                 06950000
069600           MOVE '4200-FETCH-CNTL14-CURSOR'                        06960000
069700                                    TO PV-ABEND-PARAGRAPH         06970000
069800           MOVE 'FETCH CNTL14-CSR ' TO PV-ABEND-OPERATION         06980000
069900           PERFORM 9900-DB2-ABEND                                 06990000
070000     END-EVALUATE.                                                07000000
070100                                                                  07010000
070200******************************************************************07020000
070300 4300-CLOSE-CNTL14-CURSOR.                                        07030000
070400                                                                  07040000
070500     EXEC SQL                                                     07050000
070600         CLOSE CNTL14-CSR                                         07060000
070700     END-EXEC.                                                    07070000
070800                                                                  07080000
070900     EVALUATE TRUE                                                07090000
071000       WHEN SQLCODE = ZERO                                        07100000
071100           CONTINUE                                               07110000
071200                                                                  07120000
071300       WHEN OTHER                                                 07130000
071400           MOVE '4300-CLOSE-CNTL14-CURSOR'                        07140000
071500                                    TO PV-ABEND-PARAGRAPH         07150000
071600           MOVE 'CLOSE CNTL14-CSR ' TO PV-ABEND-OPERATION         07160000
071700           PERFORM 9900-DB2-ABEND                                 07170000
071800     END-EVALUATE.                                                07180000
071900                                                                  07190000
072000******************************************************************07200000
072100 4400-DELETE-CNTL14.                                              07210000
072200                                                                  07220000
072300     EXEC SQL                                                     07230000
072400         DELETE FROM WFT_DAT_CNTL                                 07240000
072500***       WHERE CURRENT OF CNTL14-CSR                             07250000
072600          WHERE PRC_CNTL_TMST = :WFT00004-PRC-CNTL-TMST           07260000
072700            AND TRN_TYP_CDE   = :WFT00004-TRN-TYP-CDE             07270000
072800            AND STAT_CDE      = :WFT00004-STAT-CDE                07280000
072900            AND STR_NBR       = :WFT00004-STR-NBR                 07290000
073000     END-EXEC.                                                    07300000
073100                                                                  07310000
073200     EVALUATE TRUE                                                07320000
073300       WHEN SQLCODE = ZERO                                        07330000
073400           ADD +1 TO PA-TOTAL-CNTL14-DELETED                      07340000
073500                                                                  07350000
073600       WHEN OTHER                                                 07360000
073700           MOVE '4400-DELETE-CNTL14'  TO PV-ABEND-PARAGRAPH       07370000
073800           MOVE 'DELETE WFT_DAT_CNTL' TO PV-ABEND-OPERATION       07380000
073900           MOVE DCLWFT00004 TO PV-DB2-OPERATION-MESSAGE-1         07390000
074000           PERFORM 9900-DB2-ABEND                                 07400000
074100     END-EVALUATE.                                                07410000
074200                                                                  07420000
074300******************************************************************07430000
074400******************************************************************07440000
074500 5000-DELETE-XFER14-RECORDS.                                      07450000
074600                                                                  07460000
074700     PERFORM 5100-OPEN-XFER14-CURSOR.                             07470000
074800                                                                  07480000
074900     PERFORM                                                      07490000
075000       UNTIL PS-END-OF-XFER14-CSR-YES                             07500000
075100                                                                  07510000
075200          PERFORM 5200-PROCESS-XFER14-ROWS                        07520000
075300                                                                  07530000
075400     END-PERFORM.                                                 07540000
075500                                                                  07550000
075600     PERFORM 5300-CLOSE-XFER14-CURSOR.                            07560000
075700                                                                  07570000
075800******************************************************************07580000
075900 5100-OPEN-XFER14-CURSOR.                                         07590000
076000                                                                  07600000
076100     EXEC SQL                                                     07610000
076200         OPEN XFER14-CSR                                          07620000
076300     END-EXEC.                                                    07630000
076400                                                                  07640000
076500     EVALUATE TRUE                                                07650000
076600       WHEN SQLCODE = ZERO                                        07660000
076700           SET PS-END-OF-XFER14-CSR-NO TO TRUE                    07670000
076800                                                                  07680000
076900       WHEN OTHER                                                 07690000
077000           MOVE '5100-OPEN-XFER14-CURSOR'                         07700000
077100                                   TO PV-ABEND-PARAGRAPH          07710000
077200           MOVE 'OPEN XFER14-CSR ' TO PV-ABEND-OPERATION          07720000
077300           PERFORM 9900-DB2-ABEND                                 07730000
077400     END-EVALUATE.                                                07740000
077500                                                                  07750000
077600******************************************************************07760000
077700 5200-PROCESS-XFER14-ROWS.                                        07770000
077800                                                                  07780000
077900     EXEC SQL                                                     07790000
078000         FETCH XFER14-CSR                                         07800000
078100          INTO :WFT00005-LOD-DAT-TXT                              07810000
078200     END-EXEC.                                                    07820000
078300                                                                  07830000
078400     EVALUATE TRUE                                                07840000
078500       WHEN SQLCODE = +100                                        07850000
078600           SET PS-END-OF-XFER14-CSR-YES TO TRUE                   07860000
078700                                                                  07870000
078800       WHEN SQLCODE = ZERO                                        07880000
078900           PERFORM 5210-DELETE-XFER14-ROW                         07890000
079000                                                                  07900000
079100       WHEN OTHER                                                 07910000
079200           MOVE '5200-PROCESS-XFER14-ROWS' TO PV-ABEND-PARAGRAPH  07920000
079300           MOVE 'FETCH XFER14 ROW'         TO PV-ABEND-OPERATION  07930000
079400           PERFORM 9900-DB2-ABEND                                 07940000
079500     END-EVALUATE.                                                07950000
079600                                                                  07960000
079700******************************************************************07970000
079800 5210-DELETE-XFER14-ROW.                                          07980000
079900                                                                  07990000
080000     INITIALIZE PV-RETRY-COUNTER.                                 08000000
080100                                                                  08010000
080200     PERFORM WITH TEST AFTER                                      08020000
080300       UNTIL SQLCODE = ZERO OR SQLCODE = +100                     08030000
080400         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     08040000
080500                                                                  08050000
080600         EXEC SQL                                                 08060000
080700             DELETE FROM WFT_DAT_XFER                             08070000
080800             WHERE CURRENT OF XFER14-CSR                          08080000
080900         END-EXEC                                                 08090000
081000                                                                  08100000
081100         EVALUATE TRUE                                            08110000
081200           WHEN SQLCODE = ZERO                                    08120000
081300               ADD +1 TO PA-TOTAL-XFER14-DELETED                  08130000
081400                         PV-COMMIT-COUNT-XFER                     08140000
081500               IF PV-COMMIT-COUNT-XFER > 999                      08150000
081600                   DISPLAY '  5210-COMMIT-XFER = '                08160000
081700                            PV-COMMIT-COUNT-XFER                  08170000
081800                   PERFORM 2800-COMMIT                            08180000
081900                   PERFORM 5100-OPEN-XFER14-CURSOR                08190000
082000                   MOVE ZEROES TO PV-COMMIT-COUNT-XFER            08200000
082100               END-IF                                             08210000
082200                                                                  08220000
082300           WHEN SQLCODE = -911                                    08230000
082400           WHEN SQLCODE = -913                                    08240000
082500               ADD +1 TO PV-RETRY-COUNTER                         08250000
082600                                                                  08260000
082700           WHEN OTHER                                             08270000
082800               MOVE '5210-DELETE-XFER14-ROW' TO PV-ABEND-PARAGRAPH08280000
082900               MOVE 'DELETE WFT_DAT_XFER'    TO PV-ABEND-OPERATION08290000
083000               MOVE DCLWFT00004    TO PV-DB2-OPERATION-MESSAGE-1  08300000
083100               PERFORM 9900-DB2-ABEND                             08310000
083200         END-EVALUATE                                             08320000
083300     END-PERFORM.                                                 08330000
083400                                                                  08340000
083500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         08350000
083600         MOVE '5210-DELETE-XFER14-ROW' TO PV-ABEND-PARAGRAPH      08360000
083700         MOVE 'DELETE WFT_DAT_XFER'    TO PV-ABEND-OPERATION      08370000
083800         MOVE DCLWFT00004            TO PV-DB2-OPERATION-MESSAGE-108380000
083900         PERFORM 9900-DB2-ABEND                                   08390000
084000     END-IF.                                                      08400000
084100                                                                  08410000
084200******************************************************************08420000
084300 5300-CLOSE-XFER14-CURSOR.                                        08430000
084400                                                                  08440000
084500     EXEC SQL                                                     08450000
084600         CLOSE XFER14-CSR                                         08460000
084700     END-EXEC.                                                    08470000
084800                                                                  08480000
084900     EVALUATE TRUE                                                08490000
085000       WHEN SQLCODE = ZERO                                        08500000
085100           CONTINUE                                               08510000
085200                                                                  08520000
085300       WHEN OTHER                                                 08530000
085400           MOVE '5300-CLOSE-XFER-CURSOR'                          08540000
085500                                    TO PV-ABEND-PARAGRAPH         08550000
085600           MOVE 'CLOSE XFER14-CSR ' TO PV-ABEND-OPERATION         08560000
085700           PERFORM 9900-DB2-ABEND                                 08570000
085800     END-EVALUATE.                                                08580000
085900                                                                  08590000
086000******************************************************************08600000
086100*                                                                *08610000
086200*                   E O J   P R O C E S S I N G                  *08620000
086300*                                                                *08630000
086400******************************************************************08640000
086500 9000-EOJ-ROUTINE.                                                08650000
086600                                                                  08660000
086700     DISPLAY ' '.                                                 08670000
086800     DISPLAY '*******************************************'.       08680000
086900     DISPLAY '      * RCKUP071 SUMMARY STATISTICS *      '.       08690000
087000     DISPLAY ' '.                                                 08700000
087100     DISPLAY '      -------------------------------      '.       08710000
087200     DISPLAY '       LOAD REPOSITORY PURGE RESULTS       '.       08720000
087300     DISPLAY '      -------------------------------      '.       08730000
087400     MOVE PA-TOTAL-CNTL-READ              TO PV-DISPLAY-RECORD.   08740000
087500     DISPLAY ' CMPLTD WFT_DAT_CNTL > 5 DAYS  ='                   08750000
087600                                             PV-DISPLAY-RECORD.   08760000
087700     MOVE PA-TOTAL-XFER-DELETED           TO PV-DISPLAY-RECORD.   08770000
087800     DISPLAY ' ASSOC WFT_DAT_XFER DELETED    ='                   08780000
087900                                             PV-DISPLAY-RECORD.   08790000
088000     DISPLAY ' '.                                                 08800000
088100     MOVE PA-TOTAL-CNTL14-DELETED         TO PV-DISPLAY-RECORD.   08810000
088200     DISPLAY ' DELETED WFT_DAT_CNTL(14 DAYS) ='                   08820000
088300                                             PV-DISPLAY-RECORD.   08830000
088400     MOVE PA-TOTAL-XFER14-DELETED         TO PV-DISPLAY-RECORD.   08840000
088500     DISPLAY ' DELETED WFT_DAT_XFER(14 DAYS) ='                   08850000
088600                                             PV-DISPLAY-RECORD.   08860000
088700     DISPLAY '*******************************************'.       08870000
088800                                                                  08880000
088900******************************************************************08890000
089000* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      08900000
089100* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 08910000
089200******************************************************************08920000
089300 9900-DB2-ABEND.                                                  08930000
089400                                                                  08940000
089500     MOVE SQLCODE    TO PV-SQLCODE.                               08950000
089600     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       08960000
089700     DISPLAY '*** DB2 ERROR ***'.                                 08970000
089800     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               08980000
089900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08990000
090000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               09000000
090100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               09010000
090200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       09020000
090300     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             09030000
090400                                                                  09040000
090500******************************************************************09050000
090600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09060000
090700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09070000
090800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09080000
090900* FORMAT.                                                         09090000
091000******************************************************************09100000
091100     COPY DPPD004.                                                09110000
091200                                                                  09120000
091300     IF SQLCODE NOT = -911                                        09130000
091400         EXEC SQL                                                 09140000
091500             ROLLBACK                                             09150000
091600         END-EXEC                                                 09160000
091700     END-IF.                                                      09170000
091800                                                                  09180000
091900     MOVE +4013         TO PV-ABEND-CODE.                         09190000
092000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         09200000
092100******************************************************************09210000
092200******************************************************************09220000
