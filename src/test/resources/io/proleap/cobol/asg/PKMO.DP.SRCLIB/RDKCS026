000100*-----------------------*                                         00010021
000200 IDENTIFICATION DIVISION.                                         00020021
000300*-----------------------*                                         00030021
000400 PROGRAM-ID.    RDKCS026.                                         00040021
000500 AUTHOR.        PAT DOYLE - IBS.                                  00050021
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060021
000700 DATE-WRITTEN.  05-07-96.                                         00070021
000800 DATE-COMPILED.                                                   00080021
000900                                                                  00090021
001000*---------------------------------------------------------------* 00100021
001100*    U026 - KMC TRANSACTION DETAIL INQUIRY.                     * 00110021
001200*                                                               * 00120021
001300*    THIS PROGRAM DISPLAYS THE DETAIL INFORMATION FOR A KOHL'S  * 00130021
001400*    MERCHANDISE CARD TRANSACTION.                              * 00140021
001500*                                                               * 00150021
001600*---------------------------------------------------------------* 00160021
001700*    8/19/96 - AJR - ADDED THE CONTROL NUMBER TO DISPLAY ON THE * 00170039
001800*                    SCREEN.                                    * 00180021
001900*---------------------------------------------------------------* 00190021
002000*   12/09/96 - KARI SUTTON - WR# 4197                           * 00200021
002100*   - MADE CHANGES TO CORRESPOND WITH TWO COLUMN NAMES CHANGING * 00210021
002200*     ON TABLE SVT_CRD_ACCT_CMMT.                               * 00220042
002300*   06/23/97 - AMY REILAND - WR# 5220                           * 00230021
002400*   - CHANGED PROGRAM TO PROCESS GIFT CARDS.  INCREASED THE     * 00240021
002500*     SIZE OF THE CARD ID, CONTROL NUMBER AND ADDED CARD TYPE.  * 00250021
002600*---------------------------------------------------------------* 00260021
002700******************************************************************00270038
002800*  09/19/01 - ARCHIVE PROJECT - GREG SHEFF                       *00280041
002900*   IF CARD NUMBER IS NOT FOUND IN                               *00290042
003000*   TABLES SVT_CRD_ACCT_CMMT AND SVT_KOHLS_CRD_TXN               *00300069
003100*   THEN SEARCH HISTORY                                         .*00310042
003200*   TABLES SVT_CRD_CMMT_HIST AND SVT_CRD_TXN_HIST FOR THAT CARD. *00320042
003300******************************************************************00330042
124679* 9/19/15        JIM ARENDT   CHG0124679                                  
124679*  AS PART OF THE LP REFUND REMEDIATION PROJECT USERS CAN NOW             
124679*  ENTER EITHER THE FULL ENCRYPTED OR UN-ENCRYPTED DRIVERS LICENSE        
124679*  NUMBER.                                                                
124679******************************************************************00330042
P12431* 08/28/18 - COGNIZANT - CHG0208643                              *        
P12431*   MODIFIED THE PROGRAM TO HANDLE NEWLY ADDED ORD_NBR FIELD     *        
P12431*   IN THE SVT TABLES.                                           *        
P12431******************************************************************00330042
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  ******************************************************************        
003400                                                                  00340042
003500 ENVIRONMENT DIVISION.                                            00350042
003600                                                                  00360042
003700 DATA DIVISION.                                                   00370042
003800                                                                  00380042
003900 WORKING-STORAGE SECTION.                                         00390021
004000                                                                  00400021
004100 01  DK-DB2-KEYS.                                                 00410021
004200     05  DK-CRD-NBR                     PIC S9(12)V COMP-3.       00420043
004300     05  DK-TRN-AUTH-TMST               PIC  X(26).               00430021
004400     05  DK-STORE-NUMBER                PIC S9(04) COMP.          00440070
004500                                                                  00450021
004600 01  PC-PROGRAM-CONSTANTS.                                        00460021
004700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00470021
004800                                                    'RD026A  '.   00480021
004900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00490021
005000                                                    'RDKM026 '.   00500021
005100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00510021
005200                                                    'RDKCS026'.   00520021
005300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00530021
005400                                                    COMP SYNC.    00540021
124679     05  PC-MAX-RETRIES                 PIC S9(04)  VALUE +3              
124679                                                    COMP SYNC.            
005500                                                                  00550021
005600 01  PC-TSYMSG-NUMBERS.                                           00560021
005700     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00570021
005800     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00580021
005900     05  PC-TSYMSG-00134                PIC 9(5)    VALUE 00134.  00590021
006000                                                                  00600021
006100 01  PS-PROGRAM-SWITCHES.                                         00610021
006200     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00620021
006300         88  PS-NO-ERROR                             VALUE 'Y'.   00630021
006400         88  PS-ERROR                                VALUE 'N'.   00640021
006500     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   00650021
006600         88  PS-COMMAREA-VALID                       VALUE 'Y'.   00660021
006700         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   00670021
006800     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   00680021
006900         88  PS-LIST-END                             VALUE 'Y'.   00690021
007000         88  PS-NO-LIST-END                          VALUE 'N'.   00700021
007100                                                                  00710021
007200 01  PV-PROGRAM-VARIABLES.                                        00720021
007300     05  PV-CONTROL-NBR.                                          00730049
007400         10  PV-CRD-PROD-YR             PIC  9(04).               00740049
007500         10  PV-SHIPT-REQ-NBR           PIC  9(04).               00750049
007600         10  PV-CNTL-NBR                PIC  9(06).               00760049
007700     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     00770021
007800                                                     COMP SYNC.   00780021
P12431     05  PV-ORD-NBR-NULL-IND            PIC S9(04)   COMP VALUE   00780021
P12431                                                     ZERO.        00780021
007900     05  PV-DATE-ISO.                                             00790021
008000         10  PV-DATE-ISO-YYYY           PIC  X(04).               00800021
008100         10  FILLER                     PIC  X(01).               00810021
008200         10  PV-DATE-ISO-MM             PIC  X(02).               00820021
008300         10  FILLER                     PIC  X(01).               00830021
008400         10  PV-DATE-ISO-DD             PIC  X(02).               00840021
008500     05  PV-DATE-FMT.                                             00850021
008600         10  PV-DATE-FMT-MM             PIC  X(02).               00860021
008700         10  FILLER                     PIC  X(01)  VALUE '/'.    00870021
008800         10  PV-DATE-FMT-DD             PIC  X(02).               00880021
008900         10  FILLER                     PIC  X(01)  VALUE '/'.    00890021
009000         10  PV-DATE-FMT-YYYY           PIC  X(04).               00900021
009100     05  PV-TMST-ISO.                                             00910021
009200         10  PV-TMST-ISO-DATE           PIC  X(10).               00920021
009300         10  FILLER                     PIC  X(01).               00930021
009400         10  PV-TMST-ISO-TIME           PIC  X(15).               00940021
009500     05  PV-TMST-FMT.                                             00950021
009600         10  PV-TMST-FMT-DATE           PIC  X(10).               00960021
009700         10  FILLER                     PIC  X(01)  VALUE SPACE.  00970021
009800         10  PV-TMST-FMT-TIME           PIC  X(15).               00980021
124679     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE ZEROS           
124679                                                    COMP SYNC.            
124679     05  PV-HOLD-SQLCODE                PIC S9(09)  COMP-3.               
124679     05  PV-INDX-DL                     PIC S9(04)  VALUE ZEROS           
124679                                                    COMP-3.               
                                                                                
124679     05  PV-DL-NBR-CHECK                PIC  X(21).                       
124679     05  FILLER   REDEFINES   PV-DL-NBR-CHECK.                            
124679         10  PV-DL-CHAR       OCCURS 21 TIMES                             
124679                                        PIC  X(01).                       
009900     05  PS-ITEMS-SW                    PIC  X(01)  VALUE 'N'.    00990031
010000         88  PS-ITEMS-FOUND                         VALUE 'Y'.    01000031
010100         88  PS-ITEMS-NOT-FOUND                     VALUE 'N'.    01010031
010200                                                                  01020021
010300*---------------------------------------------------------------* 01030021
010400*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01040021
010500*---------------------------------------------------------------* 01050021
010600                                                                  01060021
010700     COPY DPWS030.                                                01070021
CICS       COPY DPWS930.                                                01070021
010800                                                                  01080021
010900*---------------------------------------------------------------* 01090021
011000*    STANDARD COMMAREA.                                         * 01100021
011100*---------------------------------------------------------------* 01110021
011200                                                                  01120021
011300     COPY DPWS020.                                                01130021
011400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01140021
011500                                                                  01150021
011600*---------------------------------------------------------------* 01160021
011700*    INTER-APPLICATION COMMAREA.                                * 01170021
011800*---------------------------------------------------------------* 01180021
011900                                                                  01190021
012000         10  INTER-APPL-COMM-AREA       PIC X(200).               01200021
012100     COPY RDWS021.                                                01210021
012200*---------------------------------------------------------------* 01220021
012300*    SPECIFIC COMMMAREA FOR RDKCS026.                           * 01230021
012400*---------------------------------------------------------------* 01240021
012500         10  ASC-SPECIFIC-COMMAREA.                               01250021
012600             15  ASC-CRD-ID                  PIC  9(13).          01260021
012700             15  ASC-SHORT-CRD-ID            PIC  9(12).          01270060
012800             15  ASC-CARD-TYPE-CDE           PIC  X(01).          01280060
012900             15  ASC-CARD-TYPE-DESC          PIC  X(10).          01290060
013000             15  ASC-CNTL-NBR                PIC  9(14).          01300060
013100             15  ASC-TRN-AUTH-TMST           PIC  X(26).          01310060
013200             15  ASC-DRV-LIC-NBR             PIC  X(21).          01320060
124679             15  ASC-DRV-LIC-NBR-EXP         PIC  X(50).          01320060
013300             15  ASC-ACTVY-TYP-CDE           PIC  9(01).          01330060
013400             15  ASC-ACTVY-TYP-DESC          PIC  X(07).          01340060
013500             15  ASC-ACTVY-STAT-CDE          PIC  9(01).          01350021
013600             15  ASC-ACTVY-STAT-DESC         PIC  X(15).          01360021
013700             15  ASC-TRN-RVRSL-CDE           PIC  9(01).          01370021
013800             15  ASC-TRN-RVRSL-DESC          PIC  X(08).          01380021
013900             15  ASC-TRN-VOID-IND            PIC  X(01).          01390021
014000             15  ASC-TRN-VOID-DESC           PIC  X(04).          01400021
014100             15  ASC-POS-DTE                 PIC  X(10).          01410021
014200             15  ASC-PSTD-DTE                PIC  X(10).          01420021
014300             15  ASC-STR-NBR                 PIC  9(04).          01430021
014400             15  ASC-STR-NAME                PIC  X(25).          01440021
014500             15  ASC-POS-TRMNL-NBR           PIC  X(04).          01450021
014600             15  ASC-POS-TRN-NBR             PIC  X(04).          01460021
014700             15  ASC-POS-OPRT-ID             PIC  9(11).          01470021
014800             15  ASC-APVL-USR-ID             PIC  X(08).          01480021
014900             15  ASC-APP-AUTH-AMT            PIC S9(07)V99        01490021
015000                                                  COMP-3.         01500021
015100             15  ASC-ORIG-AUTH-AMT           PIC S9(07)V99        01510021
015200                                                  COMP-3.         01520021
P12431             15  ASC-ORD-NBR                 PIC  X(40).          01530021
015300             15  ASC-COMMENT-LINE1           PIC  X(65).          01530021
015400             15  ASC-COMMENT-LINE2           PIC  X(65).          01540021
015500             15  ASC-SEL-QUEUE-NAME          PIC  X(08).          01550021
015600             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05)  COMP-3.  01560021
015700             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01570021
015800                                             PIC S9(09)  COMP-3.  01580021
015900             15  ASC-SEL-SUB                 PIC S9(04)  COMP.    01590021
016000             15  ASC-SEL-ITEM                PIC S9(04)  COMP.    01600021
016100             15  ASC-DISPLAY-TRN-AUTH-TMST   PIC  X(26).          01610021
124679**       10  FILLER                          PIC X(2468).         01620061
124679         10  FILLER                          PIC X(2418).         01620061
016300                                                                  01630021
016400*---------------------------------------------------------------* 01640021
016500*    ABEND PROCESSING COPYBOOK.                                 * 01650021
016600*---------------------------------------------------------------* 01660021
016700                                                                  01670021
016800     COPY DPWS013.                                                01680021
016900                                                                  01690021
017000*---------------------------------------------------------------* 01700021
017100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01710021
017200*---------------------------------------------------------------* 01720021
017300                                                                  01730021
017400     COPY DPWS015.                                                01740021
017500                                                                  01750021
017600*---------------------------------------------------------------* 01760021
017700*    FUNCTION KEYS COPYBOOK.                                    * 01770021
017800*---------------------------------------------------------------* 01780021
017900                                                                  01790021
018000     COPY DPWS016.                                                01800021
018100                                                                  01810021
018200*---------------------------------------------------------------* 01820021
018300*    NUMERIC EDIT LAYOUT.                                       * 01830021
018400*---------------------------------------------------------------* 01840021
018500                                                                  01850021
018600     COPY DPWS010I.                                               01860021
018700                                                                  01870021
018800******************************************************************01880055
018900** WORKING STORAGE FOR CONVERSION TO CARD NUMBER                 *01890055
019000******************************************************************01900055
019100     COPY SVWS007.                                                01910058
019200******************************************************************01920055
019300** WORKING STORAGE CONSTANT LIST FOR STORED VALUE SYSTEM        * 01930060
019400******************************************************************01940055
019500     COPY SVWS004.                                                01950058
019600*---------------------------------------------------------------* 01960021
019700*    SELECTION TEMP STORAGE QUEUE                               * 01970021
019800*---------------------------------------------------------------* 01980021
019900                                                                  01990021
020000     COPY RDWS022.                                                02000021
020100                                                                  02010021
020200*---------------------------------------------------------------* 02020021
020300*    MAP LAYOUT                                                 * 02030021
020400*---------------------------------------------------------------* 02040021
020500                                                                  02050021
020600     COPY RDKM026.                                                02060021
020700                                                                  02070021
020800*---------------------------------------------------------------* 02080021
020900*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                             * 02090042
021000*---------------------------------------------------------------* 02100021
021100     EXEC SQL                                                     02110021
021200          INCLUDE SVT00002                                        02120042
021300     END-EXEC.                                                    02130021
021400*---------------------------------------------------------------* 02140021
021500*    DB2 AREA FOR SVT_CRD_ACCT_CMMT                             * 02150042
021600*---------------------------------------------------------------* 02160021
021700     EXEC SQL                                                     02170021
021800          INCLUDE SVT00003                                        02180042
021900     END-EXEC.                                                    02190021
022000*---------------------------------------------------------------* 02200021
022100*    DB2 AREA FOR SVT_CRD_TXN_HIST                              * 02210042
022200*---------------------------------------------------------------* 02220032
022300     EXEC SQL                                                     02230032
022400          INCLUDE SVT00006                                        02240042
022500     END-EXEC.                                                    02250032
022600*---------------------------------------------------------------* 02260032
022700*    DB2 AREA FOR SVT_CRD_CMMT_HIST                             * 02270042
022800*---------------------------------------------------------------* 02280032
022900     EXEC SQL                                                     02290032
023000          INCLUDE SVT00007                                        02300042
023100     END-EXEC.                                                    02310032
023200*---------------------------------------------------------------* 02320032
023300*    DB2 AREA FOR XST_LOC                                       * 02330070
023400*---------------------------------------------------------------* 02340021
023500     EXEC SQL                                                     02350021
023600          INCLUDE XST00001                                        02360070
023700     END-EXEC.                                                    02370021
124679*---------------------------------------------------------------*         
124679*    DB2 AREA FOR ENCRYPTED DL NBR (RDT_DRVR_LIC_TRANSL)                  
124679*---------------------------------------------------------------*         
124679     EXEC SQL                                                             
124679          INCLUDE RDT00004                                                
124679     END-EXEC.                                                            
023800*---------------------------------------------------------------* 02380021
023900*    DB2 AREA FOR COMMUNICATIONS                                * 02390021
024000*---------------------------------------------------------------* 02400021
024100     EXEC SQL                                                     02410021
024200          INCLUDE SQLCA                                           02420021
024300     END-EXEC.                                                    02430021
024400                                                                  02440021
024500*---------------------------------------------------------------* 02450021
024600*    CURSOR TO OBTAIN COMMENT TEXT                              * 02460021
024700*---------------------------------------------------------------* 02470021
024800                                                                  02480021
024900     EXEC SQL                                                     02490021
025000          DECLARE COMMENT-CSR CURSOR                              02500021
025100          FOR SELECT                                              02510021
025200                CMNT_SEQ_NBR,                                     02520021
025300                CMNT_TXT                                          02530021
025400          FROM  SVT_CRD_ACCT_CMMT                                 02540042
025500          WHERE CRD_NBR        = :DK-CRD-NBR                      02550021
025600            AND CRE_TMST  = :DK-TRN-AUTH-TMST                     02560021
025700          ORDER BY                                                02570021
025800                CMNT_SEQ_NBR                                      02580021
025801          WITH UR                                                         
025900     END-EXEC.                                                    02590021
026000                                                                  02600021
026100*---------------------------------------------------------------* 02610034
026200*    HISTORY CURSOR TO OBTAIN COMMENT TEXT                      * 02620034
026300*---------------------------------------------------------------* 02630034
026400                                                                  02640034
026500     EXEC SQL                                                     02650034
026600          DECLARE COMMENT-CSR-HIST CURSOR                         02660034
026700          FOR SELECT                                              02670034
026800                CMNT_SEQ_NBR,                                     02680034
026900                CMNT_TXT                                          02690034
027000          FROM  SVT_CRD_CMMT_HIST                                 02700042
027100          WHERE CRD_NBR        = :DK-CRD-NBR                      02710034
027200            AND CRE_TMST  = :DK-TRN-AUTH-TMST                     02720034
027300          ORDER BY                                                02730034
027400                CMNT_SEQ_NBR                                      02740034
027401          WITH UR                                                         
027500     END-EXEC.                                                    02750034
027600                                                                  02760034
027700 LINKAGE SECTION.                                                 02770021
027800                                                                  02780021
027900 01  DFHCOMMAREA.                                                 02790021
028000     05  FILLER                         OCCURS  1 TO 4072 TIMES   02800021
028100                                        DEPENDING ON EIBCALEN.    02810021
028200         10  FILLER                     PIC X.                    02820021
028300                                                                  02830021
028400 PROCEDURE DIVISION.                                              02840021
028500                                                                  02850021
028600 0000-MAIN-MODULE.                                                02860021
028700                                                                  02870021
028800     INITIALIZE DP030-CICS-API-FIELDS.                            02880021
028900     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        02890021
029000     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           02900021
029100     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          02910021
029200     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        02920021
029300     MOVE LENGTH OF RD026AI       TO DP030-MAP-LENGTH (1).        02930021
029400     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      02940021
029500     PERFORM 0001-CALL-CICS-ARCH-API.                             02950021
029600     PERFORM 1000-CONTROL-PROCESSING.                             02960021
029700                                                                  02970021
029800     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      02980021
029900     PERFORM 0001-CALL-CICS-ARCH-API.                             02990021
030000                                                                  03000021
030100*----------------------------------------------------------------*03010021
030200*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *03020021
030300*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *03030021
030400*----------------------------------------------------------------*03040021
030500                                                                  03050021
030600 0001-CALL-CICS-ARCH-API.                                         03060021
030700                                                                  03070021
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
030900                                    DFHCOMMAREA                           
031000                                    DP030-CICS-API-FIELDS                 
031100                                    DP020-STANDARD-COMMAREA               
031200                                    RD026AI.                              
031300                                                                  03130021
031400     IF  DP030-RC-CALL-SUCCESSFUL                                 03140021
031500         CONTINUE                                                 03150021
031600     ELSE                                                         03160021
031700         SET DP013-NO-ROLLBACK TO TRUE                            03170021
031800         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   03180021
031900         SET DP013-CICS-ABEND TO TRUE                             03190021
032000         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        03200021
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
032300         MOVE DP030-RETURN-CODE                                   03230021
032400                               TO DP013-MESSAGE-TEXT (3)          03240021
032500         PERFORM DP013-0000-PROCESS-ABEND                         03250021
032600     END-IF.                                                      03260021
032700                                                                  03270021
032800*----------------------------------------------------------------*03280021
032900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03290021
033000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03300021
033100*----------------------------------------------------------------*03310021
033200                                                                  03320021
033300 1000-CONTROL-PROCESSING.                                         03330021
033400                                                                  03340021
033500     EVALUATE TRUE                                                03350021
033600         WHEN DP020-NEXT-ACT-INITIAL                              03360021
033700             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03370021
033800***-----$TEMPLATE NOTE$-------------------------------------------03380021
033900*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,03390021
034000*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  03400021
034100*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.03410021
034200***---------------------------------------------------------------03420021
034300             IF  PS-COMMAREA-NOT-VALID                            03430021
034400                 SET DP020-NEXT-ACT-APPL-ERROR                    03440021
034500                               TO  TRUE                           03450021
034600             ELSE                                                 03460022
034700                 SET PS-ITEMS-FOUND TO TRUE                       03470031
034800                 PERFORM 4000-BUILD-INITIAL-PANEL                 03480031
034900                 IF PS-ITEMS-NOT-FOUND                            03490031
035000                    PERFORM 4005-BUILD-INITIAL-HIST               03500031
035100                 END-IF                                           03510031
035200             END-IF                                               03520021
035300                                                                  03530021
035400         WHEN DP020-NEXT-ACT-READ-MAP                             03540021
035500             PERFORM 2000-PROCESS-PANEL                           03550021
035600                                                                  03560021
035700         WHEN DP020-NEXT-ACT-RETURN                               03570021
035800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03580021
035900                                                                  03590021
036000         WHEN OTHER                                               03600021
036100             SET DP013-LOGIC-ABEND TO TRUE                        03610021
036200             SET DP013-NO-ROLLBACK TO TRUE                        03620021
036300             MOVE '1000-CONTROL-PROCESSING'                       03630021
036400                               TO  DP013-PARAGRAPH                03640021
036500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03650021
036600                               TO  DP013-MESSAGE-TEXT(1)          03660021
036700             PERFORM DP013-0000-PROCESS-ABEND                     03670021
036800     END-EVALUATE.                                                03680021
036900                                                                  03690021
037000*----------------------------------------------------------------*03700021
037100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *03710021
037200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *03720021
037300*----------------------------------------------------------------*03730021
037400                                                                  03740021
037500 1100-PROCESS-INTER-APPL-COMM.                                    03750021
037600                                                                  03760021
037700     SET PS-COMMAREA-VALID     TO TRUE.                           03770021
037800     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03780021
037900     MOVE RD021-NUMBER-OF-SELECTED-ITEMS                          03790021
038000                                  TO ASC-NUMBER-OF-SELECTED-ITEMS.03800021
038100     MOVE RD021-NUMBER-OF-TS-ITEMS                                03810021
038200                                  TO ASC-NUMBER-OF-TS-ITEMS.      03820021
038300     MOVE RD021-SEL-QUEUE-NAME    TO ASC-SEL-QUEUE-NAME.          03830021
038400     PERFORM 1120-PREPARE-LIST-ENTRY.                             03840021
038500                                                                  03850021
038600     IF ASC-TRN-AUTH-TMST = SPACES                                03860021
038700         SET PS-COMMAREA-NOT-VALID   TO TRUE                      03870030
038800*        --- NO DETAIL EXISTS ---                                 03880030
038900         MOVE PC-TSYMSG-00134        TO DP020-MSG-NUMBER          03890021
039000         SET DP020-MSG-FATAL         TO TRUE                      03900030
039100     END-IF.                                                      03910021
039200                                                                  03920021
039300*----------------------------------------------------------------*03930021
039400*    GET READY TO START AT THE FIRST ITEM SELECTED FROM THE LIST.*03940021
039500*----------------------------------------------------------------*03950021
039600                                                                  03960021
039700 1120-PREPARE-LIST-ENTRY.                                         03970021
039800                                                                  03980021
039900     MOVE RD022-MAX-ITEMS TO ASC-SEL-SUB.                         03990021
040000     MOVE ZERO            TO ASC-SEL-ITEM.                        04000021
040100     PERFORM 2140-GET-NEXT-SELECTION.                             04010021
040200                                                                  04020047
040300*----------------------------------------------------------------*04030047
040400* SET UP CARD NUMBER FOR TABLE ACCESS                            *04040047
040500*----------------------------------------------------------------*04050047
040600 1170-SETUP-CARD-NBR.                                             04060047
           MOVE ASC-CRD-ID               TO SV007-CARD-NUMBER-IN.               
           MOVE 0                        TO SV007-CARD-NUMBER-LENGTH            
           SET SV007-FORMAT-IN           TO TRUE                                
           PERFORM SV007-FORMAT-CARD                                            
           MOVE SV007-CARD-NBR           TO DK-CRD-NBR                          
041100                                      ASC-SHORT-CRD-ID.           04110064
041200*----------------------------------------------------------------*04120021
041300*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *04130021
041400*    ON WHAT FUNCTION KEY WAS SELECTED.                          *04140021
041500*----------------------------------------------------------------*04150021
041600                                                                  04160021
041700 2000-PROCESS-PANEL.                                              04170021
041800                                                                  04180021
041900     EVALUATE TRUE                                                04190021
042000         WHEN DP020-SRC-AID = DP016-CLEAR                         04200021
042100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04210021
042200                                                                  04220021
042300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04230021
042400             SET PS-ITEMS-FOUND TO TRUE                           04240031
042500             PERFORM 4000-BUILD-INITIAL-PANEL                     04250031
042600             IF PS-ITEMS-NOT-FOUND                                04260031
042700                PERFORM 4005-BUILD-INITIAL-HIST                   04270031
042800             END-IF                                               04280031
042900                                                                  04290021
043000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04300021
043100             PERFORM 2140-GET-NEXT-SELECTION                      04310021
043200             IF PS-LIST-END                                       04320021
043300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04330021
043400                 SET PS-NO-LIST-END TO TRUE                       04340021
043500             ELSE                                                 04350021
043600                 SET PS-ITEMS-FOUND TO TRUE                       04360031
043700                 PERFORM 4000-BUILD-INITIAL-PANEL                 04370031
043800                 IF PS-ITEMS-NOT-FOUND                            04380031
043900                    PERFORM 4005-BUILD-INITIAL-HIST               04390031
044000                 END-IF                                           04400031
044100             END-IF                                               04410021
044200                                                                  04420021
044300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             04430021
044400             PERFORM 2150-GET-PREV-SELECTION                      04440021
044500             IF PS-LIST-END                                       04450021
044600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04460021
044700                 SET PS-NO-LIST-END TO TRUE                       04470021
044800             ELSE                                                 04480021
044900                 SET PS-ITEMS-FOUND TO TRUE                       04490031
045000                 PERFORM 4000-BUILD-INITIAL-PANEL                 04500031
045100                 IF PS-ITEMS-NOT-FOUND                            04510031
045200                    PERFORM 4005-BUILD-INITIAL-HIST               04520031
045300                 END-IF                                           04530031
045400             END-IF                                               04540021
045500                                                                  04550021
045600         WHEN DP020-SRC-AID = DP016-ENTER                         04560021
045700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04570021
045800                                                                  04580021
045900         WHEN OTHER                                               04590021
046000             SET DP013-NO-ROLLBACK TO TRUE                        04600021
046100             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               04610021
046200             SET DP013-CICS-ABEND TO TRUE                         04620021
046300             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    04630021
046400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04640021
046500                                   TO DP013-MESSAGE-TEXT (1)      04650021
046600             PERFORM DP013-0000-PROCESS-ABEND                     04660021
046700                                                                  04670021
046800     END-EVALUATE.                                                04680021
046900*----------------------------------------------------------------*04690021
047000*    GET THE NEXT SELECTION IF A LIST OF SELECTIONS IS BEING     *04700021
047100*    PROCESSED.                                                  *04710021
047200*----------------------------------------------------------------*04720021
047300                                                                  04730021
047400 2140-GET-NEXT-SELECTION.                                         04740021
047500                                                                  04750021
047600     ADD +1                       TO ASC-SEL-SUB.                 04760021
047700     IF  ASC-SEL-SUB > RD022-MAX-ITEMS                            04770021
047800         ADD +1                   TO ASC-SEL-ITEM                 04780021
047900         MOVE +1                  TO ASC-SEL-SUB                  04790021
048000     END-IF.                                                      04800021
048100     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                04810021
048200         PERFORM 9100-READ-SEL-QUEUE                              04820021
048300         IF  RD022-ITEM (ASC-SEL-SUB) > ZERO                      04830021
048400             PERFORM 2141-MOVE-SEL-TO-ASC                         04840021
048500             SET RD022-INQ (ASC-SEL-SUB) TO TRUE                  04850021
048600             PERFORM 9200-REWRITE-SEL-QUEUE                       04860021
048700         ELSE                                                     04870021
048800             SUBTRACT +1 FROM ASC-SEL-SUB                         04880021
048900*            --- BOTTOM OF LIST ---                               04890021
049000             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             04900021
049100             SET DP020-MSG-INFORMATIONAL TO TRUE                  04910021
049200             SET PS-LIST-END             TO TRUE                  04920021
049300         END-IF                                                   04930021
049400     ELSE                                                         04940021
049500         SUBTRACT +1 FROM ASC-SEL-ITEM                            04950021
049600         MOVE RD022-MAX-ITEMS     TO ASC-SEL-SUB                  04960021
049700*        --- BOTTOM OF LIST ---                                   04970021
049800         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             04980021
049900         SET DP020-MSG-INFORMATIONAL TO TRUE                      04990021
050000         SET PS-LIST-END             TO TRUE                      05000021
050100     END-IF.                                                      05010021
050200                                                                  05020021
050300*----------------------------------------------------------------*05030021
050400*    MOVE KEYS FOR SELECTED ITEM TO APPLICATION SPECIFIC         *05040021
050500*    COMMAREA.                                                   *05050021
050600*----------------------------------------------------------------*05060021
050700                                                                  05070021
050800 2141-MOVE-SEL-TO-ASC.                                            05080021
050900                                                                  05090021
051000     MOVE RD022-CARD-ID           (ASC-SEL-SUB)                   05100021
051100                                   TO ASC-CRD-ID.                 05110021
051200     PERFORM 1170-SETUP-CARD-NBR.                                 05120047
051300     MOVE RD022-CNTL-NBR          (ASC-SEL-SUB)                   05130021
051400                                   TO ASC-CNTL-NBR.               05140021
051500     MOVE RD022-TRN-AUTH-TMST     (ASC-SEL-SUB)                   05150021
051600                                   TO ASC-TRN-AUTH-TMST.          05160021
051700     MOVE RD022-CARD-TYPE         (ASC-SEL-SUB)                   05170021
051800                                   TO ASC-CARD-TYPE-CDE.          05180021
051900     SET SV004-CARD-TYP-IDX TO 1.                                 05190044
052000     SEARCH SV004-CARD-TYP-OCC                                    05200044
052100         AT END                                                   05210021
052200             MOVE SPACES       TO ASC-CARD-TYPE-DESC              05220021
052300         WHEN SV004-CARD-TYP-CD (SV004-CARD-TYP-IDX)              05230060
052400                               = RD022-CARD-TYPE (ASC-SEL-SUB)    05240060
052500             MOVE SV004-CARD-TYP-DESC (SV004-CARD-TYP-IDX)        05250044
052600                               TO ASC-CARD-TYPE-DESC              05260021
052700     END-SEARCH.                                                  05270021
052800*----------------------------------------------------------------*05280021
052900*    GET THE PREVIOUS SELECTION IF A LIST OF SELECTIONS IS BEING *05290021
053000*    PROCESSED.                                                  *05300021
053100*----------------------------------------------------------------*05310021
053200                                                                  05320021
053300 2150-GET-PREV-SELECTION.                                         05330021
053400                                                                  05340021
053500     SUBTRACT +1 FROM ASC-SEL-SUB.                                05350021
053600     IF  ASC-SEL-SUB < +1                                         05360021
053700         SUBTRACT +1 FROM ASC-SEL-ITEM                            05370021
053800         MOVE RD022-MAX-ITEMS     TO ASC-SEL-SUB                  05380021
053900     END-IF.                                                      05390021
054000                                                                  05400021
054100     IF  ASC-SEL-ITEM > ZERO                                      05410021
054200         PERFORM 9100-READ-SEL-QUEUE                              05420021
054300         PERFORM 2141-MOVE-SEL-TO-ASC                             05430021
054400     ELSE                                                         05440021
054500         MOVE +1                  TO ASC-SEL-ITEM                 05450021
054600                                     ASC-SEL-SUB                  05460021
054700*        --- TOP OF LIST ---                                      05470021
054800         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             05480021
054900         SET DP020-MSG-INFORMATIONAL TO TRUE                      05490021
055000         SET PS-LIST-END             TO TRUE                      05500021
055100     END-IF.                                                      05510021
055200                                                                  05520021
055300*----------------------------------------------------------------*05530021
055400*    BUILD INITIAL PANEL.                                        *05540021
055500*----------------------------------------------------------------*05550021
055600                                                                  05560021
055700 4000-BUILD-INITIAL-PANEL.                                        05570021
055800                                                                  05580021
055900     MOVE ASC-SHORT-CRD-ID  TO DK-CRD-NBR.                        05590072
056000     MOVE ASC-TRN-AUTH-TMST TO DK-TRN-AUTH-TMST.                  05600072
056100                                                                  05610021
P12431     MOVE 0 TO PV-ORD-NBR-NULL-IND.                               05610021
P12431     MOVE SPACES TO SVT00002-ORD-NBR-TEXT.                        05610021
056100                                                                  05610021
056200     EXEC SQL                                                     05620021
056300         SELECT DRV_LIC_NBR,                                      05630021
056400                TRN_RVRSL_CDE,                                    05640021
056500                TRN_VOID_IND,                                     05650021
056600                ACTVY_TYP_CDE,                                    05660021
056700                POS_DTE,                                          05670021
056800                STR_NBR,                                          05680021
056900                POS_TRMNL_NBR,                                    05690021
057000                POS_TRN_NBR,                                      05700021
057100                TRN_PSTD_TMST,                                    05710021
057200                APP_AUTH_AMT,                                     05720021
057300                POS_OPRT_ID,                                      05730021
057400                APVL_USR_ID,                                      05740021
057500                ACTVY_STAT_CDE,                                   05750021
057600                ORIG_AUTH_AMT,                                    05760021
P12431                ORD_NBR                                           05760021
057700           INTO :SVT00002-DRV-LIC-NBR,                            05770042
057800                :SVT00002-TRN-RVRSL-CDE,                          05780042
057900                :SVT00002-TRN-VOID-IND,                           05790042
058000                :SVT00002-ACTVY-TYP-CDE,                          05800042
058100                :SVT00002-POS-DTE,                                05810042
058200                :SVT00002-STR-NBR,                                05820042
058300                :SVT00002-POS-TRMNL-NBR,                          05830042
058400                :SVT00002-POS-TRN-NBR,                            05840042
058500                :SVT00002-TRN-PSTD-TMST,                          05850042
058600                :SVT00002-APP-AUTH-AMT,                           05860042
058700                :SVT00002-POS-OPRT-ID,                            05870042
058800                :SVT00002-APVL-USR-ID,                            05880042
058900                :SVT00002-ACTVY-STAT-CDE,                         05890042
059000                :SVT00002-ORIG-AUTH-AMT,                          05900042
P12431                :SVT00002-ORD-NBR :PV-ORD-NBR-NULL-IND            05900042
059100           FROM SVT_KOHLS_CRD_TXN                                 05910042
059200          WHERE CRD_NBR       = :DK-CRD-NBR                       05920021
059300            AND TRN_AUTH_TMST = :DK-TRN-AUTH-TMST                 05930021
059301          WITH UR                                                         
059400     END-EXEC.                                                    05940021
059500                                                                  05950021
059600     EVALUATE TRUE                                                05960021
059700                                                                  05970021
059800       WHEN SQLCODE = ZERO                                        05980021
059900           MOVE SVT00002-DRV-LIC-NBR  TO ASC-DRV-LIC-NBR          05990042
124679           IF ASC-DRV-LIC-NBR > SPACES                            05990042
124679              MOVE SQLCODE            TO PV-HOLD-SQLCODE                  
124679              PERFORM 4500-DL-ROUTINE                                     
124679              MOVE PV-HOLD-SQLCODE    TO SQLCODE                          
124679           END-IF                                                 05990042
060000           MOVE SVT00002-TRN-RVRSL-CDE TO ASC-TRN-RVRSL-CDE       06000042
060100           MOVE SVT00002-TRN-VOID-IND TO ASC-TRN-VOID-IND         06010042
060200           MOVE SVT00002-ACTVY-TYP-CDE TO ASC-ACTVY-TYP-CDE       06020042
060300           MOVE SVT00002-POS-DTE      TO ASC-POS-DTE              06030042
060400           MOVE SVT00002-STR-NBR      TO ASC-STR-NBR              06040042
060500           MOVE SVT00002-POS-TRMNL-NBR TO ASC-POS-TRMNL-NBR       06050042
060600           MOVE SVT00002-POS-TRN-NBR  TO ASC-POS-TRN-NBR          06060042
060700           MOVE SVT00002-TRN-PSTD-TMST TO ASC-PSTD-DTE            06070042
060800           MOVE SVT00002-APP-AUTH-AMT TO ASC-APP-AUTH-AMT         06080042
060900           MOVE SVT00002-POS-OPRT-ID  TO ASC-POS-OPRT-ID          06090042
P12431           IF PV-ORD-NBR-NULL-IND < +0                            06100042
P12431              MOVE SPACES                TO ASC-ORD-NBR           06100042
P12431           ELSE                                                   06100042
P12431              MOVE SVT00002-ORD-NBR-TEXT TO ASC-ORD-NBR           06100042
P12431           END-IF                                                 06100042
061000           MOVE SVT00002-APVL-USR-ID  TO ASC-APVL-USR-ID          06100042
061100           MOVE SVT00002-ACTVY-STAT-CDE TO ASC-ACTVY-STAT-CDE     06110042
061200           MOVE SVT00002-ORIG-AUTH-AMT TO ASC-ORIG-AUTH-AMT       06120042
061300                                                                  06130021
061400       WHEN SQLCODE = +100                                        06140021
061500         SET PS-ITEMS-NOT-FOUND TO TRUE                           06150033
061600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    06160039
061700         SET DP020-MSG-FATAL   TO  TRUE                           06170039
061800*        --- NO DETAIL EXISTS ---                                 06180040
061900         MOVE PC-TSYMSG-00134  TO  DP020-MSG-NUMBER               06190039
062000                                                                  06200021
062100       WHEN OTHER                                                 06210021
062200          MOVE '4000-BUILD-INITIAL-PANEL'                         06220021
062300                                   TO DP013-PARAGRAPH             06230021
062400          MOVE 'UNABLE TO SELECT TRANSACTION'                     06240021
062500                                   TO DP013-MESSAGE-TEXT (1)      06250021
062600          MOVE SQLCA               TO DP013-SQLCA                 06260021
062700          MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME (1)    06270042
062800          SET DP013-DB2-ABEND      TO TRUE                        06280021
062900          PERFORM DP013-0000-PROCESS-ABEND                        06290021
063000                                                                  06300021
063100     END-EVALUATE.                                                06310021
063200                                                                  06320021
063300     IF SQLCODE = ZERO                                            06330021
063400         PERFORM 4010-OPEN-CURSOR                                 06340021
063500         PERFORM 4300-FETCH-COMMENTS                              06350021
063600         PERFORM 4020-CLOSE-CURSOR                                06360021
063700                                                                  06370021
063800         PERFORM 4030-GET-DESCRIPTIONS                            06380021
063900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     06390021
064000     END-IF.                                                      06400021
064100                                                                  06410021
064200*----------------------------------------------------------------*06420031
064300*    BUILD HIST INITIAL PANEL.                                   *06430031
064400*----------------------------------------------------------------*06440031
064500 4005-BUILD-INITIAL-HIST.                                         06450031
064600                                                                  06460031
064700     MOVE ASC-TRN-AUTH-TMST           TO DK-TRN-AUTH-TMST.        06470031
064800                                                                  06480031
P12431     MOVE 0 TO PV-ORD-NBR-NULL-IND.                               06480031
P12431     MOVE SPACES TO SVT00006-ORD-NBR-TEXT.                        06480031
064800                                                                  06480031
064900     EXEC SQL                                                     06490031
065000         SELECT DRV_LIC_NBR,                                      06500031
065100                TRN_RVRSL_CDE,                                    06510031
065200                TRN_VOID_IND,                                     06520031
065300                ACTVY_TYP_CDE,                                    06530031
065400                POS_DTE,                                          06540031
065500                STR_NBR,                                          06550031
065600                POS_TRMNL_NBR,                                    06560031
065700                POS_TRN_NBR,                                      06570031
065800                TRN_PSTD_TMST,                                    06580031
065900                APP_AUTH_AMT,                                     06590031
066000                POS_OPRT_ID,                                      06600031
066100                APVL_USR_ID,                                      06610031
066200                ACTVY_STAT_CDE,                                   06620031
066300                ORIG_AUTH_AMT,                                    06630031
P12431                ORD_NBR                                           06630031
066400           INTO :SVT00006-DRV-LIC-NBR,                            06640042
066500                :SVT00006-TRN-RVRSL-CDE,                          06650042
066600                :SVT00006-TRN-VOID-IND,                           06660042
066700                :SVT00006-ACTVY-TYP-CDE,                          06670042
066800                :SVT00006-POS-DTE,                                06680042
066900                :SVT00006-STR-NBR,                                06690042
067000                :SVT00006-POS-TRMNL-NBR,                          06700042
067100                :SVT00006-POS-TRN-NBR,                            06710042
067200                :SVT00006-TRN-PSTD-TMST,                          06720042
067300                :SVT00006-APP-AUTH-AMT,                           06730042
067400                :SVT00006-POS-OPRT-ID,                            06740042
067500                :SVT00006-APVL-USR-ID,                            06750042
067600                :SVT00006-ACTVY-STAT-CDE,                         06760042
067700                :SVT00006-ORIG-AUTH-AMT,                          06770042
P12431                :SVT00006-ORD-NBR :PV-ORD-NBR-NULL-IND            06770042
067800           FROM SVT_CRD_TXN_HIST                                  06780042
067900          WHERE CRD_NBR       = :DK-CRD-NBR                       06790031
068000            AND TRN_AUTH_TMST = :DK-TRN-AUTH-TMST                 06800031
068001          WITH UR                                                         
068100     END-EXEC.                                                    06810031
068200                                                                  06820031
068300     EVALUATE TRUE                                                06830031
068400                                                                  06840031
068500       WHEN SQLCODE = ZERO                                        06850031
068600           MOVE SVT00006-DRV-LIC-NBR  TO ASC-DRV-LIC-NBR          06860042
124679           IF ASC-DRV-LIC-NBR > SPACES                            06860042
124679              MOVE SQLCODE            TO PV-HOLD-SQLCODE                  
124679              PERFORM 4500-DL-ROUTINE                                     
124679              MOVE PV-HOLD-SQLCODE    TO SQLCODE                          
124679           END-IF                                                 06860042
068700           MOVE SVT00006-TRN-RVRSL-CDE TO ASC-TRN-RVRSL-CDE       06870042
068800           MOVE SVT00006-TRN-VOID-IND TO ASC-TRN-VOID-IND         06880042
068900           MOVE SVT00006-ACTVY-TYP-CDE TO ASC-ACTVY-TYP-CDE       06890042
069000           MOVE SVT00006-POS-DTE      TO ASC-POS-DTE              06900042
069100           MOVE SVT00006-STR-NBR      TO ASC-STR-NBR              06910042
069200           MOVE SVT00006-POS-TRMNL-NBR TO ASC-POS-TRMNL-NBR       06920042
069300           MOVE SVT00006-POS-TRN-NBR  TO ASC-POS-TRN-NBR          06930042
069400           MOVE SVT00006-TRN-PSTD-TMST TO ASC-PSTD-DTE            06940042
069500           MOVE SVT00006-APP-AUTH-AMT TO ASC-APP-AUTH-AMT         06950042
069600           MOVE SVT00006-POS-OPRT-ID  TO ASC-POS-OPRT-ID          06960042
P12431           IF PV-ORD-NBR-NULL-IND < +0                            06960042
P12431              MOVE SPACES                TO ASC-ORD-NBR           06960042
P12431           ELSE                                                   06960042
P12431              MOVE SVT00006-ORD-NBR-TEXT TO ASC-ORD-NBR           06960042
P12431           END-IF                                                 06960042
069700           MOVE SVT00006-APVL-USR-ID  TO ASC-APVL-USR-ID          06970042
069800           MOVE SVT00006-ACTVY-STAT-CDE TO ASC-ACTVY-STAT-CDE     06980042
069900           MOVE SVT00006-ORIG-AUTH-AMT TO ASC-ORIG-AUTH-AMT       06990042
070000           MOVE SPACES TO DP020-MSG-SEVERITY-IND                  07000067
070100           MOVE SPACES TO DP020-NEXT-APPL-ACTIVITY                07010067
070200           MOVE SPACES TO DP020-MSG-MESSAGE                       07020069
070300                                                                  07030031
070400       WHEN SQLCODE = +100                                        07040031
070500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    07050031
070600         SET DP020-MSG-FATAL   TO  TRUE                           07060031
070700*        --- NO DETAIL EXISTS ---                                 07070031
070800         MOVE PC-TSYMSG-00134  TO  DP020-MSG-NUMBER               07080031
070900                                                                  07090031
071000       WHEN OTHER                                                 07100031
071100          MOVE '4005-BUILD-INITIAL-HIST'                          07110031
071200                                   TO DP013-PARAGRAPH             07120031
071300          MOVE 'UNABLE TO SELECT TRANSACTION'                     07130031
071400                                   TO DP013-MESSAGE-TEXT (1)      07140031
071500          MOVE SQLCA               TO DP013-SQLCA                 07150031
071600          MOVE 'SVT_CRD_TXN_HIST'  TO DP013-DB2-TABLE-NAME (1)    07160042
071700          SET DP013-DB2-ABEND      TO TRUE                        07170031
071800          PERFORM DP013-0000-PROCESS-ABEND                        07180031
071900                                                                  07190031
072000     END-EVALUATE.                                                07200031
072100                                                                  07210031
072200     IF SQLCODE = ZERO                                            07220031
072300         PERFORM 4015-OPEN-CURSOR-HIST                            07230034
072400         PERFORM 4305-FETCH-COMMENTS-HIST                         07240034
072500         PERFORM 4025-CLOSE-CURSOR-HIST                           07250034
072600                                                                  07260031
072700         PERFORM 4030-GET-DESCRIPTIONS                            07270035
072800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     07280031
072900     END-IF.                                                      07290031
073000                                                                  07300031
073100*----------------------------------------------------------------*07310021
073200* OPEN THE CURSOR.                                               *07320021
073300*----------------------------------------------------------------*07330021
073400                                                                  07340021
073500 4010-OPEN-CURSOR.                                                07350021
073600                                                                  07360021
073700     EXEC SQL                                                     07370021
073800          OPEN COMMENT-CSR                                        07380021
073900     END-EXEC.                                                    07390021
074000                                                                  07400021
074100     EVALUATE TRUE                                                07410021
074200         WHEN SQLCODE = ZERO                                      07420021
074300              CONTINUE                                            07430021
074400         WHEN OTHER                                               07440021
074500              MOVE '4010-OPEN-CURSOR'                             07450021
074600                           TO DP013-PARAGRAPH                     07460021
074700              MOVE 'OPEN COMMENT CURSOR'                          07470021
074800                           TO DP013-MESSAGE-TEXT (1)              07480021
074900              MOVE 'SVT_CRD_ACCT_CMMT'                            07490042
075000                           TO DP013-DB2-TABLE-NAME (1)            07500021
075100              MOVE SQLCA   TO DP013-SQLCA                         07510021
075200              SET DP013-DB2-ABEND                                 07520021
075300                           TO TRUE                                07530021
075400              PERFORM DP013-0000-PROCESS-ABEND                    07540021
075500     END-EVALUATE.                                                07550021
075600                                                                  07560021
075700*----------------------------------------------------------------*07570034
075800* OPEN THE HISTORY CURSOR                                        *07580034
075900*----------------------------------------------------------------*07590034
076000 4015-OPEN-CURSOR-HIST.                                           07600034
076100                                                                  07610034
076200     EXEC SQL                                                     07620034
076300          OPEN COMMENT-CSR-HIST                                   07630034
076400     END-EXEC.                                                    07640034
076500                                                                  07650034
076600     EVALUATE TRUE                                                07660034
076700         WHEN SQLCODE = ZERO                                      07670034
076800              CONTINUE                                            07680034
076900         WHEN OTHER                                               07690034
077000              MOVE '4015-OPEN-CURSOR-HIST'                        07700034
077100                           TO DP013-PARAGRAPH                     07710034
077200              MOVE 'OPEN COMMENT CURSOR'                          07720034
077300                           TO DP013-MESSAGE-TEXT (1)              07730034
077400              MOVE 'SVT_CRD_CMMT_HIST'                            07740042
077500                           TO DP013-DB2-TABLE-NAME (1)            07750034
077600              MOVE SQLCA   TO DP013-SQLCA                         07760034
077700              SET DP013-DB2-ABEND                                 07770034
077800                           TO TRUE                                07780034
077900              PERFORM DP013-0000-PROCESS-ABEND                    07790034
078000     END-EVALUATE.                                                07800034
078100                                                                  07810034
078200 EJECT                                                            07820021
078300*----------------------------------------------------------------*07830021
078400* CLOSE THE CURSOR.                                              *07840021
078500*----------------------------------------------------------------*07850021
078600                                                                  07860021
078700 4020-CLOSE-CURSOR.                                               07870021
078800                                                                  07880021
078900     EXEC SQL                                                     07890021
079000         CLOSE COMMENT-CSR                                        07900021
079100     END-EXEC.                                                    07910021
079200                                                                  07920021
079300     EVALUATE TRUE                                                07930021
079400         WHEN SQLCODE = ZERO                                      07940021
079500              CONTINUE                                            07950021
079600         WHEN OTHER                                               07960021
079700              MOVE '4020-CLOSE-CURSOR'                            07970021
079800                           TO DP013-PARAGRAPH                     07980021
079900              MOVE 'CLOSE COMMENT CURSOR'                         07990021
080000                           TO DP013-MESSAGE-TEXT (1)              08000021
080100              MOVE 'SVT_CRD_ACCT_CMMT'                            08010042
080200                           TO DP013-DB2-TABLE-NAME (1)            08020021
080300              MOVE SQLCA   TO DP013-SQLCA                         08030021
080400              SET DP013-DB2-ABEND                                 08040021
080500                           TO TRUE                                08050021
080600              PERFORM DP013-0000-PROCESS-ABEND                    08060021
080700     END-EVALUATE.                                                08070021
080800                                                                  08080021
080900*----------------------------------------------------------------*08090034
081000* CLOSE THE HISTORY CURSOR.                                      *08100034
081100*----------------------------------------------------------------*08110034
081200 4025-CLOSE-CURSOR-HIST.                                          08120034
081300                                                                  08130034
081400     EXEC SQL                                                     08140034
081500         CLOSE COMMENT-CSR-HIST                                   08150034
081600     END-EXEC.                                                    08160034
081700                                                                  08170034
081800     EVALUATE TRUE                                                08180034
081900         WHEN SQLCODE = ZERO                                      08190034
082000              CONTINUE                                            08200034
082100         WHEN OTHER                                               08210034
082200              MOVE '4025-CLOSE-CURSOR-HIST'                       08220034
082300                           TO DP013-PARAGRAPH                     08230034
082400              MOVE 'CLOSE COMMENT CURSOR'                         08240034
082500                           TO DP013-MESSAGE-TEXT (1)              08250034
082600              MOVE 'SVT_CRD_CMMT_HIST'                            08260042
082700                           TO DP013-DB2-TABLE-NAME (1)            08270034
082800              MOVE SQLCA   TO DP013-SQLCA                         08280034
082900              SET DP013-DB2-ABEND                                 08290034
083000                           TO TRUE                                08300034
083100              PERFORM DP013-0000-PROCESS-ABEND                    08310034
083200     END-EVALUATE.                                                08320034
083300                                                                  08330034
083400*----------------------------------------------------------------*08340021
083500*    GET THE DESCRIPTIONS FOR THE VARIOUS CODES ON THE SCREEN.   *08350021
083600*    ALSO REFORMATS THE DATE FIELDS.                             *08360021
083700*----------------------------------------------------------------*08370021
083800                                                                  08380021
083900 4030-GET-DESCRIPTIONS.                                           08390021
084000                                                                  08400021
084100     SET SV004-ACT-TYP-IDX     TO 1.                              08410044
084200     SEARCH SV004-ACT-TYP-OCC                                     08420044
084300         AT END                                                   08430021
084400             MOVE SPACES       TO ASC-ACTVY-TYP-DESC              08440021
084500         WHEN SV004-ACT-TYP-CD (SV004-ACT-TYP-IDX)                08450044
084600                               = ASC-ACTVY-TYP-CDE                08460021
084700             MOVE SV004-ACT-TYP-SDESC (SV004-ACT-TYP-IDX)         08470044
084800                               TO ASC-ACTVY-TYP-DESC              08480021
084900     END-SEARCH.                                                  08490021
085000                                                                  08500021
085100     SET SV004-ACT-ST-IDX      TO 1.                              08510044
085200     SEARCH SV004-ACT-ST-OCC                                      08520044
085300         AT END                                                   08530021
085400             MOVE SPACES       TO ASC-ACTVY-STAT-DESC             08540021
085500         WHEN SV004-ACT-ST-CD (SV004-ACT-ST-IDX)                  08550044
085600                       = ASC-ACTVY-STAT-CDE                       08560021
085700             MOVE SV004-ACT-ST-DESC (SV004-ACT-ST-IDX)            08570044
085800                               TO ASC-ACTVY-STAT-DESC             08580021
085900     END-SEARCH.                                                  08590021
086000                                                                  08600021
086100     IF ASC-TRN-RVRSL-CDE = SV004-REV-CDE-REVERSAL                08610044
086200         MOVE SV004-REV-CDE-REV-LONG-DESC                         08620044
086300                               TO ASC-TRN-RVRSL-DESC              08630021
086400     ELSE                                                         08640021
086500         MOVE SV004-REV-CDE-NORM-LONG-DESC                        08650044
086600                               TO ASC-TRN-RVRSL-DESC              08660021
086700     END-IF.                                                      08670021
086800                                                                  08680021
086900     IF ASC-TRN-VOID-IND  = SV004-VOID-TRANS                      08690044
087000         MOVE SV004-VOID-LONG-DESC                                08700044
087100                               TO ASC-TRN-VOID-DESC               08710021
087200         MOVE SV004-VOID-DISPLAY                                  08720044
087300                               TO ASC-TRN-VOID-IND                08730021
087400     ELSE                                                         08740021
087500         MOVE SV004-NOT-VOID-LONG-DESC                            08750044
087600                               TO ASC-TRN-VOID-DESC               08760021
087700     END-IF.                                                      08770021
087800                                                                  08780021
087900     MOVE ASC-STR-NBR                   TO DK-STORE-NUMBER.       08790070
088000                                                                  08800021
088100     EXEC SQL                                                     08810021
088200         SELECT LOC_NM                                            08820071
088300           INTO :XST00001-LOC-NM                                  08830071
088400           FROM XST_LOC                                           08840070
088500          WHERE  LOC_NBR = :DK-STORE-NUMBER                       08850070
088501          WITH UR                                                         
088600     END-EXEC.                                                    08860021
088700                                                                  08870021
088800     EVALUATE TRUE                                                08880021
088900         WHEN SQLCODE = 0                                         08890021
089000             MOVE XST00001-LOC-NM       TO ASC-STR-NAME           08900071
089100         WHEN OTHER                                               08910021
089200             MOVE SPACES                TO ASC-STR-NAME           08920021
089300     END-EVALUATE.                                                08930021
089400                                                                  08940021
089500     MOVE ASC-TRN-AUTH-TMST             TO PV-TMST-ISO.           08950021
089600     MOVE PV-TMST-ISO-DATE              TO PV-DATE-ISO.           08960021
089700     MOVE PV-DATE-ISO-YYYY              TO PV-DATE-FMT-YYYY.      08970021
089800     MOVE PV-DATE-ISO-MM                TO PV-DATE-FMT-MM.        08980021
089900     MOVE PV-DATE-ISO-DD                TO PV-DATE-FMT-DD.        08990021
090000     MOVE PV-DATE-FMT                   TO PV-TMST-FMT-DATE.      09000021
090100     MOVE PV-TMST-ISO-TIME              TO PV-TMST-FMT-TIME.      09010021
090200     MOVE PV-TMST-FMT                   TO                        09020021
090300                                        ASC-DISPLAY-TRN-AUTH-TMST.09030021
090400                                                                  09040021
090500     MOVE ASC-POS-DTE                   TO PV-DATE-ISO.           09050021
090600     MOVE PV-DATE-ISO-YYYY              TO PV-DATE-FMT-YYYY.      09060021
090700     MOVE PV-DATE-ISO-MM                TO PV-DATE-FMT-MM.        09070021
090800     MOVE PV-DATE-ISO-DD                TO PV-DATE-FMT-DD.        09080021
090900     MOVE PV-DATE-FMT                   TO ASC-POS-DTE.           09090021
091000                                                                  09100021
091100     IF ASC-PSTD-DTE = SV004-DEFAULT-DATE                         09110044
091200         MOVE SPACES                    TO ASC-PSTD-DTE           09120021
091300     ELSE                                                         09130021
091400         MOVE ASC-PSTD-DTE              TO PV-DATE-ISO            09140021
091500         MOVE PV-DATE-ISO-YYYY          TO PV-DATE-FMT-YYYY       09150021
091600         MOVE PV-DATE-ISO-MM            TO PV-DATE-FMT-MM         09160021
091700         MOVE PV-DATE-ISO-DD            TO PV-DATE-FMT-DD         09170021
091800         MOVE PV-DATE-FMT               TO ASC-PSTD-DTE           09180021
091900     END-IF.                                                      09190021
092000                                                                  09200021
092100*----------------------------------------------------------------*09210021
092200*    FETCH THE COMMENTS USING THE COMMENT CURSOR.                *09220021
092300*----------------------------------------------------------------*09230021
092400                                                                  09240021
092500 4300-FETCH-COMMENTS.                                             09250021
092600                                                                  09260021
092700     EXEC SQL                                                     09270021
092800          FETCH COMMENT-CSR                                       09280021
092900          INTO  :SVT00003-CMNT-SEQ-NBR,                           09290042
093000                :SVT00003-CMNT-TXT                                09300042
093100     END-EXEC.                                                    09310021
093200                                                                  09320021
093300     EVALUATE TRUE                                                09330021
093400         WHEN SQLCODE = ZERO                                      09340021
093500              MOVE SVT00003-CMNT-TXT                              09350042
093600                           TO ASC-COMMENT-LINE1                   09360021
093700         WHEN SQLCODE = +100                                      09370021
093800              CONTINUE                                            09380021
093900         WHEN OTHER                                               09390021
094000              MOVE '4310-FETCH-COMMENTS'                          09400021
094100                           TO DP013-PARAGRAPH                     09410021
094200              MOVE 'FETCH COMMENTS'                               09420021
094300                           TO DP013-MESSAGE-TEXT (1)              09430021
094400              MOVE 'SVT_CRD_ACCT_CMMT'                            09440042
094500                           TO DP013-DB2-TABLE-NAME (1)            09450021
094600              MOVE SQLCA   TO DP013-SQLCA                         09460021
094700              SET DP013-DB2-ABEND                                 09470021
094800                           TO TRUE                                09480021
094900              PERFORM DP013-0000-PROCESS-ABEND                    09490021
095000     END-EVALUATE.                                                09500021
095100                                                                  09510021
095200     IF SQLCODE = ZERO                                            09520021
095300         EXEC SQL                                                 09530021
095400              FETCH COMMENT-CSR                                   09540021
095500              INTO  :SVT00003-CMNT-SEQ-NBR,                       09550042
095600                    :SVT00003-CMNT-TXT                            09560042
095700         END-EXEC                                                 09570021
095800         EVALUATE TRUE                                            09580021
095900             WHEN SQLCODE = ZERO                                  09590021
096000                  MOVE SVT00003-CMNT-TXT                          09600042
096100                               TO ASC-COMMENT-LINE2               09610021
096200             WHEN SQLCODE = +100                                  09620021
096300                  CONTINUE                                        09630021
096400             WHEN OTHER                                           09640021
096500                  MOVE '4310-FETCH-COMMENTS'                      09650021
096600                               TO DP013-PARAGRAPH                 09660021
096700                  MOVE 'FETCH COMMENTS'                           09670021
096800                               TO DP013-MESSAGE-TEXT (1)          09680021
096900                  MOVE 'SVT_CRD_ACCT_CMMT'                        09690042
097000                               TO DP013-DB2-TABLE-NAME (1)        09700021
097100                  MOVE SQLCA   TO DP013-SQLCA                     09710021
097200                  SET DP013-DB2-ABEND                             09720021
097300                               TO TRUE                            09730021
097400                  PERFORM DP013-0000-PROCESS-ABEND                09740021
097500         END-EVALUATE                                             09750021
097600     END-IF.                                                      09760021
097700                                                                  09770021
097800*----------------------------------------------------------------*09780034
097900*    FETCH THE COMMENTS USING THE COMMENT HISTORY CURSOR.        *09790034
098000*----------------------------------------------------------------*09800034
098100 4305-FETCH-COMMENTS-HIST.                                        09810034
098200                                                                  09820034
098300     EXEC SQL                                                     09830034
098400          FETCH COMMENT-CSR-HIST                                  09840034
098500          INTO  :SVT00007-CMNT-SEQ-NBR,                           09850042
098600                :SVT00007-CMNT-TXT                                09860042
098700     END-EXEC.                                                    09870034
098800                                                                  09880034
098900     EVALUATE TRUE                                                09890034
099000         WHEN SQLCODE = ZERO                                      09900034
099100              MOVE SVT00007-CMNT-TXT                              09910042
099200                           TO ASC-COMMENT-LINE1                   09920034
099300         WHEN SQLCODE = +100                                      09930034
099400              CONTINUE                                            09940034
099500         WHEN OTHER                                               09950034
099600              MOVE '4315-FETCH-COMMENTS-HIST'                     09960034
099700                           TO DP013-PARAGRAPH                     09970034
099800              MOVE 'FETCH COMMENTS'                               09980034
099900                           TO DP013-MESSAGE-TEXT (1)              09990034
100000              MOVE 'SVT_CRD_CMMT_HIST'                            10000042
100100                           TO DP013-DB2-TABLE-NAME (1)            10010034
100200              MOVE SQLCA   TO DP013-SQLCA                         10020034
100300              SET DP013-DB2-ABEND                                 10030034
100400                           TO TRUE                                10040034
100500              PERFORM DP013-0000-PROCESS-ABEND                    10050034
100600     END-EVALUATE.                                                10060034
100700                                                                  10070034
100800     IF SQLCODE = ZERO                                            10080034
100900         EXEC SQL                                                 10090034
101000              FETCH COMMENT-CSR-HIST                              10100034
101100              INTO  :SVT00007-CMNT-SEQ-NBR,                       10110042
101200                    :SVT00007-CMNT-TXT                            10120042
101300         END-EXEC                                                 10130034
101400         EVALUATE TRUE                                            10140034
101500             WHEN SQLCODE = ZERO                                  10150034
101600                  MOVE SVT00007-CMNT-TXT                          10160042
101700                               TO ASC-COMMENT-LINE2               10170034
101800             WHEN SQLCODE = +100                                  10180034
101900                  CONTINUE                                        10190034
102000             WHEN OTHER                                           10200034
102100                  MOVE '4315-FETCH-COMMENTS-HIST'                 10210034
102200                               TO DP013-PARAGRAPH                 10220034
102300                  MOVE 'FETCH COMMENTS'                           10230034
102400                               TO DP013-MESSAGE-TEXT (1)          10240034
102500                  MOVE 'SVT_CRD_CMMT_HIST'                        10250042
102600                               TO DP013-DB2-TABLE-NAME (1)        10260034
102700                  MOVE SQLCA   TO DP013-SQLCA                     10270034
102800                  SET DP013-DB2-ABEND                             10280034
102900                               TO TRUE                            10290034
103000                  PERFORM DP013-0000-PROCESS-ABEND                10300034
103100         END-EVALUATE                                             10310034
103200     END-IF.                                                      10320034
103300                                                                  10330034
103400*----------------------------------------------------------------*10340021
103500*    FORMAT THE MAP.                                             *10350021
103600*----------------------------------------------------------------*10360021
103700                                                                  10370021
103800 4400-MOVE-COMMAREA-TO-SCREEN.                                    10380021
103900                                                                  10390021
104000*    MOVE ASC-CRD-ID             TO ACARDIDO.                     10400021
           MOVE ASC-CRD-ID             TO SV007-CARD-NUMBER9                    
           MOVE 13                     TO SV007-CARD-NUMBER-DIS-LENGTH          
           SET SV007-FORMAT-DISPLAY    TO TRUE                                  
           PERFORM SV007-FORMAT-CARD                                            
           MOVE SV007-CARD-NUMBER-DISPLAY TO ACARDIDO                           
104100     MOVE ASC-CARD-TYPE-CDE      TO ACRDTYPO.                     10410021
104200     MOVE ASC-CARD-TYPE-DESC     TO ACRDDESO.                     10420021
104300     MOVE ASC-CNTL-NBR           TO ACNTLIDO.                     10430021
124679**   MOVE ASC-DRV-LIC-NBR        TO ADRVLICO.                     10440021
124679     IF ASC-DRV-LIC-NBR-EXP > SPACES                              05990042
124679        MOVE ASC-DRV-LIC-NBR-EXP TO ADRVLICO                      10440021
124679     ELSE                                                         10440021
124679        MOVE PV-DL-NBR-CHECK     TO ADRVLICO                      10440021
124679     END-IF.                                                      10440021
104500     MOVE ASC-ACTVY-TYP-CDE      TO AACTTYPO.                     10450021
104600     MOVE ASC-ACTVY-TYP-DESC     TO AACTTDSO.                     10460021
104700     MOVE ASC-ACTVY-STAT-CDE     TO AACTSTAO.                     10470021
104800     MOVE ASC-ACTVY-STAT-DESC    TO AACTSDSO.                     10480021
104900     MOVE ASC-DISPLAY-TRN-AUTH-TMST                               10490021
105000                                 TO AAUTHDTO.                     10500021
105100     MOVE ASC-TRN-RVRSL-CDE      TO AREVINDO.                     10510021
105200     MOVE ASC-TRN-RVRSL-DESC     TO AREVDESO.                     10520021
105300     MOVE ASC-TRN-VOID-IND       TO AVOIDINO.                     10530021
105400     IF AVOIDINO = 'N'                                            10540052
105500        MOVE ' ' TO AVOIDINO                                      10550052
105600     END-IF.                                                      10560052
105700     MOVE ASC-TRN-VOID-DESC      TO AVOIDDSO.                     10570021
105800     MOVE ASC-POS-DTE            TO APOSDTEO.                     10580021
105900     MOVE ASC-PSTD-DTE           TO APSTDTEO.                     10590021
106000     MOVE ASC-STR-NBR            TO ASTRNBRO.                     10600021
106100     MOVE ASC-STR-NAME           TO ASTRNAMO.                     10610021
106200     MOVE ASC-POS-TRMNL-NBR      TO ATERMNLO.                     10620021
106300     MOVE ASC-POS-TRN-NBR        TO ATRANSO.                      10630021
106400     IF ASC-POS-OPRT-ID = ZERO                                    10640021
106500         MOVE SPACES             TO AOPERIDO                      10650021
106600     ELSE                                                         10660021
106700         MOVE ASC-POS-OPRT-ID    TO AOPERIDO                      10670021
106800     END-IF.                                                      10680021
P12431     MOVE ASC-ORD-NBR            TO AORDNBRO.                     10680021
106900     MOVE ASC-APVL-USR-ID        TO AUSERIDO.                     10690021
107000     MOVE ASC-APP-AUTH-AMT       TO AAPPAMTO.                     10700021
107100     MOVE ASC-ORIG-AUTH-AMT      TO AORGAMTO.                     10710021
107200     MOVE ASC-COMMENT-LINE1      TO ACOMNT1O.                     10720021
107300     MOVE ASC-COMMENT-LINE2      TO ACOMNT2O.                     10730021
107400                                                                  10740021
124679*----------------------------------------------------------------*        
124679 4500-DL-ROUTINE.                                                         
124679                                                                          
124679     PERFORM 4550-SELECT-DRVR-LIC-TRANSL.                                 
124679                                                                          
124679     IF RDT004-ENCRPD-DRVRLIC-NBR-LEN > 0                                 
124679        MOVE RDT004-ENCRPD-DRVRLIC-NBR-TEXT                               
124679                                   TO ASC-DRV-LIC-NBR-EXP                 
124679     ELSE                                                                 
124679        MOVE SPACES                TO PV-DL-NBR-CHECK                     
124679                                      ASC-DRV-LIC-NBR-EXP                 
124679        MOVE ASC-DRV-LIC-NBR       TO PV-DL-NBR-CHECK                     
124679        PERFORM                                                           
124679          VARYING PV-INDX-DL FROM 21 BY -1                                
124679            UNTIL PV-INDX-DL < 2                                          
124679              OR PV-DL-CHAR (PV-INDX-DL) > SPACE                          
124679        END-PERFORM                                                       
124679        MOVE '*'                   TO PV-DL-CHAR(PV-INDX-DL)              
124679                                      PV-DL-CHAR(PV-INDX-DL - 1)          
124679                                      PV-DL-CHAR(PV-INDX-DL - 2)          
124679                                      PV-DL-CHAR(PV-INDX-DL - 3)          
124679     END-IF.                                                              
124679                                                                          
124679*----------------------------------------------------------------*        
124679* SELECT A ROW FROM THE DB2 TABLE RDT_DRVR_LIC_TRANSL            *        
124679*----------------------------------------------------------------*        
124679 4550-SELECT-DRVR-LIC-TRANSL.                                             
124679                                                                          
124679     PERFORM                                                              
124679         WITH TEST AFTER                                                  
124679         VARYING PV-RETRY-COUNTER                                         
124679         FROM 1 BY 1                                                      
124679         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
124679                   OR (SQLCODE = ZERO)                                    
124679                   OR (SQLCODE = +100))                                   
124679                                                                          
124679         EXEC SQL                                                         
124679           SELECT  ENCRPD_DRVRLIC_NBR                                     
124679             INTO :RDT00004-ENCRPD-DRVRLIC-NBR                            
124679             FROM RDT_DRVR_LIC_TRANSL                                     
124679            WHERE DRVR_LIC_NBR = :ASC-DRV-LIC-NBR                         
124679         END-EXEC                                                         
124679                                                                          
124679         EVALUATE TRUE                                                    
124679             WHEN SQLCODE = ZERO                                          
124679                 CONTINUE                                                 
124679                                                                          
124679             WHEN SQLCODE = +100                                          
124679                 MOVE ZEROES TO RDT004-ENCRPD-DRVRLIC-NBR-LEN             
124679                 MOVE SPACES TO RDT004-ENCRPD-DRVRLIC-NBR-TEXT            
124679                                                                          
124679             WHEN SQLCODE = -904                                          
124679             WHEN SQLCODE = -913                                          
124679                 CONTINUE                                                 
124679                                                                          
124679             WHEN SQLWARN0 NOT = SPACES                                   
124679             WHEN SQLCODE < ZERO                                          
124679             WHEN SQLCODE > ZERO                                          
124679                 MOVE '4550-SELECT-DRVR-LIC-TRANSL'                       
124679                                   TO DP013-PARAGRAPH                     
124679                 MOVE 'SELECT DL CONVERSION'                              
124679                                   TO DP013-MESSAGE-TEXT (1)              
124679                 MOVE ASC-DRV-LIC-NBR                                     
124679                                   TO DP013-MESSAGE-TEXT (2)              
124679                 MOVE SQLCA        TO DP013-SQLCA                         
124679                 MOVE 'RDT_DRVR_LIC_TRANSL'                               
124679                                   TO DP013-DB2-TABLE-NAME (1)            
124679                 SET DP013-DB2-ABEND                                      
124679                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
124679                 PERFORM DP013-0000-PROCESS-ABEND                         
124679         END-EVALUATE                                                     
124679     END-PERFORM.                                                         
124679                                                                          
124679     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
124679         MOVE '4550-SELECT-DRVR-LIC-TRANSL'                               
124679                                   TO DP013-PARAGRAPH                     
124679         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'             
124679                                   TO DP013-MESSAGE-TEXT (1)              
124679         MOVE 'DL NBR: '           TO DP013-MESSAGE-TEXT (2)              
124679         MOVE ASC-DRV-LIC-NBR      TO DP013-MESSAGE-TEXT (3)              
124679         MOVE SQLCA                TO DP013-SQLCA                         
124679         MOVE 'RDT_DRVR_LIC_TRANSL'                                       
124679                                   TO DP013-DB2-TABLE-NAME (1)            
124679         SET DP013-DB2-ABEND                                              
124679             DP013-XCTL-DISPLAY-RESTART                                   
124679                                   TO TRUE                                
124679         PERFORM DP013-0000-PROCESS-ABEND                                 
124679     END-IF.                                                              
107500*----------------------------------------------------------------*10750021
107600* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *10760021
107700* OBJECT WAS UDPATED.                                            *10770021
107800*----------------------------------------------------------------*10780021
107900                                                                  10790021
108000 5200-UPDATE-SELECTION-QUEUE.                                     10800021
108100                                                                  10810021
108200     PERFORM 9100-READ-SEL-QUEUE.                                 10820021
108300     SET RD022-INQ (ASC-SEL-SUB) TO TRUE.                         10830021
108400     PERFORM 9200-REWRITE-SEL-QUEUE.                              10840021
108500                                                                  10850021
108600*----------------------------------------------------------------*10860021
108700* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *10870021
108800*----------------------------------------------------------------*10880021
108900                                                                  10890021
109000 9100-READ-SEL-QUEUE.                                             10900021
109100     EXEC CICS                                                    10910021
109200         READQ TS                                                 10920021
109300             QUEUE (ASC-SEL-QUEUE-NAME)                           10930021
109400             INTO  (RD022-MESSAGE-SEL-REC)                        10940021
109500             ITEM  (ASC-SEL-ITEM)                                 10950021
109600             RESP  (PV-CICS-RESP)                                 10960021
109700     END-EXEC.                                                    10970021
109800                                                                  10980021
109900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       10990021
110000         CONTINUE                                                 11000021
110100     ELSE                                                         11010021
110200         SET DP013-LOGIC-ABEND                                    11020021
110300             DP013-NO-ROLLBACK     TO TRUE                        11030021
110400         MOVE '9100-READ-SEL-QUEUE'                               11040021
110500                                   TO DP013-PARAGRAPH             11050021
110600         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   11060021
110700                                   TO DP013-MESSAGE-TEXT (1)      11070021
110800         PERFORM DP013-0000-PROCESS-ABEND                         11080021
110900     END-IF.                                                      11090021
111000*----------------------------------------------------------------*11100021
111100* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *11110021
111200*----------------------------------------------------------------*11120021
111300 9200-REWRITE-SEL-QUEUE.                                          11130021
111400     EXEC CICS                                                    11140021
111500          WRITEQ TS                                               11150021
111600              QUEUE  (ASC-SEL-QUEUE-NAME)                         11160021
111700              FROM   (RD022-MESSAGE-SEL-REC)                      11170021
111800              ITEM   (ASC-SEL-ITEM)                               11180021
111900              RESP   (PV-CICS-RESP)                               11190021
112000              REWRITE                                             11200021
112100     END-EXEC.                                                    11210021
112200                                                                  11220021
112300     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   11230021
112400         SET DP013-CICS-ABEND                                     11240021
112500             DP013-NO-ROLLBACK     TO TRUE                        11250021
112600         MOVE '9200-REWRITE-SEL-QUEUE'                            11260021
112700                                   TO DP013-PARAGRAPH             11270021
112800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   11280021
112900                                   TO DP013-MESSAGE-TEXT (1)      11290021
113000         PERFORM DP013-0000-PROCESS-ABEND                         11300021
113100     END-IF.                                                      11310021
113200                                                                  11320021
113300******************************************************************11330055
113400**  CONVERSION OF CARD NUMBER                                    *11340055
113500******************************************************************11350055
113600     COPY SVPD007.                                                11360055
113700*----------------------------------------------------------------*11370021
113800*    ABEND PROCESSOR MODULE                                      *11380021
113900*----------------------------------------------------------------*11390021
114000                                                                  11400021
114100     COPY DPPD013.                                                11410021
