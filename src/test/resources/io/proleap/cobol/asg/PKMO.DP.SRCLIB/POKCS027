00001 *-----------------------*                                         00010004
00002  IDENTIFICATION DIVISION.                                         00020005
00003 *-----------------------*                                         00030005
00004  PROGRAM-ID.    POKCS027.                                         00040004
00005  AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00050004
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060003
00007  DATE-WRITTEN.  09/93.                                            00070004
00008  DATE-COMPILED.                                                   00080003
00009                                                                   00090003
00010 *---------------------------------------------------------------* 00100003
00011 *    W027 - PO INSTRUCTION INQUIRY PROGRAM                      * 00110003
00012 *                                                               * 00120003
00013 *    THIS PROGRAM DISPLAYS ALL  PO INSTRUCTIONS ASSOCIATED      * 00130003
00014 *    WITH THE PURCHASE ORDER.                                   * 00140003
00015 *                                                               * 00150003
00016 *---------------------------------------------------------------* 00160003
      *    CHANGE NAME 8/26/99    SUE BARTELT  TKMA537                * 00161017
      *    ADDED SEASONAL SET YEAR AND SHORT NAME TO SCREEN.          * 00162017
      *---------------------------------------------------------------* 00163017
C98147*    CHANGE:    12/02/14    LINDA FRIESS TKMA394    CHG0098147    00163119
C98147*    EXPANDED PO NUMBER TO 8 DIGITS IN MAP.  ADJUSTED FILLER.     00164019
C98147*---------------------------------------------------------------* 00167019
263126*    CHANGED 10/27/2021    BY JIM HUNTER      WR: CHG0263126      00168020
263126*    CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE  00169020
263126*    MAKING THE CALL DYNAMIC VS STATIC.                           00169120
263126*----------------------------------------------------------------*00169220
CICS  *  CHANGED 11/10/2022    BY BARB SCHULTZ    WR: CHG0278485        00169322
CICS  *                                                                 00169421
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00169521
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00169621
CICS  *----------------------------------------------------------------*00169721
00017  EJECT                                                            00170003
00018  ENVIRONMENT DIVISION.                                            00180003
00019                                                                   00190003
00020  DATA DIVISION.                                                   00200003
00021                                                                   00210003
00022  WORKING-STORAGE SECTION.                                         00220003
00023                                                                   00230003
00024  01  PC-PROGRAM-CONSTANTS.                                        00240003
00025      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00250003
00026                                                     'PO027A  '.   00260003
00027      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00270003
00028                                                     'POKM027 '.   00280003
00029      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00290003
00030                                                     'POKCS027'.   00300003
00031      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00310003
00032      05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00320003
00033      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +5      00330003
00034                                                     COMP SYNC.    00340003
00035      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00350003
00036                                                     COMP SYNC.    00360003
00037      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00370003
00038                                                     +1000000      00380003
00039                                                     COMP-3.       00390003
00040      05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00400003
00041                                                     COMP SYNC.    00410003
00042      05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00420003
00043                                                     COMP-3.       00430003
00044      05  PC-TSYMSG-NUMBERS.                                       00440003
00045          10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00450003
00046          10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00460003
00047          10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00470003
00048          10  PC-TSYMSG-00083            PIC  9(05)  VALUE 00083.  00480003
00049          10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00490003
00050          10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00500003
00051          10  PC-TSYMSG-00624            PIC  9(05)  VALUE 00624.  00510003
00052 *                                                                 00520003
00053  01  PS-PROGRAM-SWITCHES.                                         00530003
00054      05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00540003
00055          88  PS-NO-ERROR                            VALUE 'Y'.    00550003
00056          88  PS-ERROR                               VALUE 'N'.    00560003
00057      05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00570003
00058          88  PS-COMMAREA-VALID                      VALUE 'Y'.    00580003
00059          88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00590003
00060      05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00600003
00061          88  PS-DONE                                VALUE 'Y'.    00610003
00062          88  PS-NOT-DONE                            VALUE 'N'.    00620003
00063 *                                                                 00630003
00064  01  PV-PROGRAM-VARIABLES.                                        00640003
00065      05  PV-SUB                         PIC S9(04)  VALUE +0      00650003
00066                                                     COMP SYNC.    00660003
00067      05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00670003
00068                                                     COMP SYNC.    00680003
00069      05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00690003
00070                                                     COMP-3.       00700003
00071      05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00710003
00072                                                     COMP-3.       00720003
00073      05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00730003
00074                                                     COMP-3.       00740003
00075      05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00750003
00076                                                     COMP-3.       00760003
00077      05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00770003
00078                                                     COMP-3.       00780003
00079      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00790003
00080                                                     COMP-3.       00800003
00081      05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00810003
00082                                                     COMP SYNC.    00820003
00083      05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00830003
00084                                                     COMP SYNC.    00840003
00085      05  PV-ITEM                        PIC S9(04)  VALUE +0      00850003
00086                                                     COMP SYNC.    00860003
00087      05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00870003
00088                                                     COMP SYNC.    00880003
00089      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      00890003
00090                                                     COMP SYNC.    00900003
00091      05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      00910003
00092                                                     COMP SYNC.    00920003
00093      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      00930003
00094                                                     COMP SYNC.    00940003
00095      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      00950003
00096                                                     COMP SYNC.    00960003
00097      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      00970003
00098                                                     COMP SYNC.    00980003
00099      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      00990003
00100                                                     COMP SYNC.    01000003
00101      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01010003
00102                                                     COMP SYNC.    01020003
00103      05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01030003
00104                                                     COMP SYNC.    01040003
00105      05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01050003
00106                                                     COMP SYNC.    01060003
00107      05  PV-INSTR-DESC-BK.                                        01070003
00108          10  PV-IDB-1                   PIC  X(50).               01080003
00109          10  PV-IDB-2                   PIC  X(50).               01090003
00110          10  PV-IDB-3                   PIC  X(50).               01100003
                                                                        01110003
           05  PV-SEASET-DATA.                                          01120003
               10  FILLER                     PIC  X(05)                01130006
                   VALUE 'SET: '.                                       01140003
               10  PV-SEASET-SHRT-NM          PIC  X(05)  VALUE SPACES. 01150003
               10  FILLER                     PIC  X(01)  VALUE SPACES. 01160003
               10  PV-SEASET-YR               PIC  X(04)  VALUE SPACES. 01170003
00111 *                                                                 01180003
00112 ******************************************************************01190003
00113 **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01200003
00114 **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01210003
00115 **  APPLICATION-SPECIFIC COMMAREA.                              **01220003
00116 ******************************************************************01230003
00117  01  LQW-LIST-QUEUE-WORK-AREA.                                    01240003
00118      05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01250003
00119      05  LQW-ITEM-ENTRIES               OCCURS 5  TIMES           01260003
00120                                         INDEXED BY LQW-IDX.       01270003
00121          10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01280003
00122          10  LQW-RCP-NME                PIC  X(15).               01290003
00123          10  LQW-INST-LN1               PIC  X(50).               01300003
00124          10  LQW-INST-LN2               PIC  X(50).               01310003
00125          10  LQW-INST-LN3               PIC  X(50).               01320003
00126                                                                   01330003
00127      EJECT                                                        01340003
00128 *---------------------------------------------------------------* 01350003
00129 *    MAP LAYOUT                                                 * 01360003
00130 *---------------------------------------------------------------* 01370003
00131                                                                   01380003
00132      COPY POKM027.                                                01390003
00133 *                                                                 01400003
00134  01  MR-OCCURS-LAYOUT                   REDEFINES  PO027AO.       01410003
C98147     05  FILLER                         PIC X(124).               01420019
00136      05  MR-SCROLL-AREA                 OCCURS 5  TIMES.          01430003
00137          10  MR-RECP-NMEL               PIC S9(04) COMP.          01440003
00138          10  MR-RECP-NMEA               PIC  X(01).               01450003
00139          10  MR-RECP-NMEC               PIC  X(01).               01460003
00140          10  MR-RECP-NMEH               PIC  X(01).               01470003
00141          10  MR-RECP-NME                PIC  X(15).               01480003
00142                                                                   01490003
00143          10  MR-INST-LN1L               PIC S9(04) COMP.          01500003
00144          10  MR-INST-LN1A               PIC  X(01).               01510003
00145          10  MR-INST-LN1C               PIC  X(01).               01520003
00146          10  MR-INST-LN1H               PIC  X(01).               01530003
00147          10  MR-INST-LN1                PIC  X(50).               01540003
00148                                                                   01550003
00149          10  MR-INST-LN2L               PIC S9(04) COMP.          01560003
00150          10  MR-INST-LN2A               PIC  X(01).               01570003
00151          10  MR-INST-LN2C               PIC  X(01).               01580003
00152          10  MR-INST-LN2H               PIC  X(01).               01590003
00153          10  MR-INST-LN2                PIC  X(50).               01600003
00154                                                                   01610003
00155          10  MR-INST-LN3L               PIC S9(04) COMP.          01620003
00156          10  MR-INST-LN3A               PIC  X(01).               01630003
00157          10  MR-INST-LN3C               PIC  X(01).               01640003
00158          10  MR-INST-LN3H               PIC  X(01).               01650003
00159          10  MR-INST-LN3                PIC  X(50).               01660003
00160                                                                   01670003
00161      EJECT                                                        01680003
00162 *---------------------------------------------------------------* 01690003
00163 *    ATTRIBUTE SETTINGS COPYBOOK.                               * 01700003
00164 *---------------------------------------------------------------* 01710003
00165                                                                   01720003
00166      COPY DPWS015.                                                01730003
00167                                                                   01740003
00168 *---------------------------------------------------------------* 01750003
00169 *    FUNCTION KEYS COPYBOOK.                                    * 01760003
00170 *---------------------------------------------------------------* 01770003
00171                                                                   01780003
00172      COPY DPWS016.                                                01790003
00173                                                                   01800003
00174 *---------------------------------------------------------------* 01810003
00175 *    NUMERIC EDIT LAYOUT.                                       * 01820003
00176 *---------------------------------------------------------------* 01830003
00177                                                                   01840003
00178      COPY DPWS010I.                                               01850003
00179  EJECT                                                            01860003
00180 *---------------------------------------------------------------* 01870003
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01880021
00182 *---------------------------------------------------------------* 01890003
00183                                                                   01900003
00184      COPY DPWS030.                                                01910003
CICS       COPY DPWS930.                                                01911021
00185  EJECT                                                            01920003
00186 *---------------------------------------------------------------* 01930003
00187 *    STANDARD COMMAREA.                                         * 01940003
00188 *---------------------------------------------------------------* 01950003
00189                                                                   01960003
00190      COPY DPWS020.                                                01970003
00191      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01980003
00192                                                                   01990003
00193 *---------------------------------------------------------------* 02000003
00194 * INTER-APPLICATION COMMAREA.                                   * 02010003
00195 *   POWS017 - INPUT FROM PO HEADER INQUIRY PROGRAM              * 02020003
00196 *---------------------------------------------------------------* 02030003
00197                                                                   02040003
00198          10  INTER-APPL-COMM-AREA       PIC X(200).               02050003
00199      COPY POWS017.                                                02060003
00200 *---------------------------------------------------------------* 02070003
00201 *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02080003
00202 *---------------------------------------------------------------* 02090003
00203          10  ASC-SPECIFIC-COMMAREA.                               02100003
00204              15  ASC-LIST-KEYS.                                   02110003
00205                  20  ASC-KEY-PO-NBR     PIC S9(09) COMP.          02120003
00206              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02130003
00207                  20  ASC-BLOCK-MODIFIED-SW                        02140003
00208                                         PIC  X(01).               02150003
00209                      88  ASC-BLOCK-NOT-MODIFIED                   02160003
00210                                         VALUE 'N'.                02170003
00211                      88  ASC-BLOCK-MODIFIED                       02180003
00212                                         VALUE 'Y'.                02190003
00213                                                                   02200003
00214                  20  ASC-ITEM-ARRAY.                              02210003
00215                      25  ASC-ITEM-ENTRIES OCCURS 5 TIMES.         02220003
00216                          30  ASC-LIST-ITEM-NUMBER                 02230003
00217                                         PIC S9(09) COMP-3.        02240003
00218                          30  ASC-RCP-NME             PIC  X(15).  02250003
00219                          30  ASC-INST-LN1            PIC  X(50).  02260003
00220                          30  ASC-INST-LN2            PIC  X(50).  02270003
00221                          30  ASC-INST-LN3            PIC  X(50).  02280003
00222                                                                   02290003
00223              15  ASC-BLK-SUB                         PIC S9(04)   02300003
00224                                                           COMP    02310003
00225                                                           SYNC.   02320003
00226              15  ASC-ITEM-SUB                        PIC S9(04)   02330003
00227                                                           COMP    02340003
00228                                                           SYNC.   02350003
00229              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02360003
00230                                                           COMP-3. 02370003
00231              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02380003
00232                                                           COMP-3. 02390003
00233              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02400003
00234                                                           COMP-3. 02410003
00235              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02420003
00236                                                           COMP-3. 02430003
00237              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02440003
00238                                                           COMP    02450003
00239                                                           SYNC.   02460003
00240              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02470003
00241                  88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   02480003
00242                  88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   02490003
00243              15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  02500003
00244                  88  ASC-UPDATE-TSQ                  VALUE 'Y'.   02510003
00245                  88  ASC-NO-TSQ-UPDATE               VALUE ' '.   02520003
00246              15  ASC-LIST-QUEUE-NAME.                             02530003
00247                  20  ASC-LIST-TERM-ID                PIC  X(04).  02540003
00248                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02550003
00249                                                           COMP-3. 02560003
00250                  20  ASC-LIST-SEQ                    PIC  9(01).  02570003
00251              15  ASC-START-ITEM-REQUEST.                          02580003
00252                  20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  02590003
00253              15  ASC-DPT-NBR                         PIC  X(03).  02600003
00254              15  ASC-ENT-NAME-DESC                   PIC  X(30).  02610003
                   15  ASC-SEASET-DATA                     PIC  X(15).  02620003
00255      EJECT                                                        02630003
00256 *---------------------------------------------------------------* 02640003
00257 *    ABEND PROCESSING COPYBOOK.                                 * 02650003
00258 *---------------------------------------------------------------* 02660003
00259                                                                   02670003
00260      COPY DPWS013.                                                02680003
00261                                                                   02690003
00262  EJECT                                                            02700003
00263 *---------------------------------------------------------------* 02710003
00264 *    DB2 AREA FOR PURCHASE ORDER                                * 02720003
00265 *---------------------------------------------------------------* 02730003
00266      EXEC SQL                                                     02740003
00267           INCLUDE TPURCHS                                         02750003
00268      END-EXEC.                                                    02760003
00269 *---------------------------------------------------------------* 02770003
00270 *    DB2 AREA FOR PURCHASE INSTRUCTIONS                         * 02780003
00271 *---------------------------------------------------------------* 02790003
00272      EXEC SQL                                                     02800003
00273           INCLUDE TPOINST                                         02810003
00274      END-EXEC.                                                    02820003
00275 *---------------------------------------------------------------* 02830003
00276 *    DB2 AREA FOR PO INSTRUCTION CODES                          * 02840003
00277 *---------------------------------------------------------------* 02850003
00278      EXEC SQL                                                     02860003
00279           INCLUDE TINSTCD                                         02870003
00280      END-EXEC.                                                    02880003
00281 *---------------------------------------------------------------* 02890003
00282 *    DB2 AREA FOR PO INSTRUCTION RECIPIENT CODES                * 02900003
00283 *---------------------------------------------------------------* 02910003
00284      EXEC SQL                                                     02920003
00285           INCLUDE TINRCCD                                         02930003
00286      END-EXEC.                                                    02940003
00287 *---------------------------------------------------------------* 02950003
00288 *    DB2 AREA FOR ENTERPRISE NAME                               * 02960003
00289 *---------------------------------------------------------------* 02970003
00290      EXEC SQL                                                     02980003
00291           INCLUDE TENTNME                                         02990003
00292      END-EXEC.                                                    03000003
00293 *---------------------------------------------------------------* 03010003
00294 *    DB2 AREA FOR COMMUNICATIONS                                * 03020003
00295 *---------------------------------------------------------------* 03030003
00296      EXEC SQL                                                     03040003
00297           INCLUDE SQLCA                                           03050003
00298      END-EXEC.                                                    03060003
00299 *---------------------------------------------------------------* 03070003
00300 *    INSTRUCTION CURSOR FOR PO ENTERED                          * 03080003
00301 *---------------------------------------------------------------* 03090003
00302                                                                   03100003
00303      EXEC SQL                                                     03110003
00304           DECLARE INST-CSR   CURSOR FOR                           03120003
00305           SELECT A.RECIP_CDE,                                     03130003
00306                  A.INSTR_NBR,                                     03140003
00307                  B.RECIP_DESC,                                    03150003
00308                  C.INSTR_DESC                                     03160003
00309           FROM   TPOINST A,                                       03170003
00310                  TINRCCD B,                                       03180003
00311                  TINSTCD C                                        03190003
00312           WHERE A.PO_NBR = :ASC-KEY-PO-NBR                        03200003
00313             AND B.RECIP_CDE = A.RECIP_CDE                         03210003
00314             AND C.INSTR_NBR = A.INSTR_NBR                         03220003
00315           ORDER BY A.RECIP_CDE,                                   03230003
00316                    A.INSTR_NBR                                    03240003
00317      END-EXEC.                                                    03250003
00318                                                                   03260003
00319  EJECT                                                            03270003
00320  LINKAGE SECTION.                                                 03280003
00321                                                                   03290003
00322  01  DFHCOMMAREA.                                                 03300003
00323      05  FILLER                         OCCURS  1 TO 4072 TIMES   03310003
00324                                         DEPENDING ON EIBCALEN.    03320003
00325          10  FILLER                     PIC X.                    03330003
00326                                                                   03340003
00327  EJECT                                                            03350003
00328  PROCEDURE DIVISION.                                              03360003
00329  0000-MAIN-MODULE.                                                03370003
00330      INITIALIZE DP030-CICS-API-FIELDS.                            03380003
00331      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03390003
00332      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03400003
00333      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03410003
00334      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03420003
00335      MOVE LENGTH OF PO027AI        TO DP030-MAP-LENGTH (1).       03430003
00336      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03440003
00337      PERFORM 0001-CALL-CICS-ARCH-API.                             03450003
00338 *                                                                 03460003
00339      PERFORM 1000-CONTROL-PROCESSING                              03470003
00340 *                                                                 03480003
00341      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03490003
00342      PERFORM 0001-CALL-CICS-ARCH-API.                             03500003
00343                                                                   03510003
00344 ******************************************************************03520003
00345 **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **03530003
00346 **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **03540003
00347 ******************************************************************03550003
00348  0001-CALL-CICS-ARCH-API.                                         03560003
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03570021
00350                                     DFHCOMMAREA                   03580021
00351                                     DP030-CICS-API-FIELDS         03590021
00352                                     DP020-STANDARD-COMMAREA       03600021
00353                                     PO027AI.                      03610021
00354 *                                                                 03620003
00355      IF  DP030-RC-CALL-SUCCESSFUL                                 03630003
00356          CONTINUE                                                 03640003
00357      ELSE                                                         03650003
00358          SET DP013-NO-ROLLBACK                                    03660003
00359              DP013-XCTL-DISPLAY-RESTART                           03670003
00360              DP013-CICS-ABEND      TO TRUE                        03680003
00361          MOVE '0001-CALL-CICS-ARCH-API'                           03690003
00362                                    TO DP013-PARAGRAPH             03700003
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03710021
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03720021
00365          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03730003
00366          PERFORM DP013-0000-PROCESS-ABEND.                        03740003
00367 *----------------------------------------------------------------*03750003
00368 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03760003
00369 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03770003
00370 *----------------------------------------------------------------*03780003
00371                                                                   03790003
00372  1000-CONTROL-PROCESSING.                                         03800003
00373                                                                   03810003
00374      EVALUATE TRUE                                                03820003
00375          WHEN DP020-NEXT-ACT-INITIAL                              03830003
00376              INITIALIZE ASC-SPECIFIC-COMMAREA                     03840003
00377              MOVE EIBTRMID         TO ASC-LIST-TERM-ID            03850003
00378              MOVE DP020-SRC-TASK-NUMBER                           03860003
00379                                    TO ASC-LIST-TASK-NUMBER        03870003
00380              MOVE PC-LIST-QUEUE-SEQ                               03880003
00381                                    TO ASC-LIST-SEQ                03890003
00382              PERFORM 1100-PROCESS-INTER-APPL-COMM                 03900003
00383              PERFORM 4000-BUILD-INITIAL-PANEL                     03910003
00384                                                                   03920003
00385          WHEN DP020-NEXT-ACT-READ-MAP                             03930003
00386              MOVE ASC-ITEM-AT-TOP-OF-PANEL                        03940003
00387                                    TO PV-TOP-ITEM                 03950003
00388              PERFORM 2000-PROCESS-PANEL                           03960003
00389                                                                   03970003
00390          WHEN DP020-NEXT-ACT-RETURN                               03980003
00391              PERFORM 2050-DELETE-LIST-QUEUE                       03990003
00392              PERFORM 4000-BUILD-INITIAL-PANEL                     04000003
00393                                                                   04010003
00394          WHEN OTHER                                               04020003
00395              SET DP013-LOGIC-ABEND TO TRUE                        04030003
00396              SET DP013-NO-ROLLBACK TO TRUE                        04040003
00397              MOVE '1000-CONTROL-PROCESSING'                       04050003
00398                                    TO DP013-PARAGRAPH             04060003
00399              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04070003
00400                                    TO DP013-MESSAGE-TEXT(1)       04080003
00401              PERFORM DP013-0000-PROCESS-ABEND                     04090003
00402      END-EVALUATE.                                                04100003
00403                                                                   04110003
00404  EJECT                                                            04120003
00405 *----------------------------------------------------------------*04130003
00406 * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04140003
00407 * IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04150003
00408 *----------------------------------------------------------------*04160003
00409                                                                   04170003
00410  1100-PROCESS-INTER-APPL-COMM.                                    04180003
00411                                                                   04190003
00412      SET PS-COMMAREA-VALID         TO TRUE.                       04200003
00413      MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04210003
00414      IF  DP020-NAV-KEY-DATA > SPACE                               04220003
00415          MOVE DP020-NAV-KEY-DATA   TO ASC-KEY-PO-NBR              04230003
00416      ELSE                                                         04240003
00417          MOVE PO017-PO-NBR         TO ASC-KEY-PO-NBR              04250015
               MOVE PO017-SEASET-DATA    TO ASC-SEASET-DATA.            04251015
00418                                                                   04260003
00419  EJECT                                                            04270003
00420 *----------------------------------------------------------------*04280003
00421 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04290003
00422 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04300003
00423 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04310003
00424 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04320003
00425 * FUNCTION KEYS CAN GET THIS FAR.                                *04330003
00426 *----------------------------------------------------------------*04340003
00427                                                                   04350003
00428  2000-PROCESS-PANEL.                                              04360003
00429      EVALUATE TRUE                                                04370003
00430          WHEN DP020-SRC-AID = DP016-CLEAR                         04380003
00431              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04390003
00432              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04400003
00433                                                                   04410003
00434          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04420003
                   PERFORM 4051-GET-SEASET-DATA                         04421016
00435              PERFORM 2050-DELETE-LIST-QUEUE                       04430003
00436              PERFORM 4000-BUILD-INITIAL-PANEL                     04440003
00437                                                                   04450003
 0438          WHEN OTHER                                               04460016
                   PERFORM 4051-GET-SEASET-DATA                         04461016
00439              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04470003
00440              PERFORM 2100-CHECK-FUNCTION-KEY                      04480003
00441      END-EVALUATE.                                                04490003
00442  EJECT                                                            04500003
00443 *----------------------------------------------------------------*04510003
00444 *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *04520003
00445 *----------------------------------------------------------------*04530003
00446  2050-DELETE-LIST-QUEUE.                                          04540003
00447                                                                   04550003
00448      EXEC CICS                                                    04560003
00449          DELETEQ TS                                               04570003
00450              QUEUE (ASC-LIST-QUEUE-NAME)                          04580003
00451              RESP  (PV-CICS-RESP)                                 04590003
00452      END-EXEC.                                                    04600003
00453                                                                   04610003
00454      IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       04620003
00455         (PV-CICS-RESP = DFHRESP(QIDERR))                          04630003
00456          CONTINUE                                                 04640003
00457      ELSE                                                         04650003
00458          SET DP013-CICS-ABEND      TO TRUE                        04660003
00459          SET DP013-NO-ROLLBACK     TO TRUE                        04670003
00460                                                                   04680003
00461          MOVE '2050-DELETE-LIST-QUEUE'                            04690003
00462                                    TO DP013-PARAGRAPH             04700003
00463          MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    04710003
00464                                    TO DP013-MESSAGE-TEXT (1)      04720003
00465          PERFORM DP013-0000-PROCESS-ABEND                         04730003
00466      END-IF.                                                      04740003
00467                                                                   04750003
00468      MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  04760003
00469  EJECT                                                            04770003
00470 *----------------------------------------------------------------*04780003
00471 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*04790003
00472 * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *04800003
00473 * CICS ARCHITECTURE API.                                         *04810003
00474 *----------------------------------------------------------------*04820003
00475  2100-CHECK-FUNCTION-KEY.                                         04830003
00476      EVALUATE TRUE                                                04840003
00477          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  04850003
00478              MOVE +1               TO PV-TOP-ITEM                 04860003
00479              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04870003
00480              PERFORM 3200-RESET-ATTRIBUTES                        04880003
00481                                                                   04890003
00482          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   04900003
00483              PERFORM 2110-BROWSE-BACKWARD                         04910003
00484              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04920003
00485              PERFORM 3200-RESET-ATTRIBUTES                        04930003
00486                                                                   04940003
00487          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   04950003
00488              PERFORM 2120-BROWSE-FORWARD                          04960003
00489              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04970003
00490              PERFORM 3200-RESET-ATTRIBUTES                        04980003
00491                                                                   04990003
00492          WHEN DP020-SRC-AID = DP016-ENTER                         05000003
00493              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05010003
00494              IF  PS-ERROR                                         05020003
00495                  CONTINUE                                         05030003
00496              ELSE                                                 05040003
00497                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05050003
00498                  PERFORM 3200-RESET-ATTRIBUTES                    05060003
00499              END-IF                                               05070003
00500                                                                   05080003
00501          WHEN OTHER                                               05090003
00502              SET DP013-NO-ROLLBACK                                05100003
00503                  DP013-XCTL-DISPLAY-RESTART                       05110003
00504                  DP013-CICS-ABEND  TO TRUE                        05120003
00505              MOVE '2100-CHECK-FUNCTION-KEY'                       05130003
00506                                    TO DP013-PARAGRAPH             05140003
00507              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05150003
00508                                    TO DP013-MESSAGE-TEXT (1)      05160003
00509              PERFORM DP013-0000-PROCESS-ABEND                     05170003
00510      END-EVALUATE.                                                05180003
00511 *                                                                 05190003
00512 *----------------------------------------------------------------*05200003
00513 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *05210003
00514 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *05220003
00515 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *05230003
00516 *    MESSAGE.                                                    *05240003
00517 *----------------------------------------------------------------*05250003
00518                                                                   05260003
00519  2110-BROWSE-BACKWARD.                                            05270003
00520      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    05280003
00521          GIVING PV-TOP-ITEM.                                      05290003
00522 *                                                                 05300003
00523      IF  ((PV-TOP-ITEM < +1)                                      05310003
00524        OR (PV-TOP-ITEM = +1))                                     05320003
00525          MOVE +1                   TO PV-TOP-ITEM                 05330003
00526 *        -- TOP OF LIST --                                        05340003
00527          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05350003
00528          SET DP020-MSG-INFORMATIONAL                              05360003
00529                                    TO TRUE                        05370003
00530      END-IF.                                                      05380003
00531                                                                   05390003
00532  EJECT                                                            05400003
00533 *----------------------------------------------------------------*05410003
00534 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *05420003
00535 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *05430003
00536 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *05440003
00537 *----------------------------------------------------------------*05450003
00538                                                                   05460003
00539  2120-BROWSE-FORWARD.                                             05470003
00540                                                                   05480003
00541      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              05490003
00542          GIVING PV-TOP-ITEM.                                      05500003
00543      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   05510003
00544          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            05520003
00545                                    TO PV-TOP-ITEM                 05530003
00546 *        -- BOTTOM OF LIST --                                     05540003
00547          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05550003
00548          SET DP020-MSG-INFORMATIONAL                              05560003
00549                                    TO TRUE                        05570003
00550      ELSE                                                         05580003
00551          COMPUTE PV-BOTTOM-ITEM =                                 05590003
00552              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 05600003
00553          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            05610003
00554 *            -- BOTTOM OF LIST --                                 05620003
00555              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05630003
00556              SET DP020-MSG-INFORMATIONAL                          05640003
00557                                    TO TRUE                        05650003
00558          END-IF                                                   05660003
00559      END-IF.                                                      05670003
00560  EJECT                                                            05680003
00561 *----------------------------------------------------------------*05690003
00562 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *05700003
00563 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *05710003
00564 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *05720003
00565 *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *05730003
00566 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *05740003
00567 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *05750003
00568 *----------------------------------------------------------------*05760003
00569                                                                   05770003
00570  2130-CHECK-FOR-JUMP-BROWSE.                                      05780003
00571      SET PS-NO-ERROR               TO TRUE.                       05790003
00572      IF (ASC-START-ITEM-REQUEST = SPACE)                          05800003
00573          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            05810003
00574                                    TO PV-TOP-ITEM                 05820003
00575      ELSE                                                         05830003
00576          MOVE ASC-START-ITEM-REQUEST                              05840003
00577                                    TO DP010I-UNEDITED-FIELD       05850003
00578          MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       05860003
00579          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     05870003
00580          SET DP010I-NEGATIVE-NOT-ALLOWED                          05880003
00581                                    TO TRUE                        05890003
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                         05901020
263126              USING DP010I-NUMERIC-EDIT-AREA                      05902020
00583                                                                   05910003
00584          IF  NOT DP010I-ERROR-DETECTED                            05920003
00585              MOVE DP010I-NUMERIC-FIELD                            05930003
00586                                    TO  ASC-START-ITEM-REQUEST-N   05940003
00587              IF  ASC-START-ITEM-REQUEST-N > ZERO                  05950003
00588                  IF  ASC-START-ITEM-REQUEST-N >                   05960003
00589                                           ASC-NUMBER-OF-ITEMS-READ05970003
00590                      MOVE SPACE TO ASC-START-ITEM-REQUEST         05980003
00591                      COMPUTE PV-TOP-ITEM =                        05990003
00592                              ASC-NUMBER-OF-ITEMS-READ             06000003
00593                              - PC-ITEMS-PER-PANEL + 1             06010003
00594                      IF  PV-TOP-ITEM < +1                         06020003
00595                          MOVE +1   TO PV-TOP-ITEM                 06030003
00596                          MOVE PC-TSYMSG-00070                     06040003
00597                                    TO DP020-MSG-NUMBER            06050003
00598                          SET DP020-MSG-INFORMATIONAL              06060003
00599                                    TO TRUE                        06070003
00600                      END-IF                                       06080003
00601                  ELSE                                             06090003
00602                      MOVE ASC-START-ITEM-REQUEST-N                06100003
00603                                    TO PV-TOP-ITEM                 06110003
00604                      MOVE SPACE    TO ASC-START-ITEM-REQUEST      06120003
00605                      COMPUTE PV-BOTTOM-ITEM =                     06130003
00606                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06140003
00607                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06150003
00608 *                        -- BOTTOM OF LIST --                     06160003
00609                          MOVE PC-TSYMSG-00070                     06170003
00610                                    TO DP020-MSG-NUMBER            06180003
00611                          SET DP020-MSG-INFORMATIONAL              06190003
00612                                    TO TRUE                        06200003
00613                      END-IF                                       06210003
00614                  END-IF                                           06220003
00615              ELSE                                                 06230003
00616 *                --- VALUE OUT OF RANGE ----                      06240003
00617                  MOVE PC-TSYMSG-00101                             06250003
00618                                    TO DP020-MSG-NUMBER            06260003
00619                  MOVE -1           TO ASTRTITL                    06270003
00620                  SET DP030-SET-CURSOR-APPL-1                      06280003
00621                                    TO TRUE                        06290003
00622                  MOVE DP015-REVERSE                               06300003
00623                                    TO ASTRTITH                    06310003
00624                  MOVE DP015-RED    TO ASTRTITC                    06320003
00625                  MOVE DP015-UNP-NUM-BRT-MDT                       06330003
00626                                    TO ASTRTITA                    06340003
00627                  SET DP020-MSG-FATAL                              06350003
00628                                    TO TRUE                        06360003
00629                  SET PS-ERROR      TO TRUE                        06370003
00630              END-IF                                               06380003
00631                                                                   06390003
00632          ELSE                                                     06400003
00633              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            06410003
00634              MOVE -1               TO ASTRTITL                    06420003
00635              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06430003
00636              MOVE DP015-REVERSE    TO ASTRTITH                    06440003
00637              MOVE DP015-RED        TO ASTRTITC                    06450003
00638              MOVE DP015-UNP-NUM-BRT-MDT                           06460003
00639                                    TO ASTRTITA                    06470003
00640              SET DP020-MSG-FATAL   TO TRUE                        06480003
00641              SET PS-ERROR          TO TRUE                        06490003
00642          END-IF                                                   06500003
00643      END-IF.                                                      06510003
00644  EJECT                                                            06520003
00645 ******************************************************************06530003
00646 ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **06540003
00647 ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **06550003
00648 ******************************************************************06560003
00649  2200-MOVE-SCREEN-TO-COMMAREA.                                    06570003
00650                                                                   06580003
00651      MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             06590003
00652      MOVE +1                       TO PV-SUB.                     06600003
00653      IF  ASTRTITL > ZERO                                          06610003
00654          MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      06620003
00655      ELSE                                                         06630003
00656          IF  ASTRTITF = DP015-ERASE-EOF                           06640003
00657              INITIALIZE ASC-START-ITEM-REQUEST                    06650003
00658          END-IF                                                   06660003
00659      END-IF.                                                      06670003
00660  EJECT                                                            06680003
00661 ******************************************************************06690003
00662 ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **06700003
00663 ******************************************************************06710003
00664                                                                   06720003
00665  3200-RESET-ATTRIBUTES.                                           06730003
00666                                                                   06740003
00667      MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   06750003
00668      MOVE DP015-GREEN              TO ASTRTITC.                   06760003
00669      MOVE DP015-UNDERLINE          TO ASTRTITH.                   06770003
00670  EJECT                                                            06780003
00671                                                                   06790003
00672 *----------------------------------------------------------------*06800003
00673 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *06810003
00674 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *06820003
00675 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *06830003
00676 *    DISPLAY THE PANEL TO USER.                                  *06840003
00677 *----------------------------------------------------------------*06850003
00678                                                                   06860003
00679  4000-BUILD-INITIAL-PANEL.                                        06870003
00680                                                                   06880003
00681      INITIALIZE                 ASC-BLOCK-ENTRIES (1)             06890003
00682                                 ASC-BLOCK-ENTRIES (2).            06900003
00683      MOVE +1                       TO ASC-BLK-SUB.                06910003
00684      SET ASC-ITEMS-LEFT-ON-DB                                     06920003
00685                                    TO TRUE.                       06930003
00686                                                                   06940003
00687      MOVE +0                       TO ASC-ITEM-SUB                06950003
00688                                       ASC-NUMBER-OF-ITEMS-READ    06960003
00689                                       ASC-HIGHEST-BLOCK-WRITTEN   06970003
00690                                       ASC-ITEM-AT-TOP-OF-PANEL.   06980003
00691                                                                   06990003
00692      PERFORM 4050-GET-OTHER-SCREEN-FIELDS.                        07000003
00693      IF SQLCODE = +100                                            07010003
00694          SET DP020-NEXT-ACT-APPL-ERROR                            07020003
00695                                    TO TRUE                        07030003
00696          SET DP020-MSG-FATAL       TO  TRUE                       07040003
00697          MOVE PC-TSYMSG-00083      TO  DP020-MSG-NUMBER           07050003
00698      ELSE                                                         07060003
00699          PERFORM 4100-OPEN-CURSOR                                 07070003
00700          PERFORM 4200-READ-ITEMS-FROM-DB                          07080003
00701          PERFORM 4300-CLOSE-CURSOR                                07090003
00702          MOVE +1                   TO  PV-TOP-ITEM                07100003
00703          IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      07110003
00704              SET DP020-NEXT-ACT-APPL-ERROR                        07120003
00705                                    TO TRUE                        07130003
00706              SET DP020-MSG-FATAL   TO TRUE                        07140003
00707              MOVE PC-TSYMSG-00624  TO  DP020-MSG-NUMBER           07150003
00708          ELSE                                                     07160003
00709              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07170003
00710          END-IF                                                   07180003
00711      END-IF.                                                      07190003
00712                                                                   07200003
00713  EJECT                                                            07210003
00714 *----------------------------------------------------------------*07220003
00715 * GET OTHER SCREEN FIELDS FROM TPURCHS                           *07230003
00716 *----------------------------------------------------------------*07240003
00717                                                                   07250003
00718  4050-GET-OTHER-SCREEN-FIELDS.                                    07260003
00719      PERFORM                                                      07270003
00720          WITH TEST AFTER                                          07280003
00721          VARYING PV-RETRY-COUNTER                                 07290003
00722          FROM 1 BY 1                                              07300003
00723          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07310003
00724              OR (SQLCODE = ZERO)                                  07320003
00725              OR (SQLCODE = +100))                                 07330003
00726              EXEC SQL                                             07340003
00727                  SELECT A.DEPT_NBR,                               07350003
                              A.SEASET_YR,                              07360003
                              A.SEASET_SHRT_NM,                         07370003
00728                         B.ENT_NAME_DESC                           07380003
00729                  INTO :ASC-DPT-NBR,                               07390003
                            :PV-SEASET-YR,                              07400003
                            :PV-SEASET-SHRT-NM,                         07410003
00730                       :ASC-ENT-NAME-DESC                          07420003
00731                  FROM TPURCHS A,                                  07430003
00732                       TENTNME B                                   07440003
00733                  WHERE A.PO_NBR = :ASC-KEY-PO-NBR                 07450003
00734                    AND A.VER_STATUS_CDE = 'A'                     07460003
00735                    AND B.ENT_ID = A.ENT_ID                        07470003
00736                    AND B.TYPE_CDE = '01'                          07480003
00737              END-EXEC                                             07490003
00738          EVALUATE TRUE                                            07500003
00739              WHEN SQLCODE = ZERO                                  07510003
00740              WHEN SQLCODE = +100                                  07520003
00741              WHEN SQLCODE = -904                                  07530003
00742              WHEN SQLCODE = -913                                  07540003
00743                  CONTINUE                                         07550003
00744              WHEN SQLWARN0 NOT = SPACES                           07560003
00745              WHEN SQLCODE < ZERO                                  07570003
00746              WHEN SQLCODE > ZERO                                  07580003
00747                  MOVE '4050-GET-OTHER-SCREEN-FIELDS'              07590003
00748                                    TO DP013-PARAGRAPH             07600003
00749                  MOVE 'SQL ERROR SELECTING PO'                    07610003
00750                                    TO DP013-MESSAGE-TEXT (1)      07620003
00751                  MOVE SQLCA        TO DP013-SQLCA                 07630003
00752                  MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    07640003
00753                  SET DP013-DB2-ABEND                              07650003
00754                      DP013-XCTL-DISPLAY-RESTART TO TRUE           07660003
00755                  PERFORM DP013-0000-PROCESS-ABEND                 07670003
00756          END-EVALUATE                                             07680003
               IF PV-SEASET-YR > SPACES                                 07690011
                   MOVE PV-SEASET-DATA   TO PO017-SEASET-DATA           07700013
               ELSE                                                     07710011
                   MOVE SPACES TO PO017-SEASET-DATA                     07720013
               END-IF                                                   07730011
00757      END-PERFORM.                                                 07740003
                                                                        07741013
           PERFORM 4051-GET-SEASET-DATA.                                07742014
00758 *                                                                 07750003
00759      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07760003
00760          MOVE '4050-GET-OTHER-SCREEN-FIELDS'                      07770003
00761                                    TO DP013-PARAGRAPH             07780003
00762          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  07790003
00763                                    TO DP013-MESSAGE-TEXT (1)      07800003
00764          MOVE SQLCA                TO DP013-SQLCA                 07810003
00765          MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    07820003
00766          SET DP013-DB2-ABEND                                      07830003
00767              DP013-XCTL-DISPLAY-RESTART                           07840003
00768                                    TO TRUE                        07850003
00769          PERFORM DP013-0000-PROCESS-ABEND                         07860003
00770      END-IF.                                                      07870003
                                                                        07871013
      *----------------------------------------------------------------*07872013
      *    CHECKS FOR SEASONAL SET DATA AND MOVES DATA TO ASC FIELD.   *07873013
      *----------------------------------------------------------------*07874013
       4051-GET-SEASET-DATA.                                            07875014
           IF  PO017-SEASET-DATA > SPACES                               07876014
               MOVE PO017-SEASET-DATA    TO ASC-SEASET-DATA             07877014
           ELSE                                                         07878013
               MOVE SPACES TO ASC-SEASET-DATA                           07879013
           END-IF.                                                      07879113
00771                                                                   07880003
00772 *----------------------------------------------------------------*07890003
00773 * OPEN  THE INSTRUCTION CURSOR                                   *07900003
00774 *----------------------------------------------------------------*07910003
00775                                                                   07920003
00776  4100-OPEN-CURSOR.                                                07930003
00777      PERFORM                                                      07940003
00778          WITH TEST AFTER                                          07950003
00779          VARYING PV-RETRY-COUNTER                                 07960003
00780          FROM 1 BY 1                                              07970003
00781          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07980003
00782                    OR (SQLCODE = ZERO))                           07990003
00783              MOVE 'CURSOR:  INST-CSR'                             08000003
00784                                    TO DP013-MESSAGE-TEXT (2)      08010003
00785              EXEC SQL                                             08020003
00786                   OPEN INST-CSR                                   08030003
00787              END-EXEC                                             08040003
00788                                                                   08050003
00789          EVALUATE TRUE                                            08060003
00790              WHEN SQLCODE = ZERO                                  08070003
00791              WHEN SQLCODE = -904                                  08080003
00792              WHEN SQLCODE = -913                                  08090003
00793                  CONTINUE                                         08100003
00794              WHEN SQLWARN0 NOT = SPACES                           08110003
00795              WHEN SQLCODE < ZERO                                  08120003
00796              WHEN SQLCODE > ZERO                                  08130003
00797                  MOVE '4100-OPEN-CURSOR'                          08140003
00798                                    TO DP013-PARAGRAPH             08150003
00799                  MOVE 'OPEN INSTRUCTION CURSOR - '                08160003
00800                                    TO DP013-MESSAGE-TEXT (1)      08170003
00801                  MOVE SQLCA        TO DP013-SQLCA                 08180003
00802                  MOVE 'TPOINST '   TO DP013-DB2-TABLE-NAME (1)    08190003
00803                  SET DP013-DB2-ABEND                              08200003
00804                      DP013-XCTL-DISPLAY-RESTART TO TRUE           08210003
00805                  PERFORM DP013-0000-PROCESS-ABEND                 08220003
00806          END-EVALUATE                                             08230003
00807      END-PERFORM.                                                 08240003
00808 *                                                                 08250003
00809      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08260003
00810          MOVE '4100-OPEN-CURSOR'   TO DP013-PARAGRAPH             08270003
00811          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   08280003
00812                                    TO DP013-MESSAGE-TEXT (1)      08290003
00813          MOVE SQLCA                TO DP013-SQLCA                 08300003
00814          MOVE 'TPOINST '           TO DP013-DB2-TABLE-NAME (1)    08310003
00815          SET DP013-DB2-ABEND                                      08320003
00816              DP013-XCTL-DISPLAY-RESTART                           08330003
00817                                    TO TRUE                        08340003
00818          PERFORM DP013-0000-PROCESS-ABEND                         08350003
00819      END-IF.                                                      08360003
00820                                                                   08370003
00821  EJECT                                                            08380003
00822 *----------------------------------------------------------------*08390003
00823 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *08400003
00824 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *08410003
00825 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *08420003
00826 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *08430003
00827 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *08440003
00828 *                                                                *08450003
00829 *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *08460003
00830 *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *08470003
00831 *    UPON INITIALIZATION.                                        *08480003
00832 *----------------------------------------------------------------*08490003
00833                                                                   08500003
00834  4200-READ-ITEMS-FROM-DB.                                         08510003
00835                                                                   08520003
00836      PERFORM                                                      08530003
00837          VARYING PV-READ-COUNT                                    08540003
00838          FROM 1 BY 1                                              08550003
00839          UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    08560003
00840             OR (ASC-NO-ITEMS-LEFT-ON-DB))                         08570003
00841                                                                   08580003
00842          PERFORM 4210-FETCH                                       08590003
00843                                                                   08600003
00844          IF  ASC-ITEMS-LEFT-ON-DB                                 08610003
00845              IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                08620003
00846                  ADD +1            TO ASC-ITEM-SUB                08630003
00847              ELSE                                                 08640003
00848                  ADD +1            TO ASC-BLK-SUB                 08650003
00849                  MOVE +1           TO ASC-ITEM-SUB                08660003
00850                                                                   08670003
00851                  IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         08680003
00852                      MOVE +1       TO ASC-BLK-SUB                 08690003
00853                      SET ASC-BLOCK-MODIFIED (1)                   08700003
00854                                    TO TRUE                        08710003
00855                      PERFORM 5100-WRITE-TEMP-STORAGE              08720003
00856                      MOVE ASC-BLOCK-ENTRIES                       08730003
00857                                (PC-MAX-BLOCKS-IN-ARRAY)           08740003
00858                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 08750003
00859                      ADD +1        TO ASC-BLK-SUB                 08760003
00860                      INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   08770003
00861                      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      08780003
00862                                    TO TRUE                        08790003
00863                  END-IF                                           08800003
00864              END-IF                                               08810003
00865              ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    08820003
00866              MOVE ASC-NUMBER-OF-ITEMS-READ                        08830003
00867                                    TO ASC-LIST-ITEM-NUMBER        08840003
00868                                       (ASC-BLK-SUB ASC-ITEM-SUB)  08850003
00869              MOVE INRCCD-RECIP-DESC                               08860003
00870                                    TO ASC-RCP-NME                 08870003
00871                                        (ASC-BLK-SUB ASC-ITEM-SUB) 08880003
00872              MOVE INSTCD-INSTR-DESC                               08890003
00873                                    TO PV-INSTR-DESC-BK            08900003
00874              MOVE PV-IDB-1         TO ASC-INST-LN1                08910003
00875                                        (ASC-BLK-SUB ASC-ITEM-SUB) 08920003
00876              MOVE PV-IDB-2         TO ASC-INST-LN2                08930003
00877                                        (ASC-BLK-SUB ASC-ITEM-SUB) 08940003
00878              MOVE PV-IDB-3         TO ASC-INST-LN3                08950003
00879                                        (ASC-BLK-SUB ASC-ITEM-SUB) 08960003
00880          END-IF                                                   08970003
00881      END-PERFORM.                                                 08980003
00882                                                                   08990003
00883      IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          09000003
00884          MOVE +1                   TO ASC-BLK-SUB                 09010003
00885          PERFORM 5100-WRITE-TEMP-STORAGE                          09020003
00886          ADD +1                    TO ASC-BLK-SUB                 09030003
00887          PERFORM 5100-WRITE-TEMP-STORAGE                          09040003
00888                                                                   09050003
00889          MOVE 1                    TO ASC-BLK-SUB                 09060003
00890                                       PV-BLOCK-NUMBER             09070003
00891          PERFORM 4410-READ-TEMP-STORAGE                           09080003
00892          IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             09090003
00893              MOVE 2                TO ASC-BLK-SUB                 09100003
00894                                       PV-BLOCK-NUMBER             09110003
00895              PERFORM 4410-READ-TEMP-STORAGE                       09120003
00896          END-IF                                                   09130003
00897      END-IF.                                                      09140003
00898  EJECT                                                            09150003
00899 *----------------------------------------------------------------*09160003
00900 *    FETCH THE INSTRUCTION CURSOR                                *09170003
00901 *----------------------------------------------------------------*09180003
00902                                                                   09190003
00903  4210-FETCH.                                                      09200003
00904                                                                   09210003
00905      EXEC SQL                                                     09220003
00906           FETCH INST-CSR                                          09230003
00907           INTO  :POINST-RECIP-CDE,                                09240003
00908                 :POINST-INSTR-NBR,                                09250003
00909                 :INRCCD-RECIP-DESC,                               09260003
00910                 :INSTCD-INSTR-DESC                                09270003
00911      END-EXEC                                                     09280003
00912                                                                   09290003
00913      EVALUATE TRUE                                                09300003
00914          WHEN SQLCODE = ZERO                                      09310003
00915          WHEN SQLCODE = +100                                      09320003
00916               CONTINUE                                            09330003
00917          WHEN SQLWARN0 NOT = SPACE                                09340003
00918          WHEN SQLCODE NOT = ZERO                                  09350003
00919               MOVE '4210-FETCH-CURSOR'                            09360003
00920                                    TO DP013-PARAGRAPH             09370003
00921               MOVE 'FETCH INSTRUCTION CURSOR'                     09380003
00922                                    TO DP013-MESSAGE-TEXT (1)      09390003
00923               MOVE SQLCA           TO DP013-SQLCA                 09400003
00924               SET DP013-DB2-ABEND  TO TRUE                        09410003
00925               PERFORM DP013-0000-PROCESS-ABEND                    09420003
00926      END-EVALUATE.                                                09430003
00927                                                                   09440003
00928      IF  SQLCODE EQUAL +100                                       09450003
00929          SET ASC-NO-ITEMS-LEFT-ON-DB                              09460003
00930                                    TO TRUE                        09470003
00931      END-IF.                                                      09480003
00932                                                                   09490003
00933  EJECT                                                            09500003
00934 *----------------------------------------------------------------*09510003
00935 * CLOSE THE INSTRUCTION CURSOR                                   *09520003
00936 *----------------------------------------------------------------*09530003
00937                                                                   09540003
00938  4300-CLOSE-CURSOR.                                               09550003
00939      EXEC SQL                                                     09560003
00940          CLOSE INST-CSR                                           09570003
00941      END-EXEC                                                     09580003
00942                                                                   09590003
00943      EVALUATE TRUE                                                09600003
00944          WHEN SQLCODE = ZERO                                      09610003
00945              CONTINUE                                             09620003
00946          WHEN SQLWARN0 NOT = SPACES                               09630003
00947          WHEN SQLCODE < ZERO                                      09640003
00948          WHEN SQLCODE > ZERO                                      09650003
00949              MOVE '4300-CLOSE-CURSOR'                             09660003
00950                                    TO DP013-PARAGRAPH             09670003
00951              MOVE 'CLOSE INSTRUCTION CURSOR '                     09680003
00952                                    TO DP013-MESSAGE-TEXT (1)      09690003
00953              MOVE SQLCA            TO DP013-SQLCA                 09700003
00954              MOVE 'TPOINST '       TO DP013-DB2-TABLE-NAME (1)    09710003
00955              SET DP013-DB2-ABEND                                  09720003
00956                  DP013-XCTL-DISPLAY-RESTART TO TRUE               09730003
00957              PERFORM DP013-0000-PROCESS-ABEND                     09740003
00958      END-EVALUATE.                                                09750003
00959                                                                   09760003
00960  EJECT                                                            09770003
00961 *----------------------------------------------------------------*09780003
00962 * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *09790003
00963 *----------------------------------------------------------------*09800003
00964                                                                   09810003
00965  4400-MOVE-COMMAREA-TO-SCREEN.                                    09820003
00966      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             09830003
00967          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          09840003
00968          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          09850003
00969              MOVE +1               TO ASC-BLK-SUB                 09860003
00970              PERFORM 5100-WRITE-TEMP-STORAGE                      09870003
00971              ADD +1                TO ASC-BLK-SUB                 09880003
00972              PERFORM 5100-WRITE-TEMP-STORAGE                      09890003
00973              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             09900003
00974                  GIVING PV-BLOCK-NUMBER                           09910003
00975                  REMAINDER PV-REMAINDER                           09920003
00976              IF  PV-REMAINDER > ZERO                              09930003
00977                  ADD +1            TO PV-BLOCK-NUMBER             09940003
00978              END-IF                                               09950003
00979              MOVE +1               TO ASC-BLK-SUB                 09960003
00980              PERFORM 4410-READ-TEMP-STORAGE                       09970003
00981              ADD +1                TO ASC-BLK-SUB                 09980003
00982                                       PV-BLOCK-NUMBER             09990003
00983              PERFORM 4410-READ-TEMP-STORAGE                       10000003
00984      END-IF.                                                      10010003
00985      MOVE +1                       TO ASC-BLK-SUB.                10020003
00986      COMPUTE ASC-ITEM-SUB =                                       10030003
00987          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              10040003
00988          + PC-ITEMS-PER-PANEL).                                   10050003
00989 *                                                                 10060003
00990      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10070003
00991          ADD +1                    TO ASC-BLK-SUB                 10080003
00992          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10090003
00993      END-IF.                                                      10100003
00994 *                                                                 10110003
00995      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           10120003
00996          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                10130003
00997      PERFORM 4420-FORMAT-LIST-LINES                               10140003
00998          VARYING PV-SUB                                           10150003
00999          FROM PC-ITEMS-PER-PANEL BY -1                            10160003
01000          UNTIL PV-SUB < +1.                                       10170003
01001 *                                                                 10180008
01002      COMPUTE ASC-ITEMS-DISPLAYED =                                10190003
01003          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          10200003
01004      MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    10210003
01005                                       ASTRTITO.                   10220003
01006      MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    10230003
01007      MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    10240003
01008      MOVE ASC-DPT-NBR              TO ADEPTO.                     10250003
01009      MOVE ASC-ENT-NAME-DESC        TO AVENDNMO.                   10260003
01010      MOVE ASC-KEY-PO-NBR           TO APONUMO.                    10270003
           MOVE ASC-SEASET-DATA          TO ASEASETO.                   10280003
01011                                                                   10290003
01012      IF  DP020-MSG-NUMBER-X = SPACE                               10300003
01013          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  10310003
01014 *            --- MORE ITEMS TO DISPLAY ----                       10320003
01015              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            10330003
01016              SET DP020-MSG-INFORMATIONAL TO TRUE                  10340003
01017          END-IF                                                   10350003
01018      END-IF.                                                      10360003
01019 *----------------------------------------------------------------*10370003
01020 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *10380003
01021 *----------------------------------------------------------------*10390003
01022                                                                   10400003
01023  4410-READ-TEMP-STORAGE.                                          10410003
01024                                                                   10420003
01025      EXEC CICS                                                    10430003
01026          READQ TS                                                 10440003
01027              QUEUE (ASC-LIST-QUEUE-NAME)                          10450003
01028              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               10460003
01029              ITEM  (PV-BLOCK-NUMBER)                              10470003
01030              RESP  (PV-CICS-RESP)                                 10480003
01031      END-EXEC.                                                    10490003
01032                                                                   10500003
01033      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       10510003
01034        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     10520003
01035          CONTINUE                                                 10530003
01036      ELSE                                                         10540003
01037          SET DP013-CICS-ABEND      TO TRUE                        10550003
01038          SET DP013-NO-ROLLBACK     TO TRUE                        10560003
01039          MOVE '4410-READ-TEMP-STORAGE'                            10570003
01040                                    TO DP013-PARAGRAPH             10580003
01041          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      10590003
01042                                    TO DP013-MESSAGE-TEXT(1)       10600003
01043          PERFORM DP013-0000-PROCESS-ABEND                         10610003
01044      END-IF.                                                      10620003
01045                                                                   10630003
01046      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             10640003
01047 *                                                                 10650003
01048      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         10660003
01049          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               10670003
01050      END-IF.                                                      10680003
01051  EJECT                                                            10690003
01052 *----------------------------------------------------------------*10700003
01053 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *10710003
01054 *----------------------------------------------------------------*10720003
01055                                                                   10730003
01056  4420-FORMAT-LIST-LINES.                                          10740003
01057      IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      10750003
01058          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                10760003
01059          MOVE SPACE                TO MR-RECP-NME (PV-SUB)        10770003
01060                                       MR-INST-LN1 (PV-SUB)        10780003
01061                                       MR-INST-LN2 (PV-SUB)        10790003
01062                                       MR-INST-LN3 (PV-SUB)        10800003
01063      ELSE                                                         10810003
01064          IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           10820003
01065              MOVE ASC-RCP-NME (ASC-BLK-SUB ASC-ITEM-SUB)          10830003
01066                                    TO MR-RECP-NME (PV-SUB)        10840003
01067              MOVE ASC-INST-LN1 (ASC-BLK-SUB ASC-ITEM-SUB)         10850003
01068                                    TO MR-INST-LN1 (PV-SUB)        10860003
01069              MOVE ASC-INST-LN2 (ASC-BLK-SUB ASC-ITEM-SUB)         10870003
01070                                    TO MR-INST-LN2 (PV-SUB)        10880003
01071              MOVE ASC-INST-LN3 (ASC-BLK-SUB ASC-ITEM-SUB)         10890003
01072                                    TO MR-INST-LN3 (PV-SUB)        10900003
01073          END-IF                                                   10910003
01074      END-IF.                                                      10920003
01075      SUBTRACT +1 FROM ASC-ITEM-SUB                                10930003
01076      IF  ASC-ITEM-SUB < + 1                                       10940003
01077          MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                10950003
01078          MOVE +1                   TO ASC-BLK-SUB                 10960003
01079      END-IF.                                                      10970003
01080  EJECT                                                            10980003
01081 *----------------------------------------------------------------*10990003
01082 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *11000003
01083 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *11010003
01084 *----------------------------------------------------------------*11020003
01085                                                                   11030003
01086  5100-WRITE-TEMP-STORAGE.                                         11040003
01087      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     11050003
01088                                    TO PV-LIST-ITEM-NUMBER.        11060003
01089      COMPUTE PV-BLOCK-NUMBER =                                    11070003
01090          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11080003
01091                                                                   11090003
01092      IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             11100003
01093      OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             11110003
01094          IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      11120003
01095              PERFORM 5105-REWRITE-ASC-LISTQ                       11130003
01096          END-IF                                                   11140003
01097      ELSE                                                         11150003
01098          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       11160003
01099          ASC-HIGHEST-BLOCK-WRITTEN + 1                            11170003
01100          PERFORM 5110-WRITE-ASC-LISTQ                             11180003
01101          ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   11190003
01102      END-IF.                                                      11200003
01103                                                                   11210003
01104      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             11220003
01105 ******************************************************************11230003
01106 ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **11240003
01107 ** SPECIFIC COMMAREA.                                           **11250003
01108 ******************************************************************11260003
01109  5105-REWRITE-ASC-LISTQ.                                          11270003
01110      EXEC CICS                                                    11280003
01111          WRITEQ TS                                                11290003
01112              QUEUE (ASC-LIST-QUEUE-NAME)                          11300003
01113              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               11310003
01114              ITEM  (PV-BLOCK-NUMBER)                              11320003
01115              REWRITE                                              11330003
01116              RESP  (PV-CICS-RESP)                                 11340003
01117      END-EXEC.                                                    11350003
01118                                                                   11360003
01119      IF  PV-CICS-RESP = DFHRESP(NORMAL)                           11370003
01120          CONTINUE                                                 11380003
01121      ELSE                                                         11390003
01122          SET DP013-CICS-ABEND      TO TRUE                        11400003
01123          SET DP013-NO-ROLLBACK     TO TRUE                        11410003
01124          MOVE '5105-REWRITE-ASC-LISTQ'                            11420003
01125                                    TO DP013-PARAGRAPH             11430003
01126          MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     11440003
01127                                    TO DP013-MESSAGE-TEXT(1)       11450003
01128          PERFORM DP013-0000-PROCESS-ABEND                         11460003
01129      END-IF.                                                      11470003
01130                                                                   11480003
01131 ******************************************************************11490003
01132 ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **11500003
01133 ** SPECIFIC COMMAREA.                                           **11510003
01134 ******************************************************************11520003
01135  5110-WRITE-ASC-LISTQ.                                            11530003
01136      EXEC CICS                                                    11540003
01137          WRITEQ TS                                                11550003
01138              QUEUE (ASC-LIST-QUEUE-NAME)                          11560003
01139              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               11570003
01140              ITEM  (PV-BLOCK-NUMBER)                              11580003
01141              RESP  (PV-CICS-RESP)                                 11590003
01142      END-EXEC.                                                    11600003
01143      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      11610003
01144          SET DP013-CICS-ABEND      TO TRUE                        11620003
01145          SET DP013-NO-ROLLBACK     TO TRUE                        11630003
01146          MOVE '5110-WRITE-ASC-LISTQ'                              11640003
01147                                    TO DP013-PARAGRAPH             11650003
01148          MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           11660003
01149                                    TO DP013-MESSAGE-TEXT(1)       11670003
01150          PERFORM DP013-0000-PROCESS-ABEND                         11680003
01151      END-IF.                                                      11690003
01152  EJECT                                                            11700003
01153                                                                   11710003
01154  EJECT                                                            11720003
01155 *----------------------------------------------------------------*11730003
01156 *    ABEND PROCESSOR MODULE                                      *11740003
01157 *----------------------------------------------------------------*11750003
01158                                                                   11760003
01159      COPY DPPD013.                                                11770003
