      *-----------------------*                                         00010010
       IDENTIFICATION DIVISION.                                         00020010
      *-----------------------*                                         00030010
       PROGRAM-ID.    INKCS030.                                         00040010
       AUTHOR.        SCOTT JACKSON.                                    00050010
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060010
       DATE-WRITTEN.  08-30-99.                                         00070010
       DATE-COMPILED.                                                   00080010
      *----------------------------------------------------------------*00090010
      *    I030 - PHYSICAL INVENTORY SHEET INVENTORY SELECTION         *00100010
      *                                                                *00110010
      *    THIS PROGRAM ALLOWS THE USER ENTER DATA TO BE USED BY       *00120010
      *    SUBSEQUENT PROGRAMS TO CREATE A LIST OR TO BRING UP A       *00130010
      *    DETAIL SCREEN.                                              *00140010
      *                                                                *00150010
      *    IF THE OPERATOR IS LOCATED AT CORPORATE, THE PROGRAM        *00160010
      *    PROMPTS FOR A STORE NUMBER. THE STORE NUMBER MUST BE        *00170010
      *    NUMERIC AND NON-ZERO. IF THE OPERATOR IS LOCATED AT A       *00180010
      *    SELLING STORE, THE PROGRAM FILLS IN AND PROTECTS THE STORE  *00190010
      *    NUMBER.                                                     *00200010
      *                                                                *00210010
      *    A SHEET NUMBER MUST BE ENTERED. IT MUST BE NUMERIC AND NON- *00220010
      *    ZERO, OR IT MUST CONTAIN ONE OR MORE ASTERISKS. IF IT       *00230010
      *    CONTAINS ASTERISKS, A SHEET NUMBER OF '0' IS PASSED TO THE  *00240010
      *    LIST PROGRAM. THE LIST PGM WILL RECOGNIZE THIS 'INVALID'    *00250010
      *    SHEET NUMBER TO SELECT 'ALL' SHEETS FOR DISPLAY.            *00260010
      *                                                                *00270010
      *    ALL ADDITIONAL EDITING IS DONE IN THE DETAIL PROGRAMS.      *00280010
      *----------------------------------------------------------------*00290010
      * 01/27/20000 SCOTT JACKSON      CHG ID:J2K                      *00300010
      *    INVPAR-CSR WILL NOW SELECT RECORDS WITH ACTL_FIN_BK_DTE OF  *00310010
      *    '9999-09-09' AS THE 'CURRENT' ROW. THIS WILL ALLOW USERS TO *00320010
      *    INQUIRE ON STORES/SHEETS WHICH HAVE ALREADY BOOKED UNITS.   *00330010
      *     ** UPDATES NOT ALLOWED FOR A STORE WITH AN ACTL_UNT_BK_DTE *00340010
      *     ** OF ANYTHING OTHER THAN '9999-09-09'                     *00350010
      *----------------------------------------------------------------*00360010
      * 03/04/2000  SCOTT JACKSON      CHG ID:SMJ                      *00370010
      *    ONLINE ABENDS (-913) OCCUR UPON ENTRY TO SHEET MAINTENANCE  *00380010
      *    IF TINVPAR IS WAS BEING UPDATED BY BATCH PROCESSES. 'SOFT'  *00390010
      *    ABEND TO USER WITH 'RESOURCE UNAVAILABLE' ON INITIAL FETCH. *00400010
      *----------------------------------------------------------------*00410010
      * 04/26/2000  SCOTT JACKSON      CHG ID: MAY00                   *00420010
      *    ENSURE ACTL_INV_DTE HAS BEEN SET ON TINVPAR BEFORE ANY      *00430010
      *    SHEET MAINT (ADD/UPDATE/DELETE) IS ALLOWED (NOT'9999-09-09')*00440010
      *----------------------------------------------------------------*00450010
W05091* 05/09/2001  ROD JANSSEN        CHG ID: 99999                   *00460010
W05091*    AUTOMATED SHEET INVENTORY SELECTS                            00470010
      *----------------------------------------------------------------*00480010
      * 05/01/2002  CAROL WOJCIECHOWSKI    CHG ID: 23511               *00490010
      *    ALLOW INVENTORY SHEETS TO BE ENTERED 14 DAYS BEFORE THE     *00500010
      *    PLANNED INVENTORY DATE ON THE TINVPAR TABLE                 *00510010
      *----------------------------------------------------------------*00520010
W24521* 03/26/2003  SCOTT JACKSON      CHG ID: W24521                  *00530010
W24521*    RETRIEVE STORE TYPE CODE FROM TSTR000 AND PASS TO ADD/UPDATE*00540010
W24521*    SCREENS. ADD UNT_BKG_STAT_CDE TO INVPAR_CSR TO PREVENT NEW  *00550010
W24521*    OR EXISTING SHEET MODIFICATION IF BOOKING HAS BEEN STARTED  *00560010
      *----------------------------------------------------------------*00570010
25248 * 10/30/2003  ROD JANSSEN        CHG ID: 25248                    00580010
25248 *    THE USER IS ABLE TO UPDATE/DELETE SHEETS AFTER THE STORE HAS 00590010
25248 *    BOOKED SHEETS VIA THE "LIST INQUIRY" OPTION.                 00600010
      *----------------------------------------------------------------*00610010
W26600* 07/12/2004  SCOTT JACKSON      CHG ID: W26600                   00620010
W26600*    STORE NUMBER EXPANSION. INCREASE STORE TO A 4-DIGIT NUMERIC  00630010
W26600*    FIELD. REPLACE TSTR000 WITH XMT_LOC. CHG RELATED DB2 CALLS   00640010
      *----------------------------------------------------------------*00650010
W26006* 02/24/2005  ERIN SEARL         CHG ID: W26006                   00660010
W26006*    REMOVE REFERENCES TO OBSOLETE STORE TABLE.                   00670010
      *----------------------------------------------------------------*00680010
W28545* W28545  08-22-2005 ROD JANSSEN THE NEW TRANSFER PROCESS         00690010
W28545*----------------------------------------------------------------*00700010
W28545* 02/27/2006  JOHN SELWITSCHKA   CHG ID: W28545                   00710010
W28545*    UPON RETURN FROM A SUCCESSFUL ADD, INITIALIZE THE TYPE CODE. 00720010
W28545*----------------------------------------------------------------*00730010
J28545* 06-16-2006  JAN BLAZICH        CHG ID: W28545                   00731012
J28545*    TINVPAR/TINCNTL ARE USED TO GET THE PROPER INV-ID AND STORE  00731112
      * 05-01-2008  JILL LIN           CHG ID: W33304                   00731314
      *    HOLDING INVENTORY LEDGER OPEN ACROSS PERIODS INVENTORY       00731414
      *    SHORTAGE REPORTING                                           00731514
J28545*----------------------------------------------------------------*00734012
263126* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126         00735016
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00736016
263126* MAKING THE CALL DYNAMIC VS STATIC.                              00737016
263126*----------------------------------------------------------------*00738016
1122RM* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188         00739017
1122RM* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING 00739117
1122RM* THE CICS ARCHITECTURE API.                                      00739217
1122RM*---------------------------------------------------------------* 00739317
                                                                        00740010
       ENVIRONMENT DIVISION.                                            00750010
                                                                        00760010
       DATA DIVISION.                                                   00770010
                                                                        00780010
       WORKING-STORAGE SECTION.                                         00790010
      *                                                                 00800010
       01  PC-PROGRAM-CONSTANTS.                                        00810010
           05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'IN030A  '. 00820010
           05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'INKM030 '. 00830010
           05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'INKCS030'. 00840010
           05  PC-TSYMSG-NUMBERS.                                       00850010
               10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00860010
               10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00870010
               10  PC-TSYMSG-00010       PIC  9(05)  VALUE  00010.      00880010
               10  PC-TSYMSG-00017       PIC  9(05)  VALUE  00017.      00890010
               10  PC-TSYMSG-00550       PIC  9(05)  VALUE  00550.      00900010
               10  PC-TSYMSG-00551       PIC  9(05)  VALUE  00551.      00910010
SMJ            10  PC-TSYMSG-01063       PIC  9(05)  VALUE  01063.      00920010
               10  PC-TSYMSG-01655       PIC  9(05)  VALUE  01655.      00930010
               10  PC-TSYMSG-02137       PIC  9(05)  VALUE  02137.      00940010
               10  PC-TSYMSG-02138       PIC  9(05)  VALUE  02138.      00950010
               10  PC-TSYMSG-02143       PIC  9(05)  VALUE  02143.      00960010
MAY00          10  PC-TSYMSG-02472       PIC  9(05)  VALUE  02472.      00970010
W05091         10  PC-TSYMSG-02701       PIC  9(05)  VALUE  02701.      00980010
23511          10  PC-TSYMSG-02142       PIC  9(05)  VALUE  02142.      00990010
W24521         10  PC-TSYMSG-02895       PIC  9(05)  VALUE  02895.      01000010
           05  PC-HEADQUARTERS           PIC  X(02)  VALUE  'HQ'.       01010010
           05  PC-OPERATING-CO           PIC  X(02)  VALUE  '03'.       01020010
           05  PC-CALENDAR-ROUTINE       PIC  X(08)  VALUE  'DPKUT500'. 01030010
      *                                                                 01040010
       01  PS-PROGRAM-SWITCHES.                                         01050010
           05  PS-ERROR-SW               PIC  X      VALUE  'N'.        01060010
               88  PS-ERROR                          VALUE  'Y'.        01070010
               88  PS-NO-ERROR                       VALUE  'N'.        01080010
                                                                        01090010
       01  PV-PROGRAM-VARIABLES.                                        01100010
           05  PV-ASTERISK-CNT           PIC S9(04)  VALUE +0           01110010
                                                     COMP SYNC.         01120010
                                                                        01130010
           05  PV-ASTERISK-IND           PIC  X(01)  VALUE 'N'.         01140010
               88  PV-ASTERISK-ENTERED               VALUE 'Y'.         01150010
               88  PV-ASTERISK-NO                    VALUE 'N'.         01160010
                                                                        01170010
23511      05  PV-CURRENT-DATE           PIC  X(10)  VALUE SPACES.      01180010
                                                                        01190010
23511      05  PV-SHEET-START-DTE-YYYYMMDD                              01200010
23511                                    PIC  X(10)  VALUE SPACES.      01210010
                                                                        01220010
       01  PV-DB2-KEY-AREA.                                             01230010
W26600*    05  PV-DB2-STORE-NBR-X        PIC  X(03).                    01240010
W26600*    05  PV-DB2-STORE-NBR-RED REDEFINES                           01250010
W26600*        PV-DB2-STORE-NBR-X        PIC  9(03).                    01260010
W26600     05  PV-DB2-STORE-NBR-X        PIC  X(04).                    01270010
W26600     05  PV-DB2-STORE-NBR-RED REDEFINES                           01280010
W26600         PV-DB2-STORE-NBR-X        PIC  9(04).                    01290010
           05  PV-DB2-STORE-NBR          PIC S9(04)  COMP.              01300010
           05  PV-SHEET-NBR-X            PIC  X(06).                    01310010
           05  PV-SHEET-NBR-RED     REDEFINES                           01320010
               PV-SHEET-NBR-X            PIC  9(06).                    01330010
           05  PV-SHEET-NBR              PIC S9(09)  COMP.              01340010
      *----------------------------------------------------------------*01350010
      *    MAP LAYOUT                                                  *01360010
      *----------------------------------------------------------------*01370010
                                                                        01380010
           COPY INKM030.                                                01390010
                                                                        01400010
      *----------------------------------------------------------------*01410010
      *    ATTRIBUTE SETTINGS COPYBOOK.                                *01420010
      *----------------------------------------------------------------*01430010
                                                                        01440010
           COPY DPWS015.                                                01450010
                                                                        01460010
      *----------------------------------------------------------------*01470010
      *    FUNCTION KEYS COPYBOOK                                      *01480010
      *----------------------------------------------------------------*01490010
                                                                        01500010
           COPY DPWS016.                                                01510010
                                                                        01520010
      *----------------------------------------------------------------*01530010
      *    COPY BOOK FOR NUMERIC EDIT SUBROUTINE (DPKUT100) PARAMETER  *01540010
      *    LIST.                                                       *01550010
      *----------------------------------------------------------------*01560010
                                                                        01570010
           COPY DPWS010I.                                               01580010
                                                                        01590010
      *----------------------------------------------------------------*01600010
      *    COPY BOOK FOR CURRENT SYSTEM DATE/TIME PROCEDURE DIVISION   *01610010
      *    ROUTINE                                                      01620010
      *----------------------------------------------------------------*01630010
                                                                        01640010
           COPY DPWS017.                                                01650010
                                                                        01660010
      *----------------------------------------------------------------*01670010
      *    COPY BOOK FOR CALENDAR SUBROUTINE (DPKUT500)                 01680010
      *----------------------------------------------------------------*01690010
                                                                        01700010
           COPY DPWS500.                                                01710010
                                                                        01720010
      ******************************************************************01730010
      ** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01740010
      ** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01750010
      ******************************************************************01760010
           COPY DPWS030.                                                01770010
1122RM     COPY DPWS930.                                                01771018
                                                                        01780010
      ***************************************************************** 01790010
      *    STANDARD COMMAREA.                                           01800010
      ***************************************************************** 01810010
                                                                        01820010
           COPY DPWS020.                                                01830010
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01840010
                                                                        01850010
      ***************************************************************** 01860010
      *    INTER-APPLICATION COMMAREA.                                  01870010
      ***************************************************************** 01880010
                                                                        01890010
               10  INTER-APPL-COMM-AREA PIC X(200).                     01900010
           COPY INWS030.                                                01910010
      ***************************************************************** 01920010
      *    SPECIFIC COMMMAREA FOR INKCS030.                             01930010
      ***************************************************************** 01940010
               10  ASC-SPECIFIC-COMMAREA.                               01950010
W26600*            15  ASC-STORE-NBR-X             PIC  X(03).          01960010
W26600*            15  ASC-STORE-NBR               REDEFINES            01970010
W26600*                ASC-STORE-NBR-X             PIC  9(03).          01980010
W26600             15  ASC-STORE-NBR-X             PIC  X(04).          01990010
W26600             15  ASC-STORE-NBR               REDEFINES            02000010
W26600                 ASC-STORE-NBR-X             PIC  9(04).          02010010
                   15  ASC-SHEET-NBR-X             PIC  X(06).          02020010
                   15  ASC-SHEET-NBR               REDEFINES            02030010
                       ASC-SHEET-NBR-X             PIC  9(06).          02040010
                   15  ASC-STORE-NAME              PIC  X(25).          02050010
W28545             15  ASC-TYPE-CDE                PIC  X(01).          02060010
W28545                 88  ASC-TYPE-ALL-SHEETS             VALUE '*'.   02070010
W28545                 88  ASC-TYPE-TFR-SHEETS             VALUE 'T'.   02080010
W28545                 88  ASC-TYPE-MANI-SHEETS            VALUE 'M'.   02090010
W28545                 88  ASC-TYPE-ENTRD-SHEETS           VALUE 'K'.   02100010
W28545             15  ASC-TYPE-CDE-DESC           PIC  X(25).          02110010
W28545                 88  ASC-DESC-ALL-SHEETS                          02120010
W28545                     VALUE 'ALL SHEETS'.                          02130010
W28545                 88  ASC-DESC-TFR-SHEETS                          02140010
W28545                     VALUE 'TRANSFER STORE SHEETS'.               02150010
W28545                 88  ASC-DESC-MANI-SHEETS                         02160010
W28545                     VALUE 'MANIFEST TRAILER SHEETS'.             02170010
W28545                 88  ASC-DESC-ENTRD-SHEETS                        02180010
W28545                     VALUE 'USER ENTERED SHEETS'.                 02190010
W28545             15  FILLER                      PIC  X(2804).        02200010
           EJECT                                                        02210010
      *----------------------------------------------------------------*02220010
      *    ABEND PROCESSING COPYBOOK.                                  *02230010
      *----------------------------------------------------------------*02240010
                                                                        02250010
           COPY DPWS013.                                                02260010
                                                                        02270010
      *---------------------------------------------------------------* 02280010
      *    DB2 AREA FOR STORE TABLE                                   * 02290010
      *---------------------------------------------------------------* 02300010
W26600     EXEC SQL                                                     02310010
W26600          INCLUDE XMT00001                                        02320010
W26600     END-EXEC.                                                    02330010
      *---------------------------------------------------------------* 02340010
      *    DB2 AREA FOR INVENTORY PARAMETERS TABLE                    * 02350010
      *---------------------------------------------------------------* 02360010
           EXEC SQL                                                     02370010
                INCLUDE TINVPAR                                         02380010
           END-EXEC.                                                    02390010
                                                                        02400010
W28545     EXEC SQL                                                     02410010
W28545          INCLUDE TINCNTL                                         02420010
W28545     END-EXEC.                                                    02430010
W28545                                                                  02440010
      *---------------------------------------------------------------* 02450010
      *    CURSOR TO SELECT 'SHEET INVENTORY COMPLETED INDICATOR'     * 02460010
      *---------------------------------------------------------------* 02470010
           EXEC SQL                                                     02480010
               DECLARE INVPAR-CSR CURSOR FOR                            02490010
W28545             SELECT   A.SHEET_INV_CPLD_IND                        02500010
W28545                     ,A.ACTL_INV_DTE                              02510010
W28545                     ,A.ACTL_UNIT_BK_DTE                          02520010
W28545                     ,DATE(A.PLND_INV_DTE - 14 DAYS)              02530010
W28545                     ,A.UNT_BKG_STAT_CDE                          02540010
J28545                     ,B.INV_ID                                    02550012
J28545                     ,B.INV_NM                                    02560012
W28545             FROM     TINVPAR A                                   02570010
W28545                     ,TINCNTL B                                   02580010
J28545             WHERE    A.INV_ID  = B.INV_ID                        02590012
J28545               AND    B.ACTV_IND = 'Y'                            02600012
W28545               AND    A.LOC_NBR   = :PV-DB2-STORE-NBR             02610010
W28545               AND    A.ACTL_FIN_BK_DTE = '9999-09-09'            02620010
W33304               AND    A.LOC_INV_STAT_CDE = 'IN'                   02621015
           END-EXEC.                                                    02630010
      *---------------------------------------------------------------* 02640010
      *    DB2 AREA FOR COMMUNICATIONS                                * 02650010
      *---------------------------------------------------------------* 02660010
           EXEC SQL                                                     02670010
                INCLUDE SQLCA                                           02680010
           END-EXEC.                                                    02690010
                                                                        02700010
                                                                        02710010
       EJECT                                                            02720010
       LINKAGE SECTION.                                                 02730010
                                                                        02740010
       01  DFHCOMMAREA.                                                 02750010
           05  FILLER                         OCCURS  1 TO 4072 TIMES   02760010
                                              DEPENDING ON EIBCALEN.    02770010
               10  FILLER                     PIC X.                    02780010
                                                                        02790010
                                                                        02800010
       PROCEDURE DIVISION.                                              02810010
      ***************************************************************** 02820010
      ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02830010
      ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02840010
      ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02850010
      **                                                             ** 02860010
      ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02870010
      ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02880010
      ***************************************************************** 02890010
       0000-MAIN-MODULE.                                                02900010
           INITIALIZE DP030-CICS-API-FIELDS.                            02910010
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02920010
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02930010
           MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02940010
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02950010
           MOVE LENGTH OF IN030AI        TO DP030-MAP-LENGTH (1).       02960010
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02970010
           PERFORM 0001-CALL-CICS-ARCH-API.                             02980010
      *                                                                 02990010
           PERFORM 1000-CONTROL-PROCESSING.                             03000010
      *                                                                 03010010
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03020010
           PERFORM 0001-CALL-CICS-ARCH-API.                             03030010
                                                                        03040010
       0001-CALL-CICS-ARCH-API.                                         03050010
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               03060018
1122RM     CALL DP930-CICS-ARCH-API                                     03061018
1122RM                     USING DFHEIBLK                               03062018
                                 DFHCOMMAREA                            03070010
                                 DP030-CICS-API-FIELDS                  03080010
                                 DP020-STANDARD-COMMAREA                03090010
                                 IN030AI.                               03100010
      *                                                                 03110010
           IF  DP030-RC-CALL-SUCCESSFUL                                 03120010
               CONTINUE                                                 03130010
           ELSE                                                         03140010
               SET DP013-NO-ROLLBACK                                    03150010
                   DP013-XCTL-DISPLAY-RESTART                           03160010
                   DP013-CICS-ABEND      TO TRUE                        03170010
               MOVE 'BEFORE 0000-MAIN-MODULE'                           03180010
                                         TO DP013-PARAGRAPH             03190010
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03200018
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03210018
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03211018
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03212018
               MOVE DP030-RETURN-CODE                                   03220010
                                         TO DP013-MESSAGE-TEXT (3)      03230010
               PERFORM DP013-0000-PROCESS-ABEND                         03240010
           END-IF.                                                      03250010
       EJECT                                                            03260010
      *----------------------------------------------------------------*03270010
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03280010
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03290010
      *----------------------------------------------------------------*03300010
                                                                        03310010
       1000-CONTROL-PROCESSING.                                         03320010
                                                                        03330010
           EVALUATE TRUE                                                03340010
               WHEN DP020-NEXT-ACT-INITIAL                              03350010
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     03360010
                   PERFORM 4000-BUILD-INITIAL-PANEL                     03370010
                                                                        03380010
               WHEN DP020-NEXT-ACT-READ-MAP                             03390010
                   PERFORM 2000-FKEY-PROCESSING                         03400010
                                                                        03410010
               WHEN DP020-NEXT-ACT-RETURN                               03420010
      *            *----------------------------------------------------03430010
      *            * IF THE MESSAGE NUMBER IS SET TO 2143, THIS PROGRAM 03440010
      *            * IS BEING RETURNED TO FROM THE SHEET INVENTORY      03450010
      *            * ADD PROGRAM AFTER A SUCCESSFUL ADD. IN THAT CASE,  03460010
      *            * THE SPECIFICATION SCREEN SHOULD BE DISPLAYED WITH  03470010
      *            * THE STORE NUMBER INTACT AND THE SHEET NUMBER EMPTY.03480010
W28545*            * THE SHEET TYPE CODE SHOULD ALSO BE INITIALIZED.    03490010
      *            *----------------------------------------------------03500010
                   IF DP020-MSG-NUMBER = PC-TSYMSG-02143                03510010
                       MOVE ASC-STORE-NBR-X            TO ASTOREO       03520010
                       IF DP020-LOCATION-TYPE = PC-HEADQUARTERS         03530010
                           MOVE DP015-UNP-NUM-NOR-OFF  TO ASTOREA       03540010
                           MOVE DP015-GREEN            TO ASTOREC       03550010
                           MOVE DP015-UNDERLINE        TO ASTOREH       03560010
                       END-IF                                           03570010
                       INITIALIZE ASC-SHEET-NBR-X                       03580010
W28545                            ASC-TYPE-CDE                          03590010
                       MOVE -1                         TO ASHEETL       03600010
                       SET DP030-SET-CURSOR-APPL-1     TO TRUE          03610010
                       MOVE SPACE                      TO ASHEETO       03620010
                   ELSE                                                 03630010
                       PERFORM 3000-EDIT-DATA-IN-COMMAREA               03640010
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03650010
                   END-IF                                               03660010
                                                                        03670010
               WHEN OTHER                                               03680010
                   SET DP013-LOGIC-ABEND                                03690010
                       DP013-NO-ROLLBACK TO TRUE                        03700010
                   MOVE '1000-CONTROL-PROCESSING'                       03710010
                                         TO  DP013-PARAGRAPH            03720010
                   MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03730010
                                         TO  DP013-MESSAGE-TEXT(1)      03740010
                   MOVE DP020-NEXT-APPL-ACTIVITY                        03750010
                                         TO DP013-MESSAGE-TEXT(2)       03760010
                   PERFORM DP013-0000-PROCESS-ABEND                     03770010
           END-EVALUATE.                                                03780010
                                                                        03790010
      *----------------------------------------------------------------*03800010
      * FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03810010
      * SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03820010
      * EDITS.                                                         *03830010
      *----------------------------------------------------------------*03840010
                                                                        03850010
       2000-FKEY-PROCESSING.                                            03860010
           EVALUATE TRUE                                                03870010
                                                                        03880010
               WHEN DP020-SRC-AID = DP016-CLEAR                         03890010
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03900010
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03910010
               WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03920010
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     03930010
                   PERFORM 4000-BUILD-INITIAL-PANEL                     03940010
                   PERFORM 3200-RESET-ATTRIBUTES                        03950010
               WHEN OTHER                                               03960010
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03970010
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03980010
                   IF  PS-NO-ERROR                                      03990010
                       SET DP030-CONTINUE-GO TO TRUE                    04000010
                       PERFORM 2100-CHECK-FUNCTION-KEY                  04010010
                       IF  PS-NO-ERROR                                  04020010
                           CONTINUE                                     04030010
                       ELSE                                             04040010
                           SET DP030-OVERRIDE-GO TO TRUE                04050010
                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         04060010
                       END-IF                                           04070010
                   ELSE                                                 04080010
                       SET DP030-OVERRIDE-GO TO TRUE                    04090010
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04100010
                   END-IF                                               04110010
           END-EVALUATE.                                                04120010
                                                                        04130010
                                                                        04140010
      *----------------------------------------------------------------*04150010
      * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *04160010
      * FIRST. NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED    *04170010
      * FROM THE CICS ARCHITECTURE API.                                *04180010
      *----------------------------------------------------------------*04190010
                                                                        04200010
       2100-CHECK-FUNCTION-KEY.                                         04210010
      *                                                                 04220010
      ******************************************************************04230010
      * CHECK TINVPAR BEFORE PROCESSING          GO DIRECTLY TO SCREEN *04240010
      * -------------------------------         ---------------------- *04250010
      * FUNC-01 (ADD)                            FUNC-02 (INQUIRY)     *04260010
      * FUNC-03 (UPDATE)                         FUNC-08 (LSTSHEET)    *04270010
      * FUNC-04 (DELETE)                                               *04280010
      ******************************************************************04290010
   ****                                                                 04300010
           EVALUATE TRUE                                                04310010
               WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04320010
               WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              04330010
               WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              04340010
               WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              04350010
               WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)              04360010
                   PERFORM 2110-PREPARE-INTER-APPL-COMM                 04370010
                                                                        04380010
               WHEN DP020-SRC-AID = DP016-ENTER                         04390010
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04400010
                                                                        04410010
               WHEN OTHER                                               04420010
                   SET DP013-NO-ROLLBACK                                04430010
                       DP013-XCTL-DISPLAY-RESTART                       04440010
                       DP013-CICS-ABEND  TO TRUE                        04450010
                   MOVE '2100-CHECK-FUNCTION-KEY'                       04460010
                                         TO DP013-PARAGRAPH             04470010
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04480010
                                         TO DP013-MESSAGE-TEXT (1)      04490010
                   PERFORM DP013-0000-PROCESS-ABEND                     04500010
           END-EVALUATE.                                                04510010
                                                                        04520010
                                                                        04530010
      ******************************************************************04540010
      ** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **04550010
      ** INTER-APPLICATION COMMAREA.                                  **04560010
      ******************************************************************04570010
                                                                        04580010
       2110-PREPARE-INTER-APPL-COMM.                                    04590010
           INITIALIZE IN030-INTER-APPL-COMM-AREA.                       04600010
           MOVE ASC-STORE-NBR-X      TO PV-DB2-STORE-NBR-X.             04610010
           MOVE PV-DB2-STORE-NBR-RED TO PV-DB2-STORE-NBR.               04620010
           MOVE PV-DB2-STORE-NBR     TO IN030-STR-NBR.                  04630010
           MOVE ASC-STORE-NAME       TO IN030-STORE-NAME.               04640010
W28545     MOVE ASC-TYPE-CDE         TO IN030-TYPE-CDE.                 04650010
W28545     MOVE ASC-TYPE-CDE-DESC    TO IN030-TYPE-CDE-DESC.            04660010
W26600     MOVE XMT00001-LOC-TYP-CDE TO IN030-STORE-TYPE-CODE.          04670010
           MOVE ASC-SHEET-NBR-X      TO PV-SHEET-NBR-X.                 04680010
                                                                        04690010
25248 *** OPTIONS F14 - INQUIRY, F20 - LIST INQUIRY                     04700010
           IF (DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID) OR                04710010
               DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)    )              04720010
               IF PV-ASTERISK-ENTERED                                   04730010
                   MOVE ZEROES           TO IN030-SHEET-NBR             04740010
               ELSE                                                     04750010
                   MOVE ASC-SHEET-NBR-X  TO IN030-SHEET-NBR             04760010
               END-IF                                                   04770010
25248          PERFORM 2115-TINVPAR-VARIABLES                           04780010
           ELSE                                                         04790010
25248 *** OPTIONS F13 - ADD, F15 - UPDATE, F16 - DELETE                 04800010
               IF PV-ASTERISK-ENTERED                                   04810010
                   SET  PS-ERROR                                        04820010
                   DP020-MSG-FATAL      TO TRUE                         04830010
      *            ---- ENTER A NUMERIC VALUE ----                      04840010
                   MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            04850010
                   MOVE DP015-UNP-ALP-BRT-OFF                           04860010
                                             TO ASHEETA                 04870010
                   MOVE DP015-RED            TO ASHEETC                 04880010
                   MOVE DP015-REVERSE        TO ASHEETH                 04890010
                   MOVE -1                   TO ASHEETL                 04900010
                   SET DP030-SET-CURSOR-APPL-2                          04910010
                                             TO TRUE                    04920010
               ELSE                                                     04930010
                   MOVE PV-SHEET-NBR-RED TO PV-SHEET-NBR                04940010
                   MOVE PV-SHEET-NBR     TO IN030-SHEET-NBR             04950010
               END-IF                                                   04960010
                                                                        04970010
      *    *------------------------------------------------------------04980010
      *    * PROCESS TINVPAR / SHEET-INVENTORY CURSOR.                  04990010
      *    * CHECK WHETHER SHEET-COMPLETED-INDICATOR HAS BEEN SET.      05000010
      *    * STORE MUST HAVE ACTL_INV_DTE SET TO PROCEED (NOT DEFAULT)  05010010
W24521*    * IF A STORE HAS STARTED THE UNIT BOOKING PROCESS, NO FURTHER05020010
W24521*    * SHEET MAINTENANCE CAN BE PERFORMED (ADD OR UPDATES)        05030010
      *    *------------------------------------------------------------05040010
               PERFORM 2150-OPEN-CURSOR                                 05050010
                                                                        05060010
               EVALUATE TRUE                                            05070010
                  WHEN SQLCODE = 0                                      05080010
                     PERFORM 2160-FETCH                                 05090010
      *   *                                                             05100010
                     EVALUATE TRUE                                      05110010
                        WHEN SQLCODE = 0                                05120010
MAY00 *        ADD,UPDATE OR DELETE                                     05130010
MAY00                     IF INVPAR-ACTL-INV-DTE EQUAL '9999-09-09'     05140010
23511                        AND PV-SHEET-START-DTE-YYYYMMDD            05150010
23511                            > PV-CURRENT-DATE                      05160010
MAY00                        SET  PS-ERROR                              05170010
MAY00                        DP020-MSG-FATAL      TO TRUE               05180010
MAY00 *                      -- STORE'S ACTL INV DTE NOT SET ---        05190010
23511                        MOVE PC-TSYMSG-02142 TO DP020-MSG-NUMBER   05200010
MAY00                        MOVE DP015-UNP-ALP-BRT-OFF   TO ASTOREA    05210010
MAY00                        MOVE DP015-RED               TO ASTOREC    05220010
MAY00                        MOVE DP015-REVERSE           TO ASTOREH    05230010
MAY00                        MOVE -1                      TO ASTOREL    05240010
MAY00                        SET DP030-SET-CURSOR-APPL-2  TO TRUE       05250010
MAY00                     ELSE                                          05260010
W24521                       IF INVPAR-UNT-BKG-STAT-CDE NOT EQUAL 'IN'  05270015
  |                             SET  PS-ERROR                           05280010
  |                             DP020-MSG-FATAL      TO TRUE            05290010
  |   *                         -- STORE HAS BEGUN UNIT BOOK PROCESS ---05300010
  |                             MOVE PC-TSYMSG-02895 TO DP020-MSG-NUMBER05310010
  |                             MOVE DP015-UNP-ALP-BRT-OFF   TO ASTOREA 05320010
  |                             MOVE DP015-RED               TO ASTOREC 05330010
  |                             MOVE DP015-REVERSE           TO ASTOREH 05340010
  |                             MOVE -1                      TO ASTOREL 05350010
W24521                          SET DP030-SET-CURSOR-APPL-2  TO TRUE    05360010
MAY00                        ELSE                                       05370010
                                PERFORM 2190-PROCESS-INTER-APPL-VAR     05380010
MAY00                        END-IF                                     05390010
W24521                    END-IF                                        05400010
                        WHEN SQLCODE = +100                             05410010
                               SET  PS-ERROR                            05420010
                                    DP020-MSG-FATAL TO TRUE             05430010
      *                        ---- STORE IS NOT SET ON TINVPAR ---     05440010
                               MOVE PC-TSYMSG-01655 TO  DP020-MSG-NUMBER05450010
                               MOVE DP015-UNP-ALP-BRT-OFF               05460010
                                                    TO ASTOREA          05470010
                               MOVE DP015-RED       TO ASTOREC          05480010
                               MOVE DP015-REVERSE   TO ASTOREH          05490010
                               MOVE -1              TO ASTOREL          05500010
                               SET DP030-SET-CURSOR-APPL-1 TO TRUE      05510010
SMJ                     WHEN SQLCODE = -913                             05520010
SMJ                     WHEN SQLCODE = -911                             05530010
SMJ                     WHEN SQLCODE = -904                             05540010
SMJ                        SET  PS-ERROR                                05550010
SMJ                        DP030-OVERRIDE-GO                            05560010
SMJ                        DP020-MSG-WARNING           TO TRUE          05570010
SMJ   *                    ---- SYSTEM UNAVAILABLE, TRY AGAIN LATER     05580010
SMJ                        MOVE PC-TSYMSG-01063      TO DP020-MSG-NUMBER05590010
SMJ                        MOVE -1                     TO ASTOREL       05600010
SMJ                        SET DP030-SET-CURSOR-APPL-1 TO TRUE          05610010
                     END-EVALUATE                                       05620010
                  WHEN OTHER                                            05630010
                     SET  DP030-OVERRIDE-GO                             05640010
                          DP020-MSG-WARNING TO TRUE                     05650010
      *              ---- WAIT 15 SECONDS, THEN RETRY ----              05660010
                     MOVE PC-TSYMSG-00551   TO DP020-MSG-NUMBER         05670010
MAY00 *                                                                 05680010
MAY00             PERFORM 2170-CLOSE-CURSOR                             05690010
MAY00 *                                                                 05700010
               END-EVALUATE                                             05710010
MAY00      END-IF.                                                      05720010
                                                                        05730010
25248 ******************************************************************05740010
  |   * 2115-TINVPAR-VARIABLES.                                         05750010
  |   ******************************************************************05760010
  |    2115-TINVPAR-VARIABLES.                                          05770010
  |                                                                     05780010
  |        PERFORM 2150-OPEN-CURSOR.                                    05790010
  |                                                                     05800010
  |        EVALUATE TRUE                                                05810010
  |           WHEN SQLCODE IS EQUAL TO ZEROS                            05820010
  |              PERFORM 2160-FETCH                                     05830010
  |                                                                     05840010
  |              EVALUATE TRUE                                          05850010
  |                 WHEN SQLCODE IS EQUAL TO ZEROS                      05860010
  |                     PERFORM 2190-PROCESS-INTER-APPL-VAR             05870010
  |                 WHEN SQLCODE IS EQUAL TO +100                       05880010
  |                    SET PS-ERROR                                     05890010
  |                        DP020-MSG-FATAL TO TRUE                      05900010
  |                    MOVE PC-TSYMSG-01655 TO  DP020-MSG-NUMBER        05910010
  |                    MOVE DP015-UNP-ALP-BRT-OFF                       05920010
  |                                         TO ASTOREA                  05930010
  |                    MOVE DP015-RED       TO ASTOREC                  05940010
  |                    MOVE DP015-REVERSE   TO ASTOREH                  05950010
  |                    MOVE -1              TO ASTOREL                  05960010
  |                    SET DP030-SET-CURSOR-APPL-1 TO TRUE              05970010
  |                 WHEN SQLCODE IS EQUAL TO -913                       05980010
  |                 WHEN SQLCODE IS EQUAL TO -911                       05990010
  |                 WHEN SQLCODE IS EQUAL TO -904                       06000010
  |                    SET PS-ERROR                                     06010010
  |                        DP030-OVERRIDE-GO                            06020010
  |                        DP020-MSG-WARNING  TO TRUE                   06030010
  |                    MOVE PC-TSYMSG-01063   TO DP020-MSG-NUMBER       06040010
  |                    MOVE -1                TO ASTOREL                06050010
  |                    SET DP030-SET-CURSOR-APPL-1 TO TRUE              06060010
  |              END-EVALUATE                                           06070010
  |                                                                     06080010
  |           WHEN OTHER                                                06090010
  |              SET  DP030-OVERRIDE-GO                                 06100010
  |                   DP020-MSG-WARNING TO TRUE                         06110010
  |              MOVE PC-TSYMSG-00551   TO DP020-MSG-NUMBER             06120010
  |        END-EVALUATE.                                                06130010
  |                                                                     06140010
  |        PERFORM 2170-CLOSE-CURSOR.                                   06150010
25248                                                                   06160010
      *----------------------------------------------------------------*06170010
      * OPEN THE INVENTORY PARAMETERS CURSOR.                          *06180010
      *----------------------------------------------------------------*06190010
       2150-OPEN-CURSOR.                                                06200010
           EXEC SQL                                                     06210010
                OPEN INVPAR-CSR                                         06220010
           END-EXEC.                                                    06230010
                                                                        06240010
           EVALUATE TRUE                                                06250010
               WHEN SQLCODE = ZERO                                      06260010
23511              EXEC SQL                                             06270010
23511                  SET :PV-CURRENT-DATE = CURRENT DATE              06280010
23511              END-EXEC                                             06290010
                                                                        06300010
               WHEN SQLCODE = -904                                      06310010
               WHEN SQLCODE = -913                                      06320010
                   CONTINUE                                             06330010
               WHEN SQLWARN0 NOT = SPACES                               06340010
               WHEN SQLCODE  NOT = ZERO                                 06350010
                   MOVE '2150-OPEN-CURSOR'                              06360010
                                     TO DP013-PARAGRAPH                 06370010
                   MOVE 'OPEN INVENTORY PARAMETERS CURSOR'              06380010
                                     TO DP013-MESSAGE-TEXT (1)          06390010
                   MOVE SQLCA        TO DP013-SQLCA                     06400010
                   MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)        06410010
                   SET DP013-DB2-ABEND                                  06420010
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               06430010
                   PERFORM DP013-0000-PROCESS-ABEND                     06440010
           END-EVALUATE.                                                06450010
       EJECT                                                            06460010
      *----------------------------------------------------------------*06470010
      *    FETCH THE INVENTORY PARAMETERS CURSOR.                      *06480010
      *----------------------------------------------------------------*06490010
                                                                        06500010
       2160-FETCH.                                                      06510010
                                                                        06520010
           EXEC SQL                                                     06530010
                FETCH INVPAR-CSR                                        06540010
                INTO  :INVPAR-SHEET-INV-CPLD-IND                        06550010
                     ,:INVPAR-ACTL-INV-DTE                              06560010
                     ,:INVPAR-ACTL-UNIT-BK-DTE                          06570010
23511                ,:PV-SHEET-START-DTE-YYYYMMDD                      06580010
W24521               ,:INVPAR-UNT-BKG-STAT-CDE                          06590010
J28545               ,:INCNTL-INV-ID                                    06600012
J28545               ,:INCNTL-INV-NM                                    06610012
           END-EXEC.                                                    06620010
                                                                        06630010
           EVALUATE TRUE                                                06640010
               WHEN SQLCODE = ZERO                                      06650010
W28545             MOVE INCNTL-INV-ID TO IN030-INV-ID                   06660010
W28545             MOVE INCNTL-INV-NM TO IN030-INV-NM                   06670010
               WHEN SQLCODE = +100                                      06680010
               WHEN SQLCODE = -913                                      06690010
                    CONTINUE                                            06700010
               WHEN SQLWARN0 NOT = SPACE                                06710010
               WHEN SQLCODE  NOT = ZERO                                 06720010
                    MOVE '2160-FETCH'                                   06730010
                                     TO DP013-PARAGRAPH                 06740010
                    MOVE 'FETCH INVENTORY PARAMETERS CURSOR'            06750010
                                     TO DP013-MESSAGE-TEXT (1)          06760010
                    MOVE SQLCA       TO DP013-SQLCA                     06770010
                    SET DP013-DB2-ABEND                                 06780010
                                     TO TRUE                            06790010
                    PERFORM DP013-0000-PROCESS-ABEND                    06800010
           END-EVALUATE.                                                06810010
                                                                        06820010
       EJECT                                                            06830010
      *----------------------------------------------------------------*06840010
      * CLOSE THE INVENTORY PARAMETERS CURSOR.                          06850010
      *----------------------------------------------------------------*06860010
                                                                        06870010
       2170-CLOSE-CURSOR.                                               06880010
           EXEC SQL                                                     06890010
               CLOSE INVPAR-CSR                                         06900010
           END-EXEC.                                                    06910010
      *                                                                 06920010
           EVALUATE TRUE                                                06930010
               WHEN SQLCODE = ZERO                                      06940010
                   CONTINUE                                             06950010
               WHEN SQLWARN0 NOT = SPACES                               06960010
               WHEN SQLCODE  NOT = ZERO                                 06970010
                   MOVE '2170-CLOSE-CURSOR'                             06980010
                                     TO DP013-PARAGRAPH                 06990010
                   MOVE 'CLOSE INVENTORY PARAMETERS'                    07000010
                                     TO DP013-MESSAGE-TEXT (1)          07010010
                   MOVE SQLCA        TO DP013-SQLCA                     07020010
                   MOVE 'TINVPAR '   TO DP013-DB2-TABLE-NAME (1)        07030010
                   SET DP013-DB2-ABEND                                  07040010
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               07050010
                   PERFORM DP013-0000-PROCESS-ABEND                     07060010
           END-EVALUATE.                                                07070010
       EJECT                                                            07080010
                                                                        07090010
      *                                                                 07100010
      *----------------------------------------------------------------*07110010
      * PASS APPL-SPECIFIC INFO TO COMMAREA                             07120010
      * DISPLAY 'SHEET INVENTORY COMPLETE' FOR ADD, UPDATE OR DELETE    07130010
      *----------------------------------------------------------------*07140010
       2190-PROCESS-INTER-APPL-VAR.                                     07150010
W28545     MOVE INCNTL-INV-ID        TO IN030-INV-ID.                   07160010
W28545     MOVE INCNTL-INV-NM        TO IN030-INV-NM.                   07170010
                                                                        07180010
           IF INVPAR-SHEET-INV-CPLD-IND = 'Y'                           07190010
               SET IN030-SHEET-INV-COMPLETED  TO TRUE                   07200010
               MOVE INVPAR-ACTL-INV-DTE       TO IN030-DB2-ACTL-INV-DTE 07210010
               EVALUATE TRUE                                            07220010
                   WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)          07230010
                   WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)          07240010
                   WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)          07250010
                       SET PS-ERROR                                     07260010
                           DP020-MSG-FATAL      TO TRUE                 07270010
      *                --- SHEET INVENTORY ALREADY COMPLETED ---        07280010
                       MOVE PC-TSYMSG-02137  TO DP020-MSG-NUMBER        07290010
                       MOVE DP015-UNP-ALP-BRT-OFF                       07300010
                                                   TO ASTOREA           07310010
                       MOVE DP015-RED              TO ASTOREC           07320010
                       MOVE DP015-REVERSE          TO ASTOREH           07330010
                       MOVE -1                     TO ASTOREL           07340010
                       SET DP030-SET-CURSOR-APPL-1 TO TRUE              07350010
                   WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)          07360010
                   WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)          07370010
                       CONTINUE                                         07380010
               END-EVALUATE                                             07390010
           ELSE                                                         07400010
W05091     IF INVPAR-SHEET-INV-CPLD-IND = 'S'                           07410010
  |            SET IN030-SHEET-INV-COMPLETED  TO TRUE                   07420010
  |            MOVE INVPAR-ACTL-INV-DTE       TO IN030-DB2-ACTL-INV-DTE 07430010
  |            EVALUATE TRUE                                            07440010
  |                WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)          07450010
  |                WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)          07460010
  |                WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)          07470010
  |                    SET PS-ERROR                                     07480010
  |                        DP020-MSG-FATAL      TO TRUE                 07490010
  |   *                --- SHEET INVENTORY ALREADY COMPLETED ---        07500010
  |                    MOVE PC-TSYMSG-02701  TO DP020-MSG-NUMBER        07510010
  |                    MOVE DP015-UNP-ALP-BRT-OFF                       07520010
  |                                                TO ASTOREA           07530010
  |                    MOVE DP015-RED              TO ASTOREC           07540010
  |                    MOVE DP015-REVERSE          TO ASTOREH           07550010
  |                    MOVE -1                     TO ASTOREL           07560010
  |                    SET DP030-SET-CURSOR-APPL-1 TO TRUE              07570010
  |                WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)          07580010
  |                WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)          07590010
  |                    CONTINUE                                         07600010
  |            END-EVALUATE                                             07610010
W05091     ELSE                                                         07620010
               SET IN030-SHEET-INV-NOT-COMPLETED TO TRUE                07630010
               MOVE INVPAR-ACTL-INV-DTE       TO IN030-DB2-ACTL-INV-DTE 07640010
           END-IF.                                                      07650010
                                                                        07660010
      *----------------------------------------------------------------*07670010
      * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*07680010
      * THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *07690010
      * APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *07700010
      *----------------------------------------------------------------*07710010
                                                                        07720010
       2200-MOVE-SCREEN-TO-COMMAREA.                                    07730010
           IF  ASTOREL > ZERO                                           07740010
               MOVE ASTOREI        TO ASC-STORE-NBR-X                   07750010
           ELSE                                                         07760010
               IF  ASTOREF = DP015-ERASE-EOF                            07770010
                   MOVE SPACE      TO ASC-STORE-NBR-X                   07780010
                                      ASC-STORE-NAME                    07790010
                                      ASTRNAMO                          07800010
               END-IF                                                   07810010
           END-IF.                                                      07820010
                                                                        07830010
           IF  ASHEETL > ZERO                                           07840010
               MOVE ASHEETI        TO ASC-SHEET-NBR-X                   07850010
           ELSE                                                         07860010
               IF  ASHEETF = DP015-ERASE-EOF                            07870010
                   MOVE SPACE      TO ASC-SHEET-NBR-X                   07880010
               END-IF                                                   07890010
           END-IF.                                                      07900010
                                                                        07910010
W28545     IF  ATYPCDL > ZERO                                           07920010
W28545         MOVE ATYPCDI             TO ASC-TYPE-CDE                 07930010
W28545     ELSE                                                         07940010
W28545         IF  ATYPCDF = DP015-ERASE-EOF                            07950010
W28545             MOVE SPACE            TO ASC-TYPE-CDE                07960010
W28545                                      ASC-TYPE-CDE-DESC           07970010
W28545                                      ATYPDSCO                    07980010
W28545         END-IF                                                   07990010
W28545     END-IF.                                                      08000010
W28545                                                                  08010010
      *----------------------------------------------------------------*08020010
      * ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *08030010
      * CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *08040010
      * A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*08050010
      * IN THE DESTINATION PROGRAM, NOT HERE.                          *08060010
      *----------------------------------------------------------------*08070010
                                                                        08080010
       3000-EDIT-DATA-IN-COMMAREA.                                      08090010
                                                                        08100010
           PERFORM 3200-RESET-ATTRIBUTES.                               08110010
                                                                        08120010
W28545     IF (ASC-TYPE-ALL-SHEETS                                      08130010
W28545     OR  ASC-TYPE-TFR-SHEETS                                      08140010
W28545     OR  ASC-TYPE-MANI-SHEETS                                     08150010
W28545     OR  ASC-TYPE-ENTRD-SHEETS)                                   08160010
W28545         IF ASC-TYPE-ALL-SHEETS                                   08170010
W28545             SET ASC-DESC-ALL-SHEETS   TO TRUE                    08180010
W28545             MOVE ASC-TYPE-CDE-DESC    TO ATYPDSCO                08190010
W28545         ELSE                                                     08200010
W28545         IF ASC-TYPE-TFR-SHEETS                                   08210010
W28545             SET ASC-DESC-TFR-SHEETS   TO TRUE                    08220010
W28545             MOVE ASC-TYPE-CDE-DESC    TO ATYPDSCO                08230010
W28545         ELSE                                                     08240010
W28545         IF ASC-TYPE-MANI-SHEETS                                  08250010
W28545             SET ASC-DESC-MANI-SHEETS  TO TRUE                    08260010
W28545             MOVE ASC-TYPE-CDE-DESC    TO ATYPDSCO                08270010
W28545         ELSE                                                     08280010
W28545         IF ASC-TYPE-ENTRD-SHEETS                                 08290010
W28545             SET ASC-DESC-ENTRD-SHEETS TO TRUE                    08300010
W28545             MOVE ASC-TYPE-CDE-DESC    TO ATYPDSCO                08310010
W28545         ELSE                                                     08320010
W28545             SET PS-ERROR                                         08330010
W28545                 DP020-MSG-FATAL       TO  TRUE                   08340010
W28545             MOVE PC-TSYMSG-00007      TO  DP020-MSG-NUMBER       08350010
W28545             MOVE DP015-UNP-ALP-BRT-OFF                           08360010
W28545                                       TO  ATYPCDA                08370010
W28545             MOVE DP015-RED            TO  ATYPCDC                08380010
W28545             MOVE DP015-REVERSE        TO  ATYPCDH                08390010
W28545             MOVE -1                   TO  ATYPCDL                08400010
W28545             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08410010
W28545         END-IF                                                   08420010
W28545     ELSE                                                         08430010
W28545         SET PS-ERROR                                             08440010
W28545             DP020-MSG-FATAL       TO  TRUE                       08450010
W28545         MOVE PC-TSYMSG-00007      TO  DP020-MSG-NUMBER           08460010
W28545         MOVE DP015-UNP-ALP-BRT-OFF                               08470010
W28545                                   TO  ATYPCDA                    08480010
W28545         MOVE DP015-RED            TO  ATYPCDC                    08490010
W28545         MOVE DP015-REVERSE        TO  ATYPCDH                    08500010
W28545         MOVE -1                   TO  ATYPCDL                    08510010
W28545         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08520010
W28545     END-IF.                                                      08530010
W28545                                                                  08540010
           MOVE 'N' TO PV-ASTERISK-IND.                                 08550010
                                                                        08560010
           IF  ASC-SHEET-NBR-X > SPACE                                  08570010
               INSPECT ASC-SHEET-NBR-X                                  08580010
                   TALLYING PV-ASTERISK-CNT                             08590010
                   FOR ALL '*'                                          08600010
               IF PV-ASTERISK-CNT > ZERO                                08610010
                   MOVE ALL '*'               TO ASC-SHEET-NBR-X        08620010
                   MOVE 'Y'                   TO PV-ASTERISK-IND        08630010
               ELSE                                                     08640010
                   MOVE ASC-SHEET-NBR-X       TO DP010I-UNEDITED-FIELD  08650010
                   MOVE LENGTH OF ASC-SHEET-NBR                         08660010
                                              TO DP010I-MAXIMUM-DIGITS  08670010
                   MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS08680010
                   SET  DP010I-NEGATIVE-NOT-ALLOWED                     08690010
                                              TO TRUE                   08700010
263126             CALL DP010I-NUMERIC-EDIT-ROUTINE                     08711016
263126                  USING DP010I-NUMERIC-EDIT-AREA                  08712016
                   IF DP010I-ERROR-DETECTED                             08720010
                       SET  PS-ERROR                                    08730010
                            DP020-MSG-FATAL        TO TRUE              08740010
      *                ---- MUST BE NUMERIC ----                        08750010
                       MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  08760010
                       MOVE DP015-UNP-ALP-BRT-OFF  TO ASHEETA           08770010
                       MOVE DP015-RED              TO ASHEETC           08780010
                       MOVE DP015-REVERSE          TO ASHEETH           08790010
                       MOVE -1                     TO ASHEETL           08800010
                       SET DP030-SET-CURSOR-APPL-1 TO TRUE              08810010
                   ELSE                                                 08820010
                       MOVE DP010I-NUMERIC-FIELD TO ASC-SHEET-NBR       08830010
                       IF ASC-SHEET-NBR  = ZERO                         08840010
      * A SHEET NBR OF 000000 IS INVALID                                08850010
                           SET  PS-ERROR                                08860010
                                DP020-MSG-FATAL      TO TRUE            08870010
      *                    ---- CANNOT BE ZERO ----                     08880010
                           MOVE PC-TSYMSG-00010      TO DP020-MSG-NUMBER08890010
                           MOVE DP015-UNP-ALP-BRT-OFF                   08900010
                                                     TO ASHEETA         08910010
                           MOVE DP015-RED            TO ASHEETC         08920010
                           MOVE DP015-REVERSE        TO ASHEETH         08930010
                           MOVE -1                   TO ASHEETL         08940010
                           SET DP030-SET-CURSOR-APPL-1                  08950010
                                                     TO TRUE            08960010
                       ELSE                                             08970010
                           IF ASC-SHEET-NBR  <= 99999                   08980010
                           SET  PS-ERROR                                08990010
                                DP020-MSG-FATAL      TO TRUE            09000010
      *                    ---- MUST BE > 99999 ----                    09010010
                           MOVE PC-TSYMSG-02138      TO DP020-MSG-NUMBER09020010
                           MOVE DP015-UNP-ALP-BRT-OFF                   09030010
                                                     TO ASHEETA         09040010
                           MOVE DP015-RED            TO ASHEETC         09050010
                           MOVE DP015-REVERSE        TO ASHEETH         09060010
                           MOVE -1                   TO ASHEETL         09070010
                           SET DP030-SET-CURSOR-APPL-1                  09080010
                                                     TO TRUE            09090010
                           ELSE                                         09100010
                               IF PV-ASTERISK-ENTERED                   09110010
                               SET  PS-ERROR                            09120010
                                    DP020-MSG-FATAL      TO TRUE        09130010
      *                    ---- ENTER A VALID VALUE ----                09140010
                               MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER09150010
                               MOVE DP015-UNP-ALP-BRT-OFF               09160010
                                                         TO ASHEETA     09170010
                               MOVE DP015-RED            TO ASHEETC     09180010
                               MOVE DP015-REVERSE        TO ASHEETH     09190010
                               MOVE -1                   TO ASHEETL     09200010
                               SET DP030-SET-CURSOR-APPL-1              09210010
                                                     TO TRUE            09220010
                           END-IF                                       09230010
                       END-IF                                           09240010
                   END-IF                                               09250010
               END-IF                                                   09260010
           ELSE                                                         09270010
               SET  PS-ERROR                                            09280010
                    DP020-MSG-FATAL        TO TRUE                      09290010
      *        ---- REQUIRED ENTRY ----                                 09300010
               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          09310010
               MOVE DP015-UNP-ALP-BRT-OFF  TO ASHEETA                   09320010
               MOVE DP015-RED              TO ASHEETC                   09330010
               MOVE DP015-REVERSE          TO ASHEETH                   09340010
               MOVE -1                     TO ASHEETL                   09350010
               SET DP030-SET-CURSOR-APPL-1 TO TRUE                      09360010
           END-IF.                                                      09370010
                                                                        09380010
                                                                        09390010
           IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                     09400010
               IF ASC-STORE-NBR-X > SPACE                               09410010
                   MOVE ASC-STORE-NBR-X       TO DP010I-UNEDITED-FIELD  09420010
                   MOVE LENGTH OF ASC-STORE-NBR                         09430010
                                              TO DP010I-MAXIMUM-DIGITS  09440010
                   MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS09450010
                   SET  DP010I-NEGATIVE-NOT-ALLOWED                     09460010
                                              TO TRUE                   09470010
263126             CALL DP010I-NUMERIC-EDIT-ROUTINE                     09481016
263126                  USING DP010I-NUMERIC-EDIT-AREA                  09482016
                                                                        09490010
                   IF DP010I-ERROR-DETECTED                             09500010
                       SET  PS-ERROR                                    09510010
                            DP020-MSG-FATAL        TO TRUE              09520010
      *                ---- MUST BE NUMERIC ----                        09530010
                       MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  09540010
                       MOVE DP015-UNP-NUM-BRT-OFF  TO ASTOREA           09550010
                       MOVE DP015-RED              TO ASTOREC           09560010
                       MOVE DP015-REVERSE          TO ASTOREH           09570010
                       MOVE -1                     TO ASTOREL           09580010
                       SET DP030-SET-CURSOR-APPL-1 TO TRUE              09590010
                   ELSE                                                 09600010
                       MOVE DP010I-NUMERIC-FIELD TO ASC-STORE-NBR       09610010
                       IF ASC-STORE-NBR  = ZERO                         09620010
                           SET  PS-ERROR                                09630010
                                DP020-MSG-FATAL         TO TRUE         09640010
      *                    ---- CANNOT BE ZERO ----                     09650010
                           MOVE PC-TSYMSG-00010      TO DP020-MSG-NUMBER09660010
                           MOVE DP015-UNP-NUM-BRT-OFF                   09670010
                                                     TO ASTOREA         09680010
                           MOVE DP015-RED            TO ASTOREC         09690010
                           MOVE DP015-REVERSE        TO ASTOREH         09700010
                           MOVE -1                   TO ASTOREL         09710010
                           SET DP030-SET-CURSOR-APPL-1                  09720010
                                                     TO TRUE            09730010
                       ELSE                                             09740010
                           PERFORM 3300-GET-STORE-NAME                  09750010
                           EVALUATE TRUE                                09760010
                               WHEN SQLCODE = 0                         09770010
                                   MOVE XMT00001-LOC-NM                 09780010
                                                       TO ASC-STORE-NAME09790010
W26600                                                    ASTRNAMO      09800010
                               WHEN SQLCODE = +100                      09810010
                                   SET  PS-ERROR                        09820010
                                        DP020-MSG-FATAL       TO TRUE   09830010
      *                            ---- STORE DOES NOT EXIST ----       09840010
W26600                             MOVE SPACE          TO ASC-STORE-NAME09850010
W26600                                                    ASTRNAMO      09860010
                                   MOVE PC-TSYMSG-00017                 09870010
                                                     TO DP020-MSG-NUMBER09880010
                                   MOVE DP015-UNP-NUM-BRT-OFF TO ASTOREA09890010
                                   MOVE DP015-RED             TO ASTOREC09900010
                                   MOVE DP015-REVERSE         TO ASTOREH09910010
                                   MOVE -1                    TO ASTOREL09920010
                                   SET DP030-SET-CURSOR-APPL-1          09930010
                                                              TO TRUE   09940010
                               WHEN OTHER                               09950010
W26600                             MOVE SPACE          TO ASC-STORE-NAME09960010
W26600                                                    ASTRNAMO      09970010
                                   SET  PS-ERROR                        09980010
                                        DP020-MSG-WARNING      TO TRUE  09990010
      *                            ---- WAIT 15 SECONDS, THEN RETRY ----10000010
                                   MOVE PC-TSYMSG-00551                 10010010
                                                     TO DP020-MSG-NUMBER10020010
                           END-EVALUATE                                 10030010
                       END-IF                                           10040010
                   END-IF                                               10050010
               ELSE                                                     10060010
                   SET  PS-ERROR                                        10070010
                        DP020-MSG-FATAL        TO TRUE                  10080010
      *            ---- REQUIRED ENTRY ----                             10090010
                   MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      10100010
                   MOVE DP015-UNP-NUM-BRT-OFF  TO ASTOREA               10110010
                   MOVE DP015-RED              TO ASTOREC               10120010
                   MOVE DP015-REVERSE          TO ASTOREH               10130010
                   MOVE -1                     TO ASTOREL               10140010
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10150010
               END-IF                                                   10160010
           ELSE                                                         10170010
W26600*        MOVE DP020-LOCATION TO ASC-STORE-NBR-X                   10180010
W26600         MOVE DP020-LOCATION-NBR TO ASC-STORE-NBR-X               10190010
               PERFORM 3300-GET-STORE-NAME                              10200010
W26600         MOVE XMT00001-LOC-NM    TO ASC-STORE-NAME                10210010
W26600                                    ASTRNAMO                      10220010
           END-IF.                                                      10230010
                                                                        10240010
           IF  PS-NO-ERROR                                              10250010
               IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                 10260010
                   MOVE -1                  TO ASTOREL                  10270010
               ELSE                                                     10280010
                   MOVE -1                  TO ASHEETL                  10290010
               END-IF                                                   10300010
               SET DP030-SET-CURSOR-APPL-1  TO TRUE                     10310010
           END-IF.                                                      10320010
                                                                        10330010
      ******************************************************************10340010
      ** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **10350010
      ** MAP.                                                         **10360010
      ******************************************************************10370010
                                                                        10380010
       3200-RESET-ATTRIBUTES.                                           10390010
           IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                     10400010
               MOVE DP015-UNP-NUM-NOR-OFF  TO ASTOREA                   10410010
               MOVE DP015-GREEN            TO ASTOREC                   10420010
               MOVE DP015-UNDERLINE        TO ASTOREH                   10430010
           ELSE                                                         10440010
               MOVE DP015-ASK-NOR-OFF      TO ASTOREA                   10450010
               MOVE DP015-BLUE             TO ASTOREC                   10460010
               MOVE DP015-HL-OFF           TO ASTOREH                   10470010
           END-IF.                                                      10480010
                                                                        10490010
           MOVE DP015-UNP-ALP-NOR-OFF      TO ASHEETA.                  10500010
           MOVE DP015-GREEN                TO ASHEETC.                  10510010
           MOVE DP015-UNDERLINE            TO ASHEETH.                  10520010
                                                                        10530010
W28545     MOVE DP015-UNP-ALP-NOR-OFF      TO ATYPCDA.                  10540010
W28545     MOVE DP015-GREEN                TO ATYPCDC.                  10550010
W28545     MOVE DP015-UNDERLINE            TO ATYPCDH.                  10560010
W28545                                                                  10570010
       3300-GET-STORE-NAME.                                             10580010
                                                                        10590010
W26600     MOVE ASC-STORE-NBR   TO XMT00001-LOC-NBR                     10600010
                                                                        10610010
           EXEC SQL                                                     10620010
W26600         SELECT LOC_NM                                            10630010
W26600              , LOC_TYP_CDE                                       10640010
W26600         INTO  :XMT00001-LOC-NM                                   10650010
W26600              ,:XMT00001-LOC-TYP-CDE                              10660010
W26600         FROM   XMT_LOC                                           10670010
W26600         WHERE  LOC_NBR = :XMT00001-LOC-NBR                       10680010
           END-EXEC.                                                    10690010
                                                                        10700010
           EVALUATE TRUE                                                10710010
               WHEN SQLCODE = ZERO                                      10720010
               WHEN SQLCODE = +100                                      10730010
               WHEN SQLCODE = -904                                      10740010
               WHEN SQLCODE = -913                                      10750010
                   CONTINUE                                             10760010
               WHEN SQLWARN0 NOT = SPACE                                10770010
               WHEN SQLCODE  NOT = ZERO                                 10780010
                    MOVE '3300-GET-STORE-NAME'                          10790010
                                 TO  DP013-PARAGRAPH                    10800010
W26600              MOVE 'READ XMT_LOC'                                 10810010
                                 TO  DP013-MESSAGE-TEXT (1)             10820010
                    MOVE SQLCA   TO  DP013-SQLCA                        10830010
                    SET DP013-DB2-ABEND                                 10840010
                                 TO  TRUE                               10850010
                    PERFORM DP013-0000-PROCESS-ABEND                    10860010
           END-EVALUATE.                                                10870010
                                                                        10880010
                                                                        10890010
      *----------------------------------------------------------------*10900010
      *  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *10910010
      *  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *10920010
      *  IT HERE.                                                      *10930010
      *----------------------------------------------------------------*10940010
                                                                        10950010
       4000-BUILD-INITIAL-PANEL.                                        10960010
           IF DP020-LOCATION-TYPE = PC-HEADQUARTERS                     10970010
               MOVE DP015-UNP-NUM-NOR-OFF  TO ASTOREA                   10980010
               MOVE DP015-GREEN            TO ASTOREC                   10990010
               MOVE DP015-UNDERLINE        TO ASTOREH                   11000010
               MOVE -1                     TO ASTOREL                   11010010
               MOVE LOW-VALUES             TO ASTOREO                   11020010
           ELSE                                                         11030010
W26600         MOVE DP020-LOCATION-NBR     TO ASC-STORE-NBR             11040010
W26600         MOVE ASC-STORE-NBR          TO ASTOREO                   11050010
               MOVE -1                     TO ASHEETL                   11060010
           END-IF.                                                      11070010
                                                                        11080010
           SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         11090010
           MOVE SPACE                  TO ASHEETO.                      11100010
                                                                        11110010
      *----------------------------------------------------------------*11120010
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *11130010
      *----------------------------------------------------------------*11140010
                                                                        11150010
       4400-MOVE-COMMAREA-TO-SCREEN.                                    11160010
           MOVE ASC-STORE-NBR-X TO ASTOREO.                             11170010
           MOVE ASC-SHEET-NBR-X TO ASHEETO.                             11180010
W28545     MOVE ASC-TYPE-CDE    TO ATYPCDO.                             11190010
                                                                        11200010
      *----------------------------------------------------------------*11210010
      *    CURRENT SYSTEM DATE/TIME MODULE                              11220010
      *----------------------------------------------------------------*11230010
                                                                        11240010
           COPY DPPD017.                                                11250010
                                                                        11260010
      *----------------------------------------------------------------*11270010
      *    ABEND PROCESSOR MODULE                                      *11280010
      *----------------------------------------------------------------*11290010
                                                                        11300010
           COPY DPPD013.                                                11310010
